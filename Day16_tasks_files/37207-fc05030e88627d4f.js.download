(this.webpackChunk_msteams_light_meetings=this.webpackChunk_msteams_light_meetings||[]).push([["37207"],{373775:function(e,t,i){"use strict";i.d(t,{I6:()=>a,OU:()=>o,$8:()=>l});var n=i(703937),r={},s={};function a(e,t){return r[c(e,t)]}function o(e,t,n,a){var o=c(t,a),l=r[o];if(l&&!n)return Promise.resolve(l);var d=s[o];if(d&&!n)return d;if(!e)return Promise.reject("Missing bootstrapper config");var u=i.e("90601").then(i.bind(i,787429)).then(function(t){return t.initialize(e).then(function(e){return r[o]=e,e})});return s[o]=u,u}function l(e,t){var i=c(e,t);delete r[i],delete s[i]}function c(e,t){var i;return[(0,n.Xt)(e),null==(i=null==t?void 0:t.getCacheKeySuffix)?void 0:i.call(t)].join("_")}i(629266)},409478:function(e,t,i){"use strict";i.d(t,{z:()=>n});var n={TopicPickerOpen:"Cortex.TopicAnnotations.TopicPicker.Open",TopicPickerClose:"Cortex.TopicAnnotations.TopicPicker.Close",ManualTagAdd:"Cortex.TopicAnnotations.ManualTag.Add",ManualTagRemove:"Cortex.TopicAnnotations.ManualTag.Remove",ManualTagLoad:"Cortex.TopicAnnotations.ManualTag.Load",ManualTagLoadFailed:"Cortex.TopicAnnotations.ManualTag.LoadError",AutomaticTagLoad:"Cortex.TopicAnnotations.AutomaticTag.Load",AutomaticTagLoadFailed:"Cortex.TopicAnnotations.AutomaticTag.LoadError",TopicCardOpen:"Cortex.TopicAnnotations.TopicCard.Open",ManualTagSend:"Cortex.TopicAnnotations.ManualTag.Send",TopicSmartActionRender:"Cortex.TopicAnnotations.SmartAction.Render",TopicSmartActionHover:"Cortex.TopicAnnotations.SmartAction.Hover",TopicSmartActionClick:"Cortex.TopicAnnotations.SmartAction.Click"}},603099:function(e,t,i){"use strict";i.d(t,{a:()=>a,mT:()=>s});var n=i(147714),r=i(362653),s=n.Q,a=r.j},721805:function(e,t,i){"use strict";i.d(t,{R:()=>o,i:()=>a});var n=i(134335),r=i(632735),s=(0,n.z)(null,"@1js/density-react#DensityEnvironment");function a(){var e=r.useContext(s);if(!e)throw Error("no Density environment on the context");return e}var o=s.Provider},806637:function(e,t,i){"use strict";var n;function r(e){return!!e&&e<7}i.d(t,{I:()=>n,O:()=>r}),function(e){e[e.loading=1]="loading",e[e.setVariables=2]="setVariables",e[e.fetchMore=3]="fetchMore",e[e.refetch=4]="refetch",e[e.poll=6]="poll",e[e.ready=7]="ready",e[e.error=8]="error"}(n||(n={}))},324605:function(e,t,i){"use strict";i.d(t,{M:()=>s,c:()=>o});var n=i(231191);i(773971);var r=i(926929);function s(e){return e.hasOwnProperty("graphQLErrors")}var a=function(e){var t="";return((0,r.O)(e.graphQLErrors)||(0,r.O)(e.clientErrors))&&(e.graphQLErrors||[]).concat(e.clientErrors||[]).forEach(function(e){var i=e?e.message:"Error message not found.";t+="".concat(i,"\n")}),e.networkError&&(t+="".concat(e.networkError.message,"\n")),t=t.replace(/\n$/,"")},o=function(e){function t(i){var n=i.graphQLErrors,r=i.clientErrors,s=i.networkError,o=i.errorMessage,l=i.extraInfo,c=e.call(this,o)||this;return c.graphQLErrors=n||[],c.clientErrors=r||[],c.networkError=s||null,c.message=o||a(c),c.extraInfo=l,c.__proto__=t.prototype,c}return(0,n.__extends)(t,e),t}(Error)},920259:function(e,t,i){"use strict";i.d(t,{m:()=>r});var n=i(38541);function r(e){var t=(0,n.D)(e.mutation,e),i=t[0],r=t[1];return e.children?e.children(i,r):null}},74031:function(e,t,i){"use strict";i.d(t,{A:()=>s});var n=i(231191),r=i(413260);function s(e){var t=e.children,i=e.query,s=(0,n.__rest)(e,["children","query"]),a=(0,r.a)(i,s);return a?t(a):null}},202500:function(e,t,i){"use strict";i.d(t,{w:()=>r});var n=i(140530);function r(e){var t=(0,n.m)(e.subscription,e);return e.children&&t?e.children(t):null}},499020:function(e,t,i){"use strict";i.d(t,{a:()=>a});var n=i(773971),r=i(632735),s=i(355261),a=function(e){var t=(0,s.K)();return r.createElement(t.Consumer,null,function(t){return __DEV__?(0,n.kG)(t&&t.client,'Could not find "client" in the context of ApolloConsumer. Wrap the root component in an <ApolloProvider>.'):(0,n.kG)(t&&t.client,26),e.children(t.client)})}},355261:function(e,t,i){"use strict";i.d(t,{K:()=>s});var n=i(632735),r=i(588196).aS?Symbol.for("__APOLLO_CONTEXT__"):"__APOLLO_CONTEXT__";function s(){var e=n.createContext[r];return e||(Object.defineProperty(n.createContext,r,{value:e=n.createContext({}),enumerable:!1,writable:!1,configurable:!0}),e.displayName="ApolloContext"),e}},158045:function(e,t,i){"use strict";i.d(t,{j:()=>f});var n=i(231191),r=i(632735),s=i(559431),a=i.n(s),o=i(414222),l=i(74031),c=i(773971),d=function(){return{}},u=function(){return!1};function h(e){return e.displayName||e.name||"Component"}function g(e,t){for(var i={},n=0,r=e.variables;n<r.length;n++){var s=r[n],a=s.variable,o=s.type;if(a.name&&a.name.value){var l=a.name.value,c=t[l];if(void 0!==c){i[l]=c;continue}"NonNullType"!==o.kind&&(i[l]=void 0)}}return i}var p=function(e){function t(t){var i=e.call(this,t)||this;return i.withRef=!1,i.setWrappedInstance=i.setWrappedInstance.bind(i),i}return(0,n.__extends)(t,e),t.prototype.getWrappedInstance=function(){return __DEV__?(0,c.kG)(this.withRef,"To access the wrapped instance, you need to specify { withRef: true } in the options"):(0,c.kG)(this.withRef,28),this.wrappedInstance},t.prototype.setWrappedInstance=function(e){this.wrappedInstance=e},t}(r.Component);function f(e,t){void 0===t&&(t={});var i,s=(0,o.E2)(e),c=t.options,f=void 0===c?d:c,m=t.skip,v=void 0===m?u:m,S=t.alias,y=void 0===S?"Apollo":S,C=f;"function"!=typeof C&&(C=function(){return f});var b=v;return"function"!=typeof b&&(b=function(){return v}),function(o){var c="".concat(y,"(").concat(h(o),")"),d=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}return(0,n.__extends)(d,a),d.prototype.render=function(){var a=this,d=this.props,u=b(d),h=u?Object.create(null):(0,n.__assign)({},C(d));return u||h.variables||!(s.variables.length>0)||(h.variables=g(s,d)),r.createElement(l.A,(0,n.__assign)({},h,{displayName:c,skip:u,query:e}),function(e){e.client;var s,l,c=e.data,h=(0,n.__rest)(e,["client","data"]);if(t.withRef&&(a.withRef=!0,d=Object.assign({},d,{ref:a.setWrappedInstance})),u)return r.createElement(o,(0,n.__assign)({},d,{}));var g=Object.assign(h,c||{}),p=t.name||"data",f=((s={})[p]=g,s);if(t.props){var m=((l={})[p]=g,l.ownProps=d,l);f=i=t.props(m,i)}return r.createElement(o,(0,n.__assign)({},d,f))})},d.displayName=c,d.WrappedComponent=o,d}(p);return a()(d,o,{})}}},952121:function(e,t,i){"use strict";i.d(t,{C:()=>d});var n=i(231191),r=i(773971),s=i(632735),a=i(559431),o=i.n(a),l=i(499020);function c(e){return e.displayName||e.name||"Component"}function d(e,t){void 0===t&&(t={});var i="withApollo(".concat(c(e),")"),a=function(a){function o(e){var t=a.call(this,e)||this;return t.setWrappedInstance=t.setWrappedInstance.bind(t),t}return(0,n.__extends)(o,a),o.prototype.getWrappedInstance=function(){return __DEV__?(0,r.kG)(t.withRef,"To access the wrapped instance, you need to specify { withRef: true } in the options"):(0,r.kG)(t.withRef,29),this.wrappedInstance},o.prototype.setWrappedInstance=function(e){this.wrappedInstance=e},o.prototype.render=function(){var i=this;return s.createElement(l.a,null,function(r){var a=Object.assign({},i.props,{client:r,ref:t.withRef?i.setWrappedInstance:void 0});return s.createElement(e,(0,n.__assign)({},a))})},o.displayName=i,o.WrappedComponent=e,o}(s.Component);return o()(a,e,{})}},688448:function(e,t,i){"use strict";i.d(t,{x:()=>a});var n=i(773971),r=i(632735),s=i(355261);function a(e){var t=(0,r.useContext)((0,s.K)()),i=e||t.client;return __DEV__?(0,n.kG)(!!i,'Could not find "client" in the context or passed in as an option. Wrap the root component in an <ApolloProvider>, or pass an ApolloClient instance in via options.'):(0,n.kG)(!!i,30),i}},146854:function(e,t,i){"use strict";i.d(t,{J:()=>h});var n=i(231191),r=i(632735),s=i(838766),a=i(172321),o=i(688448),l=i(437703);function c(e,t){var i=r.useRef();return i.current&&(0,s.D)(i.current.deps,t)||(i.current={value:e(),deps:t}),i.current.value}var d={};function u(e){var t=r.useRef(d);return t.current===d&&(t.current=e()),t}function h(e){var t=(0,o.x)().cache,i=c(function(){var i=e.fragment,r=e.fragmentName,s=e.from,a=e.optimistic,o=void 0===a||a,l=(0,n.__rest)(e,["fragment","fragmentName","from","optimistic"]);return(0,n.__assign)((0,n.__assign)({},l),{returnPartialData:!0,id:"string"==typeof s?s:t.identify(s),query:t.getFragmentDoc(i,r),optimistic:o})},[e]),a=u(function(){return g(t.diff(i))}),d=r.useCallback(function(){return a.current},[]);return(0,l.$)(r.useCallback(function(e){var r=0,o=t.watch((0,n.__assign)((0,n.__assign)({},i),{immediate:!0,callback:function(t){(0,s.D)(t.result,a.current.data)||(a.current=g(t),clearTimeout(r),r=setTimeout(e))}}));return function(){o(),clearTimeout(r)}},[t,i]),d,d)}function g(e){var t={data:e.result,complete:!!e.complete};return e.missing&&(t.missing=(0,a.bw)(e.missing.map(function(e){return e.missing}))),t}},731121:function(e,t,i){"use strict";i.d(t,{t:()=>c});var n=i(231191),r=i(632735),s=i(207796),a=i(413260),o=i(688448),l=["refetch","reobserve","fetchMore","updateQuery","startPolling","subscribeToMore"];function c(e,t){var i=(0,a.A)((0,o.x)(t&&t.client),e),c=(0,r.useRef)(),d=c.current?(0,s.J)(t,c.current):t,u=i.useQuery((0,n.__assign)((0,n.__assign)({},d),{skip:!c.current})),h=u.observable.options.initialFetchPolicy||i.getDefaultFetchPolicy(),g=Object.assign(u,{called:!!c.current}),p=(0,r.useMemo)(function(){for(var e={},t=function(t){var n=g[t];e[t]=function(){return c.current||(c.current=Object.create(null),i.forceUpdate()),n.apply(this,arguments)}},n=0,r=l;n<r.length;n++)t(r[n]);return e},[]);return Object.assign(g,p),[(0,r.useCallback)(function(e){c.current=e?(0,n.__assign)((0,n.__assign)({},e),{fetchPolicy:e.fetchPolicy||h}):{fetchPolicy:h};var t=i.asyncUpdate().then(function(e){return Object.assign(e,p)});return t.catch(function(){}),t},[]),g]}},38541:function(e,t,i){"use strict";i.d(t,{D:()=>d});var n=i(231191),r=i(632735),s=i(207796),a=i(838766),o=i(414222),l=i(324605),c=i(688448);function d(e,t){var i=(0,c.x)(null==t?void 0:t.client);(0,o.Vp)(e,o.n_.Mutation);var d=(0,r.useState)({called:!1,loading:!1,client:i}),u=d[0],h=d[1],g=(0,r.useRef)({result:u,mutationId:0,isMounted:!0,client:i,mutation:e,options:t});Object.assign(g.current,{client:i,options:t,mutation:e});var p=(0,r.useCallback)(function(e){void 0===e&&(e={});var t=g.current,i=t.client,r=t.options,o=t.mutation,c=(0,n.__assign)((0,n.__assign)({},r),{mutation:o});g.current.result.loading||c.ignoreResults||h(g.current.result={loading:!0,error:void 0,data:void 0,called:!0,client:i});var d=++g.current.mutationId,u=(0,s.J)(c,e);return i.mutate(u).then(function(t){var n,r,s,o=t.data,c=t.errors,p=c&&c.length>0?new l.c({graphQLErrors:c}):void 0;if(d===g.current.mutationId&&!u.ignoreResults){var f={called:!0,loading:!1,data:o,error:p,client:i};g.current.isMounted&&!(0,a.D)(g.current.result,f)&&h(g.current.result=f)}return null==(r=null==(n=g.current.options)?void 0:n.onCompleted)||r.call(n,t.data),null==(s=e.onCompleted)||s.call(e,t.data),t}).catch(function(t){var n,r,s,o;if(d===g.current.mutationId&&g.current.isMounted){var l={loading:!1,error:t,data:void 0,called:!0,client:i};(0,a.D)(g.current.result,l)||h(g.current.result=l)}if((null==(n=g.current.options)?void 0:n.onError)||u.onError)return null==(s=null==(r=g.current.options)?void 0:r.onError)||s.call(r,t),null==(o=e.onError)||o.call(e,t),{data:void 0,errors:t};throw t})},[]),f=(0,r.useCallback)(function(){h({called:!1,loading:!1,client:i})},[]);return(0,r.useEffect)(function(){return g.current.isMounted=!0,function(){g.current.isMounted=!1}},[]),[p,(0,n.__assign)({reset:f},u)]}},413260:function(e,t,i){"use strict";i.d(t,{A:()=>y,a:()=>S});var n=i(231191),r=i(773971),s=i(632735),a=i(437703),o=i(838766),l=i(207796),c=i(355261),d=i(324605),u=i(806637),h=i(414222),g=i(688448),p=i(588196),f=i(268648),m=i(926929),v=Object.prototype.hasOwnProperty;function S(e,t){return void 0===t&&(t=Object.create(null)),y((0,g.x)(t.client),e).useQuery(t)}function y(e,t){var i=(0,s.useRef)();i.current&&e===i.current.client&&t===i.current.query||(i.current=new C(e,t,i.current));var n=i.current,r=(0,s.useState)(0),a=(r[0],r[1]);return n.forceUpdate=function(){a(function(e){return e+1})},n}var C=function(){function e(e,t,i){this.client=e,this.query=t,this.asyncResolveFns=new Set,this.optionsToIgnoreOnce=new(p.sy?WeakSet:Set),this.ssrDisabledResult=(0,f.J)({loading:!0,data:void 0,error:void 0,networkStatus:u.I.loading}),this.skipStandbyResult=(0,f.J)({loading:!1,data:void 0,error:void 0,networkStatus:u.I.ready}),this.toQueryResultCache=new(p.mr?WeakMap:Map),(0,h.Vp)(t,h.n_.Query);var n=i&&i.result,r=n&&n.data;r&&(this.previousData=r)}return e.prototype.forceUpdate=function(){__DEV__&&r.kG.warn("Calling default no-op implementation of InternalState#forceUpdate")},e.prototype.asyncUpdate=function(){var e=this;return new Promise(function(t){e.asyncResolveFns.add(t),e.optionsToIgnoreOnce.add(e.watchQueryOptions),e.forceUpdate()})},e.prototype.useQuery=function(e){var t=this;this.renderPromises=(0,s.useContext)((0,c.K)()).renderPromises,this.useOptions(e);var i=this.useObservableQuery(),n=(0,a.$)((0,s.useCallback)(function(){if(t.renderPromises)return function(){};var e=function(){var e=t.result,n=i.getCurrentResult();e&&e.loading===n.loading&&e.networkStatus===n.networkStatus&&(0,o.D)(e.data,n.data)||t.setResult(n)},n=function(s){var a=i.last;r.unsubscribe();try{i.resetLastResults(),r=i.subscribe(e,n)}finally{i.last=a}if(!v.call(s,"graphQLErrors"))throw s;var l=t.result;(!l||l&&l.loading||!(0,o.D)(s,l.error))&&t.setResult({data:l&&l.data,error:s,loading:!1,networkStatus:u.I.error})},r=i.subscribe(e,n);return function(){return r.unsubscribe()}},[i,this.renderPromises,this.client.disableNetworkFetches]),function(){return t.getCurrentResult()},function(){return t.getCurrentResult()});this.unsafeHandlePartialRefetch(n);var r=this.toQueryResult(n);return!r.loading&&this.asyncResolveFns.size&&(this.asyncResolveFns.forEach(function(e){return e(r)}),this.asyncResolveFns.clear()),r},e.prototype.useOptions=function(t){var i,n=this.createWatchQueryOptions(this.queryHookOptions=t),r=this.watchQueryOptions;(this.optionsToIgnoreOnce.has(r)||!(0,o.D)(n,r))&&(this.watchQueryOptions=n,r&&this.observable&&(this.optionsToIgnoreOnce.delete(r),this.observable.reobserve(n),this.previousData=(null==(i=this.result)?void 0:i.data)||this.previousData,this.result=void 0)),this.onCompleted=t.onCompleted||e.prototype.onCompleted,this.onError=t.onError||e.prototype.onError,(this.renderPromises||this.client.disableNetworkFetches)&&!1===this.queryHookOptions.ssr&&!this.queryHookOptions.skip?this.result=this.ssrDisabledResult:this.queryHookOptions.skip||"standby"===this.watchQueryOptions.fetchPolicy?this.result=this.skipStandbyResult:(this.result===this.ssrDisabledResult||this.result===this.skipStandbyResult)&&(this.result=void 0)},e.prototype.createWatchQueryOptions=function(e){void 0===e&&(e={});var t,i=e.skip,r=Object.assign((e.ssr,e.onCompleted,e.onError,e.displayName,e.defaultOptions,(0,n.__rest)(e,["skip","ssr","onCompleted","onError","displayName","defaultOptions"])),{query:this.query});if(this.renderPromises&&("network-only"===r.fetchPolicy||"cache-and-network"===r.fetchPolicy)&&(r.fetchPolicy="cache-first"),r.variables||(r.variables={}),i){var s=r.fetchPolicy,a=void 0===s?this.getDefaultFetchPolicy():s,o=r.initialFetchPolicy;Object.assign(r,{initialFetchPolicy:void 0===o?a:o,fetchPolicy:"standby"})}else r.fetchPolicy||(r.fetchPolicy=(null==(t=this.observable)?void 0:t.options.initialFetchPolicy)||this.getDefaultFetchPolicy());return r},e.prototype.getDefaultFetchPolicy=function(){var e,t;return(null==(e=this.queryHookOptions.defaultOptions)?void 0:e.fetchPolicy)||(null==(t=this.client.defaultOptions.watchQuery)?void 0:t.fetchPolicy)||"cache-first"},e.prototype.onCompleted=function(e){},e.prototype.onError=function(e){},e.prototype.useObservableQuery=function(){var e=this.observable=this.renderPromises&&this.renderPromises.getSSRObservable(this.watchQueryOptions)||this.observable||this.client.watchQuery((0,l.J)(this.queryHookOptions.defaultOptions,this.watchQueryOptions));this.obsQueryFields=(0,s.useMemo)(function(){return{refetch:e.refetch.bind(e),reobserve:e.reobserve.bind(e),fetchMore:e.fetchMore.bind(e),updateQuery:e.updateQuery.bind(e),startPolling:e.startPolling.bind(e),stopPolling:e.stopPolling.bind(e),subscribeToMore:e.subscribeToMore.bind(e)}},[e]);var t=!(!1===this.queryHookOptions.ssr||this.queryHookOptions.skip);return this.renderPromises&&t&&(this.renderPromises.registerSSRObservable(e),e.getCurrentResult().loading&&this.renderPromises.addObservableQueryPromise(e)),e},e.prototype.setResult=function(e){var t=this.result;t&&t.data&&(this.previousData=t.data),this.result=e,this.forceUpdate(),this.handleErrorOrCompleted(e)},e.prototype.handleErrorOrCompleted=function(e){!e.loading&&(e.error?this.onError(e.error):e.data&&this.onCompleted(e.data))},e.prototype.getCurrentResult=function(){return this.result||this.handleErrorOrCompleted(this.result=this.observable.getCurrentResult()),this.result},e.prototype.toQueryResult=function(e){var t=this.toQueryResultCache.get(e);if(t)return t;var i=e.data,r=(e.partial,(0,n.__rest)(e,["data","partial"]));return this.toQueryResultCache.set(e,t=(0,n.__assign)((0,n.__assign)((0,n.__assign)({data:i},r),this.obsQueryFields),{client:this.client,observable:this.observable,variables:this.observable.variables,called:!0,previousData:this.previousData})),!t.error&&(0,m.O)(e.errors)&&(t.error=new d.c({graphQLErrors:e.errors})),t},e.prototype.unsafeHandlePartialRefetch=function(e){e.partial&&this.queryHookOptions.partialRefetch&&!e.loading&&(!e.data||0===Object.keys(e.data).length)&&"cache-only"!==this.observable.options.fetchPolicy&&(Object.assign(e,{loading:!0,networkStatus:u.I.refetch}),this.observable.refetch())},e}()},140530:function(e,t,i){"use strict";i.d(t,{m:()=>o}),i(773971);var n=i(632735),r=i(838766),s=i(414222),a=i(688448);function o(e,t){var i=(0,a.x)(null==t?void 0:t.client);(0,s.Vp)(e,s.n_.Subscription);var o=(0,n.useState)({loading:!(null==t?void 0:t.skip),error:void 0,data:void 0,variables:null==t?void 0:t.variables}),l=o[0],c=o[1],d=(0,n.useState)(function(){return(null==t?void 0:t.skip)?null:i.subscribe({query:e,variables:null==t?void 0:t.variables,fetchPolicy:null==t?void 0:t.fetchPolicy,errorPolicy:null==t?void 0:t.errorPolicy,context:null==t?void 0:t.context})}),u=d[0],h=d[1],g=(0,n.useRef)(!1);(0,n.useEffect)(function(){return function(){g.current=!0}},[]);var p=(0,n.useRef)({client:i,subscription:e,options:t});return(0,n.useEffect)(function(){var n,s,a,o,l=null==t?void 0:t.shouldResubscribe;"function"==typeof l&&(l=!!l(t)),(null==t?void 0:t.skip)?(!(null==t?void 0:t.skip)!=!(null==(n=p.current.options)?void 0:n.skip)||g.current)&&(c({loading:!1,data:void 0,error:void 0,variables:null==t?void 0:t.variables}),h(null),g.current=!1):(!1!==l&&(i!==p.current.client||e!==p.current.subscription||(null==t?void 0:t.fetchPolicy)!==(null==(s=p.current.options)?void 0:s.fetchPolicy)||!(null==t?void 0:t.skip)!=!(null==(a=p.current.options)?void 0:a.skip)||!(0,r.D)(null==t?void 0:t.variables,null==(o=p.current.options)?void 0:o.variables))||g.current)&&(c({loading:!0,data:void 0,error:void 0,variables:null==t?void 0:t.variables}),h(i.subscribe({query:e,variables:null==t?void 0:t.variables,fetchPolicy:null==t?void 0:t.fetchPolicy,errorPolicy:null==t?void 0:t.errorPolicy,context:null==t?void 0:t.context})),g.current=!1),Object.assign(p.current,{client:i,subscription:e,options:t})},[i,e,t,g.current]),(0,n.useEffect)(function(){if(u){var e=!1,n=u.subscribe({next:function(n){if(!e){var r,s,a={loading:!1,data:n.data,error:void 0,variables:null==t?void 0:t.variables};c(a),null==(s=null==(r=p.current.options)?void 0:r.onSubscriptionData)||s.call(r,{client:i,subscriptionData:a})}},error:function(i){e||c({loading:!1,data:void 0,error:i,variables:null==t?void 0:t.variables})},complete:function(){var t,i;e||null==(i=null==(t=p.current.options)?void 0:t.onSubscriptionComplete)||i.call(t)}});return function(){e=!0,setTimeout(function(){n.unsubscribe()})}}},[u]),l}},437703:function(e,t,i){"use strict";i.d(t,{$:()=>c});var n,r=i(773971),s=i(632735),a=i(588196),o=!1,l="useSyncExternalStore",c=(n||(n=i.t(s,2)))[l]||function(e,t,i){var n=t();__DEV__&&!o&&n!==t()&&(o=!0,__DEV__&&r.kG.error("The result of getSnapshot should be cached to avoid an infinite loop"));var l=s.useState({inst:{value:n,getSnapshot:t}}),c=l[0].inst,u=l[1];return a.JC?s.useLayoutEffect(function(){Object.assign(c,{value:n,getSnapshot:t}),d(c)&&u({inst:c})},[e,n,t]):Object.assign(c,{value:n,getSnapshot:t}),s.useEffect(function(){return d(c)&&u({inst:c}),e(function(){d(c)&&u({inst:c})})},[e]),n};function d(e){var t=e.value,i=e.getSnapshot;try{return t!==i()}catch(e){return!0}}},414222:function(e,t,i){"use strict";i.d(t,{E2:()=>o,Vp:()=>l,n_:()=>n});var n,r=i(773971);!function(e){e[e.Query=0]="Query",e[e.Mutation=1]="Mutation",e[e.Subscription=2]="Subscription"}(n||(n={}));var s=new Map;function a(e){var t;switch(e){case n.Query:t="Query";break;case n.Mutation:t="Mutation";break;case n.Subscription:t="Subscription"}return t}function o(e){var t,i,a,o=s.get(e);if(o)return o;__DEV__?(0,r.kG)(!!e&&!!e.kind,"Argument of ".concat(e," passed to parser was not a valid GraphQL ")+"DocumentNode. You may need to use 'graphql-tag' or another method to convert your operation into a document"):(0,r.kG)(!!e&&!!e.kind,31);for(var l=[],c=[],d=[],u=[],h=0,g=e.definitions;h<g.length;h++){var p=g[h];if("FragmentDefinition"===p.kind){l.push(p);continue}if("OperationDefinition"===p.kind)switch(p.operation){case"query":c.push(p);break;case"mutation":d.push(p);break;case"subscription":u.push(p)}}__DEV__?(0,r.kG)(!l.length||c.length||d.length||u.length,"Passing only a fragment to 'graphql' is not yet supported. You must include a query, subscription or mutation as well"):(0,r.kG)(!l.length||c.length||d.length||u.length,32),__DEV__?(0,r.kG)(c.length+d.length+u.length<=1,"react-apollo only supports a query, subscription, or a mutation per HOC. "+"".concat(e," had ").concat(c.length," queries, ").concat(u.length," ")+"subscriptions and ".concat(d.length," mutations. ")+"You can use 'compose' to join multiple operation types to a component"):(0,r.kG)(c.length+d.length+u.length<=1,33),i=c.length?n.Query:n.Mutation,c.length||d.length||(i=n.Subscription);var f=c.length?c:d.length?d:u;__DEV__?(0,r.kG)(1===f.length,"react-apollo only supports one definition per HOC. ".concat(e," had ")+"".concat(f.length," definitions. ")+"You can use 'compose' to join multiple operation types to a component"):(0,r.kG)(1===f.length,34);var m=f[0];t=m.variableDefinitions||[];var v={name:a=m.name&&"Name"===m.name.kind?m.name.value:"data",type:i,variables:t};return s.set(e,v),v}function l(e,t){var i=o(e),n=a(t),s=a(i.type);__DEV__?(0,r.kG)(i.type===t,"Running a ".concat(n," requires a graphql ")+"".concat(n,", but a ").concat(s," was used instead.")):(0,r.kG)(i.type===t,35)}},926929:function(e,t,i){"use strict";i.d(t,{O:()=>r,k:()=>n});var n=Array.isArray;function r(e){return Array.isArray(e)&&e.length>0}},588196:function(e,t,i){"use strict";i.d(t,{JC:()=>c,aS:()=>a,mr:()=>r,sy:()=>s});var n=i(773971),r="function"==typeof WeakMap&&"ReactNative"!==(0,n.wY)(function(){return navigator.product}),s="function"==typeof WeakSet,a="function"==typeof Symbol&&"function"==typeof Symbol.for,o="function"==typeof(0,n.wY)(function(){return window.document.createElement}),l=(0,n.wY)(function(){return navigator.userAgent.indexOf("jsdom")>=0})||!1,c=o&&!l},631903:function(e,t,i){"use strict";function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Object.create(null);return e.forEach(function(e){e&&Object.keys(e).forEach(function(t){var n=e[t];void 0!==n&&(i[t]=n)})}),i}i.d(t,{o:()=>n})},268648:function(e,t,i){"use strict";i.d(t,{J:()=>a}),i(773971);var n=i(259124);function r(e){var t=new Set([e]);return t.forEach(function(e){(0,n.s)(e)&&s(e)===e&&Object.getOwnPropertyNames(e).forEach(function(i){(0,n.s)(e[i])&&t.add(e[i])})}),e}function s(e){if(__DEV__&&!Object.isFrozen(e))try{Object.freeze(e)}catch(e){if(e instanceof TypeError)return null;throw e}return e}function a(e){return __DEV__&&r(e),e}},172321:function(e,t,i){"use strict";i.d(t,{Ee:()=>a,bw:()=>o,w0:()=>c});var n=i(231191),r=i(259124),s=Object.prototype.hasOwnProperty;function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o(e)}function o(e){var t=e[0]||{},i=e.length;if(i>1)for(var n=new c,r=1;r<i;++r)t=n.merge(t,e[r]);return t}var l=function(e,t,i){return this.merge(e[i],t[i])},c=function(){function e(e){void 0===e&&(e=l),this.reconciler=e,this.isObject=r.s,this.pastCopies=new Set}return e.prototype.merge=function(e,t){for(var i=this,a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];return(0,r.s)(t)&&(0,r.s)(e)?(Object.keys(t).forEach(function(r){if(s.call(e,r)){var o=e[r];if(t[r]!==o){var l=i.reconciler.apply(i,(0,n.__spreadArray)([e,t,r],a,!1));l!==o&&((e=i.shallowCopyForMerge(e))[r]=l)}}else(e=i.shallowCopyForMerge(e))[r]=t[r]}),e):t},e.prototype.shallowCopyForMerge=function(e){return(0,r.s)(e)&&!this.pastCopies.has(e)&&(e=Array.isArray(e)?e.slice(0):(0,n.__assign)({__proto__:Object.getPrototypeOf(e)},e),this.pastCopies.add(e)),e},e}()},207796:function(e,t,i){"use strict";i.d(t,{J:()=>s});var n=i(231191),r=i(631903);function s(e,t){return(0,r.o)(e,t,t.variables&&{variables:(0,n.__assign)((0,n.__assign)({},e&&e.variables),t.variables)})}},259124:function(e,t,i){"use strict";function n(e){return null!==e&&"object"==typeof e}i.d(t,{s:()=>n})},773971:function(e,t,i){"use strict";i.d(t,{ej:()=>n.ej,kG:()=>n.kG,wY:()=>a.w});var n=i(967066),r=i(93723),s=i(460841),a=i(575657);function o(){__DEV__?(0,n.kG)("boolean"==typeof r.Z,r.Z):(0,n.kG)("boolean"==typeof r.Z,37)}i(215681),(0,s.Y)(),o()},364291:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n},e.exports.__esModule=!0,e.exports.default=e.exports},794325:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},160123:function(e,t,i){var n=i(364291);e.exports=function(e){if(Array.isArray(e))return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports},479382:function(e){e.exports=function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},404988:function(e){e.exports=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},719590:function(e){function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},920566:function(e){e.exports=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},e.exports.__esModule=!0,e.exports.default=e.exports},385851:function(e,t,i){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i.d(t,{Z:()=>n})},387143:function(e,t,i){"use strict";i.d(t,{Z:()=>r});var n=i(655789);function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,n.Z)(e,t)}},648518:function(e,t,i){"use strict";function n(e,t){if(null==e)return{};var i,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}i.d(t,{Z:()=>n})},416950:function(e){function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(this,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},180852:function(e){function t(i){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},804546:function(e,t,i){var n=i(240990);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},836506:function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},591682:function(e){e.exports=function(e,t){var i,n,r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s=[],a=!0,o=!1;try{for(r=r.call(e);!(a=(i=r.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(e){o=!0,n=e}finally{try{a||null==r.return||r.return()}finally{if(o)throw n}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},41420:function(e){e.exports=function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},67331:function(e){e.exports=function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},40444:function(e){e.exports=function(e){if(null==e)throw TypeError("Cannot destructure undefined")},e.exports.__esModule=!0,e.exports.default=e.exports},505474:function(e,t,i){var n=i(598387);e.exports=function(e,t){if(null==e)return{};var i,r,s=n(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)i=a[r],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s},e.exports.__esModule=!0,e.exports.default=e.exports},598387:function(e){e.exports=function(e,t){if(null==e)return{};var i,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(r[i]=e[i]);return r},e.exports.__esModule=!0,e.exports.default=e.exports},21581:function(e,t,i){var n=i(687002).default,r=i(479382);e.exports=function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},240990:function(e){function t(i,n){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(i,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},943408:function(e,t,i){var n=i(794325),r=i(591682),s=i(852510),a=i(41420);e.exports=function(e,t){return n(e)||r(e,t)||s(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},559571:function(e,t,i){var n=i(160123),r=i(836506),s=i(852510),a=i(67331);e.exports=function(e){return n(e)||r(e)||s(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},687002:function(e){function t(i){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},852510:function(e,t,i){var n=i(364291);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if("Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}},e.exports.__esModule=!0,e.exports.default=e.exports},505513:function(e,t,i){"use strict";let n;i.d(t,{ey:()=>$,o7:()=>M,Zj:()=>tf,Dy:()=>A,VK:()=>J,LB:()=>to,y9:()=>tP,VT:()=>R,g4:()=>o,pE:()=>U,_8:()=>L,hI:()=>X,O1:()=>tu,LO:()=>eM,MA:()=>eR,Cj:()=>th,Lg:()=>eb,IJ:()=>T});var r,s,a,o,l,c,d,u,h,g,p=i(632735),f=i(312788),m=i(400759);let v={display:"none"};function S(e){let{id:t,value:i}=e;return p.createElement("div",{id:t,style:v},i)}function y(e){let{id:t,announcement:i,ariaLiveType:n="assertive"}=e,r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return p.createElement("div",{id:t,style:r,role:"status","aria-live":n,"aria-atomic":!0},i)}function C(){let[e,t]=(0,p.useState)("");return{announce:(0,p.useCallback)(e=>{null!=e&&t(e)},[]),announcement:e}}let b=(0,p.createContext)(null);function T(e){let t=(0,p.useContext)(b);(0,p.useEffect)(()=>{if(!t)throw Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function E(){let[e]=(0,p.useState)(()=>new Set),t=(0,p.useCallback)(t=>(e.add(t),()=>e.delete(t)),[e]);return[(0,p.useCallback)(t=>{let{type:i,event:n}=t;e.forEach(e=>{var t;return null==(t=e[i])?void 0:t.call(e,n)})},[e]),t]}let _={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},I={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:i}=e;return i?"Draggable item "+t.id+" was moved over droppable area "+i.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:i}=e;return i?"Draggable item "+t.id+" was dropped over droppable area "+i.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function w(e){let{announcements:t=I,container:i,hiddenTextDescribedById:n,screenReaderInstructions:r=_}=e,{announce:s,announcement:a}=C(),o=(0,m.Ld)("DndLiveRegion"),[l,c]=(0,p.useState)(!1);if((0,p.useEffect)(()=>{c(!0)},[]),T((0,p.useMemo)(()=>({onDragStart(e){let{active:i}=e;s(t.onDragStart({active:i}))},onDragMove(e){let{active:i,over:n}=e;t.onDragMove&&s(t.onDragMove({active:i,over:n}))},onDragOver(e){let{active:i,over:n}=e;s(t.onDragOver({active:i,over:n}))},onDragEnd(e){let{active:i,over:n}=e;s(t.onDragEnd({active:i,over:n}))},onDragCancel(e){let{active:i,over:n}=e;s(t.onDragCancel({active:i,over:n}))}}),[s,t])),!l)return null;let d=p.createElement(p.Fragment,null,p.createElement(S,{id:n,value:r.draggable}),p.createElement(y,{id:o,announcement:a}));return i?(0,f.createPortal)(d,i):d}function P(){}function R(e,t){return(0,p.useMemo)(()=>({sensor:e,options:null!=t?t:{}}),[e,t])}function A(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,p.useMemo)(()=>[...t].filter(e=>null!=e),[...t])}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(r||(r={}));let M=Object.freeze({x:0,y:0});function D(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function O(e,t){let i=(0,m.DC)(e);if(!i)return"0 0";let n={x:(i.x-t.left)/t.width*100,y:(i.y-t.top)/t.height*100};return n.x+"% "+n.y+"%"}function k(e,t){let{data:{value:i}}=e,{data:{value:n}}=t;return i-n}function N(e,t){let{data:{value:i}}=e,{data:{value:n}}=t;return n-i}function x(e){let{left:t,top:i,height:n,width:r}=e;return[{x:t,y:i},{x:t+r,y:i},{x:t,y:i+n},{x:t+r,y:i+n}]}function L(e,t){if(!e||0===e.length)return null;let[i]=e;return t?i[t]:i}function F(e,t,i){return void 0===t&&(t=e.left),void 0===i&&(i=e.top),{x:t+.5*e.width,y:i+.5*e.height}}let U=e=>{let{collisionRect:t,droppableRects:i,droppableContainers:n}=e,r=F(t,t.left,t.top),s=[];for(let e of n){let{id:t}=e,n=i.get(t);if(n){let i=D(F(n),r);s.push({id:t,data:{droppableContainer:e,value:i}})}}return s.sort(k)},$=e=>{let{collisionRect:t,droppableRects:i,droppableContainers:n}=e,r=x(t),s=[];for(let e of n){let{id:t}=e,n=i.get(t);if(n){let i=x(n),a=Number((r.reduce((e,t,n)=>e+D(i[n],t),0)/4).toFixed(4));s.push({id:t,data:{droppableContainer:e,value:a}})}}return s.sort(k)};function V(e,t){let i=Math.max(t.top,e.top),n=Math.max(t.left,e.left),r=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),a=r-n,o=s-i;if(n<r&&i<s){let i=t.width*t.height,n=e.width*e.height,r=a*o;return Number((r/(i+n-r)).toFixed(4))}return 0}let B=e=>{let{collisionRect:t,droppableRects:i,droppableContainers:n}=e,r=[];for(let e of n){let{id:n}=e,s=i.get(n);if(s){let i=V(s,t);i>0&&r.push({id:n,data:{droppableContainer:e,value:i}})}}return r.sort(N)};function H(e,t,i){return{...e,scaleX:t&&i?t.width/i.width:1,scaleY:t&&i?t.height/i.height:1}}function j(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:M}let q=function(e){return function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return n.reduce((t,i)=>({...t,top:t.top+e*i.y,bottom:t.bottom+e*i.y,left:t.left+e*i.x,right:t.right+e*i.x}),{...t})}}(1);function W(e){if(e.startsWith("matrix3d(")){let t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){let t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function G(e,t,i){let n=W(t);if(!n)return e;let{scaleX:r,scaleY:s,x:a,y:o}=n,l=e.left-a-(1-r)*parseFloat(i),c=e.top-o-(1-s)*parseFloat(i.slice(i.indexOf(" ")+1)),d=r?e.width/r:e.width,u=s?e.height/s:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}let z={ignoreTransform:!1};function J(e,t){void 0===t&&(t=z);let i=e.getBoundingClientRect();if(t.ignoreTransform){let{transform:t,transformOrigin:n}=(0,m.Jj)(e).getComputedStyle(e);t&&(i=G(i,t,n))}let{top:n,left:r,width:s,height:a,bottom:o,right:l}=i;return{top:n,left:r,width:s,height:a,bottom:o,right:l}}function K(e){return J(e,{ignoreTransform:!0})}function Q(e){let t=e.innerWidth,i=e.innerHeight;return{top:0,left:0,right:t,bottom:i,width:t,height:i}}function Y(e,t){return void 0===t&&(t=(0,m.Jj)(e).getComputedStyle(e)),"fixed"===t.position}function Z(e,t){void 0===t&&(t=(0,m.Jj)(e).getComputedStyle(e));let i=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{let n=t[e];return"string"==typeof n&&i.test(n)})}function X(e,t){let i=[];function n(r){if(null!=t&&i.length>=t||!r)return i;if((0,m.qk)(r)&&null!=r.scrollingElement&&!i.includes(r.scrollingElement))return i.push(r.scrollingElement),i;if(!(0,m.Re)(r)||(0,m.vZ)(r)||i.includes(r))return i;let s=(0,m.Jj)(e).getComputedStyle(r);return(r!==e&&Z(r,s)&&i.push(r),Y(r,s))?i:n(r.parentNode)}return e?n(e):i}function ee(e){let[t]=X(e,1);return null!=t?t:null}function et(e){return m.Nq&&e?(0,m.FJ)(e)?e:(0,m.UG)(e)?(0,m.qk)(e)||e===(0,m.r3)(e).scrollingElement?window:(0,m.Re)(e)?e:null:null:null}function ei(e){return(0,m.FJ)(e)?e.scrollX:e.scrollLeft}function en(e){return(0,m.FJ)(e)?e.scrollY:e.scrollTop}function er(e){return{x:ei(e),y:en(e)}}function es(e){return!!m.Nq&&!!e&&e===document.scrollingElement}function ea(e){let t={x:0,y:0},i=es(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},n={x:e.scrollWidth-i.width,y:e.scrollHeight-i.height},r=e.scrollTop<=t.y,s=e.scrollLeft<=t.x;return{isTop:r,isLeft:s,isBottom:e.scrollTop>=n.y,isRight:e.scrollLeft>=n.x,maxScroll:n,minScroll:t}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(s||(s={}));let eo={x:.2,y:.2};function el(e,t,i,n,r){let{top:a,left:o,right:l,bottom:c}=i;void 0===n&&(n=10),void 0===r&&(r=eo);let{isTop:d,isBottom:u,isLeft:h,isRight:g}=ea(e),p={x:0,y:0},f={x:0,y:0},m={height:t.height*r.y,width:t.width*r.x};return!d&&a<=t.top+m.height?(p.y=s.Backward,f.y=n*Math.abs((t.top+m.height-a)/m.height)):!u&&c>=t.bottom-m.height&&(p.y=s.Forward,f.y=n*Math.abs((t.bottom-m.height-c)/m.height)),!g&&l>=t.right-m.width?(p.x=s.Forward,f.x=n*Math.abs((t.right-m.width-l)/m.width)):!h&&o<=t.left+m.width&&(p.x=s.Backward,f.x=n*Math.abs((t.left+m.width-o)/m.width)),{direction:p,speed:f}}function ec(e){if(e===document.scrollingElement){let{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}let{top:t,left:i,right:n,bottom:r}=e.getBoundingClientRect();return{top:t,left:i,right:n,bottom:r,width:e.clientWidth,height:e.clientHeight}}function ed(e){return e.reduce((e,t)=>(0,m.IH)(e,er(t)),M)}function eu(e,t){if(void 0===t&&(t=J),!e)return;let{top:i,left:n,bottom:r,right:s}=t(e);ee(e)&&(r<=0||s<=0||i>=window.innerHeight||n>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}let eh=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+ei(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+en(t),0)}]];class eg{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;let i=X(t),n=ed(i);for(let[t,r,s]of(this.rect={...e},this.width=e.width,this.height=e.height,eh))for(let e of r)Object.defineProperty(this,e,{get:()=>{let r=s(i),a=n[t]-r;return this.rect[e]+a},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ep{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,i){var n;null==(n=this.target)||n.addEventListener(e,t,i),this.listeners.push([e,t,i])}}function ef(e){let{EventTarget:t}=(0,m.Jj)(e);return e instanceof t?e:(0,m.r3)(e)}function em(e,t){let i=Math.abs(e.x),n=Math.abs(e.y);return"number"==typeof t?Math.sqrt(i**2+n**2)>t:"x"in t&&"y"in t?i>t.x&&n>t.y:"x"in t?i>t.x:"y"in t&&n>t.y}function ev(e){e.preventDefault()}function eS(e){e.stopPropagation()}!function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"}(a||(a={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(o||(o={}));let ey={start:[o.Space,o.Enter],cancel:[o.Esc],end:[o.Space,o.Enter,o.Tab]},eC=(e,t)=>{let{currentCoordinates:i}=t;switch(e.code){case o.Right:return{...i,x:i.x+25};case o.Left:return{...i,x:i.x-25};case o.Down:return{...i,y:i.y+25};case o.Up:return{...i,y:i.y-25}}};class eb{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;let{event:{target:t}}=e;this.props=e,this.listeners=new ep((0,m.r3)(t)),this.windowListeners=new ep((0,m.Jj)(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(a.Resize,this.handleCancel),this.windowListeners.add(a.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(a.Keydown,this.handleKeyDown))}handleStart(){let{activeNode:e,onStart:t}=this.props,i=e.node.current;i&&eu(i),t(M)}handleKeyDown(e){if((0,m.vd)(e)){let{active:t,context:i,options:n}=this.props,{keyboardCodes:r=ey,coordinateGetter:s=eC,scrollBehavior:a="smooth"}=n,{code:l}=e;if(r.end.includes(l))return void this.handleEnd(e);if(r.cancel.includes(l))return void this.handleCancel(e);let{collisionRect:c}=i.current,d=c?{x:c.left,y:c.top}:M;this.referenceCoordinates||(this.referenceCoordinates=d);let u=s(e,{active:t,context:i.current,currentCoordinates:d});if(u){let t=(0,m.$X)(u,d),n={x:0,y:0},{scrollableAncestors:r}=i.current;for(let i of r){let r=e.code,{isTop:s,isRight:l,isLeft:c,isBottom:d,maxScroll:h,minScroll:g}=ea(i),p=ec(i),f={x:Math.min(r===o.Right?p.right-p.width/2:p.right,Math.max(r===o.Right?p.left:p.left+p.width/2,u.x)),y:Math.min(r===o.Down?p.bottom-p.height/2:p.bottom,Math.max(r===o.Down?p.top:p.top+p.height/2,u.y))},m=r===o.Right&&!l||r===o.Left&&!c,v=r===o.Down&&!d||r===o.Up&&!s;if(m&&f.x!==u.x){let e=i.scrollLeft+t.x,s=r===o.Right&&e<=h.x||r===o.Left&&e>=g.x;if(s&&!t.y)return void i.scrollTo({left:e,behavior:a});s?n.x=i.scrollLeft-e:n.x=r===o.Right?i.scrollLeft-h.x:i.scrollLeft-g.x,n.x&&i.scrollBy({left:-n.x,behavior:a});break}if(v&&f.y!==u.y){let e=i.scrollTop+t.y,s=r===o.Down&&e<=h.y||r===o.Up&&e>=g.y;if(s&&!t.x)return void i.scrollTo({top:e,behavior:a});s?n.y=i.scrollTop-e:n.y=r===o.Down?i.scrollTop-h.y:i.scrollTop-g.y,n.y&&i.scrollBy({top:-n.y,behavior:a});break}}this.handleMove(e,(0,m.IH)((0,m.$X)(u,this.referenceCoordinates),n))}}}handleMove(e,t){let{onMove:i}=this.props;e.preventDefault(),i(t)}handleEnd(e){let{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){let{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function eT(e){return!!(e&&"distance"in e)}function eE(e){return!!(e&&"delay"in e)}eb.activators=[{eventName:"onKeyDown",handler:(e,t,i)=>{let{keyboardCodes:n=ey,onActivation:r}=t,{active:s}=i,{code:a}=e.nativeEvent;if(n.start.includes(a)){let t=s.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==r||r({event:e.nativeEvent}),!0)}return!1}}];class e_{constructor(e,t,i){var n;void 0===i&&(i=ef(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;let{event:r}=e,{target:s}=r;this.props=e,this.events=t,this.document=(0,m.r3)(s),this.documentListeners=new ep(this.document),this.listeners=new ep(i),this.windowListeners=new ep((0,m.Jj)(s)),this.initialCoordinates=null!=(n=(0,m.DC)(r))?n:M,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){let{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:i}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(a.Resize,this.handleCancel),this.windowListeners.add(a.DragStart,ev),this.windowListeners.add(a.VisibilityChange,this.handleCancel),this.windowListeners.add(a.ContextMenu,ev),this.documentListeners.add(a.Keydown,this.handleKeydown),t){if(null!=i&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(eE(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(eT(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){let{active:i,onPending:n}=this.props;n(i,e,this.initialCoordinates,t)}handleStart(){let{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(a.Click,eS,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(a.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;let{activated:i,initialCoordinates:n,props:r}=this,{onMove:s,options:{activationConstraint:a}}=r;if(!n)return;let o=null!=(t=(0,m.DC)(e))?t:M,l=(0,m.$X)(n,o);if(!i&&a){if(eT(a)){if(null!=a.tolerance&&em(l,a.tolerance))return this.handleCancel();if(em(l,a.distance))return this.handleStart()}return eE(a)&&em(l,a.tolerance)?this.handleCancel():void this.handlePending(a,l)}e.cancelable&&e.preventDefault(),s(o)}handleEnd(){let{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){let{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===o.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}let eI={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class ew extends e_{constructor(e){let{event:t}=e;super(e,eI,(0,m.r3)(t.target))}}ew.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:i}=e,{onActivation:n}=t;return!!i.isPrimary&&0===i.button&&(null==n||n({event:i}),!0)}}];let eP={move:{name:"mousemove"},end:{name:"mouseup"}};!function(e){e[e.RightClick=2]="RightClick"}(l||(l={}));class eR extends e_{constructor(e){super(e,eP,(0,m.r3)(e.event.target))}}eR.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:i}=e,{onActivation:n}=t;return i.button!==l.RightClick&&(null==n||n({event:i}),!0)}}];let eA={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class eM extends e_{constructor(e){super(e,eA)}static setup(){return window.addEventListener(eA.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(eA.move.name,e)};function e(){}}}function eD(e){let{acceleration:t,activator:i=c.Pointer,canScroll:n,draggingRect:r,enabled:s,interval:a=5,order:o=d.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:h,delta:g,threshold:f}=e,v=ek({delta:g,disabled:!s}),[S,y]=(0,m.Yz)(),C=(0,p.useRef)({x:0,y:0}),b=(0,p.useRef)({x:0,y:0}),T=(0,p.useMemo)(()=>{switch(i){case c.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case c.DraggableRect:return r}},[i,r,l]),E=(0,p.useRef)(null),_=(0,p.useCallback)(()=>{let e=E.current;if(!e)return;let t=C.current.x*b.current.x,i=C.current.y*b.current.y;e.scrollBy(t,i)},[]),I=(0,p.useMemo)(()=>o===d.TreeOrder?[...u].reverse():u,[o,u]);(0,p.useEffect)(()=>{if(!s||!u.length||!T)return void y();for(let e of I){if((null==n?void 0:n(e))===!1)continue;let i=h[u.indexOf(e)];if(!i)continue;let{direction:r,speed:s}=el(e,i,T,t,f);for(let e of["x","y"])v[e][r[e]]||(s[e]=0,r[e]=0);if(s.x>0||s.y>0){y(),E.current=e,S(_,a),C.current=s,b.current=r;return}}C.current={x:0,y:0},b.current={x:0,y:0},y()},[t,_,n,y,s,a,JSON.stringify(T),JSON.stringify(v),S,u,I,h,JSON.stringify(f)])}eM.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:i}=e,{onActivation:n}=t,{touches:r}=i;return!(r.length>1)&&(null==n||n({event:i}),!0)}}],function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(c||(c={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(d||(d={}));let eO={x:{[s.Backward]:!1,[s.Forward]:!1},y:{[s.Backward]:!1,[s.Forward]:!1}};function ek(e){let{delta:t,disabled:i}=e,n=(0,m.D9)(t);return(0,m.Gj)(e=>{if(i||!n||!e)return eO;let r={x:Math.sign(t.x-n.x),y:Math.sign(t.y-n.y)};return{x:{[s.Backward]:e.x[s.Backward]||-1===r.x,[s.Forward]:e.x[s.Forward]||1===r.x},y:{[s.Backward]:e.y[s.Backward]||-1===r.y,[s.Forward]:e.y[s.Forward]||1===r.y}}},[i,t,n])}function eN(e,t){let i=null!=t?e.get(t):void 0,n=i?i.node.current:null;return(0,m.Gj)(e=>{var i;return null==t?null:null!=(i=null!=n?n:e)?i:null},[n,t])}function ex(e,t){return(0,p.useMemo)(()=>e.reduce((e,i)=>{let{sensor:n}=i;return[...e,...n.activators.map(e=>({eventName:e.eventName,handler:t(e.handler,i)}))]},[]),[e,t])}!function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"}(u||(u={})),function(e){e.Optimized="optimized"}(h||(h={}));let eL=new Map;function eF(e,t){let{dragging:i,dependencies:n,config:r}=t,[s,a]=(0,p.useState)(null),{frequency:o,measure:l,strategy:c}=r,d=(0,p.useRef)(e),h=y(),g=(0,m.Ey)(h),f=(0,p.useCallback)(function(e){void 0===e&&(e=[]),g.current||a(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[g]),v=(0,p.useRef)(null),S=(0,m.Gj)(t=>{if(h&&!i)return eL;if(!t||t===eL||d.current!==e||null!=s){let t=new Map;for(let i of e){if(!i)continue;if(s&&s.length>0&&!s.includes(i.id)&&i.rect.current){t.set(i.id,i.rect.current);continue}let e=i.node.current,n=e?new eg(l(e),e):null;i.rect.current=n,n&&t.set(i.id,n)}return t}return t},[e,s,i,h,l]);return(0,p.useEffect)(()=>{d.current=e},[e]),(0,p.useEffect)(()=>{h||f()},[i,h]),(0,p.useEffect)(()=>{s&&s.length>0&&a(null)},[JSON.stringify(s)]),(0,p.useEffect)(()=>{h||"number"!=typeof o||null!==v.current||(v.current=setTimeout(()=>{f(),v.current=null},o))},[o,h,f,...n]),{droppableRects:S,measureDroppableContainers:f,measuringScheduled:null!=s};function y(){switch(c){case u.Always:return!1;case u.BeforeDragging:return i;default:return!i}}}function eU(e,t){return(0,m.Gj)(i=>e?i||("function"==typeof t?t(e):e):null,[t,e])}function e$(e,t){return eU(e,t)}function eV(e){let{callback:t,disabled:i}=e,n=(0,m.zX)(t),r=(0,p.useMemo)(()=>{if(i||"undefined"==typeof window||void 0===window.MutationObserver)return;let{MutationObserver:e}=window;return new e(n)},[n,i]);return(0,p.useEffect)(()=>()=>null==r?void 0:r.disconnect(),[r]),r}function eB(e){let{callback:t,disabled:i}=e,n=(0,m.zX)(t),r=(0,p.useMemo)(()=>{if(i||"undefined"==typeof window||void 0===window.ResizeObserver)return;let{ResizeObserver:e}=window;return new e(n)},[i]);return(0,p.useEffect)(()=>()=>null==r?void 0:r.disconnect(),[r]),r}function eH(e){return new eg(J(e),e)}function ej(e,t,i){void 0===t&&(t=eH);let[n,r]=(0,p.useState)(null);function s(){r(n=>{if(!e)return null;if(!1===e.isConnected){var r;return null!=(r=null!=n?n:i)?r:null}let s=t(e);return JSON.stringify(n)===JSON.stringify(s)?n:s})}let a=eV({callback(t){if(e)for(let i of t){let{type:t,target:n}=i;if("childList"===t&&n instanceof HTMLElement&&n.contains(e)){s();break}}}}),o=eB({callback:s});return(0,m.LI)(()=>{s(),e?(null==o||o.observe(e),null==a||a.observe(document.body,{childList:!0,subtree:!0})):(null==o||o.disconnect(),null==a||a.disconnect())},[e]),n}function eq(e){let t=eU(e);return j(e,t)}let eW=[];function eG(e){let t=(0,p.useRef)(e),i=(0,m.Gj)(i=>e?i&&i!==eW&&e&&t.current&&e.parentNode===t.current.parentNode?i:X(e):eW,[e]);return(0,p.useEffect)(()=>{t.current=e},[e]),i}function ez(e){let[t,i]=(0,p.useState)(null),n=(0,p.useRef)(e),r=(0,p.useCallback)(e=>{let t=et(e.target);t&&i(e=>e?(e.set(t,er(t)),new Map(e)):null)},[]);return(0,p.useEffect)(()=>{let t=n.current;if(e!==t){s(t);let a=e.map(e=>{let t=et(e);return t?(t.addEventListener("scroll",r,{passive:!0}),[t,er(t)]):null}).filter(e=>null!=e);i(a.length?new Map(a):null),n.current=e}return()=>{s(e),s(t)};function s(e){e.forEach(e=>{let t=et(e);null==t||t.removeEventListener("scroll",r)})}},[r,e]),(0,p.useMemo)(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>(0,m.IH)(e,t),M):ed(e):M,[e,t])}function eJ(e,t){void 0===t&&(t=[]);let i=(0,p.useRef)(null);return(0,p.useEffect)(()=>{i.current=null},t),(0,p.useEffect)(()=>{let t=e!==M;t&&!i.current&&(i.current=e),!t&&i.current&&(i.current=null)},[e]),i.current?(0,m.$X)(e,i.current):M}function eK(e){(0,p.useEffect)(()=>{if(!m.Nq)return;let t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(let e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}function eQ(e,t){return(0,p.useMemo)(()=>e.reduce((e,i)=>{let{eventName:n,handler:r}=i;return e[n]=e=>{r(e,t)},e},{}),[e,t])}function eY(e){return(0,p.useMemo)(()=>e?Q(e):null,[e])}let eZ=[];function eX(e,t){void 0===t&&(t=J);let[i]=e,n=eY(i?(0,m.Jj)(i):null),[r,s]=(0,p.useState)(eZ);function a(){s(()=>e.length?e.map(e=>es(e)?n:new eg(t(e),e)):eZ)}let o=eB({callback:a});return(0,m.LI)(()=>{null==o||o.disconnect(),a(),e.forEach(e=>null==o?void 0:o.observe(e))},[e]),r}function e0(e){if(!e)return null;if(e.children.length>1)return e;let t=e.children[0];return(0,m.Re)(t)?t:e}function e1(e){let{measure:t}=e,[i,n]=(0,p.useState)(null),r=eB({callback:(0,p.useCallback)(e=>{for(let{target:i}of e)if((0,m.Re)(i)){n(e=>{let n=t(i);return e?{...e,width:n.width,height:n.height}:n});break}},[t])}),s=(0,p.useCallback)(e=>{let i=e0(e);null==r||r.disconnect(),i&&(null==r||r.observe(i)),n(i?t(i):null)},[t,r]),[a,o]=(0,m.wm)(s);return(0,p.useMemo)(()=>({nodeRef:a,rect:i,setRef:o}),[i,a,o])}let e2=[{sensor:ew,options:{}},{sensor:eb,options:{}}],e3={current:{}},e4={draggable:{measure:K},droppable:{measure:K,strategy:u.WhileDragging,frequency:h.Optimized},dragOverlay:{measure:J}};class e5 extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,i;return null!=(t=null==(i=this.get(e))?void 0:i.node.current)?t:void 0}}let e6={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new e5,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:P},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:e4,measureDroppableContainers:P,windowRect:null,measuringScheduled:!1},e8={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:P,draggableNodes:new Map,over:null,measureDroppableContainers:P},e9=(0,p.createContext)(e8),e7=(0,p.createContext)(e6);function te(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new e5}}}function tt(e,t){switch(t.type){case r.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case r.DragMove:if(null==e.draggable.active)return e;return{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case r.DragEnd:case r.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case r.RegisterDroppable:{let{element:i}=t,{id:n}=i,r=new e5(e.droppable.containers);return r.set(n,i),{...e,droppable:{...e.droppable,containers:r}}}case r.SetDroppableDisabled:{let{id:i,key:n,disabled:r}=t,s=e.droppable.containers.get(i);if(!s||n!==s.key)return e;let a=new e5(e.droppable.containers);return a.set(i,{...s,disabled:r}),{...e,droppable:{...e.droppable,containers:a}}}case r.UnregisterDroppable:{let{id:i,key:n}=t,r=e.droppable.containers.get(i);if(!r||n!==r.key)return e;let s=new e5(e.droppable.containers);return s.delete(i),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function ti(e){let{disabled:t}=e,{active:i,activatorEvent:n,draggableNodes:r}=(0,p.useContext)(e9),s=(0,m.D9)(n),a=(0,m.D9)(null==i?void 0:i.id);return(0,p.useEffect)(()=>{if(!t&&!n&&s&&null!=a){if(!(0,m.vd)(s)||document.activeElement===s.target)return;let e=r.get(a);if(!e)return;let{activatorNode:t,node:i}=e;(t.current||i.current)&&requestAnimationFrame(()=>{for(let e of[t.current,i.current]){if(!e)continue;let t=(0,m.so)(e);if(t){t.focus();break}}})}},[n,t,r,a,s]),null}function tn(e,t){let{transform:i,...n}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...n}),i):i}function tr(e){return(0,p.useMemo)(()=>({draggable:{...e4.draggable,...null==e?void 0:e.draggable},droppable:{...e4.droppable,...null==e?void 0:e.droppable},dragOverlay:{...e4.dragOverlay,...null==e?void 0:e.dragOverlay}}),[null==e?void 0:e.draggable,null==e?void 0:e.droppable,null==e?void 0:e.dragOverlay])}function ts(e){let{activeNode:t,measure:i,initialRect:n,config:r=!0}=e,s=(0,p.useRef)(!1),{x:a,y:o}="boolean"==typeof r?{x:r,y:r}:r;(0,m.LI)(()=>{if(!a&&!o||!t){s.current=!1;return}if(s.current||!n)return;let e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;let r=j(i(e),n);if(a||(r.x=0),o||(r.y=0),s.current=!0,Math.abs(r.x)>0||Math.abs(r.y)>0){let t=ee(e);t&&t.scrollBy({top:r.y,left:r.x})}},[t,a,o,n,i])}let ta=(0,p.createContext)({...M,scaleX:1,scaleY:1});!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(g||(g={}));let to=(0,p.memo)(function(e){var t,i,n,s;let{id:a,accessibility:o,autoScroll:l=!0,children:c,sensors:d=e2,collisionDetection:u=B,measuring:h,modifiers:v,...S}=e,[y,C]=(0,p.useReducer)(tt,void 0,te),[T,_]=E(),[I,P]=(0,p.useState)(g.Uninitialized),R=I===g.Initialized,{draggable:{active:A,nodes:M,translate:D},droppable:{containers:O}}=y,k=null!=A?M.get(A):null,N=(0,p.useRef)({initial:null,translated:null}),x=(0,p.useMemo)(()=>{var e;return null!=A?{id:A,data:null!=(e=null==k?void 0:k.data)?e:e3,rect:N}:null},[A,k]),F=(0,p.useRef)(null),[U,$]=(0,p.useState)(null),[V,j]=(0,p.useState)(null),W=(0,m.Ey)(S,Object.values(S)),G=(0,m.Ld)("DndDescribedBy",a),z=(0,p.useMemo)(()=>O.getEnabled(),[O]),J=tr(h),{droppableRects:K,measureDroppableContainers:Q,measuringScheduled:Y}=eF(z,{dragging:R,dependencies:[D.x,D.y],config:J.droppable}),Z=eN(M,A),X=(0,p.useMemo)(()=>V?(0,m.DC)(V):null,[V]),ee=eO(),et=e$(Z,J.draggable.measure);ts({activeNode:null!=A?M.get(A):null,config:ee.layoutShiftCompensation,initialRect:et,measure:J.draggable.measure});let ei=ej(Z,J.draggable.measure,et),en=ej(Z?Z.parentElement:null),er=(0,p.useRef)({activatorEvent:null,active:null,activeNode:Z,collisionRect:null,collisions:null,droppableRects:K,draggableNodes:M,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),es=O.getNodeFor(null==(t=er.current.over)?void 0:t.id),ea=e1({measure:J.dragOverlay.measure}),eo=null!=(i=ea.nodeRef.current)?i:Z,el=R?null!=(n=ea.rect)?n:ei:null,ec=!!(ea.nodeRef.current&&ea.rect),ed=eq(ec?null:ei),eu=eY(eo?(0,m.Jj)(eo):null),eh=eG(R?null!=es?es:Z:null),eg=eX(eh),ep=tn(v,{transform:{x:D.x-ed.x,y:D.y-ed.y,scaleX:1,scaleY:1},activatorEvent:V,active:x,activeNodeRect:ei,containerNodeRect:en,draggingNodeRect:el,over:er.current.over,overlayNodeRect:ea.rect,scrollableAncestors:eh,scrollableAncestorRects:eg,windowRect:eu}),ef=X?(0,m.IH)(X,D):null,em=ez(eh),ev=eJ(em),eS=eJ(em,[ei]),ey=(0,m.IH)(ep,ev),eC=el?q(el,ep):null,eb=x&&eC?u({active:x,collisionRect:eC,droppableRects:K,droppableContainers:z,pointerCoordinates:ef}):null,eT=L(eb,"id"),[eE,e_]=(0,p.useState)(null),eI=H(ec?ep:(0,m.IH)(ep,eS),null!=(s=null==eE?void 0:eE.rect)?s:null,ei),ew=(0,p.useRef)(null),eP=(0,p.useCallback)((e,t)=>{let{sensor:i,options:n}=t;if(null==F.current)return;let s=M.get(F.current);if(!s)return;let a=e.nativeEvent,o=new i({active:F.current,activeNode:s,event:a,options:n,context:er,onAbort(e){if(!M.get(e))return;let{onDragAbort:t}=W.current,i={id:e};null==t||t(i),T({type:"onDragAbort",event:i})},onPending(e,t,i,n){if(!M.get(e))return;let{onDragPending:r}=W.current,s={id:e,constraint:t,initialCoordinates:i,offset:n};null==r||r(s),T({type:"onDragPending",event:s})},onStart(e){let t=F.current;if(null==t)return;let i=M.get(t);if(!i)return;let{onDragStart:n}=W.current,s={activatorEvent:a,active:{id:t,data:i.data,rect:N}};(0,f.unstable_batchedUpdates)(()=>{null==n||n(s),P(g.Initializing),C({type:r.DragStart,initialCoordinates:e,active:t}),T({type:"onDragStart",event:s}),$(ew.current),j(a)})},onMove(e){C({type:r.DragMove,coordinates:e})},onEnd:l(r.DragEnd),onCancel:l(r.DragCancel)});function l(e){return async function(){let{active:t,collisions:i,over:n,scrollAdjustedTranslate:s}=er.current,o=null;if(t&&s){let{cancelDrop:l}=W.current;o={activatorEvent:a,active:t,collisions:i,delta:s,over:n},e===r.DragEnd&&"function"==typeof l&&await Promise.resolve(l(o))&&(e=r.DragCancel)}F.current=null,(0,f.unstable_batchedUpdates)(()=>{C({type:e}),P(g.Uninitialized),e_(null),$(null),j(null),ew.current=null;let t=e===r.DragEnd?"onDragEnd":"onDragCancel";if(o){let e=W.current[t];null==e||e(o),T({type:t,event:o})}})}}ew.current=o},[M]),eR=ex(d,(0,p.useCallback)((e,t)=>(i,n)=>{let r=i.nativeEvent,s=M.get(n);if(null!==F.current||!s||r.dndKit||r.defaultPrevented)return;let a={active:s};!0===e(i,t.options,a)&&(r.dndKit={capturedBy:t.sensor},F.current=n,eP(i,t))},[M,eP]));eK(d),(0,m.LI)(()=>{ei&&I===g.Initializing&&P(g.Initialized)},[ei,I]),(0,p.useEffect)(()=>{let{onDragMove:e}=W.current,{active:t,activatorEvent:i,collisions:n,over:r}=er.current;if(!t||!i)return;let s={active:t,activatorEvent:i,collisions:n,delta:{x:ey.x,y:ey.y},over:r};(0,f.unstable_batchedUpdates)(()=>{null==e||e(s),T({type:"onDragMove",event:s})})},[ey.x,ey.y]),(0,p.useEffect)(()=>{let{active:e,activatorEvent:t,collisions:i,droppableContainers:n,scrollAdjustedTranslate:r}=er.current;if(!e||null==F.current||!t||!r)return;let{onDragOver:s}=W.current,a=n.get(eT),o=a&&a.rect.current?{id:a.id,rect:a.rect.current,data:a.data,disabled:a.disabled}:null,l={active:e,activatorEvent:t,collisions:i,delta:{x:r.x,y:r.y},over:o};(0,f.unstable_batchedUpdates)(()=>{e_(o),null==s||s(l),T({type:"onDragOver",event:l})})},[eT]),(0,m.LI)(()=>{er.current={activatorEvent:V,active:x,activeNode:Z,collisionRect:eC,collisions:eb,droppableRects:K,draggableNodes:M,draggingNode:eo,draggingNodeRect:el,droppableContainers:O,over:eE,scrollableAncestors:eh,scrollAdjustedTranslate:ey},N.current={initial:el,translated:eC}},[x,Z,eb,eC,M,eo,el,K,O,eE,eh,ey]),eD({...ee,delta:D,draggingRect:eC,pointerCoordinates:ef,scrollableAncestors:eh,scrollableAncestorRects:eg});let eA=(0,p.useMemo)(()=>({active:x,activeNode:Z,activeNodeRect:ei,activatorEvent:V,collisions:eb,containerNodeRect:en,dragOverlay:ea,draggableNodes:M,droppableContainers:O,droppableRects:K,over:eE,measureDroppableContainers:Q,scrollableAncestors:eh,scrollableAncestorRects:eg,measuringConfiguration:J,measuringScheduled:Y,windowRect:eu}),[x,Z,ei,V,eb,en,ea,M,O,K,eE,Q,eh,eg,J,Y,eu]),eM=(0,p.useMemo)(()=>({activatorEvent:V,activators:eR,active:x,activeNodeRect:ei,ariaDescribedById:{draggable:G},dispatch:C,draggableNodes:M,over:eE,measureDroppableContainers:Q}),[V,eR,x,ei,C,G,M,eE,Q]);return p.createElement(b.Provider,{value:_},p.createElement(e9.Provider,{value:eM},p.createElement(e7.Provider,{value:eA},p.createElement(ta.Provider,{value:eI},c)),p.createElement(ti,{disabled:(null==o?void 0:o.restoreFocus)===!1})),p.createElement(w,{...o,hiddenTextDescribedById:G}));function eO(){let e=(null==U?void 0:U.autoScrollEnabled)===!1,t="object"==typeof l?!1===l.enabled:!1===l,i=R&&!e&&!t;return"object"==typeof l?{...l,enabled:i}:{enabled:i}}}),tl=(0,p.createContext)(null),tc="button",td="Draggable";function tu(e){let{id:t,data:i,disabled:n=!1,attributes:r}=e,s=(0,m.Ld)(td),{activators:a,activatorEvent:o,active:l,activeNodeRect:c,ariaDescribedById:d,draggableNodes:u,over:h}=(0,p.useContext)(e9),{role:g=tc,roleDescription:f="draggable",tabIndex:v=0}=null!=r?r:{},S=(null==l?void 0:l.id)===t,y=(0,p.useContext)(S?ta:tl),[C,b]=(0,m.wm)(),[T,E]=(0,m.wm)(),_=eQ(a,t),I=(0,m.Ey)(i);return(0,m.LI)(()=>(u.set(t,{id:t,key:s,node:C,activatorNode:T,data:I}),()=>{let e=u.get(t);e&&e.key===s&&u.delete(t)}),[u,t]),{active:l,activatorEvent:o,activeNodeRect:c,attributes:(0,p.useMemo)(()=>({role:g,tabIndex:v,"aria-disabled":n,"aria-pressed":!!S&&g===tc||void 0,"aria-roledescription":f,"aria-describedby":d.draggable}),[n,g,v,S,f,d.draggable]),isDragging:S,listeners:n?void 0:_,node:C,over:h,setNodeRef:b,setActivatorNodeRef:E,transform:y}}function th(){return(0,p.useContext)(e7)}let tg="Droppable",tp={timeout:25};function tf(e){let{data:t,disabled:i=!1,id:n,resizeObserverConfig:s}=e,a=(0,m.Ld)(tg),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=(0,p.useContext)(e9),u=(0,p.useRef)({disabled:i}),h=(0,p.useRef)(!1),g=(0,p.useRef)(null),f=(0,p.useRef)(null),{disabled:v,updateMeasurementsFor:S,timeout:y}={...tp,...s},C=(0,m.Ey)(null!=S?S:n),b=eB({callback:(0,p.useCallback)(()=>{if(!h.current){h.current=!0;return}null!=f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{d(Array.isArray(C.current)?C.current:[C.current]),f.current=null},y)},[y]),disabled:v||!o}),T=(0,p.useCallback)((e,t)=>{b&&(t&&(b.unobserve(t),h.current=!1),e&&b.observe(e))},[b]),[E,_]=(0,m.wm)(T),I=(0,m.Ey)(t);return(0,p.useEffect)(()=>{b&&E.current&&(b.disconnect(),h.current=!1,b.observe(E.current))},[E,b]),(0,p.useEffect)(()=>(l({type:r.RegisterDroppable,element:{id:n,key:a,disabled:i,node:E,rect:g,data:I}}),()=>l({type:r.UnregisterDroppable,key:a,id:n})),[n]),(0,p.useEffect)(()=>{i!==u.current.disabled&&(l({type:r.SetDroppableDisabled,id:n,key:a,disabled:i}),u.current.disabled=i)},[n,a,i,l]),{active:o,rect:g,isOver:(null==c?void 0:c.id)===n,node:E,over:c,setNodeRef:_}}function tm(e){let{animation:t,children:i}=e,[n,r]=(0,p.useState)(null),[s,a]=(0,p.useState)(null),o=(0,m.D9)(i);return i||n||!o||r(o),(0,m.LI)(()=>{if(!s)return;let e=null==n?void 0:n.key,i=null==n?void 0:n.props.id;if(null==e||null==i)return void r(null);Promise.resolve(t(i,s)).then(()=>{r(null)})},[t,n,s]),p.createElement(p.Fragment,null,i,n?(0,p.cloneElement)(n,{ref:a}):null)}let tv={x:0,y:0,scaleX:1,scaleY:1};function tS(e){let{children:t}=e;return p.createElement(e9.Provider,{value:e8},p.createElement(ta.Provider,{value:tv},t))}let ty={position:"fixed",touchAction:"none"},tC=e=>(0,m.vd)(e)?"transform 250ms ease":void 0,tb=(0,p.forwardRef)((e,t)=>{let{as:i,activatorEvent:n,adjustScale:r,children:s,className:a,rect:o,style:l,transform:c,transition:d=tC}=e;if(!o)return null;let u=r?c:{...c,scaleX:1,scaleY:1},h={...ty,width:o.width,height:o.height,top:o.top,left:o.left,transform:m.ux.Transform.toString(u),transformOrigin:r&&n?O(n,o):void 0,transition:"function"==typeof d?d(n):d,...l};return p.createElement(i,{className:a,style:h,ref:t},s)}),tT={duration:250,easing:"ease",keyframes:e=>{let{transform:{initial:t,final:i}}=e;return[{transform:m.ux.Transform.toString(t)},{transform:m.ux.Transform.toString(i)}]},sideEffects:(n={styles:{active:{opacity:"0"}}},e=>{let{active:t,dragOverlay:i}=e,r={},{styles:s,className:a}=n;if(null!=s&&s.active)for(let[e,i]of Object.entries(s.active))void 0!==i&&(r[e]=t.node.style.getPropertyValue(e),t.node.style.setProperty(e,i));if(null!=s&&s.dragOverlay)for(let[e,t]of Object.entries(s.dragOverlay))void 0!==t&&i.node.style.setProperty(e,t);return null!=a&&a.active&&t.node.classList.add(a.active),null!=a&&a.dragOverlay&&i.node.classList.add(a.dragOverlay),function(){for(let[e,i]of Object.entries(r))t.node.style.setProperty(e,i);null!=a&&a.active&&t.node.classList.remove(a.active)}})};function tE(e){let{config:t,draggableNodes:i,droppableContainers:n,measuringConfiguration:r}=e;return(0,m.zX)((e,s)=>{if(null===t)return;let a=i.get(e);if(!a)return;let o=a.node.current;if(!o)return;let l=e0(s);if(!l)return;let{transform:c}=(0,m.Jj)(s).getComputedStyle(s),d=W(c);if(!d)return;let u="function"==typeof t?t:t_(t);return eu(o,r.draggable.measure),u({active:{id:e,data:a.data,node:o,rect:r.draggable.measure(o)},draggableNodes:i,dragOverlay:{node:s,rect:r.dragOverlay.measure(l)},droppableContainers:n,measuringConfiguration:r,transform:d})})}function t_(e){let{duration:t,easing:i,sideEffects:n,keyframes:r}={...tT,...e};return e=>{let{active:s,dragOverlay:a,transform:o,...l}=e;if(!t)return;let c={x:a.rect.left-s.rect.left,y:a.rect.top-s.rect.top},d={scaleX:1!==o.scaleX?s.rect.width*o.scaleX/a.rect.width:1,scaleY:1!==o.scaleY?s.rect.height*o.scaleY/a.rect.height:1},u={x:o.x-c.x,y:o.y-c.y,...d},h=r({...l,active:s,dragOverlay:a,transform:{initial:o,final:u}}),[g]=h,p=h[h.length-1];if(JSON.stringify(g)===JSON.stringify(p))return;let f=null==n?void 0:n({active:s,dragOverlay:a,...l}),m=a.node.animate(h,{duration:t,easing:i,fill:"forwards"});return new Promise(e=>{m.onfinish=()=>{null==f||f(),e()}})}}let tI=0;function tw(e){return(0,p.useMemo)(()=>{if(null!=e)return++tI},[e])}let tP=p.memo(e=>{let{adjustScale:t=!1,children:i,dropAnimation:n,style:r,transition:s,modifiers:a,wrapperElement:o="div",className:l,zIndex:c=999}=e,{activatorEvent:d,active:u,activeNodeRect:h,containerNodeRect:g,draggableNodes:f,droppableContainers:m,dragOverlay:v,over:S,measuringConfiguration:y,scrollableAncestors:C,scrollableAncestorRects:b,windowRect:T}=th(),E=(0,p.useContext)(ta),_=tw(null==u?void 0:u.id),I=tn(a,{activatorEvent:d,active:u,activeNodeRect:h,containerNodeRect:g,draggingNodeRect:v.rect,over:S,overlayNodeRect:v.rect,scrollableAncestors:C,scrollableAncestorRects:b,transform:E,windowRect:T}),w=eU(h),P=tE({config:n,draggableNodes:f,droppableContainers:m,measuringConfiguration:y}),R=w?v.setRef:void 0;return p.createElement(tS,null,p.createElement(tm,{animation:P},u&&_?p.createElement(tb,{key:_,id:u.id,ref:R,as:o,activatorEvent:d,adjustScale:t,className:l,transition:s,rect:w,style:{zIndex:c,...r},transform:I},i):null))})},795339:function(e,t,i){"use strict";function n(e,t,i){let n={...e};return t.top+e.y<=i.top?n.y=i.top-t.top:t.bottom+e.y>=i.top+i.height&&(n.y=i.top+i.height-t.bottom),t.left+e.x<=i.left?n.x=i.left-t.left:t.right+e.x>=i.left+i.width&&(n.x=i.left+i.width-t.right),n}i.d(t,{DL:()=>s,F4:()=>r}),i(400759);let r=({containerNodeRect:e,draggingNodeRect:t,transform:i})=>t&&e?n(i,t,e):i,s=({transform:e})=>({...e,x:0})},767445:function(e,t,i){"use strict";i.d(t,{Fo:()=>C,PG:()=>h,Rp:()=>a,is:()=>O,nB:()=>R,qw:()=>m});var n=i(632735),r=i(505513),s=i(400759);function a(e,t,i){let n=e.slice();return n.splice(i<0?n.length+i:i,0,n.splice(t,1)[0]),n}function o(e,t){return e.reduce((e,i,n)=>{let r=t.get(i);return r&&(e[n]=r),e},Array(e.length))}function l(e){return null!==e&&e>=0}function c(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function d(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}let u={scaleX:1,scaleY:1},h=e=>{var t;let{rects:i,activeNodeRect:n,activeIndex:r,overIndex:s,index:a}=e,o=null!=(t=i[r])?t:n;if(!o)return null;let l=g(i,a,r);if(a===r){let e=i[s];return e?{x:r<s?e.left+e.width-(o.left+o.width):e.left-o.left,y:0,...u}:null}return a>r&&a<=s?{x:-o.width-l,y:0,...u}:a<r&&a>=s?{x:o.width+l,y:0,...u}:{x:0,y:0,...u}};function g(e,t,i){let n=e[t],r=e[t-1],s=e[t+1];return n&&(r||s)?i<t?r?n.left-(r.left+r.width):s.left-(n.left+n.width):s?s.left-(n.left+n.width):n.left-(r.left+r.width):0}let p=e=>{let{rects:t,activeIndex:i,overIndex:n,index:r}=e,s=a(t,n,i),o=t[r],l=s[r];return l&&o?{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}:null},f={scaleX:1,scaleY:1},m=e=>{var t;let{activeIndex:i,activeNodeRect:n,index:r,rects:s,overIndex:a}=e,o=null!=(t=s[i])?t:n;if(!o)return null;if(r===i){let e=s[a];return e?{x:0,y:i<a?e.top+e.height-(o.top+o.height):e.top-o.top,...f}:null}let l=v(s,r,i);return r>i&&r<=a?{x:0,y:-o.height-l,...f}:r<i&&r>=a?{x:0,y:o.height+l,...f}:{x:0,y:0,...f}};function v(e,t,i){let n=e[t],r=e[t-1],s=e[t+1];return n?i<t?r?n.top-(r.top+r.height):s?s.top-(n.top+n.height):0:s?s.top-(n.top+n.height):r?n.top-(r.top+r.height):0:0}let S="Sortable",y=n.createContext({activeIndex:-1,containerId:S,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:p,disabled:{draggable:!1,droppable:!1}});function C(e){let{children:t,id:i,items:a,strategy:l=p,disabled:u=!1}=e,{active:h,dragOverlay:g,droppableRects:f,over:m,measureDroppableContainers:v,measuringScheduled:C}=(0,r.Cj)(),b=(0,s.Ld)(S,i),T=null!==g.rect,E=(0,n.useMemo)(()=>a.map(e=>"object"==typeof e&&"id"in e?e.id:e),[a]),_=null!=h,I=h?E.indexOf(h.id):-1,w=m?E.indexOf(m.id):-1,P=(0,n.useRef)(E),R=!c(E,P.current),A=-1!==w&&-1===I||R,M=d(u);(0,s.LI)(()=>{R&&_&&!C&&v(E)},[R,E,_,v,C]),(0,n.useEffect)(()=>{P.current=E},[E]);let D=(0,n.useMemo)(()=>({activeIndex:I,containerId:b,disabled:M,disableTransforms:A,items:E,overIndex:w,useDragOverlay:T,sortedRects:o(E,f),strategy:l}),[I,b,M.draggable,M.droppable,A,E,w,f,T,l]);return n.createElement(y.Provider,{value:D},t)}let b=e=>{let{id:t,items:i,activeIndex:n,overIndex:r}=e;return a(i,n,r).indexOf(t)},T=e=>{let{containerId:t,isSorting:i,wasDragging:n,index:r,items:s,newIndex:a,previousItems:o,previousContainerId:l,transition:c}=e;return!!c&&!!n&&(o===s||r!==a)&&(!!i||a!==r&&t===l)},E={duration:200,easing:"ease"},_="transform",I=s.ux.Transition.toString({property:_,duration:0,easing:"linear"}),w={roleDescription:"sortable"};function P(e){let{disabled:t,index:i,node:a,rect:o}=e,[l,c]=(0,n.useState)(null),d=(0,n.useRef)(i);return(0,s.LI)(()=>{if(!t&&i!==d.current&&a.current){let e=o.current;if(e){let t=(0,r.VK)(a.current,{ignoreTransform:!0}),i={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(i.x||i.y)&&c(i)}}i!==d.current&&(d.current=i)},[t,i,a,o]),(0,n.useEffect)(()=>{l&&requestAnimationFrame(()=>{c(null)})},[l]),l}function R(e){let{animateLayoutChanges:t=T,attributes:i,disabled:a,data:o,getNewIndex:c=b,id:d,strategy:u,resizeObserverConfig:h,transition:g=E}=e,{items:p,containerId:f,activeIndex:m,disabled:v,disableTransforms:S,sortedRects:C,overIndex:R,useDragOverlay:M,strategy:D}=(0,n.useContext)(y),O=A(a,v),k=p.indexOf(d),N=(0,n.useMemo)(()=>({sortable:{containerId:f,index:k,items:p},...o}),[f,o,k,p]),x=(0,n.useMemo)(()=>p.slice(p.indexOf(d)),[p,d]),{rect:L,node:F,isOver:U,setNodeRef:$}=(0,r.Zj)({id:d,data:N,disabled:O.droppable,resizeObserverConfig:{updateMeasurementsFor:x,...h}}),{active:V,activatorEvent:B,activeNodeRect:H,attributes:j,setNodeRef:q,listeners:W,isDragging:G,over:z,setActivatorNodeRef:J,transform:K}=(0,r.O1)({id:d,data:N,attributes:{...w,...i},disabled:O.draggable}),Q=(0,s.HB)($,q),Y=!!V,Z=Y&&!S&&l(m)&&l(R),X=!M&&G,ee=X&&Z?K:null,et=null!=u?u:D,ei=Z?null!=ee?ee:et({rects:C,activeNodeRect:H,activeIndex:m,overIndex:R,index:k}):null,en=l(m)&&l(R)?c({id:d,items:p,activeIndex:m,overIndex:R}):k,er=null==V?void 0:V.id,es=(0,n.useRef)({activeId:er,items:p,newIndex:en,containerId:f}),ea=p!==es.current.items,eo=t({active:V,containerId:f,isDragging:G,isSorting:Y,id:d,index:k,items:p,newIndex:es.current.newIndex,previousItems:es.current.items,previousContainerId:es.current.containerId,transition:g,wasDragging:null!=es.current.activeId}),el=P({disabled:!eo,index:k,node:F,rect:L});return(0,n.useEffect)(()=>{Y&&es.current.newIndex!==en&&(es.current.newIndex=en),f!==es.current.containerId&&(es.current.containerId=f),p!==es.current.items&&(es.current.items=p)},[Y,en,f,p]),(0,n.useEffect)(()=>{if(er===es.current.activeId)return;if(er&&!es.current.activeId){es.current.activeId=er;return}let e=setTimeout(()=>{es.current.activeId=er},50);return()=>clearTimeout(e)},[er]),{active:V,activeIndex:m,attributes:j,data:N,rect:L,index:k,newIndex:en,items:p,isOver:U,isSorting:Y,isDragging:G,listeners:W,node:F,overIndex:R,over:z,setNodeRef:Q,setActivatorNodeRef:J,setDroppableNodeRef:$,setDraggableNodeRef:q,transform:null!=el?el:ei,transition:ec()};function ec(){return el||ea&&es.current.newIndex===k?I:(!X||(0,s.vd)(B))&&g&&(Y||eo)?s.ux.Transition.toString({...g,property:_}):void 0}}function A(e,t){var i,n;return"boolean"==typeof e?{draggable:e,droppable:!1}:{draggable:null!=(i=null==e?void 0:e.draggable)?i:t.draggable,droppable:null!=(n=null==e?void 0:e.droppable)?n:t.droppable}}function M(e){if(!e)return!1;let t=e.data.current;return!!t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable}let D=[r.g4.Down,r.g4.Right,r.g4.Up,r.g4.Left],O=(e,t)=>{let{context:{active:i,collisionRect:n,droppableRects:a,droppableContainers:o,over:l,scrollableAncestors:c}}=t;if(D.includes(e.code)){if(e.preventDefault(),!i||!n)return;let t=[];o.getEnabled().forEach(i=>{if(!i||null!=i&&i.disabled)return;let s=a.get(i.id);if(s)switch(e.code){case r.g4.Down:n.top<s.top&&t.push(i);break;case r.g4.Up:n.top>s.top&&t.push(i);break;case r.g4.Left:n.left>s.left&&t.push(i);break;case r.g4.Right:n.left<s.left&&t.push(i)}});let d=(0,r.ey)({active:i,collisionRect:n,droppableRects:a,droppableContainers:t,pointerCoordinates:null}),u=(0,r._8)(d,"id");if(u===(null==l?void 0:l.id)&&d.length>1&&(u=d[1].id),null!=u){let e=o.get(i.id),t=o.get(u),l=t?a.get(t.id):null,d=null==t?void 0:t.node.current;if(d&&l&&e&&t){let i=(0,r.hI)(d).some((e,t)=>c[t]!==e),a=k(e,t),o=N(e,t),u=i||!a?{x:0,y:0}:{x:o?n.width-l.width:0,y:o?n.height-l.height:0},h={x:l.left,y:l.top};return u.x&&u.y?h:(0,s.$X)(h,u)}}}};function k(e,t){return!!M(e)&&!!M(t)&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}function N(e,t){return!!M(e)&&!!M(t)&&!!k(e,t)&&e.data.current.sortable.index<t.data.current.sortable.index}},400759:function(e,t,i){"use strict";i.d(t,{$X:()=>_,D9:()=>y,DC:()=>R,Ey:()=>m,FJ:()=>a,Gj:()=>v,HB:()=>r,IH:()=>E,Jj:()=>l,LI:()=>g,Ld:()=>b,Nq:()=>s,Re:()=>d,UG:()=>o,Yz:()=>f,qk:()=>c,r3:()=>h,so:()=>D,ux:()=>A,vZ:()=>u,vd:()=>w,wm:()=>S,zX:()=>p});var n=i(632735);function r(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,n.useMemo)(()=>e=>{t.forEach(t=>t(e))},t)}let s="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function a(e){let t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function o(e){return"nodeType"in e}function l(e){var t,i;return e?a(e)?e:o(e)&&null!=(t=null==(i=e.ownerDocument)?void 0:i.defaultView)?t:window:window}function c(e){let{Document:t}=l(e);return e instanceof t}function d(e){return!a(e)&&e instanceof l(e).HTMLElement}function u(e){return e instanceof l(e).SVGElement}function h(e){return e?a(e)?e.document:o(e)?c(e)?e:d(e)||u(e)?e.ownerDocument:document:document:document}let g=s?n.useLayoutEffect:n.useEffect;function p(e){let t=(0,n.useRef)(e);return g(()=>{t.current=e}),(0,n.useCallback)(function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return null==t.current?void 0:t.current(...i)},[])}function f(){let e=(0,n.useRef)(null);return[(0,n.useCallback)((t,i)=>{e.current=setInterval(t,i)},[]),(0,n.useCallback)(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}function m(e,t){void 0===t&&(t=[e]);let i=(0,n.useRef)(e);return g(()=>{i.current!==e&&(i.current=e)},t),i}function v(e,t){let i=(0,n.useRef)();return(0,n.useMemo)(()=>{let t=e(i.current);return i.current=t,t},[...t])}function S(e){let t=p(e),i=(0,n.useRef)(null),r=(0,n.useCallback)(e=>{e!==i.current&&(null==t||t(e,i.current)),i.current=e},[]);return[i,r]}function y(e){let t=(0,n.useRef)();return(0,n.useEffect)(()=>{t.current=e},[e]),t.current}let C={};function b(e,t){return(0,n.useMemo)(()=>{if(t)return t;let i=null==C[e]?0:C[e]+1;return C[e]=i,e+"-"+i},[e,t])}function T(e){return function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return n.reduce((t,i)=>{for(let[n,r]of Object.entries(i)){let i=t[n];null!=i&&(t[n]=i+e*r)}return t},{...t})}}let E=T(1),_=T(-1);function I(e){return"clientX"in e&&"clientY"in e}function w(e){if(!e)return!1;let{KeyboardEvent:t}=l(e.target);return t&&e instanceof t}function P(e){if(!e)return!1;let{TouchEvent:t}=l(e.target);return t&&e instanceof t}function R(e){if(P(e)){if(e.touches&&e.touches.length){let{clientX:t,clientY:i}=e.touches[0];return{x:t,y:i}}else if(e.changedTouches&&e.changedTouches.length){let{clientX:t,clientY:i}=e.changedTouches[0];return{x:t,y:i}}}return I(e)?{x:e.clientX,y:e.clientY}:null}let A=Object.freeze({Translate:{toString(e){if(!e)return;let{x:t,y:i}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(i?Math.round(i):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;let{scaleX:t,scaleY:i}=e;return"scaleX("+t+") scaleY("+i+")"}},Transform:{toString(e){if(e)return[A.Translate.toString(e),A.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:i,easing:n}=e;return t+" "+i+"ms "+n}}}),M="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function D(e){return e.matches(M)?e:e.querySelector(M)}},104044:function(e,t,i){"use strict";i.d(t,{Z:()=>n});let n=function(e){for(var t,i=0,n=0,r=e.length;r>=4;++n,r-=4)t=(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))*0x5bd1e995+((t>>>16)*59797<<16),t^=t>>>24,i=(65535&t)*0x5bd1e995+((t>>>16)*59797<<16)^(65535&i)*0x5bd1e995+((i>>>16)*59797<<16);switch(r){case 3:i^=(255&e.charCodeAt(n+2))<<16;case 2:i^=(255&e.charCodeAt(n+1))<<8;case 1:i^=255&e.charCodeAt(n),i=(65535&i)*0x5bd1e995+((i>>>16)*59797<<16)}return i^=i>>>13,(((i=(65535&i)*0x5bd1e995+((i>>>16)*59797<<16))^i>>>15)>>>0).toString(36)}},627305:function(e,t,i){"use strict";i.d(t,{x7:()=>eN,Cp:()=>ek,cv:()=>eA,dp:()=>eO,dr:()=>ex,RR:()=>eD,oo:()=>eL,US:()=>eR,uY:()=>eM});let n=["top","right","bottom","left"],r=Math.min,s=Math.max,a=Math.round,o=e=>({x:e,y:e}),l={left:"right",right:"left",bottom:"top",top:"bottom"},c={start:"end",end:"start"};function d(e,t,i){return s(e,r(t,i))}function u(e,t){return"function"==typeof e?e(t):e}function h(e){return e.split("-")[0]}function g(e){return e.split("-")[1]}function p(e){return"x"===e?"y":"x"}function f(e){return"y"===e?"height":"width"}function m(e){return["top","bottom"].includes(h(e))?"y":"x"}function v(e){return p(m(e))}function S(e,t,i){void 0===i&&(i=!1);let n=g(e),r=v(e),s=f(r),a="x"===r?n===(i?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[s]>t.floating[s]&&(a=E(a)),[a,E(a)]}function y(e){let t=E(e);return[C(e),t,C(t)]}function C(e){return e.replace(/start|end/g,e=>c[e])}function b(e,t,i){let n=["left","right"],r=["right","left"],s=["top","bottom"],a=["bottom","top"];switch(e){case"top":case"bottom":if(i)return t?r:n;return t?n:r;case"left":case"right":return t?s:a;default:return[]}}function T(e,t,i,n){let r=g(e),s=b(h(e),"start"===i,n);return r&&(s=s.map(e=>e+"-"+r),t&&(s=s.concat(s.map(C)))),s}function E(e){return e.replace(/left|right|bottom|top/g,e=>l[e])}function _(e){return{top:0,right:0,bottom:0,left:0,...e}}function I(e){return"number"!=typeof e?_(e):{top:e,right:e,bottom:e,left:e}}function w(e){let{x:t,y:i,width:n,height:r}=e;return{width:n,height:r,top:i,left:t,right:t+n,bottom:i+r,x:t,y:i}}function P(e,t,i){let n,{reference:r,floating:s}=e,a=m(t),o=v(t),l=f(o),c=h(t),d="y"===a,u=r.x+r.width/2-s.width/2,p=r.y+r.height/2-s.height/2,S=r[l]/2-s[l]/2;switch(c){case"top":n={x:u,y:r.y-s.height};break;case"bottom":n={x:u,y:r.y+r.height};break;case"right":n={x:r.x+r.width,y:p};break;case"left":n={x:r.x-s.width,y:p};break;default:n={x:r.x,y:r.y}}switch(g(t)){case"start":n[o]-=S*(i&&d?-1:1);break;case"end":n[o]+=S*(i&&d?-1:1)}return n}let R=async(e,t,i)=>{let{placement:n="bottom",strategy:r="absolute",middleware:s=[],platform:a}=i,o=s.filter(Boolean),l=await (null==a.isRTL?void 0:a.isRTL(t)),c=await a.getElementRects({reference:e,floating:t,strategy:r}),{x:d,y:u}=P(c,n,l),h=n,g={},p=0;for(let i=0;i<o.length;i++){let{name:s,fn:f}=o[i],{x:m,y:v,data:S,reset:y}=await f({x:d,y:u,initialPlacement:n,placement:h,strategy:r,middlewareData:g,rects:c,platform:a,elements:{reference:e,floating:t}});d=null!=m?m:d,u=null!=v?v:u,g={...g,[s]:{...g[s],...S}},y&&p<=50&&(p++,"object"==typeof y&&(y.placement&&(h=y.placement),y.rects&&(c=!0===y.rects?await a.getElementRects({reference:e,floating:t,strategy:r}):y.rects),{x:d,y:u}=P(c,h,l)),i=-1)}return{x:d,y:u,placement:h,strategy:r,middlewareData:g}};async function A(e,t){var i;void 0===t&&(t={});let{x:n,y:r,platform:s,rects:a,elements:o,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:g=!1,padding:p=0}=u(t,e),f=I(p),m="floating"===h?"reference":"floating",v=o[g?m:h],S=w(await s.getClippingRect({element:null==(i=await (null==s.isElement?void 0:s.isElement(v)))||i?v:v.contextElement||await (null==s.getDocumentElement?void 0:s.getDocumentElement(o.floating)),boundary:c,rootBoundary:d,strategy:l})),y="floating"===h?{x:n,y:r,width:a.floating.width,height:a.floating.height}:a.reference,C=await (null==s.getOffsetParent?void 0:s.getOffsetParent(o.floating)),b=await (null==s.isElement?void 0:s.isElement(C))&&await (null==s.getScale?void 0:s.getScale(C))||{x:1,y:1},T=w(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:y,offsetParent:C,strategy:l}):y);return{top:(S.top-T.top+f.top)/b.y,bottom:(T.bottom-S.bottom+f.bottom)/b.y,left:(S.left-T.left+f.left)/b.x,right:(T.right-S.right+f.right)/b.x}}let M=e=>({name:"arrow",options:e,async fn(t){let{x:i,y:n,placement:s,rects:a,platform:o,elements:l,middlewareData:c}=t,{element:h,padding:p=0}=u(e,t)||{};if(null==h)return{};let m=I(p),S={x:i,y:n},y=v(s),C=f(y),b=await o.getDimensions(h),T="y"===y,E=T?"top":"left",_=T?"bottom":"right",w=T?"clientHeight":"clientWidth",P=a.reference[C]+a.reference[y]-S[y]-a.floating[C],R=S[y]-a.reference[y],A=await (null==o.getOffsetParent?void 0:o.getOffsetParent(h)),M=A?A[w]:0;M&&await (null==o.isElement?void 0:o.isElement(A))||(M=l.floating[w]||a.floating[C]);let D=P/2-R/2,O=M/2-b[C]/2-1,k=r(m[E],O),N=r(m[_],O),x=k,L=M-b[C]-N,F=M/2-b[C]/2+D,U=d(x,F,L),$=!c.arrow&&null!=g(s)&&F!==U&&a.reference[C]/2-(F<x?k:N)-b[C]/2<0,V=$?F<x?F-x:F-L:0;return{[y]:S[y]+V,data:{[y]:U,centerOffset:F-U-V,...$&&{alignmentOffset:V}},reset:$}}}),D=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var i,n,r,s,a;let{placement:o,middlewareData:l,rects:c,initialPlacement:d,platform:g,elements:p}=t,{mainAxis:f=!0,crossAxis:v=!0,fallbackPlacements:C,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:_="none",flipAlignment:I=!0,...w}=u(e,t);if(null!=(i=l.arrow)&&i.alignmentOffset)return{};let P=h(o),R=m(d),M=h(d)===d,D=await (null==g.isRTL?void 0:g.isRTL(p.floating)),O=C||(M||!I?[E(d)]:y(d)),k="none"!==_;!C&&k&&O.push(...T(d,I,_,D));let N=[d,...O],x=await A(t,w),L=[],F=(null==(n=l.flip)?void 0:n.overflows)||[];if(f&&L.push(x[P]),v){let e=S(o,c,D);L.push(x[e[0]],x[e[1]])}if(F=[...F,{placement:o,overflows:L}],!L.every(e=>e<=0)){let e=((null==(r=l.flip)?void 0:r.index)||0)+1,t=N[e];if(t)return{data:{index:e,overflows:F},reset:{placement:t}};let i=null==(s=F.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:s.placement;if(!i)switch(b){case"bestFit":{let e=null==(a=F.filter(e=>{if(k){let t=m(e.placement);return t===R||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:a[0];e&&(i=e);break}case"initialPlacement":i=d}if(o!==i)return{reset:{placement:i}}}return{}}}};function O(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function k(e){return n.some(t=>e[t]>=0)}let N=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){let{rects:i}=t,{strategy:n="referenceHidden",...r}=u(e,t);switch(n){case"referenceHidden":{let e=O(await A(t,{...r,elementContext:"reference"}),i.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:k(e)}}}case"escaped":{let e=O(await A(t,{...r,altBoundary:!0}),i.floating);return{data:{escapedOffsets:e,escaped:k(e)}}}default:return{}}}}};async function x(e,t){let{placement:i,platform:n,elements:r}=e,s=await (null==n.isRTL?void 0:n.isRTL(r.floating)),a=h(i),o=g(i),l="y"===m(i),c=["left","top"].includes(a)?-1:1,d=s&&l?-1:1,p=u(t,e),{mainAxis:f,crossAxis:v,alignmentAxis:S}="number"==typeof p?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return o&&"number"==typeof S&&(v="end"===o?-1*S:S),l?{x:v*d,y:f*c}:{x:f*c,y:v*d}}let L=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var i,n;let{x:r,y:s,placement:a,middlewareData:o}=t,l=await x(t,e);return a===(null==(i=o.offset)?void 0:i.placement)&&null!=(n=o.arrow)&&n.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:a}}}}},F=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:i,y:n,placement:r}=t,{mainAxis:s=!0,crossAxis:a=!1,limiter:o={fn:e=>{let{x:t,y:i}=e;return{x:t,y:i}}},...l}=u(e,t),c={x:i,y:n},g=await A(t,l),f=m(h(r)),v=p(f),S=c[v],y=c[f];if(s){let e="y"===v?"top":"left",t="y"===v?"bottom":"right",i=S+g[e],n=S-g[t];S=d(i,S,n)}if(a){let e="y"===f?"top":"left",t="y"===f?"bottom":"right",i=y+g[e],n=y-g[t];y=d(i,y,n)}let C=o.fn({...t,[v]:S,[f]:y});return{...C,data:{x:C.x-i,y:C.y-n,enabled:{[v]:s,[f]:a}}}}}},U=function(e){return void 0===e&&(e={}),{options:e,fn(t){let{x:i,y:n,placement:r,rects:s,middlewareData:a}=t,{offset:o=0,mainAxis:l=!0,crossAxis:c=!0}=u(e,t),d={x:i,y:n},g=m(r),f=p(g),v=d[f],S=d[g],y=u(o,t),C="number"==typeof y?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){let e="y"===f?"height":"width",t=s.reference[f]-s.floating[e]+C.mainAxis,i=s.reference[f]+s.reference[e]-C.mainAxis;v<t?v=t:v>i&&(v=i)}if(c){var b,T;let e="y"===f?"width":"height",t=["top","left"].includes(h(r)),i=s.reference[g]-s.floating[e]+(t&&(null==(b=a.offset)?void 0:b[g])||0)+(t?0:C.crossAxis),n=s.reference[g]+s.reference[e]+(t?0:(null==(T=a.offset)?void 0:T[g])||0)-(t?C.crossAxis:0);S<i?S=i:S>n&&(S=n)}return{[f]:v,[g]:S}}}},$=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var i,n;let a,o,{placement:l,rects:c,platform:d,elements:p}=t,{apply:f=()=>{},...v}=u(e,t),S=await A(t,v),y=h(l),C=g(l),b="y"===m(l),{width:T,height:E}=c.floating;"top"===y||"bottom"===y?(a=y,o=C===(await (null==d.isRTL?void 0:d.isRTL(p.floating))?"start":"end")?"left":"right"):(o=y,a="end"===C?"top":"bottom");let _=E-S.top-S.bottom,I=T-S.left-S.right,w=r(E-S[a],_),P=r(T-S[o],I),R=!t.middlewareData.shift,M=w,D=P;if(null!=(i=t.middlewareData.shift)&&i.enabled.x&&(D=I),null!=(n=t.middlewareData.shift)&&n.enabled.y&&(M=_),R&&!C){let e=s(S.left,0),t=s(S.right,0),i=s(S.top,0),n=s(S.bottom,0);b?D=T-2*(0!==e||0!==t?e+t:s(S.left,S.right)):M=E-2*(0!==i||0!==n?i+n:s(S.top,S.bottom))}await f({...t,availableWidth:D,availableHeight:M});let O=await d.getDimensions(p.floating);return T!==O.width||E!==O.height?{reset:{rects:!0}}:{}}}};function V(){return"undefined"!=typeof window}function B(e){return q(e)?(e.nodeName||"").toLowerCase():"#document"}function H(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function j(e){var t;return null==(t=(q(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function q(e){return!!V()&&(e instanceof Node||e instanceof H(e).Node)}function W(e){return!!V()&&(e instanceof Element||e instanceof H(e).Element)}function G(e){return!!V()&&(e instanceof HTMLElement||e instanceof H(e).HTMLElement)}function z(e){return!!V()&&"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof H(e).ShadowRoot)}function J(e){let{overflow:t,overflowX:i,overflowY:n,display:r}=et(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+i)&&!["inline","contents"].includes(r)}function K(e){return["table","td","th"].includes(B(e))}function Q(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch(e){return!1}})}function Y(e){let t=X(),i=W(e)?et(e):e;return["transform","translate","scale","rotate","perspective"].some(e=>!!i[e]&&"none"!==i[e])||!!i.containerType&&"normal"!==i.containerType||!t&&!!i.backdropFilter&&"none"!==i.backdropFilter||!t&&!!i.filter&&"none"!==i.filter||["transform","translate","scale","rotate","perspective","filter"].some(e=>(i.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(i.contain||"").includes(e))}function Z(e){let t=en(e);for(;G(t)&&!ee(t);){if(Y(t))return t;if(Q(t))break;t=en(t)}return null}function X(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function ee(e){return["html","body","#document"].includes(B(e))}function et(e){return H(e).getComputedStyle(e)}function ei(e){return W(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function en(e){if("html"===B(e))return e;let t=e.assignedSlot||e.parentNode||z(e)&&e.host||j(e);return z(t)?t.host:t}function er(e){let t=en(e);return ee(t)?e.ownerDocument?e.ownerDocument.body:e.body:G(t)&&J(t)?t:er(t)}function es(e,t,i){var n;void 0===t&&(t=[]),void 0===i&&(i=!0);let r=er(e),s=r===(null==(n=e.ownerDocument)?void 0:n.body),a=H(r);if(s){let e=ea(a);return t.concat(a,a.visualViewport||[],J(r)?r:[],e&&i?es(e):[])}return t.concat(r,es(r,[],i))}function ea(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function eo(e){let t=et(e),i=parseFloat(t.width)||0,n=parseFloat(t.height)||0,r=G(e),s=r?e.offsetWidth:i,o=r?e.offsetHeight:n,l=a(i)!==s||a(n)!==o;return l&&(i=s,n=o),{width:i,height:n,$:l}}function el(e){return W(e)?e:e.contextElement}function ec(e){let t=el(e);if(!G(t))return o(1);let i=t.getBoundingClientRect(),{width:n,height:r,$:s}=eo(t),l=(s?a(i.width):i.width)/n,c=(s?a(i.height):i.height)/r;return l&&Number.isFinite(l)||(l=1),c&&Number.isFinite(c)||(c=1),{x:l,y:c}}let ed=o(0);function eu(e){let t=H(e);return X()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:ed}function eh(e,t,i){return void 0===t&&(t=!1),!!i&&(!t||i===H(e))&&t}function eg(e,t,i,n){void 0===t&&(t=!1),void 0===i&&(i=!1);let r=e.getBoundingClientRect(),s=el(e),a=o(1);t&&(n?W(n)&&(a=ec(n)):a=ec(e));let l=eh(s,i,n)?eu(s):o(0),c=(r.left+l.x)/a.x,d=(r.top+l.y)/a.y,u=r.width/a.x,h=r.height/a.y;if(s){let e=H(s),t=n&&W(n)?H(n):n,i=e,r=ea(i);for(;r&&n&&t!==i;){let e=ec(r),t=r.getBoundingClientRect(),n=et(r),s=t.left+(r.clientLeft+parseFloat(n.paddingLeft))*e.x,a=t.top+(r.clientTop+parseFloat(n.paddingTop))*e.y;c*=e.x,d*=e.y,u*=e.x,h*=e.y,c+=s,d+=a,r=ea(i=H(r))}}return w({width:u,height:h,x:c,y:d})}function ep(e,t){let i=ei(e).scrollLeft;return t?t.left+i:eg(j(e)).left+i}function ef(e,t,i){void 0===i&&(i=!1);let n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-(i?0:ep(e,n)),y:n.top+t.scrollTop}}function em(e){let t=j(e),i=ei(e),n=e.ownerDocument.body,r=s(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),a=s(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight),o=-i.scrollLeft+ep(e),l=-i.scrollTop;return"rtl"===et(n).direction&&(o+=s(t.clientWidth,n.clientWidth)-r),{width:r,height:a,x:o,y:l}}function ev(e,t){let i=H(e),n=j(e),r=i.visualViewport,s=n.clientWidth,a=n.clientHeight,o=0,l=0;if(r){s=r.width,a=r.height;let e=X();(!e||e&&"fixed"===t)&&(o=r.offsetLeft,l=r.offsetTop)}return{width:s,height:a,x:o,y:l}}function eS(e,t){let i=eg(e,!0,"fixed"===t),n=i.top+e.clientTop,r=i.left+e.clientLeft,s=G(e)?ec(e):o(1),a=e.clientWidth*s.x,l=e.clientHeight*s.y;return{width:a,height:l,x:r*s.x,y:n*s.y}}function ey(e,t,i){let n;if("viewport"===t)n=ev(e,i);else if("document"===t)n=em(j(e));else if(W(t))n=eS(t,i);else{let i=eu(e);n={x:t.x-i.x,y:t.y-i.y,width:t.width,height:t.height}}return w(n)}function eC(e,t){let i=en(e);return!(i===t||!W(i)||ee(i))&&("fixed"===et(i).position||eC(i,t))}function eb(e,t){let i=t.get(e);if(i)return i;let n=es(e,[],!1).filter(e=>W(e)&&"body"!==B(e)),r=null,s="fixed"===et(e).position,a=s?en(e):e;for(;W(a)&&!ee(a);){let t=et(a),i=Y(a);i||"fixed"!==t.position||(r=null),(s?!i&&!r:!i&&"static"===t.position&&!!r&&["absolute","fixed"].includes(r.position)||J(a)&&!i&&eC(e,a))?n=n.filter(e=>e!==a):r=t,a=en(a)}return t.set(e,n),n}function eT(e,t,i){let n=G(t),r=j(t),s="fixed"===i,a=eg(e,!0,s,t),l={scrollLeft:0,scrollTop:0},c=o(0);if(n||!n&&!s)if(("body"!==B(t)||J(r))&&(l=ei(t)),n){let e=eg(t,!0,s,t);c.x=e.x+t.clientLeft,c.y=e.y+t.clientTop}else r&&(c.x=ep(r));let d=!r||n||s?o(0):ef(r,l);return{x:a.left+l.scrollLeft-c.x-d.x,y:a.top+l.scrollTop-c.y-d.y,width:a.width,height:a.height}}function eE(e){return"static"===et(e).position}function e_(e,t){if(!G(e)||"fixed"===et(e).position)return null;if(t)return t(e);let i=e.offsetParent;return j(e)===i&&(i=i.ownerDocument.body),i}function eI(e,t){let i=H(e);if(Q(e))return i;if(!G(e)){let t=en(e);for(;t&&!ee(t);){if(W(t)&&!eE(t))return t;t=en(t)}return i}let n=e_(e,t);for(;n&&K(n)&&eE(n);)n=e_(n,t);return n&&ee(n)&&eE(n)&&!Y(n)?i:n||Z(e)||i}let ew=async function(e){let t=this.getOffsetParent||eI,i=this.getDimensions,n=await i(e.floating);return{reference:eT(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},eP={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:i,offsetParent:n,strategy:r}=e,s="fixed"===r,a=j(n),l=!!t&&Q(t.floating);if(n===a||l&&s)return i;let c={scrollLeft:0,scrollTop:0},d=o(1),u=o(0),h=G(n);if((h||!h&&!s)&&(("body"!==B(n)||J(a))&&(c=ei(n)),G(n))){let e=eg(n);d=ec(n),u.x=e.x+n.clientLeft,u.y=e.y+n.clientTop}let g=!a||h||s?o(0):ef(a,c,!0);return{width:i.width*d.x,height:i.height*d.y,x:i.x*d.x-c.scrollLeft*d.x+u.x+g.x,y:i.y*d.y-c.scrollTop*d.y+u.y+g.y}},getDocumentElement:j,getClippingRect:function(e){let{element:t,boundary:i,rootBoundary:n,strategy:a}=e,o=[..."clippingAncestors"===i?Q(t)?[]:eb(t,this._c):[].concat(i),n],l=o[0],c=o.reduce((e,i)=>{let n=ey(t,i,a);return e.top=s(n.top,e.top),e.right=r(n.right,e.right),e.bottom=r(n.bottom,e.bottom),e.left=s(n.left,e.left),e},ey(t,l,a));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}},getOffsetParent:eI,getElementRects:ew,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){let{width:t,height:i}=eo(e);return{width:t,height:i}},getScale:ec,isElement:W,isRTL:function(e){return"rtl"===et(e).direction}},eR=A,eA=L,eM=F,eD=D,eO=$,ek=N,eN=M,ex=U,eL=(e,t,i)=>{let n=new Map,r={platform:eP,...i},s={...r.platform,_c:n};return R(e,t,{...r,platform:s})}},472810:function(e,t,i){"use strict";i.d(t,{$:()=>_});var n=i(632735),r=i(868374),s=i(361323);let a=-1,o="keyboard",l="touch",c="mouse",d="setValue",u="handleRef",h="wrapperRef",g="elementRef",p=20,f={end:{ArrowRight:1,ArrowLeft:-1},start:{ArrowRight:-1,ArrowLeft:1},up:{ArrowUp:1,ArrowDown:-1},down:{ArrowUp:-1,ArrowDown:1}};function m(e,t){return Object.prototype.hasOwnProperty.call(f,e)&&Object.prototype.hasOwnProperty.call(f[e],t)}let v=e=>{let{onValueChange:t,growDirection:i,getCurrentValue:a}=e,{dir:l}=(0,r.O)(),c=(0,s.$)(e=>{var n;if(!m(i,e.key))return;let r=a(),s=null!=(n=f[i][e.key])?n:1;t(e,{event:e,value:Math.round(r+=s*p*("rtl"===l&&["start","end"].includes(i)?-1:1)),type:o})});return{attachHandlers:n.useCallback(e=>{e.addEventListener("keydown",c)},[c]),detachHandlers:n.useCallback(e=>{e.removeEventListener("keydown",c)},[c])}};var S=i(389512);function y(e){let{targetDocument:t,dir:i}=(0,r.O)(),a=null==t?void 0:t.defaultView,o=n.useRef({clientX:0,clientY:0}),{growDirection:d,onValueChange:u,getCurrentValue:h}=e,g=n.useRef(0),p=(0,s.$)(e=>{let{clientX:t,clientY:n}=(0,S.xC)(e),r=[t-o.current.clientX,n-o.current.clientY],s=g.current;switch(d){case"end":s+=r[0]*("rtl"===i?-1:1);break;case"start":s-=r[0]*("rtl"===i?-1:1);break;case"up":s-=r[1];break;case"down":s+=r[1]}u(e,{value:Math.round(s),...(0,S.z6)(e)?{event:e,type:l}:{event:e,type:c}})}),f=n.useRef(null),m=(0,s.$)(e=>{a&&(f.current&&a.cancelAnimationFrame(f.current),f.current=a.requestAnimationFrame(()=>p(e)))}),v=(0,s.$)(i=>{(0,S.N5)(i)&&(null==t||t.removeEventListener("mouseup",v),null==t||t.removeEventListener("mousemove",m)),(0,S.z6)(i)&&(null==t||t.removeEventListener("touchend",v),null==t||t.removeEventListener("touchmove",m)),a&&f.current&&a.cancelAnimationFrame(f.current),p(i),null==e.onDragEnd||e.onDragEnd.call(e,i,(0,S.z6)(i)?{event:i,type:l}:{event:i,type:c})}),y=(0,s.$)(i=>{if(o.current=(0,S.xC)(i),g.current=h(),!i.defaultPrevented){if((0,S.N5)(i)){if(i.target!==i.currentTarget||0!==i.button)return;null==t||t.addEventListener("mouseup",v),null==t||t.addEventListener("mousemove",m)}(0,S.z6)(i)&&(null==t||t.addEventListener("touchend",v),null==t||t.addEventListener("touchmove",m)),null==e.onDragStart||e.onDragStart.call(e,i,(0,S.z6)(i)?{event:i,type:l}:{event:i,type:c})}}),C=n.useCallback(e=>{e.addEventListener("mousedown",y),e.addEventListener("touchstart",y)},[y]),b=n.useCallback(e=>{e.removeEventListener("mousedown",y),e.removeEventListener("touchstart",y)},[y]);return n.useEffect(()=>()=>{a&&f.current&&a.cancelAnimationFrame(f.current)},[a]),{attachHandlers:C,detachHandlers:b}}function C(e,t,i){return Math.max(Math.min(e,i),t)}function b(e,t){let i="end"===t||"start"===t?"width":"height";return(null==e?void 0:e.getBoundingClientRect()[i])||0}let T=(e,t,i,n)=>n||e===a?e:C(e,t,i),E=e=>e===a?void 0:`${e.toFixed(0)}px`,_=e=>{let{growDirection:t,variableName:i,variableTarget:r="wrapper",minValue:o=0,maxValue:l=Number.MAX_SAFE_INTEGER,onChange:c,onDragStart:p,onDragEnd:f,getA11ValueText:m=E,relative:S}=e,C=n.useRef(null),_=n.useRef(null),I=n.useRef(null),w=n.useRef(a),P=n.useCallback(e=>{let n=S?m(b(I.current,t)):m(w.current);if(Object.entries({role:"slider","aria-valuemin":o,...l<Number.MAX_SAFE_INTEGER&&{"aria-valuemax":l},...n&&{"aria-valuetext":n},"aria-orientation":"end"===t||"start"===t?"horizontal":"vertical"}).forEach(([e,t])=>{var i;null==(i=C.current)||i.setAttribute(e,String(t))}),w.current!==a){let t="wrapper"===r?_.current:I.current;null==t||t.style.setProperty(i,`${w.current}px`),null==c||c(e.event,e)}},[m,l,o,c,i]);n.useEffect(()=>{w.current=T(w.current,o,l,S)},[l,o]);let R=n.useCallback((e,i)=>{let{value:n}=i,r=T(n,o,l,S);if(r!==w.current){let e=w.current,n=b(I.current,t);w.current=r,P({...i,value:w.current}),b(I.current,t)===n&&(w.current=e,P({...i,value:w.current}))}},[o,l,P]),A=n.useCallback(e=>{let t=new CustomEvent(d);R(t,{event:t,value:e,type:d})},[R]),M=(0,s.$)((e,t)=>{null==p||p(e,{...t,value:w.current})}),D=(0,s.$)((e,t)=>{null==f||f(e,{...t,value:w.current})}),O=n.useCallback(()=>S?w.current:b(I.current,t),[]),{attachHandlers:k,detachHandlers:N}=y({growDirection:t,onValueChange:R,onDragStart:M,onDragEnd:D,getCurrentValue:O}),{attachHandlers:x,detachHandlers:L}=v({growDirection:t,onValueChange:R,getCurrentValue:O}),F=n.useCallback(e=>{e&&(C.current!==e&&(N(e),L(e)),k(e),x(e),P({type:u,event:new CustomEvent(u),value:w.current})),C.current=e},[x,k,L,N,P]),U=n.useCallback(e=>{_.current=e,I.current&&P({type:h,event:new CustomEvent(h),value:w.current})},[P]);return{setValue:A,elementRef:n.useCallback(e=>{I.current=e,I.current&&(w.current===a&&S&&(w.current=0),P({type:g,event:new CustomEvent(g),value:w.current}))},[P]),handleRef:F,wrapperRef:U,growDirection:t}}},424969:function(e,t,i){"use strict";i.d(t,{s:()=>s});var n=i(517596),r=i(187654);function s(e,t,i=n.F){let a=i(),o=null,l=null;return function(i){let{dir:n,renderer:s}=i,c="ltr"===n;return c?null===o&&(o=(0,r.V)(e,n)):null===l&&(l=(0,r.V)(e,n)),a(s,t),c?o:l}}},13044:function(e,t,i){"use strict";i.d(t,{$Q:()=>a,C_:()=>f,Hf:()=>l,JM:()=>g,M_:()=>u,Qz:()=>d,de:()=>p,gk:()=>c,jD:()=>h,n$:()=>o,td:()=>m,xR:()=>s});let n="undefined"==typeof window?i.g:window,r="@griffel/",s=function(e,t){return n[Symbol.for(r+e)]||(n[Symbol.for(r+e)]=t),n[Symbol.for(r+e)]}("DEFINITION_LOOKUP_TABLE",{}),a="data-make-styles-bucket",o="data-priority",l="f",c=7,d="___",u="_",h=d.length+7,g=0,p=1,f={all:1,borderColor:1,borderStyle:1,borderWidth:1,borderBlock:1,borderBlockEnd:1,borderBlockStart:1,borderInline:1,borderInlineEnd:1,borderInlineStart:1},m="DO_NOT_USE_DIRECTLY: @griffel/reset-value"},568384:function(e,t,i){"use strict";i.d(t,{q5:()=>P});let n=["Top","Right","Bottom","Left"];function r(e,t,...i){let[s,a=s,o=s,l=a]=i,c=[s,a,o,l],d={};for(let i=0;i<c.length;i+=1)(c[i]||0===c[i])&&(d[e+n[i]+t]=c[i]);return d}function s(...e){return r("border","Width",...e)}function a(...e){return r("border","Style",...e)}function o(...e){return r("border","Color",...e)}let l=["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset"];function c(e){return l.includes(e)}let d=e=>"string"==typeof e&&/(\d+(\w+|%))/.test(e),u=e=>"number"==typeof e&&!Number.isNaN(e),h=e=>"initial"===e,g=e=>"auto"===e,p=e=>"none"===e,f=["content","fit-content","max-content","min-content"],m=e=>f.some(t=>e===t)||d(e),v=/var\(.*\)/gi;function S(e){return void 0===e||"number"==typeof e||"string"==typeof e&&!v.test(e)}let y=/^[a-zA-Z0-9\-_\\#;]+$/,C=/^-moz-initial$|^auto$|^initial$|^inherit$|^revert$|^unset$|^span \d+$|^\d.*/;function b(e){return void 0!==e&&"string"==typeof e&&y.test(e)&&!C.test(e)}let T=["-moz-initial","inherit","initial","revert","unset"];function E(e){return 1===e.length&&T.includes(e[0])}function _(e){return 1===e.length&&Array.isArray(e[0])?e[0]:[e]}let I=["dashed","dotted","double","solid","wavy"];function w(e){return I.includes(e)}let P={border:function(...e){return c(e[0])?Object.assign({},a(e[0]),e[1]&&s(e[1]),e[2]&&o(e[2])):Object.assign({},s(e[0]),e[1]&&a(e[1]),e[2]&&o(e[2]))},borderLeft:function(...e){return c(e[0])?Object.assign({borderLeftStyle:e[0]},e[1]&&{borderLeftWidth:e[1]},e[2]&&{borderLeftColor:e[2]}):Object.assign({borderLeftWidth:e[0]},e[1]&&{borderLeftStyle:e[1]},e[2]&&{borderLeftColor:e[2]})},borderBottom:function(...e){return c(e[0])?Object.assign({borderBottomStyle:e[0]},e[1]&&{borderBottomWidth:e[1]},e[2]&&{borderBottomColor:e[2]}):Object.assign({borderBottomWidth:e[0]},e[1]&&{borderBottomStyle:e[1]},e[2]&&{borderBottomColor:e[2]})},borderRight:function(...e){return c(e[0])?Object.assign({borderRightStyle:e[0]},e[1]&&{borderRightWidth:e[1]},e[2]&&{borderRightColor:e[2]}):Object.assign({borderRightWidth:e[0]},e[1]&&{borderRightStyle:e[1]},e[2]&&{borderRightColor:e[2]})},borderTop:function(...e){return c(e[0])?Object.assign({borderTopStyle:e[0]},e[1]&&{borderTopWidth:e[1]},e[2]&&{borderTopColor:e[2]}):Object.assign({borderTopWidth:e[0]},e[1]&&{borderTopStyle:e[1]},e[2]&&{borderTopColor:e[2]})},borderColor:o,borderStyle:a,borderRadius:function(e,t=e,i=e,n=t){return{borderBottomRightRadius:i,borderBottomLeftRadius:n,borderTopRightRadius:t,borderTopLeftRadius:e}},borderWidth:s,flex:function(...e){let t=1===e.length,i=2===e.length,n=3===e.length;if(t){let[t]=e;if(h(t))return{flexGrow:0,flexShrink:1,flexBasis:"auto"};if(g(t))return{flexGrow:1,flexShrink:1,flexBasis:"auto"};if(p(t))return{flexGrow:0,flexShrink:0,flexBasis:"auto"};if(u(t))return{flexGrow:t,flexShrink:1,flexBasis:0};if(m(t))return{flexGrow:1,flexShrink:1,flexBasis:t}}if(i){let[t,i]=e;if(u(i))return{flexGrow:t,flexShrink:i,flexBasis:0};if(m(i))return{flexGrow:t,flexShrink:1,flexBasis:i}}if(n){let[t,i,n]=e;if(u(t)&&u(i)&&(g(n)||m(n)))return{flexGrow:t,flexShrink:i,flexBasis:n}}return{}},gap:function(e,t=e){return{columnGap:e,rowGap:t}},gridArea:function(...e){if(e.some(e=>!S(e)))return{};let t=void 0!==e[0]?e[0]:"auto",i=void 0!==e[1]?e[1]:b(t)?t:"auto",n=void 0!==e[2]?e[2]:b(t)?t:"auto",r=void 0!==e[3]?e[3]:b(i)?i:"auto";return{gridRowStart:t,gridColumnStart:i,gridRowEnd:n,gridColumnEnd:r}},margin:function(...e){return r("margin","",...e)},marginBlock:function(e,t=e){return{marginBlockStart:e,marginBlockEnd:t}},marginInline:function(e,t=e){return{marginInlineStart:e,marginInlineEnd:t}},padding:function(...e){return r("padding","",...e)},paddingBlock:function(e,t=e){return{paddingBlockStart:e,paddingBlockEnd:t}},paddingInline:function(e,t=e){return{paddingInlineStart:e,paddingInlineEnd:t}},overflow:function(e,t=e){return{overflowX:e,overflowY:t}},inset:function(...e){let[t,i=t,n=t,r=i]=e;return{top:t,right:i,bottom:n,left:r}},outline:function(e,t,i){return Object.assign({outlineWidth:e},t&&{outlineStyle:t},i&&{outlineColor:i})},transition:function(...e){return E(e)?{transitionDelay:e[0],transitionDuration:e[0],transitionProperty:e[0],transitionTimingFunction:e[0]}:_(e).reduce((e,[t,i="0s",n="0s",r="ease"],s)=>(0===s?(e.transitionProperty=t,e.transitionDuration=i,e.transitionDelay=n,e.transitionTimingFunction=r):(e.transitionProperty+=`, ${t}`,e.transitionDuration+=`, ${i}`,e.transitionDelay+=`, ${n}`,e.transitionTimingFunction+=`, ${r}`),e),{})},textDecoration:function(e,...t){if(0===t.length)return w(e)?{textDecorationStyle:e}:{textDecorationLine:e};let[i,n,r]=t;return Object.assign({textDecorationLine:e},i&&{textDecorationStyle:i},n&&{textDecorationColor:n},r&&{textDecorationThickness:r})}}},517596:function(e,t,i){"use strict";i.d(t,{F:()=>n});let n=()=>{let e={};return function(t,i){void 0===e[t.id]&&(t.insertCSSRules(i),e[t.id]=!0)}}},805522:function(e,t,i){"use strict";i.d(t,{z:()=>o});var n=i(13044),r=i(189751),s=i(187654);let a={};function o(){let e=null,t="",i="",o=Array(arguments.length);for(let e=0;e<arguments.length;e++){let r=arguments[e];if("string"==typeof r&&""!==r){let s=r.indexOf(n.Qz);if(-1===s)t+=r+" ";else{let a=r.substr(s,n.jD);s>0&&(t+=r.slice(0,s)),i+=a,o[e]=a}}}if(""===i)return t.slice(0,-1);let l=a[i];if(void 0!==l)return t+l;let c=[];for(let t=0;t<arguments.length;t++){let i=o[t];if(i){let t=n.xR[i];t&&(c.push(t[n.JM]),e=t[n.de])}}let d=Object.assign.apply(Object,[{}].concat(c)),[u,h]=(0,s.w)(d,e),g=(0,r.m)(h,e,o),p=g+" "+u;return a[i]=p,n.xR[g]=[d,e],t+p}},815956:function(e,t,i){"use strict";function n(e){return Array.isArray(e)?e:[e]}i.d(t,{u:()=>l});var r=i(609823);function s(e,t){try{e.insertRule(t)}catch(e){}}let a=0,o=(e,t)=>e<t?-1:+(e>t);function l(e="undefined"==typeof document?void 0:document,t={}){let{classNameHashSalt:i,unstable_filterCSSRule:c,insertionPoint:d,styleElementAttributes:u,compareMediaQueries:h=o}=t,g={classNameHashSalt:i,insertionCache:{},stylesheets:{},styleElementAttributes:Object.freeze(u),compareMediaQueries:h,id:`d${a++}`,insertCSSRules(t){for(let i in t){let a=t[i];for(let t=0,o=a.length;t<o;t++){let[o,l]=n(a[t]),u=(0,r.T9)(i,e,d||null,g,l);!g.insertionCache[o]&&(g.insertionCache[o]=i,c?c(o)&&s(u,o):s(u,o))}}}};return g}},601052:function(e,t,i){"use strict";i.d(t,{L:()=>s,T:()=>r});var n=i(13044);function r(e,t,i,r){let s=[];if(r[n.$Q]=t,r[n.n$]=String(i),e)for(let t in r)e.setAttribute(t,r[t]);return{elementAttributes:r,insertRule:function(t){return(null==e?void 0:e.sheet)?e.sheet.insertRule(t,e.sheet.cssRules.length):s.push(t)},element:e,bucketName:t,cssRules:()=>(null==e?void 0:e.sheet)?Array.from(e.sheet.cssRules).map(e=>e.cssText):s}}function s(e){let t=Array.from(e.attributes).reduce((e,t)=>(e[t.name]=t.value,e),{});return r(e,t[n.$Q],Number(t[n.n$]),t)}},609823:function(e,t,i){"use strict";i.d(t,{RM:()=>o,T9:()=>l});var n=i(13044),r=i(601052);let s=["r","d","l","v","w","f","i","h","a","s","k","t","m","c"].reduce((e,t,i)=>(e[t]=i,e),{});function a(e,t,i){return("m"===e?e+t:e)+i}function o(e){var t;let i=e.getAttribute(n.$Q),r=null!=(t=e.getAttribute(n.n$))?t:"0";return a(i,e.media,r)}function l(e,t,i,n,s={}){var o,c;let u="m"===e,h=null!=(o=s.m)?o:"0",g=null!=(c=s.p)?c:0,p=a(e,h,g);if(!n.stylesheets[p]){let a=t&&t.createElement("style"),o=(0,r.T)(a,e,g,Object.assign({},n.styleElementAttributes,u&&{media:h}));n.stylesheets[p]=o,t&&a&&t.head.insertBefore(a,d(t,i,e,n,s))}return n.stylesheets[p]}function c(e,t,i){var r,s;return t+(null!=(r=i.m)?r:"")===e.getAttribute(n.$Q)+(null!=(s=e.media)?s:"")}function d(e,t,i,r,a={}){var o,l;let u=s[i],h=null!=(o=a.m)?o:"",g=null!=(l=a.p)?l:0,p=e=>u-s[e.getAttribute(n.$Q)],f=e.head.querySelectorAll(`[${n.$Q}]`);if("m"===i){let t=e.head.querySelectorAll(`[${n.$Q}="${i}"]`);t.length&&(f=t,p=e=>r.compareMediaQueries(h,e.media))}let m=e=>c(e,i,a)?g-Number(e.getAttribute("data-priority")):p(e),v=f.length,S=v-1;for(;S>=0;){let e=f.item(S);if(m(e)>0)return e.nextSibling;S--}return v>0?f.item(0):t?t.nextSibling:null}},187654:function(e,t,i){"use strict";i.d(t,{V:()=>a,w:()=>s});var n=i(13044),r=i(189751);function s(e,t){let i="",n="";for(let r in e){let s=e[r];if(0===s){n+=r+" ";continue}let a=Array.isArray(s),o="rtl"===t?(a?s[1]:s)+" ":(a?s[0]:s)+" ";i+=o,n+=o}return[i.slice(0,-1),n.slice(0,-1)]}function a(e,t){let i={};for(let a in e){let[o,l]=s(e[a],t);if(""===l){i[a]="";continue}let c=(0,r.m)(l,t),d=c+(""===o?"":" "+o);n.xR[c]=[e[a],t],i[a]=d}return i}},189751:function(e,t,i){"use strict";i.d(t,{m:()=>a});var n=i(104044),r=i(13044);function s(e){let t=e.length;if(t===r.gk)return e;for(let i=t;i<r.gk;i++)e+="0";return e}function a(e,t,i=[]){return r.Qz+s((0,n.Z)(e+t))}},564305:function(e,t,i){"use strict";i.d(t,{a:()=>p,m:()=>g});var n=i(815956),r=i(601052),s=i(609823);let a=/@(media|supports|layer)[^{]+\{([\s\S]+?})\s*}/g,o=/\.([^{:]+)(:[^{]+)?{(?:[^}]*;)?([^}]*?)}/g,l={k:/@(-webkit-)?keyframes ([^{]+){((?:(?:from|to|(?:\d+\.?\d*%))\{(?:[^}])*})*)}/g,t:a,m:a};function c(e,t="undefined"==typeof document?void 0:document){t&&t.querySelectorAll("[data-make-styles-bucket]").forEach(t=>{let i,n=t.dataset.makeStylesBucket,a=(0,s.RM)(t);e.stylesheets[a]||(e.stylesheets[a]=(0,r.L)(t));let c=l[n]||o;for(;i=c.exec(t.textContent);){let[t]=i;e.insertionCache[t]=n}})}var d=i(632735),u=i(493792);let h=d.createContext((0,n.u)()),g=({children:e,renderer:t,targetDocument:i})=>(d.useMemo(()=>{(0,u.N)()&&c(t,i)},[t,i]),d.createElement(h.Provider,{value:t},e));function p(){return d.useContext(h)}},334659:function(e,t,i){"use strict";i.d(t,{n:()=>s,s:()=>a});var n=i(632735);let r=n.createContext("ltr"),s=({children:e,dir:t})=>n.createElement(r.Provider,{value:t},e);function a(){return n.useContext(r)}},671746:function(e,t,i){"use strict";i.d(t,{U:()=>l});var n=i(517596);function r(e,t,i,s=n.F){let a=s();return function(n){let{dir:r,renderer:s}=n,o="ltr"===r?e:t||e;return a(s,Array.isArray(i)?{r:i}:i),o}}var s=i(517783),a=i(564305),o=i(334659);function l(e,t,i){let n=r(e,t,i,s.F);return function(){return n({dir:(0,o.s)(),renderer:(0,a.a)()})}}},29658:function(e,t,i){"use strict";i.d(t,{s:()=>o});var n=i(424969),r=i(517783),s=i(564305),a=i(334659);function o(e,t){let i=(0,n.s)(e,t,r.F);return function(){return i({dir:(0,a.s)(),renderer:(0,s.a)()})}}},517783:function(e,t,i){"use strict";i.d(t,{F:()=>o});var n=i(493792),r=i(632735),s=i.t(r,2);let a=s.useInsertionEffect?s.useInsertionEffect:void 0,o=()=>{let e={};return function(t,i){if(a&&(0,n.N)())return void a(()=>{t.insertCSSRules(i)},[t,i]);void 0===e[t.id]&&(t.insertCSSRules(i),e[t.id]=!0)}}},493792:function(e,t,i){"use strict";function n(){return"undefined"!=typeof window&&!!(window.document&&window.document.createElement)}i.d(t,{N:()=>n})},395057:function(e,t,i){"use strict";i.d(t,{kpA:()=>eh,wdi:()=>b,w41:()=>ed,Woc:()=>ei,agS:()=>A,kb6:()=>ep,mRm:()=>X,N7s:()=>ee,UEO:()=>eo,goi:()=>ev,jCs:()=>K,OCG:()=>ea,VNr:()=>ey,D9J:()=>eS,cZu:()=>eC,ndN:()=>ef,Avx:()=>es,v$0:()=>en,D8M:()=>el,B23:()=>et,L8d:()=>eg,Tjj:()=>eu,IfY:()=>Z,au1:()=>Q});var n,r,s=i(625242),a=i(780902);class o{constructor(e,t,i){this.h=e,this.s=t,this.l=i}static fromObject(e){return!e||isNaN(e.h)||isNaN(e.s)||isNaN(e.l)?null:new o(e.h,e.s,e.l)}equalValue(e){return this.h===e.h&&this.s===e.s&&this.l===e.l}roundToPrecision(e){return new o((0,a.fZ)(this.h,e),(0,a.fZ)(this.s,e),(0,a.fZ)(this.l,e))}toObject(){return{h:this.h,s:this.s,l:this.l}}}class l{constructor(e,t,i){this.l=e,this.a=t,this.b=i}static fromObject(e){return!e||isNaN(e.l)||isNaN(e.a)||isNaN(e.b)?null:new l(e.l,e.a,e.b)}equalValue(e){return this.l===e.l&&this.a===e.a&&this.b===e.b}roundToPrecision(e){return new l((0,a.fZ)(this.l,e),(0,a.fZ)(this.a,e),(0,a.fZ)(this.b,e))}toObject(){return{l:this.l,a:this.a,b:this.b}}}l.epsilon=216/24389,l.kappa=24389/27;class c{constructor(e,t,i){this.x=e,this.y=t,this.z=i}static fromObject(e){return!e||isNaN(e.x)||isNaN(e.y)||isNaN(e.z)?null:new c(e.x,e.y,e.z)}equalValue(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}roundToPrecision(e){return new c((0,a.fZ)(this.x,e),(0,a.fZ)(this.y,e),(0,a.fZ)(this.z,e))}toObject(){return{x:this.x,y:this.y,z:this.z}}}function d(e){return .2126*e.r+.7152*e.g+.0722*e.b}function u(e){function t(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}return d(new s.h(t(e.r),t(e.g),t(e.b),1))}function h(e){let t=Math.max(e.r,e.g,e.b),i=Math.min(e.r,e.g,e.b),n=t-i,r=0;0!==n&&(r=t===e.r?60*((e.g-e.b)/n%6):t===e.g?60*((e.b-e.r)/n+2):60*((e.r-e.g)/n+4)),r<0&&(r+=360);let s=(t+i)/2,a=0;return 0!==n&&(a=n/(1-Math.abs(2*s-1))),new o(r,a,s)}function g(e,t=1){let i=(1-Math.abs(2*e.l-1))*e.s,n=i*(1-Math.abs(e.h/60%2-1)),r=e.l-i/2,a=0,o=0,l=0;return e.h<60?(a=i,o=n,l=0):e.h<120?(a=n,o=i,l=0):e.h<180?(a=0,o=i,l=n):e.h<240?(a=0,o=n,l=i):e.h<300?(a=n,o=0,l=i):e.h<360&&(a=i,o=0,l=n),new s.h(a+r,o+r,l+r,t)}function p(e){let t=(e.l+16)/116,i=t+e.a/500,n=t-e.b/200,r=Math.pow(i,3),s=Math.pow(t,3),a=Math.pow(n,3),o=0;o=r>l.epsilon?r:(116*i-16)/l.kappa;let d=0;d=e.l>l.epsilon*l.kappa?s:e.l/l.kappa;let u=0;return u=a>l.epsilon?a:(116*n-16)/l.kappa,o=c.whitePoint.x*o,d=c.whitePoint.y*d,u=c.whitePoint.z*u,new c(o,d,u)}function f(e){function t(e){return e>l.epsilon?Math.pow(e,1/3):(l.kappa*e+16)/116}let i=t(e.x/c.whitePoint.x),n=t(e.y/c.whitePoint.y);return new l(116*n-16,500*(i-n),200*(n-t(e.z/c.whitePoint.z)))}function m(e){function t(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}let i=t(e.r),n=t(e.g),r=t(e.b);return new c(.4124564*i+.3575761*n+.1804375*r,.2126729*i+.7151522*n+.072175*r,.0193339*i+.119192*n+.9503041*r)}function v(e,t=1){function i(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}let n=i(3.2404542*e.x-1.5371385*e.y-.4985314*e.z),r=i(-.969266*e.x+1.8760108*e.y+.041556*e.z),a=i(.0556434*e.x-.2040259*e.y+1.0572252*e.z);return new s.h(n,r,a,t)}function S(e){return f(m(e))}function y(e,t=1){return v(p(e),t)}function C(e,t){let i=e.relativeLuminance>t.relativeLuminance?e:t,n=e.relativeLuminance>t.relativeLuminance?t:e;return(i.relativeLuminance+.05)/(n.relativeLuminance+.05)}c.whitePoint=new c(.95047,1,1.08883);class b{constructor(e,t,i){this.contrast=C.bind(null,this),this.createCSS=this.toColorString,this.r=e,this.g=t,this.b=i,this.color=new s.h(e,t,i),this.relativeLuminance=u(this.color)}toColorString(){return this.color.toStringHexRGB()}static from(e){return new b(e.r,e.g,e.b)}}let T=new b(1,1,1),E=new b(0,0,0);function _(e,t,i){let n=i?E:T,r=i?T:E;return e.contrast(n)>=t?n:r}function I(e,t,i,n,r,s){let a=e=>_(e,r,s),o=a(e),l=a(t),c=o.relativeLuminance===l.relativeLuminance?o:a(i);return{rest:o,hover:l,active:c,focus:a(n)}}function w(e,t,i=0,n=e.length-1){if(n===i)return e[i];let r=Math.floor((n-i)/2)+i;return t(e[r])?w(e,t,i,r):w(e,t,r+1,n)}let P=(-.1+Math.sqrt(.21))/2;function R(e){return e.relativeLuminance<=P}function A(e){return R(e)?M.lighter:M.darker}let M=Object.freeze({darker:1,lighter:-1});function D(e){return"function"==typeof e?e():e}class O{constructor(e,t){this.closestIndexCache=new Map,this.source=e,this.swatches=t,this.reversedSwatches=Object.freeze([...this.swatches].reverse()),this.lastIndex=this.swatches.length-1}colorContrast(e,t,i,n=A(e)){void 0===i&&(i=this.closestIndexOf(e));let r=this.swatches,s=this.lastIndex,a=i,o=i=>C(e,i)>=t;return n===M.lighter&&(r=this.reversedSwatches,a=s-a),w(r,o,a,s)}delta(e,t,i){let n=D(i);return this.get(this.closestIndexOf(e)+n*t)}closestIndexOf(e){if(this.closestIndexCache.has(e.relativeLuminance))return this.closestIndexCache.get(e.relativeLuminance);let t=this.swatches.indexOf(e);if(-1!==t)return this.closestIndexCache.set(e.relativeLuminance,t),t;let i=this.swatches.reduce((t,i)=>Math.abs(i.relativeLuminance-e.relativeLuminance)<Math.abs(t.relativeLuminance-e.relativeLuminance)?i:t);return t=this.swatches.indexOf(i),this.closestIndexCache.set(e.relativeLuminance,t),t}get(e){return this.swatches[e]||this.swatches[(0,a.uZ)(e,0,this.lastIndex)]}}function k(e,t,i,n,r,s,a,o=A(t)){let l,c,d=D(o),u=e.colorContrast(t,i),h=e.closestIndexOf(u),g=h+d*Math.abs(n-r);return(d===M.darker?n<r:d*n>d*r)?(l=h,c=g):(l=g,c=h),{rest:e.get(l),hover:e.get(c),active:e.get(l+d*s),focus:e.get(l+d*a)}}function N(e,t,i,n=A(t)){return e.colorContrast(t,i,void 0,n)}function x(e,t,i,n,r,s,a=A(t)){let o=e.closestIndexOf(t),l=D(a);return{rest:e.get(o+l*i),hover:e.get(o+l*n),active:e.get(o+l*r),focus:e.get(o+l*s)}}function L(e,t,i,n=A(t)){return e.delta(t,i,n)}function F(e,t,i){return isNaN(e)||e<=0?t:e>=1?i:new s.h((0,a.t7)(e,t.r,i.r),(0,a.t7)(e,t.g,i.g),(0,a.t7)(e,t.b,i.b),(0,a.t7)(e,t.a,i.a))}!function(e){e[e.RGB=0]="RGB",e[e.HSL=1]="HSL",e[e.HSV=2]="HSV",e[e.XYZ=3]="XYZ",e[e.LAB=4]="LAB",e[e.LCH=5]="LCH"}(n||(n={}));class U extends O{static saturationBump(e,t){let i=h(e).s,n=h(t);return n.s<i?g(new o(n.h,i,n.l)):t}static ramp(e){let t=e/100;return t>.5?(t-.5)/.5:2*t}static from(e){let t=[],i=S(s.h.fromObject(e).roundToPrecision(4)),n=y(new l(0,i.a,i.b)).clamp().roundToPrecision(4),r=y(new l(50,i.a,i.b)).clamp().roundToPrecision(4),a=y(new l(100,i.a,i.b)).clamp().roundToPrecision(4),o=new s.h(0,0,0),c=new s.h(1,1,1),d=14*!a.equalValue(c),u=14*!n.equalValue(o);for(let e=100+d;e>=0-u;e-=.5){let i;i=e<0?F(e/u+1,o,n):e<=50?F(U.ramp(e),n,r):e<=100?F(U.ramp(e),r,a):F((e-100)/d,a,c),i=U.saturationBump(r,i).roundToPrecision(4),t.push(b.from(i))}return new U(e,t)}}let $={stepContrast:1.05,stepContrastRamp:0,preserveSource:!1};class V extends O{static adjustEnd(e,t,i,n){let r=-1===n?t.swatches:t.reversedSwatches,s=e=>{let i=t.closestIndexOf(e);return 1===n?t.lastIndex-i:i};1===n&&i.reverse();let o=e(i[i.length-2]);if((0,a.fZ)(C(i[i.length-1],i[i.length-2]),2)<o){i.pop();let e=s(t.colorContrast(r[t.lastIndex],o,void 0,n))-s(i[i.length-2]),a=1;for(let n=i.length-e-1;n<i.length;n++){let e=s(i[n]),o=n===i.length-1?t.lastIndex:e+a;i[n]=r[o],a++}}1===n&&i.reverse()}static createColorPaletteByContrast(e,t){let i=U.from(e),n=e=>{let i=t.stepContrast+t.stepContrast*(1-e.relativeLuminance)*t.stepContrastRamp;return(0,a.fZ)(i,2)},r=[],s=t.preserveSource?e:i.swatches[0];r.push(s);do{let e=n(s);s=i.colorContrast(s,e,void 0,1),r.push(s)}while(s.relativeLuminance>0);if(t.preserveSource){s=e;do{let e=n(s);s=i.colorContrast(s,e,void 0,-1),r.unshift(s)}while(s.relativeLuminance<1)}return this.adjustEnd(n,i,r,-1),t.preserveSource&&this.adjustEnd(n,i,r,1),r}static from(e,t){let i=void 0===t?$:Object.assign(Object.assign({},$),t);return new V(e,Object.freeze(V.createColorPaletteByContrast(e,i)))}}var B=i(656971);let{create:H}=B.L;function j(e){return B.L.create({name:e,cssCustomPropertyName:null})}H("design-unit").withDefault(4),H("control-corner-radius").withDefault(4),H("layer-corner-radius").withDefault(8),H("stroke-width").withDefault(1),H("focus-stroke-width").withDefault(2);var q=i(689193);let W=H("neutral-base-color").withDefault("#808080"),G=j("neutral-base-swatch").withDefault(e=>b.from((0,q.in)(W.getValueFor(e)))),z=j("neutral-palette").withDefault(e=>V.from(G.getValueFor(e))),J=H("accent-base-color").withDefault("#0078D4"),K=j("accent-base-swatch").withDefault(e=>b.from((0,q.in)(J.getValueFor(e)))),Q=j("accent-palette").withDefault(e=>V.from(K.getValueFor(e))),Y=Object.freeze({NormalText:4.5,LargeText:3}),Z=H("fill-color").withDefault(b.from((0,q.in)("#FFFFFF"))),X=j("accent-fill-min-contrast").withDefault(5.5),ee=j("accent-fill-rest-delta").withDefault(0),et=j("accent-fill-hover-delta").withDefault(-2),ei=j("accent-fill-active-delta").withDefault(-5),en=j("accent-fill-focus-delta").withDefault(0),er=j("accent-fill-recipe").withDefault({evaluate:(e,t)=>k(Q.getValueFor(e),t||Z.getValueFor(e),X.getValueFor(e),ee.getValueFor(e),et.getValueFor(e),ei.getValueFor(e),en.getValueFor(e))}),es=H("accent-fill-rest").withDefault(e=>er.getValueFor(e).evaluate(e).rest),ea=H("accent-fill-hover").withDefault(e=>er.getValueFor(e).evaluate(e).hover),eo=H("accent-fill-active").withDefault(e=>er.getValueFor(e).evaluate(e).active),el=H("accent-fill-focus").withDefault(e=>er.getValueFor(e).evaluate(e).focus),ec=j("foreground-on-accent-recipe").withDefault({evaluate:e=>I(es.getValueFor(e),ea.getValueFor(e),eo.getValueFor(e),el.getValueFor(e),Y.NormalText,!1)}),ed=H("foreground-on-accent-rest").withDefault(e=>ec.getValueFor(e).evaluate(e).rest);H("foreground-on-accent-hover").withDefault(e=>ec.getValueFor(e).evaluate(e).hover),H("foreground-on-accent-active").withDefault(e=>ec.getValueFor(e).evaluate(e).active),H("foreground-on-accent-focus").withDefault(e=>ec.getValueFor(e).evaluate(e).focus);let eu=j("accent-foreground-min-contrast").withDefault(Y.NormalText),eh=j("accent-foreground-rest-delta").withDefault(0),eg=j("accent-foreground-hover-delta").withDefault(3),ep=j("accent-foreground-active-delta").withDefault(-8),ef=j("accent-foreground-focus-delta").withDefault(0),em=j("accent-foreground-recipe").withDefault({evaluate:(e,t)=>k(Q.getValueFor(e),t||Z.getValueFor(e),eu.getValueFor(e),eh.getValueFor(e),eg.getValueFor(e),ep.getValueFor(e),ef.getValueFor(e))}),ev=H("accent-foreground-rest").withDefault(e=>em.getValueFor(e).evaluate(e).rest),eS=H("accent-foreground-hover").withDefault(e=>em.getValueFor(e).evaluate(e).hover),ey=H("accent-foreground-active").withDefault(e=>em.getValueFor(e).evaluate(e).active),eC=H("accent-foreground-focus").withDefault(e=>em.getValueFor(e).evaluate(e).focus),eb=j("neutral-foreground-min-contrast").withDefault(16),eT=j("neutral-foreground-rest-delta").withDefault(0),eE=j("neutral-foreground-hover-delta").withDefault(-19),e_=j("neutral-foreground-active-delta").withDefault(-30),eI=j("neutral-foreground-focus-delta").withDefault(0),ew=j("neutral-foreground-recipe").withDefault({evaluate:(e,t)=>k(z.getValueFor(e),t||Z.getValueFor(e),eb.getValueFor(e),eT.getValueFor(e),eE.getValueFor(e),e_.getValueFor(e),eI.getValueFor(e))});H("neutral-foreground-rest").withDefault(e=>ew.getValueFor(e).evaluate(e).rest),H("neutral-foreground-hover").withDefault(e=>ew.getValueFor(e).evaluate(e).hover),H("neutral-foreground-active").withDefault(e=>ew.getValueFor(e).evaluate(e).active),H("neutral-foreground-focus").withDefault(e=>ew.getValueFor(e).evaluate(e).focus);let eP=j("neutral-foreground-hint-recipe").withDefault({evaluate:(e,t)=>N(z.getValueFor(e),t||Z.getValueFor(e),Y.NormalText)});H("neutral-foreground-hint").withDefault(e=>eP.getValueFor(e).evaluate(e));let eR=j("neutral-fill-rest-delta").withDefault(-1),eA=j("neutral-fill-hover-delta").withDefault(1),eM=j("neutral-fill-active-delta").withDefault(0),eD=j("neutral-fill-focus-delta").withDefault(0),eO=j("neutral-fill-recipe").withDefault({evaluate:(e,t)=>x(z.getValueFor(e),t||Z.getValueFor(e),eR.getValueFor(e),eA.getValueFor(e),eM.getValueFor(e),eD.getValueFor(e))});H("neutral-fill-rest").withDefault(e=>eO.getValueFor(e).evaluate(e).rest),H("neutral-fill-hover").withDefault(e=>eO.getValueFor(e).evaluate(e).hover),H("neutral-fill-active").withDefault(e=>eO.getValueFor(e).evaluate(e).active),H("neutral-fill-focus").withDefault(e=>eO.getValueFor(e).evaluate(e).focus);let ek=j("neutral-fill-input-rest-delta").withDefault(-1),eN=j("neutral-fill-input-hover-delta").withDefault(1),ex=j("neutral-fill-input-active-delta").withDefault(0),eL=j("neutral-fill-input-focus-delta").withDefault(-2),eF=j("neutral-fill-input-recipe").withDefault({evaluate:(e,t)=>x(z.getValueFor(e),t||Z.getValueFor(e),ek.getValueFor(e),eN.getValueFor(e),ex.getValueFor(e),eL.getValueFor(e))});H("neutral-fill-input-rest").withDefault(e=>eF.getValueFor(e).evaluate(e).rest),H("neutral-fill-input-hover").withDefault(e=>eF.getValueFor(e).evaluate(e).hover),H("neutral-fill-input-active").withDefault(e=>eF.getValueFor(e).evaluate(e).active),H("neutral-fill-input-focus").withDefault(e=>eF.getValueFor(e).evaluate(e).focus);let eU=j("neutral-fill-secondary-rest-delta").withDefault(3),e$=j("neutral-fill-secondary-hover-delta").withDefault(2),eV=j("neutral-fill-secondary-active-delta").withDefault(1),eB=j("neutral-fill-secondary-focus-delta").withDefault(3),eH=j("neutral-fill-secondary-recipe").withDefault({evaluate:(e,t)=>x(z.getValueFor(e),t||Z.getValueFor(e),eU.getValueFor(e),e$.getValueFor(e),eV.getValueFor(e),eB.getValueFor(e))});H("neutral-fill-secondary-rest").withDefault(e=>eH.getValueFor(e).evaluate(e).rest),H("neutral-fill-secondary-hover").withDefault(e=>eH.getValueFor(e).evaluate(e).hover),H("neutral-fill-secondary-active").withDefault(e=>eH.getValueFor(e).evaluate(e).active),H("neutral-fill-secondary-focus").withDefault(e=>eH.getValueFor(e).evaluate(e).focus);let ej=j("neutral-fill-stealth-rest-delta").withDefault(0),eq=j("neutral-fill-stealth-hover-delta").withDefault(3),eW=j("neutral-fill-stealth-active-delta").withDefault(2),eG=j("neutral-fill-stealth-focus-delta").withDefault(0),ez=j("neutral-fill-stealth-recipe").withDefault({evaluate:(e,t)=>x(z.getValueFor(e),t||Z.getValueFor(e),ej.getValueFor(e),eq.getValueFor(e),eW.getValueFor(e),eG.getValueFor(e))});H("neutral-fill-stealth-rest").withDefault(e=>ez.getValueFor(e).evaluate(e).rest),H("neutral-fill-stealth-hover").withDefault(e=>ez.getValueFor(e).evaluate(e).hover),H("neutral-fill-stealth-active").withDefault(e=>ez.getValueFor(e).evaluate(e).active),H("neutral-fill-stealth-focus").withDefault(e=>ez.getValueFor(e).evaluate(e).focus);let eJ=j("neutral-fill-strong-min-contrast").withDefault(3),eK=j("neutral-fill-strong-rest-delta").withDefault(0),eQ=j("neutral-fill-strong-hover-delta").withDefault(8),eY=j("neutral-fill-strong-active-delta").withDefault(-5),eZ=j("neutral-fill-strong-focus-delta").withDefault(0),eX=j("neutral-fill-strong-recipe").withDefault({evaluate:(e,t)=>k(z.getValueFor(e),t||Z.getValueFor(e),eJ.getValueFor(e),eK.getValueFor(e),eQ.getValueFor(e),eY.getValueFor(e),eZ.getValueFor(e))});H("neutral-fill-strong-rest").withDefault(e=>eX.getValueFor(e).evaluate(e).rest),H("neutral-fill-strong-hover").withDefault(e=>eX.getValueFor(e).evaluate(e).hover),H("neutral-fill-strong-active").withDefault(e=>eX.getValueFor(e).evaluate(e).active),H("neutral-fill-strong-focus").withDefault(e=>eX.getValueFor(e).evaluate(e).focus);let e0=j("neutral-stroke-rest-delta").withDefault(8),e1=j("neutral-stroke-hover-delta").withDefault(12),e2=j("neutral-stroke-active-delta").withDefault(6),e3=j("neutral-stroke-focus-delta").withDefault(8),e4=j("neutral-stroke-recipe").withDefault({evaluate:(e,t)=>x(z.getValueFor(e),t||Z.getValueFor(e),e0.getValueFor(e),e1.getValueFor(e),e2.getValueFor(e),e3.getValueFor(e))});H("neutral-stroke-rest").withDefault(e=>e4.getValueFor(e).evaluate(e).rest),H("neutral-stroke-hover").withDefault(e=>e4.getValueFor(e).evaluate(e).hover),H("neutral-stroke-active").withDefault(e=>e4.getValueFor(e).evaluate(e).active),H("neutral-stroke-focus").withDefault(e=>e4.getValueFor(e).evaluate(e).focus);let e5=j("neutral-stroke-divider-rest-delta").withDefault(4),e6=j("neutral-stroke-divider-recipe").withDefault({evaluate:(e,t)=>L(z.getValueFor(e),t||Z.getValueFor(e),e5.getValueFor(e))});H("neutral-stroke-divider-rest").withDefault(e=>e6.getValueFor(e).evaluate(e));let e8=j("neutral-stroke-input-rest-delta").withDefault(3),e9=j("neutral-stroke-input-hover-delta").withDefault(5),e7=j("neutral-stroke-input-active-delta").withDefault(5),te=j("neutral-stroke-input-focus-delta").withDefault(5),tt=j("neutral-stroke-input-recipe").withDefault({evaluate:(e,t)=>x(z.getValueFor(e),t||Z.getValueFor(e),e8.getValueFor(e),e9.getValueFor(e),e7.getValueFor(e),te.getValueFor(e))});H("neutral-stroke-input-rest").withDefault(e=>tt.getValueFor(e).evaluate(e).rest),H("neutral-stroke-input-hover").withDefault(e=>tt.getValueFor(e).evaluate(e).hover),H("neutral-stroke-input-active").withDefault(e=>tt.getValueFor(e).evaluate(e).active),H("neutral-stroke-input-focus").withDefault(e=>tt.getValueFor(e).evaluate(e).focus);let ti=j("neutral-stroke-strong-min-contrast").withDefault(5.5),tn=j("neutral-stroke-strong-rest-delta").withDefault(0),tr=j("neutral-stroke-strong-hover-delta").withDefault(0),ts=j("neutral-stroke-strong-active-delta").withDefault(0),ta=j("neutral-stroke-strong-focus-delta").withDefault(0),to=j("neutral-stroke-strong-recipe").withDefault({evaluate:(e,t)=>k(z.getValueFor(e),t||Z.getValueFor(e),ti.getValueFor(e),tn.getValueFor(e),tr.getValueFor(e),ts.getValueFor(e),ta.getValueFor(e))});H("neutral-stroke-strong-rest").withDefault(e=>to.getValueFor(e).evaluate(e).rest),H("neutral-stroke-strong-hover").withDefault(e=>to.getValueFor(e).evaluate(e).hover),H("neutral-stroke-strong-active").withDefault(e=>to.getValueFor(e).evaluate(e).active),H("neutral-stroke-strong-focus").withDefault(e=>to.getValueFor(e).evaluate(e).focus);let tl=j("focus-stroke-outer-recipe").withDefault({evaluate:e=>_(Z.getValueFor(e),Y.NormalText,!0)}),tc=H("focus-stroke-outer").withDefault(e=>tl.getValueFor(e).evaluate(e)),td=j("focus-stroke-inner-recipe").withDefault({evaluate:e=>_(tc.getValueFor(e),Y.NormalText,!1)});H("focus-stroke-inner").withDefault(e=>td.getValueFor(e).evaluate(e));let tu=j("elevation-recipe").withDefault({evaluate:(e,t)=>{let i=.12,n=.14;t>16&&(i=.2,n=.24);let r=`0 0 2px rgba(0, 0, 0, ${i})`,s=`0 calc(${t} * 0.5px) calc((${t} * 1px)) rgba(0, 0, 0, ${n})`;return`${r}, ${s}`}}),th=j("elevation-card-rest-size").withDefault(4),tg=j("elevation-card-hover-size").withDefault(8),tp=j("elevation-card-active-size").withDefault(2),tf=j("elevation-card-focus-size").withDefault(4);H("elevation-card-rest").withDefault(e=>tu.getValueFor(e).evaluate(e,th.getValueFor(e))),H("elevation-card-hover").withDefault(e=>tu.getValueFor(e).evaluate(e,tg.getValueFor(e))),H("elevation-card-active").withDefault(e=>tu.getValueFor(e).evaluate(e,tp.getValueFor(e))),H("elevation-card-focus").withDefault(e=>tu.getValueFor(e).evaluate(e,tf.getValueFor(e)));let tm=j("elevation-tooltip-size").withDefault(16);H("elevation-tooltip").withDefault(e=>tu.getValueFor(e).evaluate(e,tm.getValueFor(e)));let tv=j("elevation-flyout-size").withDefault(32);H("elevation-flyout").withDefault(e=>tu.getValueFor(e).evaluate(e,tv.getValueFor(e)));let tS=j("elevation-dialog-size").withDefault(128);H("elevation-dialog").withDefault(e=>tu.getValueFor(e).evaluate(e,tS.getValueFor(e))),function(e){e.ltr="ltr",e.rtl="rtl"}(r||(r={})),H("direction").withDefault(r.ltr);let ty=400,tC=H("body-font").withDefault('"Segoe UI Variable", "Segoe UI", sans-serif'),tb=H("font-weight").withDefault(ty);function tT(e){return t=>{let i=e.getValueFor(t),n=tb.getValueFor(t);if(i.endsWith("px")){let e=Number.parseFloat(i.replace("px",""));if(e<=12)return`"wght" ${n}, "opsz" 8`;if(e>24)return`"wght" ${n}, "opsz" 36`}return`"wght" ${n}, "opsz" 10.5`}}let tE=H("type-ramp-base-font-size").withDefault("14px"),t_=H("type-ramp-base-line-height").withDefault("20px"),tI=H("type-ramp-base-font-variations").withDefault(tT(tE)),tw=H("type-ramp-minus-1-font-size").withDefault("12px"),tP=H("type-ramp-minus-1-line-height").withDefault("16px"),tR=H("type-ramp-minus-1-font-variations").withDefault(tT(tw)),tA=H("type-ramp-minus-2-font-size").withDefault("10px"),tM=H("type-ramp-minus-2-line-height").withDefault("14px"),tD=H("type-ramp-minus-2-font-variations").withDefault(tT(tA)),tO=H("type-ramp-plus-1-font-size").withDefault("16px"),tk=H("type-ramp-plus-1-line-height").withDefault("22px"),tN=H("type-ramp-plus-1-font-variations").withDefault(tT(tO)),tx=H("type-ramp-plus-2-font-size").withDefault("20px"),tL=H("type-ramp-plus-2-line-height").withDefault("26px"),tF=H("type-ramp-plus-2-font-variations").withDefault(tT(tx)),tU=H("type-ramp-plus-3-font-size").withDefault("24px"),t$=H("type-ramp-plus-3-line-height").withDefault("32px"),tV=H("type-ramp-plus-3-font-variations").withDefault(tT(tU)),tB=H("type-ramp-plus-4-font-size").withDefault("28px"),tH=H("type-ramp-plus-4-line-height").withDefault("36px"),tj=H("type-ramp-plus-4-font-variations").withDefault(tT(tB)),tq=H("type-ramp-plus-5-font-size").withDefault("32px"),tW=H("type-ramp-plus-5-line-height").withDefault("40px"),tG=H("type-ramp-plus-5-font-variations").withDefault(tT(tq)),tz=H("type-ramp-plus-6-font-size").withDefault("40px"),tJ=H("type-ramp-plus-6-line-height").withDefault("52px"),tK=H("type-ramp-plus-6-font-variations").withDefault(tT(tz));var tQ=i(144015);let tY=(0,i(155717).LI)(),tZ=Object.freeze({getForInstance:tY.getForInstance,getByType:tY.getByType,define:e=>(tY.register({type:e}),e)});var tX=i(44497);function t0(e,t){let i=[],n="",r=[],s=e=>{r.push(e)};for(let r=0,a=e.length-1;r<a;++r){n+=e[r];let a=t[r];void 0!==tZ.getForInstance(a)&&(a=a.createCSS(s)),a instanceof tX.X||a instanceof CSSStyleSheet?(""!==n.trim()&&(i.push(n),n=""),i.push(a)):n+=a}return""!==(n+=e[e.length-1]).trim()&&i.push(n),{styles:i,behaviors:r}}let t1=(e,...t)=>{let{styles:i,behaviors:n}=t0(e,t),r=new tX.X(i);return n.length?r.withBehaviors(...n):r};class t2{constructor(e,t){this.behaviors=t,this.css="";let i=e.reduce((e,t)=>((0,tQ.H)(t)?this.css+=t:e.push(t),e),[]);i.length&&(this.styles=new tX.X(i))}createCSS(e){return this.behaviors.forEach(e),this.styles&&e(this),this.css}bind(e){e.$fastController.addStyles(this.styles)}unbind(e){e.$fastController.removeStyles(this.styles)}}tZ.define(t2),t1.partial=(e,...t)=>{let{styles:i,behaviors:n}=t0(e,t);return new t2(i,n)},t1.partial,t1.partial`
    font-family: ${tC};
    font-size: ${tE};
    line-height: ${t_};
    font-weight: initial;
    font-variation-settings: ${tI};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tw};
    line-height: ${tP};
    font-weight: initial;
    font-variation-settings: ${tR};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tA};
    line-height: ${tM};
    font-weight: initial;
    font-variation-settings: ${tD};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tO};
    line-height: ${tk};
    font-weight: initial;
    font-variation-settings: ${tN};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tx};
    line-height: ${tL};
    font-weight: initial;
    font-variation-settings: ${tF};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tU};
    line-height: ${t$};
    font-weight: initial;
    font-variation-settings: ${tV};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tB};
    line-height: ${tH};
    font-weight: initial;
    font-variation-settings: ${tj};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tq};
    line-height: ${tW};
    font-weight: initial;
    font-variation-settings: ${tG};
`,t1.partial`
    font-family: ${tC};
    font-size: ${tz};
    line-height: ${tJ};
    font-weight: initial;
    font-variation-settings: ${tK};
`},625242:function(e,t,i){"use strict";i.d(t,{h:()=>r});var n=i(780902);class r{constructor(e,t,i,n){this.r=e,this.g=t,this.b=i,this.a="number"!=typeof n||isNaN(n)?1:n}static fromObject(e){return!e||isNaN(e.r)||isNaN(e.g)||isNaN(e.b)?null:new r(e.r,e.g,e.b,e.a)}equalValue(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}toStringHexRGB(){return"#"+[this.r,this.g,this.b].map(this.formatHexValue).join("")}toStringHexRGBA(){return this.toStringHexRGB()+this.formatHexValue(this.a)}toStringHexARGB(){return"#"+[this.a,this.r,this.g,this.b].map(this.formatHexValue).join("")}toStringWebRGB(){return`rgb(${Math.round((0,n.cY)(this.r,0,255))},${Math.round((0,n.cY)(this.g,0,255))},${Math.round((0,n.cY)(this.b,0,255))})`}toStringWebRGBA(){return`rgba(${Math.round((0,n.cY)(this.r,0,255))},${Math.round((0,n.cY)(this.g,0,255))},${Math.round((0,n.cY)(this.b,0,255))},${(0,n.uZ)(this.a,0,1)})`}roundToPrecision(e){return new r((0,n.fZ)(this.r,e),(0,n.fZ)(this.g,e),(0,n.fZ)(this.b,e),(0,n.fZ)(this.a,e))}clamp(){return new r((0,n.uZ)(this.r,0,1),(0,n.uZ)(this.g,0,1),(0,n.uZ)(this.b,0,1),(0,n.uZ)(this.a,0,1))}toObject(){return{r:this.r,g:this.g,b:this.b,a:this.a}}formatHexValue(e){return(0,n.yi)((0,n.cY)(e,0,255))}}},780902:function(e,t,i){"use strict";function n(e,t,i){return isNaN(e)||e<=t?t:e>=i?i:e}function r(e,t,i){return isNaN(e)||e<=t?0:e>=i?1:e/(i-t)}function s(e,t,i){return isNaN(e)?t:t+e*(i-t)}function a(e){let t=Math.round(n(e,0,255)).toString(16);return 1===t.length?"0"+t:t}function o(e,t,i){return isNaN(e)||e<=0?t:e>=1?i:t+e*(i-t)}function l(e,t){let i=Math.pow(10,t);return Math.round(e*i)/i}i.d(t,{Fv:()=>r,cY:()=>s,fZ:()=>l,t7:()=>o,uZ:()=>n,yi:()=>a})},689193:function(e,t,i){"use strict";i.d(t,{pJ:()=>d,in:()=>m,lu:()=>b});var n=i(625242),r=i(780902);let s={aliceblue:{r:.941176,g:.972549,b:1},antiquewhite:{r:.980392,g:.921569,b:.843137},aqua:{r:0,g:1,b:1},aquamarine:{r:.498039,g:1,b:.831373},azure:{r:.941176,g:1,b:1},beige:{r:.960784,g:.960784,b:.862745},bisque:{r:1,g:.894118,b:.768627},black:{r:0,g:0,b:0},blanchedalmond:{r:1,g:.921569,b:.803922},blue:{r:0,g:0,b:1},blueviolet:{r:.541176,g:.168627,b:.886275},brown:{r:.647059,g:.164706,b:.164706},burlywood:{r:.870588,g:.721569,b:.529412},cadetblue:{r:.372549,g:.619608,b:.627451},chartreuse:{r:.498039,g:1,b:0},chocolate:{r:.823529,g:.411765,b:.117647},coral:{r:1,g:.498039,b:.313725},cornflowerblue:{r:.392157,g:.584314,b:.929412},cornsilk:{r:1,g:.972549,b:.862745},crimson:{r:.862745,g:.078431,b:.235294},cyan:{r:0,g:1,b:1},darkblue:{r:0,g:0,b:.545098},darkcyan:{r:0,g:.545098,b:.545098},darkgoldenrod:{r:.721569,g:.52549,b:.043137},darkgray:{r:.662745,g:.662745,b:.662745},darkgreen:{r:0,g:.392157,b:0},darkgrey:{r:.662745,g:.662745,b:.662745},darkkhaki:{r:.741176,g:.717647,b:.419608},darkmagenta:{r:.545098,g:0,b:.545098},darkolivegreen:{r:.333333,g:.419608,b:.184314},darkorange:{r:1,g:.54902,b:0},darkorchid:{r:.6,g:.196078,b:.8},darkred:{r:.545098,g:0,b:0},darksalmon:{r:.913725,g:.588235,b:.478431},darkseagreen:{r:.560784,g:.737255,b:.560784},darkslateblue:{r:.282353,g:.239216,b:.545098},darkslategray:{r:.184314,g:.309804,b:.309804},darkslategrey:{r:.184314,g:.309804,b:.309804},darkturquoise:{r:0,g:.807843,b:.819608},darkviolet:{r:.580392,g:0,b:.827451},deeppink:{r:1,g:.078431,b:.576471},deepskyblue:{r:0,g:.74902,b:1},dimgray:{r:.411765,g:.411765,b:.411765},dimgrey:{r:.411765,g:.411765,b:.411765},dodgerblue:{r:.117647,g:.564706,b:1},firebrick:{r:.698039,g:.133333,b:.133333},floralwhite:{r:1,g:.980392,b:.941176},forestgreen:{r:.133333,g:.545098,b:.133333},fuchsia:{r:1,g:0,b:1},gainsboro:{r:.862745,g:.862745,b:.862745},ghostwhite:{r:.972549,g:.972549,b:1},gold:{r:1,g:.843137,b:0},goldenrod:{r:.854902,g:.647059,b:.12549},gray:{r:.501961,g:.501961,b:.501961},green:{r:0,g:.501961,b:0},greenyellow:{r:.678431,g:1,b:.184314},grey:{r:.501961,g:.501961,b:.501961},honeydew:{r:.941176,g:1,b:.941176},hotpink:{r:1,g:.411765,b:.705882},indianred:{r:.803922,g:.360784,b:.360784},indigo:{r:.294118,g:0,b:.509804},ivory:{r:1,g:1,b:.941176},khaki:{r:.941176,g:.901961,b:.54902},lavender:{r:.901961,g:.901961,b:.980392},lavenderblush:{r:1,g:.941176,b:.960784},lawngreen:{r:.486275,g:.988235,b:0},lemonchiffon:{r:1,g:.980392,b:.803922},lightblue:{r:.678431,g:.847059,b:.901961},lightcoral:{r:.941176,g:.501961,b:.501961},lightcyan:{r:.878431,g:1,b:1},lightgoldenrodyellow:{r:.980392,g:.980392,b:.823529},lightgray:{r:.827451,g:.827451,b:.827451},lightgreen:{r:.564706,g:.933333,b:.564706},lightgrey:{r:.827451,g:.827451,b:.827451},lightpink:{r:1,g:.713725,b:.756863},lightsalmon:{r:1,g:.627451,b:.478431},lightseagreen:{r:.12549,g:.698039,b:.666667},lightskyblue:{r:.529412,g:.807843,b:.980392},lightslategray:{r:.466667,g:.533333,b:.6},lightslategrey:{r:.466667,g:.533333,b:.6},lightsteelblue:{r:.690196,g:.768627,b:.870588},lightyellow:{r:1,g:1,b:.878431},lime:{r:0,g:1,b:0},limegreen:{r:.196078,g:.803922,b:.196078},linen:{r:.980392,g:.941176,b:.901961},magenta:{r:1,g:0,b:1},maroon:{r:.501961,g:0,b:0},mediumaquamarine:{r:.4,g:.803922,b:.666667},mediumblue:{r:0,g:0,b:.803922},mediumorchid:{r:.729412,g:.333333,b:.827451},mediumpurple:{r:.576471,g:.439216,b:.858824},mediumseagreen:{r:.235294,g:.701961,b:.443137},mediumslateblue:{r:.482353,g:.407843,b:.933333},mediumspringgreen:{r:0,g:.980392,b:.603922},mediumturquoise:{r:.282353,g:.819608,b:.8},mediumvioletred:{r:.780392,g:.082353,b:.521569},midnightblue:{r:.098039,g:.098039,b:.439216},mintcream:{r:.960784,g:1,b:.980392},mistyrose:{r:1,g:.894118,b:.882353},moccasin:{r:1,g:.894118,b:.709804},navajowhite:{r:1,g:.870588,b:.678431},navy:{r:0,g:0,b:.501961},oldlace:{r:.992157,g:.960784,b:.901961},olive:{r:.501961,g:.501961,b:0},olivedrab:{r:.419608,g:.556863,b:.137255},orange:{r:1,g:.647059,b:0},orangered:{r:1,g:.270588,b:0},orchid:{r:.854902,g:.439216,b:.839216},palegoldenrod:{r:.933333,g:.909804,b:.666667},palegreen:{r:.596078,g:.984314,b:.596078},paleturquoise:{r:.686275,g:.933333,b:.933333},palevioletred:{r:.858824,g:.439216,b:.576471},papayawhip:{r:1,g:.937255,b:.835294},peachpuff:{r:1,g:.854902,b:.72549},peru:{r:.803922,g:.521569,b:.247059},pink:{r:1,g:.752941,b:.796078},plum:{r:.866667,g:.627451,b:.866667},powderblue:{r:.690196,g:.878431,b:.901961},purple:{r:.501961,g:0,b:.501961},red:{r:1,g:0,b:0},rosybrown:{r:.737255,g:.560784,b:.560784},royalblue:{r:.254902,g:.411765,b:.882353},saddlebrown:{r:.545098,g:.270588,b:.07451},salmon:{r:.980392,g:.501961,b:.447059},sandybrown:{r:.956863,g:.643137,b:.376471},seagreen:{r:.180392,g:.545098,b:.341176},seashell:{r:1,g:.960784,b:.933333},sienna:{r:.627451,g:.321569,b:.176471},silver:{r:.752941,g:.752941,b:.752941},skyblue:{r:.529412,g:.807843,b:.921569},slateblue:{r:.415686,g:.352941,b:.803922},slategray:{r:.439216,g:.501961,b:.564706},slategrey:{r:.439216,g:.501961,b:.564706},snow:{r:1,g:.980392,b:.980392},springgreen:{r:0,g:1,b:.498039},steelblue:{r:.27451,g:.509804,b:.705882},tan:{r:.823529,g:.705882,b:.54902},teal:{r:0,g:.501961,b:.501961},thistle:{r:.847059,g:.74902,b:.847059},tomato:{r:1,g:.388235,b:.278431},transparent:{r:0,g:0,b:0,a:0},turquoise:{r:.25098,g:.878431,b:.815686},violet:{r:.933333,g:.509804,b:.933333},wheat:{r:.960784,g:.870588,b:.701961},white:{r:1,g:1,b:1},whitesmoke:{r:.960784,g:.960784,b:.960784},yellow:{r:1,g:1,b:0},yellowgreen:{r:.603922,g:.803922,b:.196078}},a=/^rgb\(\s*((?:(?:25[0-5]|2[0-4]\d|1\d\d|\d{1,2})\s*,\s*){2}(?:25[0-5]|2[0-4]\d|1\d\d|\d{1,2})\s*)\)$/i,o=/^rgba\(\s*((?:(?:25[0-5]|2[0-4]\d|1\d\d|\d{1,2})\s*,\s*){3}(?:0|1|0?\.\d*)\s*)\)$/i,l=/^#((?:[0-9a-f]{6}|[0-9a-f]{3}))$/i,c=/^#((?:[0-9a-f]{8}|[0-9a-f]{4}))$/i;function d(e){return l.test(e)}function u(e){return c.test(e)}function h(e){return u(e)}function g(e){return a.test(e)}function p(e){return o.test(e)}function f(e){return s.hasOwnProperty(e)}function m(e){let t=l.exec(e);if(null===t)return null;let i=t[1];if(3===i.length){let e=i.charAt(0),t=i.charAt(1),n=i.charAt(2);i=e.concat(e,t,t,n,n)}let s=parseInt(i,16);return isNaN(s)?null:new n.h((0,r.Fv)((0xff0000&s)>>>16,0,255),(0,r.Fv)((65280&s)>>>8,0,255),(0,r.Fv)(255&s,0,255),1)}function v(e){let t=c.exec(e);if(null===t)return null;let i=t[1];if(4===i.length){let e=i.charAt(0),t=i.charAt(1),n=i.charAt(2),r=i.charAt(3);i=e.concat(e,t,t,n,n,r,r)}let s=parseInt(i,16);return isNaN(s)?null:new n.h((0,r.Fv)((0xff0000&s)>>>16,0,255),(0,r.Fv)((65280&s)>>>8,0,255),(0,r.Fv)(255&s,0,255),(0,r.Fv)((0xff000000&s)>>>24,0,255))}function S(e){let t=a.exec(e);if(null===t)return null;let i=t[1].split(",");return new n.h((0,r.Fv)(Number(i[0]),0,255),(0,r.Fv)(Number(i[1]),0,255),(0,r.Fv)(Number(i[2]),0,255),1)}function y(e){let t=o.exec(e);if(null===t)return null;let i=t[1].split(",");return 4===i.length?new n.h((0,r.Fv)(Number(i[0]),0,255),(0,r.Fv)(Number(i[1]),0,255),(0,r.Fv)(Number(i[2]),0,255),Number(i[3])):null}function C(e){let t=s[e.toLowerCase()];return t?new n.h(t.r,t.g,t.b,t.hasOwnProperty("a")?t.a:void 0):null}function b(e){let t=e.toLowerCase();return d(t)?m(t):h(t)?v(t):g(t)?S(t):p(t)?y(t):f(t)?C(t):null}},144015:function(e,t,i){"use strict";i.d(t,{H:()=>r,m:()=>n});let n=e=>"function"==typeof e,r=e=>"string"==typeof e},155717:function(e,t,i){"use strict";i.d(t,{Bo:()=>r,LI:()=>s});let n={configurable:!1,enumerable:!1,writable:!1};void 0===globalThis.FAST&&Reflect.defineProperty(globalThis,"FAST",Object.assign({value:Object.create(null)},n));let r=globalThis.FAST;if(void 0===r.getById){let e=Object.create(null);Reflect.defineProperty(r,"getById",Object.assign({value(t,i){let n=e[t];return void 0===n&&(n=i?e[t]=i():null),n}},n))}function s(){let e=new Map;return Object.freeze({register:t=>!e.has(t.type)&&(e.set(t.type,t),!0),getByType:t=>e.get(t),getForInstance:t=>e.get(t.constructor)})}void 0===r.error&&Object.assign(r,{warn(){},error:e=>Error(`Error ${e}`),addMessages(){}}),Object.freeze([])},44497:function(e,t,i){"use strict";let n;i.d(t,{X:()=>o});var r=i(155717);let s=new Map;function a(e){return e.map(e=>e instanceof o?a(e.styles):[e]).reduce((e,t)=>e.concat(t),[])}class o{constructor(e){this.styles=e,this.targets=new WeakSet,this._strategy=null,this.behaviors=e.map(e=>e instanceof o?e.behaviors:null).reduce((e,t)=>null===t?e:null===e?t:e.concat(t),null)}get strategy(){return null===this._strategy&&this.withStrategy(n),this._strategy}addStylesTo(e){this.strategy.addStylesTo(e),this.targets.add(e)}removeStylesFrom(e){this.strategy.removeStylesFrom(e),this.targets.delete(e)}isAttachedTo(e){return this.targets.has(e)}withBehaviors(...e){return this.behaviors=null===this.behaviors?e:this.behaviors.concat(e),this}withStrategy(e){return this._strategy=new e(a(this.styles)),this}static setDefaultStrategy(e){n=e}static normalize(e){return void 0===e?void 0:Array.isArray(e)?new o(e):e instanceof o?e:new o([e])}}o.supportsAdoptedStyleSheets=Array.isArray(document.adoptedStyleSheets)&&"replace"in CSSStyleSheet.prototype;class l{constructor(e){this.sheets=e.map(e=>{if(e instanceof CSSStyleSheet)return e;let t=s.get(e);return void 0===t&&((t=new CSSStyleSheet).replaceSync(e),s.set(e,t)),t})}addStylesTo(e){e.adoptedStyleSheets=[...e.adoptedStyleSheets,...this.sheets]}removeStylesFrom(e){let t=this.sheets;e.adoptedStyleSheets=e.adoptedStyleSheets.filter(e=>-1===t.indexOf(e))}}o.setDefaultStrategy(r.Bo.getById(5,()=>l))},656971:function(e,t,i){"use strict";i.d(t,{L:()=>X});var n=i(231191),r=i(144015),s=i(155717);let a=s.Bo.getById(1,()=>{let e=[],t=[],i=globalThis.requestAnimationFrame,n=!0;function r(){if(t.length)throw t.shift()}function s(i){try{i.call()}catch(i){if(n)t.push(i),setTimeout(r,0);else throw e.length=0,i}}function a(){let t=1024,i=0;for(;i<e.length;)if(s(e[i]),++i>t){for(let t=0,n=e.length-i;t<n;t++)e[t]=e[t+i];e.length-=i,i=0}e.length=0}function o(t){e.push(t),e.length<2&&(n?i(a):a())}return Object.freeze({enqueue:o,next:()=>new Promise(o),process:a,setMode:e=>n=e})});class o{constructor(e,t){this.sub1=void 0,this.sub2=void 0,this.spillover=void 0,this.subject=e,this.sub1=t}has(e){return void 0===this.spillover?this.sub1===e||this.sub2===e:-1!==this.spillover.indexOf(e)}subscribe(e){let t=this.spillover;if(void 0===t){if(this.has(e))return;if(void 0===this.sub1){this.sub1=e;return}if(void 0===this.sub2){this.sub2=e;return}this.spillover=[this.sub1,this.sub2,e],this.sub1=void 0,this.sub2=void 0}else -1===t.indexOf(e)&&t.push(e)}unsubscribe(e){let t=this.spillover;if(void 0===t)this.sub1===e?this.sub1=void 0:this.sub2===e&&(this.sub2=void 0);else{let i=t.indexOf(e);-1!==i&&t.splice(i,1)}}notify(e){let t=this.spillover,i=this.subject;if(void 0===t){let t=this.sub1,n=this.sub2;void 0!==t&&t.handleChange(i,e),void 0!==n&&n.handleChange(i,e)}else for(let n=0,r=t.length;n<r;++n)t[n].handleChange(i,e)}}class l{constructor(e){this.subscribers={},this.subjectSubscribers=null,this.subject=e}notify(e){var t,i;null==(t=this.subscribers[e])||t.notify(e),null==(i=this.subjectSubscribers)||i.notify(e)}subscribe(e,t){var i,n;let r;(r=t?null!=(i=this.subscribers[t])?i:this.subscribers[t]=new o(this.subject):null!=(n=this.subjectSubscribers)?n:this.subjectSubscribers=new o(this.subject)).subscribe(e)}unsubscribe(e,t){var i,n;t?null==(i=this.subscribers[t])||i.unsubscribe(e):null==(n=this.subjectSubscribers)||n.unsubscribe(e)}}let c=s.Bo.getById(2,()=>{let e,t=a.enqueue,i=/(:|&&|\|\||if)/,n=new WeakMap,c=new WeakMap,d=e=>{throw s.Bo.error(1101)};function u(e){var t;let i=null!=(t=e.$fastController)?t:n.get(e);return void 0===i&&(Array.isArray(e)?i=d(e):n.set(e,i=new l(e))),i}function g(e){let t=c.get(e);if(void 0===t){let i=Reflect.getPrototypeOf(e);for(;void 0===t&&null!==i;)t=c.get(i),i=Reflect.getPrototypeOf(i);t=void 0===t?[]:t.slice(0),c.set(e,t)}return t}class p{constructor(e){this.name=e,this.field=`_${e}`,this.callback=`${e}Changed`}getValue(t){return void 0!==e&&e.watch(t,this.name),t[this.field]}setValue(e,t){let i=this.field,n=e[i];if(n!==t){e[i]=t;let s=e[this.callback];(0,r.m)(s)&&s.call(e,n,t),u(e).notify(this.name)}}}class f extends o{constructor(e,t,i=!1){super(e,t),this.binding=e,this.isVolatileBinding=i,this.needsRefresh=!0,this.needsQueue=!0,this.isAsync=!0,this.first=this,this.last=null,this.propertySource=void 0,this.propertyName=void 0,this.notifier=void 0,this.next=void 0}setMode(e){this.isAsync=this.needsQueue=e}observe(t,i){this.needsRefresh&&null!==this.last&&this.dispose();let n=e;e=this.needsRefresh?this:void 0,this.needsRefresh=this.isVolatileBinding;let r=this.binding(t,null!=i?i:h.default);return e=n,r}dispose(){if(null!==this.last){let e=this.first;for(;void 0!==e;)e.notifier.unsubscribe(this,e.propertyName),e=e.next;this.last=null,this.needsRefresh=this.needsQueue=this.isAsync}}watch(t,i){let n=this.last,r=u(t),s=null===n?this.first:{};if(s.propertySource=t,s.propertyName=i,s.notifier=r,r.subscribe(this,i),null!==n){if(!this.needsRefresh){let i;e=void 0,i=n.propertySource[n.propertyName],e=this,t===i&&(this.needsRefresh=!0)}n.next=s}this.last=s}handleChange(){this.needsQueue?(this.needsQueue=!1,t(this)):this.isAsync||this.call()}call(){null!==this.last&&(this.needsQueue=this.isAsync,this.notify(this))}*records(){let e=this.first;for(;void 0!==e;)yield e,e=e.next}}return Object.freeze({setArrayObserverFactory(e){d=e},getNotifier:u,track(t,i){e&&e.watch(t,i)},trackVolatile(){e&&(e.needsRefresh=!0)},notify(e,t){u(e).notify(t)},defineProperty(e,t){(0,r.H)(t)&&(t=new p(t)),g(e).push(t),Reflect.defineProperty(e,t.name,{enumerable:!0,get(){return t.getValue(this)},set(e){t.setValue(this,e)}})},getAccessors:g,binding(e,t,i=this.isVolatileBinding(e)){return new f(e,t,i)},isVolatileBinding:e=>i.test(e.toString())})});function d(e,t){c.defineProperty(e,t)}let u=s.Bo.getById(3,()=>{let e=null;return{get:()=>e,set(t){e=t}}});class h{constructor(e=null,t=null){this.index=0,this.length=0,this.parent=e,this.parentContext=t}get event(){return u.get()}get isEven(){return this.index%2==0}get isOdd(){return this.index%2!=0}get isFirst(){return 0===this.index}get isInMiddle(){return!this.isFirst&&!this.isLast}get isLast(){return this.index===this.length-1}eventDetail(){return this.event.detail}eventTarget(){return this.event.target}updatePosition(e,t){this.index=e,this.length=t}createChildContext(e){return new h(e,this)}createItemContext(e,t){let i=Object.create(this);return i.index=e,i.length=t,i}static setEvent(e){u.set(e)}static create(){return new h}}h.default=new h,c.defineProperty(h.prototype,"index"),c.defineProperty(h.prototype,"length");var g=i(44497);let p=Object.freeze({queueUpdate:a.enqueue,nextUpdate:a.next,processUpdates:a.process,setAttribute(e,t,i){null==i?e.removeAttribute(t):e.setAttribute(t,i)},setBooleanAttribute(e,t,i){i?e.setAttribute(t,""):e.removeAttribute(t)}}),f="boolean",m="reflect",v={toView:e=>e?"true":"false",fromView:e=>null!=e&&"false"!==e&&!1!==e&&0!==e};class S{constructor(e,t,i=t.toLowerCase(),n=m,r){this.guards=new Set,this.Owner=e,this.name=t,this.attribute=i,this.mode=n,this.converter=r,this.fieldName=`_${t}`,this.callbackName=`${t}Changed`,this.hasCallback=this.callbackName in e.prototype,n===f&&void 0===r&&(this.converter=v)}setValue(e,t){let i=e[this.fieldName],n=this.converter;void 0!==n&&(t=n.fromView(t)),i!==t&&(e[this.fieldName]=t,this.tryReflectToAttribute(e),this.hasCallback&&e[this.callbackName](i,t),e.$fastController.notify(this.name))}getValue(e){return c.track(e,this.name),e[this.fieldName]}onAttributeChangedCallback(e,t){this.guards.has(e)||(this.guards.add(e),this.setValue(e,t),this.guards.delete(e))}tryReflectToAttribute(e){let t=this.mode,i=this.guards;i.has(e)||"fromView"===t||a.enqueue(()=>{i.add(e);let n=e[this.fieldName];switch(t){case m:let r=this.converter;p.setAttribute(e,this.attribute,void 0!==r?r.toView(n):n);break;case f:p.setBooleanAttribute(e,this.attribute,n)}i.delete(e)})}static collect(e,...t){let i=[];t.push(e.attributes);for(let n=0,s=t.length;n<s;++n){let s=t[n];if(void 0!==s)for(let t=0,n=s.length;t<n;++t){let n=s[t];(0,r.H)(n)?i.push(new S(e,n)):i.push(new S(e,n.property,n.attribute,n.mode,n.converter))}}return i}}let y={mode:"open"},C={},b=s.Bo.getById(4,()=>(0,s.LI)());class T{constructor(e,t=e.definition){this.platformDefined=!1,(0,r.H)(t)&&(t={name:t}),this.type=e,this.name=t.name,this.template=t.template;let i=e.prototype,n=S.collect(e,t.attributes),s=Array(n.length),a={},o={};for(let e=0,t=n.length;e<t;++e){let t=n[e];s[e]=t.attribute,a[t.name]=t,o[t.attribute]=t,c.defineProperty(i,t)}Reflect.defineProperty(e,"observedAttributes",{value:s,enumerable:!0}),this.attributes=n,this.propertyLookup=a,this.attributeLookup=o,this.shadowOptions=void 0===t.shadowOptions?y:null===t.shadowOptions?void 0:Object.assign(Object.assign({},y),t.shadowOptions),this.elementOptions=void 0===t.elementOptions?C:Object.assign(Object.assign({},C),t.elementOptions),this.styles=g.X.normalize(t.styles),b.register(this)}get isDefined(){return this.platformDefined}define(e=customElements){let t=this.type;return e.get(this.name)||(this.platformDefined=!0,e.define(this.name,t,this.elementOptions)),this}static compose(e,t){return b.getByType(e)?new T(class extends e{},t):new T(e,t)}}T.getByType=b.getByType,T.getForInstance=b.getForInstance;let E=new WeakMap,_={bubbles:!0,composed:!0,cancelable:!0};function I(e){var t,i;return null!=(i=null!=(t=e.shadowRoot)?t:E.get(e))?i:null}let w="isConnected";class P extends l{constructor(e,t){super(e),this.boundObservables=null,this.behaviors=null,this.needsInitialization=!0,this.hasExistingShadowRoot=!1,this._template=null,this._styles=null,this._isConnected=!1,this.$fastController=this,this.view=null,this.element=e,this.definition=t;let i=t.shadowOptions;if(void 0!==i){let t=e.shadowRoot;t?this.hasExistingShadowRoot=!0:(t=e.attachShadow(i),"closed"===i.mode&&E.set(e,t))}let n=c.getAccessors(e);if(n.length>0){let t=this.boundObservables=Object.create(null);for(let i=0,r=n.length;i<r;++i){let r=n[i].name,s=e[r];void 0!==s&&(delete e[r],t[r]=s)}}}get isConnected(){return c.track(this,w),this._isConnected}setIsConnected(e){this._isConnected=e,c.notify(this,w)}get template(){var e;if(null===this._template){let t=this.definition;this.element.resolveTemplate?this._template=this.element.resolveTemplate():t.template&&(this._template=null!=(e=t.template)?e:null)}return this._template}set template(e){this._template!==e&&(this._template=e,this.needsInitialization||this.renderTemplate(e))}get styles(){var e;if(null===this._styles){let t=this.definition;this.element.resolveStyles?this._styles=this.element.resolveStyles():t.styles&&(this._styles=null!=(e=t.styles)?e:null)}return this._styles}set styles(e){this._styles!==e&&(null!==this._styles&&this.removeStyles(this._styles),this._styles=e,this.needsInitialization||this.addStyles(e))}addStyles(e){if(!e)return;let t=I(this.element)||this.element.getRootNode();if(e instanceof HTMLElement)t.append(e);else if(!e.isAttachedTo(t)){let i=e.behaviors;e.addStylesTo(t),null!==i&&this.addBehaviors(i)}}removeStyles(e){if(!e)return;let t=I(this.element)||this.element.getRootNode();if(e instanceof HTMLElement)t.removeChild(e);else if(e.isAttachedTo(t)){let i=e.behaviors;e.removeStylesFrom(t),null!==i&&this.removeBehaviors(i)}}addBehaviors(e){var t;let i=null!=(t=this.behaviors)?t:this.behaviors=new Map,n=e.length,r=[];for(let t=0;t<n;++t){let n=e[t];i.has(n)?i.set(n,i.get(n)+1):(i.set(n,1),r.push(n))}if(this._isConnected){let e=this.element,t=h.default;for(let i=0;i<r.length;++i)r[i].bind(e,t)}}removeBehaviors(e,t=!1){let i=this.behaviors;if(null===i)return;let n=e.length,r=[];for(let s=0;s<n;++s){let n=e[s];if(i.has(n)){let e=i.get(n)-1;0===e||t?i.delete(n)&&r.push(n):i.set(n,e)}}if(this._isConnected){let e=this.element,t=h.default;for(let i=0;i<r.length;++i)r[i].unbind(e,t)}}onConnectedCallback(){if(this._isConnected)return;let e=this.element,t=h.default;this.needsInitialization?this.finishInitialization():null!==this.view&&this.view.bind(e,t);let i=this.behaviors;if(null!==i)for(let n of i.keys())n.bind(e,t);this.setIsConnected(!0)}onDisconnectedCallback(){if(!this._isConnected)return;this.setIsConnected(!1);let e=this.view;null!==e&&e.unbind();let t=this.behaviors;if(null!==t){let e=this.element,i=h.default;for(let n of t.keys())n.unbind(e,i)}}onAttributeChangedCallback(e,t,i){let n=this.definition.attributeLookup[e];void 0!==n&&n.onAttributeChangedCallback(this.element,i)}emit(e,t,i){return!!this._isConnected&&this.element.dispatchEvent(new CustomEvent(e,Object.assign(Object.assign({detail:t},_),i)))}finishInitialization(){let e=this.element,t=this.boundObservables;if(null!==t){let i=Object.keys(t);for(let n=0,r=i.length;n<r;++n){let r=i[n];e[r]=t[r]}this.boundObservables=null}this.renderTemplate(this.template),this.addStyles(this.styles),this.needsInitialization=!1}renderTemplate(e){var t;let i=this.element,n=null!=(t=I(i))?t:i;if(null!==this.view)this.view.dispose(),this.view=null;else if(!this.needsInitialization||this.hasExistingShadowRoot){this.hasExistingShadowRoot=!1;for(let e=n.firstChild;null!==e;e=n.firstChild)n.removeChild(e)}e&&(this.view=e.render(i,n,i))}static forCustomElement(e){let t=e.$fastController;if(void 0!==t)return t;let i=T.getForInstance(e);if(void 0===i)throw s.Bo.error(1401);return e.$fastController=new P(e,i)}}function R(e){return class extends e{constructor(){super(),P.forCustomElement(this)}$emit(e,t,i){return this.$fastController.emit(e,t,i)}connectedCallback(){this.$fastController.onConnectedCallback()}disconnectedCallback(){this.$fastController.onDisconnectedCallback()}attributeChangedCallback(e,t,i){this.$fastController.onAttributeChangedCallback(e,t,i)}}}function A(e,t){return(0,r.m)(e)?T.compose(e,t):T.compose(this,e)}function M(e,t){return(0,r.m)(e)?T.compose(e,t).define().type:T.compose(this,e).define().type}let D=Object.assign(R(HTMLElement),{from:e=>R(e),define:M,compose:A});function O(e){let t=e.parentElement;if(t)return t;{let t=e.getRootNode();if(t.host instanceof HTMLElement)return t.host}return null}function k(e,t){let i=t;for(;null!==i;){if(i===e)return!0;i=O(i)}return!1}new WeakSet;let N=document.createElement("div");function x(e){return e instanceof D}class L{setProperty(e,t){a.enqueue(()=>this.target.setProperty(e,t))}removeProperty(e){a.enqueue(()=>this.target.removeProperty(e))}}class F extends L{constructor(e){super();let t=new CSSStyleSheet;this.target=t.cssRules[t.insertRule(":host{}")].style,e.$fastController.addStyles(new g.X([t]))}}class U extends L{constructor(){super();let e=new CSSStyleSheet;this.target=e.cssRules[e.insertRule(":root{}")].style,document.adoptedStyleSheets=[...document.adoptedStyleSheets,e]}}class $ extends L{constructor(){super(),this.style=document.createElement("style"),document.head.appendChild(this.style);let{sheet:e}=this.style;if(e){let t=e.insertRule(":root{}",e.cssRules.length);this.target=e.cssRules[t].style}}}class V{constructor(e){this.store=new Map,this.target=null;let t=e.$fastController;this.style=document.createElement("style"),t.addStyles(this.style),c.getNotifier(t).subscribe(this,"isConnected"),this.handleChange(t,"isConnected")}targetChanged(){if(null!==this.target)for(let[e,t]of this.store.entries())this.target.setProperty(e,t)}setProperty(e,t){this.store.set(e,t),a.enqueue(()=>{null!==this.target&&this.target.setProperty(e,t)})}removeProperty(e){this.store.delete(e),a.enqueue(()=>{null!==this.target&&this.target.removeProperty(e)})}handleChange(e,t){let{sheet:i}=this.style;if(i){let e=i.insertRule(":host{}",i.cssRules.length);this.target=i.cssRules[e].style}else this.target=null}}(0,n.__decorate)([d],V.prototype,"target",void 0);class B{constructor(e){this.target=e.style}setProperty(e,t){a.enqueue(()=>this.target.setProperty(e,t))}removeProperty(e){a.enqueue(()=>this.target.removeProperty(e))}}class H{setProperty(e,t){for(let i of(H.properties[e]=t,H.roots.values()))W.getOrCreate(H.normalizeRoot(i)).setProperty(e,t)}removeProperty(e){for(let t of(delete H.properties[e],H.roots.values()))W.getOrCreate(H.normalizeRoot(t)).removeProperty(e)}static registerRoot(e){let{roots:t}=H;if(!t.has(e)){t.add(e);let i=W.getOrCreate(this.normalizeRoot(e));for(let e in H.properties)i.setProperty(e,H.properties[e])}}static unregisterRoot(e){let{roots:t}=H;if(t.has(e)){t.delete(e);let i=W.getOrCreate(H.normalizeRoot(e));for(let e in H.properties)i.removeProperty(e)}}static normalizeRoot(e){return e===N?document:e}}H.roots=new Set,H.properties={};let j=new WeakMap,q=g.X.supportsAdoptedStyleSheets?F:V,W=Object.freeze({getOrCreate(e){let t;return j.has(e)?j.get(e):(t=e===N?new H:e instanceof Document?g.X.supportsAdoptedStyleSheets?new U:new $:x(e)?new q(e):new B(e),j.set(e,t),t)}});class G{constructor(e){this.subscribers=new WeakMap,this._appliedTo=new Set,this.name=e.name,null!==e.cssCustomPropertyName&&(this.cssCustomProperty=`--${e.cssCustomPropertyName}`,this.cssVar=`var(${this.cssCustomProperty})`),this.id=G.uniqueId(),G.tokensById.set(this.id,this)}get appliedTo(){return[...this._appliedTo]}static from(e){return new G({name:"string"==typeof e?e:e.name,cssCustomPropertyName:"string"==typeof e?e:void 0===e.cssCustomPropertyName?e.name:e.cssCustomPropertyName})}static isCSSDesignToken(e){return"string"==typeof e.cssCustomProperty}static isDerivedDesignTokenValue(e){return"function"==typeof e}static getTokenById(e){return G.tokensById.get(e)}getOrCreateSubscriberSet(e=this){return this.subscribers.get(e)||this.subscribers.set(e,new Set)&&this.subscribers.get(e)}createCSS(){return this.cssVar||""}getValueFor(e){let t=Z.getOrCreate(e).get(this);if(void 0!==t)return t;throw Error(`Value could not be retrieved for token named "${this.name}". Ensure the value is set for ${e} or an ancestor of ${e}.`)}setValueFor(e,t){return this._appliedTo.add(e),t instanceof G&&(t=this.alias(t)),Z.getOrCreate(e).set(this,t),this}deleteValueFor(e){return this._appliedTo.delete(e),Z.existsFor(e)&&Z.getOrCreate(e).delete(this),this}withDefault(e){return this.setValueFor(N,e),this}subscribe(e,t){let i=this.getOrCreateSubscriberSet(t);t&&!Z.existsFor(t)&&Z.getOrCreate(t),i.has(e)||i.add(e)}unsubscribe(e,t){let i=this.subscribers.get(t||this);i&&i.has(e)&&i.delete(e)}notify(e){let t=Object.freeze({token:this,target:e});this.subscribers.has(this)&&this.subscribers.get(this).forEach(e=>e.handleChange(t)),this.subscribers.has(e)&&this.subscribers.get(e).forEach(e=>e.handleChange(t))}alias(e){return t=>e.getValueFor(t)}}G.uniqueId=(()=>{let e=0;return()=>(e++,e.toString(16))})(),G.tokensById=new Map;class z{startReflection(e,t){e.subscribe(this,t),this.handleChange({token:e,target:t})}stopReflection(e,t){e.unsubscribe(this,t),this.remove(e,t)}handleChange(e){let{token:t,target:i}=e;this.add(t,i)}add(e,t){W.getOrCreate(t).setProperty(e.cssCustomProperty,this.resolveCSSValue(Z.getOrCreate(t).get(e)))}remove(e,t){W.getOrCreate(t).removeProperty(e.cssCustomProperty)}resolveCSSValue(e){return e&&"function"==typeof e.createCSS?e.createCSS():e}}class J{constructor(e,t,i){this.source=e,this.token=t,this.node=i,this.dependencies=new Set,this.observer=c.binding(e,this,!1),this.observer.handleChange=this.observer.call,this.handleChange()}dispose(){this.observer.dispose()}handleChange(){this.node.store.set(this.token,this.observer.observe(this.node.target,h.default))}}class K{constructor(){this.values=new Map}set(e,t){this.values.get(e)!==t&&(this.values.set(e,t),c.getNotifier(this).notify(e.id))}get(e){return c.track(this,e.id),this.values.get(e)}delete(e){this.values.delete(e)}all(){return this.values.entries()}}let Q=new WeakMap,Y=new WeakMap;class Z{constructor(e){this.target=e,this.store=new K,this.children=[],this.assignedValues=new Map,this.reflecting=new Set,this.bindingObservers=new Map,this.tokenValueChangeHandler={handleChange:(e,t)=>{let i=G.getTokenById(t);if(i&&(i.notify(this.target),G.isCSSDesignToken(i))){let t=this.parent,n=this.isReflecting(i);if(t){let r=t.get(i),s=e.get(i);r===s||n?r===s&&n&&this.stopReflectToCSS(i):this.reflectToCSS(i)}else n||this.reflectToCSS(i)}}},Q.set(e,this),c.getNotifier(this.store).subscribe(this.tokenValueChangeHandler),e instanceof D?e.$fastController.addBehaviors([this]):e.isConnected&&this.bind()}static getOrCreate(e){return Q.get(e)||new Z(e)}static existsFor(e){return Q.has(e)}static findParent(e){if(N!==e.target){let t=O(e.target);for(;null!==t;){if(Q.has(t))return Q.get(t);t=O(t)}return Z.getOrCreate(N)}return null}static findClosestAssignedNode(e,t){let i=t;do{if(i.has(e))return i;i=i.parent?i.parent:i.target!==N?Z.getOrCreate(N):null}while(null!==i);return null}get parent(){return Y.get(this)||null}has(e){return this.assignedValues.has(e)}get(e){let t=this.store.get(e);if(void 0!==t)return t;let i=this.getRaw(e);if(void 0!==i)return this.hydrate(e,i),this.get(e)}getRaw(e){var t;return this.assignedValues.has(e)?this.assignedValues.get(e):null==(t=Z.findClosestAssignedNode(e,this))?void 0:t.getRaw(e)}set(e,t){G.isDerivedDesignTokenValue(this.assignedValues.get(e))&&this.tearDownBindingObserver(e),this.assignedValues.set(e,t),G.isDerivedDesignTokenValue(t)?this.setupBindingObserver(e,t):this.store.set(e,t)}delete(e){this.assignedValues.delete(e),this.tearDownBindingObserver(e);let t=this.getRaw(e);t?this.hydrate(e,t):this.store.delete(e)}bind(){let e=Z.findParent(this);for(let t of(e&&e.appendChild(this),this.assignedValues.keys()))t.notify(this.target)}unbind(){this.parent&&Y.get(this).removeChild(this)}appendChild(e){e.parent&&Y.get(e).removeChild(e);let t=this.children.filter(t=>e.contains(t));for(let[i,n]of(Y.set(e,this),this.children.push(e),t.forEach(t=>e.appendChild(t)),c.getNotifier(this.store).subscribe(e),this.store.all()))e.hydrate(i,this.bindingObservers.has(i)?this.getRaw(i):n)}removeChild(e){let t=this.children.indexOf(e);return -1!==t&&this.children.splice(t,1),c.getNotifier(this.store).unsubscribe(e),e.parent===this&&Y.delete(e)}contains(e){return k(this.target,e.target)}reflectToCSS(e){this.isReflecting(e)||(this.reflecting.add(e),Z.cssCustomPropertyReflector.startReflection(e,this.target))}stopReflectToCSS(e){this.isReflecting(e)&&(this.reflecting.delete(e),Z.cssCustomPropertyReflector.stopReflection(e,this.target))}isReflecting(e){return this.reflecting.has(e)}handleChange(e,t){let i=G.getTokenById(t);i&&this.hydrate(i,this.getRaw(i))}hydrate(e,t){if(!this.has(e)){let i=this.bindingObservers.get(e);G.isDerivedDesignTokenValue(t)?i?i.source!==t&&(this.tearDownBindingObserver(e),this.setupBindingObserver(e,t)):this.setupBindingObserver(e,t):(i&&this.tearDownBindingObserver(e),this.store.set(e,t))}}setupBindingObserver(e,t){let i=new J(t,e,this);return this.bindingObservers.set(e,i),i}tearDownBindingObserver(e){return!!this.bindingObservers.has(e)&&(this.bindingObservers.get(e).dispose(),this.bindingObservers.delete(e),!0)}}Z.cssCustomPropertyReflector=new z,(0,n.__decorate)([d],Z.prototype,"children",void 0);let X=Object.freeze({create:function(e){return G.from(e)},notifyConnection:e=>!!e.isConnected&&!!Z.existsFor(e)&&(Z.getOrCreate(e).bind(),!0),notifyDisconnection:e=>!e.isConnected&&!!Z.existsFor(e)&&(Z.getOrCreate(e).unbind(),!0),registerRoot(e=N){H.registerRoot(e)},unregisterRoot(e=N){H.unregisterRoot(e)}})},424097:function(e,t,i){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i.d(t,{BU:()=>E,CX:()=>k,Ct:()=>s,Eq:()=>m,Fq:()=>h,Gg:()=>M,IH:()=>l,Iy:()=>d,KO:()=>b,Kq:()=>_,M2:()=>P,PB:()=>w,Qo:()=>O,SD:()=>p,TF:()=>f,W2:()=>v,WG:()=>u,WZ:()=>y,bg:()=>ei,fM:()=>B,p2:()=>a,s1:()=>S,sM:()=>A,tu:()=>T,uF:()=>o,wZ:()=>r,xH:()=>I,zX:()=>c});var r={hour:"numeric",minute:"numeric"},s={day:"numeric",month:"numeric"},a={day:"numeric",month:"numeric",year:"numeric"},o={day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric"},l={day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},c={day:"numeric",month:"numeric",year:"2-digit"},d={day:"numeric",month:"long"},u={day:"numeric",month:"long",year:"numeric"},h={hour:"numeric",minute:"numeric",second:"numeric"},g=n({},h,{timeZoneName:"short"}),p=n({},d,h,{timeZoneName:"short"}),f=n({},u,h,{timeZoneName:"short"}),m={weekday:"long"},v={weekday:"short"},S={weekday:"long",day:"numeric",month:"long",year:"numeric"},y={weekday:"long",day:"numeric",month:"long"},C=n({},h,{timeZoneName:"long"}),b=n({},y,C),T=n({},S,C),E={hour:"numeric",minute:"numeric",second:"numeric"},_={day:"numeric",month:"short"},I={day:"numeric",month:"short",year:"numeric"},w=n({},I,E),P=n({},_,E),R={},A={hour:"numeric"},M=n({},m,r),D=n({},m,h),O=n({},s,r),k=n({},a,r),N=n({},v,r),x=n({},v,h),L=void 0,F=function(e){return void 0===L&&(L=U(e)),L},U=function(e){var t=Intl.DateTimeFormat(e),i=t.resolvedOptions().timeZone;if(!i||"etc/unknown"===i.toLowerCase())return!0;try{t.format(new Date)}catch(e){if(e&&e.message&&(e.message.indexOf("Invalid time zone specified")||e.message.indexOf("Unsupported time zone specified")))return!0}return!1};function $(){var e=new Date().getTimezoneOffset();if(e%60==0){var t=e/60;return 0===t?"Etc/GMT":t>0?"Etc/GMT+"+t:"Etc/GMT"+t}return"UTC"}var V=function(e,t){return t&&t.timeZone||!F(e)?t:n({},t,{timeZone:$()})},B=function(e,t){var i=V(e,t);return Intl.DateTimeFormat(e,i)},H=function(){function e(){this.localeFormatCache=new Map}return e.prototype.get=function(e,t){var i=e+":"+JSON.stringify(t),n=this.localeFormatCache.get(i);return n||(n=B(e,t),this.localeFormatCache.set(i,n)),n},e}(),j={a:{symbol:"a",intl:{options:{hour12:!0,hour:"numeric"},part:["dayPeriod","dayperiod"]}},h:{symbol:"h",intl:{options:{hourCycle:"h12",hour:"numeric"},part:"hour"}},hh:{symbol:"hh",intl:{options:{hourCycle:"h12",hour:"2-digit"},part:"hour"}},H:{symbol:"H",intl:{options:{hourCycle:"h23",hour:"numeric"},part:"hour"}},HH:{symbol:"HH",intl:{options:{hourCycle:"h23",hour:"2-digit"},part:"hour"}},k:{symbol:"k",intl:{options:{hour:"numeric",hourCycle:"h24"},part:"hour"}},kk:{symbol:"kk",intl:{options:{hour:"2-digit",hourCycle:"h24"},part:"hour"}},K:{symbol:"K",intl:{options:{hour:"numeric",hourCycle:"h11"},part:"hour"}},KK:{symbol:"KK",intl:{options:{hour:"2-digit",hourCycle:"h11"},part:"hour"}},m:{symbol:"m",intl:{options:{minute:"numeric"},part:"minute"}},mm:{symbol:"mm",intl:{options:{minute:"2-digit"},part:"minute"}},s:{symbol:"s",intl:{options:{second:"numeric"},part:"second"}},ss:{symbol:"ss",intl:{options:{second:"2-digit"},part:"second"}},"zone-short":{symbol:["x","xx","xxx","xxxx","xxxxx","X","XX","XXX","XXXX","XXXXX","z","zz","zzz","Z","ZZ","ZZZ","ZZZZ","ZZZZZ","O","OOOO"],intl:{options:{timeZoneName:"short"},part:"timeZoneName"}},"zone-long":{symbol:["zzzz","v","vvvv","V","VV","VVV","VVVV"],intl:{options:{timeZoneName:"long"},part:"timeZoneName"}}},q={};q.windows={hh:{symbol:"hh",intl:{options:{hourCycle:"h12",hour:"2-digit"},part:"hour"}},h:{symbol:"h",intl:{options:{hourCycle:"h12",hour:"numeric"},part:"hour"}},HH:{symbol:"HH",intl:{options:{hourCycle:"h23",hour:"2-digit"},part:"hour"}},H:{symbol:"H",intl:{options:{hourCycle:"h23",hour:"numeric"},part:"hour"}},mm:{symbol:"mm",intl:{options:{minute:"2-digit"},part:"minute"}},m:{symbol:"m",intl:{options:{minute:"numeric"},part:"minute"}},ss:{symbol:"ss",intl:{options:{second:"2-digit"},part:"second"}},s:{symbol:"s",intl:{options:{second:"numeric"},part:"second"}},period:{symbol:["t","tt"],intl:{options:{hour12:!0,hour:"numeric"},part:["dayPeriod","dayperiod"]}}},q.macos=j;var W={"era-short":{symbol:["G","GG","GGG"],intl:{options:{era:"short"},part:"era"}},GGGG:{symbol:"GGGG",intl:{options:{era:"long"},part:"era"}},GGGGG:{symbol:"GGGG",intl:{options:{era:"narrow"},part:"era"}},"year-numeric":{symbol:["y","yyy","yyyy","yyyyy","Y","YYY","YYYY","YYYYY","u","uuu","uuuu","uuuuu"],intl:{options:{year:"numeric"},part:"year"}},"year-short":{symbol:["yy","YY","uu"],intl:{options:{year:"2-digit"},part:"year"}},"month-numeric":{symbol:["M","L"],intl:{options:{month:"numeric"},part:"month"}},"month-2-digit":{symbol:["MM","LL"],intl:{options:{month:"2-digit"},part:"month"}},"month-short":{symbol:["MMM","LLL"],intl:{options:{month:"short"},part:"month"}},"month-long":{symbol:["MMMM","LLLL"],intl:{options:{month:"long"},part:"month"}},"month-narrow":{symbol:["MMMMM","LLLLL"],intl:{options:{month:"narrow"},part:"month"}},d:{symbol:"d",intl:{options:{day:"numeric"},part:"day"}},dd:{symbol:"dd",intl:{options:{day:"2-digit"},part:"day"}},"weekday-long":{symbol:["E","EE","EEE","EEEE","e","ee","eee","eeee","c","cc","ccc","cccc"],intl:{options:{weekday:"long"},part:"weekday"}},"weekday-narrow":{symbol:["EEEEE","eeeee","ccccc"],intl:{options:{weekday:"narrow"},part:"weekday"}},"weekday-short":{symbol:["EEEEEE","eeeeee","cccccc"],intl:{options:{weekday:"short"},part:"weekday"}}},G={};G.windows={d:{symbol:"d",intl:{options:{day:"numeric"},part:"day"}},dd:{symbol:"dd",intl:{options:{day:"2-digit"},part:"day"}},ddd:{symbol:"ddd",intl:{options:{weekday:"short"},part:"weekday"}},dddd:{symbol:"dddd",intl:{options:{weekday:"long"},part:"weekday"}},M:{symbol:"M",intl:{options:{month:"numeric"},part:"month"}},MM:{symbol:"MM",intl:{options:{month:"2-digit"},part:"month"}},MMM:{symbol:"MMM",intl:{options:{month:"short"},part:"month"}},MMMM:{symbol:"MMMM",intl:{options:{month:"long"},part:"month"}},"year-short":{symbol:["y","yy"],intl:{options:{year:"2-digit"},part:"year"}},"year-long":{symbol:["yyyy","yyyyy"],intl:{options:{year:"numeric"},part:"year"}},era:{symbol:["g","gg"],intl:{options:{era:"narrow"},part:"era"}}},G.macos=W;var z={macos:[/l/g,/w/g,/W/g,/D/g,/F/g,/g/g,/U/g,/q/g,/Q/g]},J={h:!0,H:!0,k:!0,K:!0,m:!0,s:!0},K={hh:!0,HH:!0,kk:!0,KK:!0,mm:!0,ss:!0},Q={H:!0,HH:!0,K:!0,KK:!0},Y="'",Z="~",X=/''/g,ee=RegExp(Z,"g"),et=function(){function e(e,t,i){this.formats=new Map,this.timeTranslationMap=this.expandMap(q[t]||q.windows),this.dateTranslationMap=this.expandMap(G[t]||G.windows),this.locale=e,this.cachedDateTimeFormat=i,this.unsupportedMask=z[t]}var t=e.prototype;return t.timeToString=function(e,t){var i=this.getFormat(t,this.timeTranslationMap);return this.applyFormat(i,e)},t.dateToString=function(e,t){var i=this.getFormat(t,this.dateTranslationMap);return this.applyFormat(i,e)},t.timeHasTimeZone=function(e){var t=this.getFormat(e,this.timeTranslationMap);if(t.intlOptions.timeZoneName)return!0;for(var i=0;i<t.parts.length;i++){var n,r=t.parts[i];if("string"!=typeof r&&null!=(n=r.intlOptionsOverride)&&n.timeZoneName)return!0}return!1},t.getTimeZoneName=function(e,t){var i={intlOptions:{timeZoneName:t.timeZoneName},parts:[{replacePart:"timeZoneName"}]};return this.applyFormat(i,e)},t.expandMap=function(e){var t={};return Object.values(e).reduce(this.expandMapReducer,t),t},t.expandMapReducer=function(e,t){var i=t.symbol;if(Array.isArray(i))for(var n=0;n<i.length;n++)e[i[n]]=t;else e[i]=t;return e},t.getFormat=function(e,t){var i=this.formats.get(e);return i||(i=this.buildFormat(e,t),this.formats.set(e,i)),i},t.buildFormat=function(e,t){for(var i,n={},r=[],s=0,a=!1,o="",l=this.escapeQuotes(this.stripUnsupported(e));s<l.length;){if(i=!1,l[s]===Y){a&&o&&(r.push(o),o=""),a=!a,s++;continue}if(a){o+=l[s],s++;continue}for(var c=l.length;c>s;c--){var d=l.slice(s,c);if(t[d]){i=!0;var u=t[d],h=J[d]||!1,g=K[d]||!1,p=Q[d]||!1;this.didValuesChange(n,u.intl.options)?r.push({replacePart:u.intl.part,force1Digit:h,force2Digits:g,force0forMidnight:p,intlOptionsOverride:u.intl.options}):(n=Object.assign(n,u.intl.options),r.push({replacePart:u.intl.part,force1Digit:h,force2Digits:g,force0forMidnight:p})),s=c;break}}i||(r.push(this.unescapeQuotes(l[s])),s+=1)}return{intlOptions:n,parts:r}},t.stripUnsupported=function(e){if(!this.unsupportedMask)return e;for(var t=e,i=0;i<this.unsupportedMask.length;i++)t=t.replace(this.unsupportedMask[i],"");return t},t.escapeQuotes=function(e){return e&&e.replace(X,Z)},t.unescapeQuotes=function(e){return e&&e.replace(ee,Y)},t.didValuesChange=function(e,t){var i={change:!1,newOptions:t,oldOptions:e};return Object.keys(t).reduce(this.didValuesChangeReducer,i),(t.hourCycle||e.hourCycle)&&!!t.hour12!=!!e.hour12&&(i.change=!0),i.change},t.didValuesChangeReducer=function(e,t){return e.change||e.oldOptions[t]&&e.oldOptions[t]!==e.newOptions[t]&&(e.change=!0),e},t.partsToObject=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i].type;"literal"!==n&&(t[n]=e[i].value)}return t},t.applyFormat=function(e,t){for(var i=this.getPartValues(e.intlOptions,t),n="",r=0;r<e.parts.length;r++)n=""+n+this.getValue(e.parts[r],i,t);return n.replace(/\s+/g," ").trim()},t.getValue=function(e,t,i){if("string"==typeof e)return e;var n=e.intlOptionsOverride?this.getPartValues(e.intlOptionsOverride,i):t,r=void 0;if(Array.isArray(e.replacePart))for(var s=0;s<e.replacePart.length;s++){var a=n[e.replacePart[s]];if(a){r=a;break}}else r=n[e.replacePart];return(e.force0forMidnight&&"24"===r&&(r="0"),e.force1Digit&&r&&"string"==typeof r&&2===r.length&&"0"===r[0])?r[1]:e.force2Digits&&r&&"string"==typeof r&&1===r.length?"0"+r:"string"==typeof r?r:""},t.getPartValues=function(e,t){var i=this.cachedDateTimeFormat.get(this.locale,e).formatToParts(t);return this.partsToObject(i)},e}(),ei=function(){function e(e){void 0===e&&(e="en-US"),this.locale=e,this.cachedDateTimeFormat=new H,this.formatter=void 0}var t=e.prototype;return t.formatDateTime=function(e,t){return"string"==typeof this.locale?this.cachedDateTimeFormat.get(this.locale,t).format(e):this.formatOsDateTime(e,t,this.locale)},t.formatOsDateTime=function(e,t,i){if(!i)throw Error("Cannot call the OS date and time formatter without specifying the OS locale info.");switch(!this.formatter&&(this.formatter=new et(i.regionalFormat,i.platform,this.cachedDateTimeFormat)),n="string"==typeof this.locale?this.locale:this.locale.regionalFormat,t){case r:if(!i.shortTime)throw Error("localeInfo.shortTime was not provided!");return this.formatter.timeToString(e,i.shortTime);case s:case c:case a:if(!i.shortDate)throw Error("localeInfo.shortDate was not provided!");return this.formatter.dateToString(e,i.shortDate);case l:if(!i.shortDate||!i.longTime)throw Error("localeInfo.shortDate or localeInfo.longTime was not provided!");var n,L=this.formatter.dateToString(e,i.shortDate),F=this.formatter.timeToString(e,i.longTime);return this.combineDateAndTime(L,F);case O:case k:case o:if(!i.shortDate||!i.shortTime)throw Error("localeInfo.shortDate or localeInfo.shortTime was not provided!");var U=this.formatter.dateToString(e,i.shortDate),$=this.formatter.timeToString(e,i.shortTime);return this.combineDateAndTime(U,$);case A:if(!i.shortTime)throw Error("localeInfo.shortTime was not provided!");if("macos"===i.platform){var V=i.shortTime.includes("a");return this.formatter.timeToString(e,V?"h a":"H")}var B=i.shortTime.includes("tt"),H=i.shortTime.includes("t");return this.formatter.timeToString(e,B?"h tt":H?"h t":"H");case C:case E:case h:case g:if(!i.longTime)throw Error("localeInfo.longTime was not provided!");var j=this.formatter.timeToString(e,i.longTime);return t===g||t===C?this.ensureTimeZone(j,e,i.longTime,t,i):j;case P:case w:if(!i.longDate||!i.longTime)throw Error("localeInfo.longDate or localeInfo.longTime was not provided!");var q=this.formatter.dateToString(e,i.longDate),W=this.formatter.timeToString(e,i.longTime);return this.combineDateAndTime(q,W);case R:if(!i.shortTime)throw Error("localeInfo.shortTime was not provided!");return this.cachedDateTimeFormat.get(n,_).format(e)+", "+this.formatter.timeToString(e,i.shortTime);case b:case T:var G=i.longDate;if(i.fullDate&&"UNKNOWN"!==i.fullDate&&(G=i.fullDate),!G||!i.longTime)throw Error("localeInfo.longDate or localeInfo.longTime was not provided!");var z=this.formatter.dateToString(e,G),J=this.formatter.timeToString(e,i.longTime),K=this.ensureTimeZone(J,e,i.longTime,t,i);return this.combineDateAndTime(z,K);case m:case v:return this.cachedDateTimeFormat.get(n,t).format(e);case D:case x:if(!i.longDate||!i.longTime)throw Error("localeInfo.longDate or localeInfo.longTime was not provided!");return(t===D?this.cachedDateTimeFormat.get(n,m).format(e):this.cachedDateTimeFormat.get(n,v).format(e))+", "+this.formatter.timeToString(e,i.longTime);case M:case N:if(!i.shortTime)throw Error("localeInfo.shortTime was not provided!");return(t===M?this.cachedDateTimeFormat.get(n,m).format(e):this.cachedDateTimeFormat.get(n,v).format(e))+", "+this.formatter.timeToString(e,i.shortTime);case _:case d:case I:case u:if(!i.longDate)throw Error("localeInfo.longDate was not provided!");return this.formatter.dateToString(e,i.longDate);case y:case S:if(i.fullDate&&"UNKNOWN"!==i.fullDate)return this.formatter.dateToString(e,i.fullDate);if(!i.longDate)throw Error("localeInfo.longDate was not provided!");return this.formatter.dateToString(e,i.longDate);case p:case f:if(!i.longDate||!i.longTime)throw Error("localeInfo.longDate or localeInfo.longTime was not provided!");var Q=this.formatter.dateToString(e,i.longDate),Y=this.formatter.timeToString(e,i.longTime),Z=this.ensureTimeZone(Y,e,i.longTime,t,i);return this.combineDateAndTime(Q,Z)}var X=void 0;try{X=JSON.stringify(t)}catch(e){}throw Error("Incorrect OS locale info format specified:"+(X||t))},t.combineDateAndTime=function(e,t){return e+" "+t},t.ensureTimeZone=function(e,t,i,n,r){var s,a;return null!=(s=this.formatter)&&s.timeHasTimeZone(i)?e:e+" "+(null==(a=this.formatter)?void 0:a.getTimeZoneName(t,n))},e}()},58366:function(e,t,i){"use strict";i.d(t,{RM:()=>u,jz:()=>f});var n=function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r="undefined"==typeof window?i.g:window,s=r&&r.CSPSettings&&r.CSPSettings.nonce,a=d(),o=/[\'\"]\[theme:\s*(\w+)\s*(?:\,\s*default:\s*([\\"\']?[\.\,\(\)\#\-\s\w]*[\.\,\(\)\#\-\w][\"\']?))?\s*\][\'\"]/g,l=function(){return"undefined"!=typeof performance&&performance.now?performance.now():Date.now()};function c(e){var t=l();e();var i=l();a.perf.duration+=i-t}function d(){var e=r.__themeState__||{theme:void 0,lastStyleElement:void 0,registeredStyles:[]};return e.runState||(e=n({},e,{perf:{count:0,duration:0},runState:{flushTimer:0,mode:0,buffer:[]}})),e.registeredThemableStyles||(e=n({},e,{registeredThemableStyles:[]})),r.__themeState__=e,e}function u(e,t){void 0===t&&(t=!1),c(function(){var i=Array.isArray(e)?e:C(e),n=a.runState,r=n.mode,s=n.buffer,o=n.flushTimer;t||1===r?(s.push(i),o||(a.runState.flushTimer=g())):p(i)})}function h(){c(function(){var e=a.runState.buffer.slice();a.runState.buffer=[];var t=[].concat.apply([],e);t.length>0&&p(t)})}function g(){return setTimeout(function(){a.runState.flushTimer=0,h()},0)}function p(e,t){a.loadStyles?a.loadStyles(y(e).styleString,e):b(e)}function f(e){a.theme=e,S()}function m(e){void 0===e&&(e=3),(3===e||2===e)&&(v(a.registeredStyles),a.registeredStyles=[]),(3===e||1===e)&&(v(a.registeredThemableStyles),a.registeredThemableStyles=[])}function v(e){e.forEach(function(e){var t=e&&e.styleElement;t&&t.parentElement&&t.parentElement.removeChild(t)})}function S(){if(a.theme){for(var e=[],t=0,i=a.registeredThemableStyles;t<i.length;t++){var n=i[t];e.push(n.themableStyle)}e.length>0&&(m(1),p([].concat.apply([],e)))}}function y(e){var t=a.theme,i=!1;return{styleString:(e||[]).map(function(e){var n=e.theme;if(!n)return e.rawString;i=!0;var r=t?t[n]:void 0,s=e.defaultValue||"inherit";return t&&!r&&console&&!(n in t)&&"undefined"!=typeof DEBUG&&DEBUG&&console.warn('Theming value not provided for "'+n+'". Falling back to "'+s+'".'),r||s}).join(""),themable:i}}function C(e){var t=[];if(e){for(var i=0,n=void 0;n=o.exec(e);){var r=n.index;r>i&&t.push({rawString:e.substring(i,r)}),t.push({theme:n[1],defaultValue:n[2]}),i=o.lastIndex}t.push({rawString:e.substring(i)})}return t}function b(e){if("undefined"!=typeof document){var t=document.getElementsByTagName("head")[0],i=document.createElement("style"),n=y(e),r=n.styleString,o=n.themable;i.setAttribute("data-load-themed-styles","true"),i.type="text/css",s&&i.setAttribute("nonce",s),i.appendChild(document.createTextNode(r)),a.perf.count++,t.appendChild(i);var l=document.createEvent("HTMLEvents");l.initEvent("styleinsert",!0,!1),l.args={newStyle:i},document.dispatchEvent(l);var c={styleElement:i,themableStyle:e};o?a.registeredThemableStyles.push(c):a.registeredStyles.push(c)}}},363592:function(e,t,i){"use strict";i.d(t,{JQ:()=>y,j4:()=>C,qc:()=>S});var n=i(632735),r=i(701914),s=i(256784),a=i.n(s),o=Object.defineProperty,l=Object.defineProperties,c=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,g=(e,t,i)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,p=(e,t)=>{for(var i in t||(t={}))u.call(t,i)&&g(e,i,t[i]);if(d)for(var i of d(t))h.call(t,i)&&g(e,i,t[i]);return e},f=(e,t)=>l(e,c(t)),m=(e,t,i)=>new Promise((n,r)=>{var s=e=>{try{o(i.next(e))}catch(e){r(e)}},a=e=>{try{o(i.throw(e))}catch(e){r(e)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,a);o((i=i.apply(e,t)).next())}),v=n.createContext({}),S=({children:e,eventing:t,unmountEventing:i,reactEventMapper:r})=>{let s=n.useRef(t);s.current!==t&&(s.current=t);let a=n.useRef(i||t);a.current!==i&&(a.current=i||t);let o=n.useRef(r);o.current!==r&&(o.current=r);let l=n.useMemo(()=>({bubble:e=>m(void 0,null,function*(){return T(s,o.current(e))}),generateEvent:E(s)}),[]),c=n.useMemo(()=>({bubble:e=>m(void 0,null,function*(){return T(a,o.current(e))}),generateEvent:E(a)}),[]),d=n.useMemo(()=>({eventing:l,unmountEventing:c,internal:{eventingRef:s,unmountEventingRef:a,mapperRef:o}}),[l,c]);return n.createElement(v.Provider,{value:d},e)};S.displayName="NovaEventingProvider";var y=()=>{let{eventing:e}=n.useContext(v);return a()(e,"Nova Eventing provider must be initialized prior to consumption of eventing!"),e},C=({children:e,interceptor:t})=>{let i=n.useRef(t);i.current!==t&&(i.current=t);let{internal:r}=n.useContext(v);r||a()(r,"Nova Eventing provider must be initialized prior to creating NovaEventingInterceptor!");let s=n.useMemo(()=>({bubble:e=>m(void 0,null,function*(){let t=r.mapperRef.current(e);return T(r.eventingRef,t,i)}),generateEvent:E(r.eventingRef,i)}),[r]),o=n.useMemo(()=>({bubble:e=>m(void 0,null,function*(){let t=r.mapperRef.current(e);return T(r.unmountEventingRef,t,i)}),generateEvent:E(r.unmountEventingRef,i)}),[r]),{eventing:l,unmountEventing:c}=n.useMemo(()=>b(r,i),[r]),d=n.useRef(l),u=n.useRef(c),h=n.useMemo(()=>f(p({},r),{eventingRef:d,unmountEventingRef:u}),[r]),g=n.useMemo(()=>({eventing:s,unmountEventing:o,internal:h}),[s,o,h]);return n.createElement(v.Provider,{value:g},e)};C.displayName="NovaEventingInterceptor";var b=(e,t)=>({eventing:{bubble:i=>m(void 0,null,function*(){return T(e.eventingRef,i,t)})},unmountEventing:{bubble:i=>m(void 0,null,function*(){return T(e.unmountEventingRef,i,t)})}}),T=(e,t,i)=>m(void 0,null,function*(){if(!i)return e.current.bubble(t);let n=t;return(n=yield i.current(t))?e.current.bubble(n):Promise.resolve()}),E=(e,t)=>i=>m(void 0,null,function*(){var n;let s={event:i.event,source:{inputType:r.n.programmatic,timeStamp:null!=(n=i.timeStampOverride)?n:Date.now()}};if(!t)return e.current.bubble(s);let a=s;return(a=yield t.current(s))?e.current.bubble(a):Promise.resolve()})},745510:function(e,t,i){"use strict";i.d(t,{b:()=>o});var n=i(701914),r={dblclick:n.n.mouse,keydown:n.n.keyboard,keyup:n.n.keyboard,keypress:n.n.keyboard,mousedown:n.n.mouse,mouseenter:n.n.mouse,mouseleave:n.n.mouse,mousemove:n.n.mouse,mouseover:n.n.mouse,mouseout:n.n.mouse,mouseup:n.n.mouse,touchcancel:n.n.touch,touchend:n.n.touch,touchmove:n.n.touch,touchstart:n.n.touch,wheel:n.n.mouse},s={"":n.n.keyboard,mouse:n.n.mouse,pen:n.n.pen,touch:n.n.touch},a=e=>{let t=s[e];return null!=t?t:n.n.unknown},o=e=>{let t,{event:i,reactEvent:s}=e,o="click"===s.type?a(s.nativeEvent.pointerType):r[s.type],l=s.nativeEvent;return t=(null==l?void 0:l.view)&&s.timeStamp?l.view.performance.timeOrigin+s.timeStamp:Date.now(),{event:i,source:{inputType:null!=o?o:n.n.unknown,timeStamp:t}}}},466818:function(e,t,i){"use strict";i.d(t,{Db:()=>c,Jc:()=>o,mU:()=>l,pp:()=>a});var n=i(384306),r=i(256784),s=i.n(r);function a(e,t,i){let r=(0,n.a)();return s()(r.useLazyLoadQuery,"Expected host to provide a useLazyLoadQuery hook"),r.useLazyLoadQuery(e,t,i)}function o(e,t){var i,r;return(null==(r=(i=(0,n.a)()).useFragment)?void 0:r.call(i,e,t))||t}function l(e){let t=(0,n.a)();s()(t.useSubscription,"Expected host to provide a useSubscription hook"),t.useSubscription(e)}function c(e){let t=(0,n.a)();return s()(t.useMutation,"Expected host to provide a useMutation hook"),t.useMutation(e)}},384306:function(e,t,i){"use strict";i.d(t,{a:()=>l,g:()=>o});var n=i(632735),r=i(256784),s=i.n(r),a=n.createContext(null),o=({children:e,graphql:t})=>n.createElement(a.Provider,{value:t},e);o.displayName="NovaGraphQLProvider";var l=()=>{let e=n.useContext(a);return s()(null!==e,"Nova GraphQL provider must be initialized prior to consumption!"),e}},701914:function(e,t,i){"use strict";i.d(t,{n:()=>n});var n={unknown:"unknown",mouse:"mouse",keyboard:"keyboard",touch:"touch",pen:"pen",programmatic:"programmatic"}},821996:function(e,t,i){"use strict";function n(e,t){var i=!!(t.getRootNode&&t.getRootNode().host);if(e.contains(t))return!0;if(i){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}i.d(t,{Z:()=>n})},748934:function(e,t,i){"use strict";function n(e){var t=e.getBoundingClientRect();return{width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left,x:t.left,y:t.top}}i.d(t,{Z:()=>n})},353578:function(e,t,i){"use strict";i.d(t,{Z:()=>r});var n=i(956441);function r(e){return(0,n.Z)(e).getComputedStyle(e)}},21277:function(e,t,i){"use strict";i.d(t,{Z:()=>r});var n=i(67002);function r(e){return((0,n.k)(e)?e.ownerDocument:e.document).documentElement}},497123:function(e,t,i){"use strict";function n(e){return e?(e.nodeName||"").toLowerCase():null}i.d(t,{Z:()=>n})},163553:function(e,t,i){"use strict";i.d(t,{Z:()=>u});var n=i(956441),r=i(497123),s=i(353578),a=i(67002);function o(e){return["table","td","th"].indexOf((0,r.Z)(e))>=0}var l=i(438021);function c(e){return(0,a.R)(e)&&"fixed"!==(0,s.Z)(e).position?e.offsetParent:null}function d(e){for(var t=(0,l.Z)(e);(0,a.R)(t)&&0>["html","body"].indexOf((0,r.Z)(t));){var i=(0,s.Z)(t);if("none"!==i.transform||"none"!==i.perspective||"auto"!==i.willChange)return t;t=t.parentNode}return null}function u(e){for(var t=(0,n.Z)(e),i=c(e);i&&o(i)&&"static"===(0,s.Z)(i).position;)i=c(i);return i&&"body"===(0,r.Z)(i)&&"static"===(0,s.Z)(i).position?t:i||d(e)||t}},438021:function(e,t,i){"use strict";i.d(t,{Z:()=>s});var n=i(497123),r=i(21277);function s(e){return"html"===(0,n.Z)(e)?e:e.assignedSlot||e.parentNode||e.host||(0,r.Z)(e)}},956441:function(e,t,i){"use strict";function n(e){if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t?t.defaultView:window}return e}i.d(t,{Z:()=>n})},301004:function(e,t,i){"use strict";i.d(t,{Z:()=>r});var n=i(956441);function r(e){var t=(0,n.Z)(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}},211085:function(e,t,i){"use strict";i.d(t,{Z:()=>a});var n=i(748934),r=i(21277),s=i(301004);function a(e){return(0,n.Z)((0,r.Z)(e)).left+(0,s.Z)(e).scrollLeft}},67002:function(e,t,i){"use strict";i.d(t,{R:()=>s,k:()=>r});var n=i(956441);function r(e){var t=(0,n.Z)(e).Element;return e instanceof t||e instanceof Element}function s(e){var t=(0,n.Z)(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}},691005:function(e,t,i){"use strict";i.d(t,{Z:()=>r});var n=i(353578);function r(e){var t=(0,n.Z)(e),i=t.overflow,r=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+s+r)}},883301:function(e,t,i){"use strict";i.d(t,{Z:()=>c});var n=i(438021),r=i(691005),s=i(497123),a=i(67002);function o(e){return["html","body","#document"].indexOf((0,s.Z)(e))>=0?e.ownerDocument.body:(0,a.R)(e)&&(0,r.Z)(e)?e:o((0,n.Z)(e))}var l=i(956441);function c(e,t){void 0===t&&(t=[]);var i=o(e),a="body"===(0,s.Z)(i),d=(0,l.Z)(i),u=a?[d].concat(d.visualViewport||[],(0,r.Z)(i)?i:[]):i,h=t.concat(u);return a?h:h.concat(c((0,n.Z)(u)))}},569399:function(e,t,i){"use strict";i.d(t,{BL:()=>c,Ct:()=>m,F2:()=>s,I:()=>r,Pj:()=>h,YP:()=>p,bw:()=>f,d7:()=>o,k5:()=>g,mv:()=>l,t$:()=>a,ut:()=>d,we:()=>n,xs:()=>v,zV:()=>u});var n="top",r="bottom",s="right",a="left",o="auto",l=[n,r,s,a],c="start",d="end",u="clippingParents",h="viewport",g="popper",p="reference",f=l.reduce(function(e,t){return e.concat([t+"-"+c,t+"-"+d])},[]),m=[].concat(l,[o]).reduce(function(e,t){return e.concat([t,t+"-"+c,t+"-"+d])},[]),v=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"]},301444:function(e,t,i){"use strict";i.d(t,{fi:()=>ei});var n=i(748934),r=i(301004),s=i(956441),a=i(67002);function o(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function l(e){return e!==(0,s.Z)(e)&&(0,a.R)(e)?o(e):(0,r.Z)(e)}var c=i(497123),d=i(211085),u=i(21277),h=i(691005);function g(e,t,i){void 0===i&&(i=!1);var r=(0,u.Z)(t),s=(0,n.Z)(e),o=(0,a.R)(t),g={scrollLeft:0,scrollTop:0},p={x:0,y:0};return(o||!o&&!i)&&(("body"!==(0,c.Z)(t)||(0,h.Z)(r))&&(g=l(t)),(0,a.R)(t)?(p=(0,n.Z)(t),p.x+=t.clientLeft,p.y+=t.clientTop):r&&(p.x=(0,d.Z)(r))),{x:s.left+g.scrollLeft-p.x,y:s.top+g.scrollTop-p.y,width:s.width,height:s.height}}function p(e){return{x:e.offsetLeft,y:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}var f=i(883301),m=i(163553),v=i(569399);function S(e){var t=new Map,i=new Set,n=[];function r(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!i.has(e)){var n=t.get(e);n&&r(n)}}),n.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){i.has(e.name)||r(e)}),n}function y(e){var t=S(e);return v.xs.reduce(function(e,i){return e.concat(t.filter(function(e){return e.phase===i}))},[])}function C(e){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(e())})})),t}}function b(e){var t=e.reduce(function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign(Object.assign(Object.assign({},i),t),{},{options:Object.assign(Object.assign({},i.options),t.options),data:Object.assign(Object.assign({},i.data),t.data)}):t,e},{});return Object.keys(t).map(function(e){return t[e]})}var T={placement:"bottom",modifiers:[],strategy:"absolute"};function E(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function _(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,n=void 0===i?[]:i,r=t.defaultOptions,s=void 0===r?T:r;return function(e,t,i){void 0===i&&(i=s);var r={placement:"bottom",orderedModifiers:[],options:Object.assign(Object.assign({},T),s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],l=!1,c={state:r,setOptions:function(i){u(),r.options=Object.assign(Object.assign(Object.assign({},s),r.options),i),r.scrollParents={reference:(0,a.k)(e)?(0,f.Z)(e):e.contextElement?(0,f.Z)(e.contextElement):[],popper:(0,f.Z)(t)};var o=y(b([].concat(n,r.options.modifiers)));return r.orderedModifiers=o.filter(function(e){return e.enabled}),d(),c.update()},forceUpdate:function(){if(!l){var e=r.elements,t=e.reference,i=e.popper;if(E(t,i)){r.rects={reference:g(t,(0,m.Z)(i),"fixed"===r.options.strategy),popper:p(i)},r.reset=!1,r.placement=r.options.placement,r.orderedModifiers.forEach(function(e){return r.modifiersData[e.name]=Object.assign({},e.data)});for(var n=0;n<r.orderedModifiers.length;n++){if(!0===r.reset){r.reset=!1,n=-1;continue}var s=r.orderedModifiers[n],a=s.fn,o=s.options,d=void 0===o?{}:o,u=s.name;"function"==typeof a&&(r=a({state:r,options:d,name:u,instance:c})||r)}}}},update:C(function(){return new Promise(function(e){c.forceUpdate(),e(r)})}),destroy:function(){u(),l=!0}};if(!E(e,t))return c;function d(){r.orderedModifiers.forEach(function(e){var t=e.name,i=e.options,n=void 0===i?{}:i,s=e.effect;if("function"==typeof s){var a=s({state:r,name:t,instance:c,options:n}),l=function(){};o.push(a||l)}})}function u(){o.forEach(function(e){return e()}),o=[]}return c.setOptions(i).then(function(e){!l&&i.onFirstUpdate&&i.onFirstUpdate(e)}),c}}var I={passive:!0};let w={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,n=e.options,r=n.scroll,a=void 0===r||r,o=n.resize,l=void 0===o||o,c=(0,s.Z)(t.elements.popper),d=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&d.forEach(function(e){e.addEventListener("scroll",i.update,I)}),l&&c.addEventListener("resize",i.update,I),function(){a&&d.forEach(function(e){e.removeEventListener("scroll",i.update,I)}),l&&c.removeEventListener("resize",i.update,I)}},data:{}};var P=i(541279);let R={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=(0,P.Z)({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};var A=i(310415),M={top:"auto",right:"auto",bottom:"auto",left:"auto"};function D(e,t){var i=e.x,n=e.y,r=t.devicePixelRatio||1;return{x:Math.round(i*r)/r||0,y:Math.round(n*r)/r||0}}function O(e){var t,i,n=e.popper,r=e.popperRect,a=e.placement,o=e.offsets,l=e.position,c=e.gpuAcceleration,d=e.adaptive,h=D(o,(0,s.Z)(n)),g=h.x,p=h.y,f=o.hasOwnProperty("x"),S=o.hasOwnProperty("y"),y=v.t$,C=v.we,b=window;if(d){var T=(0,m.Z)(n);T===(0,s.Z)(n)&&(T=(0,u.Z)(n)),a===v.we&&(C=v.I,p-=T.clientHeight-r.height,p*=c?1:-1),a===v.t$&&(y=v.F2,g-=T.clientWidth-r.width,g*=c?1:-1)}var E=Object.assign({position:l},d&&M);return c?Object.assign(Object.assign({},E),{},((i={})[C]=S?"0":"",i[y]=f?"0":"",i.transform=2>(b.devicePixelRatio||1)?"translate("+g+"px, "+p+"px)":"translate3d("+g+"px, "+p+"px, 0)",i)):Object.assign(Object.assign({},E),{},((t={})[C]=S?p+"px":"",t[y]=f?g+"px":"",t.transform="",t))}let k={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,n=i.gpuAcceleration,r=void 0===n||n,s=i.adaptive,a=void 0===s||s,o={placement:(0,A.Z)(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign(Object.assign({},t.styles.popper),O(Object.assign(Object.assign({},o),{},{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign(Object.assign({},t.styles.arrow),O(Object.assign(Object.assign({},o),{},{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1})))),t.attributes.popper=Object.assign(Object.assign({},t.attributes.popper),{},{"data-popper-placement":t.placement})},data:{}},N={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var i=t.styles[e]||{},n=t.attributes[e]||{},r=t.elements[e];(0,a.R)(r)&&(0,c.Z)(r)&&(Object.assign(r.style,i),Object.keys(n).forEach(function(e){var t=n[e];!1===t?r.removeAttribute(e):r.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(e){var n=t.elements[e],r=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce(function(e,t){return e[t]="",e},{});(0,a.R)(n)&&(0,c.Z)(n)&&(Object.assign(n.style,s),Object.keys(r).forEach(function(e){n.removeAttribute(e)}))})}},requires:["computeStyles"]};function x(e,t,i){var n=(0,A.Z)(e),r=[v.t$,v.we].indexOf(n)>=0?-1:1,s="function"==typeof i?i(Object.assign(Object.assign({},t),{},{placement:e})):i,a=s[0],o=s[1];return a=a||0,o=(o||0)*r,[v.t$,v.F2].indexOf(n)>=0?{x:o,y:a}:{x:a,y:o}}let L={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,i=e.options,n=e.name,r=i.offset,s=void 0===r?[0,0]:r,a=v.Ct.reduce(function(e,i){return e[i]=x(i,t.rects,s),e},{}),o=a[t.placement],l=o.x,c=o.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[n]=a}};var F={left:"right",right:"left",bottom:"top",top:"bottom"};function U(e){return e.replace(/left|right|bottom|top/g,function(e){return F[e]})}var $={start:"end",end:"start"};function V(e){return e.replace(/start|end/g,function(e){return $[e]})}var B=i(192045),H=i(589163);function j(e,t){void 0===t&&(t={});var i=t,n=i.placement,r=i.boundary,s=i.rootBoundary,a=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,c=void 0===l?v.Ct:l,d=(0,H.Z)(n),u=(d?o?v.bw:v.bw.filter(function(e){return(0,H.Z)(e)===d}):v.mv).filter(function(e){return c.indexOf(e)>=0}).reduce(function(t,i){return t[i]=(0,B.Z)(e,{placement:i,boundary:r,rootBoundary:s,padding:a})[(0,A.Z)(i)],t},{});return Object.keys(u).sort(function(e,t){return u[e]-u[t]})}function q(e){if((0,A.Z)(e)===v.d7)return[];var t=U(e);return[V(e),t,V(t)]}let W={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var r=i.mainAxis,s=void 0===r||r,a=i.altAxis,o=void 0===a||a,l=i.fallbackPlacements,c=i.padding,d=i.boundary,u=i.rootBoundary,h=i.altBoundary,g=i.flipVariations,p=void 0===g||g,f=i.allowedAutoPlacements,m=t.options.placement,S=(0,A.Z)(m),y=S===m,C=l||(y||!p?[U(m)]:q(m)),b=[m].concat(C).reduce(function(e,i){return e.concat((0,A.Z)(i)===v.d7?j(t,{placement:i,boundary:d,rootBoundary:u,padding:c,flipVariations:p,allowedAutoPlacements:f}):i)},[]),T=t.rects.reference,E=t.rects.popper,_=new Map,I=!0,w=b[0],P=0;P<b.length;P++){var R=b[P],M=(0,A.Z)(R),D=(0,H.Z)(R)===v.BL,O=[v.we,v.I].indexOf(M)>=0,k=O?"width":"height",N=(0,B.Z)(t,{placement:R,boundary:d,rootBoundary:u,altBoundary:h,padding:c}),x=O?D?v.F2:v.t$:D?v.I:v.we;T[k]>E[k]&&(x=U(x));var L=U(x),F=[];if(s&&F.push(N[M]<=0),o&&F.push(N[x]<=0,N[L]<=0),F.every(function(e){return e})){w=R,I=!1;break}_.set(R,F)}if(I)for(var $=p?3:1,V=function(e){var t=b.find(function(t){var i=_.get(t);if(i)return i.slice(0,e).every(function(e){return e})});if(t)return w=t,"break"},W=$;W>0&&"break"!==V(W);W--);t.placement!==w&&(t.modifiersData[n]._skip=!0,t.placement=w,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};var G=i(793168);function z(e){return"x"===e?"y":"x"}function J(e,t,i){return Math.max(e,Math.min(t,i))}var K=i(723083);let Q={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,n=e.name,r=i.mainAxis,s=void 0===r||r,a=i.altAxis,o=void 0!==a&&a,l=i.boundary,c=i.rootBoundary,d=i.altBoundary,u=i.padding,h=i.tether,g=void 0===h||h,f=i.tetherOffset,S=void 0===f?0:f,y=(0,B.Z)(t,{boundary:l,rootBoundary:c,padding:u,altBoundary:d}),C=(0,A.Z)(t.placement),b=(0,H.Z)(t.placement),T=!b,E=(0,G.Z)(C),_=z(E),I=t.modifiersData.popperOffsets,w=t.rects.reference,P=t.rects.popper,R="function"==typeof S?S(Object.assign(Object.assign({},t.rects),{},{placement:t.placement})):S,M={x:0,y:0};if(I){if(s){var D="y"===E?v.we:v.t$,O="y"===E?v.I:v.F2,k="y"===E?"height":"width",N=I[E],x=I[E]+y[D],L=I[E]-y[O],F=g?-P[k]/2:0,U=b===v.BL?w[k]:P[k],$=b===v.BL?-P[k]:-w[k],V=t.elements.arrow,j=g&&V?p(V):{width:0,height:0},q=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:(0,K.Z)(),W=q[D],Q=q[O],Y=J(0,w[k],j[k]),Z=T?w[k]/2-F-Y-W-R:U-Y-W-R,X=T?-w[k]/2+F+Y+Q+R:$+Y+Q+R,ee=t.elements.arrow&&(0,m.Z)(t.elements.arrow),et=ee?"y"===E?ee.clientTop||0:ee.clientLeft||0:0,ei=t.modifiersData.offset?t.modifiersData.offset[t.placement][E]:0,en=I[E]+Z-ei-et,er=I[E]+X-ei,es=J(g?Math.min(x,en):x,N,g?Math.max(L,er):L);I[E]=es,M[E]=es-N}if(o){var ea="x"===E?v.we:v.t$,eo="x"===E?v.I:v.F2,el=I[_],ec=el+y[ea],ed=el-y[eo],eu=J(ec,el,ed);I[_]=eu,M[_]=eu-el}t.modifiersData[n]=M}},requiresIfExists:["offset"]};var Y=i(821996),Z=i(936880),X=i(14746);function ee(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function et(e){return[v.we,v.F2,v.I,v.t$].some(function(t){return e[t]>=0})}var ei=_({defaultModifiers:[w,R,k,N,L,W,Q,{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i=e.state,n=e.name,r=i.elements.arrow,s=i.modifiersData.popperOffsets,a=(0,A.Z)(i.placement),o=(0,G.Z)(a),l=[v.t$,v.F2].indexOf(a)>=0?"height":"width";if(r&&s){var c=i.modifiersData[n+"#persistent"].padding,d=p(r),u="y"===o?v.we:v.t$,h="y"===o?v.I:v.F2,g=i.rects.reference[l]+i.rects.reference[o]-s[o]-i.rects.popper[l],f=s[o]-i.rects.reference[o],S=(0,m.Z)(r),y=S?"y"===o?S.clientHeight||0:S.clientWidth||0:0,C=g/2-f/2,b=c[u],T=y-d[l]-c[h],E=y/2-d[l]/2+C,_=J(b,E,T),I=o;i.modifiersData[n]=(t={},t[I]=_,t.centerOffset=_-E,t)}},effect:function(e){var t=e.state,i=e.options,n=e.name,r=i.element,s=void 0===r?"[data-popper-arrow]":r,a=i.padding,o=void 0===a?0:a;if(null!=s){if("string"==typeof s&&!(s=t.elements.popper.querySelector(s))||!(0,Y.Z)(t.elements.popper,s))return;t.elements.arrow=s,t.modifiersData[n+"#persistent"]={padding:(0,Z.Z)("number"!=typeof o?o:(0,X.Z)(o,v.mv))}}},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,i=e.name,n=t.rects.reference,r=t.rects.popper,s=t.modifiersData.preventOverflow,a=(0,B.Z)(t,{elementContext:"reference"}),o=(0,B.Z)(t,{altBoundary:!0}),l=ee(a,n),c=ee(o,r,s),d=et(l),u=et(c);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign(Object.assign({},t.attributes.popper),{},{"data-popper-reference-hidden":d,"data-popper-escaped":u})}}]})},541279:function(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(310415),r=i(589163),s=i(793168),a=i(569399);function o(e){var t,i=e.reference,o=e.element,l=e.placement,c=l?(0,n.Z)(l):null,d=l?(0,r.Z)(l):null,u=i.x+i.width/2-o.width/2,h=i.y+i.height/2-o.height/2;switch(c){case a.we:t={x:u,y:i.y-o.height};break;case a.I:t={x:u,y:i.y+i.height};break;case a.F2:t={x:i.x+i.width,y:h};break;case a.t$:t={x:i.x-o.width,y:h};break;default:t={x:i.x,y:i.y}}var g=c?(0,s.Z)(c):null;if(null!=g){var p="y"===g?"height":"width";switch(d){case a.BL:t[g]=Math.floor(t[g])-Math.floor(i[p]/2-o[p]/2);break;case a.ut:t[g]=Math.floor(t[g])+Math.ceil(i[p]/2-o[p]/2)}}return t}},192045:function(e,t,i){"use strict";i.d(t,{Z:()=>_});var n=i(748934),r=i(569399),s=i(956441),a=i(21277),o=i(211085);function l(e){var t=(0,s.Z)(e),i=(0,a.Z)(e),n=t.visualViewport,r=i.clientWidth,l=i.clientHeight,c=0,d=0;return n&&(r=n.width,l=n.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(c=n.offsetLeft,d=n.offsetTop)),{width:r,height:l,x:c+(0,o.Z)(e),y:d}}var c=i(353578),d=i(301004);function u(e){var t=(0,a.Z)(e),i=(0,d.Z)(e),n=e.ownerDocument.body,r=Math.max(t.scrollWidth,t.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=Math.max(t.scrollHeight,t.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),l=-i.scrollLeft+(0,o.Z)(e),u=-i.scrollTop;return"rtl"===(0,c.Z)(n||t).direction&&(l+=Math.max(t.clientWidth,n?n.clientWidth:0)-r),{width:r,height:s,x:l,y:u}}var h=i(883301),g=i(163553),p=i(67002),f=i(821996);function m(e){return Object.assign(Object.assign({},e),{},{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function v(e){var t=(0,n.Z)(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}function S(e,t){return t===r.Pj?m(l(e)):(0,p.R)(t)?v(t):m(u((0,a.Z)(e)))}function y(e){var t=(0,h.Z)(e),i=["absolute","fixed"].indexOf((0,c.Z)(e).position)>=0&&(0,p.R)(e)?(0,g.Z)(e):e;return(0,p.k)(i)?t.filter(function(e){return(0,p.k)(e)&&(0,f.Z)(e,i)}):[]}function C(e,t,i){var n=[].concat("clippingParents"===t?y(e):[].concat(t),[i]),r=n[0],s=n.reduce(function(t,i){var n=S(e,i);return t.top=Math.max(n.top,t.top),t.right=Math.min(n.right,t.right),t.bottom=Math.min(n.bottom,t.bottom),t.left=Math.max(n.left,t.left),t},S(e,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var b=i(541279),T=i(936880),E=i(14746);function _(e,t){void 0===t&&(t={});var i=t,s=i.placement,o=void 0===s?e.placement:s,l=i.boundary,c=void 0===l?r.zV:l,d=i.rootBoundary,u=void 0===d?r.Pj:d,h=i.elementContext,g=void 0===h?r.k5:h,f=i.altBoundary,v=void 0!==f&&f,S=i.padding,y=void 0===S?0:S,_=(0,T.Z)("number"!=typeof y?y:(0,E.Z)(y,r.mv)),I=g===r.k5?r.YP:r.k5,w=e.elements.reference,P=e.rects.popper,R=e.elements[v?I:g],A=C((0,p.k)(R)?R:R.contextElement||(0,a.Z)(e.elements.popper),c,u),M=(0,n.Z)(w),D=(0,b.Z)({reference:M,element:P,strategy:"absolute",placement:o}),O=m(Object.assign(Object.assign({},P),D)),k=g===r.k5?O:M,N={top:A.top-k.top+_.top,bottom:k.bottom-A.bottom+_.bottom,left:A.left-k.left+_.left,right:k.right-A.right+_.right},x=e.modifiersData.offset;if(g===r.k5&&x){var L=x[o];Object.keys(N).forEach(function(e){var t=[r.F2,r.I].indexOf(e)>=0?1:-1,i=[r.we,r.I].indexOf(e)>=0?"y":"x";N[e]+=L[i]*t})}return N}},14746:function(e,t,i){"use strict";function n(e,t){return t.reduce(function(t,i){return t[i]=e,t},{})}i.d(t,{Z:()=>n})},310415:function(e,t,i){"use strict";function n(e){return e.split("-")[0]}i.d(t,{Z:()=>n})},723083:function(e,t,i){"use strict";function n(){return{top:0,right:0,bottom:0,left:0}}i.d(t,{Z:()=>n})},793168:function(e,t,i){"use strict";function n(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}i.d(t,{Z:()=>n})},589163:function(e,t,i){"use strict";function n(e){return e.split("-")[1]}i.d(t,{Z:()=>n})},936880:function(e,t,i){"use strict";i.d(t,{Z:()=>r});var n=i(723083);function r(e){return Object.assign(Object.assign({},(0,n.Z)()),e)}},530378:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TraceLevel=void 0,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info"}(i=t.TraceLevel||(t.TraceLevel={}))},651758:function(e,t){"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTrackingOption=t.ConnectionState=t.ServiceGeneratedClientIdName=t.SystemCommandsStateName=t.ConfigurationName=t.SystemSessionStateName=t.StateSubscriptionsName=void 0,t.StateSubscriptionsName="ConfigStateSubscriptions",t.SystemSessionStateName="systemSessionState",t.ConfigurationName="config",t.SystemCommandsStateName="systemCommands",t.ServiceGeneratedClientIdName="serviceGeneratedClientId",function(e){e[e.Disconnected=0]="Disconnected",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting"}(i=t.ConnectionState||(t.ConnectionState={})),function(e){e[e.All=0]="All",e[e.Last=1]="Last",e[e.None=2]="None"}(n=t.MessageTrackingOption||(t.MessageTrackingOption={}))},424663:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){function r(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):r(e.value).then(a,o)}l((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return l([e,t])}}function l(s){if(i)throw TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleSyncCell=void 0;var s=i(697531),a=i(324819),o=i(651758);t.SimpleSyncCell=function(){function e(e,t,i,n,r){this.m_id=e,this.m_sender=t,this.m_shouldEmitEventForAllMessages=i,this.aggregation=r,this.m_events=new s.EventEmitter,this.m_emitUnacknowledgedEventFor=null!=n?n:o.MessageTrackingOption.None}return e.prototype.on=function(e,t){return this.m_events.on(e,t),this},e.prototype.off=function(e,t){return this.m_events.off(e,t),this},e.prototype.removeAllListeners=function(e){return this.m_events.removeAllListeners(e),this},e.prototype.id=function(){return this.m_id},e.prototype.messageTrackingOption=function(){return this.m_emitUnacknowledgedEventFor},e.prototype.getAsync=function(){return n(this,void 0,void 0,function(){return r(this,function(e){return[2,this.m_value]})})},e.prototype.setAsync=function(e){return n(this,void 0,void 0,function(){var t;return r(this,function(i){return this.m_value=e,t={messageId:a.v4(),senderId:this.m_sender.senderId(),objectId:this.m_id,type:"cell",operation:"set",value:JSON.stringify(this.m_value)},this.m_sender.sendStateMessage(t),[2]})})},e.prototype.delete=function(){this.m_value=void 0;var e={messageId:a.v4(),senderId:this.m_sender.senderId(),objectId:this.m_id,type:"cell",operation:"delete",value:""};this.m_sender.sendStateMessage(e)},e.prototype.handleStateMessage=function(e){switch(e.operation){case"set":(JSON.stringify(this.m_value)!==e.value||this.m_shouldEmitEventForAllMessages)&&(this.m_value=JSON.parse(e.value),this.m_events.emit("valueChanged",this.m_value,e));return;case"delete":this.m_value=void 0,this.m_events.emit("valueDeleted",this.m_value,e);return;default:return}},e.prototype.handleUnacknowledgedMessage=function(e){this.m_events.emit("valueUnacknowledged",e)},e.prototype.beginAggregatedStateUpdating=function(){var e;null==(e=this.aggregation)||e.beginAggregatedStateUpdating()},e.prototype.endAggregatedStateUpdating=function(){var e;null==(e=this.aggregation)||e.endAggregatedStateUpdating()},e}()},816354:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleSyncMap=void 0;var n=i(697531),r=i(324819),s=i(651758),a=i(642732);t.SimpleSyncMap=function(){function e(e,t,i,r,a){this.m_id=e,this.m_sender=t,this.m_shouldEmitEventForAllMessages=i,this.aggregation=a,this.m_events=new n.EventEmitter,this.m_map=new Map,this.m_emitUnacknowledgedEventFor=null!=r?r:s.MessageTrackingOption.None}return e.prototype.on=function(e,t){return this.m_events.on(e,t),this},e.prototype.off=function(e,t){return this.m_events.off(e,t),this},e.prototype.removeAllListeners=function(e){return this.m_events.removeAllListeners(e),this},e.prototype.id=function(){return this.m_id},e.prototype.messageTrackingOption=function(){return this.m_emitUnacknowledgedEventFor},e.prototype.get=function(e){return this.m_map.get(e)},e.prototype.set=function(e,t){this.m_map.set(e,t);var i={messageId:r.v4(),senderId:this.m_sender.senderId(),objectId:this.m_id,type:"map",operation:"set",property:e,value:JSON.stringify(t)};this.m_sender.sendStateMessage(i)},e.prototype.delete=function(e){var t={messageId:r.v4(),senderId:this.m_sender.senderId(),objectId:this.m_id,type:"map",operation:"delete",property:e,value:""};this.performLocalDelete(t),this.m_sender.sendStateMessage(t)},e.prototype.deleteWithPrefix=function(e){var t={messageId:r.v4(),senderId:this.m_sender.senderId(),objectId:this.m_id,type:"map",operation:"delete",property:e,value:"prefix"};this.performLocalDelete(t),this.m_sender.sendStateMessage(t)},e.prototype.forEach=function(e){this.m_map.forEach(e)},e.prototype.handleStateMessage=function(e){switch(e.operation){case"set":this.handleSet(e);return;case"delete":this.handleDelete(e);return;default:return}},e.prototype.handleSet=function(e){if(!e.property)throw Error("property is missing for a map.");(JSON.stringify(this.m_map.get(e.property))!==e.value||this.m_shouldEmitEventForAllMessages)&&(this.m_map.set(e.property,JSON.parse(e.value)),this.m_events.emit("valueChanged",e.property,e))},e.prototype.handleDelete=function(e){if(this.performLocalDelete(e),a.isPrefixDeleteMessage(e))return void this.m_events.emit("valuesDeletedWithPrefix",e.property,e);this.m_events.emit("valueDeleted",e.property||"",e)},e.prototype.handleUnacknowledgedMessage=function(e){this.m_events.emit("valueUnacknowledged",e)},e.prototype.beginAggregatedStateUpdating=function(){var e;null==(e=this.aggregation)||e.beginAggregatedStateUpdating()},e.prototype.endAggregatedStateUpdating=function(){var e;null==(e=this.aggregation)||e.endAggregatedStateUpdating()},e.prototype.performLocalDelete=function(e){var t=this;if(e.property){var i=e.property;a.isPrefixDeleteMessage(e)?this.m_map.forEach(function(e,n){n.startsWith(i)&&t.m_map.delete(n)}):this.m_map.delete(e.property)}else this.m_map.clear()},e}()},642732:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPrefixDeleteMessage=void 0,t.isPrefixDeleteMessage=function(e){return"delete"===e.operation&&"prefix"===e.value}},646646:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){function r(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):r(e.value).then(a,o)}l((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return l([e,t])}}function l(s){if(i)throw TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleStateServiceProxy=void 0;var o=a(i(106230)),l=i(697531),c=i(324819),d=i(675009),u=i(172448),h=i(530378),g=i(651758),p=i(424663),f=i(816354),m=i(983729),v=i(258162),S=[2e3,2e3,3e3,3e3,5e3],y=4321;t.SimpleStateServiceProxy=function(){function e(e,t,i,n,r,s){var a;this.m_events=new l.EventEmitter,this.m_clientId="",this.m_connectionState=g.ConnectionState.Disconnected,this.m_handlers=new Map,this.m_connection=null,this.m_clientIds=new Set,this.m_initTimeoutDurationInMS=0,this.m_retryAttempts=0,this.m_sessionRetryAttempts=0,this.m_maxSessionRetries=0,this.m_outboundMessageInfo=new Map,this.m_initPromise={promise:null,resolve:null,reject:null},this.m_messageBuffer=[],this.m_batchWaitTimeMS=20,this.m_batchMessageTypeName="list",this.m_closeConnectionTimer=null,this.m_lastCloseCode=0,this.m_lastCloseReason="",this.m_offlineMessageCache=[],this.m_unacknowledgedMessages=new Map,this.m_sessionId=e,this.m_logger=n,this.m_connectionAliveTimeAfterLoseFocusInMS=r.websocketAliveTimeAfterLoseFocusInMS,this.m_useServiceGeneratedClientId=r.useServiceGeneratedClientId||!1,this.m_wsUrl=i+"?docId="+this.m_sessionId+"&clientType="+t,r.correlationId&&(this.m_wsUrl+="&cid="+r.correlationId),r.isAutomation&&(this.m_wsUrl+="&automation=true"),r.autoRoutingEnabled&&(this.m_wsUrl+="&routing=true"),this.m_useServiceGeneratedClientId||(this.m_clientId=r.customClientId||c.v4(),this.m_wsUrl+="&clientId="+this.m_clientId),this.m_deltasBaseUrl=i.replace("wss://","https://").replace("ws://","http://"),this.setupSystemClientsCell(),this.setUpSystemCommandsCell(),this.setupServiceGeneratedClientIdCell(),this.m_useServiceGeneratedClientId&&(this.m_clientIdEvictingQueue=new u.EvictingQueue(20)),this.m_telemetry=new m.SimpleServiceTelemetry(this.m_clientId,this.m_sessionId,r.maxRoundtripRaw),this.m_verbose=r.verbose||!1,this.m_batchedRequestsEnabled=r.batchedRequestsEnabled,this.m_initTimeoutDurationInMS=r.initTimeoutDurationInMs||0,this.m_pingTimeoutInMs=r.pingTimeoutInMs,this.m_pongTimeoutInMs=r.pongTimeoutInMs,this.m_user=s,this.m_metadata=r.metadata,this.m_retryIntervalsInMs=r.retryIntervalsInMs||S,this.m_maxSessionRetries=r.maxSessionRetries,this.m_offlineMessageCacheEnabled=r.offlineMessageCacheEnabled,this.m_maxOfflineMessageCacheTimeInMs=r.maxOfflineMessageCacheTimeInMs,this.m_maxOfflineMessageCacheLength=r.maxOfflineMessageCacheLength,this.m_allowReconnectOnMessageSend=r.allowReconnectOnSendMessage||!1,this.m_unacknowledgedMaxTimeInMs=null!=(a=r.unacknowledgeMessageTimeoutInMs)?a:0,this.m_subscriptions=r.subscriptions,this.m_connectionSettings={getAuthTokenAsync:this.getAuthToken.bind(this),createSetupMessage:this.createSetupMessage.bind(this),metadata:this.m_metadata,subscriptions:this.m_subscriptions}}return Object.defineProperty(e.prototype,"lastCloseReason",{get:function(){return this.m_lastCloseReason},enumerable:!1,configurable:!0}),e.prototype.senderId=function(){return this.m_clientId},e.prototype.countOfOutboundMessagesNotRoundTrippedYet=function(){return this.m_outboundMessageInfo.size},e.prototype.canRetry=function(){return this.m_connectionState===g.ConnectionState.Disconnected&&this.m_lastCloseCode!==y},e.prototype.getServiceTelemetry=function(){return this.m_telemetry.wsState=g.ConnectionState[this.getConnectionState()],this.m_telemetry.messagePendingAckCount=this.m_outboundMessageInfo.size,this.m_telemetry},e.prototype.activeClientCount=function(){return this.m_clientIds.size},e.prototype.activeClientIds=function(){return this.m_clientIds},e.prototype.clientId=function(){return this.m_clientId},e.prototype.getConnectionState=function(){return this.m_connectionState},e.prototype.on=function(e,t){return this.m_events.on(e,t),this},e.prototype.connectAsync=function(){return n(this,void 0,void 0,function(){var e=this;return r(this,function(t){return this.m_initPromise.promise=new Promise(function(t,i){e.m_initPromise.resolve=t,e.m_initPromise.reject=i}),this.setConnectionState(g.ConnectionState.Connecting),[2,new Promise(function(t,i){return n(e,void 0,void 0,function(){var e,n=this;return r(this,function(r){switch(r.label){case 0:return e=this,[4,v.StateServiceWebSocketConnection.CreateAsync(this.m_wsUrl,this.m_connectionSettings)];case 1:return e.m_connection=r.sent(),this.m_connection.onopen=function(){n.handleConnectionOpen(),n.startInitTimeoutTimer(n.m_initTimeoutDurationInMS,n.m_initPromise.reject),t()},this.m_connection.onerror=function(e){var r;n.m_logger.sendTraceTag(0x232df10c,h.TraceLevel.Error,"SimpleStateServiceProxy::connect - "+(null==(r=n.m_connection)?void 0:r.name)+" onerror. {sessionId: "+n.m_sessionId+", ClientId: "+n.m_clientId+", Error: "+JSON.stringify(e)+"}"),n.retryConnection(function(e){var t,r="failed to reconnect after "+(null==(t=n.m_connection)?void 0:t.name)+" error: "+d.errorToString(e);n.m_logger.sendTraceTag(0x2289e811,h.TraceLevel.Error,r),i(r)},!1,function(){return t()})},this.m_connection.onlog=function(e){var t;n.m_logger.sendTraceTag(0x2131c423,e.detail.level,"SimpleStateServiceProxy::log - "+(null==(t=n.m_connection)?void 0:t.name)+" {sessionId: "+n.m_sessionId+", ClientId: "+n.m_clientId+", Message: "+e.detail.message+"}")},this.m_connection.onclose=function(e){var r,s;n.m_logger.sendTraceTag(0x232df10d,h.TraceLevel.Error,"SimpleStateServiceProxy::connect - "+(null==(r=n.m_connection)?void 0:r.name)+" onclose. {sessionId: "+n.m_sessionId+", ClientId: "+n.m_clientId+", Code: "+e.code+", Reason: "+e.reason+"}"),n.m_lastCloseCode=e.code,n.m_lastCloseReason=e.reason,e.code!==y?n.retryConnection(function(e){var t="failed to reconnect after service side disconnect: "+d.errorToString(e);n.m_logger.sendTraceTag(0x2289e812,h.TraceLevel.Error,t),i(t)},!1,function(){return t()}):(n.setConnectionState(g.ConnectionState.Disconnected),n.m_logger.sendTraceTag(0x230c510d,h.TraceLevel.Error,"SimpleStateServiceProxy::connect - "+(null==(s=n.m_connection)?void 0:s.name)+" onclose. Not retryable close code. {sessionId: "+n.m_sessionId+", ClientId: "+n.m_clientId+"}"))},this.m_connection.onmessage=function(e){var t;try{n.handleConnectionMessage(e)}catch(e){n.m_logger.sendTraceTag(0x232df10e,h.TraceLevel.Error,"SimpleStateServiceProxy::onmessage - "+(null==(t=n.m_connection)?void 0:t.name)+" error. {sessionId: "+n.m_sessionId+", ClientId: "+n.m_clientId+", Error: "+d.errorToString(e)+"}")}},[2]}})})})]})})},e.prototype.close=function(){var e;this.m_logger.sendTraceTag(0x232df118,h.TraceLevel.Info,"SimpleStateServiceProxy::close. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+"}"),this.closeAndClearConnection(),this.m_retryTimer&&(clearTimeout(this.m_retryTimer),this.m_retryTimer=null),this.m_unacknowledgedMessages.clear(),this.clearPingPongTimer(),this.clearOfflineMessageCacheTimer(),this.clearInitTimeoutTimer(),this.clearUnacknowledgedTimer(),null==(e=this.m_clientIdEvictingQueue)||e.clear(),0!==this.countOfOutboundMessagesNotRoundTrippedYet()&&(this.m_events.emit("messageFailedToRoundTripOnClose",this.m_outboundMessageInfo.size),this.m_outboundMessageInfo.clear())},e.prototype.sendStateMessage=function(e){this.sendStateMessageImpl(e)},e.prototype.createMapAsync=function(e,t,i,s){return n(this,void 0,void 0,function(){var n;return r(this,function(r){return n=new f.SimpleSyncMap(e,this,t,i,s),this.m_handlers.set(e,n),[2,n]})})},e.prototype.getMapAsync=function(e){return n(this,void 0,void 0,function(){var t;return r(this,function(i){return(t=this.m_handlers.get(e))?[2,t]:[2,null]})})},e.prototype.waitMapAsync=function(e,t,i,s){return n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return[4,this.m_initPromise.promise];case 1:return r.sent(),[4,this.getMapAsync(e)];case 2:if(n=r.sent())return[3,4];return[4,this.createMapAsync(e,t,i,s)];case 3:n=r.sent(),r.label=4;case 4:return[2,n]}})})},e.prototype.createCellAsync=function(e,t,i,s){return n(this,void 0,void 0,function(){var n;return r(this,function(r){return n=new p.SimpleSyncCell(e,this,t,i,s),this.m_handlers.set(e,n),[2,n]})})},e.prototype.getCellAsync=function(e){return n(this,void 0,void 0,function(){var t;return r(this,function(i){return(t=this.m_handlers.get(e))?[2,t]:[2,null]})})},e.prototype.waitCellAsync=function(e,t,i,s){return n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return this.m_logger.sendTraceTag(0x1f010710,h.TraceLevel.Info,"SimpleStateServiceProxy::waitCellAsync - awaiting initPromise "+e),[4,this.m_initPromise.promise];case 1:return r.sent(),this.m_logger.sendTraceTag(0x1f01070f,h.TraceLevel.Info,"SimpleStateServiceProxy::waitCellAsync - getCellAsync "+e),[4,this.getCellAsync(e)];case 2:if(n=r.sent())return[3,4];return this.m_logger.sendTraceTag(0x1f01070e,h.TraceLevel.Info,"SimpleStateServiceProxy::waitCellAsync - createCellAsync "+e),[4,this.createCellAsync(e,t,i,s)];case 3:n=r.sent(),r.label=4;case 4:return[2,n]}})})},e.prototype.onFocusChanged=function(e){var t=this;e?(window.clearTimeout(this.m_closeConnectionTimer),this.m_connection||(this.m_logger.sendTraceTag(0x232df110,h.TraceLevel.Info,"SimpleStateServiceProxy::onFocusChanged - retryConnection due to getting focus again. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+"}"),this.retryConnection(function(e){t.m_logger.sendTraceTag(0x2289e813,h.TraceLevel.Error,"failed to reconnect after regaining focus: "+d.errorToString(e))},!0))):this.m_closeConnectionTimer=window.setTimeout(function(){var e;t.m_connection&&(t.m_logger.sendTraceTag(0x232df10f,h.TraceLevel.Info,"SimpleStateServiceProxy::onFocusChanged - "+(null==(e=t.m_connection)?void 0:e.name)+" close due to losing focus. {sessionId: "+t.m_sessionId+", ClientId: "+t.m_clientId+"}"),t.m_connection.onclose=function(){},t.m_connection.close(),t.m_connection=null)},this.m_connectionAliveTimeAfterLoseFocusInMS)},e.prototype.getHistoryAsync=function(e,t){return n(this,void 0,void 0,function(){var i,n;return r(this,function(r){switch(r.label){case 0:return(i=new URL(this.m_deltasBaseUrl)).searchParams.append("action","deltas"),i.searchParams.append("docId",this.m_sessionId),i.searchParams.append("cid",this.m_clientId),i.searchParams.append("objectId",e),t&&i.searchParams.append("property",t),[4,o.default.get(i.toString())];case 1:return(n=r.sent().data).forEach(function(e){return e.value=JSON.parse(e.value)}),[2,n]}})})},e.prototype.getHistoryWithPaginationAsync=function(e,t,i){return n(this,void 0,void 0,function(){var n,s;return r(this,function(r){switch(r.label){case 0:return(n=new URL(this.m_deltasBaseUrl)).searchParams.append("action","deltas"),n.searchParams.append("docId",this.m_sessionId),n.searchParams.append("cid",this.m_clientId),n.searchParams.append("objectId",e),n.searchParams.append("pagination","true"),i&&n.searchParams.append("cursor",i),t&&n.searchParams.append("property",t),[4,o.default.get(n.toString())];case 1:return(s=r.sent().data).messages.forEach(function(e){return e.value=JSON.parse(e.value)}),[2,s]}})})},e.prototype.setupSystemClientsCell=function(){var e=this;this.m_clientsCell=new p.SimpleSyncCell("systemClients",this),this.m_handlers.set(this.m_clientsCell.id(),this.m_clientsCell),this.m_clientsCell.on("valueChanged",function(t){e.m_clientIds=new Set(t),e.m_events.emit("activeClientCountChanged")})},e.prototype.setUpSystemCommandsCell=function(){var e=this;this.m_systemCommandsCell=new p.SimpleSyncCell(g.SystemCommandsStateName,this),this.m_handlers.set(this.m_systemCommandsCell.id(),this.m_systemCommandsCell),this.m_systemCommandsCell.on("valueChanged",function(t){return n(e,void 0,void 0,function(){var e,i,n;return r(this,function(r){switch(r.label){case 0:if("refreshToken"===t)return[3,1];return[3,6];case 1:if(!(this.m_user&&this.m_user.getForceRefreshedTokenAsync))return[3,5];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.m_user.getForceRefreshedTokenAsync()];case 3:return e=r.sent(),i={},e&&(i.authorization=e.token,i.authProvider=e.authProvider,i.mri=e.mri||"",i.huid=e.hashedUserEmail||""),this.sendConfigMessage(i),[3,5];case 4:return n=r.sent(),this.m_logger.sendTraceTag(0x223830c7,h.TraceLevel.Error,"Error getting force refreshed auth token: "+d.errorToString(n)),[3,5];case 5:return[3,7];case 6:return this.m_logger.sendTraceTag(0x223830c8,h.TraceLevel.Error,"Unknown system command cell value: "+t),[3,7];case 7:return[2]}})})})},e.prototype.setupServiceGeneratedClientIdCell=function(){var e=this;this.m_serviceGeneratedClientIdCell=new p.SimpleSyncCell(g.ServiceGeneratedClientIdName,this),this.m_handlers.set(this.m_serviceGeneratedClientIdCell.id(),this.m_serviceGeneratedClientIdCell),this.m_serviceGeneratedClientIdCell.on("valueChanged",function(t){e.m_logger.sendTraceTag(0x1f01070d,h.TraceLevel.Info,"SimpleStateServiceProxy::serviceGeneratedClientId changed to "+t+"}"),e.setClientId(t,!0),e.processClientIdQueue(),e.m_useServiceGeneratedClientId&&(e.processOfflineMessageCache(!0),e.clearOfflineMessageCacheTimer())})},e.prototype.handleConnectionOpen=function(){var e;this.m_logger.sendTraceTag(0x232df10b,h.TraceLevel.Info,"SimpleStateServiceProxy::connect - "+(null==(e=this.m_connection)?void 0:e.name)+" onopen. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+"}"),this.m_retryAttempts=0,this.setConnectionState(g.ConnectionState.Connected),this.startPingTimer(),this.m_useServiceGeneratedClientId||(this.processOfflineMessageCache(!1),this.clearOfflineMessageCacheTimer())},e.prototype.setConnectionState=function(e){this.m_connectionState!==e&&(this.m_connectionState=e,e===g.ConnectionState.Disconnected&&this.m_useServiceGeneratedClientId&&this.setClientId("",!1),this.m_events.emit("connectionStateChanged"))},e.prototype.setClientId=function(e,t){this.m_clientId!==e&&(this.m_clientId=e,t&&this.m_events.emit("clientIdChanged"))},e.prototype.processClientIdQueue=function(){var e=this;this.m_clientIdEvictingQueue&&this.m_clientIdEvictingQueue.forEach(function(t){t.senderId=e.m_clientId,e.sendConnectionMessage(t,!0)})},e.prototype.createSetupMessage=function(e){var t=e.authToken,i=e.metadata,n=e.subscriptions,r=[];if(t||i){var s={};t&&(s.authorization=t.token,s.authProvider=t.authProvider,s.mri=t.mri||"",s.huid=t.hashedUserEmail||""),i&&(s.metadata=JSON.stringify(i));var a={messageId:c.v4(),senderId:this.senderId(),objectId:g.ConfigurationName,type:"",operation:"",value:JSON.stringify(s)};r.push(JSON.stringify(a))}if(n){var a={messageId:c.v4(),senderId:this.senderId(),objectId:g.StateSubscriptionsName,type:"",operation:"",value:JSON.stringify(n)};r.push(JSON.stringify(a))}return r},e.prototype.sendConfigMessage=function(e){var t={messageId:c.v4(),senderId:this.senderId(),objectId:g.ConfigurationName,type:"",operation:"",value:JSON.stringify(e)};this.sendStateMessage(t)},e.prototype.retryConnection=function(e,t,i){var s=this;if(this.clearPingPongTimer(),this.clearInitTimeoutTimer(),this.m_retryAttempts>=this.m_retryIntervalsInMs.length||this.m_sessionRetryAttempts>=this.m_maxSessionRetries){this.setConnectionState(g.ConnectionState.Disconnected),this.m_logger.sendTraceTag(0x232df111,h.TraceLevel.Error,"SimpleStateServiceProxy::retryConnection reached max retry attempts. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+"}"),e&&e(Error("reached max retry attempts"));return}if(this.setConnectionState(g.ConnectionState.Connecting),!t&&(!this.m_connection||this.m_retryTimer))return void this.m_logger.sendTraceTag(0x232df112,h.TraceLevel.Info,"SimpleStateServiceProxy::retryConnection skipped. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", NullConnection: "+(null===this.m_connection)+", NullRetryTimer: "+(null===this.m_retryTimer)+"}");var a=this.m_retryIntervalsInMs[this.m_retryAttempts];this.m_retryAttempts+=1,this.m_sessionRetryAttempts+=1,this.m_telemetry.wsReconnectCount+=1,this.closeAndClearConnection(),this.m_retryTimer=setTimeout(function(){return n(s,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:this.m_logger.sendTraceTag(0x232df113,h.TraceLevel.Info,"SimpleStateServiceProxy::retryConnection. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+"}"),this.m_retryTimer=null,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.connectAsync()];case 2:return n.sent(),i&&i(),[3,4];case 3:return t=n.sent(),this.setConnectionState(g.ConnectionState.Disconnected),this.m_logger.sendTraceTag(0x232df114,h.TraceLevel.Error,"SimpleStateServiceProxy::retryConnection failed. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+"}, "+d.errorToString(t)),this.m_retryAttempts>=this.m_retryIntervalsInMs.length&&e(t),[3,4];case 4:return[2]}})})},a)},e.prototype.startPingTimer=function(){var e=this;this.m_connection&&this.m_connection.shouldSendPings&&(this.m_pingTimeoutInMs<=0||this.m_pongTimeoutInMs<=0||(this.clearPingPongTimer(),this.m_pingTimer=setTimeout(function(){return n(e,void 0,void 0,function(){return r(this,function(e){return this.sendPingMessage(),this.m_pingTimer=null,[2]})})},this.m_pingTimeoutInMs)))},e.prototype.sendPingMessage=function(){var e=this;this.m_connection&&(this.m_connection.isOpen?(this.m_verbose&&this.m_logger.sendTraceTag(0x21603256,h.TraceLevel.Info,"SimpleStateServiceProxy::sendPingMessage. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", __ping__"),this.m_connection.send("__ping__"),this.clearPongTimer(),this.m_pongTimer=setTimeout(function(){return n(e,void 0,void 0,function(){var e=this;return r(this,function(t){return this.retryConnection(function(t){e.m_logger.sendTraceTag(0x2289e814,h.TraceLevel.Error,"failed to reconnect after missing ping: "+d.errorToString(t))},!1),this.m_pongTimer=null,[2]})})},this.m_pongTimeoutInMs)):(this.retryConnection(function(t){e.m_logger.sendTraceTag(0x2289e815,h.TraceLevel.Error,"failed to reconnect after closed connection: "+d.errorToString(t))},!1),this.clearPongTimer()))},e.prototype.clearPingPongTimer=function(){this.clearPingTimer(),this.clearPongTimer()},e.prototype.clearPingTimer=function(){this.m_pingTimer&&(clearTimeout(this.m_pingTimer),this.m_pingTimer=null)},e.prototype.clearPongTimer=function(){this.m_pongTimer&&(clearTimeout(this.m_pongTimer),this.m_pongTimer=null)},e.prototype.handleConnectionMessage=function(e){if("string"==typeof e.data){if(this.startPingTimer(),"__pong__"===e.data){this.m_verbose&&this.m_logger.sendTraceTag(0x21603257,h.TraceLevel.Info,"SimpleStateServiceProxy::handleConnectionMessage. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", __pong__");return}var t=Date.now();try{var i=JSON.parse(e.data);Array.isArray(i)&&i.length>0?this.handleAggregatedStateMessages(i):this.handleStateMessage(i),this.m_telemetry.addMessageHandleLatency(Date.now()-t),i.objectId===g.SystemSessionStateName&&(this.m_logger.sendTraceTag(0x1f01070c,h.TraceLevel.Info,"SimpleStateServiceProxy::handleConnectionMessage - systemSessionState - initPromise resolved."),this.m_initPromise.resolve(),this.clearInitTimeoutTimer())}catch(e){this.m_logger.sendTraceTag(0x2275241e,h.TraceLevel.Error,"handleConnectionMessage: "+d.errorToString(e))}}else this.m_logger.sendTraceTag(0x232df115,h.TraceLevel.Error,"SimpleStateServiceProxy::handleConnectionMessage - Unknown data type. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", Type: "+typeof e.data+"}")},e.prototype.handleAggregatedStateMessages=function(e){var t,i,n=this;if(e&&0!==e.length){var r=e.map(function(e){return JSON.parse(e)}),a={};r.forEach(function(e){return a[e.objectId]=1+(a[e.objectId]||0)}),Object.keys(a).forEach(function(e){if(a[e]>1){var t=n.m_handlers.get(e);t&&t.beginAggregatedStateUpdating&&t.beginAggregatedStateUpdating()}});try{for(var o=s(r),l=o.next();!l.done;l=o.next()){var c=l.value;this.handleStateMessage(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}Object.keys(a).forEach(function(e){if(a[e]>1){var t=n.m_handlers.get(e);t&&t.endAggregatedStateUpdating&&t.endAggregatedStateUpdating()}})}},e.prototype.handleStateMessage=function(e){var t=this;if(this.m_verbose&&this.m_logger.sendTraceTag(0x232df116,h.TraceLevel.Info,"SimpleStateServiceProxy::handleStateMessage. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", ObjectId: "+e.objectId+", MessageId: "+e.messageId+"}"),"list"===e.type)JSON.parse(e.value).forEach(function(e){t.handleStateMessage(e)});else{if(this.m_user&&this.m_user.validateMessage&&!this.m_user.validateMessage(e))return void this.m_logger.sendTraceTag(0x230c510e,h.TraceLevel.Error,"SimpleStateServiceProxy::handleStateMessage rejected message: {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", ObjectId: "+e.objectId+", MessageId: "+e.messageId+"}");var i=this.getHandlerForMessage(e);if(e.senderId===this.senderId()&&(this.acknowledgeMessage(e,i),this.m_telemetry.incrementAcknowledgedCount(e.objectId)),this.measureMessageRoundTripLatency(e),this.m_telemetry.incrementReceivedCount(e.objectId),i)return void i.handleStateMessage(e)}},e.prototype.getAuthToken=function(){return n(this,void 0,void 0,function(){var e,t;return r(this,function(i){switch(i.label){case 0:if(!(this.m_user&&this.m_user.getAuthTokenAsync))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.m_user.getAuthTokenAsync()];case 2:return e=i.sent(),[3,4];case 3:return t=i.sent(),this.m_logger.sendTraceTag(0x227524c5,h.TraceLevel.Error,"Error getting auth token: "+d.errorToString(t)),[3,4];case 4:return[2,e]}})})},e.prototype.getHandlerForMessage=function(e){var t=this.m_handlers.get(e.objectId);return t||("cell"===e.type?t=new p.SimpleSyncCell(e.objectId,this):"map"===e.type?t=new f.SimpleSyncMap(e.objectId,this):this.m_logger.sendTraceTag(0x2154c744,h.TraceLevel.Error,"SimpleStateServiceProxy::handleStateMessage - Unknown message type. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", Type: "+e.type+"}"),t&&this.m_handlers.set(e.objectId,t)),t},e.prototype.sendStateMessageImpl=function(e){var t,i=this;if(this.m_verbose&&this.m_logger.sendTraceTag(0x232df11b,h.TraceLevel.Info,"SimpleStateServiceProxy::sendStateMessageImpl. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", ObjectId: "+e.objectId+", MessageId: "+e.messageId+"}"),e.objectId!==g.StateSubscriptionsName&&e.objectId!==g.ConfigurationName){if(this.m_outboundMessageInfo.set(e.messageId,Date.now()),this.m_telemetry.incrementRequestedCount(e.objectId),this.m_unacknowledgedMaxTimeInMs>0){var n=null==(t=this.getHandlerForMessage(e))?void 0:t.messageTrackingOption();if(n&&n!==g.MessageTrackingOption.None){var r=this.getUnacknowledgedMessagesMapKey(e,n);this.m_unacknowledgedMessages.set(r,{message:e,timestamp:Date.now()}),this.startUnacknowledgeMessageTimer()}}if(this.m_useServiceGeneratedClientId&&this.m_clientIdEvictingQueue&&!this.m_clientId)return void this.m_clientIdEvictingQueue.enqueue(e)}if(this.m_user&&this.m_user.patchMessage&&this.m_user.patchMessage(e),!this.m_batchedRequestsEnabled)return void this.sendConnectionMessage(e,!0);this.m_messageBuffer.push(e),this.m_processBufferTimer||(this.m_processBufferTimer=setTimeout(function(){i.processMessageBuffer()},this.m_batchWaitTimeMS))},e.prototype.createListMessage=function(e){if(0!==e.length)return 1===e.length?e[0]:{value:JSON.stringify(e),type:this.m_batchMessageTypeName,operation:"",messageId:c.v4(),objectId:"batch",senderId:this.senderId()}},e.prototype.processMessageBuffer=function(){var e=this.m_messageBuffer.length,t=this.m_messageBuffer.splice(0,e),i=this.createListMessage(t);this.m_processBufferTimer&&clearTimeout(this.m_processBufferTimer),this.m_processBufferTimer=null,i&&this.sendConnectionMessage(i,!0)},e.prototype.processOfflineMessageCache=function(e){var t=this;this.m_offlineMessageCacheEnabled&&(this.m_offlineMessageCache.forEach(function(i){e&&(i.message.senderId=t.m_clientId),t.sendConnectionMessage(i.message,!1),t.m_telemetry.offlineCacheTelemetry.resentCount+=1}),this.m_offlineMessageCache=[])},e.prototype.purgeOfflineMessageCache=function(){var e=this;if(this.m_offlineMessageCacheEnabled&&this.m_maxOfflineMessageCacheTimeInMs){var t=Date.now(),i=this.m_offlineMessageCache.filter(function(i){return e.m_maxOfflineMessageCacheTimeInMs&&i.timestamp+e.m_maxOfflineMessageCacheTimeInMs>=t});this.m_telemetry.offlineCacheTelemetry.expiredCount+=this.m_offlineMessageCache.length-i.length,this.m_offlineMessageCache=i,0===this.m_offlineMessageCache.length&&this.clearOfflineMessageCacheTimer()}},e.prototype.clearOfflineMessageCacheTimer=function(){this.m_offlineMessageCacheEnabled&&this.m_offlineMessageCacheTimer&&(clearInterval(this.m_offlineMessageCacheTimer),this.m_offlineMessageCacheTimer=null)},e.prototype.getUnacknowledgedMessagesMapKey=function(e,t){return t===g.MessageTrackingOption.None?"":t===g.MessageTrackingOption.All?e.messageId:e.objectId},e.prototype.startUnacknowledgeMessageTimer=function(){var e=this;this.m_unacknowledgedMaxTimeInMs>0&&!this.m_unacknowledgedTimer&&(this.m_unacknowledgedTimer=setInterval(function(){e.notifyUnacknowledgedMessages(),e.m_unacknowledgedMessages.size<=0&&e.clearUnacknowledgedTimer()},this.m_unacknowledgedMaxTimeInMs/2))},e.prototype.acknowledgeMessage=function(e,t){if(e.senderId===this.senderId()&&t&&!(this.m_unacknowledgedMessages.size<=0)){var i=this.getUnacknowledgedMessagesMapKey(e,t.messageTrackingOption()),n=this.m_unacknowledgedMessages.get(i);n&&e.messageId===n.message.messageId&&this.m_unacknowledgedMessages.delete(i)}},e.prototype.notifyUnacknowledgedMessages=function(){var e=this,t=Date.now();this.m_unacknowledgedMessages.forEach(function(i,n){if(i.timestamp+e.m_unacknowledgedMaxTimeInMs<t){var r=e.getHandlerForMessage(i.message);null==r||r.handleUnacknowledgedMessage(i.message),e.m_unacknowledgedMessages.delete(n),e.m_telemetry.unacknowledgedMessagesCount+=1}})},e.prototype.clearUnacknowledgedTimer=function(){this.m_unacknowledgedTimer&&(clearInterval(this.m_unacknowledgedTimer),this.m_unacknowledgedTimer=null)},e.prototype.startInitTimeoutTimer=function(e,t){e>0&&(this.clearInitTimeoutTimer(),this.m_initTimeoutTimer=setTimeout(function(){t("Initialization timed out after "+e+" ms")},e))},e.prototype.clearInitTimeoutTimer=function(){this.m_initTimeoutTimer&&clearTimeout(this.m_initTimeoutTimer)},e.prototype.sendConnectionMessage=function(e,t){var i,n,r=this;if(this.m_allowReconnectOnMessageSend&&this.m_connectionState===g.ConnectionState.Disconnected&&(this.updateRetryAttempts(),this.retryConnection(function(e){r.m_logger.sendTraceTag(0x215832c1,h.TraceLevel.Error,"SimpleStateServiceProxy::sendConnectionMessage - failed to reconnect with error: "+d.errorToString(e)+" ")},!1)),this.m_offlineMessageCacheEnabled&&t){if(!this.m_connection||this.m_connectionState!==g.ConnectionState.Connected){if(!this.m_maxOfflineMessageCacheLength||this.m_offlineMessageCache.length>=this.m_maxOfflineMessageCacheLength){this.m_telemetry.offlineCacheTelemetry.rejectedCount+=1,this.m_logger.sendTraceTag(0x2205d2de,h.TraceLevel.Error,"SimpleStateServiceProxy::sendConnectionMessage - Dropping message because offline cache is full. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", Status: "+(null==(i=this.m_connection)?void 0:i.readyState)+"}");return}!this.m_offlineMessageCacheTimer&&this.m_maxOfflineMessageCacheTimeInMs&&(this.m_offlineMessageCacheTimer=setInterval(function(){r.purgeOfflineMessageCache()},this.m_maxOfflineMessageCacheTimeInMs/2)),this.m_offlineMessageCache.push({message:e,timestamp:Date.now()}),this.m_telemetry.offlineCacheTelemetry.cachedCount+=1;return}}else{if(!this.m_connection)return void this.m_logger.sendTraceTag(0x232df119,h.TraceLevel.Error,"SimpleStateServiceProxy::sendConnectionMessage - connection is not set. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+"}");if(!this.m_connection.isOpen)return void this.m_logger.sendTraceTag(0x232df11a,h.TraceLevel.Error,"SimpleStateServiceProxy::sendConnectionMessage - "+this.m_connection.name+" status is not open. {sessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", Status: "+this.m_connection.readyState+"}")}null==(n=this.m_connection)||n.send(JSON.stringify(e))},e.prototype.closeAndClearConnection=function(){if(this.m_connection){if(this.m_connection.onclose=function(){},this.m_connection.isOpen)this.m_connection.close();else{var e=this.m_connection;e.onopen=function(){return e.close()}}this.m_connection=null}},e.prototype.updateRetryAttempts=function(){this.m_retryAttempts>=this.m_retryIntervalsInMs.length&&(this.m_retryAttempts=0),this.m_sessionRetryAttempts>=this.m_maxSessionRetries&&(this.m_sessionRetryAttempts=0)},e.prototype.measureMessageRoundTripLatency=function(e){if(e.senderId===this.senderId())try{var t=this.m_outboundMessageInfo.get(e.messageId);if(void 0!==t){this.m_outboundMessageInfo.delete(e.messageId);var i=Date.now()-t;this.m_events.emit("messageRoundTripped",{clientId:this.m_clientId,sessionId:this.m_sessionId,messageId:e.messageId,objectId:e.objectId,operation:e.operation,latencyInMs:i}),this.m_telemetry.addRoundtripLatency(i)}else this.m_verbose&&this.m_logger.sendTraceTag(0x232df11c,h.TraceLevel.Info,"SimpleStateServiceProxy::measureMessageRoundTripLatency. Failed to find outbound message info for {SessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", ObjectId: "+e.objectId+", MessageId: "+e.messageId+"}")}catch(t){this.m_logger.sendTraceTag(0x232df11d,h.TraceLevel.Error,"SimpleStateServiceProxy::measureMessageRoundTripLatency - Exception thrown error. {SessionId: "+this.m_sessionId+", ClientId: "+this.m_clientId+", MessageId: "+e.messageId+", Error: "+t.message+"}")}},e}()},983729:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleServicePerformanceTelemetry=t.SimpleServiceTelemetry=void 0;var n=i(651758);t.SimpleServiceTelemetry=function(){function e(e,t,i){this.backendService="SimpleService",this.clientId=e,this.sessionId=t,this.wsReconnectCount=0,this.wsState=n.ConnectionState[n.ConnectionState.Disconnected],this.maxRoundtripRaw=i||0,this.roundtripTelemetry=new r,this.messageHandleTelemetry=new r,this.offlineCacheTelemetry={cachedCount:0,resentCount:0,expiredCount:0,rejectedCount:0},this.maxRoundtripRaw>0&&(this.roundtripRaw=[]),this.messagePendingAckCount=0,this.unacknowledgedMessagesCount=0,this.messageRequested={},this.messageReceived={},this.messageAcknowledged={}}return e.prototype.addRoundtripLatency=function(e){this.roundtripRaw&&this.roundtripRaw.length<this.maxRoundtripRaw&&this.roundtripRaw.push(e),this.roundtripTelemetry.addLatency(e)},e.prototype.addMessageHandleLatency=function(e){this.messageHandleTelemetry.addLatency(e)},e.prototype.incrementAcknowledgedCount=function(e){this.incrementMessageCount(this.messageAcknowledged,e)},e.prototype.incrementRequestedCount=function(e){this.incrementMessageCount(this.messageRequested,e)},e.prototype.incrementReceivedCount=function(e){this.incrementMessageCount(this.messageReceived,e)},e.prototype.incrementMessageCount=function(e,t){var i=e[t],n=void 0===i?1:i+1;e[t]=n},e}();var r=function(){function e(){this.count=0,this.minValue=0,this.maxValue=0,this.avgValue=0}return e.prototype.addLatency=function(e){this.count+=1,this.avgValue=this.avgValue+(e-this.avgValue)/this.count,this.minValue=this.count>1?Math.min(e,this.minValue):e,this.maxValue=Math.max(this.maxValue,e)},e}();t.SimpleServicePerformanceTelemetry=r},339163:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){function r(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):r(e.value).then(a,o)}l((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return l([e,t])}}function l(s){if(i)throw TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.createStateServiceProxyAsync=void 0;var s=i(646646);t.createStateServiceProxyAsync=function(e,t,i,a,o,l){return n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return[4,(n=new s.SimpleStateServiceProxy(e,t,i,a,o,l)).connectAsync()];case 1:return r.sent(),[2,n]}})})}},258162:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,n){function r(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):r(e.value).then(a,o)}l((n=n.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return l([e,t])}}function l(s){if(i)throw TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.StateServiceWebSocketConnection=void 0,t.StateServiceWebSocketConnection=function(){function e(e,t){var r=this;this.onopen=null,this.onclose=null,this.onerror=null,this.onmessage=null,this.onlog=null,this.ws=new WebSocket(e),this.settings=t,this.ws.onopen=function(e){return i(r,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return this.onopen&&this.onopen(e),[4,this.sendSetupMessages()];case 1:return t.sent(),[2]}})})},this.ws.onclose=function(e){r.onclose&&r.onclose(e)},this.ws.onerror=function(e){r.onerror&&r.onerror(e)},this.ws.onmessage=function(e){r.onmessage&&r.onmessage(e)}}return e.CreateAsync=function(t,r){return i(this,void 0,void 0,function(){return n(this,function(i){return[2,new e(t,r)]})})},Object.defineProperty(e.prototype,"name",{get:function(){return"WebSocket"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.ws.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOpen",{get:function(){return this.ws.readyState===WebSocket.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shouldSendPings",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.close=function(){this.ws.close()},e.prototype.send=function(e){this.ws.send(e)},e.prototype.sendSetupMessages=function(){return i(this,void 0,void 0,function(){var e,t,i,r=this;return n(this,function(n){switch(n.label){case 0:if(!(e=this.settings.getAuthTokenAsync))return[3,2];return[4,this.settings.getAuthTokenAsync()];case 1:e=n.sent(),n.label=2;case 2:return i={authToken:e,metadata:(t=this.settings).metadata,subscriptions:t.subscriptions},this.settings.createSetupMessage(i).forEach(function(e){return r.send(e)}),[2]}})})},e}()},308126:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(530378),t),r(i(651758),t),r(i(339163),t)},172448:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EvictingQueue=void 0,t.EvictingQueue=function(){function e(e){this.maxSize=e,this._store=[]}return Object.defineProperty(e.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._store.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(e){this._store.length>=this.maxSize&&this._store.shift(),this._store.push(e)},e.prototype.dequeue=function(){return this._store.shift()},e.prototype.clear=function(){this._store=[]},e.prototype.forEach=function(e){this._store.forEach(e)},e}()},675009:function(e,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.errorToString=void 0,t.errorToString=function(e,t){if(void 0===t&&(t=!0),null==e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,r(n(t)))}catch(e){return"Stringifying error failed"}};var n=function(e){return void 0===e&&(e=!1),function(t,n){return n instanceof Error?i({name:n.name,message:n.message,stack:e?[]:("string"==typeof n.stack?n.stack:"").split("\n").map(function(e){return e.trim()}).filter(function(e){return!!e})},n):n}},r=function(e){var t=new WeakSet;return function(i,n){if("object"==typeof n&&null!==n){if(t.has(n))return;t.add(n)}return e(i,n)}}},549097:function(e,t,i){"use strict";var n,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i(937032),a=i(248632),o=function(){function e(e){this._formatter=e||new d}return e.prototype.formatter=function(){return this._formatter},e.prototype.receiveAll=function(){return!1},e.prototype.levels=function(){return null},e}();function l(e){return(0x100000000+e).toString(16).substr(-8)}function c(e,t){return(1e12+e).toString(10).substr(-t)}t.AbstractLogAppender=o,function(e){e[e.Timestamp=1]="Timestamp",e[e.Component=4]="Component",e[e.Level=8]="Level",e[e.FullDate=32]="FullDate",e[e.LogId=64]="LogId"}(n=t.SLF_Flags||(t.SLF_Flags={}));var d=function(){function e(e){void 0===e&&(e=0xffffffff),this._flags=e}return e.prototype.format=function(e,t,i,r){var o="";if(this._flags&n.FullDate)o+=new Date(e.timestamp).toISOString()+" ";else if(this._flags&n.Timestamp){var d=new Date(e.timestamp);o+=c(d.getHours(),2)+":"+c(d.getMinutes(),2)+":"+c(d.getSeconds(),2)+"."+c(d.getMilliseconds(),2)+" "}return(this._flags&n.LogId&&(o+="[#"+l(t)+"-"+(e.component.safe()?"S":"u")+"] "),this._flags&n.Level&&(o+="["+a.LogFactory.levelToString(e.level)+"] "),this._flags&n.Component&&(o+="["+e.component.name()+"] "),i||""===i)?o+s.vsprintf(i,r):o+l(t)+": "+r.join(" ")},e}();t.StandardLogFormatter=d;var u=console,h=console.log||function(){},g=console.info||h,p=console.warn||g,f=console.error||p;t.ConsoleAppender=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.log=function(e,t,i,n){n=n.slice(0);var r=e.level<=s.LogLevel.Debug3?h:e.level<=s.LogLevel.Debug1?g:e.level<=s.LogLevel.Warning?p:f;if(-1===t){var a=this.formatter().format(e,t,"",[]);"string"==typeof n[0]&&(a+=n.shift()),r.apply(u,[a].concat(n))}else{for(var o=void 0,l=[];o=i.match(/\s*%@\s*$/);)i=i.substr(0,i.length-o[0].length),l.unshift(n.pop());var a=this.formatter().format(e,t,i,n);r.apply(u,[a].concat(l))}},t}(o);var m=function(){function e(e){this._chained=e}return e.prototype.log=function(e,t,i,n){this._chained.log(e,t,i,n)},e.prototype.receiveAll=function(){return this._chained.receiveAll()},e.prototype.levels=function(){return this._chained.levels()},e}();t.ChainedLogAppender=m;var v=function(e){function t(t,i){var n=e.call(this,t)||this;return n._levels=i,n}return r(t,e),t.prototype.levels=function(){return this._levels},t}(m);t.wrapAppenderWithLogLevels=function(e,t){return new v(e,t)}},937032:function(e,t){"use strict";var i,n,r,s,a,o;function l(e,t){var i=0;return e.replace(/%[dixs%]/g,function(e){var n=0;if("%"!==e[n++])return"";var r=e[n++];return"%"===r?"%":"s"===r?t[i++]:"d"===r||"i"===r?t[i++]:"x"===r?t[i++].toString(16):e})}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=10]="Trace",e[e.Debug6=16]="Debug6",e[e.Debug5=18]="Debug5",e[e.Debug4=20]="Debug4",e[e.Debug3=30]="Debug3",e[e.Debug2=40]="Debug2",e[e.Debug1=50]="Debug1",e[e.Warning=60]="Warning",e[e.Error=70]="Error",e[e.Fatal=80]="Fatal",e[e.MetaData=90]="MetaData"}(i=t.LogLevel||(t.LogLevel={})),function(e){e[e.UseDefault=0]="UseDefault",e[e.Compress=1]="Compress",e[e.Disabled=2]="Disabled"}(n=t.LogFileCompression||(t.LogFileCompression={})),function(e){e[e.Raw=0]="Raw",e[e.Base64=1]="Base64"}(r=t.LogFileEncoding||(t.LogFileEncoding={})),function(e){e[e.Unencrypted=0]="Unencrypted",e[e.Encrypted=1]="Encrypted"}(s=t.LogFileEncryption||(t.LogFileEncryption={})),function(e){e[e.PEM=0]="PEM",e[e.DER=1]="DER",e[e.BER=2]="BER"}(a=t.CertStoreFormat||(t.CertStoreFormat={})),function(e){e[e.InsertFront=8]="InsertFront"}(o=t.AppenderFlags||(t.AppenderFlags={})),t.vsprintf=l,t.sprintf=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return l(e,t)}},248632:function(e,t,i){"use strict";var n,r,s=this&&this.__extends||function(){var e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=i(937032);function o(e){if(null===e)return -1;for(var t=0,i=e.length-1;i>=0;i--)t=37*t+e.charCodeAt(i)|0;for(var n="__auf_literal:",i=n.length-1;i>=0;i--)t=37*t+n.charCodeAt(i)|0;return t}!function(e){e[e.Unsafe=0]="Unsafe",e[e.Safe=1]="Safe",e[e.Inherited_Unsafe=2]="Inherited_Unsafe",e[e.Inherited_Safe=3]="Inherited_Safe",e[e.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(n||(n={}));var l=function(){function e(e,t){this._level=a.LogLevel.Debug4,this._threshold=255,this._safe=n.Inherited_Unsafe,this._name=e,t&&(this._level=t.level(),this._safe=t.safe()?n.Inherited_Safe:n.Inherited_Unsafe,this._extendedInfo=t.extendedInfo())}return e.prototype.name=function(){return this._name},e.prototype.safe=function(){return this._safe===n.Safe||this._safe===n.Inherited_Safe},e.prototype.safety=function(){return this._safe},e.prototype.setSafety=function(e){this._safe=e},e.prototype.description=function(){return this._desc},e.prototype.setDescription=function(e){this._desc=e},e.prototype.level=function(){return this._level},e.prototype.setLevel=function(e){r.setLevel(this,e)},e.prototype._setLevel=function(e){this._level=e},e.prototype._setThreshold=function(e){this._threshold=e},e.prototype.isEnabled=function(e){return this._threshold<=e},e.prototype.setExtendedInfo=function(e){this._extendedInfo=e},e.prototype.extendedInfo=function(){return this._extendedInfo},e.prototype.trace=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Trace,o(e),e].concat(t))},e.prototype.debug6=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Debug6,o(e),e].concat(t))},e.prototype.debug5=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Debug5,o(e),e].concat(t))},e.prototype.debug4=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Debug4,o(e),e].concat(t))},e.prototype.debug3=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Debug3,o(e),e].concat(t))},e.prototype.debug2=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Debug2,o(e),e].concat(t))},e.prototype.debug1=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Debug1,o(e),e].concat(t))},e.prototype.warn=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Warning,o(e),e].concat(t))},e.prototype.error=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Error,o(e),e].concat(t))},e.prototype.fatal=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.Fatal,o(e),e].concat(t))},e.prototype.meta=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];r.log.apply(r,[this,a.LogLevel.MetaData,o(e),e].concat(t))},e}(),c=function(){function e(){}return e.instance=function(){return r},e.levelToString=function(e){if(e<=a.LogLevel.Trace)return"TRACE";if(e<=a.LogLevel.Debug6)return"DEBUG6";if(e<=a.LogLevel.Debug5)return"DEBUG5";if(e<=a.LogLevel.Debug4)return"DEBUG4";if(e<=a.LogLevel.Debug3)return"DEBUG3";else if(e<=a.LogLevel.Debug2)return"DEBUG2";else if(e<=a.LogLevel.Debug1)return"DEBUG1";else if(e<=a.LogLevel.Warning)return"WARN";else if(e<=a.LogLevel.Error)return"ERROR";else if(e<=a.LogLevel.Fatal)return"FATAL";else if(e<=a.LogLevel.MetaData)return"META";else return"META"},e.levelFromString=function(e){return this._levelFromString[e]||parseInt(e,10)},e}();function d(e,t){for(var i=t.name();i.length>0;)if(e[i])return e[i];else{var n=i.lastIndexOf(".");i=n<0?"":i.substr(0,n)}return e[""]?e[""]:a.LogLevel.Debug4}function u(e,t){var i=255;return t.forEach(function(t){var n=255;t.appender.levels()?n=Math.min(n,d(t.appender.levels(),e)):t.appender.receiveAll()||(n=Math.min(n,e.level())),i=Math.min(i,n)}),i}function h(e,t,i){return!!e.appender.receiveAll()||(e.appender.levels()?i>=d(e.appender.levels(),t):i>=t.level())}c._levelFromString={TRACE:a.LogLevel.Trace,DEBUG6:a.LogLevel.Debug6,DEBUG5:a.LogLevel.Debug5,DEBUG4:a.LogLevel.Debug4,DEBUG3:a.LogLevel.Debug3,DEBUG2:a.LogLevel.Debug2,DEBUG1:a.LogLevel.Debug1,WARN:a.LogLevel.Warning,ERROR:a.LogLevel.Error,FATAL:a.LogLevel.Fatal,META:a.LogLevel.MetaData},t.LogFactory=c,r=new(function(e){function t(){var t=e.call(this)||this;return t._nextId=0,t._appenders=[],t._components={},t._componentBlacklist=[],t._components[""]=new l("",null),t}return s(t,e),t.prototype.toHex=function(e){return(0x100000000+e).toString(16).substr(-8)},t.prototype.addAppender=function(e,t){void 0===t&&(t=0);var i=this._nextId++;return t&a.AppenderFlags.InsertFront?this._appenders.unshift({appender:e,handle:i}):this._appenders.push({appender:e,handle:i}),this.recalcComponentThresholds(),i},t.prototype.removeAppender=function(e){for(var t=0;t<this._appenders.length;t++)if(this._appenders[t].handle===e){this._appenders.splice(t,1);break}this.recalcComponentThresholds()},t.prototype.log=function(e,t,i,n){for(var r=[],s=4;s<arguments.length;s++)r[s-4]=arguments[s];try{if(e.isEnabled(t)){var a={timestamp:new Date().getTime(),component:e,level:t};this._appenders.forEach(function(s){h(s,e,t)&&s.appender.log(a,i,n,r)})}}catch(e){}},t.prototype.parent=function(e){for(;;){var t=e.lastIndexOf(".");if(e=t>=0?e.substr(0,t):"",this._components[e])return this._components[e]}},t.prototype.children=function(e){var t=[];for(var i in this._components)this.parent(i).name()===e&&t.push(this._components[i]);return t},t.prototype.component=function(e){if(this._components[e])return this._components[e];var t=new l(e,this.parent(e));this._components[e]=t;var i=u(t,this._appenders);return t._setThreshold(i),t},t.prototype.rootComponent=function(){return this.component("")},t.prototype.setSafetyRecursive=function(e,t){var i=this;this.children(e).forEach(function(e){(e.safety()===n.Inherited_Safe||e.safety()===n.Inherited_Unsafe)&&(e.setSafety(t),i.setSafetyRecursive(e.name(),t))})},t.prototype.declareComponentSafe=function(e,t){var i=this.component(e);-1!==this._componentBlacklist.indexOf(i.name())?i.setSafety(n.Blacklisted_Unsafe):i.setSafety(t?n.Safe:n.Unsafe),this.setSafetyRecursive(e,t?n.Inherited_Safe:n.Inherited_Unsafe)},t.prototype.declareComponentDescription=function(e,t){this.component(e).setDescription(t)},t.prototype.setExtendedInfoRecursive=function(e,t){var i=this;this.children(e).forEach(function(e){void 0===e.extendedInfo()&&(e.setExtendedInfo(t),i.setExtendedInfoRecursive(e.name(),t))})},t.prototype.declareComponentExtendedInfo=function(e,t){var i=this.component(e);i.setExtendedInfo(t),this.setExtendedInfoRecursive(i.name(),t)},t.prototype.recalcComponentThresholds=function(){for(var e in this._components){var t=this._components[e],i=u(t,this._appenders);t._setThreshold(i)}},t.prototype.setLevel=function(e,t){if(""===e.name())for(var i in this._components){var n=this._components[i];n._setLevel(t);var r=u(n,this._appenders);n._setThreshold(r)}else{var s=e.name()+".";e._setLevel(t);var r=u(e,this._appenders);for(var i in e._setThreshold(r),this._components){var n=this._components[i];if(n.name().substr(0,s.length)===s){n._setLevel(t);var a=u(n,this._appenders);n._setThreshold(a)}}}},t.prototype.setComponentBlacklist=function(e){for(var t in this._componentBlacklist=e,this._components){var i=this._components[t];-1!==this._componentBlacklist.indexOf(i.name())&&i.setSafety(n.Blacklisted_Unsafe)}},t}(c))},207217:function(e,t,i){"use strict";var n,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i(578521),a=i(248632),o=i(937032),l=i(549097),c=a.LogFactory.instance().component("RootToolsManager");a.LogFactory.instance().declareComponentSafe("RootToolsManager",!0);var d="638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104";!function(e){e[e.InternalBuild=0]="InternalBuild",e[e.PublicBuild=1]="PublicBuild"}(n=t.BuildType||(t.BuildType={}));var u=n.InternalBuild;function h(e){return(0x100000000+e).toString(16).substr(-8)}function g(e,t){var i=[];for(var n in e)i.push(t(n,e[n]));return i}function p(e,t,i){if(null==e)return null==t||0===t.length;if(null==t)return null==e||0===e.length;if(e.length===t.length){for(var n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1;return!0}return!1}function f(e,t){return null==e?null==t:null==t?null==e:e.arg===t.arg&&e.op===t.op&&e.value===t.value}function m(e,t){return null==e?null==t||0===t.logId:null==t?null==e||0===e.logId:e.logId===t.logId&&e.name===t.name&&p(e.matchers,t.matchers,f)}function v(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.parsedLevel===t.level}function S(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.level===t.level}function y(e){for(var t=[],i=0;i<e.length;i++)"string"==typeof e[i]||"number"==typeof e[i]?t.push(e[i]):t.push(JSON.stringify(e[i]));return t}t.setBuildType=function(e){var t=u;return u=e,t};var C=function(e){function t(t,i,n){var r=e.call(this)||this;return r._unmetConditions=[],r._rtMan=t,r._triggerCallback=i,r._ecsConfig=n,r.resetConditions(),r}return r(t,e),t.prototype.config=function(){return this._ecsConfig},t.prototype.configEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.mutualSubmissionType===e.mutualSubmissionType&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&this._ecsConfig.experimentTarget===e.experimentTarget&&m(this._ecsConfig.resetCondition,e.resetCondition)&&p(this._ecsConfig.conditions,e.conditions,m)&&p(this._ecsConfig.filters,e.filters,S)},t.prototype.nativeConfigEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&m(this._ecsConfig.resetCondition,e.resetCondition)&&p(this._ecsConfig.conditions,e.conditions,m)&&p(this._ecsConfig.filters,e.filters,v)},t.prototype.needReset=function(e){return!this.configEquals(e)},t.prototype.resetConditions=function(){this._unmetConditions=[];for(var e=0;e<this._ecsConfig.conditions.length;e++)this._unmetConditions.push(e)},t.prototype.matcherMatches=function(e,t){if(e.arg>=t.length)return!1;var i=t[e.arg],n="string"==typeof i?e.value:parseInt(e.value,10);if("="===e.op||"=="===e.op)return i===n;if("!="===e.op)return i!==n;if("<"===e.op)return i<n;if("<="===e.op)return i<=n;else if(">"===e.op)return i>n;else if(">="===e.op)return i>=n;else if("CONTAINS"===e.op.toUpperCase())return(""+i).indexOf(e.value)>=0;else return!1},t.prototype.conditionMatches=function(e,t,i){if(t!==e.logId)return!1;if(e.matchers){for(var n=0;n<e.matchers.length;n++)if(!this.matcherMatches(e.matchers[n],i))return!1}return!0},t.prototype.log=function(e,t,i,n){if(0!==this._unmetConditions.length&&e.component!==c){var r=this._ecsConfig;r.resetCondition&&this.conditionMatches(r.resetCondition,t,n)&&(c.debug4("LogTrigger %s: resetCondition met",r.name),this.resetConditions());for(var s=0;s<this._unmetConditions.length;s++){var a=this._unmetConditions[s];if(this.conditionMatches(r.conditions[a],t,n)){c.debug4("LogTrigger %s: condition %s met",r.name,r.conditions[a].name),this._unmetConditions.splice(s,1);break}}0===this._unmetConditions.length&&(c.debug1("LogTrigger %s has triggered, trying to send the log",r.name),this._triggerCallback.call(this._rtMan,r),r.reenableAfterTriggering&&this.resetConditions())}},t.prototype.receiveAll=function(){return!0},t}(l.AbstractLogAppender),b=function(e){function t(t,i,n){var r=e.call(this)||this;return r._circularBuffer=[],r._circularBufferMaxSize=0,r._onBufferOverflow=null,r._circularBuffer=[],r._circularBufferMaxSize=i,r._includeUnsafe=t,n?r._onBufferOverflow=n:r._onBufferOverflow=function(){return r._circularBuffer.shift()},r}return r(t,e),t.prototype.log=function(e,t,i,n){if((this._includeUnsafe||e.component.safe())&&!(this._circularBuffer.length>this._circularBufferMaxSize)){var r={md:e,logId:t,messages:y(n)};this._circularBuffer.push(r),this._circularBuffer.length>this._circularBufferMaxSize&&this._onBufferOverflow()}},t.prototype.visitReverseOrder=function(e){for(var t=this._circularBuffer.length-1;t>=0;t--){var i=this._circularBuffer[t];if(!e(i.md,i.logId,i.messages))return}},t.prototype.visitForwardOrder=function(e){for(var t=0;t<this._circularBuffer.length;t++){var i=this._circularBuffer[t];if(!e(i.md,i.logId,i.messages))return}},t.prototype.needReset=function(e,t){return e!==this._includeUnsafe||t!==this._circularBufferMaxSize},t.prototype.dumpLogBuffer=function(e,t,i){var n=this,r=new T(e.reverse),s=e.filter.map(function(e){return{component:"root"===e.component?"":e.component,parsedLevel:e.level}}),a=i||{matchedLines:0,totalLines:0},o=null;return(o=e.reverse?this.visitReverseOrder:this.visitForwardOrder).apply(this,[function(e,i,o){return a.totalLines++,n.filterMatches(e,i,o,s)&&(a.matchedLines++,r.log(e.component,e.timestamp,e.level,i,o)),!t||r._data.length<t}]),r.close(),r.data()},t.prototype.filterMatches=function(e,t,i,n){for(var r=0;r<n.length;r++)if((""===n[r].component||e.component.name()===n[r].component||e.component.name().substr(0,n[r].component.length)===n[r].component&&"."===e.component.name().charAt(n[r].component.length))&&e.level>=n[r].parsedLevel)return!0;return!1},t.prototype.clear=function(){this._circularBuffer=[]},t.prototype.size=function(){return this._circularBuffer.length},t.prototype.empty=function(){return 0===this.size()},t.prototype.capacity=function(){return this._circularBufferMaxSize},t}(l.AbstractLogAppender);t.CircularBuffer=b;var T=function(){function e(e){this._reverse=e,this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2! ",e?this._data+='"':this._data+=" ",this._data+=" "}return e.prototype._add8=function(e){if(this._pending.push(255&e),3===this._pending.length){var t=(this._pending[0]<<16)+(this._pending[1]<<8)+(0|this._pending[2]),i=this._base64chars[t>>18&63]+this._base64chars[t>>12&63]+this._base64chars[t>>6&63]+this._base64chars[(0|t)&63];this._data+=i,this._pending=[]}},e.prototype._add16=function(e){this._add8(e>>8&255),this._add8((0|e)&255)},e.prototype._add32=function(e){this._add8(e>>24&255),this._add8(e>>16&255),this._add8(e>>8&255),this._add8((0|e)&255)},e.prototype._add64=function(e){this._add32(e/0x100000000|0),this._add32(0|e)},e.prototype._addS=function(e){for(var t=0;t<e.length;t++)this._add8(e.charCodeAt(t));this._add8(0)},e.prototype._close=function(){for(;this._pending.length;)this._add8(0)},e.prototype.log=function(e,t,i,n,r){var s=this._components[e.name()];s||(s=++this._componentCount,this._components[e.name()]=s,this._add8(2),this._add16(s),this._addS(e.name()),this._addS(""),this._addS(""),this._add8(+!!e.safe()));var a=128;this._first&&(a|=2);var o=t-this._lastts;this._lastts=t,o>-128&&o<128&&(a|=1),this._add8(a),1&a?this._add8(o):this._add64(1e3*t),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(s),this._add8(i),this._add32(n),this._add8(r.length);for(var l=0;l<r.length;l++)this._add8(8),this._addS(""+r[l]);this._first=!1},e.prototype.close=function(){this._add8(7),this._close()},e.prototype.data=function(){return this._data},e.prototype.empty=function(){return this._first},e}(),E=function(e){function t(t,i,n,r){var s=e.call(this)||this;return s._capacity=t,s._onBufferOverflow=i,s._enableThrottling=n,s._maxVerbosityLevel=r,s._outputFormatter=new T(!1),s._linesStored=0,s._throttling=!1,s._linesThrottled=0,s}return r(t,e),t.prototype.log=function(e,t,i,n){(!this._maxVerbosityLevel||!(e.level<this._maxVerbosityLevel))&&(this._throttling?this._linesThrottled++:(this._linesStored++,this._outputFormatter.log(e.component,e.timestamp,e.level,t,y(n))),this._linesStored>this._capacity&&(this._enableThrottling?this._throttling||(this._throttling=!0):this._onBufferOverflow()))},t.prototype.dumpAndReset=function(){if(this._outputFormatter.empty())return"";this._linesThrottled>0&&this._outputFormatter.log(c,new Date().getTime(),o.LogLevel.Fatal,-1,["RooToolsManager: Log buffer overflow! "+this._linesThrottled+" lines thrown away"]),this._outputFormatter.close();var e=this._outputFormatter.data();return this.clearBuffer(),e},t.prototype.empty=function(){return this._outputFormatter.empty()},t.prototype.clearBuffer=function(){this._outputFormatter=new T(!1),this._linesStored=0,this._linesThrottled=0,this._throttling=!1},t.prototype.capacity=function(){return this._capacity},t.prototype.throttlingEnabled=function(){return this._enableThrottling},t.prototype.size=function(){return this._linesStored},t.prototype.maxVerbosityLevel=function(){return this._maxVerbosityLevel},t}(l.AbstractLogAppender);function _(e){return"Native"===e||"JavaScript"===e||"Mixed"===e}t.DumperBuffer=E,t.RootToolsManager=new(function(){function e(){this._maxUploadSize=0,this._jsToNativeBuffer=null,this._jsToNativeBufferHandle=null,this._jsToNativeFlushTimer=null,this._jsToNativeFlushInterval=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:o.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed",this._BRBCallback=null}return e.prototype.setDelegate=function(e){this._glue=e,this.registerListeners()},e.prototype.isDelegateSet=function(){return null!=this._glue},e.prototype.setNativeFunctions=function(e){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=e,this._native&&this._native.log_config.addLogTriggerListener(this)},e.prototype.applyLogLevels=function(){var e={};for(var t in this._localLogLevels)e[t]=this._localLogLevels[t];e[""]=e.root||o.LogLevel.Debug4,delete e.root;var i=g(e,function(e,t){return{component:e,level:t}});i.sort(function(e,t){return e.component.length-t.component.length}),i.forEach(function(e){return a.LogFactory.instance().component(e.component).setLevel(e.level)}),this._native&&this._native.log_config.setLogLevelConfig(i)},e.prototype.setLocalLogLevelConfig=function(e){this._localLogLevels=e,this.applyLogLevels()},e.prototype.parseMatcher=function(e){return null==e||null==e.arg||null==e.op||null==e.value?null:{arg:e.arg,op:e.op,value:e.value}},e.prototype.parseCondition=function(e){if(null==e||null==e.logId||e.matchers&&!(e.matchers instanceof Array))return null;var t={name:e.name||h(e.logId),logId:e.logId,matchers:[]};if(e.matchers&&e.matchers.length)for(var i=0,n=e.matchers;i<n.length;i++){var r=n[i],s=this.parseMatcher(r);s&&t.matchers.push(s)}return t},e.prototype.parseFilter=function(e){return null==e||null==e.component||0===e.component.length?null:{component:e.component,level:e.level,parsedLevel:a.LogFactory.levelFromString(e.level)}},e.prototype.parseConfig=function(e,t,i){if(null==e||!(e.conditions instanceof Array)||0==e.conditions.length||!(e.filters instanceof Array)||0==e.filters.length||e.resetCondition&&!this.parseCondition(e.resetCondition))return null;for(var r={name:e.name||t+"->"+i,ecsNs:t,reenableAfterTriggering:e.reenableAfterTriggering||!1,mutualSubmissionType:e.mutualSubmissionType||"",includeUnsafe:u!==n.PublicBuild&&(e.includeUnsafe||!1),experimentTarget:_(e.experimentTarget)&&e.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==e.resetCondition?e.resetCondition:this.parseCondition(e.resetCondition),filters:[]},s=0,a=e.conditions;s<a.length;s++){var o=a[s],l=this.parseCondition(o);l&&r.conditions.push(l)}for(var c=0,d=e.filters;c<d.length;c++){var h=d[c],g=this.parseFilter(h);g&&r.filters.push(g)}return 0===r.conditions.length?null:r},e.prototype.isExperimentListed=function(e,t,i,n){return!!e&&(!!(n&&e.some(function(e){return"*"===e.namespace}))||e.some(function(e){return e.namespace===t&&(e.experiment===i||"*"==e.experiment)}))},e.prototype.isExperimentAllowed=function(e,t,i){return!this.isExperimentListed(e.blacklist,t,i,!0)||this.isExperimentListed(e.whitelist,t,i,!1)},e.prototype.findTrigger=function(e,t){for(var i in e)if(e[i].configEquals(t))return i;return null},e.prototype.findTriggerByNativeConfig=function(e,t){for(var i in e)if(e[i].nativeConfigEquals(t))return i;return null},e.prototype.OnEcsChange=function(){var e=this;function t(e,i,n){return i<e.length?n(e[i]).then(function(){return t(e,i+1,n)}):s.Resolved()}return null==this._glue?s.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then(function(i){c.debug4("Reloading ULBaseline config - new config: %@",i),i||(c.warn("No ULBaseline config"),i={}),e._maxUploadSize=i.logUpload&&i.logUpload.maxSize||1024;var n=[],r=e._triggers;e._triggers={};var s=(i.logUpload&&i.logUpload.maxSize||1024)/100,d=i.circularBuffer&&i.circularBuffer.enabled,u=i.circularBuffer&&i.circularBuffer.buffers||e._defaultBuffers,h=i.circularBuffer&&i.circularBuffer.storeUnsafe;e._defaultExperimentTarget=_(i.defaultExperimentTarget)&&i.defaultExperimentTarget||"Mixed";var p=i.killswitch||e._defaultKillswitch,f=i.blacklists||e._defaultBlacklists;f.component.length>0&&a.LogFactory.instance().setComponentBlacklist(f.component);var m={};(i.componentLevels||[]).forEach(function(e){return m[e.component]=e.level}),t(i.configPaths||[],0,function(t){return e._glue.fetchEcsConfig(t.ns,t.key).then(function(i){var s=i instanceof Array?i:[i];c.debug4("Reloading ECS config for %s->%s - new config: %@",t.ns,t.key,s);for(var a=0,o=s;a<o.length;a++){var l=o[a];if(null!=l){var u=e.parseConfig(l,t.ns,t.key);if(null==u){c.error("Failed to parse ECS config for %s->%s",t.ns,t.key);continue}if("JavaScript"!==u.experimentTarget&&"Mixed"!==u.experimentTarget){c.debug4("Skipping %s->%s, targeted for %s",t.ns,t.key,u);continue}if(c.debug2("Parsed ECS config for %s->%s - %@",t.ns,t.key,u),e.isExperimentAllowed(p,t.ns,u.name)){c.debug2("Allowing %s->%s:%s according to killswitch",t.ns,t.key,u.name),d=!0;var g=e.findTrigger(r,u);null!=g?(c.debug2("Triggers updated, keeping trigger %s",u.name),e._triggers[g]=r[g],delete r[g]):n.push(u),u.filters&&u.filters.forEach(function(e){return m[e.component]=Math.min(m[e.component]||255,e.parsedLevel)}),u.includeUnsafe&&(h=!0)}else c.debug2("Disallowing %s->%s according to killswitch",t.ns,t.key)}}})}).always(function(){for(var t in e.applyLogLevels(),r)c.debug2("Triggers updated, removing trigger %s",r[t].config().name),a.LogFactory.instance().removeAppender(+t);if(n.forEach(function(t){c.debug2("Triggers updated, adding trigger %s",t.name);var i=new C(e,e._triggered,t),n=a.LogFactory.instance().addAppender(i);e._triggers[String(n)]=i}),m[""]=m.root||o.LogLevel.Debug4,delete m.root,e._circularBuffer&&(!d||e._circularBuffer.needReset(h,s))?(c.debug2("Buffer updated, removing existing buffer"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBuffer=null,e._circularBufferHandle=null):e._circularBuffer&&(Object.keys(r).length>0||n.length>0?(c.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBufferHandle=null):c.debug2("Buffer updated, no change")),d&&(e._circularBuffer||(c.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",h,s),e._circularBuffer=new b(h,s)),null==e._circularBufferHandle&&(c.debug2("Creating log level wrapper"),e._circularBufferHandle=a.LogFactory.instance().addAppender(l.wrapAppenderWithLogLevels(e._circularBuffer,m),o.AppenderFlags.InsertFront))),e._native){var i=g(m,function(e,t){return{component:e,level:t}});i.sort(function(e,t){return e.component.length-t.component.length}),e._native.log_config.setLogBufferConfig(d,{storeUnsafe:h,buffers:u},i);var p=[];for(var f in e._triggers){var v=e._triggers[f].config();p.push({name:v.name,ecsNs:v.ecsNs,conditions:v.conditions,resetCondition:v.resetCondition,includeUnsafe:v.includeUnsafe,reenableAfterTriggering:v.reenableAfterTriggering,filters:v.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),dumpFile:!1,metadata:{}})}e._native.log_config.setLogTriggerConfig(p,{})}})})},e.prototype._send=function(e,t){null!=this._glue&&(this._glue.sendTelemetry(d,{logTriggerName:e.name,logEcsNs:e.ecsNs,logdata:t}),c.debug4("LogSender::send, sent %d bytes",t.length))},e.prototype.triggered=function(e,t){},e.prototype.triggeredPartially=function(e,t,i,n,r){var s=this.findTriggerByNativeConfig(this._triggers,e);if(s){var o={level:t.level,component:a.LogFactory.instance().component(t.component),timestamp:t.timestamp};this._triggers[s].log(o,i,n,r)}},e.prototype.reset=function(e){var t=this.findTriggerByNativeConfig(this._triggers,e);t&&this._triggers[t].resetConditions()},e.prototype.dumpLogBuffer=function(e,t){if(this._circularBuffer){var i={matchedLines:0,totalLines:0},n=this._circularBuffer.dumpLogBuffer(e,this._maxUploadSize,i);if(c.debug4("dumpLogBuffer: dumped %d of %d lines, size of payload: %d",i.matchedLines,i.totalLines,null!=n?n.length:0),!this._native)return s.Resolved(n);var r=s.Defer();return this._native.log_config.mergeAndDumpLogBuffer(n,e,t,function(e){return r.resolve(e)}),r.promise()}return c.warn("dumpLogBuffer: no log buffer enabled"),s.Rejected()},e.prototype._triggered=function(e){var t=this,i={compression:o.LogFileCompression.Compress,encoding:o.LogFileEncoding.Base64,encryption:o.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},n={includeUnsafe:e.includeUnsafe,filter:e.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),reverse:!0};this.dumpLogBuffer(n,i).then(function(i){return t._send(e,i)})},e.prototype.sendBRBEvent=function(e,t){try{if(c.debug2("sendBRBEvent %s",JSON.stringify(e)),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var i={eventType:"uploadBRB",mutualSubmissionType:"call",payload:e},n=void 0!==t?JSON.stringify({userIds:t}):"";this._glue.sendLoggingEventToNative(JSON.stringify(i),n)}}catch(e){c.error("sendBRBEvent %s: %s",e.name,e.message)}},e.prototype.setBRBCallback=function(e){return(c.debug2("setBRBCallback"),null==this._glue)?void c.warn("setBRBCallback: RootToolsManagerDelegate is not set"):"function"!=typeof this._glue.setNativeLoggingEventCallback?void c.warn("setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method"):void(this._BRBCallback=e)},e.prototype.registerListeners=function(){var e=this;if(null==this._glue||"function"!=typeof this._glue.setNativeLoggingEventCallback)return void c.warn("registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method");this._glue.setNativeLoggingEventCallback(function(t,i){return e.handleNativeLoggingEvent(t,i)})},e.prototype.handleNativeLoggingEvent=function(e,t){try{c.debug2("Native Log event message: %s aux: %s",e,t);var i=JSON.parse(e);if(i.eventType&&"uploadBRB"===i.eventType){if("function"!=typeof this._BRBCallback)return void c.warn("BRBCallback not set, ignoring native event");c.debug4("Sending BRB callback: %@",i.payload),this._BRBCallback(i.payload)}else i.eventType&&"jsLogFileConfiguration"===i.eventType&&this.handleLogFileConfigEvent(i)}catch(e){c.error("handleNativeLoggingEvent %s: %s",e.name,e.message)}},e.prototype.handleLogFileConfigEvent=function(e){if(e.payload){var t=e.payload;if(!t.enabled)return void this.flushDisableJsToNativeLogging();if(t.chunkSize&&t.flushInterval){var i={chunkSize:t.chunkSize,flushInterval:t.flushInterval,enableThrottling:t.enableThrottling,maxVerbosityLevel:t.maxVerbosityLevel};this.startJsToNativeLogging(i)}}},e.prototype.logExternalForDDL=function(e,t){try{if(c.debug2("logExternalForDDL %s %s",e,t),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var i={eventType:"logInSClog",payload:{message:e,parameters:t}};this._glue.sendLoggingEventToNative(JSON.stringify(i),"")}else c.warn("ignoring logExternalForDDL, delegate misconfigured")}catch(e){c.error("logExternalForDDL %s: %s",e.name,e.message)}},e.prototype.startJsToNativeLogging=function(e){var t=this,i=e.chunkSize,n=e.flushInterval,r=e.enableThrottling,s=this._getVerbosityLevelFromConfig(e.maxVerbosityLevel);if(this._jsToNativeBuffer){if(this._jsToNativeBuffer.capacity()===i&&this._jsToNativeFlushInterval===n&&this._jsToNativeBuffer.throttlingEnabled()===r&&this._jsToNativeBuffer.maxVerbosityLevel()===s)return void c.debug1("Same JS2Native settings received - doing nothing");c.debug1("Reapplying js to native settings"),this.flushDisableJsToNativeLogging()}this._jsToNativeBuffer=new E(i,function(){t.onJsToNativeBufferReady(t._jsToNativeBuffer)},r,s),this.setJsToNativeFlushTimeout(n),this._jsToNativeFlushInterval=n,this._jsToNativeBufferHandle=a.LogFactory.instance().addAppender(this._jsToNativeBuffer)},e.prototype._getVerbosityLevelFromConfig=function(e){return e?a.LogFactory.levelFromString(e):null},e.prototype.flushDisableJsToNativeLogging=function(){this._jsToNativeBuffer&&this.onJsToNativeBufferReady(this._jsToNativeBuffer),this.plainDisableJsToNativeLogging()},e.prototype.plainDisableJsToNativeLogging=function(){this.clearJsToNativeFlushTimeout(),this._jsToNativeBufferHandle&&(a.LogFactory.instance().removeAppender(this._jsToNativeBufferHandle),this._jsToNativeBufferHandle=0,this._jsToNativeBuffer=null,c.debug1("Disabling forwarding JS logs to native"))},e.prototype.onJsToNativeBufferReady=function(e){null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative?(this.clearJsToNativeFlushTimeout(),this.dumpJsToNativeBuffer(e),this.setJsToNativeFlushTimeout(this._jsToNativeFlushInterval)):this.plainDisableJsToNativeLogging()},e.prototype.dumpJsToNativeBuffer=function(e){if(!e.empty()){var t=e.dumpAndReset(),i={eventType:"writeLogData"};this._glue.sendLoggingEventToNative(JSON.stringify(i),t)}},e.prototype.clearJsToNativeFlushTimeout=function(){this._jsToNativeFlushTimer&&(clearTimeout(this._jsToNativeFlushTimer),this._jsToNativeFlushTimer=null)},e.prototype.setJsToNativeFlushTimeout=function(e){var t=this;!this._jsToNativeFlushTimer&&e&&(this._jsToNativeFlushTimer=setTimeout(function(){t._jsToNativeFlushTimer=null,t.onJsToNativeBufferReady(t._jsToNativeBuffer)},e))},e.prototype.stopAsyncOperations=function(){this.flushDisableJsToNativeLogging()},e}())},83836:function(e,t,i){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i(937032)),n(i(248632)),n(i(207217)),n(i(549097)),n(i(791188))},791188:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n,r=function(e){return e},s=!0,a=r,o={},l=0;function c(e){return o[e]="u"+ ++l}var d=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.InternalSkype=48]="InternalSkype"}(i||(i={}));var u=[i.Thread,i.InternalSkype];t.enableAnonymization=function(e){s=e},t.useTagger=function(e){a=e||r},function(e){function t(e){return s?e?o[e]||c(e):null:e}e.UserName=function(e){var i=t(e);return a(i)},e.Mri=function(e){var i,n=e.match(d);if(n){var r=Number(n[1]),s=n[2];i=-1!=u.indexOf(r)?e:r+":"+t(s)}else i=t(e);return a(i)},e.Omit=function(e){var t;return t=s?"number"==typeof e?19229:"string"==typeof e?e.charAt(0)+"...":null:e,a(t)}}(n=t.pii||(t.pii={}))},370574:function(e){var t;!function(e){var t;!function(e){var t,i,n,r,s,a,o,l,c,d,u,h,g,p,f,m,v,S,y,C,b,T,E,_,I,w,P,R,A,M,D,O,k,N,x,L,F,U,$,V,B,H,j,q,W,G,z,J,K,Q,Y,Z,X,ee,et,ei,en,er,es,ea,eo,el,ec,ed,eu,eh,eg,ep,ef,em,ev,eS,ey,eC,eb,eT,eE,e_,eI,ew,eP,eR,eA,eM,eD,eO,ek,eN,ex,eL,eF,eU,e$,eV,eB,eH,ej,eq,eW,eG,ez,eJ,eK,eQ,eY,eZ,eX,e0,e1,e2,e3,e4,e5,e6,e8,e9,e7,te,tt,ti,tn,tr,ts,ta,to,tl,tc,td,tu,th,tg,tp,tf,tm,tv,tS,ty,tC,tb,tT,tE,t_,tI,tw,tP,tR,tA,tM,tD,tO,tk,tN,tx,tL,tF,tU,t$,tV,tB,tH,tj,tq,tW,tG,tz,tJ,tK,tQ,tY;!function(e){e[e.None=0]="None",e[e.Notified=1]="Notified",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected",e[e.LocalHold=4]="LocalHold",e[e.RemoteHold=5]="RemoteHold",e[e.Disconnecting=6]="Disconnecting",e[e.Disconnected=7]="Disconnected",e[e.Observing=8]="Observing",e[e.EarlyMedia=9]="EarlyMedia",e[e.InLobby=10]="InLobby",e[e.Preheating=11]="Preheating",e[e.Preheated=12]="Preheated",e[e.Staging=13]="Staging",e[e.NegotiatingEncryption=14]="NegotiatingEncryption",e[e.NegotiatingEncryptionLobby=15]="NegotiatingEncryptionLobby"}(t=e.CallState||(e.CallState={})),function(e){e[e.Testing=0]="Testing",e[e.MicrosoftWNS=1]="MicrosoftWNS",e[e.MicrosoftWP7NS=2]="MicrosoftWP7NS",e[e.AppleAPN=3]="AppleAPN",e[e.GoogleAGCM=4]="GoogleAGCM",e[e.Hotmail=5]="Hotmail",e[e.GoogleAC2DM=6]="GoogleAC2DM",e[e.Trouter=7]="Trouter",e[e.Griffin=8]="Griffin",e[e.ADM=9]="ADM",e[e.NNA=10]="NNA"}(i=e.ServiceType||(e.ServiceType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(n=e.TrouterStateFromSkypeTsTrouter||(e.TrouterStateFromSkypeTsTrouter={})),function(e){e[e.Unknown=0]="Unknown",e[e.Active=1]="Active",e[e.Inactive=2]="Inactive"}(r=e.UserActivityState||(e.UserActivityState={})),function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Accepted=2]="Accepted",e[e.Completed=3]="Completed",e[e.Failed=4]="Failed"}(s=e.TransferState||(e.TransferState={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Transfer=1]="Transfer",e[e.Park=2]="Park",e[e.TransferToVoicemail=3]="TransferToVoicemail"}(a=e.CallOrigin||(e.CallOrigin={})),function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Parking=2]="Parking",e[e.Parked=3]="Parked",e[e.Failed=4]="Failed"}(o=e.ParkState||(e.ParkState={})),function(e){e[e.Team=0]="Team",e[e.SharedLine=1]="SharedLine",e[e.ServerHold=2]="ServerHold",e[e.ServerHoldV2=3]="ServerHoldV2",e[e.SharedLineV2=4]="SharedLineV2",e[e.CallPark=5]="CallPark"}(l=e.ParkContext||(e.ParkContext={})),function(e){e[e.BreakoutRoom=0]="BreakoutRoom",e[e.MusicOnHoldV2=1]="MusicOnHoldV2",e[e.SharedLineAppearanceV2=2]="SharedLineAppearanceV2",e[e.CallParkV2=3]="CallParkV2"}(c=e.ClientScenario||(e.ClientScenario={})),function(e){e[e.Transfer=0]="Transfer",e[e.Park=1]="Park",e[e.TransferToVoicemail=2]="TransferToVoicemail"}(d=e.TransferType||(e.TransferType={})),function(e){e[e.None=0]="None",e[e.Connecting=1]="Connecting",e[e.Ringing=2]="Ringing",e[e.Connected=3]="Connected",e[e.Disconnected=4]="Disconnected",e[e.OnHold=5]="OnHold",e[e.EarlyMedia=6]="EarlyMedia",e[e.InLobby=7]="InLobby",e[e.Staging=8]="Staging",e[e.NegotiatingEncryption=9]="NegotiatingEncryption",e[e.NegotiatingEncryptionLobby=10]="NegotiatingEncryptionLobby"}(u=e.ParticipantState||(e.ParticipantState={})),function(e){e[e.None=0]="None",e[e.AddingFailed=1]="AddingFailed",e[e.NoResponse=2]="NoResponse",e[e.Declined=3]="Declined",e[e.NotReachable=4]="NotReachable",e[e.Blocked=5]="Blocked",e[e.NotFriendOrAuthorized=6]="NotFriendOrAuthorized",e[e.CallLimitReached=7]="CallLimitReached",e[e.CallNotFound=8]="CallNotFound",e[e.NetworkError=9]="NetworkError",e[e.MediaDroppedError=10]="MediaDroppedError",e[e.OtherError=11]="OtherError",e[e.PstnInsufficientFunds=12]="PstnInsufficientFunds",e[e.PstnSkypeoutAccountBlocked=13]="PstnSkypeoutAccountBlocked",e[e.PstnCouldNotConnectToSkypeProxy=14]="PstnCouldNotConnectToSkypeProxy",e[e.PstnBlockedByUs=15]="PstnBlockedByUs",e[e.PstnBlockedRegulatoryIndia=16]="PstnBlockedRegulatoryIndia",e[e.PstnInvalidNumber=17]="PstnInvalidNumber",e[e.PstnNumberForbidden=18]="PstnNumberForbidden",e[e.Busy=19]="Busy",e[e.PstnCallTerminated=20]="PstnCallTerminated",e[e.PstnNumberUnavailable=21]="PstnNumberUnavailable",e[e.PstnEmergencyCallDenied=22]="PstnEmergencyCallDenied",e[e.Cancelled=23]="Cancelled",e[e.Dropped=24]="Dropped",e[e.PstnNoSubscriptionCover=25]="PstnNoSubscriptionCover",e[e.PstnCreditExpired=26]="PstnCreditExpired",e[e.PstnCreditExpiredButEnough=27]="PstnCreditExpiredButEnough",e[e.EnterprisePstnInternalError=28]="EnterprisePstnInternalError",e[e.EnterprisePstnUnavailable=29]="EnterprisePstnUnavailable",e[e.EnterprisePstnForbidden=30]="EnterprisePstnForbidden",e[e.EnterprisePstnInvalidNumber=31]="EnterprisePstnInvalidNumber",e[e.EnterprisePstnMiscError=32]="EnterprisePstnMiscError",e[e.Kicked=33]="Kicked",e[e.NetworkRequestTimeoutError=34]="NetworkRequestTimeoutError",e[e.CallDoesNotExist=35]="CallDoesNotExist",e[e.MediaSetupFailure=36]="MediaSetupFailure",e[e.ServiceUnavailable=37]="ServiceUnavailable",e[e.SignalingError=38]="SignalingError",e[e.ConversationEstablishmentFailed=39]="ConversationEstablishmentFailed",e[e.TemporarilyUnavailable=40]="TemporarilyUnavailable",e[e.CannotConnectToNetworkError=41]="CannotConnectToNetworkError",e[e.NoSignalingFromPeer=42]="NoSignalingFromPeer",e[e.ParticipantDoesNotExist=43]="ParticipantDoesNotExist",e[e.DeniedInLobby=44]="DeniedInLobby",e[e.TimedOutInLobby=45]="TimedOutInLobby",e[e.ConfParticipantCountLimitReached=46]="ConfParticipantCountLimitReached",e[e.Abandoned=47]="Abandoned",e[e.ActionNotAllowed=48]="ActionNotAllowed",e[e.ForbiddenDueToPolicy=49]="ForbiddenDueToPolicy",e[e.InsufficientCapabilitiesForCallee=50]="InsufficientCapabilitiesForCallee",e[e.AccessDenied=51]="AccessDenied",e[e.NoPermission=52]="NoPermission",e[e.AnonymousJoinDisabledByPolicy=53]="AnonymousJoinDisabledByPolicy",e[e.NoLobbyForBroadcastJoin=54]="NoLobbyForBroadcastJoin",e[e.NotAllowedDueToInformationBarrier=55]="NotAllowedDueToInformationBarrier",e[e.BroadcastLimitReached=56]="BroadcastLimitReached",e[e.B2bJoinDisabledByPolicy=57]="B2bJoinDisabledByPolicy",e[e.LocationBasedRoutingError=58]="LocationBasedRoutingError",e[e.ConfLobbyParticipantCountLimitReached=59]="ConfLobbyParticipantCountLimitReached",e[e.LobbyUserLeft=60]="LobbyUserLeft"}(h=e.ParticipantStateReason||(e.ParticipantStateReason={})),function(e){e[e.Supported=0]="Supported",e[e.BrowserNotSupported=1]="BrowserNotSupported",e[e.IncompatibleVersions=2]="IncompatibleVersions"}(g=e.CallSupport||(e.CallSupport={})),function(e){e[e.CallSetupFailed=0]="CallSetupFailed",e[e.CallDropped=1]="CallDropped",e[e.Undefined=2]="Undefined"}(p=e.FailureType||(e.FailureType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Good=1]="Good",e[e.Poor=2]="Poor",e[e.Bad=3]="Bad"}(f=e.QualityLevel||(e.QualityLevel={})),function(e){e[e.NetworkSendQuality=1]="NetworkSendQuality",e[e.NetworkRecvQuality=2]="NetworkRecvQuality",e[e.NetworkDelay=3]="NetworkDelay",e[e.NetworkBandwidthLow=4]="NetworkBandwidthLow",e[e.NetworkReconnect=5]="NetworkReconnect",e[e.NetworkPacketLoss=6]="NetworkPacketLoss",e[e.NetworkJitter=7]="NetworkJitter",e[e.NetworkRateMatching=8]="NetworkRateMatching",e[e.DeviceCaptureNotFunctioning=9]="DeviceCaptureNotFunctioning",e[e.DeviceRenderNotFunctioning=10]="DeviceRenderNotFunctioning",e[e.DeviceRenderGlitches=11]="DeviceRenderGlitches",e[e.DeviceLowSNR=12]="DeviceLowSNR",e[e.DeviceLowSpeechLevel=13]="DeviceLowSpeechLevel",e[e.DeviceClipping=14]="DeviceClipping",e[e.DeviceEcho=15]="DeviceEcho",e[e.DeviceNearEndToEchoRatio=16]="DeviceNearEndToEchoRatio",e[e.DeviceHalfDuplexAec=17]="DeviceHalfDuplexAec",e[e.DeviceMultipleEndpoints=18]="DeviceMultipleEndpoints",e[e.DeviceHowling=19]="DeviceHowling",e[e.DeviceRenderZeroVolume=20]="DeviceRenderZeroVolume",e[e.DeviceRenderMute=21]="DeviceRenderMute",e[e.NetworkSendCatastrophic=22]="NetworkSendCatastrophic",e[e.NetworkRecvCatastrophic=23]="NetworkRecvCatastrophic",e[e.CpuInsufficient=24]="CpuInsufficient",e[e.DeviceCaptureMute=25]="DeviceCaptureMute",e[e.DeviceCaptureNotMuteButSilent=26]="DeviceCaptureNotMuteButSilent",e[e.DeviceSpeakWhileMuted=27]="DeviceSpeakWhileMuted",e[e.VideoVbssRendered=28]="VideoVbssRendered",e[e.NetworkEthernetInterfaceUsed=29]="NetworkEthernetInterfaceUsed",e[e.NetworkWlanInterfaceUsed=30]="NetworkWlanInterfaceUsed",e[e.NetworkWwanInterfaceUsed=31]="NetworkWwanInterfaceUsed",e[e.NetworkRelaysNotReachable=32]="NetworkRelaysNotReachable",e[e.VideoCapturerDeviceStartFailed=33]="VideoCapturerDeviceStartFailed",e[e.VideoCapturerDeviceStartTimedOut=34]="VideoCapturerDeviceStartTimedOut",e[e.VideoCapturerDeviceStartFailureLackSystemRes=35]="VideoCapturerDeviceStartFailureLackSystemRes",e[e.VideoCapturerDeviceStartFailureMFResConflict=36]="VideoCapturerDeviceStartFailureMFResConflict",e[e.NoNetwork=37]="NoNetwork",e[e.NetworkNotWorking=38]="NetworkNotWorking",e[e.DeviceCaptureNotFunctioningDeviceInUse=39]="DeviceCaptureNotFunctioningDeviceInUse",e[e.DeviceRenderNotFunctioningDeviceInUse=40]="DeviceRenderNotFunctioningDeviceInUse",e[e.DeviceCaptureNotFunctioningAudioSrvNotRunning=41]="DeviceCaptureNotFunctioningAudioSrvNotRunning",e[e.DeviceRenderNotFunctioningAudioSrvNotRunning=42]="DeviceRenderNotFunctioningAudioSrvNotRunning",e[e.ZeroCaptureDevicesEnumerated=43]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=44]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=45]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=46]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=47]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=48]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=49]="DeviceRenderHowling",e[e.LowFarEndInput=50]="LowFarEndInput",e[e.ImageRenderingQuality=51]="ImageRenderingQuality",e[e.RemoteNetworkConnectivityIssue=52]="RemoteNetworkConnectivityIssue",e[e.PresentationAudioLoopbackDeviceState=53]="PresentationAudioLoopbackDeviceState",e[e.AudioCaptureUltrasoundDetected=54]="AudioCaptureUltrasoundDetected",e[e.ScreenshareRecordingDisabled=55]="ScreenshareRecordingDisabled",e[e.MultichannelAudioBandwidth=56]="MultichannelAudioBandwidth",e[e.MusicModeNotAvailable=57]="MusicModeNotAvailable",e[e.MusicModeSupported=58]="MusicModeSupported",e[e.AudioCaptureMusicDetectedWithHighNS=59]="AudioCaptureMusicDetectedWithHighNS",e[e.AudioCaptureMusicDetectedWithLowNS=60]="AudioCaptureMusicDetectedWithLowNS",e[e.CameraLighting=61]="CameraLighting",e[e.DeviceCaptureVoiceActive=62]="DeviceCaptureVoiceActive",e[e.AudioLoopbackDeviceReady=63]="AudioLoopbackDeviceReady",e[e.NoRequiredVideoCodecs=64]="NoRequiredVideoCodecs",e[e.SpatialAudioMUCHUnavailable=65]="SpatialAudioMUCHUnavailable",e[e.SpeechOverlapFailedInterruptionDetected=66]="SpeechOverlapFailedInterruptionDetected",e[e.BackgroundSpeechSuppressed=67]="BackgroundSpeechSuppressed",e[e.BackgroundLoudSpeechSuppressed=68]="BackgroundLoudSpeechSuppressed",e[e.ActiveSpeechDetected=69]="ActiveSpeechDetected",e[e.DeviceCaptureNotFunctioningBluetoothMidCallFail=70]="DeviceCaptureNotFunctioningBluetoothMidCallFail",e[e.DeviceCaptureNotFunctioningWebcamMicMidCallFail=71]="DeviceCaptureNotFunctioningWebcamMicMidCallFail",e[e.DeviceCaptureNotMuteButSilentDongle=72]="DeviceCaptureNotMuteButSilentDongle",e[e.DeviceRenderNotFunctioningBluetoothMidCallFail=73]="DeviceRenderNotFunctioningBluetoothMidCallFail",e[e.ZeroCaptureDevicesEnumeratedRDP=74]="ZeroCaptureDevicesEnumeratedRDP",e[e.ZeroRenderDevicesEnumeratedRDP=75]="ZeroRenderDevicesEnumeratedRDP",e[e.WrongCaptureDevicesUsedRDP=76]="WrongCaptureDevicesUsedRDP",e[e.WrongRenderDevicesUsedRDP=77]="WrongRenderDevicesUsedRDP",e[e.NetworkStatusIndicator=78]="NetworkStatusIndicator",e[e.LoopbackDeviceRenderNotFunctioning=79]="LoopbackDeviceRenderNotFunctioning",e[e.AudioMixMUCHUnavailable=80]="AudioMixMUCHUnavailable",e[e.HighSystemMemoryUsage=81]="HighSystemMemoryUsage",e[e.NetworkStatusIndicatorBandwidthQuality=82]="NetworkStatusIndicatorBandwidthQuality",e[e.NetworkStatusIndicatorVideoQuality=83]="NetworkStatusIndicatorVideoQuality",e[e.NetworkStatusIndicatorAudioQuality=84]="NetworkStatusIndicatorAudioQuality",e[e.NetworkStatusIndicatorWifiQuality=85]="NetworkStatusIndicatorWifiQuality",e[e.NetworkStatusIndicatorUplinkBandwidthQuality=86]="NetworkStatusIndicatorUplinkBandwidthQuality",e[e.NetworkStatusIndicatorLossRateQuality=87]="NetworkStatusIndicatorLossRateQuality"}(m=e.QualityEventType||(e.QualityEventType={})),function(e){e[e.Video=0]="Video",e[e.ScreenSharing=1]="ScreenSharing",e[e.Ums=2]="Ums"}(v=e.StreamType||(e.StreamType={})),function(e){e[e.All=0]="All",e[e.Specified=1]="Specified"}(S=e.MuteScope||(e.MuteScope={})),function(e){e[e.Incoming=0]="Incoming",e[e.Outgoing=1]="Outgoing",e[e.WarmPush=2]="WarmPush",e[e.MediaInit=3]="MediaInit"}(y=e.CallingIntent||(e.CallingIntent={})),function(e){e[e.AllSupported=0]="AllSupported",e[e.NoDirectConnection=1]="NoDirectConnection"}(C=e.ConnectionType||(e.ConnectionType={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.Ellipse=1]="Ellipse"}(b=e.OcclusionShape||(e.OcclusionShape={})),function(e){e[e.Stretch=0]="Stretch",e[e.Crop=1]="Crop",e[e.Fit=2]="Fit"}(T=e.ScalingMode||(e.ScalingMode={})),function(e){e[e.Unknown=-1]="Unknown",e[e.CaptureError=0]="CaptureError",e[e.RendererFailed=1]="RendererFailed",e[e.RendererFailedGpuContext=2]="RendererFailedGpuContext",e[e.RendererFailedUnavailable=3]="RendererFailedUnavailable"}(E=e.RendererErrorType||(e.RendererErrorType={})),function(e){e[e.Unknown=-1]="Unknown",e[e.VideoElement=0]="VideoElement",e[e.WebGLv1=1]="WebGLv1",e[e.WebGLv2=2]="WebGLv2",e[e.Pepper=3]="Pepper",e[e.ReactNative=4]="ReactNative"}(_=e.RendererType||(e.RendererType={})),function(e){e[e.Unknown=-1]="Unknown",e[e.None=0]="None",e[e.Software=1]="Software",e[e.Hardware=2]="Hardware"}(I=e.FrameType||(e.FrameType={})),function(e){e[e.Default=1]="Default",e[e.Auto=2]="Auto",e[e.Check=4]="Check",e[e.Rect=8]="Rect",e[e.Slider=16]="Slider",e[e.Selection=32]="Selection",e[e.Snapback=64]="Snapback"}(w=e.CameraControlMode||(e.CameraControlMode={})),function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video",e[e.ScreenShare=2]="ScreenShare",e[e.Data=3]="Data"}(P=e.MediaType||(e.MediaType={})),function(e){e[e.MuteMicrophone=1]="MuteMicrophone",e[e.MuteSpeaker=2]="MuteSpeaker",e[e.MuteAll=3]="MuteAll"}(R=e.MuteFlags||(e.MuteFlags={})),function(e){e[e.IsPreheatOnly=1]="IsPreheatOnly"}(A=e.PreheatFlags||(e.PreheatFlags={})),function(e){e[e.CanSupportOverflow=1]="CanSupportOverflow",e[e.CanSupportBreakOutRoom=2]="CanSupportBreakOutRoom",e[e.supportsWeatherPersonPresenter=4]="supportsWeatherPersonPresenter",e[e.allowTrackingInReport=8]="allowTrackingInReport",e[e.supportsParticipantMapping=16]="supportsParticipantMapping",e[e.supportsStreaming=32]="supportsStreaming",e[e.e2eEncryptionEnabled=64]="e2eEncryptionEnabled",e[e.SupportsSharedLineAppearanceV2=128]="SupportsSharedLineAppearanceV2",e[e.supportsMdpAudioRecording=256]="supportsMdpAudioRecording",e[e.supportsBreakoutRoomDistributions=512]="supportsBreakoutRoomDistributions",e[e.supportsStreamingPromotion=1024]="supportsStreamingPromotion",e[e.supportsStreamingDemotion=2048]="supportsStreamingDemotion",e[e.supportsBreakoutRoomMoveWithoutInvite=4096]="supportsBreakoutRoomMoveWithoutInvite",e[e.supportsPresenterCapabilitiesReduction=8192]="supportsPresenterCapabilitiesReduction",e[e.blockPresenterJoinInEvents=16384]="blockPresenterJoinInEvents",e[e.supportsImmersiveMode=32768]="supportsImmersiveMode",e[e.supportsCollabLeader=65536]="supportsCollabLeader",e[e.supportsNudgeFromStreamingIntoRealTime=131072]="supportsNudgeFromStreamingIntoRealTime",e[e.supportsLobbyChat=262144]="supportsLobbyChat",e[e.supportsReactions=524288]="supportsReactions",e[e.supportsBidirectionalVBSS=1048576]="supportsBidirectionalVBSS",e[e.supportsImmersiveModeV2=2097152]="supportsImmersiveModeV2",e[e.supportsPreheatInStreamingMode=4194304]="supportsPreheatInStreamingMode",e[e.supportsPresenterSlideControl=8388608]="supportsPresenterSlideControl"}(M=e.ClientEndpointCapabilities||(e.ClientEndpointCapabilities={})),function(e){e[e.Disabled=0]="Disabled",e[e.ReceiveOnly=1]="ReceiveOnly",e[e.SendOnly=2]="SendOnly",e[e.Inactive=3]="Inactive",e[e.Bidirectional=4]="Bidirectional"}(D=e.MediaDirection||(e.MediaDirection={})),function(e){e[e.Succeeded=0]="Succeeded",e[e.ErrorLocalInternal=1]="ErrorLocalInternal",e[e.ErrorRemoteInternal=2]="ErrorRemoteInternal",e[e.OfferNotAcceptable=3]="OfferNotAcceptable",e[e.OfferDeclined=4]="OfferDeclined",e[e.LocalCancel=5]="LocalCancel",e[e.RemoteCancel=6]="RemoteCancel",e[e.FailedNoRetry=7]="FailedNoRetry",e[e.Terminated=8]="Terminated",e[e.GeneralFailure=9]="GeneralFailure"}(O=e.MediaNegotiationStatusCode||(e.MediaNegotiationStatusCode={})),function(e){e[e.AnswerWithAudioOnly=0]="AnswerWithAudioOnly",e[e.AnswerWithAudioVideo=1]="AnswerWithAudioVideo",e[e.AnswerWithScreenshareOnly=2]="AnswerWithScreenshareOnly"}(k=e.AnswerMediaType||(e.AnswerMediaType={})),function(e){e[e.Receive=0]="Receive",e[e.Send=1]="Send"}(N=e.MediaStreamDirection||(e.MediaStreamDirection={})),function(e){e[e.Started=0]="Started",e[e.Inactive=1]="Inactive",e[e.Active=2]="Active",e[e.Stopped=3]="Stopped",e[e.Failed=4]="Failed",e[e.Cancelled=5]="Cancelled"}(x=e.MediaStreamState||(e.MediaStreamState={})),function(e){e[e.Specified=0]="Specified",e[e.Other=1]="Other"}(L=e.RemoveEndpointScope||(e.RemoveEndpointScope={})),function(e){e.BOT_MEETING_NOTIFICATION="BotMeetingNotification",e.IN_MEETING_CHAT_ERROR="InMeetingChatError",e.REACTION="Reaction",e.SENSITIVITY_LABEL="SensitivityLabel",e.INTERPRETATION="Interpretation",e.FACILITATOR_NOTIFICATION="FacilitatorNotification"}(F=e.MessageType||(e.MessageType={})),function(e){e[e.All=0]="All",e[e.Specified=1]="Specified",e[e.Presenters=2]="Presenters",e[e.Attendees=3]="Attendees",e[e.Self=4]="Self"}(U=e.ParticipantScope||(e.ParticipantScope={})),function(e){e[e.None=0]="None",e[e.RequestSent=1]="RequestSent",e[e.WaitingForControlAck=2]="WaitingForControlAck",e[e.RemoteControlling=3]="RemoteControlling",e[e.LocalControlling=4]="LocalControlling",e[e.WaitingForTerminateAck=5]="WaitingForTerminateAck"}($=e.ControlState||(e.ControlState={})),function(e){e[e.None=0]="None",e[e.SharerDenied=1]="SharerDenied",e[e.SharerNoResponse=2]="SharerNoResponse",e[e.SharerBusy=3]="SharerBusy",e[e.AckTimeout=4]="AckTimeout",e[e.SharerTerminated=5]="SharerTerminated",e[e.ViewerTerminated=6]="ViewerTerminated",e[e.DataChannelError=7]="DataChannelError",e[e.ViewerCancelled=8]="ViewerCancelled",e[e.SharerControlDisabled=9]="SharerControlDisabled",e[e.UnknownSender=10]="UnknownSender",e[e.MultipleSharers=11]="MultipleSharers"}(V=e.ControlTerminatedReason||(e.ControlTerminatedReason={})),function(e){e.NoMediaSession="NoMediaSession",e.NoInputDevice="NoInputDevice",e.InvalidParticipant="InvalidParticipant",e.InvalidStreamTrack="InvalidStreamTrack",e.InvalidStream="InvalidStream"}(B=e.RawMediaAccessError||(e.RawMediaAccessError={})),function(e){e[e.UnRestricted=0]="UnRestricted",e[e.DisableAudio=1]="DisableAudio",e[e.DisableVideo=2]="DisableVideo",e[e.DisableAv=3]="DisableAv",e[e.DisableChat=4]="DisableChat"}(H=e.AttendeeRestrictions||(e.AttendeeRestrictions={})),function(e){e.broadcast="broadcast"}(j=e.TransactionEndType||(e.TransactionEndType={})),function(e){e.Success="Success",e.ExpectedError="ExpectedError",e.ExpectedNoNetworkError="ExpectedNoNetworkError",e.UnexpectedNetworkError="UnexpectedNetworkError",e.UnexpectedClientError="UnexpectedClientError",e.UnexpectedServerError="UnexpectedServerError"}(q=e.ResultCategory||(e.ResultCategory={})),function(e){e.ContentOnly="ContentOnly",e.Weatherperson="Weatherperson",e.SideBySide="SideBySide",e.NewsAnchor="NewsAnchor"}(W=e.SharingLayoutMode||(e.SharingLayoutMode={})),function(e){e[e.Undefined=0]="Undefined",e[e.Success=1]="Success",e[e.NoNgcEndpoint=2]="NoNgcEndpoint",e[e.NetworkError=3]="NetworkError",e[e.MediaDroppedError=4]="MediaDroppedError",e[e.BadRequest=5]="BadRequest",e[e.CallEstablishmentTimeout=6]="CallEstablishmentTimeout",e[e.CallSetupError=7]="CallSetupError",e[e.NoPermission=8]="NoPermission",e[e.Missed=9]="Missed",e[e.Declined=10]="Declined",e[e.Busy=11]="Busy",e[e.Cancelled=12]="Cancelled",e[e.Dropped=13]="Dropped",e[e.PstnInsufficientFunds=14]="PstnInsufficientFunds",e[e.PstnSkypeoutAccountBlocked=15]="PstnSkypeoutAccountBlocked",e[e.PstnCouldNotConnectToSkypeProxy=16]="PstnCouldNotConnectToSkypeProxy",e[e.PstnBlockedByUs=17]="PstnBlockedByUs",e[e.PstnBlockedRegulatoryIndia=18]="PstnBlockedRegulatoryIndia",e[e.PstnInvalidNumber=19]="PstnInvalidNumber",e[e.PstnNumberForbidden=20]="PstnNumberForbidden",e[e.PstnCallTerminated=21]="PstnCallTerminated",e[e.PstnNumberUnavailable=22]="PstnNumberUnavailable",e[e.PstnEmergencyCallDenied=23]="PstnEmergencyCallDenied",e[e.CallNotFound=24]="CallNotFound",e[e.LocalError=25]="LocalError",e[e.NotAcceptableHere=26]="NotAcceptableHere",e[e.CallForwarded=27]="CallForwarded",e[e.CallForwardedToVoicemail=28]="CallForwardedToVoicemail",e[e.SkypeTokenError=29]="SkypeTokenError",e[e.CallAccepted=30]="CallAccepted",e[e.LocalHttpStackError=31]="LocalHttpStackError",e[e.UnknownError=32]="UnknownError",e[e.PstnNoSubscriptionCover=33]="PstnNoSubscriptionCover",e[e.SessionNotFound=34]="SessionNotFound",e[e.SessionTimedOut=35]="SessionTimedOut",e[e.PstnCreditExpired=36]="PstnCreditExpired",e[e.PstnCreditExpiredButEnough=37]="PstnCreditExpiredButEnough",e[e.RetargetNotSupported=38]="RetargetNotSupported",e[e.EnterprisePstnInternalError=39]="EnterprisePstnInternalError",e[e.EnterprisePstnUnavailable=40]="EnterprisePstnUnavailable",e[e.EnterprisePstnForbidden=41]="EnterprisePstnForbidden",e[e.EnterprisePstnInvalidNumber=42]="EnterprisePstnInvalidNumber",e[e.EnterprisePstnMiscError=43]="EnterprisePstnMiscError",e[e.Kicked=44]="Kicked",e[e.NetworkRequestTimeoutError=45]="NetworkRequestTimeoutError",e[e.CallDoesNotExist=46]="CallDoesNotExist",e[e.MediaSetupFailure=47]="MediaSetupFailure",e[e.ServiceUnavailable=48]="ServiceUnavailable",e[e.SignalingError=49]="SignalingError",e[e.ConversationEstablishmentFailed=50]="ConversationEstablishmentFailed",e[e.TemporarilyUnavailable=51]="TemporarilyUnavailable",e[e.CannotConnectToNetworkError=52]="CannotConnectToNetworkError",e[e.MediaRelayWhiteListingIssue=53]="MediaRelayWhiteListingIssue",e[e.NoSignalingFromPeer=54]="NoSignalingFromPeer",e[e.DeniedInLobby=55]="DeniedInLobby",e[e.TimedOutInLobby=56]="TimedOutInLobby",e[e.CallFailedConflict=57]="CallFailedConflict",e[e.DevicePermissionDenied=58]="DevicePermissionDenied",e[e.ConfParticipantCountLimitReached=59]="ConfParticipantCountLimitReached",e[e.ActionNotAllowed=60]="ActionNotAllowed",e[e.Abandoned=61]="Abandoned",e[e.ForbiddenDueToPolicy=62]="ForbiddenDueToPolicy",e[e.InsufficientCapabilitiesForCallee=63]="InsufficientCapabilitiesForCallee",e[e.UserBlocked=64]="UserBlocked",e[e.AccessDenied=65]="AccessDenied",e[e.AnonymousJoinDisabledByPolicy=66]="AnonymousJoinDisabledByPolicy",e[e.NoLobbyForBroadcastJoin=67]="NoLobbyForBroadcastJoin",e[e.NotAllowedDueToInformationBarrier=68]="NotAllowedDueToInformationBarrier",e[e.BroadcastLimitReached=69]="BroadcastLimitReached",e[e.TeamParkPolicyDisabled=70]="TeamParkPolicyDisabled",e[e.B2bJoinDisabledByPolicy=71]="B2bJoinDisabledByPolicy",e[e.LocationBasedRoutingError=72]="LocationBasedRoutingError",e[e.ConfLobbyParticipantCountLimitReached=73]="ConfLobbyParticipantCountLimitReached",e[e.DowngradeToStreamingClient=74]="DowngradeToStreamingClient",e[e.CallRedirected=75]="CallRedirected",e[e.CallIsEndToEndEncrypted=76]="CallIsEndToEndEncrypted",e[e.Suspended=77]="Suspended"}(G=e.TerminatedReason||(e.TerminatedReason={})),function(e){e[e.Num0=0]="Num0",e[e.Num1=1]="Num1",e[e.Num2=2]="Num2",e[e.Num3=3]="Num3",e[e.Num4=4]="Num4",e[e.Num5=5]="Num5",e[e.Num6=6]="Num6",e[e.Num7=7]="Num7",e[e.Num8=8]="Num8",e[e.Num9=9]="Num9",e[e.Star=10]="Star",e[e.Pound=11]="Pound",e[e.A=12]="A",e[e.B=13]="B",e[e.C=14]="C",e[e.D=15]="D",e[e.Flash=16]="Flash"}(z=e.DtmfTone||(e.DtmfTone={})),function(e){e[e.ConsumerTwoParty=0]="ConsumerTwoParty",e[e.ConsumerPstn=1]="ConsumerPstn",e[e.ConsumerMultiParty=2]="ConsumerMultiParty",e[e.EnterpriseTwoPartyOnlineOnly=3]="EnterpriseTwoPartyOnlineOnly",e[e.EnterpriseTwoPartyHybrid=4]="EnterpriseTwoPartyHybrid",e[e.EnterpriseMultiParty=5]="EnterpriseMultiParty",e[e.EnterprisePstnOnlineOnly=6]="EnterprisePstnOnlineOnly",e[e.EnterprisePstnHybrid=7]="EnterprisePstnHybrid",e[e.EnterpriseFederated=8]="EnterpriseFederated",e[e.EnterpriseUnknown=9]="EnterpriseUnknown",e[e.EnterpriseMultiPartyBroadcasting=10]="EnterpriseMultiPartyBroadcasting",e[e.WaimeaBay=11]="WaimeaBay"}(J=e.MediaPeerType||(e.MediaPeerType={})),function(e){e.Default="Default",e.LongrangeSpeaker="LongrangeSpeaker",e.Auditorium="Auditorium"}(K=e.AudioUsageMode||(e.AudioUsageMode={})),function(e){e.Off="Off",e.Auto="Auto",e.Low="Low",e.High="High",e.Pns="Pns",e.HeadsetNS="HeadsetNS"}(Q=e.NoiseSuppressionMode||(e.NoiseSuppressionMode={})),function(e){e.Default="Default",e.NoiseSuppression="NoiseSuppression",e.SpeechRecognition="SpeechRecognition",e.Recording="Recording"}(Y=e.AudioConfig||(e.AudioConfig={})),function(e){e.HighNoiseSuppression="HighNoiseSuppression",e.PersonalizedNoiseSuppression="PersonalizedNoiseSuppression",e.LatestLoopbackDriver="LatestLoopbackDriver"}(Z=e.AudioFeatureType||(e.AudioFeatureType={})),function(e){e[e.Disabled=0]="Disabled",e[e.ListenStarted=1]="ListenStarted",e[e.ListenFinished=2]="ListenFinished",e[e.ProducerStarted=3]="ProducerStarted",e[e.ProducerFinished=4]="ProducerFinished",e[e.DetectorStarted=5]="DetectorStarted",e[e.DetectorFinished=6]="DetectorFinished",e[e.Enabled=7]="Enabled"}(X=e.UltrasoundBeaconStatus||(e.UltrasoundBeaconStatus={})),function(e){e[e.ProducerFailed=0]="ProducerFailed",e[e.DetectorFailed=1]="DetectorFailed"}(ee=e.UltrasoundBeaconError||(e.UltrasoundBeaconError={})),function(e){e.Producer="UltrasoundBeaconProducer",e.Detector="UltrasoundBeaconDetector"}(et=e.UltrasoundBeaconType||(e.UltrasoundBeaconType={})),function(e){e.Unknown="Unknown",e.Joined="Joined",e.Leaved="Leaved"}(ei=e.ByodJoinStatus||(e.ByodJoinStatus={})),function(e){e.Unknown="Unknown",e.UserInteraction="UserInteraction",e.ServerMeshFallback="ServerMeshFallback"}(en=e.ByodJoinStatusChangeReason||(e.ByodJoinStatusChangeReason={})),function(e){e.Other="Other",e.JoinRoomFailInvalidRoomNumber="JoinRoomFailInvalidRoomNumber",e.JoinRoomFailMeshMP="JoinRoomFailMeshMP"}(er=e.ByodErrorType||(e.ByodErrorType={})),function(e){e.Unknown="Unknown",e.BRBRecordingStarted="BRBRecordingStarted",e.BRBRecordingStopped="BRBRecordingStopped"}(es=e.InCallRecordingStatus||(e.InCallRecordingStatus={})),function(e){e.Unknown="Unknown",e.ClientRequestStop="ClientRequestStop",e.DurationReached="DurationReached",e.CallEnd="CallEnd",e.AlreadyStarted="AlreadyStarted",e.AlreadyStopped="AlreadyStopped",e.StoppedDueToError="StoppedDueToError",e.CannotExcludeRemoteAudio="CannotExcludeRemoteAudio"}(ea=e.InCallRecordingStatusChangedReason||(e.InCallRecordingStatusChangedReason={})),function(e){e.Unknown="Unknown",e.PlaybackCompleted="PlaybackCompleted",e.ReceivedStopNotification="ReceivedStopNotification",e.AudioChannelClosed="AudioChannelClosed"}(eo=e.CheckMicrophoneFinishedReason||(e.CheckMicrophoneFinishedReason={})),function(e){e[e.Unknown=-1]="Unknown",e[e.P2P=1]="P2P",e[e.Conference=2]="Conference"}(el=e.CallType||(e.CallType={})),function(e){e[e.Unknown=-1]="Unknown",e[e.Private=1]="Private",e[e.Channel=2]="Channel"}(ec=e.CallMeetingType||(e.CallMeetingType={})),function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy",e[e.IPv6ScrubLastHextets=14]="IPv6ScrubLastHextets",e[e.DropValue=15]="DropValue",e[e.GenericContent=32]="GenericContent"}(ed=e.PiiKind||(e.PiiKind={})),function(e){e.DeepVqe="DeepVqe",e.DNS="DNS",e.None="None"}(eu=e.AudioEffectProvider||(e.AudioEffectProvider={})),function(e){e[e.Off=0]="Off",e[e.NoiseSuppressionClassic=1]="NoiseSuppressionClassic",e[e.NoiseSuppressionDeep=2]="NoiseSuppressionDeep",e[e.EchoCancellationClassic=4]="EchoCancellationClassic",e[e.VoiceQualityEnhancementClassic=8]="VoiceQualityEnhancementClassic",e[e.VoiceQualityEnhancementDeep=16]="VoiceQualityEnhancementDeep"}(eh=e.AudioEffectType||(e.AudioEffectType={})),function(e){e[e.Normal=0]="Normal",e[e.HighPriority=1]="HighPriority"}(eg=e.DownloadPriority||(e.DownloadPriority={})),function(e){e[e.SignLanguageDetection=0]="SignLanguageDetection",e[e.LandmarkTracker=1]="LandmarkTracker"}(ep=e.AiModelType||(e.AiModelType={})),function(e){e[e.Off=0]="Off",e[e.BackgroundBlurDefault=1]="BackgroundBlurDefault",e[e.BackgroundBlurLight=2]="BackgroundBlurLight",e[e.BackgroundBlurExperimental_1=4]="BackgroundBlurExperimental_1",e[e.BackgroundBlurExperimental_2=8]="BackgroundBlurExperimental_2",e[e.BackgroundReplacement=16]="BackgroundReplacement",e[e.WhiteboardZoom=32]="WhiteboardZoom",e[e.WhiteboardCleanup=64]="WhiteboardCleanup",e[e.WhiteboardMotionDetection=128]="WhiteboardMotionDetection",e[e.WhiteboardZoomAndCleanup=96]="WhiteboardZoomAndCleanup",e[e.WhiteboardCleanupAndMotion=192]="WhiteboardCleanupAndMotion",e[e.WhiteboardZoomAndCleanupAndMotion=224]="WhiteboardZoomAndCleanupAndMotion",e[e.Beautification=256]="Beautification",e[e.WeatherPerson=512]="WeatherPerson",e[e.ContentCamera=1024]="ContentCamera",e[e.AutoAdjust=2048]="AutoAdjust",e[e.ExplicitMask=4096]="ExplicitMask",e[e.ChromaKey=8192]="ChromaKey",e[e.Bokeh=262144]="Bokeh",e[e.Denoising=1048576]="Denoising",e[e.Last=2097152]="Last"}(ef=e.VideoEffectType||(e.VideoEffectType={})),function(e){e.onVideoEffectQualityChanged="onVideoEffectQualityChanged",e.onVideoEffectModelReadinessChanged="onVideoEffectModelReadinessChanged",e.onVideoEffectReadinessChanged="onVideoEffectReadinessChanged",e.onVideoEffectProcessingStatusChanged="onVideoEffectProcessingStatusChanged"}(em=e.VideoEffectsEventType||(e.VideoEffectsEventType={})),function(e){e[e.R360P=0]="R360P",e[e.R480P=1]="R480P",e[e.R540P=2]="R540P",e[e.R720P=3]="R720P",e[e.R1080P=4]="R1080P"}(ev=e.VideoExtensibilityResolution||(e.VideoExtensibilityResolution={})),function(e){e[e.NV12=0]="NV12",e[e.RGB=1]="RGB",e[e.RGBA=2]="RGBA",e[e.BGR=3]="BGR",e[e.ABGR=4]="ABGR"}(eS=e.VideoExtensibilityFormat||(e.VideoExtensibilityFormat={})),function(e){e.TextureStreamStarted="video_extension_texture_stream_started",e.TextureStreamStopped="video_extension_texture_stream_stopped",e.TextureError="video_extension_texture_error",e.WebStreamStopped="video_extension_web_stream_stopped",e.VideoReady="video_extension_video_ready",e.Frozen="video_extension_frozen"}(ey=e.VideoExtensibilityEventType||(e.VideoExtensibilityEventType={})),function(e){e.ModelReadinessChanged="model-readiness-changed",e.SignLanguageDetected="sign-language-detected"}(eC=e.SignLanguageDetectionEventType||(e.SignLanguageDetectionEventType={})),function(e){e[e.BadNotificationPayload=0]="BadNotificationPayload",e[e.CallSetupSucceeded=1]="CallSetupSucceeded",e[e.CallSetupFailed=2]="CallSetupFailed",e[e.BadNotificationEventType=3]="BadNotificationEventType",e[e.CallAlreadyExists=4]="CallAlreadyExists",e[e.CallFailedCannotConnect=5]="CallFailedCannotConnect",e[e.CallFailedNoSignaling=6]="CallFailedNoSignaling",e[e.CallFailedConflict=7]="CallFailedConflict",e[e.CallFailedPushIgnored=8]="CallFailedPushIgnored",e[e.CallFailedAnsweredElsewhere=9]="CallFailedAnsweredElsewhere",e[e.CallFailedCallAlreadyEnded=10]="CallFailedCallAlreadyEnded",e[e.CallSetupInProgress=11]="CallSetupInProgress"}(eb=e.CallAcknowledgeResultCode||(e.CallAcknowledgeResultCode={})),function(e){e[e.Ok=0]="Ok",e[e.Started=1]="Started",e[e.Stopped=2]="Stopped",e[e.Error=3]="Error",e[e.WindowMinimized=4]="WindowMinimized",e[e.WindowRestored=5]="WindowRestored",e[e.WindowFullyOccluded=6]="WindowFullyOccluded",e[e.WindowExposed=7]="WindowExposed",e[e.WindowClosed=8]="WindowClosed",e[e.PPTPresenterView_Enter=9]="PPTPresenterView_Enter",e[e.PPTPresenterView_Exit=10]="PPTPresenterView_Exit",e[e.WindowInPriviledgedProcess=11]="WindowInPriviledgedProcess",e[e.OcclusionRemovalDisabled=12]="OcclusionRemovalDisabled",e[e.FrameCount=13]="FrameCount",e[e.Resolution=14]="Resolution",e[e.KNPresenterView_Enter=15]="KNPresenterView_Enter",e[e.KNPresenterView_Exit=16]="KNPresenterView_Exit",e[e.KeynotePresentationSharing=17]="KeynotePresentationSharing",e[e.Strategy=18]="Strategy",e[e.Reinitialization=19]="Reinitialization",e[e.AppName=20]="AppName",e[e.ShellSharingStopped=21]="ShellSharingStopped",e[e.Fallback=22]="Fallback",e[e.DisplayColorSpace=23]="DisplayColorSpace",e[e.GraphicsCaptureAppRecovery=24]="GraphicsCaptureAppRecovery",e[e.SkippedFrameCount=25]="SkippedFrameCount",e[e.AverageCaptureDuration=26]="AverageCaptureDuration",e[e.TimeToFirstFrame=27]="TimeToFirstFrame",e[e.SlideShowWindow=28]="SlideShowWindow",e[e.Count=29]="Count"}(eT=e.ScreenScraperEvent||(e.ScreenScraperEvent={})),function(e){e[e.None=0]="None",e[e.Ringing=1]="Ringing",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected",e[e.Disconnected=4]="Disconnected"}(eE=e.BroadcastModalityState||(e.BroadcastModalityState={})),function(e){e[e.Skype=1]="Skype",e[e.Pop=2]="Pop",e[e.Aad=4]="Aad",e[e.Cae=8]="Cae"}(e_=e.TokenType||(e.TokenType={})),function(e){e.Resurrect="resurrect",e.DoNotResurrect="doNotResurrect"}(eI=e.ResurrectPreference||(e.ResurrectPreference={})),function(e){e[e.NoLocationInfo=0]="NoLocationInfo",e[e.LocationContent=1]="LocationContent",e[e.NetworkContent=2]="NetworkContent",e[e.AreaContent=3]="AreaContent"}(ew=e.LocationInfoType||(e.LocationInfoType={})),function(e){e[e.Ok=0]="Ok",e[e.Failed=1]="Failed",e[e.Cancelled=2]="Cancelled"}(eP=e.DownloadResult||(e.DownloadResult={})),function(e){e[e.PublicUrl=0]="PublicUrl",e[e.TenantUrl=1]="TenantUrl",e[e.FileSystem=2]="FileSystem"}(eR=e.DownloadSource||(e.DownloadSource={})),function(e){e.NONE="None",e.SFC="SFC",e.TFL="TFL"}(eA=e.TargetApplicationType||(e.TargetApplicationType={})),function(e){e[e.All=1]="All"}(eM=e.EndpointScope||(e.EndpointScope={})),function(e){e.PersonalAttendant="personalAttendant"}(eD=e.BotType||(e.BotType={})),function(e){e.Mri="mri"}(eO=e.RedirectionTargetIdType||(e.RedirectionTargetIdType={})),function(e){e.Default="default",e.Voicemail="voicemail"}(ek=e.RedirectionEndpointType||(e.RedirectionEndpointType={})),function(e){e[e.VbssRendered=0]="VbssRendered"}(eN=e.RemoteUserEventType||(e.RemoteUserEventType={})),function(e){e[e.Monitor=0]="Monitor",e[e.Whisper=1]="Whisper",e[e.Barge=2]="Barge",e[e.Takeover=3]="Takeover"}(ex=e.MonitorActionType||(e.MonitorActionType={})),function(e){e[e.None=0]="None",e[e.RealTime=1]="RealTime",e[e.Streaming=2]="Streaming"}(eL=e.CallMode||(e.CallMode={})),function(e){e.Auto="Auto",e.HighFramerate="HighFramerate",e.HighResolution="HighResolution"}(eF=e.AppSharingVideoContentTypePreference||(e.AppSharingVideoContentTypePreference={})),function(e){e.SFC="SFC",e.TFL="TFL"}(eU=e.FromApplicationType||(e.FromApplicationType={})),function(e){e.Private="private"}(e$=e.CallPhoneLineType||(e.CallPhoneLineType={})),function(e){e[e.CPU=0]="CPU",e[e.Bandwidth=1]="Bandwidth"}(eV=e.OptimalVideoCountChangeReason||(e.OptimalVideoCountChangeReason={})),function(e){e[e.Camera=1]="Camera",e[e.Microphone=2]="Microphone",e[e.Speaker=3]="Speaker",e[e.CompositeAudioDevice=4]="CompositeAudioDevice",e[e.ChildVideoDevice=5]="ChildVideoDevice",e[e.CompositeVideoDevice=6]="CompositeVideoDevice"}(eB=e.DeviceType||(e.DeviceType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.External=3]="External",e[e.LeftFront=4]="LeftFront",e[e.RightFront=5]="RightFront",e[e.Panoramic=6]="Panoramic",e[e.Participant=7]="Participant"}(eH=e.CameraPosition||(e.CameraPosition={})),function(e){e[e.Monitor=1]="Monitor",e[e.Window=2]="Window",e[e.Camera=3]="Camera",e[e.Picker=4]="Picker"}(ej=e.SharingSourceType||(e.SharingSourceType={})),function(e){e[e.None=0]="None",e[e.WindowOnly=1]="WindowOnly",e[e.ScreenOnly=16]="ScreenOnly",e[e.ScreenAndWindow=17]="ScreenAndWindow"}(eq=e.SharingSourcePickerMode||(e.SharingSourcePickerMode={})),function(e){e[e.Unknown=0]="Unknown",e[e.USB=1]="USB",e[e.PCI=2]="PCI",e[e.HDAudio=3]="HDAudio",e[e.Bluetooth=4]="Bluetooth",e[e.XBOX_Kinect=5]="XBOX_Kinect",e[e.Virtual=6]="Virtual",e[e.Internal=7]="Internal",e[e.External=8]="External",e[e.HDMI=9]="HDMI",e[e.Thunderbolt=10]="Thunderbolt",e[e.DisplayPort=11]="DisplayPort",e[e.AirPlay=12]="AirPlay",e[e.BluetoothLE=13]="BluetoothLE"}(eW=e.AudioDeviceConnectionType||(e.AudioDeviceConnectionType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Speakers=1]="Speakers",e[e.Headphones=2]="Headphones",e[e.Headset=3]="Headset",e[e.Handset=4]="Handset",e[e.Speakerphone=5]="Speakerphone"}(eG=e.CompositeAudioDeviceFormFactor||(e.CompositeAudioDeviceFormFactor={})),function(e){e.WebGL2IsNotSupported="WebGL2IsNotSupported",e.WebGL2RequiredExtensionsNotSupported="WebGL2RequiredExtensionsNotSupported",e.RendererIsNotSupported="RendererIsNotSupported",e.FailedToInitialize="FailedToInitialize",e.InitializationTimeout="InitializationTimeout",e.WebcvProcessorError="WebcvProcessorError",e.WasmDnsProcessorError="WasmDnsProcessorError",e.WasmAecProcessorError="WasmAecProcessorError",e.WasmVqeProcessorError="WasmVqeProcessorError"}(ez=e.EffectErrorType||(e.EffectErrorType={})),function(e){e[e.None=0]="None",e[e.AutoGainControl=1]="AutoGainControl",e[e.EchoCancellation=2]="EchoCancellation",e[e.NoiseSuppression=4]="NoiseSuppression"}(eJ=e.AudioProcessingFlags||(e.AudioProcessingFlags={})),function(e){e[e.Unknown=-1]="Unknown",e[e.NoError=0]="NoError",e[e.NotReady=1]="NotReady",e[e.InvalidAudioFileUrl=2]="InvalidAudioFileUrl",e[e.OpenFileFailed=3]="OpenFileFailed",e[e.UnsupportedWavAudioFormat=4]="UnsupportedWavAudioFormat",e[e.ReadFileFailed=5]="ReadFileFailed",e[e.StartDeviceFailed=6]="StartDeviceFailed",e[e.PlayAudioError=7]="PlayAudioError",e[e.StartPlayingInvalidParameters=8]="StartPlayingInvalidParameters",e[e.AlreadyPlaying=9]="AlreadyPlaying"}(eK=e.AudioPlayerError||(e.AudioPlayerError={})),function(e){e[e.Unknown=-1]="Unknown",e[e.PlaybackStarted=0]="PlaybackStarted",e[e.PlaybackStopped=1]="PlaybackStopped"}(eQ=e.AudioPlayerEvent||(e.AudioPlayerEvent={})),function(e){e[e.CallTypeGroup=0]="CallTypeGroup",e[e.CallTypeS2s=1]="CallTypeS2s",e[e.CallTypePstn=2]="CallTypePstn",e[e.CallTypeMeeting=3]="CallTypeMeeting"}(eY=e.EcsCallType||(e.EcsCallType={})),function(e){e[e.ContextCallStart=0]="ContextCallStart",e[e.ContextSelectedDeviceChangedFromUI=1]="ContextSelectedDeviceChangedFromUI",e[e.ContextSelectedDeviceChangedFromHid=2]="ContextSelectedDeviceChangedFromHid",e[e.ContextPairedBTDeviceUpdated=3]="ContextPairedBTDeviceUpdated",e[e.ContextPeriodicSelectedDeviceData=4]="ContextPeriodicSelectedDeviceData",e[e.ContextInvalidContext=5]="ContextInvalidContext"}(eZ=e.DeviceTelemetryDataContext||(e.DeviceTelemetryDataContext={})),function(e){e[e.VeryBad=0]="VeryBad",e[e.Bad=1]="Bad",e[e.Average=2]="Average",e[e.Good=3]="Good",e[e.VeryGood=4]="VeryGood",e[e.NotApplicable=5]="NotApplicable"}(eX=e.CallQualityRating||(e.CallQualityRating={})),function(e){e[e.Unknown=0]="Unknown",e[e.Open=1]="Open",e[e.Personal=2]="Personal",e[e.Enterprise=3]="Enterprise",e[e.UnknownSecure=4]="UnknownSecure"}(e0=e.WifiAuthType||(e.WifiAuthType={})),function(e){e.Zero="Zero",e.Basic="Basic",e.Full="Full"}(e1=e.TelemetryDiagnosticLevel||(e.TelemetryDiagnosticLevel={})),function(e){e[e.None=0]="None",e[e.E911=1]="E911",e[e.Telemetry=2]="Telemetry",e[e.LBR=4]="LBR"}(e2=e.PrivacyPermissionScope||(e.PrivacyPermissionScope={})),function(e){e[e.PluginlessStack=0]="PluginlessStack",e[e.CallingRemoteStack=1]="CallingRemoteStack",e[e.WaimeaStack=2]="WaimeaStack"}(e3=e.StackType||(e.StackType={})),function(e){e.PROD="Public",e.GCCHIGH="GCCHigh",e.DOD="DoD"}(e4=e.HomeCloud||(e.HomeCloud={})),function(e){e[e.Unknown=0]="Unknown",e[e.NotDeclaredByApp=1]="NotDeclaredByApp",e[e.DeniedBySystem=2]="DeniedBySystem",e[e.DeniedByUser=3]="DeniedByUser",e[e.UserPromptRequired=4]="UserPromptRequired",e[e.Allowed=5]="Allowed"}(e5=e.AppCapabilityStatus||(e.AppCapabilityStatus={})),function(e){e[e.Started=0]="Started",e[e.Stopped=1]="Stopped",e[e.Error=2]="Error"}(e6=e.LocalRecordingEvent||(e.LocalRecordingEvent={})),function(e){e[e.CallingWindowDoesNotExist=1]="CallingWindowDoesNotExist",e[e.DirectoryNotFound=2]="DirectoryNotFound",e[e.InsufficientPermissionToCreateDirectory=3]="InsufficientPermissionToCreateDirectory",e[e.InsufficientPermissionToCreateFile=4]="InsufficientPermissionToCreateFile",e[e.DiskFull=5]="DiskFull",e[e.WriteError=6]="WriteError",e[e.NotSupported=7]="NotSupported",e[e.UnexpectedFailure=8]="UnexpectedFailure",e[e.FailedToNotifyOtherParticipants=9]="FailedToNotifyOtherParticipants"}(e8=e.LocalRecordingError||(e.LocalRecordingError={})),function(e){e[e.LocationDoesNotExist=0]="LocationDoesNotExist",e[e.LocalRecordingCurrentlyActive=1]="LocalRecordingCurrentlyActive",e[e.NoLocalRecordingStored=2]="NoLocalRecordingStored",e[e.NoLocalRecordingAssemblyInProgress=3]="NoLocalRecordingAssemblyInProgress",e[e.InsufficientPermissionToCreateDirectory=4]="InsufficientPermissionToCreateDirectory",e[e.InsufficientPermissionToCreateFile=5]="InsufficientPermissionToCreateFile",e[e.InsufficientPermissionToDeleteDirectory=6]="InsufficientPermissionToDeleteDirectory",e[e.InsufficientPermissionToDeleteFile=7]="InsufficientPermissionToDeleteFile",e[e.DiskFull=8]="DiskFull"}(e9=e.LocalRecordingAssemblyError||(e.LocalRecordingAssemblyError={})),function(e){e.Live="Live",e.Fallback="Fallback",e.EndOfStream="EndOfStream",e.Dvr="DVR"}(e7=e.HlsInitMode||(e.HlsInitMode={})),function(e){e[e.Amp=0]="Amp",e[e.Hls=1]="Hls",e[e.Ums=2]="Ums"}(te=e.PlayerType||(e.PlayerType={})),function(e){e.AMS="AMS",e.HLS="MiddleLaneHttpLiveStreaming",e.Ums="MiddleLaneUltraLowLatency"}(tt=e.StreamDeliveryPipeline||(e.StreamDeliveryPipeline={})),function(e){e.TLE="TLE",e.Overflow="Overflow",e.TownHallBasic="TownHall_Basic",e.TownHallPremium="TownHall_Premium",e.TownHall="TownHall"}(ti=e.StreamingEventType||(e.StreamingEventType={})),function(e){e.HydraRuntimeLoadFailed="HydraRuntimeLoadFailed",e.MultiplePlayerLoad="MultiplePlayerLoad",e.PlayerScriptLoadFailed="PlayerScriptLoadFailed",e.PlayerInitializationFailed="PlayerInitializationFailed",e.InvalidStream="InvalidStream",e.SetSourceFailed="SetSourceFailed"}(tn=e.PlayerSetupErrorType||(e.PlayerSetupErrorType={})),function(e){e.LoadStart="LoadStart",e.LoadedData="LoadedData",e.LoadedMetadata="LoadedMetadata",e.Start="Start",e.Ready="Ready",e.Play="Play",e.Resume="Resume",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering",e.Seeking="Seeking",e.Seeked="Seeked",e.Ended="Ended",e.Error="Error",e.Destroyed="Destroyed",e.Initialized="Initialized",e.SkippingSegment="SkippingSegment",e.Stalled="Stalled"}(tr=e.PlaybackState||(e.PlaybackState={})),function(e){e.UnsupportedPlatform="UnsupportedPlatform",e.NetworkError="NetworkError",e.PlaybackRetried="PlaybackRetried",e.PlaybackError="PlaybackError",e.Unknown="Unknown",e.MediaTimeout="MediaTimeout",e.NoMediaFlow="NoMediaFlow"}(ts=e.PlaybackErrorType||(e.PlaybackErrorType={})),function(e){e.PlayerStopped="PlayerStopped",e.PlaybackError="PlaybackError",e.MediaTimeout="MediaTimeout"}(ta=e.PlayerDestroyedReason||(e.PlayerDestroyedReason={})),function(e){e.media="media",e.realtimeMedia="realtimeMedia",e.gtcAudit="gtcAudit",e.signaling="signaling",e.tlePlayer="tlePlayer",e.rootTools="rootTools"}(to=e.TelemetryTenantNames||(e.TelemetryTenantNames={})),function(e){e[e.SourceAndSink=0]="SourceAndSink",e[e.Source=1]="Source",e[e.Sink=2]="Sink"}(tl=e.DataChannelAdapterDirection||(e.DataChannelAdapterDirection={})),function(e){e[e.DATA_ID_RESERVED=0]="DATA_ID_RESERVED",e[e.DATA_ID_PROTOCOL=1]="DATA_ID_PROTOCOL",e[e.DATA_ID_CONTROL=2]="DATA_ID_CONTROL",e[e.DATA_ID_TRANSCRIPT=3]="DATA_ID_TRANSCRIPT",e[e.DATA_ID_SURFACERECONSTRUCTION=4]="DATA_ID_SURFACERECONSTRUCTION",e[e.DATA_ID_ANNOTATION=5]="DATA_ID_ANNOTATION",e[e.DATA_ID_ANNOTATION_RELIABLE=6]="DATA_ID_ANNOTATION_RELIABLE",e[e.DATA_ID_SKYPETX=7]="DATA_ID_SKYPETX",e[e.DATA_ID_REMOTE_USER_EVENT=8]="DATA_ID_REMOTE_USER_EVENT",e[e.DATA_ID_MULTICHANNEL_AUDIO=9]="DATA_ID_MULTICHANNEL_AUDIO",e[e.DATA_ID_SCREEN_CAPTURE_FRAME=10]="DATA_ID_SCREEN_CAPTURE_FRAME",e[e.DATA_ID_SCREEN_CAPTURE_METADATA=11]="DATA_ID_SCREEN_CAPTURE_METADATA",e[e.DATA_ID_HOLOLENS_REMOTE_ASSIST=12]="DATA_ID_HOLOLENS_REMOTE_ASSIST",e[e.DATA_ID_AUDIENCE_BOT=13]="DATA_ID_AUDIENCE_BOT",e[e.DATA_ID_SALVADOR=14]="DATA_ID_SALVADOR",e[e.DATA_ID_PTZ_CONTROL=15]="DATA_ID_PTZ_CONTROL",e[e.DATA_ID_FACESHOTS=16]="DATA_ID_FACESHOTS",e[e.DATA_ID_CONFERENCE_MESSAGE=17]="DATA_ID_CONFERENCE_MESSAGE",e[e.DATA_ID_MEDIA_CONTROL_PLANE=18]="DATA_ID_MEDIA_CONTROL_PLANE",e[e.DATA_ID_MESH_CONTROL=19]="DATA_ID_MESH_CONTROL",e[e.DATA_ID_MESH_DATA=20]="DATA_ID_MESH_DATA",e[e.DATA_ID_ACS=21]="DATA_ID_ACS",e[e.DATA_ID_ACS_DURABLE=22]="DATA_ID_ACS_DURABLE",e[e.DATA_ID_ACS_HIGH_PRIORITY=23]="DATA_ID_ACS_HIGH_PRIORITY",e[e.DATA_ID_RTT=24]="DATA_ID_RTT",e[e.DATA_ID_SLD=25]="DATA_ID_SLD",e[e.DATA_ID_WB_ANNOTATION=26]="DATA_ID_WB_ANNOTATION",e[e.DATA_ID_SLIDE_CONTROL=27]="DATA_ID_SLIDE_CONTROL",e[e.DATA_ID_DS_RELIABLE=28]="DATA_ID_DS_RELIABLE",e[e.DATA_ID_WB_CONTROL_MESSAGE=29]="DATA_ID_WB_CONTROL_MESSAGE",e[e.DATA_ID_WB_DATA_MESSAGE=30]="DATA_ID_WB_DATA_MESSAGE",e[e.DATA_ID_DS_UNRELIABLE=31]="DATA_ID_DS_UNRELIABLE"}(tc=e.DataId||(e.DataId={})),function(e){e[e.Disabled=0]="Disabled",e[e.Detection=1]="Detection",e[e.Pointer=2]="Pointer",e[e.Control=3]="Control"}(td=e.CtrlCaptureMode||(e.CtrlCaptureMode={})),function(e){e[e.MouseClick=0]="MouseClick",e[e.MouseEntering=1]="MouseEntering",e[e.MouseLeaving=2]="MouseLeaving"}(tu=e.CtrlCaptureEvent||(e.CtrlCaptureEvent={})),function(e){e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e[e.Clipboard_Text=2]="Clipboard_Text",e[e.StopSending=3]="StopSending",e[e.Reserved=255]="Reserved"}(th=e.CtrlEventType||(e.CtrlEventType={})),function(e){e[e.Move=0]="Move",e[e.Wheel=1]="Wheel",e[e.Button=2]="Button"}(tg=e.CtrlMouseEventType||(e.CtrlMouseEventType={})),function(e){e[e.Button1=0]="Button1",e[e.Button2=1]="Button2",e[e.Button3=2]="Button3",e[e.XButton1=3]="XButton1",e[e.XButton2=4]="XButton2",e[e.XButton3=5]="XButton3"}(tp=e.CtrlMouseButtonType||(e.CtrlMouseButtonType={})),function(e){e[e.ScanCode=0]="ScanCode",e[e.VirtualKey=1]="VirtualKey",e[e.NonKbdInput=2]="NonKbdInput",e[e.Invalid=3]="Invalid"}(tf=e.CtrlKbdCodeType||(e.CtrlKbdCodeType={})),function(e){e[e.Success=0]="Success",e[e.Error=-1]="Error",e[e.E_Disabled=-2]="E_Disabled",e[e.E_AvatarNotSet=-3]="E_AvatarNotSet",e[e.E_InvalidData=-4]="E_InvalidData",e[e.E_InvalidPointer=-5]="E_InvalidPointer",e[e.E_CtrlNotAllowed=-6]="E_CtrlNotAllowed",e[e.E_InjectMouse=-7]="E_InjectMouse",e[e.E_InjectKeyboard=-8]="E_InjectKeyboard",e[e.E_InjectClipboard=-9]="E_InjectClipboard",e[e.E_PermissionDenied=-10]="E_PermissionDenied"}(tm=e.CtrlResult||(e.CtrlResult={})),function(e){e[e.ScreenSharingControl=0]="ScreenSharingControl",e[e.Adapter=1]="Adapter",e[e.PTZSessionControl=2]="PTZSessionControl"}(tv=e.DataChannelProtocolType||(e.DataChannelProtocolType={})),function(e){e[e.None=0]="None",e[e.Attendee=1]="Attendee",e[e.Presenter=2]="Presenter"}(tS=e.ParticipantContentSharingRole||(e.ParticipantContentSharingRole={})),function(e){e[e.None=0]="None",e[e.Connecting=1]="Connecting",e[e.Ringing=2]="Ringing",e[e.Presenting=3]="Presenting",e[e.Connected=4]="Connected",e[e.Viewing=5]="Viewing",e[e.Finishing=6]="Finishing",e[e.Done=7]="Done",e[e.Failed=8]="Failed"}(ty=e.ContentSharingStatus||(e.ContentSharingStatus={})),function(e){e[e.Unknown=0]="Unknown",e[e.Available=1]="Available",e[e.Starting=2]="Starting",e[e.Active=3]="Active",e[e.Stopping=4]="Stopping",e[e.NotStarted=5]="NotStarted"}(tC=e.MediaDataChannelState||(e.MediaDataChannelState={})),function(e){e[e.Unknown=0]="Unknown",e[e.Sharer=1]="Sharer",e[e.Viewer=2]="Viewer"}(tb=e.SharingControlRole||(e.SharingControlRole={})),function(e){e[e.Unknown=0]="Unknown",e[e.Sending=1]="Sending",e[e.Resending=2]="Resending",e[e.Acking=3]="Acking",e[e.Dropping=4]="Dropping",e[e.Succeeded=5]="Succeeded",e[e.Terminated=6]="Terminated",e[e.Rejecting=7]="Rejecting"}(tT=e.AvailableHandshakeStatus||(e.AvailableHandshakeStatus={})),function(e){e[e.Unknown=0]="Unknown",e[e.Succeeded=1]="Succeeded",e[e.Shutdown=2]="Shutdown",e[e.DataChannel=3]="DataChannel",e[e.Replaced=4]="Replaced",e[e.TimedOut=5]="TimedOut",e[e.UnknownSender=6]="UnknownSender",e[e.SharerDenied=7]="SharerDenied"}(tE=e.AvailableHandshakeTerminatedReason||(e.AvailableHandshakeTerminatedReason={})),function(e){e[e.SetInjectorConfigError=0]="SetInjectorConfigError",e[e.InjectRawInputError=1]="InjectRawInputError",e[e.SetInjectionRectError=2]="SetInjectionRectError",e[e.AllowSingleControllerError=3]="AllowSingleControllerError",e[e.AvailableAckTimeout=4]="AvailableAckTimeout",e[e.SendDataError=5]="SendDataError",e[e.DataChannelInactive=6]="DataChannelInactive"}(t_=e.SharingControlErrorReason||(e.SharingControlErrorReason={})),function(e){e[e.SetInjectionFailed=0]="SetInjectionFailed",e[e.DisabledDWM=1]="DisabledDWM"}(tI=e.SharingControlDisableReason||(e.SharingControlDisableReason={})),function(e){e[e.NotAvailable=0]="NotAvailable",e[e.Initialized=1]="Initialized",e[e.Failed=2]="Failed",e[e.Uninitialized=3]="Uninitialized"}(tw=e.MediaStatus||(e.MediaStatus={})),function(e){e.None="none",e.All="all"}(tP=e.AdmitScope||(e.AdmitScope={})),function(e){e.RaiseHands="raiseHands",e.UFD="ufd",e.AttendeeModalitiesUnrestricted="attendeeModalitiesUnrestricted",e.AttendeeAudioRestricted="attendeeAudioRestricted",e.AttendeeVideoRestricted="attendeeVideoRestricted",e.AttendeeVideoUnrestricted="attendeeVideoUnrestricted",e.Spotlight="spotlight",e.WeatherPerson="weatherPerson",e.SharingLayoutType="sharingLayoutType",e.ManageBreakoutRooms="manageBreakoutRooms",e.TogetherMode="togetherMode",e.ConsentToRecording="consentToRecording",e.DenyConsentToRecording="denyConsentToRecording",e.ClientMediaUFD="clientMediaUfd",e.ServerMediaUFD="serverMediaUfd",e.DHHSigner="dhhSigner",e.SignLanguageInterpreter="signLanguageInterpreter"}(tR=e.PublishStateType||(e.PublishStateType={})),function(e){e.User="user",e.Endpoint="endpoint"}(tA=e.PublishStateLevel||(e.PublishStateLevel={})),function(e){e[e.None=0]="None",e[e.CollabDetails=1]="CollabDetails"}(tM=e.RefreshSettings||(e.RefreshSettings={})),function(e){e.Normal="Normal",e.Long="Long"}(tD=e.SegmentationTypeForAiInterpreter||(e.SegmentationTypeForAiInterpreter={})),function(e){e[e.CompositeCamera=1]="CompositeCamera"}(tO=e.DerivedSourceType||(e.DerivedSourceType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Controllee=1]="Controllee",e[e.Controller=2]="Controller"}(tk=e.PTZHandlerRole||(e.PTZHandlerRole={})),function(e){e[e.CommandResetError=0]="CommandResetError",e[e.CommandZoomInError=1]="CommandZoomInError",e[e.CommandZoomOutError=2]="CommandZoomOutError",e[e.CommandPanLeftError=3]="CommandPanLeftError",e[e.CommandPanRightError=4]="CommandPanRightError",e[e.CommandTiltUpError=5]="CommandTiltUpError",e[e.CommandTiltDownError=6]="CommandTiltDownError",e[e.SendDataError=7]="SendDataError"}(tN=e.PTZErrorReason||(e.PTZErrorReason={})),function(e){e[e.None=0]="None",e[e.ControlDenied=1]="ControlDenied",e[e.ControlNoResponse=2]="ControlNoResponse",e[e.ControlBusy=3]="ControlBusy",e[e.AckTimeout=4]="AckTimeout",e[e.ControlTerminated=5]="ControlTerminated",e[e.ControllerTerminated=6]="ControllerTerminated",e[e.DataChannelError=7]="DataChannelError",e[e.ControllerCancelled=8]="ControllerCancelled",e[e.ControlDisabled=9]="ControlDisabled",e[e.ControlTerminatedToAllowOtherController=10]="ControlTerminatedToAllowOtherController"}(tx=e.PTZSessionTerminatedReason||(e.PTZSessionTerminatedReason={})),function(e){e[e.Reset=1]="Reset",e[e.ZoomIn=2]="ZoomIn",e[e.ZoomOut=4]="ZoomOut",e[e.PanLeft=8]="PanLeft",e[e.PanRight=16]="PanRight",e[e.TiltUp=32]="TiltUp",e[e.TiltDown=64]="TiltDown"}(tL=e.PTZControlCommand||(e.PTZControlCommand={})),function(e){e[e.Available=0]="Available",e[e.Error=1]="Error",e[e.Reset=2]="Reset",e[e.ZoomIn=4]="ZoomIn",e[e.ZoomOut=8]="ZoomOut",e[e.PanLeft=16]="PanLeft",e[e.PanRight=32]="PanRight",e[e.TiltUp=64]="TiltUp",e[e.TiltDown=128]="TiltDown"}(tF=e.PTZControlDeviceState||(e.PTZControlDeviceState={})),function(e){e[e.None=0]="None",e[e.Optical=1]="Optical",e[e.Digital=2]="Digital"}(tU=e.DevicePTZCapabilityType||(e.DevicePTZCapabilityType={})),function(e){e[e.PNS=0]="PNS",e[e.DNS=1]="DNS",e[e.Classical=2]="Classical",e[e.Off=3]="Off",e[e.HeadsetNS=4]="HeadsetNS"}(t$=e.NoiseSuppressionMethodType||(e.NoiseSuppressionMethodType={})),function(e){e[e.None=0]="None",e[e.CpuInsufficient=1]="CpuInsufficient",e[e.ModelNotReady=2]="ModelNotReady",e[e.VoiceSignatureMissing=3]="VoiceSignatureMissing",e[e.AuditoriumMode=4]="AuditoriumMode",e[e.NearEndMusicMode=5]="NearEndMusicMode",e[e.DisabledForSpeechRecognition=6]="DisabledForSpeechRecognition",e[e.DisabledForRecording=7]="DisabledForRecording",e[e.DisabledForMicMute=8]="DisabledForMicMute",e[e.DeepAECNotAllowed=9]="DeepAECNotAllowed",e[e.GenericError=10]="GenericError",e[e.CaptureDeviceNotSet=11]="CaptureDeviceNotSet",e[e.MicOutputSamplingRateNotSupported=12]="MicOutputSamplingRateNotSupported",e[e.MicOutputChannelsNotSupported=13]="MicOutputChannelsNotSupported",e[e.RenderDeviceNotSet=14]="RenderDeviceNotSet",e[e.DisabledForOffload=15]="DisabledForOffload",e[e.ECSModelUrlsNotSet=16]="ECSModelUrlsNotSet",e[e.PlatformNotSupported=17]="PlatformNotSupported",e[e.ModelNotDownloaded=18]="ModelNotDownloaded",e[e.ModelDownloadSessionCreationFailed=19]="ModelDownloadSessionCreationFailed"}(tV=e.NoiseSuppressionMethodFallbackReason||(e.NoiseSuppressionMethodFallbackReason={})),function(e){e[e.WrongVersion=0]="WrongVersion",e[e.BadSignature=1]="BadSignature",e[e.NotValidated=2]="NotValidated",e[e.Success=3]="Success"}(tB=e.VoiceSignatureState||(e.VoiceSignatureState={})),function(e){e[e.Fit=0]="Fit",e[e.Crop=1]="Crop",e[e.Default=2]="Default"}(tH=e.StageScalingMode||(e.StageScalingMode={})),function(e){e[e.Unknown=0]="Unknown",e[e.CallingScreen=1]="CallingScreen",e[e.Popout=2]="Popout",e[e.CallingMonitor=3]="CallingMonitor",e[e.AttendeeView=4]="AttendeeView",e[e.HeroGallery=5]="HeroGallery",e[e.MainGallery=6]="MainGallery"}(tj=e.StageContext||(e.StageContext={})),function(e){e[e.Unknown=0]="Unknown",e[e.VideoStage=1]="VideoStage",e[e.AudioStage=2]="AudioStage",e[e.ScreenShare=3]="ScreenShare",e[e.PPT=4]="PPT",e[e.VideoStageA=5]="VideoStageA",e[e.VideoStageB=6]="VideoStageB",e[e.VideoStageC=7]="VideoStageC"}(tq=e.GroupPosition||(e.GroupPosition={})),function(e){e[e.Native=0]="Native",e[e.DOM=1]="DOM",e[e.TextureStream=2]="TextureStream",e[e.NoCompositor=3]="NoCompositor"}(tW=e.CompositorType||(e.CompositorType={})),function(e){e[e.Client=0]="Client",e[e.FixedGrid=1]="FixedGrid",e[e.DynamicGrid=2]="DynamicGrid"}(tG=e.LayoutAlgorithm||(e.LayoutAlgorithm={})),function(e){e[e.Tiled=0]="Tiled",e[e.Grid=1]="Grid",e[e.TopLeft=2]="TopLeft",e[e.TopRight=3]="TopRight",e[e.BottomLeft=4]="BottomLeft",e[e.BottomRight=5]="BottomRight",e[e.Center=6]="Center"}(tz=e.WatermarkTextMode||(e.WatermarkTextMode={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic",e[e.Underline=4]="Underline",e[e.Strikeout=5]="Strikeout"}(tJ=e.FontStyle||(e.FontStyle={})),function(e){e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(tK=e.StageErrorSeverity||(e.StageErrorSeverity={})),function(e){e[e.Unknown=0]="Unknown",e[e.NotImplemented=1]="NotImplemented",e[e.NotFound=2]="NotFound",e[e.CompositionActions=3]="CompositionActions",e[e.MeetingStageInteractions=4]="MeetingStageInteractions",e[e.Subscription=5]="Subscription",e[e.Json=6]="Json"}(tQ=e.StageErrorCode||(e.StageErrorCode={})),function(e){e[e.Unknown=0]="Unknown",e[e.Rendering=1]="Rendering",e[e.Failed=2]="Failed",e[e.NoFrames=3]="NoFrames",e[e.NoUpdates=4]="NoUpdates",e[e.FrameBlurred=5]="FrameBlurred"}(tY=e.ViewRenderState||(e.ViewRenderState={}))}(t=e.calling||(e.calling={}))}(t||(t={})),e.exports=t.calling},904867:function(e,t,i){var n=window;!function(t,n){e.exports=n(i(83836),i(892891))}(0,(e,t)=>{let r,s,a,o,l,c,d,u,h,g,p,f;var m,v,S,y,C,b,T,E,_,I,w,P,R,A,M,D,O,k,N,x,L,F,U,$,V,B,H,j,q,W,G,z,J,K,Q,Y,Z,X,ee,et,ei,en,er,es,ea,eo,el,ec,ed,eu,eh,eg,ep,ef,em,ev={},eS={exports:ev},ey=Object.create,eC=Object.defineProperty,eb=Object.getOwnPropertyDescriptor,eT=Object.getOwnPropertyNames,eE=Object.getPrototypeOf,e_=Object.prototype.hasOwnProperty,eI=(e,t)=>function(){return t||(0,e[eT(e)[0]])((t={exports:{}}).exports,t),t.exports},ew=(e,t)=>{for(var i in t)eC(e,i,{get:t[i],enumerable:!0})},eP=(e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of eT(t))e_.call(e,r)||r===i||eC(e,r,{get:()=>t[r],enumerable:!(n=eb(t,r))||n.enumerable});return e},eR=(e,t,i)=>(i=null!=e?ey(eE(e)):{},eP(!t&&e&&e.__esModule?i:eC(i,"default",{value:e,enumerable:!0}),e)),eA=e=>eP(eC({},"__esModule",{value:!0}),e),eM=(e,t,i,n)=>{for(var r,s=n>1?void 0:n?eb(t,i):t,a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n?r(t,i,s):r(s))||s);return n&&s&&eC(t,i,s),s},eD=(e,t)=>(i,n)=>t(i,n,e),eO=eI({"../node_modules/ua-parser-js/src/ua-parser.js"(e,t){!function(i,n){"use strict";var r="",s="?",a="function",o="undefined",l="object",c="string",d="major",u="model",h="name",g="type",p="vendor",f="version",m="architecture",v="console",S="mobile",y="tablet",C="smarttv",b="wearable",T="embedded",E=500,_="Amazon",I="Apple",w="ASUS",P="BlackBerry",R="Browser",A="Chrome",M="Firefox",D="Google",O="Huawei",k="LG",N="Microsoft",x="Motorola",L="Opera",F="Samsung",U="Sharp",$="Sony",V="Xiaomi",B="Zebra",H="Facebook",j="Chromium OS",q="Mac OS",W=function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},G=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},z=function(e,t){return typeof e===c&&-1!==J(t).indexOf(J(e))},J=function(e){return e.toLowerCase()},K=function(e){return typeof e===c?e.replace(/[^\d\.]/g,r).split(".")[0]:void 0},Q=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,r),typeof t===o?e:e.substring(0,E)},Y=function(e,t){for(var i,r,s,o,c,d,u=0;u<t.length&&!c;){var h=t[u],g=t[u+1];for(i=r=0;i<h.length&&!c&&h[i];)if(c=h[i++].exec(e))for(s=0;s<g.length;s++)d=c[++r],typeof(o=g[s])===l&&o.length>0?2===o.length?typeof o[1]==a?this[o[0]]=o[1].call(this,d):this[o[0]]=o[1]:3===o.length?typeof o[1]!==a||o[1].exec&&o[1].test?this[o[0]]=d?d.replace(o[1],o[2]):void 0:this[o[0]]=d?o[1].call(this,d,o[2]):n:4===o.length&&(this[o[0]]=d?o[3].call(this,d.replace(o[1],o[2])):n):this[o]=d||n;u+=2}},Z=function(e,t){for(var i in t)if(typeof t[i]===l&&t[i].length>0){for(var r=0;r<t[i].length;r++)if(z(t[i][r],e))return i===s?n:i}else if(z(t[i],e))return i===s?n:i;return e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ee={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,f],[/opios[\/ ]+([\w\.]+)/i],[f,[h,L+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[f,[h,L+" GX"]],[/\bopr\/([\w\.]+)/i],[f,[h,L]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[f,[h,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,f],[/\bddg\/([\w\.]+)/i],[f,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[h,"UC"+R]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[f,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[f,[h,"Smart Lenovo "+R]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+R],f],[/\bfocus\/([\w\.]+)/i],[f,[h,M+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[h,L+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[h,L+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[h,"MIUI "+R]],[/fxios\/([-\w\.]+)/i],[f,[h,M]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+R]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+R],f],[/samsungbrowser\/([\w\.]+)/i],[f,[h,F+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],f],[/metasr[\/ ]?([\d\.]+)/i],[f,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[h,f],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,H],f],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[h,A+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,A+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[h,"Android "+R]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[f,Z,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[h,M+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,f],[/(cobalt)\/([\w\.]+)/i],[h,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,J]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,r,J]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,J]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[p,F],[g,y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[p,F],[g,S]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[p,I],[g,S]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[p,I],[g,y]],[/(macintosh);/i],[u,[p,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[p,U],[g,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[p,O],[g,y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[p,O],[g,S]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[p,V],[g,S]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[p,V],[g,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[p,"OPPO"],[g,S]],[/\b(opd2\d{3}a?) bui/i],[u,[p,"OPPO"],[g,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[p,"Vivo"],[g,S]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[p,"Realme"],[g,S]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[p,x],[g,S]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[p,x],[g,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[p,k],[g,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[p,k],[g,S]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[p,"Lenovo"],[g,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[p,"Nokia"],[g,S]],[/(pixel c)\b/i],[u,[p,D],[g,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[p,D],[g,S]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[p,$],[g,S]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[p,$],[g,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[p,"OnePlus"],[g,S]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[p,_],[g,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[p,_],[g,S]],[/(playbook);[-\w\),; ]+(rim)/i],[u,p,[g,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[p,P],[g,S]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[p,w],[g,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[p,w],[g,S]],[/(nexus 9)/i],[u,[p,"HTC"],[g,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[u,/_/g," "],[g,S]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[p,"Acer"],[g,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[p,"Meizu"],[g,S]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[p,"Ulefone"],[g,S]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,u,[g,S]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,u,[g,y]],[/(surface duo)/i],[u,[p,N],[g,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[p,"Fairphone"],[g,S]],[/(u304aa)/i],[u,[p,"AT&T"],[g,S]],[/\bsie-(\w*)/i],[u,[p,"Siemens"],[g,S]],[/\b(rct\w+) b/i],[u,[p,"RCA"],[g,y]],[/\b(venue[\d ]{2,7}) b/i],[u,[p,"Dell"],[g,y]],[/\b(q(?:mv|ta)\w+) b/i],[u,[p,"Verizon"],[g,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[p,"Barnes & Noble"],[g,y]],[/\b(tm\d{3}\w+) b/i],[u,[p,"NuVision"],[g,y]],[/\b(k88) b/i],[u,[p,"ZTE"],[g,y]],[/\b(nx\d{3}j) b/i],[u,[p,"ZTE"],[g,S]],[/\b(gen\d{3}) b.+49h/i],[u,[p,"Swiss"],[g,S]],[/\b(zur\d{3}) b/i],[u,[p,"Swiss"],[g,y]],[/\b((zeki)?tb.*\b) b/i],[u,[p,"Zeki"],[g,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],u,[g,y]],[/\b(ns-?\w{0,9}) b/i],[u,[p,"Insignia"],[g,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[p,"NextBook"],[g,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],u,[g,S]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],u,[g,S]],[/\b(ph-1) /i],[u,[p,"Essential"],[g,S]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[p,"Envizen"],[g,y]],[/\b(trio[-\w\. ]+) b/i],[u,[p,"MachSpeed"],[g,y]],[/\btu_(1491) b/i],[u,[p,"Rotor"],[g,y]],[/(shield[\w ]+) b/i],[u,[p,"Nvidia"],[g,y]],[/(sprint) (\w+)/i],[p,u,[g,S]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[p,N],[g,S]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[p,B],[g,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[p,B],[g,S]],[/smart-tv.+(samsung)/i],[p,[g,C]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[p,F],[g,C]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,k],[g,C]],[/(apple) ?tv/i],[p,[u,I+" TV"],[g,C]],[/crkey/i],[[u,A+"cast"],[p,D],[g,C]],[/droid.+aft(\w+)( bui|\))/i],[u,[p,_],[g,C]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[p,U],[g,C]],[/(bravia[\w ]+)( bui|\))/i],[u,[p,$],[g,C]],[/(mitv-\w{5}) bui/i],[u,[p,V],[g,C]],[/Hbbtv.*(technisat) (.*);/i],[p,u,[g,C]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,Q],[u,Q],[g,C]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,C]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,u,[g,v]],[/droid.+; (shield) bui/i],[u,[p,"Nvidia"],[g,v]],[/(playstation [345portablevi]+)/i],[u,[p,$],[g,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[p,N],[g,v]],[/((pebble))app/i],[p,u,[g,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[p,I],[g,b]],[/droid.+; (glass) \d/i],[u,[p,D],[g,b]],[/droid.+; (wt63?0{2,3})\)/i],[u,[p,B],[g,b]],[/(quest( \d| pro)?)/i],[u,[p,H],[g,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[g,T]],[/(aeobc)\b/i],[u,[p,_],[g,T]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[g,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[g,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,S]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,f],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[f,Z,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,Z,X],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,q],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,f],[/\(bb(10);/i],[f,[h,P]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[h,M+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[h,A+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,j],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,f],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,f]]},et=function(e,t){if(typeof e===l&&(t=e,e=n),!(this instanceof et))return new et(e,t).getResult();var s=typeof i!==o&&i.navigator?i.navigator:n,v=e||(s&&s.userAgent?s.userAgent:r),C=s&&s.userAgentData?s.userAgentData:n,b=t?W(ee,t):ee,T=s&&s.userAgent==v;return this.getBrowser=function(){var e={};return e[h]=n,e[f]=n,Y.call(e,v,b.browser),e[d]=K(e[f]),T&&s&&s.brave&&typeof s.brave.isBrave==a&&(e[h]="Brave"),e},this.getCPU=function(){var e={};return e[m]=n,Y.call(e,v,b.cpu),e},this.getDevice=function(){var e={};return e[p]=n,e[u]=n,e[g]=n,Y.call(e,v,b.device),T&&!e[g]&&C&&C.mobile&&(e[g]=S),T&&"Macintosh"==e[u]&&s&&typeof s.standalone!==o&&s.maxTouchPoints&&s.maxTouchPoints>2&&(e[u]="iPad",e[g]=y),e},this.getEngine=function(){var e={};return e[h]=n,e[f]=n,Y.call(e,v,b.engine),e},this.getOS=function(){var e={};return e[h]=n,e[f]=n,Y.call(e,v,b.os),T&&!e[h]&&C&&C.platform&&"Unknown"!=C.platform&&(e[h]=C.platform.replace(/chrome os/i,j).replace(/macos/i,q)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(e){return v=typeof e===c&&e.length>E?Q(e,E):e,this},this.setUA(v),this};et.VERSION="1.0.38",et.BROWSER=G([h,f,d]),et.CPU=G([m]),et.DEVICE=G([u,p,g,v,S,C,y,b,T]),et.ENGINE=et.OS=G([h,f]),typeof e!==o?(typeof t!==o&&t.exports&&(e=t.exports=et),e.UAParser=et):typeof define===a&&define.amd?define(function(){return et}):typeof i!==o&&(i.UAParser=et);var ei=typeof i!==o&&(i.jQuery||i.Zepto);if(ei&&!ei.ua){var en=new et;ei.ua=en.getResult(),ei.ua.get=function(){return en.getUA()},ei.ua.set=function(e){en.setUA(e);var t=en.getResult();for(var i in t)ei.ua[i]=t[i]}}}("object"==typeof window?window:e)}}),ek=eI({"../node_modules/@skype/hydra_player_sdk/hydra_player_sdk_bundle.js"(e,t){!function(i,n){"object"==typeof e&&"object"==typeof t?t.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof e?e.hydra_player_sdk=n():i.hydra_player_sdk=n()}(e,function(){return function(){"use strict";var e,t,i,n,r,s,a,o,l,c,d,u,h,g,p,f,m,v,S,y,C,b={d:function(e,t){for(var i in t)b.o(t,i)&&!b.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},T={};b.r(T),b.d(T,{HlsHydraPlayerInitMode:function(){return J},HttpFetchErrorReason:function(){return ei},HydraPlayer:function(){return ea},HydraPlayerPlaybackErrorType:function(){return X},HydraPlayerPlaybackState:function(){return Z},HydraPlayerSetupErrorType:function(){return Y},HydraPlayerType:function(){return ee},HydraStreamDeliveryPipeline:function(){return Q},HydraStreamingEventType:function(){return K},IframeMessages:function(){return et},UmsModality:function(){return en},getSdkVersion:function(){return es}}),(C=e||(e={})).TLE="TLE",C.Overflow="Overflow",C.TownHallBasic="TownHall_Basic",C.TownHallPremium="TownHall_Premium",C.TownHall="TownHall",function(e){e.AMS="AMS",e.HLS="MiddleLaneHttpLiveStreaming",e.Ums="MiddleLaneUltraLowLatency"}(t||(t={})),function(e){e.MultiplePlayerLoad="MultiplePlayerLoad",e.PlayerInitializationFailed="PlayerInitializationFailed",e.InvalidStream="InvalidStream",e.SetSourceFailed="SetSourceFailed"}(i||(i={})),(y=n||(n={})).LoadStart="loadstart",y.LoadedData="loadeddata",y.LoadedMetadata="loadedmetadata",y.Start="start",y.CanPlayThrough="canplaythrough",y.Play="play",y.Playing="playing",y.Pause="pause",y.Waiting="waiting",y.Seeking="seeking",y.Seeked="seeked",y.Ended="ended",y.Destroyed="destroyed",y.Error="error",y.Initialized="initialized",y.Stalled="stalled",y.VolumeChange="volumechange",y.PlaybackBitrateChanged="playbackbitratechanged",y.DownloadBitrateChanged="downloadbitratechanged",y.TimeUpdate="timeupdate",y.DurationChange="durationchange",y.HlsKeyLoading="hlsKeyLoading",y.HlsKeyLoaded="hlsKeyLoaded",y.HlsKeyLoadedFailed="hlsKeyLoadedFailed",y.HlsManifestLoading="hlsManifestLoading",y.HlsManifestLoaded="hlsManifestLoaded",y.HlsManifestLoadedFailed="hlsManifestLoadedFailed",y.HlsFirstFragmentLoading="hlsFragLoading",y.HlsFirstFragmentBuffered="hlsFragBuffered",y.HlsFirstFragmentLoadFailed="hlsFirstFragmentLoadFailed",y.HlsFragmentChanged="hlsFragmentChanged",y.Online="online",y.Offline="offline",y.NetworkChange="networkChange",function(e){e.UnsupportedPlatform="UnsupportedPlatform",e.NetworkError="NetworkError",e.PlaybackRetried="PlaybackRetried",e.PlaybackError="PlaybackError",e.Unknown="Unknown",e.MediaTimeout="MediaTimeout",e.NoMediaFlow="NoMediaFlow"}(r||(r={})),function(e){e[e.Hls=1]="Hls",e[e.Ums=2]="Ums"}(s||(s={})),function(e){e.RequestIceCandidates="RequestIceCandidates"}(a||(a={})),(S=o||(o={})).Unknown="Unknown",S.ClientNetwork="ClientNetwork",S.ClientNetworkOrUnreachableServer="ClientNetworkOrUnreachableServer",S.ServerNetwork="ServerNetwork",S.ClientAuthIssue="ClientAuthIssue",S.ServerResourceNotFound="ServerResourceNotFound",function(e){e.Command="Command",e.CommandSuccessResult="CommandSuccessResult",e.CommandFailureResult="CommandFailureResult",e.PlayerEvent="PlayerEvent",e.InternalPlayerEvent="InternalPlayerEvent"}(l||(l={}));class E{constructor(e){this.telemetryAggregator=e,this.spinner=null,this.telemetryReportHandler=null}setSpinner(e){this.spinner=e}setTelemetryReportHandler(e){this.telemetryReportHandler=e}firstPlayerLoadAttemptDone(){var e;null==(e=this.spinner)||e.hide()}fullTelemetryReportUpdated(e){var t;null==(t=this.telemetryReportHandler)||t.setFullTelemetryReport(e)}snapshotTelemetryReportUpdated(e){var t;null==(t=this.telemetryReportHandler)||t.setSnapshotTelemetryReport(e)}internalEventTelemetry(e){this.telemetryAggregator.addEvent(e)}internalRequestTelemetry(e){this.telemetryAggregator.addRequest(e)}internalPeriodicTelemetry(e,t,i){this.telemetryAggregator.addPeriodicTelemetry(e,t,i)}}!function(e){e.Live="Live",e.DVR="DVR"}(c||(c={})),function(e){e.Stream="Stream",e.HydraPipeline="HydraPipeline",e.VideoPlayer="VideoPlayer"}(d||(d={})),function(e){e.Idle="Idle",e.Started="Started",e.BufferReceived="BufferReceived",e.Ended="Ended",e.Stopped="Stopped",e.Destroyed="Destroyed"}(u||(u={})),function(e){e.Idle="Idle",e.Attached="Attached",e.Starting="Starting",e.Started="Started",e.BufferReceived="BufferReceived",e.BufferAppended="BufferAppended",e.Stopped="Stopped",e.Destroyed="Destroyed"}(h||(h={})),function(e){e.PlayerStopped="PlayerStopped",e.PlaybackError="PlaybackError"}(g||(g={})),function(e){e.Hive="hive",e.Kollective="kollective",e.Ramp="ramp",e.Peer5="peer5",e.Microsoft="microsoft"}(p||(p={})),function(e){e[e.DoublePress3Fingers=0]="DoublePress3Fingers"}(f||(f={})),function(e){e.BitrateChangedDownload="BitrateChangedDownload",e.StreamOptionsConfigured="StreamOptionsConfigured",e.BitrateChangedPlayback="BitrateChangedPlayback",e.CaptionsToggled="CaptionsToggled",e.Error="Error",e.IgnoredError="IgnoredError",e.FullscreenChanged="FullscreenChanged",e.Mute="Mute",e.PotentialMediaFreeze="PotentialMediaFreeze",e.StateChanged="StateChanged",e.HydraInputStateChanged="HydraInputStateChanged",e.HydraOutputStateChanged="HydraOutputStateChanged",e.Volume="Volume",e.Buffering="Buffering",e.Online="Online",e.Offline="Offline",e.NetworkChange="NetworkChange",e.HlsEvents="HlsEvents",e.EcdnPluginEvents="EcdnPluginEvents",e.UserInitiatedSeek="UserInitiatedSeek",e.UserInitiatedPlay="UserInitiatedPlay",e.UserInitiatedPause="UserInitiatedPause",e.CapabilitiesUpdated="CapabilitiesUpdated"}(m||(m={})),function(e){e.LoadHydra="LoadHydra",e.LoadHlsScript="LoadHlsScript",e.LoadPlayer="LoadPlayer",e.Load="Load",e.LoadHlsAuthCookie="LoadHlsAuthCookie",e.HlsManifestLoad="HlsManifestLoad",e.HlsKeyLoad="HlsKeyLoad",e.LoadHlsFirstFragment="LoadHlsFirstFragment",e.SetSource="SetSource",e.SdnPluginLoad="SdnPluginLoad",e.ThaPluginLoad="ThaPluginLoad",e.HydraPipelineInitialization="HydraPipelineInitialization",e.Destroyed="Destroyed",e.Setup="Setup",e.StreamConnection="StreamConnection",e.SdnPluginInitialize="SdnPluginInitialize",e.SdnPluginSetSource="SdnPluginSetSource",e.PlayAttemptBlocked="PlayAttemptBlocked"}(v||(v={}));var _=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};function I(e){return _(this,arguments,void 0,function*(e,t=5,i=200){return yield e(t).catch(n=>_(this,void 0,void 0,function*(){return 0==--t?yield Promise.reject(Error(`[retry] retries exhausted: ${R(n)}`)):yield new Promise(r=>setTimeout(()=>{r(I(e,t,i).catch(e=>_(this,void 0,void 0,function*(){return yield Promise.reject(Error(`${R(n)}`.concat(", ",R(e))))})))},i))}))})}function w(e,t,i){var n;let r=i,s=null==(n=e.ecsSettings)?void 0:n[t];return typeof s==typeof r&&(r=s),r}function P(e){try{if(!e)return`${e}`;if(e instanceof Map)return function(e){let t={};return e.forEach((e,i)=>{t[i.toString()]=e}),JSON.stringify(t)}(e);if("object"==typeof e&&e instanceof MediaError)return function(e){let t="";switch(e.code){case MediaError.MEDIA_ERR_ABORTED:t="User aborted playback";break;case MediaError.MEDIA_ERR_NETWORK:t="Network error during fetch";break;case MediaError.MEDIA_ERR_DECODE:t="Decoding error (corrupt/unsupported format)";break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:t="Media format not supported";break;default:t="Unknown media error"}return`MediaError: code - ${e.code} (${t}), message - ${e.message}`}(e);let t=e.toString();return t.endsWith("[object Object]")?JSON.stringify(e):t}catch(e){return""}}function R(e){return e instanceof Error?e.message:P(e)}let A=!1;var M=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};class D{constructor(e,t,i){this.name=e,this.details=t,this.failReason=i,this.timeStamp=Date.now()}getName(){return this.name}getFailReason(){return this.failReason}getDetails(){return this.details}getTimeStamp(){return this.timeStamp}}function O(e,t){let i=t.getFailReason()?{failReason:t.getFailReason()}:{};return t.getDetails()&&e.details.push(t.getDetails()),Object.assign(Object.assign(Object.assign({},{name:e.name,startTime:e.startTime,duration:t.getTimeStamp()>e.startTime?t.getTimeStamp()-e.startTime:e.duration}),i),{details:e.details})}class k{getPlayerDiagnosticSnapshot(){return this.currentPlayerDiagnosticSnapshot}constructor(e,t,i,n){this.config=e,this.logFn=t,this.playerDiagnosticsLog=i,this.playerMetadata=n,this.playerEvents=[],this.playbackEvents=[],this.ecdnPluginEvents=[],this.userInitiatedSeekEvents=[],this.userInitiatedPlayEvents=[],this.userInitiatedPauseEvents=[],this.hydraInitResult=null,this.callSetupSucceeded=!1,this.callDropped=!1,this.latestErrorReason=void 0,this.clientNetworkType=void 0,this.supportedCodecs=void 0,this.maxPlayerPlaybackEventCount=e.maxPlayerPlaybackEventCount||5,this.maxPlayerDiagnosticsCount=e.maxPlayerDiagnosticsCount||5,this.maxPlayerMemoryTraceLogCount=e.maxPlayerMemoryTraceLogCount||100,this.maxUserInitiatedEventCount=w(this.config,"maxUserInitiatedEventCount",100),this.config.debugLogging&&(this.playerDiagnosticsLog.memoryLog=[]),this.addNetworkTypeEventListener(),w(this.config,"logSupportedCodecs",A)&&this.populateSupportedCodecs()}setHydraInitResult(e){this.hydraInitResult=e}registerStatsUpdated(e){this.currentPlayerDiagnosticSnapshot=e,Object.keys(this.playerDiagnosticsLog).forEach(t=>{var i;let n=t,r=null!=(i=this.playerDiagnosticsLog[t])?i:[];if(Array.isArray(r)){r.push(e[n]);let t="memoryLog"===n&&r.length>this.maxPlayerMemoryTraceLogCount,i="memoryLog"!==n&&r.length>this.maxPlayerDiagnosticsCount;(t||i)&&r.splice(0,1)}else this.playerDiagnosticsLog[t]=e[n]})}registerEventLoadAttempt(e,t){this.registerScenario(e,t)}registerEventLoadFailed(e,t){this.completeScenario(e,t)}registerEventLoadSucceeded(e,t){this.completeScenario(e,void 0,t),e===v.LoadPlayer&&(this.callSetupSucceeded=!0)}registerSdnPluginLoadAttempt(e){this.registerScenario(v.SdnPluginLoad,e)}registerSdnPluginLoadFailed(e){this.completeScenario(v.SdnPluginLoad,e)}registerSdnPluginLoadSucceeded(e){this.completeScenario(v.SdnPluginLoad,void 0,e)}registerSdnPluginInitializeAttempt(e){this.registerScenario(v.SdnPluginInitialize,e)}registerSdnPluginInitializeFailed(e){this.completeScenario(v.SdnPluginInitialize,e)}registerSdnPluginInitializeSucceeded(e){this.completeScenario(v.SdnPluginInitialize,void 0,e)}registerSdnPluginSetSourceAttempt(e){this.registerScenario(v.SdnPluginSetSource,e)}registerSdnPluginSetSourceFailed(e){this.completeScenario(v.SdnPluginSetSource,e)}registerSdnPluginSetSourceSucceeded(e){this.completeScenario(v.SdnPluginSetSource,void 0,e)}registerSetSourceAttempt(){this.registerScenario(v.SetSource,void 0)}registerSetSourceSucceeded(e){this.completeScenario(v.SetSource,void 0,e)}registerSetSourceFailed(e,t){this.completeScenario(v.SetSource,e,t)}registerPlayerDestroyed(e){this.registerScenario(v.Destroyed),this.completeScenario(v.Destroyed,e)}registerPlaybackStateChanged(e,t){var i,r,s,a,o,l;if(e!==n.CanPlayThrough||this.firstReadyStateTimestamp){if(e===n.Playing){if(this.firstPlayingState||(this.firstPlayingState={timestamp:Date.now()},t&&(t.edgeLatency&&(this.firstPlayingState.edgeLatency=t.edgeLatency),t.bufferLength&&(this.firstPlayingState.bufferLength=t.bufferLength))),this.userInitiatedSeekEvents.length>0){let e=this.userInitiatedSeekEvents[this.userInitiatedSeekEvents.length-1];this.modifyTelemetryEventPayload(e,{playingStatePosition:null!=(r=null==(i=this.currentPlayerDiagnosticSnapshot)?void 0:i.currentPlayPosition)?r:-1,playingStateTimestamp:Date.now()},!1)}if(this.userInitiatedPlayEvents.length>0){let e=this.userInitiatedPlayEvents[this.userInitiatedPlayEvents.length-1];this.modifyTelemetryEventPayload(e,{playingStatePosition:null!=(a=null==(s=this.currentPlayerDiagnosticSnapshot)?void 0:s.currentPlayPosition)?a:-1,playingStateTimestamp:Date.now()},!1)}}else if(e===n.Pause&&this.userInitiatedPauseEvents.length>0){let e=this.userInitiatedPauseEvents[this.userInitiatedPauseEvents.length-1];this.modifyTelemetryEventPayload(e,{pauseStatePosition:null!=(l=null==(o=this.currentPlayerDiagnosticSnapshot)?void 0:o.currentPlayPosition)?l:-1,pauseStateTimestamp:Date.now()},!1)}}else this.firstReadyStateTimestamp=Date.now();this.registerPlaybackEvent(m.StateChanged,e)}registerCapabilitiesUpdated(e){this.registerPlaybackEvent(m.CapabilitiesUpdated,e)}registerHydraInputStateChanged(e,t){this.registerPlaybackEvent(m.HydraInputStateChanged,e,t)}registerHydraOutputStateChanged(e,t){this.registerPlaybackEvent(m.HydraOutputStateChanged,e,t)}registerPlaybackBuffering(e){this.registerPlaybackEvent(m.Buffering,e)}registerSdnPluginEvent(e){let t=this.createTelemetryEvent(m.EcdnPluginEvents,e);this.ecdnPluginEvents.push(t),this.ecdnPluginEvents.length>this.maxPlayerPlaybackEventCount&&this.ecdnPluginEvents.splice(0,1),this.logTelemetryEvent(t)}registerPlaybackError(e,t,i,n){this.registerPlaybackEvent(m.Error,{errorType:e,details:t,errorSource:i,errorReason:n}),this.latestErrorReason=n}registerIgnoredPlaybackError(e){this.registerPlaybackEvent(m.IgnoredError,e)}registerDownloadBitrateChanged(e){this.registerPlaybackEvent(m.BitrateChangedDownload,e)}registerStreamOptionsConfigured(e,t){this.registerPlaybackEvent(m.StreamOptionsConfigured,e,t)}registerPlaybackBitrateChanged(e){this.registerPlaybackEvent(m.BitrateChangedPlayback,e)}registerVolumeChange(e){this.registerPlaybackEvent(m.Volume,e)}getSnapshotReport(){var e,t;let i=[this.getTotalLoadEvent(),this.getHydraLoadEvent()].concat(this.buildCompleteTelemetryEvent()),n=this.playbackEvents,r={};this.currentPlayerDiagnosticSnapshot&&(r=this.filterAndPrepareTelemetry());let s=w(this.config,"logSupportedCodecs",A);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({isFullReport:!1,configIds:this.config.configIds||"",eTag:this.config.eTag||""},this.getPlayerMetadataReport()),{isIframe:!0,isFullscreenButtonDisabled:!1,telemetryTickMs:null!=(t=null==(e=this.currentPlayerDiagnosticSnapshot)?void 0:e.statsInterval)?t:-1}),this.getHydraInitializationReport()),this.getPlayerInitializationReport(i)),this.getHydraInternalReport(n)),this.getPlaybackReport(n)),this.getBitrateReport(n)),this.getStreamConnectionReport(i)),this.getSdnReport(i)),this.getSetSourceReport(i)),this.getUserInitiatedSeekEvents()),{networkType:this.getClientNetworkType()}),s?{supportedCodecs:P(this.supportedCodecs)}:{}),{callSetupSucceeded:this.callSetupSucceeded,callDropped:this.callDropped}),r)}getReport(){var e,t,i,n;let r=[this.getTotalLoadEvent(),this.getHydraLoadEvent()].concat(this.buildCompleteTelemetryEvent()),s=this.playbackEvents,a=w(this.config,"logSupportedCodecs",A);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({isFullReport:!0,configIds:this.config.configIds||"",eTag:this.config.eTag||""},this.getPlayerMetadataReport()),{isIframe:!0,isFullscreenButtonDisabled:!1,telemetryTickMs:null!=(t=null==(e=this.currentPlayerDiagnosticSnapshot)?void 0:e.statsInterval)?t:-1}),this.getHydraInitializationReport()),this.getPlayerInitializationReport(r)),this.getHydraInternalReport(s)),this.getPlaybackReport(s)),this.getBitrateReport(s)),this.getStreamConnectionReport(r)),this.getSdnReport(r)),this.getSetSourceReport(r)),this.getUserInitiatedSeekEvents()),{networkType:this.getClientNetworkType()}),a?{supportedCodecs:P(this.supportedCodecs)}:{}),{callSetupSucceeded:this.callSetupSucceeded,callDropped:this.callDropped}),this.getPlayerDiagnosticLog()),{eventId:(null==(i=this.currentPlayerDiagnosticSnapshot)?void 0:i.eventId)||"",templateId:(null==(n=this.currentPlayerDiagnosticSnapshot)?void 0:n.templateId)||""})}buildCompleteTelemetryEvent(){this.playerEvents.sort((e,t)=>e.getName()!==t.getName()?Object.keys(v).indexOf(e.getName())-Object.keys(v).indexOf(t.getName()):e.getTimeStamp()-t.getTimeStamp());let e=[];for(let t of this.playerEvents){let i=e[e.length-1];e.length&&t.getName()===i.name&&0===i.duration?e[e.length-1]=O(i,t):e.push({name:v[t.getName()],startTime:t.getTimeStamp(),duration:0,details:t.getDetails()?[t.getDetails()]:[]})}return e}getHydraLoadEvent(){var e,t,i;let n={name:v.LoadHydra,startTime:(null==(e=this.hydraInitResult)?void 0:e.initStartTime)||-1,duration:(null==(t=this.hydraInitResult)?void 0:t.initDuration)||0,details:[]};(null==(i=this.hydraInitResult)?void 0:i.errorMsg)&&(n.failReason=this.hydraInitResult.errorMsg);let r=this.getHydraRuntimeDownloadDetails();return r&&n.details.push(r),n}getHydraRuntimeDownloadDetails(){var e;return P(null==(e=this.hydraInitResult)?void 0:e.runtimeDownloadResults)}getTotalLoadEvent(){var e,t,i;let n=this.getScenario(v.LoadPlayer),r=(null==(e=this.hydraInitResult)?void 0:e.initDuration)||0,s=n.length>0?n[n.length-1].getTimeStamp()-n[0].getTimeStamp():0,a=n.length>0?n[n.length-1].getFailReason():void 0,o={name:v.Load,startTime:(null==(t=this.hydraInitResult)?void 0:t.initStartTime)||-1,duration:r+s,details:[]};return(null==(i=this.hydraInitResult)?void 0:i.errorMsg)?o.failReason=this.hydraInitResult.errorMsg:a&&(o.failReason=a),o}getPlayerMetadataReport(){return{playerId:this.playerMetadata.playerId||"",traceId:this.playerMetadata.playerId?this.playerMetadata.playerId.replace(/-/g,""):"",hydraPlayerRuntimeVersion:this.playerMetadata.hydraPlayerRuntimeVersion||"",hydraPlayerSdkVersion:this.playerMetadata.hydraPlayerSdkVersion,player_playerType:this.playerMetadata.hydraPlayerType||""}}registerPlaybackEvent(e,t,i){let n=this.createTelemetryEvent(e,t,i);e===m.Error&&(null==t?void 0:t.errorType)!==r.PlaybackRetried&&(n.fatal=!0,this.callDropped=!0),this.playbackEvents.push(n),this.playbackEvents.length>this.maxPlayerPlaybackEventCount&&this.playbackEvents.splice(0,1),this.logTelemetryEvent(n)}getPlayerDiagnosticLog(){if(!this.currentPlayerDiagnosticSnapshot)return{};let e=this.currentPlayerDiagnosticSnapshot,t=this.playerDiagnosticsLog,i=Object.assign(Object.assign({},e),t),n={};return Object.keys(i).forEach(e=>{n[`player_${e}`]=this.prepareForTelemetry(i[e])}),n}getHydraInitializationReport(){var e,t,i,n;return{hydraInit_succeeded:(null==(e=this.hydraInitResult)?void 0:e.initSucceeded)||!1,hydraInit_startTime:(null==(t=this.hydraInitResult)?void 0:t.initStartTime)||-1,hydraInit_errorMessage:(null==(i=this.hydraInitResult)?void 0:i.errorMsg)||"",hydraInit_duration:(null==(n=this.hydraInitResult)?void 0:n.initDuration)||0}}getPlayerInitializationReport(e){var t;let i=e.find(e=>e.name===v.Load),n=this.playerEvents.find(e=>e.getName()===v.StreamConnection),r={init_timeLoadToStreamConnectionEstablished:(i&&n?n.getTimeStamp()-i.startTime:-1)||-1,init_timeLoadToReady:(i&&this.firstReadyStateTimestamp?this.firstReadyStateTimestamp-i.startTime:-1)||-1,init_timeLoadToPlaying:(i&&(null==(t=this.firstPlayingState)?void 0:t.timestamp)?this.firstPlayingState.timestamp-i.startTime:-1)||-1,init_allEvents:this.prepareForTelemetry(e)};return this.firstPlayingState&&(r.init_firstPlayingStateStatistics=this.prepareForTelemetry(this.firstPlayingState)),r}getHydraInternalReport(e){let t=e.filter(e=>e.eventType===m.HydraInputStateChanged),i=e.filter(e=>e.eventType===m.HydraOutputStateChanged);return{hydra_inputStateChangeEvents:this.prepareForTelemetry(t),hydra_outputStateChangeEvents:this.prepareForTelemetry(i)}}getPlaybackReport(e){let t=e.filter(e=>e.eventType===m.StateChanged),i=t.find(e=>e.payload===n.CanPlayThrough),r=t.find(e=>e.payload===n.Play),s=t.find(e=>e.payload===n.Start),a=t.find(e=>e.payload===n.Playing),o=null!=i&&null!=r?r.timestamp-i.timestamp:-1,l=null!=r&&null!=s?s.timestamp-r.timestamp:-1,c=null!=s&&null!=a?a.timestamp-s.timestamp:-1,d=t.filter(e=>e.payload===n.Seeked),u=t.filter(e=>e.payload===n.Seeking),h=t.filter(e=>e.payload===n.Pause),g=t.filter(e=>e.payload===n.Waiting),p=[m.BitrateChangedDownload,m.BitrateChangedPlayback,m.Error,m.Mute,m.StateChanged,m.Volume,m.StreamOptionsConfigured,m.IgnoredError],f=e.filter(e=>e.eventType===m.Error),v=e.filter(e=>e.eventType===m.IgnoredError),S=e.filter(e=>e.eventType===m.Volume||e.eventType===m.Mute),y=e.filter(e=>e.eventType===m.StreamOptionsConfigured),C=e.filter(e=>!p.includes(e.eventType));return{playback_timeReadyToPlay:o,playback_timePlayToStart:l,playback_timeStartToPlaying:c,playback_bufferingEvents:this.prepareForTelemetry(g),playback_errorEvents:this.prepareForTelemetry(f),playback_ignoredErrorEvents:this.prepareForTelemetry(v),playback_pauseEvents:this.prepareForTelemetry(h),playback_otherEvents:this.prepareForTelemetry(C),playback_seekedEvents:this.prepareForTelemetry(d),playback_seekingEvents:this.prepareForTelemetry(u),playback_stateChangeEvents:this.prepareForTelemetry(t),playback_volumeEvents:this.prepareForTelemetry(S),playback_streamOptionsConfiguredEvents:this.prepareForTelemetry(y),playback_latestErrorReason:this.latestErrorReason||""}}getBitrateReport(e){var t,i,n,r;let s=e.filter(e=>e.eventType===m.BitrateChangedDownload),a=s.sort(e=>Number(e.payload)),o=s.length>0?{bitrate_downloadChanges:this.prepareForTelemetry(s),bitrate_downloadChangeCount:s.length>0||-1,bitrate_downloadMin:(null==(t=a[0])?void 0:t.payload)||-1,bitrate_downloadMax:(null==(i=a[a.length-1])?void 0:i.payload)||-1}:{},l=e.filter(e=>e.eventType===m.BitrateChangedPlayback),c=l.sort(e=>Number(e.payload)),d=l.length>0?{bitrate_playbackChanges:this.prepareForTelemetry(l),bitrate_playbackChangeCount:l.length>0||-1,bitrate_playbackMin:(null==(n=c[0])?void 0:n.payload)||-1,bitrate_playbackMax:(null==(r=c[c.length-1])?void 0:r.payload)||-1}:{};return Object.assign(Object.assign({},o),d)}addNetworkTypeEventListener(){var e,t,i,n;(null==(t=null==(e=window.navigator)?void 0:e.connection)?void 0:t.type)&&(null==(n=null==(i=window.navigator)?void 0:i.connection)||n.addEventListener("change",()=>{this.updateClientNetworkType()}))}updateClientNetworkType(){this.clientNetworkType=void 0,this.getClientNetworkType()}getClientNetworkType(){var e,t,i,n;if(void 0===this.clientNetworkType){let r="Unknown";if(null==(t=null==(e=window.navigator)?void 0:e.connection)?void 0:t.type)switch(null==(n=null==(i=window.navigator)?void 0:i.connection)?void 0:n.type){case"cellular":r="WWAN";break;case"ethernet":r="Wired";break;case"wifi":r="Wireless";break;default:r="Unknown"}this.clientNetworkType=r}return this.clientNetworkType}getCodecList(){return[{type:"file",video:{contentType:"video/mp4; codecs=hev1.1.6.L93",width:1920,height:1080,bitrate:1e4,framerate:60}},{type:"file",video:{contentType:"video/mp4; codecs=hev1.1.6.L90",width:1920,height:1080,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=hev1.1.6.L63",width:1280,height:720,bitrate:1e4,framerate:60}},{type:"file",video:{contentType:"video/mp4; codecs=hev1.1.6.L60",width:1280,height:720,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=hev1.1.6.L30",width:640,height:480,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=avc1.64002A",width:1920,height:1080,bitrate:1e4,framerate:60}},{type:"file",video:{contentType:"video/mp4; codecs=avc1.640028",width:1920,height:1080,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=avc1.640020",width:1280,height:720,bitrate:1e4,framerate:60}},{type:"file",video:{contentType:"video/mp4; codecs=avc1.64001E",width:1280,height:720,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=avc1.640015",width:640,height:480,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/webm; codecs=vp09.00.10.08",width:1920,height:1080,bitrate:5e6,framerate:30}},{type:"file",video:{contentType:"video/webm; codecs=vp8",width:1920,height:1080,bitrate:5e6,framerate:30}},{type:"file",video:{contentType:"video/ogg; codecs=theora, vorbis",width:640,height:480,bitrate:5e5,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=av01.0.05M.08",width:1920,height:1080,bitrate:1e4,framerate:60}},{type:"file",video:{contentType:"video/mp4; codecs=av01.0.04M.08",width:1920,height:1080,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=av01.0.03M.08",width:1280,height:720,bitrate:1e4,framerate:60}},{type:"file",video:{contentType:"video/mp4; codecs=av01.0.03M.08",width:1280,height:720,bitrate:1e4,framerate:30}},{type:"file",video:{contentType:"video/mp4; codecs=av01.0.02M.08",width:640,height:480,bitrate:1e4,framerate:30}},{type:"file",audio:{contentType:"audio/webm; codecs=opus",channels:"2",bitrate:64e3,samplerate:48e3}},{type:"file",audio:{contentType:"audio/ogg; codecs=vorbis",channels:"2",bitrate:128e3,samplerate:44100}},{type:"file",audio:{contentType:"audio/mp4; codecs=mp4a.40.2",channels:"2",bitrate:128e3,samplerate:44100}},{type:"file",audio:{contentType:"audio/mp4; codecs=mp4a.40.5",channels:"2",bitrate:64e3,samplerate:48e3}},{type:"file",audio:{contentType:"audio/mpeg",channels:"2",bitrate:128e3,samplerate:44100}},{type:"file",audio:{contentType:"audio/flac",channels:"2",bitrate:32e4,samplerate:96e3}},{type:"file",audio:{contentType:"audio/mp4 codecs=ac-3",channels:"6",bitrate:64e4,samplerate:48e3}},{type:"file",audio:{contentType:"audio/mp4 codecs=ec-3",channels:"6",bitrate:64e4,samplerate:48e3}},{type:"file",audio:{contentType:"audio/wav; codecs=1",channels:"2",bitrate:1411200,samplerate:44100}}]}getAudioVideoCodecsSupported(e){return M(this,void 0,void 0,function*(){let t=[];if("mediaCapabilities"in navigator){let i=e.map(e=>M(this,void 0,void 0,function*(){let i=e;try{let n=yield navigator.mediaCapabilities.decodingInfo(i);n.supported&&(e.video?t.push({codec:e.video.contentType,supported:n.supported,smooth:n.smooth,powerEfficient:n.powerEfficient,resolution:e.video.height,framerate:e.video.framerate}):e.audio&&t.push({codec:e.audio.contentType,supported:n.supported,smooth:n.smooth,powerEfficient:n.powerEfficient}))}catch(e){}}));yield Promise.allSettled(i)}return t})}populateSupportedCodecs(){void 0===this.supportedCodecs&&this.getAudioVideoCodecsSupported(this.getCodecList()).then(e=>{this.supportedCodecs=e})}getSdnReport(e){var t;let i=e.filter(e=>[v.SdnPluginLoad,v.SdnPluginInitialize,v.SdnPluginSetSource].includes(e.name)),n=[...i,...this.ecdnPluginEvents],r=i.filter(e=>void 0!==e.failReason),s=i.filter(e=>e.name===v.SdnPluginLoad).sort((e,t)=>t.startTime-e.startTime)[0];return{sdn_loaded:null!=s&&void 0===s.failReason,sdn_details:null!=(t=null==s?void 0:s.details)?t:"",sdn_error:r.length>0&&r[r.length-1].failReason||"",sdn_events:this.prepareForTelemetry(n)}}getStreamConnectionReport(e){let t=e.filter(e=>e.name===v.StreamConnection);return{stream_connection_events:this.prepareForTelemetry(t)}}getSetSourceReport(e){let t=e.filter(e=>e.name===v.SetSource);return{set_source_events:this.prepareForTelemetry(t)}}registerScenario(e,t){this.playerEvents.push(new D(e,t))}completeScenario(e,t,i){this.playerEvents.push(new D(e,i,t))}logTelemetryEvent(e){this.config.debugLogging&&(this.logFn("debug",`PlayerTelemetryEvent: ${JSON.stringify(e)}`),this.logFn("debug",`PlayerDiagnosticData: ${JSON.stringify(this.currentPlayerDiagnosticSnapshot)}`))}filterAndPrepareTelemetry(){let e=new Set;e.add("serviceLatencyCdg"),e.add("endToEndLatencyCdg"),e.add("videoEdgeLatencyCdg"),e.add("eventId"),e.add("templateId");let t={};return Object.keys(this.currentPlayerDiagnosticSnapshot).forEach(i=>{e.has(i)||(t[`player_${i}`]=this.prepareForTelemetry(this.currentPlayerDiagnosticSnapshot[i]))}),t}prepareForTelemetry(e){return"boolean"==typeof e?e:"string"==typeof e||void 0===e?e||"":"number"==typeof e?null!=e?e:-1:JSON.stringify(e)}getScenario(e){return this.playerEvents.filter(t=>t.getName()===e)}createTelemetryEvent(e,t,i){var n,r;let s={eventType:e,timestamp:Date.now(),currentPlayPosition:null!=(r=null==(n=this.currentPlayerDiagnosticSnapshot)?void 0:n.currentPlayPosition)?r:-1};return void 0!==t&&(s.payload=this.prepareForTelemetry(t)),s.message=i,s}modifyTelemetryEventPayload(e,t,i){try{if(e.payload){let n=JSON.parse(e.payload);n=i?Object.assign(Object.assign({},n),t):Object.assign(Object.assign({},t),n),e.payload=this.prepareForTelemetry(n)}else e.payload=this.prepareForTelemetry(t)}catch(t){this.logFn("error",`Failed to modify payload for event: ${P(e)}, error: ${t}`)}}registerUserInitiatedSeek(e){var t,i;let n={newCurrentPlayPosition:e,seekForward:(null!=(i=null==(t=this.currentPlayerDiagnosticSnapshot)?void 0:t.currentPlayPosition)?i:-1)<e},r=this.createTelemetryEvent(m.UserInitiatedSeek,n);this.userInitiatedSeekEvents.push(r),this.userInitiatedSeekEvents.length>this.maxUserInitiatedEventCount&&this.userInitiatedSeekEvents.splice(0,1)}registerUserInitiatedPlay(){let e=this.createTelemetryEvent(m.UserInitiatedPlay);this.userInitiatedPlayEvents.push(e),this.userInitiatedPlayEvents.length>this.maxUserInitiatedEventCount&&this.userInitiatedPlayEvents.splice(0,1)}registerUserInitiatedPause(){let e=this.createTelemetryEvent(m.UserInitiatedPause);this.userInitiatedPauseEvents.push(e),this.userInitiatedPauseEvents.length>this.maxUserInitiatedEventCount&&this.userInitiatedPauseEvents.splice(0,1)}getUserInitiatedSeekEvents(){return{playback_userInitiatedSeekEvents:this.prepareForTelemetry(this.userInitiatedSeekEvents),playback_userInitiatedPlayEvents:this.prepareForTelemetry(this.userInitiatedPlayEvents),playback_userInitiatedPauseEvents:this.prepareForTelemetry(this.userInitiatedPauseEvents)}}registerPlayBlocked(e){this.registerScenario(v.PlayAttemptBlocked),this.completeScenario(v.PlayAttemptBlocked,`Called video element play() but it failed with error: ${e}`)}}class N{constructor(e,t,i,n){this.logFn=t,this.spinner=n;let r=this.createPlayerMetadata(e);this.initialLiveStreamStatistic=new k(e,(e,t)=>{this.logFn(e,t)},{videoBufferLength:[],videoCachedLength:[],videoEdgeLatency:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowHeight:[],windowWidth:[],playbackRate:[],currentPlayPosition:[],statsInterval:[]},r),this.initialLiveStreamStatistic.setHydraInitResult(i),this.fullTelemetryReport=this.initialLiveStreamStatistic.getReport(),this.snapshotTelemetryReport=this.initialLiveStreamStatistic.getSnapshotReport()}createPlayerMetadata(e){let t={hydraPlayerSdkVersion:e.hydraPlayerSdkVersion||"Unknown"};return e.playerType&&(t.hydraPlayerType=e.playerType),t}getFullTelemetryReport(){return this.updateInitEventsWithHydraEvent(this.fullTelemetryReport)}getSnapshotTelemetryReport(){return this.updateInitEventsWithHydraEvent(this.snapshotTelemetryReport)}setFullTelemetryReport(e){var t,i,n,r,s,a,o;this.fullTelemetryReport=Object.assign(Object.assign({},e),{init_spinnerShowTimestamp:null!=(i=null==(t=this.spinner)?void 0:t.firstShowTimestamp)?i:-1,init_spinnerHideTimestamp:null!=(r=null==(n=this.spinner)?void 0:n.firstHideTimestamp)?r:-1,init_spinnerDuration:null!=(a=null==(s=this.spinner)?void 0:s.firstSpinnerDuration)?a:-1,init_spinnerVisible:(null==(o=this.spinner)?void 0:o.isVisible())||!1})}setSnapshotTelemetryReport(e){var t,i,n,r,s,a,o;this.snapshotTelemetryReport=Object.assign(Object.assign({},e),{init_spinnerShowTimestamp:null!=(i=null==(t=this.spinner)?void 0:t.firstShowTimestamp)?i:-1,init_spinnerHideTimestamp:null!=(r=null==(n=this.spinner)?void 0:n.firstHideTimestamp)?r:-1,init_spinnerDuration:null!=(a=null==(s=this.spinner)?void 0:s.firstSpinnerDuration)?a:-1,init_spinnerVisible:(null==(o=this.spinner)?void 0:o.isVisible())||!1})}addDisposeTelemetry(){let e=Date.now();this.updateInitEventsWithDisposeEvent(this.fullTelemetryReport,e,"full"),this.updateInitEventsWithDisposeEvent(this.snapshotTelemetryReport,e,"snapshot"),this.updateStateChangeEventsWithDisposeEvent(this.fullTelemetryReport,e,"full"),this.updateStateChangeEventsWithDisposeEvent(this.snapshotTelemetryReport,e,"snapshot")}updateInitEventsWithDisposeEvent(e,t,i){try{let i=e.init_allEvents,n=JSON.parse(i);n[n.length-1].name!==v.Destroyed&&n.push({name:v.Destroyed,startTime:t,duration:0,details:g.PlayerStopped}),e.init_allEvents=P(n)}catch(e){this.logFn("warn",`Failed to add player destroyed information to init_allEvents telemetry field in ${i} telemetry report.`)}}updateStateChangeEventsWithDisposeEvent(e,t,i){try{let i=e.playback_stateChangeEvents,r=JSON.parse(i);r[r.length-1].name!==n.Destroyed&&r.push({eventType:m.StateChanged,timestamp:t,currentPlayPosition:-1,payload:n.Destroyed}),e.playback_stateChangeEvents=P(r)}catch(e){this.logFn("warn",`Failed to add player destroyed information to playback_stateChangeEvents telemetry field in ${i} telemetry report.`)}}updateInitEventsWithHydraEvent(e){try{let t=e.init_allEvents,i=JSON.parse(t);for(let t=0;t<i.length;t++)if(i[t].name===v.LoadHydra)return i[t]=this.initialLiveStreamStatistic.getHydraLoadEvent(),e.init_allEvents=P(i),e}catch(e){this.logFn("warn","Failed to add load hydra event in telemetry.")}return e}}class x{get firstShowTimestamp(){return this.firstSpinnerShowTimestamp}get firstHideTimestamp(){return this.firstSpinnerHideTimestamp}get firstSpinnerDuration(){return this.firstSpinnerShowTimestamp?this.firstSpinnerHideTimestamp?this.firstSpinnerHideTimestamp-this.firstSpinnerShowTimestamp:Date.now()-this.firstSpinnerShowTimestamp:null}get visibilityHistory(){if(this.spinnerInfoHistory.length>0){let e=this.spinnerInfoHistory[this.spinnerInfoHistory.length-1];e.hideTimestamp||(e.displayDuration=Date.now()-e.showTimestamp)}return this.spinnerInfoHistory}constructor(e){this.container=e,this.spinnerId="hydra-player-spinner",this.firstSpinnerShowTimestamp=null,this.firstSpinnerHideTimestamp=null,this.spinnerInfoHistory=[],this.maxTimestampHistorySize=100;let t=this.container.ownerDocument.getElementById(this.spinnerId);if(t)return this.spinner=t,void this.show();let i=this.container.ownerDocument.createElement("style");i.textContent="\n            .ml-player-spinner-container {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                position: absolute;\n                pointer-events: none;\n            }\n            .ml-player-spinner {\n                width: 3.6rem;\n                height: 3.6rem;\n                display: block;\n                overflow-clip-margin: content-box;\n                overflow: hidden;\n                animation: ml-player-spinner-outer-rotate 3s linear infinite;\n            }\n            .ml-player-spinner-dark-wheel {\n                fill: none;\n                r: 45%;\n                cx: 50%;\n                cy: 50%;\n                stroke: rgb(68, 71, 145);\n                stroke-width: 8px;\n            }\n            .ml-player-spinner-light-wheel {\n                fill: none;\n                r: 45%;\n                cx: 50%;\n                cy: 50%;\n                stroke: rgb(127, 133, 245);\n                stroke-width: 8px;\n                stroke-dasharray: 283;\n                stroke-dashoffset: 280;\n                stroke-linecap: round;\n                transform-origin: 50% 50%;\n                animation: ml-player-spinner-inner-rotate 1.5s cubic-bezier(0.33, 0, 0.67, 1) infinite;\n            }\n            @keyframes ml-player-spinner-outer-rotate {\n                0% {\n                    transform: rotate(0deg);\n                }\n                100% {\n                    transform: rotate(360deg);\n                }\n            }\n            @keyframes ml-player-spinner-inner-rotate {\n                0% {\n                    stroke-dashoffset: 283;\n                    transform: rotate(0deg);\n                }\n                25% {\n                    stroke-dashoffset: 283;\n                    transform: rotate(0deg);\n                }\n                50% {\n                    stroke-dashoffset: 75;\n                    transform: rotate(45deg);\n                }\n                75% {\n                    stroke-dashoffset: 75;\n                    transform: rotate(45deg);\n                }\n                100% {\n                    stroke-dashoffset: 283;\n                    transform: rotate(360deg);\n                }\n            }\n        ",this.container.ownerDocument.head.appendChild(i),this.container.style.position="relative";let n=this.container.ownerDocument.createElement("div");n.classList.add("ml-player-spinner-container"),this.container.appendChild(n),this.spinner=this.container.ownerDocument.createElementNS("http://www.w3.org/2000/svg","svg"),this.spinner.style.position="absolute",this.spinner.setAttribute("viewBox","0 0 100 100"),this.spinner.classList.add("ml-player-spinner"),this.spinner.id=this.spinnerId,n.appendChild(this.spinner);let r=this.container.ownerDocument.createElementNS("http://www.w3.org/2000/svg","circle");r.classList.add("ml-player-spinner-dark-wheel"),this.spinner.appendChild(r);let s=this.container.ownerDocument.createElementNS("http://www.w3.org/2000/svg","circle");s.classList.add("ml-player-spinner-light-wheel"),this.spinner.appendChild(s),this.show()}show(){let e=Date.now();this.firstSpinnerShowTimestamp||(this.firstSpinnerShowTimestamp=e),(0===this.spinnerInfoHistory.length||this.spinnerInfoHistory[this.spinnerInfoHistory.length-1].hideTimestamp)&&(this.spinnerInfoHistory.push({showTimestamp:e,displayDuration:0}),this.spinnerInfoHistory.length>this.maxTimestampHistorySize&&this.spinnerInfoHistory.splice(0,1)),this.spinner.style.display="block"}hide(){let e=Date.now();if(this.firstSpinnerHideTimestamp||(this.firstSpinnerHideTimestamp=e),this.spinnerInfoHistory.length>0){let t=this.spinnerInfoHistory[this.spinnerInfoHistory.length-1];t.hideTimestamp||(t.hideTimestamp=e,t.displayDuration=e-t.showTimestamp)}this.spinner.style.display="none"}isVisible(){return"none"!==this.spinner.style.display}}function L(){let e,t;return{promise:new Promise((i,n)=>{e=i,t=n}),resolve:e,reject:t}}var F,U=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};class ${constructor(e){this.playerSettings=e,this.latestCandidates=[],this.newCandidates=[],this.peerConnection=null,this.timeoutId=void 0,this.candidatesCollectionDefer=null,this.delayAfterComplete=w(this.playerSettings,"WebRtcIceCandidateCollectorDelayAfterCompleteMs",2500),this.delayAfterError=w(this.playerSettings,"WebRtcIceCandidateCollectorDelayAfterErrorMs",1e3),this.maxRetries=w(this.playerSettings,"WebRtcIceCandidateCollectorMaxRetriesMs",5),this.retryDelay=w(this.playerSettings,"WebRtcIceCandidateCollectorRetryDelayMs",100),this.maxCollectionTime=w(this.playerSettings,"WebRtcIceCandidateCollectorMaxCollectionTimeMs",6e4),this.disabledCollection=w(this.playerSettings,"WebRtcIceCandidateCollectorDisableCollection",!1)}handleIceCandidate(e){e.candidate&&this.newCandidates.push(e.candidate)}handleIceGatheringStateChange(){var e,t;"complete"===(null==(e=this.peerConnection)?void 0:e.iceGatheringState)&&(this.latestCandidates=[...this.newCandidates],this.newCandidates=[],null==(t=this.candidatesCollectionDefer)||t.resolve(),this.candidatesCollectionDefer=null,this.destroyConnection(),this.clearCollectionTimeout(),this.startCandidatesCollection(this.delayAfterComplete))}setUpPeerConnection(){return U(this,void 0,void 0,function*(){var e,t;try{this.peerConnection=new RTCPeerConnection,this.peerConnection.createDataChannel("local-ip-hydra-player-ice-candidates"),this.peerConnection.addEventListener("icecandidate",this.handleIceCandidate.bind(this)),this.peerConnection.addEventListener("icegatheringstatechange",this.handleIceGatheringStateChange.bind(this));let i=yield null==(e=this.peerConnection)?void 0:e.createOffer();yield null==(t=this.peerConnection)?void 0:t.setLocalDescription(i)}catch(e){throw this.destroyConnection(),Error(`Failure starting collection: ${R(e)}`)}})}destroyConnection(){this.peerConnection&&(this.peerConnection.removeEventListener("icecandidate",this.handleIceCandidate.bind(this)),this.peerConnection.removeEventListener("icegatheringstatechange",this.handleIceGatheringStateChange.bind(this)),this.peerConnection.close(),this.peerConnection=null)}clearCollectionTimeout(){void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0)}destroy(){this.disabledCollection=!0,this.destroyConnection(),this.clearCollectionTimeout(),this.candidatesCollectionDefer&&(this.candidatesCollectionDefer.reject(Error("Collection aborted due to destroy")),this.candidatesCollectionDefer=null)}startCandidatesCollection(){return U(this,arguments,void 0,function*(e=0){if(this.candidatesCollectionDefer||this.disabledCollection)return;e>0&&(yield new Promise(t=>setTimeout(t,e))),this.candidatesCollectionDefer=L(),this.candidatesCollectionDefer.promise.catch(()=>{});let t=this.setUpPeerConnection.bind(this);yield I(t,this.maxRetries,this.retryDelay).then(()=>{this.timeoutId=setTimeout(()=>{var e;null==(e=this.candidatesCollectionDefer)||e.reject(Error("Collection timed out")),this.candidatesCollectionDefer=null,this.destroyConnection(),this.startCandidatesCollection(this.delayAfterError)},this.maxCollectionTime)}).catch(e=>U(this,void 0,void 0,function*(){var t;let i=`Failed to start collection ${R(e)}`;null==(t=this.candidatesCollectionDefer)||t.reject(Error(i)),this.candidatesCollectionDefer=null,yield Promise.reject(Error(i)),this.startCandidatesCollection(this.delayAfterError)}))})}getCandidates(){return U(this,void 0,void 0,function*(){return 0===this.latestCandidates.length&&this.candidatesCollectionDefer&&(yield this.candidatesCollectionDefer.promise),this.latestCandidates})}}class V{constructor(e,t,i){this.iframe=e,this.playerSettings=t,this.logger=i,this.setupMessageListener(),this.candidatesCollector=new $(this.playerSettings),this.candidatesCollector.startCandidatesCollection().catch(e=>{this.logger("warn",`Failed to start collecting ICE candidates ${e}`)})}setupMessageListener(){var e;null==(e=this.iframe.ownerDocument.defaultView)||e.addEventListener("message",this.processMessage.bind(this))}postMessageToIframe(e){var t;null==(t=this.iframe.contentWindow)||t.postMessage(e,"*")}dispose(){var e;null==(e=this.iframe.ownerDocument.defaultView)||e.removeEventListener("message",this.processMessage.bind(this)),this.candidatesCollector&&this.candidatesCollector.destroy()}processMessage(e){e.data===a.RequestIceCandidates&&void 0===e.data.candidates&&this.candidatesCollector.getCandidates().then(e=>{let t=JSON.stringify(e.map(e=>JSON.stringify(e)));this.postMessageToIframe({topic:a.RequestIceCandidates,candidates:t})}).catch(()=>{this.postMessageToIframe({topic:a.RequestIceCandidates,candidates:[]})})}}class B{constructor(){this.start=0,this.first=0,this.end=0}}class H{constructor(){this.loading=new B,this.aborted=!1,this.loaded=0,this.total=0,this.readyStates=[],this.retryCount=0,this.url="",this.contentLength=0}}!function(e){e[e.TTFB_TIMEOUT=0]="TTFB_TIMEOUT",e[e.LOAD_TIMEOUT=1]="LOAD_TIMEOUT",e[e.NETWORK_ERROR=2]="NETWORK_ERROR",e[e.SUCCESS=3]="SUCCESS"}(F||(F={}));class j{constructor(){this.responseText="",this.responseReady=!1,this.perfDataReady=!1,this.perfData=void 0,this.observer=null}}class q{constructor(e,t,i){this.loadPolicy=t,this.loaderCallbacks=i,this.loader=null,this.urls=e,this.stats=new H,this.loaderId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),this.observerState=new j}xhrEventsBasedPerfData(){let e=this.stats,t=this.getDuration(e.loading.first,e.loading.end);if(e.contentLength>0&&t>0){let i=Math.floor(8*e.contentLength*1e3/t);return console.log(`[XhrLoader] XHR events download bitrate: ${i} bps, size: ${e.contentLength} bytes, duration: ${t} ms`),{duration:t,size:e.contentLength,bitrate:i}}return{duration:-1,size:-1,bitrate:-1}}callOnSuccessIfReady(){let e=this.loader,{responseText:t,observer:i,perfDataReady:n,perfData:r,responseReady:s}=this.observerState;if(!s)return void console.warn("Response is not ready, cannot call onSuccess");let a=i&&n&&r&&r.size>0,o=this.xhrEventsBasedPerfData(),l=this.createDownloadResult(F.SUCCESS,e,a?r:o);this.loaderCallbacks.onSuccess(t,l),this.resetObserverState(),this.resetObserver()}load(){let e=this.loader=new XMLHttpRequest,t=this.appendTraceIdToUrl(this.urls[this.stats.retryCount%this.urls.length]),i=t,n=new PerformanceObserver(e=>{let t=e.getEntries().find(e=>e.name.includes(i));if(t){this.observerState.observerTimeoutId&&(self.clearTimeout(this.observerState.observerTimeoutId),this.observerState.observerTimeoutId=void 0);let e=t.responseEnd-t.responseStart,i=t.encodedBodySize,r=e>0?Math.floor(8*i*1e3/e):0;this.observerState.perfData={duration:e,size:i,bitrate:r},this.observerState.perfDataReady=!0,this.callOnSuccessIfReady(),n.disconnect()}});try{n.observe({type:"resource",buffered:!1}),this.observerState.observer=n}catch(e){console.warn("PerformanceObserver not supported, falling back to XHR events",e),this.observerState.observer=null}e.open("GET",t,!0),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),self.clearTimeout(this.requestTimeoutId),this.requestTimeoutId=self.setTimeout(this.loadtimeout.bind(this,F.TTFB_TIMEOUT,e),this.loadPolicy.maxTimeToFirstByteMs),this.resetStats(t),e.send()}resetObserver(){var e;null==(e=this.observerState.observer)||e.disconnect(),this.observerState.observer=null}resetObserverState(){this.observerState.responseText="",this.observerState.responseReady=!1,this.observerState.observerTimeoutId&&(self.clearTimeout(this.observerState.observerTimeoutId),this.observerState.observerTimeoutId=void 0),this.observerState.perfDataReady=!1,this.observerState.perfData=void 0}resetStats(e){this.stats.loading.start=self.performance.now(),this.stats.loading.first=0,this.stats.loading.end=0,this.stats.readyStates=[],this.stats.aborted=!1,this.stats.url=e,this.resetObserverState()}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}loadtimeout(e,t){this.shouldRetry(this.stats)?this.retry(e,t):(this.loaderCallbacks.onError(this.createDownloadResult(e,t)),this.abortInternal())}readystatechange(){let{loader:e,stats:t}=this;if(!e||t.aborted)return;let i=e.readyState;if(this.stats.readyStates.push(i),2===i&&(this.stats.loading.first=self.performance.now(),self.clearTimeout(this.requestTimeoutId),this.requestTimeoutId=self.setTimeout(this.loadtimeout.bind(this,F.LOAD_TIMEOUT,e),this.loadPolicy.maxLoadTimeMs-(this.stats.loading.first-t.loading.start))),4===i)if(self.clearTimeout(this.retryTimeoutId),self.clearTimeout(this.requestTimeoutId),e.onreadystatechange=null,e.onprogress=null,this.stats.loading.end=self.performance.now(),200===e.status){this.observerState.responseText=e.responseText,this.observerState.responseReady=!0;let i=e.getResponseHeader("Content-Length"),n=i?parseInt(i,10):0;t.contentLength=isNaN(n)?0:n,this.observerState.observer&&(this.observerState.observerTimeoutId=self.setTimeout(()=>{this.observerState.perfDataReady||(console.warn("Performance data collection timed out, calling onSuccess without it"),this.callOnSuccessIfReady())},1e3))}else this.shouldRetry(t)?this.retry(F.NETWORK_ERROR,e):this.loaderCallbacks.onError(this.createDownloadResult(F.NETWORK_ERROR,e))}shouldRetry(e){return e.retryCount<this.loadPolicy.maxRetries}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeoutId),self.clearTimeout(this.retryTimeoutId),this.resetObserverState(),this.resetObserver(),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort())),this.loader=null}retry(e,t){this.loaderCallbacks.onRetry(this.createDownloadResult(e,t)),this.abortInternal(),this.stats.retryCount++,self.clearTimeout(this.retryTimeoutId),this.retryTimeoutId=self.setTimeout(this.load.bind(this),this.loadPolicy.retryDelay)}createDownloadResult(e,t,i){var n,r;let s=this.stats,a={status:-1,headers:{},url:s.url,readyStates:s.readyStates,loaded:s.loaded,total:s.total,ttfb:this.getDuration(s.loading.start,s.loading.first),duration:this.getDuration(s.loading.start,s.loading.end||self.performance.now()),result:F[e],isOnline:navigator.onLine,downloadBitrateBps:-1,transferSize:-1,downloadTimeMs:-1};return t&&(a.status=t.status,this.loadPolicy.headersToLog&&(n=t.getAllResponseHeaders(),r=this.loadPolicy.headersToLog,a.headers=n.trim().split("\r\n").reduce((e,t)=>{let[i,n]=t.split(": ");if(i&&n){let t=i.toLowerCase();r.includes(t)&&(e[t]=n)}return e},{}))),i&&(a.downloadBitrateBps=i.bitrate,a.transferSize=i.size,a.downloadTimeMs=i.duration,console.log(`[XhrLoader] PerfObs download bitrate: ${a.downloadBitrateBps} bps, size: ${a.transferSize} bytes, duration: ${a.downloadTimeMs} ms`)),a}getDuration(e,t){return 0===t?-1:t-e}appendTraceIdToUrl(e){try{let t=new URL(e);return t.searchParams.set("traceId",`${this.loaderId}-${Array.from(Array(16)).map(()=>Math.floor(16*Math.random()).toString(16)).join("")}`),t.href}catch(t){return e}}}let W={retryDelay:500,maxRetries:6,maxLoadTimeMs:25e3,maxTimeToFirstByteMs:8e3,headersToLog:["akamai-request-bc","x-cdn-provider","x-ms-request-id","x-azure-ref","x-cache"],logSuccessHls:!0,logSuccessUms:!0};var G=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};class z{constructor(e,t){this.playerSettings=e,this.raiseTelemetry=t,this.eventName=null,this.context=null,this.events=[],this.requests=[],this.metrics=[],this.counter=0,this.telemetryReportsBetweenUploads=w(e,"telemetryReportsBetweenUploads",5)}addEvent(e){this.events.push(e)}addRequest(e){this.requests.push(e)}addPeriodicTelemetry(e,t,i){this.eventName=e,this.context=t,this.metrics.push(i),++this.counter>=this.telemetryReportsBetweenUploads&&(this.sendTelemetry(),this.counter=0)}sendFinalTelemetry(){this.eventName&&this.context&&(this.addEvent({Time:Date.now(),Event:"FinalTelemetry",Message:"Final telemetry report",Details:{}}),this.sendTelemetry())}sendTelemetry(){this.eventName&&this.context&&(this.raiseTelemetry(this.eventName,{Player_ConfigIds:this.context.configIds,Player_PlayerId:this.context.playerId,Player_HydraPlayerRuntimeVersion:this.context.hydraPlayerRuntimeVersion,Player_HydraPlayerSdkVersion:this.context.hydraPlayerSdkVersion,Player_StreamingEventType:this.context.streamingEventType,Player_HlsStreamVersion:this.context.hlsStreamVersion,Player_Events:JSON.stringify(this.events),Player_Requests:JSON.stringify(this.requests),Player_Metrics:JSON.stringify(z.packMetrics(this.metrics))}),this.events=[],this.requests=[],this.metrics=[])}static packMetrics(e){return e.reduce((e,t)=>("object"==typeof t&&null!==t&&Object.keys(t).forEach(i=>{e[i]||(e[i]=[]),e[i].push(t[i])}),e),{})}}var J,K,Q,Y,Z,X,ee,et,ei,en,er=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};function es(){return"4.25190.4"}class ea{constructor(e,t){this.playerSettings=e,this.eventHandler=t,this.spinner=null,this.telemetryReportHandler=null,this.playerRuntimeUrls=[],this.commandResultsMap=new Map,this.iframeCommunicationHandler=null,this.MAX_COMMAND_RESULTS_MAP_SIZE=1e4,this.playerSettings.telemetryAggregationSupported=!0,this.telemetryAggregator=new z(e,this.eventHandler.telemetry.bind(this.eventHandler)),this.playerInternalEventHandler=new E(this.telemetryAggregator)}dispose(){return er(this,void 0,void 0,function*(){var e;this.telemetryAggregator.sendFinalTelemetry(),null==(e=this.telemetryReportHandler)||e.addDisposeTelemetry(),this.isIFrameCommunicationActive()&&(yield this.callPlayerApi("disposeHydraPlayer"))})}release(){var e;null==(e=this.spinner)||e.hide(),this.contextWindow&&this.contextWindow.removeEventListener("message",this.onMessage.bind(this)),this.iframeCommunicationHandler&&(this.iframeCommunicationHandler.dispose(),this.iframeCommunicationHandler=null),this.iframe&&this.container&&this.container.hasChildNodes()&&this.container.removeChild(this.iframe)}setup(e){return er(this,void 0,void 0,function*(){var t;let i=Date.now();this.container=e;let n=null;try{if(this.spinner=new x(this.container),this.playerInternalEventHandler.setSpinner(this.spinner),(n=yield this.initializeIFrame()).isSuccess){let e={initSucceeded:!0,initStartTime:i,initDuration:Date.now()-i,runtimeDownloadResults:n.runtimeDownloadResults||[]};try{yield this.callPlayerApi("createHydraPlayer",this.playerSettings,e)}catch(t){if(this.eventHandler.log("warn",`Failed to create HydraPlayer: ${t}`),this.playerSettings.playerType===s.Hls)yield this.callPlayerApi("createHlsHydraPlayer",this.playerSettings,e);else{if(this.playerSettings.playerType!==s.Ums)throw Error("Cannot create Hydra player - Unknown player type");yield this.callPlayerApi("createUmsHydraPlayer",this.playerSettings,e)}}return this.onSetupCompleted(e),!0}throw Error(n.errorMsg)}catch(s){let e=P(s);this.eventHandler.log("error",`Failed to setup HydraPlayer: ${e}`);let r={initSucceeded:!1,initStartTime:i,initDuration:Date.now()-i,runtimeDownloadResults:(null==n?void 0:n.runtimeDownloadResults)||[],errorMsg:e};try{null==(t=this.spinner)||t.hide()}catch(e){this.eventHandler.log("error",`Failed to hide spinner: ${P(e)}`)}return this.onSetupCompleted(r),!1}})}onSetupCompleted(e){this.telemetryReportHandler=new N(this.playerSettings,this.eventHandler.log.bind(this.eventHandler),e,this.spinner),this.playerInternalEventHandler.setTelemetryReportHandler(this.telemetryReportHandler)}getFullTelemetryReport(){var e;return(null==(e=this.telemetryReportHandler)?void 0:e.getFullTelemetryReport())||{}}getSnapshotTelemetryReport(){var e;return(null==(e=this.telemetryReportHandler)?void 0:e.getSnapshotTelemetryReport())||{}}callPlayerApi(e,...t){return er(this,void 0,void 0,function*(){var i;if(!this.iframe)return yield Promise.reject(Error("Hydra IFrame not initialized yet"));let n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),r={msgType:l.Command,id:n,name:e,args:t};if(!this.isIFrameCommunicationActive())throw Error("IFrame MessageAPI communication not active");if(this.commandResultsMap.size>=this.MAX_COMMAND_RESULTS_MAP_SIZE)throw Error("Too many Hydra player API commands in progress - skipping this player API call");let s=L(),a={name:e,id:n};return this.commandResultsMap.set(a,s),null==(i=this.iframe.contentWindow)||i.postMessage(r,"*"),yield s.promise})}get contextWindow(){var e;return null==(e=this.container)?void 0:e.ownerDocument.defaultView}isIFrameCommunicationActive(){var e;return!!(null==(e=this.iframe)?void 0:e.contentWindow)&&!!this.contextWindow}getRuntimeUrls(e){if(!this.playerSettings.playerRuntimeJsUrls)return[];if(!Array.isArray(this.playerSettings.playerRuntimeJsUrls)){let t=function(e){let t=e.match(/^(\d+)\.\d+\.\d+(-.*)?$/);return t?t[1]:null}(e);return t&&this.playerSettings.playerRuntimeJsUrls[t]||[]}return this.playerSettings.playerRuntimeJsUrls}initializeIFrame(){return er(this,void 0,void 0,function*(){if(this.playerSettings.hydraPlayerSdkVersion="4.25190.4",this.playerRuntimeUrls=this.getRuntimeUrls(this.playerSettings.hydraPlayerSdkVersion),0===this.playerRuntimeUrls.length)return{isSuccess:!1,runtimeDownloadResults:[],errorMsg:`No compatible runtime URLs provided for HydraPlayer SDK version:
                    ${this.playerSettings.hydraPlayerSdkVersion}, URLs:
                    ${P(this.playerSettings.playerRuntimeJsUrls)}`};if(!this.container)return{isSuccess:!1,runtimeDownloadResults:[],errorMsg:"Embedding container HTML element of IFrame is not set"};let e=yield function(e,t,i){return G(this,void 0,void 0,function*(){let n=function(e,t){var i;let n=e.ownerDocument.createElement("iframe");return n.id="player-iframe",t||null==(i=n.sandbox)||i.add("allow-scripts"),n.allowFullscreen=!0,n.allow="camera; microphone; autoplay",n.style.height="100%",n.style.width="100%",n.style.border="none",n}(e,i.disableSandbox),r=[],a=function(e,t,i){var n;let r=null==(n=e.ecsSettings)?void 0:n.runtimeLoadPolicy;return void 0===r?i:"object"!=typeof i||Array.isArray(i)?typeof r==typeof i?r:i:Object.assign(Object.assign({},i),r)}(i,0,W),o=w(i,"useBlobSrcForIFrame",!1);return yield new Promise((l,c)=>{let d={onSuccess:(t,c)=>{let d={[s.Hls]:a.logSuccessHls,[s.Ums]:a.logSuccessUms};void 0!==i.playerType&&d[i.playerType.valueOf()]&&r.push(c);try{let s=function(e,t){let i="";return t?(function(e){if(!/^[A-Za-z0-9+/]*={0,2}$/.test(e))throw Error(`Invalid characters found in nonce: ${e}`)}(t),i=`<script nonce="${t}">${e}</script>`):i=`<script>${e}</script>`,`
        <html class style='height: 100%; width: 100%; overflow: hidden'>
        <head></head>
        <body class style='height: 100%; width: 100%; margin: 0px'>
            ${i}
        </body>
        </html>
    `}(t,i.nonce);(function(e,t,i,n,r){return G(this,void 0,void 0,function*(){if(r){let e=new Blob([i],{type:"text/html"});t.src=URL.createObjectURL(e)}else t.srcdoc=i;e.appendChild(t),yield new Promise((e,i)=>{let r=self.setTimeout(()=>{i(Error("Iframe load timed out"))},n.maxLoadTimeMs);t.onload=t=>{clearTimeout(r),e()},t.onerror=e=>{clearTimeout(r),i(e)}})})})(e,n,s,a,o).then(()=>{console.log("Iframe loaded successfully"),l({iframe:n,initResult:{isSuccess:!0,runtimeDownloadResults:r}})}).catch(e=>{l({initResult:{isSuccess:!1,runtimeDownloadResults:r,errorMsg:`Failed to load iframe src: ${P(e)}`}})})}catch(e){l({initResult:{isSuccess:!1,runtimeDownloadResults:r,errorMsg:`Failed after successful runtime load: ${P(e)}`}})}},onError:e=>{r.push(e),l({initResult:{isSuccess:!1,runtimeDownloadResults:r,errorMsg:"Failed to load Hydra player runtime scripts"}})},onRetry:e=>{r.push(e)}};new q(t,a,d).load()})})}(this.container,this.playerRuntimeUrls,this.playerSettings);return e.initResult.isSuccess&&e.iframe&&(this.iframe=e.iframe,this.iframeCommunicationHandler=new V(this.iframe,this.playerSettings,this.eventHandler.log),this.contextWindow.addEventListener("message",this.onMessage.bind(this))),e.initResult})}onMessage(e){switch(e.data.msgType){case l.PlayerEvent:this.processPlayerEvent(e.data);break;case l.InternalPlayerEvent:this.processInternalPlayerEvent(e.data);break;case l.CommandSuccessResult:this.processCommandSuccessResult(e.data);break;case l.CommandFailureResult:this.processCommandFailureResult(e.data)}}processCommandSuccessResult(e){this.eventHandler.log("debug",`HydraPlayer command succeeded for ${e.name} - result: ${P(e.result)}`),this.getMapCommandResults(e).forEach(t=>{t[1].resolve(e.result),this.commandResultsMap.delete(t[0])})}processCommandFailureResult(e){this.eventHandler.log("debug",`HydraPlayer command failed for ${e.name} - error: ${e.error.message}`),this.getMapCommandResults(e).forEach(t=>{t[1].reject(e.error),this.commandResultsMap.delete(t[0])})}getMapCommandResults(e){let t=Array.from(this.commandResultsMap.entries()),i=[];return e.id?i=t.filter(([t])=>t.id===e.id):e.name&&(i=t.filter(([t])=>t.name===e.name)),i}processPlayerEvent(e){var t;null==(t=this.eventHandler[e.name])||t.apply(this.eventHandler,e.args)}processInternalPlayerEvent(e){this.playerInternalEventHandler&&this.playerInternalEventHandler[e.name]&&this.playerInternalEventHandler[e.name].apply(this,e.args)}}return function(e){e.Live="Live",e.Fallback="Fallback",e.EndOfStream="EndOfStream",e.Dvr="DVR"}(J||(J={})),function(e){e.TLE="TLE",e.Overflow="Overflow",e.TownHallBasic="TownHall_Basic",e.TownHallPremium="TownHall_Premium",e.TownHall="TownHall"}(K||(K={})),function(e){e.AMS="AMS",e.HLS="MiddleLaneHttpLiveStreaming",e.Ums="MiddleLaneUltraLowLatency"}(Q||(Q={})),function(e){e.MultiplePlayerLoad="MultiplePlayerLoad",e.PlayerInitializationFailed="PlayerInitializationFailed",e.InvalidStream="InvalidStream",e.SetSourceFailed="SetSourceFailed"}(Y||(Y={})),function(e){e.LoadStart="loadstart",e.LoadedData="loadeddata",e.LoadedMetadata="loadedmetadata",e.Start="start",e.CanPlayThrough="canplaythrough",e.Play="play",e.Playing="playing",e.Pause="pause",e.Waiting="waiting",e.Seeking="seeking",e.Seeked="seeked",e.Ended="ended",e.Destroyed="destroyed",e.Error="error",e.Initialized="initialized",e.Stalled="stalled",e.VolumeChange="volumechange",e.PlaybackBitrateChanged="playbackbitratechanged",e.DownloadBitrateChanged="downloadbitratechanged",e.TimeUpdate="timeupdate",e.DurationChange="durationchange",e.HlsKeyLoading="hlsKeyLoading",e.HlsKeyLoaded="hlsKeyLoaded",e.HlsKeyLoadedFailed="hlsKeyLoadedFailed",e.HlsManifestLoading="hlsManifestLoading",e.HlsManifestLoaded="hlsManifestLoaded",e.HlsManifestLoadedFailed="hlsManifestLoadedFailed",e.HlsFirstFragmentLoading="hlsFragLoading",e.HlsFirstFragmentBuffered="hlsFragBuffered",e.HlsFirstFragmentLoadFailed="hlsFirstFragmentLoadFailed",e.HlsFragmentChanged="hlsFragmentChanged",e.Online="online",e.Offline="offline",e.NetworkChange="networkChange"}(Z||(Z={})),function(e){e.UnsupportedPlatform="UnsupportedPlatform",e.NetworkError="NetworkError",e.PlaybackRetried="PlaybackRetried",e.PlaybackError="PlaybackError",e.Unknown="Unknown",e.MediaTimeout="MediaTimeout",e.NoMediaFlow="NoMediaFlow"}(X||(X={})),function(e){e[e.Hls=1]="Hls",e[e.Ums=2]="Ums"}(ee||(ee={})),function(e){e.RequestIceCandidates="RequestIceCandidates"}(et||(et={})),function(e){e.Unknown="Unknown",e.ClientNetwork="ClientNetwork",e.ClientNetworkOrUnreachableServer="ClientNetworkOrUnreachableServer",e.ServerNetwork="ServerNetwork",e.ClientAuthIssue="ClientAuthIssue",e.ServerResourceNotFound="ServerResourceNotFound"}(ei||(ei={})),function(e){e.audio="Audio",e.video="Video",e.text="Text"}(en||(en={})),T}()})}}),eN=eI({"../node_modules/pako/lib/utils/common.js"(e){"use strict";var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,n,r){if(t.subarray&&e.subarray)return void e.set(t.subarray(i,i+n),r);for(var s=0;s<n;s++)e[r+s]=t[i+s]},flattenChunks:function(e){var t,i,n,r,s,a;for(t=0,n=0,i=e.length;t<i;t++)n+=e[t].length;for(t=0,a=new Uint8Array(n),r=0,i=e.length;t<i;t++)s=e[t],a.set(s,r),r+=s.length;return a}},r={arraySet:function(e,t,i,n,r){for(var s=0;s<n;s++)e[r+s]=t[i+s]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(t)}}),ex=eI({"../node_modules/pako/lib/zlib/trees.js"(e){"use strict";var t,i,n,r=eN(),s=4,a=0,o=1,l=2;function c(e){for(var t=e.length;--t>=0;)e[t]=0}var d=0,u=1,h=2,g=3,p=258,f=29,m=256,v=286,S=30,y=19,C=573,b=15,T=16,E=7,_=256,I=16,w=17,P=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=512,k=Array(576);c(k);var N=Array(2*S);c(N);var x=Array(O);c(x);var L=Array(p-g+1);c(L);var F=Array(f);c(F);var U=Array(S);function $(e,t,i,n,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=e&&e.length}function V(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function B(e){return e<256?x[e]:x[256+(e>>>7)]}function H(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function j(e,t,i){e.bi_valid>T-i?(e.bi_buf|=t<<e.bi_valid&65535,H(e,e.bi_buf),e.bi_buf=t>>T-e.bi_valid,e.bi_valid+=i-T):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function q(e,t,i){j(e,i[2*t],i[2*t+1])}function W(e,t){var i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1}function G(e){16===e.bi_valid?(H(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function z(e,t){var i,n,r,s,a,o,l=t.dyn_tree,c=t.max_code,d=t.stat_desc.static_tree,u=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,p=t.stat_desc.max_length,f=0;for(s=0;s<=b;s++)e.bl_count[s]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<C;i++)(s=l[2*l[2*(n=e.heap[i])+1]+1]+1)>p&&(s=p,f++),l[2*n+1]=s,!(n>c)&&(e.bl_count[s]++,a=0,n>=g&&(a=h[n-g]),o=l[2*n],e.opt_len+=o*(s+a),u&&(e.static_len+=o*(d[2*n+1]+a)));if(0!==f){do{for(s=p-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[p]--,f-=2}while(f>0);for(s=p;0!==s;s--)for(n=e.bl_count[s];0!==n;)!((r=e.heap[--i])>c)&&(l[2*r+1]!==s&&(e.opt_len+=(s-l[2*r+1])*l[2*r],l[2*r+1]=s),n--)}}function J(e,t,i){var n,r,s=Array(b+1),a=0;for(n=1;n<=b;n++)s[n]=a=a+i[n-1]<<1;for(r=0;r<=t;r++){var o=e[2*r+1];0!==o&&(e[2*r]=W(s[o]++,o))}}function K(){var e,r,s,a,o,l=Array(b+1);for(a=0,s=0;a<f-1;a++)for(e=0,F[a]=s;e<1<<R[a];e++)L[s++]=a;for(L[s-1]=a,o=0,a=0;a<16;a++)for(e=0,U[a]=o;e<1<<A[a];e++)x[o++]=a;for(o>>=7;a<S;a++)for(e=0,U[a]=o<<7;e<1<<A[a]-7;e++)x[256+o++]=a;for(r=0;r<=b;r++)l[r]=0;for(e=0;e<=143;)k[2*e+1]=8,e++,l[8]++;for(;e<=255;)k[2*e+1]=9,e++,l[9]++;for(;e<=279;)k[2*e+1]=7,e++,l[7]++;for(;e<=287;)k[2*e+1]=8,e++,l[8]++;for(J(k,v+1,l),e=0;e<S;e++)N[2*e+1]=5,N[2*e]=W(e,5);t=new $(k,R,m+1,v,b),i=new $(N,A,0,S,b),n=new $([],M,0,y,E)}function Q(e){var t;for(t=0;t<v;t++)e.dyn_ltree[2*t]=0;for(t=0;t<S;t++)e.dyn_dtree[2*t]=0;for(t=0;t<y;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*_]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Y(e){e.bi_valid>8?H(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Z(e,t,i,n){Y(e),n&&(H(e,i),H(e,~i)),r.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}function X(e,t,i,n){var r=2*t,s=2*i;return e[r]<e[s]||e[r]===e[s]&&n[t]<=n[i]}function ee(e,t,i){for(var n=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&X(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!X(t,n,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=n}function et(e,t,i){var n,r,s,a,o=0;if(0!==e.last_lit)do n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],r=e.pending_buf[e.l_buf+o],o++,0===n?q(e,r,t):(q(e,(s=L[r])+m+1,t),0!==(a=R[s])&&j(e,r-=F[s],a),q(e,s=B(--n),i),0!==(a=A[s])&&j(e,n-=U[s],a));while(o<e.last_lit);q(e,_,t)}function ei(e,t){var i,n,r,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(i=0,e.heap_len=0,e.heap_max=C;i<l;i++)0!==s[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):s[2*i+1]=0;for(;e.heap_len<2;)s[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,o&&(e.static_len-=a[2*r+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)ee(e,s,i);r=l;do i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ee(e,s,1),n=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=n,s[2*r]=s[2*i]+s[2*n],e.depth[r]=(e.depth[i]>=e.depth[n]?e.depth[i]:e.depth[n])+1,s[2*i+1]=s[2*n+1]=r,e.heap[1]=r++,ee(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],z(e,t),J(s,c,e.bl_count)}function en(e,t,i){var n,r,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),t[(i+1)*2+1]=65535,n=0;n<=i;n++)r=a,a=t[(n+1)*2+1],++o<l&&r===a||(o<c?e.bl_tree[2*r]+=o:0!==r?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[2*I]++):o<=10?e.bl_tree[2*w]++:e.bl_tree[2*P]++,o=0,s=r,0===a?(l=138,c=3):r===a?(l=6,c=3):(l=7,c=4))}function er(e,t,i){var n,r,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),n=0;n<=i;n++)if(r=a,a=t[(n+1)*2+1],!(++o<l)||r!==a){if(o<c)do q(e,r,e.bl_tree);while(0!=--o);else 0!==r?(r!==s&&(q(e,r,e.bl_tree),o--),q(e,I,e.bl_tree),j(e,o-3,2)):o<=10?(q(e,w,e.bl_tree),j(e,o-3,3)):(q(e,P,e.bl_tree),j(e,o-11,7));o=0,s=r,0===a?(l=138,c=3):r===a?(l=6,c=3):(l=7,c=4)}}function es(e){var t;for(en(e,e.dyn_ltree,e.l_desc.max_code),en(e,e.dyn_dtree,e.d_desc.max_code),ei(e,e.bl_desc),t=y-1;t>=3&&0===e.bl_tree[2*D[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function ea(e,t,i,n){var r;for(j(e,t-257,5),j(e,i-1,5),j(e,n-4,4),r=0;r<n;r++)j(e,e.bl_tree[2*D[r]+1],3);er(e,e.dyn_ltree,t-1),er(e,e.dyn_dtree,i-1)}function eo(e){var t,i=0xf3ffc07f;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<m;t++)if(0!==e.dyn_ltree[2*t])return o;return a}c(U);var el=!1;function ec(e,t,i,n){j(e,(d<<1)+ +!!n,3),Z(e,t,i,!0)}function ed(e){j(e,u<<1,3),q(e,_,k),G(e)}function eu(e,t,i,n){var r,a,o=0;e.level>0?(e.strm.data_type===l&&(e.strm.data_type=eo(e)),ei(e,e.l_desc),ei(e,e.d_desc),o=es(e),r=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==t?ec(e,t,i,n):e.strategy===s||a===r?(j(e,(u<<1)+ +!!n,3),et(e,k,N)):(j(e,(h<<1)+ +!!n,3),ea(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),et(e,e.dyn_ltree,e.dyn_dtree)),Q(e),n&&Y(e)}function eh(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[(L[i]+m+1)*2]++,e.dyn_dtree[2*B(t)]++),e.last_lit===e.lit_bufsize-1}e._tr_init=function(e){el||(K(),el=!0),e.l_desc=new V(e.dyn_ltree,t),e.d_desc=new V(e.dyn_dtree,i),e.bl_desc=new V(e.bl_tree,n),e.bi_buf=0,e.bi_valid=0,Q(e)},e._tr_stored_block=ec,e._tr_flush_block=eu,e._tr_tally=eh,e._tr_align=ed}}),eL=eI({"../node_modules/pako/lib/zlib/adler32.js"(e,t){"use strict";t.exports=function(e,t,i,n){for(var r=65535&e,s=e>>>16&65535,a=0;0!==i;){a=i>2e3?2e3:i,i-=a;do s=s+(r=r+t[n++]|0)|0;while(--a);r%=65521,s%=65521}return r|s<<16}}}),eF=eI({"../node_modules/pako/lib/zlib/crc32.js"(e,t){"use strict";var i=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?0xedb88320^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,n,r){var s=i,a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^s[(e^t[o])&255];return -1^e}}}),eU=eI({"../node_modules/pako/lib/zlib/messages.js"(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}}),e$=eI({"../node_modules/pako/lib/zlib/deflate.js"(e){"use strict";var t,i=eN(),n=ex(),r=eL(),s=eF(),a=eU(),o=0,l=1,c=3,d=4,u=5,h=0,g=1,p=-2,f=-3,m=-5,v=-1,S=1,y=2,C=3,b=4,T=0,E=2,_=8,I=9,w=15,P=8,R=286,A=30,M=19,D=573,O=15,k=3,N=258,x=262,L=32,F=42,U=69,$=73,V=91,B=103,H=113,j=666,q=1,W=2,G=3,z=4,J=3;function K(e,t){return e.msg=a[t],t}function Q(e){return(e<<1)-9*(e>4)}function Y(e){for(var t=e.length;--t>=0;)e[t]=0}function Z(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function X(e,t){n._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Z(e.strm)}function ee(e,t){e.pending_buf[e.pending++]=t}function et(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ei(e,t,n,a){var o=e.avail_in;return(o>a&&(o=a),0===o)?0:(e.avail_in-=o,i.arraySet(t,e.input,e.next_in,o,n),1===e.state.wrap?e.adler=r(e.adler,t,o,n):2===e.state.wrap&&(e.adler=s(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)}function en(e,t){var i,n,r=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-x?e.strstart-(e.w_size-x):0,c=e.window,d=e.w_mask,u=e.prev,h=e.strstart+N,g=c[s+a-1],p=c[s+a];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(i=t)+a]!==p||c[i+a-1]!==g||c[i]!==c[s]||c[++i]!==c[s+1])continue;s+=2,i++;do;while(c[++s]===c[++i]&&c[++s]===c[++i]&&c[++s]===c[++i]&&c[++s]===c[++i]&&c[++s]===c[++i]&&c[++s]===c[++i]&&c[++s]===c[++i]&&c[++s]===c[++i]&&s<h);if(n=N-(h-s),s=h-N,n>a){if(e.match_start=t,a=n,n>=o)break;g=c[s+a-1],p=c[s+a]}}while((t=u[t&d])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead}function er(e){var t,n,r,s,a,o=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-x)){i.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=n=e.hash_size;do r=e.head[--t],e.head[t]=r>=o?r-o:0;while(--n);t=n=o;do r=e.prev[--t],e.prev[t]=r>=o?r-o:0;while(--n);s+=o}if(0===e.strm.avail_in)break;if(n=ei(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=k)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+k-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<k)););}while(e.lookahead<x&&0!==e.strm.avail_in)}function es(e,t){for(var i,r;;){if(e.lookahead<x){if(er(e),e.lookahead<x&&t===o)return q;if(0===e.lookahead)break}if(i=0,e.lookahead>=k&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-x&&(e.match_length=en(e,i)),e.match_length>=k)if(r=n._tr_tally(e,e.strstart-e.match_start,e.match_length-k),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=k){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(X(e,!1),0===e.strm.avail_out))return q}return(e.insert=e.strstart<k-1?e.strstart:k-1,t===d)?(X(e,!0),0===e.strm.avail_out)?G:z:e.last_lit&&(X(e,!1),0===e.strm.avail_out)?q:W}function ea(e,t){for(var i,r,s;;){if(e.lookahead<x){if(er(e),e.lookahead<x&&t===o)return q;if(0===e.lookahead)break}if(i=0,e.lookahead>=k&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=k-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-x&&(e.match_length=en(e,i),e.match_length<=5&&(e.strategy===S||e.match_length===k&&e.strstart-e.match_start>4096)&&(e.match_length=k-1)),e.prev_length>=k&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-k,r=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-k),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=k-1,e.strstart++,r&&(X(e,!1),0===e.strm.avail_out))return q}else if(e.match_available){if((r=n._tr_tally(e,0,e.window[e.strstart-1]))&&X(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return q}else e.match_available=1,e.strstart++,e.lookahead--}return(e.match_available&&(r=n._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<k-1?e.strstart:k-1,t===d)?(X(e,!0),0===e.strm.avail_out)?G:z:e.last_lit&&(X(e,!1),0===e.strm.avail_out)?q:W}function eo(e,t){for(var i,r,s,a,l=e.window;;){if(e.lookahead<=N){if(er(e),e.lookahead<=N&&t===o)return q;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=k&&e.strstart>0&&(r=l[s=e.strstart-1])===l[++s]&&r===l[++s]&&r===l[++s]){a=e.strstart+N;do;while(r===l[++s]&&r===l[++s]&&r===l[++s]&&r===l[++s]&&r===l[++s]&&r===l[++s]&&r===l[++s]&&r===l[++s]&&s<a);e.match_length=N-(a-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=k?(i=n._tr_tally(e,1,e.match_length-k),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(X(e,!1),0===e.strm.avail_out))return q}return(e.insert=0,t===d)?(X(e,!0),0===e.strm.avail_out)?G:z:e.last_lit&&(X(e,!1),0===e.strm.avail_out)?q:W}function el(e,t){for(var i;;){if(0===e.lookahead&&(er(e),0===e.lookahead)){if(t===o)return q;break}if(e.match_length=0,i=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(X(e,!1),0===e.strm.avail_out))return q}return(e.insert=0,t===d)?(X(e,!0),0===e.strm.avail_out)?G:z:e.last_lit&&(X(e,!1),0===e.strm.avail_out)?q:W}function ec(e,t,i,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=r}function ed(e){e.window_size=2*e.w_size,Y(e.head),e.max_lazy_match=t[e.level].max_lazy,e.good_match=t[e.level].good_length,e.nice_match=t[e.level].nice_length,e.max_chain_length=t[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=k-1,e.match_available=0,e.ins_h=0}function eu(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*D),this.dyn_dtree=new i.Buf16((2*A+1)*2),this.bl_tree=new i.Buf16((2*M+1)*2),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(O+1),this.heap=new i.Buf16(2*R+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*R+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function eh(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=E,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?F:H,e.adler=+(2!==t.wrap),t.last_flush=o,n._tr_init(t),h):K(e,p)}function eg(e){var t=eh(e);return t===h&&ed(e.state),t}function ep(e,t){return e&&e.state&&2===e.state.wrap?(e.state.gzhead=t,h):p}function ef(e,t,n,r,s,a){if(!e)return p;var o=1;if(t===v&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>I||n!==_||r<8||r>15||t<0||t>9||a<0||a>b)return K(e,p);8===r&&(r=9);var l=new eu;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+k-1)/k),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=+l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,eg(e)}function em(e,i){if(!e||!e.state||i>u||i<0)return e?K(e,p):p;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===j&&i!==d)return K(e,0===e.avail_out?m:p);if(a.strm=e,r=a.last_flush,a.last_flush=i,a.status===F)if(2===a.wrap)e.adler=0,ee(a,31),ee(a,139),ee(a,8),a.gzhead?(ee(a,+!!a.gzhead.text+2*!!a.gzhead.hcrc+4*!!a.gzhead.extra+8*!!a.gzhead.name+16*!!a.gzhead.comment),ee(a,255&a.gzhead.time),ee(a,a.gzhead.time>>8&255),ee(a,a.gzhead.time>>16&255),ee(a,a.gzhead.time>>24&255),ee(a,9===a.level?2:4*(a.strategy>=y||a.level<2)),ee(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(ee(a,255&a.gzhead.extra.length),ee(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=s(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=U):(ee(a,0),ee(a,0),ee(a,0),ee(a,0),ee(a,0),ee(a,9===a.level?2:4*(a.strategy>=y||a.level<2)),ee(a,J),a.status=H);else{var r,a,f,v,S=_+(a.w_bits-8<<4)<<8,b=-1;S|=(b=a.strategy>=y||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(S|=L),S+=31-S%31,a.status=H,et(a,S),0!==a.strstart&&(et(a,e.adler>>>16),et(a,65535&e.adler)),e.adler=1}if(a.status===U)if(a.gzhead.extra){for(f=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>f&&(e.adler=s(e.adler,a.pending_buf,a.pending-f,f)),Z(e),f=a.pending,a.pending!==a.pending_buf_size));)ee(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>f&&(e.adler=s(e.adler,a.pending_buf,a.pending-f,f)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=$)}else a.status=$;if(a.status===$)if(a.gzhead.name){f=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>f&&(e.adler=s(e.adler,a.pending_buf,a.pending-f,f)),Z(e),f=a.pending,a.pending===a.pending_buf_size)){v=1;break}v=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,ee(a,v)}while(0!==v);a.gzhead.hcrc&&a.pending>f&&(e.adler=s(e.adler,a.pending_buf,a.pending-f,f)),0===v&&(a.gzindex=0,a.status=V)}else a.status=V;if(a.status===V)if(a.gzhead.comment){f=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>f&&(e.adler=s(e.adler,a.pending_buf,a.pending-f,f)),Z(e),f=a.pending,a.pending===a.pending_buf_size)){v=1;break}v=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,ee(a,v)}while(0!==v);a.gzhead.hcrc&&a.pending>f&&(e.adler=s(e.adler,a.pending_buf,a.pending-f,f)),0===v&&(a.status=B)}else a.status=B;if(a.status===B&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&Z(e),a.pending+2<=a.pending_buf_size&&(ee(a,255&e.adler),ee(a,e.adler>>8&255),e.adler=0,a.status=H)):a.status=H),0!==a.pending){if(Z(e),0===e.avail_out)return a.last_flush=-1,h}else if(0===e.avail_in&&Q(i)<=Q(r)&&i!==d)return K(e,m);if(a.status===j&&0!==e.avail_in)return K(e,m);if(0!==e.avail_in||0!==a.lookahead||i!==o&&a.status!==j){var T=a.strategy===y?el(a,i):a.strategy===C?eo(a,i):t[a.level].func(a,i);if((T===G||T===z)&&(a.status=j),T===q||T===G)return 0===e.avail_out&&(a.last_flush=-1),h;if(T===W&&(i===l?n._tr_align(a):i!==u&&(n._tr_stored_block(a,0,0,!1),i===c&&(Y(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),Z(e),0===e.avail_out))return a.last_flush=-1,h}return i!==d?h:a.wrap<=0?g:(2===a.wrap?(ee(a,255&e.adler),ee(a,e.adler>>8&255),ee(a,e.adler>>16&255),ee(a,e.adler>>24&255),ee(a,255&e.total_in),ee(a,e.total_in>>8&255),ee(a,e.total_in>>16&255),ee(a,e.total_in>>24&255)):(et(a,e.adler>>>16),et(a,65535&e.adler)),Z(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?h:g)}function ev(e){var t;return e&&e.state?(t=e.state.status)!==F&&t!==U&&t!==$&&t!==V&&t!==B&&t!==H&&t!==j?K(e,p):(e.state=null,t===H?K(e,f):h):p}function eS(e,t){var n,s,a,o,l,c,d,u,g=t.length;if(!e||!e.state||2===(o=(n=e.state).wrap)||1===o&&n.status!==F||n.lookahead)return p;for(1===o&&(e.adler=r(e.adler,t,g,0)),n.wrap=0,g>=n.w_size&&(0===o&&(Y(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new i.Buf8(n.w_size),i.arraySet(u,t,g-n.w_size,n.w_size,0),t=u,g=n.w_size),l=e.avail_in,c=e.next_in,d=e.input,e.avail_in=g,e.next_in=0,e.input=t,er(n);n.lookahead>=k;){s=n.strstart,a=n.lookahead-(k-1);do n.ins_h=(n.ins_h<<n.hash_shift^n.window[s+k-1])&n.hash_mask,n.prev[s&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=s,s++;while(--a);n.strstart=s,n.lookahead=k-1,er(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=k-1,n.match_available=0,e.next_in=c,e.input=d,e.avail_in=l,n.wrap=o,h}t=[new ec(0,0,0,0,function(e,t){var i=65535;for(65535>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(er(e),0===e.lookahead&&t===o)return q;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,X(e,!1),0===e.strm.avail_out)||e.strstart-e.block_start>=e.w_size-x&&(X(e,!1),0===e.strm.avail_out))return q}return(e.insert=0,t===d)?(X(e,!0),0===e.strm.avail_out)?G:z:(e.strstart>e.block_start&&(X(e,!1),e.strm.avail_out),q)}),new ec(4,4,8,4,es),new ec(4,5,16,8,es),new ec(4,6,32,32,es),new ec(4,4,16,16,ea),new ec(8,16,32,32,ea),new ec(8,16,128,128,ea),new ec(8,32,128,256,ea),new ec(32,128,258,1024,ea),new ec(32,258,258,4096,ea)],e.deflateInit=function(e,t){return ef(e,t,_,w,P,T)},e.deflateInit2=ef,e.deflateReset=eg,e.deflateResetKeep=eh,e.deflateSetHeader=ep,e.deflate=em,e.deflateEnd=ev,e.deflateSetDictionary=eS,e.deflateInfo="pako deflate (from Nodeca project)"}}),eV=eI({"../node_modules/pako/lib/utils/strings.js"(e){"use strict";var t,i=eN(),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}var s=new i.Buf8(256);for(t=0;t<256;t++)s[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;function a(e,t){if(t<65534&&(e.subarray&&r||!e.subarray&&n))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var s="",a=0;a<t;a++)s+=String.fromCharCode(e[a]);return s}s[254]=s[254]=1,e.string2buf=function(e){var t,n,r,s,a,o=e.length,l=0;for(s=0;s<o;s++)(64512&(n=e.charCodeAt(s)))==55296&&s+1<o&&(64512&(r=e.charCodeAt(s+1)))==56320&&(n=65536+(n-55296<<10)+(r-56320),s++),l+=n<128?1:n<2048?2:n<65536?3:4;for(a=0,t=new i.Buf8(l),s=0;a<l;s++)(64512&(n=e.charCodeAt(s)))==55296&&s+1<o&&(64512&(r=e.charCodeAt(s+1)))==56320&&(n=65536+(n-55296<<10)+(r-56320),s++),n<128?t[a++]=n:(n<2048?t[a++]=192|n>>>6:(n<65536?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t},e.buf2binstring=function(e){return a(e,e.length)},e.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},e.buf2string=function(e,t){var i,n,r,o,l=t||e.length,c=Array(2*l);for(n=0,i=0;i<l;){if((r=e[i++])<128){c[n++]=r;continue}if((o=s[r])>4){c[n++]=65533,i+=o-1;continue}for(r&=2===o?31:3===o?15:7;o>1&&i<l;)r=r<<6|63&e[i++],o--;if(o>1){c[n++]=65533;continue}r<65536?c[n++]=r:(r-=65536,c[n++]=55296|r>>10&1023,c[n++]=56320|1023&r)}return a(c,n)},e.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&(192&e[i])==128;)i--;return i<0||0===i?t:i+s[e[i]]>t?i:t}}}),eB=eI({"../node_modules/pako/lib/zlib/zstream.js"(e,t){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}}),eH=eI({"../node_modules/pako/lib/deflate.js"(e){"use strict";var t=e$(),i=eN(),n=eV(),r=eU(),s=eB(),a=Object.prototype.toString,o=0,l=4,c=0,d=1,u=2,h=-1,g=0,p=8;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({level:h,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},e||{});var o,l=this.options;l.raw&&l.windowBits>0?l.windowBits=-l.windowBits:l.gzip&&l.windowBits>0&&l.windowBits<16&&(l.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var d=t.deflateInit2(this.strm,l.level,l.method,l.windowBits,l.memLevel,l.strategy);if(d!==c)throw Error(r[d]);if(l.header&&t.deflateSetHeader(this.strm,l.header),l.dictionary){if(o="string"==typeof l.dictionary?n.string2buf(l.dictionary):"[object ArrayBuffer]"===a.call(l.dictionary)?new Uint8Array(l.dictionary):l.dictionary,(d=t.deflateSetDictionary(this.strm,o))!==c)throw Error(r[d]);this._dict_set=!0}}function m(e,t){var i=new f(t);if(i.push(e,!0),i.err)throw i.msg||r[i.err];return i.result}function v(e,t){return(t=t||{}).raw=!0,m(e,t)}function S(e,t){return(t=t||{}).gzip=!0,m(e,t)}f.prototype.push=function(e,r){var s,h,g=this.strm,p=this.options.chunkSize;if(this.ended)return!1;h=r===~~r?r:!0===r?l:o,"string"==typeof e?g.input=n.string2buf(e):"[object ArrayBuffer]"===a.call(e)?g.input=new Uint8Array(e):g.input=e,g.next_in=0,g.avail_in=g.input.length;do{if(0===g.avail_out&&(g.output=new i.Buf8(p),g.next_out=0,g.avail_out=p),(s=t.deflate(g,h))!==d&&s!==c)return this.onEnd(s),this.ended=!0,!1;(0===g.avail_out||0===g.avail_in&&(h===l||h===u))&&("string"===this.options.to?this.onData(n.buf2binstring(i.shrinkBuf(g.output,g.next_out))):this.onData(i.shrinkBuf(g.output,g.next_out)))}while((g.avail_in>0||0===g.avail_out)&&s!==d);return h===l?(s=t.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===c):(h===u&&(this.onEnd(c),g.avail_out=0),!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.Deflate=f,e.deflate=m,e.deflateRaw=v,e.gzip=S}}),ej=eI({"../node_modules/pako/lib/zlib/inffast.js"(e,t){"use strict";var i=30,n=12;t.exports=function(e,t){var r,s,a,o,l,c,d,u,h,g,p,f,m,v,S,y,C,b,T,E,_,I,w,P,R;r=e.state,s=e.next_in,P=e.input,a=s+(e.avail_in-5),o=e.next_out,R=e.output,l=o-(t-e.avail_out),c=o+(e.avail_out-257),d=r.dmax,u=r.wsize,h=r.whave,g=r.wnext,p=r.window,f=r.hold,m=r.bits,v=r.lencode,S=r.distcode,y=(1<<r.lenbits)-1,C=(1<<r.distbits)-1;e:do for(m<15&&(f+=P[s++]<<m,m+=8,f+=P[s++]<<m,m+=8),b=v[f&y];;){if(f>>>=T=b>>>24,m-=T,0==(T=b>>>16&255))R[o++]=65535&b;else if(16&T)for(E=65535&b,(T&=15)&&(m<T&&(f+=P[s++]<<m,m+=8),E+=f&(1<<T)-1,f>>>=T,m-=T),m<15&&(f+=P[s++]<<m,m+=8,f+=P[s++]<<m,m+=8),b=S[f&C];;){if(f>>>=T=b>>>24,m-=T,16&(T=b>>>16&255)){if(_=65535&b,m<(T&=15)&&(f+=P[s++]<<m,(m+=8)<T&&(f+=P[s++]<<m,m+=8)),(_+=f&(1<<T)-1)>d){e.msg="invalid distance too far back",r.mode=i;break e}if(f>>>=T,m-=T,_>(T=o-l)){if((T=_-T)>h&&r.sane){e.msg="invalid distance too far back",r.mode=i;break e}if(I=0,w=p,0===g){if(I+=u-T,T<E){E-=T;do R[o++]=p[I++];while(--T);I=o-_,w=R}}else if(g<T){if(I+=u+g-T,(T-=g)<E){E-=T;do R[o++]=p[I++];while(--T);if(I=0,g<E){E-=T=g;do R[o++]=p[I++];while(--T);I=o-_,w=R}}}else if(I+=g-T,T<E){E-=T;do R[o++]=p[I++];while(--T);I=o-_,w=R}for(;E>2;)R[o++]=w[I++],R[o++]=w[I++],R[o++]=w[I++],E-=3;E&&(R[o++]=w[I++],E>1&&(R[o++]=w[I++]))}else{I=o-_;do R[o++]=R[I++],R[o++]=R[I++],R[o++]=R[I++],E-=3;while(E>2);E&&(R[o++]=R[I++],E>1&&(R[o++]=R[I++]))}}else if((64&T)==0){b=S[(65535&b)+(f&(1<<T)-1)];continue}else{e.msg="invalid distance code",r.mode=i;break e}break}else if((64&T)==0){b=v[(65535&b)+(f&(1<<T)-1)];continue}else if(32&T){r.mode=n;break e}else{e.msg="invalid literal/length code",r.mode=i;break e}break}while(s<a&&o<c);s-=E=m>>3,m-=E<<3,f&=(1<<m)-1,e.next_in=s,e.next_out=o,e.avail_in=s<a?5+(a-s):5-(s-a),e.avail_out=o<c?257+(c-o):257-(o-c),r.hold=f,r.bits=m}}}),eq=eI({"../node_modules/pako/lib/zlib/inftrees.js"(e,t){"use strict";var i=eN(),n=15,r=852,s=592,a=0,o=1,l=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,g,p,f,m,v,S){var y,C,b,T,E,_,I,w,P,R=S.bits,A=0,M=0,D=0,O=0,k=0,N=0,x=0,L=0,F=0,U=0,$=null,V=0,B=new i.Buf16(n+1),H=new i.Buf16(n+1),j=null,q=0;for(A=0;A<=n;A++)B[A]=0;for(M=0;M<p;M++)B[t[g+M]]++;for(k=R,O=n;O>=1&&0===B[O];O--);if(k>O&&(k=O),0===O)return f[m++]=0x1400000,f[m++]=0x1400000,S.bits=1,0;for(D=1;D<O&&0===B[D];D++);for(k<D&&(k=D),L=1,A=1;A<=n;A++)if(L<<=1,(L-=B[A])<0)return -1;if(L>0&&(e===a||1!==O))return -1;for(A=1,H[1]=0;A<n;A++)H[A+1]=H[A]+B[A];for(M=0;M<p;M++)0!==t[g+M]&&(v[H[t[g+M]]++]=M);if(e===a?($=j=v,_=19):e===o?($=c,V-=257,j=d,q-=257,_=256):($=u,j=h,_=-1),U=0,M=0,A=D,E=m,N=k,x=0,b=-1,T=(F=1<<k)-1,e===o&&F>r||e===l&&F>s)return 1;for(;;){I=A-x,v[M]<_?(w=0,P=v[M]):v[M]>_?(w=j[q+v[M]],P=$[V+v[M]]):(w=96,P=0),y=1<<A-x,D=C=1<<N;do f[E+(U>>x)+(C-=y)]=I<<24|w<<16|P;while(0!==C);for(y=1<<A-1;U&y;)y>>=1;if(0!==y?(U&=y-1,U+=y):U=0,M++,0==--B[A]){if(A===O)break;A=t[g+v[M]]}if(A>k&&(U&T)!==b){for(0===x&&(x=k),E+=D,L=1<<(N=A-x);N+x<O&&!((L-=B[N+x])<=0);)N++,L<<=1;if(F+=1<<N,e===o&&F>r||e===l&&F>s)return 1;f[b=U&T]=k<<24|N<<16|E-m}}return 0!==U&&(f[E+U]=A-x<<24|4194304),S.bits=k,0}}}),eW=eI({"../node_modules/pako/lib/zlib/inflate.js"(e){"use strict";var t,i,n=eN(),r=eL(),s=eF(),a=ej(),o=eq(),l=0,c=1,d=2,u=4,h=5,g=6,p=0,f=1,m=2,v=-2,S=-3,y=-4,C=-5,b=8,T=1,E=2,_=3,I=4,w=5,P=6,R=7,A=8,M=9,D=10,O=11,k=12,N=13,x=14,L=15,F=16,U=17,$=18,V=19,B=20,H=21,j=22,q=23,W=24,G=25,z=26,J=27,K=28,Q=29,Y=30,Z=31,X=852,ee=592,et=15;function ei(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function en(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function er(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=T,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(X),t.distcode=t.distdyn=new n.Buf32(ee),t.sane=1,t.back=-1,p):v}function es(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,er(e)):v}function ea(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?v:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,es(e)):v}function eo(e,t){var i,n;return e?(e.state=n=new en,n.window=null,(i=ea(e,t))!==p&&(e.state=null),i):v}function el(e){return eo(e,et)}var ec=!0;function ed(e){if(ec){var r;for(t=new n.Buf32(512),i=new n.Buf32(32),r=0;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(o(c,e.lens,0,288,t,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;o(d,e.lens,0,32,i,0,e.work,{bits:5}),ec=!1}e.lencode=t,e.lenbits=9,e.distcode=i,e.distbits=5}function eu(e,t,i,r){var s,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),r>=a.wsize?(n.arraySet(a.window,t,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((s=a.wsize-a.wnext)>r&&(s=r),n.arraySet(a.window,t,i-r,s,a.wnext),(r-=s)?(n.arraySet(a.window,t,i-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}function eh(e,t){var i,X,ee,et,en,er,es,ea,eo,el,ec,eh,eg,ep,ef,em,ev,eS,ey,eC,eb,eT,eE,e_,eI=0,ew=new n.Buf8(4),eP=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return v;(i=e.state).mode===k&&(i.mode=N),en=e.next_out,ee=e.output,es=e.avail_out,et=e.next_in,X=e.input,er=e.avail_in,ea=i.hold,eo=i.bits,el=er,ec=es,eT=p;t:for(;;)switch(i.mode){case T:if(0===i.wrap){i.mode=N;break}for(;eo<16;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(2&i.wrap&&35615===ea){i.check=0,ew[0]=255&ea,ew[1]=ea>>>8&255,i.check=s(i.check,ew,2,0),ea=0,eo=0,i.mode=E;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&ea)<<8)+(ea>>8))%31){e.msg="incorrect header check",i.mode=Y;break}if((15&ea)!==b){e.msg="unknown compression method",i.mode=Y;break}if(ea>>>=4,eo-=4,eb=(15&ea)+8,0===i.wbits)i.wbits=eb;else if(eb>i.wbits){e.msg="invalid window size",i.mode=Y;break}i.dmax=1<<eb,e.adler=i.check=1,i.mode=512&ea?D:k,ea=0,eo=0;break;case E:for(;eo<16;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(i.flags=ea,(255&i.flags)!==b){e.msg="unknown compression method",i.mode=Y;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Y;break}i.head&&(i.head.text=ea>>8&1),512&i.flags&&(ew[0]=255&ea,ew[1]=ea>>>8&255,i.check=s(i.check,ew,2,0)),ea=0,eo=0,i.mode=_;case _:for(;eo<32;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}i.head&&(i.head.time=ea),512&i.flags&&(ew[0]=255&ea,ew[1]=ea>>>8&255,ew[2]=ea>>>16&255,ew[3]=ea>>>24&255,i.check=s(i.check,ew,4,0)),ea=0,eo=0,i.mode=I;case I:for(;eo<16;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}i.head&&(i.head.xflags=255&ea,i.head.os=ea>>8),512&i.flags&&(ew[0]=255&ea,ew[1]=ea>>>8&255,i.check=s(i.check,ew,2,0)),ea=0,eo=0,i.mode=w;case w:if(1024&i.flags){for(;eo<16;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}i.length=ea,i.head&&(i.head.extra_len=ea),512&i.flags&&(ew[0]=255&ea,ew[1]=ea>>>8&255,i.check=s(i.check,ew,2,0)),ea=0,eo=0}else i.head&&(i.head.extra=null);i.mode=P;case P:if(1024&i.flags&&((eh=i.length)>er&&(eh=er),eh&&(i.head&&(eb=i.head.extra_len-i.length,i.head.extra||(i.head.extra=Array(i.head.extra_len)),n.arraySet(i.head.extra,X,et,eh,eb)),512&i.flags&&(i.check=s(i.check,X,eh,et)),er-=eh,et+=eh,i.length-=eh),i.length))break t;i.length=0,i.mode=R;case R:if(2048&i.flags){if(0===er)break t;eh=0;do eb=X[et+eh++],i.head&&eb&&i.length<65536&&(i.head.name+=String.fromCharCode(eb));while(eb&&eh<er);if(512&i.flags&&(i.check=s(i.check,X,eh,et)),er-=eh,et+=eh,eb)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=A;case A:if(4096&i.flags){if(0===er)break t;eh=0;do eb=X[et+eh++],i.head&&eb&&i.length<65536&&(i.head.comment+=String.fromCharCode(eb));while(eb&&eh<er);if(512&i.flags&&(i.check=s(i.check,X,eh,et)),er-=eh,et+=eh,eb)break t}else i.head&&(i.head.comment=null);i.mode=M;case M:if(512&i.flags){for(;eo<16;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(ea!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Y;break}ea=0,eo=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=k;break;case D:for(;eo<32;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}e.adler=i.check=ei(ea),ea=0,eo=0,i.mode=O;case O:if(0===i.havedict)return e.next_out=en,e.avail_out=es,e.next_in=et,e.avail_in=er,i.hold=ea,i.bits=eo,m;e.adler=i.check=1,i.mode=k;case k:if(t===h||t===g)break t;case N:if(i.last){ea>>>=7&eo,eo-=7&eo,i.mode=J;break}for(;eo<3;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}switch(i.last=1&ea,eo-=1,3&(ea>>>=1)){case 0:i.mode=x;break;case 1:if(ed(i),i.mode=B,t===g){ea>>>=2,eo-=2;break t}break;case 2:i.mode=U;break;case 3:e.msg="invalid block type",i.mode=Y}ea>>>=2,eo-=2;break;case x:for(ea>>>=7&eo,eo-=7&eo;eo<32;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if((65535&ea)!=(ea>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Y;break}if(i.length=65535&ea,ea=0,eo=0,i.mode=L,t===g)break t;case L:i.mode=F;case F:if(eh=i.length){if(eh>er&&(eh=er),eh>es&&(eh=es),0===eh)break t;n.arraySet(ee,X,et,eh,en),er-=eh,et+=eh,es-=eh,en+=eh,i.length-=eh;break}i.mode=k;break;case U:for(;eo<14;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(i.nlen=(31&ea)+257,eo-=5,i.ndist=(31&(ea>>>=5))+1,eo-=5,i.ncode=(15&(ea>>>=5))+4,ea>>>=4,eo-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Y;break}i.have=0,i.mode=$;case $:for(;i.have<i.ncode;){for(;eo<3;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}i.lens[eP[i.have++]]=7&ea,ea>>>=3,eo-=3}for(;i.have<19;)i.lens[eP[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,eE={bits:i.lenbits},eT=o(l,i.lens,0,19,i.lencode,0,i.work,eE),i.lenbits=eE.bits,eT){e.msg="invalid code lengths set",i.mode=Y;break}i.have=0,i.mode=V;case V:for(;i.have<i.nlen+i.ndist;){for(;ef=(eI=i.lencode[ea&(1<<i.lenbits)-1])>>>24,em=eI>>>16&255,ev=65535&eI,!(ef<=eo);){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(ev<16)ea>>>=ef,eo-=ef,i.lens[i.have++]=ev;else{if(16===ev){for(e_=ef+2;eo<e_;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(ea>>>=ef,eo-=ef,0===i.have){e.msg="invalid bit length repeat",i.mode=Y;break}eb=i.lens[i.have-1],eh=3+(3&ea),ea>>>=2,eo-=2}else if(17===ev){for(e_=ef+3;eo<e_;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}ea>>>=ef,eo-=ef,eb=0,eh=3+(7&ea),ea>>>=3,eo-=3}else{for(e_=ef+7;eo<e_;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}ea>>>=ef,eo-=ef,eb=0,eh=11+(127&ea),ea>>>=7,eo-=7}if(i.have+eh>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Y;break}for(;eh--;)i.lens[i.have++]=eb}}if(i.mode===Y)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Y;break}if(i.lenbits=9,eE={bits:i.lenbits},eT=o(c,i.lens,0,i.nlen,i.lencode,0,i.work,eE),i.lenbits=eE.bits,eT){e.msg="invalid literal/lengths set",i.mode=Y;break}if(i.distbits=6,i.distcode=i.distdyn,eE={bits:i.distbits},eT=o(d,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,eE),i.distbits=eE.bits,eT){e.msg="invalid distances set",i.mode=Y;break}if(i.mode=B,t===g)break t;case B:i.mode=H;case H:if(er>=6&&es>=258){e.next_out=en,e.avail_out=es,e.next_in=et,e.avail_in=er,i.hold=ea,i.bits=eo,a(e,ec),en=e.next_out,ee=e.output,es=e.avail_out,et=e.next_in,X=e.input,er=e.avail_in,ea=i.hold,eo=i.bits,i.mode===k&&(i.back=-1);break}for(i.back=0;ef=(eI=i.lencode[ea&(1<<i.lenbits)-1])>>>24,em=eI>>>16&255,ev=65535&eI,!(ef<=eo);){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(em&&(240&em)==0){for(eS=ef,ey=em,eC=ev;ef=(eI=i.lencode[eC+((ea&(1<<eS+ey)-1)>>eS)])>>>24,em=eI>>>16&255,ev=65535&eI,!(eS+ef<=eo);){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}ea>>>=eS,eo-=eS,i.back+=eS}if(ea>>>=ef,eo-=ef,i.back+=ef,i.length=ev,0===em){i.mode=z;break}if(32&em){i.back=-1,i.mode=k;break}if(64&em){e.msg="invalid literal/length code",i.mode=Y;break}i.extra=15&em,i.mode=j;case j:if(i.extra){for(e_=i.extra;eo<e_;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}i.length+=ea&(1<<i.extra)-1,ea>>>=i.extra,eo-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=q;case q:for(;ef=(eI=i.distcode[ea&(1<<i.distbits)-1])>>>24,em=eI>>>16&255,ev=65535&eI,!(ef<=eo);){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if((240&em)==0){for(eS=ef,ey=em,eC=ev;ef=(eI=i.distcode[eC+((ea&(1<<eS+ey)-1)>>eS)])>>>24,em=eI>>>16&255,ev=65535&eI,!(eS+ef<=eo);){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}ea>>>=eS,eo-=eS,i.back+=eS}if(ea>>>=ef,eo-=ef,i.back+=ef,64&em){e.msg="invalid distance code",i.mode=Y;break}i.offset=ev,i.extra=15&em,i.mode=W;case W:if(i.extra){for(e_=i.extra;eo<e_;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}i.offset+=ea&(1<<i.extra)-1,ea>>>=i.extra,eo-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Y;break}i.mode=G;case G:if(0===es)break t;if(eh=ec-es,i.offset>eh){if((eh=i.offset-eh)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Y;break}eh>i.wnext?(eh-=i.wnext,eg=i.wsize-eh):eg=i.wnext-eh,eh>i.length&&(eh=i.length),ep=i.window}else ep=ee,eg=en-i.offset,eh=i.length;eh>es&&(eh=es),es-=eh,i.length-=eh;do ee[en++]=ep[eg++];while(--eh);0===i.length&&(i.mode=H);break;case z:if(0===es)break t;ee[en++]=i.length,es--,i.mode=H;break;case J:if(i.wrap){for(;eo<32;){if(0===er)break t;er--,ea|=X[et++]<<eo,eo+=8}if(ec-=es,e.total_out+=ec,i.total+=ec,ec&&(e.adler=i.check=i.flags?s(i.check,ee,ec,en-ec):r(i.check,ee,ec,en-ec)),ec=es,(i.flags?ea:ei(ea))!==i.check){e.msg="incorrect data check",i.mode=Y;break}ea=0,eo=0}i.mode=K;case K:if(i.wrap&&i.flags){for(;eo<32;){if(0===er)break t;er--,ea+=X[et++]<<eo,eo+=8}if(ea!==(0|i.total)){e.msg="incorrect length check",i.mode=Y;break}ea=0,eo=0}i.mode=Q;case Q:eT=f;break t;case Y:eT=S;break t;case Z:return y;default:return v}return(e.next_out=en,e.avail_out=es,e.next_in=et,e.avail_in=er,i.hold=ea,i.bits=eo,(i.wsize||ec!==e.avail_out&&i.mode<Y&&(i.mode<J||t!==u))&&eu(e,e.output,e.next_out,ec-e.avail_out))?(i.mode=Z,y):(el-=e.avail_in,ec-=e.avail_out,e.total_in+=el,e.total_out+=ec,i.total+=ec,i.wrap&&ec&&(e.adler=i.check=i.flags?s(i.check,ee,ec,e.next_out-ec):r(i.check,ee,ec,e.next_out-ec)),e.data_type=i.bits+64*!!i.last+128*(i.mode===k)+256*(i.mode===B||i.mode===L),(0===el&&0===ec||t===u)&&eT===p&&(eT=C),eT)}function eg(e){if(!e||!e.state)return v;var t=e.state;return t.window&&(t.window=null),e.state=null,p}function ep(e,t){var i;return e&&e.state&&(2&(i=e.state).wrap)!=0?(i.head=t,t.done=!1,p):v}function ef(e,t){var i,n,s=t.length;return e&&e.state&&(0===(i=e.state).wrap||i.mode===O)?i.mode===O&&(n=r(1,t,s,0))!==i.check?S:eu(e,t,s,s)?(i.mode=Z,y):(i.havedict=1,p):v}e.inflateReset=es,e.inflateReset2=ea,e.inflateResetKeep=er,e.inflateInit=el,e.inflateInit2=eo,e.inflate=eh,e.inflateEnd=eg,e.inflateGetHeader=ep,e.inflateSetDictionary=ef,e.inflateInfo="pako inflate (from Nodeca project)"}}),eG=eI({"../node_modules/pako/lib/zlib/constants.js"(e,t){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}}),ez=eI({"../node_modules/pako/lib/zlib/gzheader.js"(e,t){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}}}),eJ=eI({"../node_modules/pako/lib/inflate.js"(e){"use strict";var t=eW(),i=eN(),n=eV(),r=eG(),s=eU(),a=eB(),o=ez(),l=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),d.windowBits>=0&&d.windowBits<16&&!(e&&e.windowBits)&&(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&(15&d.windowBits)==0&&(d.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var u=t.inflateInit2(this.strm,d.windowBits);if(u!==r.Z_OK||(this.header=new o,t.inflateGetHeader(this.strm,this.header),d.dictionary&&("string"==typeof d.dictionary?d.dictionary=n.string2buf(d.dictionary):"[object ArrayBuffer]"===l.call(d.dictionary)&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw)&&(u=t.inflateSetDictionary(this.strm,d.dictionary))!==r.Z_OK))throw Error(s[u])}function d(e,t){var i=new c(t);if(i.push(e,!0),i.err)throw i.msg||s[i.err];return i.result}function u(e,t){return(t=t||{}).raw=!0,d(e,t)}c.prototype.push=function(e,s){var a,o,c,d,u,h=this.strm,g=this.options.chunkSize,p=this.options.dictionary,f=!1;if(this.ended)return!1;o=s===~~s?s:!0===s?r.Z_FINISH:r.Z_NO_FLUSH,"string"==typeof e?h.input=n.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(g),h.next_out=0,h.avail_out=g),(a=t.inflate(h,r.Z_NO_FLUSH))===r.Z_NEED_DICT&&p&&(a=t.inflateSetDictionary(this.strm,p)),a===r.Z_BUF_ERROR&&!0===f&&(a=r.Z_OK,f=!1),a!==r.Z_STREAM_END&&a!==r.Z_OK)return this.onEnd(a),this.ended=!0,!1;h.next_out&&(0===h.avail_out||a===r.Z_STREAM_END||0===h.avail_in&&(o===r.Z_FINISH||o===r.Z_SYNC_FLUSH))&&("string"===this.options.to?(c=n.utf8border(h.output,h.next_out),d=h.next_out-c,u=n.buf2string(h.output,c),h.next_out=d,h.avail_out=g-d,d&&i.arraySet(h.output,h.output,c,d,0),this.onData(u)):this.onData(i.shrinkBuf(h.output,h.next_out))),0===h.avail_in&&0===h.avail_out&&(f=!0)}while((h.avail_in>0||0===h.avail_out)&&a!==r.Z_STREAM_END);return(a===r.Z_STREAM_END&&(o=r.Z_FINISH),o===r.Z_FINISH)?(a=t.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===r.Z_OK):(o===r.Z_SYNC_FLUSH&&(this.onEnd(r.Z_OK),h.avail_out=0),!0)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){e===r.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.Inflate=c,e.inflate=d,e.inflateRaw=u,e.ungzip=d}}),eK=eI({"../node_modules/pako/index.js"(e,t){"use strict";var i=eN().assign,n=eH(),r=eJ(),s=eG(),a={};i(a,n,r,s),t.exports=a}}),eQ=eI({"../signaling-agent/node_modules/sdp-transform/lib/grammar.js"(e,t){var i=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbXMessage",reg:/^rtcp-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"rtcp-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"cryptoscale",reg:/^cryptoscale:(\d*) (client|server) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","flavor","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"cryptoscale:%d %s %s %s %s":"cryptoscale:%d %s %s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=(null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v"),null!=e.generation&&(t+=" generation %d"),t+=(null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{push:"xCandidatesIpv6",reg:/^x-candidate-ipv6:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=(null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v"),null!=e.generation&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+((null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":""))}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"x-signaling-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{name:"xDataProtocol",reg:/^x-data-protocol:\s?(.*)/,format:"x-data-protocol:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(e){i[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})}}),eY=eI({"../signaling-agent/node_modules/sdp-transform/lib/parser.js"(e){var t=function(e){return String(Number(e))===e?Number(e):e},i=function(e,i,n,r){if(r&&!n)i[r]=t(e[1]);else for(var s=0;s<n.length;s+=1)null!=e[s+1]&&(i[n[s]]=t(e[s+1]))},n=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},r=eQ(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},i=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],s=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),a=i[i.length-1]);for(var o=0;o<(r[t]||[]).length;o+=1){var l=r[t][o];if(l.reg.test(s))return n(l,a,s)}}),t.media=i,t};var a=function(e,i){var n=i.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&i.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var i=[],n=e.split(" ").map(t),r=0;r<n.length;r+=3)i.push({component:n[r],ip:n[r+1],port:n[r+2]});return i},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var i,n=!1;return"~"!==e[0]?i=t(e):(i=t(e.substring(1,e.length)),n=!0),{scid:i,paused:n}})})}}}),eZ=eI({"../signaling-agent/node_modules/sdp-transform/lib/writer.js"(e,t){var i=eQ(),n=/%[sdv%]/g,r=function(e){var t=1,i=arguments,r=i.length;return e.replace(n,function(e){if(t>=r)return e;var n=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},s=function(e,t,i){var n=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?n.push(i[t.name][a]):n.push(i[t.names[s]])}else n.push(i[t.name]);return r.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,r=t.innerOrder||o,l=[];return n.forEach(function(t){i[t].forEach(function(i){i.name in e&&null!=e[i.name]?l.push(s(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){l.push(s(t,i,e))})})}),e.media.forEach(function(e){l.push(s("m",i.m[0],e)),r.forEach(function(t){i[t].forEach(function(i){i.name in e&&null!=e[i.name]?l.push(s(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){l.push(s(t,i,e))})})})}),l.join("\r\n")+"\r\n"}}}),eX=eI({"../signaling-agent/node_modules/sdp-transform/lib/index.js"(e){var t=eY();e.write=eZ(),e.parse=t.parse,e.parseParams=t.parseParams,e.parseFmtpConfig=t.parseFmtpConfig,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList}}),e0=eI({"../skype-calling-utilities/dist/skype-calling-utilities.bundle.js"(e,t){"use strict";!function(n,r){"object"==typeof e&&"object"==typeof t?t.exports=r(i(83836),i(892891)):"function"==typeof define&&define.amd?define("skype-calling-utilities",["@skype/rt-js-bindings","lodash"],r):"object"==typeof e?e["skype-calling-utilities"]=r(i(83836),i(892891)):n["skype-calling-utilities"]=r(n["@skype/rt-js-bindings"],n.lodash)}(e,(e,t)=>{var n,r={},s={exports:r},a=Object.defineProperty,o=Object.getOwnPropertyDescriptor,l=Object.getOwnPropertyNames,c=Object.prototype.hasOwnProperty,d=(e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of l(t))c.call(e,r)||r===i||a(e,r,{get:()=>t[r],enumerable:!(n=o(t,r))||n.enumerable});return e},u=e=>d(a({},"__esModule",{value:!0}),e),h={};((e,t)=>{for(var i in t)a(e,i,{get:t[i],enumerable:!0})})(h,{SlimCoreElectronControlCapturer:()=>R}),s.exports=u(h);var g=i(892891);function p(e){if(!e)return`${e}`;if(e instanceof Map)return f(e);let t=e.toString();if(!t.endsWith("[object Object]"))return t;try{return JSON.stringify(e)}catch{}let i="";for(let t in e)e.hasOwnProperty(t)&&(i+=`${t}: ${e[t]}, `);return i}function f(e){let t={};return e.forEach((e,i)=>{t[i.toString()]=e}),JSON.stringify(t)}var m=class{constructor(e){this.eventLogger=e,this.subscriptions=[]}subscribe(e){return new v(this.subscriptions,e)}dispose(e){this.subscriptions=[]}raiseEvents(e){this.subscriptions.slice().forEach(t=>{try{void 0!==t.eventHandler&&e(t.eventHandler)}catch(e){this.eventLogger?.warn?.("Event handler exception caught!",p(e))}})}},v=class{constructor(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}dispose(){(0,g.remove)(this.subscriptions,e=>e===this),this.eventHandler=void 0}},S=class extends m{constructor(e){super(e)}changed(e,t){return this.subscribe({changed:{skipEventConfig:t,handler:e},on:void 0})}on(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})}once(e,t,i){let n,r=(...e)=>{n.dispose(i),this._toEventCallback(t)(...e)};return n=this.on(e,this._fromEventCallback(r))}raiseChanged(e){this.raiseEvents(t=>{if(!t.changed)return;let{skipEventConfig:i,handler:n}=t.changed;this.getShouldSkipChangedEvent(e,i)||n()})}event(e){return{raise:this._fromEventCallback((...t)=>this._raiseEventImpl(String(e),...t))}}_raiseEventImpl(e,...t){this.raiseEvents(i=>i.on&&i.on.name===e&&i.on.handler(...t))}_toEventCallback(e){return e}_fromEventCallback(e){return e}getShouldSkipChangedEvent(e,t){return e?.skipDominantSpeakerUpdatesOnCall?!!t?.skipDominantSpeakerUpdatesOnCall:!!e?.skipParticipantsUpdatesOnCall&&!!t?.skipParticipantsUpdatesOnCall}async onAsync(e,t){return this.on(e,t)}async onceAsync(e,t,i){return this.once(e,t,i)}async changedAsync(e,t){return this.changed(e,t)}async disposeAsync(e){this.dispose(e)}};(e=>{let t=7,i=3;e.encodeMouseEvent=function(e){if(!e)return new Uint8Array(0);e.buttonType||(e.buttonType=0),e.xPos||(e.xPos=0),e.yPos||(e.yPos=0),e.wheelRotation||(e.wheelRotation=0);let i=new ArrayBuffer(t),n=new DataView(i),r=3&e.type,s=(7&e.buttonType)<<2,a=!!e.buttonDown<<5,o=!!e.wheelButtonDown<<6,l=0;return n.setUint8(0,1),n.setUint8(1,r|s|a|o|l),n.setUint16(2,e.xPos,!0),n.setUint16(4,e.yPos,!0),n.setUint8(6,e.wheelRotation),new Uint8Array(i)},e.encodeKeyboardEvent=function(e){let t=new ArrayBuffer(i),n=new DataView(t),r=3&e.codeType,s=0,a=!!e.keyUp<<4,o=!!e.repeat<<5,l=0,c=0;return n.setUint8(0,0),n.setUint8(1,r|s|a|o|l|c),n.setUint8(2,e.code),new Uint8Array(t)},e.decodeEventType=function(e){return e[0]},e.decodeMouseEvent=function(e){if(1!==e[0]||e.length!==t)return null;let i=new DataView(e.buffer),n=i.getUint8(1);return{type:3&n,buttonType:n>>2&7,buttonDown:!!(n>>5&1),wheelButtonDown:!!(n>>6&1),xPos:i.getUint16(2,!0),yPos:i.getUint16(4,!0),wheelRotation:i.getUint8(6)}},e.decodeKeyboardEvent=function(e){if(0!==e[0]||e.length!==i)return null;let t=new DataView(e.buffer),n=t.getUint8(1);return{codeType:3&n,code:t.getUint8(2),repeat:!!(n>>5&1),keyUp:!!(n>>4&1)}}})(n||(n={}));var y=65535,C=3e3,b=250,T=18,E=17,_=16,I=91,w=50,P=30,R=class extends S{constructor(e,t,i=!0,n=1){super(),this._logger=e,this._element=t,this._captureRegionPreserveAspectRatio=i,this._mouseMoveCount=0,this._mouseMoveStartTime=0,this._isMouseDown=!1,this._isMouseOnRenderer=!1,this._captureMode=0,this._pollTimerID=0,this._resizeTimerID=0,this._mouseMoveThrottlingEnabled=!1,this._handleResizeEvents=()=>{clearTimeout(this._resizeTimerID),this._resizeTimerID=window.setTimeout(()=>{this.updateCaptureRegion()},b)},this._handleMouseLeave=e=>{!this._isOnScreenContent(e)&&this._isMouseOnRenderer&&(this._raiseCaptureEvent(2),this._logger.info("Mouse leaving render region")),this._isMouseOnRenderer=!1},this._handleMouseEnter=e=>{this._isOnScreenContent(e)&&(this._isMouseOnRenderer=!0,this._raiseCaptureEvent(1),this._logger.info("Mouse entering render region"))},this._handleLosingFocus=()=>{this._syncKeyStates(!0)},this._handleClick=e=>{this._isOnScreenContent(e)&&(this._raiseCaptureEvent(0),this._logger.info("Mouse clicked"))},this._handleMouseMove=e=>{if(!this._isOnScreenContent(e)&&this._isMouseOnRenderer){this._raiseCaptureEvent(2),this._isMouseOnRenderer=!1,this._logger.info("Mouse leaving render region");return}if(this._isOnScreenContent(e)&&!this._isMouseOnRenderer&&(this._raiseCaptureEvent(1),this._isMouseOnRenderer=!0,this._logger.info("Mouse entering render region")),2!==this._captureMode&&3!==this._captureMode)return;if(this._mouseMoveCount++,this._mouseMoveThrottlingEnabled){if(!this._isOnScreenContent(e)||!this._shouldMoveMouse())return}else if(!this._isOnScreenContent(e)||this._mouseMoveCount%2==0)return;let t={type:0};this._normalizeMousePosition(e,t),this._raiseMouseEvent(t)},this._handleMouseDown=e=>{if(2!==this._captureMode&&3!==this._captureMode||!this._isOnScreenContent(e))return;let t={type:2,buttonType:A(e.button),buttonDown:!0};this._isMouseDown=!0,this._normalizeMousePosition(e,t),this._raiseMouseEvent(t)},this._handleMouseUp=e=>{if(2!==this._captureMode&&3!==this._captureMode||!this._isOnScreenContent(e))return;let t={type:2,buttonType:A(e.button),buttonDown:!1};this._isMouseDown=!1,this._normalizeMousePosition(e,t),this._raiseMouseEvent(t)},this._handleKeyDown=e=>{this._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!1}),e.stopPropagation(),e.preventDefault()},this._handleKeyUp=e=>{this._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!0}),e.stopPropagation(),e.preventDefault()},this._handleWheel=e=>{this._raiseMouseEvent({type:1,wheelRotation:e.deltaY>0?-120:120})},this._handleContextMenu=e=>{e.preventDefault()},this._ensureCanReceiveKeyboardInput(),this._element.ownerDocument?.defaultView?.addEventListener("resize",this._handleResizeEvents,!1),this._captureRegion={left:0,top:0,width:this._element.clientWidth,height:this._element.clientHeight},this._videoSize={width:Math.floor(t.clientHeight*n),height:t.clientHeight},this._origElementSize={width:0,height:0},this._checkElementSize(),this._mouseMoveStartTime=new Date(0).getTime()}get captureMode(){return this._captureMode}get captureRegion(){return this._captureRegion}setMouseMoveThrottlingFeatureFlag(e){this._mouseMoveThrottlingEnabled=e}dispose(e){this._logger.info(`dispose causeId: ${e}`),window.clearTimeout(this._pollTimerID),this._element.ownerDocument?.defaultView?.removeEventListener("resize",this._handleResizeEvents,!1),super.dispose(e)}updateVideoSize(e,t){this._videoSize.width=e,this._videoSize.height=t,this.updateCaptureRegion()}updateCaptureRegion(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)}setCaptureMode(e){3===this._captureMode&&3!==e&&this._syncKeyStates(!0),this._captureMode=e,0!==e?("none"===this._element.style.pointerEvents&&this._logger.warn("Element pointer-events is 'none', event handlers will not work"),this._element.addEventListener("click",this._handleClick),this._element.addEventListener("pointermove",this._handleMouseMove),this._element.addEventListener("pointerdown",this._handleMouseDown),this._element.addEventListener("pointerup",this._handleMouseUp),this._element.addEventListener("pointerenter",this._handleMouseEnter),this._element.addEventListener("pointerleave",this._handleMouseLeave),3===e?(this._element.addEventListener("wheel",this._handleWheel),this._element.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("keyup",this._handleKeyUp),this._element.addEventListener("contextmenu",this._handleContextMenu),this._element.addEventListener("blur",this._handleLosingFocus)):(this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))):(this._element.removeEventListener("pointermove",this._handleMouseMove),this._element.removeEventListener("pointerdown",this._handleMouseDown),this._element.removeEventListener("pointerup",this._handleMouseUp),this._element.removeEventListener("pointerenter",this._handleMouseEnter),this._element.removeEventListener("pointerleave",this._handleMouseLeave),this._element.removeEventListener("click",this._handleClick),this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))}_ensureCanReceiveKeyboardInput(){this._element.tabIndex=this._element.tabIndex}_checkElementSize(){(this._origElementSize.width!==this._element.clientWidth||this._origElementSize.height!==this._element.clientHeight)&&(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout(()=>{this._checkElementSize()},C)}_raiseMouseEvent(e){this.event("mouseControlEvent").raise(e)}_raiseKeyboardEvent(e){this.event("keyboardControlEvent").raise(e)}_raiseCaptureEvent(e){this.event("ctrlCaptureEvent").raise(e)}_normalizeMousePosition(e,t){t.xPos=(e.offsetX-this._captureRegion.left)/this._captureRegion.width*y,t.yPos=(e.offsetY-this._captureRegion.top)/this._captureRegion.height*y}_isOnScreenContent(e){let t=this._captureRegion.left,i=this._captureRegion.left+this._captureRegion.width,n=this._captureRegion.top,r=this._captureRegion.top+this._captureRegion.height;return t<=e.offsetX&&e.offsetX<i&&n<=e.offsetY&&e.offsetY<r}_shouldMoveMouse(){if(this._mouseMoveStartTime){let e=new Date().getTime(),t=e-this._mouseMoveStartTime;if(this._isMouseDown&&t>=P||!this._isMouseDown&&t>=w)return this._mouseMoveStartTime=e,!0}else this._mouseMoveStartTime=new Date().getTime();return!1}_syncKeyStates(e){this._raiseKeyboardEvent({codeType:1,code:E,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:_,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:T,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:I,repeat:!1,keyUp:e}),this._logger.info("Synced Key states.")}static formatMouseEvent(e){return n.encodeMouseEvent(e)}static formatKeyboardEvent(e){return n.encodeKeyboardEvent(e)}};function A(e){switch(e){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}return"object"==typeof s.exports&&"object"==typeof r&&(s.exports=((e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of Object.getOwnPropertyNames(t))Object.prototype.hasOwnProperty.call(e,r)||r===i||Object.defineProperty(e,r,{get:()=>t[r],enumerable:!(n=Object.getOwnPropertyDescriptor(t,r))||n.enumerable});return e})(s.exports,r)),s.exports})}}),e1=eI({"../node_modules/synctasks/dist/SyncTasks.js"(e){"use strict";function t(e){return null!=e&&"function"==typeof e.then}function i(e){return null!=e&&"function"==typeof e.cancel}function n(t,i){if(!e.config.catchExceptions)return t();try{return t()}catch(e){return i(e)}}Object.defineProperty(e,"__esModule",{value:!0}),e.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},e.fromThenable=function(e){var t=c();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var r,s=[],a="undefined"!=typeof setImmediate;function o(e){s.push(e),1===s.length&&(a?setImmediate(l):setTimeout(l,0))}function l(){var e=s;s=[];for(var t=0;t<e.length;t++)e[t]()}function c(){return new r.SyncTask}function d(e){return new r.SyncTask().resolve(e).promise()}function u(e){var n=c(),s=!1;return n.onCancel(function(t){e.forEach(function(e){i(e)&&r.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){t(e)?e.then(function(e){s||(s=!0,n.resolve(e))},function(e){s||(s=!0,n.reject(e))}):s||(s=!0,n.resolve(e))}),n.promise()}e.asyncCallback=o,function(r){r.SyncTask=function(){function r(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return r.prototype._addCallbackSet=function(e,t){var i=this,n=new r;return n.onCancel(function(t){e.wasCanceled=!0,e.cancelContext=t,i._cancelInternal(t)}),e.task=n,this._storedCallbackSets.push(e),t?this._mustHandleError=!1:n._mustHandleError=!1,!this._resolving&&(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),n.promise()},r.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},r.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},r.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},r.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},r.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},r.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},r.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},r.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},r.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},r.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},r.prototype.reject=function(e){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=e,this._cancelCallbacks=[],this._resolveFailures(),r._enforceErrorHandled(this),this},r.prototype._checkState=function(t){if(this._completedSuccess||this._completedFail)throw this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack),Error("Failed to "+(t?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected"));(e.config.traceEnabled||this._traceEnabled)&&(this._completeStack=Error("resolve"))},r._enforceErrorHandled=function(t){t._mustHandleError&&(r._rejectedTasks.push(t),r._enforceErrorHandledTimer||(r._enforceErrorHandledTimer=setTimeout(function(){r._enforceErrorHandledTimer=void 0;var t=r._rejectedTasks;r._rejectedTasks=[],t.forEach(function(t,i){t._mustHandleError&&e.config.unhandledErrorHandler(t._storedErrResolution)})},0)))},r.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},r.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var i=this._cancelCallbacks;this._cancelCallbacks=[],i.length>0&&i.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},r.cancelOtherInternal=function(e,t){var i=e;i._storedCallbackSets&&i._cancelInternal?i._cancelInternal(t):e.cancel(t)},r.prototype.promise=function(){return this},r.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?o(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},r.prototype._resolveSuccessCallback=function(e){var s=this;e.successFunc?n(function(){var n=e.successFunc(s._storedResolution);i(n)&&(e.wasCanceled?r.cancelOtherInternal(n,e.cancelContext):e.task.onCancel(function(e){return r.cancelOtherInternal(n,e)})),t(n)?n.then(function(t){e.task.resolve(t)},function(t){e.task.reject(t)}):e.task.resolve(n)},function(t){s._handleException(t,"SyncTask caught exception in success block: "+t.toString()),e.task.reject(t)}):e.task.resolve(this._storedResolution)},r.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?o(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},r.prototype._resolveFailureCallback=function(e){var s=this;e.failFunc?n(function(){var n=e.failFunc(s._storedErrResolution);i(n)&&(e.wasCanceled?r.cancelOtherInternal(n,e.cancelContext):e.task.onCancel(function(e){return r.cancelOtherInternal(n,e)})),t(n)?n.then(function(t){e.task.resolve(t)},function(t){e.task.reject(t)}):e.task.resolve(n)},function(t){s._handleException(t,"SyncTask caught exception in failure block: "+t.toString()),e.task.reject(t)}):e.task.reject(this._storedErrResolution)},r.prototype._handleException=function(t,i){e.config.exceptionsToConsole&&console.error(i),e.config.exceptionHandler&&e.config.exceptionHandler(t)},r.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,i){return e.then(t,i)})},r._rejectedTasks=[],r}()}(r||(r={})),e.all=function(e){if(0===e.length)return d([]);var n,s=c(),a=e.length,o=Array(e.length);s.onCancel(function(t){e.forEach(function(e){i(e)&&r.SyncTask.cancelOtherInternal(e,t)})});var l=function(){0==--a&&(void 0!==n?s.reject(n):s.resolve(o))};return e.forEach(function(e,i){t(e)?e.then(function(e){o[i]=e,l()},function(e){void 0===n&&(n=void 0===e||e),l()}):(o[i]=e,l())}),s.promise()},e.Defer=c,e.Resolved=d,e.Rejected=function(e){return new r.SyncTask().reject(e).promise()},e.race=u,e.raceTimer=function(e,t){var i=c(),n=setTimeout(function(){i.resolve({timedOut:!0})},t);return u([e.then(function(e){return clearTimeout(n),{timedOut:!1,result:e}}),i.promise()])}}}),e2=eI({"../node_modules/sdp-transform/lib/grammar.js"(e,t){var i=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbXMessage",reg:/^rtcp-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"rtcp-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"cryptoscale",reg:/^cryptoscale:(\d*) (client|server) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","flavor","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"cryptoscale:%d %s %s %s %s":"cryptoscale:%d %s %s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=(null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v"),null!=e.generation&&(t+=" generation %d"),t+=(null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{push:"xCandidatesIpv6",reg:/^x-candidate-ipv6:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=(null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v"),null!=e.generation&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+((null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":""))}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"x-signaling-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{name:"xDataProtocol",reg:/^x-data-protocol:\s?(.*)/,format:"x-data-protocol:%s"},{name:"xMultiStream",reg:/^x-multi-stream:(\d*) (\d*) (\d*) (\d*)/,names:["numberOfStreams","startSsrc","ssrcRange","ssrcGroupRange"],format:"x-multi-stream:%d %d %d %d"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(e){i[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})}}),e3=eI({"../node_modules/sdp-transform/lib/parser.js"(e){var t=function(e){return String(Number(e))===e?Number(e):e},i=function(e,i,n,r){if(r&&!n)i[r]=t(e[1]);else for(var s=0;s<n.length;s+=1)null!=e[s+1]&&(i[n[s]]=t(e[s+1]))},n=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},r=e2(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},i=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],s=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),a=i[i.length-1]);for(var o=0;o<(r[t]||[]).length;o+=1){var l=r[t][o];if(l.reg.test(s))return n(l,a,s)}}),t.media=i,t};var a=function(e,i){var n=i.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&i.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var i=[],n=e.split(" ").map(t),r=0;r<n.length;r+=3)i.push({component:n[r],ip:n[r+1],port:n[r+2]});return i},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var i,n=!1;return"~"!==e[0]?i=t(e):(i=t(e.substring(1,e.length)),n=!0),{scid:i,paused:n}})})}}}),e4=eI({"../node_modules/sdp-transform/lib/writer.js"(e,t){var i=e2(),n=/%[sdv%]/g,r=function(e){var t=1,i=arguments,r=i.length;return e.replace(n,function(e){if(t>=r)return e;var n=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},s=function(e,t,i){var n=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?n.push(i[t.name][a]):n.push(i[t.names[s]])}else n.push(i[t.name]);return r.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,r=t.innerOrder||o,l=[];return n.forEach(function(t){i[t].forEach(function(i){i.name in e&&null!=e[i.name]?l.push(s(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){l.push(s(t,i,e))})})}),e.media.forEach(function(e){l.push(s("m",i.m[0],e)),r.forEach(function(t){i[t].forEach(function(i){i.name in e&&null!=e[i.name]?l.push(s(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){l.push(s(t,i,e))})})})}),l.join("\r\n")+"\r\n"}}}),e5=eI({"../node_modules/sdp-transform/lib/index.js"(e){var t=e3();e.write=e4(),e.parse=t.parse,e.parseParams=t.parseParams,e.parseFmtpConfig=t.parseFmtpConfig,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList}}),e6={};ew(e6,{HttpRequestDispatcherImplementation:()=>tW,generateCauseId:()=>e9,getOvb:()=>t0,getVersion:()=>tX,pluginlessStackFactory:()=>G8,whiteList:()=>G9}),eS.exports=eA(e6);var e8=8;function e9(){let e="abcdef0123456789",t=e.length,i="";for(let n=0;n<e8;n++)i+=e.charAt(Math.floor(Math.random()*t));return i}function e7(e){return RegExp("^[a-f0-9]{8}$").test(e)&&e.length===e8}var te=i(83836),tt=i(892891),ti=class e{constructor(e,t,i=""){this.ulLogComponent=e,this.ulSafeComponent=t,this._getPrefix=(0,tt.isFunction)(i)?i:()=>i,this.logComponent=te.LogFactory.instance().component(this.ulLogComponent),te.LogFactory.instance().declareComponentSafe(this.ulLogComponent,t)}createChild(t){let i=(0,tt.isFunction)(t)?t:()=>t;return new e(this.ulLogComponent,this.ulSafeComponent,()=>this._getPrefix()?`${this._getPrefix()}/${i()}`:i())}log(...e){this._apply(e=>this.logComponent.debug2(null,e),e)}debug(...e){this._apply(e=>this.logComponent.debug4(null,e),e)}info(...e){this._apply(e=>this.logComponent.debug1(null,e),e)}warn(...e){this._apply(e=>this.logComponent.warn(null,e),e)}error(...e){this._apply(e=>this.logComponent.error(null,e),e)}_apply(e,t=[]){this._addPrefix(t),e(t.map(e=>e instanceof DOMException?e.toString():e).map(e=>(0,tt.isObject)(e)?JSON.stringify(e):e).join(", "))}_addPrefix(e){if(e&&e[0]){let t=`${this._getPrefix()} ${e[0]}`;e[0]=t}}},tn=i(83836),tr=class{constructor(e,t){this.value=e,this.piiKind=t}},ts=["id"," orgid","username","phonenumber"];function ta(e){return"string"==typeof e?tn.pii.Mri(e):tn.pii.Omit(e)}function to(e){try{return e.map(ta)}catch(e){return[]}}function tl(e,t=["id"],i={threadId:8}){if(!e||"object"!=typeof e)return e;try{let n=tp(e);return n=tf(n,t,i)}catch(e){return{error:"failed to scrub object fields"}}}function tc(e){try{let t={};return Object.keys(e).forEach(i=>{t[ta(i)]=e[i]}),t}catch(e){return{error:"failed to scrub mri keys"}}}function td(e){return JSON.stringify(tc(e))}function tu(e){return e&&tn.pii.Mri(e)}function th(e){let t=tg(e);return t&&t.substr(0,8)}function tg(e){let t="99:";return e&&e.substr(0,3)===t?tn.pii.Omit(e):e}function tp(e){if(!e||"object"!=typeof e)return e;let t=new Set;return JSON.parse(JSON.stringify(e,(e,i)=>{if("object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}))}function tf(e,t,i){if(!e||"object"!=typeof e)return e;let n={...e};for(let[r,s]of Object.entries(e))Array.isArray(s)?n[r]=s.map(e=>tf(e,t,i)):"object"==typeof s?n[r]=tf(s,t,i):"displayname"===r.toLowerCase()?n[r]="<redacted>":s&&(t.includes(r)||ts.includes(r.toLowerCase())?n[r]=ta(s):i[r]&&"string"==typeof s&&(n[r]=s.toString().substring(0,i[r])));return n}function tm(e){let t=String.raw`\\*['"]?\s*[\:=]\s*\\*['"]?`,i=String.raw`[\ \w#.~?!@$%^&*:()\-\/\+;<=>@\\\[\]^]*?`;return RegExp(String.raw`((?:${e})${t})(${i})(\\{0,2}['"])`,"g")}function tv(e){return(t,i,n,r)=>n?.toLowerCase()==="false"||n?.toLowerCase()==="true"?t:String.raw`${i}${e(n)}${r}`}function tS(e){if(!e)return null;let t=tm("[U|u]ser[N|n]ame|[O|o]rg[I|i]d");return e.replace(t,tv(ta))}function ty(e){if(!e)return null;let t=tm("[P|p]assword|[T|t]oken|[S|s]ecret|[A|a]uthorization|[D|d]isplay[N|n]ame|[P|p]honeNumber|[A|a]ddress|IP");return tS(e.replace(t,tv(()=>"<redacted>")))}var tC=eR(i(892891)),tb=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","phrase","subCode","reason","conversationType","terminatedReason","terminatedReasonCode","terminatedReasonSubCode","errorMessage"];function tT(e){try{return JSON.parse(JSON.stringify(e,tb,4))}catch(e){return{error:"failed to parse object"}}}var tE=e=>{try{return e.split("\n")[0]}catch(e){return"invalid stack"}};function t_(e,t=!1){if(null==e)return"void";if(e instanceof Error||e instanceof String||e instanceof Number||e instanceof Boolean)return e.toString();try{return e.stack&&(e.stack=tE(e.stack)),(t?JSON.stringify(e):JSON.stringify(e,tb,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(t){return`failed to get error information:${e&&"function"==typeof e.toString&&e.toString()} ${e?.response&&JSON.stringify(e.response)}`}}function tI(e){try{return JSON.stringify(e,null,2)}catch(t){return`failed to stringify obj ${e}`}}function tw(e,t){try{return e.substring(0,t)}catch(t){return e}}function tP(e){return e||!1===e||""===e||0===e}function tR(e){let t={mediaPeerType:e.mediaPeerType,threadId:th(e.threadId)};return tP(e.messageId)&&(t.messageId=e.messageId),tP(e.enableGroupCallMeetupGeneration)&&(t.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration),tP(e.endpointMetadata)&&(t.endpointMetadata=e.endpointMetadata),tP(e.onBehalfOf)&&(t.onBehalfOf=ta(e.onBehalfOf)),tP(e.onBehalfOfUserDisplayName)&&(t.onBehalfOfUserDisplayName=e.onBehalfOfUserDisplayName),tP(e.emergencyContent)&&(t.emergencyContent=e.emergencyContent),tP(e.isEmergency)&&(t.isEmergency=e.isEmergency),tP(e.broadcastContext)&&(t.broadcastContext=e.broadcastContext),e.meetingInfo&&(t.meetingInfo={tenantId:e.meetingInfo.tenantId,organizerId:ta(e.meetingInfo.organizerId)},tP(e.meetingInfo.meetingType)&&(t.meetingInfo.meetingType=e.meetingInfo.meetingType),tP(e.meetingInfo.replyChainMessageId)&&(t.meetingInfo.replyChainMessageId=e.meetingInfo.replyChainMessageId)),e.transferContext&&(t.transferContext={transferorMri:ta(e.transferContext.transferorMri),targetMri:ta(e.transferContext.targetMri),context:tl(e.transferContext.context)},tP(e.transferContext.transferType)&&(t.transferContext.transferType=e.transferContext.transferType)),tI(t)}function tA(e,t){try{let i=tl(e);return Object.keys(e).forEach(n=>{t.includes(n)?i[n]=ta(e[n]):"conversationId"===n&&(i[n]=th(e[n]))}),tI(tC.omit(i,["body.gp"]))}catch(e){return{error:"failed to get safe payload"}}}function tM(e){try{let t=tl(e,["id","groupCallInitiator","organizerId"]);return tx(t,"response.roster.participants"),tx(t,"response.additionalActionResponses.0.output.roster.participants"),tx(t,"response.muteUnmuteResponse"),t=tC.omit(t,["meetingChatProperties"]),t=tO(t)}catch(e){return"failed to return safe response"}}function tD(e){try{let t=tl(e);return tO(t)}catch(e){return"failed to return safe request"}}function tO(e){if(e?.config?.data){let t=e.config.data;t=tl(t=JSON.parse(t)),e.config.data=tI(t)}return tI(e)}function tk(e){try{let t=tl(e,["id","groupCallInitiator"]);return tx(t,"body.participants"),tI(t)}catch(e){return"failed to return safe response"}}function tN(e){try{let t=tl(e,["originalId"]);return tI(t)}catch(e){return"failed to return safe endpoint details"}}function tx(e,t){e&&tC.get(e,t)&&tC.set(e,t,tc(tC.get(e,t)))}function tL(e){return Math.floor(e*(1-(Math.floor(11*Math.random())+10)/100))}function tF(e){if(!e)return!1;try{return atob(e),!0}catch(e){return!1}}function tU(e){return!!e&&"function"==typeof e.then}function t$(e){if(!e)return`${e}`;if(e instanceof Map)return tB(e);let t=e.toString();if(!t.endsWith("[object Object]"))return t;try{return JSON.stringify(e)}catch{}let i="";for(let t in e)e.hasOwnProperty(t)&&(i+=`${t}: ${e[t]}, `);return i}function tV(e){try{if(e.status)return`status: ${e.status}, URL: ${e.responseURL}, statusText: ${e.responseText}`}catch(e){}return t$(e)}function tB(e){let t={};return e.forEach((e,i)=>{t[i.toString()]=e}),JSON.stringify(t)}function tH(e){let t=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function tj(e,t,i=0){return e&&void 0!==t&&t>-1&&e.length>t&&e.splice(i,e.length-t),e}function tq(e,t,i,n=0){tj(e,0===i?0:i-1,n),0!==i&&e.push(t)}var tW=class{constructor(e){e&&"function"==typeof e.createChild?this.logger=e.createChild("RequestDispatcher"):this.logger=new ti("JS.TsCalling.RequestDispatcher",!1)}getRequestOptions(e,t,i,n,r){return{headers:t||{},timeout:n,payload:i||null,responseType:r}}getAsync(e,t){return this.sendRequest(e,t,"GET")}postAsync(e,t){return this.sendRequest(e,t,"POST")}putAsync(e,t){return this.sendRequest(e,t,"PUT")}removeAsync(e,t){return this.sendRequest(e,t,"DELETE")}async sendRequest(e,t={headers:{}},i){return this.sendFetchRequest(e,t,i)}async sendFetchRequest(e,t={headers:{}},i){let n,r=this.logger.createChild(`[${t.causeId||e9()}][FetchRequest]`);r.info(`sending, ${i}-${e}`);let s=Date.now(),a=new AbortController,o=null,l=null,c=()=>{r.info("Aborting pending request"),a.abort()};tG(t);try{if(t.keepAlive&&t.payload?.toString().length>65536&&r.warn("Using fetch with keep alive with more than 64kib data"),r.info(`${JSON.stringify(t.headers)}`),o=fetch(e,{method:i,headers:t.headers,body:t.payload,credentials:t.withCredentials?"include":"same-origin",signal:a.signal,keepalive:t.keepAlive}),tU(t.timeout))t.timeout.then(()=>{c()},()=>{r.info("Timeout promise rejected, ignoring")});else if(t.timeout){let e=setTimeout(()=>c(),t.timeout);o=o.finally(()=>clearTimeout(e))}l=await o;try{n=await l.json()}catch(e){r.info(`unable to parse response as json with error ${e}`)}let d={response:n,request:{status:l.status,statusText:l.statusText,headers:Object.fromEntries(l.headers.entries()),responseURL:l.url,response:n,withCredentials:t.withCredentials},duration:Date.now()-s};if(!l.ok)throw r.info(`failed response, status=${l.status}`),d;return r.info(`success, status=${l.status}`),d}catch(e){if(r.info(`failed error=${t_(e)}`),"AbortError"===e.name)throw{aborted:!0};throw e||Error("Request failed")}}};function tG(e){e.headers=e.headers||{},e.headers["content-type"]||(e.headers["content-type"]=e.contentType||"application/json")}var tz=i(892891),tJ=class e{constructor(e){this._callingLogger=e,this._maybeLog=(e,...t)=>{try{this._callingLogger[e](...t)}catch(e){this._callingLogger.info("[failed to log]",t_(e))}}}getPrefix(e,t){let i="";return t&&(i+=`[${t}]`),e&&(i+=`[${e}]`),i}createChild(t,i){return new e(this._callingLogger.createChild(t,i))}createFnLogger(t,i,...n){return new e(this._callingLogger.createChild(this.getPrefix(t,i)+n.join(""),!1))}logSuccess(e){this._maybeLog("info",`success=${e}}`)}logFailure(e){let t=t_(e);this._maybeLog("info",`failed=${t}}`)}log(...e){this._maybeLog("log",...e)}debug(...e){this._maybeLog("debug",...e)}info(...e){this._maybeLog("info",...e)}warn(...e){this._maybeLog("warn",...e)}error(...e){this._maybeLog("error",...e)}},tK=i(892891),tQ=class{constructor(e){this.eventLogger=e,this.subscriptions=[]}subscribe(e){return new tY(this.subscriptions,e)}dispose(e){this.subscriptions=[]}raiseEvents(e){this.subscriptions.slice().forEach(t=>{try{void 0!==t.eventHandler&&e(t.eventHandler)}catch(e){this.eventLogger?.warn?.("Event handler exception caught!",t$(e))}})}},tY=class{constructor(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}dispose(){(0,tK.remove)(this.subscriptions,e=>e===this),this.eventHandler=void 0}},tZ=class extends tQ{constructor(e){super(e)}changed(e,t){return this.subscribe({changed:{skipEventConfig:t,handler:e},on:void 0})}on(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})}once(e,t,i){let n,r=(...e)=>{n.dispose(i),this._toEventCallback(t)(...e)};return n=this.on(e,this._fromEventCallback(r))}raiseChanged(e){this.raiseEvents(t=>{if(!t.changed)return;let{skipEventConfig:i,handler:n}=t.changed;this.getShouldSkipChangedEvent(e,i)||n()})}event(e){return{raise:this._fromEventCallback((...t)=>this._raiseEventImpl(String(e),...t))}}_raiseEventImpl(e,...t){this.raiseEvents(i=>i.on&&i.on.name===e&&i.on.handler(...t))}_toEventCallback(e){return e}_fromEventCallback(e){return e}getShouldSkipChangedEvent(e,t){return e?.skipDominantSpeakerUpdatesOnCall?!!t?.skipDominantSpeakerUpdatesOnCall:!!e?.skipParticipantsUpdatesOnCall&&!!t?.skipParticipantsUpdatesOnCall}async onAsync(e,t){return this.on(e,t)}async onceAsync(e,t,i){return this.once(e,t,i)}async changedAsync(e,t){return this.changed(e,t)}async disposeAsync(e){this.dispose(e)}};function tX(){return"2025.28.01.4"}function t0(){return"e5ccb4c51ce63a9c779b875602b2fdf834799448"}var t1=i(892891),t2=eR(eO()),t3="Android",t4="iOS",t5="Mac OS",t6="Safari",t8="Mobile Safari",t9="WebKit",t7="Blink",ie="Gecko",it="WebKit",ii="Unknown",ir="0.0",is=class e{constructor(){let e=navigator.userAgent,t=new t2.UAParser(e).getResult();this.browserInfo={name:t.browser.name||"Unknown",engine:t.engine.name||"Unknown",version:t.browser.version||ir,engineVersion:t.engine.version||ir,formFactor:ia(t)||"Unknown",osName:t.os.name||ii,osVersion:t.os.version||ii},this.modifyParserResult(t),this.queryFullVersion(t)}static get instance(){return e._instance||(e._instance=new e),e._instance}static isFormFactor(...e){return e.map(e=>e.toString()).includes(this.getBrowserInfo().formFactor)}static isEngine(...e){return e.map(e=>e.toString()).includes(this.getBrowserInfo().engine)}static isBrowser(...e){return e.map(e=>e.toString()).includes(this.getBrowserInfo().name)}static isVersionGreaterOrEqual(e){let t=this.getBrowserInfo().version,i=e.split(".").map(e=>parseInt(e,10)),n=t.split(".").map(e=>parseInt(e,10));return n[0]>i[0]||n[0]===i[0]&&n[1]>=i[1]}static getBrowserInfo(){return this.instance.browserInfo}static isRemote(){return window.navigator.mediaDevices?.isRemote}static toString(){let e=this.getBrowserInfo();return`${e.name}/${e.version} ${e.engine} ${e.formFactor}`}modifyParserResult(t){switch(t.engine.name){case t7:this.browserInfo.engine="Chromium";break;case it:t.browser.name?.includes("Safari")||(this.browserInfo.engine="Chromium");break;case ie:this.browserInfo.engine="Firefox"}t.engine.name===t7&&t.os.name===t3&&(this.browserInfo.version=t.engine.version||ir),(t.os.name===t4||t.browser.name?.includes(t6))&&(this.browserInfo.engine="Safari"),(t.os.name===t5||t.os.name===t4)&&t.browser.name===t9&&(this.browserInfo.engine="Safari",this.browserInfo.name="AppleWebView"),t.os.name===t4&&(this.browserInfo.version=t.os.version||ir),t.browser.name===t8&&(this.browserInfo.name="Safari"),t.ua.includes("maglev")&&(this.browserInfo.name="Maglev",this.browserInfo.version=t.engine.version||ir),e.isRemote()&&(this.browserInfo.engine="ChromiumAVD"),t.ua.includes("Cisco")&&(this.browserInfo.name="CiscoOS"),t.ua.includes("ZoomRoom")&&(this.browserInfo.name="ZoomRoom"),t.ua.includes("TeamsSamsungTVBrowser")&&(this.browserInfo.name="SamsungTV"),t.ua?.toLowerCase().trim()==="iphone"&&(this.browserInfo.name="AppleWebView",this.browserInfo.engine="Safari",this.browserInfo.formFactor="Mobile",this.browserInfo.version=ir,this.browserInfo.engineVersion=ir)}queryFullVersion(e){if(!("userAgentData"in navigator))return;let t=navigator.userAgentData,i=e?.browser?.name?.toUpperCase();t.getHighEntropyValues(["fullVersionList"]).then(e=>{for(let t of e.fullVersionList)if(i&&t.brand.toUpperCase().indexOf(i)>=0){this.browserInfo.version=t.version;break}}).catch(e=>{})}static getBrowserFingerprint(){let e=0,t=0,i=performance?.getEntriesByType("navigation");return i?.length>0&&(e=i[0].loadEventEnd,t=i[0].loadEventStart),{webdriver:navigator?.webdriver,pluginsLength:navigator?.plugins?.length,languageLength:navigator?.languages?.length,mimeTypesLength:navigator?.mimeTypes?.length,outerWidth:window?.outerWidth,outerHeight:window?.outerHeight,innerWidth:window?.innerWidth,innerHeight:window?.innerHeight,clientWidth:document?.documentElement?.clientWidth,clientHeight:document?.documentElement?.clientHeight,loadEventEnd:e,loadEventStart:t,hasChrome:!!window?.chrome,hasPlaywright:!!window?.__playwright,hasSelenium:!!window?.__webdriver_evaluate||!!window?.__selenium_unwrapped,hasNightmare:!!window?.__nightmare,hasPhantom:!!window?.callPhantom||!!window?._phantom,hasCypress:!!window?.Cypress}}};function ia(e){let t="136";if(io()===t)return"Hololens";if(/hostAudio-Processing/i.test(e.ua))return"RoomAudioProcessing";let i=e.device.type;return"mobile"===i||"tablet"===i?"Mobile":void 0===e.browser.name?"Unknown":"Desktop"}function io(){let e="os-sku",t=window.external;return t?.getHostEnvironmentValue?JSON.parse(t.getHostEnvironmentValue(e))[e]:"-1"}var il={src:["https://statics.teams.cdn.office.net/hashed/azuremediaplayer.min-d46c9f4.js","https://statics.teams.cdn.office.net/evergreen-assets/broadcast/player-skin.min.js"],css:["https://statics.teams.cdn.office.net/evergreen-assets/broadcast/player-skin.min.css?v=2","https://statics.teams.cdn.office.net/evergreen-assets/broadcast/video-player.css?v=3"],styles:["azuremediaplayer","amp-stream-skin","amp-big-play-centered"],lang:"en-us",disableFullscreenButton:!1,playerType:0},ic={src:["https://res.cdn.office.net/s01-ml-player/legacy/hls/hydra_player_hls_bundle_4.24351.2.js"],css:[],styles:[],lang:"en-us",disableFullscreenButton:!1,muteVideo:!1,playerType:1,hydraPlayerWebSdkUrls:["https://res-4.public.onecdn.static.microsoft/s01-ml-player/legacy/hls/hydra_player_hls_bundle_4.24351.2.js","https://res.cdn.office.net/s01-ml-player/legacy/hls/hydra_player_hls_bundle_4.24351.2.js"]},id={src:[],css:[],styles:[],playerType:2,hydraPlayerWebSdkUrls:["https://res.cdn.office.net/s01-ml-player/4.24352.3/hydra_player_ums_bundle.js"],useMicrosoftEcdn:!0},iu=class{constructor(e,t,i,n){this.configIds=i,this.logger=n,this.defaultSettings=ip(),this.logger.info(`client settings: ${JSON.stringify(t)}`),this.defaultSettings.debug=t?.debug||!1,this.defaultSettings.playerType=t?.playerConfig?.playerType||this.defaultSettings.playerType,t?.playerConfig&&(0===this.defaultSettings.playerType?this.defaultSettings.ampSettings.liveStreamPlayerConfiguration=t.playerConfig:1===this.defaultSettings.playerType?this.defaultSettings.hlsSettings.liveStreamPlayerConfiguration=t.playerConfig:2===this.defaultSettings.playerType&&(this.defaultSettings.umsSettings.liveStreamPlayerConfiguration=t.playerConfig)),(0,t1.mergeWith)(this.defaultSettings,e,im),this.logger.info(`applied settings: ${JSON.stringify(this.defaultSettings)}`)}get playerConfig(){return 0===this.defaultSettings.playerType?this.defaultSettings.ampSettings.liveStreamPlayerConfiguration:1===this.defaultSettings.playerType?this.defaultSettings.hlsSettings.liveStreamPlayerConfiguration:2===this.defaultSettings.playerType?this.defaultSettings.umsSettings.liveStreamPlayerConfiguration:null}get config(){return this.defaultSettings}},ih=class{constructor(){this.defaultSettings={allowSdnPlugins:!0,capturePlayerLogs:!0,playerType:0,loadType:1,maxPlayerDiagnosticsCount:50,maxPlayerMemoryTraceLogCount:1e3,maxPlayerPlaybackEventCount:50,maxRetryCount:10,playerTelemetryTickMs:1e3,removeEmptyDefaultTextTrack:!0,sendSnapshotTelemetry:!1,sendSnapshotTelemetryEveryMs:1e4,sendInitialTelemetryAfterMs:6e4,sendTelemetry:!0,textTrackKind:"subtitles",maxRetryCountForLoadingResources:5,maxVideoTrackHistoryLogCount:100,hydraRuntimeFetchTimeout:6e3,ampSettings:{errorCodesEligibleForStreamingUrlSwitch:[4194309,2097564,2097556,2097752,2097753,5242884],liveStreamPlayerConfiguration:il,sourceResetTimeoutInMs:1e3,streamingUrlSwitchMaxCount:2,resetStreamingUrlSwitchCount:!1,useBrowserWindowSizeForBitRate:!0,estimateAbsoluteTime:!0,maxAbsoluteTimeOffsetEstimationResultsLogCount:100,collectUserInitiatedSeekEventsTelemetry:!0,maxUserInitiatedSeekEventCount:100,noMediaTimeoutMs:-1},hlsSettings:{liveStreamPlayerConfiguration:ic,timeoutForSwitchingUrl:9e3,estimateAbsoluteTime:!0,maxAbsoluteTimeOffsetEstimationResultsLogCount:100,playlistInitialSequenceNumber:1,skipNonce:!1,maxStreamConnectionResultsLogCount:100,logHlsJsEvents:!1,logHlsJsEventsEveryMs:5e3,maxPlayerExperimentalEvents:100},umsSettings:{liveStreamPlayerConfiguration:id,timeoutForSwitchingUrl:9e3,maxStreamConnectionResultsLogCount:100,minTargetEdgeLatency:.2,latencyCompensationThreshold:.5,maxPlayerExperimentalEvents:100}}}getSettings(){return this.defaultSettings}},ig=class extends ih{constructor(){super(),this.settings=super.getSettings(),this.settings.loadType=0,this.settings.allowSdnPlugins=!1,this.settings.umsSettings.minTargetEdgeLatency=.6,this.settings.umsSettings.latencyCompensationThreshold=.9}getSettings(){return this.settings}};function ip(){return(is.isEngine("Safari")?new ig:new ih).getSettings()}function im(e,t){if((0,t1.isArray)(e))return t.slice()}function iv(e){return!!e&&!!e.url&&!!e.decryptionToken}function iS(e,t,i){if(!e&&!i)throw Error(`Assert failed${void 0!==t?`: ${t}`:""}`)}var iy=class{constructor(e,t,i){this.name=e,this.stopCrash=t,this.start(i)}complete(){iS(this.startTime,"not started",this.stopCrash),iS(void 0===this.duration,"already completed",this.stopCrash),this.duration=Date.now()-this.startTime}updateDetails(e,t){if(this.details&&"object"==typeof this.details)for(let i=0;i<e.length;i++)this.details[e[i]]=t[i]}fail(e){this.failReason=e,this.complete()}set detail(e){this.details=e}getTelemetryEvent(){iS(this.startTime,"not started",this.stopCrash);try{iS(void 0!==this.duration,"not completed",this.stopCrash)}catch(e){if("SetSource"!==this.name&&"Load"!==this.name)throw e}let e={name:this.name,startTime:this.startTime,duration:this.duration};return this.failReason&&(e.failReason=this.failReason),this.details&&(e.details=this.details),e}start(e){iS(!this.startTime,"already started",this.stopCrash),this.startTime=Date.now(),this.details=e}},iC=class{constructor(e,t,i){this.config=e,this.logger=t,this.playerDiagnosticsLog=i,this.currentScenarioMap=new Map,this.playerEvents=[],this.playbackEvents=[],this.userInitiatedSeekEvents=[],this.experimentalEvents=[],this.clientNetworkType=void 0,this.maxPlayerPlaybackEventCount=e.maxPlayerPlaybackEventCount||5,this.maxPlayerDiagnosticsCount=e.maxPlayerDiagnosticsCount||5,this.maxPlayerMemoryTraceLogCount=e.maxPlayerMemoryTraceLogCount||100,this.maxUserInitiatedSeekEventCount=e.ampSettings?.maxUserInitiatedSeekEventCount||100,this.stopCrash=e.stopCrash||!1,this.config.debug&&(this.playerDiagnosticsLog.memoryLog=[]),this.addNetworkTypeEventListener()}getPlayerDiagnosticSnapshot(){return this.currentPlayerDiagnosticSnapshot}registerStatsUpdated(e){this.currentPlayerDiagnosticSnapshot=e,Object.keys(this.playerDiagnosticsLog).forEach(t=>{let i=t,n=this.playerDiagnosticsLog[t];if(Array.isArray(n)){n.push(e[i]);let t="memoryLog"===i&&n.length>this.maxPlayerMemoryTraceLogCount,r="memoryLog"!==i&&n.length>this.maxPlayerDiagnosticsCount;(t||r)&&n.splice(0,1)}else this.playerDiagnosticsLog[t]=e[i]})}registerEventLoadAttempt(e,t){this.registerScenario(e,t)}registerEventLoadFailed(e,t){this.completeScenario(e,t)}registerEventLoadSucceeded(e,t){this.completeScenario(e,void 0,t)}registerPlayerLoadAttempt(){this.registerScenario("Load")}registerPlayerLoadSucceeded(e){this.completeScenario("Load",void 0,e)}registerPlayerLoadFailed(e){this.completeScenario("Load",e)}registerPlayerSetupAttempt(){this.registerScenario("Setup")}registerPlayerSetupSucceeded(){this.completeScenario("Setup")}registerPlayerSetupFailed(e){this.completeScenario("Setup",e)}registerStreamConnectionAttempt(e){this.registerScenario("StreamConnection")}registerStreamConnectionSucceeded(){this.completeScenario("StreamConnection")}registerStreamConnectionFailed(e){this.completeScenario("StreamConnection",e)}registerSetSourceAttempt(e,t){let i=e;t&&(i={src:e,reason:t}),this.registerScenario("SetSource",i)}registerSetSourceSucceeded(e){this.getScenario("SetSource").updateDetails(["src"],[e]),this.completeScenario("SetSource")}registerSetSourcedFailed(e,t){this.getScenario("SetSource").updateDetails(["src"],[t]),this.completeScenario("SetSource",e)}registerSdnPluginLoad(e,t,i){this.registerScenario("SdnPluginLoad",e);let n=t?void 0:i;this.completeScenario("SdnPluginLoad",n)}registerPlayerDestroyed(e){this.registerScenario("Destroyed",e),this.completeScenario("Destroyed")}registerPlaybackStateChanged(e,t){let i;if("Ready"!==e||this.firstReadyStateTimestamp?"Playing"!==e||this.firstPlayingStateTimestamp||(this.firstPlayingStateTimestamp=Date.now()):this.firstReadyStateTimestamp=Date.now(),t&&"Buffering"===e){let e=t;e?i=e.message:this.logger.debug(`Unexpected buffering payload: ${JSON.stringify(t)}`)}this.registerPlaybackEvent("StateChanged",e,i)}registerPlaybackError(e,t){this.registerPlaybackEvent("Error",{errorType:e,details:t})}registerDownloadBitratechanged(e){this.registerPlaybackEvent("BitrateChangedDownload",e)}registerStreamOptionsConfigured(e,t){this.registerPlaybackEvent("StreamOptionsConfigured",this.generateCleanedStreamOption(e),t)}registerPlaybackBitratechanged(e){this.registerPlaybackEvent("BitrateChangedPlayback",e)}registerPotentialMediaFreeze(e){this.registerPlaybackEvent("PotentialMediaFreeze",e)}registerCaptionToggle(e,t,i){let n={isEnabled:e,culture:t,playerTime:i};this.registerPlaybackEvent("CaptionsToggled",n)}registerFullScreenChange(e){this.registerPlaybackEvent("FullscreenChanged",e)}registerMute(e){this.registerPlaybackEvent("Mute",e)}registerVolumeChange(e){this.registerPlaybackEvent("Volume",e)}getExperimentalEvents(){return{playback_experimentalEvents:this.prepareForTelemetry(this.experimentalEvents)}}getUserInitiatedSeekEvents(){return{playback_userInitiatedSeekEvents:this.prepareForTelemetry(this.userInitiatedSeekEvents)}}getSnapshotReport(e={}){let t=this.playerEvents.map(e=>e.getTelemetryEvent()),i=this.playbackEvents,n={};return this.currentPlayerDiagnosticSnapshot&&(n=this.filterAndPrepareTelemetry()),{isFullReport:!1,configIds:e.configIds||"",playerId:e.playerId||"",correlationId:e.correlationId||"",traceId:e.correlationId?e.correlationId.replace(/-/g,""):"",eTag:e.eTag||"",isFinal:e.isFinal??!1,isIframe:1===this.config.loadType,isFullscreenButtonDisabled:e.disableFullscreenButton??!1,threadId:e.threadId||"",telemetryTickMs:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.statsInterval?this.currentPlayerDiagnosticSnapshot.statsInterval:-1,tsCallingVersion:tX()||"",...this.getInitializationReport(t,i),...this.getPlaybackReport(i),...this.getBitrateReport(i),...this.getSdnReport(t),...this.getSetSourceReport(t),...this.getExperimentalEvents(),...this.getUserInitiatedSeekEvents(),networkType:this.getClientNetworkType(),callSetupSucceeded:this.getCallSetupSucceeded(t),callDropped:this.getCallDropped(i),...n}}getReport(e={}){let t=this.playerEvents.map(e=>e.getTelemetryEvent()),i=this.playbackEvents;return{callendReason:e.callendReason,isFullReport:!0,configIds:e.configIds||"",playerId:e.playerId||"",correlationId:e.correlationId||"",traceId:e.correlationId?e.correlationId.replace(/-/g,""):"",eTag:e.eTag||"",isFinal:e.isFinal??!1,isIframe:1===this.config.loadType,isFullscreenButtonDisabled:e.disableFullscreenButton??!1,threadId:e.threadId||"",telemetryTickMs:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.statsInterval?this.currentPlayerDiagnosticSnapshot.statsInterval:-1,tsCallingVersion:tX()||"",...this.getInitializationReport(t,i),...this.getPlaybackReport(i),...this.getBitrateReport(i),...this.getSdnReport(t),...this.getSetSourceReport(t),...this.getExperimentalEvents(),...this.getUserInitiatedSeekEvents(),networkType:this.getClientNetworkType(),callSetupSucceeded:this.getCallSetupSucceeded(t),callDropped:this.getCallDropped(i),...this.getPlayerDiagnosticLog()}}registerExperimentalEvent(e,t,i){let n=this.createTelemetryEvent(e,t,i);this.experimentalEvents.push(n),this.logTelemetryEvent(n)}registerUserInitiatedSeek(e){let t=(this.currentPlayerDiagnosticSnapshot?.currentPlayPosition?this.currentPlayerDiagnosticSnapshot.currentPlayPosition:-1)<e.newCurrentPlayPosition,i={...e,seekForward:t},n=this.createTelemetryEvent("UserInitiatedSeek",i);this.userInitiatedSeekEvents.push(n),this.userInitiatedSeekEvents.length>this.maxUserInitiatedSeekEventCount&&this.userInitiatedSeekEvents.splice(0,1)}createTelemetryEvent(e,t,i){let n={eventType:e,timestamp:Date.now(),currentPlayPosition:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.currentPlayPosition?this.currentPlayerDiagnosticSnapshot.currentPlayPosition:-1};return void 0!==t&&(n.payload=this.prepareForTelemetry(t)),n.message=i,n}registerPlaybackEvent(e,t,i){let n=this.createTelemetryEvent(e,t,i);"Error"===e&&t?.errorType!=="PlaybackRetried"&&(n.fatal=!0),this.playbackEvents.push(n),this.playbackEvents.length>this.maxPlayerPlaybackEventCount&&this.playbackEvents.splice(0,1),this.logTelemetryEvent(n)}getPlayerDiagnosticLog(){if(!this.currentPlayerDiagnosticSnapshot)return{};let e=this.currentPlayerDiagnosticSnapshot,t=this.playerDiagnosticsLog,i={...e,...t},n={};return Object.keys(i).forEach(e=>{n[`player_${e}`]=this.prepareForTelemetry(i[e])}),n}getCallSetupSucceeded(e){let t=e.find(e=>"Load"===e.name);return!!t&&!t.failReason}getCallDropped(e){return!!e.filter(e=>"Error"===e.eventType).find(e=>e.fatal)}getInitializationReport(e,t){let i=e.find(e=>"Load"===e.name),n=i&&this.initialStreamConnectionEstablishedTimestamp?this.initialStreamConnectionEstablishedTimestamp-i.startTime:-1;return{init_timeLoadToStreamConnectionEstablished:n||-1,init_timeLoadToReady:(i&&this.firstReadyStateTimestamp?this.firstReadyStateTimestamp-i.startTime:-1)||-1,init_timeLoadToPlaying:(i&&this.firstPlayingStateTimestamp?this.firstPlayingStateTimestamp-i.startTime:-1)||-1,init_allEvents:this.prepareForTelemetry(e)}}getPlaybackReport(e){let t=e.filter(e=>"StateChanged"===e.eventType),i=t.find(e=>"Ready"===e.payload),n=t.find(e=>"Play"===e.payload),r=t.find(e=>"Start"===e.payload),s=t.find(e=>"Playing"===e.payload),a=i&&n?n.timestamp-i.timestamp:-1,o=n&&r?r.timestamp-n.timestamp:-1,l=r&&s?s.timestamp-r.timestamp:-1,c=t.filter(e=>"Seeked"===e.payload),d=t.filter(e=>"Seeking"===e.payload),u=t.filter(e=>"Paused"===e.payload),h=t.filter(e=>"Resume"===e.payload),g=t.filter(e=>"Buffering"===e.payload),p=["BitrateChangedDownload","BitrateChangedPlayback","Error","Mute","StateChanged","Volume","StreamOptionsConfigured"],f=e.filter(e=>"Error"===e.eventType),m=e.filter(e=>"Volume"===e.eventType||"Mute"===e.eventType),v=e.filter(e=>"StreamOptionsConfigured"===e.eventType),S=e.filter(e=>!p.includes(e.eventType));return{playback_timeReadyToPlay:a,playback_timePlayToStart:o,playback_timeStartToPlaying:l,playback_bufferingEvents:this.prepareForTelemetry(g),playback_errorEvents:this.prepareForTelemetry(f),playback_pauseEvents:this.prepareForTelemetry(u),playback_resumeEvents:this.prepareForTelemetry(h),playback_otherEvents:this.prepareForTelemetry(S),playback_seekedEvents:this.prepareForTelemetry(c),playback_seekingEvents:this.prepareForTelemetry(d),playback_stateChangeEvents:this.prepareForTelemetry(t),playback_volumeEvents:this.prepareForTelemetry(m),playback_streamOptionsConfiguredEvents:this.prepareForTelemetry(v)}}generateCleanedStreamOption(e){return{...e,stream:{...e?.stream,decryptionToken:e?.stream?.decryptionToken?"valid":"empty",sdnContext:e?.stream?.sdnContext?"valid":"empty",keyAuthorizationToken:e?.stream?.keyAuthorizationToken?"valid":"empty"},altStream:e?.altStream?{...e?.altStream,decryptionToken:e?.altStream?.decryptionToken?"valid":"empty",sdnContext:e?.altStream?.sdnContext?"valid":"empty",keyAuthorizationToken:e?.stream?.keyAuthorizationToken?"valid":"empty"}:void 0}}getBitrateReport(e){let t=e.filter(e=>"BitrateChangedDownload"===e.eventType),i=t.sort(e=>Number(e.payload)),n=t.length?{bitrate_downloadChanges:this.prepareForTelemetry(t),bitrate_downloadChangeCount:t.length||-1,bitrate_downloadMin:i[0].payload||-1,bitrate_downloadMax:i[i.length-1].payload||-1}:{},r=e.filter(e=>"BitrateChangedPlayback"===e.eventType),s=r.sort(e=>Number(e.payload)),a=r.length?{bitrate_playbackChanges:this.prepareForTelemetry(r),bitrate_playbackChangeCount:r.length||-1,bitrate_playbackMin:s[0].payload||-1,bitrate_playbackMax:s[s.length-1].payload||-1}:{};return{...n,...a}}addNetworkTypeEventListener(){window.navigator?.connection?.type&&window.navigator?.connection?.addEventListener("change",()=>this.updateClientNetworkType())}updateClientNetworkType(){this.clientNetworkType=void 0,this.getClientNetworkType()}getClientNetworkType(){if(void 0===this.clientNetworkType){let e="Unknown";if(window.navigator?.connection?.type)switch(window.navigator?.connection?.type){case"cellular":e="WWAN";break;case"ethernet":e="Wired";break;case"wifi":e="Wireless";break;default:e="Unknown"}this.clientNetworkType=e}return this.clientNetworkType}getSdnReport(e){let t=e.filter(e=>"SdnPluginLoad"===e.name),i=t.length?t[t.length-1]:void 0;return{sdn_loaded:!!i&&void 0===i.failReason,sdn_details:i&&i.details||"",sdn_error:i&&i.failReason||"",sdn_events:this.prepareForTelemetry(t)}}getSetSourceReport(e){let t=e.filter(e=>"SetSource"===e.name);return{set_source_events:this.prepareForTelemetry(t)}}registerScenario(e,t){let i=this.currentScenarioMap.get(e),n=new iy(e,this.stopCrash,t);iS(!i,`previous scenario:${t$(i)} is not completed, new scenario:${t$(n)}`,this.stopCrash),this.currentScenarioMap.set(e,n),this.playerEvents.push(n)}getScenario(e){return this.currentScenarioMap.get(e)}completeScenario(e,t,i){let n=this.currentScenarioMap.get(e);iS(n,"no scenario to complete",this.stopCrash),t?n.fail(t):("StreamConnection"!==e||this.initialStreamConnectionEstablishedTimestamp||(this.initialStreamConnectionEstablishedTimestamp=Date.now()),i&&(n.detail=i),n.complete()),this.currentScenarioMap.delete(e)}logTelemetryEvent(e){this.config.debug&&(this.logger.debug(`PlayerTelemetryEvent: ${JSON.stringify(e)}`),this.logger.debug(`PlayerDiagnosticData: ${JSON.stringify(this.currentPlayerDiagnosticSnapshot)}`))}filterAndPrepareTelemetry(){let e=new Set;e.add("serviceLatencyCdg"),e.add("endToEndLatencyCdg"),e.add("videoEdgeLatencyCdg");let t={};return Object.keys(this.currentPlayerDiagnosticSnapshot).forEach(i=>{e.has(i)||(t[`player_${i}`]=this.prepareForTelemetry(this.currentPlayerDiagnosticSnapshot[i]))}),t}prepareForTelemetry(e){return"boolean"==typeof e?e:"string"==typeof e||void 0===e?e||"":"number"==typeof e?e??-1:JSON.stringify(e)}},ib=i(892891);function iT(e){return new Promise(t=>{t(e())})}var iE=class{constructor(){this.isPendingInt=!0,this.promiseInt=new Promise((e,t)=>{this.resolveInt=e,this.rejectInt=t})}get resolve(){return e=>{this.isPendingInt=!1,this.resolveInt(e),this.clearTimeout()}}get reject(){return e=>{this.isPendingInt=!1,this.rejectInt(e),this.clearTimeout()}}get promise(){return this.promiseInt}get isPending(){return this.isPendingInt}setTimeout(e,t=`deferred timed out after ${e}ms`){this.isPendingInt&&(this.timeoutId=setTimeout(()=>{this.reject(t)},e))}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};function i_(e,t=`deferred timed out after ${e}ms`){let i=new iE;return i.setTimeout(e,t),i}function iI(e){return new Promise(t=>setTimeout(t,e))}var iw=class{static build(e,t){return new iP(e,t)}},iP=class{constructor(e,t){this.ontimeout=e,this.name=t}start(e){if(void 0!==this.timeoutId)throw Error(`Timer ${this.name} already started`);return this.timeoutId=window.setTimeout(()=>this.ontimeout(),e),this}stop(){if(void 0!==this.timeoutId)clearTimeout(this.timeoutId),this.timeoutId=void 0;else throw Error(`Timer ${this.name} is not defined`)}};function iR(){let e,t=ix(),i=iL();return(e=>{e.CaptionFunctionalityNotSupported="CaptionFunctionalityNotSupported"})(e||(e={})),class{constructor(e,t){this.container=e,this.eventsHandler=t,this.videoElementEvents=[],this.playerEvents=[],this.maxMemoryTraceLogCount=1e4,this.videoSourceType="application/dash+xml",this.sdnPluginLoaded=!1,this.statsTimer=-1,this.statsInterval=1e3,this.videoSourceSetAttemptCount=0,this.totalBufferingTime=0,this.isBuffering=!1,this.totalPlayingTime=0,this.isPlaying=!1,this.videoTrackTotalDurations=[]}get contextWindow(){return this.container.ownerDocument.defaultView}configure(e,t,i){this.liveStreamOptions=e,this.playerId=i,t&&(this.configProvider=t,this.statsInterval=t.config.playerTelemetryTickMs||this.statsInterval,this.maxMemoryTraceLogCount=t.config.maxPlayerMemoryTraceLogCount||this.maxMemoryTraceLogCount)}getIceCandidates(){let e=[];try{let t=this.liveStreamOptions.stream.sdnContext||this.liveStreamOptions.altStream?.sdnContext||"",i=JSON.parse(t),n=JSON.parse(i.sdnConfig);if(n.RTCIceCandidates)e=n.RTCIceCandidates;else throw Error("RTCIceCandidates not present in SDN Context")}catch(e){this.log(`getIceCandidates failed: ${JSON.stringify(e.message)}`,"error")}return this.log(`getIceCandidates: ${JSON.stringify(e)}`,"debug"),e}loadPlayerScript(){let e=Promise.resolve(""),t=this.configProvider.playerConfig.nonce,i=this.configProvider.playerConfig.css;for(let n=0;n<i.length;n++)e=e.then(()=>this.retry(()=>this.loadCss(this.container.ownerDocument,i[n],t)));return e.then(()=>this.loadAmpScript())}loadAmpScript(){this.log("loadPlayerScript started");let e=Promise.resolve(""),t=this.configProvider.playerConfig?.nonce,i=this.configProvider.playerConfig?.src||[],n=Math.max(2,this.configProvider.config.maxRetryCountForLoadingResources);if(0===i.length)return Promise.reject("AMP Player Src is empty");for(let r=0;r<i.length;++r)e=e.then(()=>this.loadScriptPromise(i,r,t,n));return e}loadScriptPromise(e,t,i,n,r=""){return this.retry(()=>this.setScriptByLoad(this.container.ownerDocument,e[t],i),n).then(i=>`${e[t]}: ${i} `.concat(r)).catch(s=>this.retry(()=>this.setScriptByBlob(this.container.ownerDocument,e[t],i),n).then(i=>`${e[t]}: ${i}`.concat(` ${s} `,` ${r} `)).catch(a=>this.retry(()=>this.setScriptByInnerHtml(this.container.ownerDocument,e[t],i),1).then(i=>`${e[t]}: ${i}`.concat(` ${s} `,`${a} `,` ${r} `)).catch(s=>{let o=r;return t<e.length&&(o=(o=o.concat(`Failed to load script, nonce: ${i}, src: ${e[t]} index: ${t} `)).concat(`${n} attempts LoadFailure `,`${n} attempts BlobFetchFailure: `,a,", 1 attempt InnerHtmlFailure: ",`${s} `)),Promise.reject(o)})))}retry(e,t=this.configProvider.config.maxRetryCountForLoadingResources,i=1,n=200){return e(t).then(e=>`${e}, succeeded on load number: ${i} `).catch(r=>(this.log(`Error loading resource: ${r} -- ${t} retriesLeft`),0==--t)?Promise.reject(`${r}`):new Promise(s=>setTimeout(()=>s(this.retry(e,t,i+1).then(e=>"string"==typeof e?`${e}, succeeded on load number: ${i}`:e).catch(e=>Promise.reject(`${r}`.concat(", ",e)))),n)))}setScriptByLoad(e,t,i){let n=e.createElement("script"),r=this.getElementLoadPromise(n,t);return n.src=t,i&&(n.nonce=i),e.head.appendChild(n),r.then(()=>Promise.resolve("Success: setScriptByLoad"))}setScriptByBlob(e,t,i){return this.safeResponse(t).then(t=>t.blob().then(n=>{if(!n)return Promise.reject(`${t.status}, blob is null`);{let t=URL.createObjectURL(n);return this.setScriptByLoad(e,t,i).then(()=>Promise.resolve("Success: setScriptByBlob"))}}))}setScriptByInnerHtml(e,t,i){return this.safeResponse(t).then(t=>t.text().then(n=>{if(!n)return Promise.reject(`status code:${t.status}, text is null`);{let t=document.createElement("script");return t.innerHTML=n,i&&!this.configProvider.config.hlsSettings.skipNonce&&(t.nonce=i),e.head.appendChild(t),Promise.resolve("Success: setScriptByInnerHtml")}}))}safeResponse(e){return fetch(e).then(e=>e.ok?e:Promise.reject(`${e.status}`))}tryLoadSdnPlugin(){return this.sdnPluginLoaded||!this.liveStreamOptions.sdn?Promise.resolve():this.configProvider.config.allowSdnPlugins?(this.log("tryLoadSdnPlugin started"),this.retry(()=>this.setScriptByLoad(this.container.ownerDocument,this.liveStreamOptions.sdn.url,this.configProvider.playerConfig.nonce)).then(()=>{this.log("SDN script loaded"),this.sdnPluginLoaded=!0,this.log("tryLoadSdnPlugin done")})):(this.log("Loading SDN plugins is not allowed"),Promise.reject("Loading SDN plugins is not allowed"))}createAmp(){this.log("createAmp started"),this.createVideoElement();let e=this.getAmpOptions();if(this.playerInstance=this.contextWindow.amp(this.video.id,e),!this.playerInstance)throw this.log("createAmp failed","error"),Error("playerInstance is null");this.playerInstance.currentTechName()?.toLowerCase()==="html5"&&this.configProvider.config.ampSettings.estimateAbsoluteTime&&this.isControlsDisabled()?(this.absoluteTimeOffsetEstimator=new ik(this.log.bind(this)),this.diagnosticProvider=new t(this.playerInstance,this.contextWindow,new Date,this.configProvider,this.absoluteTimeOffsetEstimator),this.absoluteTimeOffsetEstimator.setEstimationResultCallback(this.onAbsoluteTimeOffsetEstimation.bind(this))):this.diagnosticProvider=new t(this.playerInstance,this.contextWindow,new Date,this.configProvider);let n={controlsEnabled:!this.isControlsDisabled(),logFn:this.log.bind(this),removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack};this.diagnosticProvider.setValue("streamingEventType",this.liveStreamOptions.streamingEventType),this.diagnosticProvider.setValue("eventId",this.liveStreamOptions?.eventId||""),this.diagnosticProvider.setValue("templateId",this.liveStreamOptions?.templateId||""),this.diagnosticProvider.setValue("playerControlsEnabled",!this.isControlsDisabled()),this.captionsControl=new i(this.playerInstance,this,n,this.diagnosticProvider),this.registerPlayerEvents(),this.log("createAmp done")}isControlsDisabled(){return void 0!==this.liveStreamOptions.allowPlayerControls?!this.liveStreamOptions.allowPlayerControls:"Overflow"===this.liveStreamOptions.streamingEventType||"TownHall_Basic"===this.liveStreamOptions.streamingEventType||"TownHall_Premium"===this.liveStreamOptions.streamingEventType||"TownHall"===this.liveStreamOptions.streamingEventType}onAbsoluteTimeOffsetEstimation(e){if(this.diagnosticProvider.appendAbsoluteTimeOffsetEstimation(e),!e.isSuccess){let e=this.addEvent("CaptionFunctionalityNotSupported",{detail:{data:{fatal:!0,details:"absolute time offset estimation failed - captions will fail"}}});this.video.dispatchEvent(e)}}addEvent(e,t){let i={};return t?.detail&&(i={detail:t.detail}),new CustomEvent(e,i)}setSource(e){if(this.log("setSource started"),!this.playerInstance)throw this.log("setSource failed: playerInstance is null","error"),Error("playerInstance is null");this.videoSourceSetAttemptCount++,this.videoSourceSetAttemptCount>0&&this.diagnosticProvider.setValue("retryCount",this.videoSourceSetAttemptCount-1);let t={src:e.url,type:this.videoSourceType,protectionInfo:e.decryptionToken?[{type:"AES",authenticationToken:e.decryptionToken}]:null};this.configureSdnSource(t,e),this.diagnosticProvider.setValue("streamUrl",e.url),this.diagnosticProvider.setValue("streamId",this.getStreamIdFromStreamUrl(e.url)),this.diagnosticProvider.setValue("streamDeliveryPipeline",e.streamDeliveryPipeline||""),this.playerInstance.src([t],this.getTextTracks()),this.absoluteTimeOffsetEstimator&&this.absoluteTimeOffsetEstimator.setManifestFileURL(e.url+"(format=m3u8-aapl-v4)"),this.log("setSource done")}getStreamIdFromStreamUrl(e){try{let t=new URL(e).pathname;if(t){let e=t.toLowerCase().split("/");if(e?.length>1){let t=e.indexOf("media.ism");if(t>0)return e[t-1];return e[1]}}return this.log(`unable to parse stream ID from stream URL: ${e}`,"warn"),""}catch{return this.log(`cannot parse stream ID from invalid stream URL: ${e}`,"warn"),""}}setPlayTime(e){e&&(this.log(`setPlayerTime: ${e}`),this.playerInstance.currentTime(e))}dispose(){this.log("dispose started"),this.diagnosticProvider&&(this.stopStatsCollection(),this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.removePlayerEventListeners(),this.playerInstance.getMemoryLog(!0),this.playerInstance.dispose(),this.playerInstance=null),this.eventsHandler.ampDisposed(),this.video&&(this.removeVideoEventListeners(),this.video.parentNode&&this.video.parentNode.removeChild(this.video),this.video=null),this.absoluteTimeOffsetEstimator&&(this.absoluteTimeOffsetEstimator.stopStreamAbsoluteTimeOffsetRetrieval(),this.absoluteTimeOffsetEstimator=null),this.log("dispose done"),this.eventsHandler=null}updatePlaybackDiagnostics(){this.updateTotalPlayingTimeStatistic(),this.updateBufferingRateStatistic(),this.updateVideoTrackHistoryStatistic()}handlePlaybackStopped(){this.isBuffering=!1,this.isPlaying=!1,this.currentVideoPlaybackBitrate=null}showCaptions(e){this.log(`showCaptions: ${e}`),this.captionsControl.showCaptions(e)}addCues(e){e=e.filter(e=>e.text&&0!==e.text.trim().length),this.captionsControl.addCues(e)}clearCues(){this.captionsControl.clearCues()}captionsToggled(e,t,i){this.log(`captionsToggled: ${e} for culture ${t} at ${i}`),this.eventsHandler.message("captionsToggled").send(e,t,i)}createVideoElement(){this.log("createVideoElement started"),this.video=this.container.ownerDocument.createElement("video"),this.video.id="amp-player",this.video.setAttribute("playsinline","");let e=this.configProvider.playerConfig.lang;e&&(this.video.setAttribute("lang",e),this.log(`createVideoElement: language set to ${e}`));let t=this.configProvider.playerConfig.styles;for(let e=0;e<t.length;e++)this.video.classList.add(t[e]);this.container.appendChild(this.video),this.log("createVideoElement done")}getAmpOptions(){let e=[];this.configProvider.config.debug?e.push({target:"memory",maxMemoryTraceCount:this.maxMemoryTraceLogCount}):e.push({target:"console"});let t={TraceTargets:e,maxLogLevel:this.configProvider.config.debug?3:2},i={techOrder:["azureHtml5JS","html5"],nativeControlsForTouch:!1,autoplay:!0,preload:"auto",controls:!this.isControlsDisabled(),logo:{enabled:!1},height:"100%",width:"100%",traceConfig:t,disableFullscreenButton:this.configProvider.playerConfig?.disableFullscreenButton,staleDataTimeLimitInSec:30,heuristicProfile:this.contextWindow.amp.Player.HeuristicProfile.HighQuality,customPlayerSettings:{customHeuristicSettings:{bandwidthTestWithTimeThresholdDuringLive:!1,windowSizeHeuristics:this.configProvider.config.ampSettings.useBrowserWindowSizeForBitRate,useBrowserWindowForWindowSizeRule:this.configProvider.config.ampSettings.useBrowserWindowSizeForBitRate,useVariableFragmentSizeMode:!0}},plugins:{}};return this.initializePluginOptions(i),i}isStreamValid(e){return e&&!!e.url&&!!e.decryptionToken}initializePluginOptions(e){if(!this.sdnPluginLoaded||!this.liveStreamOptions.sdn)return;let t=this.isStreamValid(this.liveStreamOptions.stream)?this.liveStreamOptions.stream:this.liveStreamOptions.altStream;this.log(`initializePluginOptions, receivedSDNContext: ${JSON.stringify(t?.sdnContext)}`,"info");try{let i=this.liveStreamOptions.correlationId||this.playerId;switch(this.liveStreamOptions.sdn.name){case"hive":if(e.plugins={hive:{debugLevel:this.configProvider.config.debug?"debug":"notice",telemetryId:i}},t&&t.sdnContext)try{let i=JSON.parse(t.sdnContext);if(i.sdnConfig){let t=JSON.parse(i.sdnConfig);t.candidateTopicName="RequestIceCandidates",delete t.RTCIceCandidates,Object.assign(e.plugins.hive,t)}}catch(e){this.log(`initializePluginOptions, failed to parse Hive sdnConfig Json from sdnContext Json, error: ${e}`,"warn")}break;case"kollective":if(t&&t.sdnContext){let n=null,r=null,s=null;try{n=this.parseJson(t.sdnContext,"kollective sdn context")}catch(e){this.log(`initializePluginOptions, failed to parse Kollective sdnContext Json, error: ${e}`,"error")}if(n){try{r=this.parseJson(n.playbackinfo,"kollective sdn playback info")}catch(e){this.log(`initializePluginOptions, failed to parse Kollective sdnContext playbackinfo Json, error: ${e}`,"error")}try{s=this.parseJson(n.sdnConfig,"kollective sdn config")}catch(e){this.log(`initializePluginOptions, failed to parse Kollective sdnContext sdnConfig Json, error: ${e}`,"error")}}e.plugins={kollectiveSDN:{playbackInfo:r,sdnConfig:s,reportSessionId:i}}}break;case"ramp":t&&t.sdnContext&&(e.plugins={RampMOPlugin:this.parseJson(t.sdnContext,"ramp sdn context")},this.configProvider.config.debug&&(e.plugins.RampMOPlugin.verbose=!0));break;case"peer5":t.sdnContext&&(e.plugins={peer5:this.parseJson(t.sdnContext,"peer5 sdn context")})}}catch(e){this.log(`initializePluginOptions failed, error: ${e.message}`,"error")}this.log(`initializePluginOptions, configured plugin options: ${JSON.stringify(e.plugins)}`,"info")}getTextTracks(){let e=[];if(this.isControlsDisabled())e.push({id:"amp-player_default",kind:"captions",label:"default-text-track",src:"",srclang:"en"});else if(this.liveStreamOptions.supportedSubtitleLanguages){let t=this.liveStreamOptions.supportedSubtitleLanguages;for(let i=0;i<t.length;i++)e.push({id:`amp-player_${t[i].culture}`,kind:this.configProvider.config.textTrackKind,label:t[i].name||t[i].culture,src:"",srclang:t[i].culture.substr(0,2)})}return e}configureSdnSource(e,t){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn){switch(this.liveStreamOptions.sdn.name){case"hive":if(!t.sdnContext){e.sdnList=[];break}try{let i=JSON.parse(t.sdnContext);i.playbackinfo&&(e.sdnList=[{sdnName:"hive",sdnUrl:i.playbackinfo}])}catch(i){e.sdnList=[{sdnName:"hive",sdnUrl:t.sdnContext}]}break;case"kollective":if(!t.sdnContext){e.sdnList=[];break}try{let i=this.parseJson(t.sdnContext,"kollective sdn list context"),n=this.parseJson(i.playbackinfo,"kollective sdn list playback info"),r=this.parseJson(i.sdnConfig,"kollective sdn list sdn config");e.sdnList=[{sdnName:"kollectiveSDN",playbackInfo:n,sdnConfig:r}]}catch(t){e.sdnList=[],this.log(`configureSdnSource failed, error: ${t}`,"error");return}break;case"ramp":case"peer5":e.sdnList=[];break;default:return}this.log(`configureSdnSource, configured source context: ${JSON.stringify(e)}`,"info")}}registerPlayerEvents(){this.registerPlayerEvent(this.contextWindow.amp.eventName.error,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.error)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.canplaythrough,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.canplaythrough)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.play,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.play)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.playing,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.playing)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.pause,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.pause)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.resume,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.resume)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.start,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.start)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.ended,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.ended)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeking,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.seeking)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeked,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.seeked)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadedmetadata,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.loadedmetadata)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.waiting,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.waiting)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.playbackbitratechanged,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.playbackbitratechanged)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.downloadbitratechanged,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.downloadbitratechanged)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.fullscreenchange,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.fullscreenchange)}),this.registerPlayerEvent("potentialMediaFreeze",()=>{this.onAmpEvent("potentialMediaFreeze")}),this.registerPlayerEvent(this.contextWindow.amp.eventName.mute,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.mute)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.unmute,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.unmute)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.volumechange,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.volumechange)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadeddata,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.loadeddata)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadstart,()=>{this.onAmpEvent(this.contextWindow.amp.eventName.loadstart)}),Object.values(e).forEach(e=>{this.registerVideoEvent(e,t=>{this.handleUserExperienceErrorEvent(e,t.detail.data.details,t.detail.data.fatal)})}),this.configProvider.config.ampSettings.collectUserInitiatedSeekEventsTelemetry&&(this.playerEvents.push("currentTimeChanging"),this.playerInstance.addEventListener("currentTimeChanging",(e,t)=>this.onAmpCurrentTimeChangingEvent(e,t)))}onAmpCurrentTimeChangingEvent(e,t){if("currentTimeChanging"!==e.type||!t.time)return;let i={newCurrentPlayPosition:t.time};this.eventsHandler.message("stateChanged").send("UserInitiatedSeek",i)}registerPlayerEvent(e,t){this.playerEvents.push(e),this.playerInstance.addEventListener(e,t)}registerVideoEvent(e,t){this.videoElementEvents.push({name:e,callback:t}),this.video.addEventListener(e,t)}removePlayerEventListeners(){this.playerEvents.forEach(e=>{this.playerInstance.removeEventListener(e)})}removeVideoEventListeners(){this.videoElementEvents.forEach(e=>{this.video.removeEventListener(e.name,e.callback)})}onAmpEvent(e){let t,i;switch(e){case this.contextWindow.amp.eventName.error:i=this.playerInstance.error(),t={currentTime:this.playerInstance.currentTime(),errorCode:i?i.code:0,message:i?i.message:""};break;case this.contextWindow.amp.eventName.canplaythrough:this.initializeStatsColletion();break;case this.contextWindow.amp.eventName.loadedmetadata:this.captionsControl.initialize(),this.absoluteTimeOffsetEstimator&&this.absoluteTimeOffsetEstimator.restartStreamAbsoluteTimeOffsetRetrieval();break;case this.contextWindow.amp.eventName.fullscreenchange:t={isFullscreen:this.playerInstance.isFullscreen()};break;case this.contextWindow.amp.eventName.playbackbitratechanged:t={bitrate:this.playerInstance.currentPlaybackBitrate()};break;case this.contextWindow.amp.eventName.downloadbitratechanged:t={bitrate:this.playerInstance.currentDownloadBitrate()};break;case this.contextWindow.amp.eventName.seeked:t={captionsTimestamp:this.isControlsDisabled()?this.playerInstance.currentMediaTime():this.playerInstance.currentTime()};break;case this.contextWindow.amp.eventName.volumechange:t={value:this.playerInstance.volume()}}this.updatePlaybackDiagnostics(),this.updatePlayerState(e),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),this.eventsHandler.message("stateChanged").send(e,t)}updatePlayerState(e){this.updatePlayingState(e),this.updateBufferingState(e),this.updateCurrentVideoTrackBitrate(e),(e===this.contextWindow.amp.eventName.ended||e===this.contextWindow.amp.eventName.error)&&this.handlePlaybackStopped()}handleUserExperienceErrorEvent(e,t,i){let n={currentTime:this.video?this.video.currentTime:0,message:t,type:e,errorCode:0,fatal:i};this.updatePlaybackDiagnostics(),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),this.eventsHandler.message("stateChanged").send(this.contextWindow.amp.eventName.error,n)}updatePlayingState(e){this.isPlaying?(e===this.contextWindow.amp.eventName.pause||e===this.contextWindow.amp.eventName.seeking||e===this.contextWindow.amp.eventName.ended||e===this.contextWindow.amp.eventName.error||e===this.contextWindow.amp.eventName.waiting)&&(this.isPlaying=!1):e===this.contextWindow.amp.eventName.playing&&(this.isPlaying=!0)}updateBufferingState(e){this.isBuffering?(e===this.contextWindow.amp.eventName.pause&&this.playerInstance.currentTechName()?.toLowerCase()==="html5"||e===this.contextWindow.amp.eventName.seeking||e===this.contextWindow.amp.eventName.ended||e===this.contextWindow.amp.eventName.error||e===this.contextWindow.amp.eventName.playing)&&(this.isBuffering=!1):e===this.contextWindow.amp.eventName.waiting&&(this.isBuffering=!0)}updateCurrentVideoTrackBitrate(e){e===this.contextWindow.amp.eventName.playbackbitratechanged&&this.playerInstance.currentPlaybackBitrate()!==this.currentVideoPlaybackBitrate&&(this.currentVideoPlaybackBitrate=this.playerInstance.currentPlaybackBitrate(),this.updateVideoTrackHistoryStatistic())}initializeStatsColletion(){this.diagnosticProvider.initialize(),this.statsTimer=window.setInterval(()=>{this.eventsHandler&&(this.updatePlaybackDiagnostics(),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()))},this.statsInterval)}stopStatsCollection(){this.updatePlaybackDiagnostics(),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),-1!==this.statsTimer&&window.clearInterval(this.statsTimer),this.statsTimer=-1}updateVideoTrackHistoryStatistic(){let e=new Date;if(this.currentVideoPlaybackBitrate){let t=this.diagnosticProvider.getValue("videoTrackHistory"),i=this.diagnosticProvider.getValue("videoTrackTotalDurations");if(t.length>0&&this.currentVideoPlaybackBitrate===t[t.length-1].trackPlaybackBitrate){if(this.videoTrackHistoryUpdatedTimestamp){this.latestVideoTrackDuration+=(e.getTime()-this.videoTrackHistoryUpdatedTimestamp.getTime())/1e3,t[t.length-1].durationInSeconds=Number(this.latestVideoTrackDuration.toFixed(0));let n=this.videoTrackTotalDurations.find(e=>e.trackPlaybackBitrate===this.currentVideoPlaybackBitrate),r=i.find(e=>e.trackPlaybackBitrate===this.currentVideoPlaybackBitrate);n&&r&&(n.totalDurationInSeconds+=(e.getTime()-this.videoTrackHistoryUpdatedTimestamp.getTime())/1e3,r.totalDurationInSeconds=Number(n.totalDurationInSeconds.toFixed(0)))}}else{let n=this.playerInstance.videoBufferData(),r=null;if(n&&n.perceivedBandwidth&&(r=n.perceivedBandwidth),t.push({trackPlaybackBitrate:this.currentVideoPlaybackBitrate,trackSwitchTimestamp:e.getTime(),trackSwitchMeasuredBandwidth:this.diagnosticProvider?this.diagnosticProvider.getAverageMeasuredBandwidth():null,trackSwitchMeasuredByteSize:this.diagnosticProvider?this.diagnosticProvider.getAverageMeasuredVideoDownloadSize():null,trackSwitchPerceivedBandwidth:r,durationInSeconds:0}),this.latestVideoTrackDuration=0,t.length>this.configProvider.config.maxVideoTrackHistoryLogCount&&t.splice(0,1),!this.videoTrackTotalDurations.find(e=>e.trackPlaybackBitrate===this.currentVideoPlaybackBitrate)){let e={trackPlaybackBitrate:this.currentVideoPlaybackBitrate,totalDurationInSeconds:0},t={trackPlaybackBitrate:this.currentVideoPlaybackBitrate,totalDurationInSeconds:0};this.videoTrackTotalDurations.push(e),i.push(t)}}}this.videoTrackHistoryUpdatedTimestamp=e}updateTotalPlayingTimeStatistic(){let e=new Date;this.isPlaying&&this.totalPlayingTimeUpdatedTimestamp&&(this.totalPlayingTime+=e.getTime()-this.totalPlayingTimeUpdatedTimestamp.getTime()),this.totalPlayingTimeUpdatedTimestamp=e,this.diagnosticProvider.setValue("totalPlayingTimeInSeconds",Number((this.totalPlayingTime/1e3).toFixed(0)))}updateBufferingRateStatistic(){let e=new Date;this.isBuffering&&this.bufferingRateStatUpdatedTimestamp&&(this.totalBufferingTime+=e.getTime()-this.bufferingRateStatUpdatedTimestamp.getTime()),this.bufferingRateStatUpdatedTimestamp=e;let t=this.totalPlayingTime>0||this.totalBufferingTime>0?this.totalBufferingTime/(this.totalPlayingTime+this.totalBufferingTime):0;this.diagnosticProvider.setValue("bufferingRate",Number(t.toFixed(3)))}getPlayerDiagnostics(){let e=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return e.statsInterval=this.statsInterval,this.configProvider.config.debug&&(e.memoryLog=this.playerInstance.getMemoryLog(!0)),e}log(e,t="info"){let i=`[AmpPlayer${1===this.configProvider.config.loadType?"IFrame":""}]`,n=`${i}: ${e}`;this.configProvider.config.debug&&console.log(n),this.eventsHandler.message("log").send(t,n)}getElementLoadPromise(e,t){return new Promise((i,n)=>{e.onload=()=>{i("Element Load success")},e.onerror=()=>{n(`Failed to load script: ${t}`)}})}loadCss(e,t,i){let n=e.createElement("link"),r=this.getElementLoadPromise(n,t);return n.href=t,n.rel="stylesheet",i&&(n.nonce=i),e.head.appendChild(n),r}parseJson(e,t){try{return JSON.parse(e)}catch(e){throw this.log(`Error parsing JSON for ${t}, error: ${JSON.stringify(e)}`),e}}}}function iA(){let e=iR();return class{constructor(t,i){this.pipe=t,this.amp=new e(i,this)}processMessage(e){"Command"===e.msgType&&Promise.resolve().then(()=>this.amp[e.cmd].apply(this.amp,e.args)).then(t=>{this.pipe&&this.pipe.sendMsg({msgType:"CommandResult",cmd:e.cmd,result:JSON.stringify(t)})}).catch(t=>{this.pipe&&this.pipe.sendMsg({msgType:"CommandResult",cmd:e.cmd,error:t})})}message(e){return{send:this.fromMessage((...t)=>{this.sendMessageImpl(e,t)})}}ampDisposed(){this.pipe.dispose(),this.pipe=null,this.amp=null}fromMessage(e){return e}sendMessageImpl(e,t){this.pipe.sendMsg({msgType:"PlayerNotification",name:e,args:t})}}}iR();var iM=iA();function iD(){function e(e){return"CommandResult"===e.msgType}function t(e){let t="unknown";try{t="string"==typeof e?e:"toString"in e&&0!==e.toString().indexOf("[object")?e.toString():JSON.stringify(e)}catch(t){console.error("Failed to stringify error",e)}return t}return class{constructor(){this.processMsg=this.processMsg.bind(this),window.addEventListener("message",this.processMsg)}sendMsg(i){try{let n=i;e(i)&&i.error instanceof Event&&(console.debug("Stringifying error Event before trying to postMessage:",i),n={msgType:i.msgType,cmd:i.cmd,error:`Event: ${t(i.error)}`}),this.postMessage(n)}catch(n){console.error("Unexpected exception caught from postMessage.\n","message:",i,"\n","exception:",n);let e={msgType:"PlayerNotification",name:"log",args:["error",`Unexpected error with postMessage: ${t(n)}`]};throw this.postMessage(e),n}}registerObserver(e){this.observer=e}dispose(){window.removeEventListener("message",this.processMsg),this.observer=null}processMsg(e){this.observer.processMessage(e.data)}postMessage(e){window.parent.postMessage(e,"*")}}}function iO(){let e=iN();return class{constructor(t){this.playlistFileDownloadPromise=Promise.resolve(),this.playlistFileDownloadRetryWaitTime=250,this.playlistFileDownloadMaxRetryCount=20,this.playlistFileDownloadCancellationFlag=!1,this.logFn=(e,i)=>t(`[HlsAbsoluteTimeOffsetEstimator]: ${e}`,i),this.hlsFileParser=new e(t)}get absoluteTimeOffset(){return this.estimatedAbsoluteTimeOffset}setEstimationResultCallback(e){this.onAbsoluteTimeOffsetEstimation=e}restartStreamAbsoluteTimeOffsetRetrieval(){this.stopStreamAbsoluteTimeOffsetRetrieval().then(()=>this.startStreamAbsoluteTimeOffsetRetrieval())}setManifestFileURL(e){this.cachedManifestUrl=e}startStreamAbsoluteTimeOffsetRetrieval(){this.playlistFileDownloadPromise=this.retryPlaylistFileDownload(()=>this.estimateStreamTimeFromPlaylist(this.currentManifestUrl)).then(()=>{this.logFn(`Succeeded in downloading playlist files to estimate
                    absolute stream time offset as: ${this.estimatedAbsoluteTimeOffset}`)}).catch(e=>{this.logFn(`Failed to download playlist files to estimate absolute stream time offset: ${e.message}`,"error")})}stopStreamAbsoluteTimeOffsetRetrieval(){return this.playlistFileDownloadCancellationFlag=!0,this.playlistFileDownloadPromise.then(()=>{this.playlistFileDownloadCancellationFlag=!1,this.currentManifestUrl=this.cachedManifestUrl,this.cachedManifestUrl=null})}retryPlaylistFileDownload(e,t=0){Promise.resolve();return e().then(()=>(this.onAbsoluteTimeOffsetEstimation&&this.onAbsoluteTimeOffsetEstimation({timestamp:Date.now(),retries:t,isSuccess:!0,absoluteTimeOffsetEstimation:this.absoluteTimeOffset}),Promise.resolve())).catch(i=>(t++,this.logFn(`Error loading playlist file: ${i} -- attempt ${t}`),this.onAbsoluteTimeOffsetEstimation&&this.onAbsoluteTimeOffsetEstimation({timestamp:Date.now(),retries:t,isSuccess:!1,error:i.message}),t===this.playlistFileDownloadMaxRetryCount)?Promise.reject(Error(`${i} after ${t} attempts`)):this.playlistFileDownloadCancellationFlag?Promise.reject(Error("cancelling playlist file download")):new Promise(i=>setTimeout(()=>i(this.retryPlaylistFileDownload(e,t)),this.playlistFileDownloadRetryWaitTime)))}estimateStreamTimeFromPlaylist(e){return this.hlsFileParser.getStreamRenditionsUrlsFromManifest(e).then(t=>{if(0===t.audioRenditions.length&&0===t.videoRenditions.length)throw Error(`Unable to retrieve renditions URLs from manifest: ${e}`);return Promise.all([t.videoRenditions.length>0?this.hlsFileParser.getTextFileContent(t.videoRenditions[0]):Promise.resolve(null),t.audioRenditions.length>0?this.hlsFileParser.getTextFileContent(t.audioRenditions[0]):Promise.resolve(null)])}).then(e=>{let t;for(let i=0;i<e.length;i++){let n=e[i];if(n){this.logFn("Using segment duration and sequence number to calculate absolute time offset","debug");let e=this.hlsFileParser.getHlsFieldByName("SequenceNumber",n);if(0==e.length)throw Error("Unable to retrieve sequence number from playlist file");let i=this.hlsFileParser.getHlsFieldByName("SegmentDuration",n,10);if(0==i.length)throw Error("Unable to retrieve segment durations from playlist file");let r=i.map(Number);r.sort((e,t)=>e-t);let s=r[Math.floor(r.length/2)],a=Number(e[0])*Number(s);t=t?Math.max(t,a):a}}this.estimatedAbsoluteTimeOffset=t})}}}iD();var ik=iO();function iN(){return class{constructor(e){this.fieldNameRegexMap={BaseUrl:/(.*)\/.*/,AudioManifestFile:/#EXT-X-MEDIA:TYPE=AUDIO.*URI=\"(.*)\"/,SequenceNumber:/#EXT-X-MEDIA-SEQUENCE:(\d+)/,SegmentDuration:/#EXTINF:(\d+(\.\d+)?)/},this.logFn=(t,i)=>e(`[HlsFileParser]: ${t}`,i)}getHlsFieldByName(e,t,i=1){let n=[];for(let r=1;r<=i;r++){let i=this.fieldNameRegexMap[e].exec(t);if(i&&i.length>0)n.push(i[1]),t=t.substring(i.index+i[0].length);else break}return n}getStreamRenditionsUrlsFromManifest(e){return e?this.getTextFileContent(e).then(t=>{let i={audioRenditions:[],videoRenditions:[]},n=t.split("\n"),r=this.getHlsFieldByName("BaseUrl",e);for(let e=0;e<n.length;e++)if(n[e].includes("#EXT-X-STREAM-INF")){let t=n[e+1];t.includes("http")?i.videoRenditions.push(t):r.length>0&&i.videoRenditions.push(`${r[0]}/${t}`)}else if(n[e].includes("EXT-X-MEDIA:TYPE")){let t=this.getHlsFieldByName("AudioManifestFile",n[e]);if(t.length>0){let e=t[0];e.includes("http")?i.audioRenditions.push(e):r.length>0&&i.audioRenditions.push(`${r[0]}/${e}`)}}return i}).catch(e=>(this.logFn(`Failed to extract stream renditions from manifest, error: ${e.message}`,"error"),{audioRenditions:[],videoRenditions:[]})):(this.logFn("No manifest URL provided to parse"),Promise.resolve({audioRenditions:[],videoRenditions:[]}))}getTextFileContent(e){return fetch(e).then(t=>{if(!t.ok)throw Error(`http-error ${t.status} when downloading: ${e}`);return t.text()}).catch(e=>(this.logFn(`Error downloading resource: ${e}`,"error"),Promise.reject(e)))}}}function ix(){return class{constructor(e,t,i,n,r){this.playerInstance=e,this.contextWindow=t,this.streamingStartedTimestamp=i,this.configProvider=n,this.absoluteTimeOffsetEstimator=r,this.currentDiagnosticSnapshot={playerType:0,currentPlayPosition:null,tech:null,perceivedBandwidth:null,playerHeight:null,playerWidth:null,mediaHeight:null,mediaWidth:null,windowHeight:null,windowWidth:null,videoStream:null,audioStream:null,totalDurationInSeconds:null,avgVideoDownloadLatency:null,avgAudioDownloadLatency:null,avgVideoDownloadBytes:null,avgAudioDownloadBytes:null,avgAudioDownloadBandwidth:null,avgVideoDownloadBandwidth:null,maxVideoDownloadBytes:null,minVideoDownloadBytes:null,videoDownloadSuccessCount:null,audioDownloadSuccessCount:null,videoDownloadFailureCount:null,audioDownloadFailureCount:null,videoBufferLength:null,videoCachedLength:null,audioBufferLength:null,audioCachedLength:null,videoEdgeLatency:null,audioEdgeLatency:null,playbackRate:null,playbackBitrate:null,downloadBitrate:null,audioDownloadBitrate:null,audioPlaybackBitrate:null,isFullscreen:null,streamType:null,playerVersion:null,isP2PSdnUsed:null,sdnName:null,livePosition:null,muted:null,volume:null,errorCode:null,currentMediaTime:null,currentAbsoluteTime:null,absoluteTimeOffsetEstimationResults:null,estimatedAbsoluteTimeOffset:null,videoDownloadFailures:null,audioDownloadFailures:null,heuristicProfile:null,encryption:null,retryFrequency:null,averageDownloadBitrate:null,totalDownloadedBytes:0,streamId:null,streamUrl:null,streamingEventType:null,playerControlsEnabled:null,streamDeliveryPipeline:null,retryCount:0,totalPlayingTimeInSeconds:0,bufferingRate:0,videoTrackHistory:[],videoTrackTotalDurations:[],memoryLog:null,statsInterval:null},this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.audioDownloadBandwidths=[],this.videoDownloadBandwidths=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailures=[],this.videoDownloadFailures=[],this.totalDownloadedBytes=0,this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=30,this.slidingWindowLengthForDownloadBandwidth=10,this.absoluteTimeOffsetEstimationResults=[],this.downloadFailuresLimit=10,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}initialize(){this.playerVideoBuffer=this.playerInstance.videoBufferData(),this.playerAudioBuffer=this.playerInstance.audioBufferData(),this.registerForPlayerBufferEvents()}setValue(e,t){this.currentDiagnosticSnapshot[e]=t}getValue(e){return this.currentDiagnosticSnapshot[e]}appendAbsoluteTimeOffsetEstimation(e){this.absoluteTimeOffsetEstimationResults.push(e),this.absoluteTimeOffsetEstimationResults.length>this.configProvider.config.ampSettings.maxAbsoluteTimeOffsetEstimationResultsLogCount&&this.absoluteTimeOffsetEstimationResults.splice(0,1)}getPlayerDiagnosticSnapshot(){if(!this.playerInstance)return null;let e=window.screen,t=this.playerInstance.error(),i=e=>{let t=e.slice().sort();return t[Math.floor(t.length/2)]};this.currentDiagnosticSnapshot.errorCode=t&&t.code||0,this.currentDiagnosticSnapshot.currentPlayPosition=this.playerInstance.currentTime(),this.currentDiagnosticSnapshot.currentMediaTime=this.playerInstance.currentMediaTime()??this.playerInstance.currentTime(),this.currentDiagnosticSnapshot.currentAbsoluteTime=this.getCurrentAbsoluteTime(),this.currentDiagnosticSnapshot.absoluteTimeOffsetEstimationResults=this.absoluteTimeOffsetEstimationResults,this.currentDiagnosticSnapshot.estimatedAbsoluteTimeOffset=this.getCurrentAbsoluteTimeOffset(),this.currentDiagnosticSnapshot.playbackBitrate=this.playerInstance.currentPlaybackBitrate(),this.currentDiagnosticSnapshot.downloadBitrate=this.playerInstance.currentDownloadBitrate(),this.currentDiagnosticSnapshot.audioDownloadBitrate=this.lastAudioDownloadBitrate,this.currentDiagnosticSnapshot.perceivedBandwidth=this.playerVideoBuffer?this.playerVideoBuffer.perceivedBandwidth:0,this.currentDiagnosticSnapshot.tech=this.playerInstance.currentTechName(),this.currentDiagnosticSnapshot.playerVersion=this.playerInstance.getAmpVersion(),this.currentDiagnosticSnapshot.isP2PSdnUsed=this.isP2PSdnUsed(),this.currentDiagnosticSnapshot.sdnName=this.sdnName(),this.currentDiagnosticSnapshot.heuristicProfile=this.playerInstance.currentHeuristicProfile(),this.currentDiagnosticSnapshot.encryption=this.playerInstance.currentProtectionInfo()?this.playerInstance.currentProtectionInfo().type:"",this.currentDiagnosticSnapshot.streamType=this.getStreamType(this.currentDiagnosticSnapshot.streamType),this.currentDiagnosticSnapshot.totalDurationInSeconds=this.getTotalDurationInSeconds(),this.currentDiagnosticSnapshot.audioStream=this.getAudioStreamData(),this.currentDiagnosticSnapshot.videoStream=this.getVideoStreamData(),this.currentDiagnosticSnapshot.muted=this.playerInstance.muted(),this.currentDiagnosticSnapshot.volume=this.playerInstance.volume(),this.currentDiagnosticSnapshot.playbackRate=this.playerInstance.playbackRate();let n=this.getPlayerCachedLength(),r=this.getPlayerEdgeLatency();this.currentDiagnosticSnapshot.audioBufferLength=this.playerAudioBuffer?this.playerAudioBuffer.bufferLevel:0,this.currentDiagnosticSnapshot.audioCachedLength=n,this.currentDiagnosticSnapshot.audioEdgeLatency=r,this.currentDiagnosticSnapshot.videoBufferLength=this.playerVideoBuffer?this.playerVideoBuffer.bufferLevel:0,this.currentDiagnosticSnapshot.videoCachedLength=n,this.currentDiagnosticSnapshot.videoEdgeLatency=r,this.currentDiagnosticSnapshot.livePosition=this.getLivePosition(),this.currentDiagnosticSnapshot.mediaHeight=this.playerInstance.videoHeight(),this.currentDiagnosticSnapshot.mediaWidth=this.playerInstance.videoWidth(),this.currentDiagnosticSnapshot.playerHeight=this.playerInstance.height(),this.currentDiagnosticSnapshot.playerWidth=this.playerInstance.width(),this.currentDiagnosticSnapshot.windowHeight=e?e.height:0,this.currentDiagnosticSnapshot.windowWidth=e?e.width:0,this.currentDiagnosticSnapshot.isFullscreen=this.playerInstance.isFullscreen(),this.currentDiagnosticSnapshot.avgAudioDownloadLatency=i(this.audioDownloadLatencies),this.currentDiagnosticSnapshot.avgVideoDownloadLatency=i(this.videoDownloadLatencies),this.currentDiagnosticSnapshot.avgAudioDownloadBytes=i(this.audioDownloadBytes),this.currentDiagnosticSnapshot.avgVideoDownloadBytes=i(this.videoDownloadBytes),this.currentDiagnosticSnapshot.maxVideoDownloadBytes=Math.max.apply(null,this.videoDownloadBytes),this.currentDiagnosticSnapshot.minVideoDownloadBytes=Math.min.apply(null,this.videoDownloadBytes),this.currentDiagnosticSnapshot.avgAudioDownloadBandwidth=i(this.audioDownloadBandwidths),this.currentDiagnosticSnapshot.avgVideoDownloadBandwidth=i(this.videoDownloadBandwidths),this.currentDiagnosticSnapshot.audioDownloadFailureCount=this.audioDownloadFailureCount,this.currentDiagnosticSnapshot.audioDownloadSuccessCount=this.audioDownloadSuccessCount,this.currentDiagnosticSnapshot.videoDownloadFailureCount=this.videoDownloadFailureCount,this.currentDiagnosticSnapshot.videoDownloadSuccessCount=this.videoDownloadSuccessCount,this.currentDiagnosticSnapshot.audioDownloadFailures=this.audioDownloadFailures,this.currentDiagnosticSnapshot.videoDownloadFailures=this.videoDownloadFailures,this.currentDiagnosticSnapshot.totalDownloadedBytes=this.totalDownloadedBytes,this.currentDiagnosticSnapshot.retryFrequency=this.getRetryFrequency(),this.currentDiagnosticSnapshot.averageDownloadBitrate=this.getAverageDownloadBitrate();let s=this.getDiagnosticWritableField();return Object.keys(s).forEach(e=>{this.currentDiagnosticSnapshot[e]=s[e]}),this.currentDiagnosticSnapshot}getDiagnosticWritableField(){return{streamUrl:this.currentDiagnosticSnapshot.streamUrl,streamId:this.currentDiagnosticSnapshot.streamId,streamingEventType:this.currentDiagnosticSnapshot.streamingEventType,playerControlsEnabled:this.currentDiagnosticSnapshot.playerControlsEnabled,streamDeliveryPipeline:this.currentDiagnosticSnapshot.streamDeliveryPipeline,retryCount:this.currentDiagnosticSnapshot.retryCount,totalPlayingTimeInSeconds:this.currentDiagnosticSnapshot.totalPlayingTimeInSeconds,bufferingRate:this.currentDiagnosticSnapshot.bufferingRate,videoTrackHistory:this.currentDiagnosticSnapshot.videoTrackHistory,videoTrackTotalDurations:this.currentDiagnosticSnapshot.videoTrackTotalDurations,eventId:this.currentDiagnosticSnapshot.eventId||"",templateId:this.currentDiagnosticSnapshot.templateId||""}}dispose(){this.unsubscribeFromPlayerBufferEvents()}registerForPlayerBufferEvents(){this.playerVideoBuffer&&(this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))}unsubscribeFromPlayerBufferEvents(){this.playerVideoBuffer&&(this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))}isP2PSdnUsed(){return!!this.sdnName()}sdnName(){let e="options_";return this.playerInstance[e]&&this.playerInstance[e].sdn&&this.playerInstance[e].sdn.name}getStreamType(e){let t="";return(this.playerInstance&&(t=this.playerInstance.isLive()?"LIVE":"DVR"),""===t||"LIVE"===e&&t!==e)?e||"":t}getCurrentAbsoluteTime(){return this.absoluteTimeOffsetEstimator?this.absoluteTimeOffsetEstimator.absoluteTimeOffset?this.absoluteTimeOffsetEstimator.absoluteTimeOffset+this.playerInstance.currentTime():this.playerInstance.currentTime():this.playerInstance.currentAbsoluteTime()??this.playerInstance.currentTime()}getCurrentAbsoluteTimeOffset(){return this.getCurrentAbsoluteTime()-this.playerInstance.currentTime()}getTotalDurationInSeconds(){return Number(((new Date().getTime()-this.streamingStartedTimestamp.getTime())/1e3).toFixed(0))}onVideoDownloadCompleted(){this.videoDownloadSuccessCount++,this.addToList(this.videoDownloadLatencies,this.playerVideoBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.videoDownloadBytes,this.playerVideoBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes),this.addToList(this.videoDownloadBandwidths,8*this.playerVideoBuffer.downloadCompleted.totalBytes*1e3/this.playerVideoBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForDownloadBandwidth),this.totalDownloadedBytes+=this.playerVideoBuffer.downloadCompleted.totalBytes}onAudioDownloadCompleted(){this.audioDownloadSuccessCount++,this.addToList(this.audioDownloadLatencies,this.playerAudioBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.audioDownloadBytes,this.playerAudioBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes),this.addToList(this.audioDownloadBandwidths,8*this.playerAudioBuffer.downloadCompleted.totalBytes*1e3/this.playerAudioBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForDownloadBandwidth),this.totalDownloadedBytes+=this.playerAudioBuffer.downloadCompleted.totalBytes;let e=this.playerAudioBuffer.downloadCompleted.mediaDownload.bitrate;e!==this.lastAudioDownloadBitrate&&(this.lastAudioDownloadBitrate=e)}addToList(e,t,i){e.push(t),e.length>i&&e.shift()}onVideoDownloadError(){this.videoDownloadFailureCount++,this.addDownloadFailureInfo(this.playerVideoBuffer.downloadFailed,this.videoDownloadFailures)}onAudioDownloadError(){this.audioDownloadFailureCount++,this.addDownloadFailureInfo(this.playerAudioBuffer.downloadFailed,this.audioDownloadFailures)}addDownloadFailureInfo(e,t){let i={bitrate:e.mediaDownload.bitrate,errorCode:e.code,mediaTime:e.mediaDownload.mediaTime,message:e.message,timestamp:Date.now()};this.addToList(t,i,this.downloadFailuresLimit)}getAudioStreamData(){let e=this.playerInstance.currentAudioStreamList();if(e)try{let t=e.streams[e.enabledIndices[0]];return{bitrate:t.bitrate,codec:t.codec,enabled:t.enabled,name:t.name,language:t.language}}catch(e){return}}getVideoStreamData(){let e=this.playerInstance.currentVideoStreamList();if(e)try{let t=e.streams[e.selectedIndex],i=this.playerInstance.currentPlaybackBitrate(),n=e=>({bitrate:e.bitrate,height:e.height,id:e.id,selectable:e.selectable,width:e.width}),r=t.tracks?t.tracks.map(n).find(e=>e.bitrate===i):null;return{codec:t.codec,name:t.name,currentTrack:r}}catch(e){return}}getLivePosition(){let e=this.playerInstance.buffered();if(0===e.length)return 0;let t=e.end(0);for(let i=1;i<e.length;i++)t=Math.max(t,e.end(i));return t}getAverageDownloadBitrate(){if(this.streamingStartedTimestamp&&this.totalDownloadedBytes){let e=(new Date().getTime()-this.streamingStartedTimestamp.getTime())/1e3;if(e>0)return 8*this.totalDownloadedBytes/e}return 0}getRetryFrequency(){let e=this.currentDiagnosticSnapshot.retryCount;if(this.streamingStartedTimestamp&&e){let t=(new Date().getTime()-this.streamingStartedTimestamp.getTime())/6e4;if(t>0)return e/t}return 0}getAverageMeasuredBandwidth(){if(0===this.videoDownloadBandwidths.length)return null;let e=0;for(let t=0;t<this.videoDownloadBandwidths.length;t++)e+=this.videoDownloadBandwidths[t];return e/this.videoDownloadBandwidths.length}getAverageMeasuredVideoDownloadSize(){if(0===this.videoDownloadBytes.length)return null;let e=0;for(let t=0;t<this.videoDownloadBytes.length;t++)e+=this.videoDownloadBytes[t];return e/this.videoDownloadBytes.length}getPlayerCachedLength(){let e=this.playerInstance.buffered(),t=0;for(let i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return t}getPlayerEdgeLatency(){let e=this.playerInstance.buffered();if(0===e.length)return 0;let t=e.end(0);for(let i=1;i<e.length;i++)t=Math.max(t,e.end(i));return t-this.playerInstance.currentTime()}}}function iL(){return class{constructor(e,t,i,n){this.player=e,this.toggleListener=t,this.config=i,this.diagnosticProvider=n,this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.isHtml5Tech=this.player.currentTechName()?.toLowerCase()==="html5"}dispose(){this.unsubscribeFromTrackEvents(),this.player=null,this.toggleListener=null}initialize(){let e=this.getPlayerTextTracksAsArray();if(!this.config.controlsEnabled&&e.length>0)e[0].mode="showing";else for(let t=0;t<e.length;t++)e[t].mode="disabled";this.subscribeOnTrackEvents()}addCues(e){let t=this.player.getCurrentTextTrack();if(!t)return;let i=this.getCurrentAbsoluteTime()||1,n=this.getCurrentTime(),r=this.config.controlsEnabled?i-n:Math.max(i-n,0),s=this.isHtml5Tech?window.VTTCue:window.vttjs&&window.vttjs.VTTCue||window.VTTCue;for(let i=0;i<e.length;i++){let{start:n,end:a,text:o}=e[i],l=2,c=new s(Number((n-r).toFixed(l)),Number((a-r).toFixed(l)),o);c.size=100,this.containsCue(t,c)||t.addCue(c)}}clearCues(){let e=this.player.getCurrentTextTrack();if(e)try{if(e.activeCues&&e.removeCue)for(;e.activeCues.length>0;)e.removeCue(e.activeCues[0]);let t="setCues_";if(e.cues[t]){e.cues_&&(e.cues_.length=0),e.cues[t]([]);let i=Object.getOwnPropertyNames(e.cues);for(let t=0;t<i.length;t++)"length"!==i[t]&&"length_"!==i[t]&&"cues_"!==i[t]&&delete e.cues[i[t]]}}catch(e){this.config.logFn(`[clearCues]: ${e}`,"warn")}}showCaptions(e){this.config.logFn(`[CaptionsControl]: showCaptions(${e})`),e?this.show():this.hide()}hide(){this.previouslyVisibleTextTrack=this.player.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="disabled"),this.player.captionToggle&&this.player.captionToggle.hide&&this.player.captionToggle.hide(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.hide&&this.player.MoreOptionscaptionSubtitleButton.hide(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.hide&&this.player.MoreOptionscaptionSettingsButton.hide()}show(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="showing"),this.player.captionToggle&&this.player.captionToggle.show&&this.player.captionToggle.show(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.show&&this.player.MoreOptionscaptionSubtitleButton.show(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.show&&this.player.MoreOptionscaptionSettingsButton.show()}subscribeOnTrackEvents(){let e=this.player.textTracks(),t="addEventListener";e&&e[t]&&(this.config.controlsEnabled&&e[t]("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&e[t]("addtrack",this.onAddTrack.bind(this)))}unsubscribeFromTrackEvents(){let e=this.player.textTracks(),t="removeEventListener";e&&e[t]&&(this.config.controlsEnabled&&e[t]("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&e[t]("addtrack",this.onAddTrack.bind(this)))}onTextTrackChanged(){let e=this.player.getCurrentTextTrack();if(!e||!this.currentTextTrack||this.currentTextTrack.label!==e.label||this.currentTextTrack.mode!==e.mode){if(e||this.currentTextTrack){let t=!!e&&"showing"===e.mode,i=this.getCulture(e||this.currentTextTrack),n=this.getCurrentTime();this.toggleListener.captionsToggled(t,i,n),this.config.logFn(`[CaptionsControl]: track changed: culture '${i}', timestamp '${n}'`)}this.currentTextTrack=e}}onAddTrack(e){let t=e?.track;t?.kind!=="captions"||t.label||t.id||(this.player?.textTracks_?.removeTrack_(t),this.config.logFn("[CaptionsControl]: removing default empty text track"))}getCurrentTime(){return this.isHtml5Tech?this.player.currentTime():(this.config.controlsEnabled?this.player.currentTime():this.player.currentMediaTime())||1}getCurrentAbsoluteTime(){return this.diagnosticProvider.getCurrentAbsoluteTime()}getCulture(e){if(!e)return"";if(e.id){let t=e.id.split("_")[1];if(t)return t}return""}getPlayerTextTracksAsArray(){let e=this.player.textTracks(),t="tracks_";return e&&e[t]||[]}containsCue(e,t){return Array.from(e?.cues||[]).some(e=>this.areCueEquals(e,t))}areCueEquals(e,t){function i(e){return{start:e.start?e.start:e.startTime,end:e.end?e.end:e.endTime,text:e.text}}let n=i(e),r=i(t);return n.start===r.start&&n.end===r.end&&n.text===r.text}}}function iF(){let e=iD(),t=iA(),i=new e,n=new t(i,document.body);i.registerObserver(n)}function iU(){let e=`(${iF.toString()})();`;return e+(iR.toString()+";"+iD.toString()+";"+iA.toString()+";"+iL.toString()+";"+ix.toString()+";"+iO.toString()+";"+iN.toString()+";//# sourceURL=TsCallingAmpPlayer.js")}iN(),ix(),iL();var i$=class{sendMsg(e){this.peer.onMsg(e)}registerObserver(e){this.observer=e}onMsg(e){this.observer&&this.observer.processMessage(e)}connect(e){this.peer=e}dispose(){this.peer=null,this.observer=null}},iV=class{constructor(e){this.container=e}get contextWindow(){return this.container.ownerDocument.defaultView}sendMsg(e){this.iframe?.contentWindow?.postMessage(e,"*")}registerObserver(e){this.observer=e}dispose(){this.contextWindow&&this.contextWindow.removeEventListener("message",this.processMsg),this.iframe&&this.container.hasChildNodes()&&this.container.removeChild(this.iframe),this.iframe=null}initializeAmpIframe(e){let t=this.initializeIframe();return this.setAmpIframeContent(e),this.finalizeIframe(t)}initializeIframe(){let e=new iE;return this.iframe=this.container.ownerDocument.createElement("iframe"),this.iframe.id="player-iframe",this.iframe.sandbox.add("allow-scripts"),this.iframe.allowFullscreen=!0,this.iframe.allow="camera; microphone; autoplay",this.iframe.style.height="100%",this.iframe.style.width="100%",this.iframe.style.border="none",this.iframe.onload=()=>{e.resolve()},this.iframe.onerror=()=>{e.reject("iframe load failed")},e}finalizeIframe(e){return this.container.appendChild(this.iframe),this.processMsg=this.processMsg.bind(this),this.contextWindow.addEventListener("message",this.processMsg),e.promise}processMsg(e){"null"===e.origin&&e.source===this.iframe.contentWindow&&this.observer&&("RequestIceCandidates"===e.data?this.observer.processMessage({msgType:"Command",cmd:"getIceCandidates",args:[]}):this.observer.processMessage(e.data))}setAmpIframeContent(e){let t=iU(),i=e?`<script nonce='${e}'> ${t}</script>`:`<script> ${t}</script>`,n=`
            <html class style='height: 100%; width: 100%; overflow: hidden'>
            <head></head>
            <body class style='height: 100%; width: 100%; margin: 0px'>
                ${i}
            </body>
            </html>
        `;this.iframe.srcdoc=n}};async function iB(e,t,i){if(0===t){let t=new i$,i=new i$;return t.connect(i),i.connect(t),i.registerObserver(new iM(i,e)),t}if(1===t){let t=new iV(e);return await t.initializeAmpIframe(i),t}throw Error(`Unsupported communication type ${t}`)}var iH=class extends tZ{constructor(e){super(e),this.logger=e,this.resultsMap=new Map,this.on("log",(e,t)=>{this.logger[e](t)})}async initialize(e,t,i,n){let r={config:i.config,playerConfig:i.playerConfig},s=i.playerConfig?.nonce||"";this.pipe=await iB(e,i.config.loadType,s),this.pipe.registerObserver(this),await this.message("configure").send(t,r,n)}message(e){return{send:this.fromMessage((...t)=>this.sendMessageImpl(e,...t))}}dispose(){super.dispose(),this.pipe.sendMsg(this.buildMsg("dispose")),this.pipe.dispose()}processMessage(e){let t;switch(e.msgType){case"CommandResult":(t=this.getDeferred(e.cmd.toString()))&&(e.error?(t.reject(e.error),this.logger.warn(`remote command failed: ${String(e.cmd)}, ${e.error}`)):e.result?t.resolve(e.result):t.resolve(),this.processCommandResult(e),this.resultsMap.delete(e.cmd.toString()));break;case"PlayerNotification":{let t=this.event(e.name);t.raise.apply(t,e.args);break}case"Command":this.processCommand(e).catch(t=>this.logger.warn(`error while processing command: ${JSON.stringify(e)}: ${t}`));break;default:this.logger.warn(`unexpected message received: ${JSON.stringify(e)}`)}}async processCommand(e){"getIceCandidates"===e.cmd.toString()?await this.message("getIceCandidates").send():this.logger.warn(`unsupported command received: ${JSON.stringify(e)}`)}processCommandResult(e){"getIceCandidates"===e.cmd.toString()?this.pipe.sendMsg({topic:"RequestIceCandidates",candidates:e.result}):this.logger.debug(`ignoring command result for: ${JSON.stringify(e)}`)}fromMessage(e){return e}sendMessageImpl(e,...t){return this.pipe.sendMsg(this.buildMsg(e,t)),this.waitForCompletion(e.toString())}buildMsg(e,t){return{msgType:"Command",cmd:e,args:t}}getDeferred(e){return this.resultsMap.get(e)}waitForCompletion(e){let t=this.getDeferred(e);t&&t.reject(Error(`function ${e} is invoked again, before previous call is completed`));let i=new iE;return this.resultsMap.set(e,i),i.promise}},ij=class extends tZ{constructor(e,t){super(),this.player=e,this.logger=t,this.playerSubs=[],this.subscribeForPlayerEvents()}get isRendering(){return!!this.player&&this.player.isRendering()}get streamSize(){return this.player?this.player.getStreamSize():{width:0,height:0}}get rendererType(){return 0}get frameType(){return -1}seek(e){this.player.seek(e)}seekToLiveEdge(){this.player.seekToLiveEdge()}play(){this.player.play()}pause(){this.player.pause()}setVolume(e){this.player.setVolume(e)}selectVideoTrack(e){this.player.selectVideoTrack(e)}dispose(){this.stopPlayer(),super.dispose()}captions(){return this.player.getCaptionsControl()}getStats(){throw Error("Method not implemented.")}setScalingMode(e,t){throw Error("Method not implemented.")}captureFrame(e,t){throw Error("Method not implemented.")}stopPlayer(){let e=this.player;this.player=null,e&&(this.logger.info("stopPlayer"),this.unsubscribeFromPlayerEvents(),e.stop())}subscribeForPlayerEvents(){this.playerSubs.push(this.player.on("fullscreenToggled",e=>this.onFullScreenToggled(e))),this.playerSubs.push(this.player.on("captionsToggled",(e,t,i)=>this.onCaptionsToggled(e,t,i))),this.playerSubs.push(this.player.on("playbackTimeUpdated",e=>this.onPlaybackTimeUpdated(e))),this.playerSubs.push(this.player.on("videoTracksChanged",e=>this.onVideoTracksChanged(e))),this.playerSubs.push(this.player.on("captionReceived",e=>this.onCaptionReceived(e)))}unsubscribeFromPlayerEvents(){for(let e of this.playerSubs)e.dispose();this.playerSubs=[]}onFullScreenToggled(e){this.event("fullScreenToggled").raise(e)}onCaptionsToggled(e,t,i){this.logger.info(`Turned captions ${e?"ON":"OFF"} for culture [${t}] at player time [${i}]`),this.event("captionsToggled").raise(e,t,i)}onPlaybackTimeUpdated(e){this.event("playbackTimeUpdated").raise(e)}onVideoTracksChanged(e){this.event("videoTracksUpdated").raise(e)}onCaptionReceived(e){this.event("captionReceived").raise(e)}},iq=class{constructor(e,t){this.player=e,this.availableCultures=t,this.selectedCulture="",this.disposable=this.player.on("captionsToggled",(e,t,i)=>{this.selectedCulture=e?t:""})}async addCues(e){await this.player.message("addCues").send(e)}async clearCues(){await this.player.message("clearCues").send()}async showCaptions(e){await this.player.message("showCaptions").send(e)}getSelectedCulture(){return this.selectedCulture}getAvailableCultures(){return this.availableCultures}dispose(){this.disposable.dispose(),this.player=null}};function iW(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function iG(e){return RegExp("^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$").test(e)&&36===e.length}var iz=[2097152,2097552,2097556,2097557,2097564,2097652,2097654,2097655,2097656,2097752,3145728,4194305,4194306,4194307,4194308,4194309,5242880,5242881,5242882,5242884,5242885,5242886],iJ=2097753,iK=class extends tZ{constructor(e,t,i){super(),this.logger=e,this.liveStreamStatistic=t,this.configProvider=i,this.playerState="Destroyed",this.retryCount=0,this.captionsTimestamp=0,this.isSwitchStreamingUrlOngoing=!1,this.streamingUrlSwitchCount=0,this.isPlaybackUnsupported=!1,this.noMediaTimeoutId=-1,this.lastPlaybackError=void 0,this.id=iW(),this.logger.info(`AmpLiveStreamPlayer created: ID: ${this.id}`)}get playerId(){return this.id}async configure(e){if(!iv(e.stream)&&!iv(e.altStream))return void this.logger.error("Invalid Live Stream configuration provided: no valid primary or alternative stream");this.logger.info("Live Stream configuration provided"),this.liveStreamOptions=e;let t=iv(e.stream)?e.stream:e.altStream;if(!this.playerInstance||this.isPlaybackUnsupported){this.selectedStreamDetails=t;return}try{await this.playerInstance.message("configure").send(e)}catch(t){let e=t$(t);this.logger.error(`configure failed: ${e}`)}await this.handleStreamInfoUpdate(t)}async loadPlayer(e){let t;if(this.playerInstance)return this.logger.error("playerLoadFailed: cannot load a player while current one is still active"),{setupSucceeded:!1,playerSetupError:{errorType:"MultiplePlayerLoad",errorMessage:"cannot load a player while current one is still active"}};if(!this.liveStreamOptions||!this.selectedStreamDetails||!iv(this.selectedStreamDetails))return this.logger.error("playerLoadFailed: empty/invalid primary and alternate stream info configured"),{setupSucceeded:!1,playerSetupError:{errorType:"InvalidStream",errorMessage:"empty/invalid primary and alternate stream info configured"}};this.playerInstance=new iH(this.logger.createChild("AmpPlayerWrapper")),this.playerInstance.on("stateChanged",(e,t)=>this.ampStateChanged(e,t)),this.playerInstance.on("captionsToggled",(e,t,i)=>this.captionsToggled(e,t,i)),this.playerInstance.on("statsUpdated",e=>this.liveStreamStatistic.registerStatsUpdated(e));let i=this.configProvider.config.ampSettings.noMediaTimeoutMs;-1!==i&&-1===this.noMediaTimeoutId&&(this.noMediaTimeoutId=self.setTimeout(()=>this.callDropDueToMediaTimeout(),i)),await this.playerInstance.initialize(e,this.liveStreamOptions,this.configProvider,this.id),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.liveStreamStatistic.registerEventLoadAttempt("LoadScript"),this.srcLoadPromise||(this.srcLoadPromise=this.playerInstance.message("loadPlayerScript").send());try{t=await this.srcLoadPromise}catch(i){let e=t$(i);return this.logger.error(`playerLoadFailed: player scripts load failed: ${e}`),this.liveStreamStatistic.registerEventLoadFailed("LoadScript",`Load Script failed: ${i}`),this.liveStreamStatistic.registerPlayerLoadFailed(`script load failed: ${t}`),this.srcLoadPromise=null,{setupSucceeded:!1,playerSetupError:{errorType:"PlayerScriptLoadFailed",errorMessage:e}}}this.liveStreamStatistic.registerEventLoadSucceeded("LoadScript"),await this.tryLoadSdnPlugin(),this.liveStreamStatistic.registerEventLoadAttempt("CreateAmp");try{await this.playerInstance.message("createAmp").send()}catch(i){let e=t$(i);return this.logger.error(`playerLoadFailed: createAmp failed: ${e}`),this.liveStreamStatistic.registerEventLoadFailed("CreateAmp",`createAmp failed: ${i}`),this.liveStreamStatistic.registerPlayerLoadFailed(`create amp failed ${e}, script load: ${t}`),{setupSucceeded:!1,playerSetupError:{errorType:"PlayerInitializationFailed",errorMessage:e}}}this.liveStreamStatistic.registerEventLoadSucceeded("CreateAmp");try{return await this.setPlayerSource(this.selectedStreamDetails),this.loadSucceeded=!0,this.logger.info(`loadPlayer succeeded: ${this.loadSucceeded}`),this.liveStreamStatistic.registerPlayerLoadSucceeded(t),this.playerState="Initialized",{setupSucceeded:this.loadSucceeded}}catch(i){let e=t$(i);return this.loadSucceeded=!1,this.logger.error(`loadPlayer succeeded: ${this.loadSucceeded}: setSource failed: ${e}`),this.liveStreamStatistic.registerPlayerLoadFailed(`setPlayerSource failed; script load: ${t}`),{setupSucceeded:this.loadSucceeded,playerSetupError:{errorType:"SetSourceFailed",errorMessage:e}}}}getRenderer(){return!this.renderer&&this.playerInstance&&(this.renderer=new ij(this,this.logger.createChild("LiveStreamRenderer"))),this.renderer}seek(e){throw Error(`Method not implemented - cannot perform video seek operation with args: [timestamp: ${e}]`)}seekToLiveEdge(){throw Error("Method not implemented - cannot perform video seek to live edge operation")}play(){throw Error("Method not implemented - cannot perform video play operation")}pause(){throw Error("Method not implemented - cannot perform video pause operation")}setVolume(e){throw Error(`Method not implemented - cannot set video volume with args: [volume: ${e}]`)}selectVideoTrack(e){throw Error(`Method not implemented - cannot select video track with args: [track: ${e}]`)}stop(){this.destroy("PlayerStopped")}getPlaybackState(){return this.playerState}getCaptionsTimestamp(){return this.captionsTimestamp}getCaptionsControl(){if(!this.captionsControl&&this.playerInstance){let e=this.liveStreamOptions.supportedSubtitleLanguages?this.liveStreamOptions.supportedSubtitleLanguages.map(e=>e.culture):[];this.captionsControl=new iq(this.playerInstance,e)}return this.captionsControl}getStreamSize(){let e=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return e?{width:e.mediaWidth,height:e.mediaHeight}:{width:0,height:0}}isRendering(){let e=this.getStreamSize();return e.width>0&&e.height>0}ampStateChanged(e,t){switch(e){case"error":return this.handlePlaybackError(t);case"canplaythrough":return this.onCanplaythrough();case"play":return this.onPlay();case"playing":return this.onPlaying();case"pause":return this.onPause();case"resume":return this.onResume();case"start":return this.onStart();case"ended":return this.onEnded();case"seeking":return this.onSeeking();case"seeked":return this.onSeeked(t);case"loadedmetadata":return this.onMetadataLoaded();case"waiting":return this.onWaiting();case"playbackbitratechanged":return this.onPlaybackBitrateChanged(t);case"downloadbitratechanged":return this.onDownloadBitrateChanged(t);case"fullscreenchange":return this.onFullscreenChange(t);case"potentialMediaFreeze":return this.onPotentialMediaFreeze();case"mute":return this.onMute();case"unmute":return this.onUnmute();case"volumechange":return this.onVolumeChange(t);case"loadstart":return this.onLoadStart();case"loadeddata":return this.onLoadedData();case"UserInitiatedSeek":return this.onUserInitiatedSeek(t);default:this.logger.warn(`Unknown amp event ${e}`)}}onUserInitiatedSeek(e){this.liveStreamStatistic.registerUserInitiatedSeek(e)}captionsToggled(e,t,i){this.event("captionsToggled").raise(e,t,i),this.liveStreamStatistic.registerCaptionToggle(e,t,i)}async tryLoadSdnPlugin(){let e;if(this.sdnPluginLoadPromise)return void this.raiseSdnPluginSkippedEvent("SDN plugin already loaded");if(!this.liveStreamOptions.sdn)return void this.raiseSdnPluginSkippedEvent("No SDNs configured in liveStreamOptions");if(!this.configProvider.config.allowSdnPlugins)return void this.raiseSdnPluginSkippedEvent("Client configured to not allow SDN plugins");switch(this.liveStreamOptions.sdn.name){case"hive":case"kollective":case"ramp":case"peer5":break;default:this.logger.warn(`unsupported SDN provider: ${this.liveStreamOptions.sdn.name}`),this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!1,`Unsupported SDN provider: ${this.liveStreamOptions.sdn.name}`);return}this.liveStreamStatistic.registerEventLoadAttempt("SdnPluginLoad");try{this.sdnPluginLoadPromise=this.playerInstance.message("tryLoadSdnPlugin").send(),await this.sdnPluginLoadPromise,this.liveStreamStatistic.registerEventLoadSucceeded("SdnPluginLoad",this.liveStreamOptions.sdn.name)}catch(t){e=t$(t),this.sdnPluginLoadPromise=void 0,this.logger.error(`loadSdnPlugin failed: ${e}`),this.liveStreamStatistic.registerEventLoadFailed("SdnPluginLoad",e),this.event("sdnPluginLoadFailed").raise(e)}}raiseSdnPluginSkippedEvent(e){this.logger.warn(`skipping SDN plugin load: ${e}`),this.event("sdnPluginLoadSkipped").raise(e)}async setPlayerSource(e){if(!e)throw this.logger.error("setPlayerSource: streamDetails is undefined"),Error("setPlayerSource: streamDetails is undefined");if(!this.playerInstance)throw this.logger.error("setPlayerSource: playerInstance is null"),Error("playerInstance is null");this.logger.info(`setPlayerSource: AMP source set to: [${e.url}]`),this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime;try{this.logger.info("setPlayerSource: src changed"),this.selectedStreamDetails=e,this.liveStreamStatistic.registerSetSourceAttempt(e.url),await this.playerInstance.message("setSource").send(e),this.liveStreamStatistic.registerSetSourceSucceeded()}catch(t){let e=t$(t);throw this.logger.error(`setPlayerSource: failed with error [${e}]`),this.liveStreamStatistic.registerSetSourcedFailed(e),t}}async handleStreamInfoUpdate(e){this.loadSucceeded&&e.url!==this.selectedStreamDetails.url?await this.setPlayerSource(e):this.loadSucceeded&&this.playerInstance&&this.getCurrentTime()>0&&this.setPlaybackState("Start")}async switchStreamingUrl(e,t){if(this.streamingUrlSwitchCount>=this.configProvider.config.ampSettings.streamingUrlSwitchMaxCount||!(0,ib.includes)(this.configProvider.config.ampSettings.errorCodesEligibleForStreamingUrlSwitch,e)&&!t)return!1;let i=this.selectedStreamDetails.url===this.liveStreamOptions.stream?.url,n=i?this.liveStreamOptions.altStream:this.liveStreamOptions.stream;return iv(n)?(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,this.setPlayerSource(n).then(()=>!0).catch(()=>!1)):(this.logger.error(`Stream to switch (${i?"alternative":"primary"}) is not valid`),!1)}destroy(e){this.srcLoadPromise=null,this.sdnPluginLoadPromise=null,this.renderer&&(this.renderer.dispose(),this.renderer=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.liveStreamStatistic.registerPlayerDestroyed(e),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState("Destroyed"))}getCurrentTime(){let e=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return e&&e.currentPlayPosition||0}onCanplaythrough(){this.setPlaybackState("Ready")}onPlay(){(this.retryCount>0||this.lastKnownPlayTime)&&(this.logger.info(`Playing after retry count ${this.retryCount}, Setting current time to ${this.lastKnownPlayTime}`),this.playerInstance.message("setPlayTime").send(this.lastKnownPlayTime),this.retryCount=0,this.lastKnownPlayTime=void 0),this.setPlaybackState("Play")}onPlaying(){this.setPlaybackState("Playing")}onPause(){this.setPlaybackState("Paused")}onResume(){this.setPlaybackState("Resume")}onStart(){this.logger.info(`Playback started, retry count: ${this.retryCount}`),this.setPlaybackState("Start"),this.event("playbackStarted").raise(),self.clearTimeout(this.noMediaTimeoutId),this.isSwitchStreamingUrlOngoing&&(this.logger.info(`Playback started, switch count: ${this.streamingUrlSwitchCount}`),this.event("urlSwitched").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)}onEnded(){this.setPlaybackState("Ended")}onSeeking(){this.setPlaybackState("Seeking")}onSeeked(e){this.captionsTimestamp=e.captionsTimestamp,this.setPlaybackState("Seeked")}onMetadataLoaded(){this.setPlaybackState("LoadedMetadata")}onWaiting(){this.setPlaybackState("Buffering")}onLoadedData(){this.setPlaybackState("LoadedData")}onLoadStart(){this.setPlaybackState("LoadStart")}setPlaybackState(e){this.playerState=e,this.logger.debug(`playback state changed: ${e}`),this.liveStreamStatistic.registerPlaybackStateChanged(e),this.event("playbackStateChanged").raise()}onPlaybackBitrateChanged(e){this.liveStreamStatistic.registerPlaybackBitratechanged(e.bitrate)}onDownloadBitrateChanged(e){this.liveStreamStatistic.registerDownloadBitratechanged(e.bitrate)}onFullscreenChange(e){this.logger.debug(`fullscreenchange, isFullscreen=${e.isFullscreen}`),this.event("fullscreenToggled").raise(e.isFullscreen),this.liveStreamStatistic.registerFullScreenChange(e.isFullscreen)}onPotentialMediaFreeze(){this.logger.warn("Player detected a potential media freeze"),this.liveStreamStatistic.registerPotentialMediaFreeze()}onMute(){this.liveStreamStatistic.registerMute(!0)}onUnmute(){this.liveStreamStatistic.registerMute(!1)}onVolumeChange(e){this.liveStreamStatistic.registerVolumeChange(e.value)}stringifyPlayerError(e){return JSON.stringify(e,function(e,t){return"errorCode"===e?t.toString(16):t})}async handlePlaybackError(e){let t=4194307;this.playerState="Error",this.lastPlaybackError=e;let i=this.stringifyPlayerError(e);if(this.logger.info(`Playback error ${i}`),!e.errorCode&&null==e.fatal)return void this.logger.error("onError: error details are not available");if((e.errorCode&t)===t){this.isPlaybackUnsupported=!0,this.raisePlaybackError("UnsupportedPlatform",i),this.destroy("PlaybackError");return}this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime;let n=e.errorCode,r=0xfffffff&n;this.logger.error(`onError: errorCode: 0x${n.toString(16)}, errorCodeExcludingTech: 0x${r.toString(16)}, message: ${e.message}`),this.retryCount<this.configProvider.config.maxRetryCount&&(!1===e.fatal||-1!==(0,ib.indexOf)(iz,r))?setTimeout(async()=>{this.logger.info(`Retry loading stream because of error code: 0x${n.toString(16)}`),this.retryCount++,this.raisePlaybackError("PlaybackRetried",i),this.setPlayerSource(this.selectedStreamDetails)},this.configProvider.config.ampSettings.sourceResetTimeoutInMs):await this.switchStreamingUrl(r,e.fatal)?this.configProvider.config.ampSettings.resetStreamingUrlSwitchCount&&(this.streamingUrlSwitchCount=0):(r===iJ||e.message?.includes(iJ.toString(16))?this.raisePlaybackError("NetworkError",i):this.raisePlaybackError("PlaybackError",i),this.destroy("PlaybackError"))}raisePlaybackError(e,t){this.liveStreamStatistic.registerPlaybackError(e,t),this.event("playbackError").raise(e,t)}callDropDueToMediaTimeout(){let e={currentTime:-1,errorCode:0,message:JSON.stringify({state:this.playerState,error:this.stringifyPlayerError(this.lastPlaybackError)}),fatal:!0},t=this.stringifyPlayerError(e);this.raisePlaybackError("MediaTimeout",t),this.destroy("MediaTimeout")}},iQ=eR(ek()),iY=class extends tZ{constructor(e,t,i){super(),this.logger=e,this.telemetryLogger=i,this.playerLoaded=!1,this.playbackState="Destroyed",this.playerSubs=[],this.isFinalTelemetrySent=!1,this.captionsTimestamp=0,this.configProvider=t;let n=this.createHydraPlayerSettings();this.eventHandler=this.createEventHandler(),this.addPlayerEventSubscribers(),this.hydraPlayer=new iQ.HydraPlayer(n,this.eventHandler)}async configure(e){if(this.streamOptions=e,this.threadId=e.threadId,this.playerLoaded){let e=this.createHydraStreamOptions();await this.hydraPlayer.callPlayerApi("configureHydraPlayer",e)}}async loadPlayer(e){if(!await this.hydraPlayer.setup(e))return{setupSucceeded:!1,playerSetupError:{errorType:"HydraRuntimeLoadFailed",errorMessage:"Failed to create IFrame with Hydra runtime script"}};if(this.streamOptions){let e=this.createHydraStreamOptions();await this.hydraPlayer.callPlayerApi("configureHydraPlayer",e)}else this.logger.warn("No stream options configured before Hydra player loaded");let t=await this.hydraPlayer.callPlayerApi("loadHydraPlayer");return t.setupSucceeded&&(this.playerLoaded=!0,this.startTelemetryGathering()),this.getHydraPlayerSetupResult(t)}convertStreamDeliveryPipeline(e){switch(e){case"AMS":return iQ.HydraStreamDeliveryPipeline.AMS;case"MiddleLaneHttpLiveStreaming":return iQ.HydraStreamDeliveryPipeline.HLS;case"MiddleLaneUltraLowLatency":return iQ.HydraStreamDeliveryPipeline.Ums;default:throw Error(`Unable to convert StreamDeliveryPipeline ${e} to HydraStreamDeliveryPipeline`)}}convertStreamingEventType(e){switch(e){case"TLE":return iQ.HydraStreamingEventType.TLE;case"Overflow":return iQ.HydraStreamingEventType.Overflow;case"TownHall_Basic":return iQ.HydraStreamingEventType.TownHallBasic;case"TownHall_Premium":return iQ.HydraStreamingEventType.TownHallPremium;case"TownHall":return iQ.HydraStreamingEventType.TownHall;default:throw Error(`Unable to convert StreamingEventType ${e} to HydraStreamingEventType`)}}addPlayerEventSubscribers(){this.playerSubs.push(this.eventHandler.on("playbackStateChanged",e=>{this.onPlaybackStateChanged(e)})),this.playerSubs.push(this.eventHandler.on("playbackError",(e,t)=>{this.onPlaybackError(e,t)})),this.playerSubs.push(this.eventHandler.on("playbackSeeked",e=>{this.onPlaybackSeeked(e)})),this.playerSubs.push(this.eventHandler.on("urlSwitched",e=>{this.onUrlSwitched(e)})),this.playerSubs.push(this.eventHandler.on("sdnPluginLoadSkipped",e=>{this.onSdnPluginLoadSkipped(e)})),this.playerSubs.push(this.eventHandler.on("sdnPluginLoadFailed",e=>{this.onSdnPluginLoadFailed(e)})),this.playerSubs.push(this.eventHandler.on("playbackStarted",()=>{this.onPlaybackStarted()})),this.playerSubs.push(this.eventHandler.on("playbackTimeUpdated",e=>{this.onPlaybackTimeUpdated(e)})),this.playerSubs.push(this.eventHandler.on("videoTracksUpdated",e=>{this.onVideoTracksUpdated(e)})),this.playerSubs.push(this.eventHandler.on("statsUpdated",e=>{this.onStatsUpdated(e)})),this.playerSubs.push(this.eventHandler.on("log",(e,t)=>{this.onLog(e,t)})),this.playerSubs.push(this.eventHandler.on("capabilitiesUpdated",e=>{this.onCapabilitiesUpdated(e)})),this.playerSubs.push(this.eventHandler.on("telemetry",(e,t)=>{this.onTelemetry(e,t)})),this.playerSubs.push(this.eventHandler.on("captionReceived",e=>{this.event("captionReceived").raise(e)}))}getTelemetryReport(){return this.hydraPlayer?.getFullTelemetryReport()}getSnapshotTelemetryReport(){return this.hydraPlayer?.getSnapshotTelemetryReport()}startTelemetryGathering(){let e,t;this.statsSub=window.setTimeout(async()=>{clearTimeout(this.statsSub),this.logger.debug(`initial telemetry report after ${this.configProvider.config.sendInitialTelemetryAfterMs} ms`),this.sendTelemetry(!1)},this.configProvider.config.sendInitialTelemetryAfterMs),1===this.configProvider.playerConfig.playerType?(e=this.configProvider.config.hydraPlayerHlsSettings?.ecsSettings?.sendSnapshotTelemetry||this.configProvider.config.sendSnapshotTelemetry,t=this.configProvider.config.hydraPlayerHlsSettings?.ecsSettings?.sendSnapshotTelemetryEveryMs||this.configProvider.config.sendSnapshotTelemetryEveryMs):(e=this.configProvider.config.hydraPlayerUmsSettings?.ecsSettings?.sendSnapshotTelemetry||this.configProvider.config.sendSnapshotTelemetry,t=this.configProvider.config.hydraPlayerUmsSettings?.ecsSettings?.sendSnapshotTelemetryEveryMs||this.configProvider.config.sendSnapshotTelemetryEveryMs),e&&(this.diagSub=window.setInterval(async()=>{this.sendSnapshotTelemetry()},t))}getHydraPlayerSetupResult(e){return{setupSucceeded:e.setupSucceeded,playerSetupError:e.playerSetupError?{errorType:this.convertHydraPlayerSetupError(e.playerSetupError.errorType),errorMessage:e.playerSetupError.errorMessage}:void 0}}convertHydraPlayerSetupError(e){switch(e){case iQ.HydraPlayerSetupErrorType.InvalidStream:return"InvalidStream";case iQ.HydraPlayerSetupErrorType.MultiplePlayerLoad:return"MultiplePlayerLoad";case iQ.HydraPlayerSetupErrorType.PlayerInitializationFailed:return"PlayerInitializationFailed";case iQ.HydraPlayerSetupErrorType.SetSourceFailed:return"SetSourceFailed";default:return}}getRenderer(){return!this.renderer&&this.hydraPlayer&&(this.renderer=new ij(this,this.logger.createChild("LiveStreamRenderer"))),this.renderer}onStatsUpdated(e){this.playerStats=e}getStats(){return this.playerStats}onLog(e,t){this.logger[e](t)}onPlaybackStateChanged(e){try{this.playbackState=this.convertHydraPlaybackState(e),this.event("playbackStateChanged").raise()}catch(e){this.logger.warn(`Not handling playback state changed event: ${t$(e)}`)}}convertHydraPlaybackState(e){switch(e){case iQ.HydraPlayerPlaybackState.LoadStart:return"LoadStart";case iQ.HydraPlayerPlaybackState.LoadedData:return"LoadedData";case iQ.HydraPlayerPlaybackState.LoadedMetadata:return"LoadedMetadata";case iQ.HydraPlayerPlaybackState.Start:return"Start";case iQ.HydraPlayerPlaybackState.CanPlayThrough:return"Ready";case iQ.HydraPlayerPlaybackState.Play:return"Play";case iQ.HydraPlayerPlaybackState.Playing:return"Playing";case iQ.HydraPlayerPlaybackState.Pause:return"Paused";case iQ.HydraPlayerPlaybackState.Waiting:return"Buffering";case iQ.HydraPlayerPlaybackState.Seeking:return"Seeking";case iQ.HydraPlayerPlaybackState.Seeked:return"Seeked";case iQ.HydraPlayerPlaybackState.Ended:return"Ended";case iQ.HydraPlayerPlaybackState.Error:return"Error";case iQ.HydraPlayerPlaybackState.Destroyed:return"Destroyed";case iQ.HydraPlayerPlaybackState.Initialized:return"Initialized";case iQ.HydraPlayerPlaybackState.Stalled:return"Stalled";default:throw Error(`Unable to convert HydraPlayerPlaybackState ${e} to PlaybackState`)}}onPlaybackError(e,t){try{let i=this.convertHydraPlaybackErrorType(e);this.event("playbackError").raise(i,t)}catch(e){this.logger.warn(`Not handling playback error event: ${t$(e)}`)}}convertHydraPlaybackErrorType(e){switch(e){case iQ.HydraPlayerPlaybackErrorType.UnsupportedPlatform:return"UnsupportedPlatform";case iQ.HydraPlayerPlaybackErrorType.NetworkError:return"NetworkError";case iQ.HydraPlayerPlaybackErrorType.PlaybackRetried:return"PlaybackRetried";case iQ.HydraPlayerPlaybackErrorType.PlaybackError:return"PlaybackError";case iQ.HydraPlayerPlaybackErrorType.MediaTimeout:return"MediaTimeout";case iQ.HydraPlayerPlaybackErrorType.NoMediaFlow:return"NoMediaFlow";case iQ.HydraPlayerPlaybackErrorType.Unknown:return"Unknown";default:throw Error(`Unable to convert HydraPlayerPlaybackErrorType ${e} to PlaybackErrorType`)}}seek(e){this.hydraPlayer.callPlayerApi("seekHydraPlayer",e)}seekToLiveEdge(){this.hydraPlayer.callPlayerApi("seekHydraPlayerToLiveEdge")}play(){this.hydraPlayer.callPlayerApi("playHydraPlayer")}pause(){this.hydraPlayer.callPlayerApi("pauseHydraPlayer")}setVolume(e){this.hydraPlayer.callPlayerApi("setHydraPlayerVolume",e)}selectVideoTrack(e){this.hydraPlayer.callPlayerApi("selectHydraPlayerVideoTrack",e)}getStreamSize(){return this.playerStats?{width:this.playerStats.mediaWidth,height:this.playerStats.mediaHeight}:{width:0,height:0}}isRendering(){let e=this.getStreamSize();return e.width>0&&e.height>0}disposePlayer(){this.hydraPlayer?.dispose()}releasePlayer(){this.hydraPlayer&&(this.hydraPlayer.release(),this.hydraPlayer=null)}stop(){this.renderer&&(this.renderer.dispose(),this.renderer=null),this.statsSub&&(clearTimeout(this.statsSub),this.statsSub=null),this.diagSub&&(clearInterval(this.diagSub),this.diagSub=null),this.disposePlayer(),this.sendFinalTelemetry(),this.clearPlayerEventSubscribers(),this.releasePlayer()}getPlaybackState(){return this.playbackState}getCaptionsTimestamp(){return this.captionsTimestamp}sendFinalTelemetry(){this.isFinalTelemetrySent||(this.isFinalTelemetrySent=!0,this.sendTelemetry(!0))}sendTelemetry(e){if(this.configProvider.config.sendTelemetry&&this.telemetryLogger){let t={...this.getTelemetryReport(),isFinal:e,threadId:this.threadId,tsCallingVersion:tX(),correlationId:this.streamOptions.correlationId};this.logger.debug("generated live stream report: ",t),this.telemetryLogger.sendEvent({eventName:"live_events",props:t})}else this.logger.info("telemetry not sent")}sendSnapshotTelemetry(){if(this.telemetryLogger){let e={...this.getSnapshotTelemetryReport(),isFinal:!1,threadId:this.threadId,tsCallingVersion:tX(),correlationId:this.streamOptions.correlationId};this.logger.debug("sending snapshot telemetry: ",e),this.telemetryLogger.sendEvent({eventName:"live_events",props:e})}else this.logger.error("snapshot telemetry not sent, telemetryLogger is not set")}clearPlayerEventSubscribers(){for(let e of this.playerSubs)e.dispose();this.playerSubs=[]}onPlaybackSeeked(e){this.captionsTimestamp=e}onUrlSwitched(e){this.event("urlSwitched").raise(e)}onSdnPluginLoadSkipped(e){this.event("sdnPluginLoadSkipped").raise(e)}onSdnPluginLoadFailed(e){this.event("sdnPluginLoadFailed").raise(e)}onPlaybackStarted(){this.event("playbackStarted").raise()}onPlaybackTimeUpdated(e){this.event("playbackTimeUpdated").raise(e)}onVideoTracksUpdated(e){this.event("videoTracksChanged").raise(e)}onCapabilitiesUpdated(e){this.event("capabilitiesUpdated").raise(e)}onTelemetry(e,t){this.telemetryLogger?.sendEvent({eventName:e,props:{TsCalling_ThreadId:this.threadId,TsCalling_Version:tX(),TsCalling_CorrelationId:this.streamOptions.correlationId,...t}})}},iZ=class extends tZ{constructor(){super()}playbackStateChanged(e){this.event("playbackStateChanged").raise(e)}playbackSeeked(e){this.event("playbackSeeked").raise(e)}log(e,t){this.event("log").raise(e,t)}playbackError(e,t){this.event("playbackError").raise(e,t)}urlSwitched(e){this.event("urlSwitched").raise(e)}sdnPluginLoadSkipped(e){this.event("sdnPluginLoadSkipped").raise(e)}sdnPluginLoadFailed(e){this.event("sdnPluginLoadFailed").raise(e)}statsUpdated(e){this.event("statsUpdated").raise(e)}playbackStarted(){this.event("playbackStarted").raise()}playbackTimeUpdated(e){this.event("playbackTimeUpdated").raise(e)}videoTracksUpdated(e){this.event("videoTracksUpdated").raise(e)}capabilitiesUpdated(e){this.event("capabilitiesUpdated").raise(e)}telemetry(e,t){this.event("telemetry").raise(e,t)}captionReceived(e){this.event("captionReceived").raise(e)}},iX=eR(ek());function i0(e){if(e.playbackCoordinates)return e.playbackCoordinates;if(!e.url&&!e.hlsUrls)return[];let t=[];return(e.hlsUrls?e.hlsUrls:[e.url]).forEach(i=>{t.push({url:i,sdnContext:e.sdnContext})}),t}function i1(e){return e.playbackCoordinates?e.playbackCoordinates:e.url?[{url:e.url,sdnContext:e.sdnContext}]:[]}var i2=["https://res-1.public.onecdn.static.microsoft/s01-ml-player/4.25162.1/hydra_player_hls_bundle.js","https://res-4.public.onecdn.static.microsoft/s01-ml-player/4.25162.1/hydra_player_hls_bundle.js"],i3=class extends iY{createEventHandler(){return new i5}createHydraPlayerSettings(){return{playerType:iX.HydraPlayerType.Hls,hydraRuntimeFetchTimeout:this.configProvider.config.hydraRuntimeFetchTimeout,capturePlayerLogs:this.configProvider.config.capturePlayerLogs,allowSdnPlugins:this.configProvider.config.allowSdnPlugins,debugLogging:this.configProvider.config.debug??!1,muteVideo:this.configProvider.playerConfig?.muteVideo??!1,videoLang:this.configProvider.playerConfig?.lang,videoElementStyles:this.configProvider.playerConfig?.styles,maxPlayerDiagnosticsCount:this.configProvider.config.maxPlayerDiagnosticsCount,maxPlayerMemoryTraceLogCount:this.configProvider.config.maxPlayerMemoryTraceLogCount,maxPlayerPlaybackEventCount:this.configProvider.config.maxPlayerPlaybackEventCount,maxPlayerExperimentalEvents:this.configProvider.config.hlsSettings.maxPlayerExperimentalEvents,maxRetryCount:this.configProvider.config.maxRetryCount,playerTelemetryTickMs:this.configProvider.config.playerTelemetryTickMs,removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack,maxRetryCountForLoadingResources:this.configProvider.config.maxRetryCountForLoadingResources,maxVideoTrackHistoryLogCount:this.configProvider.config.maxVideoTrackHistoryLogCount,maxStreamConnectionResultsLogCount:this.configProvider.config.hlsSettings.maxStreamConnectionResultsLogCount,maxAbsoluteTimeOffsetEstimationResultsLogCount:this.configProvider.config.hlsSettings.maxAbsoluteTimeOffsetEstimationResultsLogCount,skipNonce:this.configProvider.config.hlsSettings.skipNonce,configIds:this.configProvider.configIds,estimateAbsoluteTime:this.configProvider.config.hlsSettings.estimateAbsoluteTime,playlistInitialSequenceNumber:this.configProvider.config.hlsSettings.playlistInitialSequenceNumber,timeoutForSwitchingUrl:this.configProvider.config.hlsSettings.timeoutForSwitchingUrl,hlsConfig:this.configProvider.config.hlsSettings.hlsConfig,logHlsJsEvents:this.configProvider.config.hlsSettings.logHlsJsEvents,logHlsJsEventsEveryMs:this.configProvider.config.hlsSettings.logHlsJsEventsEveryMs,switchingPolicy:this.configProvider.config.hydraPlayerHlsSettings?.ecsSettings?.switchingPolicy,enableUuidTrace:this.configProvider.config.hlsSettings.enableUuidTrace,thaScript:this.configProvider.config.hlsSettings.thaScript,enableOffsetComputeBasedOfStreamTime:this.configProvider.config.hlsSettings.enableOffsetComputeBasedOfStreamTime,stopCrash:this.configProvider.config.stopCrash,stopTerminating:this.configProvider.config.hlsSettings.stopTerminating,stallDetectionPolicy:this.configProvider.config.hydraPlayerHlsSettings?.ecsSettings?.stallDetectionPolicy,playerRuntimeJsUrls:this.configProvider.config.hydraPlayerHlsSettings?.runtimeUrls??this.configProvider.playerConfig?.hydraPlayerWebSdkUrls??i2,disableSandbox:this.configProvider.config.hlsSettings.disableSandbox,ecsSettings:this.configProvider.config.hydraPlayerHlsSettings?.ecsSettings,nonce:this.configProvider.playerConfig?.nonce??"",hlsInitMode:this.convertHlsInitMode(this.configProvider.playerConfig?.hlsInitMode),hlsStartTimestamp:this.configProvider.playerConfig?.hlsStartTimestamp??-1}}createHydraStreamOptions(){let e=iX.HydraStreamingEventType.TLE;e=this.streamOptions.streamingEventType?this.convertStreamingEventType(this.streamOptions.streamingEventType):this.streamOptions.overflow?iX.HydraStreamingEventType.Overflow:iX.HydraStreamingEventType.TLE;let t={stream:{playbackCoordinates:i0(this.streamOptions.stream),urls:this.streamOptions.stream.hlsUrls?this.streamOptions.stream.hlsUrls:[this.streamOptions.stream.url],keyAuthorizationToken:this.streamOptions.stream.keyAuthorizationToken,keyDeliveryUrl:this.streamOptions.stream.keyDeliveryUrl,sdnContext:this.streamOptions.stream.sdnContext,streamDeliveryPipeline:this.streamOptions.stream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.stream.streamDeliveryPipeline):void 0},altStream:this.streamOptions.altStream?{playbackCoordinates:i0(this.streamOptions.altStream),urls:this.streamOptions.altStream.hlsUrls?this.streamOptions.altStream.hlsUrls:[this.streamOptions.altStream.url],keyAuthorizationToken:this.streamOptions.altStream.keyAuthorizationToken,keyDeliveryUrl:this.streamOptions.altStream.keyDeliveryUrl,sdnContext:this.streamOptions.altStream.sdnContext,streamDeliveryPipeline:this.streamOptions.altStream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.altStream.streamDeliveryPipeline):void 0}:void 0,supportedSubtitleLanguages:this.streamOptions.supportedSubtitleLanguages,streamingEventType:e,allowPlayerControls:this.streamOptions.allowPlayerControls,sdn:this.streamOptions.sdn?{name:this.streamOptions.sdn.name,url:this.streamOptions.sdn.url,plugin:this.streamOptions.sdn.plugin}:void 0,thaContext:this.streamOptions.thaContext?{eventId:this.streamOptions.thaContext.eventId,organizer:{userId:this.streamOptions.thaContext.organizer?.userId,tenantId:this.streamOptions.thaContext.organizer?.tenantId},attendee:{userId:this.streamOptions.thaContext.attendee?.userId,tenantId:this.streamOptions.thaContext.attendee?.tenantId},coOrganizers:this.streamOptions.thaContext.coOrganizers}:void 0,enableParentCaptionsRendering:this.streamOptions.enableParentCaptionsRendering??!1};return this.streamOptions.eventId&&(t.eventId=this.streamOptions.eventId),this.streamOptions.templateId&&(t.templateId=this.streamOptions.templateId),this.streamOptions.meetingMetadata&&(t.meetingMetadata=this.streamOptions.meetingMetadata),t}onCaptionsToggled(e,t,i){this.captionsControl&&this.captionsControl.toggleCaptions(e,t),this.event("captionsToggled").raise(e,t,i)}getCaptionsControl(){if(!this.captionsControl&&this.hydraPlayer){let e=this.streamOptions?.supportedSubtitleLanguages?this.streamOptions.supportedSubtitleLanguages.map(e=>e.culture):["en","es"];this.captionsControl=new i4(this.hydraPlayer,e)}return this.captionsControl}addPlayerEventSubscribers(){super.addPlayerEventSubscribers(),this.playerSubs.push(this.eventHandler.on("captionsToggled",(e,t,i)=>{this.onCaptionsToggled(e,t,i)}))}releasePlayer(){super.releasePlayer(),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null)}convertHlsInitMode(e="Live"){switch(e){case"Fallback":return iX.HlsHydraPlayerInitMode.Fallback;case"EndOfStream":return iX.HlsHydraPlayerInitMode.EndOfStream;case"DVR":return iX.HlsHydraPlayerInitMode.Dvr;default:return iX.HlsHydraPlayerInitMode.Live}}},i4=class{constructor(e,t){this.hydraPlayer=e,this.availableCultures=t,this.selectedCulture=""}async addCues(e){let t=this.convertCues(e);await this.hydraPlayer.callPlayerApi("addHydraPlayerCues",t)}convertCues(e){let t=[];return e.forEach(e=>{t.push({start:e.start,end:e.end,text:e.text})}),t}async clearCues(){await this.hydraPlayer.callPlayerApi("clearHydraPlayerCues")}async showCaptions(e){await this.hydraPlayer.callPlayerApi("showHydraPlayerCaptions",e)}getSelectedCulture(){return this.selectedCulture}getAvailableCultures(){return this.availableCultures}dispose(){this.hydraPlayer=null}toggleCaptions(e,t){this.selectedCulture=e?t:""}},i5=class extends iZ{constructor(){super()}captionsToggled(e,t,i){this.event("captionsToggled").raise(e,t,i)}},i6=eR(ek()),i8=["https://res-4.public.onecdn.static.microsoft/s01-ml-player/4.24352.3/hydra_player_ums_bundle.js","https://res.cdn.office.net/s01-ml-player/4.24352.3/hydra_player_ums_bundle.js"],i9=class extends iY{get tracks(){return this.trackInfo}createEventHandler(){return new ne}createHydraPlayerSettings(){return{playerType:i6.HydraPlayerType.Ums,hydraRuntimeFetchTimeout:this.configProvider.config.hydraRuntimeFetchTimeout,allowSdnPlugins:this.configProvider.config.allowSdnPlugins,debugLogging:this.configProvider.config.debug??!1,muteVideo:this.configProvider.playerConfig?.muteVideo??!1,videoLang:this.configProvider.playerConfig?.lang,videoElementStyles:this.configProvider.playerConfig?.styles,maxPlayerDiagnosticsCount:this.configProvider.config.maxPlayerDiagnosticsCount,maxPlayerMemoryTraceLogCount:this.configProvider.config.maxPlayerMemoryTraceLogCount,maxPlayerPlaybackEventCount:this.configProvider.config.maxPlayerPlaybackEventCount,maxPlayerExperimentalEvents:this.configProvider.config.umsSettings.maxPlayerExperimentalEvents,maxRetryCount:this.configProvider.config.maxRetryCount,playerTelemetryTickMs:this.configProvider.config.playerTelemetryTickMs,maxRetryCountForLoadingResources:this.configProvider.config.maxRetryCountForLoadingResources,maxVideoTrackHistoryLogCount:this.configProvider.config.maxVideoTrackHistoryLogCount,maxStreamConnectionResultsLogCount:this.configProvider.config.umsSettings.maxStreamConnectionResultsLogCount,configIds:this.configProvider.configIds,timeoutForSwitchingUrl:this.configProvider.config.umsSettings.timeoutForSwitchingUrl,latencyCompensationThreshold:this.configProvider.config.umsSettings.latencyCompensationThreshold,switchingPolicy:this.configProvider.config.hydraPlayerUmsSettings?.ecsSettings?.switchingPolicy,enableUuidTrace:this.configProvider.config.umsSettings.enableUuidTrace,thaScript:this.configProvider.config.umsSettings.thaScript,stopCrash:this.configProvider.config.stopCrash,stopTerminating:this.configProvider.config.umsSettings.stopTerminating,stallDetectionPolicy:this.configProvider.config.hydraPlayerUmsSettings?.ecsSettings?.stallDetectionPolicy,playerRuntimeJsUrls:this.configProvider.config.hydraPlayerUmsSettings?.runtimeUrls??this.configProvider.playerConfig?.hydraPlayerWebSdkUrls??i8,disableSandbox:this.configProvider.config.umsSettings.disableSandbox,ecsSettings:this.configProvider.config.hydraPlayerUmsSettings?.ecsSettings,nonce:this.configProvider.playerConfig?.nonce??"",useLiveUmsCaptions:this.configProvider.config.umsSettings?.useLiveUmsCaptions??!1,useMicrosoftEcdn:this.configProvider.playerConfig?.useMicrosoftEcdn!==!1}}createHydraStreamOptions(){let e=i6.HydraStreamingEventType.TLE;e=this.streamOptions.streamingEventType?this.convertStreamingEventType(this.streamOptions.streamingEventType):this.streamOptions.overflow?i6.HydraStreamingEventType.Overflow:i6.HydraStreamingEventType.TLE;let t={stream:{playbackCoordinates:i1(this.streamOptions.stream),urls:[this.streamOptions.stream.url],decryptionKey:this.streamOptions.stream.decryptionKey,sdnContext:this.streamOptions.stream.sdnContext,streamDeliveryPipeline:this.streamOptions.stream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.stream.streamDeliveryPipeline):void 0},altStream:this.streamOptions.altStream?{playbackCoordinates:i1(this.streamOptions.altStream),urls:[this.streamOptions.altStream.url],decryptionKey:this.streamOptions.altStream.decryptionKey,sdnContext:this.streamOptions.altStream.sdnContext,streamDeliveryPipeline:this.streamOptions.altStream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.altStream.streamDeliveryPipeline):void 0}:void 0,streamingEventType:e,allowPlayerControls:this.streamOptions.allowPlayerControls,sdn:this.streamOptions.sdn?{name:this.streamOptions.sdn.name,url:this.streamOptions.sdn.url,plugin:this.streamOptions.sdn.plugin}:void 0,thaContext:this.streamOptions.thaContext?{eventId:this.streamOptions.thaContext.eventId,organizer:{userId:this.streamOptions.thaContext.organizer?.userId,tenantId:this.streamOptions.thaContext.organizer?.tenantId},attendee:{userId:this.streamOptions.thaContext.attendee?.userId,tenantId:this.streamOptions.thaContext.attendee?.tenantId},coOrganizers:this.streamOptions.thaContext.coOrganizers}:void 0,enableParentCaptionsRendering:this.streamOptions.enableParentCaptionsRendering??!1};return this.streamOptions.eventId&&(t.eventId=this.streamOptions.eventId),this.streamOptions.templateId&&(t.templateId=this.streamOptions.templateId),this.streamOptions.meetingMetadata&&(t.meetingMetadata=this.streamOptions.meetingMetadata),t}addPlayerEventSubscribers(){super.addPlayerEventSubscribers(),this.playerSubs.push(this.eventHandler.on("trackListUpdated",e=>{this.onTrackListUpdated(e)})),this.playerSubs.push(this.eventHandler.on("trackSelected",e=>{this.onTrackSelected(e)}))}onTrackListUpdated(e){this.trackInfo=e;let t=t$(e);this.logger.info(`[onTrackListUpdated]: Track list updated to: ${t}`)}onTrackSelected(e){let t=t$(e);this.logger.info(`[onTrackSelected]: Track selected: ${t}`)}getCaptionsControl(){return!this.captionsControl&&this.hydraPlayer&&(this.captionsControl=new i7(this.hydraPlayer,this.logger.createChild("CaptionsControl"))),this.captionsControl}releasePlayer(){super.releasePlayer(),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null)}},i7=class{constructor(e,t){this.hydraPlayer=e,this.logger=t}async addCues(e){this.logger.warn("[addCues]: not implemented for UMS player")}async clearCues(){this.logger.warn("[clearCues]: not implemented for UMS player")}async showCaptions(e){await this.hydraPlayer.callPlayerApi("showHydraPlayerCaptions",e)}getSelectedCulture(){return this.logger.warn("[getSelectedCulture]: not implemented for UMS player"),""}getAvailableCultures(){return this.logger.warn("[getAvailableCultures]: not implemented for UMS player"),[]}dispose(){this.hydraPlayer=null}async selectTextTrack(e){await this.hydraPlayer.callPlayerApi("selectHydraPlayerTextTrack",e)}},ne=class extends iZ{constructor(){super()}trackListUpdated(e){this.event("trackListUpdated").raise(e)}trackSelected(e){this.event("trackSelected").raise(e)}},nt=class extends tZ{constructor(e,t,i){super(),this.configProvider=e,this.logger=t,this.getTelemetryLogger=i,this.isAvailable=!0,this._isStreaming=!1,this.playerSubs=[],this.isFinalTelemetrySent=!1,this.telemetryLogger=this.getTelemetryLogger(),1===this.configProvider.playerConfig.playerType?this.player=new i3(this.logger.createChild("HlsHydraLiveStreamPlayer"),this.configProvider,this.telemetryLogger):2===this.configProvider.playerConfig.playerType?this.player=new i9(this.logger.createChild("UmsHydraLiveStreamPlayer"),this.configProvider,this.telemetryLogger):(this.initializeAmpTelemetry(),this.player=new iK(this.logger.createChild("AmpLiveStreamPlayer"),this.liveStreamStatistic,this.configProvider)),this.subscribeForPlayerEvents()}get isStreaming(){return this._isStreaming}isActive(){return this.isAvailable&&this.isStreaming}async start(e,t){await this.setOptions(t),this.isFinalTelemetrySent=!1;let i=await this.player.loadPlayer(e);if(!i.setupSucceeded){this.player.stop(),this.logger.error("playerLoadFailed");let e=JSON.stringify(i.playerSetupError);throw this.sendFinalTelemetry(e),Error(e)}return this._isStreaming=!0,this.liveStreamStatistic&&(this.statsSub=window.setTimeout(()=>{clearTimeout(this.statsSub),this.logger.debug(`initial telemetry report after ${this.configProvider.config.sendInitialTelemetryAfterMs} ms`),this.sendTelemetry(!1)},this.configProvider.config.sendInitialTelemetryAfterMs),this.configProvider.config.sendSnapshotTelemetry&&(this.diagSub=window.setInterval(()=>{this.sendSnapshotTelemetry()},this.configProvider.config.sendSnapshotTelemetryEveryMs))),this.player.getRenderer()}initializeAmpTelemetry(){let e={perceivedBandwidth:[],videoBufferLength:[],videoCachedLength:[],videoEdgeLatency:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowHeight:[],windowWidth:[],playbackRate:[],currentPlayPosition:[],currentMediaTime:[],statsInterval:[]};this.liveStreamStatistic=new iC(this.configProvider.config,this.logger.createChild("LiveStreamStatistic"),e)}async stop(){}async setOptions(e){return void 0!==e.overflow&&(e.streamingEventType||(e.streamingEventType=e.overflow?"Overflow":"TLE"),delete e.overflow),this.options=e,this.player.configure(e)}getStats(){return this.liveStreamStatistic?this.liveStreamStatistic.getPlayerDiagnosticSnapshot():this.player?.getStats?.()}dispose(){this.unsubscribeFromPlayerEvents(),this.player.stop(),this.statsSub&&(clearTimeout(this.statsSub),this.statsSub=null),this.diagSub&&(clearInterval(this.diagSub),this.diagSub=null),this.logger.debug("stopping live event"),this.sendFinalTelemetry("graceful disposed"),super.dispose()}sendFinalTelemetry(e){this.isFinalTelemetrySent||(this.isFinalTelemetrySent=!0,this.sendTelemetry(!0,e))}sendTelemetry(e,t){if(!this.liveStreamStatistic)return void this.logger.info("telemetry not tracked in ILiveStream object");if(this.configProvider.config.sendTelemetry&&this.telemetryLogger){let i={configIds:this.configProvider.configIds,playerId:this.player.playerId,correlationId:this.options?.correlationId,eTag:this.configProvider.etag,isFinal:e,threadId:this.options?.threadId,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton,callendReason:t},n=this.liveStreamStatistic?.getReport(i);this.logger.debug("generated live stream report",n),this.telemetryLogger.sendEvent({eventName:"live_events",props:n})}else this.logger.info("telemetry not sent")}sendSnapshotTelemetry(){if(!this.liveStreamStatistic)return void this.logger.info("telemetry not tracked in ILiveStream object");if(this.telemetryLogger){let e=this.liveStreamStatistic.getSnapshotReport({configIds:this.configProvider.configIds,playerId:this.player.playerId,correlationId:this.options?.correlationId,eTag:this.configProvider.etag,isFinal:!1,threadId:this.options?.threadId,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton});this.logger.debug("sending snapshot telemetry: ",e),this.telemetryLogger.sendEvent({eventName:"live_events",props:e})}else this.logger.error("snapshot telemetry not sent, telemetryLogger is not set")}subscribeForPlayerEvents(){this.playerSubs.push(this.player.on("playbackStateChanged",()=>{this.onPlaybackStateChanged()})),this.playerSubs.push(this.player.on("playbackError",(e,t)=>{this.onPlaybackError(e,t)})),this.playerSubs.push(this.player.on("urlSwitched",e=>{this.onUrlSwitched(e)})),this.playerSubs.push(this.player.on("sdnPluginLoadSkipped",e=>{this.onSdnPluginLoadSkipped(e)})),this.playerSubs.push(this.player.on("sdnPluginLoadFailed",e=>{this.onSdnPluginLoadFailed(e)})),this.playerSubs.push(this.player.on("playbackStarted",()=>{this.onPlaybackStarted()})),this.playerSubs.push(this.player.on("capabilitiesUpdated",e=>this.onCapabilitiesUpdated(e)))}unsubscribeFromPlayerEvents(){for(let e of this.playerSubs)e.dispose();this.playerSubs=[]}onPlaybackStarted(){this.event("playbackStarted").raise()}onPlaybackStateChanged(){let e=this.player.getPlaybackState();switch(e){case"Start":this.event("playbackStarted").raise();break;case"Ended":this.event("playbackNotLive").raise(),this.sendFinalTelemetry("playback ended");break;case"Seeked":this.event("playbackSeeked").raise(this.player.getCaptionsTimestamp());break;default:this.logger.debug(`playbackStateChanged: ${e}`)}this.event("playbackStateChanged").raise(this.player.getPlaybackState())}onPlaybackError(e,t){this.event("error").raise(e,t)}onUrlSwitched(e){this.event("urlSwitched").raise(e)}onSdnPluginLoadSkipped(e){this.event("sdnPluginLoadSkipped").raise(e)}onSdnPluginLoadFailed(e){this.event("sdnPluginLoadFailed").raise(e)}onCapabilitiesUpdated(e){this.event("capabilitiesUpdated").raise(e)}},ni=class{constructor(e,t,i){this.ecsConfig=e,this.logger=t,this.getTelemetryLogger=i}configure(e){this.configuration=e}async initialize(){let e="MDN_MIDDLELANE_TEAMS",t="liveStream",i=this.ecsConfig.getString(e,t),n={};try{n=JSON.parse(i)}catch(i){this.logger.warn(`failed to parse ECS configuration for ${e}/${t}`)}let r=this.ecsConfig.getString("ConfigIDs",e);this._configProvider=new iu(n,this.configuration,r,this.logger.createChild("LiveStreamConfigProvider"))}createLiveStream(){return new nt(this._configProvider,this.logger.createChild("LiveStream"),this.getTelemetryLogger)}dispose(){}},nn=class extends tZ{constructor(){super(...arguments),this.isAudioOutputSelectionSupported=!1}createAudioPlayer(){return null}createAudioRenderer(){return null}getRawDeviceMediaStream(e){return null}askDevicePermission(){return Promise.resolve({audio:!1,video:!1})}getPermissionState(e){return"granted"}enumerateDevicesAsync(){return Promise.resolve([])}getPreferredCamera(){return null}selectDevices(){}getSelectedDevices(){return{}}startPreview(){return null}createPreview(){return Promise.resolve(new nr)}createPreviewRenderer(){return Promise.resolve(new nr)}createScreenSharingPreviewRenderer(){return Promise.resolve(new nr)}getDeviceNameAsync(){return Promise.resolve("")}setDeviceEffectsAsync(){return Promise.resolve()}getDeviceEffectsCapabilityAsync(){return Promise.resolve(0)}setBackgroundImageAsync(){return Promise.resolve()}getImagePropertyAsync(){return Promise.resolve({width:0,height:0,uri:" "})}getMicrophoneGeometryArrayInfoAsync(e){return Promise.resolve({})}transformImageAsync(){return Promise.resolve(!1)}sendMessageDeviceVideoEffectsAsync(){return Promise.resolve({code:0})}sendMessageDeviceVideoExtensibilityAsync(){return Promise.resolve({code:0,type:"Error",response:{details:"The API has not been implemented."}})}setVideoCaptureConfigAsync(){return Promise.resolve()}captureVideoFrameWithoutEffectsAsync(){return Promise.resolve(new ImageData(0,0))}enableSignLanguageDetectionAsync(e,t){return Promise.resolve()}downloadAiModel(e,t){return Promise.resolve("")}setAudioProcessingFlags(e){}getSpeakerVolume(){return Promise.resolve(0)}getSpeakerSystemVolume(){return Promise.resolve(0)}setSpeakerVolume(e){return Promise.resolve()}setSpeakerSystemVolume(e){return Promise.resolve()}unmuteMicrophone(){return Promise.resolve()}unmuteSpeaker(){return Promise.resolve()}getNrgLevelsForDeviceTuner(e){return Promise.resolve(0)}getNrgLevelPollerForDeviceTuner(e){return Promise.resolve(new na)}setAudioEffectsAsync(){return Promise.resolve()}getAudioFeatureCapability(e){return Promise.resolve(0)}getMicrophoneVolume(){return Promise.resolve(0)}setMicrophoneVolume(e){return Promise.resolve()}setDeviceTelemetryData(e,t,i,n=0){return Promise.resolve()}getSpeakerDeviceDomIdAsync(e,t){return Promise.reject()}mapBrowserDevices(e,t){return Promise.reject()}getSourceFormats(e){return Promise.resolve([])}enableShellSharing(){return Promise.resolve()}disableShellSharing(){return Promise.resolve()}enableParticipantCameras(){return Promise.resolve()}registerDerivedSource(e,t){return Promise.resolve()}unregisterDerivedSource(e){return Promise.resolve()}startAudioLoopbackDevice(e){return Promise.resolve()}async dispose(e){return Promise.resolve()}},nr=class extends tZ{constructor(){super(...arguments),this.isRendering=!1,this.streamSize={width:0,height:0},this.rendererType=-1,this.frameType=-1}captureFrame(){return Promise.resolve(new ns)}getStats(){return Promise.resolve({framesDropped:0,framesTotal:0})}setScalingMode(){return Promise.resolve()}cameraAutoControl(e){return Promise.resolve(!1)}getCameraManualControlStates(e){return Promise.resolve([])}setCameraManualControlStates(e){return Promise.resolve([])}enumerateCameraManualControls(){return Promise.resolve([])}isCameraAdvancedControlCapable(){return Promise.resolve(!1)}dispose(){}},ns=class extends tZ{getSize(){return{width:0,height:0}}isMirrored(){return!1}},na=class{getInputLevel(){return 0}getInputLevelNormalized(e,t){return 0}dispose(){}},no=tZ,nl="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",nc="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",nd="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",nu={MEDIA_STATE:{send:"sendonly",receive:"recvonly",sendReceive:"sendrecv",inactive:"inactive"},MEDIA_DIRECTION:{SEND:"send",RECV:"recv"},MEDIA_DEVICE_KIND:{audioInput:"audioinput",audioOutput:"audiooutput",videoInput:"videoinput",compositeAudio:"compositeAudio",virtualDevice:"virtualDevice"},MEDIA_DEVICE:{camera:"camera",microphone:"microphone",speaker:"speaker",compositeAudio:"compositeAudio",defaultId:"default",communicationsId:"communications",defaultDeviceLabel:"Default",audioIngestDevice:"audioIngestDevice",virtualDevice:"virtualDevice"},MEDIA_ERROR:{constraintNotSatisfiedError:"ConstraintNotSatisfiedError",iceConnectionError:"iceConnectionError",srtpError:"srtpError",permissionDeniedError:"permissionDeniedError",internalError:"internalError",sourceUnavailableError:"SourceUnavailableError",devicesNotFoundError:"DevicesNotFoundError",noDeviceSelected:"noDeviceSelected",noNetworkError:"noNetworkError",incompatibleOffer:"IncompatibleOffer",mediaStreamRequestError:"MediaStreamRequestError",extensionNotFoundError:"ExtensionNotFoundError",sharingCancelledError:"SharingCancelledError",permissionDeniedBySystemError:"PermissionsDeniedBySystem",chromeRuntimeNotDefinedError:"ChromeRuntimeNotDefinedError",mediaStreamRequestTimedOut:"MediaStreamRequestTimedout",unsupportedStream:"UnsupportedStream",webGlRendererError:"WebGlRendererError",audioPlaybackError:"audioPlaybackError",unexpectedClose:"unexpectedClose",incompatibleOriginator:"incompatibleOriginator"},HISTOGRAM_BATCH:{seconds1to3:2,seconds3to5:4,seconds5to8:7,seconds8to15:14,seconds15to60:59,seconds60toMax:1e6},RENEGOTIATION_ERROR:{local:"local",glare:"glare",signaling:"signaling",media:"media",escalation:"escalation"},MSI:{unsubscribe:-1,subscribeAny:-2},MEDIA_LABEL:{audio:"main-audio",video:"main-video",sharing:"applicationsharing-video",data:"data"},MEDIA_TYPE:{audio:"audio",video:"video",sharing:"sharing",data:"x-data",dataChannel:"application"},MODALITY:{audio:"audio",video:"video",sharing:"sharing",data:"data"},TRACK_KIND:{audio:"audio",video:"video"},ICE_TRANSPORT_POLICY:{all:"all",relay:"relay"},RENDERER_TYPE:{video:"video",sharing:"sharing"},CONTENT_TYPE:{SDP_NGC:"application/sdp-ngc-1.0"},ALLOWED_CONTENT_TYPES:{SDP_NGC:["application/sdp-ngc-0.5","application/sdp-ngc-1.0"]},STREAMING_STATE:{created:"created",started:"started",active:"active",inactive:"inactive",stopped:"stopped",removed:"removed",failed:"failed"},TIME_INTERVAL:{SEC_1:1},DISPLAY_SOURCE_ID:"display",EMPTY_DEVICE_ID:"0",SYSTEM_AUDIO_SOURCE_ID:"system",MULTIPLE_RECV_STREAMS:"multipleVideoStreams",MULTIPLE_RECV_AUDIO_STREAMS:"multipleAudioStreams",PROFILES:{udpTlsRtpSavpf:"UDP/TLS/RTP/SAVPF",rtpSavpf:"RTP/SAVPF",rtpSavp:"RTP/SAVP",udpDtlsSctp:"UDP/DTLS/SCTP"},REPORTING_PROFILE:{RT_PROFILE:"REAL_TIME",BE_PROFILE:"BEST_EFFORT",NRT_PROFILE:"NEAR_REAL_TIME"},PAYLOAD_TYPE:{DATA_CHANNEL:"webrtc-datachannel",X_DATA:"127 126",MSRTC_RED:97,MSRTC_CNFB:120},VIDEO_CAPABILITIES:{MAX_FS_PATH:"max-fs",MAX_MBPS_PATH:"max-mbps",MAX_FPS_PATH:"max-fps",MAX_BR_PATH:"max-br",SSRC_PATH:"ssrc",RID_PATH:"rid",KEYFRAME_PATH:"KeyFrame",MAX_WIDTH:"max-width",MAX_HEIGHT:"max-height",MAX_STREAMS:"max-streams",MAX_LAYERS:"max-layers",PRIORITY_LAYOUT_MIN_MBPR:"priority-layout-min-mbpr",PRIORITY_LAYOUT_MIN_BITRATE:"priority-layout-min-bitrate",VLA_DEBUG:"vla-debug",LADDER_TYPE:"ladder-type",SEQUENCE_NUMBER:"sequence-number"},TRANSPORT_CC:{EXT_URI:nl,MSSDP_ENCODED_URI:nl.replace(/\//g,"\\"),ATTRIBUTE:"transport-cc"},ABS_SEND_TIME:{EXT_URI:nc,MSSDP_ENCODED_URI:nc.replace(/\//g,"\\")},VLA:{EXT_URI:nd,EXT_URI_NON_ADV:nd+"-non-advertised",DEFAULT_VALUE:10},MACROBLOCK_SIZE:16,MAX_FS_1080P:8160,MEDIA_EVENT_FIELDS:{Extensions:["IceConnectionState","IceConnectionStatePrevious","SignalingState","SignalingStatePrevious"],metrics:["ReconnectInProgress","IceConnectedStateTime","ErrorType","ErrorDetail","InitialNegotiationType","InitialNegotiationCompleted","TerminationReason_subCode","TerminationReason_code","MediaLegId"]},RES_TABLE:{SEND:[{w:320,h:180,fps:15,minBr:2e4,maxBr:175e3},{w:416,h:234,fps:15,minBr:125e3,maxBr:5e5},{w:640,h:360,fps:30,minBr:4e5,maxBr:575e3},{w:960,h:540,fps:30,minBr:5e5,maxBr:1125e3},{w:1280,h:720,fps:30,minBr:1e6,maxBr:25e5},{w:1920,h:1080,fps:30,minBr:175e4,maxBr:1e8}],RECV:[{w:320,h:180,fps:15,minBr:2e4,maxBr:175e3},{w:426,h:240,fps:15,minBr:125e3,maxBr:5e5},{w:640,h:360,fps:30,minBr:4e5,maxBr:575e3},{w:960,h:540,fps:30,minBr:5e5,maxBr:1125e3},{w:1280,h:720,fps:30,minBr:1e6,maxBr:25e5},{w:1920,h:1080,fps:30,minBr:175e4,maxBr:1e8}]},NATIVE_RATIO_PRECISION:6};function nh(e,t){for(let i in e)e.hasOwnProperty(i)&&t(e[i],i)}function ng(e,t){for(let i in e)e.hasOwnProperty(i)&&("object"==typeof e[i]?ng(e[i],t):t(e[i],i,e))}function np(e){return null!=e&&!Number.isNaN(e)}function nf(e,t){return np(t)?np(e)?Math.min(e,t):t:e}function nm(e,t){return np(t)?np(e)?Math.max(e,t):t:e}function nv(e){let t=0;return e.forEach(e=>t+=e),t/=e.length}function nS(e){if(0===e.length)return 0;let t=[...e].sort((e,t)=>e-t),i=Math.floor(t.length/2);return t.length%2==1?t[i]:(t[i-1]+t[i])/2}function ny(e,t){let i=!1;for(let n=e.length;n-- >0;)t(e[n],n,e)&&(e.splice(n,1),i=!0);return i}function nC(e,t,i){let n=[];return e.forEach(e=>{t.some(t=>i(e,t))||n.push(e)}),0===n.length&&e.length===t.length}function nb(e){let t=[];for(let i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t}function nT(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}function nE(e){return!Object.keys(e).length}function n_(e){return Object.keys(e)}function nI(e){let t={};return nh(e,(e,i)=>{t[i]=e}),t}function nw(e){let t;if(!e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){t=[];for(let i=0,n=e.length;i<n;i++)t[i]=nw(e[i]);return t}if(e instanceof Object)return t={},nh(e,function(e,i){t[i]=nw(e)}),t;throw Error("Unable to copy: "+t$(e))}function nP(e){return Object.keys(e).forEach(t=>{(void 0===e[t]||"{}"===e[t]||"[]"===e[t])&&delete e[t]}),e}function nR(){let e=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return e()+e()+e()+"4"+e().substring(1)+"b"+e().substring(1)+e()+e()+e()}function nA(e,t){let i,n=typeof e,r=typeof t;if(e===t)return!0;if(n!==r||"object"!==n&&"function"!==n)return!1;if(null===e||null===t)return e===t;if(e instanceof Date&&t instanceof Date)return+e==+t;if(e instanceof Map&&t instanceof Map)return nM(e,t);for(i in e)if(!(i in t)||!nA(e[i],t[i]))return!1;for(i in t)if(!(i in e)||!nA(e[i],t[i]))return!1;return!0}function nM(e,t){let i;if(e.size!==t.size)return!1;let n=!0;return e.forEach((e,r)=>{(i=t.get(r))===e&&(void 0!==i||t.has(r))||(n=!1)}),n}function nD(e,t){return t.reduce((t,i)=>{let n=e.includes(i)?i.length:0;return t.length<n?i:t},"")}function nO(e,t){if(-1===t.indexOf(e))throw{detail:`${e} mediaContent.contentType is not supported`,type:nu.MEDIA_ERROR.incompatibleOffer}}function nk(e,t){e.forEach(e=>{if(""!==e&&-1!==t.findIndex(t=>t===e))throw{detail:`Required feature '${e}' is not acceptable.`,type:nu.MEDIA_ERROR.incompatibleOffer}})}function nN(e,t,i,n=0){for(let r=1;r<e.length;r++)if(e[r-1]+n<t&&t<=e[r]+n)return i?e[r]:e[r-1];return e[0]}function nx(e,t,i){return t<=e&&e<=i}function nL(e,...t){for(let i of t)if(i.hasOwnProperty(e))return i[e]}function nF(e,t){return e.filter(e=>!t.some(t=>t===e))}function nU(e,t){if(e===t)return e;let i=0,n=0,r="";for(let s=0;s<e.length&&!(r.length>e.length-s);s++){let a=s;n-i>r.length&&(r=e.substring(i,n),s=n-1),i=s,n=s;for(let o=0;o<t.length;o++)a<e.length&&t[o]===e[a++]?n=a:(a=s,n-i>r.length&&(r=e.substring(i,n),s=n-1),i=s,n=s)}return r}function n$(e,t){let i=Array(e.length+1);for(let n=0;n<e.length+1;n++){i[n]=Array(t.length+1);for(let e=0;e<t.length+1;e++)i[n][e]=0}for(let t=1;t<e.length+1;t++)i[t][0]=t;for(let e=1;e<t.length+1;e++)i[0][e]=e;for(let n=1;n<e.length+1;n++)for(let r=1;r<t.length+1;r++){let s=1;e[n-1]===t[r-1]&&(s=0),i[n][r]=Math.min(i[n-1][r]+1,i[n][r-1]+1,i[n-1][r-1]+s)}return i[e.length][t.length]}function nV(e){return e.reduce((e,t)=>e+t,0)/(e.length?e.length:1)}function nB(e,t=3){return e&&parseFloat(e.toFixed(t))}function nH(e,t){if(!e)return"";if(e.length<3)return e;let i=[],n=e.match(/\(([0-9a-zA-Z]+:[0-9a-zA-Z]+)\)/);n&&i.push(n[1]);try{if(t?.length){let n=RegExp(`(${t.join("|")})`,"gi"),r=n.exec(e);for(;r;)i.push(r[1]),r=n.exec(e)}else i.push("no_keywords")}catch(e){i.push(`Error: ${t$(e)}`)}return 0===i.length?"unknown":i.join(" ")}function nj(e,t,i=0){return e&&void 0!==t&&t>-1&&e.length>t&&e.splice(i,e.length-t),e}function nq(e,t,i,n=0){nj(e,0===i?0:i-1,n),0!==i&&e.push(t)}function nW(e,t){let i={};for(let e in t)i[e]={get:t[e],configurable:!1,enumerable:!0};Object.defineProperties(e,i)}function nG(e){return e?.length>0?e[e.length-1]:void 0}var nz=globalThis?.performance?.now&&globalThis?.performance?.timeOrigin,nJ=nz?()=>globalThis.performance.now():()=>Date.now(),nK=nz?globalThis.performance.timeOrigin:0,nQ=nJ,nY=nK;function nZ(e,t,i){if(e?.length>0){let n=[];for(let r of e){let e=nw(r);e[t]=e[t]&&e[t]-i,n.push(e)}return n}return e}function nX(e,t,i){if(!e)return;let n={seconds1to3:[],seconds3to5:[],seconds5to8:[],seconds8to15:[],seconds15to60:[],seconds60toMax:[]};for(let[r,s]of Object.entries(e))for(let e of s)nq(n[r],e-t,i);return n}function n0(e,t,i=!1){let n=e?.map(t).filter(e=>void 0!==e&&!isNaN(e)&&null!==e&&(!1===i||0!==e));return n?.length?n.join(","):void 0}function n1(e,t,i){let n=e?.map(t).filter(e=>void 0!==e&&!isNaN(e)&&null!==e).splice(-i);return n?.length?n:void 0}function n2(e,t){let i=[];for(let n of Object.keys(e))t.has(n)||i.push(n);for(let t of i)delete e[t]}function n3(e,t){let i=[];for(let n of e.keys())t.has(n)||i.push(n);for(let t of i)e.delete(t)}function n4(e){return"object"==typeof e?t$(e):e}function n5(e){let t=Object.keys(e).map(Number).sort((e,t)=>e-t),i=t.reduce((t,i)=>t+(e[i]??0),0);return{getPercentile:n=>{let r=i*n,s=0;for(let i of t)if((s+=e[i])>=r)return i}}}function n6(e,t){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t.toLowerCase())?e[t.toLowerCase()]:void 0}function n8(e){let t=e.toLowerCase(),i='token_types="',n=t.indexOf(i);if(-1===n)return[];let r=t.indexOf('"',n+i.length);if(-1===r)return[];let s=t.substring(n+i.length,r).trim();return""===s?[]:s.split(" ")}function n9(e){return 16*Math.ceil(e/16)}function n7(e,t,i,n){return JSON.stringify(nZ(nj(e,t),i,n))}function re(e){if(!e)return[void 0,void 0,void 0];let[t,i,n,r]=[0,0,Number.MAX_SAFE_INTEGER,0];for(let[s,a]of Object.entries(e)){let e=+s;t+=e*a,i+=a,n=Math.min(n,e),r=Math.max(r,e)}return[t/i,n,r]}var rt=i(892891);function ri(e){return e.map(e=>new rn(e.w,e.h,e.fps,e.minBr,e.maxBr))}var rn=class{constructor(e,t,i=0,n=0,r=0){this.width=e,this.height=t,this.fps=i,this.minBitrate=n,this.maxBitrate=r,this.fs=Math.ceil(e/nu.MACROBLOCK_SIZE)*Math.ceil(t/nu.MACROBLOCK_SIZE)}toString(){return this.height?`${this.height}p`:`${this.fs}fs`}},rr=class{get initialResolution(){return this.resolutions[this.resolutions.length-1]}getResolutionByFs(e){return this.getResolutionRecord(void 0,e)}getMaxFsForHeight(e){return this.getResolutionRecord(e).fs}getResolutionForBitrate(e){let t=this.resolutions.filter(t=>t.maxBitrate&&t.maxBitrate>=e).shift(),i=this.resolutions.filter(t=>t.minBitrate&&t.minBitrate<=e).pop();return t=t??i,i=i??t,{lowRes:t,highRes:i}}getBitrateForResolution(e,t){let i=this.getResolutionRecord(Math.min(e,t));return{minBitrate:i.minBitrate,maxBitrate:i.maxBitrate}}getResolutions(){return[...this.resolutions]}},rs=class e extends rr{constructor(e){super(),e||(this.resolutions=ri(nu.RES_TABLE.SEND)),this.resolutions=ri(e)}static initialize(t){e.Send=new e(t.config.sendResolutionTableOverride),e.Recv=new e(t.config.recvResolutionTableOverride),t.on("configUpdated",()=>{e.Send=new e(t.config.sendResolutionTableOverride),e.Recv=new e(t.config.recvResolutionTableOverride)})}getResolutionRecord(t,i){if(this===e.Send){for(let e=this.resolutions.length-1;e>=0;e--)if(t&&this.resolutions[e].height<=t||i&&this.resolutions[e].fs<=i)return this.resolutions[e];return this.resolutions[0]}for(let e of this.resolutions)if(t&&e.height>=t||i&&e.fs>=i)return e;return this.resolutions[this.resolutions.length-1]}getNextLowerResolution(t,i){let n=Math.min(t,i),r=this.getResolutionRecord(n),s=this.resolutions.indexOf(r);return n===Math.min(r.width,r.height)||this===e.Recv?this.resolutions[s-1]:this.resolutions[s]}getNextHigherResolution(t,i){let n=Math.min(t,i),r=this.getResolutionRecord(n),s=this.resolutions.indexOf(r);return n===Math.min(r.width,r.height)?this.resolutions[s+1]:this===e.Recv?this.resolutions[s]:this.resolutions[s+1]}};rs.Recv=new rs(nu.RES_TABLE.RECV),rs.Send=new rs(nu.RES_TABLE.SEND);var ra=rs,ro=e=>ra.Send.getResolutionByFs(e).height,rl=e=>ra.Send.getMaxFsForHeight(e),rc={numVideoChannelsGvc:({current:e,constraints:t})=>rh(e,t),specCompliantSimulcast:({current:e,constraints:t})=>rp(e,t),multiviewResolutionLimits:({current:e,constraints:t,logger:i})=>rg(e,t,i),enableVla:({current:e,settings:t,constraints:i,settingsSuffix:n})=>ry(e,t,i,n),allowRemoteVla:({current:e,settings:t,constraints:i,settingsSuffix:n})=>ry(e,t,i,n),enableNonAdvVla:({current:e,settings:t,constraints:i,settingsSuffix:n})=>ry(e,t,i,n),outgoingVideoLimit:({current:e,settings:t,constraints:i})=>rv(e,t,i),webrtcCameraOpenFs:({current:e,settings:t,constraints:i,settingsSuffix:n})=>rS(e,t,i,n),webrtcVideoCapabilityMaxFS:({current:e,settings:t,constraints:i,settingsSuffix:n})=>rS(e,t,i,n)},rd=(e,t,i)=>({...ru(e,t,i),...ru(e,t,i,"1on1"),...ru(e,t,i,"Multiparty")}),ru=(e,t,i,n)=>{let r={};for(let s of Object.keys(rc)){let a=`${s}${n??""}`;(!n||np(t[a]))&&(r[a]=rc[s]({current:t[a],settings:t,constraints:i,settingsSuffix:n,logger:e}))}return r},rh=(e,t)=>nf(e,t.maxIncomingStreams),rg=(e,t,i)=>{let n=t.maxParticipantResolutions;if(!n)return e;let r={more:e.more};if(Number.isInteger(n))Object.keys(e).forEach(t=>{r[t]=nf(n,e[t])});else{let t=Object.keys(n);if(!t.length)return i.warn(`ignoring invalid value provided for maxParticipantResolutions: ${n}}`),e;t.forEach(t=>{r[t]=nf(n[t],e[t]||e.more)})}return r},rp=(e,t)=>void 0!==t.maxSimulcastLayers||e.allowOverride?{...e,video:rf(e.video,t),sharing:rf(e.sharing,t)}:e,rf=(e,t)=>{let i=e?.layerScaleFactors?.filter(e=>e<=t.maxSimulcastLayers);return i?.length>1?{...e,layerScaleFactors:i}:{...e,enableLocally:!1,allowEnableRemotely:!1}},rm=e=>nf((0,rt.isNumber)(e?.outgoingVideoLimit)?e?.outgoingVideoLimit:e?.outgoingVideoLimit?.maxResolution,e?.maxOutgoingResolution),rv=(e,t,i)=>{let{outgoingVideoLimit:n}=i,r=(0,rt.isNumber)(n),s=rm(i);if(t.sendVideoCapabilityManager?.isEnabled){let s=e=>e?ro(e):e,a=(e,t,i,n)=>t?nm(nf(t,n),i):e,o=r?void 0:n?.maxFramerate,l=r?void 0:n?.maxBitrate,c=rm(i);return{...e,maxResolution:a(e?.maxResolution,c,s(t.sendVideoCapabilityManager?.minFS),s(t.sendVideoCapabilityManager?.maxFS)),maxFramerate:a(e?.maxFramerate,o,t.sendVideoCapabilityManager?.minFPS,t.sendVideoCapabilityManager?.maxFPS),maxBitrate:a(e?.maxBitrate,l)}}let a=nf(e?.maxResolution,s);if(s>0&&t.maxCameraFsViaCallConstraints>0){let e=ro(t.maxCameraFsViaCallConstraints);a=nm(nf(a,e),nf(s,e))}let o=nf(e?.maxBitrate,r?void 0:n?.maxBitrate),l=nf(e?.maxFramerate,r?void 0:n?.maxFramerate);return{...e,maxResolution:a,maxBitrate:o,maxFramerate:l}},rS=(e,t,i,n)=>{if(rm(i)>0&&t.maxCameraFsViaCallConstraints>0){let{maxResolution:r}=rv(t[`outgoingVideoLimit${n??""}`],t,i),s=r?rl(r):e;return nm(e,s)}return e},ry=(e,t,i,n)=>(!(t.specCompliantSimulcast.constraintsDisableVla||t[`specCompliantSimulcast${n}`]?.constraintsDisableVla)||!(i.maxSimulcastLayers<2))&&e,rC=class extends no{constructor(e){super(e),this.logger=e,this._constraints={},this._callConstraintsTelemetry=[]}get constraints(){return this._constraints}get callConstraintsTelemetry(){return this._callConstraintsTelemetry}addCallConstraintsTelemetryEvent(e,t){let i={timestamp:new Date().getTime(),type:t,value:e};this._callConstraintsTelemetry.push(i)}setConstraints(e){this.logger.debug("Setting new platform call constraints",JSON.stringify(e)),this._constraints=e,this.addCallConstraintsTelemetryEvent(e,"requested"),this.raiseChanged()}getSettings(e){return rd(this.logger,e,this._constraints)}},rb=i(892891),rT='"rtcmedia"';function rE(e){return{expires:e.expires,username:e.username,password:e.password,realm:e.realm}}var r_=class{constructor(e){this.version=e,this.reports={}}watch(e){let t={time:Date.now(),duration:-1,version:this.version};return this.reports[e]&&(this.reports[`${e}_prev`]=this.reports[e]),this.reports[e]=t,{end:e=>{e&&(t.error=e),t.duration=Date.now()-t.time}}}getReports(){return this.reports}};function rI(e){return{Service:e.Service,Relay:e.Relay,Token:e.Token}}var rw="configFetch",rP="skypeTokenFetch",rR="trapTokenFetch",rA=class{constructor(e){this.updateRelaysPromise=null,this.trapTokens={},this.relaysOverride=[],this.timers=new r_(1),this.context=e,this.logger=e.logger.createChild("RM"),this.request=e.request,this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync(!0))}setRelayOverride(e){this.relaysOverride=e}setDefaultRelayConfig(e){this.config??(this.config=e)}async queryRelaysAsync(e={}){if(this.logger.info("query relays"),this.relaysOverride.length>0)return this.relaysOverride;this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync());let t=await this.updateRelaysPromise;return t?"turn"===e.relayType?t.Turn:e.isRemoteClientLync?t.Lync:t.Skype:[]}getAuthTokenStats(){}getStats(){return{config:rI(this.config),stats:this.timers.getReports()}}updateRelaysFromConfigAsync(e=!1){let t=this.getConfigAsync().then(()=>this.updateRelaysAsync()).then(e=>(this.updateRelaysPromise=t,e)).catch(t=>(this.updateRelaysPromise=null,e?this.logger.warn("failed to retrieve relays",tV(t)):this.logger.error("failed to retrieve relays",tV(t)),null));return t}refreshRelaysFromConfig(){this.request.isOnline()?this.updateRelaysFromConfigAsync():(this.updateRelaysPromise=null,this.logger.warn("not refreshing relays due to no network connection"))}updateRelaysAsync(){let e,t=this.config.Service.tokenUrl,i=async()=>(e=this.timers.watch(rR),this.context.trapTokenCredentialsProvider()),n=async()=>{let i=this.timers.watch(rP),n="";try{n=await this.context.tokenProvider(),this.logger.info("fetching skypeToken")}catch(e){throw i.end(tV(e)),e}return i.end(),e=this.timers.watch(rR),(await this.request.get(t,{headers:{"X-Skypetoken":n,"api-version":2}})).response},r=this.context.trapTokenCredentialsProvider?i:n;return this.logger.info(`Fetch TRAP token ${this.context.trapTokenCredentialsProvider?"with provider":"directly"}`),r().then(t=>{e.end();let i=0,n=this.config.Token.earlyRefreshMinutes,r=this.config.Token.earlyRefreshPercentage;this.storeTrapTokens(t),i=Math.max(t.expires-60*n,t.expires*r/100),setTimeout(this.refreshRelaysFromConfig.bind(this),1e3*i);let s=this.config.Relay.Turn.realm?this.config.Relay.Turn.realm:rT,a=rE(this.getTrapToken(s)),o={addresses:this.config.Relay.Skype.addresses,fqdns:this.config.Relay.Skype.fqdns,tcpPort:this.config.Relay.Skype.tcpPort,udpPort:this.config.Relay.Skype.udpPort,type:"msturn"},l={addresses:this.config.Relay.Lync.addresses,fqdns:this.config.Relay.Lync.fqdns,tcpPort:this.config.Relay.Lync.tcpPort,udpPort:this.config.Relay.Lync.udpPort,type:"msturn"},c={addresses:this.config.Relay.Turn.addresses,fqdns:this.config.Relay.Turn.fqdns,tcpPort:this.config.Relay.Turn.tcpPort,udpPort:this.config.Relay.Turn.udpPort,tlsPort:this.config.Relay.Turn.tlsPort,type:"turn"},d={Skype:[{...o,...a}],Lync:[{...l,...a}],Turn:[{...c,...a}]};return this.logger.info("relays from trap",[o,l,c]),d}).catch(t=>{throw e&&e.end(tV(t)),t})}storeTrapTokens(e){if(!e?.tokens)return void this.logger.error("failed to get tokens from trap response");let t={};e.tokens.forEach(i=>{t[i.realm]={expires:e.expires,username:i.username,password:i.password,realm:i.realm}}),this.trapTokens=t}getTrapToken(e){if("string"==typeof e){let t=e.replace(/^"|"$/g,""),i=`"${t}"`,n=this.trapTokens[i]||this.trapTokens[t];if(n)return n}throw Error(`token for relay not found, realm: ${e}`)}async getConfigAsync(){this.logger.info("retrieving configuration");let e=this.timers.watch(rw);try{let t=await this.context.configProvider();e.end(),this.logger.info("retrieved configuration:",t),(0,rb.isEmpty)(t)||(this.config=t),this.logger.info("applied configuration:",this.config)}catch(t){this.logger.warn("failed to retrieve configuration",t$(t)),e.end(tV(t))}}};function rM(e){return new rA(e)}var rD=i(892891),rO="aadTokenFetch",rk=class{constructor(e){this.updateRelaysPromise=null,this.trapTokens={},this.relaysOverride=[],this.timers=new r_(2),this.context=e,this.authTokenFetcher=this.context.authTokenFetcher,this.logger=e.logger.createChild("RM2")}setRelayOverride(e){this.relaysOverride=e}setDefaultRelayConfig(e){this.config??(this.config=e),this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync(!0))}setClientSupportsGenericTokenApi(e){this.authTokenFetcher.supportsGenericTokenApi=e}async queryRelaysAsync(e={}){if(this.logger.info("query relays"),this.relaysOverride.length>0)return this.relaysOverride;this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync());let t=await this.updateRelaysPromise;return t?"turn"===e.relayType?t.Turn:e.isRemoteClientLync?t.Lync:t.Skype:[]}getStats(){return{config:rI(this.config),stats:this.timers.getReports()}}getAuthTokenStats(){return this.context.authTokenFetcher.getStats()}updateRelaysFromConfigAsync(e=!1){let t=this.getConfigAsync().then(()=>this.updateRelaysAsync()).then(e=>(this.updateRelaysPromise=t,e)).catch(t=>(this.updateRelaysPromise=null,e?this.logger.warn("failed to retrieve relays",tV(t)):this.logger.error("failed to retrieve relays",tV(t)),null));return t}refreshRelaysFromConfig(){this.context.isOnline()?this.updateRelaysFromConfigAsync():(this.updateRelaysPromise=null,this.logger.warn("not refreshing relays due to no network connection"))}async updateRelaysAsync(){let e=this.context.configProvider?.config.useNewTokenApi?rO:rP,t=this.timers.watch(e),i=e9();this.logger.info(`${i}[RM2] Fetch TRAP token`);try{let e=await this.context.authTokenFetcher.fetchTrapToken(i,this.config);t.end();let n=0,r=this.config.Token.earlyRefreshMinutes,s=this.config.Token.earlyRefreshPercentage;this.storeTrapTokens(e),n=Math.max(e.expires-60*r,e.expires*s/100),setTimeout(this.refreshRelaysFromConfig.bind(this),1e3*n);let a=this.config.Relay.Turn.realm?this.config.Relay.Turn.realm:rT,o=rE(this.getTrapToken(a)),l={addresses:this.config.Relay.Skype.addresses,fqdns:this.config.Relay.Skype.fqdns,tcpPort:this.config.Relay.Skype.tcpPort,udpPort:this.config.Relay.Skype.udpPort,type:"msturn"},c={addresses:this.config.Relay.Lync.addresses,fqdns:this.config.Relay.Lync.fqdns,tcpPort:this.config.Relay.Lync.tcpPort,udpPort:this.config.Relay.Lync.udpPort,type:"msturn"},d={addresses:this.config.Relay.Turn.addresses,fqdns:this.config.Relay.Turn.fqdns,tcpPort:this.config.Relay.Turn.tcpPort,udpPort:this.config.Relay.Turn.udpPort,tlsPort:this.config.Relay.Turn.tlsPort,type:"turn"},u={Skype:[{...l,...o}],Lync:[{...c,...o}],Turn:[{...d,...o}]};return this.logger.info("relays from trap",[l,c,d]),u}catch(e){throw this.logger.info(`Fetch TRAP token failed with error ${e}`),t&&t.end(tV(e)),e}}storeTrapTokens(e){let t={};if(e?.tokens)e.tokens.forEach(i=>{t[i.realm]={expires:e.expires,username:i.username,password:i.password,realm:i.realm}});else{if(!e.realm)return void this.logger.error("failed to get tokens from trap response");t[e.realm]=e}this.trapTokens=t}getTrapToken(e){if("string"==typeof e){let t=e.replace(/^"|"$/g,""),i=`"${t}"`,n=this.trapTokens[i]||this.trapTokens[t];if(n)return n}throw Error(`token for relay not found, realm: ${e}`)}async getConfigAsync(){this.logger.info("retrieving configuration");let e=this.timers.watch(rw);try{let t=await this.context.relayConfigProvider();e.end(),this.logger.info("retrieved configuration:",t),(0,rD.isEmpty)(t)||(this.config=t),this.logger.info("applied configuration:",this.config)}catch(t){this.logger.warn("failed to retrieve configuration",tV(t)),e.end(tV(t))}}},rN=class{constructor(e,t,i,n,r){this.signalingAgentProvider=t,this.request=i,this.tokenProviders=n,this.configProvider=r,this.errors=[],this.clientSupportsGenericTokenAPI=!1,this.logger=e.createChild("AuthTokenFetcher")}set supportsGenericTokenApi(e){this.clientSupportsGenericTokenAPI=e}buildHeaders(e,t){let i={};switch(i["api-version"]=2,this.configProvider?.config.useTokenMigrationHeader&&(i["X-MS-Migration"]="True"),e){case 4:case 8:return i.Authorization=`Bearer ${t}`,i;case 1:return i["X-Skypetoken"]=t,i;default:throw Error(`TokenType ${e} is not supported`)}}serviceSupportedTokenTypes(e){let t=null;if(void 0===e)t=this.clientSupportedTokenTypes();else{let i=e?.toLowerCase();t=this.constructTokenType(i)}return null===t&&this.configProvider?.config.useSkypeTokenWhenNoAuthenticateHeader&&(t|=1),t}extractWwwauthenticateHeaders(e){let t={};if(e){let i=n6(e,"www-authenticate");i&&(t={authenticationHeaders:[i]})}return t}convertStringToTokenType(e){switch(e){case"cae":return 8;case"aad":return 4;case"skype":return 1;default:return this.logger.info("[authTokenFetcher][convertStringToTokenType]unexpected: unrecognized token type ${tokenType}"),null}}getTokenTypeFromHeaders(e,t){if(!this.clientSupportsGenericTokenAPI)return 1;let i=null,n=t?.authenticationHeaders;if(!n&&e)this.configProvider?.config.useSkypeTokenWhenNoAuthenticateHeader?(this.logger.info("[authTokenFetcher][getAuthHeadersTokenTypes] no www-authenticate header received, fallback to skype token"),i=1):(this.logger.info("[authTokenFetcher][getAuthHeadersTokenTypes] Service has not provided www-authenticate headers. use client supported tokens"),i=this.clientSupportedTokenTypes());else if(n||e){if(n&&e)for(let e of n){let t=n8(e);if(this.configProvider?.config.supportMissingTokenTypesInResponse&&0===t.length)this.logger.info("[authTokenFetcher][getAuthHeadersTokenTypes] Service has www-authenticate header, but no token types. Use client supported tokens"),i=this.clientSupportedTokenTypes();else for(let e of t){let t=this.convertStringToTokenType(e.toLowerCase());this.configProvider?.config.clientSupportsCaeToken&&8===t&&(i|=8),this.configProvider?.config.clientSupportsAadToken&&4===t&&(i|=4),this.configProvider?.config.clientSupportsSkypeToken&&1===t&&(i|=1)}}}else this.logger.info("[authTokenFetcher][getTokenTypeFromHeaders] retrying to fetch token woth client supported tokens"),i=this.clientSupportedTokenTypes();return i}constructTokenType(e){let t=null;return e.includes("aad")&&this.configProvider?.config.clientSupportsAadToken&&(t|=4),e.includes("cae")&&this.configProvider?.config.clientSupportsCaeToken&&(t|=8),e.includes("skype")&&this.configProvider?.config.clientSupportsSkypeToken&&(t|=1),t}getTokenMetadataForTrapService(e,t,i){let n=JSON.stringify({verb:"POST",path:e}),r=null,s=this.extractWwwauthenticateHeaders(i),a=!!s?.authenticationHeaders;return r=i?this.getTokenTypeFromHeaders(a,s):this.serviceSupportedTokenTypes(t),this.logger.info(`[authTokenFetcher][getTokenMetadata] return token type=${r}, factoJson=${n}`),{tokenType:r,factorsJson:n,requestMetadataJson:s,isUnauthorized:a}}clientSupportedTokenTypes(){let e=null;return this.configProvider?.config.clientSupportsAadToken&&(e|=4),this.configProvider?.config.clientSupportsCaeToken&&(e|=8),this.configProvider?.config.clientSupportsSkypeToken&&(e|=1),e}async handleAuthTokenFailure(e,t,i,n){this.logger.info("[authTokenFetcher][handleAuthTokenFailure] failed to fetch token, retrying");try{let r=this.getTokenMetadataForTrapService(t,void 0,i);return this.logger.info(`[authTokenFetcher][handleAuthTokenFailure] token request options=${r}`),r.invalidToken=n,await this.signalingAgentProvider.getSignalingAgent().authTokenManager.getToken(e,!1,r)}catch(t){let e={status:t?.response?.status||t?.status,error:t,fatal:!0};this.errors.push(t$(e)),this.logger.error(`[authTokenFetcher] failed to fetch token trough new api with error: ${t$(e)}, quiting`)}}getRequestToken(e){let t=n6(e,"X-Skypetoken");if(t)return t;let i=n6(e,"Authorization");if(i){let e=i.split(" ");if(2===e.length)return e[1]}}async fetchTrapCredentials(e,t,i){let n=this.buildHeaders(t,e),r=await this.request.get(i,{headers:n});return r?.response}async fetchTrapTokenWithNewTokenApi(e,t,i){let n;this.logger.info(`${i}[authTokenFetcher] fetching token through fetchTrapTokenWithNewTokenApi`);let r=this.getTokenMetadataForTrapService(e,t);try{return n=await this.signalingAgentProvider.getSignalingAgent().authTokenManager.getToken(i,!1,r),this.tokenTypeFetched=this.signalingAgentProvider.getSignalingAgent().authTokenManager.getLastTokenType(i),await this.fetchTrapCredentials(n,this.tokenTypeFetched,e)}catch(s){let t={status:s?.response?.status||s?.status,error:s,fatal:!1};this.errors.push(t$(t)),this.logger.error(`${i}[authTokenFetcher] fetchTrapTokenWithNewTokenApi failed with ${t$(t)}, retrying...`);let r=s?.response?.headers;if(r){let t=this.getRequestToken(r);return n=await this.handleAuthTokenFailure(i,e,r,t),this.tokenTypeFetched=this.signalingAgentProvider.getSignalingAgent().authTokenManager.getLastTokenType(i),await this.fetchTrapCredentials(n,this.tokenTypeFetched,e)}throw s}}async fetchTrapTokenThroughProvider(){return this.logger.info("[authTokenFetcher][authTokenFetcher] fetching token through fetchTrapTokenThroughProvider"),this.tokenProviders.trapTokenCredentialsProvider()}async fetchTrapTokensWithLegacyTokenFetcher(e,t){this.logger.info(`${t}[authTokenFetcher][authTokenFetcher] fetching token through fetchTrapTokensWithLegacyTokenFetcher`);try{this.tokenTypeFetched=1;let t=await this.tokenProviders.skypeTokenProvider();return(await this.request.get(e,{headers:{"X-Skypetoken":t,"api-version":2}})).response}catch(e){throw this.errors.push(t$(e)),this.logger.error(`${t}[authTokenFetcher] fetchTrapTokensWithLegacyTokenFetcher failed with ${t$(e)}`),e}}getStats(){return{tokenType:this.tokenTypeFetched,errors:tj(this.errors,this.configProvider?.config.diagnostics.telemetryLimits.numAuthTokenErrors??100)}}async fetchTrapToken(e,t){this.logger.info(`${e}[AuthTokenFetcher] Start fetching token`);let i=t.Service.tokenUrl,n=t.Service.supportedTokenTypes;return this.configProvider?.config.useNewTokenApi?this.fetchTrapTokenWithNewTokenApi(i,n,e):this.tokenProviders.trapTokenCredentialsProvider?this.fetchTrapTokenThroughProvider():this.fetchTrapTokensWithLegacyTokenFetcher(i,e)}},rx=class{constructor(e,t,i){this.config=e,this.signalingAgentProvider=t,this.logger=i}getOrCreateRelayManager(){return this.config.relayManager?this.config.relayManager:this.relayManager||this.createRelayManager()}setConfigProvider(e){this.configProvider=e}createRelayManager(){return this.relayManager??(this.relayManager=this.buildRelayManager(this.config.httpRequestDispatcher,this.config.tokenProvider,this.config.configProvider,this.config.appStateProvider,this.config.trapTokenCredentialsProvider,this.configProvider))}buildRelayManager(e,t,i,n,r,s){let a=e||new tW(this.logger),o={get:(e,t)=>a.getAsync(e,{...a.getRequestOptions("GET",t?.headers,null,t?.timeout)}),isOnline:n.isOnline};if(!this.configProvider?.config.useNewTokenApi)return rM({logger:this.logger,tokenProvider:t,trapTokenCredentialsProvider:r,configProvider:()=>i.getRelayConfig(),request:{get:(e,t)=>a.getAsync(e,{...a.getRequestOptions("GET",t?.headers,null,t?.timeout)}),isOnline:n.isOnline}});{let e=new rN(this.logger,this.signalingAgentProvider,o,{skypeTokenProvider:t,trapTokenCredentialsProvider:r},s);return new rk({logger:this.logger,relayConfigProvider:()=>i.getRelayConfig(),isOnline:n.isOnline,authTokenFetcher:e,configProvider:s})}}},rL=eR(i(892891)),rF=eR(eK()),rU="Success",r$="ExpectedError",rV="UnexpectedClientError",rB="UnexpectedServerError",rH={INCOMING_MESSAGE_ORIGIN:{TROUTER:"Trouter",BROKER:"Broker"},INVITATION_TYPE:{NUDGE:"nudge"},KNOWN_PAYLOAD_ENCODINGS:{GZIP:!0},WEBRTC_NOTIFICATION_TYPE:{CONTROL_VIDEO_STREAMING:"ControlVideoStreaming",DOMINANT_SPEAKER_INFO:"DominantSpeakerInfo",CSRC_INFO:"CsrcInfo"},PARTICIPANT_AUDIO_STATE:{CONNECTING:"Connecting",RINGING:"Ringing",CONNECTED:"Connected",OTHER:"Other"},HEADERS:{MESSAGE_ID:"X-Microsoft-Skype-Message-ID",ORIGINAL_MESSAGE_ID:"X-Microsoft-Skype-Original-Message-ID",CONTENT_ENCODING:"X-Microsoft-Skype-Content-Encoding",CORRELATION_ID:"X-Microsoft-Skype-Chain-ID",CONTENT_SHARING_CORRELATION_ID:"X-Microsoft-Skype-ContentSharing-Chain-ID",CLIENT_USER_AGENT:"X-Microsoft-Skype-Client",SKYPE_TOKEN:"X-Skypetoken",AUTHORIZATION:"Authorization",BEARER_KEYWORD:"Bearer",AAD_KEYWORD:"Aad",CAE_KEYWORD:"Cae",SKYPE_KEYWORD:"Skype",CACHE_SKYPE_TOKEN:"X-CacheSkypeToken",AUTHENTICATE:"www-authenticate",TOKEN_MIGRATION:"X-MS-Migration",BROKER_USE_BATCHING_HEADER_NAME:"X-UseBatching",PARTICIPANT_ID:"X-Microsoft-Skype-Participant-ID",CONTENT_TYPE:"Content-Type",RING:"MS-Teams-Ring",REGION:"MS-Teams-Region",PARTITION:"MS-Teams-Partition"},KNOWN_BOTS:{VOICEMAIL_BOT_ID:"28:14524421-25b4-403a-a0f7-e62d4379cabc"},HTTP_STACK_ERROR:{NONE:0,CANNOT_CONNECT:7,REQUEST_TIMEOUT:10,ATTEMPT_TIMEOUT:30,REQUEST_ABORTED:16,ATTEMPT_ABORTED:31,ABORTED_OTHER_ATTEMPT_SUCCESSFUL:32},HTTP_STATUS_CODES:{UNKNOWN:0,OK:200,CREATED:201,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,FORBIDDEN:403,PRECONDITION_FAILED:412,UNPROCESSABLE_ENTITY:422,NETWORK_ERROR:490,SKYPE_TOKEN_ERROR:495,OFFLINE:496,TIMEOUT:498,ABORTED:498,OTHER:499,INTERNAL_SERVER_ERROR:500,CONFLICT:409,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504},CALL_END_SKYPE_TOKEN_ERROR:{code:495,subCode:4507,phrase:"CallEndReasonSkypeTokenFetchError",resultCategories:[rV]},CALL_END_TOKEN_TIMEOUT_ERROR:{code:499,subCode:3119,phrase:"CallEndReasonTokenFetchTimeout",resultCategories:[rV]},CALL_END_UNSUPPORTED_TOKEN_ERROR:{code:499,subCode:3126,phrase:"CallEndReasonUnsupportedTokenError",resultCategories:[rV]},CALL_END_TOKEN_ERROR:{code:499,subCode:3127,phrase:"CallEndReasonTokenFetchError",resultCategories:[rV]},CALL_END_TOKEN_TIMEOUT_INTERACTIVITY_REQUIRED:{code:499,subCode:3128,phrase:"CallEndReasonTokenTimeoutInterActvityRequired",resultCategories:[rV]},CALL_END_LOCAL_HTTP_STACK_ERROR:{code:496,subCode:4520,phrase:"LocalHTTPStackError",resultCategories:[rV]},CALL_END_UNKNOWN_ERROR:{code:497,subCode:3121,phrase:"CallEndReasonUnknownError",resultCategories:[rV]},CALL_END_NETWORK_ERROR:{code:490,subCode:4502,phrase:"CallEndReasonNetworkError",resultCategories:[rV]},CALL_END_DNS_HOST_NAME_RESOLVE_ERROR:{code:490,subCode:4522,phrase:"CallEndReasonDnsHostNameResolveError",resultCategories:[rV]},CALL_END_LOCAL_DECLINE:{code:486,subCode:4508,phrase:"LocalDecline",resultCategories:[rU]},RESOURCE_NOT_FOUND_ERROR:{code:404,subCode:404,phrase:"ResourceNotFound",resultCategories:[r$]},CALL_STATUS:{IDLE:"Idle",RINGING:"Ringing",CONNECTING:"Connecting",CONNECTED:"Connected",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly",LOCAL_TERMINATED:"LocalTerminated",REMOTE_TERMINATED:"RemoteTerminated"},MEDIA_TYPES:{AUDIO:"Audio",VIDEO:"Video",SCREEN_SHARER:"ScreenSharer",SCREEN_VIEWER:"ScreenViewer"},MUTE_SCOPE:{MYSELF:"Myself",EVERYONE_ELSE:"EveryoneElse",SPECIFIED_PARTICIPANTS:"SpecifiedParticipants"},URL_BASE:{CALLAGENT:"callAgent"},LINKS:{HANGUP:"hangup",MEDIA_REJECTION:"mediaRejection",MEDIA_ANSWER:"mediaAnswer",MEDIA_RENEGOTIATION:"mediaRenegotiation",ACCEPT:"accept",ATTACH:"attach",REJECT:"reject",REDIRECT:"redirect",REPLACE:"replace",TRANSFER:"transfer",NEW_OFFER:"newOffer",TRANSFER_ACCEPTANCE:"transferAcceptance",TRANSFER_COMPLETION:"transferCompletion",CONVERSATION_CONTROLLER:"conversationController",ADD_PARTICIPANT:"addParticipant",ADD_PARTICIPANTS_AND_MODALITY:"addParticipantsAndModality",LEAVE:"leave",NOTIFICATION_LINKS:"notificationLinks",REMOVE_PARTICIPANT:"removeParticipant",KEEPALIVE:"keepAlive",ADD_MODALITY:"AddModality",REMOVE_MODALITY:"RemoveModality",CONTENT_SHARING_CONTROLLER:"contentSharingController",CONTENT_SHARING_TAKE_CONTROL:"contentSharingTakeControl",CONTENT_SHARING_UPDATE_SESSION_STATE:"contentSharingUpdateSessionState",CONTENT_SHARING_UPDATE_PARTICIPANT_STATE:"contentSharingUpdateParticipantState",CONTENT_SHARING_NOTIFICATION_LINKS:"contentSharingNotificationLinks",CONTENT_SHARING_LEAVE:"contentSharingLeave",MUTE:"mute",UNMUTE:"unmute",ADMIT:"admit",ADMIT_ALL:"admitAll",CONTROL_VIDEO_STREAMING:"controlVideoStreaming",APPLY_CHANNEL_PARAMETERS:"applyChannelParameters",UPDATE_ENDPOINT_STATE:"updateEndpointState",UPDATE_ENDPOINT_METADATA:"updateEndpointMetadata",LMC_NOTIFICATION_LINKS:"lmcNotificationLinks",UPDATE_PARTICIPANT_ROLE:"updateParticipantRole",PUBLISH_STATE:"publishState",REMOVE_STATE:"removeState",UPDATE_MEETING_SETTINGS:"updateMeetingSettings",SEARCH_PARTICIPANTS:"searchParticipants",GET_ALL_PARTICIPANTS:"getAllParticipants",PARK:"park",UNPARK:"unpark",UPDATE_MEETING_LIVE_STATE:"updateMeetingLiveState",UPDATE_MEETING_GROUPS:"updateMeetingGroups",SET_MEETING_LAYOUT:"setMeetingLayout",UPDATE_PARTICIPANT_INTERPRETATION_STATE:"updateParticipantInterpretationState",JOIN_MEETING_GROUP:"joinMeetingGroup",LEAVE_MEETING_GROUP:"leaveMeetingGroup",SEND_MESSAGE:"sendMessage",UPDATE_PARTICIPANTS_PROPERTIES:"updateParticipantsProperties",UPDATE_MEDIA_DESCRIPTIONS:"updateMediaDescriptions",UPDATE_MEETING_STATES:"updateMeetingStates",UPDATE_MONITOR_SESSION:"monitor"},CONTENT_TYPE:{JSON:"application/json"},TROUTER_EVENT_TYPE:{SKYPE_SKYPE_CALL:107,LYNC_SKYPE_CALL:105},MISC:{CONVERSATION:"conversation",LOBBY_CALL_CONTROLLER:"lobby",LOBBY_PARTICIPANT_STATE:"lobby"},SIGNALING_FSM_STATE:{IDLE:"Idle",INCOMING:"Incoming",WAITING_CALL_ACCEPTANCE_ACK:"WaitingCallAcceptanceAck",OUTGOING:"Outgoing",CONNECTED:"Connected",OUTGOING_FOR_ROSTER_ONLY:"OutgoingForRosterOnly",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly"},MEDIA_RENEGOTIATION_FSM_STATE:{IDLE:"Idle",CALL_CONNECTED:"Connected",INCOMING_RENEGOTIATION:"IncomingRenegotiation",OUTGOING_RENEGOTIATION:"OutgoingRenegotiation",RENEGOTIATION_GLARE:"RenegotiationGlare"},CONTENT_SHARING_FSM_STATE:{IDLE:"Idle",CONTENT_SHARING_START_INITIATED:"ContentSharingStartInitiated",CONTENT_SHARING_JOIN_INITIATED:"ContentSharingJoinInitiated",CONTENT_SHARING_LEAVE_INITIATED:"ContentSharingLeaveInitiated",CONTENT_SHARING_DELETE_INITIATED:"ContentSharingDeleteInitiated",CONTENT_SHARING_CONNECTED:"ContentSharingConnected"},TIMEOUT_OPERATIONS:{ADD_PARTICIPANT:"AddParticipant",NUDGE_PARTICIPANT:"NudgeParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT:"Admit",CALL_REDIRECT:"CallRedirect",CALL_ME_BACK:"CallMeBack",INCOMING_CALL_ESTABLISHMENT:"IncomingCallEstablishment",OUTGOING_CALL_ESTABLISHMENT:"OutgoingCallEstablishment",MEDIA_ANSWER:"MediaAnswer",MEDIA_ANSWER_ACKNOWLEDGEMENT:"MediaAnswerAcknowledgement",ADD_MODALITY:"AddModality",UNMUTE:"Unmute",UPDATE_MEETING_ROLE:"UpdateMeetingRole",MAX_PREAHEATED_TIMEOUT:"MaxPreheateadTimeout",PARK_COMPLETION:"ParkCompletion",UNPARK_COMPLETION:"UnparkCompletion",UPDATE_MEETING_LIVE_STATE_COMPLETION:"UpdateMeetingLiveStateCompletion",UPDATE_MEETING_GROUPS_COMPLETION:"UpgradeMeetingGroupsCompletion",UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION:"UpdateParticipantInterpretationStateCompletion",UPDATE_PARTICIPANTS_PROPERTIES_COMPLETION:"UpdateParticipantsPropertiesCompletion",JOIN_MEETING_GROUP_COMPLETION:"JoinMeetingGroupCompletion",LEAVE_MEETING_GROUP_COMPLETION:"LeaveMeetingGroupCompletion",SET_MEETING_LAYOUT_COMPLETION:"SetMeetingLayoutCompletion",SEND_MESSAGE_COMPLETION:"SendMessageCompletion",DISABLE_PREHEAT_ASYNC_TIMEOUT:"DisablePreheatAsyncTimeout",UPDATE_MEETING_STATES_COMPLETION:"UpdateMeetingStatesCompletion",UPDATE_MONITOR_SESSION_COMPLETION:"UpdateMonitorSessionCompletion"},CALL_END_CODE:{REJECT:603,SUCCESS:0,CALL_REDIRECTED:302,CANCEL:487,TIMEOUT:408,SERVICE_UNAVAILABLE:500,BAD_REQUEST:406,NO_NGC_ENDPOINT:480,P2P_FALLBACK_FOR_SCREENSHARING:460,CONFLICT:409,MEDIA_ERROR:410,CONF_PARTICIPANT_COUNT_LIMIT_REACHED:413,CALL_DOES_NOT_EXIST:481,CALL_ACCEPTED:450,CALL_FORWARDED:451,CALL_FORWARDED_TO_VOICEMAIL:452,P2P_REJECT_CALL:453,P2P_FALLBACK_DUE_TO_GROUPCALL:461,CALL_LEG_ENDED_ON_SERVICE:470,NOT_ACCEPTABLE_HERE:488,NETWORK_ERROR:490,UNKNOWN_ERROR:497,LOCAL_ERROR:498,CALL_MODALITY_FAILURE:580,ATC_CONTROLLER_FAILURE:581,CVA_CONTROLLER_FAILURE:586,GLARE_ERROR:491,NOT_FOUND:404,SKYPE_TOKEN_ERROR:495,LOCAL_HTTP_STACK_ERROR:496,HTTP_OTHER_ERROR:499,DECODING_FAILED:407,NOT_AUTHORIZED:403,BAD_SERVICE_RESPONSE:400},CALL_END_SUB_CODE:{SUCCESS:0,CALL_REDIRECTED_SUCCESS:3020,DOWNGRADE_TO_STREAMING_CLIENT:3099,MEDIA_DROP_DURING_CONNECT:3100,MEDIA_DROP_AFTER_CONNECT:3101,MEDIA_ANSWER_PROCESSING_ERROR:3102,MEDIA_FINAL_ANSWER_PROCESSING_ERROR:3103,MEDIA_OFFER_TIMEOUT:3104,MEDIA_FINAL_ANSWER_TIMEOUT:3105,MEDIA_OFFER_NULL:3106,MEDIA_AUDIO_DEVICE_ERROR:3107,MEDIA_RENEGOTIATION_ERROR:3108,MEDIA_PERMISSION_ERROR:3109,MEDIA_UNKNOWN_ERROR:3110,MEDIA_OFFER_PROCESSING_ERROR:3111,MEDIA_WHITELISTING_ISSUE:3112,MEDIA_MUTE_MICROPHONE_ERROR:3114,MEDIA_MUTE_SPEAKER_ERROR:3115,MEDIA_UNMUTE_MICROPHONE_ERROR:3116,MEDIA_UNMUTE_SPEAKER_ERROR:3117,MEDIA_GLARE_ERROR:3118,CONVERSATION_TERMINATION_UNKNOWN_ERROR:3121,CONVERSATION_NOTIFICATION_TIMEOUT:3125,CALL_NOT_ATTEMPTED:4500,CONV_URL_NOT_SET:4501,FAILED_TO_REACH_SERVICE:4502,PLACE_CALL_FAILED:4503,ATTACH_CALL_FAILED:4504,BAD_NOTIFICATION_PAYLOAD:4505,CALL_ESTABLISHMENT_TIMEOUT:4506,SKYPE_TOKEN_ERROR:4507,CONVERSATION_RESOLUTION_CONFLICT:5704,CALL_PARTICIPANT_REMOVAL_TIMEOUT:4507,UNMUTE_REQUEST_TIMEOUT:4509,UNMUTE_REQUEST_REJECTED:4510,CONFLICT_IN_NG:4090,CONFLICT_WITH_P2P:4091,CONVERSATION_END_RECEIVED_FROM_SERVICE:4100,TRANSFER_COMPLETE_TIMEOUT:4101,ATTACH_TO_NON_EXISTENT_CALL:4102,ATTACH_ACTION_FAILED:4103,ATTACH_FAILED:4105,CONVERSATION_ESTABLISHMENT_FAILED:4106,BEFORE_CONNECT:4107,AFTER_CONNECT:4108,AFTER_ACCEPT:4109,TROUTER_CONNECTION_DROPPED:4111,DUE_TO_CALL_ASSIMILATION:4112,PREHEATED_CALL_TIMEDOUT:4113,UNPARK_COMPLETION_TIMEOUT:4114,PARK_COMPLETION_TIMEOUT:4115,UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:4116,UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:4117,SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:4118,UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:4119,JOIN_MEETING_GROUP_TIMEOUT:4120,LEAVE_MEETING_GROUP_TIMEOUT:4121,UPDATE_PARTICIPANTS_PROPERTIES_TIMEOUT:4122,UPDATE_MEETING_STATES_COMPLETION_TIMEOUT:4123,UPDATE_MONITOR_SESSION_COMPLETION_TIMEOUT:4124,MISSING_REQUEST_URI:4511,MISC_ERROR:4512,LOCAL_HTTP_STACK_ERROR:4520,BEACON:4521,DNS_HOST_NAME_RESOLVE_ERROR:4522,CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:5014,UNABLE_TO_GENERATE_MEETUP_ID:5015,UPDATE_MEETING_ROLE_REJECTED:5651,UPDATE_MEETING_ROLE_TIMEOUT:5652,PUBLISH_STATE_LINK_MISSING:5653,PUBLISH_STATE_INVALID_CONTENT:5654,PUBLISH_STATE_INVALID_SERVICE_RESPONSE:5655,REMOVE_STATE_LINK_MISSING:5656,REMOVE_STATE_MISSING_ARGUMENTS:5657,UPDATE_MEETING_SETTINGS_LINK_MISSING:5658,UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS:5659,ADMIT_ALL_LINK_MISSING:5660,ADMIT_TIMEOUT:5661,CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE:5670,ROSTER_HANDLING_INVALID_SERVICE_RESPONSE:5671,SEARCH_PARTICIPANTS_LINK_MISSING:5672,SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5673,GET_ALL_PARTICIPANTS_LINK_MISSING:5674,GET_ALL_PARTICIPANTS_INVALID_SCOPE:5675,GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5676,PARK_UNPARK_TYPE_MISSING:5680,PARK_UNPARK_V2_DISABLED:5682,UPDATE_PARTICIPANTS_PROPERTIES_LINK_MISSING:5683,DISABLE_PREHEAT_TIMEOUT:5684,CALL_ENDED_BY_PLATFORM_AGENT:7e3,CONVERSATION_TERMINATION_INTERACTION_REQUIRED:71014},CALL_END_PHRASE:{UNKNOWN:"CallEndReasonUnknown",MEDIA_ERROR:"CallEndReasonMediaError",MEDIA_OFFER_TIMEOUT:"CallEndReasonMediaOfferTimeout",MEDIA_FINAL_ANSWER_TIMEOUT:"CallEndReasonMediaFinalAnswerTimeout",MEDIA_ANSWER_ERROR:"CallEndReasonMediaAnswerError",MEDIA_FINAL_ANSWER_ERROR:"CallEndReasonFinalAnswerError",MEDIA_PERMISSION_ERROR:"CallEndReasonMediaPermissionError",MEDIA_RENEGOTIATION_ERROR:"CallEndReasonRenegotiationError",MEDIA_DROP_DURING_CONNECT:"CallEndReasonMediaDropDuringConnectError",MEDIA_DROP_AFTER_CONNECT:"CallEndReasonMediaDropAfterConnectError",MEDIA_OFFER_PROCESSING_ERROR:"CallEndReasonMediaOfferProcessingError",MEDIA_WHITELISTING_ISSUE:"MediaWhitelistingIssue",AUDIO_ERROR:"CallEndReasonAudioDeviceError",CONVERSATION_NOTIFICATION_TIMEOUT:"ConversationNotificationTimeout",BAD_NOTIFICATION_PAYLOAD:"BadCallNotificationPayload",NETWORK_ERROR:"CallEndReasonNetworkError",LOCAL_USER_INITIATED:"CallEndReasonLocalUserInitiated",REMOTE_USER_INITIATED:"CallEndReasonRemoteUserInitiated",ESTABLISHMENT_TIMEOUT:"CallEndReasonEstablishmentTimeout",PARTICIPANT_REMOVAL_TIMEOUT:"CallParticipantRemovalTimeout",LOCAL_ERROR:"CallEndReasonLocalError",CALL_UPDATE_ERROR:"CallEndReasonCallUpdateError",CALL_REDIRECT_IS_NOT_ALLOWED:"CallRedirectisNotAllowed",P2P_FORK_CONNECTED:"CallEndReasonP2pForkConnected",P2P_FORK_FORWARDED:"CallEndReasonP2pForkForwarded",P2P_FORK_FORWARDED_TO_VOICEMAIL:"CallEndReasonP2pForkForwardedToVoiceMail",P2P_FALLBACK_FOR_SCREENSHARING:"CallEndReasonP2pFallbackForScreensharing",P2P_FALLBACK_FOR_GROUPCALL:"CallEndReasonP2pFallbackForGroupCall",P2P_FALLBACK_FOR_CALL_ASSIMILATION:"CallEndReasonP2pFallbackForCallAssimilation",P2P_FALLBACK_FOR_TRANSLATION:"CallEndReasonP2pFallbackForCallTranslation",P2P_FORK_REJECTED:"CallEndReasonP2pForkRejected",TROUTER_CONNECTION_DROPPED:"CallEndReasonTrouterConnectionDropped",REMOVED_FROM_CALL:"CallEndReasonRemovedFromCall",TRANSFER_COMPLETION_TIMEOUT:"CallEndReasonTransferCompletionTimeout",CALL_DOES_NOT_EXIST:"CallEndReasonCallDoesNotExist",ATTACH_ACTION_FAILED:"CallEndReasonAttachActionFailed",ATTACH_FAILED:"CallEndReasonAttachFailed",CONVERSATION_ESTABLISHMENT_FAILED:"CallEndReasonConversationEstablishmentFailed",CONV_END_FROM_SERVICE:"CallEndReasonConversationEndReceivedFromService",CONV_END_FROM_SERVICE_WITH_ERROR:"CallEndReasonConversationEndReceivedFromServiceWithError",SERVICE_ERROR:"CallEndReasonServiceError",CONFLICT:"CallEndReasonConflict",CALL_ALREADY_IN_P2P:"CallEndReasonCallAlreadyExistsInP2p",CONV_END_NO_MODALITY:"ConversationEndNoModalityConnected",CONV_END_FOR_ALL_INITIATED:"ConversationEndForAllInitiated",RENEGOTIATION_IN_PROGRESS:"NegotiationIsInProgress",ADD_PARTICIPANT_URL_MISSING:"AddParticipantUrlMissing",ADMIT_PARTICIPANT_URL_MISSING:"AdmitParticipantUrlMissing",ADMIT_ALL_URL_MISSING:"AdmitAllUrlMissing",UPDATE_PARTICIPANT_INTERPRETATION_STATE_URL_MISSING:"UpdateParticipantInterpretationStateUrlMissing",UPDATE_PARTICIPANTS_PROPERTIES_URL_MISSING:"UpdateParticipantsPropertiesUrlMissing",ADMIT_TIMEOUT:"AdmitTimeout",UNABLE_TO_GENERATE_MEETUP_ID:"Unable to generate GroupChat meetup id.",ENDED_BY_PMA:"Call ended by media agent.",OWNERSHIP_RESOLUTION_CONFLICT:"Conversation cannot be created due to a failure to resolve ownership.",CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:"This conversation has ended since we were unable to determine a potential host for the group call.",UNMUTE_REQUEST_TIMEOUT:"UnmuteRequestTimeout",UNMUTE_REQUEST_REJECTED:"UnmuteRequestRejected",UPDATE_MEETING_ROLE_TIMEOUT:"UpdateMeetingRoleTimeout",UPDATE_MEETING_ROLE_REJECTED:"Update meeting role operation failed due to insufficient privileges.",PARK_REQUEST_FAILED:"Park Request Failed",PARK_COMPLETION_TIMEOUT:"ParkCompletionTimeout",PARK_COMPLETION_FAILED:"ParkCompletionFailed",UNPARK_REQUEST_FAILED:"UnparkFailed",UNPARK_COMPLETION_TIMEOUT:"UnparkCompletionTimeout",UNPARK_COMPLETION_FAILED:"UnparkCompletionFailed",BAD_SERVICE_RESPONSE:"BadServiceResponse",UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:"UpdateMeetingLiveStateCompletionTimeout",UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:"UpdateMeetingGroupsCompletionTimeout",SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:"SetMeetingLayoutCompletionTimeout",UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:"UpdateParticipantInterpretationTimeout",JOIN_MEETING_GROUP_TIMEOUT:"JoinMeetingGroupTimeout",LEAVE_MEETING_GROUP_TIMEOUT:"LeaveMeetingGroupTimeout",DOWNGRADE_TO_STREAMING_CLIENT:"DowngradeToStreamingClient",MESSAGE_STATUS_WITH_FAILURE_COUNT:"NotZeroFailureCount",UPDATE_PARTICIPANTS_PROPERTIES_TIMEOUT:"UpdateParticipantsPropertiesTimeout",DISABLE_PREHEAT_TIMEOUT:"DisablePreheatTimeout",UPDATE_MEETING_STATES_COMPLETION_TIMEOUT:"UpdateMeetingStatesCompletionTimeout",UPDATE_MONITOR_SESSION_COMPLETION_TIMEOUT:"UpdateMonitorSessionCompletionTimeout"},TRANSACTION_END_CODE:{SUCCESS:0},URL_DEFAULTS:{UPLOAD_LOG_URL:"https://api.cc.skype.com/cc/v1/uploadlog/"},SUCCESS_TRANSACTION_END:{code:0,resultCategories:[rU]},VALIDATION:{VALIDATION_FAILED:6e3,NULL_OR_EMPTY:6001}},rj={REQUEST_TIMEOUT:{status:rH.HTTP_STATUS_CODES.TIMEOUT,statusText:"Request timed out",readyState:0,response:rH.HTTP_STACK_ERROR.REQUEST_TIMEOUT},ATTEMPT_TIMEOUT:{status:rH.HTTP_STATUS_CODES.TIMEOUT,statusText:"Attempt timed out",readyState:0,response:rH.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT},REQUEST_ABORTED:{status:rH.HTTP_STATUS_CODES.ABORTED,statusText:"Request Aborted",readyState:0,response:rH.HTTP_STACK_ERROR.REQUEST_ABORTED},ATTEMPT_ABORTED:{status:rH.HTTP_STATUS_CODES.ABORTED,statusText:"Attempt Aborted",readyState:0,response:rH.HTTP_STACK_ERROR.ATTEMPT_ABORTED}},rq={MEDIA_ACKNOWLEDGEMENT:"/call/mediaAcknowledgement/",MEDIA_REJECTION:"/call/rejection/",ACKNOWLEDGEMENT:"/call/acknowledgement/",MEDIA_RENEGOTIATION:"/call/mediaRenegotiation/",REPLACE:"/call/replacement/",PROGRESS:"/call/progress/",MEDIA_ANSWER:"/call/mediaAnswer/",NEW_MEDIA_OFFER:"/call/newMediaOffer/",REDIRECTION:"/call/redirection/",BALANCE_UPDATE:"/call/balanceUpdate/",ACCEPT:"/call/acceptance/",CONTROL_VIDEO_STREAMING:"/call/controlVideoStreaming/",DOMINANT_SPEAKER_INFO:"/call/dominantSpeakerInfo/",CSRC_INFO:"/call/csrcInfo/",END:"/call/end/",RETARGET_COMPLETION:"/call/retargetCompletion/",TRANSFER:"/call/transfer/",TRANSFER_ACCEPTANCE:"/call/transferAcceptance/",TRANSFER_COMPLETION:"/call/transferCompletion/",PARK_COMPLETION:"/call/holdCompletion/",UNPARK_COMPLETION:"/call/resumeCompletion/",UPDATE_MEDIA_DESCRIPTIONS:"/call/updateMediaDescriptions",MONITOR_COMPLETION:"/call/monitorCompletion/"},rW={CONV_END:"/conversation/conversationEnd/",CONV_END_SUBSCRIBE:"/subscribe/conversation/conversationEnd/",CONV_END_JOIN:"/join/conversation/conversationEnd/",CONV_UPDATE:"/conversation/conversationUpdate/",CONV_LOCAL_PARTICIPANT_UPDATE:"/conversation/localParticipantUpdate/",CONV_ROSTER_UPDATE:"/conversation/rosterUpdate/",CONV_ADD_PARTICIPANT_SUCCESS:"/conversation/addParticipantSuccess/",CONV_ADD_PARTICIPANT_FAILURE:"/conversation/addParticipantFailure/",CONV_NUDGE_PARTICIPANT_SUCCESS:"/conversation/nudgeParticipantSuccess/",CONV_NUDGE_PARTICIPANT_FAILURE:"/conversation/nudgeParticipantFailure/",CONV_ADMIT_PARTICIPANT_SUCCESS:"/conversation/admitParticipantSuccess/",CONV_ADMIT_PARTICIPANT_FAILURE:"/conversation/admitParticipantFailure/",CONV_ADMIT_ALL_STATUS:"/conversation/admitAllStatus/",CONV_REMOVE_PARTICIPANT_SUCCESS:"/conversation/removeParticipantSuccess/",CONV_REMOVE_PARTICIPANT_FAILURE:"/conversation/removeParticipantFailure/",CONV_ADD_MODALITY_SUCCESS:"/conversation/addModalitySuccess/",CONV_ADD_MODALITY_FAILURE:"/conversation/addModalityFailure/",CONV_CONTENT_SHARING_UPDATE:"/conversation/contentSharingUpdate/",CONV_CONTENT_SHARING_END:"/conversation/contentSharingEnd/",CONV_BROADCAST_UPDATE:"/conversation/broadcastUpdate/",CONV_CONFIRM_UNMUTE:"/conversation/confirmUnmute/",CONV_UNMUTE_SUCCESS:"/conversation/unmuteSuccess/",CONV_UNMUTE_FAILURE:"/conversation/unmuteFailure/",UPDATE_MEETING_LIVE_STATE_STATUS:"/conversation/updateMeetingLiveStateStatus/",UPDATE_MEETING_GROUPS_STATUS:"/conversation/updateMeetingGroupsStatus/",SET_MEETING_LAYOUT_STATUS:"/conversation/setMeetingLayoutStatus/",UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS:"/conversation/updateParticipantInterpretationStateStatus/",UPDATE_PARTICIPANT_PROPERTIES_STATUS:"/conversation/updateParticipantPropertiesStatus/",JOIN_MEETING_GROUP_STATUS:"/conversation/joinMeetingGroupStatus/",LEAVE_MEETING_GROUP_STATUS:"/conversation/leaveMeetingGroupStatus/",RECEIVE_MESSAGE:"/conversation/receiveMessage/",SEND_MESSAGE_STATUS:"/conversation/sendMessageStatus/",DISABLE_PREHEAT_ASYNC_STATUS:"/conversation/disablePreheatAsyncStatus/",UPDATE_MEETING_STATES_STATUS:"/conversation/updateMeetingStatesStatus/",MUTE_UNMUTE_ASYNC:"/conversation/muteUnmuteAsync/"},rG={...rq,...rW},rz="callNotification",rJ="mediaAnswer",rK="mediaAcknowledgement",rQ="callAcceptance",rY="callEnd",rZ="callProgress",rX="callAcceptanceAcknowledgement",r0="mediaNegotiation",r1="mediaNegotiationFailure",r2="balanceUpdate",r3="retargetCompleted",r4="callTransfer",r5="transferCompletion",r6="transferAcceptance",r8="holdCompletion",r9="resumeCompletion",r7="updateMeetingLiveStateResponse",se="updateMeetingGroupsResponse",st="setMeetingLayoutResponse",si="updateMeetingStatesResponse",sn="monitorCompletion",sr=rH,ss=eR(i(892891)),sa=class e{constructor(e){this.headers={},e&&Object.keys(e).forEach(t=>{this.headers[this.getLowerCaseName(t)]=e[t]})}isEmpty(){return ss.isEmpty(this.headers)}set(e,t){this.headers[this.getLowerCaseName(e)]=t}get(t,i){return i?e.getHeaderValue(this.headers,t)||i:e.getHeaderValue(this.headers,t)}delete(e){delete this.headers[e],delete this.headers[e.toLowerCase()]}hasOwnPropertyCaseInsensitive(e){return Object.keys(this.headers).filter(function(t){return t.toUpperCase()===e.toUpperCase()}).length>0}getAll(){return this.headers}getLowerCaseName(t){return e.useLowerCaseHeaders?t.toLowerCase():t}static getHeaderValue(e,t){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t.toLowerCase())?e[t.toLowerCase()]:void 0}};function so(e,t,i=sp()){return sS(t,"trailingPath cannot be null"),sy(e,"signalingSession cannot be null"),sy(e.baseMessagingChannelUrl,"messaging channel url is not set"),`${e.baseMessagingChannelUrl}${sr.URL_BASE.CALLAGENT}/${e.sessionId}/${i}${t}`}function sl(e){let t=e.match(RegExp(`/${sR(sr.URL_BASE.CALLAGENT)}/+([^/]+)`,"i"));return t?t[1]:null}function sc(e){let t=1;return e.callingServiceSupportsAADTokens&&(t|=4),e.callingServiceSupportsCAETokens&&(t|=8),t}function sd(e){if(!e)return"";if("string"==typeof e)return e;{let t=(e,t,i)=>i?e.endsWith(";")||e.endsWith("/")?e+`${t}=${i}`:e+`;${t}=${i}`:e,i=`${e.clientName}/${e.platformId}/${e.uiBuildVersion}/`;if(i=t(i,"os",e.os),i=t(i,"osVer",e.osVer),i=t(i,"deviceType",e.deviceType),i=t(i,"browser",e.browser),i=t(i,"browserVer",e.browserVer),i=t(i,"experienceName",e.experienceName),e.additionalValues)for(let n in e.additionalValues)i=t(i,n,e.additionalValues[n]);return i+="/",e.tscallingVersion&&(i=t(i,"TsCallingVersion",e.tscallingVersion)),e.ovb&&(i=t(i,"Ovb",e.ovb)),i}}function su(e){let t=e.toLowerCase(),i='token_types="',n=t.indexOf(i);if(-1===n)return[];let r=t.indexOf('"',n+i.length);if(-1===r)return[];let s=t.substring(n+i.length,r).trim();return""===s?[]:s.split(" ")}function sh(e){return!!e.match(/^8:/)}function sg(e){return e.replace(/^\d+:/,"")}function sp(){return sm().substr(0,8)}function sf(e){return e&&/^[a-z0-9]{8}$/.test(e)?e+sm().substr(8):sm()}function sm(){let e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",t="0123456789abcdef",i="",n=0,r=0;for(;r<36;){let s=e[r];switch(n=r%8==0?0xffffffff*Math.random()|0:n>>4,s){case"x":i+=t[15&n];break;case"y":i+=t[3&n|8];break;case"4":case"-":i+=s}r++}return i}function sv(e,t){e||sb(`Assert failed${void 0!==t?`:${t}`:""}`)}function sS(e,t){(!e||e instanceof String&&""===e||e instanceof Array&&0===e.length)&&sb(`AssertNotNullOrEmpty failed. ${void 0!==t?`: ${t}`:""}`)}function sy(e,t){e||sb(`AssertNotNull failed. ${void 0!==t?`: ${t}`:""}`)}function sC(e){sS(e,"callEndReason cannot be null or empty"),(void 0===e.code||void 0===e.subCode||void 0===e.phrase||e.code<0||e.subCode<0||" "===e.phrase)&&sb(`callEndReason must specify code, subCode and phrase. Invalid reason : ${t_(e)}`)}function sb(e){throw{code:sr.CALL_END_CODE.LOCAL_ERROR,subCode:sr.CALL_END_SUB_CODE.MISC_ERROR,phrase:e,resultCategories:[r$]}}function sT(e){sy(e,"MediaTypes passed cannot be null");let t=[],i=sr.MEDIA_TYPES;for(let n of Object.keys(i))sI(e,i[n])&&t.push(i[n]);return t}function sE(e,t){let i={};for(let n of Object.values(t)){let t=n.split("/");i[t[t.length-2]]=so(e,n)}return i}function s_(e,t){return e.length>=t.length&&e.indexOf(t,e.length-t.length)>-1}function sI(e,t){let i=t.toString().toLowerCase();return e.map(e=>e.toString().toLowerCase()).indexOf(i)>-1}function sw(e,t,i){return!e.hasOwnProperty(t)&&(e[t]=i,!0)}function sP(e,t){return!!e.hasOwnProperty(t)&&(delete e[t],!0)}function sR(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function sA(e){let t=null;try{if(t=JSON.parse(e),"object"==typeof t)return t;return null}catch(e){return null}}function sM(e,t){let i;if(!e)return{telemetryEndSubCode:sr.CALL_END_CODE.UNKNOWN_ERROR,error:sr.CALL_END_UNKNOWN_ERROR};if("object"==typeof e.response)i=e.response;else try{i=JSON.parse(e.response)}catch(e){}if(e.skypeTokenError)return{telemetryEndSubCode:sr.CALL_END_CODE.SKYPE_TOKEN_ERROR,error:sr.CALL_END_SKYPE_TOKEN_ERROR};if(e.tokenTimeoutError&&!e.tokenInteractivityRequiredTimeout)return{telemetryEndSubCode:sr.CALL_END_CODE.HTTP_OTHER_ERROR,error:sr.CALL_END_TOKEN_TIMEOUT_ERROR};if(e.tokenError){let t=e.tokenErrorSubCode?{code:sr.CALL_END_TOKEN_ERROR.code,subCode:e.tokenErrorSubCode,phrase:sr.CALL_END_TOKEN_ERROR.phrase,resultCategories:sr.CALL_END_TOKEN_ERROR.resultCategories}:sr.CALL_END_TOKEN_ERROR;return{telemetryEndSubCode:sr.CALL_END_CODE.HTTP_OTHER_ERROR,error:t}}if(e.tokenInteractivityRequiredTimeout)return{telemetryEndSubCode:sr.CALL_END_CODE.HTTP_OTHER_ERROR,error:sr.CALL_END_TOKEN_TIMEOUT_INTERACTIVITY_REQUIRED};if(i&&(i.operationFailure||i.broadcastOperationFailure)){let e=i.operationFailure||i.broadcastOperationFailure;return{telemetryEndSubCode:e.code,error:e}}else if(i&&i._error?.toLowerCase()==="net::err_name_not_resolved")return{telemetryEndSubCode:sr.CALL_END_CODE.NETWORK_ERROR,error:sr.CALL_END_DNS_HOST_NAME_RESOLVE_ERROR};else if(i?.code)return{telemetryEndSubCode:i.code,error:i};else if(!isNaN(e.status)&&e.status===sr.CALL_END_CODE.NOT_FOUND)return{telemetryEndSubCode:sr.CALL_END_CODE.NOT_FOUND,error:sr.RESOURCE_NOT_FOUND_ERROR};else if(!isNaN(e.status)&&e.status)return{telemetryEndSubCode:e.status,error:{code:e.status,subCode:isNaN(e.response)?0:e.response,phrase:e.statusText,resultCategories:[rV]}};else if(!isNaN(e.response)&&e.response)return{telemetryEndSubCode:0,error:{code:0,subCode:e.response,phrase:e.statusText,resultCategories:[rV]}};return{telemetryEndSubCode:sr.CALL_END_CODE.NETWORK_ERROR,error:sr.CALL_END_NETWORK_ERROR}}function sD(e,t){if(e&&!e.isEmpty()&&t){let i=e.get(sr.HEADERS.ORIGINAL_MESSAGE_ID),n=e.get(sr.HEADERS.MESSAGE_ID);if(n&&sI(t,n)||i&&sI(t,i))return!0;t.length>9&&t.shift(),t.push(i||n)}return!1}function sO(e){let t="unknown";return e.headers?e.headers.get(sr.HEADERS.ORIGINAL_MESSAGE_ID,t):t}function sk(e){try{return e.headers.get(sr.HEADERS.ORIGINAL_MESSAGE_ID).replace("-","").substr(0,8)}catch(e){return sp()}}function sN(e,t,i){if(e&&t){let n=e.get(sr.HEADERS.ORIGINAL_MESSAGE_ID)||e.get(sr.HEADERS.MESSAGE_ID)||null;n&&(t[n]=i)}}function sx(e,t){return e&&t[e.get(sr.HEADERS.ORIGINAL_MESSAGE_ID)||e.get(sr.HEADERS.MESSAGE_ID)||null]||null}function sL(e){return e&&e.hasOwnPropertyCaseInsensitive(sr.HEADERS.CONTENT_ENCODING)}function sF(e){return e&&sr.KNOWN_PAYLOAD_ENCODINGS.hasOwnProperty(e.get(sr.HEADERS.CONTENT_ENCODING).toUpperCase())}function sU(e){let t=e.split(/\r?\n\r?\n/),i=t[0].split(/\r?\n/),n=t[1].split(/\r?\n/),r=i.shift().split(" "),s=r[0],a=r[1]||"",o=new sa;for(let e of i)try{let[t,i]=e.split(":").map(e=>rL.trim(e));o.set(t,i)}catch(t){throw Error(`Malformed header: ${e+t}`)}return{url:a,headers:o,method:s,body:n.join("")}}function s$(e){let t=atob(e);return rF.inflate(t,{to:"string"})}function sV(){let e,t,i=!0;return{isPending:()=>i,promise:new Promise((i,n)=>{e=i,t=n}),resolve:t=>{i&&(e(t),i=!1)},reject:e=>{i&&(t(e),i=!1)}}}function sB(e){let t=!1;try{if(t=e&&2===e.state(),navigator.onLine&&t)return 3;if(!navigator.onLine&&t)return 2;if(navigator.onLine&&!t)return 1}catch{}return 0}function sH(e){return[sr.HTTP_STATUS_CODES.UNKNOWN,sr.HTTP_STATUS_CODES.UNAUTHORIZED,sr.HTTP_STATUS_CODES.NETWORK_ERROR,sr.HTTP_STATUS_CODES.OFFLINE,sr.HTTP_STATUS_CODES.TIMEOUT,sr.HTTP_STATUS_CODES.INTERNAL_SERVER_ERROR,sr.HTTP_STATUS_CODES.BAD_GATEWAY,sr.HTTP_STATUS_CODES.SERVICE_UNAVAILABLE,sr.HTTP_STATUS_CODES.GATEWAY_TIMEOUT].indexOf(e)>=0}function sj(e,t){switch(e){case sr.HEADERS.CAE_KEYWORD.toLowerCase():return 8;case sr.HEADERS.AAD_KEYWORD.toLowerCase():return 4;case sr.HEADERS.SKYPE_KEYWORD.toLowerCase():return 1;default:return t?.info("unexpected: unrecognized token type ${tokenType}"),null}}function sq(e,t,i,n,r){if(!t)return 1;let{callingServiceSupportsAADTokens:s,callingServiceSupportsCAETokens:a,supportMissingTokenTypesInResponse:o,useSkypeTokenWhenNoAuthenticateHeader:l}=e,c=r?.authenticationHeaders;n?.info(`[getAuthHeadersTokenTypes] UnauthorizedResponse=${i} and authHeaders=${c}`);let d=null;if(!c&&i)l?(n?.info("[getAuthHeadersTokenTypes] no www-authenticate header received, fallback to skype token"),d=1):(n?.info("[getAuthHeadersTokenTypes] Service has not provided www-authenticate headers. use client supported tokens"),d=sc(e));else if(c||i){if(c&&i)for(let t of c){let i=su(t);if(o&&0===i.length)n?.info("[getAuthHeadersTokenTypes] Service has www-authenticate header, but no token types. Use client supported tokens"),d=sc(e);else for(let e of i){let t=sj(e.toLowerCase(),n);a&&8===t&&(d|=8),s&&4===t&&(d|=4),1===t&&(d|=1)}}}else n?.info("[getAuthHeadersTokenTypes] first time requesting token, request client supported token types"),d=sc(e);return d}function sW(e){switch(e){case 0:return"GET";case 1:return"POST";case 2:return"PUT";case 3:return"DELETE"}}function sG(e){let t={};if(e){let i=sa.getHeaderValue(e,sr.HEADERS.AUTHENTICATE);i&&(t={authenticationHeaders:[i]})}return t}function sz(e,t,i,n,r=!1,s,a){a?.createChild("[utils.ts]");let o=JSON.stringify({verb:sW(i),path:n.url}),l=sG(s),c=sq(e,t,r,a,l);return a?.info(`[getTokenMetadata] return token type=${c}, factoJson=${o}, headers=${l?.authenticationHeaders}`),{tokenType:c,factorsJson:o,requestMetadataJson:l,isUnauthorized:r}}function sJ(){return Math.floor(Date.now()/1e3)}function sK(e){return e/1e3}function sQ(e){return 1e3*e}function sY(e){let t=sa.getHeaderValue(e,sr.HEADERS.SKYPE_TOKEN);if(t)return t;let i=sa.getHeaderValue(e,sr.HEADERS.AUTHORIZATION);if(i){let e=i.split(" ");if(2===e.length)return e[1]}}function sZ(e){switch(e){case"none":return"None";case"teamPark":return"TeamPark";case"callPark":return"CallParkV2";case"serverHold":return"ServerHold";case"serverHoldV2":return"MusicOnHoldV2";case"sharedLinePark":return"SharedLinePark";case"sharedLineParkV2":return"SharedLineAppearanceV2";default:return"UnknownType"}}function sX(e){switch(e){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"attendeeVideoUnrestricted":return"attendeeVideoUnrestricted";case"spotlight":return"spotlight";case"weatherPerson":return"weatherPerson";case"sharingLayoutType":return"sharingLayoutType";case"manageBreakoutRooms":return"manageBreakoutRooms";case"togetherMode":return"togetherMode";case"consentToRecording":return"consentToRecording";case"denyConsentToRecording":return"denyConsentToRecording";case"clientMediaUfd":return"clientMediaUfd";case"serverMediaUfd":return"serverMediaUfd";case"dhhSigner":return"dhhSigner";case"signLanguageInterpreter":return"signLanguageInterpreter";default:throw"Invalid state type when converting PublishType to PublishStateType."}}function s0(e){switch(e){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"attendeeVideoUnrestricted":return"attendeeVideoUnrestricted";case"spotlight":return"spotlight";case"weatherPerson":return"weatherPerson";case"sharingLayoutType":return"sharingLayoutType";case"manageBreakoutRooms":return"manageBreakoutRooms";case"togetherMode":return"togetherMode";case"consentToRecording":return"consentToRecording";case"denyConsentToRecording":return"denyConsentToRecording";case"clientMediaUfd":return"clientMediaUfd";case"serverMediaUfd":return"serverMediaUfd";case"dhhSigner":return"dhhSigner";case"signLanguageInterpreter":return"signLanguageInterpreter";default:throw"Invalid state type when converting PublishStateType to PublishType."}}function s1(e){let t={};return e.additionalData&&e.customHeaderContext?t="object"==typeof e.additionalData?{...e.additionalData,...{customContext:e.customHeaderContext}}:{...{additionalData:e.additionalData},...{customContext:e.customHeaderContext}}:!e.additionalData&&e.customHeaderContext?t={customContext:e.customHeaderContext}:e.additionalData&&!e.customHeaderContext&&(t=e.additionalData),t}function s2(e){if(!e)return;let t="unknown";return"substrate"===e&&(t="substrate"),t}function s3(e){if(!e)return;let t=e.split(":");if(3===t.length)return 3600*parseInt(t[0])+60*parseInt(t[1])+parseInt(t[2])}var s4="skypecosi_concore_web_ts_calling_registry",s5="*11",s6="*12",s8="*13",s9="*14",s7={totalParticipants:0,preheatedParticipants:0,lobbyParticipants:0,totalPresenters:0,requestingAttentionPresenters:0,totalAttendees:0,requestingAttentionAttendees:0,overflowAttendees:0,totalOrganizers:0},ae=i(83836),at=150,ai=30,an=class{constructor(e,t,i,n,r){this.eventName=e,this.eventStartTime=t,this.type=i,this.causeId=n,this.status="Pending",this.eventStartTimestamp=new Date().getTime(),this.data=[],this.causeId=n?.substring(0,8),"Event"===this.type&&delete this.status,r&&this.data.push(r)}set variant(e){this.eventVariant=e}recordSuccess(e,t){this.recordResult("Success",e,t)}recordFailure(e,t){this.recordResult("Failure",e,t)}recordTimeout(e,t){this.recordResult("Timeout",e,t)}addData(e){this.data.push(e)}isPending(){return"Pending"===this.status}getEvent(){let e={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,causeId:this.causeId,resultCauseId:this.resultCauseId,variant:this.eventVariant,data:this.data.map(e=>this.prepareData(e,!0)).filter(e=>!!e)};return"Event"===this.type&&delete e.status,e.data.length||delete e.data,e.causeId||delete e.causeId,e.resultCauseId||delete e.resultCauseId,e.result||delete e.result,e.variant||delete e.variant,{[this.eventName]:e}}recordResult(e,t,i){this.status=e,this.result=this.prepareData(t),this.causeId!==i&&(this.resultCauseId=i),this.duration=new Date().getTime()-this.eventStartTimestamp}prepareData(e,t=!1){if(null==e)return"";if("string"==typeof e)return ta(e);if("number"==typeof e||"boolean"==typeof e)return String(e);if("function"==typeof e)return"";if(e instanceof Error)return e.toString();try{if(Object.keys(e).length)return t?e:tT(e);return""}catch(e){return"invalid"}}},ar=class{constructor(e,t,i,n){this.logger=e,this.startTime=t,this.maxEventsExceeded=i,this.perfModule=n,this.recordedEvents=[],this.ipcStats=[],this.ongoingOperations={}}recordEvent(e,t,i=e9()){this.logger.debug("Event:",e,ae.pii.Omit(t));let n=new an(e,this.getEventStartTime(),"Event",i,t);return this.pushToRecordedEvents(n),n}recordOperationSuccess(e,t=null,i,n,r){this.logger.info("Event success:",n,e,ae.pii.Omit(i),ae.pii.Omit(t)),this.recordOperationResult(e,t,"Success",i,n,r)}recordOperationFailure(e,t,i,n,r){this.logger.info("Event failure:",e,ae.pii.Omit(i),t),this.recordOperationResult(e,t,"Failure",i,n,r)}recordOperationTimeout(e,t,i,n,r){this.logger.info("Event timeout:",e,ae.pii.Omit(i),t),this.recordOperationResult(e,t,"Timeout",i,n,r)}maybeRecordOperationSuccess(e,t=null,i,n,r){this.hasOngoingEvent(e,i)&&this.recordOperationSuccess(e,t,i,n,r)}maybeRecordOperationFailure(e,t,i,n,r){this.hasOngoingEvent(e,i)&&this.recordOperationFailure(e,t,i,n,r)}maybeRecordOperationTimeout(e,t,i,n,r){this.hasOngoingEvent(e,i)&&this.recordOperationTimeout(e,t,i,n,r)}recordOperationResult(e,t,i,n,r,s){this.hasOngoingEvent(e,n)||this.recordOperation(e,r,n);let a=this.ongoingOperations[e];switch(n&&(a=a[n]),s&&a.addData(s),i){case"Success":a.recordSuccess(t,r);break;case"Failure":a.recordFailure(t,r);break;case"Timeout":a.recordTimeout(t,r);break;default:this.logger.error("Unknown operation record state in record operation result.")}n?delete this.ongoingOperations[e][n]:delete this.ongoingOperations[e]}recordOperation(e,t,i,n){this.logger.debug("Event create:",t,e,ae.pii.Omit(i),n);let r=new an(e,this.getEventStartTime(),"Operation",t,n);return this.ongoingOperations[e]||(this.ongoingOperations[e]={}),i?this.ongoingOperations[e][i]=r:this.ongoingOperations[e]=r,this.pushToRecordedEvents(r),r}setOperationVariant(e,t,i){let n;(n=i?this.ongoingOperations[e][i]:this.ongoingOperations[e])?n.variant=t:this.logger.error(`Could not find operation ${e} to set variant ${t}`)}updateOperationData(e,t,i,n){try{if(!this.ongoingOperations[e])return void this.recordEvent(e,t,i);n?this.ongoingOperations[e][n]&&this.ongoingOperations[e][n].addData(t):this.ongoingOperations[e].addData(t)}catch(t){this.logger.info(`Unable to update operation: ${e} data`);return}}pushToRecordedEvents(e){if(this.maxEventsExceeded&&this.maxEventsExceeded()&&this.recordedEvents.shift(),this.recordedEvents.push(e),this.perfModule&&this.ipcStats.length<=ai){let e=this.perfModule.getIpcStats();e&&this.ipcStats.push({ingestionTime:this.getEventStartTime(),stats:e})}}hasOngoingEvent(e,t){return this.ongoingOperations[e]?!t||!!this.ongoingOperations[e][t]||(this.logger.warn(`Unable to find event for name\\id ${e}\\${ae.pii.Omit(t)}`),!1):(this.logger.warn(`Unable to find event for name ${e}`),!1)}getEventStartTime(){return new Date().getTime()-this.startTime}getEventTimestampBag(e,t){let i=t?[t.getEvent()]:this.recordedEvents.filter(t=>!e||!t.isPending()).map(e=>e.getEvent()),n=JSON.stringify({eventStart:this.startTime,events:i});return this.logger.info(`Call eventTimestampBag ${ae.pii.Omit(n)}`),n}getDefaultBeaconEventTimestampBag(){let e=new an("SendLastKnownStats",this.getEventStartTime(),"Event",e9()),t=JSON.stringify({eventStart:this.startTime,events:[e]});return this.logger.info(`Call eventTimestampBag ${ae.pii.Omit(t)}`),t}getIPCStats(){return 0!==this.ipcStats.length?JSON.stringify(this.ipcStats):""}removeRecordedEvent(e){let t=this.recordedEvents.indexOf(e);t>-1&&this.recordedEvents.splice(t,1)}},as=class extends ar{constructor(e,t){super(e,t,()=>this.recordedEvents.length>at),this.getHostName=()=>{try{return"localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost":"<redacted>"}catch(e){return"unknown"}},this.tsCallingVersion=tX(),this.logger=e.createChild("CallRegistryTelemetry")}setClientType(e){this.clientType=e}setEndpointId(e){this.endpointId=e}setSkypeId(e){this.skypeId=ta(e)}setApplicationType(e){this.applicationType=e}setRing(e){this.ring=e}setTenantId(e){this.tenantId=e}setUserHexCID(e){this.userHexCID=e}setAcsResourceId(e){this.acsResourceId=e}setRegion(e){this.region=e}setPartition(e){this.partition=e}getEvent(e,t){let i=e=>void 0===e?"":e;return{EndpointId:i(this.endpointId),SkypeId:i(this.skypeId),ApplicationType:i(this.applicationType),Ring:i(this.ring),TenantId:i(this.tenantId),userHexCID:i(this.userHexCID),AcsResourceId:i(this.acsResourceId),Region:i(this.region),Partition:i(this.partition),TsCallingVersion:i(this.tsCallingVersion),HostName:this.getHostName(),EventTimestampBag:this.getEventTimestampBag(e,t),DiagnosticInfo:this.callEndDiagnosticInfo,ClientType:i(this.clientType)}}removeNonPendingOperations(){this.recordedEvents=this.recordedEvents.filter(e=>e.isPending())}},aa=class extends ar{constructor(e,t,i){super(e,t,()=>this.inCallMode&&this.recordedEvents.length>at,i),this.inCallMode=!1,this.tsCallingVersion=tX(),this.logger=e.createChild("CallTelemetry")}setClientType(e){this.clientType=e}setCallId(e){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=e}setConsultativeCallId(e){this.consultativeCallId=e}setEndpointId(e){this.endpointId=e}setParticipantId(e){this.participantId=e}setDisplayName(e){this.displayName=e}setPreheatFlags(e){this.preheatFlags=e}setCallOrigin(e){this.origin=e}setGroupId(e){this.groupId=e}setThreadId(e){this.threadId=e}setBackroomThreadId(e){this.backroomThreadId=e}setStreamThreadId(e){this.streamThreadId=e}setLobbyThreadId(e){this.lobbyThreadId=e}setComplianceRecordingContentLength(e){this.complianceRecordingContentLength=e}setConversationStartTime(e){this.conversationStartTime=e}setCompositionServiceState(e){this.compositionServiceState=e}setMessageId(e){this.messageId=e}setSkypeId(e){this.skypeId=ta(e)}setApplicationType(e){this.applicationType=e}setRing(e){this.ring=e}setTenantId(e){this.tenantId=e}setUserHexCID(e){this.userHexCID=e}setAcsResourceId(e){this.acsResourceId=e}setRegion(e){this.region=e}setPartition(e){this.partition=e}setFailureType(e){this.failureType=e}setIsCast(e){this.isCast=e?"True":"False"}setIsHuddleGroupCall(e){this.isHuddleGroupCall=e?"True":"False"}setIsEmergency(e){this.isEmergency=e?"True":"False"}setRole(e){this.isAnonymous="admin"===e?"False":"True"}setCallType(e){this.callType=e}setConversationType(e){this.conversationType=e}setDirection(e){this.direction=e}setSelfParticipantRole(e){this.selfParticipantRole=e}setTerminationState(e){this.terminationState=e}setTerminationReason(e){this.terminationReason=e}setCallEndDiagnosticInfo(e){this.callEndDiagnosticInfo=e}setStackConfig(e){this.stackConfig=e}setJoinedFrom(e){this.joinedFrom=e}setMeetingCode(e){this.meetingCode=e}setMeetingUrl(e){this.meetingUrl=e}setHasMeetingRegistrationId(e){this.hasMeetingRegistrationId=e?"True":"False"}setHasParticipantPin(e){this.hasParticipantPin=e?"True":"False"}getEvent(e,t){let i=e=>void 0===e?"":e;return{CorrelationId:i(this.currentCallId),PreviousCorrelationId:i(this.previousCallId),ConsultativeCallId:i(this.consultativeCallId),EndpointId:i(this.endpointId),SkypeId:i(this.skypeId),ParticipantId:i(this.participantId),DisplayName:new tr(this.displayName??"",1),PreheatFlags:i(this.preheatFlags),CallType:i(this.callType),ConversationType:i(this.conversationType),Direction:i(this.direction),Origin:i(this.origin),SelfParticipantRole:i(this.selfParticipantRole),IsAnonymous:i(this.isAnonymous),GroupId:ta(i(this.groupId)),ThreadId:th(i(this.threadId)),MessageId:i(this.messageId),ApplicationType:i(this.applicationType),Ring:i(this.ring),TenantId:i(this.tenantId),UserHexCID:i(this.userHexCID),AcsResourceId:i(this.acsResourceId),Region:i(this.region),Partition:i(this.partition),FailureType:i(this.failureType),IsCast:i(this.isCast),IsHuddleGroupCall:i(this.isHuddleGroupCall),IsEmergency:i(this.isEmergency),TsCallingVersion:i(this.tsCallingVersion),TerminationState:i(this.terminationState),TerminationReason:i(this.terminationReason),StackConfig:i(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(e,t),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo,JoinedFrom:this.joinedFrom,MeetingCode:this.meetingCode,MeetingUrl:this.meetingUrl,HasMeetingRegistrationId:this.hasMeetingRegistrationId,HasParticipantPin:this.hasParticipantPin,IPCStats:this.getIPCStats(),ComplianceRecordingContentLength:i(this.complianceRecordingContentLength),ConversationStartTime:i(this.conversationStartTime),BackroomThreadId:th(i(this.backroomThreadId)),StreamThreadId:th(i(this.streamThreadId)),LobbyThreadId:th(i(this.lobbyThreadId)),ClientType:i(this.clientType),CompositionServiceState:i(this.compositionServiceState)}}getShortEvent(){let e=e=>void 0===e?"":e;return{CorrelationId:e(this.currentCallId),EndpointId:e(this.endpointId),ParticipantId:e(this.participantId),DisplayName:new tr(this.displayName??"",1),CallType:e(this.callType),ConversationType:e(this.conversationType),Direction:e(this.direction),Origin:e(this.origin),SelfParticipantRole:e(this.selfParticipantRole),IsAnonymous:e(this.isAnonymous),ThreadId:th(e(this.threadId)),ApplicationType:e(this.applicationType),TerminationState:e(this.terminationState),TerminationReason:e(this.terminationReason),Ring:e(this.ring),TenantId:e(this.tenantId),UserHexCID:e(this.userHexCID),AcsResourceId:e(this.acsResourceId),Region:e(this.region),TsCallingVersion:e(this.tsCallingVersion),DiagnosticInfo:this.callEndDiagnosticInfo,JoinedFrom:this.joinedFrom,ClientType:e(this.clientType),EventTimestampBag:this.getDefaultBeaconEventTimestampBag()}}switchToInCallTelemetry(){this.recordedEvents=this.recordedEvents.filter(e=>e.isPending()),this.inCallMode=!0}getHostName(){try{return location.host}catch(e){return"unknown"}}},ao=e=>Array.isArray(e)?e.map(e=>({endpointId:e.endpointId,participantId:e.participantId})):null,al=(e,t,i,n,r)=>{if(e){if(e.meetingUrl)return"MeetingUrl";if(e.meetingCode)return"MeetingCode"}return t||i?"ThreadContext":n?"GroupId":r?"Awareness":""};function ac(e,t,i){if(!e)return i.info(`sanitizeMeetingCode[${t}] empty / undefined meeting code parameter`),e;let n=e.replace(/\s/g,"");return n=n.replace(/-/g,""),i.info(`sanitizeMeetingCode[${t}] meetingCode: ${e}, sanitizedMeetingCode: ${n}`),n}function ad(e,t,i){if(!e)return i.info(`getMeetingCodeFromMeetingUrl[${t}] empty / undefined meeting Url parameter`),e;let n=new URL(e),r="";if(n&&n.pathname&&n.pathname.split("/").length>=2){let e=n.pathname.split("/");"meet"===e[e.length-2]&&(r=e[e.length-1])}return i.info(`getMeetingCodeFromMeetingUrl[${t}] meetingUrl: ${e}, meetingUrlObject: ${tI(n)}, meetingCode: ${r}`),r}function au(e,t,i,n){let r=ac(e&&e.meetingCode||"",i,n),s=ac(t&&t.meetingCode||"",i,n),a=(e,t)=>!!e&&!!t&&e===t;if(a(r,s))return!0;let o=ad(e&&e.meetingUrl||"",i,n);o=ac(o,i,n);let l=ad(t&&t.meetingUrl||"",i,n);if(a(o,l=ac(l,i,n))||a(o,s)||a(l,r))return!0;if(e&&e.meetingUrl&&t&&t.meetingUrl){let i=new URL(e.meetingUrl),n=new URL(t.meetingUrl);if(i.hostname===n.hostname&&i.pathname===n.pathname)return!0}return!1}function ah(){}var ag=0,ap=410,af=499,am=497,av=3e3,aS=3548,ay=3757,aC=4990,ab=5028,aT=4521,aE=3545,a_=0xfffffffe,aI="_operationIdValue_",aw="_causeIdValue_",aP="_callStartOptionsValue_",aR="_clientReasonValue_",aA="_guidIdValue_";function aM(e,t){return aF(0,e,t)}function aD(e,t){return aF(1,e,t)}var aO=(e,t,i)=>{if(e[t][aI])throw Error("can not specify more than one operation id");e[t][aI]=i},ak=(e,t,i)=>{if(e[t][aw])throw Error("can not specify more than one cause id");e[t][aw]=i},aN=(e,t,i)=>{if(e[t][aP])throw Error("can not specify options more than once");e[t][aP]=i},ax=(e,t,i)=>{if(e[t][aR])throw Error("can not specify reason more than once");e[t][aR]=i},aL=(e,t,i)=>{if(e[t][aA])throw Error("can not specify more than one guid");e[t][aA]=i},aF=(e,t,i)=>(n,r,s)=>{let a=s.value,o=n[r]?.[aI],l=n[r]?.[aw],c=n[r]?.[aA],d=n[r]?.[aP],u=n[r]?.[aR],h=i?.type||"Async";return s.value=function(...n){let r,s=this,g=e9();void 0!==l&&(n[l]&&(e7(n[l])||iG(n[l]))?g=n[l]:n[l]=g);let p=void 0!==o?n[o]:void 0;if(void 0!==p){if(Array.isArray(p))try{let e=p.map(e=>e.toString()).sort().concat().toString();p=a$(e).toString()}catch{let e=`[${p}]${t} failed in array parsing in operationDecorator`;return Promise.reject({terminatedReason:32,terminatedReasonCode:am,terminatedReasonSubCode:aE,errorMessage:e})}else if(p&&"object"==typeof p)try{let e=JSON.stringify(p);i&&i.operationIdKey&&p.hasOwnProperty(i.operationIdKey)&&(e=p[i.operationIdKey]),p=e}catch{let e=`[${p}]${t} failed in object parsing in operationDecorator`;return Promise.reject({terminatedReason:32,terminatedReasonCode:am,terminatedReasonSubCode:aE,errorMessage:e})}}void 0!==u&&n[u]&&(r=n[u]);let f=aU(s,e);if(f.logOperation(g,t),i&&i.singular&&f.hasPendingOperation(t))return f.logOperation(g,t,"Not allowed, pending operation exists"),Promise.reject(60);if(i&&i.idempotencyLevel&&f.getRecord(t)>0)switch(f.logOperation(g,t,`Called multiple times, handling operation according to specified policy: idempotency=${i.idempotencyLevel}`),i.idempotencyLevel){case"NoOp":return Promise.resolve();case"Error":return Promise.reject(60)}try{void 0!==d&&n[d]&&s.processCallStartOptions(n[d],g)}catch{let e=`${t} failed in processCallStartOptions`;return Promise.reject({terminatedReason:32,terminatedReasonCode:am,terminatedReasonSubCode:aE,errorMessage:e})}if(void 0!==c&&n[c]&&e7(n[c])&&!iG(n[c])){let e=iW();e=e.replace(e.substring(0,8),n[c]),n[c]=e}let m=!!(i&&i.convertError),v=()=>"Chained"===h?f.executeChained(a.bind(this,...n),t,p,g,m,r,i):"Sync"===h?f.executeSync(a.bind(this,...n),t,p,g,m,r):f.execute(a.bind(this,...n),t,p,g,m,r,i);if("StartCall"!==t&&"JoinCall"!==t||f.hasPendingOperation("_CallStartOrJoinInitiated")||f.createPendingOperation("_CallStartOrJoinInitiated").catch(ah),i&&i.triggerAttach&&!f.hasPendingOperation("_ElectronSlimcoreReady")&&f.createPendingOperation("_ElectronSlimcoreReady").catch(ah),i&&"Sync"!==i.type){let e=i&&i.waitFor;if(Array.isArray(e))return Promise.all(e.map(e=>e&&f.hasPendingOperation(e)&&f.waitForOperation(e,void 0,g))).then(v,v);if(e&&f.hasPendingOperation(e))return f.waitForOperation(e,void 0,g).then(v,v)}return v()},Reflect.defineProperty(s.value,"name",{value:a.name}),s},aU=(e,t)=>{if(0===t)return e._callOperationHandler;if(1===t)return e._participantOperationHandler;throw Error("Unsupported operation handler type!")};function a$(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)|0;return t}var aV=class{constructor(e){this._disposed=!1,this._logger=e.createChild("[ASYNC]"),this._endOperationDeferred=new iE,this._endOperationDeferred.promise.catch(e=>{this._logger.info("Rejected all operations")}),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._deferredOperationsWithCauseId={},this._logger=e}registerPromise(e,t){let i=!1,n=()=>{i=!0};return t.then(n,n),Promise.race([this._endOperationDeferred.promise.catch(t=>{if(!i)throw Error(`Operation ${e} did not complete, reason:${t}`)}),t])}updateOperationId(e,t){this._logger.info(`updateOperationId ${e} ${t}`),Object.keys(this._deferredOperationsWithOperationId).forEach(i=>{i&&this._deferredOperationsWithOperationId[i]&&(this._logger.info(`_deferredOperationsWithOperationId ${i}`),Object.keys(this._deferredOperationsWithOperationId[i]).forEach(n=>{n&&this._deferredOperationsWithOperationId[i][n]&&(this._logger.info(`_deferredOperationsWithOperationId ${n} ${t}`),n===e&&(this._deferredOperationsWithOperationId[i][t]=this._deferredOperationsWithOperationId[i][n],delete this._deferredOperationsWithOperationId[i][n]))}))}),Object.keys(this._deferredOperationsWithCauseId).forEach(i=>{i&&this._deferredOperationsWithCauseId[i]&&(this._logger.info(`_deferredOperationsWithCauseId ${i}`),Object.keys(this._deferredOperationsWithCauseId[i]).forEach(n=>{n&&this._deferredOperationsWithCauseId[i][n]&&(this._logger.info(`_deferredOperationsWithCauseId ${n} ${t}`),n===e&&(this._deferredOperationsWithOperationId[i][t]=this._deferredOperationsWithOperationId[i][n],delete this._deferredOperationsWithOperationId[i][n]))}))})}createPendingOperation(e,t,i=e9(),n={}){let r,s=new iE;s.promise.catch(ah);let a=this.getOperationInfoForLogging(i,e,t);if(this._logger.info(`${a}[creating...]`),this._disposed)return this._logger.info(`${a}[create failed, call is disposed]`),Promise.reject(60);if(t){if(this._deferredOperationsWithOperationId[e]||(this._deferredOperationsWithOperationId[e]={}),this._deferredOperationsWithOperationId[e][t])return this._logger.warn(`${a} Deferred operation with given name and operation id is already defined`),Promise.reject(Error(`Deferred operation with given name is already defined:${e}/${ta(t)}`));this._deferredOperationsWithOperationId[e][t]={deferred:s,causeId:i},this._deferredOperationsWithCauseId[i]||(this._deferredOperationsWithCauseId[i]={}),this._deferredOperationsWithCauseId[i][t]={deferred:s,options:n,operationName:e},r=this._endOperationDeferred.promise.catch(i=>{if(this.hasPendingOperationWithOperationId(e,t))throw Error(`Operation ${e} ${t} did not complete, reason:${i}`)})}else{if(this._deferredOperations[e])return this._logger.warn(`${a} Deferred operation with given name is already defined`),Promise.reject(Error(`Deferred operation with given name is already defined:${e}`));this._deferredOperationsWithCauseId[i]||(this._deferredOperationsWithCauseId[i]={}),this._deferredOperationsWithCauseId[i][""]={deferred:s,options:n,operationName:e},this._deferredOperations[e]={deferred:s,causeId:i},r=this._endOperationDeferred.promise.catch(t=>{if(this.hasPendingOperation(e))throw Error(`Operation ${e} did not complete, reason:${t}`)})}return Promise.race([r,s.promise])}hasPendingOperation(e){return!!this._deferredOperations[e]}hasAtleastOneOfPendingOperation(e){for(let t of e)if(this.hasPendingOperation(t))return!0;return!1}hasPendingOperationWithOperationId(e,t){return!!t&&!!this._deferredOperationsWithOperationId[e]&&!!this._deferredOperationsWithOperationId[e][t]}hasPendingOperationWithCauseId(e,t){let i=t||"";return this._deferredOperationsWithCauseId[e]&&!!this._deferredOperationsWithCauseId[e][i]}getPendingOperationWithCauseId(e,t){return this.hasPendingOperationWithCauseId(e,t)?this._deferredOperationsWithCauseId[e][t].deferred.promise:Promise.reject(`[${e}][${t}]: getPendingOperationWithCauseId for given causeId, operationId`)}resolveOperationWithCauseId(e,t,i){let n=t||"";if(this.hasPendingOperationWithCauseId(e,n)){let t=this._deferredOperationsWithCauseId[e][n],r=t.deferred.promise;return t.deferred.resolve(i),this._logger.info(`[${e}][${n}] resolved, result=${t_(i)||"void"}`),delete this._deferredOperationsWithCauseId[e][n],r}return Promise.reject(`[${e}][${n}] resolveOperationWithCauseId failed, operation not found`)}rejectOperationWithCauseId(e,t,i){let n=t||"";if(this.hasPendingOperationWithCauseId(e,n)){let t=this._deferredOperationsWithCauseId[e][n],r=t.deferred.promise;return r.catch(ah),t.deferred.reject(i),this._logger.info(`[${e}][${n}] rejected, result=${t_(i)||"void"}`),delete this._deferredOperationsWithCauseId[e][n],r}return Promise.reject(`[${e}][${n}] rejectOperationWithCauseId failed, operation not found`)}maybeResolveOperationWithCauseId(e,t,i){this.hasPendingOperationWithCauseId(e,t)?this.resolveOperationWithCauseId(e,t,i).catch(t=>{this._logger.info(`${e}maybeResolveOperationWithCauseId failed, reason=${t_(t)}`)}):this._logger.info(`${e}maybeResolveOperationWithCauseId ignored, operation does not exist`)}maybeRejectOperationWithCauseId(e,t,i){this.hasPendingOperationWithCauseId(e,t)?this.rejectOperationWithCauseId(e,t,i).catch(ah):this._logger.info(`${e}maybeRejectOperationWithCauseId ignored, operation does not exist`)}getPendingOperation(e,t,i=e9()){return!t&&this._deferredOperations[e]?this._deferredOperations[e].deferred.promise:t&&this._deferredOperationsWithOperationId[e]&&this._deferredOperationsWithOperationId[e][t]?this._deferredOperationsWithOperationId[e][t].deferred.promise:Promise.reject(`${this.getOperationInfoForLogging(i,e,t)}: Deferred operation with given name and operation does not exist`)}waitForOperation(e,t,i=e9()){return t&&this.hasPendingOperationWithOperationId(e,t)?this._deferredOperationsWithOperationId[e][t].deferred.promise:this.hasPendingOperation(e)?this._deferredOperations[e].deferred.promise:Promise.reject(`${this.getOperationInfoForLogging(i,e,t)}failed=wait failed, operation not found`)}resolveOperation(e,t,i,n=e9(),r=!1){if(!e)return Promise.reject("Unable to resolve deferred operation with empty name");if(i&&this.hasPendingOperationWithOperationId(e,i)){let n=this._deferredOperationsWithOperationId[e][i],s=n.deferred.promise;return n.deferred.resolve(t),this._logger.info(`${this.getOperationInfoForLogging(n.causeId,e,i)}resolved, result=${t_(t)||"void"}`),r||delete this._deferredOperationsWithOperationId[e][i],s}if(this.hasPendingOperation(e)){let n=this._deferredOperations[e],s=this._deferredOperations[e].deferred.promise;return this._deferredOperations[e].deferred.resolve(t),this._logger.info(`${this.getOperationInfoForLogging(n.causeId,e,i)}resolved, result=${t_(t)||"void"}`),r||delete this._deferredOperations[e],s}return Promise.reject(`${this.getOperationInfoForLogging(n,e,i)}failed=resolve failed, operation not found`)}rejectOperation(e,t,i,n=e9()){if(!e)return Promise.reject("Unable to reject deferred operation with empty name");if(i&&this.hasPendingOperationWithOperationId(e,i)){let n=this._deferredOperationsWithOperationId[e][i],r=n.deferred.promise;return r.catch(ah),n.deferred.reject(t),this._logger.info(`${this.getOperationInfoForLogging(n.causeId,e,i)}rejected, reason=${t_(t)||"void"}`),delete this._deferredOperationsWithOperationId[e][i],r}if(this.hasPendingOperation(e)){let n=this._deferredOperations[e],r=n.deferred.promise;return r.catch(ah),n.deferred.reject(t),this._logger.info(`${this.getOperationInfoForLogging(n.causeId,e,i)}rejected, reason=${t_(t)||"void"}`),delete this._deferredOperations[e],r}return Promise.reject(`${this.getOperationInfoForLogging(n,e,i)}failed=reject failed, operation not found`)}maybeResolveOperation(e,t,i,n=e9()){let r=this.getOperationInfoForLogging(n,e,i);i&&this.hasPendingOperationWithOperationId(e,i)||this.hasPendingOperation(e)?this.resolveOperation(e,t,i,n).catch(e=>{this._logger.info(`${r}maybeResolveOperation failed, reason=${t_(e)}`)}):this._logger.info(`${r}maybeResolveOperation ignored, operation does not exist`)}maybeResolveOperations(e,t,i,n=e9()){for(let r of e)this.maybeResolveOperation(r,t,i,n)}maybeRejectOperation(e,t,i,n=e9()){let r=this.getOperationInfoForLogging(n,e,i);i&&this.hasPendingOperationWithOperationId(e,i)||this.hasPendingOperation(e)?this.rejectOperation(e,t,i,n).catch(ah):this._logger.info(`${r}maybeRejectOperation ignored, operation does not exist`)}maybeRejectOperations(e,t,i,n=e9()){for(let r of e)this.maybeRejectOperation(r,t,i,n)}rejectPendingOperations(e,t=e9()){this._disposed=!0,this._logger.info(`[${t}]rejectPendingOperations=${JSON.stringify(e)}`),Object.keys(this._deferredOperations).forEach(i=>{this.maybeRejectOperation(i,e,void 0,t),this._deferredOperationsWithOperationId[t]&&delete this._deferredOperationsWithOperationId[t][""]}),Object.keys(this._deferredOperationsWithOperationId).forEach(i=>{Object.keys(this._deferredOperationsWithOperationId[i]).forEach(n=>{this.maybeRejectOperation(i,e,n,t),this._deferredOperationsWithOperationId[t]&&delete this._deferredOperationsWithOperationId[t][n]})}),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._endOperationDeferred.reject(e)}maybeRejectPendingOperationsWithPredicate(e,t=e9(),i){this._logger.info(`[${t}]rejectPendingOperationsWithPredicate`),Object.keys(this._deferredOperationsWithCauseId).forEach(t=>{Object.keys(this._deferredOperationsWithCauseId[t]).forEach(n=>{let r=this._deferredOperationsWithCauseId[t][n];r&&i(r.operationName,r.options)&&(this.maybeRejectOperation(r.operationName,e,n),this.maybeRejectOperationWithCauseId(t,n,e))})})}getOperationInfoForLogging(e,t,i=""){let n=i?`[${ta(i)}]`:"";return`[${e.substring(0,8)}][${t}]${n}`}},aB=i(892891),aH=class{constructor(e){this._logger=e,this._promise=Promise.resolve(void 0),this._actionQueue=[]}chainPromise(e,t,i=e9(),n=!1){let r=Date.now(),s=(("function"==typeof t?t():t)||"").toString();this._actionQueue.push(s),this._logger.info(`[${i}][${s}]enqueueing, queue=[${this._actionQueue}], reset=${n}`);let a=()=>{this._actionQueue=this._actionQueue.filter(e=>e!==s)};return n&&this.reset(i),this._promise=this._promise.catch(aB.noop).then(()=>{let t=Date.now()-r;return this._logger.info(`[${i}][${s}]begin, delayMs=${t}`),e()}),this._promise.then(()=>{a();let e=Date.now()-r;this._logger.info(`[${i}][${s}]success, durationMs=${e}`)},e=>{a();let t=Date.now()-r;this._logger.warn(`[${i}][${s}]failed=${tI(e)}, durationMs=${t}`)}),this._promise}reset(e){this._logger.info(`[${e}] resetting`),this._promise=Promise.resolve(void 0)}};function aj(e){return!!e?.terminatedReasonCode}function aq(e){return aj(e)?{code:e.terminatedReasonCode,subCode:e.terminatedReasonSubCode,phrase:e.errorMessage}:e}function aW(e){return!!e?.code}function aG(e,t){return aW(e)?e:{code:499,subCode:void 0!==t?t:0,phrase:"string"==typeof e?e:t_(e)}}function az(){return{code:0}}var aJ=class{constructor(){this.msElapsed=0,this.isPaused=!1,this._startTime=new Date().getTime(),this.pause=()=>{this.isPaused||(this.msElapsed+=new Date().getTime()-this._startTime,this.isPaused=!0)},this.resume=()=>{this.isPaused&&(this.isPaused=!1,this._startTime=new Date().getTime())},this.duration=()=>this.isPaused?this.msElapsed:this.msElapsed+new Date().getTime()-this._startTime,this.durationInMinutes=()=>Math.ceil(this.duration()/6e4),this.durationInSeconds=()=>Math.ceil(this.duration()/1e3)}get startTime(){return this._startTime}};function aK(){return new aJ}var aQ=class extends aV{constructor(e,t,i,n,r){super(e),this.callTelemetry=t,this._ecsConfig=i,this._publishCallback=n,this._preconditionFunction=r,this._record={},this.logSuccess=(e,t,i)=>{this._logger.info(`${e} execution succeeded, result=${t?t_(t):"void"}, time=${i.duration()}`)},this.logFailure=(e,t,i)=>{this._logger.info(`${e} execution failed, reason=${this.stringifyForLogging(t)}, time=${i.duration()}`)},this.logTimeout=(e,t,i)=>{this._logger.info(`${e} execution timed out, reason=${this.stringifyForLogging(t)}, time=${i.duration()}`)},this.stringifyForLogging=e=>{let t;if(e instanceof Error)t=e.toString()||"Unknown Error";else try{t=JSON.stringify(e)}catch(e){t="Unable to stringify data"}return t},this.convertToTransactionEndIfErrorOrString=(e,t,i)=>{if(this._logger.info(`ecsEnableErrorConversion in operationHandler is: ${this._ecsConfig&&this._ecsConfig.enableErrorConversion}`),t&&this._ecsConfig&&this._ecsConfig.enableErrorConversion&&("string"==typeof e||e instanceof Error)){let t=aG(e);return this._logger.info(`${i} Error converted from ${e} to ${t_(t)}`),t}return e},this._logger=e.createChild("[Operation]"),this._chainedPromise=new aH(this._logger.createChild("[Chained]"))}resetOperationChain(e){this._chainedPromise.reset(e)}executeSync(e,t,i,n=e9(),r,s){let a,o=this.getOperationInfoForLogging(n,t,i),l=aK();this._logger.info(`${o}API calledSync`);let c=this.callTelemetry.recordOperation(t,n,i,s);try{this._setRecord(t),a=e(),c.recordSuccess(a,n),this.logSuccess(o,a,l)}catch(t){let e=this.convertToTransactionEndIfErrorOrString(t,r,o);c.recordFailure(e,n),this.logFailure(o,e,l)}return a}async executeChained(e,t,i,n=e9(),r,s,a){return this.checkPendingOperationAndExecute(e,!0,t,i,n,r,s,a)}async execute(e,t,i,n=e9(),r,s,a){return this.checkPendingOperationAndExecute(e,!1,t,i,n,r,s,a)}logOperation(e,t,...i){let n=i.length&&i.map(e=>this.stringifyForLogging(ta(e)));this._logger.info(`[${e.substring(0,8)}][${t}]API called, ${n?`with args=${n}`:""}`)}rejectPendingOperations(e,t=e9(),i){if(i){for(let e of Object.keys(this._deferredOperations))this.callTelemetry.maybeRecordOperationFailure(e,i,void 0,t);for(let e of Object.keys(this._deferredOperationsWithOperationId))for(let n of Object.keys(this._deferredOperationsWithOperationId[e]))this.callTelemetry.maybeRecordOperationFailure(e,i,n,t)}super.rejectPendingOperations(e,t)}maybeRejectOperations(e,t,i,n=e9(),r){if(r)for(let t of e)this.callTelemetry.maybeRecordOperationFailure(t,r,void 0,n);super.maybeRejectOperations(e,t,i,n)}checkPendingOperationAndExecute(e,t,i,n,r=e9(),s,a,o){let l=this.getOperationInfoForLogging(r,i,n),c=null,d=null;return(this.hasPendingOperationWithOperationId(i,n)||this.hasPendingOperation(i)?(this._logger.info(`${l}already pending, returning existing operation`),c=this.waitForOperation(i,n,r)):d=this.createPendingOperation(i,n,r,o),t)?(this._logger.info(`${l}chained`),this._chainedPromise.chainPromise(()=>c||this.executeInternal(d,r,e,i,n,s,a,o),i,r)):c||this.executeInternal(d,r,e,i,n,s,a,o)}_setRecord(e){this._record.hasOwnProperty(e)||(this._record[e]=0),this._record[e]+=1}getRecord(e){return this._record[e]}_recordTelemetryTimeoutAndPublish(e,t,i,n,r,s,a){let o=e||60;return window.setTimeout(()=>{if(!this._publishCallback)return void this._logger.warn(`${r} is marked to publish telemetry but no publish callback is defined.`);if(!this.hasPendingOperationWithOperationId(n,a)&&!this.hasPendingOperation(n))return;let e=Error(`${r} execution did not complete before telemetry timeout of ${o}s.`);this.logTimeout(r,e,s),this.callTelemetry.maybeRecordOperationTimeout(n,e,a,i),this._publishCallback(t),this.callTelemetry.removeRecordedEvent(t)},1e3*o)}_instantTelemetryPublish(e,t){this._publishCallback?(this._publishCallback(t),this.callTelemetry.removeRecordedEvent(t)):this._logger.warn(`${e} is marked to publish telemetry but no publish callback is defined.`)}parseInstantTelemetryParameters(e){let t,i=!1;return e&&(i=e.enableInstantTelemetry,t=e.telemetryTimeout),[i,t]}async executeInternal(e,t,i,n,r,s,a,o){let l=this.getOperationInfoForLogging(t,n,r);this._logger.info(`${l} executing operation...`);let c=aK(),d=this.callTelemetry.recordOperation(n,t,r,a),[u,h]=this.parseInstantTelemetryParameters(o);try{let e;this._setRecord(n),u&&(e=this._recordTelemetryTimeoutAndPublish(h,d,t,n,l,c,r)),o?.preconditionTags?.length&&this._preconditionFunction&&this._preconditionFunction(n,o.preconditionTags);let s=await i();e&&clearTimeout(e),this.callTelemetry.maybeRecordOperationSuccess(n,s,r),this.logSuccess(l,s,c),this.maybeResolveOperation(n,s,r,t)}catch(i){let e=this.convertToTransactionEndIfErrorOrString(i,s,l);this.callTelemetry.maybeRecordOperationFailure(n,aq(e),r),this.logFailure(l,e,c),this.maybeRejectOperation(n,e,r,t)}return u&&this._instantTelemetryPublish(l,d),e}getEcsConfig(){return this._ecsConfig}},aY=603,aZ=403,aX=412,a0=0,a1=302,a2=400,a3=404,a4=406,a5=410,a6=413,a8=491,a9=497,a7=498,oe=500,ot=503,oi=0,on=3020,or=5204,os=5448,oa=10005,oo=5807,ol=3099,oc=3100,od=3101,ou=3108,oh=3109,og=3110,op=3111,of=3112,om=3113,ov=3114,oS=3115,oy=3115,oC=4103,ob=4105,oT=5e3,oE=5854,o_=5300,oI=5855,ow=5723,oP=5724,oR=5354,oA=5810,oM=10193,oD=800100,oO=58e4,ok={0:1,487:12,603:10,480:2,408:6,450:30,302:75,404:24,481:46,406:5,400:5,410:4,413:59,580:4,490:3,496:31,498:25,451:27,452:28,495:29,500:7,409:7,491:7,470:7,488:26,497:32,403:8,412:65},oN={9401:33,9422:33,6102:1,6423:14,9402:14,9432:14,6519:3,9403:15,9410:36,9411:37,1e3:2,9407:17,13430:18,6009:19,10484:19,10604:19,10404:19,10420:19,10403:20,17401:20,10408:9,10486:11,10600:11,10686:11,10487:21,10500:3,10501:3,10502:3,10503:3,10504:3,10480:22,10482:22,10603:10,13406:23,13416:23},ox={500:39,403:41,404:42,480:40},oL={INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_PSTN_NGC_CALL:111,INCOMING_SCREENSHARE_WITH_CHAT:119,INCOMING_CALLQUEUE_SUPERVISOR_CONTENT:125,INCOMING_TFL_TFW_CALL:126},oF={SHARED_LINE_CALL_RECORD:121,SHARED_LINE_V2_CALL_RECORD:123,MEETING_STARTED_NOTIFICATION:128},oU={LOG_UPLOAD_EVENT:120},o$="CallEndReasonUnknown",oV="CallEndReasonMediaError",oB="CallEndReasonMediaPermissionError",oH="CallEndReasonMediaDropDuringConnectError",oj="CallEndReasonMediaDropAfterConnectError",oq="CallEndReasonMediaOfferProcessingError",oW="DowngradeToStreamingClient",oG="CallEndReasonIncompatibleOffer",oz="MediaWhitelistingIssue",oJ="CallEndReasonAttachFailed",oK="CallEndReasonBadNotificationPayload",oQ="RetargetNotSupported",oY="CallEndReasonLocalUserInitiated",oZ="EndedByRemoteEndpoint",oX="CallEndReasonRedirected",o0="CallEndReasonVDIdisconnect",o1="CallEndReasonSuspended",o2=((r=o2||{}).GetSignalingMediaTypes="GetSignalingMediaTypes",r.CallStart="CallStart",r.WaitForAnswer="WaitForAnswer",r.WaitForConnect="WaitForConnect",r.Accept="Accept",r),o3=((s=o3||{}).InitializeMediaSession="InitializeMediaSession",s.UpdateMediaModalities="UpdateMediaModalities",s.CreateOffer="CreateOffer",s.CreateAnswer="CreateAnswer",s.ProcessAnswer="ProcessAnswer",s.GetSignalingMediaTypes="GetSignalingMediaTypes",s.MuteUnmute="MuteUnmute",s.MuteUnmuteSpeakers="MuteUnmuteSpeakers",s.StartVideoSafe="StartVideoSafe",s.CompleteNegotiation="CompleteNegotiation",s.MuteInput="MuteInput",s.MuteOutput="MuteOutput",s.UnmuteInput="UnmuteInput",s.UnmuteOutput="UnmuteOutput",s.evaluateEndpointStatesForAccept="evaluateEndpointStatesForAccept",s.handleEndpointStatesForAccept="handleEndpointStatesForAccept",s),o4=((a=o4||{}).InitializeMediaSession="InitializeMediaSession",a.ProcessOffer="ProcessOffer",a.ProcessOfferedModalities="ProcessOfferedModalities",a.TrySendingProvisionalAnswer="TrySendingProvisionalAnswer",a),o5=i(892891),o6=eR(i(892891)),o8=class e{static isInLobby(e,t){for(let i of e)if(i.endpointId===t&&i.isLobby)return!0;return!1}static isParticipantServerMuted(e){for(let t of e)if(t.mediaStreams&&!t.mappedTo){for(let e of t.mediaStreams)if("audio"===e.type&&!0===e.serverMuted)return!0}return!1}static fromWireParticipant(t){return sy(t,"invalid wireParticipant"),sS(t.id,"participant must have valid Id"),new e({id:t.id,displayName:t.displayName,languageId:t.languageId,acceptedBy:t.acceptedBy})}static getPluginlessStateTypeFromWire(e){return sX(e)}static findOrCreateTypeState(e,t){let i=t.typeStates.findIndex(t=>t.type===e);if(-1===i){let n={participantStates:[],type:e};t.typeStates.push(n),i=t.typeStates.length-1}return i}static processPublishedStates(e,t){let i={typeStates:[]};i.typeStates=[];let n=e;return o6.forEach(n,e=>{let n=this.findOrCreateTypeState(this.getPluginlessStateTypeFromWire(e.stateType),i),r={id:t,publishedState:{content:e.content,stateId:e.stateId,typeRank:e.typeRank}};i.typeStates[n].participantStates.push(r)}),i}static fromRosterEndpoints(e){let t=[],i=!1,n=!1,r=!1,s=!1;return{endpointDetails:t=Object.keys(e).map(t=>{let a,o,l,c=[],d=!1,u=0;if(e[t].call&&(i=!0,c=e[t].call.mediaStreams||null,u=e[t].call.serverMuteVersion||0,o=e[t].call.appliedInteractivityLevel||"unknown",l=e[t].call.negotiationTag),e[t].lobby&&(d=!0,n=!0,c=e[t].lobby.mediaStreams||null),e[t].broadcast?.sessionInformation&&(a=e[t].broadcast.sessionInformation.role||null),e[t].mappedParticipant&&(r=!0,c=e[t].mappedParticipant.mediaStreams||null),!e[t].capabilities&&e[t].endpointCapabilities){let i=e[t].endpointCapabilities;e[t].capabilities={implicitCallback:16&i?"enabled":"disabled",cloudAudioVideoConference:1&i?"enabled":"disabled",cloudScreenSharing:2&i?"enabled":"disabled",hostlessConference:4&i?"enabled":"disabled",autoJoinOnConflict:32&i?"enabled":"disabled",serverMuteUnmute:64&i?"enabled":"disabled",supportsCompressedServicePayload:128&i?"enabled":"disabled",cloudMerge:8&i?"enabled":"disabled"}}return s=s||!!e[t].streamLobby||!!e[t].stream,{endpointId:t,participantId:e[t].participantId||null,clientVersion:e[t].clientVersion||null,endpointMetadata:e[t].endpointMetadata||null,originalId:e[t].originalId||null,contentSharing:e[t].contentSharing||null,capabilities:e[t].capabilities||null,endpointType:e[t].endpointType||"default",deviceType:e[t].deviceType||void 0,clientEndpointCapabilities:e[t].clientEndpointCapabilities||void 0,mediaStreams:c,serverMuteVersion:u,broadcastMeetingRole:a,isLobby:d,endpointState:e[t].endpointState||null,publishedStates:e[t].publishedStates||null,callLinks:e[t].callLinks||null,appliedInteractivityLevel:o||"unknown",mappedTo:e[t].mappedTo||null,meetingGroupDetails:e[t].meetingGroupDetails,streamInformation:e[t].streamInformation,propertyBag:e[t].propertyBag,streamLobby:e[t].streamLobby,stream:e[t].stream,endpointMeetingRoles:e[t].endpointMeetingRoles,negotiationTag:l}}),participantHasCallModality:i,participantIsInLobby:n,participantHasMappedEndpoint:r,participantHasStreamEndpoint:s}}static fromRoster(t,i=!1){sy(t,`invalid rosterParticipant ${JSON.stringify(t)}`),sS(t.details.id,"participant must have valid Id");let n=t.endpoints||{},r=this.fromRosterEndpoints(n),s=r.endpointDetails,a=r.participantHasCallModality,o=r.participantHasMappedEndpoint,l=r.participantHasStreamEndpoint,c=r.participantIsInLobby;return a||c||o||i||l?(a&&(c=!1),new e({id:t.details.id,displayName:t.details.displayName,otpIdentity:t.details.otpIdentity,version:t.version||0,propertyBag:t.details.propertyBag||null,languageId:t.details.languageId,role:t.role||"",tenantId:t.details.tenantId||"",endpointDetails:s||[],acceptedBy:t.acceptedBy||"",isLobby:c,meetingRole:t.meetingRole,advancedMeetingRole:t.advancedMeetingRole,meetingRoles:t.meetingRoles,participantType:t.details.participantType,publishedStates:t.publishedStates||null,isIdentityMasked:t.details.isIdentityMasked,nonMaskedId:t.details.nonMaskedId||"",nonMaskedObjectId:t.details.nonMaskedObjectId||"",nonMaskedDisplayName:t.details.nonMaskedDisplayName||"",maskedIdSeqNumber:t.details.maskedIdSeqNumber||0,maskedId:t.details.maskedId||"",joinAsStreamingUser:t.joinAsStreamingUser,enableCaptcha:t.enableCaptcha})):null}static fromRosterSearchResults(e){sy(e,`invalid rosterParticipant ${JSON.stringify(e)}`),sS(e.details.id,"participant must have valid Id");let t=e.endpoints,{endpointDetails:i,participantHasCallModality:n,participantIsInLobby:r,participantHasMappedEndpoint:s,participantHasStreamEndpoint:a}=this.fromRosterEndpoints(t),o=0;return n||a?o=3:r?o=10:s&&(o=3),{id:e.details.id,state:o,tenantId:e.details.tenantId||"",displayName:e.details.displayName,role:e.role||"",meetingRole:e.meetingRole,advancedMeetingRole:e.advancedMeetingRole,meetingRoles:e.meetingRoles,participantType:e.details.participantType,isServerMuted:this.isParticipantServerMuted(i),publishedStates:this.processPublishedStates(e.publishedStates,e.details.id),endpoints:i||[],isIdentityMasked:e.details.isIdentityMasked,nonMaskedId:e.details.nonMaskedId||"",nonMaskedDisplayName:e.details.nonMaskedDisplayName||"",nonMaskedObjectId:e.details.nonMaskedObjectId||"",maskedIdSeqNumber:e.details.maskedIdSeqNumber||0,maskedId:e.details.maskedId||"",joinAsStreamingUser:e.joinAsStreamingUser}}constructor(e){this.id=e.id,this.displayName=e.displayName||"",this.otpIdentity=e.otpIdentity,this.version=e.version,this.propertyBag=e.propertyBag,this.languageId=e.languageId||null,this.endpointDetails=e.endpointDetails||[],this.acceptedBy=e.acceptedBy,this.role=e.role,this.tenantId=e.tenantId,this.isLobby=e.isLobby,this.meetingRole=e.meetingRole,this.advancedMeetingRole=e.advancedMeetingRole,this.meetingRoles=e.meetingRoles,this.participantType=e.participantType,this.publishedStates=e.publishedStates,this.isIdentityMasked=e.isIdentityMasked,this.nonMaskedId=e.nonMaskedId,this.nonMaskedDisplayName=e.nonMaskedDisplayName,this.nonMaskedObjectId=e.nonMaskedObjectId,this.maskedIdSeqNumber=e.maskedIdSeqNumber,this.maskedId=e.maskedId,this.joinAsStreamingUser=e.joinAsStreamingUser,this.enableCaptcha=e.enableCaptcha}},o9="HandleMediaAcknowledgement",o7="HandleMediaNegotiationFailure",le="HandleMediaAnswer",lt="HandleMediaAnswerFailed",li="HandleMediaOffer",ln="RejectRenegotiation",lr="HandleRetargetCompleted",ls="HandleMediaAnswerTimeout",la="HandleMediaAcknowledgementTimeout",lo="AcceptRenegotiation",ll="StartRenegotiation",lc="MediaFsmStateChanged",ld="AddModalityTimeout",lu="AddParticipant",lh="AddParticipantTimeout",lg="AddParticipantWithReplaces",lp="AddParticipantWithReplacesTimeout",lf="AddParticipantsAndModality",lm="AdmitParticipant",lv="AdmitParticipantTimeout",lS="Admit",ly="AdmitTimeout",lC="AdmitFailure",lb="AdmitSuccess",lT="CallMeBack",lE="CallMeBackTimeout",l_="RemoveParticipant",lI="RemoveParticipantOthers",lw="RemoveParticipantSpecified",lP="RemoveParticipantTimeout",lR="HandleAddParticipantSuccess",lA="HandleAddParticipantFailure",lM="HandleAdmitParticipantSuccess",lD="HandleAdmitParticipantFailure",lO="HandleAddParticipantModalityFailure",lk="HandleRemoveParticipantSuccess",lN="HandleRemoveParticipantFailure",lx="HandleRosterUpdate",lL="HandleRosterUpdateFail",lF="HandleConversationUpdate",lU="HandleLocalParticipantUpdate",l$="SetSubject",lV="SetJoinedFrom",lB="SetDeviceType",lH="GetEmergencyContent",lj="SetMultiparty",lq="SetGroupId",lW="SetThreadId",lG="SetCallOptions",lz="SetTransferContext",lJ="StartCall",lK="JoinCall",lQ="StartOrJoinCall",lY="JoinConversationWithoutCallModality",lZ="HandleIncomingCall",lX="EndCall",l0="EndWithBeacon",l1="RejectWithFetchKeepAlive",l2="EndWithFetchKeepAlive",l3="ConflictedCall",l4="SetProvisionalAnswer",l5="SetProvisionalAnswerFailed",l6="AcceptCall",l8="AcceptCallFailed",l9="HandleCallAcceptanceAck",l7="HandleCallAcceptance",ce="HandleCallAcceptanceSync",ct="HandleCallAcceptanceFailed",ci="HandleCallEstablishmentTimeout",cn="HandleCallEnd",cr="HandleCallProgress",cs="TrouterUrlChanged",ca="TrouterStateChanged",co="TrouterUrlChangedToInvalid",cl="TrouterUrlUpdateFailed",cc="AddContentSharingModality",cd="AcceptedBeforeRinging",cu="DeleteContentSharing",ch="TakeControlContentSharing",cg="UpdateSessionStateContentSharing",cp="JoinContentSharing",cf="UpdateParticipantStateContentSharing",cm="HandleContentSharingUpdate",cv="HandleContentSharingEnd",cS="ContentSharingStartFromRoster",cy="ContentSharingEndFromRoster",cC="HandleAddModalitySuccess",cb="HandleAddModalityFailure",cT="AddBroadcastModality",cE="AddModality",c_="UpdateBroadcastDetails",cI="WaitingForAddBroadcastModalityCompletion",cw="WaitingForAddModalityCompletion",cP="Mute",cR="NudgeParticipantTimeout",cA="Unmute",cM="UnmuteTimeout",cD="HandleUnmuteConfirm",cO="ApproveUnmute",ck="RejectUnmute",cN="HandleControlVideoStreaming",cx="HandleDominantSpeakerChangedCount",cL="HandleCsrcInfo",cF="SendWebRtcMediaNotification",cU="TransferCall",c$="ParkCall",cV="CallRedirect",cB="CallRedirectRequestFailed",cH="TransferCompletionFailed",cj="TransferRequestReceived",cq="HandleParkRequested",cW="DuplicateMessageIgnored",cG="CorrelationIdUpdated",cz="UnkownMessageType",cJ="FailedToHandleMessage",cK="ConnectivityChanged",cQ="TrouterDecodePayloadFailure",cY="UpdateEndpointState",cZ="BrokerDecodePayloadFailure",cX="BrokerSubscriptionTimeout",c0="BrokerSubscriptionSuccessful",c1="BrokerSubscriptionFailed",c2="FailedToHandleTrouterMessage",c3="FailedToHandleBrokerMessage",c4="BrokerDisabledSubscribeUrlPresent",c5="Connected",c6="InLobby",c8="Staging",c9="MessageMissingBody",c7="BroadcastStateChanged",de="HandleCallNotification",dt="HandleIncomingCallReplacement",di="HandlePstnBalanceUpdate",dn="IgnoreOldRoster",dr="HandleMediaAck",ds="HandleMediaProvisionalAck",da="UpdateCallStatus",dl="SendAttach",dc="RequestNewOffer",dd="HandleNewOffer",du="UpdateConversationLinks",dh="UpdateConversationLinksSuccess",dg="UpdateConversationLinksFailed",dp="ProcessInitialOffer",df="SendProgress",dm="SendProgressFailed",dv="ProcessCallAcceptance",dS="AcceptanceUserInLobby",dy="RejectIncomingCall",dC="SendKeepAlive",db="SendKeepAliveFailed",dT="StartAudio",dE="StopAudio",d_="UpdateMeetingRole",dI="EnablingPreheat",dw="DisablingPreheat",dP="PreheatDisabled",dR="TransferRequestSent",dA="CallRedirectRequestSent",dM="TransferRequestFailed",dD="SendAcceptTransfer",dO="SendAcceptTransferFail",dk="WaitingForTransferCompletion",dN="WaitingForTransferCompletionFail",dx="WaitingForTransferAcceptanceFail",dL="WaitingForTransferAcceptance",dF="TransferCompleted",dU="SendCompleteTransfer",d$="SendCompleteTransferFailed",dV="PickupCodeSet",dB="AddParticipantWithPickupCode",dH="AddParticipantWithPickupCodeTimeout",dj="PublishState",dq="PublishStateFailure",dW="RemoveState",dG="RemoveStateFailure",dz="UpdateMeetingSettings",dJ="UpdateMeetingSettingsFailure",dK="UpdateEndpointMetadataSuccess",dQ="UpdateEndpointMetadataFailure",dY="SearchParticipants",dZ="GetAllParticipants",dX="SearchParticipantsFailure",d0="GetAllParticipantsFailure",d1="ParkRequestFailed",d2="WaitingForParkCompletion",d3="WaitingForParkCompletionTimeout",d4="ParkCompleted",d5="ParkFailed",d6="UnparkRequestFailed",d8="WaitingForUnparkCompletion",d9="WaitingForUnparkCompletionTimeout",d7="UnparkCompleted",ue="UnparkFailed",ut="UpdateMeetingLiveState",ui="WaitingForUpdateMeetingLiveStateCompletion",un="UpdateMeetingLiveStateRequestFailed",ur="UpdateMeetingLiveStateResponseFailure",us="UpdateMeetingLiveStateResponseSuccess",ua="UpdateMeetingGroups",uo="UpdateParticipantInterpretationState",ul="UpdateParticipantsProperties",uc="JoinMeetingGroup",ud="LeaveMeetingGroup",uu="incomingProxiedMessages",uh="WaitingForUpdateMeetingGroupsCompletion",ug="UpdateMeetingGroupsRequestFailed",up="UpdateMeetingGroupsResponseFailure",uf="UpdateMeetingGroupsResponseSuccess",um="SetMeetingLayout",uv="WaitingForSetMeetingLayoutCompletion",uS="SetMeetingLayoutRequestFailed",uy="SetMeetingLayoutResponseFailure",uC="SetMeetingLayoutResponseSuccess",ub="UpdateParticipantInterpretationStateTimeout",uT="UpdateParticipantInterpretationStateResponseFailed",uE="UpdateParticipantInterpretationStateResponseCompleted",u_="UpdateParticipantsPropertiesTimeout",uI="UpdateParticipantsPropertiesResponseFailed",uw="UpdateParticipantsPropertiesResponseCompleted",uP="WaitingForJoinMeetingGroupCompletion",uR="JoinMeetingGroupRequestFailed",uA="JoinMeetingGroupRequestFailed",uM="JoinMeetingGroupRequestCompleted",uD="WaitingForLeaveMeetingGroupCompletion",uO="LeaveMeetingGroupRequestFailed",uk="LeaveMeetingGroupRequestFailed",uN="LeaveMeetingGroupRequestCompleted",ux="SubscribeUrlFound",uL="SubscribeUrlMissing",uF="SendMessageCompletion",uU="SendMessageTimeout",u$="DiablePreheatSucceeded",uV="AsyncDisablePreheatSucceeded",uB="DiablePreheatFailed",uH="AsyncDiablePreheatFailed",uj="DisablePreheatResponseReceived",uq="StreamInformationReceived",uW="UpdateMediaDescriptions",uG="UpdateMediaDescriptionsFailed",uz="NudgeToJoinAsRealtime",uJ="UpdateMeetingStates",uK="WaitingForUpdateMeetingStatesCompletion",uQ="UpdateMeetingStatesResponseSuccess",uY="UpdateMeetingStatesResponseFailure",uZ="UpdateMonitorSession",uX="UpdateMonitorSessionRequestFailed",u0="UpdateMonitorSessionResponseFailed",u1="UpdateMonitorSessionResponseCompleted",u2="WaitingForUpdateMonitorSessionCompletion",u3={SEND_MEDIA_ANSWER:{name:"SendMediaAnswer",controller:0},START_RENEGOTIATION:{name:"StartRenegotiation",controller:0},SEND_MEDIA_ACKNOWLEDGEMENT:{name:"SendMediaAcknowledgement",controller:0},SEND_MEDIA_REJECTION:{name:"SendMediaRejection",controller:0},ADD_PARTICIPANT:{name:"AddParticipant",controller:1},ADD_PARTICIPANT_WITH_REPLACES:{name:"AddParticipantWithReplaces",controller:1},NUDGE_PARTICIPANT:{name:"NudgeParticipant",controller:1},REMOVE_PARTICIPANT_NONE:{name:"RemoveParticipant",controller:1},REMOVE_PARTICIPANT_OTHERS:{name:"RemoveParticipantOthers",controller:1},REMOVE_PARTICIPANT_SPECIFIED:{name:"RemoveParticipantSpecified",controller:1},ADMIT_PARTICIPANT:{name:"AdmitParticipant",controller:1},ADMIT:{name:"Admit",controller:1},BROKER_SUBSCRIBE:{name:"BrokerSubscribe",controller:2},CALL_ME_BACK:{name:"CallMeBack",controller:1},SEND_ACCEPTANCE:{name:"SendAcceptance",controller:0},SEND_ACCEPTANCE_ACKNOWLEDGEMENT:{name:"SendAcceptanceAcknowledgement",controller:0},END_CALL:{name:"EndCall",controller:1},CANCEL_CALL:{name:"CancelCall",controller:1},REJECT_CALL:{name:"RejectCall",controller:0},JOIN_CONVERSATION:{name:"JoinConversation",controller:1},JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:{name:"JoinConversationWithoutCallModality",controller:1},LEAVE_CONVERSATION:{name:"LeaveConversation",controller:1},DELETE_CONVERSATION:{name:"DeleteConversation",controller:1},START_CALL:{name:"StartCall",controller:1},PLACE_NUDGE_CALL:{name:"PlaceNudgeCall",controller:5},UPDATE_CONVERSATION_LINKS:{name:"UpdateConversationLinks",controller:1},SEND_CONVERSATION_KEEP_ALIVE:{name:"SendConversationKeepAlive",controller:1},SEND_CALL_ATTACH:{name:"SendCallAttach",controller:0},SEND_CALL_PROGRESS:{name:"SendCallProgress",controller:0},SEND_KEEP_ALIVE:{name:"SendKeepAlive",controller:0},ADD_CONTENT_SHARING_MODALITY:{name:"AddContentSharingModality",controller:1},DELETE_CONTENT_SHARING:{name:"DeleteContentSharing",controller:3},TAKE_CONTROL_CONTENT_SHARING:{name:"TakeControlContentSharing",controller:3},UPDATE_SESSION_STATE_CONTENT_SHARING:{name:"UpdateSessionStateContentSharing",controller:3},JOIN_CONTENT_SHARING:{name:"JoinContentSharing",controller:3},UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:{name:"UpdateParticipantStateContentSharing",controller:3},UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS:{name:"UpdateContentSharingNotificationLinks",controller:3},MUTE_ALL:{name:"MuteAll",controller:1},MUTE_ALL_SYNC:{name:"MuteAllSync",controller:1},MUTE_SPECIFIED:{name:"MuteSpecified",controller:1},MUTE_SPECIFIED_SYNC:{name:"MuteSpecifiedSync",controller:1},MUTE_MYSELF:{name:"MuteMyself",controller:1},UNMUTE:{name:"Unmute",controller:1},UNMUTE_SYNC:{name:"UnmuteMyselfSync",controller:1},SEND_CONTROL_VIDEO_STREAMING:{name:"SendControlVideoStreaming",controller:0},SEND_APPLY_CHANNEL_PARAMETERS:{name:"SendApplyChannelParameters",controller:0},APPROVE_UNMUTE:{name:"ApproveUnmute",controller:5},REJECT_UNMUTE:{name:"RejectUnmute",controller:5},SEND_CALL_REDIRECT_REQUEST:{name:"SendCallRedirectRequest",controller:0},SEND_TRANSFER_REQUEST:{name:"SendTransferRequest",controller:0},SEND_PARK_REQUEST:{name:"SendParkRequest",controller:0},SEND_SHARED_LINE_PARK_REQUEST:{name:"SharedLinePark",controller:0},SEND_SERVER_HOLD_REQUEST:{name:"ServerHoldRequest",controller:0},PARK_REQUEST:{name:"ParkRequest",controller:0},SEND_UNPARK_REQUEST:{name:"UnparkRequest",controller:0},TRANSFER_ACCEPTANCE:{name:"TransferAcceptance",controller:0},TRANSFER_COMPLETION:{name:"TransferCompletion",controller:0},TRANSFER_COMPLETION_FAILED:{name:"TransferCompletionFailed",controller:0},UPDATE_ENDPOINT_STATE:{name:"UpdateEndpointState",controller:1},DISABLE_PREHEAT:{name:"DisablePreheat",controller:5},REQUEST_NEW_OFFER:{name:"RequestNewOffer",controller:0},UPDATE_ENDPOINT_METADATA:{name:"UpdateEndpointMetadata",controller:1},UPDATE_MEETING_ROLE_ATTENDEE:{name:"UpdateMeetingRoleToAttendee",controller:1},UPDATE_MEETING_ROLE_PRESENTER:{name:"UpdateMeetingRoleToPresenter",controller:1},UPDATE_MEETING_ROLE_ORGANIZER:{name:"UpdateMeetingRoleToOrganizer",controller:1},ADD_PARTICIPANT_WITH_PICKUP_CODE:{name:"AddParticipantWithPickupCode",controller:1},PUBLISH_STATE:{name:"PublishState",controller:1},REMOVE_STATE:{name:"RemoveState",controller:1},UPDATE_MEETING_SETTINGS:{name:"UpdateMeetingSettings",controller:1},ADD_PARTICIPANTS_AND_MODALITY:{name:"AddParticipantsAndModality",controller:1},ADD_BROADCAST_MODALITY:{name:"AddBroadcastModality",controller:1},ADD_MODALITY:{name:"AddModality",controller:1},SEARCH_PARTICIPANTS:{name:"SearchParticipants",controller:1},GET_ALL_PARTICIPANTS:{name:"GetAllParticipants",controller:1},UPDATE_MEETING_LIVE_STATE:{name:"UpdateMeetingLiveState",controller:1},UPDATE_MEETING_GROUPS:{name:"UpdateMeetingGroups",controller:1},SET_MEETING_LAYOUT:{name:"SetMeetingLayout",controller:1},UPDATE_PARTICIPANT_INTERPRETATION_STATE:{name:"UpdateParticipantInterpretationState",controller:1},JOIN_MEETING_GROUP:{name:"JoinMeetingGroup",controller:1},LEAVE_MEETING_GROUP:{name:"LeaveMeetingGroup",controller:1},SEND_PROXIED_MESSAGE:{name:"SendProxiedMessage",controller:1},UPDATE_PARTICIPANTS_PROPERTIES:{name:"UpdateParticipantsProperties",controller:1},UPDATE_MEDIA_DESCRIPTIONS:{name:"UpdateMediaDescriptions",controller:0},UPDATE_MEETING_STATES:{name:"UpdateMeetingStates",controller:1},UPDATE_MONITOR_SESSION:{name:"UpdateMonitorSession",controller:0}},u4={TROUTER:"Trouter",BROKER:"Broker",UDP:"UDP",LOCAL:"Local"},u5={NGC_SOURCE:"SkypeConcore"},u6={CONVERSATION_CALL_MODALITY:"skypecosi_concore_web_csa_conversation_callmodality",CONVERSATION_CONTENT_SHARING:"skypecosi_concore_web_csa_conversation_contentsharing",CONVERSATION_HTTP_REQUEST:"skypecosi_concore_web_csa_conversation_httprequest",CONVERSATION_TOKEN:"skypecosi_concore_web_csa_conversation_token"},u8={DATA_VERSION:"DataVersion",DIRECTION:"Direction",CONTENT_SHARING_DIRECTION:"ContentSharingDirection",CONNECTED_DURATION_IN_MS:"ConnectedDurationInMsecs",PREHEATED_CALL_SETUP_DURATION_IN_S:"PreheatedCallSetupDurationInSeconds",CALL_CANCELATION_DURATION_IN_S:"CallCancelationDurationInSeconds",IS_PREHEATED:"IsPreheated",TIME_TO_RING_IN_MS:"TimeToRingInMsecs",CALL_TERMINATING_END:"CallTerminatingEnd",NETWORK_REQUESTS_PENDING:"NetworkRequestsPending",NETWORK_REQUESTS_COMPLETED:"NetworkRequestsCompleted",LOCAL_OPERATIONS_PERFORMED:"LocalOperationsPerformed",TROUTER_WAIT_OPERATIONS:"TrouterWaitOperations",CALL_START_TIME:"CallStartTime",CALL_END_TIME:"CallEndTime",IS_GROUP_CALL:"IsGroupCall",IS_HOSTLESS_CALL:"IsHostLessCall",IS_CAST_CALL:"IsCastCall",IS_HUDDLE_GROUP_CALL:"IsHuddleGroupCall",IS_MEETUP_CALL:"IsMeetupCall",IS_ON_BEHALF_OF_CALL:"IsOnBehalfOfCall",IS_SDP_IN_CALL_NOTIFICATION:"SdpInCallNotification",CALL_END_CODE:"Code",CALL_END_SUB_CODE:"SubCode",CALL_PHRASE:"Phrase",CALL_END_RESULT_CATEGORIES:"ResultCategories",CALL_END_CAUSE_ID:"CauseId",CONFLICTING_CALL_ID:"ConflictingCallId",CONTENT_SHARING_END_CODE:"ContentSharingEndReasonServiceCode",CONTENT_SHARING_END_SUB_CODE:"ContentSharingEndReasonServiceSubCode",CONVERSATION_SERVICE_URL:"ConversationServiceUrl",CONTENT_SHARING_SERVICE_URL:"ContentSharingServiceUrl",MEETING_INFO:"MeetingInfo",JOINED_FROM:"JoinedFrom",RESULT_VALUE:"ResultValue",RESULT_DETAIL:"ResultDetail",RESULT_CAUSE_ID:"ResultCauseId",RESULT_CODE:"ResultCode",LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS:"LocalOfferAnswerGenerationTimestamps",SELF_PARTICIPANT_ROLE:"SelfParticipantRole",SCENARIO:"Scenario",CALLER_TYPE:"Caller_Type",CALLEE_TYPE:"Callee_Type",CALL_TYPE:"Call_Type",TEST_CONTEXT_ID:"Test_Context_Id",OUTGOING_MODALITIES:"Outgoing_Modalities",INCOMING_MODALITIES:"Incoming_Modalities",OFFERED_MODALITIES:"CallOfferredModalities",ANSWERED_MODALITIES:"CallAnsweredModalities",VBSS_OPERATIONS:"VBSS_Operations",CHANGING_CORRELATION_ID_NEW_ID:"ChangingCorrelationId_NewId",CHANGING_CORRELATION_ID_OLD_ID:"ChangingCorrelationId_OldId",MESSAGING_CHANNEL:"MessagingChannel",EVENT_TIMESTAMP_BAG:"EventTimestampBag",ROSTER_UPDATES_BAG:"RosterUpdatesBag",NETWORK_REQUESTS_BAG:"NetworkRequestBag",CLIENT_INFORMATION:"ClientInformation",ECS_ETAG:"EcsEtag",APPLICATION_TYPE:"ApplicationType",RING:"Ring",TENANT_ID:"TenantId",USER_HEX_CID:"UserHexCID",ACS_RESOURCE_ID:"AcsResourceId",REGION:"Region",PARTITION:"Partition",CALL_END_CLIENT_SUB_CODE:"CallEventCallEndClientSubCode",CALL_END_CLIENT_PHRASE:"CallEventCallEndClientPhrase",MEETING_CODE:"MeetingCode",MEETING_URL:"MeetingJoinUrl",BROADCAST_MEETING_ROLE:"BroadcastMeetingRole",MEETING_ROLE:"MeetingRole",ADVANCED_MEETING_ROLE:"AdvancedMeetingRole",MEETING_ROLES:"MeetingRoles",PARTICIPANT_TYPE:"ParticipantType",DISPLAY_NAME:"DisplayName",AUDIO_ONLY_WATERMARK:"ClientSupportsAudioOnlyWatermark",CLIENT_SUPPORT_WATERMARK:"ClientSupportsWatermark",TARGET_APPLICATION_TYPE:"TargetApplicationType",IS_REINVITELESS:"IsReinviteless",CLIENT_TYPE:"ClientType",CLIENT_SUPPORTS_PREVENT_SCREEN_CAPTURE:"ClientSupportsPreventScreenCapture"},u9={TROUTER:"Trouter",BROKER:"Broker"},u7="JsCsaConfig",he={BROKER_OUTGOING_ENABLED:"BrokerOutgoingEnabled",BROKER_INCOMING_ENABLED:"BrokerIncomingEnabled",BROKER_REQUEST_BATCHING_ENABLED:"BrokerRequestBatchingEnabled",BROKER_EXCLUSIVELY_ENABLED:"BrokerExclusivelyEnabled",SUPPORTS_COMPRESSED_PAYLOAD:"SupportsCompressedPayload",SYNC_TROUTER_RESPONSE:"SyncTrouterResponse",SERVER_MUTE_UNMUTE:"serverMuteUnmute",HANDLE_OFFER_FROM_NOTIFICATION:"handleMediaOfferFromPushNotification",HANDLE_NEW_OFFER_REQUEST:"handleNewOfferRequest",SEND_PROGRESS_FROM_CC:"sendProgressFromCC",INTERNAL_HTTP_DISPATCHER:"internalHttpDispatcher",ENABLE_TOKEN_CACHE:"enableTokenCache",ENABLE_TOKEN_PREFETCH:"enableTokenPrefetch",REQUEST_HEDGING:"requestHedging",SUPPORT_MEDIA_RETARGET_WHILE_INCOMING_RENEGOTIATION:"supportMediaRetargetWhileIncomingRenegotiation",ENABLE_ERROR_CODE_IMPROVEMENTS_FOR_NETWORK_FAILURES:"enableErrorCodeImprovementsForNetworkFailures",ENABLE_CALL_ESTABLISHMENT_TIMEOUTS_FOR_START_OR_JOIN_CALL:"enableCallEstablishmentTimeoutsForStartJoinCall",ENABLE_TOKEN_CACHE_FOR_GENERIC_TOKEN_API:"enableTokenCacheForGenericTokenAPI",ENABLE_LONG_OUTGOING_1TO1_SETUP:"enableLongOutgoing1To1SetupTimeoutForWeb"},ht={CORRELATION_ID:"CorrelationId",SHARED_CORRELATION_ID:"SharedCorrelationId",SIGNALING_SESSION_ID:"SignalingSessionId",GROUP_ID:"GroupId",THREAD_ID:"ThreadId",TEAMS_MESSAGEID:"TeamsMessageId",TEAMS_MEETINGINFO:"TeamsMeetingInfo",ENDPOINT_ID:"EndpointId",PARTICIPANT_ID:"ParticipantId",DATA_VERSION:"DataVersion",CONTENT_SHARING_ID:"ContentSharingSessionId",CONTENT_SHARING_CORRELATION_ID:"ContentSharingCorrelationId"},hi={LOCAL:"Local",REMOTE:"Remote"},hn={SUCCESS:"Success",FAILURE:"Failure"},hr={INCOMING:"Incoming",OUTGOING:"Outgoing"},hs={CALLER:"caller",CALLEE:"callee",JOIN:"join",JOIN_FOR_ROSTER_ONLY:"joinForRosterOnly",PREHEAT:"preheat"},ha={START:"Start",STOP:"Stop",REJECTED:"Rejected",REMOTE_START:"RemoteStart",TIMEOUT:"Timeout",CALL_END:"CallEnd"},ho={STARTED:"Started",ENDED:"Ended",FAILED:"Failed"},hl={TOKEN_TELEMETRY:"TokenTelemetry"};function hc(e){let t=!0,i="enabled",n=!1,r=!1,s=!0,a=!0,o=!0,l=!1,c=!1,d=!0,u=!0,h=!0,g=!0,p=!0,f=!1,m=!1,v=!1,S=!1,y=!1,C=!0,b=!0,T=!0,E=3,_=4e3,I=!1,w=!1,P=!1,R=!1,A=!1,M=!0,D={conversationKeepAliveTimeoutSec:2700,promotionUnmuteTimeoutSec:1e4,addParticipantTimeoutSec:130,removeParticipantTimeoutSec:60,incomingCallEstablishmentTimeoutSec:75,outgoingCallEstablishmentTimeoutSec:90,longerOutgoingCallEstablishmentTimeoutSec:185,mediaAnswerTimeoutSec:35,mediaAnswerAcknowledgementTimeoutSec:15,addModalityTimeoutSec:65,unmuteTimeoutSec:35,admitParticipantTimeoutSec:210,admitTimeoutSec:60,updateMeetingRoleTimeoutSec:15,nudgeParticipantTimeoutSec:60,callMeBackTimeoutSec:120,maxPreaheatedTimeoutSec:90,parkCompletionTimeoutSec:45,unparkCompletionTimeoutSec:45,updateMeetingLiveStateCompletionTimeoutSec:45,updateMeetingGroupsCompletionTimeoutSec:45,setMeetingLayoutCompletionTimeoutSec:45,updateParticipantInterpretationStateCompletionTimeoutSec:45,updateParticipantsPropertiesCompletionTimeoutSec:45,joinMeetingGroupCompletionTimeoutSec:45,leaveMeetingGroupCompletionTimeoutSec:45,tokenRequiredTimeoutSec:20,sendMessageCompletionTimeoutSec:15,disablePreheatTimeoutSec:45,updateMeetingStatesCompletionTimeoutSec:45,updateMonitorSessionCompletionTimeoutSec:45},O=!1,k=!1,N=!1,x=!1,L=3600,F=86400,U=30,$=!1,V=!0,B=!0,H=60,j="https://calling.teams.microsoft.com",q=!0,W=!1,G=!1,z=!1,J=!1,K=!1,Q=!1,Y=!1,Z=!1,X=0,ee=0,et=!1,ei=!1,en=!1,er=!1,es=!0,ea=!1,eo=!1,el=!1,ec=!1,ed=!1;e.cloudScreenSharingFlag="disabled"===e.cloudScreenSharingFlag?e.cloudScreenSharingFlag:i,e.isWebRtcEnabled="undefined"==typeof RTCIceGatherer,e.shouldServiceSendNGCUpgradeMessages=hd(e.shouldServiceSendNGCUpgradeMessages,s),e.isGVCOutgoingEnabled=hd(e.isGVCOutgoingEnabled,t),e.supportsCompressedServicePayload=hd(e.supportsCompressedServicePayload,a),e.supportsSynchronousTrouterResponse=hd(e.supportsSynchronousTrouterResponse,o),e.supportsHostlessGroupCalls=hd(e.supportsHostlessGroupCalls,d),e.doHostlessCalling=hd(e.doHostlessCalling,n),e.brokerExclusively=hd(e.brokerExclusively,f),e.brokerEnabledOutgoing=hd(e.brokerEnabledOutgoing,h),e.brokerEnabledIncoming=hd(e.brokerEnabledIncoming,g),e.brokerRequestBatching=hd(e.brokerRequestBatching,p),e.handleMediaOfferFromPushNotification=hd(e.handleMediaOfferFromPushNotification,C),e.handleNewOfferRequest=hd(e.handleNewOfferRequest,m),e.autoJoinOnConflict=hd(e.autoJoinOnConflict,u),e.endConflictedCall=hd(e.endConflictedCall,l),e.autoResolveConflictedCall=hd(e.autoResolveConflictedCall,c),e.shouldServiceSendCallEventMessages=hd(e.shouldServiceSendCallEventMessages,r),e.forceTrouterReconnectOnNetworkOnline=hd(e.forceTrouterReconnectOnNetworkOnline,b),e.attemptHttpRequestWithCachedSkypetoken=hd(e.attemptHttpRequestWithCachedSkypetoken,T),e.useInternalHttpDispatcher=hd(e.useInternalHttpDispatcher,v),e.enableTokenCache=hd(e.enableTokenCache,S),e.enableTokenPrefetch=hd(e.enableTokenPrefetch,y),e.hedgeDelayMs=hd(e.hedgeDelayMs,_),e.hedgeMaxParallelAttempts=hd(e.hedgeMaxParallelAttempts,E),e.useInternalHttpDispatcher&&(e.httpRequestDispatcher=new tW(e.logger)),e.enableQuickSendAcceptanceAck=hd(e.enableQuickSendAcceptanceAck,I),e.supportMediaRetargetWhileIncomingRenegotiation=hd(e.supportMediaRetargetWhileIncomingRenegotiation,w),e.callingServiceSupportsAADTokens=hd(e.callingServiceSupportsAADTokens,O),e.callingServiceSupportsCAETokens=hd(e.callingServiceSupportsCAETokens,k),e.aadTokenExpirationTimeInSeconds=hd(e.aadTokenExpirationTimeInSeconds,L),e.caeTokenExpirationTimeInSeconds=hd(e.caeTokenExpirationTimeInSeconds,F),e.disableTokenMigrationHeader=hd(e.disableTokenMigrationHeader,N),e.enablePublishTokenTelemetry=hd(e.enablePublishTokenTelemetry,x),e.forceClearExpiredTokens=hd(e.forceClearExpiredTokens,$),e.enableRefreshToken=hd(e.enableRefreshToken,V),e.refreshTimeBeforeTokenTimeoutInSeconds=hd(e.refreshTimeBeforeTokenTimeoutInSeconds,U),e.enableCallEstablishmentTimeoutsForStartJoinCall=hd(e.enableCallEstablishmentTimeoutsForStartJoinCall,P),e.csaTimeoutConfiguration=hu(e.csaTimeoutConfiguration,D),e.reportPreviousErrorsForTimeout=hd(e.reportPreviousErrorsForTimeout,z),e.callingTokenLogicalUrl=hd(e.callingTokenLogicalUrl,j),e.enableAsyncDisablePreheat=hd(e.enableAsyncDisablePreheat,J),e.enablePreheatInStreamingMode=hd(e.enablePreheatInStreamingMode,K),e.skipOfferGenerationForStreamingUser=hd(e.skipOfferGenerationForStreamingUser,Q),e.forceLowercaseHttpHeaders=hd(e.forceLowercaseHttpHeaders,Y),e.enableResolveScreenSharingWhenNegotiationComplete=hd(e.enableResolveScreenSharingWhenNegotiationComplete,Z),e.maxReinvitelessMediaForVideoForWeb=hd(e.maxReinvitelessMediaForVideoForWeb,X),e.maxReinvitelessMediaForVBSSForWeb=hd(e.maxReinvitelessMediaForVBSSForWeb,ee),e.enableRefreshTokenRetry=hd(e.enableRefreshTokenRetry,B),e.enableRefreshTokenRetryInSeconds=hd(e.enableRefreshTokenRetryInSeconds,H),e.enableConversationTypeUpdateOnCallEnd=hd(e.enableConversationTypeUpdateOnCallEnd,A),e.supportMissingTokenTypesInResponse=hd(e.supportMissingTokenTypesInResponse,q),e.useSkypeTokenWhenNoAuthenticateHeader=hd(e.useSkypeTokenWhenNoAuthenticateHeader,W),e.enableAutoPromotion=hd(e.enableAutoPromotion,et),e.enableBatchedSendMessageStatus=hd(e.enableBatchedSendMessageStatus,en),e.enableBatchedReceiveMessage=hd(e.enableBatchedReceiveMessage,ei),e.enableAddParticipantEnhancements=hd(e.enableAddParticipantEnhancements,er),e.enableTokenCacheForGenericTokenAPI=hd(e.enableTokenCacheForGenericTokenAPI,G),e.disableRealTimeModeFromRoster=hd(e.disableRealTimeModeFromRoster,es),e.enableLongOutgoing1To1SetupTimeoutForWeb=hd(e.enableLongOutgoing1To1SetupTimeoutForWeb,R),e.checkAttendeeRoleInCreateContentSharing=hd(e.checkAttendeeRoleInCreateContentSharing,M),e.enableSpecificErrorCodesForCallEnd=hd(e.enableSpecificErrorCodesForCallEnd,ea),e.enableSplitConversationEndUrl=hd(e.enableSplitConversationEndUrl,eo),e.enableFetchRequestWithKeepAlive=hd(e.enableFetchRequestWithKeepAlive,el),e.enableFetchApiForBeacon=hd(e.enableFetchApiForBeacon,ec),e.nullifyAuthTokenManagerOnReset=hd(e.nullifyAuthTokenManagerOnReset,ed)}function hd(e,t){return null==e?t:e}function hu(e,t){return(t||e)&&{...t,...e}}var hh=class{constructor(){this.skypeTokenContext={},this.aadTokenContext={},this.caeTokenContext={}}getTokenContext(e){return 4===e?this.aadTokenContext:8===e?this.caeTokenContext:1===e?this.skypeTokenContext:void 0}getTokenExpiry(e,t){return 4===e?this.aadTokenContext?.expiryTime:8===e?this.caeTokenContext?.expiryTime:1===e?this.skypeTokenContext?.expiryTime:(t?.info("[getTokenExpiry] unrecognized token type, return Number.MAX_VALUE"),Number.MAX_VALUE)}getToken(e,t,i,n){return 8&e&&this.caeTokenContext?.token&&this.caeTokenContext.token!==n?{token:this.caeTokenContext.token,tokenType:8}:4&e&&this.aadTokenContext?.token&&this.aadTokenContext.token!==n?{token:this.aadTokenContext.token,tokenType:4}:1&e&&this.skypeTokenContext?.token&&this.skypeTokenContext.token!==n?{token:this.skypeTokenContext.token,tokenType:1}:(i?.info(`[getToken] no cached token found of token type: ${e}`),null)}setToken(e,t,i,n){switch(e){case 4:this.aadTokenContext.factorsJson=i,this.aadTokenContext.tokenType=e,this.aadTokenContext.token=t,this.aadTokenContext.expiryTime=n;break;case 1:this.skypeTokenContext.factorsJson=i,this.skypeTokenContext.tokenType=e,this.skypeTokenContext.token=t,this.skypeTokenContext.expiryTime=n;break;case 8:this.caeTokenContext.factorsJson=i,this.caeTokenContext.tokenType=e,this.caeTokenContext.token=t,this.caeTokenContext.expiryTime=n;break;default:throw Error(`Invalid tokenType ${e}`)}}clearExpiredTokens(e){let t=Math.round(Date.now()/1e3);this.caeTokenContext?.expiryTime<=t&&(this.resetToken(8),e?.info("[cacheTokenManager] reset expired cae token")),this.aadTokenContext?.expiryTime<=t&&(this.resetToken(4),e?.info("[cacheTokenManager] reset expired aad token")),this.skypeTokenContext?.expiryTime<=t&&(this.resetToken(1),e?.info("[cacheTokenManager] reset expired skype token"))}resetToken(e){8===e?this.caeTokenContext={}:4===e?this.aadTokenContext={}:1===e&&(this.skypeTokenContext={})}},hg=class{constructor(e){this.timers={},this.startTimer=(e,t,i,n)=>{this.logger.info(`startTimer called for :  ${e} with timeoutInSeconds : ${i}s`);let r=window.setTimeout(t,1e3*i),s=n?`${e}${n}`:e;this.timers[s]=r},this.stopTimer=(e,t)=>{this.logger.info(`stopTimer called for : ${e}`);let i=t?`${e}${t}`:e;this.timers.hasOwnProperty(i)&&(clearTimeout(this.timers[i]),delete this.timers[i])},this.dispose=()=>{this.logger.info("timeoutManager :: dispose"),Object.keys(this.timers).forEach(e=>{this.stopTimer(e)})},this.logger=e}},hp=class extends hg{constructor(e){super(e)}updateTimeoutValues(e){this.timeoutValues={...this.timeoutValues,...e}}getTimeoutValue(e){return this.timeoutValues[e]}},hf=3600,hm=class{constructor(e,t,i,n,r){this.tokenProvider=t,this.tokenCachingEnabled=!1,this.enableTokenCacheForGenericTokenAPI=!1,this.cachedToken="",this.lastTokenType=1,this.lastToken="",this.clientSupportsGenericTokenAPI=!1,this.stopTimerFlag=!1,this.tokensPromiseMap={},this.logger=e.createChild("TokenManager"),n&&this.updateTokenSettings(n),this.cacheTimers=new hp(e),this.cacheTimers.updateTimeoutValues(i),this.cacheTokenManager=new hh,this.telemetryManager=r,this.nextRefreshTimePointInSeconds=Number.MAX_VALUE}deletePromisesByTriggeredByRefresh(e,t){if(this.tokensPromiseMap[e]){let i=this.tokensPromiseMap[e];for(let n=i.length-1;n>=0;n--)i[n]?.tokenRequestOptions.triggeredByRefresh===t&&this.tokensPromiseMap[e].splice(n,1)}}startTokenRefreshTimer(e){let t="startTokenRefreshTimer";if(!this.enableRefreshToken)return void this.logger.info("[startTokenRefreshTimer] token refresh is disabled");if(this.stopTimerFlag){this.logger.info("[startTokenRefreshTimer] stopTimerFlag=true so cancel timer"),this.cacheTimers.dispose();return}this.logger.info(`[startTokenRefreshTimer] starting token refresh timer timeToStartInMilliseconds=${e}`);let i=sJ(),n=sK(e),r=i+n;this.nextRefreshTimePointInSeconds===Number.MAX_VALUE||this.nextRefreshTimePointInSeconds<i||r<this.nextRefreshTimePointInSeconds?(this.logger.info("[startTokenRefreshTimer] cancelling current refresh timer to create new one with shorter time"),this.cacheTimers.stopTimer(t),this.nextRefreshTimePointInSeconds=r,this.logger.info(`[startTokenRefreshTimer] start new timer with timeout=${n} at time=${i}`),this.cacheTimers.startTimer(t,()=>{this.nextRefreshTimePointInSeconds=Number.MAX_VALUE,this.refreshToken()},n)):this.logger.info("[startTokenRefreshTimer] no need to set a new refresh timer")}async refreshTokenWithContext(e){let t,i,n,r={};r.triggeredByRefresh=!0;let s=sm(),a={causeId:s},o=Date.now(),l=2;this.logger.info(`[${s}][refreshTokenWithContext] refreshing token tokenType=${e.tokenType} factorsJson=${e.factorsJson}`);let c=null;try{let i=this.onTokenRequired({factorsJson:e.factorsJson,tokenType:e.tokenType,requestMetadataJson:a,invalidToken:void 0,isUnauthorized:void 0,triggeredByRefresh:!0}),r=await this.timeoutPromiseRace(i,this.enableRefreshTokenRetryInSeconds,"ActiveRefresh Token Timeout");t=Date.now(),n=r?.causeId,c=r?.tokenType,this.lastTokenType=c,this.lastToken=r.token,l=1,this.logger.info(`[${s}][refreshTokenWithContext] refresh token success for factorsJson ${e.factorsJson} and tokenType ${e.tokenType}`)}catch(r){i=r,n=i?.causeId,r?.timeOut?(this.logger.info(`[${s}][refreshTokenWithContext] refresh token timeout, UI did not respond with token in time ${t_(r)}`),l=5):(this.logger.info(`[${s}][refreshTokenWithContext] failed to refresh token, UI did not respond with token ${t_(r)}`),l=2),t=Date.now(),this.deletePromisesByTriggeredByRefresh(e.factorsJson,!0)}finally{r&&(r.requestCauseId=s,r.responseCauseId=n,r.supportTokenApi=this.clientSupportsGenericTokenAPI,r.requestTokenFactors=e.factorsJson,r.tokenRequestTime=o,r.tokenResponseTime=t,r.tokenRequestStatus=l,r.requestTokenType=e.tokenType,r.foundInCache=!1,r.responseTokenType=c,r.errorCode=i?.errorCode,r.errorSubCode=i?.errorSubCode,this.sendTokenTelemetry(r))}}refreshToken(){if(!this.clientSupportsGenericTokenAPI)return void this.logger.info("[refreshToken] refresh token is not supported due to new Token Api is not enabled");if(!this.enableTokenCacheForGenericTokenAPI)return void this.logger.info("[refreshToken] refresh token is not supported due to caching being disabled");let e=this.cacheTokenManager.getTokenContext(4),t=this.cacheTokenManager.getTokenContext(8),i=this.cacheTokenManager.getTokenContext(1);if(!e&&!t&&!i)return void this.logger.info("[refreshToken] no cached tokens available to refresh");let n=sJ()+this.refreshTimeBeforeTokenTimeoutInSeconds,r=Number.MAX_VALUE,s=!1;if(e)if(e.expiryTime>n){let t=e?.expiryTime-n;t<r&&(r=t)}else e.expiryTime<=n&&(this.refreshTokenWithContext(e),s=!0);if(t)if(t.expiryTime>n){let e=t?.expiryTime-n;e<r&&(r=e)}else t.expiryTime<=n&&(this.refreshTokenWithContext(t),s=!0);if(i)if(i.expiryTime>n){let e=i?.expiryTime-n;e<r&&(r=e)}else i.expiryTime<=n&&(this.refreshTokenWithContext(i),s=!0);s&&this.enableRefreshTokenRetry&&this.enableRefreshTokenRetryInSeconds>0&&this.enableRefreshTokenRetryInSeconds<r&&(r=this.enableRefreshTokenRetryInSeconds),r>=0&&r!==Number.MAX_VALUE&&this.startTokenRefreshTimer(sQ(r))}async getTokenWithTokenType(e,t=!1,i,n){let r,s,a;this.logger.info(`[${e}][getTokenWithTokenType] call with factorJson=${i?.factorsJson} and request tokenType ${i?.tokenType}`);let{factorsJson:o,requestMetadataJson:l,invalidToken:c,isUnauthorized:d}=i||{},u=Date.now(),h=i?.tokenType,g=2,p=null;this.clearExpiredTokens(),this.startTokenRefreshTimer(1);try{if(t)this.invalidateCachedTokenWithTokenType(h,c,o);else if(this.enableTokenCacheForGenericTokenAPI){let t=this.cacheTokenManager.getToken(h,o,this.logger,c);if(t?.token)return this.logger.info(`[${e}][getTokenWithTokenType] returning cached token for factorsJson ${o} and request tokenType ${h}, response tokenType ${t.tokenType}`),g=3,r=Date.now(),p=t.tokenType,this.lastToken=t.token,this.lastTokenType=p,t}this.logger.info(`[${e}][getTokenWithTokenType] fetching new token for factorsJson ${o} and tokenType ${h}`);let i=l||{};i.causeId=e;let n=this.onTokenRequired({factorsJson:o,tokenType:h,requestMetadataJson:i,invalidToken:c,isUnauthorized:d,triggeredByRefresh:!1}),s=await this.timeoutPromiseRace(n,this.cacheTimers.getTimeoutValue("tokenRequiredTimeoutSec"),"Token not received from UI in time");return r=Date.now(),a=s?.causeId,p=s?.tokenType,this.lastToken=s?.token,this.lastTokenType=p,g=1,this.logger.info(`[${e}][getTokenWithTokenType] fetching new token success for factorsJson ${o} and tokenType ${h}`),s}catch(t){throw this.logger.info(`[${e}][getTokenWithTokenType] failed to fetch token ${t_(t)}`),s=t,a=s?.causeId,s.timeOut&&(g=4),this.deletePromisesByTriggeredByRefresh(o,!1),t}finally{let t=!n?.tokenTelemetryData,o=t?{}:n?.tokenTelemetryData;o&&(o.requestCauseId=e,o.responseCauseId=a,o.supportTokenApi=this.clientSupportsGenericTokenAPI,o.requestTokenFactors=i?.factorsJson,o.tokenRequestTime=u,o.tokenResponseTime=r,o.tokenRequestStatus=g,o.requestTokenType=i?.tokenType,o.foundInCache=3===g,o.responseTokenType=p,o.timeToResponse=r?r-u:r,o.errorCode=s?.errorCode,o.errorSubCode=s?.errorSubCode),n&&(!t||n.signalingSession)||(this.logger?.info("[getTokenWithTokenType] TokenContext is not provided, sending token telemetry to Token table"),this.sendTokenTelemetry(o))}}async onTokenRequired(e){let{factorsJson:t,tokenType:i,requestMetadataJson:n,invalidToken:r,isUnauthorized:s,triggeredByRefresh:a}=e;if(this.logger.info(`[onTokenRequired] factorsJson=${t} tokenType=${i}`),!i)return this.logger.info(`[onTokenRequired] factorsJson=${t} with no token type`),Promise.reject({errorCode:sr.HTTP_STATUS_CODES.UNAUTHORIZED,errorSubCode:0,causeId:n?.causeId});if(this.tokensPromiseMap[t]&&!a){for(let e of this.tokensPromiseMap[t])if(e.tokenRequestOptions.tokenType===i)return this.logger.info(`[onTokenRequired] factorsJson=${t} and tokenType ${i} has pending request`),e.defered.promise}this.tokensPromiseMap[t]||(this.tokensPromiseMap[t]=[]);let o=new iE;return this.tokensPromiseMap[t].push({tokenRequestOptions:e,defered:o}),this.tokenCallback({factorsJson:t,tokenType:i,requestMetadataJson:n,invalidToken:r,isUnauthorized:s}),o.promise}setTokenCaching(e,t){this.tokenCachingEnabled!==e&&(this.logger.info(`[authTokenManager]setTokenCaching=${e}`),this.tokenCachingEnabled=e)}setTokenCachingForGenericTokenAPI(e,t){this.enableTokenCacheForGenericTokenAPI!==e&&(this.logger.info(`[authTokenManager]setTokenCachingForGenericTokenAPI=${e}`),this.enableTokenCacheForGenericTokenAPI=e)}calculateTokenExpiry(e,t,i){let{factorsJson:n,tokenType:r}=t,s=i-sJ(),a=s,o=i;if(s&&s>0&&s>this.refreshTimeBeforeTokenTimeoutInSeconds){switch(r){case 4:s>this.aadTokenExpirationTimeInSeconds&&(s=this.aadTokenExpirationTimeInSeconds);break;case 8:s>this.caeTokenExpirationTimeInSeconds&&(s=this.caeTokenExpirationTimeInSeconds);break;default:s>hf&&(s=hf)}o=(a=s-this.refreshTimeBeforeTokenTimeoutInSeconds)+sJ()}return this.logger.info(`[${e}][calculateTokenExpiry] calculate expiry to ${o} tokenType=${r} factorsJson=${n}`),o}addToCache(e,t,i,n){this.clearExpiredTokens(),this.cacheTokenManager.setToken(e,t,i,n)}clearExpiredTokens(){this.forceClearExpiredTokens&&this.cacheTokenManager.clearExpiredTokens(this.logger)}async getToken(e,t=!1,i,n){let r,s;if(this.clientSupportsGenericTokenAPI){this.logger.info(`[${e}][getToken] callingTokenAPI is enabled so using new API to fetch it`);let{token:r}=await this.getTokenWithTokenType(e,t,i,n);return r}let a=Date.now(),o=2;try{if(t&&this.invalidateCachedToken(e),this.cachedToken&&this.tokenCachingEnabled)return this.logger.info(`[${e}][getToken] returning cached token`),o=3,this.lastTokenType=1,Promise.resolve(this.cachedToken);this.logger.info(`[${e}][getToken] fetching new token`);let i=await this.tokenProvider();if(r=Date.now(),!i)return this.logger.info(`[${e}][getToken] received empty token`),Promise.reject("Received empty token");return this.tokenCachingEnabled&&(this.cachedToken=i),o=1,this.lastToken=i,this.lastTokenType=1,this.logger.info(`[${e}][getToken] fetching new token success`),i}catch(t){throw this.logger.info(`[${e}][getToken] failed to fetch token=${t_(t)}`),s=t,this.cachedToken="",t}finally{let t=n?.tokenTelemetryData;t&&(t.requestCauseId=e,t.supportTokenApi=this.clientSupportsGenericTokenAPI,t.requestTokenFactors=i?.factorsJson,t.tokenRequestTime=a,t.tokenResponseTime=r,t.tokenRequestStatus=o,t.requestTokenType=i?.tokenType,t.foundInCache=3===o,t.responseTokenType=this.lastTokenType,t.timeToResponse=r?r-a:r,t.errorCode=s?.errorCode,t.errorSubCode=s?.errorSubCode)}}invalidateCachedToken(e){this.cachedToken&&(this.logger.info(`[${e}][invalidateCachedToken]`),this.cachedToken="")}invalidateCachedTokenWithTokenType(e,t,i){8===e&&this.cacheTokenManager.getToken(8,i,this.logger)?.token===t&&(this.cacheTimers.stopTimer(i,e.toString()),this.cacheTokenManager.resetToken(8)),4===e&&this.cacheTokenManager.getToken(4,i,this.logger)?.token===t&&(this.cacheTimers.stopTimer(i,e.toString()),this.cacheTokenManager.resetToken(4)),1===e&&this.cacheTokenManager.getToken(1,i,this.logger)?.token===t&&(this.cacheTimers.stopTimer(i,e.toString()),this.cacheTokenManager.resetToken(1))}getLastToken(e){return this.logger.info(`[${e}][getLastToken]`),this.lastToken}async timeoutPromiseRace(e,t,i){let n,r=new Promise((e,r)=>{n=window.setTimeout(()=>{r({phrase:i,timeOut:!0})},sQ(t))});return Promise.race([e.then(e=>(clearTimeout(n),e)),r])}getLastTokenType(e){return this.logger.info(`[${e}][getLastTokenType] lastTokenType=${this.lastTokenType}`),this.lastTokenType}updateTokenSettings(e){let{clientSupportsGenericTokenAPI:t,aadTokenExpirationTimeInSeconds:i,caeTokenExpirationTimeInSeconds:n,refreshTimeBeforeTokenTimeoutInSeconds:r,enablePublishTokenTelemetry:s,enableRefreshToken:a,forceClearExpiredTokens:o,enableRefreshTokenRetry:l,enableRefreshTokenRetryInSeconds:c}=e;this.logger.info(`updateTokenSettings ${JSON.stringify(e)}`),this.clientSupportsGenericTokenAPI=t??this.clientSupportsGenericTokenAPI,this.aadTokenExpirationTimeInSeconds=i??this.aadTokenExpirationTimeInSeconds,this.caeTokenExpirationTimeInSeconds=n??this.caeTokenExpirationTimeInSeconds,this.refreshTimeBeforeTokenTimeoutInSeconds=r??this.refreshTimeBeforeTokenTimeoutInSeconds,this.enablePublishTokenTelemetry=s??this.enablePublishTokenTelemetry,this.forceClearExpiredTokens=o??this.forceClearExpiredTokens,this.enableRefreshToken=a??this.enableRefreshToken,this.enableRefreshTokenRetry=l??this.enableRefreshTokenRetry,this.enableRefreshTokenRetryInSeconds=c??this.enableRefreshTokenRetryInSeconds}updateToken(e,t,i,n,r){if(this.logger.info(`[${n}][updateToken] UI replies with a token with factorsJson=${e} updateMetadata=${JSON.stringify(t)} tokenExpirySecSinceEpoch?=${r}`),t.error){for(let i of(this.logger.info(`[${n}][updateToken] UI replies with error ${t.error} for factorsJson ${e}`),this.tokensPromiseMap[e]))i.tokenRequestOptions.requestMetadataJson.causeId===n&&i.defered.reject({phrase:t.error?.phrase,errorCode:t.error?.code,errorSubCode:t.error?.subCode,causeId:n});return}if(!i){for(let t of(this.logger.info(`[${n}][updateToken] received empty token`),this.tokensPromiseMap[e]))t.tokenRequestOptions.requestMetadataJson.causeId===n&&t.defered.reject({phrase:"Received empty token",causeId:n});return}if(r>sJ()&&this.enableTokenCacheForGenericTokenAPI){this.logger.info(`[${n}][updateToken] caching Token with tokenType=${t.tokenType}`);let s={factorsJson:e,tokenType:t.tokenType,invalidToken:i};this.addToCache(t.tokenType,i,e,this.calculateTokenExpiry(n,s,r))}if(!this.tokensPromiseMap[e]){this.logger.warn(`[updateToken]: UI tries to update token with invalid factorsJson=${e}`);let i={responseCauseId:n,supportTokenApi:this.clientSupportsGenericTokenAPI,requestTokenFactors:e,tokenResponseTime:Date.now(),tokenRequestStatus:6,responseTokenType:t.tokenType};this.sendTokenTelemetry(i);return}if(this.tokensPromiseMap[e]){let r=this.tokensPromiseMap[e];for(let s=r.length-1;s>=0;s--)(r[s]?.tokenRequestOptions.tokenType&t.tokenType)>0&&(r[s].defered.resolve({token:i,tokenType:t.tokenType,causeId:n}),this.tokensPromiseMap[e].splice(s,1))}if(this.logger.info(`[${n}][updateToken] resolved and upateToken with factorsJson=${e} tokenType=${t.tokenType}`),0===this.tokensPromiseMap[e].length&&delete this.tokensPromiseMap[e],4!==t.tokenType&&8!==t.tokenType&&1!==t.tokenType)return;if(Object.keys(this.tokensPromiseMap).length>0)for(let r of Object.values(this.tokensPromiseMap))for(let s=r.length-1;s>=0;s--){let a=r[s];a.tokenRequestOptions.factorsJson!==e&&(a.tokenRequestOptions.tokenType&t.tokenType)>0&&!a.tokenRequestOptions.isUnauthorized&&(a.defered.resolve({token:i,tokenType:t.tokenType,causeId:n}),r.splice(s,1))}for(let e of Object.keys(this.tokensPromiseMap))0===this.tokensPromiseMap[e].length&&delete this.tokensPromiseMap[e];let s=r-sJ();this.startTokenRefreshTimer(s>=0?sQ(s):0)}setTokenRequiredCallBack(e){this.tokenCallback=e}setDisableTimerFlag(e){this.logger.info(`[setDisableTimerFlag] set disableTimerFlag to ${e}`),this.stopTimerFlag=e}sendTokenTelemetry(e){if(!this.enablePublishTokenTelemetry)return;let t={};t[hl.TOKEN_TELEMETRY]=JSON.stringify(e),this.telemetryManager?(this.logger.info("[sendTokenTelemetry] sending token telemetry:",t),this.telemetryManager.sendEvent(u6.CONVERSATION_TOKEN,t)):this.logger.warn("[sendTokenTelemetry] telemetryManager is undefined, cannot send token telemetry")}dispose(){this.cacheTimers&&this.cacheTimers.dispose()}},hv=(e,t,i,n,r)=>new hm(e,t,i,n,r),hS=class{constructor(e){this.piiScrubber=this.getPiiScrubber(e)}scrubParticipantsList(e){let t=[];return Array.isArray(e)&&e.forEach(e=>t.push(this.scrubMriOrOmit(e))),t}scrubMriOrOmit(e){return"string"==typeof e?this.piiScrubber.mri(e):this.piiScrubber.omit(e)}getPiiScrubber(e){return e&&"function"==typeof e.omit&&"function"==typeof e.mri?e:{omit:()=>"<pii:omit/>",mri:()=>"<pii:mri/>"}}},hy=eR(i(892891));function hC(e){switch(e){case 0:return"main-audio";case 1:return"main-video";case 2:return"applicationsharing-video";case 3:return"data"}throw Error("Invalid media type")}function hb(e){switch(e){case"audio":return 0;case"video":return 1;case"applicationsharing-video":case"xapplicationsharing-video":return 2;case"data":return 3;default:return}}function hT(e,t){return e.endpoints?.endpointDetails?.some(e=>e.participantId===t)??!1}function hE(e,t){return e.endpoints?.endpointDetails.find(e=>e.participantId===t)}function h_(e,t){return e.participants.find(e=>hT(e,t))}function hI(e){return!!e?.meetingGroupDetails?.groups&&Object.keys(e.meetingGroupDetails.groups).some(e=>"stagingGroup"===e)}function hw(e,t){let i=-1;try{if(e.endpoints)i:for(let n of e.endpoints.endpointDetails)if(n?.mediaStreams!==void 0){for(let e of n.mediaStreams)if(hb(e.type)===t){i=e.sourceId;break i}}else i=a_}catch(e){return -1}return i}function hP(e,t,i){if(!e?.endpoints)return -1;let n=e.endpoints.endpointDetails.find(e=>e?.participantId===t);if(!n?.mediaStreams)return hw(e,i);let r=n.mediaStreams.find(({type:e})=>hb(e)===i);return r?r.sourceId:-1}function hR(e,t,i){try{if(!e.endpoints)return;for(let n of e.endpoints.endpointDetails)if(n?.mediaStreams){for(let e of n.mediaStreams)if(i===e.sourceId&&hb(e.type)===t)return n.participantId??null}return}catch(e){return}}function hA(e){return"sendonly"===e.direction&&"applicationsharing-video"===e.label}function hM(e){if(e.endpoints?.endpointDetails)return 1===e.endpoints.endpointDetails.length?e.endpoints.endpointDetails[0].participantId:e.endpoints.endpointDetails.find(e=>e?.mediaStreams?.some(hA))?.participantId}function hD(e,t){return e.endpoints?.endpointDetails?.find(e=>e.mediaStreams?.find(e=>e.sourceId===t))}function hO(e){let t={};if(e.stateId)t.result=e.stateId;else if(e.results){let{results:i}=e;1===i.length&&i[0].stateId&&(t.result=i[0].stateId);let n={};e.results.forEach(e=>{let{result:i}=e,r=hk(e);(void 0===t.code||i.code>t.code)&&(t.code=i.code,t.subCode=i.subCode),n[r]=e}),t.result=JSON.stringify(n)}else e.result&&(t={code:e.result.code,phrase:e.result.phrase,subCode:e.result.subCode,resultCategories:e.result.resultCategories},e.additionalDetail&&(t.result=e.additionalDetail));return t}function hk(e){return e.participantId||e.participant&&e.participant.id}var hN=class{constructor(e,t){this.broadcastContext=null,this.broadcastControllerUrl="",this.broadcastCallbackUrl="",this.broadcastState=null,this.setContext=(e=null)=>{this.logger.info("BroadcastSession :: set broadcast context",e),this.broadcastContext=e},this.getContext=()=>(this.logger.info("BroadcastSession :: get broadcast context",this.broadcastContext||null),this.broadcastContext||null),this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(()=>"[Broadcast]")}handleBroadcastStateChanged(e){let t=e.body;this.broadcastState=t;let i=sk(e);this.signalingSession.telemetryHelper.recordIncomingEvent(c7,e),this.logger.info(`[${i}] broadcast state changed=${this.broadcastState}`),this.updateBroadcastMetadata(i)}updateBroadcastCallbackUrl(e){let t=so(this.signalingSession,rG.CONV_BROADCAST_UPDATE);this.broadcastCallbackUrl!==t&&(this.broadcastCallbackUrl=t,this.logger.info(`[${e}] broadcast callback url changed=${this.broadcastCallbackUrl}`),this.updateBroadcastMetadata(e))}handleBroadcastDetailsChanged(e,t){this.signalingSession.telemetryHelper.recordEvent(c_,{causeId:t}),e.activeModalities&&e.activeModalities.broadcast&&e.activeModalities.broadcast.controller!==this.broadcastControllerUrl&&(this.broadcastControllerUrl=e.activeModalities.broadcast.controller,this.broadcastAdditionalData=e.activeModalities.broadcast,this.logger.info(`[${t}] broadcast controller changed=${this.broadcastControllerUrl}`),this.signalingSessionCallback.onBroadcastMeetingConnected(sr.SUCCESS_TRANSACTION_END,t),this.updateBroadcastMetadata(t)),!this.broadcastControllerUrl||e.activeModalities&&e.activeModalities.broadcast||(this.broadcastControllerUrl="",this.broadcastContext=null,this.logger.info(`[${t}] broadcast controller changed=${this.broadcastControllerUrl}`),this.updateBroadcastMetadata(t),this.signalingSessionCallback.onBroadcastMeetingEnded(sr.SUCCESS_TRANSACTION_END,t))}handleAddBroadcastModalitySuccess(e,t){this.logger.info(`[${t}][handleAddBroadcastModalitySuccess]`)}handleAddBroadcastModalityFailure(e,t){this.logger.info(`[${t}][handleAddBroadcastModalityFailure]`);let i={...e.modalityFailure.broadcast};this.signalingSessionCallback.onBroadcastMeetingEnded(i,t)}updateBroadcastMetadata(e){let t={broadcastControllerUrl:this.broadcastControllerUrl,broadcastStateCallbackUrl:this.broadcastCallbackUrl,broadcastState:this.broadcastState,broadcastAdditionalData:this.broadcastAdditionalData};this.logger.info(`[${e}] update broadcast metadata=${t}`),this.signalingSessionCallback.onBroadcastMeetingUpdated&&this.signalingSessionCallback.onBroadcastMeetingUpdated(t,e)}},hx="http://broker.invalid/",hL=30,hF=5,hU=1,h$=class{constructor(e){this._signalingSession=e,this.baseUrl=hx,this.currentSubscriptionUrl=null,this._currentSubscriptionTimeoutInSec=hL,this._subscribers=[],this._disposed=!1,this._reportedResultCount=0,this._subscriptionRetryBackoffInSec=hF,this._notifySubscribers=e=>{this._logger.info("_notifySubscribers"),Promise.resolve().then(()=>{e.split(",").forEach(e=>{let t=sU(s$(e)),i=t.body;sL(t.headers)&&sF(t.headers)&&(i=s$(i));let n={url:t.url,body:JSON.parse(i),headers:t.headers};this._logger.info("message length=",i.length,"n. of subscribers",this._subscribers.length),this._subscribers.forEach(e=>e(n))})}).catch(e=>{this._logger.error("_notifySubscribers, failed to decode message",e),this._signalingSession.telemetryHelper.recordEvent(cZ)})},this._subscribeToBroker=(e,t)=>{if(this._disposed)return void this._logger.warn("_subscribeToBroker, disposed, ignore subscription");let i=sp();this._logger.info("_subscribeToBroker, url: ",e,",timeout in sec",t),this.currentSubscriptionUrl=e,this._currentSubscriptionTimeoutInSec=t,this._clearAllPendingTimeouts(),this._setSubscriptionTimeout(t),this._signalingSession.http.sendGetRequest({url:this.currentSubscriptionUrl,requestName:u3.BROKER_SUBSCRIBE.name,customHeaders:this._getBrokerRequestHeaders(i),payload:null,skipHttpTelemetry:!this._reportSubscriptionInTelemetry(),causeId:sp(),operationType:"BrokerSubscribe"}).then(this._handleSubscriptionSuccess).catch(this._handleSubscriptionFailure)},this._clearAllPendingTimeouts=()=>{this._cancelRequestTimer&&(this._cancelRequestTimer.stop(),this._cancelRequestTimer=null),this._retryRequestTimer&&(this._retryRequestTimer.stop(),this._retryRequestTimer=null)},this._abortPendingRequest=()=>{this._signalingSession.http.cancelRequestIfPending(u3.BROKER_SUBSCRIBE.name,sp())},this._setSubscriptionTimeout=e=>{this._cancelRequestTimer=iw.build(()=>{this._disposed||(this._signalingSession.http.hasPendingRequest(u3.BROKER_SUBSCRIBE.name)?(this._logger.warn("timeout subscription"),this._signalingSession.telemetryHelper.recordEvent(cX),this._signalingSession.http.cancelRequestIfPending(u3.BROKER_SUBSCRIBE.name,sp())):this._logger.error("Unable to resolve timeout deferred, it is not defined!"))},"TIMEOUT").start(1e3*e)},this._handleSubscriptionSuccess=e=>{if(this._disposed)return void this._logger.warn("_handleSubscriptionSuccess, disposed, ignore subscription success");if(this._reportSubscriptionInTelemetry(e)&&this._signalingSession.telemetryHelper.recordEvent(c0),e?.response){let t=e.response;this._logger.info("_handleSubscriptionSuccess, response",t),t.message&&this._notifySubscribers(t.message);let i=t.nextSubscribeUrl||this.currentSubscriptionUrl,n=t.expirationTimeInSec||this._currentSubscriptionTimeoutInSec;this._subscribeToBroker(i,n)}else this._logger.info("_handleSubscriptionSuccess, empty response")},this._handleSubscriptionFailure=e=>{if(this._disposed)return void this._logger.warn("_handleSubscriptionFailure, disposed, ignore subscription");if(e.status>=400&&e.status<500&&401!==e.status&&this.isNotNetworkErrors(e.status))return void this._logger.warn(`_handleSubscriptionFailure, received status ${e.status}, stop subscribing`);let t=t_(e);this._logger.error("_handleSubscriptionFailure failed, re-subscribing",t),this._reportSubscriptionInTelemetry()&&this._signalingSession.telemetryHelper.recordEvent(c1),this._retryRequestTimer=iw.build(()=>{this._subscribeToBroker(this.currentSubscriptionUrl,this._currentSubscriptionTimeoutInSec)},"RETRY").start(1e3*this._subscriptionRetryBackoffInSec)},this._reportSubscriptionInTelemetry=e=>(this._reportedResultCount++,this._reportedResultCount<=hU),this._getBrokerRequestHeaders=e=>{let t=new sa;return t.set(sr.HEADERS.CONTENT_TYPE,sr.CONTENT_TYPE.JSON),this._signalingSession.signalingAgentConfig.brokerRequestBatching&&t.set(sr.HEADERS.BROKER_USE_BATCHING_HEADER_NAME,"1"),t},this._logger=this._signalingSession.logger.createChild("Broker"),this._signalingSession.signalingAgentConfig.csaTimeoutConfiguration?.brokerRetryBackOffInSec&&(this._subscriptionRetryBackoffInSec=this._signalingSession.signalingAgentConfig.csaTimeoutConfiguration.brokerRetryBackOffInSec)}subscribeToBroker(e){this._logger.info("subscribeToBroker called."),this._abortPendingRequest(),this._clearAllPendingTimeouts(),this._subscribeToBroker(e,this._currentSubscriptionTimeoutInSec)}onBrokerMessage(e){this._logger.info("onBrokerMessage callback added"),this._subscribers.push(e)}dispose(){this._disposed=!0,this._logger.info("dispose"),this._subscribers=[],this._clearAllPendingTimeouts(),this._abortPendingRequest()}isNotNetworkErrors(e){return 490!==e&&496!==e&&498!==e&&499!==e}},hV=class{constructor(e){this.requests={},this.logger=e}clear(e,t){let i=t||{code:sr.CALL_END_CODE.SUCCESS,subCode:sr.CALL_END_SUB_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach(t=>{try{let n=parseInt(t,10);Object.keys(this.requests[n]).forEach(t=>{this.rejectOperation(n,t,e,i)})}catch(e){this.logger.warn(`CallOperations: clear error = ${e}`)}})}hasOperation(e,t){return this.requests.hasOwnProperty(e.valueOf())&&this.requests[e.valueOf()].hasOwnProperty(t)}getAllOperations(){return this.requests}getOperation(e,t){return this.hasOperation(e,t)?this.requests[e.valueOf()][t]:null}setOperation(e,t,i){return!this.hasOperation(e,t)&&(this.hasOwnProperty(e.valueOf())||(this.requests[e.valueOf()]={}),this.requests[e.valueOf()][t]=i,!0)}rejectOperation(e,t,i,n){if(this.hasOperation(e,t)){let i=e.valueOf(),r=this.requests[i][t].promise;delete this.requests[i][t],r.reject(n)}}resolveOperation(e,t,i,n){if(this.hasOperation(e,t)){let n=e.valueOf(),r=this.requests[n][t].promise;delete this.requests[n][t],r.resolve(i)}}},hB=class{constructor(e){this.logger=e,this.localRequests=new hV(e)}dispose(e,t,i){this.logger.info(`[${i}][dispose]`),this.rejectAllPendingOperations(e,t)}hasPendingOperation(e,t,i){return this.logger.info(`[${i}][hasPendingOperation] ${e} ${ta(t)}}`),this.localRequests.hasOperation(e,t)}rejectPendingOperation(e,t,i,n,r){this.logger.info(`[${r}][rejectPendingOperation] ${e} ${t} reason: ${i} endCode: ${n}`),this.localRequests.rejectOperation(e,t,i,n)}resolvePendingOperation(e,t,i,n){this.logger.info(`[${n}][resolvePendingOperation]: ${ta(t)}`),this.localRequests.resolveOperation(e,t,i,n)}setPendingOperation(e,t,i,n){return this.logger.info(`[${n}][setPendingOperation] ${e} value: ${i}`),this.localRequests.setOperation(e,t,i)}rejectAllPendingOperations(e,t){this.logger.info("rejectLocalQueuedOperations"),this.localRequests.clear(e,t)}};function hH(e,t){return sy(e,"signalingSession cannot be null"),sy(t,"content cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[]},contentSharing:{identifier:t.contentIdentifier,subject:t.subject,sessionState:t.sessionState,sequenceNumber:t.sequenceNumber,links:{sessionUpdate:so(e,rG.CONV_CONTENT_SHARING_UPDATE),sessionEnd:so(e,rG.CONV_CONTENT_SHARING_END)}},links:{addModalitySuccess:so(e,rG.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:so(e,rG.CONV_ADD_MODALITY_FAILURE)}}}}function hj(e){return sy(e,"signalingSession cannot be null"),{payload:{contentSharing:{links:{sessionUpdate:so(e,rG.CONV_CONTENT_SHARING_UPDATE),sessionEnd:so(e,rG.CONV_CONTENT_SHARING_END)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}function hq(e,t){return sy(e,"signalingSession cannot be null"),sC(t),{payload:{contentSharingTransactionEnd:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}function hW(e){return sy(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}function hG(e){return sy(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},links:{sessionUpdate:so(e,rG.CONV_CONTENT_SHARING_UPDATE),sessionEnd:so(e,rG.CONV_CONTENT_SHARING_END)}}}}function hz(e){return sy(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}function hJ(e,t,i){return sy(e,"signalingSession cannot be null"),sy(t,"sessionState cannot be null"),sy(i,"sequenceNumber cannot be null"),{payload:{sessionUpdateSequenceNumber:i,sessionState:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}var hK=class{constructor(){this.msElapsed=0,this.isPaused=!1,this.startTime=new Date().getTime(),this.pause=()=>{this.isPaused||(this.msElapsed+=new Date().getTime()-this.startTime,this.isPaused=!0)},this.resume=()=>{this.isPaused&&(this.isPaused=!1,this.startTime=new Date().getTime())},this.duration=()=>this.isPaused?this.msElapsed:this.msElapsed+new Date().getTime()-this.startTime,this.durationInMinutes=()=>Math.ceil(this.duration()/6e4),this.durationInSeconds=()=>Math.ceil(this.duration()/1e3)}};function hQ(){return new hK}var hY=class{constructor(e,t,i,n){this.signalingSession=e,this.correlationId=t,this.sessionId=null,this.fsmState=sr.CONTENT_SHARING_FSM_STATE.IDLE,this.addSessionPromise=null,this.removeSessionPromise=null,this.confirmInRosterPromise=null,this.links={},this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.disposed=!1,this.isPresenter=!1,this.FSM_STATES=sr.CONTENT_SHARING_FSM_STATE,this.logger=e.logger.createChild(()=>`[${this.fsmState}][cs=${this.sessionId}][cc=${this.correlationId}]`),i&&(this.sessionId=i),n&&(this.links=n)}start(e,t,i,n){if(this.logger.info(`[${n}][start]`),sS(e,"Correct addModality url is not provided"),!this.checkState("start",this.FSM_STATES.IDLE,this.addSessionPromise))return Promise.reject(null);this.addSessionPromise=i,this.confirmInRosterPromise=sV(),this.fsmState=this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.addTelemetryOperation(u3.ADD_CONTENT_SHARING_MODALITY.name,{causeId:n});let r=new sa;return r.set(sr.HEADERS.CONTENT_SHARING_CORRELATION_ID,this.correlationId),this.signalingSession.http.sendPostRequest({url:e,payload:hH(this.signalingSession,t),requestName:u3.ADD_CONTENT_SHARING_MODALITY.name,customHeaders:r,onceTrouterReady:()=>{this.startContentSharingTimer(n)},causeId:n}).then(()=>{this.disposed||(this.presenterMri=this.signalingSession.participantManager.localParticipant.id,this.isPresenter=!0)}).catch(e=>{let t=sM(e,this.signalingSession.signalingAgentConfig);return this.logger.info(`[${n}][start] error: ${t_(t)}`),this.disposed||(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_MODALITY),this.rejectPendingPromise(t_(e),t.error)),Promise.reject(null)})}delete(e,t){this.logger.info(`[${t}][delete]`);let i=!1;if(this.fsmState===this.FSM_STATES.IDLE)return this.logger.info(`[${t}][delete] skipped because state is already ${this.fsmState}`),e.resolve(),Promise.resolve();if(this.fsmState===this.FSM_STATES.CONTENT_SHARING_START_INITIATED)i=!0,this.rejectPendingPromise("Session delete called before start was finished");else if(!this.checkState("delete",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return Promise.reject(null);i||sS(this.links[sr.LINKS.CONTENT_SHARING_CONTROLLER],"Correct controller url is not set"),this.removeSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_DELETE_INITIATED;let n=hQ(),r=this.addTelemetryOperation(u3.DELETE_CONTENT_SHARING.name,{causeId:t});return(i?Promise.resolve(void 0):this.signalingSession.http.sendDeleteRequest({url:this.links[sr.LINKS.CONTENT_SHARING_CONTROLLER],requestName:u3.DELETE_CONTENT_SHARING.name,payload:hq(this.signalingSession,{code:sr.CALL_END_CODE.SUCCESS,subCode:sr.CALL_END_SUB_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.LOCAL_USER_INITIATED}),causeId:t})).then(()=>{if(!this.disposed){let e={success:!0,duration:n.duration()};i&&(e.skipReason="Session delete called before start was finished"),this.updateTelemetryOperation(r,e),this.fsmState=this.FSM_STATES.IDLE,this.resolvePendingPromise()}}).catch(e=>{let i=sM(e,this.signalingSession.signalingAgentConfig);if(this.logger.info(`[${t}][delete] error: ${t_(i)}`),!this.disposed){let e={success:!1,duration:n.duration()};this.updateTelemetryOperation(r,e),this.fsmState=this.FSM_STATES.IDLE,this.resolvePendingPromise()}return Promise.reject(null)})}join(e,t){if(this.logger.info(`[${t}][join]`),sS(this.links[sr.LINKS.CONTENT_SHARING_CONTROLLER],"Correct joinContentSharing url is not provided"),!this.checkState("join",this.FSM_STATES.IDLE,e))return;this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.addSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_JOIN_INITIATED;let i=hQ(),n=this.addTelemetryOperation(u3.JOIN_CONTENT_SHARING.name,{causeId:t});this.signalingSession.http.sendPostRequest({url:this.links[sr.LINKS.CONTENT_SHARING_CONTROLLER],payload:hj(this.signalingSession),requestName:u3.JOIN_CONTENT_SHARING.name,causeId:t}).then(e=>{if(!this.disposed){let t={success:!0,duration:i.duration()};this.updateTelemetryOperation(n,t),this.processStartOrJoinSuccess(e.response),this.resolvePendingPromise(e.response)}}).catch(e=>{let r=sM(e,this.signalingSession.signalingAgentConfig);if(this.logger.info(`[${t}][join] error: ${t_(r)}`),!this.disposed){let t={success:!1,duration:i.duration()};this.updateTelemetryOperation(n,t);let s=r.error;this.rejectPendingPromise(t_(e),s)}})}takeControl(e,t){if(this.logger.info(`[${t}][takeControl]`),sS(this.links[sr.LINKS.CONTENT_SHARING_TAKE_CONTROL],"correct contentSharingTakeControl url is not provided"),!this.checkState("takeControl",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return;let i=hQ(),n=this.addTelemetryOperation(u3.TAKE_CONTROL_CONTENT_SHARING.name,{causeId:t});this.signalingSession.http.sendPostRequest({url:this.links[sr.LINKS.CONTENT_SHARING_TAKE_CONTROL],payload:hW(this.signalingSession),requestName:u3.TAKE_CONTROL_CONTENT_SHARING.name,withoutTrouter:!0,causeId:t}).then(t=>{if(!this.disposed){let r={success:!0,duration:i.duration()};this.updateTelemetryOperation(n,r);let s={contentIdentifier:t.response.identifier,presenter:t.response.presenter.id,subject:t.response.subject||null,sessionState:t.response.sessionState||null};e.resolve(s)}}).catch(r=>{let s=sM(r,this.signalingSession.signalingAgentConfig);if(this.logger.info(`[${t}][takeControl] error: ${t_(s)}`),!this.disposed){let t={success:!1,duration:i.duration()};this.updateTelemetryOperation(n,t);let a=Error(t_(r));a.endCode=s.error,e.reject(a)}})}updateSessionState(e,t,i){if(this.logger.info(`[${i}][updateSessionState]`),sS(this.links[sr.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],"Correct sendUpdateSessionState url is not provided"),!this.checkState("updateSessionState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,t))return;let n=hQ(),r=this.addTelemetryOperation(u3.UPDATE_SESSION_STATE_CONTENT_SHARING.name,{causeId:i});this.signalingSession.http.sendPostRequest({url:this.links[sr.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],payload:hJ(this.signalingSession,e,this.nextClientSequenceNumberToUse++),requestName:u3.UPDATE_SESSION_STATE_CONTENT_SHARING.name,causeId:i}).then(()=>{if(!this.disposed){let e={success:!0,duration:n.duration()};this.updateTelemetryOperation(r,e),t.resolve()}}).catch(e=>{let s=sM(e,this.signalingSession.signalingAgentConfig);if(this.logger.info(`[${i}][updateSessionState] error: ${t_(s)}`),!this.disposed){let i={success:!1,duration:n.duration()};this.updateTelemetryOperation(r,i);let a=Error(t_(e));a.endCode=s.error,t.reject(a)}})}updateParticipantState(e,t){if(this.logger.info(`[${t}][updateParticipantState]`),sS(this.links[sr.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],"correct confirmContentSharingView url is not provided"),!this.checkState("updateParticipantState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return;let i=hQ(),n=this.addTelemetryOperation(u3.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING.name,{causeId:t});this.signalingSession.http.sendPostRequest({url:this.links[sr.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],payload:hz(this.signalingSession),requestName:u3.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING.name,withoutTrouter:!0,causeId:t}).then(()=>{if(!this.disposed){let t={success:!0,duration:i.duration()};this.updateTelemetryOperation(n,t),e.resolve()}}).catch(r=>{let s=sM(r,this.signalingSession.signalingAgentConfig);if(this.logger.info(`[${t}][updateParticipantState] error: ${t_(s)}`),!this.disposed){let t={success:!1,duration:i.duration()};this.updateTelemetryOperation(n,t);let a=Error(t_(r));a.endCode=s.error,e.reject(a)}})}updateNotificationLinks(e){if(this.logger.info(`[${e}][updateNotificationLinks]`),sS(this.links[sr.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],"correct notificationLinks url is not provided"),!this.checkState("updateState",this.FSM_STATES.CONTENT_SHARING_CONNECTED))return;let t=hQ(),i=this.addTelemetryOperation(u3.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS.name,{causeId:e});this.signalingSession.http.sendPostRequest({url:this.links[sr.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],payload:hG(this.signalingSession),requestName:u3.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS.name,withoutTrouter:!0,causeId:e}).then(()=>{if(!this.disposed){let e={success:!0,duration:t.duration()};this.updateTelemetryOperation(i,e)}}).catch(n=>{let r=sM(n,this.signalingSession.signalingAgentConfig);if(this.logger.info(`[${e}][updateNotificationLinks] error: ${t_(r)}`),!this.disposed){let e={success:!1,duration:t.duration()};this.updateTelemetryOperation(i,e)}})}confirmInRoster(){this.confirmInRosterPromise&&this.confirmInRosterPromise.isPending&&(this.logger.info("Confirmed in roster"),this.confirmInRosterPromise.resolve())}handleAddModalitySuccess(e,t){return(this.logger.info(`[${t}][handleAddModalitySuccess]`),this.checkState("handleAddModalitySuccess",this.FSM_STATES.CONTENT_SHARING_START_INITIATED))?e.modalitySuccess&&e.modalitySuccess.contentSharing?(this.addTelemetryOperation(cC,{causeId:t}),this.processStartOrJoinSuccess(e.modalitySuccess.contentSharing),this.confirmInRosterPromise.promise.then(()=>{delete this.confirmInRosterPromise,this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_MODALITY),this.resolvePendingPromise(e.modalitySuccess.contentSharing)}),!0):(this.addTelemetryOperation(cC,{causeId:t,skipReason:"no content sharing blob"}),this.logger.info(`[${t}][handleAddModalitySuccess] ignored because modalitySuccess was missing or did not contain content sharing blob`),!1):(this.logger.info(`[${t}][handleAddModalitySuccess] ignored because session is not waiting to start`),!1)}handleAddModalityFailure(e,t){if(this.logger.info(`[${t}][handleAddModalityFailure]`),!this.checkState("handleAddModalityFailure",[this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.FSM_STATES.CONTENT_SHARING_CONNECTED]))return!1;if(!e.modalityFailure||!e.modalityFailure.contentSharing)return this.addTelemetryOperation(cb,{causeId:t,skipReason:"no content sharing blob"}),!1;let i=e.modalityFailure.contentSharing;this.addTelemetryOperation(cb,{reason:i,causeId:t});let n={...i};return this.sendTelemetryData(n),this.rejectPendingPromise(n.phrase,n),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_MODALITY),!0}handleStartFromRoster(e,t){this.logger.info(`[${t}][handleStartFromRoster]`),this.addTelemetryOperation(cS,{causeId:t})}handleStopFromRoster(e,t){this.logger.info(`[${t}][handleStopFromRoster]`),this.addTelemetryOperation(cy,{causeId:t}),this.sendTelemetryData(e)}handleStop(e,t){if(this.logger.info(`[${t}][handleStop]`),this.isSelfInitiatedAction(e))return this.logger.info(`[${t}][handleStop]handleStop skipped because session was ended by self`),!1;let i={...e.contentSharingTransactionEnd};return this.addTelemetryOperation(cv,{causeId:t}),this.sendTelemetryData(i),!0}handleUpdate(e,t){return(this.logger.info(`[${t}][handleUpdate]`),e.sequenceNumber<=this.lastUpdateSequenceNumber)?(this.logger.info(`handleUpdate skipped because of old sequence number: last received ${this.lastUpdateSequenceNumber}, update contained ${e.sequenceNumber}`),this.addTelemetryOperation(cm,{causeId:t,skipReason:"old sequence number"}),!1):(this.lastUpdateSequenceNumber=e.sequenceNumber,this.isPresenter=e.presenter.id===this.signalingSession.participantManager.localParticipant.id,this.addTelemetryOperation(cm,{causeId:t}),!0)}dispose(e,t){this.logger.info(`[${t}][dispose]`),this.disposed=!0,this.rejectPendingPromise("call ended",e||{code:sr.CALL_END_CODE.SUCCESS,subCode:sr.CALL_END_SUB_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.LOCAL_USER_INITIATED}),this.addTelemetryOperation(cn,{causeId:t}),this.sendTelemetryData(e)}rejectPendingPromise(e,t){this.logger.info("rejectPendingPromise");let i=Error(e);t&&(i.endCode=t),this.removeSessionPromise&&(this.removeSessionPromise.reject(i),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.reject(i),this.addSessionPromise=null)}resolvePendingPromise(e){this.logger.info("resolvePendingPromise");let t=null;e&&(t={sessionId:e.sessionId,correlationId:e.contentSharingCorrelationId,contentIdentifier:e.identifier,presenter:e.presenter.id,subject:e.subject||null,sessionState:e.sessionState||null}),this.removeSessionPromise&&(this.removeSessionPromise.resolve(t),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.resolve(t),this.addSessionPromise=null)}processStartOrJoinSuccess(e){this.logger.info("processStartOrJoinSuccess"),this.sessionId=e.sessionId,this.fsmState=this.FSM_STATES.CONTENT_SHARING_CONNECTED,this.lastUpdateSequenceNumber=-1,this.links[sr.LINKS.CONTENT_SHARING_CONTROLLER]=e.links.contentSharingController,this.links[sr.LINKS.CONTENT_SHARING_TAKE_CONTROL]=e.links.takeControl,this.links[sr.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE]=e.links.updateSessionState,this.links[sr.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE]=e.links.sync,this.links[sr.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[sr.LINKS.CONTENT_SHARING_LEAVE]=e.links.leave}checkState(e,t,i){let n;if(n="string"==typeof t?this.fsmState===t:t.indexOf(this.fsmState)>-1)return!0;{let n=`${e} requires state ${t}, but state is ${this.fsmState}`;return this.logger.error(n),i&&i.reject(n),!1}}isSelfInitiatedAction(e){return e.presenter.participantId===this.signalingSession.participantManager.localParticipant.participantId}startContentSharingTimer(e){this.logger.info("startContentSharingTimer"),this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.ADD_MODALITY,()=>{this.addTelemetryOperation(ld,{causeId:e}),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_MODALITY),this.rejectPendingPromise("timed out waiting for ContentSharing to start",{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:sr.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},this.signalingSession.getTimeoutValue("addModalityTimeoutSec"))}addTelemetryOperation(e,t){return this.signalingSession.telemetryHelper.addContentSharingOperation(this.correlationId,e,t)}updateTelemetryOperation(e,t){this.signalingSession.telemetryHelper.updateContentSharingOperation(this.correlationId,e,t)}sendTelemetryData(e){this.signalingSession.telemetryHelper.sendContentSharingTelemetryData(this.correlationId,this.signalingSession.sessionId,this.isPresenter,e,this.links[sr.LINKS.CONTENT_SHARING_CONTROLLER],this.sessionId)}},hZ=class{constructor(e,t){this.contentSharingToStartCallWith=null,this.contentSharingSessions={},this.DEFAULT_STOP_REASON={code:sr.CALL_END_CODE.SUCCESS,subCode:sr.CALL_END_SUB_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.REMOTE_USER_INITIATED},this.DEFAULT_STOP_ID="8:unknown",this.deleteContentSharingAsync=(e,t)=>{this.logger.info(`[${t}][deleteContentSharingAsync]`);let i=sV(),n=this.contentSharingSessions[e];if(this.pendingSessionToStart&&this.pendingSessionToStart.correlationId===e&&(n=this.pendingSessionToStart),n){let r=()=>{this.contentSharingSessions[e]&&delete this.contentSharingSessions[e]};n.delete(i,t).then(r,r)}else this.rejectBecauseOfMissingSession(e,i);return i.promise},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(()=>"[ContentSharingManager]"),this.lastProcessedSequenceNumber=-1,this.lastProcessedSequenceNumberForParticipant={}}startContentSharingAsync(e,t,i,n,r,s,a){if(this.logger.info(`startContentSharingAsync called for: ${e}`),this.pendingSessionToStart){let e="There is already a ContentSharing session start pending";return this.logger.error(e),Promise.reject(Error(e))}let o={contentIdentifier:e,subject:i||null,sessionState:t||null,sequenceNumber:1},l=sV(),c=new hY(this.signalingSession,a||sm());return this.pendingSessionToStart=c,r?(this.logger.info("Call connected, send content sharing request out immediately"),c.start(n,o,l,s)):(this.logger.info("Content sharing is to be started when startOutgoingCall is called"),c.addSessionPromise=l,c.fsmState=sr.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED,this.contentSharingToStartCallWith=o),l.promise.then(()=>{this.contentSharingSessions.hasOwnProperty(c.correlationId)||(this.contentSharingSessions[c.correlationId]=c),this.pendingSessionToStart=null}).catch(()=>{this.pendingSessionToStart=null}),l.promise}joinContentSharingAsync(e,t){this.logger.info(`[${t}][joinContentSharingAsync]`);let i=sV(),n=this.contentSharingSessions[e];return n?n.join(i,t):this.rejectBecauseOfMissingSession(e,i),i.promise}updateContentSharingSessionStateAsync(e,t,i){this.logger.info(`[${i}][updateContentSharingSessionStateAsync][sessionState=${JSON.stringify(t)}]`);let n=sV(),r=this.contentSharingSessions[e];return r?r.updateSessionState(t,n,i):this.rejectBecauseOfMissingSession(e,n),n.promise}takeContentSharingControlAsync(e,t){this.logger.info(`[${t}][takeContentSharingControlAsync]`);let i=sV(),n=this.contentSharingSessions[e];return n?n.takeControl(i,t):this.rejectBecauseOfMissingSession(e,i),i.promise}updateContentSharingParticipantStateAsync(e,t){this.logger.info(`[${t}][updateContentSharingParticipantStateAsync]`);let i=sV(),n=this.contentSharingSessions[e];return n?n.updateParticipantState(i,t):this.rejectBecauseOfMissingSession(e,i),i.promise}updateContentSharingNotificationLinksAsync(e){for(let t of(this.logger.info(`[${e}][updateContentSharingNotificationLinksAsync]`),Object.keys(this.contentSharingSessions)))if(this.contentSharingSessions.hasOwnProperty(t)){let i=this.contentSharingSessions[t];i&&i.updateNotificationLinks(e)}}getContentSharingInfoToStartSharing(){if(this.contentSharingToStartCallWith){let e=this.pendingSessionToStart,t=sr.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED;e&&e.fsmState===t||(this.contentSharingToStartCallWith=null,this.pendingSessionToStart=null)}return this.contentSharingToStartCallWith}dispose(e,t){for(let i of(this.logger.info(`[${t}][dispose]`),Object.keys(this.contentSharingSessions)))if(this.contentSharingSessions.hasOwnProperty(i)){let n=this.contentSharingSessions[i];n&&n.dispose(e,t)}}handleContentSharingUpdate(e){let t=e.body,i=sk(e),n=this.contentSharingSessions[t.contentSharingCorrelationId];if(!n)return void this.logger.info(`[${i}][handleContentSharingUpdate][failed][reason=no session with correlation ID ${t.correlationId}]`);n.handleUpdate(t,i)&&this.signalingSessionCallback.onContentSharingUpdated({sessionId:t.sessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:t.presenter.id,subject:t.subject||null,sessionState:t.sessionState||null},i)}handleAddModalitySuccess(e,t){this.logger.info(`[${t}][handleAddModalitySuccess]`);let i=this.pendingSessionToStart;i?i.handleAddModalitySuccess(e,t):this.logger.info(`[${t}][handleAddModalitySuccess]Ignoring handleAddModalitySuccess because not waiting for one`)}handleAddModalityFailure(e,t){this.logger.info(`[${t}][handleAddModalityFailure]`);let i=this.pendingSessionToStart;i?i.handleAddModalityFailure(e,t):this.logger.info(`[${t}][handleAddModalityFailure]Ignoring handleAddModalityFailure because not waiting for one`)}handleIncomingContentSharingFromRoster(e,t,i){if(this.logger.info(`[${i}] handleIncomingContentSharingFromRoster: isFullRoster ${t} content ${t_(e)}`),("MultiPartyEndpoint"===e.type||t)&&this.lastProcessedSequenceNumber>e.sequenceNumber)return void this.logger.info(`[${i}] handleIncomingContentSharingFromRoster invalid roster current sequenceNumber ${e.sequenceNumber} lastProcessedSequenceNumber ${this.lastProcessedSequenceNumber}`);let{sessionsWithPresenters:n,sessionsWithoutPresenters:r}=this.parseContentSharingSessionsFromRoster(e);this.startSessionsFromRoster(n,i),this.stopSessionsFromRoster(r,i),this.lastProcessedSequenceNumber=e.sequenceNumber}handleContentSharingEnd(e){let t=e.body,i=sk(e);this.logger.info("handleContentSharingEnd : ",t_(t));let n=this.contentSharingSessions[t.contentSharingCorrelationId];if(!n)return void this.logger.info("Ignoring contentSharingEnd since there is no corresponding sharing ongoing");if(!n.handleStop(t,i))return;let r={...t.contentSharingTransactionEnd};this.raiseContentSharingStopped(t.contentSharingCorrelationId,i,t.presenter.id,r)}parseContentSharingSessionsFromRoster(e){let t={},i={},n=new Set;for(let i of Object.keys(e.participants)){let r=e.participants[i];if("Delta"===e.type&&this.lastProcessedSequenceNumberForParticipant.hasOwnProperty(i)&&r.version<=this.lastProcessedSequenceNumberForParticipant[i]||(r.version=r.version||-1,this.lastProcessedSequenceNumberForParticipant[i]=r.version,n.add(r.details.id),!r.endpoints))continue;let s=this.signalingSession.participantManager.localParticipant.participantId;for(let e of Object.keys(r.endpoints)){let i=r.endpoints[e],n=i?.contentSharing?.sessionInformation;n?.role==="presenter"&&(t[n.contentSharingCorrelationId]={presenterId:r.details.id,sessionInfo:n,selfEndpointIsPresenter:i.participantId===s})}}for(let e of Object.keys(this.contentSharingSessions))!t[e]&&n.has(this.contentSharingSessions[e].presenterMri)&&(i[e]=this.contentSharingSessions[e]);return{sessionsWithPresenters:t,sessionsWithoutPresenters:i}}stopSessionsFromRoster(e,t){for(let i of(this.logger.info(`[${t}][stopSessionsFromRoster]`),Object.keys(e)))this.logger.info(`[${t}][stopSessionsFromRoster] stopping session with correlationId ${i}`),this.stopSession(e[i],t)}stopSession(e,t){this.logger.info(`[${t}][stopSession] Stopping session ${e.sessionId}`),e.handleStopFromRoster(this.DEFAULT_STOP_REASON,t),this.raiseContentSharingStopped(e.correlationId,t)}startSessionsFromRoster(e,t){for(let i of(this.logger.info(`[${t}][startSessionsFromRoster]`),Object.keys(e))){this.logger.info(`[${t}][startSessionsFromRoster]`);let n=this.contentSharingSessions[i],r=e[i];if(this.pendingSessionToStart&&this.pendingSessionToStart.correlationId===i?this.pendingSessionToStart.confirmInRoster():n&&n.confirmInRoster(),n)n&&(this.contentSharingSessions[i].presenterMri=r.presenterId,this.logger.info(`[${t}][startSessionsFromRoster]Session ${i} is already present locally`));else{if(r.selfEndpointIsPresenter){this.logger.info(`[${t}][startSessionsFromRoster]This endpoint is presenting, dont fire callback`);continue}this.logger.info(`[${t}][startSessionsFromRoster]New sharing session found. Raising ContentSharingStarted`),this.raiseContentSharingStarted(r.presenterId,r.sessionInfo,t).handleStartFromRoster(r.presenterId,t)}}}raiseContentSharingStopped(e,t,i,n){this.logger.info(`[${t}][raiseContentSharingStopped]`),this.signalingSessionCallback.onContentSharingStopped({sessionId:this.contentSharingSessions[e].sessionId,correlationId:e,endedBy:i||this.DEFAULT_STOP_ID,reason:n||this.DEFAULT_STOP_REASON},t),delete this.contentSharingSessions[e]}raiseContentSharingStarted(e,t,i){this.logger.info(`[${i}][raiseContentSharingStarted]`);let n=new hY(this.signalingSession,t.contentSharingCorrelationId,t.contentSharingSessionId,{[sr.LINKS.CONTENT_SHARING_CONTROLLER]:t.contentSharingController});n.presenterMri=e,this.contentSharingSessions[n.correlationId]=n;let r={sessionId:t.contentSharingSessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:e,subject:t.subject||null,sessionState:t.sessionState||null};return this.signalingSessionCallback.onContentSharingStarted(r,i),n}rejectBecauseOfMissingSession(e,t){let i=`There is no ContentSharing session with the correlation ID ${e}`;this.logger.error(i),t&&t.reject(Error(i))}},hX={Default:{retryIntervalsMs:[200,1e3,5e3],maxRequestAttempts:4,perRequestTimeoutMs:45e3,perAttemptTimeoutMs:15e3,perRequestTimeoutWithHedgingMs:45e3,perAttemptTimeoutWithHedgingMs:3e4,hedgeDelayMs:4e3},BrokerSubscribe:{retryIntervalsMs:[100,200,500],maxRequestAttempts:4,perRequestTimeoutMs:3e4,perAttemptTimeoutMs:3e4,perRequestTimeoutWithHedgingMs:45e3,perAttemptTimeoutWithHedgingMs:3e4}},h0={CallSetup:{requestHedgingCapability:["disabled"],hedgeDelayMs:4e3},Other:{requestHedgingCapability:["disabled"]},BrokerSubscribe:{requestHedgingCapability:["disabled"]}},h1="HttpRequestDispatcherFactory";function h2(e,t,i){t?.signalingSession?t.signalingSession.telemetryHelper?.addTokenTelemetry(e,t?.tokenTelemetryData):i?.info("[reportTokenTelemetryData] signaling session is not available, cannot send token telemetry")}function h3(e,t){let{signalingSession:i,operation:n,causeId:r,data:s,customHeaders:a={},forceFetchToken:o,tokenRequestOptions:l,keepAlive:c}=e;if(i.disposed)return Promise.reject("Session already disposed");let d=e=>{let t="string"==typeof e?Error(e):e;throw i.signalingAgent.clientSupportsGenericTokenAPI?e.timeOut?t.tokenTimeoutError=!0:(t.tokenError=!0,t.tokenErrorSubCode=e.errorSubCode):t.skypeTokenError=!0,t},u=!1,h={signalingSession:i,tokenTelemetryData:{}};return i.signalingAgent.authTokenManager.getToken(r,o,l,h).catch(n=>(h2(e.requestId,h,t),!o&&h4(i)&&i.signalingAgentConfig.attemptHttpRequestWithCachedSkypetoken&&i.signalingAgent.authTokenManager.getLastToken(r))?(u=!0,t?.info(`[${r}][requestBuilder] failed to fetch token, using lastToken`),Promise.resolve(i.signalingAgent.authTokenManager.getLastToken(r))):(t?.info(`[${r}][requestBuilder] getToken failed with error ${n}`),d(n))).then(o=>{if(i.disposed)throw Error("token returned too late. Object is already disposed");h2(e.requestId,h,t);let l=new sa;if(l.set(sr.HEADERS.CORRELATION_ID,i.correlationId),l.set(sr.HEADERS.MESSAGE_ID,sf(r)),l.set(sr.HEADERS.CLIENT_USER_AGENT,sd(i.signalingAgentConfig.clientInformation)),i.signalingAgent.clientSupportsGenericTokenAPI){let e=i.signalingAgent.authTokenManager.getLastTokenType(r);switch(!i.signalingAgentConfig.disableTokenMigrationHeader&&l.set(sr.HEADERS.TOKEN_MIGRATION,"True"),e){case 8:case 4:l.set(sr.HEADERS.AUTHORIZATION,`${sr.HEADERS.BEARER_KEYWORD} ${o}`),l.delete(sr.HEADERS.SKYPE_TOKEN);break;case 1:l.set(sr.HEADERS.SKYPE_TOKEN,o),l.delete(sr.HEADERS.AUTHORIZATION);break;default:throw Error(`Error in RequestBuilder. TokenType ${e} is not supported`)}}else l.set(sr.HEADERS.SKYPE_TOKEN,o);let d=i.participantManager.localParticipant;d&&(d.ring&&l.set(sr.HEADERS.RING,d.ring),d.region&&l.set(sr.HEADERS.REGION,d.region),d.partition&&l.set(sr.HEADERS.PARTITION,d.partition));let g=s?.payload?JSON.stringify(s.payload):null,p={headers:{...l?.getAll(),...a},payload:g,usedCachedSkypetoken:u,reporting:{serviceName:n?`${h1}-${n}`:h1},keepAlive:c};return i.telemetryHelper.addNetworkOperationStarted(n),p}).catch(d)}function h4(e){let t=sB(e.signalingAgentConfig.trouterServiceProvider);return 3===t||1===t}var h5=500,h6=1e4,h8=4,h9=3e3,h7=3;function ge(e){return new gt(e.causeId,e.logger,e.dispatcher,e.requestType,e.url,e.request,e.attemptFailureCallback,e.authRequiredCallback,e.settings)}var gt=class{constructor(e,t,i,n,r,s,a,o,l){this.causeId=e,this.logger=t,this.dispatcher=i,this.requestType=n,this.url=r,this.request=s,this.onRequestFailed=a,this.authRequiredCallback=o,this.settings=l,this.requestsSent=0,this.otherAttemptSuccessful=!1,this.pendingAttempts=[],this.hedgeDelayMs=h9,this.hedgeMaxParallelAttempts=h7,this.stopStandardRetryTimer=()=>{this.standardRetryTimer&&(this.standardRetryTimer.stop(),this.standardRetryTimer=null)},this.stopHedgeTimer=()=>{this.hedgeTimer&&(this.hedgeTimer.stop(),this.hedgeTimer=null)},this.stopAttemptTimeoutTimer=e=>{try{e.timeoutTimer&&(e.timeoutTimer.stop(),this.logger.info("attempt timer stopped"))}catch(e){this.logger.info(`stopAttemptTimeoutTimer error ${e}`)}},this.stopRequestTimer=()=>{try{this.requestTimer&&(this.requestTimer.stop(),this.logger.info("Request timer stopped"))}catch(e){this.logger.info(`stopRequestTimer error ${e}`)}this.requestTimer=null},this.canScheduleNextAttempt=()=>{if(this.stackError===sr.HTTP_STACK_ERROR.REQUEST_ABORTED||this.otherAttemptSuccessful||this.requestsSent>=this.settings.maxRequestAttempts)return this.logger.info(`canScheduleNextAttempt stack error ${this.stackError} otherAttemptSuccessful ${this.otherAttemptSuccessful} exceeded max attempt ${this.requestsSent>=this.settings.maxRequestAttempts}`),!1;if(this.settings.enableRequestHedging){let e=this.pendingAttempts.length<this.hedgeMaxParallelAttempts;return e||this.logger.info(`canScheduleNextAttempt enableRequestHedging attempts sent: ${this.pendingAttempts.length} max attempts: ${this.hedgeMaxParallelAttempts}`),e}{let e=this.requestsSent<this.settings.retryIntervalsMs.length;return e||this.logger.info(`canScheduleNextAttempt attempts sent: ${this.requestsSent} max attempts: ${this.settings.retryIntervalsMs.length}`),e}},this.scheduleNextRequest=e=>{this.settings.enableRequestHedging?(this.logger.info("scheduleNextRequest with hedging"),this.hedgeTimer=iw.build(()=>{this.attempt(),this.canScheduleNextAttempt()&&this.scheduleNextRequest(!1)},"HEDGE").start(this.getNextDelay(e))):(this.logger.info("scheduleNextRequest with retry"),this.standardRetryTimer=iw.build(()=>{this.attempt()},"RETRY").start(this.getNextDelay(e)))},this.standardizeFailedRequest=(e,t)=>{let i,n=this.logger.createChild("[standardizeFailedRequest]");try{if(this.stackError===sr.HTTP_STACK_ERROR.REQUEST_TIMEOUT)n.info("request timed out"),i=rj.REQUEST_TIMEOUT;else if(this.stackError===sr.HTTP_STACK_ERROR.REQUEST_ABORTED)n.info("request aborted"),i=rj.REQUEST_ABORTED;else if(t&&t.status===sr.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT)n.info("request attempt timed out"),i=rj.ATTEMPT_TIMEOUT;else if(t&&[sr.HTTP_STACK_ERROR.ATTEMPT_ABORTED,sr.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL].indexOf(t.status)>-1)n.info("request attempt aborted"),i=rj.ATTEMPT_ABORTED;else if(e){if(n.info(`request ${tD(e)}`),e.request?.response){let t=e;i={response:{...t?.request?.response,headers:t.response?.headers},status:t.request.status,statusText:t.request.statusText,readyState:t.request.readyState}}else e.status||e.statusCode||e.response?i={response:e.response,status:[void 0,null,""].indexOf(e.status)>-1?e.statusCode:e.status,statusText:e.statusText,readyState:e.readyState}:(n.info("Local http stack error"),i={response:sr.CALL_END_SUB_CODE.LOCAL_HTTP_STACK_ERROR,status:sr.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,statusText:"LocalHTTPStackError",readyState:e.readyState||0});this.isBrowserOffline()&&0===i.status&&4===i.readyState&&(n.info("offline"),i={response:sr.HTTP_STACK_ERROR.CANNOT_CONNECT,status:sr.HTTP_STATUS_CODES.OFFLINE,statusText:"offline",readyState:i.readyState}),e.response?.message&&(e.response.message.operationFailure||e.response.message.broadcastOperationFailure)?i={response:e.response.message}:!e.response&&e.body?.operationFailure&&(i={response:e.body})}else n.info("no response"),i={response:sr.HTTP_STACK_ERROR.NONE,status:sr.HTTP_STATUS_CODES.OTHER,statusText:"Empty Response",readyState:0}}catch(e){n.info(`Failed to handle error ${e}`),i={response:"",status:sr.HTTP_STATUS_CODES.OTHER,statusText:"FailedToHandleError",readyState:0}}return i},this.hasPendingAttempts=()=>this.pendingAttempts.some(e=>e.pending),this.getRequestFromStatus=e=>e?.request?.status||0,this.isBrowserOffline=()=>navigator&&!1===navigator.onLine,this.logger=t.createChild(`[${this.causeId}][Dispatcher]`),this.logger.info(`created request, url=${r}`),!isNaN(this.settings.hedgeDelayMs)&&this.settings.hedgeDelayMs>=h5&&this.settings.hedgeDelayMs<=h6&&(this.hedgeDelayMs=this.settings.hedgeDelayMs),!isNaN(this.settings.hedgeMaxParallelAttempts)&&this.settings.hedgeMaxParallelAttempts>=0&&this.settings.hedgeMaxParallelAttempts<=h8&&(this.hedgeMaxParallelAttempts=this.settings.hedgeMaxParallelAttempts),(isNaN(this.settings.perAttemptTimeoutMs)||this.settings.perAttemptTimeoutMs<=0)&&(this.settings.perAttemptTimeoutMs=15e3),(isNaN(this.settings.perRequestTimeoutMs)||this.settings.perRequestTimeoutMs<=0)&&(this.settings.perRequestTimeoutMs=45e3),(isNaN(this.settings.maxRequestAttempts)||this.settings.maxRequestAttempts<=0)&&(this.settings.maxRequestAttempts=4),(isNaN(this.settings.perRequestTimeoutWithHedgingMs)||this.settings.perRequestTimeoutWithHedgingMs<=0)&&(this.settings.perRequestTimeoutWithHedgingMs=45e3),(isNaN(this.settings.perAttemptTimeoutWithHedgingMs)||this.settings.perAttemptTimeoutWithHedgingMs<=0)&&(this.settings.perAttemptTimeoutWithHedgingMs=3e4)}sendRequest(){this.stackError=sr.HTTP_STACK_ERROR.NONE;let e=()=>{this.stackError=sr.HTTP_STACK_ERROR.REQUEST_TIMEOUT,this.cancelAllAttempts(sr.HTTP_STACK_ERROR.REQUEST_TIMEOUT)};return this.logger.info("send api called"),this.requestTimer=iw.build(e,"REQUEST_TIMEOUT").start(this.settings.enableRequestHedging?this.settings.perRequestTimeoutWithHedgingMs:this.settings.perRequestTimeoutMs),new Promise((e,t)=>{this.resolve=e,this.reject=t,this.scheduleNextRequest(!0)})}cancelRequest(){this.logger.info("cancelRequest"),this.stackError=sr.HTTP_STACK_ERROR.REQUEST_ABORTED,this.cancelAllAttempts(sr.HTTP_STACK_ERROR.ATTEMPT_ABORTED)}cancelOtherAttempts(e){this.pendingAttempts.splice(e-1,1),this.cancelAllAttempts(sr.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL)}cancelAllAttempts(e){this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.pendingAttempts.forEach(t=>{t.status=e,t.cancelDeferred.resolve(),this.stopAttemptTimeoutTimer(t)}),this.stopRequestTimer()}getRequestMethod(e){switch(e){case 0:return this.dispatcher.getAsync.bind(this.dispatcher);case 1:return this.dispatcher.postAsync.bind(this.dispatcher);case 2:return this.dispatcher.putAsync.bind(this.dispatcher);case 3:return this.dispatcher.removeAsync.bind(this.dispatcher);default:return null}}async queueAttempt(e){let t=e&&this.isNotRetryable(e);if(this.logger.info("queueAttempt"),t||!this.canScheduleNextAttempt()){this.logger.info(`unable to retry isNotRetryable ${t} ${JSON.stringify(e)}`),this.stopHedgeTimer(),this.stopRequestTimer(),this.hasPendingAttempts()||(this.settings.reportPreviousErrorsForTimeout&&e===rj.ATTEMPT_TIMEOUT&&this.previousAttempt?this.reject(this.previousAttempt):this.reject(e));return}if(this.isAuthFailedStatus(e)){this.logger.info("auth failed"),this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.stopRequestTimer();try{let t=e?.response?.headers,i=sY(this.request?.headers),n=e.response?.status===sr.HTTP_STATUS_CODES.UNAUTHORIZED&&e.response?.operationFailure?.subCode===sr.CALL_END_SUB_CODE.CONVERSATION_TERMINATION_INTERACTION_REQUIRED,r=await this.authRequiredCallback(t,i,{IPCAFailure:n});this.request=r}catch(t){t.authCallBackFailure=!0,e.error=t,this.reject(e);return}}if(this.previousAttempt=e,this.hedgeTimer)return void this.logger.info("scheduleNextRequest ignored as there's already active hedge timer");this.scheduleNextRequest(!1)}attempt(){if(this.logger.info("attempt to send request"),this.stackError===sr.HTTP_STACK_ERROR.REQUEST_ABORTED||this.otherAttemptSuccessful)return;let e=new Date().getTime();this.requestsSent++;let t=this.requestsSent,i=sV();this.request.timeout=i.promise;let n={cancelDeferred:i,status:sr.HTTP_STACK_ERROR.NONE,timeoutTimer:null,pending:!0},r=()=>{n.status=sr.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT,n.cancelDeferred.resolve()};n.timeoutTimer=iw.build(r,"ATTEMPT_TIMEOUT").start(this.settings.enableRequestHedging?this.settings.perAttemptTimeoutWithHedgingMs:this.settings.perAttemptTimeoutMs),this.pendingAttempts.push(n),this.getRequestMethod(this.requestType)(this.url,this.request).then(i=>{if(this.logger.info(`attempt successful, request response=${tM(i)} status=${this.getRequestFromStatus(i)}`),this.otherAttemptSuccessful)throw"Other attempt succesful";if(this.stackError===sr.HTTP_STACK_ERROR.REQUEST_ABORTED)throw"Session disposed";if(!i)throw"Invalid response";n.pending=!1,this.otherAttemptSuccessful=!0,this.stopRequestTimer(),this.stopHedgeTimer(),this.stopAttemptTimeoutTimer(n),this.cancelOtherAttempts(t),this.resolve({success:!0,request:i.request,response:i.response,attempt:this.requestsSent,attemptStartTimestamp:e,attemptResponseTimestamp:new Date().getTime()})}).catch(t=>{n.pending=!1,this.stopAttemptTimeoutTimer(n);let i=this.standardizeFailedRequest(t,n);this.logger.info(`attempt failed, request: ${tD(t)} status=${i.status}`),this.onRequestFailed({abandoned:this.otherAttemptSuccessful,success:!1,request:i,attempt:this.requestsSent,attemptStartTimestamp:e,attemptResponseTimestamp:new Date().getTime()}),this.queueAttempt(i)})}getNextDelay(e){let t;if(e)t=0;else if(this.settings.enableRequestHedging)t=this.hedgeDelayMs;else if(this.requestsSent<=this.settings.retryIntervalsMs.length)t=this.settings.retryIntervalsMs[this.requestsSent-1];else throw"Unable to get next delay";return this.logger.info(`next delay= ${t} ms`),t}isRequestWithStatus(e,t){return!!e&&t.indexOf(e.status)>-1}isNotRetryable(e){return!sH(e?.status)}isAuthFailedStatus(e){return this.isRequestWithStatus(e,[sr.HTTP_STATUS_CODES.UNAUTHORIZED])}},gi={1:"POST",0:"GET",2:"PUT",3:"DELETE"},gn=class{constructor(e,t){this.signalingSession=e,this.callStartTime=t,this.pendingRequests={},this.sendGetRequest=e=>this.sendRequest(0,e),this.sendPostRequest=e=>this.sendRequest(1,e),this.sendPutRequest=e=>this.sendRequest(2,e),this.sendDeleteRequest=e=>this.sendRequest(3,e),this.cancelRequestIfPending=(e,t,i,n)=>{if(this.logger.info(`[${t}][cancelRequestIfPending]`),!this.pendingRequests[e])return void this.logger.info(`[${t}][cancelRequestIfPending]no pending request with name=${e}`);i?this.hasPendingRequest(e,i)&&this.cancelRequest(e,i,t,n):Object.keys(this.pendingRequests[e]).forEach(i=>this.cancelRequest(e,i,t,n))},this.cancelAllRequests=e=>{this.logger.info(`[${e}][cancelAllRequests]`);let t=[];return Object.keys(this.pendingRequests).forEach(i=>{Object.keys(this.pendingRequests[i]).forEach(n=>{t.push(this.cancelRequest(i,n,e))})}),Promise.all(t).catch(()=>void 0)},this.hasPendingRequest=(e,t)=>!!this.pendingRequests[e]&&!!(t?this.pendingRequests[e][t]:this.pendingRequests[e]),this.cancelRequest=(e,t,i,n)=>{try{return this.pendingRequests[e][t].dispatcher&&this.pendingRequests[e][t].dispatcher.cancelRequest(),this.pendingRequests[e][t].aborted=!0,this.pendingRequests[e][t].errorDetails=n,this.logger.info(`[${i}][cancelRequest]Request=${e} aborted ${n?`with errorDetails ${JSON.stringify(n)}`:""}`),this.pendingRequests[e][t].requestPromise.catch(()=>void 0)}catch(n){return this.logger.warn(`[${i}][cancelRequest]Unable to cancel request=${e}, requestId=${t}`),Promise.resolve()}},this.buildRequestTelemetry=(e,t,i,n)=>({name:`${gi[e]}-${t.requestName}`,url:t.url,eventStart:i-this.callStartTime,trouterReady:-1,requestReady:-1,status:-1,attempts:[],rtt:-1,uid:t.requestId,causeId:t.causeId,requestDispatcherConfig:n,enableRequestHedging:this.shouldEnableRequestHedging(n)}),this.addPendingRequest=e=>(this.pendingRequests[e.requestName]||(this.pendingRequests[e.requestName]={}),this.pendingRequests[e.requestName][e.requestId]={dispatcher:null,requestPromise:null,aborted:!1},this.pendingRequests[e.requestName][e.requestId]),this.sendRequest=(e,t)=>{let i;if(!t.url)return this.logger.error(t.requestName,"Link does not exist"),Promise.reject({code:sr.CALL_END_CODE.HTTP_OTHER_ERROR,subCode:sr.CALL_END_SUB_CODE.MISSING_REQUEST_URI,phrase:`Link does not exist for requestName: ${t.requestName}.`});t.requestId||(t.requestId=sm()),t.causeId||(t.causeId=sp());let n=!1,r=!1,s=this.logger.createChild(`[${t.causeId}][${t.requestName}]`);s.info("[scheduled]");let a=this.getInternalHttpDispatcherConfig(t.requestName,t.operationType);t.skipHttpTelemetry||(t.skipHttpTelemetry=!1);let o=hQ(),l=new Date().getTime(),c=[],d=this.buildRequestTelemetry(e,t,l,a),u=()=>{this.signalingSession.disposed?this.logger.info("Unable to record telemetry, session disposed"):this.signalingSession.telemetryHelper.updateNetworkRequest(d)},h=()=>{this.signalingSession.telemetryHelper.deleteNetworkRequest(d)};u();let g=(e,i,n)=>{if(!e?.request)return void this.logger.warn(t.requestName,"missing request details, unable to record for telemetry!");s.info(`[finished][status=${e.request.status}][statusText=${e.request.statusText}][retryCount=${e.attempt}]`);let a=e.request.status,o=e.request.response?.operationFailure?.subCode,c={status:a,statusSubCode:o||n,start:e.attemptStartTimestamp-l,end:e.attemptResponseTimestamp-l,online:sB(this.signalingSession.signalingAgentConfig.trouterServiceProvider)};e.abandoned&&(c.abandoned=!0),e.request.statusText&&(c.statusText=e.request.statusText),(i||!r)&&(d.status=a,d.statusSubCode=n||o),(i||!r&&a>=200&&a<400)&&(r=!0),d.attempts.push(c),u()};if(this.hasPendingRequest(t.requestName,t.requestId))return this.logger.warn(t.requestName,t.requestId,"is already pending request!!"),this.pendingRequests[t.requestName][t.requestId].requestPromise;i=this.addPendingRequest(t);let p=(e,i,n,r)=>{if(e&&t.skipHttpTelemetry){this.logger.info("Skipping telemetry"),h();return}s.info(`[steps=${c}]`),this.pendingRequests[t.requestName][t.requestId].aborted&&(d.aborted=!0),this.hasPendingRequest(t.requestName,t.requestId)?(delete this.pendingRequests[i][n],Object.keys(this.pendingRequests[i]).length||delete this.pendingRequests[i]):this.logger.warn("Unable to clean up!"),this.signalingSession.disposed||(r&&(d.error=r),d.rtt=o.duration(),this.signalingSession.telemetryHelper.addNetworkOperationCompleted(t.requestName,e,o.duration()),u(),this.signalingSession.telemetryHelper.sendHttpTelemetryData(d.uid))},f=e=>(...i)=>{if(this.signalingSession.disposed){let e=`[${t.causeId}][${t.requestName}][failed][reason=Session disposed]`;throw s.info("[failed][reason=Session disposed]"),Error(e)}if(this.hasPendingRequest(t.requestName,t.requestId)&&this.pendingRequests[t.requestName][t.requestId].aborted){let e,i=`[${t.causeId}][${t.requestName}][failed][reason=request already aborted]`,n=this.pendingRequests[t.requestName][t.requestId].errorDetails;throw n?(e=n).phrase=i:e=i,s.info(`${i}`),Error(JSON.stringify(e))}return e(...i)},m=f(()=>(c.push("[waitForTrouter]"),t.withoutTrouter?Promise.resolve():this.signalingSession.ensureMessageChannelReady(t.requestName))),v=f(()=>(c.push("[trouterReady]"),d.trouterReady=o.duration(),t.onceTrouterReady&&t.onceTrouterReady(),u(),Promise.resolve())),S=f(()=>{let i=this.signalingSession.signalingAgent.clientSupportsGenericTokenAPI,n=sz(this.signalingSession.signalingAgentConfig,i,e,t,!1,void 0,this.logger);return c.push("[buildRequest]"),h3({signalingSession:this.signalingSession,operation:t.requestName,data:t.payload,customHeaders:t.customHeaders?.getAll(),causeId:t.causeId,tokenRequestOptions:n,requestId:t.requestId,keepAlive:t.keepAlive},this.logger)}),y=e=>{let t,i={request:{status:sr.HTTP_STATUS_CODES.OTHER,statusText:"Local error"},attempt:1,success:!1,attemptResponseTimestamp:new Date().getTime(),attemptStartTimestamp:new Date().getTime()};e&&(e.skypeTokenError?(i.request={status:sr.CALL_END_SKYPE_TOKEN_ERROR.code,statusText:sr.CALL_END_SKYPE_TOKEN_ERROR.phrase},t=sr.CALL_END_SKYPE_TOKEN_ERROR.subCode):e.tokenError?(i.request={status:sr.CALL_END_TOKEN_ERROR.code,statusText:sr.CALL_END_TOKEN_ERROR.phrase},t=e.errorSubCode&&e.errorSubCode>0?e.errorSubCode:sr.CALL_END_TOKEN_ERROR.subCode):e.tokenTimeoutError&&(n?(i.request={status:sr.CALL_END_TOKEN_TIMEOUT_INTERACTIVITY_REQUIRED.code,statusText:sr.CALL_END_TOKEN_TIMEOUT_INTERACTIVITY_REQUIRED.phrase},t=sr.CALL_END_TOKEN_TIMEOUT_INTERACTIVITY_REQUIRED.subCode,e.tokenInteractivityRequiredTimeout=!0):(i.request={status:sr.CALL_END_TOKEN_TIMEOUT_ERROR.code,statusText:sr.CALL_END_TOKEN_TIMEOUT_ERROR.phrase},t=sr.CALL_END_TOKEN_TIMEOUT_ERROR.subCode))),g(i,!1,t)},C=f(e=>(c.push("[failedToBuildRequestOptions]"),y(e),Promise.reject(e))),b=f(e=>(c.push("[requestBuilt]"),d.requestReady=o.duration(),e.usedCachedSkypetoken&&(d.usedCachedSkypetoken=e.usedCachedSkypetoken),u(),Promise.resolve(e))),T=(i,r,s)=>{c.push("[authRequired]"),s?.IPCAFailure&&(n=!0);let a=this.signalingSession.signalingAgent.clientSupportsGenericTokenAPI,o=sz(this.signalingSession.signalingAgentConfig,a,e,t,!0,i,this.logger);return o.invalidToken=r,h3({signalingSession:this.signalingSession,operation:t.requestName,data:t.payload,customHeaders:t.customHeaders?.getAll(),causeId:t.causeId,forceFetchToken:!0,tokenRequestOptions:o,requestId:t.requestId},this.logger)},E=f(n=>{c.push("[sendRequest]");let r={...a,enableRequestHedging:this.shouldEnableRequestHedging(a),hedgeDelayMs:a.hedgeDelayMs,hedgeMaxParallelAttempts:this.signalingSession.signalingAgentConfig.hedgeMaxParallelAttempts,retryIntervalsMs:t.disableRetry||!a.retryIntervalsMs?[]:a.retryIntervalsMs,reportPreviousErrorsForTimeout:this.signalingSession.signalingAgentConfig.reportPreviousErrorsForTimeout},s=ge({logger:this.logger,causeId:t.causeId,dispatcher:this.signalingSession.signalingAgentConfig.httpRequestDispatcher,url:t.url,request:n,requestType:e,authRequiredCallback:T,attemptFailureCallback:e=>{g(e,!1)},settings:r});return i.dispatcher=s,u(),s.sendRequest()}),_=f(async e=>(g(e,!0),s.info("[success]"),p(!0,t.requestName,t.requestId),e)),I=e=>{let i=t_(e);s.info(`onFailure err:${i}`);let n=e;return e.error?.authCallBackFailure&&(n=e.error,s.info(`authCallBackerror:${t_(n)}`),y(n)),p(!1,t.requestName,t.requestId,i),!e||e.readyState||e.status?s.info(`[failed][reason=${i}]`):s.info(`[failed][offline][reason=${i}]`),Promise.reject(n)},w=Promise.resolve().then(m).then(v).then(S).catch(C).then(b).then(E).then(_).catch(I);return i.requestPromise=w,w},this.logger=this.signalingSession.logger.createChild("[HTTP]")}getInternalHttpDispatcherConfig(e,t="Other"){let i={...hX.Default,...h0[t],...hX[e]};return this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap&&(i={...i,...this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap[t]}),this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap&&(i={...i,...this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap.Default,...this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap[e]}),this.logger.info(`getInternalHttpDispatcherConfig request type: ${e} config: ${tI(i)}`),i}shouldEnableRequestHedging(e){return!!(this.signalingSession.getMeetingInfo()&&e.requestHedgingCapability.indexOf("enabledForMeetings")>-1||!this.signalingSession.multiParty&&e.requestHedgingCapability.indexOf("enabledForP2PCalls")>-1)||!!(this.signalingSession.multiParty&&e.requestHedgingCapability.indexOf("enabledForGroupCalls")>-1)||!!(e.requestHedgingCapability.indexOf("enabled")>-1)||!1}};function gr(e,t,i){sy(e,"signalingSession cannot be null");let n=[];i&&(n=sT(i),e.telemetryHelper.addOutgoingModalities(n));let r=sp();return{payload:{mediaNegotiation:{callModalities:n,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAnswer:so(e,rG.MEDIA_ANSWER,r),rejection:so(e,rG.MEDIA_REJECTION,r)},mediaContent:t}}}}function gs(e,t){return sy(e,"signalingSession cannot be null"),sC(t),{payload:{mediaNegotiationFailure:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},code:t.code,subCode:t.subCode,phrase:t.phrase},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}}}function ga(e,t,i){sy(e,"signalingSession cannot be null");let n=[];return i&&(n=sT(i),e.telemetryHelper.addOutgoingModalities(n)),{payload:{mediaAnswer:{callModalities:n,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAcknowledgement:so(e,rG.MEDIA_ACKNOWLEDGEMENT)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}}}var go=class{constructor(e,t,i){this.telemetryHelper=i,this.vbssInitiated=!1,this.disposed=!1,this.fsmState=sr.MEDIA_RENEGOTIATION_FSM_STATE.IDLE,this.fsmStateCauseId="",this.links={},this.renegotiationOffersSeenSoFar=[],this.isOutgoingRenegotiationInProgress=()=>this.fsmState===sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION||this.fsmState===sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,this.isIncomingRenegotiationInProgress=()=>this.fsmState===sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION||this.fsmState===sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,this.acceptRenegotiationAsync=(e,t,i)=>{this.logger.info(`[${i}][acceptRenegotiationAsync][mediaTypes=${t}]`),this.signalingSession.telemetryHelper.recordEvent(lo,{mediaTypes:t,causeId:i}),sS(this.links[sr.LINKS.MEDIA_ANSWER],"MediaAnswer link not set");let n=sV();switch(this.fsmState){case sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,i);break;case sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,i);break;default:return this.logger.info(`[${i}][acceptRenegotiationAsync]there is no incoming media renegotiation offer to accept`),n.reject(Error("there is no incoming media renegotiation offer to accept")),n.promise}let r=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT,this.handleMediaAnswerAcknowledgmentTimeout.bind(this,i),this.signalingSession.getTimeoutValue("mediaAnswerAcknowledgementTimeoutSec"))};return this.signalingSession.http.sendPostRequest({url:this.links[sr.LINKS.MEDIA_ANSWER],payload:ga(this.signalingSession,e,t),requestName:u3.SEND_MEDIA_ANSWER.name,onceTrouterReady:r,causeId:i}).then(e=>{n.resolve(e.response)}).catch(e=>{let t=sM(e,this.signalingSession.signalingAgentConfig);this.logger.info(`[${i}][acceptRenegotiationAsync] error: ${t_(t)}`),this.disposed||this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),n.reject(Error(`acceptRenegotiationAsync failed because : ${t_(e)}`))}),n.promise},this.startRenegotiationAsync=(e,t,i,n)=>{this.logger.info(`[${n}][startRenegotiationAsync][mediaTypes=${i}]`),this.signalingSession.telemetryHelper.recordEvent(ll,{causeId:n,mediaTypes:i}),sS(t,"MediaRenegotiation link not set");let r=sV();switch(this.fsmState){case sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,n);break;case sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:case sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:case sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return this.logger.info(`[${n}][startRenegotiationAsync][failed] can only be performed with no current outstanding renegotiations, previous negotiation causeId=${this.fsmStateCauseId}`),this.signalingSessionCallback.onMediaRenegotiationRejection(this.getGlareError(),n),Promise.resolve(null);default:return this.logger.info(`[${n}][startRenegotiationAsync][failed] can only be performed on an established call`),r.reject(Error("media renegotiation can only be performed on an established call")),r.promise}let s=i&&sI(i,sr.MEDIA_TYPES.SCREEN_SHARER);s?(this.vbssInitiated=!0,this.signalingSession.telemetryHelper.addVbssOperations(ha.START)):!s&&this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(ha.STOP));let a=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER,this.handleMediaAnswerTimeout.bind(this),this.signalingSession.getTimeoutValue("mediaAnswerTimeoutSec"))};return this.signalingSession.http.sendPostRequest({url:t,payload:gr(this.signalingSession,e,i),requestName:u3.START_RENEGOTIATION.name,onceTrouterReady:a,causeId:n}).then(e=>{r.resolve(e.response)}).catch(e=>{let t=sM(e,this.signalingSession.signalingAgentConfig);if(this.logger.info(`[${n}][startRenegotiationAsync] error: ${t_(t)}`),!this.disposed){switch(this.fsmState){case sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,n);break;case sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,n)}this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER)}r.reject(Error(`startRenegotiationAsync failed because : ${t_(e)}`))}),r.promise},this.handleMediaAcknowledgment=(e,t)=>{this.signalingSession.telemetryHelper.recordEvent(o9,{causeId:t}),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),this.signalingSession.saveMediaControllerLinksIfAny(e),this.signalingSession.saveUpdatedCallLinksIfAny(e),this.signalingSessionCallback.onMediaAcknowledgementSuccess(!0,t)},this.onCallConnected=e=>{this.logger.info("onCallConnected"),this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,e)},this.handleMediaNegotiationFailure=e=>{let t=sk(e);this.signalingSession.telemetryHelper.recordIncomingEvent(o7,e),this.handleMediaNegotiationFailureInternal(e.body.mediaNegotiationFailure,e.origin,t)},this.handleMediaAnswer=(e,t)=>{switch(this.logger.info(`[${t}][handleMediaAnswer]`),this.signalingSession.telemetryHelper.recordEvent(le,{causeId:t}),this.fsmState){case sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,t);break;case sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,t);break;default:return}this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER);let i=[];e.mediaAnswer.callModalities&&e.mediaAnswer.callModalities.length>0&&(i=sT(e.mediaAnswer.callModalities),this.signalingSession.telemetryHelper.addIncomingModalities(i));let n={provisional:!1,renegotiation:!0,mediaTypes:i,remoteParticipantId:this.signalingSession.getParticipantIdForOfferAnswer(e.mediaAnswer.mediaContent),mediaContent:e.mediaAnswer.mediaContent};this.signalingSession.http.sendPostRequest({url:e.mediaAnswer.links.mediaAcknowledgement,payload:null,requestName:u3.SEND_MEDIA_ACKNOWLEDGEMENT.name,causeId:t}).catch(e=>{let i=sM(e,this.signalingSession.signalingAgentConfig);this.logger.info(`[${t}][handleMediaAnswer] error: ${t_(i)}`),this.signalingSession.disposed||this.signalingSession.telemetryHelper.recordEvent(lt,{causeId:t})}),this.signalingSessionCallback.onAnswer(n,t)},this.handleMediaNegotiationOffer=e=>{let t=e.body,i=e.headers,n=sk(e);this.logger.info(`[${n}][handleMediaNegotiationOffer]`),this.signalingSession.telemetryHelper.recordIncomingEvent(li,e);let r=sD(i,this.renegotiationOffersSeenSoFar);switch(this.fsmState){case sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,n),this.raiseMediaRenegotiationOffer(t,n);break;case sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,n),this.raiseMediaRenegotiationOffer(t,n);break;case sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:if(this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.supportMediaRetargetWhileIncomingRenegotiation){this.raiseMediaRenegotiationOffer(t,n);break}this.rejectAndLog(n,r,t);break;default:this.rejectAndLog(n,r,t)}},this.rejectRenegotiationAsync=(e,t)=>{this.logger.info(`[${t}][rejectRenegotiationAsync]`),this.signalingSession.telemetryHelper.recordEvent(ln,{rejectionData:e,causeId:t}),sS(this.links[sr.LINKS.MEDIA_REJECTION],"MediaRejection link not set");let i=e||{code:sr.CALL_END_CODE.NOT_ACCEPTABLE_HERE,subCode:sr.CALL_END_SUB_CODE.MEDIA_ANSWER_PROCESSING_ERROR,phrase:sr.CALL_END_PHRASE.MEDIA_ANSWER_ERROR};switch(this.fsmState){case sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:return this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,t),this.rejectMediaRenegotiation(this.links[sr.LINKS.MEDIA_REJECTION],i,t);case sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,t),this.rejectMediaRenegotiation(this.links[sr.LINKS.MEDIA_REJECTION],i,t);default:return this.logger.error(`[${t}][rejectRenegotiationAsync][failed] There is no incoming media renegotiation offer to reject`),Promise.resolve(null)}},this.handleRetargetCompleted=e=>{let t=e.body.retargetCompleted,i=sk(e);this.logger.info(`[${i}][handleRetargetCompleted][details=${t_(t)}]`),this.signalingSession.telemetryHelper.recordIncomingEvent(lr,e,tT(t)),0===t.code?this.signalingSessionCallback.onReTargetCompletedSuccess(i):this.signalingSessionCallback.onReTargetCompletedFailure(t,i)},this.dispose=()=>{this.logger.info("mediaRenegotiationManager :: dispose"),this.disposed=!0},this.getGlareError=()=>({code:sr.CALL_END_CODE.GLARE_ERROR,subCode:sr.CALL_END_SUB_CODE.MEDIA_GLARE_ERROR,phrase:sr.CALL_END_PHRASE.RENEGOTIATION_IN_PROGRESS,previousNegotiationCauseId:this.fsmStateCauseId}),this.handleMediaNegotiationFailureInternal=(e,t,i)=>{switch(this.logger.info(`[${i}][handleMediaNegotiationFailureInternal][failureData=${tT(e)}]`),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER),this.fsmState){case sr.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,i);break;case sr.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:this.setFsmState(sr.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,i);break;default:return}this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(ha.REJECTED)),this.signalingSession.telemetryHelper.addIncomingModalities(["Rejected"]),this.signalingSessionCallback.onMediaRenegotiationRejection({code:e.code,subCode:e.subCode,phrase:e.phrase},i)},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(()=>`[RenegotiationManager][${this.fsmState}][stateCauseId=${this.fsmStateCauseId}]`)}rejectAndLog(e,t,i){this.logger.error(`[${e}][handleMediaNegotiationOffer] Cannot handle the incoming mediaRenegotiation offer in present callstate. Either call not connected or renegotiation in progress. isDuplicateOffer=${t}`),t||this.rejectMediaRenegotiation(i.mediaNegotiation.links.rejection,this.getGlareError(),e)}setFsmState(e,t){this.fsmState=e,this.fsmStateCauseId=t,this.logger.info(`[setFsmState]state=${e}`),this.telemetryHelper.recordEvent(lc,{state:e,causeId:t})}raiseMediaRenegotiationOffer(e,t){this.logger.info(`[${t}][raiseMediaRenegotiationOffer]`),this.links[sr.LINKS.MEDIA_ANSWER]=e.mediaNegotiation.links.mediaAnswer,this.links[sr.LINKS.MEDIA_REJECTION]=e.mediaNegotiation.links.rejection;let i=[];e.mediaNegotiation.callModalities&&e.mediaNegotiation.callModalities.length>0&&(i=sT(e.mediaNegotiation.callModalities),this.signalingSession.telemetryHelper.addIncomingModalities(i),sI(i,sr.MEDIA_TYPES.SCREEN_SHARER)&&this.signalingSession.telemetryHelper.addVbssOperations(ha.REMOTE_START));let n={mediaTypes:i,remoteParticipantId:this.signalingSession.getParticipantIdForOfferAnswer(e.mediaNegotiation.mediaContent),mediaContent:e.mediaNegotiation.mediaContent,renegotiation:!0};this.signalingSessionCallback.onOffer(n,t)}rejectMediaRenegotiation(e,t,i){this.logger.info(`[${i}][rejectMediaRenegotiation][rejectionData=${tT(t)}]`);let n=sV();return this.signalingSession.http.sendPostRequest({url:e,payload:gs(this.signalingSession,t),requestName:u3.SEND_MEDIA_REJECTION.name,causeId:i}).then(e=>{n.resolve(e.response)}).catch(e=>{let t=sM(e,this.signalingSession.signalingAgentConfig);this.logger.info(`[${i}][rejectMediaRenegotiation] error: ${t_(t)}`),n.reject(Error(`rejectMediaRenegotiation failed because : ${t_(e)}`))}),n.promise}handleMediaAnswerTimeout(e){this.logger.info(`[${e}][handleMediaAnswerTimeout]`),this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(ha.TIMEOUT)),this.signalingSession.telemetryHelper.addIncomingModalities(["Timeout"]),this.signalingSession.telemetryHelper.recordEvent(ls),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER),this.handleMediaNegotiationFailureInternal({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.MEDIA_FINAL_ANSWER_TIMEOUT,phrase:sr.CALL_END_PHRASE.MEDIA_FINAL_ANSWER_TIMEOUT},u4.LOCAL,e)}handleMediaAnswerAcknowledgmentTimeout(e){this.logger.info(`[${e}][handleMediaAnswerAcknowledgmentTimeout]`),this.signalingSession.telemetryHelper.recordEvent(la),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT);let t={reason:"timed out waiting for Media Answer Acknowledgement"};this.signalingSessionCallback.onMediaAcknowledgementFailure(!0,t,e)}},gl=class{constructor(){this.requests={}}clear(e,t){let i=t||{code:sr.CALL_END_CODE.SUCCESS,subCode:sr.CALL_END_SUB_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach(t=>{this.rejectOperation(t,e,i)})}hasOperation(e){return this.requests.hasOwnProperty(e)}getAllOperations(){return this.requests}getOperation(e){return this.hasOperation(e)?this.requests[e]:null}setOperation(e,t){return!this.hasOperation(e)&&(this.requests[e]=t,!0)}rejectOperation(e,t,i){let n=Error(t);if(i&&(n.endCode=i),this.hasOperation(e)){let t=this.requests[e].promise;delete this.requests[e],t.reject(n)}}resolveOperation(e,t){if(this.hasOperation(e)){let i=this.requests[e].promise;delete this.requests[e],i.resolve(t)}}},gc=class{constructor(e){this.logger=e,this.localAddParticipantRequests=new gl,this.localAdmitParticipantRequests=new gl,this.localCallMeBackRequests=new gl,this.localRemoveParticipantEndpointRequests=new gl,this.localRemoveParticipantRequests=new gl,this.localUpdateParticipantInterpretationStateRequest=new gl,this.participantIdMriMap=new Map}dispose(e,t,i){this.logger.info(`[${i}][dispose]`),this.rejectAllPendingOperations(e,t)}getAllPendingOperations(e,t){this.logger.info(`[${t}][getAllPendingOperations] ${e}`);let i=this.getOperationTable(e);return i?i.getAllOperations():null}getPendingOperation(e,t,i){this.logger.info(`[${i}][getPendingOperation] ${e} ${t}`);let n=this.getOperationTable(e);return n?n.getOperation(t):null}getRnlMri(e,t){for(let i of(this.logger.info(`[${t}][getRnlMri] ${e}`),e))if(this.participantIdMriMap.has(i))return this.participantIdMriMap.get(i);return""}hasPendingOperation(e,t,i){this.logger.info(`[${i}][hasPendingOperation] ${e} ${ta(t)}`);let n=this.getOperationTable(e);return!!n&&n.hasOperation(t)}rejectPendingOperation(e,t,i,n,r){this.logger.info(`[${r}][rejectPendingOperation] ${e} ${ta(t)} reason: ${i}`);let s=this.getOperationTable(e);s&&s.rejectOperation(t,i,n)}resolvePendingOperation(e,t,i,n){this.logger.info(`[${n}][resolvePendingOperation]: ${ta(t)}`);let r=this.getOperationTable(e);r&&r.resolveOperation(t,i)}setPendingOperation(e,t,i,n){this.logger.info(`[${n}][setPendingOperation] ${e} ${ta(t)} value: ${i}`);let r=this.getOperationTable(e);if(!r)return!1;if(0===e){let e=i&&i.participant&&i.participant.participantId;e&&this.participantIdMriMap.set(e,t)}return r.setOperation(t,i)}setParticipantIdToMriMapping(e,t,i,n){n?(this.logger.info(`[${i}][setParticipantIdMriMap] ${tu(e)}: ${ta(t)} clear mapping.`),this.participantIdMriMap.delete(e)):e&&t&&(this.logger.info(`[${i}][setParticipantIdMriMap] ${tu(e)}: ${ta(t)}`),this.participantIdMriMap.set(e,t))}getOperationTable(e){switch(e){case 0:return this.localAddParticipantRequests;case 1:return this.localAdmitParticipantRequests;case 2:return this.localCallMeBackRequests;case 4:return this.localRemoveParticipantEndpointRequests;case 3:return this.localRemoveParticipantRequests;case 5:return this.localUpdateParticipantInterpretationStateRequest;default:return null}}rejectAllPendingOperations(e,t){this.logger.info("rejectLocalQueuedOperations"),this.localAddParticipantRequests.clear(e,t),this.localAdmitParticipantRequests.clear(e,t),this.localCallMeBackRequests.clear(e,t),this.localRemoveParticipantRequests.clear(e,t),this.localRemoveParticipantEndpointRequests.clear(e,t),this.localUpdateParticipantInterpretationStateRequest.clear(e,t)}};function gd(e,t,i,n){sy(e,"signalingSession cannot be null");let r=i.groupId?{id:i.groupId}:null,s=i.threadId?{threadId:i.threadId,messageId:i.messageId||null}:null,a=[],o={};t&&t.length>0?(a=t.map(t=>({id:t.nonMaskedId?t.nonMaskedId:t.id,assertedId:t.assertedId,displayName:t.displayName,participantId:t.participantId,...i.invitationPreferences&&{invitationPreferences:i.invitationPreferences},replacementDetails:3===i.replacementType?e.getReplacementDetailsByParticipantLegOfCall(i.callIdToReplace,t.id,t.replacementParticipantId):void 0})),o={addParticipantSuccess:so(e,rG.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:so(e,rG.CONV_ADD_PARTICIPANT_FAILURE)}):o={addModalitySuccess:so(e,rG.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:so(e,rG.CONV_ADD_MODALITY_FAILURE)};let l={payload:{disableUnmute:i&&i.disableUnmute,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:a},participantInvitationData:s1(i),replacementDetails:3===i.replacementType?void 0:n,groupContext:r,groupChat:s,links:o}};return i&&i.alternateId&&(l.payload.participants.from.alternateId=i.alternateId),i?.callingLineIdentity&&(l.payload.participants.from.callingLineIdentity=i.callingLineIdentity),i?.clientScenario&&(l.payload.debugContent={clientScenario:i.clientScenario}),l}function gu(e,t,i,n){sy(e,"signalingSession cannot be null");let r=t.map(e=>(sy(e,"remoteParticipant cannot be null"),{id:e.id,assertedId:e.assertedId,displayName:e.displayName,participantId:e.participantId,...i.invitationPreferences&&{invitationPreferences:i.invitationPreferences}}));return{payload:{disableUnmute:i&&i.disableUnmute,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,alternateId:i?i.alternateId:null,callingLineIdentity:i?i.callingLineIdentity:null},to:r},participantInvitationData:s1(i),replacementDetails:n,links:{addParticipantSuccess:so(e,rG.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:so(e,rG.CONV_ADD_PARTICIPANT_FAILURE)},debugContent:{clientScenario:i.clientScenario}}}}function gh(e,t,i){return sy(e,"signalingSession cannot be null"),sy(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{admitFailure:so(e,rG.CONV_ADMIT_PARTICIPANT_FAILURE),admitSuccess:so(e,rG.CONV_ADMIT_PARTICIPANT_SUCCESS)},debugContent:{causeId:i}}}}function gg(e){return sy(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"]}}}function gp(e,t,i,n=!1,r=null){sy(e,"signalingSession cannot be null"),sy(t,"muteScope be null"),sy(i,"participantList cannot be null");let s={from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:t,muteParticipants:i,mediaTypes:["audio"]};return n&&(s.links={clientCallback:so(e,rG.MUTE_UNMUTE_ASYNC,r)},s.operationId=r),{payload:s}}function gf(e,t,i,n,r,s){sy(e,"signalingSession cannot be null"),sy(t,"participantsIds cannot be null");let a=e.groupId?{id:e.groupId}:null,o=n?{threadId:n,messageId:r||null}:null,l=[];return t.forEach(e=>{let t={id:e};l.push(t)}),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},invitationType:sr.INVITATION_TYPE.NUDGE,to:l},participantInvitationData:s,groupContext:a,groupChat:o,links:{nudgeParticipantSuccess:so(e,rG.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:so(e,rG.CONV_NUDGE_PARTICIPANT_FAILURE)}}}}function gm(e,t,i){sy(e,"signalingSession cannot be null"),sy(t,"participantsIds cannot be null");let n=[];return t.forEach(e=>{let t={id:e};n.push(t)}),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},invitationType:sr.INVITATION_TYPE.NUDGE,to:n},participantInvitationData:i,links:{nudgeParticipantSuccess:so(e,rG.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:so(e,rG.CONV_NUDGE_PARTICIPANT_FAILURE),addParticipantSuccess:so(e,rG.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:so(e,rG.CONV_ADD_PARTICIPANT_FAILURE)}}}}function gv(e,t){return sy(e,"signalingSession cannot be null"),sC(t),{payload:{transactionEnd:t}}}function gS(e,t,i){return sy(e,"signalingSession cannot be null"),sy(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:i,toEndpoints:[{id:t.id,endpointId:t.endpointId}]},links:{removeParticipantSuccess:so(e,rG.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:so(e,rG.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}function gy(e,t){return sy(e,"signalingSession cannot be null"),sy(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{removeParticipantSuccess:so(e,rG.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:so(e,rG.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}function gC(e,t=!1,i=null){sy(e,"signalingSession cannot be null");let n={from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"]};return t&&(n.links={clientCallback:so(e,rG.MUTE_UNMUTE_ASYNC,i)},n.operationId=i),{payload:n}}function gb(e,t,i,n=""){sy(i&&"specified"===i,"Only non-null non-empty scope of 'specified' is supported."),sy(e,"signalingSession cannot be null"),sy(t,"participantsIds cannot be null");let r=[];return t.forEach(e=>{let t={id:e,meetingRole:n};r.push(t)}),{payload:{from:{id:e.participantManager.localParticipant.id,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:i,to:r}}}function gT(e,t,i){return sy(e,"signalingSession cannot be null"),sy(t,"options cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id},to:t,links:{updateParticipantInterpretationStateStatus:so(e,rG.UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS)},operationId:i}}}var gE=eR(i(892891)),g_=class{constructor(e,t){this.participantManager=e,this.logger=t,this.handleRosterUpdate=(e,t,i,n)=>{if("Delta"!==e.type&&"MultiPartyEndpoint"!==e.type)return void this.logger.warn(`[${n}][handleRosterUpdate][sequenceNumber=${e.sequenceNumber}] invalid roster type ${e.type}`);if(void 0===e.sequenceNumber&&(e.sequenceNumber=this.lastRosterUpdateSeqNumber),this.logger.info(`[${n}][handleRosterUpdate][sequenceNumber=${e.sequenceNumber}]`),this.rostersInLifetime.add(e.sequenceNumber),"Delta"===e.type)this.logger.info(`[${n}][handleRosterUpdate], RosterType: Delta, isFullRoster: ${i}`),this.handleDeltaRoster(e,i,t,n);else{if(this.logger.info(`[${n}][handleRosterUpdate], RosterType: MultiPartyEndpoint`),this.isRosterStale(e,n)){this.participantManager.signalingSession.telemetryHelper.recordEvent(dn,{lastRosterUpdateSeqNumber:this.lastRosterUpdateSeqNumber,sequenceNumber:e.sequenceNumber,causeId:n}),this.logger.info(`[${n}][handleRosterUpdate] Ignoring old roster update: received ${e.sequenceNumber}, but already handled ${this.lastRosterUpdateSeqNumber}`);return}for(let i of Object.keys(e.participants)){let r=o8.fromRoster(e.participants[i]);this.handleRosterParticipant(r,t,n)}this.checkForRemovedParticipants(t,e.participants,n),this.participantManager.signalingSessionCallback.onParticipantCountsUpdated(e.participantCounts,n)}if(e.sequenceNumber>this.lastRosterUpdateSeqNumber){this.participantManager.signalingSessionCallback.onParticipantCountsUpdated(e.participantCounts,n),this.lastRosterUpdateSeqNumber=e.sequenceNumber,this.firstRosterUpdateSeqNumber<0&&(this.firstRosterUpdateSeqNumber=this.lastRosterUpdateSeqNumber);let t=Object.keys(e.participants||0).length;this.participantCountInFirstRoster<0&&(this.participantCountInFirstRoster=t),this.maxConcurrentParticipantsDuringLeg=Math.max(this.maxConcurrentParticipantsDuringLeg,t)}this.recordTelemetry(e,i,n),this.participantManager.signalingSessionCallback.onRosterHandlingComplete()},this.isRosterStaleFromFull=(e,t)=>(this.logger.info(`[${t}][isRosterStale] ${e.sequenceNumber<this.lastFullRosterSeqNumber}`),e.sequenceNumber<this.lastFullRosterSeqNumber),this.isRosterStale=(e,t)=>(this.logger.info(`[${t}][isRosterStale] ${e.sequenceNumber<this.lastRosterUpdateSeqNumber}`),e.sequenceNumber<this.lastRosterUpdateSeqNumber),this.updateLocalParticipantFromSubscribe=(e,t)=>{this.logger.info(`[${t}][updateLocalParticipantFromSubscribe]`),this.updateLocalParticipant(e,t)},this.handleParticipantAcceptedBy=(e,t,i)=>{let n=t.hasOwnProperty(e.id),r=e.id===e.acceptedBy.id;this.logger.info(`[${i}][RosterManager::handleParticipantAcceptedBy] oldParticipantInRoster: ${n}`),this.participantManager.participantOperationHandler.setParticipantIdToMriMapping(e.participantId,e.id,i,!0),n&&!r&&this.handleRemovedDeltaRosterParticipant(new o8({id:e.id}),this.lastRosterUpdateSeqNumber,t,i)},this.lastRosterUpdateSeqNumber=-1,this.lastFullRosterSeqNumber=-1,this.firstRosterUpdateSeqNumber=-1,this.tombstoneSequence=new Map,this.latestRosterVersionForActiveParticipants=new Map,this.rostersInLifetime=new Set,this.maxConcurrentParticipantsDuringLeg=-1,this.participantCountInFirstRoster=-1}recordTelemetry(e,t,i){let n={participantCountInLastRoster:Object.keys(e.participants||0).length,participantCountInFirstRoster:this.participantCountInFirstRoster,sequenceNumberOfLastRoster:this.lastRosterUpdateSeqNumber,sequenceNumberOfLastFullRoster:this.lastFullRosterSeqNumber,sequenceNumberOfFirstRoster:this.firstRosterUpdateSeqNumber,rosterType:e.type,isFullRoster:t,maxConcurrentParticipantsDuringLeg:this.maxConcurrentParticipantsDuringLeg,totalParticipantsDuringLifetimeOfLeg:this.tombstoneSequence.size+this.latestRosterVersionForActiveParticipants.size,countOfMissingNotifications:this.getMissingNotificiations()};this.logger.info(`[recordTelemetry] data ${JSON.stringify(n,null,4)}`),this.participantManager.signalingSession.telemetryHelper.recordRosterEvent(n,lx,i)}getMissingNotificiations(){let e=this.lastRosterUpdateSeqNumber-this.firstRosterUpdateSeqNumber+1-this.rostersInLifetime.size;return e>0?e:0}isParticipantRosterStale(e,t){if(this.logger.info(`[isParticipantRosterStale], rosterParticipantVersion ${t}`),t){if(this.tombstoneSequence.has(e))return t<=this.tombstoneSequence.get(e);else if(this.latestRosterVersionForActiveParticipants.has(e))return t<=this.latestRosterVersionForActiveParticipants.get(e)}return!1}handleDeltaRoster(e,t,i,n){if(this.logger.info(`[${n}][handleDeltaRoster] isFullRoster ${t}`),this.isRosterStaleFromFull(e,n)){this.participantManager.signalingSession.telemetryHelper.recordEvent(dn,{lastRosterUpdateSeqNumber:this.lastRosterUpdateSeqNumber,lastFullRosterSeqNumber:this.lastFullRosterSeqNumber,sequenceNumber:e.sequenceNumber,causeId:n}),this.logger.info(`[${n}][handleRosterUpdate] Ignoring old roster update: received ${e.sequenceNumber}, but already handled full roster ${this.lastFullRosterSeqNumber}`);return}if(t){for(let t of Object.keys(i))if(!e.participants.hasOwnProperty(t)&&!this.isParticipantRosterStale(t,e.sequenceNumber)){let r=new o8({id:t});this.logger.info(`[${n}][handleRosterUpdate] participant missing from delta, full roster`),this.handleRemovedDeltaRosterParticipant(r,e.sequenceNumber,i,n)}this.lastFullRosterSeqNumber=e.sequenceNumber}else if(!e?.participants)return void this.logger.warn(`[${n}][handleRosterUpdate] participants blob empty in delta roster`);for(let t of Object.keys(e.participants)){let r=e.participants[t];if(!this.isParticipantRosterStale(t,r.version)){let e=o8.fromRoster(r);r.state&&"active"===r.state?(this.logger.info(`[${n}][handleDeltaRoster] participant active`),this.handleRosterParticipant(e,i,n),this.tombstoneSequence.has(t)&&this.tombstoneSequence.delete(t),this.latestRosterVersionForActiveParticipants.set(t,r.version)):r.state&&"inactive"===r.state?(e=e||new o8({id:r.details.id}),this.logger.info(`[${n}][handleDeltaRoster] participant inactive`),this.handleRemovedDeltaRosterParticipant(e,r.version,i,n)):this.logger.info(`[${n}][handleDeltaRoster] unexpected participant state ${r.state}`)}}this.handleRemoveParticipantRequests(this.getActiveParticipants(e.participants),n)}getRnlMri(e,t){let i=this.participantManager.participantOperationHandler;if(e){let n=this.getRnlParticipantIdsFromRoster(e,t);return i.getRnlMri(n,t)}return""}handleRemovedDeltaRosterParticipant(e,t,i,n){let r=e.id,s=this.getRnlMri(e,n),a="";i.hasOwnProperty(r)?a=r:i.hasOwnProperty(s)&&(a=s),a&&this.handleRemovedParticipant(i,a,n),this.tombstoneSequence.set(r,t),this.latestRosterVersionForActiveParticipants.has(r)&&this.latestRosterVersionForActiveParticipants.delete(r)}handleRemovedParticipant(e,t,i){let n=this.participantManager.signalingSessionCallback,r=this.participantManager.signalingSession;!1!==e[t]&&(sP(this.participantManager.connectedRemoteParticipantIds,t),this.logger.info(`[${i}][handleRemovedParticipant] ${ta(t)} removed from roster`),n.onParticipantRemoved({id:t},i),r.clearParticipantCallLinks(t))}getActiveParticipants(e){let t={};for(let i of Object.keys(e))"inactive"!==e[i].state&&(t[i]=e[i]);return t}handleRosterParticipant(e,t,i){if(!e)return void this.logger.info(`[handleRosterParticipant][${i}] rosterParticipant processing skipped because null.`);if(e.id===this.participantManager.localParticipant.id){this.updateLocalParticipant(e,i);let t=this.getLocalEndpoint(),n=gE.find(e.endpointDetails,e=>t?.participantId===e?.participantId),r=!!(n?.stream||n?.streamLobby),s=0===this.participantManager.signalingSession.callMode;this.logger.info(`[handleRosterParticipant][${i}] isStreaming:${r} isInitialMode:${s} selfParticipant: $${!!n}`),r&&s?this.participantManager.signalingSession.configureStreamingMode(i):r||this.participantManager.signalingSession.setRealTimeState(1,i);return}let n=this.participantManager.participantOperationHandler,r=this.participantManager.signalingSession,s=this.participantManager.signalingSessionCallback,a=e.id,o=this.getRnlMri(e,i),l=this.getRnlParticipantIdsFromRoster(e,i);r.remoteCaller&&-1!==l.indexOf(r.remoteCaller.participantId)&&(e.displayName=r.remoteCaller.displayName),sw(this.participantManager.connectedRemoteParticipantIds,e.id,!0);let c=t.hasOwnProperty(e.id),d=t.hasOwnProperty(o);for(let s of((c||d)&&(t[e.id]=!1),n.hasPendingOperation(0,e.id,i)&&this.isParticipantInCall(e)?(this.logger.info(`participant ${ta(e.id)} appears in roster. Resolving AddParticipant request`),r.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),n.resolvePendingOperation(0,e.id,e,i)):o&&n.hasPendingOperation(0,o,i)&&this.isParticipantInCall(e)?(this.logger.info(`RNL participant ${ta(o)} appears in roster. Resolving AddParticipant request`),r.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,o),n.resolvePendingOperation(0,o,e,i)):n.hasPendingOperation(1,e.id,i)&&this.isParticipantInCall(e)&&(this.logger.info(`participant: ${ta(e.id)} appears in roster. Resolving AdmitParticipant request`),r.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),n.resolvePendingOperation(1,e.id,e,i)),e.endpointDetails))n.hasPendingOperation(0,s.participantId,i)&&this.isParticipantInCall(e)&&(this.logger.info(`participant ${ta(e.id)} appears in roster. Resolving AddParticipant request`),r.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,s.participantId),n.resolvePendingOperation(0,s.participantId,e,i));c?(this.logger.info(`participantIds=[${l}] updated ${ta(e.id)}`),s.onParticipantUpdated(e,i),r.setParticipantCallLinks(e)):d?(this.logger.info(`RNL participant participantIds=[${l}] removed old ${ta(o)} and added new ${ta(a)}`),s.onParticipantRemoved({id:o},i,!0),r.clearParticipantCallLinks(o),s.onParticipantJoined(e,i),r.setParticipantCallLinks(e)):n.hasPendingOperation(3,e.id,i)?this.logger.info(`participantIds=[${l}] ignored ${ta(e.id)}`):(this.logger.info(`participantIds=[${l}] joined ${ta(e.id)}`),s.onParticipantJoined(e,i),r.setParticipantCallLinks(e))}getLocalEndpoint(){return gE.find(this.participantManager.localParticipant.endpointDetails,e=>this.participantManager.localParticipant.endpointId===e.endpointId)}getRnlParticipantIdsFromRoster(e,t){let i=[];for(let t of e.endpointDetails)i.push(t.participantId);return this.logger.info(`[${t}][getRnlParticipantIdsFromRoster] ${JSON.stringify(i)}`),i}isParticipantInCall(e){return e.endpointDetails?.[0]&&!e.endpointDetails[0].isLobby}updateLocalParticipant(e,t){let i=this.participantManager.localParticipant,n=this.participantManager.signalingSession,r=this.participantManager.signalingSessionCallback;n.setParticipantCallLinks(e),this.logger.info(`[${t}][updateLocalParticipant]`);let s=!1;if(e?.endpointDetails){let a=gE.find(e.endpointDetails,e=>i.endpointId===e.endpointId),o=gE.find(i.endpointDetails,e=>i.endpointId===e.endpointId);s=hI(a),a?.isLobby&&!o?.isLobby?n.telemetryHelper.recordEvent(c6,{causeId:t}):a&&!a.isLobby&&(!o||o.isLobby)&&(s?n.telemetryHelper.recordEvent(c8,{causeId:t}):n.telemetryHelper.recordEvent(c5,{causeId:t})),a?.broadcastMeetingRole&&i&&i.broadcastMeetingRole!==a.broadcastMeetingRole&&(i.broadcastMeetingRole=a.broadcastMeetingRole,n.telemetryHelper.setBroadcastMeetingRole(a.broadcastMeetingRole)),r.onMeetingGroupDetailsUpdated(a?.meetingGroupDetails,t)}if(e?.meetingRole&&n.telemetryHelper.setMeetingRole(e.meetingRole),e?.advancedMeetingRole&&n.telemetryHelper.setAdvancedMeetingRole(e.advancedMeetingRole),e?.meetingRoles&&n.telemetryHelper.setMeetingRoles(e.meetingRoles),e?.participantType&&n.telemetryHelper.setParticipantType(e.participantType),e&&(i.endpointDetails=e.endpointDetails||[],i.acceptedBy=e.acceptedBy,i.role=e.role,i.meetingRole=e.meetingRole,i.advancedMeetingRole=e.advancedMeetingRole,i.meetingRoles=e.meetingRoles,i.participantType=e.participantType,i.tenantId=e.tenantId,i.isLobby=e.isLobby,i.publishedStates=e.publishedStates,i.isStaging=s,i.version=e.version,i.propertyBag=e.propertyBag,i.isIdentityMasked=e.isIdentityMasked,i.maskedIdSeqNumber=e.maskedIdSeqNumber,i.maskedId=e.maskedId,e?.joinAsStreamingUser!==void 0&&(i.joinAsStreamingUser=e.joinAsStreamingUser),e?.enableCaptcha!==void 0&&(i.enableCaptcha=e.enableCaptcha),e?.otpIdentity!==void 0&&(i.otpIdentity=e.otpIdentity),this.participantManager.localParticipant.fromRoster=!0,r.onSelfParticipantUpdated(i,t)),this.isParticipantInCall(e)){let i=this.participantManager.participantOperationHandler,r=this.getRnlMri(e,t);r&&i.hasPendingOperation(0,r,t)&&(this.logger.info(`RNL participant ${ta(r)} appears in roster. Resolving AddParticipant request`),n.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,r),i.resolvePendingOperation(0,r,e,t))}}checkForRemovedParticipants(e,t,i){let n=this.participantManager.signalingSessionCallback,r=this.participantManager.signalingSession,s=this.participantManager.participantOperationHandler;for(let t of(this.logger.info(`[${i}][checkForRemovedParticipants]`),Object.keys(e)))e.hasOwnProperty(t)&&!1!==e[t]&&!s.hasPendingOperation(0,t,i)&&(sP(this.participantManager.connectedRemoteParticipantIds,t),this.logger.info(`[${i}][checkForRemovedParticipants] ${ta(t)} removed from roster`),n.onParticipantRemoved({id:t},i),r.clearParticipantCallLinks(t));this.handleRemoveParticipantRequests(t,i)}handleRemoveParticipantRequests(e,t){let i=this.participantManager.signalingSession,n=this.participantManager.participantOperationHandler;this.logger.info(`handleRemoveParticipantRequests [${t}] dynamicRosterParticipants`);let r=[];for(let s of(Object.keys(e).forEach(t=>{let i=o8.fromRoster(e[t]);i&&i.endpointDetails&&i.endpointDetails.forEach(e=>{e.originalId&&r.push(e.originalId)})}),Object.keys(n.getAllPendingOperations(3,t))))-1!==r.indexOf(s)||e.hasOwnProperty(s)||(this.logger.info(`[${t}][handleRemoveParticipantRequests] ${ta(s)} no longer appears in roster. Resolving RemoveParticipant request`),sP(this.participantManager.connectedRemoteParticipantIds,s),i.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,s),n.resolvePendingOperation(3,s,{id:s},t))}},gI=class{constructor(e,t,i,n){this.connectedRemoteParticipantIds={},this.disposed=!1,this.unmuteApprovalLinks={},this._asyncMuteUnmuteDefers=new Map,this.muteAsyncEnabled=!1,this.unmuteAsyncEnabled=!1,this.setLocalParticipantId=(e,t)=>{e&&(this.logger.info(`[${t}][setLocalParticipantId][participantId=${e}]`),this.localParticipant.participantId=e,this.signalingSession.telemetryHelper.setParticipantId(this.localParticipant.participantId))},this.setEnableMuteAsync=e=>{this.muteAsyncEnabled=e},this.setEnableUnmuteAsync=e=>{this.unmuteAsyncEnabled=e},this.admitParticipantAsync=(e,t,i)=>{let n=`[${i}][admitParticipantAsync]`;this.logger.info(`${n}${this.piiUtils.scrubMriOrOmit(e.id)}`);let r=sV();return this.participantOperationHandler.hasPendingOperation(1,e.id,i)?(this.logger.info(`${n}there is an existing pending request to admit the participant ${this.piiUtils.scrubMriOrOmit(e.id)}`),r.reject(Error("there is an existing pending request to admit the participant"))):(this.participantOperationHandler.setPendingOperation(1,e.id,{participant:e,promise:r,causeId:i},i),this.sendNetworkRequestForAdmittingParticipant(e,t,i)),r.promise},this.addParticipantsAsync=(e,t,i,n,r)=>{let s=`[${r}][addParticipantsAsync]`,a=e.map(e=>this.piiUtils.scrubMriOrOmit(e.id));this.logger.info(`${s} remoteParticipantsIds: ${a}`);let o=[],l=[];return e.forEach(e=>{let t=sV(),i=3===n.replacementType?e.participantId:e.id;this.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(this.logger.info(`${s}the given participant is already connected to the call ${this.piiUtils.scrubMriOrOmit(e.id)}`),t.reject(Error("the given participant is already connected to the call"))):this.participantOperationHandler.hasPendingOperation(0,i,r)?(this.logger.info(`${s}there is an existing pending request to add the participant ${this.piiUtils.scrubMriOrOmit(e.id)}`),t.reject(Error("there is an existing pending request to add the participant"))):(e.participantId||(e.participantId=sm(),this.logger.info(`participantId created ${e.participantId}`)),this.participantOperationHandler.setPendingOperation(0,i,{participant:e,promise:t,causeId:r},r),o.push(e)),l.push(t.promise)}),i&&this.sendNetworkRequestForAddingParticipant(o,t,n,r),l},this.nudgeParticipantsAsync=(e,t,i,n,r,s,a,o)=>(this.logger.info(`[${n}][nudgeParticipantAsync] ${this.piiUtils.scrubParticipantsList(e)}`),i)?this.sendNetworkRequestForNudgingParticipants(e,t,n,r,s,a,o):Promise.reject(`[${n}][nudgeParticipantAsync] Call not started`),this.updateMeetingRolesAsync=(e,t,i,n=sp())=>{let r=sV();if(!e||e.length<1){let e=`[${n}][updateMeetingRolesAsync] participantsInfo cannot be empty or null`,t=Error(e);t.endCode={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:e},this.logger.info(e),r.reject(t)}else if(t)if(i){let s;"attendee"===t?s=u3.UPDATE_MEETING_ROLE_ATTENDEE.name:"presenter"===t?s=u3.UPDATE_MEETING_ROLE_PRESENTER.name:"organizer"===t?s=u3.UPDATE_MEETING_ROLE_ORGANIZER.name:r.reject(Error(`[${n}] Invalid meetingRole value(${t})`)),this.logger.info(`[${n}][updateMeetingRolesAsync][meetingRole=${t}]`),this.signalingSession.ensureMessageChannelReady(s).then(()=>{this.sendNetworkRequestForUpdatingMeetingRoles(e,t,i,s,n,r)}).catch(e=>{let t=t_(e);this.logger.info(`[${n}][updateMeetingRolesAsync][failed][reason=${t}]`);let i={...sM(e,this.signalingSession.signalingAgentConfig).error};r.reject(i)})}else{let e=`[${n}][updateMeetingRolesAsync] updateMeetingRoleUrl cannot be empty or null`,t=Error(e);t.endCode={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:e},this.logger.info(e),r.reject(t)}else{let e=`[${n}][updateMeetingRolesAsync] meetingRole cannot be empty or null`,t=Error(e);t.endCode={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:e},this.logger.info(e),r.reject(t)}return r.promise},this.updateParticipantInterpretationStateAsync=(e,t,i)=>{let n=`[${i}][updateParticipantInterpretationStateAsync]`,r=e.map(e=>this.piiUtils.scrubMriOrOmit(e.id));this.logger.info(`${n} remoteParticipantsIds: ${r}`);let s=[],a=[];return e.forEach(e=>{let t=sV();this.participantOperationHandler.hasPendingOperation(5,e.id,i)?(this.logger.info(`${n}there is an existing pending request to update the participant ${this.piiUtils.scrubMriOrOmit(e.id)}`),t.reject(Error("there is an existing pending request to update the participant"))):(this.participantOperationHandler.setPendingOperation(5,e.id,{option:e,promise:t,causeId:i},i),s.push(e)),a.push(t.promise)}),this.sendNetworkRequestToUpdateParticipantInterpretationState(s,t,e,i),a},this.callMeBackAsync=(e,t,i)=>{this.logger.info(`[${i}][callMeBackAsync] ${this.piiUtils.scrubMriOrOmit(e.id)}`);let n=sV();return this.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(this.logger.info(`the given participant is already connected to the call : ${this.piiUtils.scrubMriOrOmit(e.id)}`),n.reject(Error("the given participant is already connected to the call"))):this.participantOperationHandler.hasPendingOperation(2,e.id,i)?(this.logger.info(`there is an existing pending request to call back the participant : ${this.piiUtils.scrubMriOrOmit(e.id)}`),n.reject(Error("there is an existing pending request to call back the participant"))):(this.participantOperationHandler.setPendingOperation(2,e.id,{participant:e,promise:n},i),this.sendNetworkRequestForCallMeBack(e,t,i)),n.promise},this.isRosterStale=(e,t)=>this.rosterManager.isRosterStale(e,t),this.removeParticipantAsync=(e,t,i)=>{this.logger.info(`[${i}][removeParticipantAsync] ${this.piiUtils.scrubMriOrOmit(e.id)}`),sS(t,"correct removeParticipantUrl is not provided");let n=sV();if(this.participantOperationHandler.hasPendingOperation(3,e.id,i))this.logger.info(`there is an existing pending request to remove the participant ${this.piiUtils.scrubMriOrOmit(e.id)}`),n.reject(Error("there is an existing pending request to remove the participant"));else{this.participantOperationHandler.setPendingOperation(3,e.id,{participant:e,promise:n},i);let r=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,()=>{this.signalingSession.telemetryHelper.recordEvent(lP),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),this.participantOperationHandler.rejectPendingOperation(3,e.id,"timed out waiting for participant to not show up in roster",{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:sr.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},i)},this.signalingSession.getTimeoutValue("removeParticipantTimeoutSec"),e.id)};this.signalingSession.http.sendPostRequest({url:t,payload:gy(this.signalingSession,e),requestName:u3.REMOVE_PARTICIPANT_NONE.name,onceTrouterReady:r,causeId:i}).catch(t=>{let n=sM(t,this.signalingSession.signalingAgentConfig);this.logger.info(`[${i}][removeParticipantAsync][failed][reason=${t_(n)}]`),this.disposed||(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),this.participantOperationHandler.rejectPendingOperation(3,e.id,t,n.error,i))})}return n.promise},this.removeParticipantEndpointAsync=(e,t,i,n)=>{this.logger.info(`[${n}][removeParticipantEndpointAsync] ${tw(e.endpointId,8)} [endPointScope] ${i}`),sS(t,"correct removeParticipantUrl is not provided");let r=sV(),s="";switch(i){case"all":s=u3.REMOVE_PARTICIPANT_OTHERS.name;break;case"specified":s=u3.REMOVE_PARTICIPANT_SPECIFIED.name;break;default:return Promise.reject(`invalid scope ${i} removeParticipantEndpointAsync`)}this.participantOperationHandler.setPendingOperation(4,e.endpointId,{participant:e,promise:r,scope:i},n);let a=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,()=>{this.signalingSession&&!this.signalingSession.disposed&&(this.signalingSession.telemetryHelper.recordEvent(lP),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.endpointId),this.participantOperationHandler.rejectPendingOperation(4,e.endpointId,"timed out waiting for participant endpoint sync response from service",{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:sr.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},n))},this.signalingSession.getTimeoutValue("removeParticipantTimeoutSec"),e.endpointId)};return this.signalingSession.http.sendPostRequest({url:t,payload:gS(this.signalingSession,e,i),requestName:s,onceTrouterReady:a,causeId:n}).then(e=>{if(e.response?.code)if(-1!==[sr.HTTP_STATUS_CODES.OK,sr.HTTP_STATUS_CODES.CREATED].indexOf(e.response.code))this.logger.info(`[${n}][removeParticipantEndpointAsync][endPointScope] ${i} [passed][reason=${t_(e.response)}]`),r.resolve(e.response);else{let t=Error("invalid service response for removeParticipantEndpoint");t.endCode={code:e.response.code,subCode:e.response.subcode,phrase:e.response.reason},this.logger.info(`[${n}][removeParticipantEndpointAsync][endPointScope] ${i} [failed][reason=${t_(e.response)}]`),r.reject(t)}r.resolve()}).catch(t=>{let r=sM(t,this.signalingSession.signalingAgentConfig);this.logger.info(`[${n}][removeParticipantEndpointAsync][endPointScope] ${i} [failed][reason=${t_(r)}]`),this.disposed||(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.endpointId),this.participantOperationHandler.rejectPendingOperation(4,e.endpointId,t_(t),r.error,n))}),r.promise},this.getParticipantsToInitiateCallWith=()=>{this.logger.info("getParticipantsToInitiateCallWith");let e=[],t=this.participantOperationHandler.getAllPendingOperations(0,sp());for(let i of Object.keys(t))t.hasOwnProperty(i)&&t[i]&&e.push(t[i].participant);return e},this.initializeForIncomingCall=e=>{this.logger.info("initializeForIncomingCall"),this.participantOperationHandler.dispose("incoming calls cannot add/remove participants until call is connected",null,sp())},this.handleAddParticipantSuccess=e=>{let t=e.body,i=sk(e);this.logger.info(`[${i}][handleAddParticipantSuccess(${t.participantInfos?"new format":"old format"})]${t_(t)}]`),this.signalingSession.telemetryHelper.recordIncomingEvent(lR,e),this.internalHandleCallMeBackSuccess(t,i)||this.signalingSession.telemetryHelper.recordEvent(lR),this.signalingSession.signalingAgentConfig.enableAddParticipantEnhancements&&this.internalHandleAcceptedByParticipants(t,i)},this.handleAddParticipantFailure=e=>{let t=e.body,i=sk(e);this.logger.info(`[${i}][handleAddParticipantFailure(${t.participantInfos?"new format":"old format"})][${t_(t)}]`),t.modalityFailure?(this.logger.info(`[${i}][handleAddParticipantFailure][modalityFailure=${t_(t)}]`),this.signalingSession.telemetryHelper.recordIncomingEvent(lO,e)):this.internalHandleAddParticipantFailure(e,i)},this.handleAdmitParticipantSuccess=e=>{let t=e.body,i=sk(e);this.logger.info(`[${i}][handleAdmitParticipantSuccess][${t_(t)}]`),this.signalingSession.telemetryHelper.recordIncomingEvent(lM,e),t.participants&&this.internalHandleAdmitParticipantSuccess(e,i)},this.handleAdmitParticipantFailure=e=>{let t=e.body,i=sk(e);this.logger.info(`[${i}][handleAdmitParticipantFailure][${t_(t)}]`),t.participants&&this.internalHandleAdmitParticipantFailure(e,i)},this.handleRemoveParticipantFailure=e=>{let t=e.body,i=sk(e);for(let n of(this.logger.info(`[${i}][handleRemoveParticipantFailure][${t_(t)}]`),this.signalingSession.telemetryHelper.recordIncomingEvent(lN,e),Object.keys(t.participants)))t.participants.hasOwnProperty(n)&&this.internalHandleRemoveParticipantFailure(n,t.participants[n],i)},this.handleRemoveParticipantSuccess=e=>{let t=e.body,i=sk(e);this.logger.info(`[${i}][handleRemoveParticipantSuccess][${t_(t)}]`),this.signalingSession.telemetryHelper.recordIncomingEvent(lk,e)},this.handleUnmuteConfirmRequest=e=>{let t=e.body,i=sk(e);this.logger.info(`[${i}][handleUnmuteConfirmRequest][${t_(t)}]`),this.signalingSession.telemetryHelper.recordIncomingEvent(cD,e),this.unmuteApprovalLinks[t.from.id]={approve:t.links.approveUnmute,reject:t.links.rejectUnmute},this.signalingSessionCallback.onUnmuteRequested(t.from.id,i)},this.approveUnmuteRequestAsync=(e,t)=>{this.logger.info(`[${t}][approveUnmuteRequestAsync]`);let i=sV();return this.unmuteApprovalLinks.hasOwnProperty(e)?this.signalingSession.ensureMessageChannelReady(u3.APPROVE_UNMUTE.name).then(()=>{this.muteUnmute(u3.APPROVE_UNMUTE.name,gg(this.signalingSession),i,this.unmuteApprovalLinks[e].approve,t)}).catch(e=>{let n=t_(e);this.logger.info(`[${t}][approveUnmuteRequestAsync][failed][reason=${n}]`),i.reject(Error(e))}):i.reject(Error("no unmute links found for given participant")),i.promise},this.rejectUnmuteRequestAsync=(e,t,i)=>{this.logger.info(`[${t}][rejectUnmuteRequestAsync]`);let n=sV();if(!this.unmuteApprovalLinks.hasOwnProperty(e))return n.reject(Error("no unmute links found for given participant")),n.promise;let r=i||{code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UNMUTE_REQUEST_REJECTED,phrase:sr.CALL_END_PHRASE.UNMUTE_REQUEST_REJECTED};return this.signalingSession.ensureMessageChannelReady(u3.REJECT_UNMUTE.name).then(()=>{this.muteUnmute(u3.REJECT_UNMUTE.name,gv(this.signalingSession,r),n,this.unmuteApprovalLinks[e].reject,t)}).catch(e=>{let i=t_(e);this.logger.info(`[${t}][rejectUnmuteRequestAsync][failed][reason=${i}]`),n.reject(Error(e))}),n.promise},this.handleRosterUpdate=(e,t,i)=>{let n=this.getCurrentParticipantsInCallModality(!1);this.rosterManager.handleRosterUpdate(e,n,t,i)},this.updateLocalParticipantFromSubscribe=(e,t)=>{this.localParticipant.fromRoster||this.rosterManager.updateLocalParticipantFromSubscribe(e,t)},this.muteAsync=(e,t,i,n)=>{this.logger.info(`[${n}][muteAsync][muteScope=${t}]`);let r="specified",s=[],a=u3.MUTE_SPECIFIED;switch(t){case sr.MUTE_SCOPE.MYSELF:a=u3.MUTE_MYSELF,s.push({id:this.localParticipant.id});break;case sr.MUTE_SCOPE.EVERYONE_ELSE:a=u3.MUTE_ALL_SYNC,r="all",i.forEach(e=>{s.push({id:e})});break;case sr.MUTE_SCOPE.SPECIFIED_PARTICIPANTS:sS(i,`[${n}]array of participantIds must be specified for SPECIFIED_PARTICIPANTS mute scope`),a=u3.MUTE_SPECIFIED_SYNC,i.forEach(e=>{s.push({id:e})});break;default:sv(!1,`[${n}]muteScope is a required param. please pass in a valid value.`)}let o=sV();if(t===sr.MUTE_SCOPE.SPECIFIED_PARTICIPANTS){let e=this.areParticipantsConnectedToCall(i);if(!e.result)return o.reject(Error(`[${n}]specified participant is not connected to call yet. Id = ${e.participant}`)),o.promise}let l=this.muteAsyncEnabled&&(t===sr.MUTE_SCOPE.SPECIFIED_PARTICIPANTS||t===sr.MUTE_SCOPE.EVERYONE_ELSE);return this.signalingSession.ensureMessageChannelReady(a.name).then(()=>{this.muteUnmute(a.name,gp(this.signalingSession,r,s,l,n),o,e,n,!1,l)}).catch(e=>{let t=t_(e),i=sM(e,this.signalingSession.signalingAgentConfig);this.logger.info(`[${n}][muteAsync][failed][reason=${t}]`),o.reject(i)}),o.promise},this.unmuteAsync=(e,t)=>{this.logger.info(`[${t}][unmuteAsync]`);let i=sV();return this.signalingSession.ensureMessageChannelReady(u3.UNMUTE_SYNC.name).then(()=>{this.muteUnmute(u3.UNMUTE_SYNC.name,gC(this.signalingSession,this.unmuteAsyncEnabled,t),i,e,t,!0,this.unmuteAsyncEnabled)}).catch(e=>{let n=t_(e);this.logger.info(`[${t}][unmuteAsync][failed][reason=${n}]`),i.reject(Error(e))}),i.promise},this.dispose=(e,t)=>{this.logger.info(`[${t}][dispose]`),this.disposed=!0,this.participantOperationHandler.dispose("call ended",e,t),this.signalingSession.telemetryHelper.setParticipantId(this.localParticipant.participantId),this._asyncMuteUnmuteDefers.forEach((t,i)=>{t.reject(e)}),this._asyncMuteUnmuteDefers.clear()},this.handleMuteUnmuteAsyncResponse=e=>{let t=sk(e),i=this.logger.createFnLogger("handleMuteUnmuteAsyncResponse",t);if(!e.body)return void i.error("ignored. Empty message body.");let n={info:e.body.muteUnmuteResponseAsync,operationId:e.body.operationId};if(i.info(`Received async response for mute/unmute operation, operation id = ${n.operationId}.`),this.disposed)return void i.info("ignored. Call disposed.");if(!n.operationId)return void i.error("operationId is undefined.");let r=this._asyncMuteUnmuteDefers.get(n.operationId);if(!r)return void i.warn(`cannot find deferred promise for operation id [${n.operationId}].`);r.resolve(n),this._asyncMuteUnmuteDefers.delete(n.operationId)},this.internalHandleAcceptedByParticipants=(e,t)=>{if(e?.participantInfos){let i=e.participantInfos,n=this.getCurrentParticipantsInCallModality(!1);for(let e of(this.logger.info(`[${t}][internalHandleAcceptedByParticipants] handling participants with acceptedBy blob.`),i))if(e?.acceptedBy){let i=e.id;this.participantOperationHandler.hasPendingOperation(0,i,t)&&(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,i),this.logger.info(`[${t}][internalHandleAcceptedByParticipants] ${this.piiUtils.scrubMriOrOmit(i)} added using a different MRI. Resolving operation.`),this.participantOperationHandler.resolvePendingOperation(0,i,void 0,t)),this.rosterManager.handleParticipantAcceptedBy(e,n,t)}}},this.internalHandleCallMeBackSuccess=(e,t)=>{let i=!1;if(e?.participantInfos)for(let n of e.participantInfos){let e=n.id;this.internalHandleCallMeBackSuccessHelper(e,t)&&(i=!0)}else if(e?.participants)for(let n of e.participants)this.internalHandleCallMeBackSuccessHelper(n,t)&&(i=!0);return i},this.signalingSession=e,this.signalingSessionCallback=t,this.localParticipant=i,this.localParticipant.endpointId||(this.localParticipant.endpointId=this.signalingSession.getEndpointId());let r=tw(this.localParticipant.endpointId,8);this.logger=n.createChild(()=>`[PM][${r}]`),this.piiUtils=e.piiUtils,this.participantOperationHandler=new gc(e.logger.createChild(()=>`[ParticipantOperationHandler][${r}]`)),this.rosterManager=new g_(this,e.logger.createChild(()=>`[RosterManager][${r}]`)),this.localParticipant.participantId||(this.localParticipant.participantId=sm()),"string"==typeof e.signalingAgentConfig.languageCode?this.localParticipant.languageId=e.signalingAgentConfig.languageCode:"function"==typeof e.signalingAgentConfig.languageCode&&(this.localParticipant.languageId=e.signalingAgentConfig.languageCode()),e.telemetryHelper.setParticipantId(this.localParticipant.participantId),e.telemetryHelper.setEndPointId(this.localParticipant.endpointId)}handleUpdateParticipantInterpretationStateCompletion(e){let t=e.body,i=sk(e),n=t.operationId;if(this.disposed)return void this.logger.info(`[${i}][handleUpdateParticipantInterpretationStateCompletion] ignored. Call disposed.`);n||this.logger.warn(`[${i}][handleUpdateParticipantInterpretationStateCompletion] operationId is undefined.`),this.logger.info(`[${i}][handleUpdateParticipantInterpretationStateCompletion] starts`);let r=e.body;if(r.participantInfos){for(let t of r.participantInfos)if(this.logger.info(t),this.participantOperationHandler.hasPendingOperation(5,t.participant.id,i))if(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,t.participant.id),t.transactionEnd.code===sr.TRANSACTION_END_CODE.SUCCESS)this.logger.info(`[${i}]Update participant interpretation state succeeded for: ${this.piiUtils.scrubMriOrOmit(t.participant.id)}`),this.signalingSession.telemetryHelper.recordIncomingEvent(uE,e),this.participantOperationHandler.resolvePendingOperation(5,t.participant.id,void 0,i);else{let n=t.transactionEnd.reason;this.logger.info(`[${i}]Update participant interpretation state failed for: ${this.piiUtils.scrubMriOrOmit(t.participant.id)} reason : ${t_(n)}`);let r=this.getCallEndGivenParticipantFailure(n);this.signalingSession.telemetryHelper.recordIncomingEvent(uT,e,r),this.participantOperationHandler.rejectPendingOperation(5,t.participant.id,r.phrase,r,i)}}}setEnableCaptcha(e,t){this.logger.info(`[${t}][setEnableCaptcha] value:${e}`),this.localParticipant.enableCaptcha=e,this.signalingSessionCallback.onSelfParticipantUpdated(this.localParticipant,t)}areParticipantsConnectedToCall(e){this.logger.info(`areParticipantsConnectedToCall : ${t_(e)}`);let t=this.getCurrentParticipantsInCallModality(!0);for(let i of e)if(!t.hasOwnProperty(i))return this.logger.info(`areParticipantsConnectedToCall : returning false for :${this.piiUtils.scrubMriOrOmit(i)}`),{result:!1,participant:i};return this.logger.info("areParticipantsConnectedToCall : returning true"),{result:!0}}muteUnmute(e,t,i,n,r,s,a=!1){let o=this.logger.createFnLogger("muteUnmute",r);sv(2!==this.signalingSession.callMode,"mute/unmute operations are not allowed in streaming mode"),o.info(`operation=${e}, isAsync=${a}`),n?(s&&this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UNMUTE,()=>{if(this.signalingSession&&!this.signalingSession.disposed){this.signalingSession.telemetryHelper.recordEvent(cM),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UNMUTE);let e=Error("timed out waiting for response to request");e.endCode={code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UNMUTE_REQUEST_TIMEOUT,phrase:sr.CALL_END_PHRASE.UNMUTE_REQUEST_TIMEOUT},i.reject(e)}},this.signalingSession.getTimeoutValue("unmuteTimeoutSec")),a&&this._asyncMuteUnmuteDefers.set(r,i),this.signalingSession.http.sendPostRequest({url:n,payload:t,requestName:e,withoutTrouter:!0,causeId:r}).then(t=>{if(!this.disposed)if(a)o.info(`Inline response received for async operation, operation id: ${r}.`);else{if(t.response?.muteUnmuteResponse){let n={info:t.response.muteUnmuteResponse,operationId:t.response.operationId};switch(e){case u3.UNMUTE_SYNC.name:case u3.MUTE_ALL_SYNC.name:case u3.MUTE_SPECIFIED_SYNC.name:i.resolve(n)}}i.resolve()}}).catch(e=>{let t=sM(e,this.signalingSession.signalingAgentConfig);o.info(`operation failed, reason=${t_(t)}`),this.disposed||(s&&this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UNMUTE),i.reject(t.error))})):i.reject(Error(`[${r}][muteUnmute] cannot be performed now, the link is not yet available`))}sendNetworkRequestForUpdatingMeetingRoles(e,t,i,n,r,s){if(!i){let e=`[${r}][sendNetworkRequestForUpdatingMeetingRoles] failed because correct updateMeetingRoleUrl is not provided`;Error(e).endCode={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:e},this.logger.info(e),s.reject()}if(!e){let e=`[${r}][sendNetworkRequestForUpdatingMeetingRoles] failed because participants list is empty or null`,t=Error(e);t.endCode={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:e},this.logger.info(e),s.reject(t)}let a=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE,()=>{if(this.signalingSession&&!this.signalingSession.disposed){this.signalingSession.telemetryHelper.recordEvent(d_,{causeId:r}),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE);let e=Error(`[${r}] Timed out waiting for response to request`);e.endCode={code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_TIMEOUT,phrase:sr.CALL_END_PHRASE.UPDATE_MEETING_ROLE_TIMEOUT},s.reject(e)}},this.signalingSession.getTimeoutValue("updateMeetingRoleTimeoutSec"))};this.signalingSession.http.sendPostRequest({url:i,payload:gb(this.signalingSession,e,"specified",t),requestName:n,onceTrouterReady:a,causeId:r}).then(e=>{s.resolve(e.response)}).catch(e=>{let t=t_(e);this.logger.info(`[${r}][sendNetworkRequestForUpdatingMeetingRoles] failed: ${t}`);let i=Error(`[${r}][CS response] Forbidden request`),n=sM(e,this.signalingSession.signalingAgentConfig);i.code=n.error.code,i.subCode=n.error.subCode,i.phrase=n.error.phrase,this.disposed||(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE),s.reject(i))})}sendNetworkRequestForNudgingParticipants(e,t,i,n,r,s,a){if(!t)return this.logger.info(`[${i}][sendNetworkRequestForNudgingParticipant] failed because correct nudgeParticipantUrl is not provided`),Promise.reject("Missing nudgeParticipant url");{let o=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,()=>{this.signalingSession&&!this.signalingSession.disposed&&(this.signalingSession.telemetryHelper.recordEvent(cR),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,e?e.join():""))},this.signalingSession.getTimeoutValue("nudgeParticipantTimeoutSec"),e?e.join():"")},l=s||r?gf(this.signalingSession,e,r,s,a,n):gm(this.signalingSession,e,n);return this.signalingSession.http.sendPostRequest({url:t,payload:l,requestName:u3.NUDGE_PARTICIPANT.name,onceTrouterReady:o,causeId:i}).then(()=>{}).catch(t=>{let n=sM(t,this.signalingSession.signalingAgentConfig);return this.logger.info(`[${i}][sendNetworkRequestForNudgingParticipant][failed][reason=${t_(n)}]`),this.disposed||this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,e?e.join():""),Promise.reject(n.error)})}}sendNetworkRequestForAddingParticipant(e,t,i,n=sp()){if(t){let r=u3.ADD_PARTICIPANT.name,s=lh,a={};switch(i.replacementType){case 2:r=u3.ADD_PARTICIPANT_WITH_PICKUP_CODE.name,s=dH,a.unparkContent={pickupCode:i.pickupCode};break;case 1:r=u3.ADD_PARTICIPANT_WITH_REPLACES.name,s=lp,a=this.signalingSession.getCallReplacementDetailsForCall(i.callIdToReplace,n);break;case 3:r=u3.ADD_PARTICIPANT_WITH_REPLACES.name,s=lp,a=this.signalingSession.getReplacementDetailsByParticipantLegOfCall(i.callIdToReplace,e[0].id,e[0].replacementParticipantId,n);break;default:r=u3.ADD_PARTICIPANT.name,s=lh,a=null}let o=()=>{e.forEach(e=>{let t=3===i.replacementType?e.participantId:e.id;this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,()=>{this.signalingSession&&!this.signalingSession.disposed&&(this.signalingSession.telemetryHelper.recordEvent(s,{causeId:n}),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,t),this.participantOperationHandler.rejectPendingOperation(0,t,"timed out waiting for participant to show up in roster",{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:sr.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},n))},this.signalingSession.getTimeoutValue("addParticipantTimeoutSec"),t)})},l=i.threadId||i.groupId?gd(this.signalingSession,e,i,a):gu(this.signalingSession,e,i,a);this.signalingSession.http.sendPostRequest({url:t,payload:l,requestName:r,onceTrouterReady:o,causeId:n}).catch(t=>{let r=sM(t,this.signalingSession.signalingAgentConfig);this.logger.info(`[${n}][sendNetworkRequestForAddingParticipant] failed:${t_(t)}`),this.disposed||e.forEach(e=>{let s=3===i.replacementType?e.participantId:e.id;this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,s),this.participantOperationHandler.rejectPendingOperation(0,s,t,r.error,n)})})}else this.logger.info(`[${n}][sendNetworkRequestForAddingParticipants] failed because correct addParticipantUrl is not provided`),e.forEach(e=>{let t=3===i.replacementType?e.participantId:e.id;this.participantOperationHandler.rejectPendingOperation(0,t,"correct addParticipantUrl is not provided",{code:sr.CALL_END_CODE.LOCAL_ERROR,subCode:sr.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:sr.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},n)})}sendNetworkRequestToUpdateParticipantInterpretationState(e,t,i,n=sp()){if(t){let r=u3.UPDATE_PARTICIPANT_INTERPRETATION_STATE.name,s=ub,a=()=>{let t={code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT,phrase:sr.CALL_END_PHRASE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT};e.forEach(e=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,()=>{this.signalingSession&&!this.signalingSession.disposed&&(this.logger.info(`[${n}][sendNetworkRequestToUpdateParticipantInterpretationState] timed out`),this.signalingSession.telemetryHelper.recordEvent(s,{causeId:n}),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,e.id),this.participantOperationHandler.rejectPendingOperation(5,e.id,"timed out waiting to update particiant interpretation state",t,n))},this.signalingSession.getTimeoutValue("updateParticipantInterpretationStateCompletionTimeoutSec"),e.id)})},o=gT(this.signalingSession,i,n);this.signalingSession.http.sendPostRequest({url:t,payload:o,requestName:r,onceTrouterReady:a,causeId:n}).catch(t=>{let i=sM(t,this.signalingSession.signalingAgentConfig);this.logger.info(`[${n}][sendNetworkRequestToUpdateParticipantInterpretationState] failed:${t_(t)}`),this.disposed||e.forEach(e=>{this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,e.id),this.participantOperationHandler.rejectPendingOperation(5,e.id,t,i.error,n)})})}else{this.logger.info(`[${n}][sendNetworkRequestToUpdateParticipantInterpretationState] failed because correct updateParticipantUrl is not provided`);let t={code:sr.CALL_END_CODE.LOCAL_ERROR,subCode:sr.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:sr.CALL_END_PHRASE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_URL_MISSING};e.forEach(e=>{this.participantOperationHandler.rejectPendingOperation(5,e.id,"correct updateParticipantUrl is not provided",t,n)})}}sendNetworkRequestForCallMeBack(e,t,i){if(t){let n=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.CALL_ME_BACK,()=>{this.signalingSession&&!this.signalingSession.disposed&&(this.signalingSession.telemetryHelper.recordEvent(lE,{causeId:i}),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),this.participantOperationHandler.rejectPendingOperation(2,e.id,"timed out waiting for call me back success response",{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:sr.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},i))},this.signalingSession.getTimeoutValue("callMeBackTimeoutSec"),e.id)},r={groupId:this.signalingSession.groupId,threadId:this.signalingSession.threadId,messageId:this.signalingSession.teamsMessageId};this.signalingSession.http.sendPostRequest({url:t,payload:gd(this.signalingSession,[e],r),requestName:u3.CALL_ME_BACK.name,onceTrouterReady:n,causeId:i}).catch(t=>{let n=sM(t,this.signalingSession.signalingAgentConfig);this.logger.info(`[${i}][sendNetworkRequestForCallMeBack] failed: ${t_(n)}`),this.disposed||(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),this.participantOperationHandler.rejectPendingOperation(2,e.id,t,n.error,i))})}else this.logger.info(`[${i}][sendNetworkRequestForCallMeBack] failed because correct addParticipantUrl is not provided`),this.participantOperationHandler.rejectPendingOperation(2,e.id,"correct addParticipantUrl is not provided",{code:sr.CALL_END_CODE.LOCAL_ERROR,subCode:sr.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:sr.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},i)}sendNetworkRequestForAdmittingParticipant(e,t,i){if(t){let n=()=>{this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,()=>{this.signalingSession&&!this.signalingSession.disposed&&(this.signalingSession.telemetryHelper.recordEvent(lv),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),this.participantOperationHandler.rejectPendingOperation(1,e.id,"timed out waiting for participant to show up in roster",{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:sr.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},i))},this.signalingSession.getTimeoutValue("admitParticipantTimeoutSec"),e.id)};this.signalingSession.http.sendPostRequest({url:t,payload:gh(this.signalingSession,e,i),requestName:u3.ADMIT_PARTICIPANT.name,onceTrouterReady:n,causeId:i}).catch(t=>{let n=sM(t,this.signalingSession.signalingAgentConfig);this.logger.info(`[${i}][sendNetworkRequestForAdmittingParticipant][failed][reason=${t_(n)}]`),this.disposed||(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),this.participantOperationHandler.rejectPendingOperation(1,e.id,t,n.error,i))})}else this.logger.info(`[${i}][sendNetworkRequestForAdmittingParticipant] failed because correct admitParticipantUrl is not provided`),this.participantOperationHandler.rejectPendingOperation(1,e.id,"correct admitParticipantUrl is not provided",{code:sr.CALL_END_CODE.LOCAL_ERROR,subCode:sr.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:sr.CALL_END_PHRASE.ADMIT_PARTICIPANT_URL_MISSING},i)}getCurrentParticipantsInCallModality(e){let t={},i=[sr.PARTICIPANT_AUDIO_STATE.CONNECTED];return e||i.push(sr.PARTICIPANT_AUDIO_STATE.CONNECTING,sr.PARTICIPANT_AUDIO_STATE.RINGING),this.signalingSessionCallback.getRemoteParticipantCollection()?.forEach(e=>{i.some(t=>t===e.audioState)&&(t[e.mri]=!0)}),t}internalHandleRemoveParticipantFailure(e,t,i){if(this.participantOperationHandler.hasPendingOperation(3,e,i)){this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e),this.logger.info(`[${i}][internalHandleRemoveParticipantFailure] failed for ${this.piiUtils.scrubMriOrOmit(e)} reason ${t_(t)}`);let n=this.getCallEndGivenParticipantFailure(t);this.participantOperationHandler.rejectPendingOperation(3,e,n.phrase,n,i)}}internalHandleCallMeBackSuccessHelper(e,t){if(this.participantOperationHandler.hasPendingOperation(2,e,t)){let i={id:e};return this.logger.info(`participant : ${this.piiUtils.scrubMriOrOmit(e)} was successfully added. Resolving CallMeBack request`),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.CALL_ME_BACK,e),this.participantOperationHandler.resolvePendingOperation(2,i.id,i,t),!0}return!1}internalHandleAddParticipantFailure(e,t=sp()){let i=e.body;if(i.participantInfos)i.participantInfos.forEach(i=>{let n=[i.participant.participantId],r=this.participantOperationHandler.getRnlMri(n,t)||i.participant.id;this.rejectAddParticipantFailure(r,i.transactionEnd,e,t)});else if(i.participants)for(let n of Object.keys(i.participants))this.rejectAddParticipantFailure(n,i.participants[n],e,t)}rejectAddParticipantFailure(e,t,i,n){let r=this.getCallEndGivenParticipantFailure(t);this.signalingSession.telemetryHelper.recordIncomingEvent(lA,i,r),this.participantOperationHandler.hasPendingOperation(0,e,n)?(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e),this.logger.info(`participantAdd failed for : ${this.piiUtils.scrubMriOrOmit(e)} reason : ${t_(t)}`),this.participantOperationHandler.rejectPendingOperation(0,e,r.phrase,r,n)):this.participantOperationHandler.hasPendingOperation(2,e,n)&&(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.CALL_ME_BACK,e),this.logger.info(`callMeBack failed for : ${this.piiUtils.scrubMriOrOmit(e)} reason : ${t_(t)}`),this.participantOperationHandler.rejectPendingOperation(2,e,r.phrase,r,n))}internalHandleAdmitParticipantSuccess(e,t){for(let i of e.body.participants)this.participantOperationHandler.hasPendingOperation(1,i,t)&&(this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,i),this.logger.info(`Admit participant success for : ${this.piiUtils.scrubMriOrOmit(i)}`),this.participantOperationHandler.resolvePendingOperation(1,i,void 0,t))}internalHandleAdmitParticipantFailure(e,t){let i=e.body;for(let n of Object.keys(i.participants))if(this.participantOperationHandler.hasPendingOperation(1,n,t)){this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,n);let r=i.participants[n];this.logger.info(`Admit participant failed for : ${this.piiUtils.scrubMriOrOmit(n)} reason : ${t_(r)}`);let s=this.getCallEndGivenParticipantFailure(r);this.signalingSession.telemetryHelper.recordIncomingEvent(lD,e,s),this.participantOperationHandler.rejectPendingOperation(1,n,s.phrase,s,t)}}getCallEndGivenParticipantFailure(e){let t={code:e.code,subCode:e.subCode,phrase:e.phrase,resultCategories:e.resultCategories};return e.code===sr.CALL_END_CODE.CALL_MODALITY_FAILURE&&e.callControllerTransactionEnd?t={...e.callControllerTransactionEnd}:e.code===sr.CALL_END_CODE.ATC_CONTROLLER_FAILURE&&e.atcControllerTransactionEnd?t={...e.atcControllerTransactionEnd}:e.code===sr.CALL_END_CODE.CVA_CONTROLLER_FAILURE&&e.cvaControllerTransactionEnd&&(t={...e.cvaControllerTransactionEnd}),t}};function gw(e,t){sy(e,"signalingSession cannot be null"),sS(t,"sendMessageOptions cannot be null or empty");let i=[];for(let n of t){let t=0===n.scope?"all":"specified",r=[];n.to&&Object.keys(n.to).forEach(e=>{n.to[e].participantLegIdMap?Object.keys(n.to[e].participantLegIdMap).forEach(t=>{r.push({id:e,level:n.to[e].level,endpointId:n.to[e].participantLegIdMap[t].endpointId,participantId:t})}):r.push({id:e,level:n.to[e].level})}),i.push({links:{sendMessageStatus:so(e,rG.SEND_MESSAGE_STATUS)},operationId:n.operationId,payload:n.payload,scope:t,to:r,type:n.type})}return{payload:{from:{displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,id:e.participantManager.localParticipant.id,languageId:e.participantManager.localParticipant.languageId??"",participantId:e.participantManager.localParticipant.participantId},messageContent:i}}}function gP(e,t){return`${e}-${t}`}function gR(e,t){return`${e}-${t}`}function gA(e,t,i){return`${e}_${t}_${i}`}var gM=class{constructor(e){this.signalingSession=e,this.scopeAllOperations=new Map,this.mriOperations=new Map,this.legOperations=new Map,this.logger=e.logger.createChild(()=>"[ProxiedMessageNotificationManager]")}sendProxiedMessageAsync(e,t,i){this.logger.createChild("sendProxiedMessageAsync",e).info(`Url: ${i}`);let n=[],r=[];for(let i of t){if(0===i.scope){let t=sV();this.scopeAllOperations.set(i.operationId,t),n.push(t.promise),r.push(i.operationId),this.startTimeout(e,"all",i.operationId);continue}if(1===i.scope){for(let t in i.to)if("participant"===i.to[t].level){let s=gP(t,i.operationId),a=sV();this.mriOperations.set(s,a),n.push(a.promise),r.push(s),this.startTimeout(e,"participant",s)}else if("endpoint"===i.to[t].level)for(let s in i.to[t].participantLegIdMap){let t=gR(s,i.operationId),a=sV();this.legOperations.set(t,a),n.push(a.promise),r.push(t),this.startTimeout(e,"endpoint",t)}}}return this.sendProxiedMessageNetworkRequest(e,t,i,r),n}sendProxiedMessageNetworkRequest(e,t,i,n){let r=gw(this.signalingSession,t),s=this.logger.createChild("sendProxiedMessageNetworkRequest",e);s.info(`Url: ${i}`),this.signalingSession.http.sendPostRequest({url:i,requestName:u3.SEND_PROXIED_MESSAGE.name,payload:r,causeId:e}).catch(t=>{let i=sM(t,this.signalingSession.signalingAgentConfig);if(s.info(`failed:${t_(t)}`),this.signalingSession.disposed)return void s.info("signaling session is already disposed.");for(let t of n){this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.SEND_MESSAGE_COMPLETION,t);let n=null;this.scopeAllOperations.has(t)?(n=this.scopeAllOperations.get(t),this.scopeAllOperations.delete(t)):this.mriOperations.has(t)?(n=this.mriOperations.get(t),this.mriOperations.delete(t)):this.legOperations.get(t)?(n=this.legOperations.get(t),this.legOperations.delete(t)):s.warn(`could not find resolveString:${t} to reject it.`),null!==n&&n.reject({transactionEnd:i.error,causeId:e,resolveString:t})}})}startTimeout(e,t,i){let n=this.logger.createChild("startTimeout",e);n.info(`Creating timeout for level ${t} message with resolveString ${i}`),this.signalingSession.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.SEND_MESSAGE_COMPLETION,()=>{this.signalingSession.telemetryHelper.recordEvent(uU,{causeId:e,resolveString:i}),n.info(`timed out waiting for level [${t}] message with resolveString [${i}]`),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.SEND_MESSAGE_COMPLETION,i);let r="all"===t?this.scopeAllOperations:"participant"===t?this.mriOperations:"endpoint"===t?this.legOperations:null;return null===r?void n.warn(`Could not find a operations map for ${t}. Will not reject promise.`):r.has(i)?void(r.get(i).reject({transactionEnd:{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.CONVERSATION_NOTIFICATION_TIMEOUT,phrase:sr.CALL_END_PHRASE.CONVERSATION_NOTIFICATION_TIMEOUT},causeId:e,resolveString:i}),r.delete(i)):void n.warn(`Could not find resolveString [${i}] on map for ${t}. Will not reject promise.`)},this.signalingSession.getTimeoutValue("sendMessageCompletionTimeoutSec"),i)}handleProxiedMessageNotificationItem(e,t,i){if(t.info(`Message contains ${e.participantInfos?.length} participantInfos.`),0===this.scopeAllOperations.size&&0===this.mriOperations.size&&0===this.legOperations.size)return void t.info("Received statusMessage but there is no pending operation.");let n=e.operationId;if(this.scopeAllOperations.has(n)){t.info(`Scope all resolveString:${n}`),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.SEND_MESSAGE_COMPLETION,n);let e={transactionEnd:{code:0,subCode:0,phrase:""},causeId:i,resolveString:n};this.scopeAllOperations.get(n).resolve(e),this.scopeAllOperations.delete(n),this.signalingSession.telemetryHelper.recordEvent(uF,{causeId:i,operationId:n,level:"all"});return}for(let r of e.participantInfos){let e=r.transactionEnd?.code===0,s=gP(r.participant.id,n),a=gR(r.participant.participantId,n);if(s&&this.mriOperations.has(s)){t.info(`Scope mri resolveString:${s}`);let a={transactionEnd:r.transactionEnd,causeId:i,resolveString:s};e?this.mriOperations.get(s).resolve(a):this.mriOperations.get(s).reject(a),this.mriOperations.delete(s),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.SEND_MESSAGE_COMPLETION,s),this.signalingSession.telemetryHelper.recordEvent(uF,{causeId:i,operationId:n,level:"mri"})}else if(a&&this.legOperations.has(a)){t.info(`Scope legId resolveString:${a}`);let s={transactionEnd:r.transactionEnd,causeId:i,resolveString:a};e?this.legOperations.get(a).resolve(s):this.legOperations.get(a).reject(s),this.legOperations.delete(a),this.signalingSession.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.SEND_MESSAGE_COMPLETION,a),this.signalingSession.telemetryHelper.recordEvent(uF,{causeId:i,operationId:n,level:"leg"})}else t.warn(`Could not map this participantInfo to any pending operation operationId:${n}`)}}handleProxiedMessageNotification(e){let t,i=sk(e),n=this.logger.createChild("handleProxiedMessageNotification",i);for(let r of(t=Array.isArray(e.body?.statuses)?e.body.statuses:[e.body],n.info(`Received ${t.length} proxied message notification(s).`),t))this.handleProxiedMessageNotificationItem(r,n,i)}};function gD(e,t){return sy(e,"signalingSession cannot be null"),sy(t,"broadcastContext cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},broadcast:t,links:{addModalitySuccess:so(e,rG.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:so(e,rG.CONV_ADD_MODALITY_FAILURE)}}}}function gO(e,t){return sy(e,"signalingSession cannot be null"),sy(t,"broadcastContext cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},groupContext:t.groupContext?{id:t.groupContext.groupId}:null,groupChat:t.groupChat?{threadId:t.groupChat.threadId,messageId:t.groupChat.messageId}:null,links:{addModalitySuccess:so(e,rG.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:so(e,rG.CONV_ADD_MODALITY_FAILURE)}}}}function gk(e,t){return sy(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},links:{admitAllStatus:so(e,rG.CONV_ADMIT_ALL_STATUS)},operationId:t,debugContent:{causeId:t}}}}function gN(e,t,i=!0){sy(e,"signalingSession cannot be null"),sy(t,"joinUrl cannot be null");let n={type:"Delta",rosterUpdate:so(e,rG.CONV_ROSTER_UPDATE)},r=e.getEndpointCapabilities(),s={payload:{attach:{requireMediaContent:i,links:{end:so(e,rG.END)},locationContent:e.getLocationContent(),networkContent:e.getNetworkContent(),areaContent:e.getAreaContent(),...e?.signalingAgent?.accountConfig?.applicationType?{applicationType:e.signalingAgent.accountConfig.applicationType}:{}},capabilities:null,endpointCapabilities:r,additionalActions:[{input:{capabilities:null,endpointCapabilities:r,conversationRequest:{applicationType:e.participantManager.localParticipant.applicationType,roster:n,links:{conversationEnd:so(e,e.signalingAgentConfig.enableSplitConversationEndUrl?rG.CONV_END_JOIN:rG.CONV_END),conversationUpdate:so(e,rG.CONV_UPDATE),localParticipantUpdate:so(e,rG.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:so(e,rG.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:so(e,rG.CONV_ADD_PARTICIPANT_FAILURE),receiveMessage:so(e,rG.RECEIVE_MESSAGE)}},endpointMetadata:e.endpointMetadata,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}},name:"join",url:t,waitForResponse:!0}]}};return e.signalingAgentConfig.ecsEtag&&(s.payload.debugContent={ecsEtag:e.signalingAgentConfig.ecsEtag}),s.payload.additionalActions.length>0&&e.deviceType&&"default"!==e.deviceType&&(s.payload.additionalActions[0].input.conversationRequest.deviceType=e.deviceType),s}function gx(e){return sy(e,"signalingSession cannot be null"),{payload:{callAcceptanceAcknowledgement:{links:{mediaRenegotiation:so(e,rG.MEDIA_RENEGOTIATION),transfer:so(e,rG.TRANSFER),replacement:so(e,rG.REPLACE),balanceUpdate:so(e,rG.BALANCE_UPDATE),retargetCompletion:so(e,rG.RETARGET_COMPLETION),controlVideoStreaming:so(e,rG.CONTROL_VIDEO_STREAMING),updateMediaDescriptions:so(e,rG.UPDATE_MEDIA_DESCRIPTIONS)}}}}}function gL(e,t,i,n){sy(e,"signalingSession cannot be null");let r=sT(i);e.telemetryHelper.addOutgoingModalities(r);let s=e.getEndpointCapabilities();return{payload:{callAcceptance:{acceptedBy:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},acceptedCallModalities:r,capabilities:null,endpointCapabilities:s,clientEndpointCapabilities:0!==n?n:null,links:{mediaRenegotiation:so(e,rG.MEDIA_RENEGOTIATION),transfer:so(e,rG.TRANSFER),replacement:so(e,rG.REPLACE),balanceUpdate:so(e,rG.BALANCE_UPDATE),retargetCompletion:so(e,rG.RETARGET_COMPLETION),controlVideoStreaming:so(e,rG.CONTROL_VIDEO_STREAMING),updateMediaDescriptions:so(e,rG.UPDATE_MEDIA_DESCRIPTIONS)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,callKeepAliveInterval:null,...e?.signalingAgent?.accountConfig?.applicationType?{applicationType:e.signalingAgent.accountConfig.applicationType}:{}}}}}function gF(e){return sy(e,"signalingSession cannot be null"),{payload:{callProgress:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},status:"ringing",phrase:"ringing"}}}}function gU(e,t,i,n){sy(e,"signalingSession cannot be null");let r=e.participantManager.localParticipant;return{payload:{invitationRedirection:{target:{type:t,endpointType:n,id:i},sender:{id:r.id,endpointId:r.endpointId,participantId:r.participantId,languageId:r.languageId}}}}}function g$(e,t,i){sy(e,"signalingSession cannot be null"),sC(t);let n={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:sr.CALL_END_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}};return i&&t.code===sr.CALL_END_CODE.CANCEL&&(n.payload.callTransactionEnd.callQualityDiagnosticsInformation=i),n}function gV(e,t,i,n){sy(e,"signalingSession cannot be null");let r=[];r=n.invitationType===sr.INVITATION_TYPE.NUDGE&&Array.isArray(n.participantsToNudge)?n.participantsToNudge.map(e=>({id:e})):e.participantManager.getParticipantsToInitiateCallWith(),e.signalingAgentConfig.doHostlessCalling||sv(r.length>0,"remoteParticipants need to be set before a call can be made");let s={type:"Delta",rosterUpdate:so(e,rG.CONV_ROSTER_UPDATE)},a=e.groupId?{id:e.groupId}:null,o=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,l=e.contentSharingManager.getContentSharingInfoToStartSharing(),c=null===l?null:{identifier:l.contentIdentifier,subject:l.subject,sessionState:l.sessionState,sessionUpdateSequenceNumber:l.sequenceNumber,links:{sessionUpdate:so(e,rG.CONV_CONTENT_SHARING_UPDATE),sessionEnd:so(e,rG.CONV_CONTENT_SHARING_END)}},d=e.broadcastSession?.getContext(),u=e.getEndpointCapabilities();1===r.length&&e.telemetryHelper.setCalleeType(r[0].id),e.numberOfOriginalInvitees=r.length;let h=[];r.forEach(t=>{let i={id:t.id};t.displayName&&(i.displayName=t.displayName),t.participantId&&(i.participantId=t.participantId),(n.callToVoicemail||e.transferContext&&e.transferContext.target&&"voicemail"===e.transferContext.target.endpointType)&&(i.endpointType="voicemail"),h.push(i)});let g=e.transferContext?e.transferContext.transferor:null,p=e.transferContext?e.transferContext.transferContext:null,f={};n.callToVoicemail&&(n.voicemailResourcePath&&(f.localResourcePath=n.voicemailResourcePath),n.voicemailItemId&&(f.voicemailItemId=n.voicemailItemId));let m={payload:{conversationRequest:{conversationType:n.conversationType,subject:e.convSubject,suppressDialout:n.suppressDialout,applicationType:n.applicationType,targetApplicationType:n.targetApplicationType,roster:s,properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:so(e,e.signalingAgentConfig.enableSplitConversationEndUrl?n.subscribe?rG.CONV_END_SUBSCRIBE:rG.CONV_END_JOIN:rG.CONV_END),conversationUpdate:so(e,rG.CONV_UPDATE),localParticipantUpdate:so(e,rG.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:so(e,rG.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:so(e,rG.CONV_ADD_PARTICIPANT_FAILURE),addModalitySuccess:so(e,rG.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:so(e,rG.CONV_ADD_MODALITY_FAILURE),confirmUnmute:so(e,rG.CONV_CONFIRM_UNMUTE),receiveMessage:so(e,rG.RECEIVE_MESSAGE)}},broadcast:d,contentSharing:c,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,meetingRegistrationId:n.meetingRegistrationId,participantPin:n.participantPin},to:h},capabilities:null,endpointCapabilities:u,clientEndpointCapabilities:n.clientEndpointCapabilities?n.clientEndpointCapabilities:null,endpointMetadata:e.endpointMetadata,groupContext:a,groupChat:o,meetingInfo:e.getMeetingInfo(),meetingData:n.meetingData,meetingPreferences:n.meetingPreferences,endpointState:n.endpointState}};if(n.publishedStates?.publishedStates.length>0){let t=[];t=n.publishedStates.publishedStates.map(t=>{let i={};try{i=JSON.parse(t.content)}catch(t){e.logger.warn("createConversationRequest getPayload() failed to parse state.content")}return{stateType:t.type,level:t.level,content:i,sequenceNumber:e.getPublishStateSequenceNumber()}}),m.payload.publishedStates=t}e.deviceType&&"default"!==e.deviceType&&(m.payload.conversationRequest.deviceType=e.deviceType);let v=sT(i);if(e.telemetryHelper.addOutgoingModalities(v),m.payload.callInvitation={callModalities:v,replaces:null,transferor:g||null,clientTransferContext:p,customContext:n.customHeaderContext||null,links:{progress:so(e,rG.PROGRESS),mediaAnswer:so(e,rG.MEDIA_ANSWER),acceptance:so(e,rG.ACCEPT),redirection:so(e,rG.REDIRECTION),end:so(e,rG.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),pstnContent:e.pstnContent,emergencyContent:e.getEmergencyContent(),mediaContent:t,voicemailSettings:f,routingFlags:n.routingFlags,invitationData:n.invitationData,locationContent:e.getLocationContent(),networkContent:e.getNetworkContent(),areaContent:e.getAreaContent()},n.pickupCode&&(m.payload.callInvitation.unparkContent={pickupCode:parseInt(n.pickupCode,10)}),n.onBehalfOf&&(m.payload.callInvitation.onBehalfOf={id:n.onBehalfOf},n.onBehalfOfUserDisplayName&&(m.payload.callInvitation.onBehalfOf.displayName=n.onBehalfOfUserDisplayName)),n.callQueueContext&&(m.payload.callInvitation.callQueueContext=n.callQueueContext),n.scenario&&(m.payload.conversationRequest.scenario=n.scenario),n.alternateId&&(m.payload.participants.from.alternateId=n.alternateId),n.callingLineIdentity&&(m.payload.participants.from.callingLineIdentity=n.callingLineIdentity),n.invitationType===sr.INVITATION_TYPE.NUDGE&&(m.payload.participants.invitationType=n.invitationType),e.signalingAgentConfig.ecsEtag&&(m.payload.debugContent={ecsEtag:e.signalingAgentConfig.ecsEtag}),n.clientEndpointDebugContent){m.payload.debugContent||(m.payload.debugContent={});try{m.payload.debugContent.clientDebugContent=JSON.parse(n.clientEndpointDebugContent)}catch(e){sv(!1,`Failed to parse ${n.clientEndpointDebugContent}`)}}if(n.captchaContentJson)try{m.payload.conversationRequest.captchaContent=JSON.parse(n.captchaContentJson)}catch(e){sv(!1,`Failed to parse ${n.captchaContentJson}`)}return n.participationPreferences&&(m.payload.participationPreferences=n.participationPreferences),n.participantPropertyBag&&(m.payload.participantPropertyBag=n.participantPropertyBag),m}function gB(e,t){return sy(e,"signalingSession cannot be null"),sC(t),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:sr.CALL_END_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED},callTransactionEnd:t}}}function gH(e,t){return{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:t}}}function gj(e,t,i,n,r,s=!1){sy(e,"signalingSession cannot be null");let a={type:"Delta",rosterUpdate:so(e,rG.CONV_ROSTER_UPDATE)},o=e.getEndpointCapabilities(),l=e.groupId?{id:e.groupId}:null,c=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,d={payload:{conversationRequest:{conversationType:n.conversationType,subject:e.convSubject,suppressDialout:n.suppressDialout,scenario:n.scenario,applicationType:n.applicationType,roster:a,properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:so(e,e.signalingAgentConfig.enableSplitConversationEndUrl?n.subscribe?rG.CONV_END_SUBSCRIBE:rG.CONV_END_JOIN:rG.CONV_END),conversationUpdate:so(e,rG.CONV_UPDATE),localParticipantUpdate:so(e,rG.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:so(e,rG.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:so(e,rG.CONV_ADD_PARTICIPANT_FAILURE),receiveMessage:so(e,rG.RECEIVE_MESSAGE)}},groupContext:l,groupChat:c,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,meetingRegistrationId:n.meetingRegistrationId,participantPin:n.participantPin}},capabilities:null,endpointCapabilities:o,clientEndpointCapabilities:n.clientEndpointCapabilities?n.clientEndpointCapabilities:null,endpointMetadata:e.endpointMetadata,meetingInfo:e.getMeetingInfo(),meetingData:n.meetingData,meetingPreferences:n.meetingPreferences,endpointState:n.endpointState}};if(n.publishedStates?.publishedStates.length>0){let t=[];t=n.publishedStates.publishedStates.map(t=>{let i={};try{i=JSON.parse(t.content)}catch(t){e.logger.warn("joinConversationRequest getPayload() failed to parse state.content")}return{stateType:t.type,level:t.level,content:i,sequenceNumber:e.getPublishStateSequenceNumber()}}),d.payload.publishedStates=t}if(n?.applyServerMute&&(d.payload.participants.from.applyServerMute=n.applyServerMute.value,n.applyServerMute.mediaTypes&&(d.payload.participants.from.mediaTypes=n.applyServerMute.mediaTypes)),e.deviceType&&"default"!==e.deviceType&&(d.payload.conversationRequest.deviceType=e.deviceType),!n.subscribe)if(s)d.payload.stream={};else{d.payload.callInvitation={replaces:null,transferor:null,links:{progress:so(e,rG.PROGRESS),mediaAnswer:so(e,rG.MEDIA_ANSWER),acceptance:so(e,rG.ACCEPT),redirection:so(e,rG.REDIRECTION),end:so(e,rG.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,locationContent:e.getLocationContent(),networkContent:e.getNetworkContent(),areaContent:e.getAreaContent(),sharedLineCallInvitationContent:n.sharedLineCallInvitationContent,invitationData:n.invitationData,callQueueContext:n.callQueueContext};let r=sT(i);d.payload.callInvitation.callModalities=r,e.telemetryHelper.addOutgoingModalities(r)}if(e.signalingAgentConfig.ecsEtag&&(d.payload.debugContent={ecsEtag:e.signalingAgentConfig.ecsEtag}),r&&(d.payload.debugContent||(d.payload.debugContent={}),d.payload.debugContent.causeId=r),n.clientEndpointDebugContent){d.payload.debugContent||(d.payload.debugContent={});try{d.payload.debugContent.clientDebugContent=JSON.parse(n.clientEndpointDebugContent)}catch(e){sv(!1,`Failed to parse ${n.clientEndpointDebugContent}`)}}if(n.captchaContentJson)try{d.payload.conversationRequest.captchaContent=JSON.parse(n.captchaContentJson)}catch(e){sv(!1,`Failed to parse ${n.captchaContentJson}`)}return n.callQueueContext&&(d.payload.conversationRequest.callQueueContext=n.callQueueContext),n.participationPreferences&&(d.payload.participationPreferences=n.participationPreferences),n.participantPropertyBag&&(d.payload.participantPropertyBag=n.participantPropertyBag),d}function gq(e,t,i){return sy(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},..."meetingGroupId"in t&&{meetingGroup:t.meetingGroupId},..."meetingGroupLabel"in t&&{meetingGroupLabel:t.meetingGroupLabel},...t.groupPreferences&&{groupPreferences:t.groupPreferences},links:{joinMeetingGroupStatus:so(e,rG.JOIN_MEETING_GROUP_STATUS)},operationId:i}}}function gW(e,t,i,n){sy(e,"signalingSession cannot be null"),sC(t);let r={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:n&&"all"!==n?void 0:n},conversationTransactionEnd:{reason:"noError",code:sr.CALL_END_CODE.SUCCESS,phrase:sr.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}};return i&&t.code===sr.CALL_END_CODE.CANCEL&&(r.payload.callTransactionEnd.callQualityDiagnosticsInformation=i),r}function gG(e,t,i){sy(e,"signalingSession cannot be null");let{meetingGroupId:n}=t;return{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},meetingGroup:n,links:{leaveMeetingGroupStatus:so(e,rG.LEAVE_MEETING_GROUP_STATUS)},operationId:i}}}function gz(e,t,i){return sy(e,"signalingSession cannot be null"),sy(i,"newOfferLink cannot be null"),{payload:{mediaOfferRequirements:{compatibleContentTypes:t,links:{offerReady:so(e,rG.NEW_MEDIA_OFFER)}}}}}function gJ(e,t){return sy(t,"signalingSession cannot be null"),{payload:{callTransfer:{target:{id:t.participantManager.localParticipant.id},transferor:{details:{id:t.participantManager.localParticipant.id,endpointId:t.participantManager.localParticipant.endpointId,participantId:t.participantManager.localParticipant.participantId,languageId:t.participantManager.localParticipant.languageId},authorizationToken:null},parkType:e,links:{transferAcceptance:so(t,rG.TRANSFER_ACCEPTANCE),transferCompletion:so(t,rG.TRANSFER_COMPLETION)}}}}}function gK(e,t,i){sy(e,"ParkRequestPayload: signalingSession cannot be null");let n={payload:{hold:{holdType:t,links:{holdCompletion:so(e,rG.PARK_COMPLETION)}}}};return i&&(n.payload.debugContent=i),n}function gQ(e){return sy(e,"signalingSession cannot be null"),{payload:{callParticipantUpdate:{links:sE(e,rq),clientContentForMediaController:e.webRtcSignalingManager.getClientUrls()}}}}function gY(e,t,i,n,r,s){let a={payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},publishedState:{content:n,level:i,stateType:t,sequenceNumber:e.getPublishStateSequenceNumber()},scope:r}};if(s&&s.length>0){let e=s.map(e=>({id:e}));a.payload.to=e}return a}function gZ(e,t){return sy(e,"signalingSession cannot be null"),sC(t),{payload:{callEnd:t}}}function gX(e,t,i,n){let r={from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},sequenceNumber:e.getPublishStateSequenceNumber(),scope:t};return"specified"===t?r.stateIds=i:r.stateType=n,{payload:r}}function g0(e,t){return{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},searchOptions:t}}}function g1(e,t){return sy(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,displayName:e.participantManager.localParticipant.displayName},...t,links:{setMeetingLayoutStatus:so(e,rG.SET_MEETING_LAYOUT_STATUS)}}}}function g2(){return{payload:{transferAcceptance:{}}}}function g3(e,t,i,n,r){return sy(t,"signalingSession cannot be null"),sS(e,"transferTarget cannot be null OR empty"),{payload:{callTransfer:{target:{id:e,endpointType:"TransferTypeVoicemail"===n?"voicemail":void 0},transferor:{details:{id:t.participantManager.localParticipant.id,endpointId:t.participantManager.localParticipant.endpointId,participantId:t.participantManager.localParticipant.participantId,languageId:t.participantManager.localParticipant.languageId},authorizationToken:null},links:{transferAcceptance:so(t,rG.TRANSFER_ACCEPTANCE),transferCompletion:so(t,rG.TRANSFER_COMPLETION)},replacementDetails:i,disableForwardingAndUnanswered:r&&r.disableForwardingAndUnanswered,transferContext:r&&r.clientTransferContext}}}}function g4(e){return{payload:{transferCompletion:e}}}function g5(e,t){sy(e,"ResumePayload: signalingSession cannot be null");let i={payload:{resume:{links:{resumeCompletion:so(e,rG.UNPARK_COMPLETION)}}}};return t&&(i.payload.debugContent=t),i}function g6(e,t){return sy(t,"clientMetadataJson cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},endpointMetadata:t}}}function g8(e,t,i,n,r){sy(t,"clientStateJson cannot be null");let s={payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},endpointState:t}};if(r)try{s.payload.captchaContent=JSON.parse(r)}catch(t){e.logger.warn("updateEndpointState getPayload() failed to parse captchaContentJson")}if(i?.publishedStates.length>0){let t=[];t=i.publishedStates.map(t=>{let i={};try{i=JSON.parse(t.content)}catch(t){e.logger.warn("updateEndpointState getPayload() failed to parse stateType.content")}return{stateType:t.type,level:t.level,content:i,sequenceNumber:e.getPublishStateSequenceNumber()}}),s.payload.publishedStates=t}return n&&(s.payload.links={updateEndpointStateStatus:so(e,rG.DISABLE_PREHEAT_ASYNC_STATUS)}),s}function g9(e,t,i){sy(e,"signalingSession cannot be null");let{scope:n,toGroup:r,fromGroup:s,participants:a}=t;"specified"===n&&sy(a,"participantsIds cannot be null");let o={from:{id:e.participantManager.localParticipant.id,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,displayName:e.participantManager.localParticipant.displayName},scope:n,fromGroup:s,toGroup:r,links:{updateMeetingGroupsStatus:so(e,rG.UPDATE_MEETING_GROUPS_STATUS)},operationId:i};return a&&(o.to=a.map(e=>({id:e.mri,endpointId:e.endpointId,participantId:e.participantId}))),{payload:o}}function g7(e,t,i){return sy(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,displayName:e.participantManager.localParticipant.displayName},meetingLiveState:t,links:{updateMeetingLiveStateStatus:so(e,rG.UPDATE_MEETING_LIVE_STATE_STATUS)},operationId:i}}}function pe(e,t){let i={};return void 0!==t.allowRaiseHands&&(i.allowRaiseHands=t.allowRaiseHands),void 0!==t.attendeeRestrictions&&(i.attendeeRestrictions=t.attendeeRestrictions),void 0!==t.lockMeeting&&(i.lockMeeting=t.lockMeeting),void 0!==t.breakoutRoomsEnabled&&(i.breakoutRoomsEnabled=t.breakoutRoomsEnabled),void 0!==t.allowPresentersToManageBreakoutRooms&&(i.allowPresentersToManageBreakoutRooms=t.allowPresentersToManageBreakoutRooms),void 0!==t.disableMdpClientAudioRecording&&(i.disableMdpClientAudioRecording=t.disableMdpClientAudioRecording),void 0!==t.refreshSettings&&(i.refreshSettings=t.refreshSettings),void 0!==t.aiInterpretationEnabled&&(i.aiInterpretationEnabled=t.aiInterpretationEnabled),void 0!==t.groupCopilotDetails&&(i.groupCopilotDetails=t.groupCopilotDetails),void 0!==t.segmentationTypeForAiInterpreter&&(i.segmentationTypeForAiInterpreter=t.segmentationTypeForAiInterpreter),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},meetingSettings:i,sequenceNumber:e.getPublishStateSequenceNumber()}}}function pt(e,t,i,n){return sy(e,"signalingSession cannot be null"),{payload:{monitorContent:{sequenceId:e.getMonitorSequenceId(),monitorActionType:t,monitorData:i??{},links:{monitorCompletion:so(e,rG.MONITOR_COMPLETION)}},debugContent:{causeId:n}}}}function pi(e){sy(e,"signalingSession cannot be null");let t={type:"Delta",rosterUpdate:so(e,rW.CONV_ROSTER_UPDATE)};return{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},roster:t,links:sE(e,rW)}}}function pn(e,t,i){return sy(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId},to:t,links:{updateParticipantPropertiesStatus:so(e,rG.UPDATE_PARTICIPANT_PROPERTIES_STATUS)},operationId:i}}}function pr(e,t){return sy(e,"signalingSession cannot be null"),{payload:{mediaAnswer:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaContent:t,pstnContent:e.pstnContent}}}}function ps(e,t){return sy(e,"signalingSession cannot be null"),{payload:{UpdateMediaDescriptions:{mediaDescriptions:t}}}}function pa(e,t,i){return sy(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,displayName:e.participantManager.localParticipant.displayName},meetingStates:t,updateMeetingStatesStatus:so(e,rG.UPDATE_MEETING_STATES_STATUS),operationId:i}}}var po=eR(i(892891)),pl=eR(eX()),pc=["CorrelationId","SignalingSessionId","Region","ParticipantId","ClientInformation","ResultCode","ResultDetail","ResultValue","Direction","ClientType","MeetingRoles"],pd=class{constructor(e,t){this.signalingSession=e,this.logger=t,this.logConversationCallModalityEvent=e=>{let t=this.createCallModalityEvent(e);this.logger.info("sending modality telemetry:",this.getStringifiedEventData(t)),t.hostName=this.getHostDomainInfo(),this.telemetryLogger.sendEvent(u6.CONVERSATION_CALL_MODALITY,t)},this.logConversationContentSharingEvent=e=>{e[ht.CORRELATION_ID]=this.signalingSession.correlationId,e[u8.ECS_ETAG]=this.signalingSession.signalingAgentConfig.ecsEtag,this.logger.info("sending content sharing telemetry:",this.getStringifiedEventData(e)),e.hostName=this.getHostDomainInfo(),this.telemetryLogger.sendEvent(u6.CONVERSATION_CONTENT_SHARING,e)},this.logHttpTelemetryEvent=e=>{e[u8.ECS_ETAG]=this.signalingSession.signalingAgentConfig.ecsEtag,e[u7]=this.getSignalingAgentConfig(),this.logger.info("sending http telemetry:",this.getStringifiedEventData(e)),e.hostName=this.getHostDomainInfo(),this.telemetryLogger.sendEvent(u6.CONVERSATION_HTTP_REQUEST,e)},this.getHostDomainInfo=()=>"localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost":"<redacted>",this.getSignalingAgentConfig=()=>{let e=[],t=this.signalingSession.signalingAgentConfig;return t.supportsCompressedServicePayload&&e.push(he.SUPPORTS_COMPRESSED_PAYLOAD),t.brokerEnabledOutgoing&&e.push(he.BROKER_OUTGOING_ENABLED),t.brokerEnabledIncoming&&e.push(he.BROKER_INCOMING_ENABLED),t.brokerRequestBatching&&e.push(he.BROKER_REQUEST_BATCHING_ENABLED),t.brokerExclusively&&e.push(he.BROKER_EXCLUSIVELY_ENABLED),t.supportsSynchronousTrouterResponse&&e.push(he.SYNC_TROUTER_RESPONSE),t.handleMediaOfferFromPushNotification&&e.push(he.HANDLE_OFFER_FROM_NOTIFICATION),t.handleNewOfferRequest&&e.push(he.HANDLE_NEW_OFFER_REQUEST),t.sendProgressFromCC&&e.push(he.SEND_PROGRESS_FROM_CC),t.useInternalHttpDispatcher&&e.push(he.INTERNAL_HTTP_DISPATCHER),t.enableTokenCache&&e.push(he.ENABLE_TOKEN_CACHE),t.enableTokenPrefetch&&e.push(he.ENABLE_TOKEN_PREFETCH),t.supportMediaRetargetWhileIncomingRenegotiation&&e.push(he.SUPPORT_MEDIA_RETARGET_WHILE_INCOMING_RENEGOTIATION),t.enableCallEstablishmentTimeoutsForStartJoinCall&&e.push(he.ENABLE_CALL_ESTABLISHMENT_TIMEOUTS_FOR_START_OR_JOIN_CALL),t.enableTokenCacheForGenericTokenAPI&&e.push(he.ENABLE_TOKEN_CACHE_FOR_GENERIC_TOKEN_API),t.enableLongOutgoing1To1SetupTimeoutForWeb&&e.push(he.ENABLE_LONG_OUTGOING_1TO1_SETUP),e.push(he.SERVER_MUTE_UNMUTE),e.join(",")},this.getStringifiedEventData=e=>{try{return JSON.stringify(e,pc,4)}catch(e){return"invalid data"}},this.telemetryLogger=this.signalingSession.signalingAgentConfig.oneDsTelemetryLogger??this.signalingSession.signalingAgentConfig.telemetryManager}createCallModalityEvent(e){let t={};t.Type=u5.NGC_SOURCE;let i=(i,n=!1)=>{n?t[i]=JSON.stringify(e[i]):t[i]=e[i]},n=(t,n=!1)=>{e.hasOwnProperty(t)&&i(t,n)};if(t.ResultDetail=e[u8.RESULT_DETAIL],t.ResultValue=e[u8.RESULT_VALUE],t.ResultCode=e[u8.CALL_END_CODE],t.ResultCauseId=e[u8.RESULT_CAUSE_ID],t[u7]=this.getSignalingAgentConfig(),t[ht.CORRELATION_ID]=this.signalingSession.correlationId,t[ht.SIGNALING_SESSION_ID]=this.signalingSession.sessionId,i(ht.ENDPOINT_ID),i(ht.PARTICIPANT_ID),t[u8.ECS_ETAG]=this.signalingSession.signalingAgentConfig.ecsEtag,i(u8.CONVERSATION_SERVICE_URL),i(u8.CALL_START_TIME,!0),i(u8.CALL_END_TIME,!0),i(u8.MESSAGING_CHANNEL,!0),t[u8.IS_GROUP_CALL]=this.signalingSession.multiParty?"true":"false",t[u8.IS_HOSTLESS_CALL]=this.signalingSession.isHostLessCall?"true":"false",t[u8.IS_CAST_CALL]=this.signalingSession.isCastCall?"true":"false",t[u8.IS_HUDDLE_GROUP_CALL]=this.signalingSession.isHuddleGroupCall?"true":"false",t[u8.IS_ON_BEHALF_OF_CALL]=this.signalingSession.onBehalfOf?"true":"false",i(u8.CLIENT_INFORMATION),i(u8.IS_SDP_IN_CALL_NOTIFICATION),i(u8.CALL_TERMINATING_END),i(u8.CALL_END_CODE,!0),i(u8.CALL_END_SUB_CODE,!0),n(ht.SHARED_CORRELATION_ID),n(u8.DIRECTION),n(u8.SELF_PARTICIPANT_ROLE),n(u8.CONNECTED_DURATION_IN_MS,!0),n(u8.TIME_TO_RING_IN_MS,!0),n(u8.NETWORK_REQUESTS_COMPLETED),n(u8.NETWORK_REQUESTS_PENDING),n(u8.LOCAL_OPERATIONS_PERFORMED),n(u8.EVENT_TIMESTAMP_BAG),n(u8.ROSTER_UPDATES_BAG),n(u8.NETWORK_REQUESTS_BAG),n(u8.TROUTER_WAIT_OPERATIONS),n(u8.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS),n(u8.OUTGOING_MODALITIES),n(u8.INCOMING_MODALITIES),n(u8.OFFERED_MODALITIES),n(u8.ANSWERED_MODALITIES),n(u8.VBSS_OPERATIONS),n(u8.CALLER_TYPE),n(u8.CALLEE_TYPE),n(u8.SCENARIO),n(u8.PREHEATED_CALL_SETUP_DURATION_IN_S),n(u8.CALL_CANCELATION_DURATION_IN_S),n(u8.IS_PREHEATED),n(u8.ACS_RESOURCE_ID),n(u8.CALL_END_RESULT_CATEGORIES),n(u8.APPLICATION_TYPE),n(u8.RING),n(u8.REGION),n(u8.PARTITION),n(u8.JOINED_FROM),n(u8.MEETING_URL),n(u8.MEETING_CODE),n(u8.USER_HEX_CID),n(u8.BROADCAST_MEETING_ROLE),n(u8.MEETING_ROLE),n(u8.ADVANCED_MEETING_ROLE),n(u8.MEETING_ROLES,!0),n(u8.PARTICIPANT_TYPE),n(u8.DISPLAY_NAME),n(u8.AUDIO_ONLY_WATERMARK),n(u8.TARGET_APPLICATION_TYPE),n(u8.IS_REINVITELESS),n(u8.CLIENT_TYPE),n(u8.CONFLICTING_CALL_ID),this.signalingSession.callType&&(t[u8.CALL_TYPE]=this.signalingSession.callType),this.signalingSession.signalingAgentConfig.testCall&&(t[u8.TEST_CONTEXT_ID]="Test"),this.signalingSession.groupId&&(t[ht.GROUP_ID]=ta(this.signalingSession.groupId)),this.signalingSession.threadId&&(t[ht.THREAD_ID]=th(this.signalingSession.threadId)),this.signalingSession.teamsMessageId&&(t[ht.TEAMS_MESSAGEID]=this.signalingSession.teamsMessageId),this.signalingSession.getMeetingInfo()){let e={...this.signalingSession.getMeetingInfo()};e.hasOwnProperty("organizerId")&&(e.organizerId=ta(e.organizerId)),t[ht.TEAMS_MEETINGINFO]=JSON.stringify(e)}return this.signalingSession.multiParty&&0===this.signalingSession.numberOfOriginalInvitees&&e.hasOwnProperty(u8.SELF_PARTICIPANT_ROLE)&&e[u8.SELF_PARTICIPANT_ROLE]===hs.CALLER&&(t[u8.IS_MEETUP_CALL]="true"),t}};function pu(e,t){return new pd(e,t)}var ph=class{constructor(e,t,i){this.signalingSession=e,this.callStartTime=i,this.networkRequestsCompleted=[],this.networkRequestsStarted={},this.networkRequests={},this.localOperationsPerformed=[],this.recordedEvents=[],this.rosterUpdates=[],this.contentSharingOperationsPerformed={},this.outgoingModalities=[],this.incomingModalities=[],this.offeredModalities="",this.answeredModalities="",this.vbssOperations=[],this.vbssStarted=!1,this.localOfferAnswerGenerationTimestamps=[],this.trouterWaitOperations=[],this.telemetryData={},this.contentSharingBaseTelemetryData={},this.httpRequestTelemetryData={},this.connectedStopWatch=null,this.preheatedCallSetupDurationWatch=null,this.callCancelationDurationWatch=null,this.timeToRingStopWatch=null,this.isSdpInCallNotification=!1,this.isPreheated=0,this.isReinviteless=0,this.addBrokerChannel=()=>{this.setMessagingChannel(u9.BROKER)},this.addTrouterChannel=()=>{this.setMessagingChannel(u9.TROUTER)},this.addTrouterWaitOperation=e=>{this.trouterWaitOperations.push(this.recordOperation(e))},this.recordIncomingEvent=(e,t,i)=>{let n=sk(t),r={origin:t.origin,causeId:n,data:i};i||delete r.data,this.recordEvent(e,r)},this.recordIncomingEventCount=e=>{this.localOperationsPerformed.push(this.recordOperation(e));let t=this.recordedEvents.findIndex(t=>t[e]);if(-1!==t)this.recordedEvents[t][e]+=1;else{let t={};t[e]=1,this.recordedEvents.push(t)}},this.recordEvent=(e,t)=>{this.logger.debug("Event:",e,t),this.localOperationsPerformed.push(this.recordOperation(e));let i={};i[e]=this.timeSinceCallStart(),t&&(i.data=t),this.recordedEvents.push(i)},this.recordRosterEvent=(e,t,i)=>{this.localOperationsPerformed.push(this.recordOperation(t));let n={data:e,causeId:i},r={eventName:this.timeSinceCallStart(),data:n};this.rosterUpdates.push(r)},this.addOutgoingModalities=e=>{e&&this.outgoingModalities.push(e)},this.addIncomingModalities=e=>{e&&this.incomingModalities.push(e)},this.setOfferedModalities=(e,t)=>{this.offeredModalities=this.sdpTelemetryFormat(e,t)},this.setAnsweredModalities=(e,t)=>{this.answeredModalities=this.sdpTelemetryFormat(e,t)},this.setIsSdpInCallNotification=e=>{this.isSdpInCallNotification=e},this.addVbssOperations=e=>{e&&(e===ha.START?this.vbssStarted=!0:this.vbssStarted=!1,this.vbssOperations.push(this.recordOperation(e)))},this.addNetworkOperationStarted=e=>{sw(this.networkRequestsStarted,e,this.recordOperation(e))},this.addNetworkOperationCompleted=(e,t,i)=>{let n=t?hn.SUCCESS:hn.FAILURE,r=i?`${e}:${n}:${i}`:`${e}:${n}`;this.networkRequestsCompleted.push(this.recordOperation(r)),sP(this.networkRequestsStarted,e)},this.updateNetworkRequest=e=>{this.networkRequests[e.uid]?po.assign(this.networkRequests[e.uid],e):this.networkRequests[e.uid]=e},this.deleteNetworkRequest=e=>{delete this.networkRequests[e.uid]},this.addContentSharingOperation=(e,t,i)=>{this.contentSharingOperationsPerformed[e]||(this.contentSharingOperationsPerformed[e]=[]);let n={[t]:this.timeSinceCallStart()};this.contentSharingOperationsPerformed[e].push(n);let r=this.contentSharingOperationsPerformed[e].length-1;return i&&this.updateContentSharingOperation(e,r,i),r},this.updateContentSharingOperation=(e,t,i)=>{if(!this.contentSharingOperationsPerformed[e])return;let n=this.contentSharingOperationsPerformed[e][t],r=[];for(let e of Object.keys(i))r.push(`${e}: ${i[e]}`);n.data=r.join(", ")},this.setDirection=e=>{this.telemetryData[u8.DIRECTION]=e},this.setEndPointId=e=>{this.telemetryData[ht.ENDPOINT_ID]=e,this.contentSharingBaseTelemetryData[ht.ENDPOINT_ID]=e,this.httpRequestTelemetryData[ht.ENDPOINT_ID]=e},this.setParticipantId=e=>{this.telemetryData[ht.PARTICIPANT_ID]=e,this.contentSharingBaseTelemetryData[ht.PARTICIPANT_ID]=e,this.httpRequestTelemetryData[ht.PARTICIPANT_ID]=e},this.addTokenTelemetry=(e,t)=>{if(!e)return void this.logger.error("[addTokenTelemetry] httprequest uid is undefined");this.networkRequests?.[e]?(this.networkRequests[e].tokenTelemetries||(this.networkRequests[e].tokenTelemetries=[]),this.networkRequests[e].tokenTelemetries.push(t)):this.logger.info(`[addTokenTelemtry] httprequest: ${e} is not found in networkRequests`)},this.setConversationServiceUrl=e=>{this.telemetryData[u8.CONVERSATION_SERVICE_URL]=e},this.setMeetingInfo=e=>{e||(this.telemetryData[u8.MEETING_INFO]=e)},this.setJoinedFrom=e=>{this.telemetryData[u8.JOINED_FROM]=e},this.setMeetingCode=e=>{this.telemetryData[u8.MEETING_CODE]=e},this.setMeetingUrl=e=>{this.telemetryData[u8.MEETING_URL]=e},this.setBroadcastMeetingRole=e=>{this.telemetryData[u8.BROADCAST_MEETING_ROLE]=e},this.setMeetingRole=e=>{this.telemetryData[u8.MEETING_ROLE]=e},this.setAdvancedMeetingRole=e=>{this.telemetryData[u8.ADVANCED_MEETING_ROLE]=e},this.setParticipantType=e=>{this.telemetryData[u8.PARTICIPANT_TYPE]=e},this.setSelfParticipantRole=e=>{this.telemetryData[u8.SELF_PARTICIPANT_ROLE]=e},this.setDisplayName=e=>{let t=new tr(e,1);this.telemetryData[u8.DISPLAY_NAME]=t},this.setAudioOnlyWatermark=e=>{this.telemetryData[u8.AUDIO_ONLY_WATERMARK]=e},this.setWatermarkSupport=e=>{this.telemetryData[u8.CLIENT_SUPPORT_WATERMARK]=e},this.setClientSupportsPreventScreenCapture=e=>{this.telemetryData[u8.CLIENT_SUPPORTS_PREVENT_SCREEN_CAPTURE]=e},this.setScenario=e=>{this.telemetryData[u8.SCENARIO]=e},this.setTargetApplicationType=e=>{e&&(this.telemetryData[u8.TARGET_APPLICATION_TYPE]=e)},this.setCallerType=e=>{e&&(this.telemetryData[u8.CALLER_TYPE]=e.split(":",1)[0])},this.setCalleeType=e=>{e&&(this.telemetryData[u8.CALLEE_TYPE]=e.split(":",1)[0])},this.setTerminatingData=e=>{this.telemetryData[u8.CALL_TERMINATING_END]=e.terminatingEnd,this.telemetryData[u8.CALL_END_CODE]=e.endCode||sr.CALL_END_CODE.SUCCESS,this.telemetryData[u8.CALL_END_SUB_CODE]=e.endSubCode||sr.CALL_END_SUB_CODE.SUCCESS,this.telemetryData[u8.CALL_PHRASE]=e.phrase||sr.CALL_END_PHRASE.UNKNOWN,this.telemetryData[u8.RESULT_VALUE]=e.resultValue||hn.SUCCESS,this.telemetryData[u8.RESULT_DETAIL]=e.resultDetail||"Call gracefully hungup",this.telemetryData[u8.RESULT_CAUSE_ID]=e.causeId||"unknown",this.telemetryData[u8.CALL_END_RESULT_CATEGORIES]=e.resultCategories||[],this.telemetryData[u8.CALL_END_CLIENT_SUB_CODE]=e.clientReasonSubCode,this.telemetryData[u8.CALL_END_CLIENT_PHRASE]=e.clientReasonPhrase},this.startCallInitializationWatch=e=>{this.timeToRingStopWatch=hQ(),e&&(this.timeToRingStopWatch.msElapsed+=e)},this.startCallConnectedWatch=()=>{this.connectedStopWatch=hQ()},this.setIsPreheated=()=>{this.isPreheated=1},this.startPreheatedCallSetupDurationWatch=()=>{this.preheatedCallSetupDurationWatch=hQ()},this.stopPreheatedCallSetupDurationWatch=()=>{this.preheatedCallSetupDurationWatch.pause()},this.startCallCancelationDurationWatch=()=>{this.callCancelationDurationWatch=hQ()},this.stopCallCancelationDurationWatch=()=>{this.callCancelationDurationWatch&&this.callCancelationDurationWatch.pause()},this.getCallCancelationDuration=()=>this.callCancelationDurationWatch?this.callCancelationDurationWatch.durationInSeconds():0,this.resetCallCancelationDurationWatch=()=>{this.callCancelationDurationWatch=null},this.setOfferAnswerGenerationTimestamps=e=>{this.localOfferAnswerGenerationTimestamps.push(this.recordOperation(e))},this.setTimeToRingDuration=()=>{this.timeToRingStopWatch&&(this.telemetryData[u8.TIME_TO_RING_IN_MS]=this.timeToRingStopWatch.duration(),this.timeToRingStopWatch=null)},this.dispose=()=>{this.sendCallModalityTelemetryData()},this.setMessagingChannel=e=>{this.telemetryData[u8.MESSAGING_CHANNEL]||(this.telemetryData[u8.MESSAGING_CHANNEL]=[]),this.telemetryData[u8.MESSAGING_CHANNEL].some(t=>-1!==t.indexOf(e))||this.telemetryData[u8.MESSAGING_CHANNEL].push(this.recordOperation(e))},this.sendHttpTelemetryData=e=>{let t={...this.httpRequestTelemetryData};t[ht.CORRELATION_ID]=this.signalingSession.correlationId,t[ht.SIGNALING_SESSION_ID]=this.signalingSession.sessionId,t[u8.CLIENT_INFORMATION]=sd(this.signalingSession.signalingAgentConfig.clientInformation);let i=JSON.stringify({eventStart:this.callStartTime,events:this.networkRequests[e]});sP(this.networkRequests,e),t[u8.NETWORK_REQUESTS_BAG]=i,this.telemetryLogger.logHttpTelemetryEvent(t)},this.sdpTelemetryFormat=(e,t)=>{if(!e)return"";let i=e=>{switch(e){case"main-audio":return"Audio";case"main-video":return"Video";case"applicationsharing-video":return"AppSharing";default:return}},n=e=>{switch(e){case"inactive":return"Inactive";case"sendonly":return t?"ReceiveFromPeer":"SendToPeer";case"recvonly":return t?"SendToPeer":"ReceiveFromPeer";default:return"Bidirectional"}},r={"main-audio":0,"main-video":0,"applicationsharing-video":0},s=[];for(let t of pl.parse(e).media){let e=i(t.label);if(!e)continue;let a=r[t.label]++,o=n(t.direction);s.push(`${e}[${a}] = ${o}`)}return s.join(", ")},this.setReinviteless=e=>{this.isReinviteless=+!!e},this.logger=e.logger,this.telemetryLogger=pu(e,this.logger),this.telemetryData[u8.CALL_START_TIME]=this.callStartTime,this.telemetryData[u8.CONVERSATION_SERVICE_URL]=e.signalingAgentConfig.conversationServiceUrl,this.fillCommonData(t,this.telemetryData),this.fillCommonData(t,this.httpRequestTelemetryData),this.fillCommonData(t,this.contentSharingBaseTelemetryData)}fillCommonData(e,t){t[u8.APPLICATION_TYPE]=e.applicationType,t[u8.RING]=e.ring,t[u8.TENANT_ID]=e.tenantId,t[u8.USER_HEX_CID]=e.userHexCID,t[u8.ACS_RESOURCE_ID]=e.acsResourceId,t[u8.REGION]=e.region,t[u8.PARTITION]=e.partition,t[u8.CLIENT_TYPE]=e.clientType}addChangingCorrelationId(e,t){this.telemetryData[u8.CHANGING_CORRELATION_ID_OLD_ID]=e,this.telemetryData[u8.CHANGING_CORRELATION_ID_NEW_ID]=t}addSharedCorrelationId(e){this.telemetryData[ht.SHARED_CORRELATION_ID]=e}setMeetingRoles(e){this.telemetryData[u8.MEETING_ROLES]=e}setConflictingCallId(e){this.telemetryData[u8.CONFLICTING_CALL_ID]=e}sendContentSharingTelemetryData(e,t,i,n,r,s){let a={...this.contentSharingBaseTelemetryData},o=this.contentSharingOperationsPerformed[e];o&&(a[u8.EVENT_TIMESTAMP_BAG]=JSON.stringify(o)),a[ht.CONTENT_SHARING_CORRELATION_ID]=e,a[ht.SIGNALING_SESSION_ID]=t,a[ht.CONTENT_SHARING_ID]=s||"",a[u8.CONTENT_SHARING_SERVICE_URL]=r,a[u8.CONTENT_SHARING_DIRECTION]=i?hr.OUTGOING:hr.INCOMING,a[u8.CALL_END_CODE]=n.code,a[u8.CALL_END_SUB_CODE]=n.subCode,a[u8.CALL_PHRASE]=n.phrase,a[u8.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(n.resultCategories),a[u8.CALL_END_CAUSE_ID]=n.causeId,a[u8.CLIENT_INFORMATION]=sd(this.signalingSession.signalingAgentConfig.clientInformation),delete this.contentSharingOperationsPerformed[e],this.telemetryLogger.logConversationContentSharingEvent(a)}recordOperation(e){return`${e}:${this.timeSinceCallStart()}`}timeSinceCallStart(){return new Date().getTime()-this.callStartTime}sendCallModalityTelemetryData(){this.vbssStarted&&this.addVbssOperations(ha.CALL_END);let e=e=>"number"==typeof e?e/1e3:0;if(this.telemetryData[u8.CLIENT_INFORMATION]=sd(this.signalingSession.signalingAgentConfig.clientInformation),this.telemetryData[u8.CALL_END_TIME]=new Date().getTime(),this.connectedStopWatch&&(this.telemetryData[u8.CONNECTED_DURATION_IN_MS]=this.connectedStopWatch.duration()),this.telemetryData[u8.IS_PREHEATED]=this.isPreheated,this.preheatedCallSetupDurationWatch&&(this.telemetryData[u8.PREHEATED_CALL_SETUP_DURATION_IN_S]=e(this.preheatedCallSetupDurationWatch.duration())),this.callCancelationDurationWatch&&(this.telemetryData[u8.CALL_CANCELATION_DURATION_IN_S]=e(this.callCancelationDurationWatch.duration())),this.networkRequestsCompleted.length&&(this.telemetryData[u8.NETWORK_REQUESTS_COMPLETED]=JSON.stringify(this.networkRequestsCompleted)),this.localOperationsPerformed.length&&(this.telemetryData[u8.LOCAL_OPERATIONS_PERFORMED]=JSON.stringify(this.localOperationsPerformed)),this.trouterWaitOperations.length&&(this.telemetryData[u8.TROUTER_WAIT_OPERATIONS]=JSON.stringify(this.trouterWaitOperations)),this.localOfferAnswerGenerationTimestamps.length&&(this.telemetryData[u8.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=JSON.stringify(this.localOfferAnswerGenerationTimestamps)),this.incomingModalities.length&&(this.telemetryData[u8.INCOMING_MODALITIES]=JSON.stringify(this.incomingModalities)),this.outgoingModalities.length&&(this.telemetryData[u8.OUTGOING_MODALITIES]=JSON.stringify(this.outgoingModalities)),this.offeredModalities.length&&(this.telemetryData[u8.OFFERED_MODALITIES]=this.offeredModalities),this.answeredModalities.length&&(this.telemetryData[u8.ANSWERED_MODALITIES]=this.answeredModalities),this.telemetryData[u8.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(this.telemetryData[u8.CALL_END_RESULT_CATEGORIES]),this.telemetryData[u8.IS_SDP_IN_CALL_NOTIFICATION]=this.isSdpInCallNotification.toString(),this.vbssOperations.length&&(this.telemetryData[u8.VBSS_OPERATIONS]=JSON.stringify(this.vbssOperations)),this.recordedEvents.length){let e=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents});this.telemetryData[u8.EVENT_TIMESTAMP_BAG]=e}if(this.rosterUpdates.length){let e=JSON.stringify({eventStart:this.callStartTime,events:this.rosterUpdates});this.telemetryData[u8.ROSTER_UPDATES_BAG]=e}let t=[];for(let e of Object.keys(this.networkRequestsStarted))t.push(this.networkRequestsStarted[e]);t.length>0&&(this.telemetryData[u8.NETWORK_REQUESTS_PENDING]=JSON.stringify(t)),this.telemetryData[u8.IS_REINVITELESS]=this.isReinviteless,this.telemetryLogger.logConversationCallModalityEvent(this.telemetryData)}getResultCategoryString(e){return e&&Array.isArray(e)?e.join(","):""}},pg=class{constructor(e,t){this.disposed=!1,this.lastSeenSeqNumbers={},this.isDominantSpeakerInfoLinkEnabled=!0,this.clientUrlsGenerated=!1,this.getClientUrls=()=>{this.clientUrlsGenerated=!0;let e=null;return this.isWebRtcCall&&(e={controlVideoStreaming:so(this.signalingSession,rG.CONTROL_VIDEO_STREAMING),csrcInfo:so(this.signalingSession,rG.CSRC_INFO)},this.isDominantSpeakerInfoLinkEnabled&&(e.dominantSpeakerInfo=so(this.signalingSession,rG.DOMINANT_SPEAKER_INFO))),e},this.handleDominantSpeakerInfo=e=>{let t=e.body;this.logger.debug("handleDominantSpeakerInfo : ",t_(t)),this.signalingSession.telemetryHelper.recordIncomingEventCount(cx),this.handleWebRtcNotification(sr.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO,t.dominantSpeakerInformation)},this.handleControlVideoStreaming=e=>{let t=e.body;this.logger.debug("handleControlVideoStreaming: ",t_(t)),this.signalingSession.telemetryHelper.recordIncomingEvent(cN,e),this.handleWebRtcNotification(sr.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING,t.controlVideoStreaming,!1)},this.handleCsrcInfo=e=>{let t=e.body;this.logger.debug("handleCsrcInfo : ",t_(t)),this.signalingSession.telemetryHelper.recordIncomingEvent(cL,e),this.handleWebRtcNotification(sr.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO,t.csrcInfo)},this.sendWebRtcMediaNotificationAsync=({operation:e,requestUrl:t,requestBody:i,stackRetry:n=!0},r)=>{this.logger.info("sendWebRtcMediaNotificationAsync"),sv(this.isWebRtcCall,"this is not a webrtc call"),sS(t,"correct media notification requestUrl is not provided"),sS(i,"media notification requestBody cannot be null or empty");let s=sV(),a={url:t,payload:{payload:i},requestName:e,withoutTrouter:!0,causeId:r};return n||(a.disableRetry=!0),this.signalingSession.http.sendPostRequest(a).then(()=>{this.disposed||s.resolve()}).catch(e=>{let t=t_(e);if(this.logger.error(`sendWebRtcMediaNotificationAsync failed because : ${t}`),!this.disposed){let t=Error(e);t.endCode=sr.CALL_END_NETWORK_ERROR,s.reject(t)}}),s.promise},this.dispose=()=>{this.logger.info("WebRtcSignalingManager :: dispose"),this.disposed=!0},this.signalingSession=e,this.signalingSessionCallback=t,this.isWebRtcCall=e.signalingAgentConfig.isWebRtcEnabled,this.logger=e.logger,this.lastSeenSeqNumbers[sr.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING]=-1,this.lastSeenSeqNumbers[sr.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO]=-1,this.lastSeenSeqNumbers[sr.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO]=-1}areClientURLsGenerated(){return this.clientUrlsGenerated}getIsDominantSpeakerInfoLinkEnabled(){return this.isDominantSpeakerInfoLinkEnabled}setIsDominantSpeakerInfoLinkEnabled(e){this.isDominantSpeakerInfoLinkEnabled=e}handleWebRtcNotification(e,t,i=!0){sv(this.isWebRtcCall,"ignoring message in non-webrtc call");let n=this.lastSeenSeqNumbers[e];if(i&&t.sequenceNumber<=n)return void this.logger.info(`ignoring ${e} . Last seen seq = ${n} current seq = ${t.sequenceNumber}`);t.sequenceNumber<=n&&this.logger.info(`let listener to handle older ${e} . Last seen seq = ${n} current seq = ${t.sequenceNumber}`),this.lastSeenSeqNumbers[e]=Math.max(t.sequenceNumber,this.lastSeenSeqNumbers[e]),this.signalingSessionCallback.onWebRtcMediaNotification(e,t)}},pp=class{constructor(e,t,i,n,r,s){this.disposed=!1,this.convSubject=null,this.groupId=null,this.threadId=null,this.incomingCallCallerId=null,this.incomingCallPayload=null,this.multiParty=!0,this.isIncomingCall=!1,this.isHostLessCall=!1,this.isCastCall=!1,this.isHuddleGroupCall=!1,this.numberOfOriginalInvitees=0,this.teamsMessageId=null,this.enableGroupCallMeetupGeneration=!1,this.meetingInfo=null,this.meetingDetails=null,this.emergencyContent=null,this.transferContext=null,this.callType="default",this.callMode=0,this.transferor=null,this.onBehalfOf=null,this.onBehalfOfUserDisplayName=null,this.callQueueContext=null,this.callQueueSupervisorContent=null,this.bannerContent=null,this.callPhoneLineType=null,this.endpointMetadata={},this.sessionId=sm(),this.remoteCaller=null,this.acceptedElsewhereBy=null,this.parkAdditionalContextJson=null,this.serverHoldLocation=null,this.breakoutDetails=null,this.callLimits=null,this.complianceRecordingContent=null,this.backroomThreadId=null,this.streamThreadId=null,this.lobbyThreadId=null,this.conversationStartTime=null,this.meetingLayoutDetails=null,this.compositionServiceDetails=null,this.realTimeState=0,this.disposing=!1,this.links={},this.provisionalMediaAnswersSeenSoFar=[],this.incomingTrouterMessagesSeenSoFar=[],this.incomingBrokerMessagesSeenSoFar=[],this.currentCallStatus=null,this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.convJoined=!1,this.keepAliveTimer=null,this.keepAliveInterval=null,this.keepAliveCount=1,this.conversationKeepAliveTimer=null,this.conversationKeepAliveInterval=null,this.conversationKeepAliveCount=1,this.remoteUser=null,this.mediaTypesToUse=null,this.lastUsedOutgoingMediaContent=null,this.lastUsedJoinCallOptions=null,this.originalRoleBeforePreheat="unknown",this.skipOfferGenerationForStreamingUser=!1,this.endpointStateSequenceNumber=0,this.publishStateSequenceNumber=0,this.monitorSequenceId=0,this.requestedPublishedStatesWhileConnecting=null,this.linkUpdateRequested={conversationLinks:!1,keepAliveLinks:!1},this.incomingMessageSyncResponseCache={},this.isPreheatOnly=!1,this.callStartTime=new Date().getTime(),this.callUsesMixer=!1,this.disablePreheatDefer=sV(),this.participantReplacementDetails={},this.meetingLiveStateSequenceNumber=0,this.meetingLayoutSequenceNumber=0,this.localParticipantUpdateSequenceNumber=0,this.isRedirectAllowed=!1,this.updateSequenceNumber=-1,this.isPromotingToRealtime=!1,this.streamInformationReceived=!1,this.startOrJoinConvResponseReceived=!1,this.updateParticipantsPromises={},this.updateEndpointState=(e,t=sp(),i,n)=>{this.logger.info(`[${t}][requestedEndpointState=${t_(e,!0)}][captchaContentJson=${n}]`);let r=this.links[sr.LINKS.UPDATE_ENDPOINT_STATE],s=this.getEndpointState();this.logger.info(`[${t}][currentEndpointState=${t_(s,!0)}] startOrJoinConvResponseReceived=${this.startOrJoinConvResponseReceived}`);let a={...s,...e,endpointStateSequenceNumber:++this.endpointStateSequenceNumber};this.telemetryHelper.recordEvent(cY,{newEndpointState:a,causeId:t});let o=a?.endpointProperties?.preheatProperties===0&&this.isPreheatOnly;o&&(this.telemetryHelper.recordEvent(dw,{causeId:t}),this.telemetryHelper.startPreheatedCallSetupDurationWatch(),this.telemetryHelper.startCallCancelationDurationWatch());let l=this.lastUsedJoinCallOptions?.clientEndpointCapabilities,c=l&&(4194304&l)==4194304;if(!(this.signalingAgentConfig.enablePreheatInStreamingMode&&c)&&2===this.callMode&&o)return this.logger.info(`[${t}][updateEndpointState skipped as mode is streaming]`),this.handleEndpointStateUpdated(t,!0),Promise.resolve();if(!this.startOrJoinConvResponseReceived)return(this.logger.info(`[${t}][updateEndpointState will be queued as we don't have a link yet]`),this.requestedEndpointStateWhileConnecting=e,this.requestedPublishedStatesWhileConnecting=i,o)?this.disablePreheatDefer.promise:Promise.resolve();if(!this.shouldUpdateEndpointState(s,a)&&!this.http.hasPendingRequest(u3.UPDATE_ENDPOINT_STATE.name))return this.logger.info(`[${t}][updateEndpointState will ignore current update as there is nothing new to send]`),Promise.resolve();if(!r)return this.logger.info(`[${t}][updateEndpointState operation cannot be performed now, the link is not yet available]`),Promise.reject("No link");this.latestEndpointState=a;let d=this.signalingAgentConfig.enableAsyncDisablePreheat&&o;d&&this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.DISABLE_PREHEAT_ASYNC_TIMEOUT,()=>{let e={code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.DISABLE_PREHEAT_TIMEOUT,phrase:sr.CALL_END_PHRASE.DISABLE_PREHEAT_TIMEOUT};this.disablePreheatDefer.isPending()&&this.disablePreheatDefer.reject({response:e})},this.getTimeoutValue("disablePreheatTimeoutSec"));let u=this.http.sendPostRequest({url:r,requestName:u3.UPDATE_ENDPOINT_STATE.name,payload:g8(this,a,i,d,n),causeId:t}).then(()=>(d&&(this.logger.info(`[${t}][updateEndpointState] asyncDisablePreheat: true`),this.telemetryHelper.recordEvent(uj,{causeId:t})),Promise.resolve())).catch(e=>{if(d)this.disablePreheatDefer.reject(e);else throw e});return(d?this.disablePreheatDefer.promise:u).then(()=>{this.logger.info(`[${t}][updateEndpointState] asyncDisablePreheat: ${d}`),this.telemetryHelper.recordEvent(d?uV:u$,{causeId:t}),this.disposed||this.handleEndpointStateUpdated(t,o)}).catch(e=>{let i=sM(e,this.signalingAgentConfig);return this.logger.info(`[${t}][updateEndpointState] error: ${t_(i)}`),o&&(this.handleDisablePreheatError(i.error,d?uH:uB,t),this.stopCallPreheatTimer(),this.terminateEstablishedCall({code:i.error.code,subCode:i.error.subCode,phrase:i.error.phrase},{forEveryone:!1,causeId:t})),Promise.reject(i.error)})},this.setParticipantCallLinks=e=>{e&&e.endpointDetails&&(this.participantReplacementDetails[e.id]={},e.endpointDetails.forEach(t=>{t&&t.callLinks&&(this.participantReplacementDetails[e.id][t.participantId]=t.callLinks)}))},this.clearParticipantCallLinks=e=>{this.participantReplacementDetails?.hasOwnProperty(e)&&delete this.participantReplacementDetails[e]},this.getReplacementDetailsByParticipantLeg=(e,t,i=sp())=>(this.logger.info(`[${i}]getReplacementDetailsByParticipantLeg: participantMri ${this.piiUtils.scrubMriOrOmit(e)} participantLegId ${t}`),this.participantReplacementDetails?.hasOwnProperty(e)&&this.participantReplacementDetails[e].hasOwnProperty(t))?{replaces:this.participantReplacementDetails[e][t].replacement,replacementTargetParticipantId:t}:(this.logger.info(`[${i}]getReplacementDetailsByParticipantLeg: unable to find replacement details for participantLegId ${t}`),{}),this.getReplacementDetailsByParticipantLegOfCall=(e,t,i,n=sp())=>{this.logger.info(`[${n}]getReplacementDetailsByParticipantLegOfCall: callId ${e} participantMri ${this.piiUtils.scrubMriOrOmit(t)} participantLegId ${i}`);let r=this.signalingAgent.getSignalingSession(e);return r?r.getReplacementDetailsByParticipantLeg(t,i,n):{}},this.getMriByParticipantLegOfCall=(e,t,i)=>{this.logger.info(`[${i}]getMriByParticipantLegOfCall: callId: ${e} participantLegId ${t}`);let n=this.signalingAgent.getSignalingSession(e);return n?n.getMriByParticipantLeg(t,i):""},this.getMriByParticipantLeg=(e,t)=>{for(let i of(this.logger.info(`getMriByParticipantLeg[${t}] participantLegId ${e}`),Object.keys(this.participantReplacementDetails)))if(i&&this.participantReplacementDetails.hasOwnProperty(i)&&this.participantReplacementDetails[i]?.hasOwnProperty(e))return i;return""},this.handleEndpointStateUpdated=(e,t)=>{this.requestedEndpointStateWhileConnecting=null,this.requestedPublishedStatesWhileConnecting=null,t&&this.handlePreheatDisabled(e)},this.handlePreheatDisabled=e=>{this.isPreheatOnly=!1,this.telemetryHelper.setSelfParticipantRole(this.originalRoleBeforePreheat),this.telemetryHelper.recordEvent(dP,{causeId:e}),this.telemetryHelper.resetCallCancelationDurationWatch(),this.telemetryHelper.stopPreheatedCallSetupDurationWatch(),this.telemetryHelper.startCallConnectedWatch(),this.stopCallPreheatTimer(),this.disablePreheatDefer.isPending()&&this.disablePreheatDefer.resolve()},this.shouldUpdateEndpointState=(e,t)=>{if(!t)return!1;let i=t.state&&t.state.isMuted?1:0,n=t.endpointProperties&&1===t.endpointProperties.preheatProperties?1:0,r=e&&e.state&&e.state.isMuted?1:0,s=e&&e.endpointProperties&&1===e.endpointProperties.preheatProperties?1:0,a=e?.endpointProperties?.additionalEndpointProperties,o=t?.endpointProperties?.additionalEndpointProperties!==a;return!!(i^r||n^s||o)},this.setInitialTelemetry=(e,t)=>{let{causeId:i}=t;switch(e){case"Subscribe":case"SubscribeWithMeetingData":this.telemetryHelper.recordEvent(lY,{causeId:i,correlationId:t.correlationId}),this.telemetryHelper.setDirection(hr.OUTGOING),this.telemetryHelper.setSelfParticipantRole(hs.JOIN_FOR_ROSTER_ONLY),this.telemetryHelper.setConversationServiceUrl(t.conversationServiceUrl||this.signalingAgentConfig.conversationServiceUrl),this.telemetryHelper.setCallerType(this.participantManager.localParticipant.id);break;case"Acknowledge":this.telemetryHelper.recordEvent(lZ,{causeId:i}),this.telemetryHelper.setDirection(hr.INCOMING),this.telemetryHelper.setSelfParticipantRole(hs.CALLEE),this.telemetryHelper.setCalleeType(this.participantManager.localParticipant.id);break;case"JoinCall":case"JoinWithMeetingData":this.setInitialJoinOrStartTelemetry(lK,t,"join");break;case"StartCall":case"StartCallToVoiceMail":case"StartCallWithNudge":case"StartCallAndUnpark":case"StartWithMeetingData":this.telemetryHelper.startCallInitializationWatch(t.offerGenerationTime),this.setInitialJoinOrStartTelemetry(lJ,t,"caller")}},this.setInitialJoinOrStartTelemetry=(e,t,i)=>{let{callOptions:n,causeId:r}=t,s=this.gatherTelemetryForStartOrJoin(n,r,t.offerGenerationTime);this.telemetryHelper.recordEvent(e,s),this.telemetryHelper.setDirection(hr.OUTGOING),n.isPreheatOnly?(this.originalRoleBeforePreheat=i,this.telemetryHelper.recordEvent(dI,{causeId:r}),this.telemetryHelper.setSelfParticipantRole(hs.PREHEAT),this.telemetryHelper.setIsPreheated()):this.telemetryHelper.setSelfParticipantRole(i)},this.getParticipantIdForOfferAnswer=e=>{sy(e,"mediaContent should be a non null value"),this.logger.info("getParticipantIdForOfferAnswer");let t=null;return!this.remoteUser||this.groupId||this.threadId||e.newOffer||e.escalationOccurring||(t=this.remoteUser.id),t},this.getMeetingInfo=()=>this.meetingInfo,this.getEmergencyContent=()=>(this.telemetryHelper.recordEvent(lH),this.emergencyContent),this.getEndpointId=()=>this.signalingAgent.endpointId,this.getConversationUrl=()=>this.links[sr.LINKS.CONVERSATION_CONTROLLER],this.getOriginalRoleBeforePreheat=()=>this.originalRoleBeforePreheat,this.setJoinedFrom=e=>{!this.disposed&&e&&(this.telemetryHelper.recordEvent(lV),this.telemetryHelper.setJoinedFrom(e))},this.setMeetingCode=e=>{!this.disposed&&e&&this.telemetryHelper.setMeetingCode(e)},this.setMeetingUrl=e=>{!this.disposed&&e&&this.telemetryHelper.setMeetingUrl(e)},this.setSubject=e=>{this.disposed||(this.telemetryHelper.recordEvent(l$),sy(e,"subject should be a non null value"),this.convSubject=e)},this.setDeviceType=e=>{!this.disposed&&(this.telemetryHelper.recordEvent(lB),e&&(this.deviceType=e,this.logger.info("setDeviceType",this.deviceType)))},this.setOfferAnswerGenerationTimestamps=e=>{this.disposed||this.telemetryHelper.setOfferAnswerGenerationTimestamps(e)},this.setTimeToRingDuration=()=>{this.disposed||this.telemetryHelper.setTimeToRingDuration()},this.setGroupId=e=>{this.telemetryHelper.recordEvent(lq),this.groupId!==e&&e&&(sv(!this.groupId,"conversation groupId has already been set. It cannot be overwritten"),this.groupId=e)},this.setThreadId=e=>{this.telemetryHelper.recordEvent(lW),sy(e,"threadId should be a non null value"),this.threadId!==e&&(sv(!this.threadId,"conversation threadId has already been set. It cannot be overwritten"),this.threadId=e)},this.setDisplayName=e=>{!this.disposed&&e&&this.telemetryHelper.setDisplayName(e)},this.setCallOptions=e=>{if(sy(e,"callOptions should be a non null value"),this.logger.info("setCallOptions",t_(e)),this.telemetryHelper.recordEvent(lG),e){this.teamsMessageId=e.teamsMessageId,this.meetingInfo=e.meetingInfo||null,this.emergencyContent=e.emergencyContent||null,this.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration||!1,e.broadcastContext&&(this.broadcastSession=new hN(this,this.signalingSessionCallback),this.broadcastSession.setContext(e.broadcastContext));try{this.endpointMetadata=JSON.parse(e.endpointMetadata)}catch(e){this.logger.warn("Unable to parse endpoint metadata")}}},this.setTransferContext=e=>{sy(e,"transferContext should not be null"),this.logger.info("Transfer: setTransferContext",tl(e)),this.telemetryHelper.recordEvent(lz),this.transferContext=e},this.getTimeoutValue=e=>this.timeoutManager.getTimeoutValue(e)??this.signalingAgentConfig.csaTimeoutConfiguration[e],this.muteAsync=(e,t,i=sp())=>(sv(2!==this.callMode||e!==sr.MUTE_SCOPE.MYSELF,"mute self operation is not allowed in streaming mode"),this.logger.info(`[${i}][muteAsync][scope=${e}]`),this.telemetryHelper.recordEvent(cP,{causeId:i}),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,`[${i}]mute operation for all or specified only allowed in a connected call`),this.participantManager.muteAsync(this.links[sr.LINKS.MUTE],e,t,i)),this.unmuteAsync=(e=sp())=>(sv(2!==this.callMode,"unmute operation is not allowed in streaming mode"),this.logger.info(`[${e}][unmuteAsync]`),this.telemetryHelper.recordEvent(cA,{causeId:e}),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"unmute operation only allowed in a connected call"),this.participantManager.unmuteAsync(this.links[sr.LINKS.UNMUTE],e)),this.recordTelemetryForStartAudio=(e,t)=>(this.telemetryHelper.recordEvent(dT,{mediaNegotiationStatus:e,causeId:t}),Promise.resolve(null)),this.recordTelemetryForStopAudio=(e,t)=>(this.telemetryHelper.recordEvent(dE,{mediaNegotiationStatus:e,causeId:t}),Promise.resolve(null)),this.rejectUnmuteRequestAsync=(e,t=sp(),i)=>(sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"rejectUnmute operation only allowed in a connected call"),sS(e,"requestor must be specified"),this.logger.info(`[${t}][rejectUnmuteRequestAsync][rejectionReason=${i}]`),this.telemetryHelper.recordEvent(ck,{causeId:t,rejectionReason:i}),this.participantManager.rejectUnmuteRequestAsync(e,t,i)),this.approveUnmuteRequestAsync=(e,t=sp())=>(sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"approveUnmute operation only allowed in a connected call"),sS(e,"requestor must be specified"),this.logger.info(`[${t}][approveUnmuteRequestAsync]`),this.telemetryHelper.recordEvent(cO,{causeId:t}),this.participantManager.approveUnmuteRequestAsync(e,t)),this.sendWebRtcMediaNotificationAsync=(e,t,i=sp())=>(sv(2!==this.callMode,"sendWebRtcMediaNotification operation is not allowed in streaming mode"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"webRtc media notification can only be sent in a connected call"),this.telemetryHelper.recordEvent(cF,{causeId:i}),0===e)?this.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:u3.SEND_APPLY_CHANNEL_PARAMETERS.name,requestUrl:this.links[sr.LINKS.APPLY_CHANNEL_PARAMETERS],requestBody:t,stackRetry:!1},i):this.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:u3.SEND_CONTROL_VIDEO_STREAMING.name,requestUrl:this.links[sr.LINKS.CONTROL_VIDEO_STREAMING],requestBody:t},i),this.addParticipantsAsync=(e,t,i=sp())=>{sS(e,"remoteParticipants should be a non null value"),sv(this.isCallOngoing()||this.isCallNotConnected(),"remoteParticipants can only be added before starting an outgoing call or to an ongoing call"),this.logger.info(`[${i}][addParticipantsAsync][addParticipantOptions=${t_(t)}]
            [remoteParticipantId=${e.map(e=>this.piiUtils.scrubMriOrOmit(e.id))}]`);let n=lu;switch(t.replacementType){case 2:n=dB;break;case 1:case 3:n=lg;break;default:n=lu}this.telemetryHelper.recordEvent(n,{causeId:i}),t.groupId=this.groupId||t.groupId,t.threadId=this.threadId||t.threadId;let r=t.threadId||t.groupId?this.links[sr.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:this.links[sr.LINKS.ADD_PARTICIPANT],s=this.participantManager.addParticipantsAsync(e,r,this.isCallConnectedOrConnectedForRoster(),t,i);return this.currentCallStatus||this.setMultiParty(1!==this.participantManager.getParticipantsToInitiateCallWith().length,i),s},this.addGroupModalityAsync=(e,t)=>{sv(this.isCallOngoing(),"GroupModality can only be added before starting an outgoing call or to an ongoing call"),this.logger.info(`[${t}][addGroupModalityAsync][addGroupModalityOptions=${t_(e)}]`);let i=lf;this.telemetryHelper.recordEvent(i,{causeId:t});let n=gd(this,null,e);return this.http.sendPostRequest({url:this.links[sr.LINKS.ADD_PARTICIPANTS_AND_MODALITY],payload:n,requestName:u3.ADD_PARTICIPANTS_AND_MODALITY.name,causeId:t}).then(()=>{hy.noop()}).catch(e=>{let i=sM(e,this.signalingAgentConfig);throw this.logger.info(`[${t}][sendNetworkRequestForAddingParticipant] failed:${t_(i)}`),i.error})},this.addModalityAsync=(e,t)=>{sv(this.isCallOngoing(),"GroupModality can only be added before starting an outgoing call or to an ongoing call"),this.logger.info(`[${t}][addModalityAsync][modalityContext=${t_(e)}]`),this.telemetryHelper.recordEvent(cE,{causeId:t});let i=gO(this,e);return this.http.sendPostRequest({url:this.links[sr.LINKS.ADD_MODALITY],payload:i,requestName:u3.ADD_MODALITY.name,causeId:t}).then(e=>(this.logger.info(`[${t}][addModalityAsync] response: ${t_(e)}`),this.telemetryHelper.recordEvent(cw,{causeId:t}),sr.SUCCESS_TRANSACTION_END)).catch(e=>{let i=sM(e);return this.logger.info(`[${t}][sendNetworkRequestForAddModalityAsync] failed:${t_(i)}`),Promise.reject(i.error)})},this.addBroadcastModalityAsync=(e,t)=>{if(sv(this.isCallOngoing(),"BroadcastModality can only be added before starting an outgoing call or to an ongoing call"),this.logger.info(`[${t}][addBroadcastModalityAsync][addBroadcastContext=${t_(this.addBroadcastModalityAsync)}]`),this.telemetryHelper.recordEvent(cT,{causeId:t}),this.broadcastSession){let e="There is already a broadcast session";return this.logger.info(e),Promise.resolve(sr.SUCCESS_TRANSACTION_END)}this.broadcastSession=new hN(this,this.signalingSessionCallback),this.broadcastSession.setContext(e);let i=gD(this,e);return this.http.sendPostRequest({url:this.links[sr.LINKS.ADD_MODALITY],payload:i,requestName:u3.ADD_BROADCAST_MODALITY.name,causeId:t}).then(e=>(this.logger.info(`[${t}][addBroadcastModalityAsync] response: ${t_(e)}`),this.telemetryHelper.recordEvent(cI,{causeId:t}),sr.SUCCESS_TRANSACTION_END)).catch(e=>{let i=sM(e);return this.logger.info(`[${t}][sendNetworkRequestForAddBroadcastModalityAsync] failed:${t_(i)}`),this.endBroadcastMeeting(t),Promise.reject(i.error)})},this.nudgeParticipantsAsync=e=>{if(sy(e.participantsIds,"ParticipantsIds should be a non null value"),sv(this.isCallOngoing(),"Participants can only be nudged before starting an outgoing call or to an ongoing call"),this.logger.info(`[${e.causeId}][nudgeParticipantsAsync][participantsIds=${this.piiUtils.scrubParticipantsList(e.participantsIds)}][invitationData=${e.invitationData}]`),void 0===e.participantsIds||e.participantsIds.length<1)return Promise.reject("List of participants to nudge is empty");this.telemetryHelper.recordEvent(lu,{withNudge:sr.INVITATION_TYPE.NUDGE,causeId:e.causeId});let t=this.groupId||e.newGroupId,i=this.threadId||e.newThreadId,n=this.teamsMessageId||e.newMessageId,r=i||t?this.links[sr.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:this.links[sr.LINKS.ADD_PARTICIPANT];return this.participantManager.nudgeParticipantsAsync(e.participantsIds,r,this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING||this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,e.causeId,e.invitationData,t,i,n)},this.callMeBackAsync=(e,t=sp())=>(sy(e,"remoteParticipant should be a non null value"),this.logger.info(`[${t}][callMeBackAsync][remoteParticipantId=${this.piiUtils.scrubMriOrOmit(e.id)}]`),this.telemetryHelper.recordEvent(lT,{causeId:t}),this.hasGroupModality()||sv(!1,"threadId/groupId must be set before using call me back"),this.participantManager.callMeBackAsync(e,this.links[sr.LINKS.ADD_PARTICIPANTS_AND_MODALITY],t)),this.removeParticipantAsync=(e,t=sp(),i="none")=>{switch(sy(e,"remoteParticipant should be a non null value"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"participants can only be removed from an ongoing call"),this.logger.info(`[${t}][removeParticipantAsync][remoteParticipantId=${this.piiUtils.scrubMriOrOmit(e.id)}] [removeEndpointScope] ${i}`),i){case"all":this.telemetryHelper.recordEvent(lI,{causeId:t});break;case"specified":this.telemetryHelper.recordEvent(lw,{causeId:t});break;default:this.telemetryHelper.recordEvent(l_,{causeId:t})}return"none"!==i&&e.endpointId?this.participantManager.removeParticipantEndpointAsync(e,this.links[sr.LINKS.REMOVE_PARTICIPANT],i,t):this.participantManager.removeParticipantAsync(e,this.links[sr.LINKS.REMOVE_PARTICIPANT],t)},this.admitParticipantAsync=(e,t=sp())=>(sy(e,"remoteParticipant should be a non null value"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"remoteParticipants can only be admitted to an ongoing call"),this.hasGroupModality()||sv(!1,"threadId/groupId must be set before admitting more participants to connected call"),this.logger.info(`[${t}][admitParticipantAsync][remoteParticipantId=${this.piiUtils.scrubMriOrOmit(e.id)}]`),this.telemetryHelper.recordEvent(lm,{causeId:t}),this.participantManager.admitParticipantAsync(e,this.links[sr.LINKS.ADMIT],t)),this.admitAsync=e=>{if(this.logger.info(`[${e}][admitAsync]`),this.telemetryHelper.recordEvent(lS,{causeId:e}),!this.links[sr.LINKS.ADMIT_ALL]){let t={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.ADMIT_ALL_LINK_MISSING,phrase:sr.CALL_END_PHRASE.ADMIT_ALL_URL_MISSING};return this.telemetryHelper.recordEvent(lC,{causeId:e,transactionEnd:t}),this.logger.warn(`admitAsync error ${t_(t)}`),Promise.reject(t)}let t=sV();return this.callOperationHandler.setPendingOperation(0,e,{promise:t,causeId:e},e),this.sendNetworkRequestForAdmit(e),t.promise},this.updateMeetingRolesAsync=(e,t,i=sp())=>(sy(e,"participants array should be a non null value"),sy(t,"meetingRole should be a non null value"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"remote participant roles can only be updated in an ongoing call"),this.logger.info(`[${i}][updateMeetingRolesAsync][participants=${this.piiUtils.scrubMriOrOmit(e)}]`),this.participantManager.updateMeetingRolesAsync(e,t,this.links[sr.LINKS.UPDATE_PARTICIPANT_ROLE],i)),this.startContentSharingAsync=(e,t,i,n,r=sp())=>(sy(e,"contentIdentifier should be a non null value"),sv(this.isCallOngoing(),"contentSharing can only be added before starting an outgoing call or to an ongoing call"),this.logger.info(`[${r}][startContentSharingAsync]`),this.telemetryHelper.recordEvent(cc,{causeId:r}),this.contentSharingManager.startContentSharingAsync(e,t,i,this.links[sr.LINKS.ADD_MODALITY],this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,r,n)),this.deleteContentSharingAsync=(e,t=sp())=>(this.logger.info(`[${t}][deleteContentSharingAsync][correlationId=${e}]`),this.telemetryHelper.recordEvent(cu,{causeId:t,correlationId:e}),this.contentSharingManager.deleteContentSharingAsync(e,t)),this.joinContentSharingAsync=(e,t=sp())=>(this.logger.info(`[${t}][joinContentSharingAsync][correlationId=${e}]`),this.telemetryHelper.recordEvent(cp,{causeId:t,correlationId:e}),this.contentSharingManager.joinContentSharingAsync(e,t)),this.updateContentSharingSessionStateAsync=(e,t,i=sp())=>(sy(t,"sessionState should be a non null value"),this.telemetryHelper.recordEvent(cg,{causeId:i,correlationId:e}),this.logger.info(`[${i}][updateContentSharingSessionStateAsync][correlationId=${e}][sessionState=${t}]`),this.contentSharingManager.updateContentSharingSessionStateAsync(e,t,i)),this.takeContentSharingControlAsync=(e,t=sp())=>(this.telemetryHelper.recordEvent(ch,{causeId:t,correlationId:e}),this.logger.info(`[${t}][takeContentSharingControlAsync][correlationId=${e}]`),this.contentSharingManager.takeContentSharingControlAsync(e,t)),this.updateContentSharingParticipantStateAsync=(e,t=sp())=>(this.telemetryHelper.recordEvent(cf,{causeId:t}),this.logger.info(`[${t}][updateContentSharingParticipantStateAsync][correlationId=${e}]`),this.contentSharingManager.updateContentSharingParticipantStateAsync(e,t)),this.configureEndpointStateForStartOrJoin=e=>{let t={endpointStateSequenceNumber:this.endpointStateSequenceNumber},i=!1;if(e&&(e.muted&&(i=!0,Object.assign(t,{state:{isMuted:e.muted}})),e.isPreheatOnly||e.additionalEndpointProperties)){let n={};i=!0,e.isPreheatOnly&&(n.preheatProperties=1),e.additionalEndpointProperties&&(n.additionalEndpointProperties=e.additionalEndpointProperties),Object.assign(t,{endpointProperties:n})}if(i)return t},this.gatherTelemetryForStartOrJoin=(e,t,i)=>{let n={causeId:t};return e&&(e.invitationType===sr.INVITATION_TYPE.NUDGE&&(n.withNudge=e.invitationType===sr.INVITATION_TYPE.NUDGE),e.parkContext&&(n.unpark=!0,n.context=e.parkContext),e.isPreheatOnly&&(n.isPreheatOnly=!0),e.targetApplicationType&&(n.targetApplicationType=e.targetApplicationType,this.telemetryHelper.setTargetApplicationType(e.targetApplicationType))),n},this.startOutgoingCall=(e,t,i,n,r=sp())=>{let s=`[${r}][startOutgoingCall]`;if(sy(e,"mediaContent should be a non null value"),sy(e.blob,"outgoingSdp should be a non null value"),sv(this.isCallNotConnected(),"a call is already in progress"),this.logger.info(`${s}[start] applicationType=${this.participantManager.localParticipant.applicationType}`),this.disposed)return void this.logger.warn(`${s}[failed][reason=Session disposed]`);this.lastUsedJoinCallOptions={muted:i?i.muted:null,scenario:i?i.scenario:null,isPreheatOnly:i?i.isPreheatOnly:null,clientEndpointCapabilities:i?i.clientEndpointCapabilities:null,clientEndpointDebugContent:i?i.clientEndpointDebugContent:null},i&&i.scenario&&this.telemetryHelper.setScenario(i.scenario),this.logger.info(`${s}options=${t_(this.gatherTelemetryForStartOrJoin(i,r,n))}`),this.isBrokerEnabledForOutgoingCall()&&this.setupBrokerChannel(),this.callUsesMixer=!!(i&&i.callUsesMixer),this.fsmState=sr.SIGNALING_FSM_STATE.OUTGOING,this.meetingData=i?.meetingData,this.meetingPreferences=i?.meetingPreferences;let a={newCall:!0,suppressDialout:!!i&&(i.suppressDialout||!1),conversationServiceUrl:this.signalingAgentConfig.conversationServiceUrl,onBehalfOf:i?i.onBehalfOf:null,onBehalfOfUserDisplayName:i?i.onBehalfOfUserDisplayName:null,callQueueContext:i?i.callQueueContext:null,callToVoicemail:!!i&&i.callToVoicemail,voicemailResourcePath:i?i.voicemailResourcePath:null,voicemailItemId:i?i.voicemailItemId:null,endpointState:this.configureEndpointStateForStartOrJoin(i),invitationType:i&&i.invitationType?i.invitationType:null,participantsToNudge:i&&Array.isArray(i.participantsToNudge)?i.participantsToNudge:null,routingFlags:i?i.routingFlags:null,parkContext:i?i.parkContext:null,pickupCode:i?i.pickupCode:null,scenario:i?i.scenario:null,isPreheatOnly:!!i&&i.isPreheatOnly,applicationType:this.participantManager.localParticipant.applicationType,clientEndpointCapabilities:i?i.clientEndpointCapabilities:0,clientEndpointDebugContent:i?i.clientEndpointDebugContent:null,invitationData:i?i.invitationData:null,conversationType:i?this.getConversationType(i.isEmergency,i.castCall,i.isHuddleGroupCall):null,meetingData:this.meetingData,meetingPreferences:this.meetingPreferences,alternateId:i?i.alternateId:null,meetingRegistrationId:i?i.meetingRegistrationId:null,participantPin:i?i.participantPin:null,publishedStates:i?i.publishedStates:null,targetApplicationType:i?i.targetApplicationType:null,captchaContentJson:i?i.captchaContentJson:null,customHeaderContext:i?i.customHeaderContext:null,participationPreferences:i?i.participationPreferences:null,participantPropertyBag:i?i.participantPropertyBag:null};this.isCastCall=i&&i.castCall,this.isHuddleGroupCall=i&&i.isHuddleGroupCall,this.onBehalfOf=a.onBehalfOf,this.onBehalfOfUserDisplayName=a.onBehalfOfUserDisplayName,this.callQueueContext=a.callQueueContext,this.startOrJoinCall(a,u3.START_CALL.name,r,e,t)},this.joinGivenConversation=(e,t,i,n,r,s={},a=sp(),o=!1)=>{let l=`[${a}][joinGivenConversation]`;if(sy(t,"correlationId should be a non null value"),sS(e||this.getConversationUrl(),"conversationUrl should be a non null value"),o||(sy(i,"mediaContent should be a non null value"),sy(i.blob,"outgoingSdp should be a non null value")),this.isPromotingToRealtime=2===this.callMode,sv(this.isCallNotConnected()||this.isPromotingToRealtime,"a call is already in progress"),this.logger.info(`${l}[start][correlationId=${t}] applicationType=${this.participantManager.localParticipant.applicationType}`),this.disposed)return void this.logger.warn(`${l}[failed][reason=Session disposed]`);let c=this.gatherTelemetryForStartOrJoin(s,a,r);this.lastUsedJoinCallOptions=s,this.skipOfferGenerationForStreamingUser=o,this.telemetryHelper.startCallInitializationWatch(r),s&&s.scenario&&this.telemetryHelper.setScenario(s.scenario),this.logger.info(`${l}options=${t_(c)}`),this.isBrokerEnabledForIncomingCall()&&this.setupBrokerChannel(),this.fsmState=sr.SIGNALING_FSM_STATE.OUTGOING,this.updateCorrelationId(t,a),this.meetingData=s?.meetingData,this.meetingPreferences=s?.meetingPreferences;let d={newCall:!1,suppressDialout:!0,conversationServiceUrl:e,endpointState:this.configureEndpointStateForStartOrJoin(s),scenario:s?s.scenario:null,isPreheatOnly:!!s&&s.isPreheatOnly,applicationType:this.participantManager.localParticipant.applicationType,clientEndpointCapabilities:s?s.clientEndpointCapabilities:0,clientEndpointDebugContent:s?s.clientEndpointDebugContent:null,conversationType:s?this.getConversationType(s.isEmergency,!1):null,meetingPreferences:this.meetingPreferences,meetingData:this.meetingData,meetingRegistrationId:s?.meetingRegistrationId,participantPin:s?.participantPin,sharedLineCallInvitationContent:s?.sharedLineCallInvitationContent,applyServerMute:s?.applyServerMute,publishedStates:s?.publishedStates,invitationData:s?.invitationData,captchaContentJson:s?.captchaContentJson,callQueueContext:s?.callQueueContext,participationPreferences:s?.participationPreferences,participantPropertyBag:s?.participantPropertyBag};this.isCastCall=!1,this.startOrJoinCall(d,u3.JOIN_CONVERSATION.name,a,i,n,o)},this.subscribeToCall=(e,t,i=0,n,r=sp())=>{sy(t,"correlationId should be a non null value"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.IDLE,"a call is already in progress");let s=e;return(s||(s=this.signalingAgentConfig.conversationServiceUrl,this.logger.info(`conversationServiceUrl passed is empty. so it is set to ${s}`)),sS(s,"conversationUrl should be a non null value"),this.logger.info(`[${r}][subscribeToCall][start][correlationId=${t}] applicationType=${this.participantManager.localParticipant.applicationType}`),this.disposed)?(this.logger.warn(`[${r}][subscribeToCall][failed][reason=Session disposed]`),Promise.reject(sr.CALL_END_CODE.CALL_DOES_NOT_EXIST)):(this.isBrokerEnabledForIncomingCall()&&this.setupBrokerChannel(),this.lastUsedJoinCallOptions=n||{},this.lastUsedJoinCallOptions.clientEndpointCapabilities=i||this.lastUsedJoinCallOptions?.clientEndpointCapabilities,this.meetingData=n?.meetingData,this.meetingPreferences=n?.meetingPreferences,this.fsmState=sr.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY,this.updateCorrelationId(t,r),this.http.sendPostRequest({url:s,requestName:u3.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY.name,operationType:"CallSetup",payload:gj(this,null,null,{subscribe:!0,clientEndpointCapabilities:i,...n,applicationType:this.participantManager.localParticipant.applicationType,endpointState:this.configureEndpointStateForStartOrJoin({additionalEndpointProperties:n?.additionalEndpointProperties})},r),causeId:r}).then(e=>{this.disposed||(this.fsmState=sr.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,this.processConversationServiceResponseHeaders(e,r),this.processConversationServiceResponse(e.response,r,1),this.onCallStatusChanged(sr.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY,r))}).catch(e=>{if(e.stack&&!this.isFatalException(e))return Promise.resolve();let t=sM(e,this.signalingAgentConfig);return(this.logger.info(`[${r}][subscribeToCall] error: ${t_(e)} xhrError: ${t_(t)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultValue:hn.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultCategories:t.error.resultCategories,resultDetail:t.error.phrase||"SubscribeFailure",causeId:r}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,r,t.error),Promise.reject(t.error))}))},this.getCallReplacementDetailsForCall=(e,t=sp())=>{this.logger.info(`[${t}] getCallReplacementDetailsForCall callId ${e}`);let i=this.signalingAgent.getSignalingSession(e);return i?i.getCallReplacementDetails(t):{replaces:""}},this.getCallReplacementDetails=(e=sp())=>(this.logger.info(`[${e}] getCallReplacementDetails`),{replaces:this.links[sr.LINKS.REPLACE]}),this.transferCallAsync=(e,t,i,n,r=sp())=>{this.logger.info(`[${r}] transferCallAsync: transferTargetMri: ${this.piiUtils.scrubMriOrOmit(e)} transferType ${t} callTransferOptions: ${tI(n)}`),this.transferHelper(e,t,i,n,r)},this.redirectCall=(e,t=sp(),i)=>{let{id:n,endpointType:r,type:s}=e.redirectOptions;if(this.logger.info(`[${t}] redirectCall: targetId: ${this.piiUtils.scrubMriOrOmit(n)} targetEndpointType ${r}`),!this.isRedirectAllowed)return Promise.reject({code:sr.CALL_END_CODE.REJECT,phrase:sr.CALL_END_PHRASE.CALL_REDIRECT_IS_NOT_ALLOWED});this.telemetryHelper.recordEvent(cV,{causeId:t});let a=gU(this,s,n,r);return this.http.sendPostRequest({url:this.links[sr.LINKS.REDIRECT],requestName:u3.SEND_CALL_REDIRECT_REQUEST.name,payload:a,causeId:t}).then(n=>(this.logger.info(`[${t}][redirectCall] succeeds. Leaving the call...`),this.telemetryHelper.recordEvent(dA,{causeId:t,targetEndpointType:r}),this.terminateEstablishedCall(i,e))).catch(e=>{let n=sM(e);this.logger.info(`[${t}][redirectCall] error: ${t_(n)}`);let s=n.error;return this.telemetryHelper.recordEvent(cB,{causeId:t,transactionEnd:s,endpointType:r}),this.disposed||(this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,endCode:i.code,endSubCode:i.subCode,clientReasonSubCode:i.clientReasonSubCode,clientReasonPhrase:i.clientReasonPhrase,resultDetail:i.phrase||"RedirectCall",resultCategories:i.resultCategories,causeId:t}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,i),this.dispose(i,t)),Promise.reject(s)})},this.transferHelper=(e,t,i,n,r=sp())=>{sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet");let s=!1;this.logger.info(`[${r}][transferHelper][replacementDetails=${t_(i)}] disableForwardingAndUnanswered=${n&&n.disableForwardingAndUnanswered}`),this.telemetryHelper.recordEvent(cU,{causeId:r}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,()=>{this.handleCallTransferTimeout(r,s)},this.getTimeoutValue("outgoingCallEstablishmentTimeoutSec")),this.http.sendPostRequest({url:this.links[sr.LINKS.TRANSFER],requestName:u3.SEND_TRANSFER_REQUEST.name,payload:g3(e,this,i,t,n),causeId:r}).then(()=>{this.telemetryHelper.recordEvent(dL,{causeId:r}),s=!0}).catch(e=>{let t=sM(e,this.signalingAgentConfig);this.logger.info(`[${r}][transferCallAsync] error: ${t_(t)}`),this.disposed||(this.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:sr.CALL_END_CODE.NETWORK_ERROR,reason:t_(e)}},r),this.telemetryHelper.recordEvent(dM,{causeId:r,...t.error}))}),this.telemetryHelper.recordEvent(dR,{causeId:r,transferType:t})},this.consultTransferCallAsync=(e,t,i,n,r)=>{let s,a;if(this.logger.info(`[${n}] consultTransferCallAsync: transferTargetMri: ${this.piiUtils.scrubMriOrOmit(t)} transferTargetParticipantLegId: ${i}`),i?(a=this.getMriByParticipantLegOfCall(e,i,n),s=this.getReplacementDetailsByParticipantLegOfCall(e,t,i,n)):(a=t,s=this.getCallReplacementDetailsForCall(e,n)),!a||!s){let r=s?"target mri corresponding not found":`unable to retrieve replacementDetails for transferTargetCallId: ${e}, transferTargetMri: ${t}, transferTargetParticipantLegId: ${i}`;this.logger.info(`[${n}] consultTransferCallAsync: error: ${r}`),this.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:sr.CALL_END_CODE.BAD_REQUEST,reason:r}},n);return}this.transferHelper(a,"TransferTypeStandard",s,r,n)},this.isParkByTransfer=(e,t)=>{let i=["serverHold","sharedLinePark","teamPark"].indexOf(e)>-1;return this.logger.info(`[${t}][isParkByTransfer][context=${e}] result = ${i}`),i},this.parkCallAsync=(e,t=sp())=>{if(e&&"none"===e)throw{code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark context is missing or none"};return(sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet"),this.logger.info(`[${t}][parkCallAsync][context=${e}]`),this.telemetryHelper.recordEvent(c$,{causeId:t,parkType:sZ(e)}),this.isParkByTransfer(e,t))?this.parkByTransfer(e,t):this.park(e,t)},this.unparkAsync=(e,t=sp())=>{if(e&&"none"===e)throw{code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark context is missing or none"};if(!this.links[sr.LINKS.UNPARK])throw{code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark link not available"};this.logger.info(`[${t}][unparkAsync][context=${e}]`),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UNPARK_COMPLETION,()=>{this.handleUnparkError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UNPARK_COMPLETION_TIMEOUT,phrase:sr.CALL_END_PHRASE.UNPARK_COMPLETION_TIMEOUT},d9,t,e)},this.getTimeoutValue("unparkCompletionTimeoutSec"));let i={causeId:t};return this.http.sendPostRequest({url:this.links[sr.LINKS.UNPARK],requestName:u3.SEND_UNPARK_REQUEST.name,payload:g5(this,i),causeId:t}).then(e=>(this.logger.info(`[${t}][unparkAsync] response: ${t_(e)}`),this.telemetryHelper.recordEvent(d8,{causeId:t}),Promise.resolve())).catch(i=>{let n=sM(i,this.signalingAgentConfig);return(this.logger.info(`[${t}][unparkAsync] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleUnparkError(n.error,d6,t,e),Promise.reject(n.error))})},this.handleUpdateParticipantsPropertiesCompletion=e=>{let t=e.body,i=sk(e),n=this.logger.createChild(`[${i}][handleUpdateParticipantsPropertiesCompletion]`,this.correlationId),r={};if(this.disposed)return void n.info("ignored. Call disposed.");if(t.operationId||n.warn("operationId is undefined."),n.info("starts"),t.participantInfos)for(let e of t.participantInfos){if(!e.participant.id){n.warn("participant id is undefined."),this.telemetryHelper.recordEvent(uI,"participant id is undefined in response, property");continue}if(!e.participant.key){n.warn("property name (key) is undefined."),this.telemetryHelper.recordEvent(uI,"property name (key) is undefined in response");continue}let s=gA(e.participant.id,t.operationId,e.participant.key),a={code:e.transactionEnd.code,subCode:e.transactionEnd.subCode,phrase:e.transactionEnd.phrase,resultCategories:e.transactionEnd.resultCategories};n.info(`Update participants properties completed for: ${this.piiUtils.scrubMriOrOmit(e.participant.id)} with transactionEnd ${t_(a)}`),this.telemetryHelper.recordEvent(uw,{causeId:i,resolveId:this.piiUtils.scrubMriOrOmit(s),property:e.participant.key,result:t_(a)}),r[s]=a,this.updateParticipantsPromises[t.operationId].delete(s)}this.checkAndCleanupPromisesForOperationId(t.operationId),this.signalingSessionCallback.onUpdateParticipantsPropertiesCompleted(r,t.operationId,i)},this.getCallStatus=()=>this.currentCallStatus,this.processIncomingCallRequest=(e,t,i=sp())=>{sy(e,"request should be a non null value"),sS(e.body,"request should have a valid body"),sS(e.body.gp||e.body.cp,"request body should have payload"),sv(this.isCallNotConnected(),"a call is already in progress");let n=this.logger.createChild(`[${i}][processIncomingCallRequest]`);if(this.callUsesMixer=e.fromMixer,n.info("[start]"),this.disposed)return void n.warn("processIncomingCallRequest canceled");this.telemetryHelper.startCallInitializationWatch(),this.isIncomingCall=!0,this.isBrokerEnabledForIncomingCall()&&this.setupBrokerChannel(),this.fsmState=sr.SIGNALING_FSM_STATE.INCOMING,this.participantManager.initializeForIncomingCall();let r={};try{t&&(r=JSON.parse(t))}catch(e){n.warn("Unable to parse endpoint metadata")}this.endpointMetadata=r;try{let t;if(e?.body?.gp&&!tF(e.body.gp))n.info("unencoded payload, skipping decoding."),t=e.body.gp;else{let i=e.body.gp?atob(e.body.gp):s$(e.body.cp);t=JSON.parse(i)}if(t.callNotification)n.info(`incoming call payload: ${tI(tl(t))}`),this.processIncomingCallPayload(t,i),this.incomingCallPayload=t;else throw n.info("[failed][reason=CallNotification missing]"),Error("CallNotification is missing")}catch(e){this.endIncomingCallBecauseOfInvalidPayload(i)}},this.sendAttachToCall=(e=sp())=>(this.logger.info(`[${e}][sendAttachToCall]`),this.incomingCallPayload)?(this.onCallStatusChanged(sr.CALL_STATUS.IDLE,e),this.sendAttachToCallInternal(e)):(this.endIncomingCallBecauseOfInvalidPayload(e),Promise.reject(sr.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD)),this.supportsNewOfferRequest=()=>this.signalingAgentConfig.handleNewOfferRequest,this.requestNewOffer=(e,t=sp())=>(this.telemetryHelper.recordEvent(dc,{compatibleContentTypes:e,causeId:t}),this.signalingAgentConfig.handleNewOfferRequest)?(sS(this.links[sr.LINKS.NEW_OFFER],"newOffer link should be a non null value"),this.http.sendPostRequest({url:this.links[sr.LINKS.NEW_OFFER],requestName:u3.REQUEST_NEW_OFFER.name,payload:gz(this,e,this.links[sr.LINKS.NEW_OFFER]),causeId:t}).then(e=>this.disposed?Promise.reject(this.getCallNotFoundTransactionEnd()):Promise.resolve(e)).catch(e=>{let i=sM(e,this.signalingAgentConfig);return(this.logger.info(`[requestNewOffer][${t}] error ${t_(i)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultValue:hn.FAILURE,endCode:i.telemetryEndSubCode,endSubCode:i.error.subCode,resultCategories:i.error.resultCategories,resultDetail:i.error.phrase||"RequestNewOfferFailure",causeId:t}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,i.error),this.dispose(i.error,t),Promise.reject(i.error))})):Promise.reject("Disabled"),this.endAsync=(e,t={})=>{t.causeId=t.causeId||sp();let i=t.causeId;if(this.logger.info(`[${i}][endAsync][rejectionData=${e&&t_(e)}][endCallForAll=${t.forEveryone}]`),this.disposed)return this.logger.warn(`[${i}][endAsync] canceled but session already disposed`),Promise.resolve(null);if(this.disposing=!0,this.telemetryHelper.recordEvent(lX,e?{code:e.code,subCode:e.subCode,causeId:i,callEndClientSubCode:e.clientReasonSubCode,callEndClientPhrase:e.clientReasonPhrase}:{causeId:i}),t.preventAllCallbacks)for(let e of Object.keys(this.signalingSessionCallback))this.signalingSessionCallback[e]=hy.noop;let n=this.mediaRenegotiationManager?.isIncomingRenegotiationInProgress()||this.mediaRenegotiationManager?.isOutgoingRenegotiationInProgress();if(this.telemetryHelper.stopCallCancelationDurationWatch(),this.fsmState===sr.SIGNALING_FSM_STATE.INCOMING)return e.code===sr.CALL_END_CODE.CALL_REDIRECTED?this.redirectCall(t,i,e):this.rejectIncomingCall(e,i);{if(this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING||this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY)return this.cancelOutgoingCall(e,i);if(this.fsmState===sr.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK)return this.rejectIncomingCall(e,i);if((this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED||n)&&t.forEveryone)return this.deleteConversation(e,i);if(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED||this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||n)return this.terminateEstablishedCall(e,t);this.logger.info(`[${i}][endAsync] there is no call to cancel or end or reject in current state`);let r={code:isNaN(e?.code)?sr.CALL_END_CODE.NOT_FOUND:e.code,subCode:isNaN(e?.subCode)?sr.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED:e.subCode,phrase:e?.phrase||sr.CALL_END_PHRASE.CALL_DOES_NOT_EXIST,resultCategories:e?.resultCategories||[r$],clientReasonSubCode:e?.clientReasonSubCode,clientReasonPhrase:e?.clientReasonPhrase};return this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultDetail:r.phrase||"CallDoesNotExist",endCode:r.code,endSubCode:r.subCode,resultCategories:r.resultCategories,causeId:i,clientReasonSubCode:r.clientReasonSubCode,clientReasonPhrase:r.clientReasonPhrase}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,i,r),this.dispose(r,i),Promise.resolve(null)}},this.handleIncomingMsgAsync=(e,t=sr.INCOMING_MESSAGE_ORIGIN.TROUTER)=>{sy(e,"incoming message should be a non null value");let i=sO(e),n=sV(),r=e.body,s=e.url,a={...e,origin:t},o=sk(a);if(this.logger.info(`[${o}][handleIncomingMsgAsync][url=${s}][messageId=${i}]`),!r)return this.logger.info(`[${o}][handleIncomingMsgAsync][failed][reason=received message with no body]`),this.telemetryHelper.recordEvent(c9,{origin:t,messageId:i,causeId:o}),n.reject(Error("received message with no body")),n.promise;if(this.disposed)return this.logger.info(`[${o}][handleIncomingMsgAsync][failed][reason=call is disposed]`),n.reject(this.getCallNotFoundTransactionEnd()),n.promise;if(this.isDuplicatedIncomingMessage(a))return this.logger.info(`[${o}][handleIncomingMsgAsync][failed][reason=duplicate]`),this.telemetryHelper.recordEvent(cW,{origin:t,messageId:i,causeId:o}),n.resolve(Error("Message was already handled")),n.promise;this.checkCorrelationIdChange(e,o);let l={[rz]:e=>{this.handleCallNotification(e)},[rJ]:e=>{this.handleMediaAnswer(e)},[rK]:e=>{this.handleMediaAcknowledgement(e)},[rQ]:e=>{this.handleCallAcceptance(e)},[rY]:e=>{this.handleCallEnd(e,!1)},[rZ]:e=>{this.handleCallProgress(e)},[rX]:e=>{this.handleCallAcceptanceAck(e)},[r0]:e=>{this.mediaRenegotiationManager?.handleMediaNegotiationOffer(e)},[r1]:e=>{this.mediaRenegotiationManager?.handleMediaNegotiationFailure(e)},[r2]:e=>{this.handlePSTNBalanceUpdate(e)},[r3]:e=>{this.mediaRenegotiationManager?.handleRetargetCompleted(e)},[r4]:e=>{this.handleTransferRequested(e)},[r5]:e=>{this.handleTransferCompletion(e)},[r6]:e=>{this.handleTransferAcceptance(e)},[r8]:e=>{this.handleParkCompletion(e)},[r9]:e=>{this.handleUnparkCompletion(e)},[r7]:e=>{this.handleUpdateMeetingLiveStateCompletion(e)},[se]:e=>{this.handleUpdateMeetingGroupsCompletion(e)},[st]:e=>{this.handleSetMeetingLayoutCompletion(e)},[si]:e=>{this.handleUpdateMeetingStatesCompletion(e)},[sn]:e=>{this.handleUpdateMonitorSessionCompletion(e)}},c={[rG.CONTROL_VIDEO_STREAMING]:e=>{this.webRtcSignalingManager.handleControlVideoStreaming(e)},[rG.DOMINANT_SPEAKER_INFO]:e=>{this.webRtcSignalingManager.handleDominantSpeakerInfo(e)},[rG.CSRC_INFO]:e=>{this.webRtcSignalingManager.handleCsrcInfo(e)},[rG.CONV_ROSTER_UPDATE]:e=>{this.handleRosterUpdate(e,!1)},[rG.NEW_MEDIA_OFFER]:e=>{this.handleNewMediaOffer(e)},[rG.CONV_ADD_PARTICIPANT_SUCCESS]:e=>{this.participantManager.handleAddParticipantSuccess(e)},[rG.CONV_ADD_PARTICIPANT_FAILURE]:e=>{this.participantManager.handleAddParticipantFailure(e)},[rG.CONV_ADMIT_PARTICIPANT_SUCCESS]:e=>{this.participantManager.handleAdmitParticipantSuccess(e)},[rG.CONV_ADMIT_PARTICIPANT_FAILURE]:e=>{this.participantManager.handleAdmitParticipantFailure(e)},[rG.CONV_ADMIT_ALL_STATUS]:e=>{this.handleAdmitAllStatus(e)},[rG.CONV_REMOVE_PARTICIPANT_SUCCESS]:e=>{this.participantManager.handleRemoveParticipantSuccess(e)},[rG.CONV_REMOVE_PARTICIPANT_FAILURE]:e=>{this.participantManager.handleRemoveParticipantFailure(e)},[rG.CONV_CONFIRM_UNMUTE]:e=>{this.participantManager.handleUnmuteConfirmRequest(e)},[rG.CONV_UPDATE]:e=>{this.handleConversationUpdate(e)},[rG.CONV_LOCAL_PARTICIPANT_UPDATE]:e=>{this.handleLocalParticipantUpdate(e)},[rG.CONV_ADD_MODALITY_SUCCESS]:e=>{this.handleAddModalitySuccess(e)},[rG.CONV_ADD_MODALITY_FAILURE]:e=>{this.handleAddModalityFailure(e)},[rG.CONV_BROADCAST_UPDATE]:e=>{this.broadcastSession.handleBroadcastStateChanged(e)},[rG.CONV_CONTENT_SHARING_UPDATE]:e=>{this.contentSharingManager?.handleContentSharingUpdate(e)},[rG.CONV_CONTENT_SHARING_END]:e=>{this.contentSharingManager?.handleContentSharingEnd(e)},[rG.CONV_END]:e=>{this.handleCallEnd(e,!1)},[rG.CONV_END_JOIN]:e=>{this.handleCallEnd(e,!1)},[rG.CONV_END_SUBSCRIBE]:e=>{this.handleCallEnd(e,!0)},[rG.UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS]:e=>{this.participantManager.handleUpdateParticipantInterpretationStateCompletion(e)},[rG.UPDATE_PARTICIPANT_PROPERTIES_STATUS]:e=>{this.handleUpdateParticipantsPropertiesCompletion(e)},[rG.JOIN_MEETING_GROUP_STATUS]:e=>{this.handleJoinMeetingGroupCompletion(e)},[rG.LEAVE_MEETING_GROUP_STATUS]:e=>{this.handleLeaveMeetingGroupCompletion(e)},[rG.RECEIVE_MESSAGE]:e=>{this.handleReceiveMessage(e)},[rG.SEND_MESSAGE_STATUS]:e=>{this.proxiedMessageNotificationManager.handleProxiedMessageNotification(e)},[rG.DISABLE_PREHEAT_ASYNC_STATUS]:e=>{this.handleDisablePreheatCompletion(e)},[rG.MUTE_UNMUTE_ASYNC]:e=>{this.participantManager.handleMuteUnmuteAsyncResponse(e)},[rG.SET_MEETING_LAYOUT_STATUS]:e=>{this.handleSetMeetingLayoutCompletion(e)}};try{let e=Object.keys(l).filter(e=>r.hasOwnProperty(e))[0],t=this.signalingAgentConfig.enableSplitConversationEndUrl&&(s_(a.url,rG.CONV_END_JOIN)||s_(a.url,rG.CONV_END_SUBSCRIBE))?Object.keys(c).filter(e=>a.url&&s_(a.url,e))[1]:Object.keys(c).filter(e=>a.url&&s_(a.url,e))[0];e?l[e](a):t?c[t](a):(this.telemetryHelper.recordEvent(cz,{messageId:i}),this.logger.info(`[${o}][handleIncomingMsgAsync][failed][reason=received unknown message]`)),n.resolve(!0)}catch(e){this.telemetryHelper.recordEvent(cJ,{messageId:i,error:t_(e)}),this.logger.info(`[${o}][handleIncomingMsgAsync][failed][reason=${e.message}]`),n.reject(Error(e.message))}return n.promise},this.canHandleIncomingMsgSync=e=>!!this.signalingAgentConfig.supportsSynchronousTrouterResponse&&!!e.body.callAcceptance,this.handleIncomingMsgSync=e=>{let t=sO(e),i=e.body,n=e.url,r=sr.INCOMING_MESSAGE_ORIGIN.TROUTER,s={...e,origin:r},a=sk(s);this.logger.info(`[${a}][handleIncomingMsgSync][url=${n}][messageId=${t}]`);let o=s.headers,l=sr.HTTP_STATUS_CODES.OK,c="",d=new sa;if(sD(o,this.incomingTrouterMessagesSeenSoFar)){this.logger.info(`[${a}][handleIncomingMsgSync][failed][reason=duplicate]`);let e=sx(o,this.incomingMessageSyncResponseCache);if(e)return this.logger.info(`[${a}][handleIncomingMsgSync][cachedResponse]`),e;this.telemetryHelper.recordEvent(cW,{origin:r,messageId:t,causeId:a}),this.logger.info(`[${a}][handleIncomingMsgSync][failed][reason=cachedResponseNotFound]`),l=sr.HTTP_STATUS_CODES.BAD_REQUEST}else if(i){if(i.callAcceptance)try{let e=this.handleCallAcceptanceSync(s);c=tI(e)}catch(e){this.telemetryHelper.recordEvent(cJ,{messageId:t,origin:r,causeId:a,error:t_(e)}),this.logger.info(`[${a}][handleIncomingMsgSync][failed][reason=${e?.message}]`),l=sr.HTTP_STATUS_CODES.BAD_REQUEST}}else this.logger.info(`[${a}][handleIncomingMsgSync][failed][reason=received message with no body]`),this.telemetryHelper.recordEvent(c9,{origin:r,messageId:t,causeId:a}),l=sr.HTTP_STATUS_CODES.BAD_REQUEST;o&&(o.get(sr.HEADERS.CORRELATION_ID)&&d.set(sr.HEADERS.CORRELATION_ID,o.get(sr.HEADERS.CORRELATION_ID)),o.get(sr.HEADERS.MESSAGE_ID)&&d.set(sr.HEADERS.MESSAGE_ID,o.get(sr.HEADERS.MESSAGE_ID)));let u={resultCode:l,responseBody:c,responseHeaders:d.getAll()};return sN(o,this.incomingMessageSyncResponseCache,u),this.logger.info(`[${a}][handleIncomingMsgSync][success][resultCode=${l}]`),u},this.acceptRenegotiationAsync=(e,t,i=sp())=>(sy(e.blob,"finalSdp should be a non null value"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"Renegotiation operations are only allowed when the call is connected and no disconnect operation is in flight"),this.logger.info(`[${i}][acceptRenegotiationAsync][mediaTypes=${t}]`),this.mediaRenegotiationManager.acceptRenegotiationAsync(e,t,i)),this.setProvisionalAnswerAsync=(e,t=sp())=>{sy(e.blob,"sdp should be a non null value"),this.telemetryHelper.recordEvent(l4,{causeId:t});let i=sV();return this.fsmState!==sr.SIGNALING_FSM_STATE.INCOMING?(this.logger.info(`[setProvisionalAnswerAsync][${t}] there is no incoming call to set provisional answer on.`),i.reject(Error("there is no incoming call to set provisional answer on."))):this.http.sendPostRequest({url:this.links[sr.LINKS.MEDIA_ANSWER],requestName:u3.SEND_MEDIA_ANSWER.name,payload:pr(this,e),causeId:t}).then(e=>{this.disposed||this.onCallStatusChanged(sr.CALL_STATUS.CONNECTING,t),i.resolve(null),this.disposed||(this.telemetryHelper.recordEvent(o9,{causeId:t}),this.telemetryHelper.setTimeToRingDuration(),this.onCallStatusChanged(sr.CALL_STATUS.RINGING,t),this.signalingSessionCallback.onMediaAcknowledgementSuccess(!1,t))}).catch(e=>{let n=sM(e,this.signalingAgentConfig);this.logger.info(`[setProvisionalAnswerAsync][${t}] error: ${t_(n)}`),this.disposed?i.reject(this.getCallNotFoundTransactionEnd()):(this.telemetryHelper.recordEvent(l5,{causeId:t}),i.reject(n.error))}),i.promise},this.startRenegotiationAsync=(e,t,i=sp())=>(sy(e,"mediaContent should be a non null value"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"Renegotiation operations are only allowed when the call is connected and no disconnect operation is in flight"),this.logger.info(`[${i}][startRenegotiationAsync]`),this.mediaRenegotiationManager.startRenegotiationAsync(e,this.links[sr.LINKS.MEDIA_RENEGOTIATION],t,i)),this.updateMediaDescriptionsAsync=(e=sp(),t)=>{sy(t,"mediaDescriptions should be a non null value"),sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"updateMediaDescriptions operations are only allowed when the call is connected");let i=this.links[sr.LINKS.UPDATE_MEDIA_DESCRIPTIONS];return sy(i,"updateMediaDescriptionsUrl should be a non null value"),this.telemetryHelper.recordEvent(uW,{causeId:e}),this.http.sendPostRequest({url:i,requestName:u3.UPDATE_MEDIA_DESCRIPTIONS.name,payload:ps(this,t),causeId:e}).catch(t=>{let i=sM(t,this.signalingAgentConfig);return(this.logger.info(`[updateMediaDescriptionsAsync][${e}] error: ${t_(i)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.telemetryHelper.recordEvent(uG,{causeId:e}),Promise.reject(i.error))})},this.acceptAsync=(e,t,i,n=sp())=>{sy(e,"mediaContent should be a non null value"),sy(e.blob,"outgoingSdp should be a non null value"),this.logger.info(`[${n}][acceptAsync][mediaTypes=${t}]`),this.telemetryHelper.recordEvent(l6,{causeId:n}),this.telemetryHelper.setAnsweredModalities(e.blob);let r=sV();return this.fsmState!==sr.SIGNALING_FSM_STATE.INCOMING?(this.logger.warn("acceptAsync, there is no incoming call to accept"),r.reject(Error("there is no incoming call to accept"))):(this.fsmState=sr.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK,this.http.sendPostRequest({url:this.links[sr.LINKS.ACCEPT],requestName:u3.SEND_ACCEPTANCE.name,payload:gL(this,e,t,i),causeId:n}).then(e=>{!this.disposed&&(this.currentCallStatus===sr.CALL_STATUS.IDLE&&(this.telemetryHelper.setTimeToRingDuration(),this.telemetryHelper.recordEvent(cd,{causeId:n}),this.onCallStatusChanged(sr.CALL_STATUS.CONNECTING,n)),e.response.callAcceptanceAcknowledgement&&(this.logger.info("acceptAsync, handling inlined callAcceptanceAcknowledgement"),this.internalHandleCallAcceptanceAck(e.response,n))),r.resolve(null)}).catch(e=>{let t=sM(e,this.signalingAgentConfig);this.logger.info(`[acceptAsync][${n}] error: ${t_(t)}`),this.disposed?r.reject(this.getCallNotFoundTransactionEnd()):(this.fsmState=sr.SIGNALING_FSM_STATE.INCOMING,this.telemetryHelper.recordEvent(l8,{causeId:n,xhrError:t}),r.reject(t.error))})),r.promise},this.rejectRenegotiationAsync=(e,t=sp())=>(sv(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED,"Renegotiation operations are only allowed when the call is connected and no disconnect operation is in flight"),this.logger.info(`[${t}][rejectRenegotiationAsync][rejectionData=${e}]`),this.mediaRenegotiationManager.rejectRenegotiationAsync(e,t)),this.saveMediaControllerLinksIfAny=e=>{e.links&&(this.links[sr.LINKS.CONTROL_VIDEO_STREAMING]=e.links.controlVideoStreaming||this.links[sr.LINKS.CONTROL_VIDEO_STREAMING],this.links[sr.LINKS.APPLY_CHANNEL_PARAMETERS]=e.links.applyChannelParameters||this.links[sr.LINKS.APPLY_CHANNEL_PARAMETERS])},this.getInitialMediaOfferFromIncomingCallPayload=(e=sp())=>{if(!this.signalingAgentConfig.handleMediaOfferFromPushNotification)return null;let t=this.incomingCallPayload?.callNotification?.mediaContent?this.incomingCallPayload.callNotification.mediaContent:null;return this.telemetryHelper.setIsSdpInCallNotification(!!t),t},this.updateCorrelationId=(e,t=sp())=>{if(this.logger.info(`[${t}][updateCorrelationId][old=${this.correlationId}][new=${e}]`),this.correlationId!==e&&!this.disposed){let i=this.correlationId;this.correlationId=e,this.telemetryHelper&&this.telemetryHelper.recordEvent&&this.telemetryHelper.recordEvent(cG,{newId:this.correlationId,oldId:i,causeId:t}),this.signalingSessionCallback&&this.signalingSessionCallback.onCorrelationIdUpdated&&this.signalingSessionCallback.onCorrelationIdUpdated(this.correlationId,t)}},this.endIncomingCallBecauseOfInvalidPayload=e=>{this.logger.info(`[${e}][endIncomingCallBecauseOfInvalidPayload]`),this.fsmState=sr.SIGNALING_FSM_STATE.IDLE;let t={code:sr.CALL_END_CODE.BAD_REQUEST,subCode:sr.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,phrase:sr.CALL_END_PHRASE.BAD_NOTIFICATION_PAYLOAD,resultCategories:[rB]};this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultValue:hn.FAILURE,endCode:t.code,endSubCode:t.subCode,resultDetail:t.phrase||"EndIncomingCall",resultCategories:t.resultCategories,causeId:e}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,e,t),this.dispose(t,e)},this.isDuplicatedIncomingMessage=e=>e.origin===sr.INCOMING_MESSAGE_ORIGIN.BROKER&&sD(e.headers,this.incomingBrokerMessagesSeenSoFar)||e.origin===sr.INCOMING_MESSAGE_ORIGIN.TROUTER&&sD(e.headers,this.incomingTrouterMessagesSeenSoFar),this.getEndpointState=()=>this.startOrJoinConvResponseReceived?{...this.latestEndpointState}:{...this.requestedEndpointStateWhileConnecting},this.setMultiParty=(e,t)=>{let i=!!e;this.multiParty!==i&&(this.telemetryHelper.recordEvent(lj,{isMultiparty:i,causeId:t}),this.multiParty=i)},this.setupTrouterChannel=()=>{this.logger.info(`Broker config: outgoing=${this.signalingAgentConfig.brokerEnabledOutgoing?"enabled":"disabled"}incoming=${this.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled"}batching=${this.signalingAgentConfig.brokerRequestBatching?"enabled":"disabled"}exclusive=${this.signalingAgentConfig.brokerExclusively?"enabled":"disabled"}`);let e=e=>{e&&"string"==typeof e&&e.trim()&&(this.baseMessagingChannelUrl=this.previousTrouterUrl=this.currentTrouterUrl=e.trim(),this.telemetryHelper.addTrouterChannel())};this.brokerExclusiveEnabled()||(this.signalingAgentConfig.trouterServiceProvider?(2===this.signalingAgentConfig.trouterServiceProvider.state()&&this.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync().then(e),this.signalingAgentConfig.trouterServiceProvider.onStateChanged(this.onTrouterStateChanged)):(e(this.signalingAgentConfig.trouterUrlGetter.trouterUrl()),this.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed(this.onTrouterUrlChanged)))},this.isTrouterDisconnected=()=>{try{return 3===this.signalingAgentConfig.trouterServiceProvider.state()}catch(e){return!1}},this.forceTrouterConnectionCheck=()=>{try{this.signalingAgentConfig.trouterServiceProvider.checkConnection(!1);return}catch(e){return}},this.navigatorOnlineCallback=()=>{!this.disposed&&(this.reportConnectivityStatus(),this.isTrouterDisconnected()&&this.signalingAgentConfig.forceTrouterReconnectOnNetworkOnline&&this.forceTrouterConnectionCheck())},this.navigatorOfflineCallback=()=>{this.reportConnectivityStatus()},this.reportConnectivityStatus=()=>{if(!this.disposed){let e=sB(this.signalingAgentConfig.trouterServiceProvider);this.logger.info(`[Connectivity] status=${e}`),this.telemetryHelper.recordEvent(cK,{status:e})}},this.onTrouterStateChanged=(e,t)=>{let i=sp();if(this.logger.info(`[${i}][onTrouterStateChanged][state=${e}]`),this.disposed)return void this.logger.info("onTrouterStateChanged ignored");this.reportConnectivityStatus(),2===e&&(this.telemetryHelper.addTrouterChannel(),this.updateLinksToTrouter(ca,i))},this.setupConnectionCheck=()=>{try{navigator&&navigator.onLine&&window&&window.addEventListener&&(window.addEventListener("online",this.navigatorOnlineCallback),window.addEventListener("offline",this.navigatorOfflineCallback))}catch(e){return}},this.tearDownConnectionCheck=()=>{try{navigator&&navigator.onLine&&window&&window.removeEventListener&&(window.removeEventListener("online",this.navigatorOnlineCallback),window.removeEventListener("offline",this.navigatorOfflineCallback))}catch(e){return}},this.getTrouterUrlAsync=()=>this.signalingAgentConfig.trouterServiceProvider?this.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync():this.signalingAgentConfig.trouterUrlGetter.getTrouterUrlAsync(),this.brokerExclusiveEnabled=()=>this.signalingAgentConfig.brokerEnabledOutgoing&&this.signalingAgentConfig.brokerEnabledIncoming&&this.signalingAgentConfig.brokerExclusively,this.isBrokerEnabledForOutgoingCall=()=>this.signalingAgentConfig.brokerEnabledOutgoing,this.isBrokerEnabledForIncomingCall=()=>this.signalingAgentConfig.brokerEnabledIncoming,this.setupBrokerChannel=()=>{!this.brokerService&&(this.logger.info("setupBrokerChannel, Enable broker"),this.brokerService=new h$(this),this.brokerService.onBrokerMessage(e=>{this.logger.info("setupBrokerChannel, message from broker",tk(e)),this.handleIncomingMsgAsync(e,sr.INCOMING_MESSAGE_ORIGIN.BROKER).catch(e=>{this.telemetryHelper.recordEvent(c3),this.logger.info("setupBrokerChannel, Failed to handle message from broker",e)})}),this.baseMessagingChannelUrl||(this.telemetryHelper.addBrokerChannel(),this.baseMessagingChannelUrl=this.brokerService.baseUrl))},this.onTrouterUrlChanged=()=>{let e=sp();if(this.logger.info(`[${e}][onTrouterUrlChanged]`),this.disposed)return void this.logger.info("onTrouterUrlChanged ignored");this.getTrouterUrlAsync().then(t=>{this.telemetryHelper.recordEvent(cs,{url:t}),this.telemetryHelper.addTrouterChannel(),this.updateLinksToTrouter(cs,e)}).catch(e=>{this.logger.info(`Failed to update links to trouter: ${e}`)})},this.updateLinksToTrouter=(e,t)=>{this.logger.info(`[${t}][updateLinksToTrouter][tag=${e}]`),this.ensureLatestTrouterUrl(e).then(()=>{this.previousTrouterUrl!==this.currentTrouterUrl?(this.previousTrouterUrl=this.currentTrouterUrl,this.updateConversationLinks(),this.updateKeepAliveUrl(),this.contentSharingManager?.updateContentSharingNotificationLinksAsync(t),this.broadcastSession&&this.broadcastSession.updateBroadcastCallbackUrl(t)):this.logger.info(`[${t}][updateLinksToTrouter]skip updating links, url did not change`)}).catch(e=>{this.disposed||this.telemetryHelper.recordEvent(cl,{causeId:t}),this.logger.info(`[${t}][updateLinksToTrouter][failed][reason=${t_(e)}]`)})},this.updateLinks=(e,t)=>{this.ensureLatestTrouterUrl(cs).then(()=>{e(t)}).catch(e=>{this.disposed||this.telemetryHelper.recordEvent(cl,{causeId:t}),this.logger.warn("Failed to update links")})},this.startCallPreheatTimer=e=>{this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT,()=>{this.handleCallEstablishmentTimeout(e,sr.CALL_END_SUB_CODE.PREHEATED_CALL_TIMEDOUT,"Preheat timed out!"),this.terminateEstablishedCall({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.PREHEATED_CALL_TIMEDOUT,phrase:"Preheat timed out!"},{forEveryone:!1,causeId:e})},this.getTimeoutValue("maxPreaheatedTimeoutSec"))},this.stopCallPreheatTimer=()=>{this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT)},this.updateKeepAliveUrl=()=>{this.logger.info("updateKeepAliveUrl"),this.links.hasOwnProperty(sr.LINKS.KEEPALIVE)?(this.linkUpdateRequested.keepAliveLinks=!1,this.logger.info("updateKeepAliveUrl, sending request"),this.sendToKeepAliveUrl(gQ(this))):this.linkUpdateRequested.keepAliveLinks=!0},this.updateConversationLinks=(e=sp())=>{this.logger.info(`[${e}][updateConversationLinks]`),this.telemetryHelper.recordEvent(du,{causeId:e}),this.links.hasOwnProperty(sr.LINKS.NOTIFICATION_LINKS)?(this.linkUpdateRequested.conversationLinks=!1,this.logger.info("updateConversationLinks, sending request"),this.sendToUpdateConversationLinks(!0)):this.linkUpdateRequested.conversationLinks=!0},this.sendAttachToCallInternal=(e=sp())=>{this.telemetryHelper.recordEvent(dl,{causeId:e}),this.logger.info(`[${e}][sendAttachToCallInternal]`);let t=new sa;return this.signalingAgentConfig.sendProgressFromCC&&t.set(sr.HEADERS.CACHE_SKYPE_TOKEN,"1"),this.http.sendPostRequest({url:this.incomingCallPayload.callNotification.links.attach,customHeaders:t,requestName:u3.SEND_CALL_ATTACH.name,payload:gN(this,this.incomingCallPayload.conversationInvitation.conversationController,!this.getInitialMediaOfferFromIncomingCallPayload()),causeId:e}).then(t=>{if(!this.disposed){this.processAttachResponse(this.incomingCallPayload,t,e);let i=t.response.additionalActionResponses;i&&i.length>0&&this.processConversationServiceResponse(i[0].output,e,0),this.onCallStatusChanged(sr.CALL_STATUS.RINGING,e),this.telemetryHelper.setTimeToRingDuration(),this.handleBrokerSubscription(t.response.callInvitation,e)}}).catch(t=>{let i=sM(t,this.signalingAgentConfig);if(this.logger.info(`[${e}][sendAttachToCallInternal] error: ${t_(t)} xhrError: ${t_(i)}`),!this.disposed)throw this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultValue:hn.FAILURE,endCode:i.telemetryEndSubCode,endSubCode:i.error.subCode,resultCategories:i.error.resultCategories,resultDetail:i.error.phrase||"SendAttachtoCallFailure",causeId:e}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,e,i.error),this.dispose(i.error,e),{code:i.telemetryEndSubCode,subCode:i.error.subCode,resultCategories:i.error.resultCategories}})},this._processCallAcceptance=(e,t)=>{if(this.logger.info(`[${t}][_processCallAcceptance]`),this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING){this.processCallAcceptance(e.body,t),this.telemetryHelper.setTimeToRingDuration();try{this.multiParty||this.callUsesMixer||this.participantManager.handleRosterUpdate(this.getFakeRoster(e.body),!0,t)}catch(n){let i={code:sr.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:sr.CALL_END_SUB_CODE.CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE,phrase:n?.toString()};throw this.logger.info(`[${t}][_processCallAcceptance] ${tI(i)}`),this.telemetryHelper.recordRosterEvent(e,lL,t),i}}},this.restartKeepAliveInterval=(e,t=!1,i)=>{if(!this.disposed){if(window.clearInterval(this.keepAliveTimer),t&&(this.telemetryHelper.recordEvent(db,i),i?.code===sr.RESOURCE_NOT_FOUND_ERROR.code))return void this.logger.info(`[${e}][restartKeepAliveInterval] keepAlive stopped since last request returned NOT_FOUND.`);this.keepAliveTimer=window.setInterval(this.sendKeepAlive.bind(this),this.keepAliveInterval)}},this.isCallOngoing=()=>this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED||this.fsmState===sr.SIGNALING_FSM_STATE.IDLE,this.isCallNotConnected=()=>{let e=this.signalingAgentConfig.enableSplitConversationEndUrl&&this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING;return this.fsmState===sr.SIGNALING_FSM_STATE.IDLE||this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||e},this.isCallConnectedOrConnectedForRoster=()=>this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED||this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,s&&(this.callStartTime=s),this.signalingSessionCallback=t,this.signalingAgentConfig=i,this.signalingAgent=r,this.urlIdentifier=n,this.piiUtils=new hS(i.piiScrubber),this.isHostLessCall=i.doHostlessCalling||!1,this.logger=i.logger.createChild(()=>`CSA[${this.correlationId}][${this.fsmState}]`,this.correlationId,!0),this.updateCorrelationId(n),this.logger.info(`[endpointId=${tw(this.signalingAgent.endpointId,8)}]`),this.logger.info(`[participantId=${e.participantId}]`),this.callOperationHandler=new hB(this.logger.createChild(()=>`[CallOperationHandler][${e.participantId}]`)),this.http=new gn(this,this.callStartTime),this.telemetryHelper=new ph(this,e,this.callStartTime),this.mediaRenegotiationManager=new go(this,t,this.telemetryHelper),this.participantManager=new gI(this,t,e,new tJ(this.logger)),this.proxiedMessageNotificationManager=new gM(this),this.timeoutManager=new hp(this.logger),this.timeoutManager.updateTimeoutValues(i.csaTimeoutConfiguration),this.contentSharingManager=new hZ(this,t),this.webRtcSignalingManager=new pg(this,t),this.pstnContent={emergencyCallCountry:i.emergencyCallCountry||"",platformName:sd(i.clientInformation),publicApiCall:!1},this.setupTrouterChannel(),this.setupConnectionCheck()}onPromotionCompleted(e,t,i){this.logger.info(`[${i}][onPromotionCompleted] isFailed=${e} error=${t_(t)}]`),this.isPromotingToRealtime=!1,this.signalingSessionCallback.onPromotionCompleted(e,t,i)}setRealTimeState(e,t){let i=e;(2===e&&1===this.realTimeState||1===e&&2===this.realTimeState)&&(i=3),i!==this.realTimeState&&(this.logger.info(`[${t}][setRealTimeState] changed: input=${e} old=${this.realTimeState}, new=${i}`),this.realTimeState=i,3===i?this.setCallMode(1,t):0!==this.callMode||2!==i&&(this.signalingAgentConfig.disableRealTimeModeFromRoster||1!==i)||this.setCallMode(1,t))}setCallMode(e,t){this.callMode!==e&&(this.logger.info(`[${t}][setCallMode] oldMode=${this.callMode}, newMode=${e}`),this.callMode=e,this.signalingSessionCallback.onCallModeChanged(this.callMode,t))}configureStreamingMode(e){if(2===this.callMode)return void this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT);this.logger.info(`[${e}][configureStreamingMode]`),this.setCallMode(2,e),this.cleanUpDueToStreaming(e),this.onCallStatusChanged(sr.CALL_STATUS.CONNECTED,e)}updateDominantSpeakerHistoryMessageSubscription(e){this.webRtcSignalingManager.getIsDominantSpeakerInfoLinkEnabled()!==e&&(this.logger.info(`Signaling dominant speaker history subscription updated: ${e}`),this.webRtcSignalingManager.setIsDominantSpeakerInfoLinkEnabled(e),this.webRtcSignalingManager.areClientURLsGenerated()&&this.updateKeepAliveUrl())}cleanUpDueToStreaming(e){this.setRealTimeState(0,e),this.fsmState=sr.SIGNALING_FSM_STATE.CONNECTED,this.isPromotingToRealtime=!1,this.provisionalMediaAnswersSeenSoFar=[],this.mediaRenegotiationManager?.dispose(),this.mediaRenegotiationManager=new go(this,this.signalingSessionCallback,this.telemetryHelper),this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT);let t={code:sr.CALL_END_CODE.SUCCESS,subCode:sr.CALL_END_SUB_CODE.DOWNGRADE_TO_STREAMING_CLIENT,phrase:sr.CALL_END_PHRASE.DOWNGRADE_TO_STREAMING_CLIENT},i=u3;for(let n of Object.keys(i))(0===i[n].controller||4===i[n].controller||3===i[n].controller)&&this.http.cancelRequestIfPending(i[n].name,e,void 0,t)}updateEndpointMetadata(e,t=sp()){let i={};try{i=JSON.parse(e)}catch(e){return Promise.reject("Invalid metadata")}return this.http.sendPutRequest({url:this.links[sr.LINKS.UPDATE_ENDPOINT_METADATA],requestName:u3.UPDATE_ENDPOINT_METADATA.name,payload:g6(this,i),causeId:t}).then(()=>{this.telemetryHelper.recordEvent(dK,{causeId:t})}).catch(e=>{let i=sM(e,this.signalingAgentConfig);return this.logger.info(`[${t}][updateEndpointMetadata] error: ${t_(i)}`),this.telemetryHelper.recordEvent(dQ,{...i.error}),Promise.reject(i.error)})}isOneToOnePSTNCall(){return this.signalingSessionCallback.isOneToOnePstnCall()}getLocationContent(){return this.isOneToOnePSTNCall()?sA(this.locationInfoContent):null}getNetworkContent(){return this.isOneToOnePSTNCall()?sA(this.networkInfoContent):null}getAreaContent(){return this.isOneToOnePSTNCall()?sA(this.areaContent):null}setLocationInfo(e,t,i){this.locationInfoContent=e,this.networkInfoContent=t,this.areaContent=i}setStreamInformationReceived(){this.disposed||this.streamInformationReceived||(this.streamInformationReceived=!0,this.telemetryHelper.recordEvent(uq))}getEndpointCapabilities(){let e=0;return this.signalingAgentConfig.brokerEnabledIncoming&&(e|=16),this.signalingAgentConfig.isGVCJoiningEnabled&&(e|=1),"disabled"!==this.signalingAgentConfig.cloudScreenSharingFlag&&(e|=2),this.signalingAgentConfig.supportsHostlessGroupCalls&&(e|=4),this.signalingAgentConfig.autoJoinOnConflict&&(e|=32),this.signalingAgentConfig.supportsCompressedServicePayload&&(e|=128),this.signalingAgentConfig.enableAutoPromotion&&(e|=65536),this.signalingAgentConfig.enableBatchedSendMessageStatus&&(e|=16384),this.signalingAgentConfig.enableBatchedReceiveMessage&&(e|=8192),e|=64,e|=1024,this.signalingAgent?.accountConfig?.clientSupportsAudioOnlyWatermark&&(e|=4096,this.telemetryHelper.setAudioOnlyWatermark(!0)),this.signalingAgent?.accountConfig?.clientSupportsWatermark&&(e|=2048,this.telemetryHelper.setWatermarkSupport(!0)),this.signalingAgent?.accountConfig?.clientSupportsPreventScreenCapture&&(e|=131072,this.telemetryHelper.setClientSupportsPreventScreenCapture(!0)),(this.getMaxReinvitelessMediaForVBSSForWeb()||this.getMaxReinvitelessMediaForVideoForWeb())&&(this.telemetryHelper.setReinviteless(this.callUsesMixer),e|=512),e}handleAdmitAllStatus(e){let t=e.body?.transactionResponse,i=sk(e);this.logger.info(`[${i}][handleAdmitAllStatus][${t_(t)}]`);let n=t?.operationId;if(n&&this.callOperationHandler.hasPendingOperation(0,n,i)){this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT,n);let e=t?.result?.code,r=t?.result?.subCode,s=t?.result?.resultCategories,a=t?.additionalDetail;if(0===e||e>=200&&e<300){let t={code:e,subCode:r,resultCategories:s,result:tI(a)};this.telemetryHelper.recordEvent(lb,{causeId:n,transactionEnd:t}),this.callOperationHandler.resolvePendingOperation(0,n,t,i)}else{let a={code:e||sr.CALL_END_CODE.BAD_REQUEST,subCode:r||0,resultCategories:s,result:t,phrase:sr.CALL_END_PHRASE.BAD_SERVICE_RESPONSE};this.telemetryHelper.recordEvent(lC,{causeId:n,transactionEnd:a}),this.callOperationHandler.rejectPendingOperation(0,n,"AdmitAllStatus response contains failure",a,i)}}else this.logger.warn(`[${i}][handleAdmitAllStatus] invalid admitAllStatus response or no pending operation. operationId=${n}`)}sendNetworkRequestForAdmit(e){let t=()=>{this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.ADMIT,()=>{this.telemetryHelper.recordEvent(ly,{causeId:e}),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT,e),this.callOperationHandler.rejectPendingOperation(0,e,"timed out waiting for admit operation",{code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.ADMIT_TIMEOUT,phrase:sr.CALL_END_PHRASE.ADMIT_TIMEOUT},e)},this.getTimeoutValue("admitTimeoutSec"),e)};this.http.sendPostRequest({url:this.links[sr.LINKS.ADMIT_ALL],requestName:u3.ADMIT.name,payload:gk(this,e),causeId:e,onceTrouterReady:t}).catch(t=>{let i=sM(t,this.signalingAgentConfig);this.telemetryHelper.recordEvent(lC,{causeId:e,...i.error}),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.ADMIT,e),this.callOperationHandler.rejectPendingOperation(0,e,t,i.error,e)})}getConversationType(e,t,i){return e?"emergencyGroupCall":t?"cast":i?"huddleGroupCall":null}getMaxReinvitelessMediaForVideoForWeb(){return this.signalingAgentConfig.maxReinvitelessMediaForVideoForWeb}getMaxReinvitelessMediaForVBSSForWeb(){return this.signalingAgentConfig.maxReinvitelessMediaForVBSSForWeb}convertParkType(e){return"teamPark"===e?"TransferTypeTeamPark":"sharedLinePark"===e?"TransferTypeSharedLinePark":"serverHold"===e?"TransferTypeServerHold":(this.logger.info(`convertParkType, parkType: ${e} is unknown`),"none")}parkByTransfer(e,t){this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,()=>{this.handleCallTransferTimeout(t)},this.getTimeoutValue("outgoingCallEstablishmentTimeoutSec"));let i=this.getNetworkRequestName(e);return this.http.sendPostRequest({url:this.links[sr.LINKS.TRANSFER],requestName:i,payload:gJ(e,this),causeId:t}).catch(e=>{let i=sM(e,this.signalingAgentConfig);return(this.logger.info(`[${t}][parkByTransfer] error: ${t_(i)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:sr.CALL_END_CODE.NETWORK_ERROR,reason:t_(e)}},t),this.telemetryHelper.recordEvent(dM,{causeId:t,...i.error}),Promise.reject(i.error))}),this.telemetryHelper.recordEvent(dR,{causeId:t,transferType:this.convertParkType(e)}),Promise.resolve()}park(e,t){this.logger.info(`[${t}][park] context ${e}`),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.PARK_COMPLETION,()=>{this.handleParkError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.PARK_COMPLETION_TIMEOUT,phrase:sr.CALL_END_PHRASE.PARK_COMPLETION_TIMEOUT},d3,t,e)},this.getTimeoutValue("parkCompletionTimeoutSec"));let i=this.getHoldTypeInRequest(e),n={causeId:t};return this.http.sendPostRequest({url:this.links[sr.LINKS.PARK],requestName:u3.PARK_REQUEST.name,payload:gK(this,i,n),causeId:t}).then(e=>{this.logger.info(`[${t}][park] response: ${t_(e)}`),this.telemetryHelper.recordEvent(d2,{causeId:t}),sy(e.response.holdResponse.links,"server response does not include park links"),this.links[sr.LINKS.UNPARK]=e.response.holdResponse.links.resume}).catch(i=>{let n=sM(i,this.signalingAgentConfig);return(this.logger.info(`[${t}][park] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleParkError(n.error,d1,t,e),Promise.reject(n.error))}),Promise.resolve()}getHoldTypeInRequest(e){switch(e){case"serverHoldV2":return"musicOnHold";case"sharedLineParkV2":return"sharedLineAppearance";case"callPark":return"callPark";default:return null}}handleParkError(e,t,i,n){if(this.disposed)return void this.logger.info("handleParkError ignored");this.logger.info(`[${i}] handleParkError reject reason: ${t_(e)}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.PARK_COMPLETION),this.signalingSessionCallback.onParkCompleted&&(this.telemetryHelper.recordEvent(t,{...e,parkContext:n,causeId:i}),this.signalingSessionCallback.onParkCompleted(e,i)),this.links[sr.LINKS.UNPARK]=void 0}handleParkCompletion(e){let t=e.body,i=sk(e),n=t.holdCompletion;this.handleOperationCompletionCommon(n,i,void 0,t_(t),"handleParkCompletion",sr.TIMEOUT_OPERATIONS.PARK_COMPLETION,d4,d5,this.signalingSessionCallback.onParkCompleted,this.handleParkError.bind(this))}handleUnparkError(e,t,i,n){if(this.disposed)return void this.logger.info("handleUnparkError ignored");this.logger.info(`[${i}] handleUnparkError reject reason: ${e}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.signalingSessionCallback.onUnparkCompleted&&(this.telemetryHelper.recordEvent(t,{...e,parkContext:n,causeId:i}),this.signalingSessionCallback.onUnparkCompleted(e,i)),this.links[sr.LINKS.UNPARK]=void 0}handleUnparkCompletion(e){let t=e.body,i=sk(e);if(this.disposed)return void this.logger.info(`[${i}]handleUnparkCompletion ignored`);this.logger.info(`[${i}][handleUnparkCompletion] body ${t_(t)}`);let n=t.resumeCompletion;n.code===sr.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.telemetryHelper.recordEvent(d7,{...n,causeId:i}),this.signalingSessionCallback.onUnparkCompleted(n,i),this.links[sr.LINKS.UNPARK]=void 0):this.handleUnparkError(n,ue,i)}getNetworkRequestName(e){return({none:null,teamPark:u3.SEND_PARK_REQUEST.name,sharedLinePark:u3.SEND_SHARED_LINE_PARK_REQUEST.name,serverHold:u3.SEND_SERVER_HOLD_REQUEST.name})[e]}updateMeetingsGroupsAsync(e,t){this.logger.info(`[${e}][updateMeetingsGroupsAsync] scope=${t.scope}`),this.telemetryHelper.recordEvent(ua,{causeId:e,options:t}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION,()=>{this.handleUpdateMeetingGroupsError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT,phrase:sr.CALL_END_PHRASE.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT},uh,e,e,t)},this.getTimeoutValue("updateMeetingGroupsCompletionTimeoutSec"));let i=g9(this,t,e);return this.http.sendPostRequest({url:this.links[sr.LINKS.UPDATE_MEETING_GROUPS],requestName:u3.UPDATE_MEETING_GROUPS.name,payload:i,causeId:e}).then(t=>{this.logger.info(`[${e}][updateMeetingsGroupsAsync] response: ${t_(t)}`),this.telemetryHelper.recordEvent(uh,{causeId:e})}).catch(i=>{let n=sM(i,this.signalingAgentConfig);return(this.logger.info(`[${e}][updateMeetingsGroupsAsync] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleUpdateMeetingGroupsError(n.error,ug,e,e,t),Promise.reject(n.error))})}updateMonitorSessionAsync(e,t){this.logger.info(`[${t}][updateMonitorSessionAsync]`),this.telemetryHelper.recordEvent(uZ,{causeId:t,options:e}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MONITOR_SESSION_COMPLETION,()=>{this.handleUpdateMonitorSessionError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MONITOR_SESSION_COMPLETION_TIMEOUT,phrase:sr.CALL_END_PHRASE.UPDATE_MONITOR_SESSION_COMPLETION_TIMEOUT},u2,t,e)},this.getTimeoutValue("updateMonitorSessionCompletionTimeoutSec"));let i=pt(this,e.monitorActionType,e.monitorData,t);return this.http.sendPostRequest({url:this.links[sr.LINKS.UPDATE_MONITOR_SESSION],requestName:u3.UPDATE_MONITOR_SESSION.name,payload:i,causeId:t}).then(e=>{this.logger.info(`[${t}][updateMonitorSessionAsync] response: ${t_(e)}`),this.telemetryHelper.recordEvent(u2,{causeId:t})}).catch(i=>{let n=sM(i,this.signalingAgentConfig);return(this.logger.info(`[${t}][updateMonitorSessionAsync] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleUpdateMonitorSessionError(n.error,uX,t,e),Promise.reject(n.error))})}updateParticipantInterpretationStateAsync(e,t){return sS(t,"options should be a non null value"),this.logger.info(`[${e}][updateParticipantInterpretationStateAsync]`),this.telemetryHelper.recordEvent(uo,{causeId:e,options:t}),this.participantManager.updateParticipantInterpretationStateAsync(t,this.links[sr.LINKS.UPDATE_PARTICIPANT_INTERPRETATION_STATE],e)}async sendProxiedMessageAsync(e,t){return t&&0!==t.length?this.links[sr.LINKS.SEND_MESSAGE]?this.proxiedMessageNotificationManager.sendProxiedMessageAsync(e,t,this.links[sr.LINKS.SEND_MESSAGE]):Promise.reject({code:sr.VALIDATION.VALIDATION_FAILED,subCode:sr.VALIDATION.NULL_OR_EMPTY,phrase:"missing url for CONSTANTS.LINKS.SEND_MESSAGE"}):Promise.reject({code:sr.VALIDATION.VALIDATION_FAILED,subCode:sr.VALIDATION.NULL_OR_EMPTY,phrase:"options should be a non empty array"})}async updateParticipantsPropertiesAsync(e,t,i,n){this.telemetryHelper.recordEvent(ul,{causeId:n,updateParticipantsPropertiesContext:e});let r=this.links[sr.LINKS.UPDATE_PARTICIPANTS_PROPERTIES],s=[],a=e.scope;if("self"===a){let t={id:this.participantManager.localParticipant.id,propertyBag:e.propertyBag};s.push(t)}else if("specified"!==a)return Promise.reject("This scope is not Supported");else for(let t of e.participants){let e={id:t.id,propertyBag:t.propertyBag};s.push(e)}return this.sendNetworkRequestForUpdateParticipantsProperties(s,t,r,i,n)}sendNetworkRequestForUpdateParticipantsProperties(e,t,i,n,r){let s=this.logger.createChild(`[${r}][sendNetworkRequestForUpdateParticipantsProperties]`,this.correlationId);if(i){let a=()=>{let e={code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UPDATE_PARTICIPANTS_PROPERTIES_TIMEOUT,phrase:sr.CALL_END_PHRASE.UPDATE_PARTICIPANTS_PROPERTIES_TIMEOUT};this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES_COMPLETION,()=>{this.handleUpdateParticipantsPropertiesOnTimeout(t,e,u_,n,r)},this.getTimeoutValue("updateParticipantsPropertiesCompletionTimeoutSec"),n)},o=pn(this,e,n);return this.updateParticipantsPromises[n]=t,this.http.sendPostRequest({url:i,payload:o,requestName:u3.UPDATE_PARTICIPANTS_PROPERTIES.name,onceTrouterReady:a,causeId:r}).then(e=>{s.info(`response: ${t_(e)}`)}).catch(e=>{let t=sM(e,this.signalingAgentConfig);s.info(`failed: ${t_(t)}`);let i={...t.error};return this.disposed||(this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES_COMPLETION,n),delete this.updateParticipantsPromises[n]),this.telemetryHelper.recordEvent(uI,{causeId:r,transactionEnd:i}),Promise.reject(i)})}{let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_PARTICIPANTS_PROPERTIES_LINK_MISSING,phrase:"updateParticipantsProperties link is missing"};return s.warn(e),this.telemetryHelper.recordEvent(uI,{causeId:r,error:e}),Promise.reject(e)}}checkAndCleanupPromisesForOperationId(e){this.updateParticipantsPromises[e]&&(0===this.updateParticipantsPromises[e].size?(delete this.updateParticipantsPromises[e],this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES_COMPLETION,e)):this.logger.info(`remaining promises for the operation  ${e} (count: ${this.updateParticipantsPromises[e].size}):
                ${this.piiUtils.scrubMriOrOmit(tI(this.updateParticipantsPromises[e]))}`))}handleUpdateParticipantsPropertiesOnTimeout(e,t,i,n,r){if(this.disposed)return void this.logger.info("handleUpdateParticipantsPropertiesOnTimeout ignored");this.logger.createChild(`[${r}][handleUpdateParticipantsPropertiesOnTimeout]`,this.correlationId).info(`reason: ${t}`),this.telemetryHelper.recordEvent(i,{...t,causeId:r});let s={};e.forEach(e=>{s[e]=t,this.updateParticipantsPromises[n].delete(e)}),this.checkAndCleanupPromisesForOperationId(n),this.signalingSessionCallback.onUpdateParticipantsPropertiesCompleted(s,n,r)}joinMeetingGroupAsync(e,t){this.logger.info(`[${e}][joinMeetingGroupAsync]`),this.telemetryHelper.recordEvent(uc,{causeId:e,options:t}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION,()=>{this.handleJoinMeetingGroupError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.JOIN_MEETING_GROUP_TIMEOUT,phrase:sr.CALL_END_PHRASE.JOIN_MEETING_GROUP_TIMEOUT},uP,e,e,t)},this.getTimeoutValue("joinMeetingGroupCompletionTimeoutSec"));let i=gq(this,t,e);return this.http.sendPostRequest({url:this.links[sr.LINKS.JOIN_MEETING_GROUP],requestName:u3.JOIN_MEETING_GROUP.name,payload:i,causeId:e}).then(t=>{this.logger.info(`[${e}][joinMeetingGroupAsync] response: ${t_(t)}`),this.telemetryHelper.recordEvent(uP,{causeId:e})}).catch(i=>{let n=sM(i,this.signalingAgentConfig);return(this.logger.info(`[${e}][joinMeetingGroupAsync] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleJoinMeetingGroupError(n.error,uR,e,e,t),Promise.reject(n.error))})}leaveMeetingGroupAsync(e,t){this.logger.info(`[${e}][leaveMeetingGroupAsync]`),this.telemetryHelper.recordEvent(ud,{causeId:e,options:t}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION,()=>{this.handleLeaveMeetingGroupError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.LEAVE_MEETING_GROUP_TIMEOUT,phrase:sr.CALL_END_PHRASE.LEAVE_MEETING_GROUP_TIMEOUT},uD,e,e,t)},this.getTimeoutValue("leaveMeetingGroupCompletionTimeoutSec"));let i=gG(this,t,e);return this.http.sendPostRequest({url:this.links[sr.LINKS.LEAVE_MEETING_GROUP],requestName:u3.LEAVE_MEETING_GROUP.name,payload:i,causeId:e}).then(t=>{this.logger.info(`[${e}][leaveMeetingGroupAsync] response: ${t_(t)}`),this.telemetryHelper.recordEvent(uD,{causeId:e})}).catch(i=>{let n=sM(i,this.signalingAgentConfig);return(this.logger.info(`[${e}][leaveMeetingGroupAsync] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleLeaveMeetingGroupError(n.error,uO,e,e,t),Promise.reject(n.error))})}handleUpdateMeetingGroupsError(e,t,i,n,r){if(this.disposed)return void this.logger.info(`[${i}][handleUpdateMeetingGroupsError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleUpdateMeetingGroupsError] reject reason: ${JSON.stringify(e)}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION),this.telemetryHelper.recordEvent(t,{...e,updateMeetingGroupsOptions:r,causeId:i}),this.signalingSessionCallback.onUpdateMeetingGroupsCompleted(e,i,n)}handleUpdateMeetingGroupsCompletion(e){let t=e.body,i=sk(e),n=t.updateMeetingGroupsResponse.operationId;if(this.disposed)return void this.logger.info(`[${i}][handleUpdateMeetingGroupsCompletion] ignored. Call disposed.`);n||this.logger.warn(`[${i}][handleUpdateMeetingGroupsCompletion] operationId is undefined.`),this.logger.info(`[${i}][handleUpdateMeetingGroupsCompletion] starts`);let{updateMeetingGroupsResponse:r}=t,s=hO(r);s.code===sr.TRANSACTION_END_CODE.SUCCESS?(this.logger.info(`[${i}][handleUpdateMeetingGroupsCompletion] update meeting group succeeded`),this.telemetryHelper.recordEvent(uf,{...s,causeId:i})):(this.logger.info(`[${i}][handleUpdateMeetingGroupsCompletion] update meeting group failed code=${s.code} subCode=${s.subCode}`),this.telemetryHelper.recordEvent(up,{...s,causeId:i})),this.logger.info(`[${i}][handleUpdateMeetingGroupsCompletion] completes`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION),this.signalingSessionCallback.onUpdateMeetingGroupsCompleted(s,i,n)}handleJoinMeetingGroupError(e,t,i,n,r){if(this.disposed)return void this.logger.info(`[${i}][handleJoinedMeetingGroupError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleJoinedMeetingGroupError] reject reason: ${JSON.stringify(e)}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION),this.telemetryHelper.recordEvent(t,{...e,joinMeetingGroupOptions:r,causeId:i}),this.signalingSessionCallback.onJoinMeetingGroupCompleted(e,i,n)}handleJoinMeetingGroupCompletion(e){let t=e.body.joinMeetingGroupResponse,i=sk(e),n=t.operationId;if(this.disposed)return void this.logger.info(`[${i}][handleJoinMeetingGroupCompletion] ignored. Call disposed.`);n||this.logger.warn(`[${i}][handleJoinMeetingGroupCompletion] operationId is undefined.`),this.logger.info(`[${i}][handleJoinMeetingGroupCompletion] starts`);let r=hO(t);r.code===sr.TRANSACTION_END_CODE.SUCCESS?(this.logger.info(`[${i}][handleJoinMeetingGroupCompletion] join meeting group succeeded`),this.telemetryHelper.recordEvent(uM,{...r,causeId:i})):(this.logger.info(`[${i}][handleJoinMeetingGroupCompletion] join meeting group failed code=${r.code} subCode=${r.subCode}`),this.telemetryHelper.recordEvent(uA,{...r,causeId:i})),this.logger.info(`[${i}][handleJoinMeetingGroupCompletion] complete`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION),this.signalingSessionCallback.onJoinMeetingGroupCompleted(r,i,n)}handleLeaveMeetingGroupError(e,t,i,n,r){if(this.disposed)return void this.logger.info(`[${i}][handleLeaveMeetingGroupError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleLeaveMeetingGroupError] reject reason: ${JSON.stringify(e)}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION),this.telemetryHelper.recordEvent(t,{...e,leaveMeetingGroupOptions:r,causeId:i}),this.signalingSessionCallback.onLeaveMeetingGroupCompleted(e,i,n)}handleLeaveMeetingGroupCompletion(e){let t=e.body.leaveMeetingGroupResponse,i=sk(e),n=t.operationId;if(this.disposed)return void this.logger.info(`[${i}][handleLeaveMeetingGroupCompletion] ignored. Call disposed.`);n||this.logger.warn(`[${i}][handleLeaveMeetingGroupCompletion] operationId is undefined.`),this.logger.info(`[${i}][handleLeaveMeetingGroupCompletion] starts`);let r=hO(t);r.code===sr.TRANSACTION_END_CODE.SUCCESS?(this.logger.info(`[${i}][handleLeaveMeetingGroupCompletion] leave meeting group succeeded`),this.telemetryHelper.recordEvent(uN,{...r,causeId:i})):(this.logger.info(`[${i}][handleLeaveMeetingGroupCompletion] leave meeting group failed code=${r.code} subCode=${r.subCode}`),this.telemetryHelper.recordEvent(uk,{...r,causeId:i})),this.logger.info(`[${i}][handleLeaveMeetingGroupCompletion] complete`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION),this.signalingSessionCallback.onLeaveMeetingGroupCompleted(r,i,n)}handleDisablePreheatError(e,t,i){if(this.disposed)return void this.logger.info(`[${i}][handleDisablePreheatError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleDisablePreheatError] reject reason: ${JSON.stringify(e)}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.DISABLE_PREHEAT_ASYNC_TIMEOUT),this.telemetryHelper.recordEvent(t,{...e,causeId:i}),this.disablePreheatDefer.isPending()&&this.disablePreheatDefer.reject(e)}handleDisablePreheatCompletion(e){let t=e.body,i=sk(e),n=t.transactionEnd;if(this.disposed)return void this.logger.info(`[${i}][handleDisablePreheatCompletion] ignored. Call disposed.`);if(!this.disablePreheatDefer.isPending())return void this.logger.info(`[${i}][handleDisablePreheatCompletion] ignored. Disable preheat promise is resolved/rejected.`);if(this.logger.info(`[${i}][handleDisablePreheatCompletion] starts`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.DISABLE_PREHEAT_ASYNC_TIMEOUT),n.code===sr.TRANSACTION_END_CODE.SUCCESS)this.logger.info(`[${i}][handleDisablePreheatCompletion] update endpoint state succeeded`),this.handleEndpointStateUpdated(i,!0);else if(this.logger.info(`[${i}][handleDisablePreheatCompletion] update endpoint state failed code=${n.code} subCode=${n.subCode}`),this.disablePreheatDefer.isPending()){let e={response:n};this.disablePreheatDefer.reject(e)}}handleReceiveMessage(e){let t,i=sk(e);if(this.disposed)return void this.logger.info(`[${i}][handleReceiveMessage] ignored. Call disposed.`);t=Array.isArray(e.body?.messageContent)?e.body.messageContent:[e.body];let n="",r=[];for(let e=0;e<t.length;e++){let i=t[e];n+=i?.operationId,e<t.length-1&&(n+=","),r.push({operationId:i.operationId,messageType:i.type,payload:i.payload,from:{[i.from.id]:{participantLegIdMap:{[i.from.participantId]:{...i.from.endpointId&&{endpointId:i.from.endpointId}}},level:"endpoint"}}})}this.logger.info(`[${i}][handleReceiveMessage] complete. OperationIds:${n}`),this.telemetryHelper.recordEvent(uu,{causeId:i,operationIds:n}),this.signalingSessionCallback.onIncomingProxiedMessages(r,i)}publishStateAsync(e,t,i,n,r,s){this.logger.info(`[${i}][publishStateAsync][publishType=${e} publishLevel=${t}]`),this.telemetryHelper.recordEvent(dj,{causeId:i,publishType:e,publishLevel:t});let a=this.links[sr.LINKS.PUBLISH_STATE];if(!a){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.PUBLISH_STATE_LINK_MISSING,phrase:"publish state link is missing"};return this.logger.warn(e),Promise.reject(e)}let o={};try{o=JSON.parse(n)}catch(t){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_CONTENT,phrase:"publish state content is invalid"};return this.logger.warn(e),Promise.reject(e)}return this.http.sendPostRequest({url:a,requestName:u3.PUBLISH_STATE.name,payload:gY(this,e,t,o,r,s),causeId:i,requestId:i}).then(e=>{if(e?.response?.publishStateResponse)return this.parsePublishStateResult(e,i);{let t=`Invalid CS response which does not contains publishStateResponse. Respone: ${e?.response?JSON.stringify(e.response):"no response"}`;throw this.logger.warn(t),{response:{code:sr.CALL_END_CODE.DECODING_FAILED,subCode:sr.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:t}}}}).catch(e=>{let t=sM(e,this.signalingAgentConfig);this.logger.info(`[${i}][publishStateAsync] error: ${t_(t)}`);let n=t.error;return this.telemetryHelper.recordEvent(dq,{causeId:i,transactionEnd:n}),Promise.reject(n)})}getPublishStateSequenceNumber(){return++this.publishStateSequenceNumber}getMonitorSequenceId(){return++this.monitorSequenceId}parsePublishStateResult(e,t){let i={};if(e?.response?.publishStateResponse){if(e.response.publishStateResponse.stateId)return e.response.publishStateResponse.stateId;else if(e.response.publishStateResponse.results){if(1===e.response.publishStateResponse.results.length)if(e.response.publishStateResponse.results[0].stateId)return e.response.publishStateResponse.results[0].stateId;else this.logger.warn("invalid response format");return e.response.publishStateResponse.results.forEach(e=>{i[e.participantId]={code:e.result.code,phrase:e.result.phrase,subCode:e.result.subCode}}),JSON.stringify(i)}else if(e.response.publishStateResponse.result)return JSON.stringify(i={code:e.response.publishStateResponse.result.code,phrase:e.response.publishStateResponse.result.phrase,subCode:e.response.publishStateResponse.result.subCode,result:e.response.publishStateResponse.additionalDetail})}let n=e?.response?JSON.stringify(e.response):"no response",r=`Invalid CS response which does not contains publishStateResponse. Respone: ${n}`;throw this.logger.warn(r),{response:{code:sr.CALL_END_CODE.DECODING_FAILED,subCode:sr.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:r}}}removeStateAsync(e,t,i,n){if(this.logger.info(`[${e}][removeStateAsync][scope=${t} publishType=${i} stateIds=${n}]`),this.telemetryHelper.recordEvent(dW,{causeId:e,scope:t,publishType:i,stateIds:n}),!i&&!n){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.REMOVE_STATE_MISSING_ARGUMENTS,phrase:"remove state operation miss arguments"};return this.logger.warn(e),Promise.reject(e)}let r=this.links[sr.LINKS.REMOVE_STATE];if(!r){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.REMOVE_STATE_LINK_MISSING,phrase:"remove state link is missing"};return this.logger.warn(e),Promise.reject(e)}return this.http.sendPostRequest({url:r,requestName:u3.REMOVE_STATE.name,payload:gX(this,t,n,i),causeId:e,requestId:e}).then(t=>this.parseRemoveStateResult(t,e)).catch(t=>{let i=sM(t,this.signalingAgentConfig);this.logger.info(`[${e}][removeStateAsync] error: ${t_(i)}`);let n=i.error;return this.telemetryHelper.recordEvent(dG,{causeId:e,transactionEnd:n}),Promise.reject(n)})}parseRemoveStateResult(e,t){let i={};return e?.response?.removeStateResponse&&(e.response.removeStateResponse.results?e.response.removeStateResponse.results.forEach(e=>{i[e.stateId]={code:e.result.code,phrase:e.result.phrase,subCode:e.result.subCode}}):e.response.removeStateResponse.result&&(i={code:e.response.removeStateResponse.result.code,phrase:e.response.removeStateResponse.result.phrase,subCode:e.response.removeStateResponse.result.subCode,result:e.response.removeStateResponse.additionalDetail})),JSON.stringify(i)}updateMeetingSettingsAsync(e,t){this.telemetryHelper.recordEvent(dz,{causeId:t,meetingSettings:e});let i=this.links[sr.LINKS.UPDATE_MEETING_SETTINGS];if(!i){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_LINK_MISSING,phrase:"update meeting settings link is missing"};return this.logger.warn(e),Promise.reject(e)}if(!Object.keys(e).length){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS,phrase:"update meeting settings missing arguments"};return this.logger.warn(e),Promise.reject(e)}return this.http.sendPutRequest({url:i,requestName:u3.UPDATE_MEETING_SETTINGS.name,payload:pe(this,e),causeId:t,requestId:t}).then(()=>{hy.noop()}).catch(e=>{let i=sM(e,this.signalingAgentConfig);this.logger.info(`[${t}][updateMeetingSettingsAsync] error: ${t_(i)}`);let n=i.error;throw this.telemetryHelper.recordEvent(dJ,{causeId:t,transactionEnd:n}),n})}searchParticipantsAsync(e,t){this.logger.info(`[${t}][searchParticipantsAsync][queryOptions=${e}]`),this.telemetryHelper.recordEvent(dY,{causeId:t,queryOptions:e});let i=this.links[sr.LINKS.SEARCH_PARTICIPANTS];if(!i){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_LINK_MISSING,phrase:"search participants link is missing"};return this.logger.warn(e),Promise.reject(e)}return this.http.sendPostRequest({url:i,requestName:u3.SEARCH_PARTICIPANTS.name,payload:g0(this,e),causeId:t,requestId:t}).then(e=>{if(e?.response?.participants)return this.parseSearchParticipantsResult(e,t);{let t=e?.response?JSON.stringify(e.response):"no response",i=`Invalid CS response which does not contain proper search results. Respone: ${t}`;throw this.logger.warn(i),{response:{code:sr.CALL_END_CODE.DECODING_FAILED,subCode:sr.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:i}}}}).catch(e=>{let i=sM(e,this.signalingAgentConfig);this.logger.info(`[${t}][searchParticipantsAsync] error: ${t_(i)}`);let n=i.error;return this.telemetryHelper.recordEvent(dX,{causeId:t,transactionEnd:n}),Promise.reject(n)})}parseSearchParticipantsResult(e,t){let i=[];if(e?.response){let t=e.response.participants;if(t)for(let n of Object.keys(t))i.push(o8.fromRosterSearchResults(e.response.participants[n]))}return{participants:i}}getAllParticipantsAsync(e,t){this.logger.info(`[${t}][getAllParticipantsAsync][scope=${e}]`),this.telemetryHelper.recordEvent(dZ,{causeId:t,scope:e});let i=this.links[sr.LINKS.GET_ALL_PARTICIPANTS];if(!i){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_LINK_MISSING,phrase:"get all participants link is missing"};return this.logger.warn(e),Promise.reject(e)}if("lobby"!==e){let e={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SCOPE,phrase:"get all participants scope is invalid"};return this.logger.warn(e),Promise.reject(e)}return this.http.sendPostRequest({url:i,requestName:u3.GET_ALL_PARTICIPANTS.name,payload:gH(this,e),causeId:t,requestId:t}).then(e=>{if(e?.response)return{participants:e.response.participants};{let e="Invalid CS response which does not contain results.";throw this.logger.warn(e),{response:{code:sr.CALL_END_CODE.DECODING_FAILED,subCode:sr.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:e}}}}).catch(e=>{let i=sM(e,this.signalingAgentConfig);this.logger.info(`[${t}][getAllParticipantsAsync] error: ${t_(i)}`);let n=i.error;return this.telemetryHelper.recordEvent(d0,{causeId:t,transactionEnd:n}),Promise.reject(n)})}resetState(){this.currentCallStatus=null,this.fsmState=sr.SIGNALING_FSM_STATE.IDLE}saveUpdatedCallLinksIfAny(e){e.links&&(this.logger.info(`saveUpdatedCallLinksIfAny, updated call links found, update to new links ${t_(e)}`),this.links[sr.LINKS.MEDIA_RENEGOTIATION]=e.links.mediaRenegotiation||this.links[sr.LINKS.MEDIA_RENEGOTIATION],this.links[sr.LINKS.TRANSFER]=e.links.transfer||this.links[sr.LINKS.TRANSFER],this.links[sr.LINKS.REPLACE]=e.links.replacement||this.links[sr.LINKS.REPLACE],this.links[sr.LINKS.HANGUP]=e.links.callLeg||this.links[sr.LINKS.HANGUP],this.links[sr.LINKS.KEEPALIVE]=e.links.callLeg||this.links[sr.LINKS.KEEPALIVE],this.links[sr.LINKS.PARK]=e.links.hold||this.links[sr.LINKS.PARK],this.links[sr.LINKS.UPDATE_MEDIA_DESCRIPTIONS]=e.links.updateMediaDescriptions||this.links[sr.LINKS.UPDATE_MEDIA_DESCRIPTIONS],this.links[sr.LINKS.UPDATE_MONITOR_SESSION]=e.links.monitor||this.links[sr.LINKS.UPDATE_MONITOR_SESSION])}ensureMessageChannelReady(e){return this.disposed?(this.logger.info("ensureMessageChannelReady: error: call already disposed"),Promise.reject(this.getCallNotFoundTransactionEnd())):this.brokerService?(this.telemetryHelper.addTrouterWaitOperation(`${ho.STARTED}:${e}`),this.telemetryHelper.addTrouterWaitOperation(`${ho.ENDED}:${e}`),Promise.resolve()):this.ensureLatestTrouterUrl(e)}ensureLatestTrouterUrl(e){return this.telemetryHelper.addTrouterWaitOperation(`${ho.STARTED}:${e}`),this.getTrouterUrlAsync().then(t=>t&&("string"!=typeof t||t.trim())?this.disposed?(this.logger.info("ensureLatestTrouterUrl, trouterUrlGetter returned too late. Object is already disposed"),Promise.reject(this.getCallNotFoundTransactionEnd())):(this.telemetryHelper.addTrouterWaitOperation(`${ho.ENDED}:${e}`),this.baseMessagingChannelUrl=this.currentTrouterUrl=t,Promise.resolve()):(this.telemetryHelper.recordEvent(co),this.telemetryHelper.addTrouterWaitOperation(`${ho.ENDED}:${e}`),Promise.reject(Error("Invalid trouter url")))).catch(t=>(this.disposed||this.telemetryHelper.addTrouterWaitOperation(`${ho.FAILED}:${e}`),this.logger.info(`ensureLatestTrouterUrl, failed because:${t}`),Promise.reject(t)))}signalTransferAcceptedAsync(e,t=sp()){return(this.logger.info(`[signalTransferAcceptedAsync][${t}] transferType ${e}`),this.disposed)?(this.logger.info(`[signalTransferAcceptedAsync][${t}] Call already ended, skip acceptance request`),Promise.reject({code:sr.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(this.telemetryHelper.recordEvent(dD,{causeId:t,transferType:e}),this.http.sendPostRequest({url:this.links[sr.LINKS.TRANSFER_ACCEPTANCE],requestName:u3.TRANSFER_ACCEPTANCE.name,payload:g2(),causeId:t}).catch(e=>{let i=sM(e,this.signalingAgentConfig);return this.logger.info(`[signalTransferAcceptedAsync][${t}] error: ${t_(i)}`),this.telemetryHelper.recordEvent(dO,{causeId:t}),Promise.reject(i.error)}))}signalTransferCompletedAsync(e,t=sp()){return(this.logger.info(`[signalTransferCompletedAsync][${t}] rejectReason ${e}`),this.disposed)?(this.logger.info(`[signalTransferCompletedAsync][${t}]  Call already ended by transferor, skip completion request`),Promise.reject({code:sr.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(0!==e.code?this.telemetryHelper.recordEvent(cH,{code:e.code,subcode:e.subCode,causeId:t}):this.telemetryHelper.recordEvent(dF,{causeId:t}),this.telemetryHelper.recordEvent(dU,{causeId:t}),this.http.sendPostRequest({url:this.links[sr.LINKS.TRANSFER_COMPLETION],requestName:u3.TRANSFER_COMPLETION.name,payload:g4(e),causeId:t}).catch(e=>{this.telemetryHelper.recordEvent(d$,{causeId:t});let i=sM(e,this.signalingAgentConfig);return this.logger.info(`[signalTransferCompletedAsync][${t}] error: ${t_(i)}`),Promise.reject(i.error)}))}async rejectCallWithFetchAndKeepAlive(e){this.telemetryHelper.recordEvent(l1,{causeId:e});let t={code:sr.CALL_END_CODE.REJECT,subCode:sr.CALL_END_SUB_CODE.BEACON,phrase:sr.CALL_END_PHRASE.LOCAL_USER_INITIATED,resultCategories:[rU]};await this.http.sendDeleteRequest({url:this.links[sr.LINKS.REJECT],requestName:u3.REJECT_CALL.name,payload:gZ(this,t),causeId:e??sp(),requestId:sm(),keepAlive:!0})}async endCallWithFetchAndKeepAlive(e,t,i,n){this.telemetryHelper.recordEvent(l2,{causeId:n}),await this.http.sendPostRequest({url:e,requestName:u3.END_CALL.name,payload:t,causeId:n??sp(),requestId:sm(),keepAlive:!0})}endWithBeacon(e){if(this.disposed)return!1;let t=()=>{this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,e,i),this.dispose(i,e)};if(this.signalingAgentConfig.enableFetchRequestWithKeepAlive&&window.Request?.prototype?.hasOwnProperty("keepalive")&&this.currentCallStatus===sr.CALL_STATUS.RINGING)return this.rejectCallWithFetchAndKeepAlive(e),t(),!0;let i={code:sr.CALL_END_CODE.SUCCESS,subCode:sr.CALL_END_SUB_CODE.BEACON,phrase:sr.CALL_END_PHRASE.LOCAL_USER_INITIATED},n=JSON.stringify(gW(this,i).payload),r=-1===this.links[sr.LINKS.LEAVE].indexOf("?")?"?":"&",s=this.signalingAgent?.authTokenManager?.getLastTokenType(e),a=this.signalingAgent?.authTokenManager?.getLastToken(e),o="";switch(s){case 4:case 8:this.logger.info(`[endWithBeacon] with tokenType:${s},token size:${a.length},query parameter:access_token`),o=`${this.links[sr.LINKS.LEAVE]}${r}access_token=${a}`;break;default:this.logger.info(`[endWithBeacon] with tokenType:${s},token size:${a.length},query parameter:skypeToken`),o=`${this.links[sr.LINKS.LEAVE]}${r}skypeToken=${a}`}return this.signalingAgentConfig.enableFetchApiForBeacon&&window.Request?.prototype?.hasOwnProperty("keepalive")?(this.endCallWithFetchAndKeepAlive(o,n,i,e),t(),!0):!!navigator?.sendBeacon&&(this.telemetryHelper.recordEvent(l0,{causeId:e}),navigator.sendBeacon(o,n))}setFsmState(e){this.fsmState=e}setIsHostless(e,t){let i=!!e;this.isHostLessCall!==i&&(this.logger.info(`[${t}][setIsHostless] isHostless=${i}`),this.isHostLessCall=i)}hasGroupModality(){return this.threadId||this.groupId}processConversationServiceResponseHeaders(e,t){this.logger.info(`[${t}][processConversationServiceResponseHeaders]`);try{let i=e.request.headers[sr.HEADERS.CORRELATION_ID]||e.request.headers[sr.HEADERS.CORRELATION_ID.toLowerCase()];this.updateCorrelationId(i,t)}catch(e){this.logger.info(`[${t}][processConversationServiceResponseHeaders] failed, reason=${t_(e)}`)}}processConversationServiceResponse(e,t,i){let n=this.logger.createChild(`[${t}][processConversationServiceResponse]`);if(n.info(`responseType :${i}`),this.processConversationServiceUpdate(e,t),e.subscriptionDetails?.selfParticipant){let i=o8.fromRoster(e.subscriptionDetails.selfParticipant,!0);n.info("converted selfParticipant to Participant type"),this.participantManager.updateLocalParticipantFromSubscribe(i,t)}e.selfParticipant?.enableCaptcha&&this.participantManager.setEnableCaptcha(!0,t),this.handleBrokerSubscription(e,t),e.roster&&this.internalHandleRosterUpdate(e.roster,!0,t),0===i&&(this.startOrJoinConvResponseReceived=!0,this.handlePendingEndpointState(t))}processConversationServiceUpdate(e,t){let i=this.logger.createChild(`[${t}][processConversationServiceUpdate]`);i.info(),this.convJoined=!0;let n=e.sequenceNumber>=0?e.sequenceNumber:-1;if(n<this.updateSequenceNumber)return void i.info(`seqNum=${n} is less than latest seqNum=${this.updateSequenceNumber}`);this.updateSequenceNumber=n,this.links[sr.LINKS.CONVERSATION_CONTROLLER]=e.conversationController,this.links[sr.LINKS.ADD_PARTICIPANT]=e.links.addParticipant,this.links[sr.LINKS.ADD_PARTICIPANTS_AND_MODALITY]=e.links.addParticipantAndModality,this.links[sr.LINKS.LEAVE]=e.links.leave,this.links[sr.LINKS.NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[sr.LINKS.REMOVE_PARTICIPANT]=e.links.removeParticipant,this.links[sr.LINKS.ADD_MODALITY]=e.links.addModality,this.links[sr.LINKS.REMOVE_MODALITY]=e.links.removeModality,this.links[sr.LINKS.MUTE]=e.links.mute||null,this.links[sr.LINKS.UNMUTE]=e.links.unmute||null,this.links[sr.LINKS.ADMIT]=e.links.admit||null,this.links[sr.LINKS.ADMIT_ALL]=e.links.admitAll||null,this.links[sr.LINKS.UPDATE_ENDPOINT_STATE]=e.links.updateEndpointState||null,this.links[sr.LINKS.UPDATE_ENDPOINT_METADATA]=e.links.updateEndpointMetadata||null,this.links[sr.LINKS.UPDATE_PARTICIPANT_ROLE]=e.links.updateParticipantRole||null,this.links[sr.LINKS.PUBLISH_STATE]=e.links.publishState||null,this.links[sr.LINKS.REMOVE_STATE]=e.links.removeState||null,this.links[sr.LINKS.UPDATE_MEETING_SETTINGS]=e.links.updateMeetingSettings||null,this.links[sr.LINKS.SEARCH_PARTICIPANTS]=e.links.searchParticipants||null,this.links[sr.LINKS.GET_ALL_PARTICIPANTS]=e.links.getAllParticipants||null,this.links[sr.LINKS.UPDATE_MEETING_LIVE_STATE]=e.links.updateMeetingLiveState||null,this.links[sr.LINKS.UPDATE_MEETING_GROUPS]=e.links.updateMeetingGroups||null,this.links[sr.LINKS.SET_MEETING_LAYOUT]=e.links.setMeetingLayout||null,this.links[sr.LINKS.UPDATE_PARTICIPANT_INTERPRETATION_STATE]=e.links.updateParticipantInterpretationState||null,this.links[sr.LINKS.UPDATE_PARTICIPANTS_PROPERTIES]=e.links.updateParticipantProperties||null,this.links[sr.LINKS.JOIN_MEETING_GROUP]=e.links.joinMeetingGroup||null,this.links[sr.LINKS.LEAVE_MEETING_GROUP]=e.links.leaveMeetingGroup||null,this.links[sr.LINKS.SEND_MESSAGE]=e.links.sendMessage||null,this.links[sr.LINKS.UPDATE_MEETING_STATES]=e.links.updateMeetingStates||null,this.convSubject=e.subject,e.state&&(this.setMultiParty(e.state.isMultiParty,t),this.setIsHostless(e.state.isHostless||!1,t),this.conversationType=e.state.conversationType,this.isCastCall="cast"===e.state.conversationType,this.isHuddleGroupCall="huddleGroupCall"===e.state.conversationType),e.activeModalities&&e.activeModalities.groupChat&&this.updateGroupChatIds(e.activeModalities.groupChat,t),e.activeModalities&&e.activeModalities.broadcast&&(this.broadcastSession||(this.broadcastSession=new hN(this,this.signalingSessionCallback)),this.broadcastSession.handleBroadcastDetailsChanged(e,t)),this.handleMeetingDetailsChanged(e,t),this.handleMeetingStatesChanged(e,t),this.linkUpdateRequested.conversationLinks?(i.info("Updating CS links as requested"),this.updateLinks(this.updateConversationLinks,t)):this.scheduleConversationKeepAlive(),e.meetingData&&(this.meetingData=e.meetingData),e.meetingInfo&&(this.meetingInfo=e.meetingInfo),e.region&&(this.region=e.region),e.callLimits&&(this.callLimits=e.callLimits),e.complianceRecordingContent&&(this.complianceRecordingContent=e.complianceRecordingContent),e.conversationStartTime&&(this.conversationStartTime=e.conversationStartTime),e.layoutDetails&&(this.meetingLayoutDetails=e.layoutDetails),e.compositionServiceDetails&&(this.compositionServiceDetails=e.compositionServiceDetails),this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,groupId:this.groupId,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo,callLimits:this.callLimits,complianceRecordingContent:this.complianceRecordingContent,conversationStartTime:this.conversationStartTime,isHuddleGroupCall:this.isHuddleGroupCall,backroomThreadId:this.backroomThreadId,streamThreadId:this.streamThreadId,lobbyThreadId:this.lobbyThreadId,meetingLayoutDetails:this.meetingLayoutDetails,compositionServiceDetails:this.compositionServiceDetails},t)}processLocalParticipantUpdateResponse(e,t){this.logger.info(`[${t}][processLocalParticipantUpdateResponse]`),e.sequenceNumber&&e.sequenceNumber<this.localParticipantUpdateSequenceNumber||(this.breakoutDetails=e.breakoutDetails||{},this.signalingSessionCallback.onBreakoutDetailsUpdated(this.breakoutDetails,t),!0===e.nudgeToJoinAsRealtime&&(this.telemetryHelper.recordEvent(uz,{causeId:t}),this.signalingSessionCallback.onNudgeToJoinRealtime(t)))}handlePendingEndpointState(e){this.requestedEndpointStateWhileConnecting&&(this.logger.info(`[${e}][handlePendingEndpointState]sending pending endpoint state now that we are connected.`),this.updateEndpointState(this.requestedEndpointStateWhileConnecting,e,this.requestedPublishedStatesWhileConnecting).catch(e=>{this.isPreheatOnly&&this.disablePreheatDefer.isPending()&&(this.logger.info("handlePendingEndpointState failed"),this.disablePreheatDefer.reject(e))}))}handleMeetingDetailsChanged(e,t){this.logger.info(`[${t}][handleMeetingDetailsChanged]`),e.meetingDetails&&!hy.isEqual(e.meetingDetails,this.meetingDetails)&&this.signalingSessionCallback.onMeetingDetailsUpdated&&(this.meetingDetails=e.meetingDetails,this.meetingDetails.meetingCapability?.meetingLiveState&&(this.meetingLiveStateSequenceNumber=this.meetingDetails.meetingCapability.meetingLiveState.seqNum,this.logger.info(`[${t}][handleMeetingDetailsChanged] update meeting seqNum as ${this.meetingLiveStateSequenceNumber}`)),this.signalingSessionCallback.onMeetingDetailsUpdated(this.meetingDetails,t))}handleMeetingStatesChanged(e,t){this.logger.info(`[${t}][handleMeetingStatesChanged]`),this.signalingSessionCallback.onMeetingStatesUpdated&&this.signalingSessionCallback.onMeetingStatesUpdated(e.meetingStates,t)}handleBrokerSubscription(e,t){this.logger.info(`[${t}][handleBrokerSubscription]`),e.links.subscribe?(this.telemetryHelper.recordEvent(ux,t),this.brokerService&&!hy.isEqual(e.links.subscribe,this.brokerService.currentSubscriptionUrl)?this.brokerService.subscribeToBroker(e.links.subscribe):(this.logger.info(`[${t}][handleBrokerSubscription] broker subscribe ignored. Broker is disabled or subscribe url is same.`),this.telemetryHelper.recordEvent(c4,t))):this.telemetryHelper.recordEvent(uL,t)}cancelOutgoingCall(e,t){let i=sV();this.logger.info(`[${t}][cancelOutgoingCall][rejectionData=${e&&t_(e)}]`);let n={code:isNaN(e?.code)?sr.CALL_END_CODE.CANCEL:e.code,subCode:e?.subCode||sr.CALL_END_SUB_CODE.SUCCESS,phrase:e?.phrase||sr.CALL_END_PHRASE.LOCAL_USER_INITIATED,resultCategories:e?.resultCategories||[rU],clientReasonSubCode:e?.clientReasonSubCode,clientReasonPhrase:e?.clientReasonPhrase};if(this.signalingAgentConfig.enableSpecificErrorCodesForCallEnd&&(n.code=sr.CALL_END_CODE.CANCEL,n.subCode=sr.CALL_END_SUB_CODE.SUCCESS,n.phrase=sr.CALL_END_PHRASE.LOCAL_USER_INITIATED,n.resultCategories=[rU]),this.links.hasOwnProperty(sr.LINKS.LEAVE)){this.logger.info(`[${t}][cancelOutgoingCall] cancelling outgoing call`),this.fsmState=sr.SIGNALING_FSM_STATE.IDLE;let e={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()},r={terminatingEnd:hi.LOCAL,resultDetail:n.phrase||"CancelOutgoingCall",endCode:n.code,endSubCode:n.subCode,causeId:t,clientReasonSubCode:n.clientReasonSubCode,clientReasonPhrase:n.clientReasonPhrase,resultCategories:n.resultCategories};this.http.sendPostRequest({url:this.links[sr.LINKS.LEAVE],requestName:u3.CANCEL_CALL.name,payload:g$(this,n,e),causeId:t}).then(e=>{this.disposed||(this.telemetryHelper.setTerminatingData(r),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,n),this.dispose(n,t)),i.resolve(null)}).catch(e=>{let s=sM(e,this.signalingAgentConfig);this.logger.info(`[cancelOutgoingCall][${t}] error: ${t_(e)} xhrError: ${t_(s)}`),this.disposed||(this.telemetryHelper.setTerminatingData(r),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,n),this.dispose(n,t)),i.resolve(null)})}else this.logger.info(`[${t}][cancelOutgoingCall] Conversation Service Leave Url is not yet set. Cannot leave conversation. Disposing anyways.`),n.subCode=sr.CALL_END_SUB_CODE.CONV_URL_NOT_SET,this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultDetail:n.phrase||"CancelOutgoingCall",endCode:n.code,endSubCode:n.subCode,causeId:t,clientReasonSubCode:n.clientReasonSubCode,clientReasonPhrase:n.clientReasonPhrase,resultCategories:n.resultCategories}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,n),this.dispose(n,t),i.resolve(null);return i.promise}terminateEstablishedCall(e,t){let i=t.causeId||sp();this.logger.info(`[${i}][terminateEstablishedCall]`);let n=sV();this.fsmState=sr.SIGNALING_FSM_STATE.IDLE;let r=this.convJoined?u3.LEAVE_CONVERSATION.name:u3.END_CALL.name,s=hQ(),a={code:e?.code||sr.CALL_END_CODE.SUCCESS,subCode:e?.subCode||sr.CALL_END_SUB_CODE.SUCCESS,phrase:e?.phrase||sr.CALL_END_PHRASE.LOCAL_USER_INITIATED,resultCategories:e?.resultCategories,clientReasonSubCode:e?.clientReasonSubCode,clientReasonPhrase:e?.clientReasonPhrase};a.resultCategories=a.resultCategories||[rU];let o={terminatingEnd:hi.LOCAL,endCode:a.code,endSubCode:a.subCode,resultDetail:a.phrase||"TerminateEstablishedCall",causeId:i,clientReasonSubCode:a.clientReasonSubCode,clientReasonPhrase:a.clientReasonPhrase,resultCategories:a.resultCategories};return this.leaveConversation(a,t).then(()=>{this.logger.info(`[${i}][terminateEstablishedCall]success`),this.disposed||(this.telemetryHelper.setTerminatingData(o),this.telemetryHelper.addNetworkOperationCompleted(r,!0,s.duration()),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,i,a),this.dispose(a,i)),n.resolve(null)}).catch(e=>{let t=sM(e,this.signalingAgentConfig);this.logger.info(`[${i}][terminateEstablishedCall][failed] error: ${t_(e)} xhrError: ${t_(t)}]`),this.disposed||(this.telemetryHelper.setTerminatingData(o),this.telemetryHelper.addNetworkOperationCompleted(r,!1,s.duration()),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,i,a),this.dispose(a,i)),n.resolve(null)}),n.promise}deleteConversation(e,t){this.logger.info(`[${t}][deleteConversation]`);let i=sV();this.fsmState=sr.SIGNALING_FSM_STATE.IDLE;let n=u3.DELETE_CONVERSATION.name,r=hQ(),s={code:e?.code||sr.CALL_END_CODE.SUCCESS,subCode:e?.subCode||sr.CALL_END_SUB_CODE.SUCCESS,phrase:e?.phrase||sr.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED,resultCategories:e?.resultCategories||[rU],clientReasonSubCode:e?.clientReasonSubCode,clientReasonPhrase:e?.clientReasonPhrase},a={terminatingEnd:hi.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:s.phrase,causeId:t,clientReasonSubCode:s.clientReasonSubCode,clientReasonPhrase:s.clientReasonPhrase,resultCategories:s.resultCategories};return this.deleteConversationController(s,t).then(()=>{this.logger.info(`[${t}][deleteConversation]success`),this.disposed||(this.telemetryHelper.setTerminatingData(a),this.telemetryHelper.addNetworkOperationCompleted(n,!0,r.duration()),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,s),this.dispose(s,t)),i.resolve(null)}).catch(e=>{let o=sM(e,this.signalingAgentConfig);this.logger.info(`[${t}][deleteConversation][failed] error: ${t_(e)} xhrError: ${t_(o)}`),this.disposed||(this.telemetryHelper.setTerminatingData(a),this.telemetryHelper.addNetworkOperationCompleted(n,!1,r.duration()),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,s),this.dispose(s,t)),i.resolve(null)}),i.promise}leaveConversation(e,t){let i=t.causeId||sp();if(!this.convJoined)return this.logger.info(`[${i}][leaveConversation] ignore, not joined to conversation`),Promise.resolve(void 0);{this.logger.info(`[${i}][leaveConversation]`);let n={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()};return this.http.sendPostRequest({url:this.links[sr.LINKS.LEAVE],requestName:u3.LEAVE_CONVERSATION.name,payload:gW(this,e,n,t.scope),withoutTrouter:!0,causeId:i})}}deleteConversationController(e,t){return this.convJoined?(this.logger.info(`[${t}][deleteConversationController]`),this.http.sendDeleteRequest({url:this.links[sr.LINKS.CONVERSATION_CONTROLLER],requestName:u3.DELETE_CONVERSATION.name,payload:gB(this,e),withoutTrouter:!0,causeId:t})):(this.logger.info(`[${t}][deleteConversationController]ignored, not joined to conversation`),Promise.resolve(void 0))}rejectIncomingCall(e,t){this.telemetryHelper.recordEvent(dy,t),this.logger.info(`[${t}][rejectIncomingCall]`);let i=sV();this.fsmState=sr.SIGNALING_FSM_STATE.IDLE;let n={code:isNaN(e?.code)?sr.CALL_END_CODE.REJECT:e.code,subCode:e?.subCode||sr.CALL_END_SUB_CODE.SUCCESS,phrase:e?.phrase||sr.CALL_END_PHRASE.LOCAL_USER_INITIATED,resultCategories:e?.resultCategories,clientReasonSubCode:e?.clientReasonSubCode,clientReasonPhrase:e?.clientReasonPhrase,...this.signalingAgent?.accountConfig?.applicationType?{applicationType:this.signalingAgent.accountConfig.applicationType}:{}};n.resultCategories=n.resultCategories||[rU];let r={terminatingEnd:hi.LOCAL,endCode:n.code,endSubCode:n.subCode,resultDetail:n.phrase||"RejectCall",causeId:t,clientReasonSubCode:n.clientReasonSubCode,clientReasonPhrase:n.clientReasonPhrase,resultCategories:n.resultCategories};return this.http.sendDeleteRequest({url:this.links[sr.LINKS.REJECT],requestName:u3.REJECT_CALL.name,payload:gZ(this,n),causeId:t}).then(e=>{this.disposed||(this.telemetryHelper.setTerminatingData(r),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,n),this.dispose(n,t)),i.resolve(null)}).catch(e=>{let s=sM(e,this.signalingAgentConfig);this.logger.info(`[rejectIncomingCall][${t}] error: ${t_(e)} xhrError: ${t_(s)}`),this.disposed||(this.telemetryHelper.setTerminatingData(r),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,t,n),this.dispose(n,t)),i.resolve(null)}),i.promise}onCallStatusChanged(e,t,i){let n=`[${t}][onCallStatusChanged]`;if(this.logger.info(`${n}${this.currentCallStatus}=>${e}]`),this.disposed)return void this.logger.info(`${n}Call is already disposed!!`);if(i&&this.logger.info(`${n}[statusCode=${t_(i)}]`),this.isPromotingToRealtime)e===sr.CALL_STATUS.CONNECTED&&this.onPromotionCompleted(!1,void 0,t);else if(this.isValidStateTransitions(e)){this.currentCallStatus=e;let n={callStatus:e,statusCode:i,causeId:t};this.isPreheatOnly&&(n.isPreheatOnly=!0),this.telemetryHelper.recordEvent(da,n),this.signalingSessionCallback.onCallStatusChanged(e,i,t),this.currentCallStatus===sr.CALL_STATUS.CONNECTED&&(this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.telemetryHelper.resetCallCancelationDurationWatch(),this.isPreheatOnly&&this.startCallPreheatTimer(t))}}updateMeetingLiveStateAsync(e,t){this.logger.info(`[${e}][updateMeetingLiveStateAsync][options=${JSON.stringify(t)}]`),this.telemetryHelper.recordEvent(ut,{causeId:e,meetingLiveStateOptions:t}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION,()=>{this.handleUpdateMeetingLiveStateError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT,phrase:sr.CALL_END_PHRASE.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT},ui,e,e,t)},this.getTimeoutValue("updateMeetingLiveStateCompletionTimeoutSec"));let i=g7(this,{...t,sequenceNumber:this.meetingLiveStateSequenceNumber},e);return this.http.sendPostRequest({url:this.links[sr.LINKS.UPDATE_MEETING_LIVE_STATE],requestName:u3.UPDATE_MEETING_LIVE_STATE.name,payload:i,causeId:e}).then(t=>{this.logger.info(`[${e}][updateMeetingLiveStateAsync] response: ${t_(t)}`),this.telemetryHelper.recordEvent(ui,{causeId:e})}).catch(i=>{let n=sM(i,this.signalingAgentConfig);return(this.logger.info(`[${e}][updateMeetingLiveStateAsync] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleUpdateMeetingLiveStateError(n.error,un,e,e,t),Promise.reject(n.error))})}updateMeetingStatesAsync(e,t){let i=this.logger.createChild(`[${e}][updateMeetingStatesAsync]`,this.correlationId);if(i.info(`meetingStatesOptions: ${JSON.stringify(t)}`),!t)return Promise.reject({code:sr.VALIDATION.VALIDATION_FAILED,subCode:sr.VALIDATION.NULL_OR_EMPTY,phrase:"meetingStatesOptions should be a non empty object"});this.telemetryHelper.recordEvent(uJ,{causeId:e,meetingStatesOptions:t}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_STATES_COMPLETION,()=>{for(let i in t.meetingStates)this.handleUpdateMeetingStatesError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.UPDATE_MEETING_STATES_COMPLETION_TIMEOUT,phrase:sr.CALL_END_PHRASE.UPDATE_MEETING_STATES_COMPLETION_TIMEOUT},uK,e,t.operationId+"_"+i)},this.getTimeoutValue("updateMeetingStatesCompletionTimeoutSec"));let n=pa(this,{...t.meetingStates},e);return this.http.sendPostRequest({url:this.links[sr.LINKS.UPDATE_MEETING_STATES],requestName:u3.UPDATE_MEETING_STATES.name,payload:n,causeId:e}).then(t=>{i.info(`response: ${t_(t)}`),this.telemetryHelper.recordEvent(uK,{causeId:e})}).catch(n=>{let r=sM(n,this.signalingAgentConfig);if(i.error(`error: ${t_(r)}`),!this.disposed){for(let i in t.meetingStates)this.handleUpdateMeetingStatesError(r.error,uY,e,t.operationId+"_"+i);return Promise.reject(r.error)}return Promise.reject(this.getCallNotFoundTransactionEnd())})}handleUpdateMeetingLiveStateError(e,t,i,n,r){if(this.disposed)return void this.logger.info(`[${i}][handleUpdateMeetingLiveStateError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleUpdateMeetingLiveStateError] reject reason: ${e}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION),this.telemetryHelper.recordEvent(t,{...e,updateMeetingGroupsOptions:r,causeId:i}),this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted&&this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted(e,i,n)}handleUpdateMeetingLiveStateCompletion(e){let t=e.body,i=sk(e),n=t.updateMeetingLiveStateResponse.result,r=t.updateMeetingLiveStateResponse.operationId;r||this.logger.warn(`[${i}][handleUpdateMeetingLiveStateCompletion] operationId is undefined.`),this.logger.info(`[${i}][handleUpdateMeetingLiveStateCompletion] meetingLiveUpdate completes with operationId=${r}`),this.handleOperationCompletionCommon(n,i,r,t_(t),"handleUpdateMeetingLiveStateCompletion",sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION,us,ur,this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted,this.handleUpdateMeetingLiveStateError.bind(this))}handleUpdateMeetingStatesError(e,t,i,n){if(this.disposed)return void this.logger.info(`[${i}][handleUpdateMeetingStatesError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleUpdateMeetingStatesError] reject reason: ${e}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_STATES_COMPLETION),this.telemetryHelper.recordEvent(t,{...e,causeId:i}),this.signalingSessionCallback.onUpdateMeetingStatesCompleted&&this.signalingSessionCallback.onUpdateMeetingStatesCompleted(e,i,n)}handleUpdateMeetingStatesCompletion(e){let t=e.body,i=sk(e),n=t.updateMeetingStatesResponse,r=t.operationId,s=this.logger.createChild(`[${i}][handleUpdateMeetingStatesCompletion]`,this.correlationId);for(let e of(r||s.warn("operationId is undefined."),n))s.info(`UpdateMeetingStates completes with operationId=${r}.`),this.handleOperationCompletionCommon(e.transactionEnd,i,r+"_"+e.meetingStateName,t_(t),"handleUpdateMeetingStatesCompletion",sr.TIMEOUT_OPERATIONS.UPDATE_MEETING_STATES_COMPLETION,uQ,uY,this.signalingSessionCallback.onUpdateMeetingStatesCompleted,this.handleUpdateMeetingStatesError.bind(this))}handleUpdateMonitorSessionCompletion(e){let t=e.body,i=sk(e);this.logger.info(`[${i}][handleUpdateMeetingStatesCompletion]`,this.correlationId);let n=t.monitorCompletion;this.handleOperationCompletionCommon(n,i,void 0,t_(t),"handleUpdateMonitorSessionCompletion",sr.TIMEOUT_OPERATIONS.UPDATE_MONITOR_SESSION_COMPLETION,u1,u0,this.signalingSessionCallback.onUpdateMonitorSessionCompleted,this.handleUpdateMonitorSessionError.bind(this))}handleUpdateMonitorSessionError(e,t,i,n){if(this.disposed)return void this.logger.info(`[${i}][handleUpdateMonitorSessionError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleUpdateMonitorSessionError] reject reason: ${JSON.stringify(e)}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.UPDATE_MONITOR_SESSION_COMPLETION),this.telemetryHelper.recordEvent(t,{...e,monitorOptions:n,causeId:i}),this.signalingSessionCallback.onUpdateMonitorSessionCompleted(e,i)}setMeetingLayoutAsync(e,t){this.logger.info(`[${e}][setMeetingLayoutAsync][options=${JSON.stringify(t)}]`),this.telemetryHelper.recordEvent(um,{causeId:e,setMeetingLayoutOptions:t}),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION,()=>{this.handleSetMeetingLayoutError({code:sr.CALL_END_CODE.TIMEOUT,subCode:sr.CALL_END_SUB_CODE.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT,phrase:sr.CALL_END_PHRASE.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT},uv,e,e,t)},this.getTimeoutValue("setMeetingLayoutCompletionTimeoutSec"));let i=g1(this,{...t,sequenceNumber:this.meetingLayoutSequenceNumber});return this.http.sendPostRequest({url:this.links[sr.LINKS.SET_MEETING_LAYOUT],requestName:u3.SET_MEETING_LAYOUT.name,payload:i,causeId:e}).then(t=>{this.logger.info(`[${e}][setMeetingLayoutAsync] response: ${t_(t)}`),this.telemetryHelper.recordEvent(uv,{causeId:e})}).catch(i=>{let n=sM(i);return(this.logger.info(`[${e}][setMeetingLayoutAsync] error: ${t_(n)}`),this.disposed)?Promise.reject(this.getCallNotFoundTransactionEnd()):(this.handleSetMeetingLayoutError(n.error,uS,e,e,t),Promise.reject(n.error))})}handleSetMeetingLayoutError(e,t,i,n,r){if(this.disposed)return void this.logger.info(`[${i}][handleSetMeetingLayoutError] ignored. Call disposed, err: ${JSON.stringify(e)}`);this.logger.info(`[${i}][handleSetMeetingLayoutError] reject reason: ${e}`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION),this.telemetryHelper.recordEvent(t,{...e,updateMeetingGroupsOptions:r,causeId:i}),this.signalingSessionCallback.onSetMeetingLayoutCompleted&&this.signalingSessionCallback.onSetMeetingLayoutCompleted(e,i,n)}handleSetMeetingLayoutCompletion(e){let t=e.body,i=sk(e),n=t.transactionEnd,r=t.operationId;n.result=t.layoutDetails,r||this.logger.warn(`[${i}][handleSetMeetingLayoutCompletion] operationId is undefined.`),this.handleOperationCompletionCommon(n,i,void 0,t_(t),"handleSetMeetingLayoutCompletion",sr.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION,uC,uy,this.signalingSessionCallback.onSetMeetingLayoutCompleted,this.handleSetMeetingLayoutError.bind(this))}handleOperationCompletionCommon(e,t,i,n,r,s,a,o,l,c){if(this.disposed)return void this.logger.info(`[${t}][${r}] ignored. Call disposed.`);this.logger.info(`[${t}][${r}] body ${n}`),e.code===sr.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(s),this.telemetryHelper.recordEvent(a,{...e,causeId:t}),l&&l(e,t,i)):c&&c(e,o,t,i)}isValidStateTransitions(e){if(this.currentCallStatus===sr.CALL_STATUS.LOCAL_TERMINATED&&e===sr.CALL_STATUS.CONNECTING)return!0;let t=e=>{switch(e){case sr.CALL_STATUS.IDLE:case sr.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY:return 0;case sr.CALL_STATUS.CONNECTING:return 1;case sr.CALL_STATUS.RINGING:return 2;case sr.CALL_STATUS.CONNECTED:return 3;case sr.CALL_STATUS.LOCAL_TERMINATED:case sr.CALL_STATUS.REMOTE_TERMINATED:return 4;default:return -1}};return t(e)>t(this.currentCallStatus)}handlePSTNBalanceUpdate(e){let t=e.body.balanceUpdate,i=sk(e);this.logger.info(`[${i}][handlePSTNBalanceUpdate]`),this.telemetryHelper.recordIncomingEvent(di,e),t.updateBalance?this.signalingSessionCallback.onPSTNBalanceUpdate(t):this.logger.info(di,"this was a pstn keepAlive message - ignore")}handleCallAcceptanceAck(e){let t=e.body,i=sk(e);this.logger.info(`[${i}][handleCallAcceptanceAck]`),this.telemetryHelper.recordIncomingEvent(l9,e),this.internalHandleCallAcceptanceAck(t,i)}internalHandleCallAcceptanceAck(e,t){this.logger.info(`[${t}][internalHandleCallAcceptanceAck] ${t_(e)}`),this.fsmState!==sr.SIGNALING_FSM_STATE.CONNECTED&&(this.links[sr.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptanceAcknowledgement.links.mediaRenegotiation,this.links[sr.LINKS.TRANSFER]=e.callAcceptanceAcknowledgement.links.transfer,this.links[sr.LINKS.REPLACE]=e.callAcceptanceAcknowledgement.links.replacement,this.links[sr.LINKS.HANGUP]=e.callAcceptanceAcknowledgement.links.callLeg,this.links[sr.LINKS.KEEPALIVE]=e.callAcceptanceAcknowledgement.links.callLeg,this.links[sr.LINKS.PARK]=e.callAcceptanceAcknowledgement.links.hold,this.links[sr.LINKS.UPDATE_MEDIA_DESCRIPTIONS]=e.callAcceptanceAcknowledgement.links.updateMediaDescriptions,this.links[sr.LINKS.UPDATE_MONITOR_SESSION]=e.callAcceptanceAcknowledgement.links.monitor,this.saveMediaControllerLinksIfAny(e.callAcceptanceAcknowledgement),this.scheduleKeepAlives(e.callAcceptanceAcknowledgement.callKeepAliveInterval),this.signalingSessionCallback.updateIsSharedLineAppearanceV2Activated(e.callAcceptanceAcknowledgement.callProperties?.isSharedLineAppearanceV2Activated),this.fsmState=sr.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(t),this.onCallStatusChanged(sr.CALL_STATUS.CONNECTED,t),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info(`[${t}][internalHandleCallAcceptanceAck] updating CC links as requested`),this.updateLinks(this.updateKeepAliveUrl,t)))}isFatalException(e){let t=!0;try{JSON.parse(e.message).code===sr.CALL_END_CODE.CONFLICT&&(t=!1,this.logger.info("isFatalException: received non-fatal 409 error"))}catch(e){this.logger.error("isFatalException: failed to parse error")}return t}startOrJoinCall(e,t,i,n,r,s=!1){let a=`[${i}][startOrJoinCall][${t}]`;if(this.disposed)return void this.logger.info(`${a} session already disposed, ignore`);this.telemetryHelper.recordEvent(lQ,{causeId:i,requestName:t}),this.setMultiParty(1!==this.participantManager.getParticipantsToInitiateCallWith().length,i);let o=this.getConversationUrl()?this.getConversationUrl():e.conversationServiceUrl;this.telemetryHelper.setConversationServiceUrl(o),this.logger.info(`options.conversationServiceUrl ${e.conversationServiceUrl} conversationServiceUrl ${o}`),e.isPreheatOnly?this.isPreheatOnly=!0:this.telemetryHelper.startCallCancelationDurationWatch(),this.skipOfferGenerationForStreamingUser=s,this.mediaTypesToUse=r,this.lastUsedOutgoingMediaContent=n,this.telemetryHelper.setCallerType(this.participantManager.localParticipant.id);let l=!this.multiParty&&this.signalingAgentConfig.enableLongOutgoing1To1SetupTimeoutForWeb,c=l?this.getTimeoutValue("longerOutgoingCallEstablishmentTimeoutSec"):this.getTimeoutValue("outgoingCallEstablishmentTimeoutSec");this.logger.info(`${a} target endpointType = ${this.transferContext&&this.transferContext.target?this.transferContext.target.endpointType:"default"} timeout = ${c} LongerTimeout = ${l}`);let d=e.newCall?gV(this,n,r,e):gj(this,n,r,e,i,s);this.signalingAgentConfig.enableCallEstablishmentTimeoutsForStartJoinCall&&this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,()=>{this.handleCallEstablishmentTimeout(i)},c),this.signalingSessionCallback.onTransferredCallAcceptance(i),e.endpointState&&(this.latestEndpointState=e.endpointState),this.http.sendPostRequest({url:o,requestName:t,operationType:"CallSetup",payload:d,causeId:i}).then(e=>{this.disposed||(this.processConversationServiceResponseHeaders(e,i),this.processConversationServiceResponse(e.response,i,0),this.onCallStatusChanged(sr.CALL_STATUS.CONNECTING,i))}).catch(e=>{if(e.stack&&!this.isFatalException(e))return;let t=sM(e,this.signalingAgentConfig);if(this.logger.info(`${a} error: ${t_(e)} xhrError: ${t_(t)}`),!this.disposed){if(this.isPromotingToRealtime)return void this.onPromotionCompleted(!0,t.error,i);this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultValue:hn.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultCategories:t.error.resultCategories,resultDetail:t.error.phrase||"StartOrJoinCallFailure",causeId:i}),this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,i,t.error),this.dispose(t.error,i)}})}processIncomingCallPayload(e,t){if(this.remoteUser=o8.fromWireParticipant(e.callNotification.from),this.participantManager.setLocalParticipantId(e.callNotification.to.participantId,t),!e)return void this.logger.info(`[${t}][processIncomingCallPayload] empty incoming payload content`);e.conversationInvitation&&(this.links[sr.LINKS.CONVERSATION_CONTROLLER]=e.conversationInvitation.conversationController,this.setMultiParty(e.conversationInvitation.isMultiParty,t),this.setIsHostless(!!e.conversationInvitation.isHostless,t)),e.callNotification&&(this.links[sr.LINKS.ATTACH]=e.callNotification.links?.attach,this.links[sr.LINKS.REDIRECT]=e.callNotification.links?.redirection,this.onBehalfOf=e.callNotification.onBehalfOf?.id,this.onBehalfOfUserDisplayName=e.callNotification.onBehalfOf?.displayName,this.callQueueContext=e.callNotification.callQueueContext,this.callPhoneLineType=e.callNotification.callPhoneLineType,this.callType=e.callNotification.callType,this.incomingCallCallerId=e.callNotification.from?.id,this.callUsesMixer=!!e.callNotification.mediaContent?.fromMixer,this.isRedirectAllowed=!!e.callNotification.redirectionProperties?.isRedirectAllowed,this.callQueueSupervisorContent=e.callNotification.callQueueSupervisorContent,this.bannerContent=e.callNotification.bannerContent),e.debugContent&&this.updateCorrelationId(e.debugContent.callId,t),e.callNotification.transferor&&(this.transferor=e.callNotification.transferor.details?e.callNotification.transferor.details.id:null),e.groupChat&&this.updateGroupChatIds(e.groupChat,t),e.meetingData&&(this.meetingData=e.meetingData),e.meetingInfo&&(this.meetingInfo=e.meetingInfo)}processAttachResponse(e,t,i){this.telemetryHelper.recordEvent(dp,{causeId:i}),this.links[sr.LINKS.MEDIA_ANSWER]=t.response.callInvitation.links.mediaAnswer,this.links[sr.LINKS.ACCEPT]=t.response.callInvitation.links.acceptance,this.links[sr.LINKS.REJECT]=t.response.callInvitation.links.callLeg,this.links[sr.LINKS.REDIRECT]=t.response.callInvitation.links.redirection,this.links[sr.LINKS.NEW_OFFER]=t.response.callInvitation.links.newOffer,this.signalingAgentConfig.sendProgressFromCC||this.sendProgress(t),this.remoteCaller=t.response.participants.from;let n=this.getInitialMediaOfferFromIncomingCallPayload()||t.response.callInvitation.mediaContent;this.telemetryHelper.setCallerType(this.getParticipantIdForOfferAnswer(n));let r=sT(t.response.callInvitation.callModalities);this.telemetryHelper.addIncomingModalities(r),this.telemetryHelper.setOfferedModalities(n.blob,!0),this.callUsesMixer=n.fromMixer,this.isRedirectAllowed=!!(t.response.callInvitation.redirectionProperties&&t.response.callInvitation.redirectionProperties.isRedirectAllowed),this.signalingSessionCallback.onAttachOffer({subject:e.conversationInvitation.subject,remoteParticipantId:this.getParticipantIdForOfferAnswer(n),remoteEndpointId:t.response.participants.from.endpointId,transferor:t.response.callInvitation.transferor,clientTransferContext:e.callNotification.transferContext,customHeaderContext:t.response.callInvitation.customContext,mediaTypes:r,mediaContent:n,renegotiation:!1,invitationData:t.response.callInvitation.invitationData,riskLevel:t.response.callInvitation.spamProperties&&t.response.callInvitation.spamProperties.riskLevel,stirAttestation:t.response.callInvitation.spamProperties&&t.response.callInvitation.spamProperties.stirAttestation,isRedirectAllowed:this.isRedirectAllowed},i)}sendProgress(e,t=sp()){this.logger.info(`[${t}][sendProgress]`),this.telemetryHelper.recordEvent(df,{causeId:t}),this.http.sendPostRequest({url:e.response.callInvitation.links.progress,requestName:u3.SEND_CALL_PROGRESS.name,payload:gF(this),causeId:t}).catch(e=>{let i=sM(e,this.signalingAgentConfig);this.logger.info(`[${t}][sendProgress] error: ${t_(i)}`),this.disposed||this.telemetryHelper.recordEvent(dm,{causeId:t,...i.error})})}handleCallNotification(e){let t=sk(e);if(this.logger.info(`[${t}][handleCallNotification]`),this.telemetryHelper.recordIncomingEvent(de,e),s_(e.url,rG.REPLACE))this.telemetryHelper.recordIncomingEvent(dt,e),this.logger.info(`[${t}][handleCallNotification]replacementCallNotification`),this.signalingSessionCallback&&this.signalingSessionCallback.onIncomingCallReplacement(e.body,t);else throw Error(`[${t}][handleCallNotification]IncomingCallNotification should not be received in handleIncomingMsg`)}handleMediaAnswer(e){this.telemetryHelper.recordIncomingEvent(le,e);let t=e.body,i=sk(e);if(this.logger.info(`[${i}][handleMediaAnswer]`),this.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())return void this.mediaRenegotiationManager.handleMediaAnswer(t,i);if(this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED);else if(this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING){if(sD(e.headers,this.provisionalMediaAnswersSeenSoFar))return void this.logger.info(`[${i}][handleMediaAnswer] ignoring provisional answer retried by service`);t.mediaAnswer.sender&&(this.remoteUser=t.mediaAnswer.sender),this.resetCallEstablishmentTimeout(i),t.mediaAnswer.noRingBack||(this.telemetryHelper.setTimeToRingDuration(),this.onCallStatusChanged(sr.CALL_STATUS.RINGING,i));let n=t.mediaAnswer.mediaContent;this.signalingSessionCallback.onAnswer({provisional:!0,renegotiation:!1,remoteEndpointId:t.mediaAnswer.sender?t.mediaAnswer.sender.endpointId:sm(),remoteParticipantId:this.getParticipantIdForOfferAnswer(n),mediaContent:n},i)}}async _sendCallAcceptanceAcknowledgement(e,t){this.http.sendPostRequest({url:e.body.callAcceptance.links.acknowledgement,requestName:u3.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,payload:gx(this),causeId:t}).catch(e=>{let i=sM(e,this.signalingAgentConfig);this.logger.info(`[${t}][_sendCallAcceptanceAcknowledgement] error: ${t_(i)}`),this.disposed||this.telemetryHelper.recordEvent(ct,{causeId:t,...i.error})})}handleCallAcceptance(e){let t=sk(e);this.telemetryHelper.recordIncomingEvent(l7,e,{enableQuickSendAcceptanceAck:this.signalingAgentConfig.enableQuickSendAcceptanceAck,causeId:t}),this.logger.info(`[${t}][handleCallAcceptance]enableQuickSendAcceptanceAck:
            ${this.signalingAgentConfig.enableQuickSendAcceptanceAck}`),this.signalingAgentConfig.enableQuickSendAcceptanceAck?(this._sendCallAcceptanceAcknowledgement(e,t),this._processCallAcceptance(e,t)):(this._processCallAcceptance(e,t),this.http.sendPostRequest({url:e.body.callAcceptance.links.acknowledgement,requestName:u3.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,payload:gx(this),causeId:t}).catch(e=>{let i=sM(e,this.signalingAgentConfig);this.logger.info(`[${t}][handleCallAcceptance] error: ${t_(i)}`),this.disposed||this.telemetryHelper.recordEvent(ct,{causeId:t,...i.error})}))}handleCallAcceptanceSync(e){let t=sk(e);this.telemetryHelper.recordIncomingEvent(ce,e,{enableQuickSendAcceptanceAck:this.signalingAgentConfig.enableQuickSendAcceptanceAck,causeId:t}),this.logger.info(`[${t}][handleCallAcceptanceSync] enableQuickSendAcceptanceAck:
            ${this.signalingAgentConfig.enableQuickSendAcceptanceAck}`),this.signalingAgentConfig.enableQuickSendAcceptanceAck?hy.defer(this._processCallAcceptance,e,t):this._processCallAcceptance(e,t);let i=gx(this).payload;return this.telemetryHelper.addNetworkOperationCompleted(u3.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,!0),i}getFakeRoster(e){let t,i=this.participantManager.getParticipantsToInitiateCallWith(),n={id:t=1===i.length?i[0].id:e.callAcceptance.acceptedBy.id,displayName:e.callAcceptance.acceptedBy.id===t?e.callAcceptance.acceptedBy.displayName:"",languageId:e.callAcceptance.acceptedBy.languageId},r=e.callAcceptance.acceptedBy.endpointId;return{type:"MultiPartyEndpoint",participants:{[t]:{acceptedBy:e.callAcceptance.acceptedBy.id,details:n,endpoints:{[r]:{call:{},contentSharing:{},capabilities:e.callAcceptance.capabilities,participantId:e.callAcceptance.acceptedBy.participantId}}}}}}processCallAcceptance(e,t){this.logger.info(`[${t}][processCallAcceptance] ${t_(e)}`),this.telemetryHelper.recordEvent(dv,{causeId:t}),this.fsmState=sr.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(t);let i=!1;e.callAcceptance.controllerName===sr.MISC.LOBBY_CALL_CONTROLLER&&(this.logger.info(`[${t}][processCallAcceptance] Controller name is lobby so putting user in lobby`),this.participantManager.localParticipant.isLobby=!0,this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId,participantId:this.participantManager.localParticipant.participantId}),i=!0,this.telemetryHelper.recordEvent(dS,{causeId:t})),this.participantManager.localParticipant.isStaging=hI(e.callAcceptance),this.signalingSessionCallback.onMeetingGroupDetailsUpdated(e.callAcceptance.meetingGroupDetails,t),this.signalingSessionCallback.updateIsSharedLineAppearanceV2Activated(e.callAcceptance.callProperties?.isSharedLineAppearanceV2Activated),this.logger.info(`[${t}][processCallAcceptance] for localParticipant, isStaging is set to ${this.participantManager.localParticipant.isStaging}`);let n=this.mediaTypesToUse,r=sm();e.callAcceptance.acceptedBy&&(this.remoteUser=o8.fromWireParticipant(e.callAcceptance.acceptedBy),r=e.callAcceptance.acceptedBy.endpointId),e.callAcceptance.acceptedCallModalities&&e.callAcceptance.acceptedCallModalities.length>0&&(n=e.callAcceptance.acceptedCallModalities);let s=e.callAcceptance.mediaContent;this.callUsesMixer=s.fromMixer;let a=sT(n);this.telemetryHelper.addIncomingModalities(a),this.telemetryHelper.setAnsweredModalities(s.blob,!0),this.links[sr.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptance.links.mediaRenegotiation,this.links[sr.LINKS.TRANSFER]=e.callAcceptance.links.transfer,this.links[sr.LINKS.REPLACE]=e.callAcceptance.links.replacement,this.links[sr.LINKS.HANGUP]=e.callAcceptance.links.callLeg,this.links[sr.LINKS.KEEPALIVE]=e.callAcceptance.links.callLeg,this.links[sr.LINKS.PARK]=e.callAcceptance.links.hold,this.links[sr.LINKS.UPDATE_MEDIA_DESCRIPTIONS]=e.callAcceptance.links.updateMediaDescriptions,this.links[sr.LINKS.UPDATE_MONITOR_SESSION]=e.callAcceptance.links.monitor,this.saveMediaControllerLinksIfAny(e.callAcceptance),this.scheduleKeepAlives(e.callAcceptance.callKeepAliveInterval);let o=this.getParticipantIdForOfferAnswer(s);this.signalingSessionCallback.onAnswer({provisional:!1,renegotiation:!1,remoteEndpointId:r,remoteParticipantId:o,callAcceptedByNGCVoicemail:o===sr.KNOWN_BOTS.VOICEMAIL_BOT_ID,mediaTypes:a,mediaContent:s},t),this.setRealTimeState(2,t),this.onCallStatusChanged(sr.CALL_STATUS.CONNECTED,t),i&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant,t),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info(`[${t}][processCallAcceptance] Updating CC links as requested`),this.updateLinks(this.updateKeepAliveUrl,t))}updateGroupChatIds(e,t){let i=this.groupId,n=this.threadId,r=this.teamsMessageId,s=this.backroomThreadId,a=this.streamThreadId,o=this.lobbyThreadId;this.groupId=e.groupId,this.threadId=e.threadId,this.teamsMessageId=e.messageId,this.backroomThreadId=e.backroomThreadId,this.streamThreadId=e.streamThreadId,this.lobbyThreadId=e.lobbyThreadId,(this.groupId!==i||this.threadId!==n||this.teamsMessageId!==r||this.backroomThreadId!==s||this.streamThreadId!==a||this.lobbyThreadId!==o)&&this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,groupId:this.groupId,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo,callLimits:this.callLimits,isHuddleGroupCall:this.isHuddleGroupCall,backroomThreadId:this.backroomThreadId,streamThreadId:this.streamThreadId,lobbyThreadId:this.lobbyThreadId},t)}handleCallEnd(e,t){let i=e.body.callEnd||e.body,n=sk(e);if(this.logger.info(`[${n}][handleCallEnd][content=${t_(i)}]`),this.telemetryHelper.recordEvent(cn,{origin:e.origin,code:i?i.code:"unknown",subCode:i?i.subCode:"unknown",resultCategories:i?i.resultCategories:[],causeId:n}),this.signalingAgentConfig.enableConversationTypeUpdateOnCallEnd&&(this.conversationType=i?.conversationType||this.conversationType,this.signalingSessionCallback.onConversationTypeUpdated(this.conversationType,n)),this.fsmState===sr.SIGNALING_FSM_STATE.IDLE)return void this.logger.info(`[${n}][handleCallEnd] not handling incoming callEnd since fsmstate = SIGNALING_FSM_STATE.IDLE`);if(i.code===sr.CALL_END_CODE.CONFLICT&&this.multiParty&&i.conversationUrl?.Location)this.handleConversationResolutionConflict(i,n);else{this.disposing=!0,i.callControllerTransactionEnd&&(this.logger.info("handleCallEnd: using CC end details specified in CS end"),i=i.callControllerTransactionEnd),i.broadcastOperationFailure&&(this.logger.info("handleCallEnd: using broadcastOperationFailure end details specified in CS end"),i=i.broadcastOperationFailure);let e=i.code===sr.CALL_END_CODE.SUCCESS||i.code===sr.CALL_END_CODE.CANCEL||i.code===sr.CALL_END_CODE.REJECT;this.telemetryHelper.setTerminatingData({terminatingEnd:hi.REMOTE,resultDetail:i.phrase,resultValue:e?hn.SUCCESS:hn.FAILURE,endCode:i.code,endSubCode:i.subCode,resultCategories:i?i.resultCategories:[],causeId:n});let r={code:i.code,subCode:i.subCode,phrase:i.phrase,resultCategories:i.resultCategories,pickupCode:""},s=this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY;i.acceptedElsewhereBy&&(this.acceptedElsewhereBy={id:i.acceptedElsewhereBy.id,displayName:i.acceptedElsewhereBy.displayName}),i.unparkContent&&(i.unparkContent.CallParkAdditionalContext&&(this.parkAdditionalContextJson=JSON.stringify(i.unparkContent.CallParkAdditionalContext),this.serverHoldLocation=i.unparkContent.CallParkAdditionalContext.ConversationControllerLocation),i.unparkContent.pickupCode&&(r.pickupCode=i.unparkContent.pickupCode));let a=this.signalingAgentConfig.enableSplitConversationEndUrl;a&&s===t?(this.logger.info("fsmstate = SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY or OUTGOING_FOR_ROSTER_ONLY"),this.onCallStatusChanged(sr.CALL_STATUS.REMOTE_TERMINATED,n,r),this.dispose(r,n)):a||(this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(sr.CALL_STATUS.REMOTE_TERMINATED,n,r),this.dispose(r,n))}}handleConversationResolutionConflict(e,t){this.logger.info(`[${t}][handleConversationResolutionConflict]`);let i={...e,phrase:e.phrase||"Conflict Resolution Error"};if(this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||this.fsmState===sr.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY)this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.http.cancelRequestIfPending(u3.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY.name,t,void 0,i),this.subscribeToCall(e.conversationUrl.Location,e.correlationId,this.lastUsedJoinCallOptions?this.lastUsedJoinCallOptions.clientEndpointCapabilities:0,{meetingData:this.meetingData,meetingPreferences:this.meetingPreferences,additionalEndpointProperties:this.lastUsedJoinCallOptions?.additionalEndpointProperties},t);else{this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT);let n={meetingData:this.meetingData,meetingPreferences:this.meetingPreferences};if(this.lastUsedJoinCallOptions){let e=this.lastUsedJoinCallOptions.scenario;n.muted=this.lastUsedJoinCallOptions.muted,n.scenario=`409Redirect${e||""}`,n.isPreheatOnly=this.lastUsedJoinCallOptions.isPreheatOnly,n.clientEndpointCapabilities=this.lastUsedJoinCallOptions.clientEndpointCapabilities,n.clientEndpointDebugContent=this.lastUsedJoinCallOptions.clientEndpointDebugContent,n.additionalEndpointProperties=this.lastUsedJoinCallOptions.additionalEndpointProperties}else n.scenario="409RedirectJoin";this.setInitialTelemetry("JoinCall",{correlationId:e.correlationId,causeId:t,conversationServiceUrl:e.conversationUrl.Location,callOptions:n,offerGenerationTime:void 0}),this.http.cancelRequestIfPending(u3.JOIN_CONVERSATION.name,t,void 0,i),this.http.cancelRequestIfPending(u3.START_CALL.name,t,void 0,i),this.joinGivenConversation(e.conversationUrl.Location,e.correlationId,this.lastUsedOutgoingMediaContent,this.mediaTypesToUse,void 0,n,t,this.skipOfferGenerationForStreamingUser)}}handleCallProgress(e){this.telemetryHelper.recordIncomingEvent(cr,e);let t=sk(e);this.logger.info(`[${t}][handleCallProgress]`);let i=e.body.callProgress;this.fsmState===sr.SIGNALING_FSM_STATE.OUTGOING&&(this.telemetryHelper.setTimeToRingDuration(),this.resetCallEstablishmentTimeout(t),this.onCallStatusChanged(sr.CALL_STATUS.RINGING,t),"forwarded"===i.status&&this.signalingSessionCallback.onCallForwarded({destinationType:i.forwardingDestinationType||"user"},t))}resetCallEstablishmentTimeout(e){let t=this.isOneToOnePSTNCall()?this.getTimeoutValue("longerOutgoingCallEstablishmentTimeoutSec"):this.getTimeoutValue("outgoingCallEstablishmentTimeoutSec");this.logger.info(`resetCallEstablishmentTimeout: ${t}s`),this.timeoutManager.stopTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.timeoutManager.startTimer(sr.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,()=>{this.handleCallEstablishmentTimeout(e)},t)}handleMediaAcknowledgement(e){this.telemetryHelper.recordIncomingEvent(dr,e);let t=e.body,i=sk(e);this.currentCallStatus!==sr.CALL_STATUS.CONNECTED?this.telemetryHelper.recordEvent(ds,{causeId:i}):this.mediaRenegotiationManager.handleMediaAcknowledgment(t,i)}handleConversationUpdate(e){let t=e.body,i=sk(e);this.logger.info(`[${i}][handleConversationUpdate]content=${t_(t)}`),this.telemetryHelper.recordIncomingEvent(lF,e),this.processConversationServiceResponse(t,i,2)}endBroadcastMeeting(e){this.logger.info(`[${e}][endBroadcastMeeting]`),this.broadcastSession=null}handleLocalParticipantUpdate(e){let t=e.body,i=sk(e);this.logger.info(`[${i}][handleLocalParticipantUpdate]content=${t_(t)}`),this.telemetryHelper.recordIncomingEvent(lU,e),this.processLocalParticipantUpdateResponse(t,i)}handleAddModalityFailure(e){let t=e.body,i=sk(e);this.logger.info(`[${i}][handleAddModalityFailure]`),this.telemetryHelper.recordIncomingEvent(cb,e),t.modalityFailure.contentSharing?this.contentSharingManager?.handleAddModalityFailure(t,i):t.modalityFailure.groupChat?this.signalingSessionCallback.onChatModalitySetupFailed({code:t.modalityFailure.groupChat.code,subCode:t.modalityFailure.groupChat.subCode,phrase:t.modalityFailure.groupChat.phrase,resultCategories:t.modalityFailure.groupChat.resultCategories},i):t.modalityFailure.broadcast&&this.broadcastSession&&this.broadcastSession.handleAddBroadcastModalityFailure(t,i)}handleAddModalitySuccess(e){let t=e.body,i=sk(e);this.logger.info(`[${i}][handleAddModalitySuccess]`),this.telemetryHelper.recordIncomingEvent(cC,e),t.modalitySuccess.contentSharing?this.contentSharingManager?.handleAddModalitySuccess(t,i):t.modalitySuccess.groupChat?this.logger.info(`[${i}][handleAddModalitySuccess] group modality ${t_(t.modalitySuccess.groupChat)}`):t.modalitySuccess.broadcast&&this.broadcastSession&&this.broadcastSession.handleAddBroadcastModalitySuccess(t,i)}handleTransferRequested(e){let t=e.body.callTransfer,i=sk(e);this.logger.info(`[${i}][handleTransferRequested]`),t.parkType?(this.telemetryHelper.recordIncomingEvent(cq,e,{type:t.parkType}),this.telemetryHelper.addSharedCorrelationId(t.sharedCorrelationId)):("voicemail"===t.target.endpointType&&this.logger.info(`[${i}][handleTransferRequested] target endpointType = ${t.target.endpointType}`),this.telemetryHelper.recordIncomingEvent(cj,e)),this.links[sr.LINKS.TRANSFER_ACCEPTANCE]=t.links.transferAcceptance,this.links[sr.LINKS.TRANSFER_COMPLETION]=t.links.transferCompletion,this.signalingSessionCallback.onTransferRequested?this.signalingSessionCallback.onTransferRequested(t,i):this.logger.info(`[${i}][handleTransferRequested] failed, no callback defined`)}handleTransferAcceptance(e){let t=sk(e);this.logger.info(`[${t}][handleTransferAcceptance]`),this.telemetryHelper.recordIncomingEvent(dk,e),this.signalingSessionCallback.onTransferAccepted?this.signalingSessionCallback.onTransferAccepted(t):this.logger.info(`[${t}][handleTransferAcceptance]failed, no callback defined`)}handleTransferCompletion(e){let t=e.body,i=sk(e);this.logger.info(`[${i}][handleTransferCompletion]`),t.sharedCorrelationId&&this.telemetryHelper.addSharedCorrelationId(t.sharedCorrelationId),t.unparkContent?.pickupCode!==void 0&&(t.unparkContent.pickupCode=t.unparkContent.pickupCode.toString(),this.telemetryHelper.recordIncomingEvent(dV,e)),this.signalingSessionCallback.onTransferCompleted?(e.body.transferCompletion&&(0===e.body.transferCompletion.code?this.telemetryHelper.recordIncomingEvent(dF,e):(this.logger.info(`[${i}][handleTransferCompletion]-1-code: ${t.transferCompletion.code}, message: ${t_(e)}`),this.telemetryHelper.recordIncomingEvent(cH,e,{code:t.transferCompletion.code,subcode:t.transferCompletion.subCode,resultCategories:t.transferCompletion.resultCategories}))),this.signalingSessionCallback.onTransferCompleted(t,i)):(e.body.transferCompletion&&(e.body.transferCompletion.code===sr.CALL_END_CODE.NETWORK_ERROR?this.telemetryHelper.recordIncomingEvent(dN,e):this.telemetryHelper.recordIncomingEvent(cH,e,{code:t.transferCompletion.code,subcode:t.transferCompletion.subCode,resultCategories:t.transferCompletion.resultCategories})),this.logger.info(`[${i}][handleTransferCompletion]failed, no callback defined`))}handleRosterUpdate(e,t){let i=e.body,n=sk(e);if(this.disposing||this.disposed)return void this.logger.info(`[${n}][handleRosterUpdate]failed=ignore call ending or ended`);this.internalHandleRosterUpdate(i,t,n)}handleNewMediaOffer(e){let t=sk(e);this.telemetryHelper.recordIncomingEvent(dd,e);let i=e.body.mediaOfferReady.mediaContent;this.callUsesMixer=i.fromMixer,this.signalingSessionCallback.onNewOffer({mediaContent:i,renegotiation:!1},t)}internalHandleRosterUpdate(e,t,i){if(e&&"Delta"!==e.type&&"MultiPartyEndpoint"!==e.type)return void this.logger.warn(`[${i}][internalHandleRosterUpdate] roster.type=${e.type} is invalid`);this.logger.info(`[${i}][internalHandleRosterUpdate]`);try{this.participantManager.handleRosterUpdate(e,t,i),this.contentSharingManager?.handleIncomingContentSharingFromRoster(e,t,i)}catch(n){let t={code:sr.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:sr.CALL_END_SUB_CODE.ROSTER_HANDLING_INVALID_SERVICE_RESPONSE,phrase:n?.toString()};throw this.logger.info(`[${i}][internalHandleRosterUpdate] ${tI(t)}`),this.telemetryHelper.recordRosterEvent(e,lL,i),t}}scheduleKeepAlives(e){let t=.9*e*1e3;this.logger.info(`scheduleKeepAlives: every ${t} milliseconds`),this.keepAliveInterval=t,this.keepAliveTimer=window.setInterval(this.sendKeepAlive.bind(this),this.keepAliveInterval)}scheduleConversationKeepAlive(){if(!this.conversationKeepAliveTimer&&!this.disposed){if(!this.conversationKeepAliveInterval){let e=tL(1e3*this.signalingAgentConfig.csaTimeoutConfiguration.conversationKeepAliveTimeoutSec);this.logger.info(`sendConversationKeepAlive: every ${e} milliseconds`),this.conversationKeepAliveInterval=e}this.conversationKeepAliveTimer=window.setInterval(this.sendConversationKeepAlive.bind(this),this.conversationKeepAliveInterval)}}sendConversationKeepAlive(){if(this.logger.info("sendConversationKeepAlive"),this.disposed)return void this.logger.info("sendConversationKeepAlive ignored");this.logger.info(`sendConversationKeepAlive keepAlive count = ${this.conversationKeepAliveCount++}`),this.sendToUpdateConversationLinks(!0)}sendKeepAlive(){if(this.logger.info("sendKeepAlive"),this.disposed)return void this.logger.info("sendKeepAlive ignored");this.logger.info(`sendKeepAlive keepAlive count = ${this.keepAliveCount++}`),this.sendToKeepAliveUrl(null)}sendToUpdateConversationLinks(e,t=sp()){if(this.disposed)return Promise.resolve();let i=this.logger.createChild(`[${t}][sendToUpdateConversationLinks]`,this.correlationId),n=e?pi(this):{},r=e?u3.UPDATE_CONVERSATION_LINKS.name:u3.SEND_CONVERSATION_KEEP_ALIVE.name,s=this.links[sr.LINKS.NOTIFICATION_LINKS];return(i.info(`shouldUpdateUrl: ${e}, url: ${s}, payload: ${t_(n)}`),s)?(this.conversationKeepAliveTimer&&(window.clearInterval(this.conversationKeepAliveTimer),this.conversationKeepAliveTimer=0),this.http.sendPostRequest({url:s,payload:n,withoutTrouter:!0,requestName:r,causeId:t}).then(e=>{this.disposed||(this.telemetryHelper.recordEvent(dh,{causeId:t}),this.processConversationServiceResponse(e.response,t,2))}).catch(e=>{let i=sM(e,this.signalingAgentConfig),n=sH(i.error.code);this.logger.info(`[${t}][updateConversationLinks] error: ${t_(i)}, retryable: ${n}`),this.disposed||(this.telemetryHelper.recordEvent(dg,{causeId:t,...i.error}),n?this.scheduleConversationKeepAlive():this.links[sr.LINKS.NOTIFICATION_LINKS]=null)})):Promise.resolve()}sendToKeepAliveUrl(e,t=sp()){let i=this.logger.createChild(`[${t}][sendToKeepAliveUrl]`,this.correlationId);return(i.info(`payload: ${t_(e)}`),window.clearInterval(this.keepAliveTimer),this.disposed)?Promise.resolve():(this.telemetryHelper.recordEvent(dC),this.http.sendPostRequest({url:this.links[sr.LINKS.KEEPALIVE],payload:e,requestName:u3.SEND_KEEP_ALIVE.name,withoutTrouter:!0,causeId:t}).then(()=>{this.restartKeepAliveInterval(t)}).catch(e=>{let n=sM(e,this.signalingAgentConfig);i.info(`error: ${t_(n)}`),this.restartKeepAliveInterval(t,!0,n.error)}))}handleCallEstablishmentTimeout(e,t,i){let n={code:sr.CALL_END_CODE.TIMEOUT,subCode:t||sr.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:i||sr.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT,resultCategories:[rV]};if(this.isPromotingToRealtime)return void this.onPromotionCompleted(!0,n,e);this.telemetryHelper.recordEvent(ci),this.telemetryHelper.setTerminatingData({terminatingEnd:hi.LOCAL,resultValue:hn.FAILURE,resultDetail:n.phrase,endCode:n.code,endSubCode:n.subCode,causeId:e,resultCategories:n.resultCategories}),this.fsmState=sr.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(sr.CALL_STATUS.LOCAL_TERMINATED,e,n),this.dispose(n,e)}handleCallTransferTimeout(e,t){if(this.disposed)return void this.logger.info("Transfer: handleCallTransferTimeout ignored");let i={code:sr.CALL_END_CODE.TIMEOUT,phrase:sr.CALL_END_PHRASE.TRANSFER_COMPLETION_TIMEOUT};this.signalingSessionCallback.onTransferCompleted&&(!1===t?this.telemetryHelper.recordEvent(cH,{code:sr.CALL_END_CODE.TIMEOUT,subcode:sr.CALL_END_SUB_CODE.TRANSFER_COMPLETE_TIMEOUT,causeId:e}):!0===t&&this.telemetryHelper.recordEvent(dx,{causeId:e}),this.signalingSessionCallback.onTransferCompleted({transferCompletion:i},e))}checkCorrelationIdChange(e,t){if(e&&e.headers){let i=e.headers.get(sr.HEADERS.CORRELATION_ID);if(i&&i.length){let n=[rG.CONV_CONTENT_SHARING_UPDATE,rG.CONV_CONTENT_SHARING_END].some(t=>e.url&&s_(e.url,t));this.correlationId===i||n||(this.logger.info(`[${t}]checkCorrelationIdChange:${this.correlationId} => ${i}`),this.telemetryHelper.addChangingCorrelationId(this.correlationId,i),this.updateCorrelationId(i,t))}}}getCommandUrlPresence(){let e=0;return this.links[sr.LINKS.MUTE]&&(e|=1),this.links[sr.LINKS.UNMUTE]&&(e|=2),e}getCallNotFoundTransactionEnd(){return{code:sr.CALL_END_CODE.CALL_DOES_NOT_EXIST,subCode:0,phrase:sr.CALL_END_PHRASE.CALL_DOES_NOT_EXIST}}dispose(e,t){this.disposed||(this.logger.info(`[${t}][dispose] end reason ${t_(e)}`),this.disposed=!0,this.disposing=!1,this.tearDownConnectionCheck(),this.conversationKeepAliveTimer&&(window.clearInterval(this.conversationKeepAliveTimer),this.conversationKeepAliveTimer=0),this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.brokerService&&this.brokerService.dispose(),this.http.cancelAllRequests(t).then(()=>{this.signalingAgent.onCallCompleted(this.sessionId,t),this.signalingAgentConfig.trouterUrlGetter&&this.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed.off(this.onTrouterUrlChanged),this.signalingAgentConfig.trouterServiceProvider&&this.signalingAgentConfig.trouterServiceProvider.offStateChanged(this.onTrouterStateChanged),this.timeoutManager.dispose(),this.timeoutManager=null,this.participantManager.dispose(e,t),this.callOperationHandler.dispose("call ended",e,t),this.participantManager=null,this.mediaRenegotiationManager?.dispose(),this.mediaRenegotiationManager=null,this.contentSharingManager?.dispose(e,t),this.contentSharingManager=null,this.telemetryHelper.dispose(),this.telemetryHelper=null,this.webRtcSignalingManager.dispose(),this.webRtcSignalingManager=null}))}};function pf(e,t,i,n,r,s){return new pp(e,t,i,n,r,s)}var pm=class{constructor(e){this.endpointId=sm(),this.signalingSessions={},this.clientSupportsGenericTokenAPI=!1,this.getNewSignalingSession=(e,t,i,n)=>{let r=sp();sy(e,"selfParticipant should be a non null value"),sy(t,"signalingSessionCallback should be a non null value");let s=i||sm();sS(s,"signalingSession id generated cannot be null or empty"),this.checkConfigChange(r);let a=pf(e,t,this.signalingAgentConfig,s,this,n),o=a.sessionId;return this.signalingSessions[o]=a,this.logger.info(`[${r}]Created new signalingSession with correlation ID ${s} and session ID ${o}`),a},this.resolvePotentialCallConflict=e=>{let t,i=sp();if(this.logger.info(`[${i}][resolvePotentialCallConflict]`),e.multiParty)return;let n=Object.values(this.signalingSessions).find(t=>this.isSessionInConflictingState(t,e));if(!n||!(t=e.isIncomingCall?this.getConflictingSessionToEnd(e,n):this.getConflictingSessionToEnd(n,e)))return;let r=t===e?n:e;if(this.logger.info("Call conflict done.",` conflictingSession.correlationId=${n.correlationId}`,` conflictingSession.urlIdentifier=${n.urlIdentifier}`,` sessionToEnd.correlationId=${t.correlationId}`,` sessionToEnd.urlIdentifier=${t.urlIdentifier}`),t.telemetryHelper.setConflictingCallId(r.correlationId),t.telemetryHelper.recordEvent(l3),this.signalingAgentConfig.endConflictedCall)return this.endConflictedSession(t,i),t},this.handleIncomingNotification=e=>{if(sy(e,"request should be a non null value"),this.logger.info(`handleIncomingNotification to : ${e.url}`),!e.body&&!e.rawBody)return this.logger.error("request has no body"),this.buildNotificationResponse(sr.HTTP_STATUS_CODES.BAD_REQUEST);let t=sr.HTTP_STATUS_CODES.OK,i=sl(e.url);if(i){let n=this.signalingSessions.hasOwnProperty(i);if(this.logger.info(`Is session found:${n}`),n){let t=this.signalingSessions[i];if(e.headers=new sa(e.headers),sL(e.headers))try{if(!sF(e.headers))throw Error("Unsupported encoding");let t=s$(e.rawBody);e.body=JSON.parse(t)}catch(e){return t.telemetryHelper.recordEvent(cQ),this.buildNotificationResponse(sr.HTTP_STATUS_CODES.BAD_REQUEST)}if(t.canHandleIncomingMsgSync(e))return t.handleIncomingMsgSync(e);window.setTimeout(()=>{if(this.signalingSessions.hasOwnProperty(i)){let t=this.signalingSessions[i];t.handleIncomingMsgAsync(e).catch(e=>{t&&t.telemetryHelper&&t.telemetryHelper.recordEvent(c2),this.logger.error(`handling IncomingMsg failed with error: ${e}`)})}},0)}else this.logger.info(`Incoming message for session ID ${i}, but session was not found!`),t=sr.HTTP_STATUS_CODES.NOT_FOUND}else this.logger.error(`Could not retrieve session ID from Url path. Path = ${e.url}`),t=sr.HTTP_STATUS_CODES.BAD_REQUEST;let n=this.buildNotificationResponse(t);return this.logger.info(`Result code:${t_(n)}`),n},this.onCallCompleted=(e,t)=>{this.signalingSessions.hasOwnProperty(e)?(delete this.signalingSessions[e],this.logger.info(`[${t}][onCallCompleted] Session ID ${e} found. Deleted from signalingSession table`)):this.logger.info(`[${t}][onCallCompleted] Session ID ${e} not found. Could not delete from signalingSession table`)},this.applyAuthTokenCacheConfig=e=>{this.signalingAgentConfig.enableTokenCache?(this.authTokenManager.setTokenCaching(!0,e),this.signalingAgentConfig.enableTokenPrefetch&&this.authTokenManager.getToken(e).then(()=>{this.logger.info(`[${e}] token prefetch success`)}).catch(t=>{this.logger.info(`[${e}] token prefetch failure, error=${t_(t)}`)})):this.authTokenManager.setTokenCaching(!1,e),this.signalingAgentConfig.enableTokenCacheForGenericTokenAPI?this.authTokenManager.setTokenCachingForGenericTokenAPI(!0,e):this.authTokenManager.setTokenCachingForGenericTokenAPI(!1,e)},this.endConflictedSession=(e,t)=>{this.logger.info("Call conflict, ending signalingSession with callId=",e.correlationId,"urlIdentifier=",e.urlIdentifier),e.endAsync({code:sr.CALL_END_CODE.CONFLICT,subCode:sr.CALL_END_SUB_CODE.CONFLICT_IN_NG,phrase:sr.CALL_END_PHRASE.CONFLICT},{forEveryone:!1,causeId:t})},this.getConflictingSessionToEnd=(e,t)=>{if(!sh(e.incomingCallCallerId)||!sh(t.participantManager.localParticipant.id))return;let i=sg(e.incomingCallCallerId),n=t.participantManager.getParticipantsToInitiateCallWith();if(0===n.length)return;let r=sg(n[0].id),s=sg(t.participantManager.localParticipant.id);if(r===i)return s>i?e:t},this.isSessionInConflictingState=(e,t)=>{if(!e)return this.logger.info("Call conflict, ignore, session already disposed"),!1;let i=[sr.CALL_STATUS.IDLE,sr.CALL_STATUS.CONNECTING,sr.CALL_STATUS.RINGING];return!e.multiParty&&i.indexOf(e.getCallStatus())>-1&&t.isIncomingCall!==e.isIncomingCall},this.buildNotificationResponse=(e,t)=>this.signalingAgentConfig.supportsSynchronousTrouterResponse?{resultCode:e,responseBody:t}:e,hc(e),this.signalingAgentConfig=e,this.logger=e.logger.createChild("SignalingAgent"),sy(e,"signalingAgentConfig should be a non null value"),this.logger.info(e.isWebRtcEnabled?"webRTC enabled":"ORTC enabled");let t={aadTokenExpirationTimeInSeconds:e.aadTokenExpirationTimeInSeconds,caeTokenExpirationTimeInSeconds:e.caeTokenExpirationTimeInSeconds,disableTokenMigrationHeader:e.disableTokenMigrationHeader,enablePublishTokenTelemetry:e.enablePublishTokenTelemetry,refreshTimeBeforeTokenTimeoutInSeconds:e.refreshTimeBeforeTokenTimeoutInSeconds,forceClearExpiredTokens:e.forceClearExpiredTokens,enableRefreshToken:e.enableRefreshToken,enableRefreshTokenRetry:e.enableRefreshTokenRetry,enableRefreshTokenRetryInSeconds:e.enableRefreshTokenRetryInSeconds};this.authTokenManager=hv(this.logger,e.skypeToken,e.csaTimeoutConfiguration,t,e.telemetryManager),this.applyAuthTokenCacheConfig(sp()),sa.useLowerCaseHeaders=e.forceLowercaseHttpHeaders}updateSignalingAgentConfig(e){let t=sp(),i=JSON.stringify(e,(e,t)=>e?String(t):t);this.logger.info(`[${t}] updateSignalingAgentConfig, SignalingAgentConfig: ${i}`),this.logger.info(`[${t}] ecsEtag=${e.ecsEtag}`),hc(e),this.updatedSignalingAgentConfig=e;let n={aadTokenExpirationTimeInSeconds:e.aadTokenExpirationTimeInSeconds,caeTokenExpirationTimeInSeconds:e.caeTokenExpirationTimeInSeconds,refreshTimeBeforeTokenTimeoutInSeconds:e.refreshTimeBeforeTokenTimeoutInSeconds,disableTokenMigrationHeader:e.disableTokenMigrationHeader,enablePublishTokenTelemetry:e.enablePublishTokenTelemetry,forceClearExpiredTokens:e.forceClearExpiredTokens,enableRefreshToken:e.enableRefreshToken,enableRefreshTokenRetry:e.enableRefreshTokenRetry,enableRefreshTokenRetryInSeconds:e.enableRefreshTokenRetryInSeconds};this.authTokenManager?this.authTokenManager.updateTokenSettings(n):this.authTokenManager=hv(this.logger,e.skypeToken,this.signalingAgentConfig.csaTimeoutConfiguration,n,e.telemetryManager),sa.useLowerCaseHeaders=e.forceLowercaseHttpHeaders}updateUrls(e,t,i){this.logger.info(`updateUrls: conversationServiceUrl: ${e}, uploadLogRequestUrl: ${t}, enforceUrls: ${i}`),this.updatedSignalingAgentConfig=this.updatedSignalingAgentConfig||this.signalingAgentConfig,i||!this.updatedSignalingAgentConfig.isConversationServiceUrlFromEcs?this.updatedSignalingAgentConfig.conversationServiceUrl=e||this.updatedSignalingAgentConfig.conversationServiceUrl:this.updatedSignalingAgentConfig.conversationServiceUrl=this.updatedSignalingAgentConfig.conversationServiceUrl||e,i||!this.updatedSignalingAgentConfig.isUploadLogRequestUrlFromEcs?this.updatedSignalingAgentConfig.uploadLogRequestUrl=t||this.updatedSignalingAgentConfig.uploadLogRequestUrl:this.updatedSignalingAgentConfig.uploadLogRequestUrl=this.updatedSignalingAgentConfig.uploadLogRequestUrl||t}update(e){this.logger.info(`update accountConfiguration ${JSON.stringify(e)}`),e&&e.clientSupportsGenericTokenAPI!==this.clientSupportsGenericTokenAPI&&(this.clientSupportsGenericTokenAPI=e.clientSupportsGenericTokenAPI,this.authTokenManager.updateTokenSettings({clientSupportsGenericTokenAPI:this.clientSupportsGenericTokenAPI})),this.accountConfig=e}sendPushAsync(e,t,i,n,r=sp()){let s=new hS(this.signalingAgentConfig.piiScrubber),a=`sendPush[local participant mri = ${s.scrubMriOrOmit(e)}][recipientList = ${s.scrubMriOrOmit(t)}][headers = ${i})][causeId = ${r}]`;if(!e?.id)return this.logger.info(`${a} Empty localParticipantId`),Promise.reject("invalid localParticipantId");if(!t||0===t.length||t.every(e=>e&&""===e.id))return this.logger.info(`${a} Empty recipientList`),Promise.reject("invalid recipientList");if(!i)return this.logger.info(`${a} Empty headers`),Promise.reject("invalid headers");if(!n||null===sA(n))return this.logger.info(`${a} Invalid body.`),Promise.reject("invalid body");let o={...sA(n),...{To:Array.from(t,e=>e.id),From:e.id}},l=new sa(i);l.hasOwnPropertyCaseInsensitive(sr.HEADERS.CORRELATION_ID)||l.set(sr.HEADERS.CORRELATION_ID,iW()),l.hasOwnPropertyCaseInsensitive(sr.HEADERS.MESSAGE_ID)||l.set(sr.HEADERS.MESSAGE_ID,iW()),l.hasOwnPropertyCaseInsensitive(sr.HEADERS.PARTICIPANT_ID)||l.set(sr.HEADERS.PARTICIPANT_ID,iW()),l.hasOwnPropertyCaseInsensitive(sr.HEADERS.CONTENT_TYPE)||l.set(sr.HEADERS.CONTENT_TYPE,"application/json"),l.hasOwnPropertyCaseInsensitive(sr.HEADERS.CLIENT_USER_AGENT)&&l.set(sr.HEADERS.CLIENT_USER_AGENT,l.get(sr.HEADERS.CLIENT_USER_AGENT)+`/TsCallingVersion=${tX()}/Ovb=${t0()}`);let c=this.signalingAgentConfig.httpRequestDispatcher.getRequestOptions("POST",l?.getAll(),JSON.stringify(o),3e4);return new Promise((e,t)=>{this.signalingAgentConfig.httpRequestDispatcher.postAsync(this.signalingAgentConfig.uploadLogRequestUrl||sr.URL_DEFAULTS.UPLOAD_LOG_URL,c).then(()=>{e()}).catch(e=>{t(e)})})}getSignalingSession(e){for(let t of Object.keys(this.signalingSessions)){let i=this.signalingSessions[t];if(i.correlationId===e)return i}return null}updateToken(e,t,i,n,r){this.authTokenManager.updateToken(e,t,i,n,r)}setTokenRequiredCallBack(e){this.authTokenManager.setTokenRequiredCallBack(e)}resetAuthTokenManager(){this.setTokenRequiredCallBack(null),this.authTokenManager.setDisableTimerFlag(!0),this.authTokenManager.dispose(),this.signalingAgentConfig?.nullifyAuthTokenManagerOnReset&&(this.authTokenManager=null)}checkConfigChange(e){this.updatedSignalingAgentConfig&&this.updatedSignalingAgentConfig!==this.signalingAgentConfig&&(this.signalingAgentConfig=this.updatedSignalingAgentConfig,this.updatedSignalingAgentConfig=null,this.applyAuthTokenCacheConfig(e))}},pv=/;aliases=.*$/i,pS="8:",py=";aliases=",pC="2:",pb="4:";function pT(e){return e?e.replace(pv,""):e}function pE(e,t){let i=e;return t&&(i+=py+pC+t),i}var p_=(e,t)=>t&&void 0!==t.phase&&!!e[t.phase],pI=(e,t)=>t&&void 0!==t.phase&&t.phase===e;function pw(e){let t={},i=e=>{let i={status:"Pending"};t[e]=i},n=(e,i)=>{t[e].t=i,delete t[e].status},r=(e,i,n)=>{t[e].status="Failed",t[e].t=i,t[e].reason=t_(n)};return{execute:async(s,a)=>{let o=e.createChild(`[phase=${s}]`);i(s),o.info("started");let l=new Date().getTime();try{let e=await a(),t=new Date-l;return o.logSuccess(`done, time=${t}`),n(s,t),e}catch(i){let e=new Date-l;throw o.logFailure(`time=${e}, error=${t_(i)}`),r(s,e,i),{phase:s,error:i,phases:t}}},executeSync:(s,a)=>{let o=e.createChild(`[phase=${s}]`);o.info("started"),i(s);let l=new Date().getTime();try{let e=a(),t=new Date-l;return n(s,t),o.logSuccess(`done, time=${t}`),e}catch(i){let e=new Date-l;throw o.logFailure(`time=${e}, error=${t_(i)}`),r(s,e,i),{phase:s,error:i,phases:t}}},getTelemetryData:()=>t}}function pP(e,t){return -1!==t.indexOf(e)}var pR={0:[1,2,8,6,10,11,9],1:[2,6,7,10,13],2:[1,3,6,7,9,10,13,14],3:[6,7,4,5,10,13],8:[1,11,10,2,9,6,7],4:[6,7,3,5,10,13],5:[6,7,3,4,10,13],9:[3,6,7,10,13],10:[3,6,7,9,4,5,13,15],13:[3,6,7,4,5],14:[3,6,7,10,13],15:[3,6,7,4,5,13],11:[12,1,2,6,7],12:[2,6,7],6:[7],7:[]};(e=>{let t,i,n,r;(e=>{e.Off="off",e.BackgroundBlur="blur",e.BackgroundReplacement="replacement",e.PresenterMode="presenterMode",e.None="none"})(t=e.VideoEffectType||(e.VideoEffectType={})),(e=>{e.Default="default",e.HighPerformance="high-performance",e.LowPower="low-power"})(i=e.PowerPreference||(e.PowerPreference={})),(e=>{e.Wasm="Wasm",e.Webgl2="Webgl2"})(n=e.ProcessorType||(e.ProcessorType={})),(e=>{e[e.ExternalParam=0]="ExternalParam",e[e.Performance=1]="Performance",e[e.RendererSize=2]="RendererSize",e[e.ProfileSuggestion=3]="ProfileSuggestion"})(r=e.EffectQualityChangeReason||(e.EffectQualityChangeReason={}))})(m||(m={})),(e=>{let t,i,n,r,s;(e=>{e[e.P2P=0]="P2P",e[e.Conference=1]="Conference",e[e.PSTN=2]="PSTN",e[e.BroadcastingConf=3]="BroadcastingConf"})(t=e.CallType||(e.CallType={})),(e=>{e[e.Default=0]="Default",e[e.LongRangeSpeaker=1]="LongRangeSpeaker",e[e.Auditorium=2]="Auditorium"})(i=e.AudioUsageMode||(e.AudioUsageMode={})),(e=>{e[e.Normal=0]="Normal",e[e.Soc=1]="Soc",e[e.Mobile=2]="Mobile",e[e.NoisyTimestamps=3]="NoisyTimestamps"})(n=e.AecPerfProfile||(e.AecPerfProfile={})),(e=>{e[e.Off=0]="Off",e[e.SkypeNS=1]="SkypeNS",e[e.SkypeAEC=2]="SkypeAEC",e[e.SkypeVQE=3]="SkypeVQE",e[e.DeepNS=4]="DeepNS",e[e.DeepVQE=5]="DeepVQE"})(r=e.VqeMode||(e.VqeMode={})),(e=>{e.Off="Off",e.NoiseSuppressionDeep="Deep NS",e.NoiseSuppressionClassic="Classic NS",e.EchoCancellationClassic="Classic AEC",e.VoiceQualityEnhancementClassic="Classic VQE",e.VoiceQualityEnhancementDeep="Deep VQE"})(s=e.AudioEffectType||(e.AudioEffectType={}))})(v||(v={})),(e=>{let t,i;(e=>{e[e.None=0]="None",e[e.Software=1]="Software",e[e.Hardware=2]="Hardware"})(t=e.FrameType||(e.FrameType={})),(e=>{e[e.Default=0]="Default",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error"})(i=e.LogLevel||(e.LogLevel={}))})(S||(S={}));var pA=i(892891),pM=((o=pM||{})[o.CallStateChanged=0]="CallStateChanged",o[o.TrouterStateChanged=1]="TrouterStateChanged",o[o.MultiPartyModeSet=2]="MultiPartyModeSet",o[o.MediaRetargetSucceeded=3]="MediaRetargetSucceeded",o[o.MediaRetargetFailed=4]="MediaRetargetFailed",o),pD=((l=pD||{})[l.StartModality=0]="StartModality",l[l.StopModality=1]="StopModality",l[l.StreamStateChanged=2]="StreamStateChanged",l[l.NegotiationStateChanged=3]="NegotiationStateChanged",l),pO=((c=pO||{})[c.SelectSource=0]="SelectSource",c[c.AttachSource=1]="AttachSource",c[c.DetachSource=2]="DetachSource",c),pk=((d=pk||{})[d.Available=0]="Available",d[d.Subscribe=1]="Subscribe",d[d.Subscribed=2]="Subscribed",d[d.Unsubscribe=3]="Unsubscribe",d[d.Unsubscribed=4]="Unsubscribed",d[d.RenderingStarted=5]="RenderingStarted",d[d.RenderingStopped=6]="RenderingStopped",d),pN=class{};pN.agentEnvironmentId="agent_environment_id",pN.correlationId="CorrelationId",pN.participantId="participant_id",pN.displayName="display_name",pN.tenantId="TenantId",pN.userHexCID="UserHexCID",pN.acsResourceId="AcsResourceId",pN.endpointId="endpoint_id",pN.mediaLegId="media_leg_id",pN.webMediaConfigIds="web_media_config_ids",pN.tsCallingVersion="ts_calling_version",pN.vdi3SessionChannelId="vdi3_session_channel_id";var px=class{};px.diagnostics="MediaDiagnostic",px.qoeStats="QoE",px.webrtcSession="webrtc_session",px.webrtcSessionInitial="webrtc_session_initial",px.realtimeTelemetry="realtimetelemetry",px.webrtcMediaSession="webrtc_call_session",px.mediaSession="pluginless_modality_session",px.callSession="pluginless_call_session";var pL=class{constructor(e){this.eventName=e,this.ended=!1,this.events=[]}setLocalUserId(e){this.localUserId=e}start(){this.ended||(this.startTime=Date.now())}end(e=0){this.ended||(this.ended=!0,this.resultCode=e)}asStatsRecord(e={}){if((0,pA.isEmpty)(this.events))return null;let t=(0,pA.uniqBy)(this.events,e=>JSON.stringify(e)).map(e=>{let t={[e.type]:e.timestamp-this.startTime};return(0,pA.isEmpty)(e.data)||(t.data=e.data),t});return{name:this.eventName,record:(0,pA.assign)({LocalUser:this.localUserId,ResultCode:String(this.resultCode),EventTimestampBag:JSON.stringify({eventStart:this.startTime,events:t})},e)}}add(e){!this.ended&&e.type&&((0,pA.isUndefined)(this.startTime)&&(this.startTime=Date.now()),(0,pA.isUndefined)(e.timestamp)&&(e.timestamp=Date.now()),this.events.push(e))}},pF=class e extends pL{constructor(){super(px.callSession)}callStateChanged(t){super.add({type:pM[0],data:e.callStateToString[t]||t})}event(e){super.add({type:pM[e]})}};pF.callStateToString={0:"None",1:"Notified",2:"Connecting",3:"Connected",4:"LocalHold",5:"RemoteHold",6:"Disconnecting",7:"Disconnected",8:"Observing",10:"Lobby"};var pU=pF,p$=class e extends pL{constructor(t,i){super(px.mediaSession),this.mediaType=t,this.mediaDirection=i,this.streamDirection=e.mediaDirectionToStream[this.mediaDirection]}addEvent(e,t){super.add({type:e,data:t})}lifecycle(e){this.addEvent(pD[e])}streamStateChanged(t,i=this.streamDirection){let n=pD[2];this.addEvent(n,{state:e.streamStateToString[t],direction:e.streamDirectionToString[i]})}negotiationStateChanged(t,i,n=this.streamDirection){let r=pD[3];this.addEvent(r,{state:e.negotiationStateToString[t],reason:i})}asStatsRecord(t={}){return super.asStatsRecord((0,pA.assign)({MediaType:e.mediaTypeToString[this.mediaType],Role:e.mediaDirectionToRole[this.mediaDirection]},t))}};p$.negotiationStateToString={started:"NegotiationStarted",rejected:"NegotiationRejected",completed:"NegotiationCompleted"},p$.streamStateToString={created:"StreamCreated",started:"StreamStarted",active:"StreamActive",inactive:"StreamInactive",stopped:"StreamStopped",removed:"StreamRemoved",failed:"StreamFailed",cancelled:"StreamCancelled"},p$.streamDirectionToString={send:"Send",receive:"Receive"},p$.mediaTypeToString={0:"Audio",1:"Video",2:"ScreenShare",3:"Data"},p$.mediaDirectionToRole={1:"Receiver",2:"Sender",4:"Bidirectional"},p$.mediaDirectionToStream={1:"receive",2:"send"};var pV=p$,pB=class extends pV{constructor(){super(0,4)}start(){super.start(),super.lifecycle(0)}stop(){super.lifecycle(1)}},pH=class extends pV{constructor(e){super(e,2),this.mediaType=e}start(){super.start(),super.lifecycle(0)}stop(){super.lifecycle(1)}event(e){super.addEvent(pO[e])}},pj=class extends pV{constructor(e,t){super(e,1),this.mediaType=e,this.remoteParticipantId=t,this.rendererCounter=0}newRendererId(){return this.rendererCounter+=1,String(this.rendererCounter)}event(e,t,i){super.addEvent(pk[e],(0,pA.isUndefined)(i)?{rendererId:t}:{rendererId:t,sourceId:i})}asStatsRecord(){return super.asStatsRecord({TargetUser:this.remoteParticipantId})}},pq=class{constructor(){this.allStats=[],this.ended=!1}setLocalUserId(e){this.localUserId=e}get call(){return this.callStats||this.startCall()}get audio(){return this.audioStats||this.newSession(0)}get video(){return this.videoStats||this.newSession(1)}get screenShare(){return this.sharingStats||this.newSession(2)}renderer(e,t){let i=this.renderingStats[t];return i||(i=this.renderingStats[t]=this.receive(e,t)),i}startCall(){return this.callStats?this.callStats:(this.callStats=new pU,this.callStats.start(),this.addStats(this.callStats))}endCall(e=0){this.ended=!0,this.call.end(e),this.allStats.forEach(e=>e.end()),this.cleanUp()}cleanUp(){this.audioStats&&(this.audioStats.stop(),this.audioStats=null),this.videoStats&&(this.videoStats.stop(),this.videoStats=null),this.sharingStats&&(this.sharingStats.stop(),this.sharingStats=null)}newSession(e){let t;switch(e){case 0:t=this.audioStats=new pB;break;case 1:t=this.videoStats=new pH(e);break;case 2:t=this.sharingStats=new pH(e)}return this.addStats(t)}receive(e,t){let i=new pj(e,t);return i.start(),this.addStats(i)}buildStatsRecords(){return this.allStats.map(e=>e.asStatsRecord()).filter(e=>!!e)}addStats(e){return this.ended||(this.allStats.push(e),e.setLocalUserId(this.localUserId)),e}},pW=class e{constructor(){this.localStats=new pq,this.tsCallingVersion=tX()}setVDI3SessionChannelId(e){this.vdi3SessionChannelId=e}setCallId(e){this.callId=e}setTenantId(e){this.tenantId=e}setUserHexCID(e){this.userHexCID=e}setParticipantId(e){this.participantId=e}setDisplayName(e){this.displayName=e}setEndpointId(e){this.endpointId=e}setMediaLegId(e){this.mediaLegId=e}setMediaStats(e){this.mediaStats=e}setAcsResourceId(e){this.acsResourceId=e}appendDataChannelInfo(e){this.mediaStats?.data&&e&&(this.mediaStats.data.DataHandlers=e)}appendSharingControlInfo(e){this.mediaStats?.data&&(this.mediaStats.data.SharingControlEnabled=e?"true":"false")}appendMediaControlPlaneInfo(e){this.mediaStats?.data&&e&&(this.mediaStats.data.MediaControlPlane=e)}appendTerminationInfo(e,t){this.mediaStats?.data&&(this.mediaStats.data.TerminatedReason=`${e}`,this.mediaStats.data.TerminatedState=`${t}`)}appendPictureInPictureInfo(e){this.mediaStats?.data&&e&&(this.mediaStats.data.PictureInPicture=e)}appendCallDeviceManagerInfo(e){this.mediaStats?.data&&e&&(this.mediaStats.data.CallDeviceManager=e)}buildFromMediaStats(){return this.mediaStats?.type==="WebRtcMediaStats"?[this.buildEvent(this.mediaStats.data,px.webrtcSession)]:[]}buildShortCallEvent(e){let t={};return t[pN.correlationId]=this.callId||"",t[pN.participantId]=this.participantId||"",t[pN.displayName]=new tr(this.displayName||"",1),t[pN.tenantId]=this.tenantId||"",t[pN.tsCallingVersion]=this.tsCallingVersion||"",t[pN.vdi3SessionChannelId]=this.vdi3SessionChannelId||"",t.metrics_TerminationReason_code=new tr(e.data.metrics.TerminationReason_code,0),t.metrics_TerminationReason_subCode=new tr(e.data.metrics.TerminationReason_subCode,0),t.metrics_eventType=new tr(e.eventType,0),[{eventName:px.webrtcMediaSession,props:this.buildProps(e.data,null,t)}]}buildMediaTelemetry(){if(!this.mediaStats)return;let e=this.buildEvent(this.mediaStats.data,null).props,t={};return Object.keys(e).forEach(i=>{void 0===e[i].piiKind?t[i]=e[i]:t[i]=e[i].value}),t}buildMidCallTelemetry(e){if(!this.mediaStats)return[];let t=this.buildEvent(this.mediaStats.data,px.webrtcSession),i=t.props,n=e.reduce((e,t)=>(i[t]&&(e[t]=i[t]),e),{});return[{eventName:t.eventName,props:n}]}buildFromCallSetupStats(e){return this.mediaStats?.type==="WebRtcMediaStats"?(this.mediaStats.data.trouterUrl=e,[this.buildEvent(this.mediaStats.data,px.webrtcSessionInitial)]):[]}buildFromLocalStats(){return this.localStats.buildStatsRecords().map(e=>this.buildEvent(e.record,e.name))}buildEvent(t,i){let n={};return n[pN.agentEnvironmentId]=e.agentEnvironmentId,n[pN.correlationId]=this.callId||"",n[pN.tenantId]=this.tenantId||"",n[pN.userHexCID]=this.userHexCID||"",n[pN.participantId]=this.participantId||"",n[pN.displayName]=new tr(this.displayName||"",1),n[pN.endpointId]=this.endpointId||"",n[pN.mediaLegId]=this.mediaLegId||"",n[pN.webMediaConfigIds]=this.webMediaConfigIds||"",n[pN.tsCallingVersion]=this.tsCallingVersion||"",n[pN.acsResourceId]=this.acsResourceId||"",n[pN.vdi3SessionChannelId]=this.vdi3SessionChannelId||"",{eventName:i,props:this.buildProps(t,null,n)}}normalizeKey(e){return e.replace(/[^a-zA-Z0-9._]/g,"_")}buildProps(e,t,i){return Object.keys(e).forEach(n=>{let r=this.normalizeKey(n),s=t?`${t}_${r}`:r,a=e[n];if((0,pA.isString)(a))i[s]=this.getPiiAwareValue(n,a);else if((0,pA.isArray)(a)){if(a.length>0){let e=a,t=e.map(e=>e.value).toString();i[s]=new tr(t,e[0].type)}}else if((0,pA.isObject)(a))if(a.__VALUE__){let e=a;(0,pA.isBoolean)(e.value)&&(e.value=e.value?"true":"false"),i[s]=new tr(e.value,e.type)}else this.buildProps(a,s,i)}),i}getPiiAwareValue(t,i){return e.piiProps.hasOwnProperty(t)?new tr(i,e.piiProps[t]):i}build(){return(0,pA.flatten)([this.buildFromMediaStats(),this.buildFromLocalStats()])}};pW.agentEnvironmentId=iW(),pW.piiProps={IPAddr:13,MACAddr:13,IPAddress:13,OpaqueData:0,LocalSite:13,RemoteSite:13,BaseAddress:13,LocalAddress:13,RemoteAddress:13,NetworkName:12,LocalUser:10,TargetUser:10,[pN.displayName]:1};var pG=pW,pz=i(892891);function pJ(e){return e?pQ(e.code,e.subCode):0}function pK(e,t){let i={clientVersion:e.clientVersion,participantId:e.participantId,endpointId:e.endpointId,endpointType:e.endpointType,endpointMetadata:e.endpointMetadata,originalId:e.originalId,capabilities:e.capabilities,clientEndpointCapabilities:e.clientEndpointCapabilities,mappedTo:e.mappedTo,meetingGroupDetails:e.meetingGroupDetails,endpointMeetingRoles:e.endpointMeetingRoles};return e.mediaStreams&&(i.mediaStreams=e.mediaStreams),e.appliedInteractivityLevel&&(i.appliedInteractivityLevel=e.appliedInteractivityLevel),e.deviceType&&(i.deviceType=e.deviceType),e.streamInformation&&32&t&&(i.streamInformation=e.streamInformation),e.propertyBag&&(i.propertyBag=e.propertyBag),e.negotiationTag&&(i.negotiationTag=e.negotiationTag),i}function pQ(e,t=null){if(e===a0)switch(t){case oT:case o_:return 44;case oE:return 55;case oI:return 56;default:return 1}if(null!==t&&t>=2e5&&t<=299999){let e=t-2e5;return oN[e]?oN[e]:0}if(null!==t&&t>=4e5&&t<=499999)return ox[e]?ox[e]:43;if(e===aZ){if(t===oa)return 64;if(t===os)return 62;if(t===ow)return 66;else if(t===oR)return 67;else if(t===oA)return 68;else if(t===oM)return 70;else if(t===oP)return 71;return 8}if(e===aX&&t===or)return 63;if(e===ot)return t===oD?69:48;if(e===oe)return 7;if(e===a6)if(t===oo)return 73;else return 59;return ok[e]?ok[e]:e}function pY(e){if(1===e)return a0;let t=Object.keys(ok).filter(t=>ok[t]===e);if(t.length>=1)for(let i of t){let t=parseInt(i);if(t&&ok[t]===e)return t}return a9}function pZ(e,t){if(void 0!==t&&3!==t&&1!==t)return{mediaType:e,isDisabled:0===t,label:hC(e)}}function pX(e){if(e.sendMediaModalities)return e;let t={mediaStates:[]},i=pZ(0,e.audioDirection?e.audioDirection:4);return i&&t.mediaStates.push(i),(i=pZ(1,e.withVideo?4:e.videoDirection))&&t.mediaStates.push(i),(i=pZ(2,e.screenshareDirection?e.screenshareDirection:1))&&t.mediaStates.push(i),e.sendMediaModalities=t,e}function p0(e){let t=p1(e.type),i=p2(e.endpointType);return{type:t,id:e.id,endpointType:i}}function p1(e){if("mri"===e)return"mri";throw"Unknown RedirectionTargetIdType"}function p2(e){switch(e){case"voicemail":return"voicemail";case"default":return"default";default:throw"Unknown RedirectionEndpointType"}}var p3=class{constructor(e){this.mediaStateConfiguration=e}isDisabled(e){if(this.mediaStateConfiguration?.mediaStates){let t=this.mediaStateConfiguration.mediaStates.find(t=>t.mediaType===e);return!!t&&!!t.isDisabled}return!1}isInactiveOrDisabled(e){if(this.mediaStateConfiguration?.mediaStates){let t=this.mediaStateConfiguration.mediaStates.find(t=>t.mediaType===e);return!t||!!t.isDisabled}return!1}isSending(e){return!!this.mediaStateConfiguration?.mediaStates&&!!this.mediaStateConfiguration.mediaStates.find(t=>t.mediaType===e&&!t.isDisabled)}disableModality(e){this.setModality(e,!0)}enableModality(e){this.setModality(e,!1)}removeModality(e){this.mediaStateConfiguration?.mediaStates&&(0,pz.remove)(this.mediaStateConfiguration.mediaStates,t=>t.mediaType===e)}setCallAcceptOptions(e){let t=this.isDisabled(1),i=this.isDisabled(2),n=this.isSending(3);if(e.sendMediaModalities)this.mediaStateConfiguration=e.sendMediaModalities;else{void 0===e.answerMediaType&&(e.answerMediaType=+!!e.withVideo);let t=e.answerMediaType,i={mediaStates:[]};switch(t){case 0:i.mediaStates.push(pZ(0,4));break;case 1:i.mediaStates.push(pZ(0,4)),i.mediaStates.push(pZ(1,4));break;case 2:i.mediaStates.push(pZ(1,0))}this.mediaStateConfiguration=i}t&&this.setModality(1,!0),i&&this.setModality(2,!0),n&&this.setModality(3,!1),e.sendMediaModalities=this.mediaStateConfiguration}setModality(e,t){if(this.mediaStateConfiguration?.mediaStates){let i=this.mediaStateConfiguration.mediaStates.find(t=>t.mediaType===e);i?i.isDisabled=t:this.mediaStateConfiguration.mediaStates.push({mediaType:e,isDisabled:t,label:hC(e)})}}};function p4(e){return e||!1===e||""===e||0===e}function p5(e){let t={};p4(e.callStartTime)&&(t.callStartTime=e.callStartTime),p4(e.callVoicemailStartOptions)&&(t.callVoicemailStartOptions=e.callVoicemailStartOptions),p4(e.invitationType)&&(t.invitationType=e.invitationType),p4(e.meetingPreferences)&&(t.meetingPreferences=e.meetingPreferences),p4(e.parkContext)&&(t.parkContext=e.parkContext),p4(e.pickupCode)&&(t.pickupCode=e.pickupCode),p4(e.participantsToNudge)&&(t.participantsToNudgeSize=e.participantsToNudge.length);let i=e.callStartOptions;if(i){let e={};p4(i.additionalEndpointProperties)&&(e.additionalEndpointProperties=i.additionalEndpointProperties),p4(i.clientEndpointCapabilities)&&(e.clientEndpointCapabilities=i.clientEndpointCapabilities),p4(i.connectionType)&&(e.connectionType=i.connectionType),p4(i.invitationDataJson)&&(e.invitationDataJson=i.invitationDataJson),p4(i.isCast)&&(e.isCast=i.isCast),p4(i.isHuddleGroupCall)&&(e.isHuddleGroupCall=i.isHuddleGroupCall),p4(i.label)&&(e.label=i.label),p4(i.maxVideoChannels)&&(e.maxVideoChannels=i.maxVideoChannels),p4(i.maxVbssChannels)&&(e.maxVbssChannels=i.maxVbssChannels),p4(i.mediaConfiguration)&&(e.mediaConfiguration=i.mediaConfiguration),p4(i.muteFlags)&&(e.muteFlags=i.muteFlags),p4(i.muted)&&(e.muted=i.muted),p4(i.negotiationTag)&&(e.negotiationTag=i.negotiationTag),p4(i.preheatFlags)&&(e.preheatFlags=i.preheatFlags),p4(i.ringOthers)&&(e.ringOthers=i.ringOthers),p4(i.routingFlags)&&(e.routingFlags=i.routingFlags),p4(i.scenario)&&(e.scenario=i.scenario),p4(i.screenshareDirection)&&(e.screenshareDirection=i.screenshareDirection),p4(i.sendMediaModalities)&&(e.sendMediaModalities=i.sendMediaModalities),p4(i.sharedLineCallInvitationContentJson)&&(e.sharedLineCallInvitationContentJson=i.sharedLineCallInvitationContentJson),p4(i.targetApplicationType)&&(e.targetApplicationType=i.targetApplicationType),p4(i.captchaContentJson)&&(e.captchaContentJson=i.captchaContentJson),p4(i.callQueueContext)&&(e.callQueueContext=i.callQueueContext),p4(i.clientEndpointDebugContent)&&(e.clientEndpointDebugContentSize=i.clientEndpointDebugContent.length),p4(i.alternateId)&&(e.alternateId=ta(i.alternateId)),p4(i.callKey)&&(e.callKeySize=i.callKey.length),p4(i.encryptedKey)&&(e.encryptedKeySize=i.encryptedKey.length),t.callStartOptions=e}return t}function p6(e){switch(e){case 0:return"Audio";case 1:return"Video";case 2:return"ScreenShare"}throw Error("MediaType required")}function p8(e){switch(e){case"Audio":return 0;case"Video":return 1;case"ScreenShare":return 2}throw Error("MediaType required")}function p9(e){switch(e){case 0:return"Monitor";case 1:return"Whisper";case 2:return"Barge";case 3:return"Takeover";default:return}}var p7="NegotiationCompleted",fe={OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"InitialAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"InitialAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",ANSWER_GENERATION_STARTED:"InitialAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"InitialAnswerGenerationEnded"},ft={OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"},fi=class{constructor(e,t){this.mediaSession=e,this.signalingSession=t,this.operationNames=fe,this.configureModalitiesAsync=this.mediaSession.configureModalitiesAsync.bind(this.mediaSession),this.getAllowedModalities=this.mediaSession.getAllowedModalities.bind(this.mediaSession),this.rejectNegotiationAsync=this.mediaSession.rejectNegotiationAsync.bind(this.mediaSession),this.createRemoteRenderer=this.mediaSession.createRemoteRenderer.bind(this.mediaSession),this.getStatsAsync=this.mediaSession.getStatsAsync.bind(this.mediaSession),this.getLastKnownStats=this.mediaSession.getLastKnownStats.bind(this.mediaSession),this.getCallTechnicalInfo=this.mediaSession.getCallTechnicalInfo.bind(this.mediaSession),this.muteHold=this.mediaSession.muteHold.bind(this.mediaSession),this.muteInputAsync=this.mediaSession.muteInputAsync.bind(this.mediaSession),this.unmuteInputAsync=this.mediaSession.unmuteInputAsync.bind(this.mediaSession),this.muteOutputAsync=this.mediaSession.muteOutputAsync.bind(this.mediaSession),this.unmuteOutputAsync=this.mediaSession.unmuteOutputAsync.bind(this.mediaSession),this.getSpeakerVolume=this.mediaSession.getSpeakerVolume.bind(this.mediaSession),this.setSpeakerVolume=this.mediaSession.setSpeakerVolume.bind(this.mediaSession),this.terminate=this.mediaSession.terminate.bind(this.mediaSession),this.createAudioElement=this.mediaSession.createAudioElement.bind(this.mediaSession),this.getSessionConfig=this.mediaSession.getSessionConfig.bind(this.mediaSession),this.getDiagnostics=this.mediaSession.getDiagnostics.bind(this.mediaSession),this.getIncomingRawAudioStream=this.mediaSession.getIncomingRawAudioStream.bind(this.mediaSession),this.getUnmixedAudioProvider=this.mediaSession.getUnmixedAudioProvider.bind(this.mediaSession),this.useNullAudioStreamClient=this.mediaSession.useNullAudioStreamClient.bind(this.mediaSession),this.getSubscriptionManager=this.mediaSession.getSubscriptionManager.bind(this.mediaSession),this.configureSpatialAudio=this.mediaSession.configureSpatialAudio.bind(this.mediaSession),this.setParticipantSpatialAudioPositions=this.mediaSession.setParticipantSpatialAudioPositions.bind(this.mediaSession),this.setCallConstraints=this.mediaSession.setCallConstraints.bind(this.mediaSession),this.startMediaDescriptionsUpdateAsync=this.mediaSession.startMediaDescriptionsUpdateAsync.bind(this.mediaSession),this.completeMediaDescriptionsUpdateAsync=this.mediaSession.completeMediaDescriptionsUpdateAsync.bind(this.mediaSession),this.rejectMediaDescriptionsUpdateAsync=this.mediaSession.rejectMediaDescriptionsUpdateAsync.bind(this.mediaSession),this.registerRemoteQualityStateChangedEvent=this.mediaSession.registerRemoteQualityStateChangedEvent.bind(this.mediaSession),this.getMediaControlPlaneInstance=this.mediaSession.getMediaControlPlaneInstance.bind(this.mediaSession),this.sendBeaconDataViaDataChannel=this.mediaSession.sendBeaconDataViaDataChannel.bind(this.mediaSession)}enableTeamsRealTimeTelemetry(){this.mediaSession.enableTeamsRealTimeTelemetry()}getMediaStatsReport(){return this.mediaSession.getMediaStatsReport()}processOfferAsync(e,t){return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_PROCESSING_STARTED),this.mediaSession.processOfferAsync(e,t).then(e=>(this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_PROCESSING_ENDED),e))}createAnswerAsync(e,t){return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_GENERATION_STARTED),this.mediaSession.createAnswerAsync(e,t).then(t=>(this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_GENERATION_ENDED),e||(this.operationNames=ft),t))}createOfferAsync(e,t){return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_GENERATION_STARTED),this.mediaSession.createOfferAsync(e,t).then(e=>(this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_GENERATION_ENDED),e))}processAnswerAsync(e,t,i,n=!1){return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_PROCESSING_STARTED),this.mediaSession.processAnswerAsync(e,t,i,n).then(()=>{this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_PROCESSING_ENDED),this.operationNames=ft})}completeNegotiationAsync(e){return this.mediaSession.completeNegotiationAsync(e).then(e=>(this.signalingSession.setOfferAnswerGenerationTimestamps(p7),e))}sendDtmf(e){return this.mediaSession.sendDtmf?this.mediaSession.sendDtmf(e):Promise.reject("Not Implemented")}reconnectAsync(e,t=!1,i){return this.mediaSession.reconnectAsync(e,t,i)}completeEscalationAsync(e){return this.mediaSession.completeEscalationAsync(e)}rejectEscalationAsync(e,t){return this.mediaSession.rejectEscalationAsync(e,t)}getAcceptedTypes(){return this.mediaSession.getAcceptedTypes()}getLocalMediaTrackId(e){return this.mediaSession.getLocalMediaTrackId?this.mediaSession.getLocalMediaTrackId(e):null}getAudioSenderStats(){return this.mediaSession.getAudioSenderStats()}processNotification(e,t){this.mediaSession.processNotification(e,t)}};function fn(e,t,i){if(t?.serverMuteVersion===void 0||i?.serverMuteVersion===void 0||i.serverMuteVersion>=t.serverMuteVersion)return;let n=i&&i.mediaStreams,r=n&&n.filter(e=>"audio"===e.type||"audio-teleconferencing"===e.type),s=t&&t.mediaStreams,a=s&&s.filter(e=>"audio"===e.type||"audio-teleconferencing"===e.type);r&&r.length&&(i.serverMuteVersion=t.serverMuteVersion,r[0].serverMuted=a[0].serverMuted,e.info(`handleServerMutedVersion: patching server muted state in audio streams updated:${JSON.stringify(r[0])} as we encountered stale muteServerVersion. Updated to ${t.serverMuteVersion}`))}function fr(e,t,i,n){if("success"!==i.reason||void 0===t||i.serverMuteVersion<=t.serverMuteVersion)return e.info(`handleMuteUnmuteParticipantInfo: ignoring updating since we encountered invalid state: ${i.reason} serverMuteVersion: ${i.serverMuteVersion}`),!1;let r=t&&t.mediaStreams,s=r&&r.filter(e=>"audio"===e.type||"audio-teleconferencing"===e.type);return!!s&&(s[0].serverMuted=n,t.serverMuteVersion=i.serverMuteVersion,e.info(`handleMuteUnmuteParticipantInfo: updating since we encountered valid state serverMuteVersion: ${i.serverMuteVersion} to: ${n} streams: ${s[0].sourceId}`),!0)}var fs=i(83836);function fa(e,t,i,n){let r=JSON.parse(JSON.stringify(e));return r&&(fo(e,r,t,fs.pii.Omit),fo(e,r,i,fs.pii.Mri),fo(e,r,n,fs.pii.UserName)),JSON.stringify(r)}function fo(e,t,i,n){i?.forEach(i=>{e[i]&&(t[i]=n(e[i]))})}function fl(e){return`id=${fs.pii.Mri(e.id)}, participantId=${e.participantId}`}function fc(e){let t=[],i=["transferorMri","targetMri"];return fa(tl(e),t,i)}var fd=i(892891),fu=n.setImmediate?e=>{n.setImmediate(e)}:e=>{(0,fd.defer)(e)},fh=class e{constructor(){this.deferredOperations=new Map,this.deferredOperationsNames=[],this.isRunning=!1}setLogger(e){this._logger=e.createChild("[DeferHandler]")}setDeferToQueueMicrotask(t){t&&n.queueMicrotask?e.defer=e=>n.queueMicrotask(e):e.defer=fu}createDeferRunner(e){let t={};return i=>this.runDeferred(t,i,e)}runDeferredWithoutDedup(e,t){let i={};this.runDeferred(i,e,t)}runDeferred(t,i,n){!this.deferredOperations.has(t)&&(this.deferredOperations.set(t,i),n&&this.deferredOperationsNames.push(" "+n),this.isRunning||(this.isRunning=!0,this._startDeferalTime=Date.now(),this.causeId=e9(),this._logger?.info(`[${this.causeId}]Deferring operations`),e.defer(()=>{this._timeToRun=Date.now()-this._startDeferalTime,this.deferredOperations.forEach(t=>{e.runWithTryCatch(t)}),this.deferredOperations.clear(),this.isRunning=!1,this._logger?.info(`[${this.causeId}]Deferred operations ran after ${this._timeToRun}ms | Completed after ${Date.now()-this._startDeferalTime}ms | Operations:${this.deferredOperationsNames}`),this.deferredOperationsNames=[]})))}static runWithTryCatch(e){try{e&&e()}catch(e){}}};fh.defer=fu;var fg=fh,fp=class{};fp.instance=new fg;var ff=i(892891),fm="sendonly",fv="recvonly",fS="sendrecv",fy="audio",fC="video",fb="applicationsharing-video",fT="audio-teleconferencing",fE="xapplicationsharing-video",f_=class extends tZ{constructor(e,t,i){super(t),this.mediaSession=e,this.isAvailable=!1,this.mediaSessionInitPromise=new iE,this.currentIsStreaming=!1,e&&this.mediaSessionInitPromise.resolve(),this.id=i,this.logger=t.createChild(`Stream[${this.id}]`)}set isStreaming(e){this.currentIsStreaming=e,this.logger.info(`isStreaming has changed to ${this.currentIsStreaming}`),this.raiseChanged()}get isStreaming(){return this.currentIsStreaming}update({sourceId:e=null,direction:t=fv,participantId:i=null,endpointId:n=null}={},r,s){this.logger.info(`[${r}][update before]  sourceId=${e}, direction=${t}, isAvailable=${this.isAvailable}, participantId=${i}, endpointId=${tw(n,8)}, ${this.negotiationTag?`, negotiationTag=${this.negotiationTag}`:""}`),this.id=e;let a=t===fS||t===fm;this.isAvailable!==a&&(this.negotiationTag=s?.get(n)),this.isAvailable=a,this.mediaSession?.getSessionConfig().config.streamAvailabilityConsiderModalities&&this.getIsModalityDisabled()&&(this.logger.info(`Disabling current modality, disabled: ${JSON.stringify(this.mediaSession?.getDisabledModalities?.()||"")}`),this.isAvailable=!1),this.participantId=i,this.endpointId=n,this.logger.info(`[${r}][update after]  sourceId=${e}, direction=${t}, isAvailable=${this.isAvailable}, participantId=${i}, endpointId=${tw(n,8)}, ${this.negotiationTag?`, negotiationTag=${this.negotiationTag}`:""}`),this.raiseChanged()}setMediaSession(e,t){let i=e?.getAllowedModalities?.()||{};this.logger.info(`[${t}][setMediaSession] ${JSON.stringify(i)}`),this.mediaSession=e,e?this.mediaSessionInitPromise.resolve():this.mediaSessionInitPromise.reject(Error("MediaSession is null"))}isActive(){return this.isAvailable&&this.isStreaming}getIsModalityDisabled(){return!1}},fI=class extends f_{},fw=i(892891),fP=class extends f_{constructor(e,t,i,n,r,s){super(void 0,e,t),this.configProvider=i,this.streamOptions=n,this.telemetryLogger=r,this.callInfo=s,this.type=2,this.finalTelemetrySent=!1,this.player=new i9(e.createChild("UmsHydraLiveStreamPlayer"),this.configProvider,this.telemetryLogger),this.isAvailable=!0}getStreamOptions(){return this.streamOptions}getDiagnosticData(){return JSON.stringify({id:this.id,type:this.type,rank:this.rank,isAvailable:this.isAvailable,isStreaming:this.isStreaming})}getStats(){let e=this.player.getSnapshotTelemetryReport(),t={isAvailable:this.isAvailable,isStreaming:this.isStreaming,...e};return(0,fw.isEqual)(this.lastStreamStats,t)||(this.streamStatsUpdatedTimestamp=Date.now(),this.lastStreamStats=t),{id:this.id,type:this.type,timestampUpdated:this.streamStatsUpdatedTimestamp,rank:this.rank,...this.lastStreamStats}}stop(){return Promise.resolve(void 0)}async start(e){if(this.logger.info("[start]: Starting UMS stream"),!this.renderer){if(await this.player.configure(this.streamOptions),!(await this.player.loadPlayer(e)).setupSucceeded)return this.player.stop(),this.logger.error("[start]: Failed to load UMS player"),Promise.reject("Failed to load UMS player");this.renderer=this.player.getRenderer()}return this.isStreaming=!0,this.renderer}sendSnapshotTelemetry(){let e=this.player.getSnapshotTelemetryReport();this.logger.debug(`[sendSnapshotTelemetry] sending snapshot telemetry report: ${JSON.stringify(e)}`);let t={...this.callInfo,...e};this.telemetryLogger.sendEvent({eventName:"live_events",props:t})}sendTelemetry(e){if(this.finalTelemetrySent)return;e&&(this.finalTelemetrySent=!0);let t=this.player.getTelemetryReport();this.logger.debug(`[sendTelemetry] sending telemetry report: ${JSON.stringify(t)}`);let i={...this.callInfo,...t};this.telemetryLogger.sendEvent({eventName:"live_events",props:i})}};function fR(e){switch(e){case 1:return"crop";case 0:return"stretch";default:return"fit"}}var fA=class extends tZ{constructor(){super(...arguments),this.isRendering=!1,this.frameType=-1}get rendererType(){return 0}captureFrame(){if(this.renderer.captureFrame)return this.renderer.captureFrame();throw Error("Not implemented yet")}async getStats(){if(this.renderer.getStats)return this.renderer.getStats();throw Error("Renderer does not support stats")}async setScalingMode(e){this.renderer.setScalingMode(fR(e))}async cameraAutoControl(e){throw Error("Not implemented")}async getCameraManualControlStates(e){throw Error("Not implemented")}async setCameraManualControlStates(e){throw Error("Not implemented")}async enumerateCameraManualControls(){throw Error("Not implemented")}async isCameraAdvancedControlCapable(){throw Error("Not implemented")}onVideoSizeChanged(e,t){this.streamSize={width:e,height:t},this.event("videoSizeChanged").raise(e,t),this.raiseChanged()}},fM=class extends fA{constructor(){super(),this.disposed=!1}initialize(e,t,i){this.disposed||this.renderer||(this.renderer=t.createPreviewRenderer(e,i),this.renderer.on("onVideoSizeChanged",(e,t)=>this.onVideoSizeChanged(e,t)))}onVideoSizeChanged(e,t){this.isRendering=e>0&&t>0,super.onVideoSizeChanged(e,t)}setVideoMirroring(e){this.renderer.setVideoMirroring(e)}startVideoAsync(){return this.renderer.startVideoAsync()}dispose(){this.disposed=!0,this.renderer&&(this.renderer.dispose(),this.renderer=null)}},fD=class extends fA{constructor(e,t,i,n,r){super(),this.logger=e,this.target=t,this.rendererStats=n,this.configProvider=r,this.subscriptionActive=!1,this.firstFrameRendered=!1,this.rendererId=n.newRendererId(),this.renderer=i.createRemoteRenderer(t),this.renderer.on("onVideoSizeChanged",(e,t)=>this.onVideoSizeChanged(e,t)),this.renderer.on("onVideoStateChanged",e=>this.onVideoStateChanged(e)),this.renderer.on("onIsRenderingChanged",e=>this.onIsRenderingChanged(e))}toString(){return`rvr:${this.rendererId}`}onVideoStateChanged(e){this.rendererStats.streamStateChanged(e.stream)}onVideoSizeChanged(e,t){this.configProvider.config.videoIsRenderingCheck&&this.setIsRendering(e>0&&t>0),super.onVideoSizeChanged(e,t)}setIsRendering(e){this.isRendering!==e&&(this.isRendering=e,this.logger.info(`isRendering has changed to ${this.isRendering}`),this.rendererStats.event(this.isRendering?5:6,this.rendererId),this.isRendering&&!this.firstFrameRendered&&(this.firstFrameRendered=!0,this.event("firstFrameRendered").raise()))}onIsRenderingChanged(e){this.setIsRendering(e),this.raiseChanged()}subscribeVideoAsync(e){this.currentVideoStream=e,this.rendererStats.event(1,this.rendererId,e.id);let t=this.renderer.subscribeVideoAsync(e.id,1===e.type);return this.subscriptionActive=!0,t.then(()=>{this.rendererStats.event(2,this.rendererId,e.id),this.watchStream(e)}),t}watchStream(e){this.changeSub&&this.changeSub.dispose(),this.changeSub=e.changed(()=>{e.isAvailable?this.subscriptionActive||this.subscribeVideoAsync(e):(this.subscriptionActive=!1,this.rendererStats.event(3,this.rendererId),this.renderer.unsubscribeNow(),this.rendererStats.event(4,this.rendererId))})}dispose(){this.renderer&&(this.subscriptionActive&&(this.rendererStats.event(3,this.rendererId),this.currentVideoStream&&!this.currentVideoStream.isAvailable&&this.renderer.unsubscribeNow()),this.renderer.dispose(),this.subscriptionActive&&this.rendererStats.event(4,this.rendererId),this.renderer=null,this.currentVideoStream=null),this.changeSub&&(this.changeSub.dispose(),this.changeSub=null)}},fO=class extends tZ{constructor(e,t,i){super(i),this.getRawStream=e,this.disposeStream=t,this.logger=i,this.isClientDisposed=!1,this.clientId=nR()}get isDisposed(){return this.isClientDisposed}notifyStreamChange(){this.logger.info(`clientId:${this.clientId} - Stream changed`),this.raiseChanged(),this.event("notifiedOnStreamChanged").raise(this.clientId)}async getMediaStream(e=!1){return this.checkDisposed(),this.logger.info(`clientId:${this.clientId} - Stream requested`),this.event("rawStreamRequested").raise(this.clientId),this.getRawStream(e)}dispose(){this.checkDisposed(),this.disposeStream?.(),this.isClientDisposed=!0,this.event("clientDisposed").raise(this.clientId),super.dispose(),this.logger.info(`clientId:${this.clientId} - Raw stream client disposed`)}checkDisposed(){if(this.isClientDisposed)throw Error("Raw stream client is already disposed")}},fk=class{constructor(e,t){this.stream=e,this.rawBaseClient=new fO(async()=>this.stream,()=>this.dispose(),t)}client(){return this.rawBaseClient}updateAndNotifyClient(e){this.rawBaseClient&&(this.stream=e,this.rawBaseClient.notifyStreamChange())}dispose(){this.rawBaseClient=null,this.stream=null}},fN=class{constructor(e,t,i){this.videoStream=e,this.subscriptionManager=t,this.logger=i,this.subscriptionActive=!1,this.modality=0===e.type?nu.MODALITY.video:nu.MODALITY.sharing,this.createSubscription(),this.rawBaseClient=new fO(async()=>this.subscriptionClient?.subscribedStream,()=>this.unsubscribeVideo(),i),this.videoStream.changed(()=>{!this.rawBaseClient?.isDisposed&&(this.logger.info(`isAvailable: ${e.isAvailable}, subscriptionActive: ${this.subscriptionActive}`),e.isAvailable?this.subscriptionActive||this.createSubscription():(this.subscriptionActive=!1,this.unsubscribeVideo()))})}client(){return this.rawBaseClient}createSubscription(){if(this.rawBaseClient?.isDisposed)return void this.logger.error("createSubscription skipped, raw stream client disposed: stream already exists");this.logger.info("createSubscription: Creating new subscription"),this.subscriptionClient=this.subscriptionManager.subscribeVideo(this.modality,this.videoStream.mediaSourceId),this.setClientSubscription(),this.subscriptionActive=!0}unsubscribeVideo(){this.logger.info("unsubscribeVideo: Disposing subcription"),this.subscriptionClient?.unsubscribe(),this.subscriptionClient?.dispose(),this.subscriptionClient=null}setClientSubscription(){this.logger.info("setClientSubscription: setting onMediaStreamChanged callback"),this.subscriptionClient.setOnMediaStreamChangedHandler(()=>this.rawBaseClient?.notifyStreamChange())}},fx=class{constructor(e){this.logger=e,this.handlerMap=new Map}dispose(){this.logger.info("dispose"),this.handlerMap.forEach(e=>e.client().dispose()),this.handlerMap.clear()}handlerAdded(e){let t=e.client();t.on("clientDisposed",()=>this.deleteRawStreamManagerById(t.clientId)),this.handlerMap.set(t.clientId,e)}deleteRawStreamManagerById(e){this.handlerMap.delete(e)}},fL=class extends fx{constructor(e){super(e)}streamChanged(e){this.handlerMap.forEach(t=>t.updateAndNotifyClient(e))}createIRawStreamClient(e,t){let i=new fk(e,this.logger);super.handlerAdded(i);let n=i.client();return this.logger.info(`[${t}] - clientId:${n.clientId}, client created`),n}updateHandlers(e){e.forEach((e,t)=>{this.handlerMap.has(t)||this.handlerMap.set(t,e)})}},fF=class extends fx{constructor(e){super(e)}createIRawStreamClient(e,t,i){let n=new fN(e,t,this.logger);super.handlerAdded(n);let r=n.client();return this.logger.info(`[${i}] - clientId:${r.clientId}, client created`),r}},fU=i(892891),f$=class extends f_{constructor(e,t,i,n){super(e,i,n),this.rendererStats=t,this.rawIncomingVideoStreamManager=new fF(this.logger.createChild(`rawVideoStream, [sourceId:${this.id}]`)),this.type=0}get mediaSourceId(){return this.id}getDiagnosticData(){return JSON.stringify({id:this.id,msi:this.mediaSourceId,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})}getStats(){let e={isAvailable:this.isAvailable,isStreaming:this.isStreaming};return(0,fU.isEqual)(this.lastStreamStats,e)||(this.streamStatsUpdatedTimestamp=Date.now(),this.lastStreamStats=e),{id:this.id,type:this.type,timestampUpdated:this.streamStatsUpdatedTimestamp,msi:this.mediaSourceId,rank:this.rank,...this.lastStreamStats}}stop(){return this.mediaSessionInitPromise.reject(Error("Video stream stopped")),Promise.resolve(void 0)}getRawStream(e=e9()){return this.logger.info(`[${e}] - getRawStream called for incoming video stream`),this.rawIncomingVideoStreamManager.createIRawStreamClient(this,this.mediaSession.getSubscriptionManager(),e)}start(e,t){return this.logger.info(`video start: target=${e}, options=${JSON.stringify(t)}`),this.mediaSessionInitPromise.promise.then(()=>new fD(this.logger.createChild("RemoteVideoRenderer"),e,this.mediaSession,this.rendererStats,this.mediaSession?.getSessionConfig())).then(e=>(t&&e.setScalingMode(t.scalingMode),this.logger.info(`subscribeVideoAsync: videoRenderer=${e}, id=${this.id}`),e.subscribeVideoAsync(this).catch(t=>{throw e.dispose(),t}).then(()=>(this.isStreaming=!0,e))))}update(e,t,i){this.logger.info(`[${t}][update] stream=${JSON.stringify(e)}`);let n=this.isAvailable;super.update(e,t,i),this.isAvailable&&this.isAvailable!==n&&this.rendererStats.event(0)}getIsModalityDisabled(){return!!this.mediaSession?.getDisabledModalities?.().video}},fV=class extends f${constructor(e,t,i,n){super(e,t,i,n),this.type=1}getIsModalityDisabled(){return!!this.mediaSession?.getDisabledModalities?.().sharing}},fB=1,fH=2,fj=3,fq=class e extends tZ{constructor(e,t,i,n){super(),this.participantId=e,this.mediaSession=t,this.localStats=i,this.audioSourceIds=[],this.streams={},this.lastUmsStreamId=1;let r=i.receive(1,e),s=i.receive(2,e);this.audio=new fI(t,n,fB);let a=new f$(t,r,n,fH),o=new fV(t,s,n,fj);this.mediaSession?.getSessionConfig()?.config.participantStreamInitialSubscriptions&&(a.changed(()=>this.event("streamChanged").raise()),o.changed(()=>this.event("streamChanged").raise())),this.streams[0]=[a],this.streams[1]=[o],this.streams[2]=[],this.logger=n.createChild("PluginlessCallStreamManager")}setMediaSession(e,t){this.logger.info(`[${t}][setMediaSession]`),this.mediaSession=e,[[this.audio],this.streams[0],this.streams[1]].forEach(i=>i.forEach(i=>i.setMediaSession(e,t)))}updateStreams(t,i,n,r){this.logger.info(`[${i}][updateStreams]`);let s=i=>t.filter(e=>i.includes(e.type)).sort(e.compareStreams),a=s([fy]);0===a.length&&(a=s([fT])),a.length>0&&(this.audioSourceIds=a.map(e=>e.sourceId));let o=a[0];o&&this.audio.update(o,i),this.updateMediaStreams(s([fC]),0,i,n),r?this.updateMediaStreams(s([fb,fE]),1,i,n):this.updateMediaStreams(s([fb]),1,i,n)}hasAudioSource(e){return this.audioSourceIds.some(t=>t===e)||this.audio.id===e}useUmsStream(t,i,n,r,s,a){this.logger.info(`[${a}][useUmsStream] Updating ums streams`);let o=this.getUmsInformation(t,r),l=this.streams[2],c=l.filter(t=>!o.some(i=>e.compareUmsStreams(t,i)));c.forEach(e=>(0,ff.remove)(l,e)),c.length&&this.logger.info(`[${a}][useUmsStream] Removing ${c.length} ums streams`),o.forEach(t=>{let r=l.find(i=>e.compareUmsStreams(i,t));r||(r=new fP(this.logger.createChild("UmsStream"),this.lastUmsStreamId++,i,t,s,n),this.logger.info(`[${a}][useUmsStream] Adding ums stream with metadata: ${JSON.stringify(t)}`),l.push(r))})}getUmsStreamMetadata(e,t){let i=null,n=null;if(i=e.find(function(e){return"MiddleLaneUltraLowLatency"===e.deliveryPipelineType&&t===e.isPrimary})){let e=i.urls;if(e&&e.length>0){i.identifier||this.logger.warn(`[getUmsStreamMetadata]: no ums stream identifier found, isPrimary: ${t}`);let r=i.decryptionKey?.id,s=i.decryptionKey?.value;r&&s||this.logger.warn(`[getUmsStreamMetadata]: no valid ums stream decryption key found, isPrimary: ${t}`);let a=i.deliveryPipelineType||void 0;n={url:e[0],streamDeliveryPipeline:a,decryptionKey:r&&s?{id:r,value:s}:null}}else this.logger.info(`[getUmsStreamMetadata]: no ums URLs found, isPrimary: ${t}`)}else this.logger.info(`[getUmsStreamMetadata]: no ums stream information found, isPrimary: ${t}`);return n}getUmsInformation(e,t){let i=[],n=null,r=null;for(let t in e){let i=e[t].streams;if(i){if(n)this.logger.info(`[getUmsInformation]: primary ums stream already found, skipping finding primary stream for participant: ${t}`);else{let e=this.getUmsStreamMetadata(i,!0);e?n=e:this.logger.info(`[getUmsInformation]: no primary ums stream found for participant: ${t}`)}if(r)this.logger.info(`[getUmsInformation]: alternate ums stream already found, skipping finding alternate stream for participant: ${t}`);else{let e=this.getUmsStreamMetadata(i,!1);e?r=e:this.logger.info(`[getUmsInformation]: no alternate ums stream found for participant: ${t}`)}}else this.logger.warn(`[getUmsInformation]: no stream information found for participant: ${t}`)}return(n||r)&&i.push({stream:n,altStream:r,threadId:t}),i}static compareStreams(e,t){let i="sendonly"===e.direction||"sendrecv"===e.direction,n="sendonly"===t.direction||"sendrecv"===t.direction;return i&&!n?-1:n&&!i?1:t.sourceId-e.sourceId}static compareUmsStreams(t,i){let n=t.getStreamOptions();return e.compareUmsStreamMetadata(n.stream,i.stream)&&e.compareUmsStreamMetadata(n.altStream,i.altStream)}static compareUmsStreamMetadata(e,t){return!e&&!t||(!!e||!t)&&(!e||!!t)&&e.decryptionKey.id===t.decryptionKey.id&&e.decryptionKey.value===t.decryptionKey.value&&e.url===t.url}updateMediaStreams(e,t,i,n){let r=this.streams[t],s=r.filter(t=>!e.some(e=>e.sourceId===t.id));s.forEach(e=>(0,ff.remove)(r,e)),s.length&&this.logger.info(`[${i}][updateMediaStreams] Removing ${s.length} streams of type ${t}`),e.forEach((s,a)=>{let o=r.find(e=>e.id===s.sourceId);o||(0===t?o=new f$(this.mediaSession,this.localStats.receive(1,this.participantId),this.logger,s.sourceId):1===t&&(o=new fV(this.mediaSession,this.localStats.receive(2,this.participantId),this.logger,s.sourceId)),this.logger.info(`[${i}][updateMediaStreams] Adding stream ${s.sourceId} of type ${t}`),r.push(o),o.changed(()=>this.event("streamChanged").raise())),o.update(s,i,n),o.rank=e.length-a})}},fW={0:[1],1:[2,6,3,4,5,7,8],2:[6,3,4,8],3:[1,4,5,8],7:[3,4,8],4:[],5:[3,4,8],6:[3,4],8:[3,5,4]},fG=class extends tZ{constructor(e,t,i,n,r,s=e9(),a=[]){super(i),this.mri=e,this.callTelemetry=r,this.cachedMediaStreams=a,this.state=0,this.voiceLevel=0,this.isServerMuted=!1,this.endpointType="default",this.balanceUpdates={},this._raiseChangeDeferRunner=fp.instance.createDeferRunner("CallParticipant.RaiseChange"),this.filteredParticipantEndpointDetails={},this.recordTelemetryForStateChange=(e,t,i,n)=>{if(n){let n="_SetParticipantStateInvalid",r={state:t,reason:i,endpoints:[]};this.endpoints?.endpointDetails?.length&&(r.endpoints=ao(this.endpoints.endpointDetails)),this.callTelemetry.recordEvent(n,r,e)}},this.checkIfIncomingServerMutedIsUpdated=e=>{e.endpointDetails.forEach(e=>{let t=this.filteredParticipantEndpointDetails[e.participantId];void 0!==t&&fn(this.logger,t,e)})},this.handleServerMutedInfoUpdate=e=>{let t=!1;for(let i of e){let e=this.filteredParticipantEndpointDetails[i.participantId];fr(this.logger,e,i,!0)&&(t=!0)}t&&this.updateIsServerMuted()},this.id=this.mri,this.logger=i.createChild(()=>`ICallParticipant[${ta(this.id)}][${this.state}]`),this.logger.info(`[${s}]created`),this.streamManager=new fq(this.id,t,n,this.logger),this.streamManager.on("streamChanged",()=>this.raiseChanged())}get audio(){return this.streamManager.audio}get streams(){return this.streamManager.streams}getDiagnosticData(){return JSON.stringify({id:ta(this.id),state:this.state,isServerMuted:this.isServerMuted})}async getDiagnosticDataAsync(){return this.getDiagnosticData()}isSameParticipantsMri(e){return this.id===e}setMediaSession(e,t=e9()){this.streamManager.setMediaSession(e,t)}applyCachedMediaStreams(e=e9()){let t=this.logger.createFnLogger("applyCachedMediaStreams",e);if(!this.cachedMediaStreams?.length)return void t.info("cachedMediaStreams is empty");t.info("applying cachedMediaStreams"),this.updateStreams(this.cachedMediaStreams,e,!1)}updateStreams(e,t=e9(),i=!1,n,r=!1){this.logger.createFnLogger("updateStreams",t).info(`isStreamingMode=${i} mediaStreams=${tI(e)}`),e?.length&&(this.cachedMediaStreams=e),i||(this.streamManager.updateStreams(e,t,n,r),this.raiseChangedDeferred())}hasAudioSource(e){return this.streamManager.hasAudioSource(e)}raiseChangedDeferred(){this._raiseChangeDeferRunner(()=>this.raiseChanged())}updateIsServerMuted(){if(!Object.values(this.filteredParticipantEndpointDetails).length)return void this._updateIsServerMuted(!1);let e=!1;Object.values(this.filteredParticipantEndpointDetails).forEach(t=>{let i=e=>t.mediaStreams?.filter(t=>t.type===e).sort(fq.compareStreams),n=i(fy)?.[0];n||(n=i(fT)?.[0]);let r=!!n?.serverMuted,s=t.endpointState?.state,a=!!s?.isMuted;if(!1===r&&!1===a){e=!0;return}});let t=!e;this._updateIsServerMuted(t)}_updateIsServerMuted(e){e!==this.isServerMuted&&(this.isServerMuted=e,this.logger.info(`_updateIsServerMuted updating to: ${this.isServerMuted}`),this.raiseChanged())}updateVoiceLevel(e){this.voiceLevel!==e&&(this.voiceLevel=e,this.raiseChanged())}setState(e,t,i){if(this.state===e)return;let n=this.logger.createFnLogger("setState",i);if(3===this.state&&6===e)return void n.info("Ignore Connected->EarlyMedia transition, it is a race between media and signaling");let r=fW[this.state].indexOf(e)>=0;if(this.recordTelemetryForStateChange(i,e,t,!r),!r)return void n.logFailure(`Invalid state transition ${this.state}->${e} attempted`);n.info(`state=${this.state}->${e} reason=${this.stateReason}->${t}`),this.state=e,this.stateReason=t,this.raiseChangedDeferred()}processParticipantDetails(e,t,i){let n=this.logger.createFnLogger("processParticipantDetails","");this.role=e.role,this.meetingRole=e.meetingRole,this.advancedMeetingRole=e.advancedMeetingRole,this.meetingRoles=e.meetingRoles,this.participantType=e.participantType,this.displayName=e.displayName,this.tenantId=e.tenantId,this.propertyBag=e.propertyBag,this.version=e.version,this.otpIdentity=e.otpIdentity,this.isIdentityMasked=!!e.isIdentityMasked,this.nonMaskedId=e.nonMaskedId,this.nonMaskedDisplayName=e.nonMaskedDisplayName,this.nonMaskedObjectId=e.nonMaskedObjectId,this.maskedIdSeqNumber=e.maskedIdSeqNumber,this.maskedId=e.maskedId,this.joinAsStreamingUser=e.joinAsStreamingUser,e.endpointDetails?.length&&(this.endpoints={endpointDetails:[]},this.participantCapabilities={canConference:!1,canShareScreen:!1,canMerge:!0},this.checkIfIncomingServerMutedIsUpdated(e),this.filteredParticipantEndpointDetails={},e.endpointDetails.forEach(e=>{let n=pK(e,t);if(this.endpoints.endpointDetails.push(n),!n.mappedTo){if(this.filteredParticipantEndpointDetails[e.participantId]={endpointId:e.endpointId,serverMuteVersion:e.serverMuteVersion,endpointState:e.endpointState,mediaStreams:e.mediaStreams},e.capabilities&&(this.participantCapabilities.canConference||"enabled"!==e.capabilities.cloudAudioVideoConference||(this.participantCapabilities.canConference=!0),this.participantCapabilities.canShareScreen||"enabled"!==e.capabilities.cloudScreenSharing||(this.participantCapabilities.canShareScreen=!0),this.participantCapabilities.canMerge||"enabled"!==e.capabilities.cloudMerge||(this.participantCapabilities.canMerge=!0)),this.contentSharingRole=0,e.contentSharing&&e.contentSharing.sessionInformation){let t=e.contentSharing.sessionInformation;"attendee"===t.role?this.contentSharingRole=1:"presenter"===t.role&&(this.contentSharingRole=2)}n.streamInformation&&i&&i()}}),this.updateIsServerMuted(),n.info(`endpointDetails=${tN(this.endpoints)}`),this.raiseChangedDeferred())}convertAudioState(e){switch(e){case 0:case 4:return"Disconnected";case 1:case 7:case 6:case 9:case 10:return"Connecting";case 2:return"Ringing";case 3:case 5:case 8:return"Connected"}}toCafeParticipant(){return{audioState:this.convertAudioState(this.state),mri:this.mri}}getSourceIdForMediaType(e){let t=hw(this,e);return -1===t&&this.logger.warn("getSourceIdForMediaType failed"),t}useUmsStream(e,t,i,n,r,s){this.streamManager.useUmsStream(e,t,i,n,r,s),this.raiseChangedDeferred()}hasSourceId(e,t){return void 0!==hR(this,e,t)}},fz=class extends tZ{constructor(e,t,i,n,r,s="",a,o){super(),this.callTelemetry=e,this.signalingSession=i,this.contentSharingGuid=n,this.contentSharingIdentity=r,this.state=s,this.subject=a,this.handleOperationFailure=(e,t,i)=>{i.logFailure(e);let n=this.getTerminatedReasonFromError(e);return t.updateStatusTo&&(this.contentSharingStatus=t.updateStatusTo,this.rejectContentSharing(n)),Promise.reject(n)},this._logger=t.createChild(()=>`[ContentSharingSession][${this.contentSharingGuid}]`),this.contentSharingStatus=0,this.contentSharingTerminationReason=null,this.contentSharingState=s,this._callOperationHandler=new aQ(this._logger,this.callTelemetry),o&&(this.sessionId=o)}get contentSharingStatus(){return this.status}set contentSharingStatus(e){if((this._logger.info(`[set contentSharingStatus][currentStatus=${this.status}][newStatus=${e}]`),this.callTelemetry.recordEvent("_SetContentSharingStatus",{newStatus:e,oldStatus:this.status}),this.status!==e)&&7!==this.status&&8!==this.status){if(this._logger.info(`[set contentSharingStatus] Changing content sharing status to: ${e}`),this.status=e,7===this.status){let e={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"[set contentSharingStatus] Content sharing is disconnected"};this._callOperationHandler.maybeResolveOperation("StopContentSharing"),this._callOperationHandler.rejectPendingOperations(e)}if(2===this.status||5===this.status){let e={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Content sharing cannot be ended when not presenting"};this._callOperationHandler.maybeRejectOperation("StopContentSharing",e)}3===this.status&&(this._callOperationHandler.maybeResolveOperation("StartContentSharing"),this._callOperationHandler.maybeResolveOperation("TakeContentSharingControl")),this.raiseChanged()}}get contentSharingState(){return this.state}set contentSharingState(e){this.state!==e&&(this.state=e,this.raiseChanged())}startContentSharing(e=e9()){let t=this._logger.createFnLogger("StartContentSharing",e);if(0!==this.contentSharingStatus){let i=`[${e}][startContentSharing][failed][reason=InvalidState]`,n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return t.logFailure(`state=${this.contentSharingStatus}, reason=${i}`),Promise.reject(n)}return this.signalingSession.startContentSharingAsync(this.contentSharingIdentity,this.contentSharingState,this.subject,this.contentSharingGuid,e).then(e=>{this.sessionId=e.sessionId,this.contentSharingStatus=3,this.presenterId=this.signalingSession.participantManager.localParticipant.id}).catch(i=>this.handleOperationFailure(i,{causeId:e,operation:"StartContentSharing",updateStatusTo:8},t)),this._callOperationHandler.waitForOperation("StartContentSharing")}joinContentSharing(e=e9()){let t=this._logger.createFnLogger("JoinContentSharing",e);if(2!==this.contentSharingStatus){let i=`[${e}][joinContentSharing][failed][reason=InvalidState]`,n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return t.logFailure(`state=${this.contentSharingStatus}, reason=${i}`),Promise.reject(n)}return this.signalingSession.joinContentSharingAsync(this.contentSharingGuid,e).then(e=>(this.contentSharingStatus=4,this.contentSharingState=e.sessionState,this.presenterId=e.presenter,Promise.resolve())).catch(i=>this.handleOperationFailure(i,{causeId:e,operation:"JoinContentSharing",updateStatusTo:8},t))}updateContentSharingSessionState(e,t,i=e9()){let n=this._logger.createFnLogger("UpdateContentSharingSessionState",i);if(3!==this.contentSharingStatus){let e=`[${i}][updateContentSharingSessionState][failed][reason=InvalidState]`,t={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:e};return n.logFailure(`state=${this.contentSharingStatus}, reason=${e}`),Promise.reject(t)}return this.signalingSession.updateContentSharingSessionStateAsync(this.contentSharingGuid,t,i).then(()=>Promise.resolve()).catch(t=>this.handleOperationFailure(t,{causeId:i,operation:"UpdateContentSharingSessionState",operationId:e},n))}takeContentSharingControl(e=e9()){let t=this._logger.createFnLogger("TakeContentSharingControl",e);if(5!==this.contentSharingStatus){let i=`[${e}][updateContentSharingSessionState][failed][reason=InvalidState]`,n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return t.logFailure(`state=${this.contentSharingStatus}, reason=${i}`),Promise.reject(n)}return this.signalingSession.takeContentSharingControlAsync(this.contentSharingGuid,e).then(()=>{this.contentSharingStatus=3,this.presenterId=this.signalingSession.participantManager.localParticipant.id}).catch(i=>this.handleOperationFailure(i,{causeId:e,operation:"TakeContentSharingControl"},t)),this._callOperationHandler.waitForOperation("TakeContentSharingControl")}updateContentSharingParticipantStateToViewer(e=e9()){let t=this._logger.createFnLogger("UpdateParticipantState",e);if(4!==this.contentSharingStatus){let i=`[${e}][updateContentSharingSessionState][failed][reason=InvalidState]`,n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return t.logFailure(`state=${this.contentSharingStatus}, reason=${i}`),Promise.reject(n)}return this.signalingSession.updateContentSharingParticipantStateAsync(this.contentSharingGuid,e).then(()=>(this.contentSharingStatus=this.presenterId===this.signalingSession.participantManager.localParticipant.id?3:5,Promise.resolve())).catch(i=>this.handleOperationFailure(i,{causeId:e,operation:"UpdateParticipantState"},t))}stopContentSharing(e=e9()){let t=this._logger.createFnLogger("StopContentSharing",e);if(2===this.contentSharingStatus||4===this.contentSharingStatus||5===this.contentSharingStatus){let i=`[${e}][stopContentSharing][failed][reason=InvalidState]`,n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return t.logFailure(`state=${this.contentSharingStatus}, reason=${i}`),Promise.reject(n)}return this.signalingSession.deleteContentSharingAsync(this.contentSharingGuid,e).then(()=>(this.contentSharingStatus=7,this._callOperationHandler.waitForOperation("StopContentSharing"))).catch(i=>this.handleOperationFailure(i,{causeId:e,operation:"StopContentSharing"},t))}dispose(e=e9()){let t={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"};this._callOperationHandler.rejectPendingOperations(t,e),this.contentSharingStatus=7,this.contentSharingState="",super.dispose()}rejectContentSharing(e={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"[rejectContentSharing] Content sharing is disconnected"}){if(7===this.status||8===this.status)this._callOperationHandler.maybeResolveOperation("StopContentSharing"),this._callOperationHandler.rejectPendingOperations(e);else throw Error(`Tried to reject content sharing with status=${this.status}`)}getTerminatedReasonFromError(e){let t=e?.endCode?.code||0,i={terminatedReason:32,terminatedReasonCode:t,terminatedReasonSubCode:e?.endCode?.subCode||0,errorMessage:e};switch(t){case a3:i.terminatedReason=34,i.errorMessage="Active session not found on server";break;case aZ:i.terminatedReason=8,i.errorMessage="Failed due to insufficient permissions"}return i}};eM([aM("StartContentSharing"),eD(0,ak)],fz.prototype,"startContentSharing",1),eM([aM("JoinContentSharing"),eD(0,ak)],fz.prototype,"joinContentSharing",1),eM([aM("UpdateContentSharingSessionState"),eD(0,aO),eD(2,ak)],fz.prototype,"updateContentSharingSessionState",1),eM([aM("TakeContentSharingControl"),eD(0,ak)],fz.prototype,"takeContentSharingControl",1),eM([aM("UpdateParticipantState"),eD(0,ak)],fz.prototype,"updateContentSharingParticipantStateToViewer",1),eM([aM("StopContentSharing",{waitFor:"StartContentSharing"}),eD(0,ak)],fz.prototype,"stopContentSharing",1);var fJ=class{constructor(e){this.value=e,this.next=void 0}},fK=class{constructor(){this.length=0}enqueue(e){let t=new fJ(e);this.front?this.rear.next=t:this.front=t,this.rear=t,this.length++}dequeue(){if(!this.front)return;let e=this.front;return this.front===this.rear?(this.front=void 0,this.rear=void 0):this.front=this.front.next,this.length--,e.value}peek(){return this.front?.value}size(){return this.length}back(){return this.rear?.value}},fQ=i(892891),fY=class{constructor(e){this.comparator=e,this.heap=[]}enqueue(e){this.heap.push(e),this.bubbleUp()}dequeue(){let e=this.peek();if(void 0!==e){let e=this.heap.pop();this.size()>0&&(this.heap[0]=e,this.bubbleDown())}return e}peek(){return this.heap[0]}size(){return this.heap.length}bubbleUp(){let e=this.size()-1,t=this.getParentIndex(e);for(;!this.isRoot(e)&&this.comparator(this.heap[e],this.heap[t]);)[this.heap[t],this.heap[e]]=[this.heap[e],this.heap[t]],e=t,t=this.getParentIndex(e)}bubbleDown(){if(1>=this.size())return;let e=this.getRootIndex(),t=this.getLeftIndex(e),i=this.getRightIndex(e);for(;this.heap[t]&&this.comparator(this.heap[t],this.heap[e])||this.heap[i]&&this.comparator(this.heap[i],this.heap[e]);)!this.heap[i]||this.comparator(this.heap[t],this.heap[i])?([this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]],e=t):([this.heap[e],this.heap[i]]=[this.heap[i],this.heap[e]],e=i),t=this.getLeftIndex(e),i=this.getRightIndex(e)}getRootIndex(){return 0}isRoot(e){return 0===e}getLeftIndex(e){return 2*e+1}getRightIndex(e){return 2*e+2}getParentIndex(e){return Math.floor((e-1)/2)}},fZ=class{constructor(e,t,i){this.maxPacketRate=t,this.rateLimiterCheckInterval=i,this.maxDataRate=0,this.packetsEndTimeForPacketRate=0,this.packetsEndTimeForBitrate=0,this.maxDataRate=e/8}canSend(e){if(0===this.maxDataRate&&0===this.maxPacketRate)return!0;let t=nQ();if(this.maxPacketRate&&this.packetsEndTimeForPacketRate>t+this.rateLimiterCheckInterval||this.maxDataRate&&this.packetsEndTimeForBitrate>t+this.rateLimiterCheckInterval)return!1;let i=this.maxPacketRate?1e3/this.maxPacketRate:0,n=this.maxDataRate?e.length/this.maxDataRate*1e3:0;return this.packetsEndTimeForPacketRate=Math.max(this.packetsEndTimeForPacketRate,t)+i,this.packetsEndTimeForBitrate=Math.max(this.packetsEndTimeForBitrate,t)+n,!0}},fX=class{constructor(e){this.dataIds=new Map,this.maxBitrate=e.config.webrtcDataChannel.maxBitrate,this.maxPacketRate=e.config.webrtcDataChannel.maxPacketRate,this.maxQueueSize=e.config.webrtcDataChannel.maxQueueSize,e.config.webrtcDataChannel.dataIds.forEach(e=>{this.dataIds.set(e.dataId,e)})}getMaxBitrate(e){return this.dataIds.get(e)?.maxBitrate??this.maxBitrate}getMaxPacketRate(e){return this.dataIds.get(e)?.maxPacketRate??this.maxPacketRate}getMaxQueueSize(e){return this.dataIds.get(e)?.maxQueueSize??this.maxQueueSize}getConfig(e){let t=this.dataIds.get(e)||{dataId:e};return t.maxBitrate=t.maxBitrate??this.maxBitrate,t.maxPacketRate=t.maxPacketRate??this.maxPacketRate,t.maxQueueSize=t.maxQueueSize??this.maxQueueSize,t.priorityWeight=t.priorityWeight??1,t}},f0=class{constructor(e,t,i){this.dataIdConfig=t,this.rateLimiterCheckInterval=i,this.timeOffset=0,this.packets=new fK,this.startTime=e(),this.finishTime=this.startTime,this.rateLimiter=new fZ(t.maxBitrate,t.maxPacketRate,this.rateLimiterCheckInterval),this.getCurrentTime=e,this.stats={bufferSize:t.maxQueueSize,remainingBytes:0,remainingPackets:0}}enqueue(e){if(0===e.length)return 0;let t=(0,fQ.sumBy)(e,e=>e.length),i=this.dataIdConfig.maxQueueSize;if(i&&this.stats.remainingBytes+t>i)throw Error(`dataId ${this.dataIdConfig.dataId} send queue is full`);let n=this.getCurrentTime(),r=0;return 0===this.packets.size()?(this.startTime=n,this.finishTime=n,this.timeOffset=0,r=n):r=this.finishTime,e.forEach(e=>{r+=e.length*this.dataIdConfig.priorityWeight,this.packets.enqueue({finishTime:r,packet:e}),this.stats.remainingBytes+=e.length,this.stats.remainingPackets++}),this.finishTime=r,t}dequeue(){let e=this.peek();if(void 0!==e){if(!this.rateLimiter.canSend(e.packet))return;this.packets.dequeue(),this.stats.remainingBytes-=e.packet.length,this.stats.remainingPackets--}return e}updateTimeOffset(){this.packets.size()?this.timeOffset=this.getCurrentTime()-this.startTime:(this.startTime=this.getCurrentTime(),this.finishTime=this.startTime,this.timeOffset=0)}peek(){if(0===this.packets.size())return;let e=this.packets.peek();return{finishTime:e.finishTime+this.timeOffset,packet:e.packet}}getConfig(){return this.dataIdConfig}getStats(){return(0,fQ.clone)(this.stats)}},f1=class{constructor(e){this.senders=new Map,this.currentVirtualClock=0,this.dataIdConfigManager=new fX(e),this.virtualTimeQueue=new fY((e,t)=>e.minTime<t.minTime),this.sendStats={bufferSize:0,remainingBytes:0,remainingPackets:0},this.rateLimiterCheckInterval=e.config.webrtcDataChannel.rateLimiterCheckInterval}getPacketsToSend(e){if(0===this.virtualTimeQueue.size())return[];let t=[],i=[];for(;e>=0&&this.virtualTimeQueue.size();){let n=this.virtualTimeQueue.peek();if(n.size>e)break;this.virtualTimeQueue.dequeue();let r=n.dataId,s=this.senders.get(r);if(void 0!==s.peek()){let n=s.dequeue();if(void 0!==n){t.push(n.packet),this.sendStats.remainingBytes-=n.packet.length,e-=n.packet.length,this.sendStats.remainingPackets--,this.currentVirtualClock=Math.max(this.currentVirtualClock,n.finishTime);let i=s.peek();i&&this.virtualTimeQueue.enqueue({dataId:r,minTime:i.finishTime,size:i.packet.length})}else i.push(r)}}return i.forEach(e=>{let t=this.senders.get(e);t.updateTimeOffset();let i=t.peek();i&&this.virtualTimeQueue.enqueue({dataId:e,minTime:i.finishTime,size:i.packet.length})}),t}appendPackets(e,t){let i=this.senders.get(e);void 0===i&&(i=new f0(()=>this.currentVirtualClock,this.dataIdConfigManager.getConfig(e),this.rateLimiterCheckInterval),this.senders.set(e,i));let n=i.getStats(),r=i.enqueue(t);if(this.sendStats.remainingBytes+=r,this.sendStats.remainingPackets+=t.length,0===n.remainingPackets){let t=i.peek();void 0!==t&&this.virtualTimeQueue.enqueue({dataId:e,minTime:t.finishTime,size:t.packet.length})}}getStats(e){if(void 0===e)return(0,fQ.clone)(this.sendStats);let t=this.senders.get(e);return void 0===t?{bufferSize:this.dataIdConfigManager.getMaxQueueSize(e),remainingBytes:0,remainingPackets:0}:t.getStats()}},f2=class{constructor(e){this.data={protocolCounters:{},id:void 0,label:void 0,ordered:void 0,negotiated:void 0},this.data.id=e.id,this.data.label=e.label,this.data.ordered=e.ordered,this.data.negotiated=e.negotiated,this.data.protocol=e.protocol||void 0,this.data.maxPacketLifeTime=e.maxPacketLifeTime??void 0,this.data.maxRetransmits=e.maxRetransmits??void 0}recordProtocolEvent(e,t,i){this.data.protocolCounters[i]||(this.data.protocolCounters[i]={});let n=this.data.protocolCounters[i];switch(!n[e]&&(n[e]={successful:0,failed:0,fragmented:0,dismissed:0}),t){case 0:n[e].successful++;break;case 1:n[e].failed++;break;case 2:n[e].fragmented++;break;case 3:n[e].dismissed++}}recordError(e){this.data.error=e}getObjectRef(){return this.data}},f3=class{constructor(e,t,i){this.dataId=e,this.diagnostics=t,this.logger=i,this.pendingFragments=[]}depacketize(e){let t=new DataView(e.buffer),i=63&t.getUint8(2);if(i!==this.dataId)throw Error(`Invalid packet dataId: ${this.dataId} !== ${i}`);let n=11,r=((15&t.getUint8(0))<<8)+t.getUint8(1),s=128&t.getUint8(2),a=t.getUint16(3),o=t.getUint8(5),l=t.getUint32(6),c=t.getUint8(10);if(s){this.pendingFragments.length&&this.logger.warn(`Unfinished message: dataId: ${this.dataId} seqNum: ${a}`),this.remainingPackets=o,0!==o&&this.diagnostics.recordProtocolEvent("recv",2,i),this.pendingFragments=[],this.sourceId=l,this.recipients=[];for(let e=0;e<c;e++){let i=t.getUint32(n+4*e);this.recipients.push(i)}}else{if(0===this.pendingFragments.length)return this.logger.safe.error(`No start flag dataId: ${this.dataId} seqNum: ${a}`),this.diagnostics.recordProtocolEvent("recv",3,i),null;if(this.nextSeqNum!==a)return this.logger.safe.error(`Invalid sequence number: dataId: ${this.dataId} seqNum: ${a}`),this.diagnostics.recordProtocolEvent("recv",3,i),null;this.remainingPackets-=1}if(this.nextSeqNum=a+1&65535,this.pendingFragments.push(e.slice(r)),0!==this.remainingPackets)return null;{let e=new Uint8Array(this.pendingFragments.reduce((e,t)=>e+t.length,0)),t=0;for(let i of this.pendingFragments)e.set(i,t),t+=i.length;return this.pendingFragments=[],{dataId:this.dataId,sourceId:this.sourceId,data:e,recipients:this.recipients}}}},f4=class{constructor(e){this.dataId=e,this.seqNum=0}packetize(e){if(e.dataId!==this.dataId)throw Error(`Invalid dataId: ${this.dataId} !== ${e.dataId}`);let t=11,i=11+4*e.recipients.length,n=new Uint8Array(e.data.length+i),r=new DataView(n.buffer);r.setUint8(0,16+(i>>8)),r.setUint8(1,255&i),r.setUint8(2,128|63&e.dataId),r.setUint16(3,this.seqNum),r.setUint8(5,0),r.setUint32(6,e.sourceId),r.setUint8(10,e.recipients.length);for(let i=0;i<e.recipients.length;i++)r.setUint32(t+4*i,e.recipients[i]);return n.set(e.data,i),this.seqNum+=1,[n]}},f5=class{constructor(e,t,i){this.dataId=e,this.fragmentationSize=t,this.diagnostics=i,this.seqNum=0}packetize(e){if(e.dataId!==this.dataId)throw Error(`Invalid dataId: ${this.dataId} !== ${e.dataId}`);let t=11,i=11+4*e.recipients.length,n=[],r=this.fragmentationSize-i;if(r<0)throw Error(`message dataId: ${this.dataId} payload size: ${i} exceeds limit`);let s=e.data.length?Math.ceil(e.data.length/r):1,a=s-1;a>0&&this.diagnostics.recordProtocolEvent("send",2,this.dataId);let o=e.data.length,l=!0,c=0;for(;s>0;){let d=Math.min(o,r),u=new Uint8Array(d+i),h=new DataView(u.buffer);h.setUint8(0,16+(i>>8)),h.setUint8(1,255&i),l?(l=!1,h.setUint8(2,128|63&e.dataId)):h.setUint8(2,63&e.dataId),h.setUint16(3,this.seqNum),h.setUint8(5,a),h.setUint32(6,e.sourceId),h.setUint8(10,e.recipients.length);for(let i=0;i<e.recipients.length;i++)h.setUint32(t+4*i,e.recipients[i]);u.set(e.data.slice(c,c+d),i),c+=d,n.push(u),this.seqNum+=1,s-=1,o-=d}return n}},f6=class extends no{constructor(e,t,i,n){super(),this.dataChannel=e,this.sessionDiagnostics=t,this.stateInternal="Created",this.packetizers=new Map,this.depacketizers=new Map,this.sendScheduleTimer=0,this.pendingPackets=new fK,this.sourceIdInternal=a_,this.label=e.label,this.diagnostics=this.sessionDiagnostics.newDataChannelDiagnostics(e),this.logger=i.createChild(`[WebRtcDataChannel ${this.label}]`),this.logger.safe.info(`Created with settings ${t$(this.getDataChannelSettings(e))}`),this.bufferedAmountLowThreshold=n.config.webrtcDataChannel.bufferedAmountLowThreshold,this.bufferedAmountHighThreshold=n.config.webrtcDataChannel.bufferedAmountHighThreshold,this.fragmentationSize=n.config.webrtcDataChannel.enableFragmentation?n.config.webrtcDataChannel.fragmentationSize:0,n.config.webrtcDataChannel.enableSendScheduler&&(this.sendScheduler=new f1(n)),this.rateLimiterCheckInterval=n.config.webrtcDataChannel.rateLimiterCheckInterval,this.discardOnSendFailure=n.config.webrtcDataChannel.discardOnSendFailure,this.subscribeOnDataChannelEvents()}getDataIdStats(e){return this.sendScheduler?.getStats(e)}get state(){return this.stateInternal}set sourceId(e){this.sourceIdInternal=e}setDataChannel(e){this.dataChannel&&(this.logger.safe.info(`Replacing internal data channel ${this.label}:${this.dataChannel.id} with ${e.label}:${e.id} with settings ${t$(this.getDataChannelSettings(e))}`),this.unsubscribeOnDataChannelEvents(),this.dataChannel.close()),this.dataChannel=e,this.diagnostics=this.sessionDiagnostics.newDataChannelDiagnostics(e),this.subscribeOnDataChannelEvents()}dispose(){this.logger.safe.info("dispose"),this.dataChannel&&(this.logger.safe.info(`dataChannel.close ${this.dataChannel.id}`),this.unsubscribeOnDataChannelEvents(),this.dataChannel.close(),this.dataChannel=null,this.setState("Destroyed"),super.dispose())}sendMessage(e,t=this.sourceIdInternal,i,n=[]){try{this.packetizers.has(e)||(this.fragmentationSize?this.packetizers.set(e,new f5(e,this.fragmentationSize,this.diagnostics)):this.packetizers.set(e,new f4(e)));let r=this.packetizers.get(e).packetize({dataId:e,sourceId:t,data:i,recipients:n});void 0!==this.sendScheduler?(this.sendScheduler.appendPackets(e,r),this.scheduleSend()):r.forEach(e=>{this.dataChannel.send(e)}),this.diagnostics.recordProtocolEvent("send",0,e)}catch(t){throw this.logger.unsafe.warn(`Failed to construct protocol message: ${t$(t)}`),this.diagnostics.recordProtocolEvent("send",1,e),t}}scheduleSend(){if("Connected"!==this.state)return;let e=e=>{try{this.dataChannel.send(e)}catch(e){return this.logger.unsafe.warn(`Failed to send message: ${t$(e)}`),!1}return!0};if(this.dataChannel.bufferedAmount<=this.dataChannel.bufferedAmountLowThreshold){let t=Date.now(),i=this.bufferedAmountHighThreshold-this.dataChannel.bufferedAmount;for(;this.pendingPackets.size();){let t=this.pendingPackets.peek();if(t.length>i)break;if(e(t))this.pendingPackets.dequeue(),i-=t.length;else break}if(0===this.pendingPackets.size()&&i>0){for(let t of this.sendScheduler.getPacketsToSend(i))if(!1===e(t)&&!1===this.discardOnSendFailure){this.pendingPackets.enqueue(t);break}}if(this.dataChannel.bufferedAmount<=this.dataChannel.bufferedAmountLowThreshold){if(this.sendScheduleTimer)return;if(this.sendScheduler.getStats().remainingPackets>0){let e=Math.max(t+this.rateLimiterCheckInterval-Date.now(),20);this.sendScheduleTimer=window.setTimeout(()=>{this.sendScheduleTimer=0,this.scheduleSend()},e)}}}}subscribeOnDataChannelEvents(){this.dataChannel.binaryType="arraybuffer",this.dataChannel.onmessage=e=>{let t=new Uint8Array(e.data),i=63&t[2];try{this.depacketizers.has(i)||this.depacketizers.set(i,new f3(i,this.diagnostics,this.logger));let e=this.depacketizers.get(i).depacketize(t);e&&(this.diagnostics.recordProtocolEvent("recv",0,i),this.event("onmessage").raise(i,e.sourceId,e.data))}catch(e){this.logger.unsafe.warn(`Failed to parse incoming message: ${t$(e)}`),this.diagnostics.recordProtocolEvent("recv",1,i)}},this.dataChannel.onerror=e=>{let t=e?.target,i=t$(e?.error??e);this.logger.safe.warn(`onerror: label:${t.label} id:${t.id} ${i} `),this.diagnostics.recordError(i)},"open"===this.dataChannel.readyState&&this.dataChannel.id%2==0&&(this.logger.safe.info(`readyState is already 'open' label:${this.dataChannel.label} id:${this.dataChannel.id}`),this.setState("Connected")),this.dataChannel.onopen=e=>{let t=e.target;this.logger.safe.info(`onopen label:${t.label} id:${t.id}`),t.id%2==0&&this.setState("Connected")},this.dataChannel.onclose=e=>{let t=e.target;this.logger.safe.info(`onclose label:${t.label} id:${t.id}`),this.setState("Closed")},this.dataChannel.onclosing=e=>{let t=e.target;this.logger.safe.debug(`onclosing label:${t.label} id:${t.id}`),this.setState("Closed")},void 0!==this.sendScheduler&&(this.dataChannel.bufferedAmountLowThreshold=this.bufferedAmountLowThreshold,this.dataChannel.onbufferedamountlow=()=>{this.scheduleSend()})}unsubscribeOnDataChannelEvents(){this.dataChannel.onmessage=null,this.dataChannel.onerror=null,this.dataChannel.onopen=null,this.dataChannel.onclose=null,this.dataChannel.onclosing=null,this.dataChannel.onbufferedamountlow=null}setState(e){this.stateInternal=e,this.event("onStateChanged").raise(),"Connected"===e&&void 0!==this.sendScheduler&&this.scheduleSend()}getDataChannelSettings(e){return{ordered:e.ordered,maxRetransmits:e.maxRetransmits,maxPacketLifeTime:e.maxPacketLifeTime}}},f8="main-channel",f9=class extends no{constructor(e,t,i,n){let r=i.createChild("PluginlessDataChannel");super(r),this.pc=e,this.diagnostics=t,this.configProvider=n,this._state="Inactive",this.logger=r,this.subscribeOnDatachannel()}get state(){return this._state}getDataChannel(e){if(!this.dataChannel){this.logger.safe.info(`[${e}] creating new dataChannel`);try{let e=this.configProvider.config.dataChannelDebugInitSettings||{};this.dataChannel=new f6(this.pc.createDataChannel(f8,e),this.diagnostics,this.logger,this.configProvider),this.subscribeForDataChannelEvents()}catch(i){let t=t$(i);return this.logger.safe.error(`[${e}] createDataChannel failed: ${t}`),this.diagnostics.createChannelFailReason=t,this.setState("Failed"),null}}return this.dataChannel}updateDataModalityState(e){"Failed"!==this._state&&"Disabled"!==this._state&&(e===nu.MEDIA_STATE.sendReceive?this.setState("Active"):e===nu.MEDIA_STATE.inactive&&this.setState("Inactive"))}disable(){this.setState("Disabled")}dispose(){this.stopDataChannel(),this.pc=null,super.dispose()}subscribeOnDatachannel(){this.pc.ondatachannel=e=>{this.onDataChannel(e.channel)}}onDataChannel(e){this.logger.safe.info(`onDataChannel id=${e.id} label=${e.label}`),e.id%2==0?this.dataChannel?(this.logger.safe.info("Found existing data channel, replacing"),this.dataChannel.setDataChannel(e)):(this.dataChannel=new f6(e,this.diagnostics,this.logger,this.configProvider),this.subscribeForDataChannelEvents()):this.logger.safe.info(`onDataChannel ignoring id ${e.id}`)}subscribeForDataChannelEvents(){this.dataChannel.on("onStateChanged",()=>{"Closed"===this.dataChannel.state&&(this.stopDataChannel(),this.setState("Inactive"))})}setState(e){if(this._state!==e){this.diagnostics.dataChannelSessionState=e;let t=e9();this._state=e,this.logger.safe.info(`[${t}] SessionDataChannelState changed, state=${this._state}`),"Inactive"===this._state||"Disabled"===this._state?this.stopDataChannel():"Active"===this._state&&this.getDataChannel(t),this.event("onStateChanged").raise(this._state)}}stopDataChannel(){this.dataChannel&&(this.logger.safe.info("stopDataChannel"),this.dataChannel.dispose(),this.dataChannel=null)}},f7=class extends tZ{constructor(e){super(),this.mainChannel=null,this.sourceId=a_,this._state="Inactive",this.dataHandlers=new Map,this.dataHandlerTelemetry=new Map,this.startTime=Date.now(),this.onStartCallbacks=new WeakMap,this.sessionDataChannelSubs=[],this.sendMessage=async(e,t,i)=>{if(!this.mainChannel||"Connected"!==this.mainChannel.state||"Active"!==this.state)throw Error("No active data channel to send data from");this.mainChannel.sendMessage(e,this.sourceId,t,i)},this.logger=e.createChild("PluginlessDataChannel")}get state(){return this._state}registerSessionDataChannel(e,t){this.sessionDataChannel&&this.stop(t),this.sessionDataChannel=e,this.subscribeForSessionDataChannelEvents()}setDataChannelSourceId(e){this.logger.debug(`setDataChannelSourceId ${e}`),this.mainChannel&&(this.mainChannel.sourceId=e),this.sourceId=e}requestDataChannelHandler(e){return this.sessionDataChannel.getDataChannel(e)}async sendUserEvents(e,t){if(this.mainChannel){let i=t?t.map(e=>parseInt(e,10)):[];this.mainChannel.sendMessage(0,this.sourceId,new TextEncoder().encode(e),i)}else throw this.logger.info("sendUserEvents() no data channel available"),Error("Main DataChannel is not active")}async addHandler(e,t){if(this.logger.info(`Adding handler with dataId ${e}`),this.dataHandlers.get(e))throw Error(`Data Id ${e} is already registered`);let i={isStarted:!1,handler:t};this.dataHandlers.set(e,i),this.recordDataHandlerEvent(e,"added"),this.mainChannel?.state==="Connected"&&this.startHandler(e,i)}async removeHandler(e){if(this.logger.info(`Removing handler with dataId ${e}`),!this.dataHandlers.has(e))throw Error(`Handler associated with Data Id ${e} is not attached`);let t=this.dataHandlers.get(e);t.isStarted&&this.stopHandler(e,t),this.dataHandlers.delete(e)}async updateNegotiationTag(e){}getTelemetry(){if(!this.dataHandlerTelemetry.size)return"";let e={};for(let[t,i]of this.dataHandlerTelemetry)e[t]=i;return JSON.stringify(e)}start(e){if(this.mainChannel)return void this.logger.info(`[${e}] already started`);this.logger.info(`[${e}] starting`),this.mainChannel=this.sessionDataChannel.getDataChannel(e),this.subscribeForMainDataChannelEvents()}stop(e){this.mainChannel&&(this.logger.info(`[${e}] stopping`),this.mainChannel.dispose(),this.mainChannel=null)}cleanup(e){this.logger.info(`[${e}] cleaning up`),this.stop(e),this.sessionDataChannel=null,this.unsubscribeFromSessionDataChannelEvents(),this.setState("Stopped")}dispose(e){this.cleanup(e),super.dispose(e)}setConfigProviderView(e){this.configProviderView=e}subscribeForMainDataChannelEvents(){this.mainChannel.on("onmessage",(e,t,i)=>{this.dataHandlers.has(e)&&(this.recordDataHandlerEvent(e,"recvd"),this.dataHandlers.get(e).handler.onDataReceived(e,i,t)),this.event("remoteUserEventsReceived").raise(e.toString(),new TextDecoder().decode(i))}),this.onMainChannelStateChanged(),this.mainChannel.on("onStateChanged",()=>this.onMainChannelStateChanged())}onMainChannelStateChanged(){if(this.mainChannel)switch(this.mainChannel.state){case"Connected":this.startHandlers();break;case"Closed":case"Destroyed":this.stopHandlers()}}startHandlers(){for(let[e,t]of this.dataHandlers.entries())t.isStarted||this.startHandler(e,t)}stopHandlers(){for(let[e,t]of this.dataHandlers.entries())t.isStarted&&this.stopHandler(e,t)}startHandler(e,t){this.logger.info(`Starting dataHandler id: ${e}`);let[i,n]=this.getOnStartCallbacks(e,t);t.handler.onStarted(e,i,n),t.isStarted=!0,this.recordDataHandlerEvent(e,"started")}stopHandler(e,t){this.logger.info(`Stopping dataHandler id: ${e}`),t.handler.onStopped(e),t.isStarted=!1,this.recordDataHandlerEvent(e,"removed")}subscribeForSessionDataChannelEvents(){let e=this.sessionDataChannel.on("onStateChanged",e=>{let t=e9();switch(e){case"Active":this.start(t),this.setState("Active");break;case"Inactive":this.stop(t),this.setState("Inactive");break;case"Failed":this.stop(t),this.setState("Failed");break;case"Disabled":this.stop(t),this.setState("Disabled");break;default:this.logger.warn(`[${t}] unhandled SessionDataChannelState ${e}`)}});this.sessionDataChannelSubs.push(e)}unsubscribeFromSessionDataChannelEvents(){this.sessionDataChannelSubs.forEach(e=>e.dispose()),this.sessionDataChannelSubs=[]}recordDataHandlerEvent(e,t){this.dataHandlerTelemetry.has(e)||this.dataHandlerTelemetry.set(e,[{}]);let i=this.dataHandlerTelemetry.get(e),n=i[i.length-1];if("added"===t&&void 0!==n.added){n={},i.push(n);let e=this.configProviderView?.config.maxStoredDataChannelValues??15;i.length>e&&i.shift()}switch(t){case"added":case"started":case"removed":n[t]=Date.now()-this.startTime;break;case"recvd":case"sent":n[t]=isNaN(n[t])?1:n[t]+1}}setState(e){this._state!==e&&(this._state=e,this.logger.info(`PluginlessDataChannelState changed, state=${this._state}`),this.event("onDataChannelStateUpdated").raise(this._state))}getOnStartCallbacks(e,t){let i=(t,i)=>(this.recordDataHandlerEvent(e,"sent"),this.sendMessage(e,t,i)),n=()=>{let t=this.mainChannel?.getDataIdStats(e);return void 0!==t?Promise.resolve({bufferSize:t.bufferSize,remainingBytes:t.remainingBytes,remainingPackets:t.remainingPackets}):Promise.reject(Error(`Stats of dataId ${e} is not available`))};return this.onStartCallbacks.set(t,[i,n]),this.onStartCallbacks.get(t)}},me=eR(e0());(e=>{let t=7,i=3;e.encodeMouseEvent=function(e){if(!e)return new Uint8Array(0);e.buttonType||(e.buttonType=0),e.xPos||(e.xPos=0),e.yPos||(e.yPos=0),e.wheelRotation||(e.wheelRotation=0);let i=new ArrayBuffer(t),n=new DataView(i),r=3&e.type,s=(7&e.buttonType)<<2,a=!!e.buttonDown<<5,o=!!e.wheelButtonDown<<6,l=0;return n.setUint8(0,1),n.setUint8(1,r|s|a|o|l),n.setUint16(2,e.xPos,!0),n.setUint16(4,e.yPos,!0),n.setUint8(6,e.wheelRotation),new Uint8Array(i)},e.encodeKeyboardEvent=function(e){let t=new ArrayBuffer(i),n=new DataView(t),r=3&e.codeType,s=0,a=!!e.keyUp<<4,o=!!e.repeat<<5,l=0,c=0;return n.setUint8(0,0),n.setUint8(1,r|s|a|o|l|c),n.setUint8(2,e.code),new Uint8Array(t)},e.decodeEventType=function(e){return e[0]},e.decodeMouseEvent=function(e){if(1!==e[0]||e.length!==t)return null;let i=new DataView(e.buffer),n=i.getUint8(1);return{type:3&n,buttonType:n>>2&7,buttonDown:!!(n>>5&1),wheelButtonDown:!!(n>>6&1),xPos:i.getUint16(2,!0),yPos:i.getUint16(4,!0),wheelRotation:i.getUint8(6)}},e.decodeKeyboardEvent=function(e){if(0!==e[0]||e.length!==i)return null;let t=new DataView(e.buffer),n=t.getUint8(1);return{codeType:3&n,code:t.getUint8(2),repeat:!!(n>>5&1),keyUp:!!(n>>4&1)}}})(y||(y={}));var mt=i(892891),mi=i(83836),mn=3e4,mr=1e4,ms=2e3,ma=6,mo="",ml=-1,mc=class extends ar{constructor(e,t,i,n,r,s,a,o,l,c){super(e,n,()=>this.recordedEvents.length>100),this.auditLogger=t,this.config=i,this.negotiationTag=r,this.callId=s,this.callType=a,this.participantId=o,this.endpointId=l,this.dataSourceId=c,this.messagesFromUnknownSender={},this.tsCallingVersion=tX()}setCallId(e){this.callId=e}setParticipantId(e){this.participantId=e}setDataSourceId(e){this.dataSourceId=e}setCallType(e){this.callType=e}callStateChanged(e){this.recordEvent("CallState",{state:e})}dataChannelAvailable(e){e?this.recordEvent("DataChannelAvailable"):this.recordEvent("DataChannelUnavailable")}shutdownSession(e){this.negotiationTag&&this.negotiationTag!==e?this.recordEvent("ShutdownByOtherSession",null,e):this.recordEvent("Shutdown")}recordProtocolMessage(e,t){!e&&(t in this.messagesFromUnknownSender||(this.messagesFromUnknownSender[t]=0),this.messagesFromUnknownSender[t]++)}sendAuditEvent(e,t,i,n,r){if(!this.auditLogger)return void this.logger.warn("AuditLogger is not set");let s=e=>e??"",a={TenantId:s(this.tenantId),CorrelationId:s(this.callId),ParticipantId:s(this.participantId),EndpointId:s(this.endpointId),CallType:s(this.callType),TsCallingVersion:s(this.tsCallingVersion),sharingNegotiationTag:s(this.negotiationTag),timestamp:Date.now(),eventType:t,role:mv(this.role),initiator:mv(i),controlCauseId:e,viewerParticipantId:s(r.participantId),viewerEndpointId:s(r.endpointId),viewerDataSourceId:s(r.dataSourceId),sharerParticipantId:s(n.participantId),sharerEndpointId:s(n.endpointId),sharerDataSourceId:s(n.dataSourceId)};try{this.auditLogger.sendEvent({eventName:"mdsc_gtc_audit",props:a})}catch(e){this.logger.error("Failed to send audit event",e)}}},md=class extends mc{constructor(e,t,i,n,r,s,a,o,l,c,d){super(e,t,i,n,r,s,a,o,l,c),this.role=2;let u=hM(d);if(u){this.sharerParticipantId=u;let e=(0,mt.find)(d.endpoints.endpointDetails,e=>e.participantId===u);e&&(this.sharerEndpointId=e.endpointId,this.sharerClientVersion=e.clientVersion)}}startHandshake(e){this.recordOperation("AvailableHandshake",e)}delayHandshakeSending(e,t,i){let n={delay:t,maxDelay:i};this.updateOperationData("AvailableHandshake",n,e)}handshakeSucceeded(e,t){let i={retries:t};this.recordOperationSuccess("AvailableHandshake",i,null,e)}handshakeFailed(e,t,i){let n={retries:t,reason:mg(i)};this.recordOperationFailure("AvailableHandshake",n,null,e)}requestControl(e,t){this.recordOperation("ControlRequest",e,e),this.recordAuditEvent(e,2,"ControlRequest",t)}requestControlAccepted(e,t){this.recordOperationSuccess("ControlRequest",e,e),this.recordAuditEvent(e,1,"ControlRequestAccepted",t),this.recordAuditEvent(e,2,"ControlStarted",t)}requestControlRejected(e,t,i){let n={reason:mm(t)};2===t?this.recordOperationTimeout("ControlRequest",n,e,e):this.recordOperationFailure("ControlRequest",n,e,e),this.recordAuditEvent(e,1,"ControlRequestDeclined",i)}controlGiven(e,t){this.recordEvent("ControlGiven",{sharerSourceId:t},e),this.recordAuditEvent(e,1,"ControlGiven",t),this.recordAuditEvent(e,2,"ControlStarted",t)}controlTerminated(e,t,i,n){let r={sharerSourceId:i,reason:mm(t)};this.recordEvent("ControlTerminated",r,e);let s=n?1:2;this.recordAuditEvent(e,s,"ControlTerminated",i)}recordAuditEvent(e,t,i,n){if(this.config.disableAudit)return;let r={participantId:this.sharerParticipantId,endpointId:this.sharerEndpointId,dataSourceId:n},s={participantId:this.participantId,endpointId:this.endpointId,dataSourceId:this.dataSourceId};this.sendAuditEvent(e,i,t,r,s)}getEvent(e,t){let i=e=>e??"";return{CorrelationId:i(this.callId),ParticipantId:i(this.participantId),EndpointId:i(this.endpointId),CallType:i(this.callType),NegotiationTag:i(this.negotiationTag),TsCallingVersion:i(this.tsCallingVersion),TenantId:i(this.tenantId),SharerParticipantId:i(this.sharerParticipantId),SharerClientVersion:i(this.sharerClientVersion),EventTimestampBag:super.getEventTimestampBag(e,t),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}}},mu=class extends mc{constructor(e,t,i,n,r,s,a,o,l,c){super(e,t,i,n,r,s,a,o,l,c),this.role=1}availableAckChanged(e){e?this.recordEvent("AvailableAckEnabled"):this.recordEvent("AvailableAckDisabled")}controlRequest(e,t,i){this.recordOperation("ControlRequest",e,e),this.recordAuditEvent(e,2,"ControlRequest",t,i)}controlRequestAccept(e,t,i){let n={status:"accepting",participantId:i};this.updateOperationData("ControlRequest",n,e,e),this.recordAuditEvent(e,1,"ControlRequestAccepted",t,i)}controlRequestAccepted(e,t,i){let n={participantId:i};this.recordOperationSuccess("ControlRequest",n,e,e),this.recordAuditEvent(e,2,"ControlStarted",t,i)}controlRequestRejected(e,t,i,n){let r={reason:mm(t),participantId:n};4===t?this.recordOperationTimeout("ControlRequest",r,e,e):this.recordOperationFailure("ControlRequest",r,e,e),this.recordAuditEvent(e,1,"ControlRequestDeclined",i,n)}giveControl(e,t,i){this.recordOperation("GiveControl",e,e),this.recordAuditEvent(e,1,"ControlGiven",t,i)}giveControlSucceeded(e,t,i){let n={participantId:i};this.recordOperationSuccess("GiveControl",n,e,e),this.recordAuditEvent(e,2,"ControlStarted",t,i)}giveControlFailed(e,t,i,n){let r={reason:mm(t)};this.recordOperationTimeout("GiveControl",r,e,e),this.recordAuditEvent(e,1,"ControlGiveFailed",i,n)}controlTerminated(e,t,i,n,r){let s={controllerSourceId:n,reason:mm(t)};this.recordEvent("ControlTerminated",s,e);let a=r?2:1;this.recordAuditEvent(e,a,"ControlTerminated",i,n)}recordAuditEvent(e,t,i,n,r){if(this.config.disableAudit)return;let s=hD(n,r)??n.endpoints?.endpointDetails?.[0],a={participantId:s?.participantId,endpointId:s?.endpointId,dataSourceId:r},o={participantId:this.participantId,endpointId:this.endpointId,dataSourceId:this.dataSourceId};this.sendAuditEvent(e,i,t,o,a)}getEvent(e,t){let i=e=>void 0===e?"":e;return{CorrelationId:i(this.callId),ParticipantId:i(this.participantId),EndpointId:i(this.endpointId),CallType:i(this.callType),NegotiationTag:i(this.negotiationTag),TsCallingVersion:i(this.tsCallingVersion),TenantId:i(this.tenantId),EventTimestampBag:this.getEventTimestampBag(e,t),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}}},mh=class extends tZ{constructor(e,t,i,n){super(e),this._logger=e,this._call=t,this._telemetryLoggers=i,this._config=n,this.controlState=0,this._role=0,this._enabled=!1,this._availableAckEnabled=!0,this._clientConfiguration={},this._dataChannelAvailable=!1,this._availableHandshakeSent=!1,this._controlRequest=null,this._controlRequestSubscription=null,this._controlCauseId=null,this._controllerParticipant=null,this._controllerParticipantSubscription=null,this._controllerSourceId=null,this._screenSharingVideoRenderer=null,this._screenSharingVideoRendererSubscriptions=[],this._sharerParticipant=null,this._pendingSharer=null,this._controlCapturer=null,this._captureEventSubscription=null,this._mouseControlEventSubscription=null,this._keyboardControlEventSubscription=null,this._requestControlTimer=null,this._grantControlTimer=null,this._acceptControlTimer=null,this._terminateControlTimer=null,this._delayedSendHandshakeTimer=null,this._availableAckTimer=null,this._retryAttempt=0,this._raiseRenderedAtViewer=null,this._participantSubscriptions={},this._viewerSessionLastTerminatedReason=0,this._completedViewerSessions=[],this.isEscalationInProgress=!1,this._logger.info("constructor"),this._callId=this._call.callId,this._callType=this._call.callType,this._call.on("callIdChanged",e=>{this._callId=e,this._recordSessionTelemetry(t=>t.setCallId(e))}),this._participantId=this._call.participantId,this._call.on("callLegIdChanged",e=>{this._participantId=e,this._recordSessionTelemetry(t=>{t.setParticipantId(e),t.setDataSourceId(this.getLocalEndpointDataSourceId())})}),this._endpointId=this._call.endpointId}get role(){return this._role}setAdapters(e,t,i){this._controlInjector=e,this._rendererAdapter=t,this._dataChannelAdapter=i,this._dataChannelAdapter.on("stateChange",e=>{this._onDataChannelStatusChanged(e),this._recordSessionTelemetry(t=>t.dataChannelAvailable(e))}),this._dataChannelAdapter.on("protocolMessage",(e,t,i,n)=>this.processProtocolMessage(e,t,i,n)),this._dataChannelAdapter.on("controlMessage",(e,t)=>this.processControlMessage(e,t))}testSetControlInjector(e){}enableScreenSharingControl(e,t,i,n){if(this._logger.info(`enableScreenSharingControl() enabled=${e} disabledReason=${t}`),this._availableAckEnabled!==e||this._allowControlForUser!==n){if(this._allowControlForUser=n,e)this._raiseScreenSharingControlCapableEvent(!0,mo);else{if(0===t){let e={reason:2,detail:i};this.event("sharingControlError").raise(e)}this._raiseScreenSharingControlCapableEvent(!1,mo)}this._availableAckEnabled!==e&&this._recordSharerSessionTelemetry(t=>t.availableAckChanged(e),!1),this._availableAckEnabled=e}}_canEnableGiveControl(){return this._controlInjector.canBeEnabled()}setRaiseRenderedAtViewer(e){this._raiseRenderedAtViewer=e}setScreenSharingControlFeatureFlag(e,t){this._logger.info(`setScreenSharingControlFeatureFlag() enabled=${e} clientConfiguration=${JSON.stringify(t)}`),this._enabled=e,this._availableAckEnabled=e,this._clientConfiguration={...t},this._enabled&&this._handleCallState(this._callState)}isScreenSharingControlEnabled(){return this._enabled}isInternalViewerControlEnabled(){return!this._clientConfiguration.externalViewerControlInitialization}isInternalSharerControlEnabled(){return!this._clientConfiguration.externalSharerControlInitialization}_disposeRenderer(e){for(let t of(this._disposeControlCapturer(e),this._screenSharingVideoRendererSubscriptions))t.dispose();this._screenSharingVideoRendererSubscriptions=[],this._screenSharingVideoRenderer=null}setRenderer(e,t){this._logger.info("setRenderer");let i=e9();if(this._disposeRenderer(i),!e)return Promise.resolve();let n=t||this._rendererAdapter.getTarget(e);return iT(()=>{this._setViewingRenderer(e,n)})}_isDataChannelActive(){return this._dataChannelAdapter.isActive()&&this._dataChannelAvailable}_raiseScreenSharingControlCapableEvent(e,t,i){if(this._enabled&&this._isDataChannelActive()){this._logger.info(`_raiseScreenSharingControlCapableEvent() enabled=true, capable=${e}, role=${this._role}`);let n={capable:e,id:t,disabledBySharer:i};this.event("sharingControlCapable").raise(n)}else{this._logger.info(`_raiseScreenSharingControlCapableEvent() enabled=false, capable=${e}, role=${this._role}`);let i={capable:!1,id:t};this.event("sharingControlCapable").raise(i)}}_notifySharingControlChanged(e,t,i){let n={inControl:e,id:t,terminatedReason:i};this._logger.info(`_sharingControlChanged inControl=${e}, id=${ta(t)}, terminatedReason=${mm(i)}, role=${this._role}`),this.event("sharingControlChanged").raise(n)}initControlForSharer(e){if(this._logger.info(`initControlForSharer() negotiationTag: ${e}`),this._isSharing()&&this._logger.warn("initControlForSharer() when already sharing"),this._isViewing()){this._logger.info("initControlForSharer: Viewer is active, temporarily shutting it down as sharer takes precedence"),4===this.controlState&&(this._logger.info("initControlForSharer: Viewer is controlling, notify UI that control is terminated"),this._notifySharingControlChanged(!1,mo,11));let e=this._currentViewerSessionTelemetry.negotiationTag,t=this._sharerParticipant;this.shutdownControlForViewer(),this._pendingNegotiationTag=e,this._pendingSharer=t}this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this._logger.info(`role is changing from=${this._role} to=1`),this._role=1,this._availableHandshakeSent=!1,this._raiseScreenSharingControlCapableEvent(this._canEnableGiveControl(),mo),this._initiateSharerSessionTelemetry(e)}enableControlInjector(e){this._logger.info(`enableControlInjector() trackId: ${e}`),this._canEnableGiveControl()?this._controlInjector.enableInjector(e).catch(e=>{let t={reason:0,detail:JSON.stringify({errorMsg:e})};this.event("sharingControlError").raise(t)}):this._logger.info("enableControlInjector() give control cannot be enabled")}shutdownControlForSharer(){if(this._logger.info("shutdownControlForSharer()"),!this._isSharing())return void this._logger.warn("shutdownControlForSharer() when not sharing");if(this._controlRequest){this._logger.warn("Rejecting pending control requests");let e=this._getDataSourceIdForParticipantLeg(this._controlRequest),t=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(t),this._sendControlRejectRequest(t.causeId,5,t.participant,e)}if(this._controllerParticipant){let e=this._controllerParticipant.participant;this._recordSharerSessionTelemetry(t=>t.controlTerminated(this._controlCauseId,5,e,this._controllerSourceId)),this._notifySharingControlChanged(!1,e.id,5)}this._finalizeSharerSessionTelemetry(),this._teardownSharerRemoteControl(),this._controlInjector.disableInjector().catch(e=>{let t={reason:0,detail:JSON.stringify({errorMsg:e})};this.event("sharingControlError").raise(t)}),this._resetControlState(),this._resetParticipantSubscriptions(),this._availableAckEnabled=this._enabled,this._logger.info(`role is changing from=${this._role} to=0`),this._role=0,this._pendingSharer&&(this._logger.info("shutdownControlForSharer: Initializing control for viewer with pending sharer"),this.initControlForViewer(this._pendingSharer,this._pendingNegotiationTag))}async moveSlide(e,t){if(this._logger.info(`moveSlide() isNext=${e} sourceId=${t}`),!this._isSharing())throw this._logger.warn("moveSlide() when not sharing"),Error("Sharing session is not active");return this._controlInjector.injectSlideMove(e,t)}_resetParticipantSubscriptions(){this._logger.info("resetParticipantSubscriptions() Stopping tracking all participant state changes"),(0,mt.each)(this._participantSubscriptions,e=>{e.dispose()}),this._participantSubscriptions={}}_initiateViewerSessionTelemetry(e,t,i){if(!i&&!t||!i&&(0,mt.find)(this._completedViewerSessions,e=>t===e))return null;if(this._currentViewerSessionTelemetry){if(this._currentViewerSessionTelemetry.negotiationTag===t)return null;this._finalizeViewerSessionTelemetry(t)}return this._logger.info(`Initiating new viewer session telemetry for ${t}`),this._currentViewerSessionTelemetry=new md(this._logger,this._telemetryLoggers?.gtcAudit,this._config,new Date().getTime(),t,this._callId,this._callType,this._participantId,this._endpointId,this.getLocalEndpointDataSourceId(),e),this._currentViewerSessionTelemetry.callStateChanged(this._callState),this._isDataChannelActive()&&this._currentViewerSessionTelemetry.dataChannelAvailable(!0),this._currentViewerSessionTelemetry}_recordViewerSessionTelemetry(e,t=!0){if(!this._currentViewerSessionTelemetry){t&&this._logger.error("Cannot record telemetry without current session");return}e&&e(this._currentViewerSessionTelemetry)}_finalizeViewerSessionTelemetry(e){if(!this._currentViewerSessionTelemetry)return;this._currentViewerSessionTelemetry.shutdownSession(e);let t=this._currentViewerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_viewer_session",t),this._currentViewerSessionTelemetry.negotiationTag&&this._completedViewerSessions.push(this._currentViewerSessionTelemetry.negotiationTag),this._currentViewerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentViewerSessionTelemetry.messagesFromUnknownSender).length&&mi.RootToolsManager.logExternalForDDL("ScreenSharingControl_viewer: messages received from unkonwn sender",JSON.stringify(t.ProtocolMessages)),this._currentViewerSessionTelemetry=null}_initiateSharerSessionTelemetry(e){if(this._currentSharerSessionTelemetry){if(this._currentSharerSessionTelemetry.negotiationTag===e)return null;this._finalizeSharerSessionTelemetry(this._currentSharerSessionTelemetry.negotiationTag)}this._logger.info(`Initiating new sharer session telemetry for ${e}`),this._currentSharerSessionTelemetry=new mu(this._logger,this._telemetryLoggers?.gtcAudit,this._config,new Date().getTime(),e,this._callId,this._callType,this._participantId,this._endpointId,this.getLocalEndpointDataSourceId()),this._isDataChannelActive()&&this._currentSharerSessionTelemetry.dataChannelAvailable(!0)}_recordSharerSessionTelemetry(e,t=!0){if(!this._currentSharerSessionTelemetry){t&&this._logger.error("Cannot record telemetry without current session");return}e&&e(this._currentSharerSessionTelemetry)}_finalizeSharerSessionTelemetry(e){if(!this._currentSharerSessionTelemetry)return;this._currentSharerSessionTelemetry.shutdownSession(e);let t=this._currentSharerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_sharer_session",t),this._currentSharerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentSharerSessionTelemetry.messagesFromUnknownSender).length&&mi.RootToolsManager.logExternalForDDL("ScreenSharingControl_sharer: messages received from unkonwn sender",JSON.stringify(t.ProtocolMessages)),this._currentSharerSessionTelemetry=null}_recordSessionTelemetry(e){e&&(this._currentSharerSessionTelemetry&&e(this._currentSharerSessionTelemetry),this._currentViewerSessionTelemetry&&e(this._currentViewerSessionTelemetry))}_sendTelemetryEvent(e,t){this._logger.info(`Sending event ${e}: `),Object.keys(t).forEach(e=>{this._logger.info(`     ${e} => ${t[e]}`)}),this._telemetryLoggers?.media?.sendEvent({eventName:e,props:t})}setCallType(e){this._callType=e,this._recordSessionTelemetry(t=>t.setCallType(e))}reportSharingSessionChangeForViewer(e,t){t&&this._initiateViewerSessionTelemetry(e,t,!1)}initControlForViewer(e,t){if(this._logger.info(`initControlForViewer(${ta(e?.id)}, ${t})`),!e)return void this._logger.warn("initControlForViewer: Sharer undefined, ignoring");if(this._isViewing()&&this._logger.warn("initControlForViewer: called when already viewing"),this._isSharing()){this._logger.info("initControlForViewer: currently sharing, keeping viewer initialization pending until sharing stops"),this._pendingSharer=e,this._pendingNegotiationTag=t;return}if(3!==this._callState){this._logger.info(`initControlForViewer: postponed until call is connected, callState=${this._callState}`),this._pendingSharer=e,this._pendingNegotiationTag=t;return}this._logger.info(`role is changing from=${this._role} to=2`),this._role=2,this._sharerParticipant?this._sharerParticipant.id!==e.id&&(this._logger.info(`initControlForViewer: sharer switched, new sharer id=${ta(e.id)}`),this._sharerParticipant=e,this._availableHandshakeSent=!1):(this._logger.info(`initControlForViewer: setting sharer to id=${ta(e.id)}`),this._sharerParticipant=e,this._availableHandshakeSent=!1),this._initiateViewerSessionTelemetry(e,t,!0),this._enabled&&this._isDataChannelActive()&&!this._availableHandshakeSent&&(this._resetControlState(),this._sharerParticipant=e,this._pendingSharer=null,this._logger.info("initControlForViewer: sending Available message to sharer"),this._startAvailableHandshake())}shutdownControlForViewer(e){if(this._logger.info(`shutdownControlForViewer() isViewing: ${this._isViewing()}`),this._pendingSharer=null,this._pendingNegotiationTag=null,e&&e.id!==this._sharerParticipant?.id||!this._isViewing())return void this._logger.warn("shutdownControlForViewer: ignoring, either sharer is different or not viewing");if(this._logger.info(`shutdownControlForViewer: sharerParticipant id=${e?ta(e.id):null}`),1===this.controlState){if(this._sharerParticipant){let e=this._getSharerDataSourceId();this._sendRequest({action:2,terminatedReason:8,causeId:this._controlCauseId},e)}else this._logger.warn("shutdownControlForViewer: No sharer participant to send cancel request to");if(this._requestControlPromise){let e={inControl:!1,id:mo,terminatedReason:8};this._requestControlPromise.reject(Error(JSON.stringify({controlInfo:e,details:""})))}else this._logger.warn("shutdownControlForViewer: requestControlPromise is not set while in controlState=RequestSent")}else 4===this.controlState&&(this._recordViewerSessionTelemetry(e=>e.controlTerminated(this._controlCauseId,6,this._controllerSourceId,!1)),this._notifySharingControlChanged(!1,mo,6));this._teardownViewerRemoteControl(),this._resetControlState(),this._screenSharingVideoRenderer=null,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._availableHandshakeSent=!1,this._finalizeViewerSessionTelemetry(),2===this._role?(this._logger.info(`_raiseScreenSharingControlCapableEvent  with user role=${this._role}, MRI=${mo}, isCapable=false`),this._raiseScreenSharingControlCapableEvent(!1,mo)):this._logger.warn(`can't call _raiseScreenSharingControlCapableEvent, role=${this._role}`),this._logger.info(`role is changing from=${this._role} to=0`),this._role=0}_resetControlRequest(e){this._clearControlRequest(),this._controlRequest=e,this._registerParticipantListener(e),3===e.participantState&&(this._logger.info(`participantState: Connected, raising: sharingIncomingControlRequest for participantId: ${ta(e.participant.id)}`),this.event("sharingIncomingControlRequest").raise(e.participant.id))}_clearControlRequest(){this._logger.info("_clearControlRequest()"),this._stopListeningToParticipantChanges(this._controlRequest),this._controlRequest=null}_stopListeningToParticipantChanges(e){this._controlRequestSubscription&&(this._logger.info(`_stopListeningToParticipantChanges: stopping tracking changes for ${ta(e.participant.id)}`),this._controlRequestSubscription.dispose(),this._controlRequestSubscription=null)}_registerParticipantListener(e){this._logger.info(`_registerParticipantListener: tracking changes for ${ta(e.participant.id)}`),this._logger.info(`request.participantState: ${e.participantState} | request.participant.state: ${e.participant.state}`),this._controlRequestSubscription=e.participant.changed(()=>{if(e.participant.state!==e.participantState)switch(this._logger.info(`request.participantState about to changed from: ${e.participantState} to: ${e.participant.state}`),e.participantState=e.participant.state,e.participantState){case 3:this.event("sharingIncomingControlRequest").raise(e.participant.id),this._logger.info(`participantState: Connected, raising: sharingIncomingControlRequest for participantId: ${ta(e.participant.id)}`);break;case 0:case 5:case 4:this.denyControlRequest().catch(e=>{this._logger.info(`It is ok if denyControlRequest rejects here as screensharing may have just been stopped. Err: ${e}`)}),this._logger.info(`_registerParticipantListener: participant ${ta(e.participant.id)} is no longer connected. resetting`),this._clearControlRequest(),this._raiseControlRequestCanceled(e);break;case 1:case 2:case 6:case 7:this._logger.info(`participantState: ${e.participantState}, participantId: ${ta(e.participant.id)}`);break;default:this._logger.error(`_registerParticipantListener: Unexpected participantState ${e.participantState} unhandled`)}})}_resetControllerParticipant(e){this._controllerParticipantSubscription&&(this._logger.info(`_resetControllerParticipant: stopping tracking changes for ${ta(this._controllerParticipant.participant.id)}`),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),e&&(this._logger.info(`_resetControllerParticipant: tracking changes for ${ta(e.participant.id)}`),this._controllerParticipantSubscription=e.participant.changed(()=>{3!==e.participant.state&&this.handleParticipantRemoved(e.participant.id)})),this._controlCauseId=e?.causeId??null,this._controllerParticipant=e}handleParticipantRemoved(e){if(this._participantSubscriptions[e]&&(this._logger.info(`handleParticipantRemoved(): Stopping tracking state changes for ${ta(e)}`),this._participantSubscriptions[e].dispose(),delete this._participantSubscriptions[e]),this._isSharing()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===e){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._teardownSharerRemoteControl(),this.controlState=0;let t=5;this._recordSharerSessionTelemetry(e=>e.controlTerminated(this._controlCauseId,t,this._controllerParticipant.participant,this._controllerSourceId,!0)),this._resetControllerParticipant(),this._notifySharingControlChanged(!1,e,t)}this._raiseScreenSharingControlCapableEvent(!1,e)}else this._sharerParticipant&&this._sharerParticipant.id===e&&4===this.controlState&&(this._logger.info("handleParticipantRemoved: sharer left call, tearing down control session"),this._teardownViewerRemoteControl(),this.controlState=0,this._notifySharingControlChanged(!1,mo,6))}callStateChanged(e){this._callState=e,this._recordSessionTelemetry(t=>t.callStateChanged(e)),this.isScreenSharingControlEnabled()&&this._handleCallState(e)}setIsEscalationInProgress(e){this.isEscalationInProgress=e}_getHandshakeDelay(){if(!this._config.handshakeSendDelay?.minParticipantThreshold)return 0;let e=0;if(this._call.participants.length>=this._config.handshakeSendDelay.minParticipantThreshold)for(let t of this._call.participants)t.endpoints?.endpointDetails.some(e=>"interactive"===e.appliedInteractivityLevel)&&e++;if(e<=this._config.handshakeSendDelay.minParticipantThreshold)return 0;let t=Math.ceil((e-this._config.handshakeSendDelay.minParticipantThreshold)/this._config.handshakeSendDelay.increaseEveryN);return Math.min(this._config.handshakeSendDelay.maxDelay,t*this._config.handshakeSendDelay.delayPerN)}_handleCallState(e){switch(e){case 3:this._handleCallConnected();break;case 7:this._handleCallDisconnected();break;case 4:case 5:this.isInternalViewerControlEnabled()&&this.shutdownControlForViewer()}}_handleCallConnected(){this._logger.info("_handleCallConnected()"),!this._pendingSharer||this._isSharing()||this._isViewing()||this.initControlForViewer(this._pendingSharer,this._pendingNegotiationTag)}_handleCallDisconnected(){this._logger.info("_handleCallDisconnected()"),this._isSharing()?this.isInternalSharerControlEnabled()&&this.shutdownControlForSharer():this.isInternalViewerControlEnabled()&&this.shutdownControlForViewer()}_videoSizeChanged(e,t){null!==this._controlCapturer&&this._controlCapturer.updateVideoSize(e,t)}_onRenderStarted(){let e={action:11,terminatedReason:0};if(this._sharerParticipant){let t=this._getSharerDataSourceId();this._sendRequest(e,t)}else this._logger.error("Attempted to send sharing rendered message to null sharerParticipant")}_setViewingRenderer(e,t){try{this._screenSharingVideoRenderer=e,this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeVideoSizeChangedEvent(this._screenSharingVideoRenderer,(e,t)=>{this._videoSizeChanged(e,t)})),this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeRenderStartedEvent(this._screenSharingVideoRenderer,()=>{this._onRenderStarted()}));let i=1;e.streamSize&&e.streamSize.width>0&&e.streamSize.height>0&&(i=e.streamSize.width/e.streamSize.height),this._controlCapturer=new me.SlimCoreElectronControlCapturer(this._logger,t,!0,i),4===this.controlState?(this._logger.info("_setViewingRenderer: detected local state is controlling"),this._setupViewerRemoteControl()):this._teardownViewerRemoteControl()}catch(e){this._logger.error(`_setViewingRenderer: unable to set _screenSharingVideoRenderer error=${e}`)}}_onDataChannelStatusChanged(e){this._logger.info(`_onDataChannelStatusChanged(): Data channel status=${e}, isEscalationInProgress=${this.isEscalationInProgress}`),e?!this._dataChannelAvailable&&(this._dataChannelAvailable=!0,this._recordSessionTelemetry(e=>e.dataChannelAvailable(!0)),this._enabled&&(this._isViewing()?this._availableHandshakeSent||(this._sharerParticipant?(this._logger.info("_onDataChannelStatusChanged: sending Available message to sharer"),this._startAvailableHandshake()):this._logger.error("Unexpected null _sharerParticipant trying to send Available to sharer")):this._isSharing()&&!this.isEscalationInProgress&&this._raiseScreenSharingControlCapableEvent(!0,mo))):this._dataChannelAvailable&&(this._recordSessionTelemetry(e=>e.dataChannelAvailable(!1)),this._dataChannelAvailable=!1,this._availableHandshakeSent=!1,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(3),this.isEscalationInProgress||this._raiseScreenSharingControlCapableEvent(!1,mo))}_isSharing(){return 1===this._role}_isViewing(){return 2===this._role}_handleAvailableRequest(e,t,i){if(!this._isSharing())return void this._logger.warn(`Ignoring available request since role=${this._role} is not sharing. Expecting for viewer side retries`);if(!this._enabled||!this._availableAckEnabled||!this._canEnableGiveControl()){this._logger.info(`Rejecting available ack - enabled=${this._enabled}, availableAck=${this._availableAckEnabled}, controlInjector=${this._canEnableGiveControl()}`),this._rejectAvailableRequest(e.handshakeId,i,9);return}if(!t?.id){this._logger.info("Unknown sender. Rejecting available ack"),this._rejectAvailableRequest(e.handshakeId,i,10);return}this._allowControlForUser&&"function"==typeof this._allowControlForUser?this._allowControlForUser(t).then(n=>{n?this._acceptAvailableRequest(e.handshakeId,t,i):this._rejectAvailableRequest(e.handshakeId,i,1)}):this._acceptAvailableRequest(e.handshakeId,t,i)}_acceptAvailableRequest(e,t,i){this._raiseScreenSharingControlCapableEvent(!0,t.id),this._participantSubscriptions[t.id]||(this._logger.info(`Tracking participant status for ${ta(t.id)}`),this._participantSubscriptions[t.id]=t.changed(()=>{3!==t.state&&(this._logger.info(`Participant ${ta(t.id)} is not connected. removing`),this.handleParticipantRemoved(t.id))})),this._logger.info(`Acking Available for handShake:${i}:${e}`),this.event("controlAvailableHandshake").raise(e,i,3),this._sendRequest({action:9,terminatedReason:0,handshakeId:e},i)}_rejectAvailableRequest(e,t,i){this._logger.info(`Rejecting Available for handShake:${t}:${e}`),this.event("controlAvailableHandshake").raise(e,t,7,this._getAvailableHandshakeTerminatedFromControlTerminated(i)),this._sendRequest({action:10,terminatedReason:i,handshakeId:e},t)}processProtocolMessage(e,t,i,n){return iT(()=>{this._processProtocolMessage(e,t,i,n)})}_raiseControlRequestCanceled(e){this.event("sharingIncomingControlRequestCancelled").raise(e.participant.id)}_handleControlRequest(e,t,i,n){this._recordSharerSessionTelemetry(i=>i.controlRequest(n,e,t)),this._enabled?this._controlRequest?(this._logger.warn("Sharer is already processing a control request...rejecting new requests"),this._sendControlRejectRequest(n,3,e,t)):this._controllerParticipant&&this._controllerParticipant.participant===e?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==i?(this._logger.warn(`rejecting control request from second endpoint. participantId: ${i}`),this._sendControlRejectRequest(n,3,e,t)):(this._logger.warn("Got control request for someone already in control"),this._resetControllerParticipant(),this._resetControlRequest({participant:e,participantState:e.state,participantId:i,causeId:n})):e?(this._logger.info(`resetControlRequest for participantId: ${i}`),this._resetControlRequest({participant:e,participantState:e.state,participantId:i,causeId:n})):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring"):(this._logger.warn("Sharer control is disabled - rejecting request"),this._sendControlRejectRequest(n,9,e,t))}_handleAcceptRequest(e,t){if(1===this.controlState){let i=this._sendRequest({action:5,terminatedReason:0},t);this._logger.info(`_handleAcceptRequest controlMessage.action: ${mp(e.action)} _sendRequest isSent: ${i}`),i?(this._setupViewerRemoteControl(),this.controlState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error(`Unexpected, no promise could be resolved - controlState=RequestSent action=${mp(e.action)}`),this._recordViewerSessionTelemetry(e=>e.requestControlAccepted(this._controlCauseId,t))):this._requestControlPromise?this._requestControlPromise.reject(Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but failed to send ack"}))):this._logger.error(`Unexpected, no promise could be resolved - controlState=${mf(this.controlState)} action=${mp(e.action)}`),this._cancelRequestControlTimer()}else this._logger.warn(`AcceptRequest message received in controlState=${mf(this.controlState)}`)}_handleRejectRequest(e,t){if(1===this.controlState){this._logger.info(`_handleRejectRequest: controlState: ${mf(this.controlState)}, about to be changed to: ${mf(0)}`),this.controlState=0;let i={inControl:!1,id:mo,terminatedReason:e.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(Error(JSON.stringify({controlInfo:i,details:""}))):this._logger.error(`Unexpected, no promise could be resolved - controlState=RequestSent action=${mp(e.action)}`),this._recordViewerSessionTelemetry(i=>i.requestControlRejected(this._controlCauseId,e.terminatedReason,t)),this._cancelRequestControlTimer(),this._controlCauseId=null}else this._logger.warn(`RejectRequest message received in controlState=${mf(this.controlState)} reason=${e.terminatedReason}`)}_handleCancelControlRequest(e,t){if(this._logger.info(`_handleCancelControlRequest action=${mp(e.action)} sender=${t}, controlRequest participantId: ${this._controlRequest.participantId}, controlRequest participantState: ${this._controlRequest.participantState}:`),this._controlRequest){let i=this._controlRequest;this._logger.info(`_handleCancelControlRequest action=${mp(e.action)} sender=${t}, about to raise: _raiseControlRequestCanceled state: ${this._controlRequest.participantState} `),this._recordSharerSessionTelemetry(n=>n.controlRequestRejected(e.causeId,e.terminatedReason,i.participant,t)),this._clearControlRequest(),this._raiseControlRequestCanceled(i)}}_handleGiveControl(e,t,i){let n=this._sendRequest({action:5,terminatedReason:0},t);this._logger.info(`_handleGiveControl: controlMessage.action: ${mp(e.action)} _sendRequest isSent: ${n}`),this._controlCauseId=e.causeId,n&&(this._setupViewerRemoteControl(),this._logger.info(`controlState: ${mf(this.controlState)}, about to be changed to: ${mf(4)}`),this.controlState=4,this._recordViewerSessionTelemetry(e=>e.controlGiven(this._controlCauseId,t)),this._notifySharingControlChanged(!0,mo,e.terminatedReason))}_handleAck(e,t,i){if(2===this.controlState)if(this._controllerParticipant&&this._controllerParticipant.participant.id===t.id){let t=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);i!==t&&this._logger.warn(`acknowledging source id: ${i} does not match requesting source id: ${t}`),this._logger.info(`Setting up remote control for controller source id=${t}`),this._setupSharerRemoteControl(t),this._logger.info(`controlState: ${mf(this.controlState)}, about to be changed to: ${mf(3)}`),this.controlState=3,this._notifySharingControlChanged(!0,this._controllerParticipant.participant.id,e.terminatedReason),this._grantControlPromise?(this._grantControlPromise.resolve(),this._cancelGrantControlTimer(),this._recordSharerSessionTelemetry(e=>e.giveControlSucceeded(this._controlCauseId,this._controllerParticipant.participant,t))):this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer(),this._recordSharerSessionTelemetry(e=>e.controlRequestAccepted(this._controlCauseId,this._controllerParticipant.participant,t))):this._logger.error(`Unexpected, no promise could be resolved - controlState=WaitingForControlAck action=${mp(e.action)}`)}else t?this._logger.warn(`Ignoring ack from participant that does not match controller id=${ta(t.id)}`):this._logger.warn(`Ignoring ack from null participant source id=${i}`);else 5===this.controlState?(this._logger.info(`controlState: ${mf(this.controlState)}, about to be changed to: ${mf(0)}`),this.controlState=0,this._resetControllerParticipant(),this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._cancelTerminateControlTimer()):this._logger.error(`Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck action=${mp(e.action)}`)):this._logger.warn(`Unexpected ack in control controlState=${mf(this.controlState)}`)}_handleTerminate(e,t,i){let n;this._isViewing()?(this._teardownViewerRemoteControl(),n=mo,this._recordViewerSessionTelemetry(t=>t.controlTerminated(this._controlCauseId,e.terminatedReason,i,!0))):(this._teardownSharerRemoteControl(),t?n=t.id:this._logger.error("Got terminate message but could not find a sender participant!"),this._recordSharerSessionTelemetry(t=>t.controlTerminated(this._controlCauseId,e.terminatedReason,this._controllerParticipant.participant,i,!0))),this._logger.info(`controlMessage action: ${mp(e.action)}, controllerId: ${ta(n)}`),this._logger.info(`controlState: ${mf(this.controlState)}, about to be changed to: ${mf(0)}`),this.controlState=0,this._resetControllerParticipant(),this._notifySharingControlChanged(!1,n,e.terminatedReason),8===e.action&&this._sendRequest({action:5,terminatedReason:0},i)}_handleAvailableAck(e){this._terminateAvailableHandshake&&(this._logger.info(`_handleAvailableAck: terminate available handshake reason: 1,handshakeId: ${e.handshakeId}`),this._terminateAvailableHandshake(1,e.handshakeId)),2===this._role?this._raiseScreenSharingControlCapableEvent(!0,mo):this._logger.info(`Ignoring AvailableAck as viewer session is not initialized, role: ${this._role}`)}_handleAvailableNack(e){if(this._logger.info(`_handleAvailableNack: action=${mp(e.action)} terminate reason: ${mm(e.terminatedReason)}`),this._viewerSessionLastTerminatedReason=e.terminatedReason,10===e.terminatedReason)return void this._logger.warn("_handleAvailableNack: control terminate reason: UnknownSender");this._terminateAvailableHandshake&&(this._terminateAvailableHandshake(this._getAvailableHandshakeTerminatedFromControlTerminated(e.terminatedReason),e.handshakeId),this._logger.info(`_handleAvailableNack: terminateAvailableHandshake reason=${mm(e.terminatedReason)}`)),1===e.terminatedReason?(this._logger.warn("_handleAvailableNack: control terminate reason: SharerDenied"),this._raiseScreenSharingControlCapableEvent(!0,mo,!0)):this._raiseScreenSharingControlCapableEvent(!1,mo)}_handleRenderedAtViewer(e,t){this._raiseRenderedAtViewer&&(t?(this._logger.info(`raiseRenderedAtViewer senderId=${ta(t.id)}, action=${mp(e.action)}`),this._raiseRenderedAtViewer(t.id)):this._logger.error("Got RenderedAtViewer message but could not find a sender participant!"))}_processProtocolMessage(e,t,i,n){let r;this._recordSessionTelemetry(e=>e.recordProtocolMessage(t,n));try{r=JSON.parse(e)}catch(e){this._logger.error("Error parsing controlMessage");return}switch(!t&&this._logger.warn(`protocol message from unknown sender with sourceId=${n}`),this._logger.info(`_processProtocolMessage action=${mp(r.action)}, sourceId=${n}`),r.action){case 0:this._handleAvailableRequest(r,t,n);break;case 1:this._handleControlRequest(t,n,i,r.causeId);break;case 3:this._handleAcceptRequest(r,n);break;case 4:this._handleRejectRequest(r,n);break;case 2:this._handleCancelControlRequest(r,n);break;case 6:this._handleGiveControl(r,n,t);break;case 5:this._handleAck(r,t,n);break;case 8:case 7:this._handleTerminate(r,t,n);break;case 9:this._handleAvailableAck(r);break;case 10:this._handleAvailableNack(r);break;case 11:this._handleRenderedAtViewer(r,t);break;default:this._logger.error(`Unknown request action received on control protocol data sink, action=${mp(r.action)}`)}}_getAvailableHandshakeTerminatedFromControlTerminated(e){switch(e){case 10:return 6;case 1:return 7;default:return 0}}_sendRequest(e,t){if(t<0)return this._logger.warn(`Unexpected: invalid sourceID=${t}`),!1;this._logger.info(`_sendRequest() action=${mp(e.action)} recipient sourceid=${t}`);let i={type:0,message:JSON.stringify(e)},n=[t];return this._dataChannelAdapter.sendProtocolMessage(tH(JSON.stringify(i)),n),!0}async processControlMessage(e,t){return t!==this._controllerSourceId?void this._logger.debug(`Ignoring control message, wrong sourceId. Expected: ${t}, got: ${this._controllerSourceId}`):3!==this.controlState?void this._logger.debug(`Ignoring control message, wrong controlState. Expected: RemoteControlling, got: ${mf(this.controlState)}`):this._processControlMessage(e,t)}_processControlMessage(e,t){return this._controlInjector.injectRawInput(e,t)}_resetControlState(){this._logger.info("_resetControlState()"),this.controlState=0,this._resetControllerParticipant(),this._sharerParticipant=null,this._controlCauseId=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer()}_setupSharerRemoteControl(e){this._logger.info(`_setupSharerRemoteControl() sourceId=${e}`),this._controllerSourceId=e,this._controlInjector.showVirtualCursor(e).catch(t=>{let i={reason:3,detail:JSON.stringify({sourceId:e,errorMsg:t})};this.event("sharingControlError").raise(i)})}_teardownSharerRemoteControl(){this._logger.info("_teardownSharerRemoteControl()"),this._controllerSourceId=null,this._controlInjector.showVirtualCursor(0).catch(e=>{let t={reason:3,detail:JSON.stringify({sourceId:0,errorMsg:e})};this.event("sharingControlError").raise(t)})}_setupViewerRemoteControl(){this._logger.info("_setupViewerRemoteControl()"),this._setCapturerMode(3)}_teardownViewerRemoteControl(){this._logger.info("_teardownViewerRemoteControl()"),this._setCapturerMode(0)}_clearCapturerEventSubscriptions(){this._logger.info("_clearCapturerEventSubscriptions()"),this._captureEventSubscription&&(this._captureEventSubscription.dispose(),this._captureEventSubscription=null),this._mouseControlEventSubscription&&(this._mouseControlEventSubscription.dispose(),this._mouseControlEventSubscription=null),this._keyboardControlEventSubscription&&(this._keyboardControlEventSubscription.dispose(),this._keyboardControlEventSubscription=null)}sendRemoteControlEvent(e,t){if(!t)return void this._logger.error("sendRemoteControlEvent: Invalid argument.");switch(e){case"mouseControlEvent":this._sendControlEvent(y.encodeMouseEvent(t));break;case"keyboardControlEvent":this._sendControlEvent(y.encodeKeyboardEvent(t));break;default:this._logger.error("sendRemoteControlEvent: Invalid type=",e);return}}_sendControlEvent(e){if(!this._isDataChannelActive()||!this._sharerParticipant||4!==this.controlState)return void this._logger.error(`_sendControlEvent: Dropping message - No data channel or wrong controlState. dataConnected: ${this._isDataChannelActive()} controlState: ${mf(this.controlState)})`);let t=[this._getSharerDataSourceId()];this._dataChannelAdapter.sendControlMessage(e,t)}_setCapturerMode(e){if(this._logger.info(`_setCapturerMode() capturerMode=${e}`),!this._controlCapturer)return void this._logger.info("_controlCapturer not set, relying on external controlCapturer");this._controlCapturer.setCaptureMode(e),this._clearCapturerEventSubscriptions(),1===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",e=>{0===e&&this.event("sharingRendererClicked").raise()}):2===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",e=>{1===e?this.event("sharingRendererMouseEntering").raise():2===e&&this.event("sharingRendererMouseLeaving").raise()}):3===e&&(this._mouseControlEventSubscription=this._controlCapturer.on("mouseControlEvent",e=>{this._sendControlEvent(y.encodeMouseEvent(e))}),this._keyboardControlEventSubscription=this._controlCapturer.on("keyboardControlEvent",e=>{this._sendControlEvent(y.encodeKeyboardEvent(e))}),this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",e=>{1===e?this.event("sharingRendererMouseEntering").raise():2===e&&this.event("sharingRendererMouseLeaving").raise()}))}setPointerImage(e,t){return(this._logger.warn("setPointerImage is deprecated. Use setLocalPointerImage or setRemotePointerImage"),e)?this.setRemotePointerImage(e,t):this.setLocalPointerImage(t)}setLocalPointerImage(e){return 0===e.length?Promise.reject(Error("setLocalPointerImage invalid image length")):this._setPointerImage(0,e)}async setRemotePointerImage(e,t){if(!e)throw Error("setRemotePointerImage participant is null");if(0===t.length)throw Error("setRemotePointerImage invalid image length");let i=this._getParticipantsDataSourceIds(e);if(0===i.length)throw Error("setRemotePointerImage unable to map participant to sourceIds");for(let e of(this._logger.info(`set pointer image for ${i.length} sources`),i))await this._setPointerImage(e,t)}_setPointerImage(e,t){return this._isSharing()||this._logger.warn("_setPointerImage called when not sharing"),this._controlInjector.setPointerImage(e,t)}startPointerMode(){return this._enabled?this._isDataChannelActive()?0!==this.controlState?Promise.reject(Error(`startPointerMode called in bad control controlState=${mf(this.controlState)}`)):this._isViewing()?iT(()=>{this._setCapturerMode(2)}):Promise.reject(Error("startPointerMode when not viewing")):Promise.reject(Error("startPointerMode when data channel not active")):Promise.reject(Error("startPointerMode when feature not enabled"))}stopPointerMode(){return 0!==this.controlState?Promise.reject(Error(`stopPointerMode called in bad control controlState=${mf(this.controlState)}`)):this._isViewing()?iT(()=>{this._setCapturerMode(1)}):Promise.reject(Error("stopPointerMode when not viewing"))}_startAvailableHandshake(){let e=this._getSharerDataSourceId(),t=iW(),i=this._getHandshakeDelay(),n=Math.floor(Math.random()*i);if(this._logger.info(`_startAvailableHandshake() - handshakeId: ${e}:${t} ${n>0?`delay: ${n}ms maxDelay: ${i}ms`:""}}`),this._terminateAvailableHandshake&&(this._logger.warn("Replacing existing availble handshake"),this._terminateAvailableHandshake(4)),this._recordViewerSessionTelemetry(e=>e.startHandshake(t)),e<0)this._logger.warn(`_startAvailableHandshake() - sharer: ${ta(this._sharerParticipant?.id)} has no data channel, retrying later`),this._waitForAvailableAck(t);else{let r=()=>{this.event("controlAvailableHandshake").raise(t,e,1),this._sendRequest({action:0,terminatedReason:0,handshakeId:t},e)||this._logger.error("Failed to send Available message to sharer, will retry after backoff"),this._waitForAvailableAck(t)};n>0?(this._delayedSendHandshakeTimer=window.setTimeout(r,n),this._recordViewerSessionTelemetry(e=>e.delayHandshakeSending(t,n,i))):r()}this._availableHandshakeSent=!0,this._terminateAvailableHandshake=(i=0,n)=>{this._logger.info(`_terminateAvailableHandshake() - handshakeId: ${e}:${t}, status: ${i}`),1===i?this._recordViewerSessionTelemetry(e=>e.handshakeSucceeded(t,this._retryAttempt)):(this._logger.error(`GTC handshake terminated with code ${i}, last terminated reason: ${mm(this._viewerSessionLastTerminatedReason)}`),mi.RootToolsManager.logExternalForDDL(`GTC handshake terminated with code ${i},`,this._viewerSessionLastTerminatedReason.toString()),this._recordViewerSessionTelemetry(e=>e.handshakeFailed(t,this._retryAttempt,i))),this._terminateAvailableHandshake=null,this.event("controlAvailableHandshake").raise(t,e,1===i?5:6,i),n&&n!==t&&this._logger.warn(`AvailableSeries: Got handshake from another series - expected: ${t}, received: ${n}`),this._availableAckTimer&&(clearTimeout(this._availableAckTimer),this._availableAckTimer=null),this._delayedSendHandshakeTimer&&(clearTimeout(this._delayedSendHandshakeTimer),this._delayedSendHandshakeTimer=null),this._retryAttempt=0}}_waitForAvailableAck(e){this._logger.info("_waitForAvailableAck()"),this._availableAckTimer=window.setTimeout(()=>{this._logger.warn(`No Ack received for Available message from attempt=${this._retryAttempt}`),this._availableAckTimer=null;let t=this._getSharerDataSourceId();if(this._retryAttempt<=ma)t>=0?(this._logger.info(`Re-sending Available message handshakeId: ${t}:${e}`),this.event("controlAvailableHandshake").raise(e,t,2),this._sendRequest({action:0,terminatedReason:0,handshakeId:e},t)):this._logger.warn(`_waitForAvailableAck() - sharer: ${ta(this._sharerParticipant?.id)} has no data channel, retrying later`),this._waitForAvailableAck(e);else{if(this._logger.error("Reached Available retry limit! Control capability will be false"),this._terminateAvailableHandshake)this._terminateAvailableHandshake(5);else{let e={reason:4,detail:JSON.stringify({sourceId:t,errorMsg:`Timed out after ${this._retryAttempt} tries`})};this.event("sharingControlError").raise(e)}this._raiseScreenSharingControlCapableEvent(!1,mo)}},ms*++this._retryAttempt)}requestControl(){if(!this._enabled)return Promise.reject(Error("requestControl when feature not enabled"));if(!this._isDataChannelActive())return Promise.reject(Error("requestControl when data channel not active"));if(0!==this.controlState)return Promise.reject(Error(`requestControl called in bad controlState=${mf(this.controlState)}`));if(!this._isViewing())return Promise.reject(Error("requestControl when not viewing"));if(!this._sharerParticipant)return Promise.reject(Error("requestControl unexpected null sharer"));return this._requestControlPromise?Promise.reject(Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(Error("terminate control promise has not been resolved yet while requesting control")):this._requestControl()}_requestControl(){let e=this._controlCauseId=e9();this._logger.info(`_requestControl(), controlState: ${this.controlState}, controlCauseId: ${e}`),this._requestControlPromise=new iE;let t=()=>{this._requestControlPromise=null};this._requestControlPromise.promise.then(t,t);let i=this._getSharerDataSourceId();if(!this._sendRequest({action:1,terminatedReason:0,causeId:e},i)){let e={inControl:!1,id:mo,terminatedReason:7};return this._requestControlPromise.reject(Error()),this._logger.error("_requestControl(): failed to send the request."),Promise.reject(Error(JSON.stringify({controlInfo:e,details:""})))}return this._recordViewerSessionTelemetry(t=>t.requestControl(e,i)),this.controlState=1,this._requestControlTimer=window.setTimeout(()=>{if(1===this.controlState){this.controlState=0,this._controlCauseId=null,this._logger.warn("No response to control request - canceling"),this._sendRequest({action:2,terminatedReason:2,causeId:e},i)||this._logger.error("Failed to send the cancel control request");let t={inControl:!1,id:mo,terminatedReason:2};this._recordViewerSessionTelemetry(n=>n.requestControlRejected(e,t.terminatedReason,i)),this._requestControlPromise?this._requestControlPromise.reject(Error(JSON.stringify({controlInfo:t,details:"we did not get any response to the control - terminating control"}))):this._logger.error("Unexpected, no promise could be resolved - controlState=RequestSent")}else this._requestControlPromise?this._requestControlPromise.reject(Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):this._logger.error(`Unexpected, no promise could be resolved - controlState=${mf(this.controlState)}`);this._requestControlTimer=null},mn),this._requestControlPromise.promise}_cancelRequestControlTimer(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)}cancelControl(){if(!this._enabled)return Promise.reject(Error("cancelControl when feature not enabled"));if(!this._isDataChannelActive())return Promise.reject(Error("cancelControl when data channel not active"));if(1!==this.controlState)return Promise.reject(Error(`cancelControl called in bad state=${mf(this.controlState)}`));if(!this._isViewing())return Promise.reject(Error("cancelControl when not viewing"));if(!this._sharerParticipant)return Promise.reject(Error("cancelControl unexpected null sharer"));return this._requestControlPromise?this._terminateControlPromise?Promise.reject(Error("Terminate control promise has not been resolved yet while cancelling control")):this._cancelControl():Promise.reject(Error("Request control promise has been resolved while cancelling control"))}_cancelControl(){this._logger.info("_cancelControl()");let e=this._getSharerDataSourceId();if(1!==this.controlState)return Promise.reject(Error("Cancel control - in bad state - do nothing"));if(this._cancelRequestControlTimer(),this.controlState=0,this._logger.info("Viewer cancels the control"),!this._sendRequest({action:2,terminatedReason:8,causeId:this._controlCauseId},e))return Promise.reject(Error("Failed to send cancel control request"));{let t={inControl:!1,id:mo,terminatedReason:8};this._recordViewerSessionTelemetry(i=>i.requestControlRejected(this._controlCauseId,t.terminatedReason,e)),this._controlCauseId=null,this._requestControlPromise.reject(Error(JSON.stringify({controlInfo:t,details:""})))}return new Promise((e,t)=>{e()})}acceptControlRequest(){return this._enabled?this._isDataChannelActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(Error("Accept control promise has not been resolved yet while accepting control")):this._grantControlPromise?Promise.reject(Error("Grant control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(Error("Terminate control promise has not been resolved yet while accepting control")):this._acceptControlRequest():Promise.reject(Error("acceptControlRequest when not sharing")):Promise.reject(Error("acceptControlRequest while no control request pending")):Promise.reject(Error("acceptControlRequest when data channel not active")):Promise.reject(Error("acceptControlRequest when feature not enabled"))}async _acceptControlRequest(){this._logger.info("_acceptControlRequest()"),this._acceptControlPromise=new iE;let e=()=>{this._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(e,e),this._controllerParticipant){this._logger.warn("_acceptControlRequest called while another participant already has control - terminating control");try{await this._terminateControl(!1)}catch(e){this._logger.error("_acceptControlRequest: failed to gracefully terminate control of previous controller",e)}this._resetControllerParticipant()}let t=this._getDataSourceIdForParticipantLeg(this._controlRequest),i=this._controlRequest.participant.id,n=this._controlRequest.causeId,r=this._controlRequest.participant;return this._sendControlAcceptRequest(n,r,t)?(this._resetControllerParticipant(this._controlRequest),this._clearControlRequest(),this.controlState=2,this._acceptControlTimer=window.setTimeout(()=>{2===this.controlState?(this.controlState=0,this._resetControllerParticipant(),this._logger.error("No ack received when accepting control request - terminating control"),this._sendRequest({action:7,terminatedReason:4,causeId:n},t)||this._logger.error("Failed to send the TerminateNoAck request"),this._recordSharerSessionTelemetry(e=>e.controlRequestRejected(n,4,r,t)),this._notifySharingControlChanged(!1,i,4),this._acceptControlPromise?this._acceptControlPromise.reject(Error("No ack received when accept control - terminating control")):this._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck")):this._acceptControlPromise?this._acceptControlPromise.reject(Error("accept control - times out in bad state - do nothing")):this._logger.error(`Unexpected, no promise could be resolved - controlState=${mf(this.controlState)}`),this._acceptControlTimer=null},mr),this._acceptControlPromise.promise):(this._logger.error("Failed to send the accept control request"),this._acceptControlPromise.reject(Error()),Promise.reject(Error("Failed to send the accept control request!")))}_sendControlAcceptRequest(e,t,i){let n=this._sendRequest({action:3,terminatedReason:0,causeId:e},i);return this._recordSharerSessionTelemetry(n=>n.controlRequestAccept(e,t,i)),n}_sendControlRejectRequest(e,t,i,n){let r=this._sendRequest({action:4,terminatedReason:t},n);return this._recordSharerSessionTelemetry(r=>r.controlRequestRejected(e,t,i,n)),r}_cancelAcceptControlTimer(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)}denyControlRequest(){return this._enabled?this._isDataChannelActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(Error("Accept control promise has not been resolved yet while denying control")):this._grantControlPromise?Promise.reject(Error("Grant control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(Error("Terminate control promise has not been resolved yet while denying control")):this._denyControlRequest():Promise.reject(Error("denyControlRequest when not sharing")):Promise.reject(Error("denyControlRequest while no control request pending")):Promise.reject(Error("denyControlRequest when data channel not active")):Promise.reject(Error("denyControlRequest when feature not enabled"))}_denyControlRequest(){this._logger.info("_denyControlRequest()");let e=this._getDataSourceIdForParticipantLeg(this._controlRequest),t=this._sendControlRejectRequest(this._controlRequest.causeId,1,this._controlRequest.participant,e);return(this._clearControlRequest(),t)?Promise.resolve():Promise.reject(Error("Failed to send the deny control requst"))}grantControl(e){if(!this._enabled)return Promise.reject(Error("grantControl when feature not enabled"));if(!this._isDataChannelActive())return Promise.reject(Error("grantControl when data channel not active"));if(this._controlRequest)return Promise.reject(Error("grantControl called while control request pending"));if(!this._isSharing())return Promise.reject(Error("grantControl when not sharing"));if(!e)return Promise.reject(Error("grantControl null participant"));return this._acceptControlPromise?Promise.reject(Error("Accept control promise has not been resolved yet while granting control")):this._grantControlPromise?Promise.reject(Error("Grant control promise has not been resolved yet while granting control")):this._terminateControlPromise?Promise.reject(Error("Terminate control promise has not been resolved yet while granting control")):this._grantControl(e)}_grantControl(e){this._logger.info("_grantControl()"),this._grantControlPromise=new iE;let t=()=>{this._grantControlPromise=null};if(this._grantControlPromise.promise.then(t,t),3===this.controlState)if(this._controllerParticipant.participant?.id===e.id)return this._logger.warn("_grantControl called for participant who already has control"),this._grantControlPromise.resolve(),new Promise((e,t)=>{e()});else{this._logger.warn("_grantControl called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();let e=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},e)||this._logger.error("Failed to send the terminateNoAck request")}let i=this._mapParticipantToSourceId(e),n=e9(),r=this._sendRequest({action:6,terminatedReason:0,causeId:n},i);if(this._recordSharerSessionTelemetry(t=>t.giveControl(n,e,i)),!r)return this._logger.error("Failed to send the grant control request"),this._grantControlPromise.reject(Error()),Promise.reject(Error("Failed to send the grant control request!"));let s=this._getParticipantIdForDataSourceId(e,i);return this._resetControllerParticipant({participant:e,participantState:e.state,participantId:s,causeId:n}),this.controlState=2,this._grantControlTimer=window.setTimeout(()=>{2===this.controlState?(this.controlState=0,this._resetControllerParticipant(),this._logger.error("No ack received when granting control - terminating control"),this._sendRequest({action:7,terminatedReason:4},i)||this._logger.error("Failed to send the terminateNoAck request"),this._recordSharerSessionTelemetry(t=>t.giveControlFailed(n,4,e,i)),this._grantControlPromise?this._grantControlPromise.reject(Error("No ack received when granting control - terminating control")):this._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck")):this._grantControlPromise?this._grantControlPromise.reject(Error("Grant control - times out in bad state - do nothing")):this._logger.error(`Unexpected, no promise could be resolved - controlState=${mf(this.controlState)}`),this._grantControlTimer=null},mr),this._grantControlPromise.promise}_cancelGrantControlTimer(){this._grantControlTimer&&(this._grantControlPromise&&this._grantControlPromise.reject(Error("cancelled by _cancelGrantControlTimer")),clearTimeout(this._grantControlTimer),this._grantControlTimer=null)}_mapParticipantToSourceId(e){return this._dataChannelAdapter.isActive()?hw(e,3):(this._logger.error("Null data channel cannot map participant to source id"),ml)}_getParticipantsDataSourceIds(e){let t=[];try{if(e?.endpoints?.endpointDetails){if(1===e.endpoints.endpointDetails.length){let i=e.endpoints.endpointDetails[0];if(!i?.mediaStreams)return t.push(a_),t}for(let i of e.endpoints.endpointDetails)if(i?.mediaStreams){for(let e of i.mediaStreams)if(3===hb(e.type)){if(t.push(e.sourceId),t.length>=8)return this._logger.error("Excessive amount of data streams"),t;break}}}}catch(e){this._logger.error(`_getParticipantsDataSourceIds caught exception error=${e}`)}return t}_getParticipantIdForDataSourceId(e,t){return hR(e,3,t)}_getDataSourceIdForParticipantId(e,t){return this._dataChannelAdapter.isActive()?hP(e,t,3):(this._logger.error("Null data channel cannot map participant to source id"),ml)}_getDataSourceIdForParticipantLeg(e){return this._getDataSourceIdForParticipantId(e.participant,e.participantId)}_getSharerDataSourceId(){let e=hM(this._sharerParticipant);return e?this._getDataSourceIdForParticipantId(this._sharerParticipant,e):(this._logger.warn("Unable to identify the sharer participantId, falling back to first data channel"),this._mapParticipantToSourceId(this._sharerParticipant))}getLocalEndpointDataSourceId(){if(!this._call)return ml;let e=hE(this._call,this._participantId);if(e?.mediaStreams){let t=e.mediaStreams.find(({type:e})=>3===hb(e));return t?.sourceId??ml}return ml}terminateControl(e){if(this._isViewing()){if(4!==this.controlState)return Promise.reject(Error("terminateControl called while not in control"));else if(!this._sharerParticipant)return Promise.reject(Error("terminateControl called but _sharerParticipant is null"))}else if(!this._isSharing())return Promise.reject(Error("terminateControl called but not sharing nor viewing"));else if(!this._controllerParticipant)return Promise.reject(Error("terminateControl called but controllerParticipant is null"));return this._requestControlPromise?Promise.reject(Error("Request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(Error("Accept control promise has not been resolved yet while terminating control")):this._grantControlPromise?Promise.reject(Error("Grant control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(Error("Terminate control promise has not been resolved yet while terminating control")):this._terminateControl(!0,e)}_terminateControl(e,t){let i,n;this._logger.info("_terminateControl()"),this._terminateControlPromise=new iE;let r=()=>{this._terminateControlPromise=null};this._terminateControlPromise.promise.then(r,r);let s=0,a=e?8:7;if(this._isViewing())if(4!==this.controlState)return this._logger.error("Local viewer called terminateControl when not controlling"),this._terminateControlPromise.reject(Error()),Promise.reject(Error("Local viewer called terminateControl when not controlling"));else this._teardownViewerRemoteControl(),s=t??6,i=this._getSharerDataSourceId(),this._recordViewerSessionTelemetry(e=>e.controlTerminated(this._controlCauseId,s,i)),n=mo,this._logger.info(`Terminating remote control reason: ${mm(s)},  recipient: ${i}, controllerId: ${n}`);else{if(3!==this.controlState||!this._controllerParticipant)return this._logger.error("Local sharer called terminateControl when no one is in control"),this._terminateControlPromise.reject(Error()),Promise.reject(Error("Local sharer called terminateControl when no one is in control"));this._teardownSharerRemoteControl(),s=t??5,i=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),this._recordSharerSessionTelemetry(e=>e.controlTerminated(this._controlCauseId,s,this._controllerParticipant.participant,i)),n=ta(this._controllerParticipant.participant.id),this._logger.info(`Terminating control on the sharer side, reason: ${mm(s)}, recipient: ${i}, controllerId: ${n}`)}let o={action:a,terminatedReason:s};if(!this._sendRequest(o,i))if(e)return this._logger.error("Failed to send the terminate control request"),this._terminateControlPromise.reject(Error()),Promise.reject(Error("Failed to send the grant control request!"));else this._logger.error("Failed to send the terminateNoAck request");return(this.controlState=5*!!e,this._notifySharingControlChanged(!1,n,o.terminatedReason),e)?(this._terminateControlTimer=window.setTimeout(()=>{5===this.controlState?(this.controlState=0,this._resetControllerParticipant(),this._logger.error("No ack received when terminating control - resending terminate request"),this._sendRequest({action:7,terminatedReason:4},i)||this._logger.error("Failed to send the terminateNoAck request"),this._terminateControlPromise?this._terminateControlPromise.reject(Error("No ack received when terminating control - resending terminate request")):this._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck")):this._terminateControlPromise?this._terminateControlPromise.reject(Error("terminate control - times out in bad state - do nothing")):this._logger.error(`Unexpected, no promise could be resolved - controlState=${mf(this.controlState)}`),this._terminateControlTimer=null},mr),this._terminateControlPromise.promise):(this._terminateControlPromise.resolve(),new Promise((e,t)=>{e()}))}_cancelTerminateControlTimer(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null,this._logger.info("_cancelTerminateControlTimer()"))}_disposeControlCapturer(e=e9()){this._logger.info(`_disposeControlCapturer causeId: ${e}`),this._clearCapturerEventSubscriptions(),this._controlCapturer&&(this._controlCapturer.dispose(e),this._controlCapturer=null)}dispose(e){this._logger.info(`dispose causeId: ${e}`),this._dataChannelAdapter.dispose(e),this._resetControlState(),this._disposeRenderer(e),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._pendingNegotiationTag=null,this._pendingSharer=null,this._call=null,this._resetParticipantSubscriptions(),this._finalizeViewerSessionTelemetry(),this._finalizeSharerSessionTelemetry(),super.dispose(e)}};function mg(e){switch(e){case 1:return"Succeeded";case 2:return"Shutdown";case 3:return"DataChannel";case 4:return"Replaced";case 5:return"TimedOut";case 6:return"UnknownSender";case 7:return"SharerDenied";default:return"Unknown"}}function mp(e){switch(e){case 0:return"Available";case 1:return"ControlRequest";case 2:return"CancelControlRequest";case 3:return"AcceptRequest";case 4:return"RejectRequest";case 5:return"Ack";case 6:return"GiveControl";case 7:return"TerminateNoAck";case 8:return"Terminate";case 9:return"AvailableAck";case 10:return"AvailableNack";case 11:return"RenderedAtViewer";default:return"Unknown"}}function mf(e){switch(e){case 0:return"None";case 1:return"RequestSent";case 2:return"WaitingForControlAck";case 3:return"RemoteControlling";case 4:return"LocalControlling";case 5:return"WaitingForTerminateAck";default:return"Unknown"}}function mm(e){switch(e){case 0:return"None";case 1:return"SharerDenied";case 2:return"SharerNoResponse";case 3:return"SharerBusy";case 4:return"AckTimeout";case 5:return"SharerTerminated";case 6:return"ViewerTerminated";case 7:return"DataChannelError";case 8:return"ViewerCancelled";case 9:return"SharerControlDisabled";case 10:return"UnknownSender";case 11:return"MultipleSharers";default:return"Unknown"}}function mv(e){switch(e){case 1:return"Sharer";case 2:return"Viewer";default:return"Unknown"}}var mS=((u=mS||{})[u.LEFT=0]="LEFT",u[u.RIGHT=1]="RIGHT",u[u.MIDDLE=2]="MIDDLE",u[u.BACK=3]="BACK",u[u.FORWARD=4]="FORWARD",u),my=((h=my||{})[h.SCAN_CODE=0]="SCAN_CODE",h[h.VIRTUAL_KEY=1]="VIRTUAL_KEY",h[h.RECOGNITION_INPUT=2]="RECOGNITION_INPUT",h),mC=class{constructor(e){this.logger=e}toEdgeControlMouseEvent(e){let t;switch(e.type){case 0:return{event:this.toMouseMoveEvent(e),apiName:"injectMouseMoveEvent"};case 1:return{event:this.toMouseWheelEvent(e),apiName:"injectMouseWheelEvent"};case 2:return{event:this.toMouseButtonPressedEvent(e),apiName:"injectMouseButtonEvent"};default:throw t=`Uncovered mouse control event type. Event: ${e}`,this.logger.error(t),Error(t)}}toEdgeControlKeyboardEvent(e){return{event:{repeat:e.repeat,keyUp:e.keyUp,codeType:my[e.codeType],keyCode:e.code},apiName:"injectKeyEvent"}}toMouseMoveEvent(e){return{xPos:e.xPos,yPos:e.yPos}}toMouseWheelEvent(e){return{wheelButtonDown:e.wheelButtonDown,wheelRotation:e.wheelRotation}}toMouseButtonPressedEvent(e){return{xPos:e.xPos,yPos:e.yPos,button:mS[e.buttonType],buttonDown:e.buttonDown}}};async function mb(e,t,i){return new Promise((n,r)=>{let s=Buffer.from(e,"base64"),a=document.createElement("canvas").getContext("2d"),o=new Blob([s],{type:"image/png"}),l=new Image;l.onload=()=>{a.drawImage(l,0,0,l.width,l.height,0,0,t,i);let e=a.getImageData(0,0,t,i);window.URL.revokeObjectURL(l.src),l=null,n(Array.from(e.data))},l.onerror=e=>{r(e)},l.src=window.URL.createObjectURL(o)})}var mT="ncbjelpjchkpbikbpkcchkhkblodoama",mE=class{constructor(e){this.logger=e}async sendInjectInputEventMessage(e,t){return this.logger.info("EdgeControlInjectorApi - sendInjectInputEventMessage"),new Promise((i,n)=>{window.top.chrome.runtime.sendMessage(mT,{api:e,deviceId:this.virtualInputDeviceId,event:t},e=>{e.error?n(e.error.message):i(0)})})}async createInputDeviceId(e,t,i){this.virtualInputDeviceId&&this.logger.warn("EdgeControlInjectorApi - createInputDeviceId virtual input already exists.");try{this.virtualInputDeviceId=await this.sendCreateInputDeviceMessage(e,i)}catch(e){this.logger.error(`EdgeControlInjectorApi - createInputDevice failed, error: ${JSON.stringify(e)}`),t()}}async sendSetLocalUserAvatarMessage(e){let t=await this.generateAvatarBitmap(e);return new Promise((e,i)=>{let n=window.top;t&&n.chrome.runtime.sendMessage(mT,{api:"setLocalUserAvatar",avatarBitmap:t},t=>{t.error?i(t.error.message):e()})})}async sendCloseVirtualInputDeviceMessage(){let e=this.virtualInputDeviceId;return e?(this.logger.info("EdgeControlInjectorApi - sendCloseVirtualInputDeviceMessage called"),new Promise((t,i)=>{let n=window.top;n.chrome.runtime.sendMessage(mT,{api:"closeInputDevice",deviceId:e},e=>{e?e.error?i(e.error.message):(this.virtualInputDeviceId=null,t(e.deviceId)):i(n.chrome.runtime.lastError.message)})})):(this.logger.info("EdgeControlInjectorApi - VirtualInputDevice does not exists, nothing to close."),Promise.resolve())}async sendCreateInputDeviceMessage(e,t){this.logger.info("EdgeControlInjectorApi - sendCreateInputDeviceMessage called");let i=await this.generateAvatarBitmap(t);return new Promise((t,n)=>{let r=window.top,s=e=>{e?e.deviceId?t(e.deviceId):e.error?n(e.error.message):n("Error: Unexpected response from API"):n(r.chrome.runtime.lastError.message)};i?r.chrome.runtime.sendMessage(mT,{api:"createInputDevice",mediaStreamTrackId:e,avatarBitmap:i},s):r.chrome.runtime.sendMessage(mT,{api:"createInputDevice",mediaStreamTrackId:e},s)})}async generateAvatarBitmap(e){if(!e)return null;try{let t=32,i=await mb(e,t,t);return{width:t,height:t,data:i}}catch(e){return this.logger.error(`EdgeControlInjectorApi - generateAvatarBitmap error: ${JSON.stringify(e)}, continue without avatar.`),null}}};async function m_(e){return new Promise((t,i)=>{e.info("EdgeControlInjectorApi - sendIsVirtualInputSupportedMessage");let n=window.top;n.chrome.runtime.sendMessage(mT,{api:"isVirtualInputSupported"},e=>{e?e.error?t(e.error.message):t(e):i(n.chrome.runtime.lastError?.message)})})}var mI=class{constructor(e,t,i){this.logger=e,this.sharingTrackId=t,this.onInitErrorCallback=i,this.images=new Map,this.controlEventConverter=new mC(e),this.edgeApi=new mE(this.logger)}showVirtualCursor(e,t){if(this.logger.info(`EdgeControlInjector - showVirtualCursor, id: ${e} sharingTrackId: ${this.sharingTrackId}`),t){this.edgeApi.createInputDeviceId(this.sharingTrackId,this.onInitErrorCallback,this.images[e]);let t=this.images[0];t?this.edgeApi.sendSetLocalUserAvatarMessage(t):this.logger.error("EdgeControllerInjector - local avatar is missing, continue without local avatar")}else this.edgeApi.sendCloseVirtualInputDeviceMessage()}setAvatar(e,t){this.logger.info(`${e} EdgeControlInjector - setAvatar, id: ${e}, data: ${JSON.stringify(t)}`),this.images[e]=t,Promise.resolve(-2)}async injectMouseEvent(e,t){this.logger.info(`${e} EdgeControlInjector - injectMouseEvent ${JSON.stringify(t)}`);let i=this.controlEventConverter.toEdgeControlMouseEvent(t);return this.edgeApi.sendInjectInputEventMessage(i.apiName,i.event)}async injectKeyboardEvent(e,t){let i=this.controlEventConverter.toEdgeControlKeyboardEvent(t);return this.edgeApi.sendInjectInputEventMessage(i.apiName,i.event)}injectClipboardText(e,t){return this.logger.info(`${e} EdgeControlInjector - injectClipboardText is unimplemented`),Promise.resolve(0)}dispose(e){this.logger.info("EdgeControlInjector - dispose"),this.edgeApi.sendCloseVirtualInputDeviceMessage()}},mw="undefined"!=typeof navigator&&void 0!==navigator.mediaDevices?.getUserMedia,mP=((g=mP||{}).AVD="43",g.Citrix="44",g.VMware="45",g);function mR(e){let t=sd(e).match(RegExp("^SkypeSpaces/(\\d+)/"));t?.length&&Object.values(mP).includes(t[1])&&(b=t[1]),mD()}function mA(){return!!b}function mM(){return b}function mD(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(void 0!==navigator.webkitGetUserMedia&&"undefined"!=typeof webkitRTCPeerConnection&&mA()?(window.RTCPeerConnection=webkitRTCPeerConnection,navigator.getUserMedia=(e,t,i)=>{let n=e=>{e?.deviceId?.exact&&(e.mandatory||(e.mandatory={}),e.mandatory.sourceId=e.deviceId.exact,delete e.deviceId)};return e&&(n(e.audio),n(e.video)),navigator.webkitGetUserMedia(e,t,i)}):mw&&mO())}function mO(){navigator.getUserMedia=function(e,t,i){return navigator.mediaDevices.getUserMedia(e).then(t).catch(i)}}"undefined"!=typeof window&&"undefined"!=typeof navigator&&(C=window,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.MediaStream=window.MediaStream||window.webkitMediaStream||window.mozMediaStream||window.msMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext);var mk=C,mN=class{constructor(e){this.logger=e,this.activeSourceId=0,this.pendingPointerImages=new Map}static create(e,t){return e.config.enableGiveControl?mA()||window.ControlInjector?new mL(t):is.isBrowser("Edge")?new mx(t):new mF(t):new mF(t)}async dispose(e){}async enableInjector(e){this.injector&&this.logger.warn("Control injector already present when enabling injector");try{this.injector=this.createInjector(e)}catch(e){throw this.logger.error(`Control injector creation failed: ${e}`),e}this.pendingPointerImages.forEach((e,t)=>{this.injector.setAvatar(t,e)}),this.pendingPointerImages.clear()}async disableInjector(){this.injector||this.logger.warn("Control injector not present when disabling injector"),this.logger.info("ControlInjector disposed"),this.injector.dispose(),this.injector=null}async setPointerImage(e,t){this.injector?this.injector.setAvatar(e,t):this.pendingPointerImages.set(e,t)}async showVirtualCursor(e){if(this.logger.info(`showVirtualCursor ${e} ${this.activeSourceId}`),!this.injector)throw Error("Control injector not present");e?(this.activeSourceId&&this.injector.showVirtualCursor(this.activeSourceId,!1),this.injector.showVirtualCursor(e,!0),this.activeSourceId=e):this.activeSourceId&&(this.injector.showVirtualCursor(this.activeSourceId,!1),this.activeSourceId=0)}async injectRawInput(e,t){if(!this.injector)throw Error("Control injector not present");let i=this.injector;return new Promise((n,r)=>{let s,a,o=y.decodeEventType(e);switch(o){case 1:s=y.decodeMouseEvent(e),i.injectMouseEvent(t,s).then(e=>0===e?n():r());break;case 0:a=y.decodeKeyboardEvent(e),i.injectKeyboardEvent(t,a).then(e=>0===e?n():r());break;default:this.logger.error(`Invalid event type in raw input: ${o}`),r()}})}async injectSlideMove(e,t){throw Error("injectMoveSlide not supported in pluginless mode")}async createControlInjector(){throw Error("Not supported in pluginless mode. create injector through createInjector method")}},mx=class extends mN{constructor(e){super(e.createChild("EdgeControlInjector")),this.edgeVirtualInputSupported=!1,m_(e).then(t=>{this.edgeVirtualInputSupported=t,e.info(`Edge supports virtual input device: ${JSON.stringify(this.edgeVirtualInputSupported)}`)}).catch(t=>{e.info(`Edge IsVirtualInputSupported: ${JSON.stringify(t)}`)})}canBeEnabled(){return this.edgeVirtualInputSupported}createInjector(e){if(!this.edgeVirtualInputSupported)return void this.logger.info("Edge doesn't support give control");let t=new mI(this.logger,e,()=>{this.logger.error("An error occured, disabling control injector."),this.disableInjector()});return this.logger.info("Edge ControlInjector created"),t}},mL=class extends mN{constructor(e){super(e.createChild("WindowControlInjector"))}canBeEnabled(){return!!window.ControlInjector}createInjector(e){let t=window.ControlInjector(e);return this.logger.info("Window ControlInjector created"),t}},mF=class extends mN{constructor(e){super(e.createChild("NoopControlInjector"))}canBeEnabled(){return!1}createInjector(){throw Error("Control injector creation is disabled")}},mU=class{constructor(e){this.logger=e,this.logger.info("RendererAdapter")}getTarget(e){return e.target}subscribeVideoSizeChangedEvent(e,t){let i=e;return i.streamSize&&t(i.streamSize.width,i.streamSize.height),i.renderer.on("onVideoSizeChanged",t)}subscribeRenderStartedEvent(e,t){return e.renderer.on("onVideoStarted",(e,i)=>t())}};function m$(e){return String.fromCharCode.apply(null,e)}var mV=class extends tZ{constructor(e,t){super(e),this.logger=e,this._call=t}isActive(){return!!this.protocolSendFunc&&!!this.controlSendFunc}sendProtocolMessage(e,t){return this.protocolSendFunc?this.protocolSendFunc(e,t):(this.logger.error("Cannot send protocol message, ProtocolHandler hasn't started"),Promise.resolve())}sendControlMessage(e,t){return this.controlSendFunc?this.controlSendFunc(e,t):(this.logger.error("Cannot send control message, ControlHandler hasn't started"),Promise.resolve())}getProtocolHandler(){return{onStarted:async(e,t)=>{this.logger.info(`ProtocolHandler started for ${e}`),this.protocolSendFunc=t,this.isActive()&&this.event("stateChange").raise(!0)},onStopped:async e=>{this.logger.info(`ProtocolHandler stopped for ${e}`);let t=this.isActive();this.protocolSendFunc=null,t&&this.event("stateChange").raise(!1)},onDataReceived:async(e,t,i)=>{if(1===e){let e,n=JSON.parse(m$(t)),r=this._call.mapDataChannelSourceIdToParticipant(i);return r&&(e=hR(r,3,i)),this.event("protocolMessage").raise(n.message,r,e,i)}}}}getControlHandler(){return{onStarted:async(e,t)=>{this.logger.info(`ControlHandler started for ${e}`),this.controlSendFunc=t,this.isActive()&&this.event("stateChange").raise(!0)},onStopped:async e=>{this.logger.info(`ControlHandler stopped for ${e}`);let t=this.isActive();this.controlSendFunc=null,t&&this.event("stateChange").raise(!1)},onDataReceived:async(e,t,i)=>{if(2===e)return this.event("controlMessage").raise(t,i)}}}},mB=class extends mh{constructor(e,t,i,n,r,s){let a={disableAudit:r.getEcsConfig("SkypeCalling","gtcAuditDisabled")??!1},o=r.getEcsConfig("SkypeCalling","gtcHandshakeSendDelay");if(o)try{a.handshakeSendDelay=JSON.parse(o)}catch(t){e.error(`Failed to parse ecs config gtcAvailableAckDelay: ${t$(t)}`)}super(e.createChild("ScreenSharingControl"),i,n,a),this.dataChannel=t;let l=mN.create(s,e),c=new mU(this._logger),d=new mV(this._logger,i);this.setAdapters(l,c,d)}setupDataHandlers(){if(this.controlDataHandler&&this.protocolDataHandler)return void this._logger.info("Data handlers already setup, skipping setup");this.controlDataHandler=this.getControlHandler(),this.protocolDataHandler=this.getProtocolHandler(),this.dataChannel.addHandler(2,this.controlDataHandler).catch(e=>{this._logger.error(`Failed to add control data handler: ${t$(e)}`)}),this.dataChannel.addHandler(1,this.protocolDataHandler).catch(e=>{this._logger.error(`Failed to add protocol data handler: ${t$(e)}`)})}startOrStopControlForViewer(e,t,i){if(e&&i?.appliedInteractivityLevel!=="nonInteractive"){if(t&&0===this.role){let e=t.streams[1].find(e=>e.isAvailable)?.negotiationTag;this.initControlForViewer(t,e)}}else 2===this.role&&this.shutdownControlForViewer()}getProtocolHandler(){return this._dataChannelAdapter.getProtocolHandler()}getControlHandler(){return this._dataChannelAdapter.getControlHandler()}};function mH(e){let t=[];for(let i in e)if(e[i].participantLegIdMap)for(let n in e[i].participantLegIdMap){let r=e[i].participantLegIdMap[n].endpointId;t.push({id:i,mri:i,participantId:n,...r&&{endpointId:r}})}else t.push({id:i,mri:i});return t}function mj(e){switch(e){case 1:return"specified";case 0:return"all";case 3:return"attendees";case 2:return"presenters";case 4:return"self";default:return"none"}}var mq={};ew(mq,{addReceiveDirectionality:()=>mX,allowDataChannel:()=>vc,areNegotiatedDirectionsAcceptable:()=>m3,areNegotiatedDirectionsFulfilled:()=>m4,areSendDirectionsFulfilled:()=>m5,convertToCodecInfo:()=>vu,getAllowedCodecs:()=>vd,getSrtpInfo:()=>m6,hasReceiveDirectionality:()=>mZ,hasSendDirectionality:()=>mY,invertModalities:()=>mK,ipAddressConverter:()=>vg,ipV4RegExp:()=>mW,ipV6RegExp:()=>mG,ipv4AddressConverter:()=>vf,ipv6AddressConverter:()=>vp,isOnHold:()=>m0,mediaTypeToModality:()=>vi,modalityToMediaType:()=>vt,negotiateDirectionality:()=>mJ,negotiateModalities:()=>m1,parseCandidateString:()=>ve,printMediaStream:()=>vh,removeChangedSendDirection:()=>m8,removeSendDirectionality:()=>mQ,scrubConstraints:()=>vl,scrubDevices:()=>vo,scrubObjectExcludingFields:()=>vs,scrubObjectFields:()=>vr,scrubSelectedDevices:()=>va,sendStreamsToModalities:()=>vn,shouldDisableAudioSendersTroughSetParams:()=>vv,shouldDisableVideoSendersTroughSetParams:()=>vm});var mW=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:[0-9]{1,5})?$/),mG=RegExp(/^\[?(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|:((:[0-9a-fA-F]{1,4}){1,5}|:)((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,5}([0-9a-fA-F]{1,4})?:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\]?(?::\d{1,5})?$/);function mz(e){switch(e){case nu.MEDIA_STATE.send:return nu.MEDIA_STATE.receive;case nu.MEDIA_STATE.receive:return nu.MEDIA_STATE.send;default:return e}}function mJ(e,t){let i=mY(e)&&mY(t),n=mZ(e)&&mZ(t);return i&&n?nu.MEDIA_STATE.sendReceive:i?nu.MEDIA_STATE.send:n?nu.MEDIA_STATE.receive:e===nu.MEDIA_STATE.inactive&&t||e&&t===nu.MEDIA_STATE.inactive?nu.MEDIA_STATE.inactive:void 0}function mK(e){let t={},i=mz(e.audio);i&&(t.audio=i);let n=mz(e.video);n&&(t.video=n);let r=mz(e.sharing);r&&(t.sharing=r);let s=mz(e.data);return s&&(t.data=s),t}function mQ(e){return e===nu.MEDIA_STATE.sendReceive?nu.MEDIA_STATE.receive:void 0}function mY(e){return e===nu.MEDIA_STATE.send||e===nu.MEDIA_STATE.sendReceive}function mZ(e){return e===nu.MEDIA_STATE.receive||e===nu.MEDIA_STATE.sendReceive}function mX(e){return mZ(e)?e:e===nu.MEDIA_STATE.send?nu.MEDIA_STATE.sendReceive:nu.MEDIA_STATE.receive}function m0(e){return e.audio===nu.MEDIA_STATE.inactive&&(!e.video||e.video===nu.MEDIA_STATE.inactive)&&(!e.sharing||e.sharing===nu.MEDIA_STATE.inactive)}function m1(e,t){let i={},n=mJ(e.audio,t.audio);n&&(i.audio=n);let r=mJ(e.video,t.video);r&&(i.video=r);let s=mJ(e.sharing,t.sharing);s&&(i.sharing=s);let a=mJ(e.data,t.data);return a&&(i.data=a),i}function m2(e,t,i,n){let r=mY(t)&&mY(i)||!mY(t)&&!mY(n),s=!n||mZ(t)&&mZ(i)||!mZ(t)&&!mZ(n);return e.config.fixExtraNegotiation&&(s=s||mZ(t)&&!mZ(i)&&!mZ(n)),r&&s}function m3(e,t,i,n){return m2(e,t.audio,i.audio,n.audio)&&m2(e,t.video,i.video,n.video)&&m2(e,t.sharing,i.sharing,n.sharing)&&m2(e,t.data,i.data,n.data)}function m4(e,t){function i(e,t){let i=mY(e)===mY(t),n=mZ(e)===mZ(t)||mZ(e)&&!t;return i&&n}return i(e.audio,t.audio)&&i(e.video,t.video)&&i(e.sharing,t.sharing)&&i(e.data,t.data)}function m5(e,t){let i=(e,t)=>mY(e)===mY(t);return i(e.audio,t.audio)&&i(e.video,t.video)&&i(e.sharing,t.sharing)&&i(e.data,t.data)}function m6(e){let t={dtls:!1,sdes:!1};return t.dtls=!!e.fingerprint,e.media.forEach(e=>{t.dtls=t.dtls||!!e.fingerprint,t.sdes=t.sdes||!!e.crypto}),t}function m8(e,t){if(!t||nE(t))return e;let i={};return nh(e,(e,n)=>{n===nu.MODALITY.data?i[n]=m7(e,t[n]):i[n]=m9(e,t[n])}),i}function m9(e,t){return mY(e)&&!mY(t)?mQ(e)||t:e}function m7(e,t){return mY(e)&&!mY(t)?t:e}function ve(e){let t=(e||"").split(" ");return{component:t[1],protocol:t[2],priority:t[3],ip:t[4],port:t[5],type:t[7]}}function vt(e){switch(e){case"audio":return"Audio";case"video":return"Video";case"sharing":return"ScreenShare";default:return null}}function vi(e){switch(e){case"Audio":return"audio";case"Video":return"video";case"ScreenShare":return"sharing";default:return null}}function vn(e){let t={};return n_(e).forEach(i=>t[i]=!!e[i]),t}function vr(e,t,i){if(!e)return e;let n={...e};for(let[r,s]of Object.entries(e))"object"==typeof s?n[r]=vr(s,t):s&&t.includes(r)&&(n[r]=i?i(s):ta(s));return n}function vs(e,t,i){if(!e)return e;let n={...e};for(let[r,s]of Object.entries(e))"object"==typeof s?n[r]=vs(s,t):s&&!t.includes(r)&&(n[r]=i?i(s):ta(s));return n}function va(e){return e?vs(e,[]):e}function vo(e,t){if(!e)return e;let i=vr(e,["deviceId","groupId","guid"]);return vr(i,["label"],e=>nH(e,t))}function vl(e){return vr(e,["sourceId","deviceId"])}function vc(e){return e.config.isPstnCall?e.configProvider.config.enableDataChannelPstn:e.configProvider.config.enableDataChannel}function vd(e,t){switch(t){case nu.MEDIA_TYPE.audio:return e.config.allowedAudioCodecs;case nu.MEDIA_TYPE.video:return e.config.allowedVideoCodecs;default:return[]}}function vu(e){return e.map(e=>{let t={codec:e.mimeType.split("/").pop(),rate:e.clockRate};return e.channels&&(t.encoding=e.channels),e.sdpFmtpLine&&(t.fmtpLine=e.sdpFmtpLine),t})}function vh(e){return`${e?.id}:${JSON.stringify(e?.getTracks().map(e=>e.id))}}`}function vg(e){try{if(mW.test(e))return vf(e);if(mG.test(e))return vp(e)}catch(e){}return e}function vp(e){let t,i=e.lastIndexOf("]")+1,n="",r="";i>0?(t=e.substring(0,i),r=e.substring(i)):i=(t=e).length;let s=t.lastIndexOf(":");if(t.includes(".")){let e=vf(t.substring(s+1,i-1-s));n=t.substring(0,s+1)+e}else s<t.length-1||":"===t[s-1]&&t.match(/:/g).length<7?n=t.substring(0,s+1)+"x":7===t.match(/:/g).length&&(n=t.substring(0,s)+"0:x");return n?r?n+"]"+r:("["===e.substring(0,1)&&(n=n.substring(1)),n):e}function vf(e){let t=e.substring(0,e.lastIndexOf(".")+1)+"x",i=e.lastIndexOf(":");return i>0?t+e.substring(i):t}function vm(e,t,i){return(!!t||!!i)&&(i?e.config.disableSendersTroughSetParametersVideo&&(i===nu.MODALITY.sharing||i===nu.MODALITY.video):e.config.disableSendersTroughSetParametersVideo&&("Video"===t.mediaType||"ScreenShare"===t.mediaType))}function vv(e,t){return e.config.disableSendersTroughSetParametersAudio&&"Audio"===t.mediaType}function vS(e){let t=[];return e.forEach(e=>{try{let i=t.find(t=>t.participantId===e.participantId&&t.endpointId===e.endpointId);i||(i={participantId:e.participantId,endpointId:e.endpointId},t.push(i)),("audio"===e.type||"audioteleconference"===e.type)&&(i.serverMuted=e.serverMuted),i[e.type]=e.direction}catch(e){t=[]}}),t}var vy=i(892891),vC=i(892891),vb={maxOutgoingResolution:({settings:e})=>vI(e),maxParticipantResolutions:({settings:e})=>v_(e),maxIncomingStreams:({settings:e})=>vP(e),maxSimulcastLayers:({settings:e})=>vR(e),outgoingVideoLimit:({settings:e,constraints:t})=>vw(e,t)},vT=(e,t,i)=>(e.info(`Converting settings to constraints and mapping, [requestedConstraints=${JSON.stringify(i)}], [settings=${JSON.stringify(t)}]`),vE((0,vC.cloneDeep)(i),(0,vC.cloneDeep)(t))),vE=(e,t)=>Object.keys(e).reduce((i,n)=>{let r=vb[n]?vb[n]({constraints:e,settings:t}):void 0;return r&&(i[n]=r),i},{}),v_=e=>e.multiviewResolutionLimits,vI=e=>e.outgoingVideoLimit?.maxResolution,vw=(e,t)=>{let i=t?.outgoingVideoLimit;if(!i)return;let{outgoingVideoLimit:n={}}=nw(e);if("number"==typeof i)return n?.maxResolution;let r=Object.keys(i).reduce((e,t)=>{let i=n?.[t];return i&&(e[t]=i),e},{});return Object.keys(r).length?r:void 0},vP=e=>e.numVideoChannelsGvc,vR=e=>{let t=e.specCompliantSimulcast,i=t.video?.layerScaleFactors,n=t.sharing?.layerScaleFactors;return Math.min(i?.length?Math.max(...i):1,n?.length?Math.max(...i):1)},vA=i(892891),vM=e=>{let t=["maxResolution","maxBitrate","maxFramerate"],i=e=>t.includes(e),n=Object.entries(e);return 0!==n.length&&n.every(([e,t])=>(0,vA.isNumber)(t)&&i(e))},vD=e=>!!(0,vA.isNumber)(e)||!!vM(e)&&!nE(e),vO={maxIncomingStreams:vA.isNumber,maxSimulcastLayers:vA.isNumber,maxOutgoingResolution:vA.isNumber,maxParticipantResolutions:e=>!!np(e)&&(!!(0,vA.isNumber)(e)||"more"in e&&Object.values(e).every(e=>(0,vA.isNumber)(e))),outgoingVideoLimit:e=>!!np(e)&&vD(e)},vk=e=>(e=JSON.parse(JSON.stringify(e)),Object.entries(vO).reduce((t,[i,n])=>(n(e[i])&&(t[i]=e[i]),t),{})),vN=class extends rr{constructor(e){super(),this.config=e,this.updateVideoSendLadder(1)}updateVideoSendLadder(e){switch(this._currentVideoLadderType=e,e){case 2:this.resolutions=ri(this.config.sendVideoLadderOverride360pHW);break;case 3:this.resolutions=ri(this.config.sendVideoLadderOverride270pHW);break;default:this.resolutions=ri(this.config.sendVideoLadderOverrideDefault)}}getCurrentVideoLadderType(){return this._currentVideoLadderType}getResolutionRecord(e,t){for(let i=this.resolutions.length-1;i>=0;i--)if(e&&this.resolutions[i].height<=e||t&&this.resolutions[i].fs<=t)return this.resolutions[i];return this.resolutions[0]}getNextLowerResolution(e,t){let i=Math.min(e,t),n=this.getResolutionRecord(i),r=this.resolutions.indexOf(n);return i===Math.min(n.width,n.height)?this.resolutions[r-1]:this.resolutions[r]}getNextHigherResolution(e,t){let i=Math.min(e,t),n=this.getResolutionRecord(i),r=this.resolutions.indexOf(n);return n.width,n.height,this.resolutions[r+1]}};function vx(e,t){if(Array.isArray(e))return t.slice()}function vL(e){return"string"==typeof e&&e.startsWith("64")}var vF=(e,t)=>{for(let i in t){let n=e[i],r=t[i];"object"==typeof r?e[i]=vF({...n},r):e[i]=nf(n,r)}return e},vU=class{constructor(e,t,i,n,r,s,a){this.logger=e,this.defaultSettings=t,this._mediaConfig=i,this._userAgentConfig=n,this._countryCode=r,this.platformCallConstraintsProvider=s,this.currentCallConstraints=a,this.mergedConstraints={},this.callConstraintsTelemetry=[],this.iceTransportPolicy=nu.ICE_TRANSPORT_POLICY.all,this.validIceTransportPolicies=[nu.ICE_TRANSPORT_POLICY.all,nu.ICE_TRANSPORT_POLICY.relay],this.mergeConstraintsTelemetryWithGlobal(),this.mergedConstraints=this.mergeConstraintsWithGlobal(this.currentCallConstraints),this.settings=this.mergeSettings((0,vy.cloneDeep)(this.defaultSettings)),this.settings.updateLadderTypeFromVdclc?this.videoLadder=new vN(this.settings):this.videoLadder=ra.Send}get config(){return this.settings}get mediaConfig(){return this._mediaConfig}get userAgentConfig(){return this._userAgentConfig}get countryCode(){return this._countryCode}addCallConstraintsTelemetryEvent(e,t){let i={timestamp:new Date().getTime(),type:t,value:e};nq(this.callConstraintsTelemetry,i,this.config.numCallConstraintsEvents)}getCallConstraintsTelemetry(){return this.callConstraintsTelemetry}getCallConstraints(){return this.mergedConstraints}setCallConstraints(e={}){this.addCallConstraintsTelemetryEvent(e,"requested"),this.logger.safe.debug("Saving new call constraints",JSON.stringify(e));let t=this.transformConstraints(vk(e));return this.logger.safe.debug("Validated call constraints",JSON.stringify(t)),this.mergedConstraints=this.mergeConstraintsWithGlobal(t),this.settings=this.mergeSettings((0,vy.cloneDeep)(this.defaultSettings)),vT(this.logger,this.settings,t)}getIceTransportPolicy(){return this.settings.iceTransportPolicyForced||this.iceTransportPolicy}setIceTransportPolicy(e){if(!this.validIceTransportPolicies.includes(e))return void this.logger.debug(`Unknown incoming transport policy, using ${this.iceTransportPolicy}`);this.logger.info(`Setting transport policy to ${this.iceTransportPolicy}`),this.iceTransportPolicy=e}overrideMaxSessionBandwidth(e){return this.defaultSettings.maxBandwidthInKbps!==e&&(this.defaultSettings.maxBandwidthInKbps=e,this.settings.maxBandwidthInKbps=e,this.mediaConfig.maxBandwidthInKbps=e,!0)}getVideoSendLadder(){return this.videoLadder}transformConstraints(e){let t=(0,vy.cloneDeep)(e);return"maxOutgoingResolution"in t&&(t.outgoingVideoLimit={maxResolution:t.maxOutgoingResolution},delete t.maxOutgoingResolution),"number"==typeof t.outgoingVideoLimit&&(t.outgoingVideoLimit={maxResolution:t.outgoingVideoLimit}),t}mergeConstraintsTelemetryWithGlobal(){this.platformCallConstraintsProvider.callConstraintsTelemetry.forEach(e=>nq(this.callConstraintsTelemetry,e,this.defaultSettings.numCallConstraintsEvents))}mergeConstraintsWithGlobal(e={}){let t=this.transformConstraints(this.platformCallConstraintsProvider.constraints);if(!Object.keys(t).length)return e;let i=(0,vy.cloneDeep)(e);return vF(i,t),this.logger.safe.debug(`Merging call constraints ${JSON.stringify(e)} and global constraints ${JSON.stringify(t)}. Result: ${JSON.stringify(i)}`),i}mergeSettings(e){if(!e.enablePlatformCallConstraints||!e.enablePlatformCallConstraintsPerCall)return e;let t=rd(this.logger,e,this.mergedConstraints);return this.logger.safe.info(`Merging settings with platform call constraints: ${t$(t)}`),(0,vy.assign)({},e,t,vx)}},v$=class e extends no{constructor(e){super(),this.configProvider=e,this.isAudioOutputSelectionSupportedValue=!1,e.on("configUpdated",()=>this.updateConfig(!0)),this.updateConfig(!1)}get isAudioOutputSelectionSupported(){return this.isAudioOutputSelectionSupportedValue}get isBrowserRollbackSupported(){return this.isRollbackSupportedValue}static hasApplyConstraints(){return void 0!==MediaStreamTrack.prototype.applyConstraints}static hasPermissionsApi(){return void 0!==navigator.permissions}static get hardwareConcurrency(){return window.navigator.hardwareConcurrency}static get unmaskedGlRenderer(){if(this.renderer)return this.renderer===nu.MEDIA_ERROR.webGlRendererError?void 0:this.renderer;try{let e=document.createElement("canvas").getContext("webgl"),t=e?.getExtension("WEBGL_debug_renderer_info"),i=t&&e.getParameter(t.UNMASKED_RENDERER_WEBGL);return this.renderer=i,i}catch{this.renderer=nu.MEDIA_ERROR.webGlRendererError;return}}async isRollbackSupported(){let e;if(!this.isRollbackSupportChecked&&!0!==this.configProvider.config.skipRollbackSupportCheck){this.isRollbackSupportChecked=!0;try{if(e=mk.RTCPeerConnection&&new mk.RTCPeerConnection({sdpSemantics:"unified-plan"})){let t=await e.createOffer();await e.setLocalDescription(t),await e.setLocalDescription({type:"rollback"}),this.isRollbackSupportedValue=!0}}catch(e){this.isRollbackSupportedValue=!1}finally{e?.close()}}}static async isCodecsSupported(e){let t={format:"annexb"},i=1280,n=720,r=["no-preference","prefer-software","prefer-hardware"],s=[];for(let a of e)for(let e of r){let r=await window.VideoEncoder?.isConfigSupported({codec:a,hardwareAcceleration:e,hevc:t,width:i,height:n}),o=await window.VideoDecoder?.isConfigSupported({codec:a,hardwareAcceleration:e,hevc:t});if(r||o){let e={name:a,mode:r?.config.hardwareAcceleration,encode:r?.supported,decode:o?.supported};s.push(e)}}return s}static async hasH264CodecSupport(e){let t=`v=0
o=- 596983 0 IN IP4 127.0.0.1
s=session
c=IN IP4 0.0.0.0
t=0 0
a=msid-semantic: WMS *
m=video 3480 RTP/SAVPF 107 99
a=rtpmap:107 H264/90000
a=rtpmap:99 rtx/90000
a=fmtp:107 max-fs=240;max-mbps=3600;max-br=208;max-fps=1500;profile-level-id=42C02A;packetization-mode=1
a=fmtp:99 apt=107
a=setup:actpass
a=mid:video
a=recvonly
a=rtcp-mux
a=ice-ufrag:CvYq
a=ice-pwd:axsjsa0GOz3kz6TuGvNgJZWO
a=fingerprint:sha-256 34:DF:5C:15:60:FF:28:3E:E8:96:4B:F8:85:61:E4:C0:57:D1:60:82:21:FD:BC:D2:90:41:06:FA:03:FD:12:A2
`,i=mk.RTCPeerConnection&&new mk.RTCPeerConnection;if(!i)return!1;try{return await i.setRemoteDescription({sdp:t,type:"offer"}),!0}catch(t){return e.error("H264 not supported",t),!1}finally{try{i.close()}catch(e){}}}static hasMediaApi(){return navigator.getUserMedia&&"undefined"!=typeof RTCPeerConnection}static hasCapabilitiesApi(){return!!mk.RTCRtpReceiver?.getCapabilities}static isAudioOutputSelectionSupportedByBrowser(){return!!mk?.HTMLAudioElement?.prototype.setSinkId}updateConfig(t){let i=e.isAudioOutputSelectionSupportedByBrowser();i!==this.isAudioOutputSelectionSupportedValue&&(this.isAudioOutputSelectionSupportedValue=i,this.event("isAudioOutputSelectionSupportedChanged").raise()),t&&this.isRollbackSupported()}static hasEncodedStreamsApi(){return!!RTCRtpReceiver.prototype.createEncodedStreams||e.hasScriptTransformApi()}static hasScriptTransformApi(){return!!window.RTCRtpScriptTransform}static isWakeLockSupported(){return!!window.navigator.wakeLock}},vV=class extends no{constructor(e,t,i){super(),this.configProvider=e,this.workerProvider=t,this.logger=i,this.transformsCollections=new Map,this.configProvider.config.useInsertableStreams&&this.workerProvider&&v$.hasEncodedStreamsApi()&&(this.worker=new Sd(this.workerProvider,this.logger))}get timerWorkletURL(){return this.workerProvider?.getTimerWorkletUrl()}get decoderWorkletURL(){return this.workerProvider?.getDecoderWorkletUrl()}get rendererWorkletURL(){return this.workerProvider?.getRendererWorkletUrl()}async initialize(){return this.worker?this.worker.initialize():Promise.resolve()}initTransformsCollection(e,t,i){let n=v$.hasScriptTransformApi()||this.workerProvider;if(!(this.configProvider.config.useInsertableStreams&&v$.hasEncodedStreamsApi()&&(!n||this.isWorkerLoaded())&&null!==e.track))return null;if(!this.transformsCollections.has(e)){let n=this.worker?new vH(this.worker,e):new vB(e);this.transformsCollections.set(e,{collection:n,mediaType:i,objType:t})}let r=this.transformsCollections.get(e);return this.event("onTransformsCollectionCreated").raise(r),r.collection}clearTransformsCollection(e){let t=this.transformsCollections.get(e);t&&(this.event("onTransformsCollectionCleared").raise(t),t.collection.clearTransforms())}dispose(){for(let e of this.transformsCollections.values())this.event("onTransformsCollectionCleared").raise(e),e.collection.clearTransforms();this.transformsCollections.clear(),this.worker?.dispose(),super.dispose()}isWorkerLoaded(){return!!this.worker?.isWorkerLoaded()}},vB=class{constructor(e){let{readable:t,writable:i}=e.createEncodedStreams();this.streamTransformer=new Sy(t,i)}addTransform(e){e.createBaseInstance(this.streamTransformer)}clearTransforms(){this.streamTransformer.clearTransforms()}},vH=class{constructor(e,t){if(this.workerHandler=e,this.clientId=t.track.id,v$.hasScriptTransformApi()){t.transform=new RTCRtpScriptTransform(this.workerHandler.worker,{clientId:this.clientId});return}let{readable:i,writable:n}=t.createEncodedStreams(),r=[i,n];this.workerHandler.sendTransformCommand(this.clientId,{operation:"init",readable:i,writable:n},r)}addTransform(e){e.createWorkerInstance(this.workerHandler,this.clientId)}clearTransforms(){this.workerHandler.sendTransformCommand(this.clientId,{operation:"clear"})}},vj=class{constructor(e,t,i=!1){this.audioContext=e,this.logger=t,this.disabled=i}isSingleInputStream(){return this.mixerImp?.mixerType===0}stopMixing(){this.disabled=!0,this.mixerImp?.reset()}startMixing(e){this.disabled=!1,this.mixerImp?.setupMixer(this.audioContext.audioContext,this.audioContext.destination,e)}setMixerType(e,t){this.mixerImp?.mixerType!==e&&(this.mixerImp?.reset(),this.mixerImp=this.createMixer(e),this.disabled||this.mixerImp.setupMixer(this.audioContext.audioContext,this.audioContext.destination,t))}setStreamSources(e){this.disabled||this.mixerImp.setStreamSources?.(e)}setParticipantSpatialAudioPositions(e){this.mixerImp.setParticipantSpatialAudioPositions?.(e)}createMixer(e){switch(e){case 0:return new vW;case 1:return new vG(this.logger.createChild("MixingStreamsMixer"));case -1:return new vq;default:throw Error(`unknown mixer type: ${e}`)}}},vq=class{constructor(){this.mixerType=-1}reset(){}setupMixer(e,t,i){}},vW=class{constructor(){this.mixerType=0}reset(){this.sourceNode.disconnect()}setupMixer(e,t,i){this.sourceNode=e.createMediaStreamSource(i[0]),this.sourceNode.connect(t)}},vG=class{constructor(e){this.logger=e,this.sourcePositions=new Map,this.sourceNodes=[],this.pannerNodes=[],this.mixerType=1}reset(){for(let e of(this.logger.safe.info("resetting SpatialMultiStreamMixer"),this.sourceNodes))e.disconnect();for(let e of(this.sourceNodes=[],this.pannerNodes))e.disconnect();this.pannerNodes=[]}setupMixer(e,t,i){for(let n of((this.sourceNodes.length||this.pannerNodes.length)&&this.reset(),i)){let i=e.createMediaStreamSource(n),r=new PannerNode(e,{panningModel:"HRTF"});i.connect(r),r.connect(t),this.sourceNodes.push(i),this.pannerNodes.push(r)}this.logger.safe.info(`setupMixer is done for ${i.length} streams.`)}setStreamSources(e){for(let t=0;t<e.length;t++)this.setStreamPosition(t,e[t])}setParticipantSpatialAudioPositions(e){this.sourcePositions=new Map(e.map(e=>[e.sourceId,e]))}setStreamPosition(e,t){let i=this.sourcePositions.get(t)??{sourceId:t,x:0,y:0},n=this.pannerNodes[e];if(!n)return void this.logger.warn(`panner node for stream ${e} is not found`);n.positionX.value=i.x,n.positionY.value=i.y}},vz=class{constructor(e){this.audioContext=new AudioContext({sampleRate:e}),this.destination=this.audioContext.createMediaStreamDestination()}dispose(){this.audioContext.close()}},vJ=class extends no{constructor(e){super(),this.logger=e,this.mediaStreams=[],this.cnStream=null,this.isConfigured=!1,this.isNegotiated=!1,this.activeCodec="None"}get streams(){return this.mediaStreams}get comfortNoiseStream(){return this.cnStream}get configured(){return this.isConfigured}get active(){return this.isNegotiated}get codec(){return this.activeCodec}setupStreams(e,t){this.logger.safe.debug(`setup ${e} streams with extra Comfort Noise stream: ${t}`),this.mediaStreams=[];let i=[];for(;e--;){let e=new MediaStreamTrackGenerator({kind:"audio"});i.push(e),this.streams.push(new MediaStream([e]))}let n=t?new MediaStreamTrackGenerator({kind:"audio"}):null;return this.cnStream=n?new MediaStream([n]):null,this.event("onStreamsChanged").raise(),{streams:i.map(e=>e.writable),cnStream:n?.writable}}setStreamSources(e){this.isNegotiated&&this.event("onStreamSourcesUpdated").raise(e)}setConfiguredState(e){this.isConfigured!==e&&(this.isConfigured=e,this.event("onConfiguredStateChanged").raise(this.isConfigured))}setNegotiatedState(e){this.isNegotiated!==e&&(this.isNegotiated=e,this.event("onActiveStateChanged").raise(this.isNegotiated))}setDetectedCodec(e){this.activeCodec!==e&&(this.activeCodec=e,this.event("onActiveCodecChanged").raise(this.activeCodec))}},vK="encodedStreamsTimer",vQ=class e{constructor(){this.context=new AudioContext({sampleRate:5e4})}dispose(){this.context.close()}createTimerPort(){return new AudioWorkletNode(this.context,vK,{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[1]}).port}static async create(t,i){let n=new e;try{return i.safe.info(`Creating TimerWorkletNode from url: ${t}`),await n.context.audioWorklet.addModule(t),n}catch(e){i.safe.error(`Failed to create TimerWorkletNode from url: ${t} - error: ${e}`);return}}},vY="encodedStreamsRenderer",vZ=class e{constructor(e,t){this.context=e,this.destNode=t}dispose(){this.context=null}createRendererPort(e){let t=new AudioWorkletNode(this.context,vY,{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[e]});return t.connect(this.destNode),t.port}static async create(t,i,n,r){let s=new e(t,i);try{return r.safe.info(`Creating RendererWorkletNode from url: ${n}`),await s.context.audioWorklet.addModule(n),s}catch(e){r.safe.error(`Failed to create RendererWorkletNode from url: ${n} - error: ${e}`);return}}},vX=0,v0={MUCHv2:{CODEC:{NAME:"x-much2",RATE:48e3,ENCODING:2},SUBSTITUTION:{NAME:"L16",RATE:48e3,ENCODING:2},PT:113},SatinFB:{CODEC:{NAME:"SATINFB",RATE:48e3,ENCODING:2},SUBSTITUTION:{NAME:"L16",RATE:48e3,ENCODING:2},PT:109}},v1=class{constructor(e,t,i,n){this.worker=e,this.clientId=t,this.transformType=i,this.listener=n,this.worker.subscribeClient(this.clientId,this.transformType,e=>this.processMsg(e)),this.worker.sendTransformCommand(this.clientId,{operation:"add",transformType:this.transformType})}dispose(){this.worker.unsubscribeClient(this.clientId),this.worker.sendTransformCommand(this.clientId,{operation:"clear"})}processMsg(e){if(this.listener&&e.name in this.listener)return this.listener[e.name].apply(this.listener,e.args);throw`unexpected message received for transform type ${this.transformType}: ${JSON.stringify(e)}`}};function v2(e,t,i){return new v3(e,t,i)}var v3=class extends v1{constructor(e,t,i){super(e,t,2,i)}init(e,t,i,n){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"init",args:[e,t,i,n]}})}setTimerWorkletPort(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"setTimerWorkletPort",args:[e]}},[e])}setDecoderWorkletPort(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"setDecoderWorkletPort",args:[e]}},[e])}setRendererWorkletPort(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"setRendererWorkletPort",args:[e]}},[e])}setCodec(e,t){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"setCodec",args:[e,t]}})}passWriteableStreams(e,t){let i=e.concat(t);this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"passWriteableStreams",args:[e,t]}},i)}setAvailableStreams(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"setAvailableStreams",args:[e]}})}setRecvPayloads(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"setRecvPayloads",args:[e]}})}debugLogging(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"debugLogging",args:[e]}})}sendApiRecordingData(){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"sendApiRecordingData",args:[]}})}},v4=class e{constructor(){this.node=null,this.context=new AudioContext({sampleRate:16e3})}dispose(){this.node&&(this.node.disconnect(),this.node&&"dispose"in this.node&&this.node.dispose(),this.node.port.close(),this.node=null),this.context.close()}createDecoderPort(){return this.node=new AudioWorkletNode(this.context,"decoder-worklet-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[1]}),this.node.connect(this.context.destination),this.node.port}static async create(t){let i=new e;return await i.context.audioWorklet.addModule(t),i}},v5=class{constructor(e){let t=e.config.useInsertableStreams?.audioWasmCodec?.wasmHealerPullStrategy;this.wasmHealerPullStrategy=t>=0?t:-1,this.fallbackThresholdPullTiming=e.config.useInsertableStreams?.audioWasmCodec?.fallbackThreshold%1e4||1e3,this.fallbackThresholdCountMax=Math.floor(e.config.useInsertableStreams?.audioWasmCodec?.fallbackThreshold/1e4)%10||3,this.fallbackThresholdPullDuration=Math.floor(e.config.useInsertableStreams?.audioWasmCodec?.fallbackThreshold/1e5)||1e3,this.timeToFirstAudioInsertableStreams=e.config.useInsertableStreams?.audioWasmCodec?.timeToFirstAudioInsertableStreams}},v6=class e extends no{constructor(e,t,i,n){super(),this.logger=e,this.maxNumOfStreamsFactor=i,this.statsProvider=new v9,this.contributingSources=[],this.audioContext=new vz(v0.SatinFB.CODEC.RATE),this.unmixedAudioProvider=new vJ(this.logger),this.codec="None",this.recvPayloads=[],this.initCompleted=!1,this.enabledApiRecording=!1,this.fallbackThresholdCount=0,this.avgJitterBufferDelayMs=0;try{this.enabledApiRecording="true"===localStorage.getItem("enableApiRecording")}catch{}this.streamMixer=new vj(this.audioContext,this.logger,n),this.unmixedAudioProvider.setConfiguredState(!!t.mediaConfig.spatialAudioEnabled),this.codecConfig=new v5(t)}get stream(){return this.audioContext.destination.stream}static async create(t,i,n,r,s,a,o){let l=new e(t,i,n,r);l.timerWorkletNode=s?await vQ.create(s,t):void 0;try{l.decoderWorkletNode=a?await v4.create(a):void 0}catch(e){t.safe.warn(`Failed to create DecoderWorkletNode from url: ${a} - error: ${e}`),l.decoderWorkletNode=void 0}return l.rendererWorkletNode=o?await vZ.create(l.audioContext.audioContext,l.audioContext.destination,o,t):void 0,l.injectWebMA(),l}dispose(){super.dispose(),this.audioContext.dispose(),this.imp?.dispose(),this.removeWebMA()}activateTransform(e){this.logger.safe.debug("Activating WASM decoder transform"),e.addTransform(this)}deactivateTransform(){this.logger.safe.debug("Deactivating WASM decoder transform"),this.imp.dispose(),this.imp=null,this.initCompleted=!1,this.codec="None",this.streamMixer.setMixerType(-1,[])}createBaseInstance(e){this.logger.warn("WASM decoder could only be instantiated in worker")}createWorkerInstance(e,t){this.imp=v2(e,t,this),this.imp.init(this.enabledApiRecording,this.codecConfig.wasmHealerPullStrategy,!!this.timerWorkletNode,!!this.rendererWorkletNode&&!!this.decoderWorkletNode)}setCodec(e){if(this.logger.safe.debug(`Setting codec to ${e}`),!this.initCompleted){this.logger.safe.debug("Decoder is not initialized yet, postponing codec setting"),this.codec=e;return}this.codec!==e&&(this.codec=e,this.setCodecInternal())}setRecvPayloads(e){if(this.recvPayloads=e,!this.initCompleted)return void this.logger.safe.debug("Decoder is not initialized yet, postponing Recv payload setting");this.imp.setRecvPayloads(e)}negotiationCompleted(e){this.logger.safe.debug(`Negotiation completed, negotiated=${e}`),this.unmixedAudioProvider.setNegotiatedState(e),e||(this.codec="None",this.imp?.setCodec(this.codec,this.streamMixer.isSingleInputStream()))}setParticipantSpatialAudioPositions(e){this.streamMixer.setParticipantSpatialAudioPositions(e)}disableStreamsMixer(e){e?this.streamMixer.stopMixing():this.streamMixer.startMixing(this.unmixedAudioProvider.streams.concat(this.unmixedAudioProvider.comfortNoiseStream??[]))}getStatsProvider(){return this.statsProvider}getUnmixedAudioProvider(){return this.unmixedAudioProvider}configureSpatialAudio(e){this.unmixedAudioProvider.setConfiguredState(e)}async storeApiRecording(){if(this.enabledApiRecording&&this.initCompleted)return this.recordingCompletePromise?.resolve(),this.recordingCompletePromise=new iE,this.imp.sendApiRecordingData(),this.recordingCompletePromise.promise}initDone(e,t){if(this.healerCapabilities=t,this.logger.safe.info(`Init done, errorCode=${e}`),0!==e)return void this.event("initFailed").raise(e);this.logger.safe.info(`healerCapabilities=${JSON.stringify(t)}`),this.initCompleted=!0;let i=Math.floor(this.healerCapabilities.maxNumStreamsPerPacket*this.maxNumOfStreamsFactor),n=this.unmixedAudioProvider.setupStreams(i,!0);this.imp.passWriteableStreams(n.streams,n.cnStream),this.setCodecInternal(),this.imp.setRecvPayloads(this.recvPayloads)}requestTimerWorkletPort(){this.timerWorkletNode&&this.imp?.setTimerWorkletPort(this.timerWorkletNode.createTimerPort())}requestDecoderWorkletPort(){this.decoderWorkletNode&&this.imp?.setDecoderWorkletPort(this.decoderWorkletNode.createDecoderPort())}requestRendererWorkletPort(){this.rendererWorkletNode&&this.imp?.setRendererWorkletPort(this.rendererWorkletNode.createRendererPort(v0.SatinFB.CODEC.ENCODING))}usedDecoderChanged(e){this.logger.safe.info(`Used decoder changed to custom=${e}, configured codec=${this.codec}`),this.event("usedDecoderChanged").raise(e),this.unmixedAudioProvider.setDetectedCodec(this.codec)}packetReceived(e,t,i,n){this.statsProvider.ssrc=t,this.statsProvider.addPushStats(e,n),this.avgJitterBufferDelayMs=n.webrtc.jitterBufferDelay&&n.extra.totalReceivedPackets?1e3*n.webrtc.jitterBufferDelay/n.extra.totalReceivedPackets:0,this.contributingSources.length===i.length&&this.contributingSources.every((e,t)=>e===i[t])||(this.contributingSources=i,this.event("contributingSourcesChanged").raise(i))}firstAudioFrameReceived(){this.codecConfig.timeToFirstAudioInsertableStreams&&this.event("firstAudioPacketReceived").raise()}newDataWrittenToStreams(e){let t=Array.from(new Int32Array(e));this.unmixedAudioProvider.setStreamSources(t),this.streamMixer.setStreamSources(t);let i=t.reduce((e,t,i)=>(t===vX&&e.push(i),e),[]);this.imp?.setAvailableStreams(i)}packetDecoded(e,t,i){let n=!1;if(this.fallbackThresholdCount<this.codecConfig.fallbackThresholdCountMax){let e=0,t=!1;i.pullTiming&&(t=(e=i.pullTiming+this.avgJitterBufferDelayMs)>=this.codecConfig.fallbackThresholdPullTiming)&&(this.fallbackThresholdCount+=1,(n=t&&this.fallbackThresholdCount===this.codecConfig.fallbackThresholdCountMax)&&this.logger.safe.warn(`Decoder delay of ${e}ms (${this.avgJitterBufferDelayMs}, ${i.pullTiming}) exceeded fallback threshold ${this.codecConfig.fallbackThresholdPullTiming}ms. Threshold hit ${this.codecConfig.fallbackThresholdCountMax} times`)),!t&&void 0!==i.extra.processingTime&&(t=i.extra.processingTime>=this.codecConfig.fallbackThresholdPullDuration)&&(this.fallbackThresholdCount+=1,(n=t&&this.fallbackThresholdCount===this.codecConfig.fallbackThresholdCountMax)&&this.logger.safe.warn(`Decoder duration of ${i.extra.processingTime}ms exceeded fallback threshold ${this.codecConfig.fallbackThresholdPullDuration}ms. Threshold hit ${this.codecConfig.fallbackThresholdCountMax} times`)),t||(this.fallbackThresholdCount=0)}i.pullStrategy=this.codecConfig.wasmHealerPullStrategy,i.fallbackThreshold=this.codecConfig.fallbackThresholdPullTiming,i.hasFallbackTriggered=this.fallbackThresholdCount===this.codecConfig.fallbackThresholdCountMax,i.audioWorkletAvailable=+!!this.timerWorkletNode+(this.decoderWorkletNode&&this.rendererWorkletNode?10:0),this.statsProvider.addPullStats(e,t,i,i.extra.samplingRatekHz*this.healerCapabilities.frameLengthMs),n&&this.event("fallbackRequired").raise()}apiRecordingAvailable(e,t,i){if(this.logger.safe.debug(`API recording available: errorCode=${e}, name=${t}, buffer length=${i.byteLength}`),this.recordingCompletePromise?.resolve(),0===i.byteLength)return;let n=new Blob([i],{type:"application/octet-stream"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=t,s.click()}setCodecInternal(){this.streamMixer.setMixerType(v8(this.codec),this.unmixedAudioProvider.streams.concat(this.unmixedAudioProvider.comfortNoiseStream??[])),this.imp.setCodec(this.codec,this.streamMixer.isSingleInputStream()),this.statsProvider.codecName=this.codec}injectWebMA(){let e=window.webMA;e&&(e.wasmDecoder={debugLogging:e=>this.imp?.debugLogging(e),sendApiRecordingData:()=>this.imp?.sendApiRecordingData()})}removeWebMA(){let e=window.webMA;e&&delete e.wasmDecoder}};function v8(e){switch(e){case"SatinFB":return 0;case"MUCHv2":return 1;case"None":return -1;default:throw Error(`unknown codec: ${e}`)}}var v9=class{constructor(){this.customHealerStats={numSamplesPerFrame:0,FECPayloadDecodedSamples:0,concealSamples:0,stretchSamples:0,healedSamples:0,decodedSamples:0,redPacketsCount:0,pushProcessingTimes:{},pullProcessingTimes:{},pullProcessingTimePerStreamNumber:{},pullTimings:{},pullNumOfStreamsCounter:{},pullStrategy:0,fallbackThreshold:0,hasFallbackTriggered:!1,audioWorkletAvailable:0,audioRendererUsed:0},this.inboudStats={silentConcealedSamples:0,concealedSamples:0,totalSamplesReceived:0,audioLevel:0,jitterBufferDelay:0,jitterBufferEmittedCount:0,totalReceivedPackets:0},this.decoderStats={pushCount:0,pushErrCount:0,pullCount:0,pullErrCount:0},this.packetPushProccesingTimes=new v7(0,1e3),this.packetPullProccesingTimes=new v7(0,1e3),this.numOfStreamsCounter=new v7(0,10),this.pullProcessingTimePerStreamNumber={},this.packetPullTimings=new v7(0,1e3)}get codecName(){return this.codec}set codecName(e){this.codec=e}addPushStats(e,t){this.decoderStats.pushCount++,this.decoderStats.pushErrCount+=+(0!==e),this.inboudStats.jitterBufferDelay=t.webrtc.jitterBufferDelay,this.inboudStats.totalReceivedPackets=t.extra.totalReceivedPackets,this.customHealerStats.packetDurationInMs=t.extra.packetDurationInMs,this.packetPushProccesingTimes.addSample(t.extra.processingTime),this.customHealerStats.cnpPushCount=t.extra.totalCountCNPackets,this.customHealerStats.redPacketsCount+=+(0!==t.extra.redundancyTimestampOffset)}addPullStats(e,t,i,n){var r;this.decoderStats.pullCount++,this.decoderStats.pullErrCount+=+(0!==e),this.inboudStats.audioLevel=i.webrtc.audioLevel,this.inboudStats.totalAudioEnergy=i.webrtc.totalAudioEnergy,this.inboudStats.jitterBufferEmittedCount=i.webrtc.jitterBufferEmittedCount,this.inboudStats.totalSamplesReceived=i.webrtc.totalSamplesReceived,this.inboudStats.concealedSamples=i.webrtc.concealedSamples,this.inboudStats.silentConcealedSamples=i.webrtc.silentConcealedSamples,this.numOfStreamsCounter.addSample(t),this.customHealerStats.FECPayloadDecodedSamples=i.extra.FECPayloadDecodedSamples,this.customHealerStats.numSamplesPerFrame=n,this.customHealerStats.pullAdspPayloadType=i.extra.pullAdspPayloadType,this.customHealerStats.concealSamples=i.extra.concealSamples,this.customHealerStats.stretchSamples=i.extra.stretchSamples,this.customHealerStats.healedSamples=i.extra.healedSamples,this.customHealerStats.decodedSamples=i.extra.decodeSamples,this.packetPullProccesingTimes.addSample(i.extra.processingTime),this.customHealerStats.cnpPullCount=i.extra.totalCountCNGeneratedFrames,this.customHealerStats.cngSamples=i.extra.cngSamples,(r=this.pullProcessingTimePerStreamNumber)[t]??(r[t]=new v7(0,200)),this.pullProcessingTimePerStreamNumber[t].addSample(i.extra.processingTime),this.packetPullTimings.addSample(i.pullTiming),void 0!==i.pullStartTiming&&(this.customHealerStats.pullStartTiming=i.pullStartTiming),this.customHealerStats.pullStrategy=i.pullStrategy,this.customHealerStats.fallbackThreshold=i.fallbackThreshold,this.customHealerStats.hasFallbackTriggered=i.hasFallbackTriggered,this.customHealerStats.audioWorkletAvailable=i.audioWorkletAvailable,this.customHealerStats.audioRendererUsed=i.audioRendererUsed}getWebRtcCompatibleStats(){return this.inboudStats}getWasmStats(){for(let e of(this.customHealerStats.pushProcessingTimes=this.packetPushProccesingTimes.getFrequencies(),this.customHealerStats.pullProcessingTimes=this.packetPullProccesingTimes.getFrequencies(),this.customHealerStats.pullNumOfStreamsCounter=this.numOfStreamsCounter.getFrequencies(),this.customHealerStats.pullTimings=this.packetPullTimings.getFrequencies(),Object.keys(this.pullProcessingTimePerStreamNumber)))this.customHealerStats.pullProcessingTimePerStreamNumber[e]=this.pullProcessingTimePerStreamNumber[e].getFrequencies();return this.customHealerStats}getDecoderStats(){return this.decoderStats}},v7=class{constructor(e,t){this.minSample=e,this.maxSample=t,this.frequencyDict={}}addSample(e){if(void 0===e)return;let t=Math.min(this.maxSample,Math.max(this.minSample,e));this.frequencyDict[t]=(this.frequencyDict[t]??0)+1}getFrequencies(){return{...this.frequencyDict}}};function Se(e,t,i){return new St(e,t,i)}var St=class extends v1{constructor(e,t,i){super(e,t,3,i)}init(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"init",args:[e]}})}setCodec(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"setCodec",args:[e]}})}debugLogging(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"debugLogging",args:[e]}})}},Si=[{payload:109,rate:48e3,channels:2,ptime:20}],Sn=class extends no{constructor(e){super(),this.logger=e,this.codec="None",this.injectWebMA()}getCodecName(){return this.codec}dispose(){super.dispose(),this.imp?.dispose(),this.removeWebMA()}activateTransform(e){this.logger.safe.debug("Activating WASM encoder transform"),e.addTransform(this)}deactivateTransform(){this.logger.safe.debug("Deactivating WASM encoder transform"),this.imp?.dispose(),this.imp=void 0,this.encodersInitCodes=void 0,this.codec="None"}createBaseInstance(e){this.logger.warn("WASM encoder could only be instantiated in worker")}createWorkerInstance(e,t){this.imp=Se(e,t,this),this.imp.init(Si)}setCodec(e){if(this.logger.safe.debug(`Setting codec to ${e}`),!this.encodersInitCodes){this.logger.safe.debug("Encoder is not initialized yet, postponing codec setting"),this.codec=e;return}this.codec!==e&&(this.codec=e,this.setCodecInternal())}isCodecAllowed(e){return Si.map(e=>Ss(e.payload)).includes(e)}negotiationCompleted(e){e||(this.codec="None",this.imp?.setCodec(Sr(this.codec)))}initDone(e){this.logger.safe.info(`initDone: ${JSON.stringify(e)}`),this.encodersInitCodes=e,this.setCodecInternal()}packetEncoded(e){0!==e&&this.logger.safe.info(`encode failed: ${e}`)}setCodecInternal(){let e=Sr(this.codec).payload,t=this.encodersInitCodes[e]??-0x7ff8ffa9;if("None"!==this.codec&&0!==t){this.logger.safe.error(`WASM encoder is failed to init codec ${this.codec}, err code: ${t}`),this.event("initCodecFailed").raise(t);return}this.event("codecChanged").raise(this.codec),this.imp?.setCodec(Sr(this.codec))}injectWebMA(){let e=window.webMA;e&&(e.wasmEncoder={debugLogging:e=>this.imp?.debugLogging(e)})}removeWebMA(){let e=window.webMA;e&&delete e.wasmEncoder}};function Sr(e){return"SatinFB"===e?{payload:109,rate:48e3,channels:2,ptime:20}:{payload:255,rate:-1,channels:-1,ptime:-1}}function Ss(e){return 109===e?"SatinFB":"None"}var Sa=i(892891),So=class extends no{constructor(e,t,i){super(),this.encStreamsManager=e,this.logger=t,this.configProvider=i,this.isEnabled=!1,this.fallbackRequired=!1,this.sessionStats=new Sc,this.subs=[],this.codecContext=this.configProvider.mediaConfig.audioCodecContext,this.codecConfig=this.configProvider.config.useInsertableStreams?.audioWasmCodec}get decoder(){return this.decoderImp}get encoder(){return this.encoderImp}async init(e,t){if(!e||!this.codecContext||!this.codecConfig?.enable)return;this.isEnabled=!0;let i=this.codecConfig.maxNumOfStreamsFactor||1;this.decoderImp=await v6.create(this.logger.createChild("AudioWasmDecoder"),this.configProvider,i,t,this.encStreamsManager.timerWorkletURL,this.encStreamsManager.decoderWorkletURL,this.encStreamsManager.rendererWorkletURL),this.codecConfig.enableSend&&(this.encoderImp=new Sn(this.logger.createChild("AudioWasmEncoder"))),this.subscribeToStreamManagerEvents(this.encStreamsManager),this.subscribeToCodecsEvents()}dispose(){super.dispose(),this.unsubscribeFromEvents(),this.decoderImp?.dispose(),this.encoderImp?.dispose()}getSessionEvents(){return this.sessionStats.getSessionEvents()}prepareForNegotiation(e){if(!this.isEnabled)return;let t=this.fallbackRequired?"None":this.decoderImp?.getUnmixedAudioProvider()?.configured?"MUCHv2":this.codecConfig.codec||"None";this.logger.info(`Audio codec prepareForNegotiation: codec=${t}, fallback=${this.fallbackRequired}`),this.codecContext.codec!==t&&(this.codecContext.initSendFailed=!1),this.codecContext.lastUsedCodec=this.codecContext.codec,this.codecContext.codec=t,this.codecContext.enabledLocally=!this.codecContext.initFailed&&"None"!==t,this.codecContext.enabledForSend=this.codecContext.enabledLocally&&!this.codecContext.initSendFailed&&!!this.codecConfig?.enableSend&&this.encoder?.isCodecAllowed(t),this.logger.safe.info(`Audio codec state: context=${JSON.stringify(this.codecContext)}`),this.codecContext.initFailed||!e&&this.codecContext.disabledRemotely||(this.sessionStats.toggleState("None"!==t),this.decoderImp?.setCodec(t),this.encoderImp?.setCodec(this.codecContext.enabledForSend?t:"None"))}negotiationCompleted(){if(!this.isEnabled)return!1;let e=this.codecContext.enabledLocally&&!this.codecContext.disabledRemotely;return this.decoderImp?.negotiationCompleted(e),this.encoderImp?.negotiationCompleted(e),this.sessionStats.negotiationCompleted(e,this.codecContext.enabledForSend),e}configureSpatialAudio(e,t){return!!this.isEnabled&&(this.decoderImp?.configureSpatialAudio(e),(e&&"MUCHv2"!==this.codecContext.codec||!e&&"MUCHv2"===this.codecContext.codec)&&this.event("negotiationNeeded").raise(t),!0)}subscribeToStreamManagerEvents(e){this.subs.push(e.on("onTransformsCollectionCreated",e=>this.handleTransformsCollectionCreated(e)),e.on("onTransformsCollectionCleared",e=>this.handleTransformsCollectionCleared(e)))}handleTransformsCollectionCreated(e){if("Audio"===e.mediaType){if(this.decoderImp&&"Receiver"===e.objType)return void this.decoderImp.activateTransform(e.collection);if(this.encoderImp&&"Sender"===e.objType)return void this.encoderImp.activateTransform(e.collection)}}handleTransformsCollectionCleared(e){if("Audio"===e.mediaType){if(this.decoderImp&&"Receiver"===e.objType)return void this.decoderImp.deactivateTransform();if(this.encoderImp&&"Sender"===e.objType)return void this.encoderImp.deactivateTransform()}}subscribeToCodecsEvents(){this.decoderImp&&(this.subs.push(this.decoderImp.on("initFailed",e=>this.handleCodecInitFailed("decoder",e))),this.subs.push(this.decoderImp.on("fallbackRequired",()=>{this.fallbackRequired||(this.fallbackRequired=!0,this.event("negotiationNeeded").raise(e9()))}))),this.encoderImp&&this.subs.push(this.encoderImp.on("initCodecFailed",e=>this.handleCodecInitFailed("encoder",e)))}unsubscribeFromEvents(){this.subs.forEach(e=>e.dispose()),this.subs=[]}handleCodecInitFailed(e,t){"decoder"===e?this.codecContext.initFailed=!0:this.codecContext.initSendFailed=!0;let i=e9();this.logger.safe.warn(`[${i}] Audio ${e} init failed ${t}`),this.sessionStats.initFailed(t,e),this.event("negotiationNeeded").raise(i)}},Sl=class e{constructor(){this.sessionEvents={negotiationAttempts:[],toggleCount:0,negotiatedCount:0,failedNegotiationCount:0,decoderInitError:0,encoderInitError:0}}toggleState(t){this.sessionEvents.toggleCount++,this.inProgressNegotiation={ts:Date.now(),enabled:t,negotiated:!1,sendEnabled:!1},nq(this.sessionEvents.negotiationAttempts,this.inProgressNegotiation,e.maxStoreNegotiations)}negotiationCompleted(e,t){this.inProgressNegotiation&&(this.sessionEvents.negotiatedCount+=+!!e,this.sessionEvents.failedNegotiationCount+=this.inProgressNegotiation.enabled&&!e?1:0,this.inProgressNegotiation.negotiated=e,this.inProgressNegotiation.sendEnabled=t,this.inProgressNegotiation=void 0)}initFailed(e,t){"decoder"===t?this.sessionEvents.decoderInitError=e:this.sessionEvents.encoderInitError=e}getSessionEvents(){return(0,Sa.clone)(this.sessionEvents)}};Sl.maxStoreNegotiations=5;var Sc=Sl,Sd=class{constructor(e,t){this.logger=t,this.clientsMap=new Map,this.loaded=!1,this.initDefer=new iE;try{this.worker=e.getWorker(this.logger),this.worker.onmessage=e=>this.handleEvent(e.data),this.worker.onerror=e=>{this.logger.safe.error(`error inside worker: ${e.message}`),this.initDefer.resolve()}}catch(e){this.logger.safe.error("failed to create worker"),this.initDefer.resolve()}}async initialize(){return Promise.race([this.initDefer.promise,iI(5e3).then(()=>{this.loaded??this.logger.safe.warn("worker initialization timeout")})])}isWorkerLoaded(){return this.loaded}sendTransformCommand(e,t,i=[]){let n={type:"transform",clientId:e,payload:t};this.worker?.postMessage(n,i)}subscribeClient(e,t,i){let n=this.clientsMap.get(e)??new Map;n.set(t,i),this.clientsMap.set(e,n)}unsubscribeClient(e){this.clientsMap.delete(e)}dispose(){let e={type:"generic",payload:{operation:"dispose"}};this.worker?.postMessage(e),this.worker?.terminate()}handleEvent(e){switch(e.type){case"init":this.initDefer.resolve(),this.loaded=!0,this.logger.safe.info("worker initialized");break;case"transform":{let t=this.clientsMap.get(e.payload.clientId),i=t?.get(e.payload.event.transformType);i?i(e.payload.event):this.logger.safe.error(`received event for unknown Client ${e.payload.clientId} or transformType ${e.payload.event.transformType}: ${e.payload.event.name}`)}break;case"log":switch(e.level){case"debug":this.logger.safe.debug(e.msg);break;case"info":this.logger.safe.info(e.msg);break;case"warn":this.logger.safe.warn(e.msg);break;case"error":this.logger.safe.error(e.msg);break;default:this.logger.safe.error(`unknown log level ${e.level}`)}break;default:this.logger.safe.error(`received unsupported event from worker ${e.type}`)}}},Su=7,Sh=31,Sg=class{constructor(e){this.logger=e,this.transformType=0}transform(e){return this.processChunk(e),e}dispose(){}getStartCodeSize(e){let t=e.getUint32(0);return 1===t?4:3*((0xffffff00&t)==256)}processChunk(e){if("key"!==e.type)return;let t=this.isH264KeyFrame(e.data)?`${this.getH264Profile(e.data)}(H264)`:"unknown";this.logger.info(`keyframe metadata: ${JSON.stringify(e.getMetadata())}, profile=${t}`)}isH264KeyFrame(e){if(e.byteLength<7)return!1;let t=new DataView(e),i=this.getStartCodeSize(t);return!!i&&(t.getUint8(i)&Sh)===Su}getH264Profile(e){let t=new DataView(e),i=this.getStartCodeSize(t);return(0xffffff&t.getUint32(i)).toString(16)}},Sp=class extends v1{constructor(e,t){super(e,t,0,void 0)}},Sf=class{constructor(e){this.logger=e}createBaseInstance(e){this.imp=new Sg(this.logger.safe),e.addTransform(this.imp)}createWorkerInstance(e,t){this.imp=new Sp(e,t)}},Sm=class{constructor(){this.transformType=1,this.muted=!1}transform(e){return this.muted?null:e}mute(e){this.muted=e}dispose(){}},Sv=class extends v1{constructor(e,t){super(e,t,1,void 0)}mute(e){this.worker.sendTransformCommand(this.clientId,{operation:"invoke",func:{transformType:this.transformType,name:"mute",args:[e]}})}},SS=class{constructor(e){this.logger=e}createBaseInstance(e){this.imp=new Sm,e.addTransform(this.imp)}createWorkerInstance(e,t){this.imp=new Sv(e,t)}mute(e){this.logger.safe.info(`Dropping audio chunks: ${e}`),this.imp.mute(e)}},Sy=class{constructor(e,t){this.transforms=[];let i=new TransformStream({transform:(e,t)=>{let i=e;for(let e of this.transforms)if(!(i=e.transform(i)))return;t.enqueue(i)}});e.pipeThrough(i).pipeTo(t)}clearTransforms(){for(let e of this.transforms)e.dispose();this.transforms=[]}addTransform(e){this.transforms.push(e)}getTransform(e){return this.transforms.find(t=>t.transformType===e)}},SC=class extends tZ{constructor(){super(),this.subs=[]}get streams(){return this.sessionAudioProvider?.streams??[]}get comfortNoiseStream(){return this.sessionAudioProvider?.comfortNoiseStream??null}get configured(){return this.sessionAudioProvider?.configured??!1}get active(){return this.sessionAudioProvider?.active??!1}get codec(){return this.sessionAudioProvider?.codec??"None"}setSessionStreamsProvider(e){this.unsubscribeFromStreamEvents(),this.sessionAudioProvider=e,this.subscribeForStreamEvents(),this.event("onStreamsChanged").raise(),this.event("onActiveStateChanged").raise(this.active)}dispose(){super.dispose(),this.unsubscribeFromStreamEvents()}subscribeForStreamEvents(){this.sessionAudioProvider&&this.subs.push(this.sessionAudioProvider.on("onStreamsChanged",()=>this.event("onStreamsChanged").raise()),this.sessionAudioProvider.on("onStreamSourcesUpdated",e=>this.event("onStreamSourcesUpdated").raise(e)),this.sessionAudioProvider.on("onConfiguredStateChanged",e=>this.event("onConfiguredStateChanged").raise(e)),this.sessionAudioProvider.on("onActiveStateChanged",e=>this.event("onActiveStateChanged").raise(e)),this.sessionAudioProvider.on("onActiveCodecChanged",e=>this.event("onActiveCodecChanged").raise(e)))}unsubscribeFromStreamEvents(){this.subs.forEach(e=>e.dispose()),this.subs=[]}},Sb=class extends tZ{constructor(e,t,i,n,r){super(),this.allowVirtualDeviceInCall=e,this.defaultDeviceManager=t,this.logger=i,this.callStats=n,this.isMediaSending=r,this.stats=[],this.selectedVirtualDevice={camera:void 0,screenshare:void 0},this.subs=[this.defaultDeviceManager.on("onVirtualDevicesChanged",()=>this.handleRegisteredDeviceChange())],this.logger.info(`allowVirtualDeviceInCall: ${e}`)}get isVirtualDeviceEnabled(){return this.allowVirtualDeviceInCall}selectDevices(e){let t=this.defaultDeviceManager.getRegisteredDevices(),i=t.find(t=>t.id===e.camera),n=t.find(t=>t.id===e.screenshare);this.logger.info(`Selecting virtual devices, camera: ${i?.id}, screenshare: ${n?.id}`);let r={camera:this.selectedVirtualDevice.camera?.id,screenshare:this.selectedVirtualDevice.screenshare?.id};if(e.camera===r.camera&&e.screenshare===r.screenshare)return void this.logger.info("Virtual Device did not change.");this.selectedVirtualDevice={camera:i,screenshare:n},this.addToCallStat({type:"VirtualDeviceSelected",payload:this.selectedVirtualDevice}),this.event("onSelectedVirtualDevicesChanged").raise(e,r)}getSelectedDevices(){return Object.entries(this.selectedVirtualDevice).reduce((e,[t,i])=>(e[t]=i?.id,e),{})}getDeviceManager(e){return this.allowVirtualDeviceInCall?this.getDeviceManagersForVirtualDevice(e)[0]:this.defaultDeviceManager}getDeviceManagersForVirtualDevice(e){return"Video"===e&&this.selectedVirtualDevice.camera?(this.logger.info(`Using Virtual Device (DM), type: ${e}`),this.selectedVirtualDevice.camera.getDeviceManagers()):"ScreenShare"===e&&this.selectedVirtualDevice.screenshare?(this.logger.info(`Using Virtual Device (DM), type: ${e}`),this.selectedVirtualDevice.screenshare.getDeviceManagers()):(this.logger.info(`Using default DM, type: ${e}`),[this.defaultDeviceManager])}getDefaultDeviceManager(){return this.defaultDeviceManager}dispose(){this.stats=[],this.subs.forEach(e=>e.dispose()),super.dispose()}hasDevice(e){return this.defaultDeviceManager.id===e||[...this.selectedVirtualDevice.camera?.getDeviceManagers()??[],...this.selectedVirtualDevice.screenshare?.getDeviceManagers()??[]].some(t=>t?.id===e)}addToCallStat(e){let t=this.stats.push(e);this.callStats.appendCallDeviceManagerInfo({events:JSON.stringify(t)})}handleRegisteredDeviceChange(){let e=this.defaultDeviceManager.getRegisteredDevices(),{camera:t,screenshare:i}=this.selectedVirtualDevice,n=!1,r=!1;t&&(n=e.some(e=>e.id===t.id),this.logger.info(`Selected camera(${t.id}) in call, isCameraValid:${n}`)),i&&(r=e.some(e=>e.id===i.id),this.logger.info(`Selected SS(${i.id}) in call, isScreenShareValid:${r}`)),this.selectDevices({camera:n?t.id:void 0,screenshare:r?i.id:void 0})}isModalityEnabled(e){return this.isMediaSending(p8(e))}},ST=class{constructor(e,t){this.logger=e,this.configProvider=t,this.debounceMap=new Map,this.enabledViaApi=!1,this.configProvider.config.remoteUFD?.enabledViaApi&&this.init()}init(){this.configProvider.config.remoteUFD?.enabled&&Object.keys(this.configProvider.config.remoteUFD.list).length&&(this.enabledViaApi=!0,this.logger.info(`Remote UFDs list: ${JSON.stringify(this.configProvider.config.remoteUFD.list)}`))}raiseIfNeeded(e,t,i){if(this.shouldBeRaised(e,t))if(this.configProvider.config.localUFDDebounceTime)i(this.getState(e));else{clearTimeout(this.debounceMap.get(e.type));let t=setTimeout(i,this.configProvider.config.remoteUFD.debounceTime,this.getState(e));this.debounceMap.set(e.type,t)}}dispose(){for(let e of this.debounceMap.values())clearTimeout(e);this.debounceMap.clear(),this.enabledViaApi=!1}shouldBeRaised(e,t){return!!this.configProvider.config.remoteUFD?.enabled&&!!this.enabledViaApi&&!(t>this.configProvider.config.remoteUFD.maxParticipantNumber)&&!!this.configProvider.config.remoteUFD.list[e.type]}getState(e){return{type:"clientMediaUfd",level:"endpoint",content:JSON.stringify([e])}}},SE=i(892891),S_={reconnect:{metrics:["ReconnectAttempts","ReconnectConnectedCount","RetargetCompletedCount","TerminationReason_code","TerminationReason_subCode","UFDs"],Extensions:["StartTime","EndTime"]},rejectNegotiation:{metrics:["NetworkEvents","ErrorDetail","UFDs","RollbackNegotiation","TerminationReason_code","TerminationReason_subCode"],Extensions:["IceConnectionState","IceConnectionStatePrevious","StartTime","EndTime"]},visibilityHidden:nu.MEDIA_EVENT_FIELDS,lowBattery:nu.MEDIA_EVENT_FIELDS},SI=class extends tZ{constructor(e){super(),this.configProvider=e}setDiagnosticsReport(e){this.diagnosticsReport=e}setEventType(e){if(!this.configProvider.config.smallCallTelemetry.enable)return;let t=Object.keys(this.configProvider.config.smallCallTelemetry.mediaUFDEventDictionary),i=this.getLastKnownMediaSessionStats();if(i&&(t?.forEach(t=>{if(t===e){let n=this.configProvider.config.smallCallTelemetry.mediaUFDEventDictionary[t],r={eventType:e,data:this.buildFromDictionary(i,n)};this.setTerminationCodeAndSubCodeToSuccess(r.data),this.event("sendSmallCallTelemetry").raise(r)}}),"reconnect"===e||"rejectNegotiation"===e||"visibilityHidden"===e||"lowBattery"===e)){let t={eventType:e,data:this.buildFromDictionary(i,S_[e])};void 0===t.data.metrics.TerminationReason_code&&this.setTerminationCodeAndSubCodeToSuccess(t.data),this.event("sendSmallCallTelemetry").raise(t)}}getEndCallSmallTelemetry(e){let t=this.getLastKnownMediaSessionStats(),i=this.buildFromDictionary(t,nu.MEDIA_EVENT_FIELDS);return e&&(i.metrics.TerminationReason_code=ag,i.metrics.TerminationReason_subCode=aT),{eventType:e?"tabClosed":"endCall",data:i}}getSmallTelemetryOnBatteryLow(){let e=this.getLastKnownMediaSessionStats(),t=this.buildFromDictionary(e,nu.MEDIA_EVENT_FIELDS);return this.setTerminationCodeAndSubCodeToSuccess(t),{eventType:"lowBattery",data:t}}getLastKnownMediaSessionStats(){if(!this.diagnosticsReport)return;let e=this.diagnosticsReport.rawRootRef.sessions.length;return this.diagnosticsReport.getSessionTelemetry(this.diagnosticsReport.rawRootRef.sessions[e-1]?.sessionId)}buildFromDictionary(e,t){let i={Extensions:{},metrics:{}};if(!e)return i;for(let n in t)e[n]&&(i[n]={},t[n].forEach(t=>{let r=e[n][t];void 0!==r&&((0,SE.isBoolean)(r)||(0,SE.isNumber)(r)?i[n][t]=`${r}`:i[n][t]=r)}));return i}setTerminationCodeAndSubCodeToSuccess(e){void 0===e.metrics.TerminationReason_code&&(e.metrics.TerminationReason_code=ag,e.metrics.TerminationReason_subCode=ag)}},Sw=class extends tZ{constructor(e,t){super(),this.diagnostics=e,this.configProvider=t,this.hasSentLowBatteryEvent=!1,navigator?.getBattery?.().then(e=>{let t=()=>this.onLevelChange(e);e.addEventListener("levelchange",t),this.unsubscribe=()=>e.removeEventListener("levelchange",t)})}dispose(){this.unsubscribe?.()}onLevelChange(e){let t=100*e.level;this.diagnostics.setBatteryLevel(t),t<=this.configProvider.config.lowBatteryThreshold&&!this.hasSentLowBatteryEvent&&(this.event("batteryStatusChanged").raise(t),this.hasSentLowBatteryEvent=!0)}},SP=e=>`${e.type}:${e.mediaType}`,SR=class{constructor(e,t){this.logger=e,this.configProvider=t,this.timestamps={},this.lastSentUFDValues=new Map,this.disabledUFDs=new Set}shouldRaise(e,t,i){if(!this.isEnabled(e,t,i))return!1;let n=SP(e);if("Good"!==e.value&&this.shouldUFDBeDisabled(n)&&!this.disabledUFDs.has(n)&&(this.logger.info(`Disabling remote UFD: ${JSON.stringify(e)}`),this.disabledUFDs.add(n),setTimeout(()=>{this.disabledUFDs.delete(n)},this.configProvider.config.remoteUFD.disableInterval)),this.disabledUFDs.has(n)&&"Good"!==e.value)return!1;let r=this.lastSentUFDValues.get(n);return!this.disabledUFDs.has(n)||"Good"!==e.value||!!r&&"Good"!==r}registerSentUFDs(e){e.forEach(e=>{let t=SP(e);this.lastSentUFDValues.set(t,e.value)})}shouldUFDBeDisabled(e){var t;let i=this.configProvider.config.remoteUFD.maxNumberOfBadUFDsForThrottling;(t=this.timestamps)[e]??(t[e]=[]);let n=this.timestamps[e];return tq(n,Date.now(),i),!(n.length<i)&&n[i-1]-n[0]<this.configProvider.config.remoteUFD.throttlingTimeInterval}isEnabled(e,t,i){return!!this.configProvider.config.remoteUFD?.enabled&&!!i&&!(t>this.configProvider.config.remoteUFD.maxParticipantNumber)&&!!this.configProvider.config.remoteUFD.list[e.type]}},SA=class{constructor(e,t,i){this.logger=e,this.configProvider=t,this.publishState=i,this.bundledUFDs=new Map,this.sentBundleWindow=[],this.enabledViaApi=!1,this.configProvider.config.remoteUFD?.enabledViaApi&&this.init()}raiseIfNeeded(e,t){let i=SP(e);if(!this.remoteUFDFilter?.shouldRaise(e,t,this.enabledViaApi))return;let n=this.bundledUFDs.get(i);"Good"===e.value&&n&&"Good"!==n.value?this.bundledUFDs.delete(i):this.bundledUFDs.set(i,e)}dispose(){this.enabledViaApi=!1,this.bundledUFDs.clear(),clearTimeout(this.bundleInterval)}init(){!this.enabledViaApi&&this.configProvider.config.remoteUFD?.enabled&&Object.keys(this.configProvider.config.remoteUFD.list).length&&(this.enabledViaApi=!0,this.logger.info(`Initialized with remote UFDs list: ${JSON.stringify(this.configProvider.config.remoteUFD.list)}`),this.remoteUFDFilter=new SR(this.logger,this.configProvider),this.bundleInterval=window.setInterval(()=>this.sendUfdBundle(),this.configProvider.config.remoteUFD.bundlingInterval))}sendUfdBundle(){if(!this.bundledUFDs.size)return;if(this.sentBundleWindow.length>=this.configProvider.config.remoteUFD.maxNumberOfBundles){if(this.sentBundleWindow[0]+this.configProvider.config.remoteUFD.bundlingWindowInterval>Date.now())return;this.sentBundleWindow.shift()}let e=this.getState();this.logger.info(`Sending remote UFDs: ${e.content}`),this.remoteUFDFilter.registerSentUFDs(Array.from(this.bundledUFDs.values())),this.publishState(e),this.bundledUFDs.clear(),this.sentBundleWindow.push(Date.now())}getState(){return{type:"clientMediaUfd",level:"endpoint",content:JSON.stringify(Array.from(this.bundledUFDs.values()))}}},SM=new Map([["NetworkSendQuality",1],["NetworkRecvQuality",2],["NetworkDelay",3],["NetworkBandwidthLow",4],["NetworkReconnect",5],["NetworkPacketLoss",6],["NetworkJitter",7],["NetworkRateMatching",8],["DeviceCaptureNotFunctioning",9],["DeviceRenderNotFunctioning",10],["DeviceRenderGlitches",11],["DeviceLowSNR",12],["DeviceLowSpeechLevel",13],["DeviceClipping",14],["DeviceEcho",15],["DeviceNearEndToEchoRatio",16],["DeviceHalfDuplexAec",17],["DeviceMultipleEndpoints",18],["DeviceHowling",19],["DeviceRenderZeroVolume",20],["DeviceRenderMute",21],["NetworkSendCatastrophic",22],["NetworkRecvCatastrophic",23],["CpuInsufficient",24],["DeviceCaptureMute",25],["DeviceCaptureNotMuteButSilent",26],["DeviceSpeakWhileMuted",27],["VideoVbssRendered",28],["NetworkEthernetInterfaceUsed",29],["NetworkWlanInterfaceUsed",30],["NetworkWwanInterfaceUsed",31],["NetworkRelaysNotReachable",32],["VideoCapturerDeviceStartFailed",33],["VideoCapturerDeviceStartTimedOut",34],["VideoCapturerDeviceStartFailureLackSystemRes",35],["VideoCapturerDeviceStartFailureMFResConflict",36],["NoNetwork",37],["NetworkNotWorking",38],["DeviceCaptureNotFunctioningDeviceInUse",39],["DeviceRenderNotFunctioningDeviceInUse",40],["VideoCaptureDeviceFreeze",45],["ZeroCaptureDevicesEnumerated",43],["ZeroRenderDevicesEnumerated",44],["VideoCapturePermissionDenied",47],["ScreenshareRecordingDisabled",55],["AudioCapturePermissionDenied",46],["VideoCaptureFreezeRecovered",48],["DeviceRenderHowling",49],["PresentationAudioLoopbackDeviceState",53],["RemoteNetworkConnectivityIssue",52],["AudioCaptureUltrasoundDetected",54],["MusicModeNotAvailable",57],["CameraLighting",61],["AudioLoopbackDeviceReady",63],["NoRequiredVideoCodecs",64],["SpatialAudioMUCHUnavailable",65],["AudioMixMUCHUnavailable",80]]);function SD(e){return SM.get(e)}var SO=new Map([["Unknown",0],["Good",1],["Poor",2],["Bad",3]]);function Sk(e){return SO.get(e)}var SN=new Map([["Audio",0],["Video",1],["ScreenShare",2],["Data",3]]);function Sx(e){return SN.get(e)}var SL=class{constructor(){this.total=0,this.duration=0,this.max=0,this.minNonZero=Number.MAX_SAFE_INTEGER}get avg(){return 0!==this.duration?this.total/this.duration:0}get maxSample(){return this.max}get minNonZeroSample(){return this.minNonZero}captureSample(e){(e||0===e)&&(this.total+=e,this.duration++,this.max=Math.max(e,this.max),0!==e&&(this.minNonZero=Math.min(e,this.minNonZero)))}},SF=class{constructor(){this.sampleCounts={}}get min(){let e=Object.keys(this.sampleCounts).map(Number).filter(e=>e>0);return e.length>0?Math.min(...e):0}get max(){let e=Object.keys(this.sampleCounts).map(Number);return e.length>0?Math.max(...e):0}get mode(){let e=Object.keys(this.sampleCounts).map(Number);return e.length>0?e.reduce((e,t)=>this.sampleCounts[t]>this.sampleCounts[e]?t:e,e[0]):0}captureSample(e){var t;if(void 0!==e){let i=`${e}`;(t=this.sampleCounts)[i]??(t[i]=0),this.sampleCounts[i]++}}},SU=class{get delta(){if(void 0!==this.cur&&void 0!==this.last)return this.cur-this.last}captureSample(e,t){void 0!==e&&(void 0!==this.cur&&(this.last=this.cur),this.cur=e)}},S$=class{constructor(e=0){this.precision=e}get delta(){if(void 0!==this.currentSample&&void 0!==this.prevSample){let e=1;return void 0!==this.currentTimestamp&&void 0!==this.prevTimestamp&&(e=(this.currentTimestamp-this.prevTimestamp)/1e3),e&&nB((this.currentSample-this.prevSample)/e,this.precision)}}captureSample(e,t){if(this.currentTimestamp!==t){if(void 0===e){this.prevSample=void 0,this.currentSample=void 0,this.prevTimestamp=void 0,this.currentTimestamp=void 0;return}void 0!==this.currentSample&&(this.prevSample=this.currentSample),this.prevTimestamp=this.currentTimestamp,this.currentTimestamp=t,this.currentSample=e}}},SV=class{constructor(){this.startTime=Date.now()}get elapsed(){return nB((Date.now()-this.startTime)/1e3,0)}},SB=class{constructor(e){this.numOfHistogramSamples=e,this.eventCount=0,this.totalActiveDuration=0,this.countBuckets={seconds1to3:0,seconds3to5:0,seconds5to8:0,seconds8to15:0,seconds15to60:0,seconds60toMax:0},this.timestampBuckets={seconds1to3:[],seconds3to5:[],seconds5to8:[],seconds8to15:[],seconds15to60:[],seconds60toMax:[]},this.averager=new SL}get active(){return!!this.current}get ongoingDuration(){return this.current?.elapsed||0}get avgDuration(){return this.averager.avg}get longestDuration(){return this.averager.maxSample}get numEvents(){return this.eventCount}get totalDuration(){return this.current?this.totalActiveDuration+this.current.elapsed:this.totalActiveDuration}get timestamps(){return nw(this.timestampBuckets)}get counts(){return nw(this.countBuckets)}set active(e){if(!this.current&&e)this.current=new SV;else if(this.current&&!e){let e=this.current.elapsed;for(let t of(this.averager.captureSample(e),this.totalActiveDuration+=e,Object.keys(nu.HISTOGRAM_BATCH)))if(e<=nu.HISTOGRAM_BATCH[t]){this.countBuckets[t]++,tq(this.timestampBuckets[t],this.current.startTime,this.numOfHistogramSamples);break}this.eventCount++,this.current=void 0}}},SH=class{constructor(){this.sampleChangeCount=0,this.sampleDurations={}}get durations(){return nw(this.sampleDurations)}get sortedDurations(){return Object.keys(this.sampleDurations).sort((e,t)=>this.sampleDurations[t]-this.sampleDurations[e])}get durationRatios(){let e={},t=0;for(let e in this.sampleDurations)t+=this.sampleDurations[e];for(let i in this.sampleDurations)e[i]=nB(this.sampleDurations[i]/t*100,2);return e}get changeCount(){return this.sampleChangeCount}captureSample(e){this.sampleDurations[e]||(this.sampleDurations[e]=0),this.sampleDurations[e]++,e!==this.lastSample&&(this.sampleChangeCount++,this.lastSample=e)}},Sj=class{constructor(){this.sampleDurations={}}get keys(){return Object.keys(this.sampleDurations)}get durations(){let e=nw(this.sampleDurations);if(this.currentSample&&this.startTimestamp){let t=Date.now()-this.startTimestamp;e[this.currentSample]+=t}return e}get durationRatios(){let e={},t=this.durations,i=0;for(let e in t)i+=t[e];for(let n in t)e[n]=nB(t[n]/i*100,2);return e}captureSample(e){let t=Date.now();if(this.currentSample&&this.startTimestamp){let e=t-this.startTimestamp;this.sampleDurations[this.currentSample]+=e}this.currentSample=e,this.startTimestamp=t,this.sampleDurations[e]||(this.sampleDurations[e]=0)}},Sq=class{constructor(e,t){this.validTimeBetweenFramesArrival=e,this.invalidFPSAboveMax=t,this.lastSampleTimestamp=-1,this.fpsHarmonicSumWeigtsTs=0,this.fpsHarmonicWeigtedSumsFramePerDelayTs=0}captureSample(e){let t=Date.now();if(e>0&&this.lastSampleTimestamp>0){let i=t-this.lastSampleTimestamp;if(this.lastSampleTimestamp=t,i<0||i>this.validTimeBetweenFramesArrival||e>this.invalidFPSAboveMax)return;let n=i/e;this.fpsHarmonicSumWeigtsTs+=i,this.fpsHarmonicWeigtedSumsFramePerDelayTs+=i*n}(this.lastSampleTimestamp<0||0===e)&&(this.lastSampleTimestamp=t)}get harmonicMean(){return this.fpsHarmonicWeigtedSumsFramePerDelayTs>0?1e3*this.fpsHarmonicSumWeigtsTs/this.fpsHarmonicWeigtedSumsFramePerDelayTs:0}},SW=class{constructor(e){this.samplesNum=e,this.samples=[],this.sortedSamples=[],this.lastReport={avg:-1,max:-1,median:-1,p90:-1,volatilityPercent:-1}}isReportComplete(){return this.samples.length===this.samplesNum}getReport(){return this.lastReport}captureSample(e){void 0===e||e<0||(tq(this.samples,e,this.samplesNum),this.sortedSamples=nw(this.samples).sort((e,t)=>e-t),this.lastReport={avg:this.getAvg(),median:this.calculatePercentile(50),p90:this.calculatePercentile(90),max:this.calculatePercentile(100),volatilityPercent:this.getVolatility()})}getAvg(){return nv(this.samples)}getVolatility(){let e=this.getAvg();if(0===e)return 0;let t=0;return this.samples.forEach(i=>{t+=Math.abs(i-e)}),nB(t/this.samples.length*100/e,2)}calculatePercentile(e){if(e<0||e>100)throw Error("Percentile must be between 0 and 100");let t=e/100*(this.sortedSamples.length-1),i=Math.floor(t),n=Math.ceil(t),r=t-i;return n>=this.sortedSamples.length?this.sortedSamples[i]:this.sortedSamples[i]*(1-r)+this.sortedSamples[n]*r}},SG=class{constructor(){this.duration=0,this.reportAggr={avg:0,max:0,median:0,p90:0,volatilityPercent:0}}captureSample(e){e&&!(e.avg<0)&&(this.reportAggr={avg:this.reportAggr.avg+e.avg,max:Math.max(this.reportAggr.max,e.max),median:this.reportAggr.median+e.median,p90:this.reportAggr.p90+e.p90,volatilityPercent:this.reportAggr.volatilityPercent+e.volatilityPercent},this.duration++)}getReport(){if(0!==this.duration)return{avg:this.reportAggr.avg/this.duration,max:this.reportAggr.max,median:this.reportAggr.median/this.duration,p90:this.reportAggr.p90/this.duration,volatilityPercent:this.reportAggr.volatilityPercent/this.duration}}},Sz=class{constructor(e,t=0){this.overshootType=e,this.allowedOvershoot=t,this.past=[],this.totalOvershootDuration=0,this.lastAllowed=0}get isOvershooting(){return!!this.current}get events(){return this.current?[...this.past,this.current]:this.past}get totalDuration(){return this.totalOvershootDuration}captureSample(e,t){let i=nB(e-t);i>this.allowedOvershoot&&(0===this.lastAllowed||t===this.lastAllowed||!this.current&&t>this.lastAllowed)?(this.totalOvershootDuration++,this.current?(this.current.min=Math.min(this.current.min,i),this.current.max=Math.max(this.current.max,i)):this.current={timestamp:Date.now(),min:i,max:i,type:this.overshootType}):this.current&&(this.current.duration=Date.now()-this.current.timestamp,this.past.push(this.current),this.current=void 0),this.lastAllowed=t}},SJ=class{constructor(e=!1){this.disableNormalization=e,this.prevLost=0,this.prevReceived=0,this.minPackets=100}calculate(e,t){if(void 0===e||void 0===t)return;let i=e-this.prevReceived,n=t-this.prevLost;if(i+n<this.minPackets)return;this.prevReceived=e,this.prevLost=t;let r=n*(this.disableNormalization?1:this.minPackets)/(n+i);return r>(this.disableNormalization?1:this.minPackets)?0:r}},SK=class{constructor(){this.capturedSamples=[]}captureSample(e){e&&this.capturedSamples.push(e)}calculateStd(){if(!this.capturedSamples.length)return;let e=this.capturedSamples.reduce((e,t)=>e+t,0)/this.capturedSamples.length,t=this.capturedSamples.map(t=>(t-e)**2);return nB(Math.sqrt(t.reduce((e,t)=>e+t,0)/t.length),2)}getFirst(){return this.capturedSamples[0]}getLast(){if(this.capturedSamples.length)return this.capturedSamples[this.capturedSamples.length-1]}calculatePercentile(e){if(!this.capturedSamples.length)return;let t=this.capturedSamples.sort((e,t)=>e-t),i=(t.length-1)*e,n=Math.floor(i),r=i-n;return void 0!==t[n+1]?t[n]+r*(t[n+1]-t[n]):t[n]}};function SQ(e){if(!e)return;let t=!0;for(let i of["libvpx","ffmpeg"])if(e.toLowerCase().includes(i)){t=!1;break}return t}var SY=class{constructor(e){this.samplesCount=e,this.capturedSamples=[]}captureSample(e){void 0!==e&&tq(this.capturedSamples,e,this.samplesCount)}getRate(){if(!this.capturedSamples.length)return;let e=this.samplesCount/this.capturedSamples.length;return this.capturedSamples.reduce((e,t)=>e+t)*e/this.samplesCount}},SZ=class{constructor(e=5){this.limit=e,this.curWidth=0,this.curHeight=0,this.resolutionSwitches=[]}captureSample(e,t){(e!==this.curWidth||t!==this.curHeight)&&(tq(this.resolutionSwitches,`${e}x${t}`,this.limit),this.curWidth=e,this.curHeight=t)}get switches(){if(this.resolutionSwitches.length)return this.resolutionSwitches}};function SX(e,t,i){return e&&t?Math.ceil(e/nu.MACROBLOCK_SIZE)*Math.ceil(t/nu.MACROBLOCK_SIZE)*i:0}var S0=class{constructor(){this.macroblockRateAveragerReceived=new SL,this.macroblockRateAveragerDecoded=new SL,this.maxDecoderLoss=0,this.decoderLoss=0}captureSample(e,t){this.macroblockRateAveragerReceived.captureSample(e),this.macroblockRateAveragerDecoded.captureSample(t);let i=this.maxDecoderLoss;e&&(i=(e-t)/e*100),this.decoderLoss=i,this.maxDecoderLoss=Math.max(i,this.maxDecoderLoss)}getReport(){return{macroblockRateReceivedMax:this.macroblockRateAveragerReceived.maxSample,macroblockRateReceivedAvg:this.macroblockRateAveragerReceived.avg,macroblockRateDecodedMax:this.macroblockRateAveragerDecoded.maxSample,macroblockRateDecodedAvg:this.macroblockRateAveragerDecoded.avg,macroblockRateMaxDecoderLossPercent:Math.floor(this.maxDecoderLoss),macroblockRateDecoderLossPercent:Math.floor(this.decoderLoss)}}},S1=class{constructor(){this.codecReport={}}captureSample(e,t){var i,n;let r=e.split("/").pop();if(void 0===this.activeMsi||this.activeMsi!==t){this.activeMsi=t,this.previousCodec=r,(i=this.codecReport)[t]??(i[t]={[r]:1,codecSwitchCounter:0});return}if(this.previousCodec!==r){(n=this.codecReport[t])[r]??(n[r]=0),this.codecReport[t][r]++,this.codecReport[t].codecSwitchCounter++,this.previousCodec=r;return}this.codecReport[t][r]++}get report(){return this.codecReport}},S2=class{constructor(e){this.maxEvents=e,this.events=[]}captureSample(e){if(this.lastEvent?.reason===e)return;this.lastEvent&&(this.lastEvent.duration=Date.now()-this.lastEvent.timestamp);let t={reason:e,timestamp:Date.now()};tq(this.events,t,this.maxEvents),this.lastEvent=t}getReport(){return this.events}},S3=class{constructor(e=5){this.limit=e,this.curPowerEfficientCodecState=!1,this.powerEfficientCodecEvents=[],this.powerEfficientCodecEventOnCount=0,this.powerEfficientCodecEventOffCount=0,this.powerEfficientCodecEventMismatchCount=0}captureSample(e){let{frameHeight:t,rid:i,encoderImplementation:n,powerEfficientEncoder:r}=e,s=n&&S4(n,i).endsWith(":HW");if(s!==this.curPowerEfficientCodecState){let e={timestamp:Date.now(),powerEfficient:s,frameHeight:t};tq(this.powerEfficientCodecEvents,e,this.limit),this.curPowerEfficientCodecState=s,s?this.powerEfficientCodecEventOnCount++:this.powerEfficientCodecEventOffCount++}!r&&s&&this.powerEfficientCodecEventMismatchCount++}get events(){if(this.powerEfficientCodecEvents.length)return this.powerEfficientCodecEvents}get eventOnCount(){return this.powerEfficientCodecEventOnCount}get eventOffCount(){return this.powerEfficientCodecEventOffCount}get eventMismatchCount(){return this.powerEfficientCodecEventMismatchCount}get curPowerEfficientEncoderState(){return this.curPowerEfficientCodecState}};function S4(e,t){if(e.startsWith("SimulcastEncoderAdapter")){let i=e.indexOf("(")+1,n={},r=e.indexOf(")");e.substring(i,r).split(",").forEach((e,t)=>{n[`${t+1}`]=e.trim()}),e=n[t]??"Unknown"}switch(e){case"OpenH264":return"H264:SW";case"ExternalEncoder":case"MediaFoundationVideoEncodeAccelerator":case"VideoToolbox":case"WMFVideoEncoder":case"VTVideoEncoder":case"VaapiVideoEncodeAccelerator":return"H264:HW";default:return"H264:Other"}}var S5=class extends tZ{constructor(e,t){super(),this.logger=e,this.configProvider=t,this.isEnabled=!1,this.isMuted=!1,this.isWatching=!1,this.streamsNumber=1,this.isEnabled=!!this.configProvider.config.watchdog?.enabled,this.logger.info(`ModalityWatchdog initialized with enabled: ${this.isEnabled}`)}setIntendedMuteState(e,t){this.isEnabled&&(this.isMuted=e,this.isMuted&&this.canWatch()?this.startWatching(t,"MuteStateChanged"):this.stopWatching("MuteStateChanged"))}processReport(e){let t;if(this.isEnabled&&this.isWatching){for(let i of Object.values(e.codec))i.mimeType.includes("audio")&&(t=i.mimeType.split("/").pop());for(let i of Object.values(e["outbound-rtp"]))if("audio"===i.mediaType){this.packetsCalculator.captureSample(i.packetsSent,i.timestamp),this.bytesCalculator.captureSample(i.bytesSent,i.timestamp);let e=this.packetsCalculator.delta&&this.packetsCalculator.delta>this.configProvider.config.watchdog.maxPacketsDiff,n=this.bytesCalculator.delta&&this.bytesCalculator.delta>this.configProvider.config.watchdog.maxBytesDiff;if(e&&n){let e={modality:"audio",codec:t,diffPackets:this.packetsCalculator.delta,diffBytes:this.bytesCalculator.delta,timestamp:i.timestamp};this.logger.warn(`Audio leak detected. While muted sending ${this.packetsCalculator.delta} packets and ${this.bytesCalculator.delta} bytes`),this.registerTelemetryEvent(e),this.event("audioLeakDetected").raise(this.currentCauseId,this.packetsCalculator.delta,this.bytesCalculator.delta)}}}}setTelemetryEventReporter(e){this.registerTelemetryEvent=e}updateNumberOfStreams(e){if(this.isEnabled&&this.streamsNumber!==e){if(this.logger.info(`updateNumberOfStreams: streamsNumber changed from ${this.streamsNumber} to ${e}`),this.streamsNumber=e,!this.isMuted||!this.canWatch())return void this.stopWatching("SystemAudioSharing");this.startWatching(this.currentCauseId,"SystemAudioSharing")}}canWatch(){return 1===this.streamsNumber}startWatching(e,t){this.isWatching||(this.logger.info(`started watching, reason ${t}`),this.isWatching=!0,this.currentCauseId=e,this.packetsCalculator=new S$,this.bytesCalculator=new S$)}stopWatching(e){this.isWatching&&(this.logger.info(`stopped watching, reason ${e}`),this.isWatching=!1,this.packetsCalculator=null,this.bytesCalculator=null)}},S6=[1,2,9,10,11,12,30,27,28],S8="remote",S9="remote",S7=class extends tZ{constructor(e,t){super(),this.isStreaming=e,this.mediaType=t}},ye=class e extends tZ{constructor(t,i,n,r,s,a,o,l,c,d,u,h,g,p,f,m,v,S){super(n),this.signalingAgent=t,this.mediaAgent=i,this.logger=n,this.telemetryLoggers=r,this.currentUserSkypeIdentity=s,this.groupId=a,this.threadId=o,this.ecsProvider=d,this.trouterService=u,this.accountConfiguration=h,this.vdi3=S,this.participants=[],this.isServerMuted=!1,this.isSpeakerMuted=!1,this.isVideoOn=!1,this.isScreenSharingOn=!1,this.callStartedAt=null,this.callHeldAt=null,this.conversationStartTime=null,this.callType=-1,this.failureType=2,this.isEmergency=!1,this.contentSharingSessions=[],this.endpoints={endpointDetails:[]},this.isPreheatEnabled=!1,this.localMediaStreams=[],this.enableRealtimeTelemetry=!1,this.isSharedLineAppearanceV2Activated=!1,this.enableCaptcha=!1,this.requestedHoldState=!1,this.mediaStateConfigurationHelper=new p3({mediaStates:[pZ(0,4)]}),this.canToggleAudio=!0,this.canToggleVideo=!0,this.connectCallPromise=Promise.resolve(),this.canToggleScreenSharing=!0,this.callUsesMixer=!1,this.isEscalationInProgress=!1,this.retryOutgoingRenegotiation={retry:!1,causeId:""},this.isHoldInProgress=!1,this.isMuteOnHold=!1,this.callSetupFailed=!1,this.isSomeoneSharing=!1,this.isSomeoneStreamingVideo=!1,this.activeTalkersHistory=[],this.callGotConnected=!1,this.mediaRelayWhiteListingIssue=!1,this.signalingSessionCallOptions=null,this.tsCallingTelemetryReported=!1,this.isCallSetupTelemetrySent=!1,this._isAudioStreamConnected=!1,this._wasAudioStreamConnected=!1,this._callInLobby=!1,this._callIsSetupComplete=!1,this._transferState=0,this._parkState=0,this._muteState=0,this._callCreationTime=new Date().getTime(),this._commandUrlPresence=0,this._capabilities={canMuteOthers:!1,canUnmuteSelf:!1},this._spamRiskLevel=null,this._spamStirAttestation=null,this._callMode=0,this._isUpdatePropertiesSpecifiedAllowedByEcs=!1,this._deferUsingMicrotask=!1,this._enableResolveScreenSharingWhenNegotiationComplete=!1,this._publishedStatesModified=0,this._participantPublishedStatesMap={},this._endpointPublishedStatesMap={},this._participantChangedEventSkipConfig={skipParticipantsUpdatesOnCall:!0},this._dominantSpeakerChangedEventSkipConfig={skipDominantSpeakerUpdatesOnCall:!0},this.receiveOnlyAudioOnCallStart=!1,this.lastContributingSourceReport=Date.now(),this.instanceNumber=e.instanceCount++%1e3,this._enableMuteAsync=!1,this._enableUnmuteAsync=!1,this._enableEndpointMeetingRoleCheckForClientCapability=!1,this._enableUserMeetingRolesCheckForClientCapability=!1,this._enableAddModalityGeneric=!1,this._delayedElevationPending=!1,this._delayedElevationQueued=!1,this.maxVbssChannels=0,this.startVM=(e,t,i,n,r)=>this.signalingSession.startOutgoingCall(i,n,{voicemailResourcePath:t.callVoicemailStartOptions.voicemailResourcePath,voicemailItemId:t.callVoicemailStartOptions.voicemailItemId,callToVoicemail:!0},Date.now()-r,e),this.getSignalingSessionCallOptions=e=>{let t={suppressDialout:!e.callStartOptions.ringOthers,isPreheatOnly:(1&e.callStartOptions.preheatFlags)==1,onBehalfOf:this.onBehalfOfMri,onBehalfOfUserDisplayName:this.onBehalfOfUserDisplayName,callQueueContext:e.callStartOptions?.callQueueContext,muted:(1&e.callStartOptions.muteFlags)==1,invitationType:e.invitationType,participantsToNudge:e.participantsToNudge,routingFlags:e.callStartOptions&&e.callStartOptions.routingFlags,parkContext:e.parkContext,pickupCode:e.pickupCode,scenario:e.callStartOptions&&e.callStartOptions.scenario,callUsesMixer:this.callUsesMixer,clientEndpointCapabilities:e.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:e.callStartOptions.clientEndpointDebugContent,isEmergency:this.isEmergency,meetingData:this.meetingData,meetingPreferences:e.meetingPreferences,alternateId:e.callStartOptions?e.callStartOptions.alternateId:null,meetingRegistrationId:e.callStartOptions?e.callStartOptions.meetingRegistrationId:"",participantPin:e.callStartOptions?e.callStartOptions.participantPin:"",additionalEndpointProperties:e.callStartOptions?.additionalEndpointProperties||null,publishedStates:e.callStartOptions?.publishedStates||null,targetApplicationType:e.callStartOptions?.targetApplicationType,isHuddleGroupCall:e.callStartOptions?.isHuddleGroupCall,captchaContentJson:e.callStartOptions?.captchaContentJson,customHeaderContext:e.callStartOptions?.customHeaderContext,participationPreferences:e.callStartOptions?.participationPreferences,callingLineIdentity:e.callStartOptions?e.callStartOptions.callingLineIdentity:null,participantPropertyBag:e.callStartOptions?e.callStartOptions.participantPropertyBag:null},i=e.callStartOptions?.invitationDataJson;if(i)try{t.invitationData=JSON.parse(i)}catch(e){throw Error(`Invalid JSON in invitationData: ${i}`)}return t},this.startOutgoingCall=(e,t,i,n,r)=>this.signalingSession.startOutgoingCall(i,n,this.getSignalingSessionCallOptions(t),Date.now()-r,e),this.joinGivenConversation=(e,t,i,n,r,s)=>{let a=(1&t.callStartOptions.muteFlags)==1,o=(1&t.callStartOptions.preheatFlags)==1,l=t.callStartOptions?.invitationDataJson,c=t.callStartOptions?.sharedLineCallInvitationContentJson;this.logger.info(`[${e}][joinGivenConversation] muted=${a}, isPreheatOnly=${o},
            sharedLineCallInvitationContentJson=${c}, invitationDataJson=${l},
            captchaContentJson=${!!t?.callStartOptions?.captchaContentJson}`);let d={muted:a,isPreheatOnly:o,clientEndpointCapabilities:t.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:t.callStartOptions.clientEndpointDebugContent,isEmergency:this.isEmergency,meetingData:this.meetingData,meetingPreferences:t.meetingPreferences,meetingRegistrationId:t.callStartOptions?t.callStartOptions.meetingRegistrationId:"",participantPin:t.callStartOptions?t.callStartOptions.participantPin:"",additionalEndpointProperties:t?.callStartOptions?.additionalEndpointProperties,applyServerMute:t?.applyServerMute,publishedStates:t?.callStartOptions.publishedStates,invitationData:t?.callStartOptions.invitationDataJson,captchaContentJson:t?.callStartOptions.captchaContentJson,callQueueContext:t?.callStartOptions.callQueueContext,participationPreferences:t?.callStartOptions.participationPreferences,participantPropertyBag:t?.callStartOptions.participantPropertyBag};if(c)try{d.sharedLineCallInvitationContent=JSON.parse(c)}catch(e){throw Error(`Invalid JSON in sharedLineCallInvitationContent: ${c}`)}if(l)try{d.invitationData=JSON.parse(l)}catch(e){throw Error(`Invalid JSON in invitationDataJson: ${l}`)}return this.signalingSession.joinGivenConversation(s,this.callId,i,n,Date.now()-r,d,e,this.shouldSkipOfferGenerationForStreamingUser(t.isPromotingToRealtime))},this.setInitialJoinOrStartTelemetry=(e,t={},i,n,r)=>{let{callStartOptions:s={}}=t,a=s.muted||(1&s.muteFlags)==1,o=(1&s.preheatFlags)==1,l=this.telemetryDataFromCallStartOptions(s);l&&this.callTelemetry.updateOperationData(e,l,r),this.callTelemetry.setDirection("Outgoing"),o?(this.callTelemetry.setSelfParticipantRole("preheat"),this.callTelemetry.setOperationVariant(e,"Preheat")):this.callTelemetry.setSelfParticipantRole(i),this.signalingSession.setInitialTelemetry(e,{correlationId:this.callId,causeId:r,conversationServiceUrl:n,callOptions:Object.assign(s,{isPreheatOnly:o,muted:a}),offerGenerationTime:Date.now()-t.callStartTime})},this.getParticipantByLegId=(e,t,i)=>{for(let n of(this.logger.info(`getMriByParticipantLegId[${i}] participantLegId ${e}`),t.participants))for(let t of n.endpoints.endpointDetails)if(t&&t.participantId&&t.participantId===e)return n;return null},this.executeCallTransfer=(e,t,i,n)=>{this._setTransferState(1);let r=this._callOperationHandler.createPendingOperation("_CallTransferInProgress",void 0,t,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]});return 0===i?this.signalingSession.transferCallAsync(e,"TransferTypeStandard",void 0,n,t):2===i&&this.signalingSession.transferCallAsync(e,"TransferTypeVoicemail",void 0,n,t),r},this.executeConsultCallTransfer=(e,t,i,n,r)=>{this._setTransferState(1);let s=this._callOperationHandler.createPendingOperation("_CallTransferInProgress",void 0,n,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]});return this.signalingSession.consultTransferCallAsync(e,t,i,n,r),s},this.createUpdateParticipantPromise=(e,t)=>this._callOperationHandler.createPendingOperation("UpdateParticipantsProperties",e,t),this._getCallEndOperation=()=>this._callOperationHandler.hasPendingOperation("StopCall")?this._callOperationHandler.waitForOperation("StopCall"):this._callOperationHandler.hasPendingOperation("Reject")?this._callOperationHandler.waitForOperation("Reject"):this._callOperationHandler.hasPendingOperation("CallRedirect")?this._callOperationHandler.waitForOperation("CallRedirect"):Promise.resolve(),this._onAcknowledgeError=(e,t,i,n)=>{let r;i.logFailure(e);let s={code:2,success:!1,fatal:!0},a=7;throw pI("SendAttach",e)&&(r={code:oe,subCode:ob,phrase:oJ}),pI("ProcessIncomingCallRequest",e)&&(r={code:a4,subCode:oC,phrase:oK},s={code:0,success:!1,fatal:!0}),p_(o4,e)&&(a=47),e?.error&&e.error.type===this.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer&&(r={code:a5,subCode:op,phrase:oG}),this.callTelemetry.updateOperationData("Acknowledge",{phases:n,error:tT(e)},t),this._callOperationHandler.maybeRejectOperation("Acknowledge",s,void 0,t),this.stopInternal({rejectReason:r,causeId:t,terminatedReason:a}),s},this._onAcknowledgeSuccess=(e,t,i)=>(e.logSuccess("success"),this.callTelemetry.updateOperationData("Acknowledge",{phases:t},i),{code:1,success:!0}),this._processOfferedModalities=(e,t)=>{this.handleOfferedModalities(e,t);let i=this.callUsesMixer?void 0:{modalityOverride:e};return this.updateMediaModalities(i,t)},this._handleOfferProcessingError=(e,t,i)=>(i.logFailure(`handleOfferProcessingError=${e}`),e?.error?.type!==this.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer)?Promise.reject(e):(this.callTelemetry.recordEvent("IncompatibleOffer",{message:t_(e?.error?.detail)},t),this.signalingSession.supportsNewOfferRequest())?(this.newOfferRequestDeferred=new iE,this.attachToCallAndGetOffer.promise.then(()=>this.mediaSession.rejectNegotiationAsync(e.error,t)).then(()=>this.signalingSession.requestNewOffer(this.mediaSession.getAcceptedTypes(),t)).then(()=>this.newOfferRequestDeferred.promise).then(e=>this.mediaSession.processOfferAsync(e,t)).catch(e=>(this.callTelemetry.recordEvent("NewOfferFailed",t_(e),t),Promise.reject(e)))):Promise.reject(e),this._trySendProvisionalMediaAnswer=e=>Promise.resolve(void 0).then(()=>this.mediaSession.createAnswerAsync(!0,e)).then(e=>e.blob?(this.mediaAcknowledgmentOperation=this._callOperationHandler.createPendingOperation("_MediaAcknowledgment",void 0,e9(),{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),this.signalingSession.setProvisionalAnswerAsync(e).then(()=>this.mediaAcknowledgmentOperation)):Promise.resolve(void 0)),this.checkForCallIdUpdate=(e,t)=>{if(this.callId!==e){this.logger.info(`[${t}][checkForCallIdUpdate] old=${this.callId}, new=${e}`),this.setCallId(e);try{this.event("callIdChanged").raise(this.callId)}catch(e){this.logger.error(`Error raising call ID change: ${e}`)}this.raiseChanged()}},this.handleRemoteParticipantStateInOneToOneCall=e=>{if(!this.callUsesMixer&&3===this.state){let t=this.participants[0];t&&t.setState(3,void 0,e)}},this.handleRemoteParticipantJoinedInOneToOneCall=(e,t)=>{if(!this.callUsesMixer&&3===this.state){let i=this.participants.filter(t=>t.id===e.id)[0];i?i.setState(3,void 0,t):this.logger.logFailure(`[${t}][handleRemoteParticipantJoinedInOneToOneCall]unable to find particpant ${ta(e.id)}`)}},this.handleRemoteParticipantStateInObservingCall=(e,t,i)=>{let n=t.isLobby;if(8===this.state){let t=n?7:3;e.setState(t,void 0,i)}},this.getTelemetryFromPhaseExecution=e=>{let t={phase:e.phase,phases:e.phases,code:e.error&&e.error.code,subCode:e.error&&e.error.subCode,message:e.error&&e.error.message,error:e.error};return(t.code||t.message)&&delete t.error,t},this._setTransferState=e=>{this.transferState!==e&&(this.logger.info(`Transfer: state set: ${e}`),this._transferState=e,this.callTelemetry.recordEvent("_SetTransferState",{state:e}),this.raiseChanged())},this._setParkState=e=>{this.parkState!==e&&(this.logger.info(`Parking: state set: ${e}`),this._parkState=e,this.callTelemetry.recordEvent("_SetParkState",{state:e}),this.raiseChanged())},this.prepareNegotiationResultForTelemtry=e=>({isComplete:e.isComplete,activeModalities:e.activeModalities,configuredModalities:e.configuredModalities,initiator:ta(e.initiator),attemptedModalities:e.attemptedModalities,offeredModalities:e.offeredModalities}),this.prepareTelemetryForOfferAnswer=e=>e&&e.mediaContent&&{isRenegotiation:!!e.renegotiation,isEscalation:!!e.mediaContent.isTwoPartyToMultiPartyEscalation,mediaTypes:e.mediaTypes,newOffer:e.mediaContent.newOffer},this.updateLocalParticipantEndpoints=e=>{let t=this.logger.createFnLogger("updateLocalParticipantEndpoints",""),i=[];(0,o5.forEach)(e,e=>{let t=pK(e,this.getSelfClientEndpointCapabilities());i.push(t)}),this.endpoints.endpointDetails=i;let n=this.getDataChannelSourceId();-1!==n&&this.dataChannel&&this.dataChannel.setDataChannelSourceId(n),t.info(`selfEndpointDetails=${tN(this.endpoints)}`)},this.handleParticipantsMutedUpdated=(e,t)=>{let i=this.logger.createFnLogger("handleParticipantsMutedUpdated",t);if(e?.info===void 0)return void i.info("Ignored, no mute participant info.");for(let t of(this.logger.info(`handleParticipantsMutedUpdated: number of infos: ${Object.keys(e.info).length}`),Object.keys(e.info))){let n=this.getParticipant(t);n?n.handleServerMutedInfoUpdate(e.info[t]):i.info(`Cannot find local participant ${ta(t)}`)}},this.handleSelfUnmuteUpdatedInfo=(e,t)=>{let i=this.logger.createFnLogger("handleSelfUnmuteUpdatedInfo",t);if(e?.info===void 0)return void i.info("Ignored, no unmute participant info.");for(let n of Object.keys(e.info)){let r=e.info[n];if(n===this.localSignalingParticipant.id){let e=(0,o5.find)(r,e=>e.participantId===this.localSignalingParticipant.participantId);if(void 0===e){i.info(`Cannot find local participant ${ta(n)}`);continue}let s=(0,o5.find)(this.localSignalingParticipant.endpointDetails,t=>t.participantId===e.participantId);fr(this.logger,s,e,!1)&&this.handleSelfServerMutedState(t)}}},this.state=0,this.terminatedReason=0,this.callStats=new pG,this.callDeviceManager=this.createCallDeviceManager(),this.callTelemetry=new aa(this.logger,this._callCreationTime),this.collectMediaStatsDeferred=new iE,this.setCallId(l),this.setGroupId(a),this.setThreadId(o),this.setMessageId(g),this.setSkypeId(this.currentUserSkypeIdentity.id),this.setParticipantId(c),this.setCallOrigin(0),this.vdi3&&this.callStats.setVDI3SessionChannelId(this.vdi3.sessionChannelId),this.logger=this.logger.createChild(()=>{let e=(this.endpointId||"").substr(0,8),t=(this.participantId||"").substr(0,8);return`Web/${this.instanceNumber}[${this.callId}][${e}][${t}][${this.state}]`}),this._enableMuteAsync=this.ecsProvider.getEcsConfig("SkypeCalling","enableAsyncMute"),this._enableUnmuteAsync=this.ecsProvider.getEcsConfig("SkypeCalling","enableAsyncUnmute"),this._enableEndpointMeetingRoleCheckForClientCapability=this.ecsProvider.getEcsConfig("SkypeCalling","enableEndpointMeetingRoleCheckForClientCapability"),this._enableUserMeetingRolesCheckForClientCapability=this.ecsProvider.getEcsConfig("SkypeCalling","enableUserMeetingRolesCheckForClientCapability"),this._enableAddModalityGeneric=this.ecsProvider.getEcsConfig("SkypeCalling","enableAddModalityGeneric"),this.initializeSignalingSession(c),this.signalingSession.setLocationInfo(p,f,v),this.streamManager=new fq(this.participantId,null,this.callStats.localStats,this.logger),this.mediaAgent&&(this.dataChannel=new f7(this.logger),this.dataChannel.on("remoteUserEventsReceived",(e,t)=>this.event("remoteUserEventsReceived").raise(e,t)),this.dataChannel.on("onDataChannelStateUpdated",e=>{"Failed"===e&&(this.logger.error("onDataChannelStateUpdated: datachannel creation failed, will remove data modality"),this.mediaStateConfigurationHelper.removeModality(3),this.updateSignalingDSHMessageSubscription(!0),this.updateMediaModalities())}),this.screenSharingControl=new mB(this.logger,this.dataChannel,this,this.telemetryLoggers,this.ecsProvider,this.mediaAgent.getConfigProvider()),this.mediaAgent.handleSendMidCallTelemetry(this.sendMidCallTelemetry.bind(this)),this.remoteUFDHandler=this.mediaAgent.getConfigProvider().config.remoteUFD?.remoteUFDHandlerV2?new SA(this.logger.createChild("remoteUFDHandlerV2"),this.mediaAgent.getConfigProvider(),this.publishState.bind(this)):new ST(this.logger.createChild("remoteUFDHandler"),this.mediaAgent.getConfigProvider()),this.smallCallTelemetry=new SI(this.mediaAgent.getConfigProvider()),this.smallCallTelemetry.on("sendSmallCallTelemetry",e=>this.reportSmallCallEvent(e)),this.modalityWatchDog=new S5(this.logger.createChild("Watchdog"),this.mediaAgent.getConfigProvider()),this.modalityWatchDog.on("audioLeakDetected",(e,t,i)=>{this.mediaAgent.getConfigProvider().config.watchdog?.stopCallOnAudioLeak&&this.stop(!1,e,void 0,{clientSubCode:af,clientPhrase:`Audio leak from watchdog. While muted sending ${t} packets and ${i} bytes`})}));let y={enableErrorConversion:this.ecsProvider.getEcsConfig("SkypeCalling","enableErrorConversion")};this._deferUsingMicrotask=this.ecsProvider.getEcsConfig("SkypeCalling","deferUsingMicrotask"),fp.instance.setDeferToQueueMicrotask(this._deferUsingMicrotask),fp.instance.setLogger(n),this.logger.info(`operationHandlerEcsConfig: ${JSON.stringify(y)}`),this._preferredMpLocation=this.ecsProvider.getEcsConfig("SkypeCalling","preferredMpLocation"),this.logger.debug(`preferredMpLocation: ${this._preferredMpLocation}`),this._isUpdatePropertiesSpecifiedAllowedByEcs=this.ecsProvider.getEcsConfig("SkypeCalling","enableUpdateParticipantsSpecified"),this._enableResolveScreenSharingWhenNegotiationComplete=this.ecsProvider.getEcsConfig("SkypeCalling","enableResolveScreenSharingWhenNegotiationComplete"),this._callOperationHandler=new aQ(this.logger,this.callTelemetry,y,void 0,(e,t)=>{this.preconditions(e,t)}),this._participantOperationHandler=new aQ(this.logger,this.callTelemetry,y),this.setMeetingData(m),this.initializeLiveStreamConfigProvider()}get callMode(){return this._callMode}get callId(){return this._callId}get endpointId(){return this._endpointId}get isHostless(){return this.signalingSession.isHostLessCall}get transferState(){return this._transferState}get parkState(){return this._parkState}get capabilities(){return this._capabilities}get publishedStates(){return this._publishedStates}get dataChannelAdapter(){return this.dataChannel}get participantId(){try{let e=this.signalingSession?.participantManager?.localParticipant?.participantId;this._participantId=e||this._participantId}catch(e){this.logger.error("Error updating participantId")}return this._participantId}get displayName(){return this.localSignalingParticipant.displayName}get role(){return this.localSignalingParticipant.role}get meetingRole(){return this.localSignalingParticipant.meetingRole}get advancedMeetingRole(){return this.localSignalingParticipant.advancedMeetingRole}get meetingRoles(){return this.localSignalingParticipant.meetingRoles}get maskedIdentityDetails(){return{isIdentityMasked:this.localSignalingParticipant.isIdentityMasked,maskedIdSeqNumber:this.localSignalingParticipant.maskedIdSeqNumber,maskedId:this.localSignalingParticipant.maskedId}}get participantType(){return this.localSignalingParticipant.participantType}get isMuted(){return 2===this._muteState||3===this._muteState}get tenantId(){return this.localSignalingParticipant.tenantId}get mediaLegId(){return this._mediaLegId}get isIncomingOneOnOneVideoCall(){return this.isOneToOneCall()&&this.isSomeoneStreamingVideo}get mediaStreams(){return this.streamManager.streams}get origin(){return this._origin}get propertyBag(){return this.localSignalingParticipant.propertyBag}get version(){return this.localSignalingParticipant.version}get isAudioStreamConnected(){return this._isAudioStreamConnected}set isAudioStreamConnected(e){this._isAudioStreamConnected!==e&&(this._isAudioStreamConnected=e,this._wasAudioStreamConnected=this._wasAudioStreamConnected||e,this.raiseChanged())}setMeetingRole(e){e!==this.localSignalingParticipant.meetingRole&&(this.logger.info(`changing self role to [${e}]`),this.localSignalingParticipant.meetingRole=e,this.event("meetingRoleUpdated").raise(e))}setAdvancedMeetingRole(e){e!==this.localSignalingParticipant.advancedMeetingRole&&(this.logger.info(`changing self advanced meeting role to [${e}]`),this.localSignalingParticipant.advancedMeetingRole=e,this.event("advancedMeetingRoleUpdated").raise(e))}setMeetingRoles(e){(0,o5.isEqual)(e,this.localSignalingParticipant.meetingRoles)||(this.logger.info(`changing self meeting roles to [${e}]`),this.localSignalingParticipant.meetingRoles=e,this.event("meetingRolesUpdated").raise(e))}setParticipantType(e){e!==this.localSignalingParticipant.participantType&&(this.logger.info(`changing self participant user type to [${e}]`),this.localSignalingParticipant.participantType=e,this.event("participantTypeUpdated").raise(e))}setPropertyBag(e){e&&!(0,o5.isEqual)(e,this.localSignalingParticipant.propertyBag)&&(this.logger.info(`changing self participant property bag to [${e}]`),this.localSignalingParticipant.propertyBag=e,this.event("propertyBagUpdated").raise(e))}setPropertyRosterVersion(e){e!==this.localSignalingParticipant.version&&(this.logger.info(`changing self participant property version to [${e}]`),this.localSignalingParticipant.version=e,this.event("propertyRosterVersionUpdated").raise(e))}setMaskedIdentityDetails(e=!1,t,i){(this.localSignalingParticipant.isIdentityMasked!==e||this.localSignalingParticipant.maskedIdSeqNumber!==t||this.localSignalingParticipant.maskedId!==i)&&(this.localSignalingParticipant.isIdentityMasked=e,this.localSignalingParticipant.maskedIdSeqNumber=t,this.localSignalingParticipant.maskedId=i,this.logger.info(`self participant masked identity details updated to [${JSON.stringify(this.maskedIdentityDetails)}]`),this.event("maskedIdentityDetailsUpdated").raise(this.maskedIdentityDetails))}setIsSomeoneStreamingVideo(e){this.logger.debug(`setting isSomeoneStreamingVideo to [${e}]`),this.isSomeoneStreamingVideo=e}setJoinAsStreamingUser(e){e!==this.joinAsStreamingUser&&(this.logger.info(`setting self join as streaming user to [${e}]`),this.joinAsStreamingUser=e)}setOtpIdentity(e){e!==this.otpIdentity&&(this.logger.info("setting self participant optIdentity"),this.otpIdentity=e)}get spamRiskLevel(){return this._spamRiskLevel}set spamRiskLevel(e){e&&(this._spamRiskLevel=e)}isMultiVBSSEnabled(){return this.maxVbssChannels>=1}get spamStirAttestation(){return this._spamStirAttestation}set spamStirAttestation(e){e&&(this._spamStirAttestation=e)}getScreenHandle(e){if(!this.sharedScreenHandle){let t=!!this.mediaSession&&this.mediaSession.getSessionConfig().config.enableAudioSharing&&!this.mediaSession.getSessionConfig().config.requireUserActionForAudioSharing,i=this.mediaStateConfigurationHelper.isSending(0)&&t&&!!this.mediaSession,n=e?.getType()===3?e?.getDeviceId():void 0,r=this.callDeviceManager.getDeviceManager(p6(2));r.setAudioSharingRequested(i),this.sharedScreenHandle=r.createDevicesHandle({audio:i,sharing:!0},"pluginlessCall:getScreenHandle()",n),this.sharedScreenHandle.on("onStreamStateChanged",(e,t)=>this.onSharingStreamStateChanged(e))}return this.sharedScreenHandle}setCallOrigin(e){this.logger.info(`Set call origin to ${e}`),this._origin=e,this.callTelemetry.setCallOrigin(e),this.callTelemetry.recordEvent("_SetCallOrigin",{origin:e})}setMediaLegId(e){this._mediaLegId=e,this.callStats.setMediaLegId(e)}setCallId(e){this.callTelemetry.setCallId(e),this.callStats.setCallId(e),this._callId=e}setEndpointId(e){this._endpointId=e,this.logger.info(`[endpointId=${tw(this._endpointId,8)}]`),this.callTelemetry.setEndpointId(e),this.callStats.setEndpointId(e)}setFailureType(e){this.callTelemetry.setFailureType(e),this.failureType=e}setParticipantId(e){this._participantId!==e&&(this._participantId=e,this.logger.info(`[participantId=${this._participantId}]`),this.callTelemetry.setParticipantId(this.participantId),this.event("callLegIdChanged").raise(this.participantId))}setDisplayName(e,t=e9()){this.logger.info(`[${t}][setDisplayName] displayName=${tw(e,4)}`),this.localSignalingParticipant.displayName=e,"anonymous"===this.participantType&&(this.callStats.setDisplayName(e),this.callTelemetry.setDisplayName(e),this.signalingSession.setDisplayName(e))}setCallerMri(e){this.callerMri=e,this.logger.info(`[callerMri=${ta(this.callerMri)}]`)}setDisplayNameSource(e){this.displayNameSource=e,this.logger.info(`[displayNameSource=${this.displayNameSource}]`)}setTransferorMri(e){let t=pT(e);t!==this.transferorMri&&(this.transferorMri=t,this.logger.info(`transferorMri: ${ta(this.transferorMri)}`),this.raiseChanged())}setGroupId(e,t=e9()){this.logger.info(`[${t}][setGroupId] groupId=${ta(e)}`),this.groupId!==e&&(this.groupId=e,this.callTelemetry.setGroupId(e),this.event("groupIdChanged").raise(e))}setMeetingData(e){if(e){if(e.meetingCode&&(!this.meetingData||this.meetingData&&e.meetingCode!==this.meetingData.meetingCode)){let t=e.meetingCode;this.logger.info(`[setMeetingData] meetingCode=${!!t}`),this.callTelemetry.setMeetingCode(t),this.signalingSession.setMeetingCode(t)}if(e.meetingUrl&&(!this.meetingData||this.meetingData&&e.meetingUrl!==this.meetingData.meetingUrl)){let t=e.meetingUrl.split("?")[0];this.logger.info(`[setMeetingData] meetingUrl=${!!e.meetingUrl}`),this.callTelemetry.setMeetingUrl(t),this.signalingSession.setMeetingUrl(t)}}this.meetingData=e}setHuddleGroupCall(e){!!e!==this.isHuddleGroupCall&&(this.logger.info(`[setHuddleGroupCall] new isHuddleGroupCall=${e}`),this.isHuddleGroupCall=e,this.callTelemetry.setIsHuddleGroupCall(!0))}onConversationStartTimeChanged(e,t=e9()){if(this.logger.info(`onConversationStartTimeChanged: Conv start time=${e}`),e&&this._rawConversationStartTime!==e){this.logger.info(`[${t}][onConversationStartTimeChanged] rawConvStartTime=${e}`);try{this.conversationStartTime=new Date(e),this._rawConversationStartTime=e,this.callTelemetry.setConversationStartTime(e)}catch(t){this.logger.warn(`Failed to parse the raw conv start timestamp. Error: ${t}, rawConvStartTime: ${e}`)}}}setComplianceRecordingContent(e,t){try{if(!(0,o5.isEqual)(this.complianceRecordingContent,t)){this.complianceRecordingContent=t;let i=t?JSON.stringify(t):"";this.callTelemetry.setComplianceRecordingContentLength(i.length),this.logger.info(`[${e}][setComplianceRecordingContent] complianceRecordingContentLength=${i.length}`)}}catch(t){this.logger.error(`[${e}][setComplianceRecordingContent] ${t}`)}}setThreadId(e,t=e9()){this.threadId!==e&&(this.logger.info(`[${t}][setThreadId] threadId=${th(e)}`),this.threadId=e,this.callTelemetry.setThreadId(e))}setBackroomThreadId(e,t=e9()){this.backroomThreadId!==e&&(this.logger.info(`[${t}][setBackroomThreadId] backroomThreadId=${th(e)}`),this.backroomThreadId=e,this.callTelemetry.setBackroomThreadId(e))}setStreamThreadId(e,t=e9()){this.streamThreadId!==e&&(this.logger.info(`[${t}][setStreamThreadId] streamThreadId=${th(e)}`),this.streamThreadId=e,this.callTelemetry.setStreamThreadId(e))}setLobbyThreadId(e,t=e9()){this.lobbyThreadId!==e&&(this.logger.info(`[${t}][setLobbyThreadId] lobbyThreadId=${th(e)}`),this.lobbyThreadId=e,this.callTelemetry.setLobbyThreadId(e))}setMeetingLayoutDetails(e,t=e9()){(0,o5.isEqual)(this.meetingLayoutDetails,e)||(this.logger.info(`[${t}][meetingLayoutDetails updated]`),this.meetingLayoutDetails=e,this.event("meetingLayoutChanged").raise(this.meetingLayoutDetails))}setCompositionServiceDetails(e,t=e9()){(0,o5.isEqual)(this.compositionServiceDetails,e)||(this.logger.info(`[${t}][compositionServiceDetails updated]`),this.compositionServiceDetails=e,this.event("compositionServiceDetailsChanged").raise(this.compositionServiceDetails),this.callTelemetry.setCompositionServiceState(e?.state))}setMessageId(e,t=e9()){this.logger.info(`[${t}][setMessageId] messageId=${ta(e)}`),this.messageId=e,this.callTelemetry.setMessageId(e)}setSkypeId(e,t=e9()){this.skypeId!==e&&(this.logger.info(`[${t}][setSkypeId]`),this.skypeId=e,this.callTelemetry.setSkypeId(e))}setCallType(e,t){let i=this.logger.createFnLogger("setCallType",t);if(i.info(`current=${this.callType}, newValue: ${e}`),2===this.callType&&1===e)return void i.logFailure("De-escalating to P2P should not happen!");e!==this.callType&&(this.callType=e,this.callTelemetry.setCallType(e),this.screenSharingControl?.setCallType(e),2===e&&this.callStats.localStats.call.event(2),this.raiseChanged())}setConversationType(e,t){this.logger.createFnLogger("setConversationType",t).info(`current=${this.conversationType}, newValue=${e}`),e!==this.conversationType&&(this.conversationType=e,this.callTelemetry.setConversationType(e),this.raiseChanged())}setCallUsesMixer(e,t){!!e!==this.callUsesMixer&&(this.logger.info(`[${t}][setCallUsesMixer] new value=${e}`),this.callUsesMixer=e,this.callTelemetry.recordEvent("_CallUsesMixer",{newValue:e},t),this.dataChannel.setConfigProviderView(this.mediaSession?.getSessionConfig()))}_setMaxVbssChannels(e,t){this.logger.createFnLogger("MaxVbssChannels",t).info(`current=${this.maxVbssChannels}, newValue=${e}`),e!==this.maxVbssChannels&&(this.maxVbssChannels=e,this.callTelemetry.recordEvent("_setMaxVbssChannels",{MaxVbssChannels:e},t),this.raiseChanged())}setIsEscalationInProgress(e,t){this.logger.info(`[${t}][setIsEscalationInProgress] currentValue=${this.isEscalationInProgress}, newValue=${e}`),this.isEscalationInProgress=e,this.allowScreenSharingControl()&&this.screenSharingControl.setIsEscalationInProgress(e),this.callTelemetry.recordEvent("_EscalationInProgress",void 0,t)}setFromApplicationType(e,t){e&&(this.fromApplicationType=e,this.callTelemetry.recordEvent("_SetFromApplicationType",{fromApplicationType:e},t))}setCalleeAlternateId(e,t){e&&(this.calleeAlternateId=e,this.callTelemetry.recordEvent("_SetCalleeAlternateId",{hasCalleeAlternateId:!!e},t))}setEnableCaptcha(e){e!==this.localSignalingParticipant.enableCaptcha&&(this.logger.info(`setting self participant to enable captcha to [${e}]`),this.localSignalingParticipant.enableCaptcha=e,this.enableCaptcha=e)}processCallStartOptions(e,t){let i=this.logger.createFnLogger("_ProcessCallStartOptions",t);try{1&e.preheatFlags&&(this.isPreheatEnabled=!0)}catch(e){i.logFailure(e)}}getlocalScreenShareStream(){return(0,o5.find)(this.localMediaStreams,e=>2===e.mediaType)}setRoutingTimeout(e){this.routingTimeout=e,this.logger.info(`[routingTimeout=${this.routingTimeout}]`)}setMeetingLayout(e,t){let i=this.logger.createFnLogger("SetMeetingLayout",e);return Promise.resolve().then(()=>this.signalingSession.setMeetingLayoutAsync(e,t)).catch(e=>(i.logFailure(t_(e)),Promise.reject(aG(e)))).then(()=>this._callOperationHandler.waitForOperation("SetMeetingLayout",e)).catch(t=>{throw this.callTelemetry.updateOperationData("AddBroadcastModality",{error:tT(t)},e),i.logFailure(t),t})}async selectDevices(e){if(!this.callDeviceManager.isVirtualDeviceEnabled)return void this.logger.error("allowVirtualDeviceInCall not enabled.");this.callDeviceManager.selectDevices(e)}async getSelectDevices(){return this.callDeviceManager.getSelectedDevices()}createStageAsync(e){throw Error("Method not implemented.")}createStage(e){throw Error("Method not implemented.")}updateDisplayName(e){this.logger.info("updating displayName"),this.setDisplayName(e),this.signalingSession.participantManager.localParticipant.displayName=e}init(e){if(this.logger.info(`init callInitOptions:${tR(e)}`),this.signalingSessionCallOptions={teamsMessageId:e.messageId,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration,meetingInfo:e.meetingInfo,emergencyContent:e.emergencyContent?JSON.parse(e.emergencyContent):void 0,broadcastContext:e.broadcastContext,endpointMetadata:e.endpointMetadata},this.setMessageId(e.messageId),this.onBehalfOfMri=e.onBehalfOf,this.onBehalfOfUserDisplayName=e.onBehalfOfUserDisplayName,e.threadId&&(this.setThreadId(e.threadId),this.signalingSession.setThreadId(e.threadId)),this.groupId&&this.signalingSession.setGroupId(this.groupId),this.signalingSession.setCallOptions(this.signalingSessionCallOptions),e.transferContext){switch(this.logger.info("Transfer: Call.init, set transferContext",fc(e.transferContext)),this.signalingSession.setTransferContext(e.transferContext.context),e.transferContext.transferType){case 1:this.setCallOrigin(2);break;case 0:this.setCallOrigin(1);break;case 2:this.setCallOrigin(3);break;default:throw Error(`TransferType: ${e.transferContext.transferType} doesn't have a switch option`)}e.transferContext.context.callAcceptanceCallback?this._transferredCallAcceptanceCallback=e.transferContext.context.callAcceptanceCallback:this.logger.info("[failed]Transfer: Missing transferred call acceptance callback"),e.transferContext.transferorMri&&this.setTransferorMri(e.transferContext.transferorMri)}this.setIsEmergency(!!e.isEmergency),this.raiseChanged()}async initAsync(e){return this.init(e)}getIncomingRawAudioStream(e=e9()){if(!this.mediaSession)throw this.logger.error("can not execute getIncomingRawAudioStream as there is no mediaSession"),Error("NoMediaSession");return this.mediaSession.getIncomingRawAudioStream(e)}getUnmixedAudioProvider(){return this.unmixedAudioProvider?Promise.resolve(this.unmixedAudioProvider):Promise.reject("No audio provider available")}setDeviceManager(e){}async startVideo(e,t=e9()){return this.startStopVideo(!0,t,e)}async stopVideo(e,t=e9()){return this.startStopVideo(!1,t,e)}async dumpVideoSourceImages(){return Promise.reject(60)}async hold(e,t=e9(),i,n){let r=this.logger.createFnLogger("Hold",t);return(r.info(`[Hold][${t}] negotiationTag ${e} hold options: ${tI(i)}`),4===this.state)?(r.logFailure("Trying to put a call on hold which is already held state, early resolving the promise"),Promise.resolve(void 0)):i?.isLocal?this.localHold(t,i,n):this.holdWithRenegotiate(t,i)}async holdWithRenegotiate(e,t){return this.isValidHoldResumeCallState(this.state)?this.setHold(!0,e,t):(this.logger.logFailure(`[Hold][${e}] Trying to hold a call in an invalid state: ${this.state}`),Promise.reject(`Trying to hold a call in an invalid state: ${this.state}`))}async localHold(e,t,i){return this.isValidHoldResumeCallState(this.state)?this.setHold(!0,e,t,i):(this.logger.logFailure(`[LocalHold][${e}] Trying to hold a call in an invalid state: ${this.state}`),Promise.reject(`Trying to hold a call in an invalid state: ${this.state}`))}async unhold(e,t=e9()){let i=this.logger.createFnLogger("Unhold",t);return 3===this.state?(i.logFailure("Trying to resume a call which is already in connected state, early resolving the promise"),Promise.resolve(void 0)):4===this.state?(i.info(`current hold state ${this.requestedHoldState}`),this.setHold(!1,t)):(i.logFailure(`Trying to resume a call in an invalid state: ${this.state}`),Promise.reject(`Trying to resume a call in an invalid state: ${this.state}`))}canMerge(e,t){let i=e.isOneToOneCall(),n=3===this.state,r=4===e.state,s=i&&n&&r;return this.logger.info(`[${t}][canMerge] Call ${e.callId} isOneToOne ${i} isCallConnected ${n} call.state ${this.state} isMergeOnHold ${r} mergeCall.state ${e.state} CanMerge result: ${s}`),s}async updateEndpointMetadata(e,t=e9()){return this.signalingSession.updateEndpointMetadata(e,t)}async sendDtmfTone(e){if(this.mediaSession){let t=this.toneToString(e);return t?(this.logger.info(`[${ak}][sendDtmfTone]DtmfTone: <omitted>`),Promise.resolve(this.mediaSession.sendDtmf(t))):Promise.reject(Error("Unsupported DtmfTone"))}return Promise.reject(Error("no mediaSession"))}async setAudioUsageMode(e){return Promise.reject(60)}async setAudioMidcallConfig(e,t){return Promise.reject(60)}async setAudioMidcallConfigJson(e,t=e9()){if(!e)return Promise.reject(60);np(e.enableSpatialAudio)&&this.mediaSession?.configureSpatialAudio(e.enableSpatialAudio,t),e.noiseSuppressionMode&&await this.setNoiseSuppressionMode(e.noiseSuppressionMode,e.enableAEC)}async setParticipantSpatialAudioPositions(e,t=e9()){let i=e.map(e=>({sourceId:this.participants.find(t=>t.id===e.participantId)?.audio.id,x:e.x,y:e.y}));return this.mediaSession?.setParticipantSpatialAudioPositions(i,t)}async setNoiseSuppressionMode(e,t){return this.mediaSession.getSessionConfig().config.wasmvqe.enableVqe||this.mediaSession.getSessionConfig().config.wasmdns.enableNoiseSuppression?"Auto"===e?this.mediaSession.getSessionConfig().config.wasmvqe.enableVqe?this.mediaAgent.getDeviceManager().setAudioEffects(this.mediaAgent.getDeviceManager().effectsManager.vqeModeToAudioEffectType(this.mediaSession.getSessionConfig().config.wasmvqe.defaultVqeMode)):this.mediaAgent.getDeviceManager().setAudioEffects(this.mediaAgent.getDeviceManager().effectsManager.vqeModeToAudioEffectType(this.mediaAgent.getDeviceManager().effectsManager.nsModeToVqeMode(this.mediaSession.getSessionConfig().config.wasmdns.noiseSuppressionMode,t))):this.mediaSession.getSessionConfig().config.wasmvqe.enableVqe?this.mediaAgent.getDeviceManager().setAudioEffects(this.mediaAgent.getDeviceManager().effectsManager.vqeModeToAudioEffectType(this.mediaAgent.getDeviceManager().effectsManager.nsModeToVqeMode(e,this.mediaSession.getSessionConfig().config.wasmvqe.enableAec))):this.mediaAgent.getDeviceManager().setAudioEffects(this.mediaAgent.getDeviceManager().effectsManager.vqeModeToAudioEffectType(this.mediaAgent.getDeviceManager().effectsManager.nsModeToVqeMode(e,t))):Promise.resolve()}shouldSkipOfferGenerationForStreamingUser(e){return!e&&this.signalingSession.signalingAgentConfig.skipOfferGenerationForStreamingUser&&this.joinAsStreamingUser}setInitialTelemetry(e,t={},i,n){switch(e){case"Subscribe":case"SubscribeWithMeetingData":this.callTelemetry.setDirection("Outgoing"),this.callTelemetry.setSelfParticipantRole("SUBSCRIBE"),i||this.callTelemetry.setOperationVariant(e,"CCWM"),this.signalingSession.setInitialTelemetry(e,{correlationId:this.callId,causeId:n,conversationServiceUrl:i});break;case"Acknowledge":0!==this.state&&8!==this.state&&this.callTelemetry.maybeRecordOperationSuccess(e,{code:4}),this.callTelemetry.setDirection("Incoming"),this.callTelemetry.setSelfParticipantRole("callee"),this.signalingSession.setInitialTelemetry(e,{causeId:n});break;case"JoinCall":case"JoinWithMeetingData":this.setInitialJoinOrStartTelemetry(e,t,"join",i,n);break;case"StartCall":case"StartWithMeetingData":case"StartCallToVoiceMail":case"StartCallWithNudge":case"StartCallAndUnpark":this.setInitialJoinOrStartTelemetry(e,t,"caller",i,n)}}async setHold(e,t,i,n){let r=this.logger.createFnLogger("setHold",t,`hold=${e}`);if(!this.canToggleAudio||this.callHoldResumeDeferred)return Promise.reject(Error("can not set hold as it is already in progress"));this.callHoldResumeDeferred=new iE,this.isHoldInProgress=e,this.canToggleAudio=!1,this.canToggleVideo=!1,this.canToggleScreenSharing=!1,this.requestedHoldState=e;let s=()=>{this.canToggleAudio=!0,this.canToggleScreenSharing=!0,this.canToggleVideo=!0};r.info(`start, holdOptions: ${JSON.stringify(i)}`);let a=this.callHoldResumeDeferred.promise,o=e?"Hold":"Unhold",l={debugContent:{clientScenario:this.convertClientScenario(n)}};try{if(e?this.isMuteOnHold=i&&i.isLocal&&5!==this.state:this.prepareModalitiesForResume(t),!this.isMuteOnHold){let e=await this.updateMediaModalities(void 0,t);this.updateMediaState(e,t),this.updateScreenSharingState(e,t)}e&&(this.prepareModalitiesForHold(t),5===this.state&&this.finishCallHoldResume(),this.setCallState(4,t)),this.isMuteOnHold&&this.setMuteOnHold(e,t),s();let n={code:0,subCode:0,phrase:""};this.callTelemetry.recordOperationSuccess(o,n,null,t,l)}catch(i){this.callTelemetry.recordOperationFailure(o,{error:tT(i)},null,t,l),r.logFailure(i),s(),this.callHoldResumeDeferred?.reject(Error(`Failed setting hold state to ${e}`)),this.callHoldResumeDeferred=null}return a}transferCall(e){return this.logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(e)}callBlindTransfer(e,t=e9(),i){return this.executeCallTransfer(e,t,0,i)}callSafeTransfer(e,t=e9(),i){return this.executeCallTransfer(e,t,0,i)}transferCallToVoicemail(e,t=e9()){return this.executeCallTransfer(e.transferTargetMri,t,2,void 0)}callConsultativeTransfer(e,t=e9(),i,n){let r,s=this.logger.createFnLogger("ConsultativeTransfer",t);e.participants.length>1?(r=this.getParticipantByLegId(i,e))||(s.warn("getParticipantByLegId did not find a match in the participants list, defaulting to first participant"),r=e.participants[0]):r=e.participants[0];let a=r&&r.acceptedBy||r&&r.id;return s.info(`transferTargetParticipantLegId: ${i} targetMri: ${ta(a)}`),this.executeConsultCallTransfer(e.callId,a,i,t,n)}async consultativeTransferWithPickupCode(e,t){let i=this.logger.createFnLogger("ConsultativeTransferWithPickupCode",t);if(i.info(`pickup code: ${e}`),!e||isNaN(Number(e)))return i.info("pickup code cannot be empty"),Promise.reject(aG("TransactionDisallowed"));let n=this._callOperationHandler.createPendingOperation("_CallTransferInProgress",void 0,t,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),r=`4:${s8}`,s={unparkContent:{pickupCode:Number(e)}},a={disableForwardingAndUnanswered:!1};return this.signalingSession.transferCallAsync(r,"TransferTypeStandard",s,a,t),n}callRedirect(e,t=e9()){return this.logger.createFnLogger("CallRedirect",t).info(`redirectOptions: ${JSON.stringify(e)}`),this.stopInternal({terminatedReason:75,redirectOptions:e,causeId:t}).then(()=>({code:a1,subCode:on,phrase:oX,resultCategories:["Success"]}))}convertParkContext(e){switch(e){case 1:return"sharedLinePark";case 4:return"sharedLineParkV2";case 0:return"teamPark";case 3:return"serverHoldV2";case 5:return"callPark";default:return"serverHold"}}convertClientScenario(e){switch(e){case 0:return"breakoutRoom";case 1:return"musicOnHoldV2";case 2:return"sharedLineAppearanceV2";default:return}}park(e,t=e9()){let i=this.convertParkContext(e);return this.logger.info(`[${t}] [ParkCall] start -  context ${e} parkType ${i}`),5===e?(this.callTelemetry.recordOperation(`${sZ(i)}`,t),this._pendingParkPromise=this._callOperationHandler.createPendingOperation("CallParkV2",void 0,t)):this._pendingParkPromise=this._callOperationHandler.waitForOperation("ParkCall"),"serverHoldV2"!==i&&"callPark"!==i&&this._setParkState(1),this.signalingSession.parkCallAsync(i,t).catch(e=>{this.logger.info(`[${t}] [ParkCall] error in parkCallAsync (synchronous error) : ${tT(e)}. Hold promise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("ParkCall",{error:tT(e)},t)}),this._pendingParkPromise}async unpark(e,t){let i=this.convertParkContext(e);return this.logger.info(`[${t}] [UnparkCall] start -  context ${e} parkType ${i}`),this._pendingUnparkPromise=this._callOperationHandler.waitForOperation("UnparkCall"),this.signalingSession.unparkAsync(i,t).catch(e=>{this.logger.info(`[${t}] [UnparkCall] error in unparkAsync (synchronous error) : ${tT(e)}. Unhold promise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("UnparkCall",{error:tT(e)},t)}),this._pendingUnparkPromise}getServerHoldLocation(){return this._pendingParkPromise.then(()=>(this.logger.info(`getServerHoldLocation ${this.serverHoldLocation}`),this.serverHoldLocation))}getParkAdditionalContextJson(){return this._pendingParkPromise.then(()=>(this.logger.info(`getParkAdditionalContextJson ${this.parkAdditionalContextJson}`),this.parkAdditionalContextJson))}getJoinBlob(){return Promise.resolve(JSON.stringify({conversationUrl:this.signalingSession.getConversationUrl(),conversationId:this.callId}))}getTechnicalInformationJson(){return Promise.resolve(JSON.stringify(this.mediaSession.getCallTechnicalInfo()))}isOneToOneCall(e=!1){if(e){let e=(this.state,[0,1]);return 1===this.callType&&e.includes(this.participants.length)}return 1===this.callType&&1===this.participants.length}setMuteOnHold(e,t){this.mediaSession.muteHold(e,t),e||(this.computeCallState(t),this.isMuteOnHold=!1),this.finishCallHoldResume()}finishCallHoldResume(e){e?this.callHoldResumeDeferred?.reject(e):this.callHoldResumeDeferred?.resolve(),this.isHoldInProgress=!1,this.callHoldResumeDeferred=null}computeCallState(e){let t=3;this._callInLobby?t=10:this.signalingSession.participantManager.localParticipant.isStaging&&(t=13),this.logger.info(`[${e}][computeCallState] the call state will be set to ${t}`),this.setCallState(t,e)}async prepareModalitiesForResume(e){this.mediaStateConfigurationHelper.isSending(1)&&await this.turnOnLocalVideoPreview(e)}async prepareModalitiesForHold(e){await this.turnOffLocalVideoPreview(e)}updateMediaState(e,t){this.setVideoOn(e.video===this.mediaAgent.constants.MEDIA_STATE.sendReceive||e.video===this.mediaAgent.constants.MEDIA_STATE.send,t),this.setAudioOn(e.audio===this.mediaAgent.constants.MEDIA_STATE.sendReceive||e.audio===this.mediaAgent.constants.MEDIA_STATE.send,t)}updateScreenSharingState(e,t){this.setScreenSharingOn(e.sharing===this.mediaAgent.constants.MEDIA_STATE.send,t)}onSharingStreamStateChanged(t){let i=e9();this.logger.info(`[${i}] Sharing stream state moved to ${t}`);let n={mediaType:2,mediaDirection:1,mediaStreamState:e.streamingStatetoMediaStreamState(t)};this.event("mediaStreamStateChanged").raise(n),this.callStats.localStats.screenShare.streamStateChanged(t),"stopped"===t&&(this.canToggleScreenSharing=!0,this.stopScreenSharing(),"screenSharingCall"!==this.conversationType||this.participants.some(e=>3===e.state)||this.stop(!0,i))}async startScreenSharing(e,t,i,n=e9()){this.allowScreenSharingControl()&&(this.screenSharingControl.isInternalViewerControlEnabled()&&this.screenSharingControl.shutdownControlForViewer(),this.screenSharingControl.isInternalSharerControlEnabled()&&this.screenSharingControl.initControlForSharer(i));let r=this.logger.createFnLogger("StartScreenSharing",n);return(r.info(`started. negotiationTag is ${i}`),this.canToggleScreenSharing)?this.isScreenSharingOn?(r.logSuccess("Resolving early because screen sharing is already on"),Promise.resolve()):(this.screenSharingRenegotiationDeferred&&(r.logFailure("called before the renegotiation deferred for the previous one has been closed"),this.screenSharingRenegotiationDeferred.resolve()),this.screenSharingRenegotiationDeferred=new iE,this.callStats.localStats.newSession(2),this.callStats.localStats.screenShare.start(),this.mediaStateConfigurationHelper.isDisabled(2)&&r.info("sharing modality was skipped till now. Adding it now"),this.canToggleScreenSharing=!1,this.callStats.localStats.screenShare.event(0),this.getScreenHandle(e).acquire().then(()=>(r.logSuccess("sharing stream acquired"),this.mediaStateConfigurationHelper.enableModality(2),this.allowDataChannel()&&this.mediaStateConfigurationHelper.enableModality(3),this._delayedElevationPending&&!this._delayedElevationQueued)?this.triggerDelayedReconnectIfNeeded(n):Promise.resolve()).then(()=>this.updateMediaModalities(void 0,n,i)).then(()=>(r.logSuccess("updateMediaModalities done"),this.callStats.localStats.screenShare.negotiationStateChanged("started"),this.setScreenSharingOn(!0,n),this.canToggleScreenSharing=!0,this.screenSharingRenegotiationDeferred.promise)).then(()=>{this.enableControlInjector(),this.callStats.localStats.screenShare.negotiationStateChanged("completed")}).catch(e=>{this.callTelemetry.updateOperationData("StartScreenSharing",{error:tT(e)},n),this.setScreenSharingOn(!1,n),this.mediaStateConfigurationHelper.removeModality(2),this.canToggleScreenSharing=!0,this.disposeSharingScreenHandle();let t=e.error;throw t&&t.code===a8?(this.callStats.localStats.screenShare.negotiationStateChanged("rejected","glare"),r.logFailure("starting screen sharing failure with reason glare")):"ScreenSharingStopped"===e.reason?(this.callStats.localStats.screenShare.negotiationStateChanged("rejected","sharingStopped"),r.logFailure("expected starting screen sharing failure with reason stopped")):(this.callStats.localStats.screenShare.negotiationStateChanged("rejected","other"),r.logFailure(e)),e})):Promise.reject(Error("cannot start screen sharing"))}async stopScreenSharing(e,t,i=e9()){let n=this.logger.createFnLogger("StopScreenSharing",i);if(n.info(`started. negotiationTag is ${t}`),!this.canToggleScreenSharing)throw n.logFailure("cannot stop screen sharing"),Error("cannot stop screen sharing");if(!this.isScreenSharingOn&&!this._callOperationHandler.hasPendingOperation("StartScreenSharing"))return void n.logFailure("screensharing is not on, ignore this operation");this.screenSharingRenegotiationDeferred&&(this.screenSharingRenegotiationDeferred.reject({reason:"ScreenSharingStopped"}),this.screenSharingRenegotiationDeferred=null),this.mediaStateConfigurationHelper.removeModality(2),this.canToggleScreenSharing=!1,this.allowScreenSharingControl()&&this.screenSharingControl.isInternalSharerControlEnabled()&&this.screenSharingControl.shutdownControlForSharer(),await this.updateMediaModalities(void 0,i,t),this.canToggleScreenSharing=!0,this.callStats.localStats.screenShare.stop(),this.disposeSharingScreenHandle(),this.mediaAgent.getDeviceManager().shareSystemSound(!1),this.mediaAgent.getDeviceManager().setAudioSharingRequested(!1);try{this.setScreenSharingOn(!1,i)}catch(e){throw n.logFailure(e),this.callTelemetry.updateOperationData("StopScreenSharing",{error:tT(e)},i),e}}async startDataChannel(e,t=e9()){if(!this.allowDataChannel())throw Error("startDataChannel is disabled since ECS flag prohibits it");this.mediaStateConfigurationHelper.enableModality(3),await this.updateMediaModalities({},t)}async stopDataChannel(e,t=e9()){if(!this.allowDataChannel())throw Error("stopDataChannel is disabled since ECS flag prohibits it");this.mediaStateConfigurationHelper.removeModality(3),await this.updateMediaModalities({},t)}allowDataChannel(){return this.mediaSession?this.isOneToOnePSTNCall()?this.mediaSession.getSessionConfig().config.enableDataChannelPstn:this.mediaSession.getSessionConfig().config.enableDataChannel:(this.logger.warn("datachannel not allowed as there is no mediaSession"),!1)}isInitialSignalingDSHSubscriptionEnabled(){let e=this.mediaSession?.getSessionConfig()?.config;return e?!this.allowDataChannel()||e.enableInitialSignalingDSHSubscription:(this.logger.warn("Initial signaling dsh subscription is enabled as there is no mediaSession, sessionConfig or sessionConfig.config"),!0)}allowScreenSharingControl(){return this.screenSharingControl?.isScreenSharingControlEnabled()&&this.allowDataChannel()}updateSignalingDSHMessageSubscription(e){this.signalingSession.updateDominantSpeakerHistoryMessageSubscription(e),e&&this.mediaSession?.getDiagnostics?.().dshDiagnostics.setCurrentActiveStrategy("signaling")}async sendUserEvents(e,t){return this.dataChannel.sendUserEvents(e,t)}async shareSystemSound(e,t=e9()){let i=this.logger.createFnLogger("ShareSystemSounds",t,`shareSystemSound=${e}`);if(!(this.mediaSession&&this.mediaSession.getSessionConfig().config.enableAudioSharing&&this.mediaSession.getSessionConfig().config.requireUserActionForAudioSharing))return i.error("shareSystemSound not allowed"),Promise.reject(60);try{this.mediaAgent.getDeviceManager().shareSystemSound(e);return}catch{return i.error("shareSystemSound failed with device error"),Promise.reject(58)}}async mute(e=iW()){return this.isMuted?Promise.reject(aG("TransactionDisallowed")):this.muteUnmute(!0,e)}async unmute(e=iW()){return this._callOperationHandler.hasPendingOperation("_PromotionToRealtime")&&await this._callOperationHandler.waitForOperation("_PromotionToRealtime"),this.muteUnmute(!1,e)}async muteSpeaker(e=e9()){return this.muteUnmuteSpeaker(!0,e)}async unmuteSpeaker(e=e9()){return this.muteUnmuteSpeaker(!1,e)}async getSpeakerVolume(e=e9()){return await this.mediaSession.getSpeakerVolume(e)}async setSpeakerVolume(e,t=e9()){return this.mediaSession.setSpeakerVolume(e,t)}async muteParticipants(t,i,n=iW()){let r=this.logger.createFnLogger("MuteParticipants",n,`muteScope=${t}`);r.info(`callParticipants count=${i.length}`);let s=e.convertMuteScope(t);if(void 0===s)return r.logFailure(`Unrecognized ${t}`),Promise.reject(Error("Unrecognized muteScope"));if(pP(this.state,[11,12]))return r.logFailure("Can not mute/unmute during preheat call"),Promise.reject(60);let a=[];return i.forEach(e=>{a.push(e.id)}),this.signalingSession.muteAsync(s,a,n).then(e=>this.handleParticipantsMutedUpdated(e,n)).catch(e=>(this.callTelemetry.updateOperationData("MuteParticipants",{error:tT(e)},n),r.logFailure(e),e?.endCode?Promise.reject(e.endCode):Promise.reject(e)))}async startAudio(e,t=e9()){let i=this.logger.createFnLogger("StartAudio",t);if(this.receiveOnlyAudioOnCallStart=!1,3!==this.state)return i.logFailure("Cannot startAudio when call is not connected"),Promise.reject(60);if(this.mediaStateConfigurationHelper.enableModality(0),this.callUsesMixer&&this.mediaStateConfigurationHelper.removeModality(1),this.mediaStateConfigurationHelper.isSending(1))try{await this.turnOnLocalVideoPreview(t)}catch(e){return i.logFailure(e),Promise.reject(25)}let n=await this.startStopAudio(!0,t);return await this.signalingSession.recordTelemetryForStartAudio(n),{code:n}}async stopAudio(e,t=e9()){let i=this.logger.createFnLogger("StopAudio",t);if(3!==this.state)return i.logFailure("Cannot stopAudio when call is not connected"),Promise.reject(60);this.mediaStateConfigurationHelper.removeModality(0);let n=await this.startStopAudio(!1,t);return await this.turnOffLocalVideoPreview(t),await this.signalingSession.recordTelemetryForStopAudio(n),{code:n}}assimilate(e,t,i,n=e9()){return Promise.reject(Error("Not implemented"))}async merge(e,t,i=e9()){let n=this.logger.createFnLogger("MergeCall",i);n.error(`merge callId ${e.callId} callMergeOptions ${JSON.stringify(t)}`);let r=this.canMerge(e,i);if(!r)return n.info(`Error. ${t_(r)}`),Promise.reject(aG("TransactionDisallowed"));let s=[];return e.participants.forEach(e=>{s.push(this._callOperationHandler.createPendingOperation("MergeCall",e.id,i))}),(await this.mergeCallByAddParticipantWithReplaces(t,e.participants,e,1,"MergeCall",i,s,void 0))[0]}async mergeParticipants(e,t,i,n,r){let s=this.logger.createFnLogger("MergeParticipants",n),a=[];if(!e)return Promise.reject(aG("Invalid callToMerge"));if(0===t.length)return Promise.reject(aG("Invalid participantIds"));let o=[];for(let i of t){let t=h_(e,i);if(!t&&hE(e,i)&&(s.info("found self endpoint, use localSignalingParticipant"),t=this.localSignalingParticipant),t){let e=iW(),r={id:t.id,participantId:e,replacementParticipantId:i,nonMaskedId:t.nonMaskedId};a.push(r),o.push(this._callOperationHandler.createPendingOperation("MergeParticipant",e,n))}else{let e={code:406,subCode:5201,phrase:`participantLegId ${i} is invalid!`};o.push(Promise.reject(aG(e)))}}return this.mergeCallByAddParticipantWithReplaces(i,a,e,3,"MergeParticipant",n,o,r)}async mergeWithPickupCode(e,t,i=e9()){let n=this.logger.createFnLogger("MergeWithPickupCode",i);if(n.info(`mergeWithPickupCode: pickup code: ${e}, groupId: ${ta(t.groupId)}, threadId: ${th(t.threadId)} messageId: ${t.messageId}`),!e||isNaN(Number(e)))return n.info("mergeWithPickupCode: pickup code cannot be empty"),Promise.reject(aG("mergeWithPickupCode: pickup code cannot be empty"));let r={additionalData:t.additionalData,groupId:t.groupId,threadId:t.threadId,messageId:t.messageId,replacementType:2,pickupCode:Number(e)},s={id:`4:${s8}`};return Promise.resolve().then(()=>Promise.all(this.signalingSession.addParticipantsAsync([s],r,i))).then(e=>(e.length>0&&this.signalingNotifications.onParticipantJoined(e[0],i),Promise.resolve({code:0,subCode:0,phrase:"TransactionComplete"}))).catch(e=>{n.logFailure(`Participant was not added to call, error=${t_(e)}`);let t=this._handleParticipantOperationFailure("MergeWithPickupCode",e,i,null,!0).reason;return Promise.reject(e?e.endCode:t||0)})}async setMaxVideoChannels(e){return Promise.reject(60)}async setMaxVbssChannels(e){return Promise.reject(60)}async stop(e=!1,t=e9(),i,n){let r=this.logger.createFnLogger("StopAudio",t);if(6===this.state)return r.logFailure("Trying to stop a call which is already Disconnecting"),Promise.reject(Error("cannot stop call in Disconnecting state"));if(7===this.state)return r.logFailure("Trying to stop a call which is already Disconnected"),Promise.reject(Error("cannot stop call in Disconnected state"));if(this.disposedPromise)return r.logFailure("Call already ended"),Promise.reject("Call already ended");let s=0;1===this.state&&(s=10);let a=n?{clientReasonSubCode:n.clientSubCode,clientReasonPhrase:n.clientPhrase}:{};n?.clientSubCode===av&&this.mediaSession?.getSessionConfig()?.config.vdiDisconnectedTracking.enabled&&this.mediaSession?.getSessionConfig()?.config.vdiDisconnectedTracking.clientPhrases.includes(n?.clientPhrase)&&(a.code=ap,a.subCode=av,a.phrase=o0,a.resultCategories=["UnexpectedClientError"],s=4);let o={terminatedReason:s,forEveryone:e,causeId:t,...i,rejectReason:a};return this.stopInternal(o)}publishState(e,t){let i=s0(e.type),n=this.getPluginlessPublishLevel(e.level),r=e.participantIds&&e.participantIds.length>0?"specified":void 0;return this.callTelemetry.setOperationVariant("PublishState","specified"===r?`${i}Specified`:`${i}None`,t),this.signalingSession.publishStateAsync(i,n,t,e.content,r,e.participantIds)}publishStatesForEveryone(e,t){let i=s0(e.type),n=this.getPluginlessPublishLevel(e.level),r="all";return this.callTelemetry.setOperationVariant("PublishState",`${i}All`),this.signalingSession.publishStateAsync(i,n,t,e.content,r)}removeState(e,t){return this.signalingSession.removeStateAsync(t,"specified",void 0,e.stateIds).then(e=>Promise.resolve())}removeStatesForEveryone(e,t){let i=s0(e.type);return this.signalingSession.removeStateAsync(t,"all",i,void 0).then(e=>Promise.resolve())}updateMeetingSettings(e,t){let i;return e.segmentationTypeForAiInterpreter&&(i="Long"===e.segmentationTypeForAiInterpreter?"Long":"Normal"),this.signalingSession.updateMeetingSettingsAsync({allowRaiseHands:e.allowRaiseHands,attendeeRestrictions:e.attendeeRestrictions,lockMeeting:e.lockMeeting,breakoutRoomsEnabled:e.breakoutRoomsEnabled,allowPresentersToManageBreakoutRooms:e.allowPresentersToManageBreakoutRooms,disableMdpClientAudioRecording:e.disableMdpClientAudioRecording,refreshSettings:e.refreshSettings,aiInterpretationEnabled:e.aiInterpretationEnabled,groupCopilotDetails:e.groupCopilotDetails,segmentationTypeForAiInterpreter:i},t)}updateMeetingGroups(e,t){this.logger.info(`[UpdateMeetingGroups][${e}] options ${tI(t)}`);let i=this._callOperationHandler.waitForOperation("UpdateMeetingGroups",e),n={fromGroup:t.fromGroup,toGroup:t.toGroup,scope:mj(t.scope)};return t.participants&&(n.participants=mH(t.participants)),this.signalingSession.updateMeetingsGroupsAsync(e,n).catch(t=>{this.logger.info(`[${e}] [UpdateMeetingGroups] error in updateMeetingGroups (synchronous error) : ${tT(t)}. updateMeetingGroupsPromise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("UpdateMeetingGroups",{error:tT(t)},e)}),i}updateMeetingLiveState(e,t){return this.logger.info(`[UpdateMeetingLiveState][${e}] options ${tI(t)}`),this.signalingSession.updateMeetingLiveStateAsync(e,t).catch(t=>{this.logger.info(`[${e}] [UpdateMeetingLiveState] error in updateMeetingLiveState (synchronous error) : ${tT(t)}. promise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("UpdateMeetingLiveState",{error:tT(t)},e)}),this._callOperationHandler.waitForOperation("UpdateMeetingLiveState",e)}updateMeetingStates(e,t=e9()){var i;this.logger.info(`[UpdateMeetingStates][${t}]`);let n={},r=[];for(let s of(e.operationId=e.operationId||t,Object.keys(e.meetingStates))){let a=e.operationId+"_"+s;r.push(a);let o=this._callOperationHandler.createPendingOperation("UpdateMeetingStates",a,t);n[i=e.operationId]??(n[i]={}),n[e.operationId][s]=o,this.callTelemetry.recordOperation("UpdateMeetingStates",t,a)}return Promise.resolve().then(()=>this.signalingSession.updateMeetingStatesAsync(t,e)).then(e=>{for(let i of r)this.callTelemetry.updateOperationData("UpdateMeetingStates",{data:tT(e)},t,i)}).catch(e=>{for(let i of r)this.callTelemetry.updateOperationData("UpdateMeetingStates",{error:tT(e)},t,i);this.logger.logFailure(e)}).then(()=>n)}async updateParticipantInterpretationState(e,t){if(this.logger.info(`[UpdateParticipantInterpretationState][${e}] options ${tI(t)}`),0===t.length)return Promise.reject(aG("Invalid UpdateParticipantInterpretationState options"));let i=this.signalingSession.updateParticipantInterpretationStateAsync(e,t),n=[];t.forEach(t=>{n.push(this._callOperationHandler.createPendingOperation("UpdateParticipantInterpretationState",t.id,e))});for(let n=0;n<i.length;n++){let r=i[n],s=t[n];r.then(()=>{this.logger.logSuccess(`updateParticipantInterpretationState succeeded for [id=${ta(s.id)}]`);let t={code:0,subCode:0,phrase:""};this.callTelemetry.recordOperationSuccess("UpdateParticipantInterpretationState",t,s.id,e),this._callOperationHandler.maybeResolveOperation("UpdateParticipantInterpretationState",t,s.id,e)}).catch(t=>{this.logger.error(`[${e}] [UpdateParticipantInterpretationState] error in updateParticipantInterpretationState (synchronous error) : ${tT(t)}. updateParticipantInterpretationStatePromise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("UpdateParticipantInterpretationState",{error:tT(t)},e);let i=this._handleParticipantOperationFailure("UpdateParticipantInterpretationState",t,e,s.id).reason,n=t?.endCode||i||0;this._callOperationHandler.maybeRejectOperation("UpdateParticipantInterpretationState",n,s.id,e)})}return Promise.resolve(n)}async updateParticipantsProperties(e,t){let i=this.logger.createFnLogger("UpdateParticipantsProperties",t);if(i.info(`options ${ta(tI(e))}`),!e)return Promise.reject(aG("Invalid input: UpdateParticipantsPropertiesContext"));let n={},r=e.scope,s=e.operationId,a=new Set;if("self"===r){let i=this.signalingSession.participantManager.localParticipant.id;for(let r in e.propertyBag){let e=gA(i,s,r),o=this.createUpdateParticipantPromise(e,t);n[e]={[i]:o},a.add(e),this.callTelemetry.recordOperation("UpdateParticipantsProperties",t,ta(e))}}else if("specified"!==r||!this._isUpdatePropertiesSpecifiedAllowedByEcs)return Promise.reject("This scope is not supported.");else for(let i of e.participants){let e=i.id;for(let r in i.propertyBag){let i=gA(e,s,r),o=this.createUpdateParticipantPromise(i,t);n[i]={[e]:o},a.add(i),this.callTelemetry.recordOperation("UpdateParticipantsProperties",t,ta(i))}}return i.info(`promises created: ${ta(tI(n))}`),this.signalingSession.updateParticipantsPropertiesAsync(e,a,s,t).catch(e=>{let r=t_(e);i.info(`[failed][reason=${r}]`);let s={...e};for(let e of(this.callTelemetry.updateOperationData("UpdateParticipantsProperties",{error:tT(r)},t),Object.keys(n)))this._callOperationHandler.maybeRejectOperation("UpdateParticipantsProperties",s,e,t)}),Promise.resolve().then(()=>n)}joinMeetingGroup(e,t){this.logger.info(`[JoinMeetingGroup][${e}] options ${tI(t)}`);let i=this._callOperationHandler.waitForOperation("JoinMeetingGroup",e),n={..."meetingGroupId"in t&&{meetingGroupId:t.meetingGroupId},..."meetingGroupLabel"in t&&{meetingGroupLabel:t.meetingGroupLabel},...t.groupPreferences&&{groupPreferences:t.groupPreferences}};return this.signalingSession.joinMeetingGroupAsync(e,n).catch(t=>{let i=tT(t);this.logger.info(`[${e}] [JoinMeetingGroup] error in joinMeetingGroup (synchronous error) : ${i}. joinMeetingGroupPromise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("JoinMeetingGroup",{error:i},e)}),i}leaveMeetingGroup(e,t){this.logger.info(`[LeaveMeetingGroup][${e}] options ${tI(t)}`);let i=this._callOperationHandler.waitForOperation("LeaveMeetingGroup",e),n={meetingGroupId:t.meetingGroupId};return this.signalingSession.leaveMeetingGroupAsync(e,n).catch(t=>{let i=tT(t);this.logger.info(`[${e}] [LeaveMeetingGroup] error in leaveMeetingGroup (synchronous error) : ${i}. leaveMeetingGroupPromise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("LeaveMeetingGroup",{error:i},e)}),i}sendMessages(e,t){var i,n;this.logger.info(`[SendMessages][${e}]`);let r={};for(let s of t)if(0===s.scope){let t=this._callOperationHandler.createPendingOperation("SendMessages",s.operationId,e);r[s.operationId]={all:t},this.callTelemetry.recordOperation("SendMessages",e,s.operationId)}else if(1===s.scope){for(let t in s.to)if("participant"===s.to[t].level){let n=gP(t,s.operationId),a=this._callOperationHandler.createPendingOperation("SendMessages",n,e);r[i=s.operationId]??(r[i]={}),r[s.operationId][t]=a,this.callTelemetry.recordOperation("SendMessages",e,n)}else if("endpoint"===s.to[t].level)for(let i in s.to[t].participantLegIdMap){let t=gR(i,s.operationId),a=this._callOperationHandler.createPendingOperation("SendMessages",t,e);r[n=s.operationId]??(r[n]={}),r[s.operationId][i]=a,this.callTelemetry.recordOperation("SendMessages",e,t)}}return this.signalingSession.sendProxiedMessageAsync(e,t).then(e=>{for(let t of e)t.then(e=>{this._callOperationHandler.maybeResolveOperation("SendMessages",e.transactionEnd,e.resolveString,e.causeId)}).catch(e=>{this._callOperationHandler.maybeRejectOperation("SendMessages",e.transactionEnd,e.resolveString,e.causeId)});return r})}async updateMonitorSession(e,t=e9()){this.logger.info(`updateMonitorSession: monitorActionType: ${e.monitorActionType}, monitorData: ${e.monitorData}`);let i=p9(e.monitorActionType);if(void 0===i)return Promise.reject({code:af,subCode:ay,phrase:`Invalid monitor action type ${e.monitorActionType}`});let n={monitorActionType:i,monitorData:e.monitorData},r=this._callOperationHandler.waitForOperation("UpdateMonitorSession","",t);return this.signalingSession.updateMonitorSessionAsync(n,t).catch(e=>{let i=tT(e);this.logger.info(`[${t}] [UpdateMonitorSession] error in updateMonitorSession (synchronous error): ${JSON.stringify(i)}. updateMonitorSessionPromise will be rejected by signaling callback`),this.callTelemetry.updateOperationData("UpdateMonitorSession",{error:i},t)}),r}switchInterpreterGroup(e){return Promise.reject(Error("Not implemented"))}setLiveInterpretationAttributes(e,t){return Promise.reject(Error("Not implemented"))}async updateMeetingRoles(e,t,i=e9()){return 3===this.state&&this.signalingSession.hasOwnProperty("updateMeetingRolesAsync")?this.signalingSession.updateMeetingRolesAsync(e,t,i):Promise.reject({code:af,subCode:aS,phrase:"ActionNotAllowed"})}dispose(e){this.logger.createFnLogger("dispose",e).info("start"),this.screenSharingControl?.dispose(e),this.screenSharingControl=null,this.dataChannel?.dispose(e),this.dataChannel=null,super.dispose(e)}stopInternal(e){let t=this.logger.createFnLogger("stopInternal",e.causeId),i=e.terminatedReason||0,n=e.rejectReason&&(e.rejectReason.code||e.rejectReason.subCode)?e.rejectReason:this.getRejectionInfoFromTerminatedReason(i);if(e.rejectReason&&(n||(n={}),n.clientReasonSubCode=e.rejectReason.clientReasonSubCode,n.clientReasonPhrase=e.rejectReason.clientReasonPhrase),t.info(`started, terminatedReason=${i}, rejectReason=${tI(n)}`),6===this.state)return t.logFailure("Trying to stop a call which is already Disconnecting"),this.disconnectingPromise;if(7===this.state)return t.logFailure("Trying to stop a call which is already Disconnected"),this.disconnectingPromise;this.setCallState(6,e.causeId,i);let r={causeId:e.causeId,forEveryone:e.forEveryone,scope:this.mapEndpointScope(e.scope),redirectOptions:e.redirectOptions&&p0(e.redirectOptions)};return 1===e.scope&&(n.code=ag,n.subCode=ab,n.phrase=oZ),this.disconnectingPromise=Promise.all([this.cleanUpMedia(e.causeId,n).then(()=>{this.callTelemetry.recordOperationSuccess("_MediaCleanUp")}).catch(i=>{throw t.logFailure(`cleanUpMedia failed with reason=${t_(i)}`),this.callTelemetry.recordOperationFailure("_MediaCleanUp",{error:tT(i)},e.causeId),i}),this.signalingSession.endAsync(n,r).catch(e=>{throw t.logFailure(`endAsync failed with reason=${t_(e)}`),e})]).catch(i=>{throw t.logFailure(i),this.cleanUp(e.causeId,n),i}).then(()=>this.cleanUp(e.causeId,n)).catch(t=>{throw this.callTelemetry.updateOperationData("StopCall",{error:tT(t)},e.causeId),this.setCallState(7,e.causeId,i),t}),this.disconnectingPromise}async cleanUp(e,t){return this.logger.info(`[${e}][cleanup]start`),this.disposedPromise||(this.disposedPromise=this.cleanUpFinalize(e,t),this._getCallEndOperation().catch(ah).then(()=>{let t={code:af,subCode:aC};this._callOperationHandler.rejectPendingOperations(61,e,t),this._participantOperationHandler.rejectPendingOperations(47,e,t)})),this.disposedPromise}async cleanUpMedia(e,t){return this.mediaDisposedPromise||(this.callTelemetry.recordOperation("_MediaCleanUp",e),this.mediaDisposedPromise=(async()=>{this.callDeviceManager?.dispose(),this.callDeviceManager=null,this.turnOffLocalVideoPreview(e),this.localVideoContainer=null,this.disposeContentSharingSessions(),this.disposeSharingScreenHandle();let i=this.mediaSession;if(this.reportMediaStats=!!i,!i)return;this.unmixedAudioProvider.dispose(),this.remoteUFDHandler.dispose(),this.dataChannel.cleanup(e),this.mediaSession=null,this.streamManager.setMediaSession(null,e),this.participants?.forEach(t=>{t.setMediaSession(null,e)});let n=i.terminate(e,t);this.isVideoOn=!1,this.setMediaStream(this.isVideoOn,!1,1),this.setMediaStream(!1,!1,2),this.setMediaStream(!1,!1,0),this.isScreenSharingOn=!1,this.screenSharingRenegotiationDeferred?.reject(t),this.screenSharingRenegotiationDeferred=null,this.mediaStateConfigurationHelper.removeModality(1),this.mediaStateConfigurationHelper.removeModality(0),this.mediaStateConfigurationHelper.removeModality(3),this.mediaStateConfigurationHelper.removeModality(2),this.batteryStatus?.dispose(),i?.getSessionConfig()?.config?.useOneDsLogger&&i.getSessionConfig().config.addTelemetryReportingCallback&&window.removeEventListener("beforeunload",this.beforeUnloadTelemetrySender);try{await n}finally{await this.collectCallStats(i),this.callStats.appendMediaControlPlaneInfo(JSON.stringify(i.getMediaControlPlaneInstance()?.getTelemetryReport()))}})()),this.mediaDisposedPromise}async cleanUpFinalize(e,t){try{await this.cleanUpMedia(e,t)}catch(t){this.logger.info(`[${e}][cleanUpMedia] failure: ${t_(t)}`),this.callTelemetry.recordOperationFailure("_MediaCleanUp",{error:tT(t)},e)}this.callTelemetry.recordOperationSuccess("_MediaCleanUp");let i=this.reportCallEndStats(this.reportMediaStats);this.mediaSession?.getSessionConfig().config.waitReportStatsAtCallStop&&await i}async createContentSharingSession(e,t,i,n,r=e9()){if(this.signalingSession.signalingAgentConfig.checkAttendeeRoleInCreateContentSharing&&"attendee"===(this.advancedMeetingRole||this.meetingRole))return Promise.reject({terminatedReason:8,terminatedReasonCode:403,terminatedReasonSubCode:0,errorMessage:"Failed due to insufficient permissions"});let s=new fz(this.callTelemetry,this.logger,this.signalingSession,e,t,n,i);return this.contentSharingSessions.push(s),s.changed(()=>this.removeContentSessionIfEnded(s)),this.event("contentSharingChanged").raise(),Promise.resolve(s)}stopWithBeacon(e=e9()){if(6===this.state||7===this.state)return!0;this.mediaSession?.getSessionConfig()?.config?.enableCallStateChangesOnPageClose&&(this.callEndDiagnosticsInfo={callControllerCode:ag,callControllerSubCode:aT},this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this.setCallState(6,e,1));let t=this.signalingSession.endWithBeacon(e);return this.mediaSession?.getSessionConfig()?.config?.enableCallStateChangesOnPageClose&&this.setCallState(7,e,1),t}disposeContentSharingSessions(){this.contentSharingSessions.forEach(e=>{e.dispose(),this.removeContentSessionIfEnded(e)}),this.event("contentSharingChanged").raise()}isPreheatedOnly(){return!!(12===this.state||2===this.state&&this._callOperationHandler.hasPendingOperation("JoinPreheatedCall")||9===this.state&&this._callOperationHandler.hasPendingOperation("JoinPreheatedCall"))}removeContentSessionIfEnded(e){(7===e.contentSharingStatus||8===e.contentSharingStatus)&&(this.logger.info("stopping the content sharing session."),(0,o5.remove)(this.contentSharingSessions,t=>t.contentSharingGuid===e.contentSharingGuid).length&&this.event("contentSharingChanged").raise())}getRejectionInfoFromTerminatedReason(e){switch(e){case 53:return{code:a5,subCode:of,phrase:oz};case 4:return{code:a5,subCode:this._wasAudioStreamConnected?od:oc,phrase:this._wasAudioStreamConnected?oj:oH};case 47:return{code:a5,subCode:op,phrase:oq};case 38:return{code:a5,subCode:ou,phrase:oQ};case 10:return{code:aY,subCode:oi,phrase:oY};case 25:return{code:a9,subCode:og,phrase:oV};case 58:return{code:a5,subCode:oh,phrase:oB};case 7:return{code:a9,subCode:oi,phrase:o$};case 0:case 1:return{code:a0,subCode:oi,phrase:oY};case 75:return{code:a1,subCode:on,phrase:oX,resultCategories:["Success"]};case 77:return{code:a0,subCode:oO,phrase:o1}}return null}async acknowledge(e,t,i=e9()){let n=this.logger.createFnLogger("Acknowledge",i),r=Date.now();if(this.setInitialTelemetry("Acknowledge",{callStartTime:r},"",i),0!==this.state&&8!==this.state)throw Error(`Trying to acknowledge a call that has already been acted on ${this.state}`);n.info(`isMultiParty=${e.isMultiParty}`),n.info(`fromMixer=${e.fromMixer}`),n.info(`participantId=${e.participantId}`),n.info(`callType=${e.callType}`),this.attachToCallAndGetOffer=new iE,this.setCallType(e.isMultiParty?2:1,i),this.setCallUsesMixer(!!e.fromMixer,i),this.setCallerMri(pT(e.callerId)),this.setDisplayNameSource(e.displayNameSource),this.setTransferorMri(e.transferorId),this.transferorType=e.transferorType,this.transferorDisplayName=e.transferorDisplayName,this.incomingCallType=e.callType,this.consultativeCallId=e.consultativeCallId,this.callQueueInfo=e.callQueueInfo,this.setFromApplicationType(e.fromApplicationType,i),this.setCalleeAlternateId(e.calleeAlternateId,i),this.setRoutingTimeout(e.routingTimeout),this.callStats.localStats.startCall();let s=pw(n);try{if(s.executeSync("ProcessIncomingCallRequest",()=>this.signalingSession.processIncomingCallRequest(e,t,i)),this.setParticipantId(this.participantId),s.executeSync("ResolvePotentialConflict",()=>this.signalingAgent.resolvePotentialCallConflict(this.signalingSession))===this.signalingSession)return Promise.reject({code:7,success:!1});let r=()=>s.execute("SendAttach",()=>this.signalingSession.sendAttachToCall(i)).then(()=>this.setCallState(1,i)),a=async()=>{let e;s.executeSync("InitializeMediaSession",()=>this.initializeMediaSession(i)),this.updateSignalingDSHMessageSubscription(this.isInitialSignalingDSHSubscriptionEnabled());let t=this.signalingSession.getInitialMediaOfferFromIncomingCallPayload();this.callStats.setParticipantId(this.participantId),this.onBehalfOfMri=this.signalingSession.onBehalfOf,this.onBehalfOfUserDisplayName=this.signalingSession.onBehalfOfUserDisplayName,this.callQueueContext=this.signalingSession.callQueueContext,this.callQueueSupervisorContent=this.signalingSession.callQueueSupervisorContent,this.bannerContent=this.signalingSession.bannerContent,this.callPhoneLineType=this.signalingSession.callPhoneLineType;let r=await s.execute("WaitForMediaOffer",()=>t?Promise.resolve(t):this.attachToCallAndGetOffer.promise);try{e=await s.execute("ProcessOffer",()=>this.mediaSession.processOfferAsync(r,i))}catch(t){e=await this._handleOfferProcessingError(t,i,n)}await s.execute("ProcessOfferedModalities",()=>this._processOfferedModalities(e,i))},o=r();return await Promise.all([o,a()]).catch(async e=>{throw await o,e}),await s.execute("TrySendingProvisionalAnswer",()=>this._trySendProvisionalMediaAnswer(i)),s.executeSync("OnAcknowledgeSuccess",()=>this._onAcknowledgeSuccess(n,s.getTelemetryData(),i))}catch(e){return this._onAcknowledgeError(e,i,n,s.getTelemetryData())}}_onMessageIdChanged(e,t){e&&this.messageId!==e&&this.setMessageId(e,t)}async accept(e,t=e9()){let i=this.logger.createFnLogger("Accept",t);if(i.info(`accept, answerMediaType: ${e.answerMediaType},
                            withVideo: ${e.withVideo},
                            muted: ${e.muted},
                            getSendMediaModalities: ${JSON.stringify(e.sendMediaModalities)},
                            clientEndpointCapabilities: ${e.clientEndpointCapabilities},
                            muteFlags: ${e.muteFlags}`),1!==this.state)throw Error("Only calls in Notified state can be accepted");this.setCallOptions({callStartOptions:e,callStartTime:Date.now()}),this.setSessionIceTransportPolicy(e?.mediaConfiguration);let n=this._callOperationHandler.createPendingOperation("_ConnectCall",void 0,t);this.callStats.localStats.audio.start();let r=pw(i);this.mediaSession.createAudioElement(t);let s=e.muted||(1&e.muteFlags)==1,a=(2&e.muteFlags)==2;this.setMuted(s?2:+!!this.isServerMuted,t),this.setSpeakerMuted(a,t),this.setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation("Accept");try{e.forceAudioSendModalityWithNullStream&&this.mediaSession.useNullAudioStreamClient(),this.mediaStateConfigurationHelper.setCallAcceptOptions(e),this.mediaStateConfigurationHelper.isSending(1)&&await r.execute("StartVideoSafe",()=>this.startVideoSafe(t)),this.mediaStateConfigurationHelper.isSending(0)&&this.setAudioOn(!0,t);let s=await r.execute("UpdateMediaModalities",()=>this.updateMediaModalities(void 0,t)),a=r.executeSync("GetSignalingMediaTypes",()=>this.getSignalingMediaTypes(s)),o=await r.execute("evaluateEndpointStatesForAccept",()=>this.evaluateEndpointStatesForAccept(2===this._muteState,e?.additionalEndpointProperties,t));await r.execute("MuteUnmuteSpeakers",()=>this.muteUnmuteSpeaker(this.isSpeakerMuted,t));let l=r.execute("handleEndpointStatesForAccept",()=>this.handleEndpointStatesForAccept(o,t));i.info("Queued the handleEndpointStatesForAccept");let c=await r.execute("CreateAnswer",()=>this.mediaSession.createAnswerAsync(!1,t));await r.execute("Accept",()=>this.signalingSession.acceptAsync(c,a,e.clientEndpointCapabilities,t)),await r.execute("WaitForConnect",()=>n),this.handleRemoteParticipantStateInOneToOneCall(t),await r.execute("CompleteNegotiation",()=>this.completeNegotiationAsync(t)),await l,this.callTelemetry.updateOperationData("Accept",{phases:r.getTelemetryData()},t)}catch(r){let e=7,n={};throw this.callTelemetry.updateOperationData("Accept",this.getTelemetryFromPhaseExecution(r),t),r?.error&&(n={...r.error}),p_(o3,r)&&(e=47),this.mediaSession?.getSessionConfig().config.stopCallOnAcceptFailure&&this.stopInternal({terminatedReason:e,causeId:t,rejectReason:n}),r.terminatedReason=e,i.logFailure(r),r}}async reject(e=e9(),t){let i=t?{clientReasonSubCode:t.clientSubCode,clientReasonPhrase:t.clientPhrase}:{};return 1!==this.state?Promise.reject(60):this.stopInternal({terminatedReason:10,causeId:e,rejectReason:i})}async join(e,t={},i=e9()){let n=Date.now();return this.setInitialTelemetry("JoinCall",{callStartOptions:t,callStartTime:n},e.conversationUrl,i),this.setCallerMri(pT(e.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation("JoinCall"),this.signalingSession.signalingAgentConfig.enableSplitConversationEndUrl&&this.signalingSession.setFsmState(sr.SIGNALING_FSM_STATE.OUTGOING),this.joinOrStartCall({callStartOptions:pX(t),callStartTime:n},this.joinGivenConversation,i,e.conversationUrl)}async joinPreheatedCall(e,t){let i=this.logger.createFnLogger("JoinPreheatedCall",t),n=this.isServerMuted||(1&e.muteFlags)==1,r=(2&e.muteFlags)==2,s=pw(i);this.connectCallPromise=this._callOperationHandler.waitForOperation("JoinPreheatedCall");try{let a={endpointProperties:{preheatProperties:0}};this.setCallState(2,t),!this.isCallModeStreaming()&&n&&(a.state={isMuted:!0}),i.info(`captchaContentJson=${!!e.captchaContentJson} publishedStates=${!!e.publishedStates} muteFlags=${e.muteFlags}}`),await this.signalingSession.updateEndpointState(a,t,e.publishedStates,e.captchaContentJson),this.computeCallState(t),!this.isCallModeStreaming()&&(n||(await s.execute("UnmuteInput",()=>this.mediaSession.unmuteInputAsync(t)),this.setMuted(0,t)),r||(await s.execute("UnmuteOutput",()=>this.mediaSession.unmuteOutputAsync(t)),this.setSpeakerMuted(!1,t)))}catch(r){let e,n=7;return i.logFailure(`error: ${n} ${t_(r)}`),aW(r)?e=r:pI("UnmuteInput",r)?e={code:a7,subCode:oS,phrase:t_(r),causeId:t}:pI("UnmuteOutput",r)&&(e={code:a7,subCode:oy,phrase:t_(r),causeId:t}),this.callTelemetry.updateOperationData("JoinPreheatedCall",{phases:s.getTelemetryData(),error:tT(r)},t),this.stopInternal({causeId:t,terminatedReason:n,rejectReason:e}),Promise.reject(e)}}async start(e={},t=e9()){let i=Date.now();return this.setCallerMri(pS+this.currentUserSkypeIdentity.id),this.setInitialTelemetry("StartCall",{callStartOptions:e,callStartTime:i},"",t),this.connectCallPromise=this._callOperationHandler.waitForOperation("StartCall"),this.signalingSession.signalingAgentConfig.enableSplitConversationEndUrl&&this.signalingSession.setFsmState(sr.SIGNALING_FSM_STATE.OUTGOING),this.joinOrStartCall({callStartOptions:pX(e),callStartTime:i},this.startOutgoingCall,t)}async startCallToVoicemail(e,t=e9()){let i=Date.now();return this.setCallerMri(pS+this.currentUserSkypeIdentity.id),this.setInitialTelemetry("StartCallToVoiceMail",{callVoicemailStartOptions:e,callStartTime:i},"",t),this.connectCallPromise=this._callOperationHandler.waitForOperation("StartCallToVoiceMail"),this.joinOrStartCall({callVoicemailStartOptions:e,callStartTime:i},this.startVM,t)}async startSessionWithBot(e,t){return Promise.reject("method not implemented")}async joinCallWithoutCallModality(e,t={},i=e9()){let n=Date.now();this.setCallerMri(e.groupCallInitiator),this.setCallType(2,i);let r={callStartOptions:pX(t),callStartTime:n};return(this.setInitialTelemetry("Subscribe",r,e.conversationUrl,i),0!==this.state)?(this.logger.info(`[${i}][joinCallWithoutCallModality]Trying to subscribe to a call that has already been acted on`),Promise.reject(60)):(this.setCallOptions(r),this.setCallState(8,i),this.signalingSession.subscribeToCall(e.conversationUrl,this.callId,t.clientEndpointCapabilities,{meetingRegistrationId:t.meetingRegistrationId,participantPin:t.participantPin,clientEndpointDebugContent:t.clientEndpointDebugContent,additionalEndpointProperties:t.additionalEndpointProperties},i).catch(e=>aW(e)?(this.logger.info(`[${i}][joinCallWithoutCallModality] ${t_(e)}`),Promise.reject(e)):Promise.reject(pJ(e))),this._callOperationHandler.waitForOperation("Subscribe",void 0,i))}startWithMeetingData(e,t){let i=Date.now();return this.setCallerMri(pS+this.currentUserSkypeIdentity.id),this.setInitialTelemetry("StartWithMeetingData",{callStartOptions:t,callStartTime:i},"",e),this.connectCallPromise=this._callOperationHandler.waitForOperation("StartWithMeetingData"),this.joinOrStartCall({callStartOptions:pX(t),callStartTime:i,meetingPreferences:{shouldResurrect:t.shouldResurrect}},this.startOutgoingCall,e)}joinWithMeetingData(e,t,i){let n=Date.now();return this.setInitialTelemetry("JoinWithMeetingData",{callStartOptions:i,callStartTime:n},t.conversationUrl,e),this.setCallerMri(pT(t.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation("JoinWithMeetingData"),this.joinOrStartCall({callStartOptions:pX(i),callStartTime:n,meetingPreferences:{shouldResurrect:i.shouldResurrect}},this.joinGivenConversation,e,t.conversationUrl)}subscribeWithMeetingData(e,t,i){let n=Date.now();this.setCallerMri(t.groupCallInitiator),this.setCallType(2,e);let r={callStartOptions:pX(i),callStartTime:n};return(this.setInitialTelemetry("SubscribeWithMeetingData",r,t.conversationUrl,e),0!==this.state)?(this.logger.info(`[${e}][subscribeWithMeetingData]Trying to subscribe to a call that has already been acted on`),Promise.reject(60)):(this.setCallOptions(r),this.setCallState(8,e),this.signalingSession.subscribeToCall(t.conversationUrl,this.callId,i.clientEndpointCapabilities,{meetingPreferences:{shouldResurrect:i.shouldResurrect},meetingData:this.meetingData,meetingRegistrationId:i.meetingRegistrationId,participantPin:i.participantPin,additionalEndpointProperties:i.additionalEndpointProperties},e).catch(t=>aW(t)?(this.logger.info(`[${e}][subscribeWithMeetingData] ${t_(t)}`),Promise.reject(t)):Promise.reject(pJ(t))),this._callOperationHandler.waitForOperation("SubscribeWithMeetingData",void 0,e))}async startCallWithNudge(e,t={},i=e9()){this.setCallerMri(pS+this.currentUserSkypeIdentity.id),this.connectCallPromise=this._callOperationHandler.waitForOperation("StartCallWithNudge");let n=Date.now();if(this.logger.info(`[${i}][startCallWithNudge]startCallWithNudge for participants: ${to(e)}`),this.participants.length)return Promise.reject(48);if(t.isCast&&t.isHuddleGroupCall)return this.logger.logFailure(`isCast: ${t.isCast} isHuddleGroupCall: ${t.isHuddleGroupCall}`),Promise.reject(Error("isCast or isHuddleGroupCall can only be set exclusively."));let r={};return r.callStartOptions=pX(t),r.invitationType=sr.INVITATION_TYPE.NUDGE,r.participantsToNudge=e,r.callStartTime=n,this.setInitialTelemetry("StartCallWithNudge",r,"",i),this.joinOrStartCall(r,this.startOutgoingCall,i)}async startAndUnpark(e,t,i={},n=e9()){this.setCallerMri(pS+this.currentUserSkypeIdentity.id);let r=this.logger.createFnLogger("StartCallAndUnpark",n),s=Date.now();this.setInitialTelemetry("StartCallAndUnpark",{callStartTime:s},"",n),r.info(`startAndUnpark for context: ${e}, pickupCode :${t}`),this.connectCallPromise=this._callOperationHandler.waitForOperation("StartCallAndUnpark");let a={};switch(a.callStartOptions=pX(i),a.pickupCode=t,a.parkContext=s8,e){case 0:a.parkContext=s5;break;case 1:a.parkContext=s6;break;case 5:a.parkContext=s9;break;case 2:a.parkContext=s8;break;default:throw Error(`[startAndUnpark] unsupported ParkContext name: ${e}`)}return this.addParticipant(`4:${a.parkContext}`).catch(e=>r.logFailure("Failed to add participant to unparked call")),this.joinOrStartCall(a,this.startOutgoingCall,n)}async admitParticipant(e,t=e9()){let i=pE(e),n=this.getParticipant(i),r=this._getParticipantLegId(n),s=r?{participantLegId:r}:{};if(n&&7!==n.state){let i={code:0,subCode:3552,phrase:"Participant is not in lobby state"};return this.callTelemetry.maybeRecordOperationSuccess("AdmitParticipant",i,e,t,s),Promise.reject(i)}return this.admitParticipantToCall(i,t,r)}admit(e,t){return this.signalingSession.admitAsync(t)}async callMeBack(e,t,i=e9()){let n=pE(`${pS}${this.currentUserSkypeIdentity.id}`,this.currentUserSkypeIdentity.sipUri);return this.addCallMeBackParticipant(e,t||n,i)}async addParticipant(e,t={},i=e9()){return(await this.addParticipantsImpl([e],t,i,"addParticipant"))[0]}async addParticipants(e,t={},i=e9()){return this.addParticipantsImpl(e,t,i,"addParticipants")}async addParticipantsImpl(e,t={},i=e9(),n){if(this.logger.info(`[${i}][${n}] start`),this.isEmergency&&0===this.state&&(0!==this.participants.length||1!==e.length))return Promise.reject(Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"));if(t.participantInvitationData)try{JSON.stringify(t.participantInvitationData)}catch(e){throw this.logger.info(`[${i}][${n}] ${e}`),e}let r=[],s=[];if(e.forEach(e=>{let t=this.getOrCreateParticipant(e,i,!0);0===t.state||4===t.state?(s.push(t),r.push(this._participantOperationHandler.createPendingOperation("AddParticipant",t.id,i))):3===t.state?r.push(Promise.resolve(t)):this._participantOperationHandler.hasPendingOperationWithOperationId("AddParticipant",t.id)&&r.push(this._participantOperationHandler.waitForOperation("AddParticipant",t.id))}),0===s.length)return Promise.resolve(r);let a=!!t.disableUnmute,o=this.addParticipantsToCall(s,i,t.participantInvitationData,t.groupId,t.threadId,t.messageId,a,t.alternateId,t.customHeaderContext,t.callingLineIdentity,t.invitationPreferences);return(0,o5.zip)(o,s).forEach(async([e,t])=>{try{await e;let n=this._getParticipantLegId(this.getParticipant(t.id)),r=n?{participantLegId:n}:{};this.callTelemetry.recordOperationSuccess("AddParticipant",{code:0,subCode:0,phrase:""},t.id,i,r),this._participantOperationHandler.maybeResolveOperation("AddParticipant",t,t.id,i)}catch(e){this._participantOperationHandler.maybeRejectOperation("AddParticipant",e,t.id,i)}}),this.raiseChanged(this._participantChangedEventSkipConfig),Promise.resolve(r)}async nudgeParticipants(e,t,i={},n=e9()){return 2!==this.state&&3!==this.state?Promise.reject(48):this.signalingSession.nudgeParticipantsAsync({participantsIds:t,causeId:n,invitationData:i.participantInvitationData,newGroupId:i.groupId,newThreadId:i.threadId,newMessageId:i.messageId})}mapRemoveEndpointScope(e){switch(e){case 0:return"specified";case 1:return"all";default:return"none"}}mapEndpointScope(e){return 1===e?"all":"none"}async removeParticipant(e,t=e9(),i,n){let r=this.logger.createFnLogger("removeParticipant",t);r.info("start");let s=this.mapRemoveEndpointScope(n);return this.signalingSession.removeParticipantAsync({id:e,endpointId:i},t,s).catch(i=>(r.logFailure(`Participant was not removed from call, error=${i}`),Promise.reject(this._handleParticipantOperationFailure("RemoveParticipant",i,t,e).reason||38)))}async cancelNudge(e,t){throw Error("Method not implemented.")}async searchParticipants(e,t){return this.signalingSession.searchParticipantsAsync(e.searchQueryOptions,t)}async getAllParticipants(e,t){return this.signalingSession.getAllParticipantsAsync(e.scope,t)}set dominantSpeakerInfo(e){this.internalDominantSpeakerInfo=e}get dominantSpeakerInfo(){return this.internalDominantSpeakerInfo?this.internalDominantSpeakerInfo:this.mediaSession?.getSessionConfig().config.emptyInitialDSH?{speakerList:[],timestamp:null,noCurrentDominantSpeaker:!1}:{speakerList:this.participants.filter(e=>3===e.state).map(e=>e.id),timestamp:null,noCurrentDominantSpeaker:!1}}set slowedDownActiveTalkerInfo(e){(0,o5.isEqual)(this.internalSlowedDownActiveTalkerInfo?.speakerList,e.speakerList)||(this.internalSlowedDownActiveTalkerInfo=e,this.raiseChanged())}get slowedDownActiveTalkerInfo(){return this.internalSlowedDownActiveTalkerInfo}startVideoSafe(e){return this.startVideo(e).catch(t=>{this.logger.info(JSON.stringify(t),"startVideoSafe",e)})}async joinOrStartCall(e,t,i,n){let r=this.logger.createFnLogger("joinOrStartCall",i);if(0!==this.state&&8!==this.state&&!e.isPromotingToRealtime){let e="Trying to start a call that has already been acted on";return r.logFailure(e),Promise.reject(60)}if(this.signalingAgent.resolvePotentialCallConflict(this.signalingSession)===this.signalingSession)return Promise.reject(57);this.callStats.localStats.startCall();let s=8===this.state||1!==this.participants.length;r.info(`isMultiparty=${s}, reason: participants.length=${this.participants.length}`),this.setCallType(s?2:1,i),this.setCallUsesMixer(s,i),this._setMaxVbssChannels(e?.callStartOptions?.maxVbssChannels,i),this.setCallOptions(e);let a=e.callStartOptions||{};if((1&a.preheatFlags)==1)this.setMuted(2,i),this.setSpeakerMuted(!0,i),this.setCallState(11,i);else{let e=!!a&&(a.muted||(1&a.muteFlags)==1),t=a?.muteFlags?(2&a.muteFlags)==2:this.isSpeakerMuted;this.setMuted(e?2:+!!this.isServerMuted,i),this.setSpeakerMuted(t,i),this.setCallState(2,i)}let o=al(this.meetingData,this.threadId,this.messageId,this.groupId,!!n);this.callTelemetry.setJoinedFrom(o),this.signalingSession.setJoinedFrom(o),this.setHuddleGroupCall(!!e.callStartOptions?.isHuddleGroupCall);let l=this._callOperationHandler.createPendingOperation("_ConnectCall","",i);return l.catch(ah),await this.joinOrStartWithMedia(e,t,e.callStartTime,l,i,n),e.callStartOptions?.meetingRegistrationId&&this.callTelemetry.setHasMeetingRegistrationId(!0),e.callStartOptions?.participantPin&&this.callTelemetry.setHasParticipantPin(!0),l}setSessionIceTransportPolicy(e){let t=e?.connectionType,i=nu.ICE_TRANSPORT_POLICY.all;switch(t){case"AllSupported":i=nu.ICE_TRANSPORT_POLICY.all;break;case"NoDirectConnection":i=nu.ICE_TRANSPORT_POLICY.relay}this.mediaSession?.getSessionConfig().setIceTransportPolicy?.(i)}async joinOrStartWithMedia(e,t,i,n,r,s){let a=this.logger.createFnLogger("joinOrStartWithMedia",r);this.callStats.localStats.audio.start();let o=e.callStartOptions,l=o&&1&o.preheatFlags;if(this._startCallPhase=pw(a),e.callStartOptions?.sendMediaModalities&&(this.mediaStateConfigurationHelper=new p3(e.callStartOptions.sendMediaModalities)),this._preferredMpLocation){e.callStartOptions=e.callStartOptions||{};let t=e.callStartOptions.clientEndpointDebugContent?JSON.parse(e.callStartOptions.clientEndpointDebugContent):{};e.callStartOptions.clientEndpointDebugContent=JSON.stringify({preferredMpLocation:this._preferredMpLocation,...t})}try{let c;o&&!l&&this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)&&this.mediaStateConfigurationHelper.isSending(2)&&(this.setCallUsesMixer(!0,r),await this.getScreenHandle().acquire()),this.mediaStateConfigurationHelper.isSending(0)&&this.setAudioOn(!0,r),this.callUsesMixer||this.mediaStateConfigurationHelper.disableModality(2),a.info(`skipSharingModality=${!this.callUsesMixer}`),this._startCallPhase.executeSync("InitializeMediaSession",()=>this.initializeMediaSession(r,o?.mediaConfiguration)),this.updateSignalingDSHMessageSubscription(this.isInitialSignalingDSHSubscriptionEnabled()),this.mediaSession.getSessionConfig().config.alwaysNegotiateDataChannel&&this.mediaStateConfigurationHelper.enableModality(3),this.setSessionIceTransportPolicy(e?.callStartOptions?.mediaConfiguration),this.mediaSession.createAudioElement(r),this.callUsesMixer||s||this.isOneToOnePSTNCall()||e.callVoicemailStartOptions||this.setIsSomeoneStreamingVideo(!0);let d=this._callOperationHandler.createPendingOperation("_WaitForAnswer","",r,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]});d.catch(ah);let u=!1;e.isPromotingToRealtime?(this.isSpeakerMuted=!0,u=!0,await this._startCallPhase.execute("MuteInput",()=>this.mediaSession.muteInputAsync(r)),await this._startCallPhase.execute("MuteOutput",()=>this.mediaSession.muteOutputAsync(r))):o&&(l?(u=!0,await this._startCallPhase.execute("MuteInput",()=>this.mediaSession.muteInputAsync(r)),await this._startCallPhase.execute("MuteOutput",()=>this.mediaSession.muteOutputAsync(r)),this.setMuted(2,r),this.setCallUsesMixer(!0,r)):this.mediaStateConfigurationHelper.isSending(1)&&await this._startCallPhase.execute("StartVideoSafe",()=>this.startVideoSafe(r)));let h=[];if(!this.shouldSkipOfferGenerationForStreamingUser(e.isPromotingToRealtime)){o?.forceAudioSendModalityWithNullStream&&this.mediaSession.useNullAudioStreamClient();let e=await this._startCallPhase.execute("UpdateMediaModalities",()=>this.updateMediaModalities(void 0,r));if(!this.mediaSession?.createOfferAsync)throw{error:"NoMediaSession",phase:"CreateOffer"};c=await this._startCallPhase.execute("CreateOffer",()=>this.mediaSession.createOfferAsync(r)),h=this._startCallPhase.executeSync("GetSignalingMediaTypes",()=>this.getSignalingMediaTypes(this.calculateModalityDirections({},r))),this.mediaStateConfigurationHelper.isSending(2)&&this.updateScreenSharingState(e,r)}if(u||(await this._startCallPhase.execute("MuteUnmute",()=>this.muteUnmute(2===this._muteState,r)),await this._startCallPhase.execute("MuteUnmuteSpeakers",()=>this.muteUnmuteSpeaker(this.isSpeakerMuted,r))),this._startCallPhase.executeSync("CallStart",()=>t(r,e,c,h,i,s)),await this._startCallPhase.execute("WaitForConnect",()=>n),!this.isCallModeStreaming()||e.isPromotingToRealtime){let e=await this._startCallPhase.execute("WaitForAnswer",()=>d);if(!this.mediaSession?.processAnswerAsync)throw{error:"NoMediaSession",phase:"ProcessAnswer"};await this._startCallPhase.execute("ProcessAnswer",()=>this.mediaSession.processAnswerAsync(e,r,!1)),await this._startCallPhase.execute("CompleteNegotiation",()=>this.completeNegotiationAsync(r))}if(l){let e=this.signalingSession.getOriginalRoleBeforePreheat();a.info(`setSelfParticipantRole to originalRoleBeforePreheat=${e}`),"unknown"!==e&&this.callTelemetry.setSelfParticipantRole(e)}this.callTelemetry.updateOperationData("_ConnectCall",{phases:this._startCallPhase.getTelemetryData()},r),this._startCallPhase=void 0,(o?.screenshareDirection===2||o?.screenshareDirection===4)&&(this.allowScreenSharingControl()&&this.screenSharingControl.isInternalSharerControlEnabled()&&this.screenSharingControl.initControlForSharer(""),this.enableControlInjector())}catch(e){this.catchJoinOrStartCallError(e,r,a)}}catchJoinOrStartCallError(e,t,i){let n,r=0;throw i.logFailure(t_(e)),e?.error&&(n={...e.error}),pI("MuteInput",e)?(r=7,n={code:a7,subCode:om,phrase:t_(e),causeId:t}):pI("MuteOutput",e)?(r=7,n={code:a7,subCode:ov,phrase:t_(e),causeId:t}):e?.type===this.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer||p_(o3,e)?r=47:e?.type===this.mediaAgent.constants.MEDIA_ERROR.permissionDeniedError?(r=58,n={code:a5,subCode:oh,phrase:t_(e),causeId:t}):pI("WaitForAnswer",e)||pI("WaitForConnect",e)?r=e.error:p_(o2,e)&&(r=7),this.callTelemetry.updateOperationData("_ConnectCall",this.getTelemetryFromPhaseExecution(e),t),this._startCallPhase=void 0,this.callSetupFailed=!0,Promise.all([this._callOperationHandler.maybeRejectOperation("_WaitForAnswer",r,"",t),this._callOperationHandler.maybeRejectOperation("_ConnectCall",r,"",t)]).then(()=>{this.isPromotingToRealtime()||this.stopInternal({causeId:t,terminatedReason:r,rejectReason:n})}).catch(ah),r}addCallMeBackParticipant(e,t,i){let n=this._participantOperationHandler.waitForOperation("CallMeBack",e),r=this.logger.createFnLogger("CallMeBack",i),s={id:e,assertedId:t};return this.signalingSession.callMeBackAsync(s).then(()=>{r.logSuccess(`successfully executed call me back, participantId = ${ta(e)}`),this._participantOperationHandler.resolveOperation("CallMeBack",0,e)}).catch(n=>{r.logFailure(`Call me back failed, participantId = ${ta(e)}, error = ${n}`),this._handleParticipantOperationFailure("CallMeBack",n,i,t,!1);let s=this._processError(n),a={};s&&(a={...s}),a.failureReason=s.reason?s.reason:11,this._participantOperationHandler.rejectOperation("CallMeBack",a,e)}),n}addParticipantsToCall(e,t,i,n,r,s,a,o,l,c,d){let u=this.logger.createFnLogger("addParticipantsToCall",t);e.forEach(e=>{e.setState(1,void 0,t)});let h=e.map(e=>({id:e.mri}));u.info(`participantIds=${e.map(e=>ta(e.id))}, disableUnmute=${a} invitationPreferences=${!!d}`);let g={additionalData:i,groupId:n,threadId:r,messageId:s,disableUnmute:a,alternateId:o,customHeaderContext:l,callingLineIdentity:c,invitationPreferences:d};try{let e=this.signalingSession.addParticipantsAsync(h,g,t);return(0,o5.zip)(e,h).map(async([e,i])=>{try{let n=await e;this.signalingNotifications.onParticipantJoined(n,t);let r=this._getParticipantLegId(this.getParticipant(i.id)),s=r?{participantLegId:r}:{};this.callTelemetry.recordOperationSuccess("AddParticipant",{code:0,subCode:0,phrase:""},n.id,t,s)}catch(n){let e=this._handleParticipantOperationFailure("AddParticipant",n,t,i.id).reason;throw this._removeParticipant(i,t,e),e}})}catch(e){return u.logFailure(`Participants was not added to call, error=${e}`),(0,o5.range)(h.length).map(()=>Promise.reject(1))}}async mergeCallByAddParticipantWithReplaces(e,t,i,n,r,s,a,o){let l=this.logger.createFnLogger("mergeCallByAddParticipantWithReplaces",s),c=this.convertClientScenario(o),d={additionalData:e.additionalData,groupId:e.groupId,threadId:e.threadId,messageId:e.messageId,callIdToReplace:i.callId,replacementType:n,clientScenario:c},u=await this.signalingSession.addParticipantsAsync(t,d,s);for(let e=0;e<u.length;e++){let i=3===n?t[e].participantId:t[e].id;try{await u[e],l.logSuccess(` [participantInfos id =${ta(t[e].id)}]`);let n={debugContent:{replacementParticipantLegId:t[e].replacementParticipantId||void 0,clientScenario:c},participantLegId:t[e].participantId},a={code:0,subCode:0,phrase:""};this.callTelemetry.recordOperationSuccess(r,a,i,s,n),this._callOperationHandler.maybeResolveOperation(r,a,i,s)}catch(o){l.logFailure(`Participant was not added to call, error=${tT(o)}`);let n=this._handleParticipantOperationFailure(r,o,s,i,!0,c).reason;this._removeParticipant(t[e],s,n);let a=o?o.endCode:n||0;this._callOperationHandler.maybeRejectOperation(r,a,i,s)}}return Promise.resolve(a)}admitParticipantToCall(e,t,i){let n=this.logger.createFnLogger("admitParticipantToCall",t),r={id:e};return n.info("start"),this.signalingSession.admitParticipantAsync(r,t).then(r=>{n.info(`successfully admitted participant to call, participantId = ${ta(e)}`);let s=i?{participantLegId:i}:{},a={code:0,subCode:0,phrase:""};this.callTelemetry.recordOperationSuccess("AdmitParticipant",a,e,t,s)}).catch(i=>(n.logFailure(`Participant was not admitted to call, error=${i}`),Promise.reject(this._handleParticipantOperationFailure("AdmitParticipant",i,t,e))))}_processError(t){let i,n={reason:i};if(t?.endCode){let r=pQ(t.endCode.code,t.endCode.subCode);n.reason=i=e.getParticipantReasonFromTerminatedReason(r),n.code=t.endCode.code,n.subCode=t.endCode.subCode,n.resultCategories=t.endCode.resultCategories,n.phrase=t.endCode.phrase}else n.phrase=`${t}`;return this.logger.info(`_processError error=${t} telemetryData=${JSON.stringify(n)}`),n}_handleParticipantOperationFailure(e,t,i,n,r=!0,s){this.callTelemetry.updateOperationData(e,{error:tT(t)},i,n);let a=this._processError(t),o=this.getParticipant(n);a.code&&o&&(o.callEndDiagnosticsInfo={callControllerCode:a.code,callControllerSubCode:a.subCode,phrase:a.phrase,resultCategories:a.resultCategories});try{if(r){let t=this._getParticipantLegId(o),r={debugContent:{clientScenario:s},participantLegId:t||void 0};this.callTelemetry.recordOperationFailure(e,a,n,i,r)}}catch(e){this.logger.info(`_handleParticipantOperationFailure error during recordOperationFailure ${e}`)}return a}_getParticipantLegId(e){return(0,o5.has)(e,"endpoints.endpointDetails")&&e.endpoints.endpointDetails.length&&e.endpoints.endpointDetails[0].participantId?e.endpoints.endpointDetails[0].participantId:null}isOneToOnePSTNCall(e=!1){let t=this.signalingSession.isIncomingCall?this.callerMri:this.participants.length>0?this.participants[0].id:"";return this.isOneToOneCall(e)&&(0,o5.startsWith)(t,pb)&&(!this.incomingCallType||!this.callUsesMixer)}isParkedCall(){return this.isOneToOnePSTNCall()&&!!this.callOptions?.parkContext}async updateMediaModalities(e={},t=e9(),i){let n,r=this.logger.createFnLogger("updateMediaModalities",t);return r.info(`callUsesMixer=${this.callUsesMixer},isSomeoneSharing=${this.isSomeoneSharing},isSomeoneStreamingVideo=${this.isSomeoneStreamingVideo}`),r.info(`options=${tI(e)},requestHoldState=${this.requestedHoldState},requestedScreenSharingState=${this.mediaStateConfigurationHelper.isSending(2)}`),n=e.modalityOverride?e.modalityOverride:this.requestedHoldState&&!this.isMuteOnHold?this.getMediaModalitiesForHold(t):this.calculateModalityDirections(e?.offered,t),r.info(`modalities=${tI(n)}`),await this.mediaSession.configureModalitiesAsync(n,t,i),n}calculateModalityDirections(e={},t){let i=this.logger.createFnLogger("calculateModalityDirections",t);i.info(`callUsesMixer=${this.callUsesMixer}, isEscalationInProgress=${this.isEscalationInProgress}`);let n={audio:this.calculateAudioDirection(e.audio,i),video:this.calculateVideoDirection(e.video,i),sharing:this.calculateSharingDirection(e.sharing,i),data:this.calculateDataDirection(e.data,i)};return i.info(`done, modalities=${tI(n)}`),this.deleteExtraneousModalities(n,t),n}calculateAudioDirection(e,t){return(t.info(`calculateAudioDirection, offer=${e}, requestedAudioState=${this.mediaStateConfigurationHelper.isSending(0)}`),this.receiveOnlyAudioOnCallStart)?(t.info("calculateAudioDirection, direction=recvonly, receiveOnlyAudioOnCallStart=true"),"recvonly"):this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)||"inactive"===e?"inactive":this.mediaSession.getAllowedModalities().audio.some(e=>e===fm||e===fS)?"sendrecv":"sendonly"===e?"inactive":"recvonly"}calculateVideoDirection(e,t){let i=this.mediaStateConfigurationHelper.isSending(1);if(t.info(`calculateVideoDirection, offer=${e}, requestedVideoState=${i}, isSomeoneStreamingVideo=${this.isSomeoneStreamingVideo}`),this.mediaStateConfigurationHelper.isInactiveOrDisabled(0))return"inactive";let n=i,r=this.isSomeoneStreamingVideo||this.callUsesMixer||this.isEscalationInProgress;return(e&&(n=n&&("sendrecv"===e||"sendonly"===e),r=r&&("sendrecv"===e||"recvonly"===e)),n)?"sendrecv":r?"recvonly":"inactive"}calculateSharingDirection(e,t){return(t.info(`calculateSharingDirection, offer=${e}, requestedScreenSharingState=${this.mediaStateConfigurationHelper.isSending(2)}, isSomeoneSharing=${this.isSomeoneSharing}`),"inactive"===e)?"inactive":this.mediaStateConfigurationHelper.isSending(2)&&this.isMultiVBSSEnabled()?"sendrecv":this.mediaStateConfigurationHelper.isSending(2)?"sendonly":this.isSomeoneSharing||this.callUsesMixer||this.isEscalationInProgress?"recvonly":void 0}calculateDataDirection(e,t){let i=this.mediaStateConfigurationHelper.isSending(3);return(t.info(`calculateDataDirection, offer=${e}, dataEnabled=${i}`),this.allowDataChannel())?i?"inactive"===e?"inactive":"sendrecv":void 0:void t.info("calculateDataDirection, disabling data since ECS flag prohibits it")}getMediaModalitiesForHold(e){this.logger.info(`[${e}][getMediaModalitiesForHold]`);let t="inactive",i={audio:t,video:t,data:this.allowDataChannel()?t:void 0,sharing:t};return this.deleteExtraneousModalities(i,e),i}deleteExtraneousModalities(e,t){!mY(e.video)&&this.mediaStateConfigurationHelper.isDisabled(1)&&(this.logger.info(`[${t}][deleteExtraneousModalities] skipping videoModality`),delete e.video),!mY(e.sharing)&&this.mediaStateConfigurationHelper.isDisabled(2)&&(this.logger.info(`[${t}][deleteExtraneousModalities] skipping sharingModality`),delete e.sharing)}getSignalingMediaTypes(e){let t=e=>e===this.mediaAgent.constants.MEDIA_STATE.send||e===this.mediaAgent.constants.MEDIA_STATE.sendReceive,i=[];return e.audio&&e.audio!==this.mediaAgent.constants.MEDIA_STATE.inactive&&i.push("Audio"),t(e.video)&&i.push("Video"),e.sharing===this.mediaAgent.constants.MEDIA_STATE.send?i.push("ScreenSharer"):e.sharing===this.mediaAgent.constants.MEDIA_STATE.receive&&i.push("ScreenViewer"),i}enableControlInjector(){if(this.allowScreenSharingControl())if(this.getlocalScreenShareStream()){let e=this.mediaSession?.getLocalMediaTrackId("ScreenShare")??"";this.screenSharingControl.enableControlInjector(e)}else this.logger.warn("enableControlInjector: no local screenshare stream found")}createCallDeviceManager(){return new Sb(this.mediaAgent.getConfigProvider().config.allowVirtualDeviceInCall,this.mediaAgent.getDeviceManager(),this.logger.createChild("CallDeviceManager"),this.callStats,e=>this.isMediaSending(e))}initializeSignalingSession(t){if(this.signalingSession)return void this.logger.info("Session already exists!");let i=sr.CALL_STATUS;if(this.localSignalingParticipant={id:pE(`${pS}${this.currentUserSkypeIdentity.id}`,this.currentUserSkypeIdentity.sipUri),displayName:this.currentUserSkypeIdentity.displayName,endpointDetails:[],languageId:null,participantId:t,endpointId:null},this.accountConfiguration){if(this.localSignalingParticipant.applicationType=this.accountConfiguration.applicationType,this.callTelemetry.setApplicationType(this.accountConfiguration.applicationType),this.localSignalingParticipant.ring=this.accountConfiguration.ring,this.callTelemetry.setRing(this.accountConfiguration.ring),this.localSignalingParticipant.region=this.accountConfiguration.region,this.callTelemetry.setRegion(this.accountConfiguration.region),this.localSignalingParticipant.userHexCID=this.accountConfiguration.userHexCID,this.callTelemetry.setUserHexCID(this.accountConfiguration.userHexCID),this.localSignalingParticipant.partition=this.accountConfiguration.partition,this.callTelemetry.setPartition(this.accountConfiguration.partition),this.localSignalingParticipant.acsResourceId=this.accountConfiguration.acsResourceId,this.callTelemetry.setAcsResourceId(this.accountConfiguration.acsResourceId),this.callStats.setAcsResourceId(this.accountConfiguration.acsResourceId),this.accountConfiguration.serviceUrls){let e=this.accountConfiguration.serviceUrls.calling_conversationServiceUrl,t=this.accountConfiguration.serviceUrls.calling_uploadLogRequestUrl;this.signalingAgent.updateUrls(e,t,this.accountConfiguration.enforceUrls)}this.localSignalingParticipant.clientType=this.accountConfiguration.clientType,this.callTelemetry.setClientType(this.accountConfiguration.clientType)}this.callStats.localStats.setLocalUserId(this.localSignalingParticipant.id),this._callOperationHandler&&this._callOperationHandler.resetOperationChain(),this.signalingNotifications={onPromotionCompleted:(e,t,i)=>{this.logger.info(`[${i}][onPromotionCompleted] isFailed=${e} reason=${tI(t)} callMode=${this.callMode}`);let n=e?t:{code:0,subCode:0};if(this.callTelemetry.recordEvent("PromotionCompleted",{reason:n},i),e){let e=pJ(t);this._callOperationHandler.maybeRejectOperation("_WaitForAnswer",e,"",i),this._callOperationHandler.maybeRejectOperation("_CallStartOrJoinInitiated",e,"",i),this._callOperationHandler.maybeRejectOperation("_ConnectCall",e,"",i),this.promotionCompletedDeferred?.reject(e)}else this._callOperationHandler.maybeResolveOperation("_CallStartOrJoinInitiated",void 0,void 0,i),this._callOperationHandler.maybeResolveOperation("_ConnectCall",void 0,void 0,i);this.participants.forEach(e=>{e.applyCachedMediaStreams(i)})},onCallStatusChanged:(e,t,n=e9())=>{let r=this.logger.createFnLogger("onCallStatusChanged",n),s=`[status=${e}]`;if(t&&(s+=`[reason=${tI(t)}]`,void 0!==t.code&&(this.callEndDiagnosticsInfo={callControllerCode:t.code,callControllerSubCode:t.subCode,phrase:t.phrase,resultCategories:t.resultCategories},(t.overflowJoinInformation||t.registrationInformation)&&(this.callEndDiagnosticsInfo.additionalDiagnostics={overflowInformation:t.overflowJoinInformation,registrationInformation:t.registrationInformation}))),r.info(s),this.callTelemetry.recordEvent("_SignalingStateChanged",{status:e,reason:t},n),e===i.CONNECTING)this._callOperationHandler.maybeResolveOperation("_CallStartOrJoinInitiated",void 0,void 0,n);else if(e===i.RINGING)2===this.audioStreamState?(this.setCallState(9,n),this.participants.forEach(e=>e.setState(6,void 0,n))):this.participants.forEach(e=>e.setState(2,void 0,n)),this._callOperationHandler.maybeResolveOperation("Subscribe",void 0,void 0,n);else if(e===i.CONNECTED_FOR_ROSTER_ONLY)this._callOperationHandler.maybeResolveOperation("Subscribe",void 0,void 0,n),this._callOperationHandler.maybeResolveOperation("SubscribeWithMeetingData",void 0,void 0,n);else if(e===i.CONNECTED){this._callIsSetupComplete=!0;let e=this.getLocalSignalingEndpointDetails();(e?.isLobby||e?.streamLobby)&&(this._callInLobby=!0,this.updateCapabilities(n,!0));let t=this.signalingSession.participantManager.localParticipant.isStaging;if(11===this.state)this.setCallState(12,n);else if(this._callOperationHandler.hasPendingOperation("JoinPreheatedCall"))r.info("wait for joinPreheatedCall to resolved");else if(this._callInLobby)r.info("[inLobby] Override Connected state from signaling agent"),this.setCallState(10,n);else if(t)this.setCallState(13,n);else{if(3===this.state&&!this._callOperationHandler.hasPendingOperation("_CallStartOrJoinInitiated")&&!this._callOperationHandler.hasPendingOperation("_ConnectCall"))return void r.info("Return: Don't re-send setup telemetry if call was already connected and operations are completed");this.setCallState(3,n),this.handleRemoteParticipantStateInOneToOneCall(n)}this._callOperationHandler.maybeResolveOperation("_CallStartOrJoinInitiated",void 0,void 0,n),this._callOperationHandler.maybeResolveOperation("_ConnectCall",void 0,void 0,n),this.reportTsCallingTelemetry(!0)}else if(e===i.LOCAL_TERMINATED||e===i.REMOTE_TERMINATED){let s=this.callSetupFailed?7:pJ(t);if(8===this.state&&this._callOperationHandler.hasAtleastOneOfPendingOperation(["StartCall","JoinCall","StartWithMeetingData","JoinWithMeetingData"])){this.signalingSession.resetState(),this._callOperationHandler.maybeRejectOperation("Subscribe",s,void 0,n),this._callOperationHandler.maybeRejectOperation("SubscribeWithMeetingData",s,void 0,n),r.info("Subscribe failed, there is pending start/join operation, ignore call end message");return}if(1!==s&&t?.code===a5&&t?.subCode===oh&&(s=58,r.info(`[terminated][reason=${tI(t)}]`)),(2===this.state||6===this.state||8===this.state)&&this._callOperationHandler.hasAtleastOneOfPendingOperation(["StartCall","JoinCall","StartWithMeetingData","JoinWithMeetingData","Subscribe","SubscribeWithMeetingData"])){let e={code:this.callEndDiagnosticsInfo.callControllerCode,subCode:this.callEndDiagnosticsInfo.callControllerSubCode,phrase:this.callEndDiagnosticsInfo.phrase,reason:s};this._callOperationHandler.maybeRejectOperations(["Accept","JoinCall","JoinWithMeetingData","JoinPreheatedCall","StartCall","StartCallAndUnpark","StartCallToVoiceMail","StartCallWithNudge","StartWithMeetingData","Subscribe","SubscribeWithMeetingData"],s,void 0,n,e)}this.signalingSession.acceptedElsewhereBy&&(this.acceptedElsewhereBy={id:this.signalingSession.acceptedElsewhereBy.id,displayName:this.signalingSession.acceptedElsewhereBy.displayName}),this.signalingSession.parkAdditionalContextJson&&(this.parkAdditionalContextJson=this.signalingSession.parkAdditionalContextJson),this.signalingSession.serverHoldLocation&&(this.serverHoldLocation=this.signalingSession.serverHoldLocation),this._callOperationHandler.hasPendingOperation("CallParkV2")&&t.pickupCode&&0===t.code&&this._callOperationHandler.resolveOperation("CallParkV2",""+t.pickupCode,void 0,n),1!==s&&this.mediaRelayWhiteListingIssue&&(s=53,r.info(`[terminated][reason=${tI(t)}]`)),this._callOperationHandler.maybeRejectOperation("CallParkV2",s,"",n),this._callOperationHandler.maybeRejectOperation("_WaitForAnswer",s,"",n),this._callOperationHandler.maybeRejectOperation("_ConnectCall",s,"",n);let a=this.mediaSession?.getSessionConfig().config.setDisconnectAfterCleanUp;if(a?this.setTerminatedReason(s):this.setCallState(7,n,s),this.participants.forEach(e=>e.setState(4,void 0,n)),!this.disconnectingPromise){let s={...t,remoteTerminated:e===i.REMOTE_TERMINATED};this.disconnectingPromise=this.cleanUp(n,s).catch(e=>{r.logFailure(`Error when cleaning up the call, callId = ${this.callId}, error = ${e}`)})}a&&this.disconnectingPromise.finally(()=>{7!==this.state&&this.setCallState(7,n,s)})}},onAttachOffer:(e,t=e9())=>{this.logger.createFnLogger("onAttachOffer",t).info("Attach offer received"),this.customHeaderContext=e.customHeaderContext,this.invitationData=e.invitationData,this.clientTransferContext=e.clientTransferContext,this.spamRiskLevel=e.riskLevel,this.spamStirAttestation=e.stirAttestation,this.signalingNotifications.onOffer(e,t)},onOffer:(e,t=e9())=>{let i=this.logger.createFnLogger("onOffer",t);i.info(`${tI((0,o5.omit)(tl(e),"mediaContent","remoteParticipantId"))}`),this.setMediaLegId(e.mediaContent.mediaLegId),this.callTelemetry.recordEvent("_WebOnOffer",this.prepareTelemetryForOfferAnswer(e),t),e.transferor?.details?.id&&this.setTransferorMri(e.transferor.details.id),e.transferor?.transferorType&&(this.transferorType=e.transferor.transferorType),e.transferor?.details?.displayName&&(this.transferorDisplayName=e.transferor.details.displayName),e.mediaContent.isTwoPartyToMultiPartyEscalation&&this.setIsEscalationInProgress(!0,t),e.renegotiation?this.requestedHoldState&&this._pendingParkPromise?this.renegotiateIncoming(e.mediaContent,t):this._delayedElevationPending||this._delayedElevationQueued?(this.signalingSession.rejectRenegotiationAsync({},t),this.triggerDelayedReconnectIfNeeded(t,"onOffer")):this._callOperationHandler.executeChained(()=>this.renegotiateIncoming(e.mediaContent,t),"_RenegotiateIncoming",t,t,void 0,void 0,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}):(i.info("resolving attach / offer promise"),this.attachToCallAndGetOffer.resolve(e.mediaContent))},onNewOffer:(e,t=e9())=>{let i=this.logger.createFnLogger("onNewOffer",t);if(!this.newOfferRequestDeferred)return void i.info("callback received but new offer was not requested");i.info("onNewOffer"),this.newOfferRequestDeferred.resolve(e.mediaContent)},onAnswer:(e,t=e9())=>{let i=this.logger.createFnLogger("onAnswer",t);if(i.info(`${tI((0,o5.omit)(e,"mediaContent","remoteParticipantId"))}`),this.setMediaLegId(e.mediaContent.mediaLegId),this.callTelemetry.recordEvent("_WebOnAnswer",this.prepareTelemetryForOfferAnswer(e),t),e.renegotiation)i.info("resolving previous renegotiation promise"),this.renegotiationAnswerDeferred.resolve(e.mediaContent);else if(e.provisional){let i=this.isOneToOnePSTNCall()&&(0,o5.startsWith)(e.remoteParticipantId,pb);this.mediaSession.processAnswerAsync(e.mediaContent,t,!0,i)}else i.info("resolving final answer promise"),this._callOperationHandler.maybeResolveOperation("_WaitForAnswer",e.mediaContent,void 0,t),this.handleRemoteParticipantStateInOneToOneCall(t);e.provisional||!e.mediaContent.fromMixer||this.callUsesMixer||this._callOperationHandler.executeChained(async()=>{this.setCallUsesMixer(!0,t),this.mediaStateConfigurationHelper.isDisabled(2)&&this.mediaStateConfigurationHelper.removeModality(2),await this.updateMediaModalities(void 0,t);let e=!(this.isSomeoneSharing||this.isScreenSharingOn||this.isVideoOn);return(this.isOneToOnePSTNCall()?this.mediaSession.getSessionConfig().config.callElevationDelayReconnectPSTN:this.mediaSession.getSessionConfig().config.callElevationDelayReconnect)&&e?(i.info("Delayed elevation: pending"),this._delayedElevationPending=!0,Promise.resolve()):this.mediaSession.reconnectAsync(t,!0)},"_CallEscalatedToConference",t,t,void 0,void 0,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]})},onMediaAcknowledgementSuccess:(e,t=e9())=>{this.logger.info(`isRenegotiation: ${e}`,"onMediaAcknowledgementSuccess",t),this._callOperationHandler.resolveOperation("_MediaAcknowledgment",void 0,void 0,t)},onMediaAcknowledgementFailure:(e,t,i=e9())=>{this.logger.createFnLogger("onMediaAcknowledgementFailure",i).logFailure(tI(t)),this._callOperationHandler.rejectOperation("_MediaAcknowledgment",t,i)},onMediaRenegotiationRejection:(e,t=e9())=>{this.logger.createFnLogger("onMediaRenegotiationRejection",t).logFailure(tI(e)),this.renegotiationAnswerDeferred.reject(e)},onRosterHandlingComplete:()=>{this.logger.info(`[onRosterHandlingComplete] ${this._publishedStatesModified}`),0!==this._publishedStatesModified&&(this.processPublishedStates(),this._publishedStatesModified=0)},onMeetingGroupDetailsUpdated:(e,t=e9())=>{this.meetingGroupDetails!==e&&(this.callTelemetry.recordEvent("_UpdateMeetingGroupDetails",e,t),this.logger.info(`[${t}][onMeetingGroupDetailsUpdated] update meetingGroupDetails from ${JSON.stringify(this.meetingGroupDetails)} to ${JSON.stringify(e)}`),this.meetingGroupDetails=e,this.raiseChanged())},onSelfParticipantUpdated:(e,t=e9())=>{this.logger.info(`[${t}][onSelfParticipantUpdated]`),this.updateLocalParticipant(e,t),this.raiseChanged()},onParticipantMriUpdated:(e,t,i=e9())=>{this.logger.info(`[${i}][onParticipantMriUpdated]`);let n=this.getParticipant(e);n&&(n.id=t,this.raiseChangedDeferred())},onParticipantUpdated:(t,i=e9())=>{this.logger.info(`[${i}][onParticipantUpdated]: ${fl(t)}`);let n=this.getOrCreateParticipant(t.id,i,!0);n.displayName=t.displayName;let r=e.getStreamsFromEndpoints(t.endpointDetails,this.isMultiVBSSEnabled()),s=(0,o5.some)(t.endpointDetails,e=>e?.streamInformation);this.callUsesMixer||r.length>0||s?(this.updateParticipantStreams(n,t,r,i),this.updateCallParticipantFromSignalingParticipant(n,t,i)):n.setState(3,void 0,i),n.processParticipantDetails(t,this.getSelfClientEndpointCapabilities(),()=>{this.signalingSession?.setStreamInformationReceived()}),this.updatePublishedStates(t),this.calculateIsSomeoneStreaming(i),this.raiseChangedDeferred()},onParticipantRemoved:(e,t=e9(),i=!1)=>{if(this.logger.info(`[${t}][onParticipantRemoved]`),i){let i=this.getParticipant(e.id);this.callTelemetry.recordOperationSuccess("_ParticipantJoined",null,i?.id,t,{participantJoinedButReplaced:"Participant joined with original MRI and replaced with participant of RNL MRI"})}else this.callTelemetry.recordOperationSuccess("RemoveParticipant",null,e.id,t),this._participantOperationHandler.maybeRejectOperation("AddParticipant",1,e.id,t);this._removeParticipant(e,t),this.removePublishedStatesByParticipant(e.id),this.calculateIsSomeoneStreaming(t)},onParticipantJoined:(t,i=e9())=>{this.logger.info(`[${i}][onParticipantJoined]`);let n=!this.getParticipant(t.id),r=this.getOrCreateParticipant(t.id,i,!1);r.displayName=t.displayName,0===r.state&&r.setState(1,void 0,i);let s=e.filterVirtualEndpoints(t.endpointDetails),a=e.getStreamsFromEndpoints(s,this.isMultiVBSSEnabled()),o=(0,o5.some)(t.endpointDetails,e=>e?.streamInformation);this.callUsesMixer||a.length>0||o?(this.updateParticipantStreams(r,t,a,i),this.updateCallParticipantFromSignalingParticipant(r,t,i),this.calculateIsSomeoneStreaming(i)):(this.handleRemoteParticipantJoinedInOneToOneCall(t,i),this.handleRemoteParticipantStateInObservingCall(r,t,i),t.acceptedBy&&t.acceptedBy!==t.id&&(r.acceptedBy=t.acceptedBy)),this.callTelemetry.recordOperationSuccess("_ParticipantJoined",ao(t.endpointDetails),r.id,i),r.processParticipantDetails(t,this.getSelfClientEndpointCapabilities(),()=>{this.signalingSession?.setStreamInformationReceived()}),this.updatePublishedStates(t),n&&this.event("participantAdded").raise(r),this.raiseChangedDeferred()},onCallModeChanged:(e,t)=>{this.callTelemetry.recordEvent("_CallModeChanged",{newCallMode:e,oldCallMode:this._callMode},t),this.logger.info(`onCallModeChanged[${t}]: new=${e} old=${this._callMode} `),e&&this._callMode!==e&&(this._callMode=e,this.isCallModeStreaming()&&this.cleanUpDueToStreaming(t),1===this._callMode&&(this.participants.forEach(e=>{e.applyCachedMediaStreams(t)}),this.promotionCompletedDeferred?.resolve()),this.monitorCallStart(),this.updateCapabilities(t),this.raiseChanged())},getRemoteParticipantCollection:()=>this.participants.map(e=>e.toCafeParticipant()),onReTargetCompletedSuccess:e=>{let t=this.logger.createFnLogger("onReTargetCompletedSuccess",e);t.info(`started, isEscalationInProgress=${this.isEscalationInProgress}`),this.callTelemetry.recordEvent("_WebRetargetSuccess",void 0,e),this.callStats.localStats.call.event(3);let i=this.isEscalationInProgress;this.screenSharingControl&&this.screenSharingControl.shutdownControlForViewer(),this.updateSignalingDSHMessageSubscription(this.isInitialSignalingDSHSubscriptionEnabled()),this.mediaSession.completeEscalationAsync(e).then(()=>(t.logSuccess("completeEscalationAsync"),this.callTelemetry.recordEvent("_WebOnEscalationSuccess",void 0,e),this.handleCallEscalation(i,e),this.updateMediaStatus(e))).catch(i=>{t.logFailure(`completeEscalationAsync, error=${t_(i)}`),this.setIsEscalationInProgress(!1,e),this.callTelemetry.recordEvent("_WebOnEscalationFailure",tT(i),e),this.stopInternal({causeId:e,terminatedReason:47})})},onReTargetCompletedFailure:(e,t)=>{this.logger.createFnLogger("onReTargetCompletedFailure",t).logFailure(`reason=${t_(e)}, isEscalationInProgress=${this.isEscalationInProgress}`),this.callTelemetry.recordEvent("_WebRetargetFailure",tT(e),t),this.isEscalationInProgress&&(this.setIsEscalationInProgress(!1,t),this.setCallUsesMixer(!1,t),this.updateMediaStatus(t)),this.callStats.localStats.call.event(4),this.mediaSession.rejectEscalationAsync(e,t)},onChatModalitySetupFailed:e=>{this.logger.debug(`onChatModalitySetupFailed: ${e}`)},onConversationUpdated:(e,t)=>{this.logger.info(`onConversationUpdated[${t}]: ${JSON.stringify(tl(e,["organizerId","meetingData"]))}`),this.setConversationType(e.conversationType,t),this._onMessageIdChanged(e.teamsMessageId,t),this.setGroupId(e.groupId,t),this.setThreadId(e.threadId,t),this.setBackroomThreadId(e.backroomThreadId,t),this.setStreamThreadId(e.streamThreadId,t),this.setLobbyThreadId(e.lobbyThreadId,t),this.setCallType(e.isMultiParty?2:1,t),this.setMeetingLayoutDetails(e.meetingLayoutDetails,t),this.setCompositionServiceDetails(e.compositionServiceDetails,t),this._commandUrlPresence=e.commandUrlPresence,this.updateCapabilities(t),this.region=e.region,this.setMeetingData(e.meetingData),this.meetingInfo=e.meetingInfo,this.callLimits=e.callLimits,this.setComplianceRecordingContent(t,e.complianceRecordingContent),this.setHuddleGroupCall(e.isHuddleGroupCall),this.onConversationStartTimeChanged(e.conversationStartTime,t),this.raiseChanged()},onMeetingDetailsUpdated:e=>{this.meetingDetails=e,this.mediaSession&&!this.enableRealtimeTelemetry&&this.meetingDetails.meetingCapability?.enableRealtimeTelemetry&&(this.mediaSession.enableTeamsRealTimeTelemetry(),this.enableRealtimeTelemetry=!0),this.raiseChanged()},onMeetingStatesUpdated:e=>{(0,o5.isEqual)(e,this.meetingStates)||(this.meetingStates=e,this.logger.info(`[onMeetingStatesUpdated] meetingStates updated to ${JSON.stringify(this.meetingStates)}`),this.raiseChanged())},onParticipantCountsUpdated:e=>{(0,o5.isEqual)(e,this.participantCounts)||(this.participantCounts={...s7,...e},this.event("participantCountsUpdated").raise(this.participantCounts),this.mediaSession?.processNotification("ParticipantCountChanged",{count:e.totalParticipants}))},updateIsSharedLineAppearanceV2Activated:e=>{this.isSharedLineAppearanceV2Activated!==e&&(this.logger.info(`_updateIsSharedLineAppearanceV2Activated: new value is ${e}`),this.isSharedLineAppearanceV2Activated=e,this.event("sharedLineAppearanceV2ActivatedChanged").raise(this.isSharedLineAppearanceV2Activated))},onBroadcastMeetingUpdated:e=>{e&&(this.broadcastMeeting&&this.broadcastMeeting.metadataChanged(JSON.stringify(e)),this.broadcastMetadata=e,this.raiseChanged())},onBroadcastMeetingConnected:(e,t)=>{this.logger.info(`[${t}][onBroadcastMeetingConnected]`),this._callOperationHandler.hasPendingOperation("AddBroadcastModality")&&(0===e.code?this._callOperationHandler.resolveOperation("AddBroadcastModality",e,t):this._callOperationHandler.rejectOperation("AddBroadcastModality",e,t))},onBroadcastMeetingEnded:(e,t)=>{this.logger.info(`[${t}][onBroadcastMeetingEnded]`),this._callOperationHandler.hasPendingOperation("AddBroadcastModality")&&this._callOperationHandler.rejectOperation("AddBroadcastModality",e,t),this.signalingSession.endBroadcastMeeting(t)},onTransferRequested:(e,t)=>{let i=this.logger.createFnLogger("onTransferRequested",t);i.info("Transfer: onTransferRequested, target participant",fl(e.target));let n="",r="",s=0;"voicemail"===e.target.endpointType&&(s=2);try{n=e.target.id,r=e.transferor.details.id,e&&e.parkType&&"none"!==e.parkType&&(s=1)}catch(e){i.logFailure(e),this.callTelemetry.recordEvent("_OnTransferRequestedInvalid"),this.signalingSession.signalTransferCompletedAsync({code:pY(7)});return}let a=this.convertToTransferType(s,e.parkType),o={transferContext:{transferorMri:r,targetMri:n,transferType:s,context:{target:e.target,transferor:e.transferor,transferContext:e.transferContext,newCallModalities:e.newCallModalities,links:e.links,replacementDetails:e.replacementDetails,isConsultative:e.isConsultative,callAcceptanceCallback:()=>{i.logSuccess("Transfer: callAcceptanceCallback called"),this.signalingSession.signalTransferAcceptedAsync(a)}}},onCompleted:e=>{i.logSuccess("Transfer: onCompleted called"),this.signalingSession.signalTransferCompletedAsync({code:pY(e)})}};this.callTelemetry.recordEvent("_OnTransferRequested",{transferType:s}),this.event("transferRequested").raise(o)},onTransferredCallAcceptance:e=>{let t=this.logger.createFnLogger("onTransferredCallAcceptance",e);this._transferredCallAcceptanceCallback&&(t.info("[Transfer] Invoke call acceptance callback for original call"),this._transferredCallAcceptanceCallback())},onTransferAccepted:e=>{this.logger.info("Transfer: onTransferAccepted"),this._callOperationHandler.hasPendingOperation("_CallTransferInProgress")&&this._setTransferState(2),this._callOperationHandler.hasPendingOperation("BlindTransfer")&&this._callOperationHandler.maybeResolveOperation("_CallTransferInProgress",void 0,void 0,e),this._callOperationHandler.hasPendingOperation("ParkCall")&&this._setParkState(2)},onTransferCompleted:(e,t)=>{let i=this.logger.createFnLogger("onTransferCompleted",t);i.info("Transfer: onTransferCompleted");let n=e.transferCompletion,r=pJ(n);if(n&&(i.info(`Transfer: Call Transfer Code: ${n.code}`),0===n.code)){if(this._callOperationHandler.hasPendingOperation("_CallTransferInProgress")&&(this._callOperationHandler.resolveOperation("_CallTransferInProgress",void 0,void 0,t),this._setTransferState(3)),this._callOperationHandler.hasPendingOperation("ConsultativeTransferWithPickupCode")){let e={code:0,subCode:0,phrase:"TransactionComplete"};this._callOperationHandler.resolveOperation("ConsultativeTransferWithPickupCode",e,void 0,t),this._setTransferState(3)}this._callOperationHandler.hasPendingOperation("ParkCall")&&(e.unparkContent?.CallParkAdditionalContext?.ConversationControllerLocation&&(this.serverHoldLocation=e.unparkContent.CallParkAdditionalContext.ConversationControllerLocation),e.unparkContent?.pickupCode!==void 0?(this._callOperationHandler.resolveOperation("ParkCall",e.unparkContent.pickupCode,void 0,t),i.logSuccess(`pickupCode=${e.unparkContent.pickupCode}`),this._setParkState(3)):(this._callOperationHandler.rejectOperation("ParkCall",32,t),i.logFailure(`terminatedReason=${r}`),this._setParkState(4)));return}if(this._callOperationHandler.hasPendingOperation("_CallTransferInProgress")&&(this._callOperationHandler.rejectOperation("_CallTransferInProgress",r,void 0,t),i.logFailure(`terminatedReason=${r}`),this.transferDiagnosticsInfo={callControllerCode:n.code,callControllerSubCode:n.subCode,phrase:n.phrase,resultCategories:n.resultCategories},this._setTransferState(4)),this._callOperationHandler.hasPendingOperation("ConsultativeTransferWithPickupCode")){let e={code:n.code,subCode:n.subCode,resultCategories:n.resultCategories};this._callOperationHandler.rejectOperation("ConsultativeTransferWithPickupCode",e,void 0,t)}this._callOperationHandler.hasPendingOperation("ParkCall")&&(this._callOperationHandler.rejectOperation("ParkCall",r,void 0,t),i.logFailure(`terminatedReason=${r}`),this.transferDiagnosticsInfo={callControllerCode:n.code,callControllerSubCode:n.subCode,phrase:n.phrase,resultCategories:n.resultCategories},this._setParkState(4))},onParkCompleted:(e,t)=>{this.logger.createFnLogger("onParkCompleted",t).info(`transactionEnd ${t_(e)}`),this._callOperationHandler.hasPendingOperation("CallParkV2")?0===e.code&&e.unparkContent?.pickupCode!==void 0?(this._callOperationHandler.resolveOperation("CallParkV2",""+e.unparkContent?.pickupCode,void 0,t),this.callTelemetry.maybeRecordOperationSuccess("CallParkV2"),this.serverHoldLocation=e.unparkContent?.CallParkAdditionalContext?.ConversationControllerLocation,this.parkAdditionalContextJson=JSON.stringify(e.unparkContent.CallParkAdditionalContext)):this._callOperationHandler.rejectOperation("CallParkV2",e,t):this._callOperationHandler.hasPendingOperation("ParkCall")&&(0===e.code?(this._callOperationHandler.resolveOperation("ParkCall","",void 0,t),this._setParkState(3)):(this._callOperationHandler.rejectOperation("ParkCall",e,t),this._setParkState(4)))},onUnparkCompleted:(e,t)=>{this.logger.createFnLogger("onUnparkCompleted",t).info(`transactionEnd ${t_(e)}`),this._callOperationHandler.hasPendingOperation("UnparkCall")&&(0===e.code?this._callOperationHandler.resolveOperation("UnparkCall",e,void 0,t):this._callOperationHandler.rejectOperation("UnparkCall",e,t))},onIncomingCallReplacement:(e,t)=>{let i=this.logger.createFnLogger("onIncomingCallReplacement",t);this.callTelemetry.recordEvent("_onIncomingCallReplacement",{},t),e.callNotification.callType="replaces",e.callNotification.consultativeCallId=this.callId,i.info(`consultativeCallId=${this.callId}`),e.body={gp:e,evt:oL.INCOMING_SKYPE_NGC_CALL,nsp:void 0},this.event("replacementRequested").raise(e)},onContentSharingStopped:e=>{for(let t of(this.logger.debug("ScreenSharing: onContentSharingStopped"),this.mediaAgent.getDeviceManager()?.effectsManager.signalContentSharingStateChanged(!1),this.contentSharingSessions))t.contentSharingGuid===e.correlationId&&(t.contentSharingStatus=7)},onContentSharingStarted:e=>{this.logger.debug("ScreenSharing: onContentSharingStarted");let t=new fz(this.callTelemetry,this.logger.createChild("ContentSharingSession"),this.signalingSession,e.correlationId||iW(),e.contentIdentifier,e.sessionState,e.subject,e.sessionId);t.contentSharingStatus=2,this.contentSharingSessions.push(t),this.mediaAgent.getDeviceManager()?.effectsManager.signalContentSharingStateChanged(!0),t.changed(()=>this.removeContentSessionIfEnded(t)),this.event("contentSharingChanged").raise()},onContentSharingUpdated:e=>{this.logger.debug("ScreenSharing: onContentSharingUpdated");let t=(0,o5.find)(this.contentSharingSessions,t=>t.contentSharingGuid===e.correlationId);if(!t)return void this.logger.warn("onContentSharingUpdated: session not found");e.presenter&&(t.presenterId=e.presenter),e.subject&&t.subject!==e.subject&&(t.subject=e.subject),e.sessionState&&t.contentSharingState!==e.sessionState&&(t.contentSharingState=e.sessionState),3===t.contentSharingStatus&&this.localSignalingParticipant.id!==e.presenter?t.contentSharingStatus=5:5===t.contentSharingStatus&&this.localSignalingParticipant.id===e.presenter&&(t.contentSharingStatus=3)},onWebRtcMediaNotification:(e,t)=>{this.mediaSession?.processNotification(e,t)},onCorrelationIdUpdated:(e,t)=>this.checkForCallIdUpdate(e,t),onUnmuteRequested:e=>void 0,onCallForwarded:e=>{e&&e.destinationType!==this.forwardingDestinationType&&(this.forwardingDestinationType=e.destinationType,this.raiseChanged())},onPSTNBalanceUpdate:e=>void 0,isOneToOnePstnCall:()=>this.isOneToOnePSTNCall(),onUpdateMeetingLiveStateCompleted:(e,t,i)=>{this.logger.info(`[onUpdateMeetingLiveStateCompleted] [${t}] transactionEnd ${t_(e)}`),this.onOperationCompleteCommonHandler(e,t,"UpdateMeetingLiveState",i)},onUpdateMeetingStatesCompleted:(e,t,i)=>{this.logger.info(`[onUpdateMeetingStatesCompleted] [${t}] transactionEnd ${t_(e)}`),this.onOperationCompleteCommonHandler(e,t,"UpdateMeetingStates",i)},onUpdateMeetingGroupsCompleted:(e,t,i)=>{this.logger.info(`[onUpdateMeetingGroupsCompleted] [${t}] transactionEnd ${t_(e)}`),this.onOperationCompleteCommonHandler(e,t,"UpdateMeetingGroups",i)},onSetMeetingLayoutCompleted:(e,t,i)=>{this.logger.info(`[onSetMeetingLayoutCompleted] causeId [${t}] operationId: ${i}`),this.onOperationCompleteCommonHandler(e,t,"SetMeetingLayout")},onJoinMeetingGroupCompleted:(e,t,i)=>{this.logger.info(`[onJoinMeetingGroupCompleted] [${t}] transactionEnd ${t_(e)}`),this.onOperationCompleteCommonHandler(e,t,"JoinMeetingGroup",i)},onLeaveMeetingGroupCompleted:(e,t,i)=>{this.logger.info(`[onJoinMeetingGroupCompleted] [${t}] transactionEnd ${t_(e)}`),this.onOperationCompleteCommonHandler(e,t,"LeaveMeetingGroup",i)},onBreakoutDetailsUpdated:(e,t)=>{this.logger.info(`[onBreakoutDetailsUpdated] [${t}]`),this.breakoutDetails=e,this.raiseChanged()},onIncomingProxiedMessages:(e,t)=>{this.logger.info(`[onIncomingProxiedMessages] [${t}] payload ${t_(e,!0)}`),this.event("incomingProxiedMessages").raise(e)},onUpdateParticipantsPropertiesCompleted:(e,t,i)=>{for(let t of(this.logger.createFnLogger("onUpdateParticipantsPropertiesCompleted",i).info(`promisesToResolve ${ta(tI(e))}`),Object.keys(e)))e[t].code===ag?this._callOperationHandler.maybeResolveOperation("UpdateParticipantsProperties",e[t],t,i):this._callOperationHandler.maybeRejectOperation("UpdateParticipantsProperties",e[t],t,i)},onUpdateMonitorSessionCompleted:(e,t)=>{this.logger.info(`[onUpdateMonitorSessionCompleted] [${t}] transactionEnd ${t_(e)}`),this.onOperationCompleteCommonHandler(e,t,"UpdateMonitorSession")},onNudgeToJoinRealtime:e=>{if(this.logger.info("[onNudgeToJoinRealtime]",e),this.callTelemetry.recordEvent("NudgeToJoinRealTime",e),pP(this.state,[11,12]))return void this.logger.info(`[onNudgeToJoinRealtime][${e}] skipped - call is in ${this.state} state`);this.canPromoteToRealTime(1)&&this.promoteToRealtime(1,e).then(()=>this.logger.info(`[onNudgeToJoinRealtime][${e}] completed`)).catch(t=>this.logger.info(`[onNudgeToJoinRealtime][${e}] failed to auto promote: ${t_(t)}`))},onConversationTypeUpdated:(e,t)=>{this.logger.info(`[onConversationTypeUpdated] [${t}] conversationType ${e}`),this.setConversationType(e,t)}};let n=Object.create(this.localSignalingParticipant);this.signalingSession=this.signalingAgent.getNewSignalingSession(n,this.signalingNotifications,this.callId,this._callCreationTime),this.signalingSession.participantManager.setEnableMuteAsync(this._enableMuteAsync),this.signalingSession.participantManager.setEnableUnmuteAsync(this._enableUnmuteAsync),this.accountConfiguration&&this.accountConfiguration.deviceType&&this.signalingSession.setDeviceType(this.accountConfiguration.deviceType),this.setCallId(this.callId||this.signalingSession.correlationId),this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&(this.setDisplayName(this.signalingSession.participantManager.localParticipant.displayName),this.setEndpointId(this.signalingSession.participantManager.localParticipant.endpointId),this.setParticipantId(this.signalingSession.participantManager.localParticipant.participantId),this.callStats.setParticipantId(this.participantId))}updateParticipantStreams(t,i,n,r){let s=e.getNegotiationTagsFromEndpoints(i.endpointDetails);t.updateStreams(n,r,this.isCallModeStreaming(),s,this.isMultiVBSSEnabled());let a=this.getStreamInformationMap(i);this.logger.info(`[updateParticipantStreams]: streaming mode with new streamInfoMap: ${tI(a)}`);let o={callId:this.callId,participantId:this.participantId,endpointId:this.endpointId};this.meetingData&&(o.meetingId=this.meetingData.meetingCode);let l=this.telemetryLoggers?this.telemetryLoggers.tlePlayer:null;t.useUmsStream(a,this._liveStreamConfigProvider,o,this.threadId,l,r)}cleanUpDueToStreaming(e){this.logger.info(`cleanUpDueToStreaming[${e}]: cleaning streams and media and canceling cc operations`),this.cancelAllCallingOperationsDueToStreaming(e);let t={code:a0,subCode:ol,phrase:oW};this.participants.forEach(t=>t.updateStreams([],e,this.isMultiVBSSEnabled())),this.cleanUpMedia(e,t).then(()=>{this.callTelemetry.recordOperationSuccess("_MediaCleanUp")}).catch(t=>{this.callTelemetry.recordOperationFailure("_MediaCleanUp",{error:tT(t)},e)}).finally(()=>{this.mediaDisposedPromise=null}),this.finishCallHoldResume(t),this.renegotiationAnswerDeferred?.reject(t),this.newOfferRequestDeferred?.reject(t),this._parkState=0,this._transferState=0,this.isServerMuted||(this._muteState=0),this.isSpeakerMuted=!1,this.requestedHoldState=!1,this.isMuteOnHold=!1}cancelAllCallingOperationsDueToStreaming(e){this._callOperationHandler.maybeRejectPendingOperationsWithPredicate(74,e,(e,t)=>(0,o5.some)(t?.preconditionTags,e=>"NOT_SUPPORTED_IN_STREAMING_MODE"===e))}onOperationCompleteCommonHandler(e,t,i,n){0===e.code?this._callOperationHandler.maybeResolveOperation(i,e,n,t):this._callOperationHandler.maybeRejectOperation(i,e,n,t)}convertToTransferType(e,t){let i="none";return 1===e&&t&&"none"!==t?"teamPark"===t?i="TransferTypeTeamPark":"sharedLinePark"===t?i="TransferTypeSharedLinePark":"serverHold"===t&&(i="TransferTypeServerHold"):0===e?i="TransferTypeStandard":2===e?i="TransferTypeVoicemail":this.logger.info(`Irrelevant combination of transferTye: ${e} and parkType: ${t}`),i}raiseChangedDeferred(e){this.raiseChangedDefer&&(!this.raiseChangedDefer.isSkippable||e)||(fp.instance.runDeferredWithoutDedup(()=>{delete this.raiseChangedDefer,this.raiseChanged(e)},"Call.raiseChanged"),this.raiseChangedDefer={isSkippable:!!e})}static getStreamsFromEndpoints(t,i){if(!t)return[];let n=e.filterVirtualEndpoints(t);return n.forEach(e=>{e.mediaStreams=i?e.mediaStreams:e.mediaStreams?.filter(e=>e.type!==fE),(0,o5.forEach)(e.mediaStreams,t=>{t.participantId=e.participantId,t.endpointId=e.endpointId})}),(0,o5.flatMap)(n,e=>e&&e.mediaStreams||[])}preconditions(e,t){this.logger.info(`check call mode currentMode is ${this.callMode} operationName is ${e}`),(0,o5.some)(t,e=>"NOT_SUPPORTED_IN_STREAMING_MODE"===e)&&this.isCallModeStreaming(!0)}mapCallSetupIntent(e){switch(e){case 0:return"None";case 1:return"AutoPromotion";case 2:return"PromotionWithAudio";case 3:return"PromotionWithVideo";default:return"Unknown"}}async promoteToRealtime(e,t){this.logger.info(`[${t}][promoteToRealtime] started with intent=${e}`);let i=this.getPromoteToRealtimeCallOptions(e,this.callOptions);this.callTelemetry.updateOperationData("_PromotionToRealtime",{intent:e},t),this.callTelemetry.recordEvent("StartPromotion",{intent:this.mapCallSetupIntent(e)},t);try{this.promotionCompletedDeferred=new iE,await Promise.all([this.joinOrStartCall(i,this.joinGivenConversation,t,void 0),this.promotionCompletedDeferred.promise])}catch(e){throw this.logger.logFailure(`[${t}][promoteToRealtime] failed with reason=${t_(e)}`),this.cleanUpDueToStreaming(t),this.signalingSession.cleanUpDueToStreaming(t),e}}async promoteToRealtimeAndUnmute(e){return(this.logger.info(`[${e}][promoteToRealtimeAndUnmute]`),this.isPromotingToRealtime())?(this.logger.info(`[${e}][promoteToRealtimeAndUnmute] already promoting to realtime.`),this._callOperationHandler.waitForOperation("_PromotionToRealtime").then(()=>this.muteUnmute(!1,e))):this.canPromoteToRealTime(2)?(this.unmutePendingPromise=new iE,setTimeout(()=>{this.unmutePendingPromise?.reject("promoteToRealtime unmute timed out")},1e3*this.signalingSession.signalingAgentConfig.csaTimeoutConfiguration.promotionUnmuteTimeoutSec),Promise.all([this.promoteToRealtime(2,e),this.unmutePendingPromise.promise]).then(()=>{}).finally(()=>this.unmutePendingPromise=null)):Promise.reject("manual promotion with audio is not allowed")}isPromotingToRealtime(){return this._callOperationHandler.hasPendingOperation("_PromotionToRealtime")}getPromoteToRealtimeCallOptions(e,t){let i,n=1;1===e?i={value:!0,mediaTypes:["audio"]}:3===e?(i={value:!0,mediaTypes:["audio"]},n=4):2===e&&(i={value:!1});let r={...t.callStartOptions,sendMediaModalities:{mediaStates:[pZ(0,4),pZ(1,n)].filter(e=>null!=e)},preheatFlags:0};return{...t,callStartOptions:r,applyServerMute:i,isPromotingToRealtime:!0,callStartTime:Date.now()}}canPromoteToRealTime(e){let t=this.logger.createChild("[canPromoteToRealTime]");return(t.info(`[promoteType:${e}]`),this.isCallModeStreaming())?this.isPromotingToRealtime()?(t.info("already promoting to realtime"),!1):1===e||2===e:(t.info("cant promote since call mode is not streaming"),!1)}isCallModeStreaming(e=!1){if(2===this.callMode){if(!e)return!0;throw this.logger.info("reject check callmode"),{code:499,subCode:3551,phrase:"TransactionNotAllowedForStreamMode"}}return!1}setCallOptions(e){this.receiveOnlyAudioOnCallStart=!!e.callStartOptions?.receiveOnlyAudioOnCallStart,this.callOptions=e,this.logger.info(`callOptions: ${tI(p5(e))}`)}getSelfClientEndpointCapabilities(){return this.callOptions?.callStartOptions?.clientEndpointCapabilities}getLocalSignalingEndpointDetails(){return(0,o5.find)(this.localSignalingParticipant.endpointDetails,e=>e?.endpointId===this._endpointId)}getStreamInformationMap(e){let t={};return e&&this.accountConfiguration?.clientSupportsUms&&(0,o5.forEach)(e.endpointDetails,e=>{e?.streamInformation&&e.participantId&&e.participantId!==this._participantId&&(t[e.participantId]=e.streamInformation)}),t}updateSATInfo(e=[]){let t=this.mediaSession?.getSessionConfig().config.slowedDownTalkerInfoAggregationTime;if(!t||t<0)return;let i=Date.now(),n=i-1e3*t;this.activeTalkersHistory=this.activeTalkersHistory.filter(({timestamp:e})=>e>n).concat({speakers:e.map(e=>e.id),timestamp:i});let r=Object.entries(this.activeTalkersHistory.reduce((e,{speakers:t})=>{for(let i of t)e[i]??(e[i]=0),e[i]++;return e},{})).sort(([,e],[,t])=>t-e).map(([e])=>e);this.slowedDownActiveTalkerInfo={speakerList:r,timestamp:new Date(i)}}enableRemoteUFDs(e){this.logger.info(`${e?"Enabling":"Disabling"} remote UFDs`),e?this.remoteUFDHandler.init():this.remoteUFDHandler.dispose()}setPlatformCallConstraints(e){this.setCallConstraints(e).catch(e=>{this.logger.error(e)})}setCallConstraints(e){return this.mediaSession?(this.logger.info(`Applying platform constraints to current call ${JSON.stringify(e)}`),this.mediaSession.setCallConstraints(e,e9())):(this.logger.info("Saving platform constraints until media session is created"),this.temporaryCallConstraints=e,new Promise((e,t)=>{this.resolveTemporaryCallConstraints=e,this.rejectTemporaryCallConstraints=t}))}initializeMediaSession(t,i){if(this.mediaSession)return;let n=this.logger.createFnLogger("initializeMediaSession",t),r=((e,t)=>{let i={};return Object.keys(t).forEach(n=>{i[n]=(...i)=>t[n]&&e()&&t[n](...i)}),i})(()=>!this.isCallModeStreaming()||this.isPromotingToRealtime(),{onSessionErrorOccurred:(e,t=e9())=>{n.error(`[${t}][onSessionErrorOccurred]: ${tI(e)}`);let i=[this.mediaAgent.constants.MEDIA_ERROR.iceConnectionError,this.mediaAgent.constants.MEDIA_ERROR.internalError];(0,o5.includes)(i,e.type)&&this.event("mediaConnectionFailed").raise(),this.callTelemetry.recordEvent("SessionError",{type:e.type},t)},onNegotiationRequired:(e=e9(),t)=>{this.executeNegotiation(e,"onNegotiationRequired",!0,t)},onContributingSourcesChanged:e=>{let t=this.mediaSession?.getSessionConfig().config.contributingSourcesLogInterval,i=t&&Date.now()>=this.lastContributingSourceReport+t,r=i?new Map(e.map(e=>[e,"<unknown>"])):new Map,s=[];for(let t of this.participants){let n=e.some(e=>t.hasAudioSource(e)),a=+!!n;t.updateVoiceLevel(a),n&&(s.push(t),i&&r.set(t.audio.id,ta(t.id)))}this.updateSATInfo(s),i&&(n.info(`[onContributingSourcesChanged], ${e.length?Array.from(r).join(";"):"none"}`),this.lastContributingSourceReport=Date.now())},onDominantSpeakerChanged:(e,t)=>{let i=e9(),r=[],s=[];e.forEach(e=>{let t=(0,o5.find)(this.participants,t=>t.hasAudioSource(e));t?(r.push(t.id),s.push(ta(t.id))):s.push(this.streamManager.audio.id===e?"<self>":"<unknown>")}),n.info(`[${i}][onDominantSpeakerChanged], msidList = ${e} => speakerList = ${s}, timestamp = ${t}`),this.dominantSpeakerInfo={speakerList:r,timestamp:t,noCurrentDominantSpeaker:!1},this.event("dominantSpeakerChanged").raise(),this.raiseChanged(this._dominantSpeakerChangedEventSkipConfig)},onAudioStateChanged:(t,i)=>{let n=e9(),r=this.logger.createFnLogger("onAudioStateChanged",n);r.info(tI(t));let s=e.streamingStatetoMediaStreamState(t.stream);if(this.audioStreamState=s,!s)return;this.callStats.localStats.audio.streamStateChanged(t.stream,t.direction),this.callTelemetry.recordEvent("AudioStateChanged",{state:t,reason:i},n),2===s&&2===this.state&&(this.setCallState(9,n),this.participants.forEach(e=>e.setState(6,void 0,n)));let a={mediaType:0,mediaDirection:e.streamingDirectionToMediaDirectionMapping(t.direction),mediaStreamState:s};if(this.event("mediaStreamStateChanged").raise(a),!this.isCallSetupTelemetrySent&&this.mediaSession?.getSessionConfig().config.sendCallStartupTelemetry&&this.sendCallSetupTelemetry(),0===a.mediaDirection&&(this.isAudioStreamConnected=(0,o5.includes)([2,1],a.mediaStreamState)),(0,o5.includes)([3,4],a.mediaStreamState)&&(r.logFailure(`audio stream state changed to ${t.stream} with reason ${i}`),!i||["timeout","connection-dropped","connectivity-check-failure","suspended"].indexOf(i)>=0)){this.event("mediaConnectionFailed").raise();let e="suspended"===i?77:this.mediaRelayWhiteListingIssue?53:4;this.mediaRelayWhiteListingIssue&&this.callTelemetry.recordEvent("_MediaWhiteListingIssueDetected"),this.stopInternal({causeId:n,terminatedReason:e})}},onQualityChanged:e=>{let t={type:SD(e.type),value:Sk(e.value),isLocalSource:e.isLocalSource,mediaType:Sx(e.mediaType)};this.muteUnmuteWorkaround(t),32===t.type&&(this.mediaRelayWhiteListingIssue=3===t.value,this.mediaRelayWhiteListingIssue&&this.event("mediaConnectionWhitelistingWarning").raise()),5===t.type&&3===t.value&&this.trouterService.checkConnection(!0),this.callTelemetry.recordEvent("AudioQualityChanged",t),this.remoteUFDHandler.raiseIfNeeded(e,this.participantCounts?.totalParticipants,e=>{this.publishState(e,e9())}),this.event("callQualityChanged").raise(t)},onOptimalVideoReceiversCountChanged:e=>{n.debug(`onOptimalVideoReceiversCountChanged: ${e}`),this.optimalVideoCount!==e&&(this.optimalVideoCount=e,this.raiseChanged())},onDataChannelUpdated:e=>{let t=e9();n.debug(`[${t}] onDataChannelUpdated`),this.dataChannel.registerSessionDataChannel(e,t)},onUpdateMediaDescriptionsRequired:(e,t)=>{this.executeNegotiation(e,"onUpdateMediaDescriptionsRequired",!1,t)},onRealtimeTelemetryReport:()=>{this.reportTelemetryEvents([{eventName:px.realtimeTelemetry,props:{user_object_id:{value:pS+this.currentUserSkypeIdentity.id,piiKind:10},display_name:{value:this.displayName,piiKind:1},call_context_id:{value:this.signalingSession.correlationId,piiKind:0},participant_id:{value:this.participantId,piiKind:0},media_leg_id:{value:this.mediaLegId,piiKind:0},DiagnosticLevel:{value:255,piiKind:0},eventpdclevel:{value:2,piiKind:0},eventpriority:{value:5,piiKind:0},call_technical_info:{value:JSON.stringify(this.mediaSession.getCallTechnicalInfo()),piiKind:0}}}],"realtimeMedia","mdsc")},onTransportConnected:()=>{this.allowDataChannel()||this.mediaStateConfigurationHelper.isSending(3)||this.isInitialSignalingDSHSubscriptionEnabled()||!this.callUsesMixer||this.updateSignalingDSHMessageSubscription(!0),this.unmixedAudioProvider.setSessionStreamsProvider(this.mediaSession.getUnmixedAudioProvider()),this.event("transportConnected").raise()},onTransportDisconnected:()=>{this.event("transportDisconnected").raise()},onTransportFailed:()=>{this.event("transportFailed").raise()},onUpdateSignalingDSHMessageSubscription:e=>this.updateSignalingDSHMessageSubscription(e)});this.callTelemetry.recordEvent("CreatingConference","",t),this.callDeviceManager||(n.info(`[${t}][initializeMediaSession] Creating new callDeviceManager`),this.callDeviceManager=this.createCallDeviceManager());let s={maxReinvitelessMediaForVBSSMultiparty:this.signalingSession.getMaxReinvitelessMediaForVBSSForWeb(),maxReinvitelessMediaForVideoMultiparty:this.signalingSession.getMaxReinvitelessMediaForVideoForWeb()};this.callTelemetry.recordEvent("_ReinvitelessConfig",{reinvitelessConfig:s},t);let a=this.mediaAgent?.getConfigProvider().config.identifyOneToOneCallWithoutParticipants;this.mediaSession=new fi(this.mediaAgent.createSession(r,this.signalingSession,{isConference:this.callUsesMixer,isPstnCall:this.isOneToOnePSTNCall(a),isParkedCall:this.isParkedCall(),reinvitelessConfig:s,numVbssChannels:this.isMultiVBSSEnabled()?this.maxVbssChannels+1:void 0},this.callDeviceManager,this.smallCallTelemetry,i,this.modalityWatchDog),this.signalingSession),this.batteryStatus=new Sw(this.mediaSession.getDiagnostics(),this.mediaAgent.getConfigProvider()),this.batteryStatus.on("batteryStatusChanged",()=>this.reportSmallCallEvent(this.smallCallTelemetry?.getSmallTelemetryOnBatteryLow())),this.temporaryCallConstraints&&(n.info(`Applying saved call constraints to current call ${JSON.stringify(this.temporaryCallConstraints)}`),this.mediaSession.setCallConstraints(this.temporaryCallConstraints,e9()).then(this.resolveTemporaryCallConstraints).catch(this.rejectTemporaryCallConstraints).finally(()=>{this.temporaryCallConstraints=void 0,this.rejectTemporaryCallConstraints=void 0,this.resolveTemporaryCallConstraints=void 0})),this.dataChannel.setConfigProviderView(this.mediaSession.getSessionConfig()),this.callTelemetry.recordEvent("CreatedConference","",t),this.streamManager.setMediaSession(this.mediaSession,t),this.participants.forEach(e=>{e.setMediaSession(this.mediaSession,t)});let o=this.mediaSession.getSessionConfig()?.config;o?.useOneDsLogger&&o?.addTelemetryReportingCallback&&(this.beforeUnloadTelemetrySender=()=>{this.sendLastKnownStats()},window.addEventListener("beforeunload",this.beforeUnloadTelemetrySender)),this.screenSharingControl&&this.allowDataChannel()&&this.screenSharingControl.setupDataHandlers(),this.unmixedAudioProvider=new SC}executeNegotiation(e,t,i,n){let r=this.logger.createFnLogger(t,e);if(this.isCallModeStreaming()||this.isEscalationInProgress)return void r.info(`ignored due to being in streaming=${this.isCallModeStreaming()},
                isEscalationInProgress=${this.isEscalationInProgress}`);let s=e9();3===this.state||4===this.state||5===this.state||10===this.state||this.isPreheatedOnly()?(r.info(`started, state: ${this.state}, runNegotiation: ${i}`),i?(this.callTelemetry.recordEvent("NegotiationRequired","",e),this._callOperationHandler.executeChained(()=>this.renegotiateOutgoing(e,n),"_RenegotiateOutgoing",s,e,void 0,void 0,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]})):(this.callTelemetry.recordEvent("UpdateMediaDescriptions","",e),this._callOperationHandler.executeChained(()=>this.updateMediaDescriptions(e,n),"_UpdateMediaDescriptions",void 0,e,void 0,void 0,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}))):r.info(`not started, state: ${this.state}`)}async muteUnmuteWorkaround(e){if(this.mediaSession?.getSessionConfig().config.enableMuteSpeakerUnmuteSpeakerWorkaround&&!this.isSpeakerMuted&&25===e.type&&3===e.value&&0===e.mediaType){this.logger.log("Performing muteSpeaker->unmuteSpeaker workaround");let e=e9();await this.muteSpeaker(e),await this.unmuteSpeaker(e)}}async setIntendedMuteState(e){this.logger.info(`setIntendedMuteState called with mute ${e}`),this.modalityWatchDog.setIntendedMuteState(e,e9())}sendLastKnownStats(){if(this.tsCallingTelemetryReported)return;this.callEndDiagnosticsInfo={callControllerCode:ag,callControllerSubCode:aT,phrase:"CallEndBeacon",resultCategories:["Success"]},this.callTelemetry.setTerminationState(this.state),this.callTelemetry.setTerminationReason(this.terminatedReason),this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo);let e=this.callTelemetry.getShortEvent();if(e.Code=this.callEndDiagnosticsInfo.callControllerCode,e.SubCode=this.callEndDiagnosticsInfo.callControllerSubCode,e.ResultDetail=this.callEndDiagnosticsInfo.phrase,e.ResultValue="Success",e.IsPreheated=this.isPreheatEnabled,!0===this.callUsesMixer){let e=this.smallCallTelemetry?.getEndCallSmallTelemetry(!0);this.mediaSession?.sendBeaconDataViaDataChannel({terminationCode:ag,terminationSubCode:aT,context:JSON.stringify({IceConnectedStateTime:e?.data.metrics.IceConnectedStateTime,MediaLegId:e?.data.metrics.MediaLegId})})}let t="csa_conversation_callmodality";if(this.reportTelemetryEvents([{eventName:t,props:e}],"signaling","skypecosi_concore_web"),t=this._callIsSetupComplete?"in_call_session":"call_setup_session",this.reportTelemetryEvents([{eventName:t,props:this.callTelemetry.getEvent(!0)}],"signaling","skypecosi_concore_web_ts_calling"),this.mediaSession){let e=this.mediaSession.getLastKnownStats(!0);this.callStats.setMediaStats(e),this.reportSmallCallEvent(null,!0),this.reportTelemetryEvents(this.callStats.buildFromLocalStats(),"signaling","skypecosi_concore_web")}}reportSmallCallEvent(e,t){this.reportTelemetryEvents(this.callStats.buildShortCallEvent(e??this.smallCallTelemetry?.getEndCallSmallTelemetry(t)),"media","mdsc")}invertDirectionality(e){switch(e){case this.mediaAgent.constants.MEDIA_STATE.sendReceive:return fS;case this.mediaAgent.constants.MEDIA_STATE.send:return fv;case this.mediaAgent.constants.MEDIA_STATE.receive:return fm;default:return null}}completeNegotiationAsync(e){let t=this.logger.createFnLogger("completeNegotiationAsync",e),i=this.mediaSession.completeNegotiationAsync(e).then(i=>{t.info(`activeModalities=${i&&Object.keys(i.activeModalities)}`);let n=this.mediaSession.getSessionConfig().config.avoidFakeStreamsDuringEscalation&&this.isEscalationInProgress;if(!this.callUsesMixer&&!n){if(this.mediaStateConfigurationHelper.isSending(3)&&i.initiator){let t=i.offeredModalities.data===this.mediaAgent.constants.MEDIA_STATE.sendReceive,n=i.activeModalities.data===this.mediaAgent.constants.MEDIA_STATE.sendReceive;t&&!n&&(this.logger.info(`[${e}][completeNegotiationAsync] Disabling data modality as it was not wanted by remote`),this.mediaStateConfigurationHelper.removeModality(3))}let t=this.participants[0],n=t?.endpoints?.endpointDetails.length&&t.endpoints.endpointDetails[0].mediaStreams?.length;if(t&&!n){let n=(e,t,i)=>({participantId:S9,endpointId:S8,type:e,direction:this.invertDirectionality(t),sourceId:i,serverMuted:!1}),r=[];r.push(n(fy,i.activeModalities.audio,fB)),i.activeModalities.video&&r.push(n(fC,i.activeModalities.video,fH)),i.activeModalities.sharing&&r.push(n(fb,i.activeModalities.sharing,fj)),t.updateStreams(r,e,this.isMultiVBSSEnabled()),this.callIsHeld()||this.calculateIsSomeoneStreaming(e)}}if(t.logSuccess(tI(i)),this.mediaAgent.getConfigProvider().config.syncMuteStateWithAudioDirection&&i?.activeModalities?.audio){let t=i.activeModalities.audio===this.mediaAgent.constants.MEDIA_STATE.receive||i.activeModalities.audio===this.mediaAgent.constants.MEDIA_STATE.inactive;this.setMuted(t?2:+!!this.isServerMuted,e)}return i});return i.catch(i=>{t.logFailure(i),this.callTelemetry.recordEvent("_CompleteNegotiationFailed",{e:i},e)}),i}async renegotiateOutgoing(e,t){this.renegotiationAnswerDeferred=new iE;let i=this.logger.createFnLogger("renegotiateOutgoing",e),n=this.inLocalHold()?this.getMediaModalitiesForHold(e):this.calculateModalityDirections({},e);if(this._delayedElevationPending&&!this._delayedElevationQueued)if(mY(n.video)||mY(n.sharing)){i.info("mediaModalities",n),await this.triggerDelayedReconnectIfNeeded(e,"renegotiateOutgoing");return}else i.info("Delayed elevation (renegotiateOutgoing): no outgoing video or sharing, skipping elevation for now");i.info("start");let r=pw(i);try{try{let i=await r.execute("MediaCreateOffer",()=>this.mediaSession.createOfferAsync(e,t)),s=this.getSignalingMediaTypes(n);await r.execute("SignalingStartNegotiation",()=>this.signalingSession.startRenegotiationAsync(i,s,e));let a=await r.execute("SignalingRenegotiationAnswer",()=>this.renegotiationAnswerDeferred.promise);await r.execute("MediaProcessAnswer",()=>this.mediaSession.processAnswerAsync(a,e,!1));let o=await r.execute("CompleteNegotiation",()=>this.completeNegotiationAsync(e));this.onNegotiationCompletion(o,!0,n,e,r.getTelemetryData())}catch(a){if(i.logFailure(a),!a.phase)throw this.callTelemetry.recordEvent("OutgoingNegotiationFailure",a,e),a;let t="unknown",r=this.mediaAgent.constants.RENEGOTIATION_ERROR;if(t=r.local,"SignalingRenegotiationAnswer"===a.phase||"SignalingStartNegotiation"===a.phase){let e=415;t=a.error.code===a8?r.glare:a.error.code===e?r.media:r.signaling}else"MediaCreateOffer"===a.phase&&a.error.type===this.mediaAgent.constants.MEDIA_ERROR.noNetworkError&&(t=r.media);if(this.callTelemetry.recordEvent("OutgoingNegotiationFailure",this.getTelemetryFromPhaseExecution(a),e),a.error.message?.includes("The requested call does not exist"))throw Error("Call drop due to remote replying with call not found");i.logFailure(t);let s={type:t,detail:a.error};await this.mediaSession.rejectNegotiationAsync(s,e),this.onNegotiationFailure(a.error,t,e,n)}}catch(t){i.logFailure(t),this.callTelemetry.recordEvent("NegotiationFatalError",tT(t),e),this.stopInternal({causeId:e,terminatedReason:47})}}async renegotiateIncoming(e,t){this.mediaAcknowledgmentOperation=this._callOperationHandler.createPendingOperation("_MediaAcknowledgment",null,t,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),this.mediaAcknowledgmentOperation.catch(ah);let i=this.logger.createFnLogger("renegotiateIncoming",t);if(i.info("start"),e.newOffer&&!this.mediaAgent.getCapabilities().retargeting){i.logFailure("Retarget offer received, but pluginless has no support for retarget"),this.stopInternal({causeId:t,terminatedReason:38});return}let n=pw(i);try{let i=await n.execute("MediaProcessOffer",()=>this.mediaSession.processOfferAsync(e,t));this.handleOfferedModalities(i,t),2===this.getRenegotiationOfferType(i)&&await this.prepareModalitiesForResume(t);let r=await this.updateMediaModalities({offered:i},t);1===this.getRenegotiationOfferType(i)&&await this.prepareModalitiesForHold(t),this.updateMediaState(r,t),this.isRenegotiationHoldOrResume(r)&&this.updateScreenSharingState(r,t);let s=await n.execute("MediaCreateAnswer",()=>this.mediaSession.createAnswerAsync(!1,t)),a=this.getSignalingMediaTypes(r);await n.execute("SignalingAcceptRenegotiation",()=>this.signalingSession.acceptRenegotiationAsync(s,a,t)),await n.execute("SignalingMediaAcknowledgement",()=>this.mediaAcknowledgmentOperation);let o=await n.execute("CompleteNegotiation",()=>this.completeNegotiationAsync(t));this.onNegotiationCompletion(o,!1,i,t,n.getTelemetryData())}catch(e){try{if(!e.phase||"CompleteNegotiation"===e.phase)throw this.callTelemetry.recordEvent("IncomingNegotiationFailure",e,t),e;let n=e;this.callTelemetry.recordEvent("IncomingNegotiationFailure",this.getTelemetryFromPhaseExecution(e),t);let r={type:this.mediaAgent.constants.RENEGOTIATION_ERROR.local,detail:e.error};if("SignalingAcceptRenegotiation"===n.phase||"SignalingMediaAcknowledgement"===n.phase){i.logFailure("Error in renegotiateIncoming() -> rejecting media negotiation"),r.type=this.mediaAgent.constants.RENEGOTIATION_ERROR.signaling,this._callOperationHandler.maybeRejectOperation("_MediaAcknowledgment",r,void 0,t),await this.mediaSession.rejectNegotiationAsync(r,t);return}this._callOperationHandler.maybeRejectOperation("_MediaAcknowledgment",r,void 0,t),await this.mediaSession.rejectNegotiationAsync(r,t),await this.signalingSession.rejectRenegotiationAsync(void 0,t)}catch(e){i.logFailure(e),this.callTelemetry.recordEvent("NegotiationFatalError",tT(e),t),this.stopInternal({causeId:t,terminatedReason:47})}}}async updateMediaDescriptions(e,t){let i=this.logger.createFnLogger("updateMediaDescriptions",e);i.info("start");try{let n=await this.mediaSession.startMediaDescriptionsUpdateAsync(e,t);i.info(`send updateMediaDesriptions, descriptions=${tI(n)}`),await this.signalingSession.updateMediaDescriptionsAsync(e,n);let r=await this.mediaSession.completeMediaDescriptionsUpdateAsync(e);if(this.mediaAgent.getConfigProvider().config.syncMuteStateWithAudioDirection&&r?.appliedModalities?.audio){let t=r.appliedModalities.audio===this.mediaAgent.constants.MEDIA_STATE.receive||r.appliedModalities.audio===this.mediaAgent.constants.MEDIA_STATE.inactive;this.setMuted(t?2:+!!this.isServerMuted,e)}this.onUpdateMediaDescriptionsCompletion(r,e)}catch(n){i.logFailure(n),this.callTelemetry.recordEvent("UpdateMediaDescriptionsFailure",n,e);let t=await this.mediaSession.rejectMediaDescriptionsUpdateAsync(e,!0);this.onUpdateMediaDescriptionsFailure(n,t,e)}}handleCallEscalation(e,t){let i=this.logger.createFnLogger("handleCallEscalation",t);if(i.info(`current callType=${this.callType}, escalationInProgress=${e}, isEscalationInProgress=${this.isEscalationInProgress}`),e){let e=this.participants[0];e&&e.audio.participantId===S9?e.updateStreams([{type:fy,direction:"inactive",sourceId:null,serverMuted:!1},{type:fC,direction:"inactive",sourceId:null,serverMuted:!1},{type:fb,direction:"inactive",sourceId:null,serverMuted:!1}],t,this.isMultiVBSSEnabled()):i.info("no 1-1 participant found, stream update ignored"),this.setCallType(2,t),this.setCallUsesMixer(!0,t),this.setIsEscalationInProgress(!1,t),this.callTelemetry.recordEvent("_EscalationCompleted",void 0,t),this.raiseChanged()}}async reportTsCallingTelemetry(e){if(this.tsCallingTelemetryReported)return;await this.connectCallPromise.catch(ah);let t=e?"call_setup_session":"in_call_session";this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this.reportTelemetryEvents([{eventName:t,props:this.callTelemetry.getEvent(e)}],"signaling","skypecosi_concore_web_ts_calling"),e?this.callTelemetry.switchToInCallTelemetry():this.tsCallingTelemetryReported=!0}async sendMidCallTelemetry(e){this.mediaSession&&e?.length&&(this.callStats.setMediaStats(await this.mediaSession.getStatsAsync(!0)),this.appendInfoToCallStats(),this.reportTelemetryEvents(this.callStats.buildMidCallTelemetry(e),"media","mdsc_mid_call_telemetry"))}sendCallSetupTelemetry(){this.mediaSession&&(this.collectCallStats(this.mediaSession),this.reportCallSetupStats(),this.isCallSetupTelemetrySent=!0)}collectCallStats(e){let t=()=>this.collectMediaStatsDeferred.resolve();return e.getStatsAsync(!1).then(e=>this.callStats.setMediaStats(e)).then(t,t)}reportCallSetupStats(){this.collectMediaStatsDeferred.promise.then(()=>{this.reportTelemetryEvents(this.callStats.buildFromCallSetupStats(this.signalingSession.baseMessagingChannelUrl),"media","mdsc"),this.event("statsReported").raise(),this.collectMediaStatsDeferred=new iE})}async reportCallEndStats(e){this.callTelemetry.setTerminationState(this.state),this.callTelemetry.setTerminationReason(this.terminatedReason),this.callStats.localStats.endCall(this.terminatedReason),e&&this.mediaAgent.getConfigProvider().config?.smallCallTelemetry?.enable&&this.reportSmallCallEvent(null),this.reportTelemetryEvents(this.callStats.buildFromLocalStats(),"signaling","skypecosi_concore_web"),this.reportTsCallingTelemetry(!this._callIsSetupComplete),e&&(await this.collectMediaStatsDeferred.promise,this.callStats.appendTerminationInfo(this.terminatedReason,this.state),this.appendInfoToCallStats(),this.reportTelemetryEvents(this.callStats.buildFromMediaStats(),"media","mdsc")),this.event("statsReported").raise(),this.collectMediaStatsDeferred=new iE}reportTelemetryEvents(e,t,i){let n=this.telemetryLoggers?this.telemetryLoggers[t]:null;n?e.forEach(e=>n.sendEvent({eventName:`${i?`${i}_`:""}${e.eventName}`,props:e.props})):this.logger.debug(`reportTelemetryEvents no logger for tenant ${t}`)}onLocalPreviewSizeChanged(e,t){this.logger.debug(`onLocalPreviewSizeChanged: ${e}x${t}`)}onLocalPreviewStateChanged(e){this.logger.debug(`onLocalPreviewStateChanged: ${e}`),this.callStats.localStats.video.streamStateChanged(e.stream)}async configureVideoModalitiesAsync(e,t,i){if(!this.mediaSession)return this.logger.warn("Tried to configure modalities after call end"),Promise.resolve();e&&this._delayedElevationPending&&!this._delayedElevationQueued&&await this.triggerDelayedReconnectIfNeeded(t,"configureVideoModalitiesAsync"),await this.updateMediaModalities(void 0,t,i),e||this.turnOffLocalVideoPreview(t),this.setVideoOn(e,t)}turnOffLocalVideoPreview(e){return this.localVideoRenderer&&(this.localVideoRenderer.dispose(),this.localVideoRenderer=null),this.disposeLocalVideoHandle(),Promise.resolve(void 0)}turnOnLocalVideoPreview(e){return this.mediaSession?.getSessionConfig().config.useDeviceHandleForLocalVideo?this.acquireLocalVideo(e):(this.localVideoContainer||(this.localVideoContainer=document.createElement("div")),this.turnOnLocalVideoPreviewUsingRenderer(e))}acquireLocalVideo(e){let t=this.logger.createFnLogger("_StartPreviewVideo",e);if(!this.mediaStateConfigurationHelper.isSending(1))return Promise.reject("could not start video preview, not configured to send");try{this.disposeLocalVideoHandle();let e=this.callDeviceManager.getDeviceManager(p6(1));return this.localVideoHandle=e.createDevicesHandle({video:!0},"pluginlessCall:acquireLocalVideo()"),this.localVideoHandle.on("onStreamStateChanged",e=>this.onLocalPreviewStateChanged({stream:e})),this.localVideoHandle.acquire()}catch(e){t.logFailure(e),this.disposeLocalVideoHandle();return}}turnOnLocalVideoPreviewUsingRenderer(e){let t=this.logger.createFnLogger("_StartPreviewVideo",e),i=this.mediaStateConfigurationHelper.isSending(1);if(!i||!this.localVideoContainer)return Promise.reject(`could not start video preview: requestedVideoState=${i}, localVideoContainer=${this.localVideoContainer}`);this.turnOffLocalVideoPreview(e);let n=iT(()=>{this.localVideoRenderer=this.callDeviceManager.getDeviceManager(p6(1)).createPreviewRenderer(this.localVideoContainer,"Video"),this.localVideoRenderer.on("onVideoSizeChanged",(e,t)=>this.onLocalPreviewSizeChanged(e,t)),this.localVideoRenderer.on("onVideoStateChanged",e=>this.onLocalPreviewStateChanged(e))}).then(()=>this.localVideoRenderer.startVideoAsync(e));return n.catch(e=>t.logFailure(e)),n}async startStopVideo(e,t,i){let n=this.logger.createFnLogger(e?"startVideo":"stopVideo",t);if(n.info("start"),!this.canToggleVideo)if(e!==this.mediaStateConfigurationHelper.isSending(1))return n.logFailure(`video switching is in progress ${e}]`),Promise.reject({reason:1});else{await this.videoTogglePromise,this.turnOnLocalVideoPreview(t);return}return e?(this.callStats.localStats.newSession(1),this.callStats.localStats.video.start()):this.callStats.localStats.video.stop(),e&&this.mediaStateConfigurationHelper.isDisabled(1)&&n.info("Video modality was skipped till now. Adding it now."),e?this.mediaStateConfigurationHelper.enableModality(1):this.mediaStateConfigurationHelper.removeModality(1),this.canToggleVideo=!1,this.videoTogglePromise=(async()=>{try{let n=!1;e&&(await this.turnOnLocalVideoPreview(t),n=!0),await this.configureVideoModalitiesAsync(n,t,i)}catch(e){throw n.logFailure(e),this.mediaStateConfigurationHelper.removeModality(1),await this.configureVideoModalitiesAsync(!1,t,i),e}finally{this.canToggleVideo=!0}})(),this.videoTogglePromise}async startStopAudio(e,t){let i=this.logger.createFnLogger(e?"startAudio":"stopAudio",t);try{let e=await this.updateMediaModalities(void 0,t);this.updateMediaState(e,t)}catch(e){return i.logFailure(e),9}return 0}updateEndpointStateForMute(e,t){try{this.signalingSession.updateEndpointState({state:{isMuted:e}},t).catch(e=>{this.logger.logFailure(`updateEndpointStateForMute failure: ${e}`)})}catch(e){this.logger.logFailure(`updateEndpointStateForMute failure: ${e}`)}}async handleServerMutedState(e){let t=this.logger.createFnLogger(`handleServerMutedState, isServerMuted=${!!this.isServerMuted}`,e);if(!this.isServerMuted){let i=3===this._muteState;if(1===this._muteState||i)try{t.info("is unmuting, as we are no longer server muted"),await this.handleMuteUnmuteOnMediaSession(!1,e),this.setMuted(0,e),this.unmutePendingPromise?.resolve(),i&&this.updateEndpointStateForMute(!1,e)}catch(e){throw t.logFailure(e),e}}if(this.isServerMuted&&0===this._muteState){t.info("is muting, as we are unmuted");try{await this.handleMuteUnmuteOnMediaSession(!0,e),this.setMuted(1,e)}catch(e){throw t.logFailure(e),e}}}async handleMuteUnmuteOnMediaSession(e,t){let i=this.logger.createFnLogger(`handleMuteUnmuteOnMediaSession, value=${!!e}`,t);if(this.mediaSession?.getAllowedModalities&&!this.isServerMuted){let n=this.isMuted||this.isServerMuted,r=this.mediaSession.getAllowedModalities().audio.some(e=>e===fm||e===fS);(n&&r||!n&&!r)&&(i.info(`updating audio modalities: Muted ${n} -> ${e}; audioAllowed = ${r}`),await this.updateMediaModalities(void 0,t))}return e?(i.info("mediaSession.muteInputAsync"),await this.mediaSession?.muteInputAsync(t)):e||(i.info("mediaSession.unmuteInputAsync"),await this.mediaSession?.unmuteInputAsync(t)),Promise.resolve()}canMuteOthers(){let e=this._enableUserMeetingRolesCheckForClientCapability&&this.meetingRoles?.some(e=>"attendee"===e)||"attendee"===(this.advancedMeetingRole||this.meetingRole),t=this._enableEndpointMeetingRoleCheckForClientCapability&&!!this.endpoints?.endpointDetails.find(e=>this._endpointId===e.endpointId)?.endpointMeetingRoles?.some(e=>"attendee"===e);return!e&&!t}updateCapabilities(e,t=!1){let i=!1,n=!1;pP(this.state,[11,12])||(this.isServerMuted&&!this._callInLobby?2&this._commandUrlPresence&&(i=!0):this.isMuted&&(i=!0),n=!!(1&this._commandUrlPresence)&&this.canMuteOthers()),(this._capabilities.canUnmuteSelf!==i||this._capabilities.canMuteOthers!==n)&&(this._capabilities.canUnmuteSelf=i,this._capabilities.canMuteOthers=n,this.logger.info(`[${e}][updateCapabilities] Computed self capabilities: ${JSON.stringify(this._capabilities)}`),t&&this.raiseChanged())}async evaluateEndpointStatesForAccept(e,t,i){let n=this.logger.createFnLogger(`evaluateEndpointStatesForAccept, isMuted=${!!e}`,i),r={};try{await this.handleMuteUnmuteOnMediaSession(e,i),Object.assign(r,{state:{isMuted:e}}),n.info("is updating endpointState for mute"),t&&(Object.assign(r,{endpointProperties:{additionalEndpointProperties:t}}),n.info("is updating endpointState for additionalEndpointProperties"))}catch(e){throw n.logFailure(e),aG(e)}return r}async handleEndpointStatesForAccept(e,t){let i=this.logger.createFnLogger("handleEndpointStatesForAccept",t);try{await this.signalingSession.updateEndpointState(e,t)}catch(e){throw i.logFailure(e),aG(e)}}async muteUnmute(e,t){let i=this.logger.createFnLogger(`muteUnmute, value=${!!e} isServerMuted=${this.isServerMuted} inLobby=${this._callInLobby}`,t);if(pP(this.state,[11,12]))return i.logFailure("Can not mute/unmute during preheat call"),Promise.reject(aG("TransactionDisallowed"));let n=!e&&(!this.isServerMuted||this._callInLobby);try{if((e||n)&&await this.handleMuteUnmuteOnMediaSession(e,t),e)this.setMuted(2,t),i.info("is updating endpointState for mute"),this.updateEndpointStateForMute(!0,t);else if(n)i.info("is updating endpointState for unmute"),this.setMuted(0,t),this.updateEndpointStateForMute(!1,t);else{if(i.info("is unmuting on server"),2===this._muteState&&this.setMuted(3,t),this.isCallModeStreaming())return this.promoteToRealtimeAndUnmute(t);return this.signalingSession.unmuteAsync(t).then(e=>{this.handleSelfUnmuteUpdatedInfo(e,t)})}}catch(e){throw i.logFailure(e),aG(e)}}async muteUnmuteSpeaker(e,t){this.setSpeakerMuted(e,t),this.mediaSession&&(e?await this.mediaSession.muteOutputAsync(t):await this.mediaSession.unmuteOutputAsync(t))}getParticipant(e){return this.participants.filter(t=>t.isSameParticipantsMri(e))[0]}getOrCreateParticipant(e,t,i){let n=this.getParticipant(e);return n||((n=new fG(e,this.mediaSession,this.logger,this.callStats.localStats,this.callTelemetry,t)).changed(()=>this.onParticipantChanged(n)),this.participants.push(n),i&&this.event("participantAdded").raise(n),this.monitorCallStart()),n}onParticipantChanged(e){this.event("participantUpdated").raise(e),this.raiseChangedDeferred(this._participantChangedEventSkipConfig)}setCallState(e,t,i=0){if(this.state===e)return;let n=this.logger.createFnLogger("setCallState",t);n.info(`currentState=${this.state}, newState=${e}, terminatedReason=${this.terminatedReason}`),(pR[this.state].indexOf(e)>=0||(n.logFailure("invalid state transition"),7===e))&&(this.callTelemetry.recordEvent("_SetCallState",{state:e,reason:i},t),this.state=e,this.callStats.localStats.call.callStateChanged(e),6===e&&this._startCallPhase&&(this.callTelemetry.updateOperationData("_ConnectCall",{phases:this._startCallPhase.getTelemetryData()},t),this._startCallPhase=void 0),7===e&&this.setTerminatedReason(i),3===e&&(this.callGotConnected=!0,this.callHeldAt=null),this.callIsHeld()&&!this.callHeldAt&&(this.callHeldAt=new Date),n.logSuccess(`changed to ${e}, terminatedReason: ${this.terminatedReason}, failureType=${this.failureType}`),this.screenSharingControl.callStateChanged(this.state),this.monitorCallStart(),this.event("callStateChanged").raise(),this.updateCapabilities(t),this.raiseChanged(),this.callTelemetry.recordEvent("_RaiseCallStateChangeEvent",{state:e,reason:i},t))}setTerminatedReason(e){if(this.terminatedReason=e,!(0,o5.includes)(S6,e)){let e=44===this.terminatedReason,t=55===this.terminatedReason,i=56===this.terminatedReason;this.setFailureType(!this.callGotConnected||!this._wasAudioStreamConnected||e||t||i?0:1)}}setMediaStream(e,t,i){if(e){if(!(0,o5.find)(this.localMediaStreams,e=>e.mediaType===i)){let e=new S7(t,i);this.logger.info(`setMediaStream ${JSON.stringify(e)}`),this.localMediaStreams.push(e)}}else this.logger.info(`setMediaStream removing ${i}`),(0,o5.remove)(this.localMediaStreams,e=>e.mediaType===i)}setVideoOn(e,t){this.logger.info(`[${t}]videoOn=${e}`),this.isVideoOn=e,this.setMediaStream(this.isVideoOn,!0,1),this.callTelemetry.recordEvent("_SetLocalVideo",{value:e},t),this.raiseChanged()}setAudioOn(e,t){this.logger.info(`[${t}]audioOn=${e}`),this.setMediaStream(e,!0,0),this.callTelemetry.recordEvent("_SetLocalAudio",{value:e},t)}setScreenSharingOn(e,t){this.logger.info(`[${t}]screenSharingOn=${e}`),this.isScreenSharingOn=e,this.setMediaStream(this.isScreenSharingOn,this.isScreenSharingOn,2),this.callTelemetry.recordEvent("_SetScreenSharing",{screenSharingOn:e},t),this.event("userActivityChanged").raise(),this.raiseChanged()}disposeSharingScreenHandle(){this.sharedScreenHandle&&(this.sharedScreenHandle.dispose(),this.sharedScreenHandle=null)}disposeLocalVideoHandle(){this.localVideoHandle?.dispose(),this.localVideoHandle=null}setMuted(e,t){this._muteState!==e&&(this._muteState=e,this.callTelemetry.recordEvent("_SetMuted",{isMuted:e},t),this.logger.info(`[${t}]participantMuteState:${e}, isMuted: ${this.isMuted}`),this.updateCapabilities(t),this.raiseChanged(),this.event("muteStateChanged").raise(this.isMuted,t))}setSpeakerMuted(e,t){this.logger.info(`[${t}]speakerMute=${e}]`),this.isSpeakerMuted=e,this.raiseChanged()}monitorCallStart(){3===this.state&&(this.participants.length||2===this.callMode)&&!this.callStartedAt&&(this.callStartedAt=new Date)}_removeParticipant(e,t,i=0){let n=this.logger.createFnLogger("removeParticipant",t);n.info(`mri=${fl(e)}`);let r=(0,o5.remove)(this.participants,t=>t.isSameParticipantsMri(e.id))[0];r?(r.setState(4,i,t),this.event("participantRemoved").raise(r)):n.logFailure(`unable to remove participant ${ta(e.id)}`),this.raiseChanged(this._participantChangedEventSkipConfig)}setIsSomeoneSharing(e,t){let i=this.isSomeoneSharing!==e&&!(e&&this.screenSharingRenegotiationDeferred&&this.callUsesMixer);i&&(this.isSomeoneSharing=e);let n=i;if(this.callUsesMixer&&this.mediaSession?.getSessionConfig().config.enableStopSharingWithIncomingOffer&&(n||(n=t)),!this.isMultiVBSSEnabled()&&n&&this.isSomeoneSharing&&this.isScreenSharingOn&&(this.stopScreenSharing(),this.logger.info("sharingStolen: Cleaning up local screenshare because remote screenshare is running"),this.event("sharingStolen").raise()),this.allowScreenSharingControl()&&this.screenSharingControl?.isInternalViewerControlEnabled()){let e=this.localSignalingParticipant.endpointDetails.find(e=>this._endpointId===e.endpointId),t=this.participants.find(e=>e.streams[1].some(e=>e.isAvailable));this.screenSharingControl.startOrStopControlForViewer(this.isSomeoneSharing,t,e)}}handleOfferedModalities(e,t){let i,n=this.mediaAgent.constants.MEDIA_STATE,r=this.logger.createFnLogger("handleOfferedModalities",t);try{r.info(`offeredModalities=${tI(e)}`)}catch(e){r.logFailure(e)}e.hasOwnProperty("video")||this.mediaStateConfigurationHelper.isSending(1)?e.hasOwnProperty("video")&&!this.mediaStateConfigurationHelper.isSending(1)&&this.mediaStateConfigurationHelper.removeModality(1):this.mediaStateConfigurationHelper.disableModality(1),e.hasOwnProperty("sharing")||this.mediaStateConfigurationHelper.isSending(2)||this.mediaStateConfigurationHelper.disableModality(2),(i=this.mediaAgent.getConfigProvider().config.fixSharingSendrecvOfferHandling?e.sharing===n.receive||e.sharing===n.sendReceive:e.sharing===n.receive)&&!this.mediaStateConfigurationHelper.isSending(2)&&this.mediaStateConfigurationHelper.removeModality(2),e.data===n.sendReceive&&this.allowDataChannel()&&this.mediaStateConfigurationHelper.enableModality(3),this.isReivitelessEnabled()||(this.setIsSomeoneSharing(i,!0),this.setIsSomeoneStreamingVideo(e.video===n.receive||e.video===n.sendReceive))}getRenegotiationOfferType(e){if(e){if(5===this.state){if("sendrecv"===e.audio)return 2}else if(this.modalitiesAreHold(e))return 1}return 0}isRenegotiationHoldOrResume(e){return 1===this.getRenegotiationOfferType(e)||2===this.getRenegotiationOfferType(e)}isReivitelessEnabled(){return(this.signalingSession.getMaxReinvitelessMediaForVideoForWeb()>0||this.signalingSession.getMaxReinvitelessMediaForVBSSForWeb()>0)&&this.callUsesMixer}isValidHoldResumeCallState(e){return[3,5,10,13].includes(e)}onNegotiationCompletion(e,t,i={},n,r){let s,a=this.logger.createFnLogger("onNegotiationCompletion",n);a.info(`byLocal=${t}, result=${tI(e)}`),this.callTelemetry.recordEvent("NegotiationCompletion",{phaseTelemetryBag:r,...this.prepareNegotiationResultForTelemtry(e)},n);let o=this.isOneToOneCall();if(o&&!this.callUsesMixer){let t=this.modalitiesAreHold(e.activeModalities)?5:3;this.participants[0].setState(t,void 0,n),a.info(`isOneToOneCall: participant[0] state set to ${t}`)}let l=this.modalitiesAreHold(e.configuredModalities),c=this.modalitiesAreHold(e.activeModalities),d=this.signalingSession.participantManager.localParticipant.isStaging;a.info(`isStaging= ${d}`),this.requestedHoldState?(l&&c||a.info(`Not expected modalities when processing local hold: ${l} ${c}`),4!==this.state&&a.info(`Not expected state when processing local hold: ${this.state}, switching back to LocalHold`)):t||this.callHoldResumeDeferred?!l&&c?s=5:l||c||this._callInLobby||this.isPreheatedOnly()||(s=d?13:3):4===this.state||this._callInLobby||this.isPreheatedOnly()||(s=o&&5===this.participants[0].state?5:d?13:3),s&&this.setCallState(s,n),this.callHoldResumeDeferred&&(a.info(`isHoldInProgress=${this.isHoldInProgress}, state=${this.state}, completed=${c}`),this.isHoldInProgress?c&&this.finishCallHoldResume():this.inLocalHold()||this.finishCallHoldResume(this.isValidHoldResumeCallState(s)?void 0:Error(`Call state changed to ${s} instead of Connected, Lobby, Staging or RemoteHold`))),this.requestedHoldState||(this.setIsSomeoneSharing((0,o5.some)(this.participants,e=>(0,o5.some)(e.streams[1],e=>e.isAvailable))),this.setIsSomeoneStreamingVideo((0,o5.some)(this.participants,e=>(0,o5.some)(e.streams[0],e=>e.isAvailable))));let u=i&&i.sharing===this.mediaAgent.constants.MEDIA_STATE.send,h=e?.activeModalities?.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(this.resolveScreenSharingRenegotiation(n,u,h,e.isComplete),this.retryOutgoingRenegotiation.retry){let e=this.retryOutgoingRenegotiation.causeId;this._callOperationHandler.executeChained(()=>this.updateMediaModalities(void 0,e),"_Renegotiate",e,e,void 0,void 0,{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),this.retryOutgoingRenegotiation.retry=!1}}onUpdateMediaDescriptionsFailure(e,t,i){let n=t?.requestedModalities.sharing===this.mediaAgent.constants.MEDIA_STATE.send;this.screenSharingRenegotiationDeferred&&n&&(this.screenSharingRenegotiationDeferred.reject(e),this.screenSharingRenegotiationDeferred=null)}onUpdateMediaDescriptionsCompletion(e,t){this.logger.createFnLogger("onUpdateMediaDescriptionsCompletion",t).info(`result=${tI(e)}`),this.callTelemetry.recordEvent("UpdateMediaDescriptionsCompletion",e,t);let i=e?.requestedModalities?.sharing===this.mediaAgent.constants.MEDIA_STATE.send,n=e?.appliedModalities?.sharing===this.mediaAgent.constants.MEDIA_STATE.send;this.resolveScreenSharingRenegotiation(t,i,n,!0)}resolveScreenSharingRenegotiation(e,t,i,n){let r=this.logger.createFnLogger("resolveScreenShareRenegotiation",e);if(r.info(`invoked with wasSharingOfferred: ${t}, isSharingActive: ${i}, isComplete: ${n}`),this.screenSharingRenegotiationDeferred){if(t&&i)r.info("resolving screenSharingRenegotiationDeferred"),this.screenSharingRenegotiationDeferred.resolve(),this.screenSharingRenegotiationDeferred=null;else if(this._enableResolveScreenSharingWhenNegotiationComplete&&n&&!this.retryOutgoingRenegotiation.retry&&this.canToggleScreenSharing){let e=Error(`screenSharing error: wasSharingOfferred: ${t}, isSharingActive: ${i}`);r.info(`reject screenSharingRenegotiationDeferred ${e}`),this.screenSharingRenegotiationDeferred.reject(e),this.screenSharingRenegotiationDeferred=null}}}async updateMediaStatus(e){if(this.calculateIsSomeoneStreaming(e),this.mediaSession){let t=await this.updateMediaModalities(void 0,e);this.callTelemetry.updateOperationData("_UpdateLocalMediaStatus",t,e)}}calculateIsSomeoneStreaming(e){let t=!1,i=!1;for(let e of this.participants)if(t||(t=(0,o5.some)(e.streams[1],e=>e.isAvailable)),i||(i=(0,o5.some)(e.streams[0],e=>e.isAvailable)),t&&i)break;this._delayedElevationPending&&(t||i)&&this.triggerDelayedReconnectIfNeeded(e,"roster update"),this.setIsSomeoneSharing(t),this.setIsSomeoneStreamingVideo(i)}async triggerDelayedReconnectIfNeeded(e,t=""){let i=()=>{this._delayedElevationPending=!1,this._delayedElevationQueued=!1,this.mediaSession?.getDiagnostics()?.registerElevation("completed")};this.logger.info(`Delayed elevation (${t}): pending=${this._delayedElevationPending} queued=${this._delayedElevationQueued}`),this._delayedElevationPending&&!this._delayedElevationQueued?(this._delayedElevationQueued=!0,this._callOperationHandler.maybeRejectOperations(["_RenegotiateIncoming","_RenegotiateOutgoing","_Renegotiate"]),this.mediaSession?.getDiagnostics()?.registerElevation("attempted"),await this.mediaSession.reconnectAsync(e,!0,i)):this.logger.info(`Delayed elevation: was not queued, pending=${this._delayedElevationPending} isQueued=${this._delayedElevationQueued}`)}onNegotiationFailure(e,t,i,n){let r=n&&n.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(t===this.mediaAgent.constants.RENEGOTIATION_ERROR.glare){this.screenSharingRenegotiationDeferred&&r&&this.callStats.localStats.screenShare.negotiationStateChanged("rejected","glare"),this.retryOutgoingRenegotiation={retry:!0,causeId:i};return}this.finishCallHoldResume(e),this.screenSharingRenegotiationDeferred&&r&&(this.screenSharingRenegotiationDeferred.reject(e),this.screenSharingRenegotiationDeferred=null)}static getParticipantReasonFromTerminatedReason(e){switch(e){case 1:return 0;case 9:return 2;case 10:return 3;case 2:return 4;case 24:return 8;case 3:return 9;case 4:return 10;case 14:return 12;case 0:default:return 11;case 15:return 13;case 16:return 14;case 17:return 15;case 18:return 16;case 19:return 17;case 20:return 18;case 11:return 19;case 21:return 20;case 22:return 21;case 23:return 22;case 33:return 25;case 36:return 26;case 37:return 27;case 41:return 30;case 39:return 28;case 42:return 31;case 40:return 29;case 43:return 32;case 44:return 33;case 45:return 34;case 46:return 35;case 47:return 36;case 48:return 37;case 49:return 38;case 50:return 39;case 51:return 40;case 52:return 41;case 54:return 42;case 55:return 44;case 56:return 45;case 12:return 23;case 59:return 46;case 73:return 59;case 61:return 47;case 60:return 48;case 62:return 49;case 63:return 50;case 64:return 5;case 65:return 51;case 8:return 52}}isRemoteParticipantInStaging(e){if(!e.endpointDetails)return!1;for(let t of e.endpointDetails)if(!hI(t))return!1;return!0}updateCallParticipantFromSignalingParticipant(t,i,n){if((0,o5.every)(i.endpointDetails,e=>e?.isLobby||e?.streamLobby))return void t.setState(7,void 0,n);let r=(0,o5.some)(i.endpointDetails,e=>e?.streamInformation),s=i.endpointDetails&&(0,o5.some)(i.endpointDetails,e=>e.mappedTo),a=e.filterVirtualEndpoints(i.endpointDetails),o=a&&a[0].mediaStreams,l=this.isRemoteParticipantInStaging(i);if(o&&o.length>0){let e=o.every(e=>"inactive"===e.direction),i=e?5:l?8:3;1!==this.state||e||this.callUsesMixer||(i=2),this.logger.info(`[updateCallParticipantFromSignalingParticipant]: with mediaStreams is not empty, ParticipantState is set to ${i}`),t.setState(i,void 0,n)}else if(o||s||r){let e=l?8:3;this.logger.info(`[updateCallParticipantFromSignalingParticipant]: ParticipantState is set to ${e}, mediaStreams=${!!o}, hasMappedEndpoints=${s}, hasPlayerStreams=${r}`),t.setState(e,void 0,n)}}handleSelfServerMutedState(t){let i=e.filterVirtualEndpoints(this.localSignalingParticipant.endpointDetails),n=(0,o5.find)(i,e=>this._endpointId===e.endpointId),r=n&&n.mediaStreams,s=r&&r.filter(e=>"audio"===e.type||"audio-teleconferencing"===e.type),a=n&&(n.stream||n.streamLobby);if(a){let e=a.serverMuted??!1;n.serverMuteVersion=0,e!==this.isServerMuted&&(this.isServerMuted=e,this.callTelemetry.recordEvent("_SelfParticipantUpdated",{isServerMuted:this.isServerMuted}),this.logger.info(`updateLocalParticipant: server muted set to ${e}`),this.event("serverMutedChanged").raise(e,t),this.updateCapabilities(t,!0),this.isServerMuted&&this.setMuted(1,t))}else if(s&&s.length>0){let e=s.some(e=>e.serverMuted);e!==this.isServerMuted&&(this.isServerMuted=e,this.callTelemetry.recordEvent("_SelfParticipantUpdated",{isServerMuted:this.isServerMuted}),this.logger.info(`updateLocalParticipant: server muted set to ${e}`),this.event("serverMutedChanged").raise(e,t),this.updateCapabilities(t,!0),this.handleServerMutedState(t))}}checkIfIncomingServerMutedIsUpdated(e){let t=(0,o5.find)(this.localSignalingParticipant.endpointDetails,e=>e.participantId===this.localSignalingParticipant.participantId);if(void 0===t)return;let i=(0,o5.find)(e.endpointDetails,e=>e.participantId===this.localSignalingParticipant.participantId);fn(this.logger,t,i)}convertWiredPublishedState(e){if(!e)return;let t=sX(e.stateType);return{content:e.content,stateType:t,typeRank:e.typeRank,stateId:e.stateId}}updatePublishedStateModified(e,t){e!==this.currentUserSkypeIdentity.id||t&&t!==this.participantId?this._publishedStatesModified=2|this._publishedStatesModified:this._publishedStatesModified=1|this._publishedStatesModified}updatePublishedStates(e){try{let t=[];(0,o5.forEach)(e.publishedStates,e=>{t.push(this.convertWiredPublishedState(e))}),(0,o5.isEqual)(this._participantPublishedStatesMap[e.id],t)||0===t.length&&(void 0===this._participantPublishedStatesMap[e.id]||null===this._participantPublishedStatesMap[e.id])||(this._participantPublishedStatesMap[e.id]=t,this.updatePublishedStateModified(e.id));let i=[];(0,o5.forEach)(e.endpointDetails,n=>{i.push(n.participantId),t=[],(0,o5.forEach)(n.publishedStates,i=>{let r=this.convertWiredPublishedState(i);if(this._endpointPublishedStatesMap[e.id]||(this._endpointPublishedStatesMap[e.id]={},this._endpointPublishedStatesMap[e.id][n.participantId]=[]),"clientMediaUfd"===r.stateType&&this.mediaSession.getSessionConfig().config?.remoteUFD?.enabled)try{let e=JSON.parse(JSON.stringify(r.content));Array.isArray(e)?this.mediaSession.registerRemoteQualityStateChangedEvent(e,n.participantId):this.logger.info("Expected events to be an array in ClientMediaUFD state, but got:",e)}catch(e){this.logger.error(`Error while parsing state.content for ClientMediaUFD: ${e}`)}t.push(r)}),this._endpointPublishedStatesMap[e.id]&&!(0,o5.isEqual)(this._endpointPublishedStatesMap[e.id][n.participantId],t)&&(0!==t.length||null!==this._endpointPublishedStatesMap[e.id][n.participantId]&&void 0!==this._endpointPublishedStatesMap[e.id][n.participantId])&&(this._endpointPublishedStatesMap[e.id][n.participantId]=t,this.updatePublishedStateModified(e.id,n.participantId))}),this._endpointPublishedStatesMap[e.id]&&Object.keys(this._endpointPublishedStatesMap[e.id]).forEach(t=>{i.some(e=>e===t)||(delete this._endpointPublishedStatesMap[e.id][t],this.updatePublishedStateModified(e.id,t))})}catch(e){this.logger.error(`updatePublishedStates ${JSON.stringify(e)}`)}this.logger.info(`updatePublishedStates ${td(this._participantPublishedStatesMap)}`),this.logger.info(`updatePublishedStates ${td(this._endpointPublishedStatesMap)}`)}removePublishedStatesByParticipant(e){this._endpointPublishedStatesMap[e]&&delete this._endpointPublishedStatesMap[e],this._participantPublishedStatesMap[e]&&delete this._participantPublishedStatesMap[e],this.updatePublishedStateModified(e)}findOrCreateTypeState(e){let t=this._publishedStates.typeStates.findIndex(t=>t.type===e);if(-1===t){let i={participantStates:[],type:e};this._publishedStates.typeStates.push(i),t=this._publishedStates.typeStates.length-1}return t}processPublishedStates(){this.logger.info(`processPublishedStates ${td(this._participantPublishedStatesMap)}`),this.logger.info(`processPublishedStates ${td(this._endpointPublishedStatesMap)}`);try{for(let e of(this._publishedStates||(this._publishedStates={typeStates:[]}),this._publishedStates.typeStates=[],Object.keys(this._participantPublishedStatesMap))){let t=this._participantPublishedStatesMap[e];(0,o5.forEach)(t,t=>{let i=this.findOrCreateTypeState(t.stateType),n={id:e,publishedState:{content:t.content,stateId:t.stateId,typeRank:t.typeRank}};this._publishedStates.typeStates[i].participantStates.push(n)})}for(let e of Object.keys(this._endpointPublishedStatesMap))for(let t of Object.keys(this._endpointPublishedStatesMap[e]))this._endpointPublishedStatesMap[e][t].forEach(i=>{let n=this.findOrCreateTypeState(i.stateType),r={id:t,publishedState:{content:i.content,stateId:i.stateId,typeRank:i.typeRank}},s={id:e,endpoints:[r]},a=this._publishedStates.typeStates[n].participantStates.filter(t=>t.id===e);a&&a.length>0?(a[0].endpoints||(a[0].endpoints=[]),a[0].endpoints.push(r)):this._publishedStates.typeStates[n].participantStates.push(s)});this.event("publishedStatesChanged").raise(this._publishedStates),this.raiseChanged()}catch(e){this.logger.error(`processPublishedStates ${e}}`)}}updateLocalParticipant(t,i){let n=this.logger.createFnLogger("updateLocalParticipant",i);this.checkIfIncomingServerMutedIsUpdated(t),this.localSignalingParticipant.endpointDetails=t.endpointDetails,this.localSignalingParticipant.role=t.role,this.setMeetingRole(t.meetingRole),this.setAdvancedMeetingRole(t.advancedMeetingRole),this.setMeetingRoles(t.meetingRoles),this.setParticipantType(t.participantType),this.setDisplayName(t.displayName),this.setPropertyBag(t.propertyBag),this.setPropertyRosterVersion(t.version),this.setMaskedIdentityDetails(t.isIdentityMasked,t.maskedIdSeqNumber,t.maskedId),this.setOtpIdentity(t.otpIdentity),this.localSignalingParticipant.tenantId=t.tenantId,this.localSignalingParticipant.isLobby=t.isLobby,t.joinAsStreamingUser&&(this.localSignalingParticipant.joinAsStreamingUser=t.joinAsStreamingUser,this.setJoinAsStreamingUser(t.joinAsStreamingUser)),void 0!==t.enableCaptcha&&this.setEnableCaptcha(t.enableCaptcha),this.callTelemetry.setTenantId(t.tenantId),this.callStats.setTenantId(t.tenantId);let r=this.localSignalingParticipant.isLobby;t.endpointDetails&&this.updateLocalParticipantEndpoints(t.endpointDetails),this.updatePublishedStates(t),this.handleSelfServerMutedState(i);let s=this.getLocalSignalingEndpointDetails();this._callInLobby=r||!!s?.streamLobby,this.signalingSession.participantManager.localParticipant.isStaging=t.isStaging;let a=this.signalingSession.participantManager.localParticipant.isStaging;n.info(`callInLobby = ${r}, callSetupComplete = ${this._callIsSetupComplete}, callIsHeld = ${this.callIsHeld()}, isStaging = ${a}`),!this._callIsSetupComplete||this.callIsHeld()||pP(this.state,[11,12])||(r?this.setCallState(10,i):a&&pP(this.state,[3,13,10,9,2])?this.setCallState(13,i):this.setCallState(3,i));let o=e.getStreamsFromEndpoints(t.endpointDetails,this.isMultiVBSSEnabled());if(this.callTelemetry.recordEvent("_UpdateLocalParticipantStream",vS(o),i),this.streamManager.updateStreams(o,i),this.updateCapabilities(i,!0),this.allowScreenSharingControl()&&this.screenSharingControl?.isInternalViewerControlEnabled()){let e=t.endpointDetails.find(e=>this._endpointId===e.endpointId),i=this.participants.find(e=>e.streams[1].some(e=>e.isAvailable));this.screenSharingControl.startOrStopControlForViewer(this.isSomeoneSharing,i,e)}}modalitiesAreHold(e){return(!e.audio||"inactive"===e.audio)&&(!e.video||"inactive"===e.video)&&(!e.sharing||"inactive"===e.sharing)}toneToString(e){switch(e){case 0:return"0";case 1:return"1";case 2:return"2";case 3:return"3";case 4:return"4";case 5:return"5";case 6:return"6";case 7:return"7";case 8:return"8";case 9:return"9";case 10:return"*";case 11:return"#";default:return null}}static streamingStatetoMediaStreamState(e){switch(e){case"started":return 0;case"active":return 2;case"inactive":return 1;case"stopped":return 3;default:return 4}}static streamingDirectionToMediaDirectionMapping(e){switch(e){case"send":return 1;case"receive":return 0;default:return}}static convertMuteScope(e){switch(e){case 0:return"EveryoneElse";case 1:return"SpecifiedParticipants";default:return}}callIsHeld(){return 4===this.state||5===this.state}inLocalHold(){return this.isHoldInProgress||4===this.state}telemetryDataFromCallStartOptions(e){let t={};return e.muteFlags&&(t.muteMicrophone=!!(1&e.muteFlags),t.muteSpeaker=!!(2&e.muteFlags)),Object.keys(t).length?t:void 0}reconnect(){let e=e9();return this.mediaSession.reconnectAsync(e)}async provideCallQualityFeedback(e,t,i,n){}async showCQFInfo(e,t){throw Error("Not implemented")}async isCqfRendered(e){}async provideCallQualityFeedbackEx(e,t,i,n,r,s){}testTriggerMediaRelayWhiteListingIssue(){this.logger.info("Simulating media relay whitelisting issue for test purposes");let e=this.mediaSession.mediaSession.callback,t={type:"NetworkRelaysNotReachable",value:"Bad",isLocalSource:!0,mediaType:"Audio"};e.onQualityChanged(t);let i={direction:"send",stream:"failed",content:"audio"};e.onAudioStateChanged(i)}async getMediaTelemetry(e=!1){return this.mediaSession&&(this.callStats.setMediaStats(await this.mediaSession.getStatsAsync(e)),this.appendInfoToCallStats()),this.callStats.buildMediaTelemetry()}getMediaSessionStats(){return this.mediaSession?.getMediaStatsReport()}async getMediaSessionStatsAsync(){return this.mediaSession?.getMediaStatsReport()}async getAudioSendStats(){return this.mediaSession?.getAudioSenderStats()}getDiagnosticsForE2E(){return this.mediaSession?.getDiagnostics().e2eDiagnostics}appendInfoToCallStats(){this.callStats.appendDataChannelInfo(this.dataChannel.getTelemetry()),this.callStats.appendSharingControlInfo(this.screenSharingControl?.isScreenSharingControlEnabled()),this.callStats.appendMediaControlPlaneInfo(JSON.stringify(this.mediaSession?.getMediaControlPlaneInstance()?.getTelemetryReport()))}getMediaLogs(){return this.mediaAgent.getMediaLogs()}testSetCallState(e){this.logger.info(`Overwriting call state for test purposes: ${this.state} -> ${e} `),this.state=e}testSetCallType(e){this.logger.info(`Overwriting call state for test purposes: ${this.callType} -> ${e} `),this.callType=e}addGroupModality(e,t=e9()){let i,n=this.logger.createFnLogger("AddGroupModality",t);if(!e.threadId&&!e.groupId)return Promise.reject(aG("No threadId/groupId was provided."));if(6===this.state||7===this.state)return n.info(`Not adding modality because CallState is ${this.state} groupId=${ta(e.groupId)}, threadId = ${th(e.threadId)} messageId = ${e.messageId}`),Promise.reject(aG("TransactionDisallowed"));if(e.additionalData)try{i=JSON.stringify(e.additionalData)}catch(t){return n.logFailure(`additionalData: ${e.additionalData} is not valid Json, error: ${t}`),Promise.reject({code:a2,subCode:0,phrase:`additionalData is not valid Json, error: ${t}`})}if(n.info(`groupId=${ta(e.groupId)}, threadId = ${th(e.threadId)} messageId = ${e.messageId} additionalData = ${ta(i)}`),this._enableAddModalityGeneric){let i={groupContext:{id:e.groupId},groupChat:{threadId:e.threadId,messageId:e.messageId}};return this.signalingSession.addModalityAsync(i,t).catch(e=>(n.logFailure(t_(e)),Promise.reject(e)))}{let r={groupId:e.groupId,threadId:e.threadId,messageId:e.messageId,additionalData:i};return this.signalingSession.addGroupModalityAsync(r,t).catch(e=>(n.logFailure(t_(e)),Promise.reject(e)))}}addBroadcastModality(e,t){let i=this.logger.createFnLogger("AddBroadcastModality",t);return Promise.resolve().then(()=>{this.signalingSession.addBroadcastModalityAsync(e,t)}).catch(e=>(i.logFailure(t_(e)),Promise.reject(aG(e)))).then(()=>this._callOperationHandler.waitForOperation("AddBroadcastModality")).catch(e=>{throw this.callTelemetry.updateOperationData("AddBroadcastModality",{error:tT(e)},t),i.logFailure(e),e})}getPluginlessPublishLevel(e){switch(e){case"user":return"user";case"endpoint":return"endpoint";default:throw"Invalid level type."}}setIsEmergency(e){this.logger.info(`Set isEmergency:${e}`),this.isEmergency=e,this.callTelemetry.setIsEmergency(e)}static filterVirtualEndpoints(e){return e&&(0,o5.filter)(e,e=>!e.mappedTo)}mapDataChannelSourceIdToParticipant(e){let t=null;return t=1===this.callType?this.participants[0]:(0,o5.find)(this.participants,t=>t.hasSourceId(3,e)),t?.id?this.logger.info(`ParticipantId: ${ta(t.id)} to SourceId: ${e}`):this.logger.warn(`No Participant found for SourceId: ${e}`),t}getDataChannelSourceId(){let e=(0,o5.find)(this.endpoints.endpointDetails,e=>null!==e&&e.participantId===this._participantId);if(!e)return this.logger.warn(`No participantLeg found for participantId: ${this._participantId}`),-1;if(!e.mediaStreams)return this.logger.warn(`ParticipantLeg ${this._participantId} does not have valid mediaStreams`),-1;let t=(0,o5.find)(e.mediaStreams,e=>3===hb(e.type));return t?t.sourceId:(this.logger.warn(`participantLeg ${this._participantId} has no data channel`),-1)}initializeLiveStreamConfigProvider(){let e="MDN_MIDDLELANE_TEAMS",t="liveStream",i=this.ecsProvider.getEcsConfig(e,t),n=this.ecsProvider.getEcsConfig("ConfigIDs",e);this._liveStreamConfigProvider=new iu(i,null,n,this.logger.createChild("LiveStreamConfigProvider"))}isMediaSending(e){return this.mediaStateConfigurationHelper.isSending(e)}async setAudioStreamConnectedAsync(e){this.isAudioStreamConnected=e}async setSpamRiskLevelAsync(e){this.spamRiskLevel=e}async setSpamStirAttestationAsync(e){this.spamStirAttestation=e}async setDominantSpeakerInfoAsync(e){this.dominantSpeakerInfo=e}async setSlowedDownActiveTalkerInfoAsync(e){this.slowedDownActiveTalkerInfo=e}};ye.instanceCount=0,ye.getNegotiationTagsFromEndpoints=e=>{if(!e)return;let t=new Map;return ye.filterVirtualEndpoints(e).forEach(e=>{t.set(e.endpointId,e.negotiationTag)}),t},eM([aM("SetMeetingLayout"),eD(0,ak)],ye.prototype,"setMeetingLayout",1),eM([aM("Initialize",{type:"Sync",convertError:!0,idempotencyLevel:"NoOp"})],ye.prototype,"init",1),eM([aM("StartVideo",{waitFor:"_UpdateMediaDescriptions",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"startVideo",1),eM([aM("StopVideo",{waitFor:"_UpdateMediaDescriptions",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"stopVideo",1),eM([aM("DumpVideoSourceImages")],ye.prototype,"dumpVideoSourceImages",1),eM([eD(1,ak)],ye.prototype,"hold",1),eM([aM("Hold",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(0,ak)],ye.prototype,"holdWithRenegotiate",1),eM([aM("LocalHold",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(0,ak)],ye.prototype,"localHold",1),eM([aM("Unhold",{waitFor:["Hold","LocalHold"],preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"unhold",1),eM([aM("UpdateEndpointMetadata"),eD(1,ak)],ye.prototype,"updateEndpointMetadata",1),eM([aM("SendDtmfTone",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]})],ye.prototype,"sendDtmfTone",1),eM([aM("SetAudioUsage")],ye.prototype,"setAudioUsageMode",1),eM([aM("SetAudioMidcallConfig")],ye.prototype,"setAudioMidcallConfig",1),eM([aM("SetAudioMidcallConfigJon",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"setAudioMidcallConfigJson",1),eM([aM("SetParticipantSpatialAudioPositions",{waitFor:"_ElectronSlimcoreReady",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"setParticipantSpatialAudioPositions",1),eM([aM("BlindTransfer",{singular:!0,type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"callBlindTransfer",1),eM([aM("SafeTransfer",{singular:!0,type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"callSafeTransfer",1),eM([aM("TransferToVoicemail",{singular:!0,type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"transferCallToVoicemail",1),eM([aM("ConsultativeTransfer",{singular:!0,type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"callConsultativeTransfer",1),eM([aM("ConsultativeTransferWithPickupCode",{singular:!0,type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]})],ye.prototype,"consultativeTransferWithPickupCode",1),eM([aM("CallRedirect",{singular:!0,type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"callRedirect",1),eM([aM("ParkCall",{type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"park",1),eM([aM("UnparkCall",{type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"unpark",1),eM([aM("getTechnicalInformationJson",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]})],ye.prototype,"getTechnicalInformationJson",1),eM([aM("StartScreenSharing",{waitFor:"_UpdateMediaDescriptions",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(3,ak)],ye.prototype,"startScreenSharing",1),eM([aM("StopScreenSharing",{waitFor:"_UpdateMediaDescriptions",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(2,ak)],ye.prototype,"stopScreenSharing",1),eM([aM("StartDataChannel",{type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"startDataChannel",1),eM([aM("StopDataChannel",{type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"stopDataChannel",1),eM([aM("ShareSystemSounds",{waitFor:"_UpdateMediaDescriptions",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"shareSystemSound",1),eM([aM("Mute",{waitFor:"JoinPreheatedCall",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(0,aL),eD(0,ak)],ye.prototype,"mute",1),eM([aM("Unmute",{waitFor:["JoinPreheatedCall"]}),eD(0,aL),eD(0,ak)],ye.prototype,"unmute",1),eM([aM("MuteSpeaker",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(0,ak)],ye.prototype,"muteSpeaker",1),eM([aM("UnmuteSpeaker",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(0,ak)],ye.prototype,"unmuteSpeaker",1),eM([aM("GetSpeakerVolume",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(0,ak)],ye.prototype,"getSpeakerVolume",1),eM([aM("SetSpeakerVolume",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"setSpeakerVolume",1),eM([aM("MuteParticipants",void 0),eD(2,aL),eD(2,ak)],ye.prototype,"muteParticipants",1),eM([aM("StartAudio",{type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"startAudio",1),eM([aM("StopAudio",{type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"stopAudio",1),eM([aM("Assimilate"),eD(3,ak)],ye.prototype,"assimilate",1),eM([eD(2,ak)],ye.prototype,"merge",1),eM([aM("MergeParticipants"),eD(1,aO),eD(3,ak)],ye.prototype,"mergeParticipants",1),eM([aM("MergeWithPickupCode"),eD(0,aO),eD(2,ak)],ye.prototype,"mergeWithPickupCode",1),eM([aM("SetMaxVideoChannels")],ye.prototype,"setMaxVideoChannels",1),eM([aM("SetMaxVbssChannels")],ye.prototype,"setMaxVbssChannels",1),eM([aM("StopCall"),eD(1,ak),eD(3,ax)],ye.prototype,"stop",1),eM([aM("PublishState"),eD(1,aO)],ye.prototype,"publishState",1),eM([aM("PublishState"),eD(1,aO)],ye.prototype,"publishStatesForEveryone",1),eM([aM("RemoveState"),eD(1,aO)],ye.prototype,"removeState",1),eM([aM("RemoveState"),eD(1,aO)],ye.prototype,"removeStatesForEveryone",1),eM([aM("UpdateMeetingSettings"),eD(1,aO)],ye.prototype,"updateMeetingSettings",1),eM([aM("UpdateMeetingGroups"),eD(0,aO)],ye.prototype,"updateMeetingGroups",1),eM([aM("UpdateMeetingLiveState"),eD(0,aO)],ye.prototype,"updateMeetingLiveState",1),eM([aM("UpdateMeetingStates"),eD(1,aO)],ye.prototype,"updateMeetingStates",1),eM([aM("UpdateParticipantInterpretationState"),eD(0,aO)],ye.prototype,"updateParticipantInterpretationState",1),eM([aM("UpdateParticipantsProperties")],ye.prototype,"updateParticipantsProperties",1),eM([aM("JoinMeetingGroup"),eD(0,aO)],ye.prototype,"joinMeetingGroup",1),eM([aM("LeaveMeetingGroup"),eD(0,aO)],ye.prototype,"leaveMeetingGroup",1),eM([aM("SendMessages"),eD(0,aO)],ye.prototype,"sendMessages",1),eM([aM("UpdateMonitorSession"),eD(1,ak)],ye.prototype,"updateMonitorSession",1),eM([aM("SwitchInterpreterGroup")],ye.prototype,"switchInterpreterGroup",1),eM([aM("SetLiveInterpretationAttributes")],ye.prototype,"setLiveInterpretationAttributes",1),eM([aM("UpdateMeetingRole")],ye.prototype,"updateMeetingRoles",1),eM([aM("CreateContentSharingSession"),eD(4,ak)],ye.prototype,"createContentSharingSession",1),eM([aM("StopCallWithBeacon",{type:"Sync"}),eD(0,ak)],ye.prototype,"stopWithBeacon",1),eM([aM("Acknowledge",{type:"Chained",convertError:!0,idempotencyLevel:"Error",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(2,ak)],ye.prototype,"acknowledge",1),eM([aM("Accept",{type:"Chained",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(1,ak)],ye.prototype,"accept",1),eM([aM("Reject",{preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(0,ak),eD(1,ax)],ye.prototype,"reject",1),eM([aM("JoinCall",{type:"Chained",idempotencyLevel:"Error"}),eD(1,aN),eD(2,ak)],ye.prototype,"join",1),eM([aM("JoinPreheatedCall",{waitFor:"_CallStartOrJoinInitiated"})],ye.prototype,"joinPreheatedCall",1),eM([aM("StartCall",{type:"Chained",idempotencyLevel:"Error"}),eD(0,aN),eD(1,ak)],ye.prototype,"start",1),eM([aM("StartCallToVoiceMail",{type:"Chained",idempotencyLevel:"Error"}),eD(1,ak)],ye.prototype,"startCallToVoicemail",1),eM([aM("StartSessionWithBot",{type:"Chained",triggerAttach:!0,idempotencyLevel:"Error"})],ye.prototype,"startSessionWithBot",1),eM([aM("Subscribe",{type:"Chained",idempotencyLevel:"Error"}),eD(2,ak)],ye.prototype,"joinCallWithoutCallModality",1),eM([aM("StartWithMeetingData",{type:"Chained",idempotencyLevel:"Error"})],ye.prototype,"startWithMeetingData",1),eM([aM("JoinWithMeetingData",{type:"Chained",idempotencyLevel:"Error"})],ye.prototype,"joinWithMeetingData",1),eM([aM("SubscribeWithMeetingData",{type:"Chained",idempotencyLevel:"Error"})],ye.prototype,"subscribeWithMeetingData",1),eM([aM("StartCallWithNudge",{type:"Chained",idempotencyLevel:"Error"}),eD(1,aN),eD(2,ak)],ye.prototype,"startCallWithNudge",1),eM([aM("StartCallAndUnpark",{type:"Chained",idempotencyLevel:"Error",preconditionTags:["NOT_SUPPORTED_IN_STREAMING_MODE"]}),eD(2,aN),eD(3,ak)],ye.prototype,"startAndUnpark",1),eM([aD("AdmitParticipant"),eD(0,aO),eD(1,ak)],ye.prototype,"admitParticipant",1),eM([aM("Admit")],ye.prototype,"admit",1),eM([aD("CallMeBack"),eD(0,aO),eD(2,ak)],ye.prototype,"callMeBack",1),eM([eD(0,aO),eD(2,ak)],ye.prototype,"addParticipant",1),eM([aD("AddParticipants"),eD(0,aO),eD(2,ak)],ye.prototype,"addParticipants",1),eM([eD(0,aO),eD(2,ak)],ye.prototype,"addParticipantsImpl",1),eM([aD("NudgeParticipants"),eD(0,aO),eD(3,ak)],ye.prototype,"nudgeParticipants",1),eM([aD("RemoveParticipant"),eD(0,aO),eD(1,ak)],ye.prototype,"removeParticipant",1),eM([aD("CancelNudge"),eD(0,aO),eD(0,ak)],ye.prototype,"cancelNudge",1),eM([aM("SearchParticipants"),eD(1,aO),eD(1,ak)],ye.prototype,"searchParticipants",1),eM([aM("GetAllParticipants"),eD(1,aO),eD(1,ak)],ye.prototype,"getAllParticipants",1),eM([aM("_PromotionToRealtime"),eD(1,ak)],ye.prototype,"promoteToRealtime",1),eM([eD(0,ak)],ye.prototype,"turnOffLocalVideoPreview",1),eM([aM("_StartPreviewVideo"),eD(0,ak)],ye.prototype,"turnOnLocalVideoPreview",1),eM([eD(0,ak)],ye.prototype,"acquireLocalVideo",1),eM([eD(0,ak)],ye.prototype,"turnOnLocalVideoPreviewUsingRenderer",1),eM([aM("_UpdateLocalMediaStatus",{type:"Chained"}),eD(0,ak)],ye.prototype,"updateMediaStatus",1),eM([eD(0,ak)],ye.prototype,"calculateIsSomeoneStreaming",1),eM([aM("_Reconnect")],ye.prototype,"reconnect",1),eM([aM("AddGroupModality"),eD(1,ak)],ye.prototype,"addGroupModality",1),eM([aM("AddBroadcastModality")],ye.prototype,"addBroadcastModality",1);var yt=ye;function yi(e){let t=new TextDecoder("utf-8"),i=atob(e),n=Uint8Array.from(i,e=>e.charCodeAt(0));return t.decode(n)}var yn=eR(eK()),yr=RegExp("/callAgent/","i"),ys=class{constructor(e,t){this.signalingAgentProvider=e,this.callRegistry=t}handleMessage(e){if(e.eventId){if(e.eventId in oU){this.callRegistry.logUploadNotification(e);let t=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(e);return"number"==typeof t?{isHandled:!0,resultCode:t}:{isHandled:!0,resultCode:t.resultCode,responseBody:t.responseBody,responseHeaders:t.responseHeaders}}}else if(e.url.search(yr)>-1){let t=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(e);return"number"==typeof t?{isHandled:!0,resultCode:t}:{isHandled:!0,resultCode:t.resultCode,responseBody:t.responseBody,responseHeaders:t.responseHeaders}}return{isHandled:!1}}},ya=class{constructor(e,t,i){this.callRegistry=e,this.recentInvitations=[],this.logger=t.createChild("IncomingCallMessageHandler"),this.ecsProvider=i,this._createNewCallWithCallOptions=this.ecsProvider.getEcsConfig("SkypeCalling","createNewCallWithCallOptions")}handleMessage(e){let t=this.handleIncomingCall(e);return t?{isHandled:t,resultCode:200}:{isHandled:t}}handleIncomingCall(e){let t,i=e9(),n=this.logger.createFnLogger("handleIncomingCall",i);if(this.isProxiableNotification(e))return this.callRegistry.proxyPushNotification(e),!0;if(!this.isIncomingCallMessage(e))return!1;this.callRegistry.pushHandlingStarted(i);try{if(e?.body?.gp&&!tF(e.body.gp))n.info("unencoded payload, skipping decoding."),t=e.body.gp;else{let i=yl(e,n);t=JSON.parse(i)}t.body=e.body}catch(e){return this.callRegistry.pushHandlingEnded(i,{result:"Failed to parse incoming call notification payload",code:a2,subCode:3080,participantId:"",callId:"",resultCategories:["UnexpectedServerError"]}),n.logFailure(`Error parsing notification payload: ${e}`),!1}let r=this.isCallTransferNotification(e)?this.buildTransferCallPayload(t):this.buildNGCCallPayload(t);if(!r)return this.callRegistry.pushHandlingEnded(i,{result:"Failed to get incoming call notification payload",code:a2,subCode:3081,participantId:"",callId:"",resultCategories:["UnexpectedClientError"]}),!1;if(this.callRegistry.calls.some(e=>e.callId===r.convoCallId&&e.participantId===r.participantId))return n.logFailure(`Duplicate call filtered because it was in the call registry, callId = ${r.convoCallId}, participantId = ${r.participantId}`),this.callRegistry.pushHandlingEnded(i,{result:"Failed due to duplicate call filtered because it was in the call registry",code:a7,subCode:3082,participantId:r?.participantId,callId:r?.convoCallId,resultCategories:["ExpectedError"]}),!1;let s=this.isCallReplacementNotification(e);if(n.log(`replacementCall=${s}`),!s&&this.recentInvitations.some(e=>e.convoCallId===r.convoCallId&&e.participantId===r.participantId))return n.logFailure(`Duplicate call filtered because it was in the recent calls list, callId = ${r.convoCallId}, participantId = ${r.participantId}`),this.callRegistry.pushHandlingEnded(i,{result:"Failed due to duplicate call filtered because it was in the recent calls list",code:a7,subCode:3083,participantId:r?.participantId,callId:r?.convoCallId,resultCategories:["ExpectedError"]}),!1;5===this.recentInvitations.length&&this.recentInvitations.shift(),this.recentInvitations.push({convoCallId:r.convoCallId,participantId:r.participantId});let a=null,o=null;if(this._createNewCallWithCallOptions?(a=this.callRegistry.generateCreateCallOptions(i,r.convoCallId,r.participantId,r.groupId,r.conversationId,r.messageId,null),o=this.callRegistry.getCurrentCall(a)):o=this.callRegistry.calls.find(e=>e.callId===r.convoCallId&&8===e.state),!o)try{o=this._createNewCallWithCallOptions&&a?this.callRegistry.createNewCall(a):r.groupId?this.callRegistry.createCallWithGroupId(r.groupId,r.convoCallId,r.participantId,i):this.callRegistry.createCall(r.conversationId,r.convoCallId,r.participantId,void 0,i)}catch(t){let e=this._createNewCallWithCallOptions?"Failed to create incoming call notification":r.groupId?"Failed to create incoming call notification with groupId":"Failed to create incoming call notification";this.callRegistry.pushHandlingEnded(i,{result:e,code:a2,subCode:3084,participantId:r?.participantId,callId:r?.convoCallId,resultCategories:["UnexpectedClientError"]})}o.init({threadId:r.conversationId,messageId:r.messageId,mediaPeerType:2});let l=()=>{this.callRegistry.pushHandlingEnded(i,{code:sr.HTTP_STATUS_CODES.OK,subCode:a0,participantId:r?.participantId,callId:r?.convoCallId,resultCategories:["Success"]})},c=e=>{let t=o.callEndDiagnosticsInfo,n=t?t.callControllerSubCode:3085+e.code;this.callRegistry.pushHandlingEnded(i,{result:"Failed to acknowledge incoming call notification",code:t?.callControllerCode||a7,subCode:n,participantId:r?.participantId,callId:r?.convoCallId,resultCategories:t?.resultCategories||["UnexpectedClientError"]})};return this.callRegistry.testEndpointMetadata?o.acknowledge(r,this.callRegistry.testEndpointMetadata,i).then(l).catch(c):o.acknowledge(r,void 0,i).then(l).catch(c),!0}isIncomingCallMessage(e){if(Object.keys(oL).some(t=>oL[t]===e.eventId))if(e.eventId===oL.INCOMING_TFL_TFW_CALL)return this.ecsProvider?.getEcsConfig("SkypeCalling","enableTFWTFLOneToOneCall");else return!0;return this.isCallTransferNotification(e)}isCallTransferNotification(e){return e.callNotification&&("transfer"===e.callNotification.callType||"replaces"===e.callNotification.callType)}isCallReplacementNotification(e){return e.callNotification&&"replaces"===e.callNotification.callType}isProxiableNotification(e){return Object.keys(oF).some(t=>oF[t]===e.eventId)}buildTransferCallPayload(e){let t={body:e.body,callerId:e.callNotification.from.id,displayNameSource:s2(e.callNotification.from.displayNameSource),groupId:null,conversationId:null,convoCallId:e.debugContent.callId,isMultiParty:e.conversationInvitation?.isMultiParty,fromMixer:e.callNotification.fromMixer,ngcCall:!0,participantId:e.callNotification.to.participantId,transferorId:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.id,transferorType:e.callNotification.transferor&&e.callNotification.transferor.transferorType,transferorDisplayName:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.displayName,callType:e.callNotification.callType,consultativeCallId:e.callNotification.consultativeCallId,messageId:null,callQueueInfo:e.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0,calleeAlternateId:e.callNotification.to?.alternateId};return this.logger.info("Incoming transfer paylod",tA(t,["callerId","transferorId"])),t}buildNGCCallPayload(e){if(!e.callNotification)return this.logger.error("Missing callNotification in parsed incoming NGC call payload"),null;let t={groupId:e.groupContext?.id,conversationId:e.groupChat?.threadId,messageId:e.groupChat?.messageId,callerId:e.callNotification.from.id,displayNameSource:s2(e.callNotification.from.displayNameSource),isMultiParty:e.conversationInvitation.isMultiParty,fromMixer:e.callNotification.fromMixer,convoCallId:e.debugContent.callId,participantId:e.debugContent.participantId,ngcCall:!0,body:e.body,transferorId:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.id,transferorType:e.callNotification.transferor&&e.callNotification.transferor.transferorType,transferorDisplayName:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.displayName,callType:e.callNotification.callType,callQueueInfo:e.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0,fromApplicationType:e.callNotification.fromApplicationType,calleeAlternateId:e.callNotification.to?.alternateId,routingTimeout:s3(e.callNotification.routingTimeout)};return this.logger.info("Incoming NGC paylod",tA(t,["callerId","transferorId"])),t}},yo=class extends tZ{constructor(e,t,i,n,r,s=null,a,o,l){super(),this.trouterService=e,this.signalingAgentProvider=t,this.mediaAgent=i,this.callingLogger=n,this.telemetryLoggers=r,this.ecsProvider=s,this.skypeIdentity=a,this.oneDsTelemetryLoggers=o,this.vdi3=l,this.calls=[],this.isDisposing=!1,this._disposedPromise=new iE,this.testEndpointMetadata=null,this._disconnectingPromiseDefers=new Map,this.skypeIdentity&&(this.identity=this.skypeIdentity.id),this.callSubscriptionsMap=new Map,this.logger=new tJ(this.callingLogger).createChild(`CallRegistry/${e9()}`),this.registryTelemetry=new as(this.logger,new Date().getTime()),this._callOperationHandler||(this._callOperationHandler=new aQ(this.logger,this.registryTelemetry,{},e=>{this._publishTelemetry(e)}));let c=this.mediaAgent.getConfig().disconnectOnPageHide;this._windowUninitEvent=c?"pagehide":"beforeunload",this.signalingAgentProvider.getSignalingAgent().setTokenRequiredCallBack(this.onTokenRequired.bind(this)),this._createNewCallInDisconnectedState=this.ecsProvider.getEcsConfig("SkypeCalling","createNewCallInDisconnectedState"),this._invokeDeleteCallInDisconnectedState=this.ecsProvider.getEcsConfig("SkypeCalling","invokeDeleteCallInDisconnectedState")}init(e,t,i=e9()){return this.logger.createFnLogger("init",i).info("init"),this.login(e)}uninit(){return this.logout()}login(e,t=e9()){return this.logger.createFnLogger("login",t).info("login"),this.skypeIdentity=e,this.identity=this.skypeIdentity.id,this.initialize(t)}initialize(e=e9(),t){let i=this.logger.createFnLogger("initialize",e),n=t&&t.applicationType?t.applicationType:"null";i.info(`initialize with applicationType: ${n}`),this.accountConfiguration=t,this.accountConfiguration&&this.event("accountConfigurationReceived").raise(this.accountConfiguration),this.signalingAgentProvider.getSignalingAgent().update(t),this.incomingCallMessageHandler=new ya(this,this.logger,this.ecsProvider),this.trouterService.registerMessageHandler(new ys(this.signalingAgentProvider,this)),this.trouterService.registerMessageHandler(this.incomingCallMessageHandler),i.info("Call registry init, endpointMetadata",this.testEndpointMetadata);try{this.windowUninitListener=()=>{this._disregardWindowUninitEvents||this.stopCallsWithBeacon()},window.addEventListener(this._windowUninitEvent,this.windowUninitListener)}catch(e){i.logFailure(`Not adding beforeunload listener: ${e}`)}return Promise.resolve(void 0)}logout(e=e9()){let t=this.logger.createFnLogger("logout",e);t.info("logout");try{this.trouterService.clearMessageHandlers(),window.removeEventListener(this._windowUninitEvent,this.windowUninitListener)}catch(e){t.info(`Not removing beforeunload listener: ${e}`)}return Promise.resolve(void 0)}_publishTelemetry(e){if(!this.telemetryLoggers?.signaling)return;this.registryTelemetry.setSkypeId(this.identity);try{let e=this.signalingAgentProvider.getSignalingAgent();this.registryTelemetry.setEndpointId(e.endpointId)}catch(e){this.logger.warn("Could not get end point ID from signaling agent for call registry telemetry.")}this.accountConfiguration&&(this.registryTelemetry.setAcsResourceId(this.accountConfiguration.acsResourceId),this.registryTelemetry.setApplicationType(this.accountConfiguration.applicationType),this.registryTelemetry.setPartition(this.accountConfiguration.partition),this.registryTelemetry.setRegion(this.accountConfiguration.region),this.registryTelemetry.setRing(this.accountConfiguration.ring),this.registryTelemetry.setTenantId(this.accountConfiguration.tenantId),this.registryTelemetry.setUserHexCID(this.accountConfiguration.userHexCID),this.registryTelemetry.setClientType(this.accountConfiguration.clientType));let t=s4;this.telemetryLoggers.signaling.sendEvent({eventName:t,props:this.registryTelemetry.getEvent(null,e)})}async dispose(e=e9()){let t=this.logger.createFnLogger("dispose",e);if(t.info("dispose"),this.isDisposing)return t.warn("call registry is already in disposing stage!"),this._disposedPromise.promise;this.isDisposing=!0;let i=()=>{this.calls=[],this.event("disposed").raise(),super.dispose(),this._disposedPromise.resolve()},n=this.calls.map(e=>e.stop()),r=()=>this.logout();return this.clearCallSubscription(),this.signalingAgentProvider.getSignalingAgent().resetAuthTokenManager(),Promise.all(n).then(r,r).then(i,i),this._disposedPromise.promise}get disposePromise(){return this._disposedPromise.promise}createCallAsync(e){let t=this.logger.createFnLogger("createCallAsync",e.causeId),i=`callId:${e.callId}, localParticipantId: ${ta(e.localParticipantId)},
            causeId:${e.causeId}, type:${e.type}, `;switch(e.type){case"MeetingData":i.concat(`meetingUrl:${!!e.meetingData?.meetingUrl}, meetingCode:${!!e.meetingData?.meetingCode}`);break;case"GroupId":i.concat(`groupId:${ta(e.groupId)}`);break;case"ThreadId":i.concat(`threadId:${th(e.threadId)}, messageId:${e.messageId}`);break;default:throw Error("Invalid type in passing parameter.")}t.info(i);let n=this.mediaAgent?.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers,r=this._getCurrentCall(e,t);if(r)if(6!==r.state)return Promise.resolve(r);else{let e=new iE;return this._disconnectingPromiseDefers.set(r.callId,e),e.promise}return Promise.resolve(this._createNewCall(e,n,t))}createCallWithMeetingData(e,t,i,n){let r=this.logger.createFnLogger("createCallWithMeetingData",n);if(r.info(`meetingData:${!!e}, callId:${t}, localParticipantId: ${ta(i)}`),!e)return r.info("meetingData cannot be null"),null;let s=this.generateCreateCallOptions(n,t,i,null,null,null,e),a=this._getCurrentCall(s,r);if(a)return a;let o=this.mediaAgent?.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers;return this._createNewCall(s,o,r)}createCall(e,t,i,n,r=e9()){return this._createCall(e,t,i,n,r)}createCallWithGroupId(e,t,i,n){return this._createCall("",t,i,void 0,n,e)}createNewCall(e){let t=this.logger.createFnLogger("createNewCall",e.causeId);t.info(`createNewCall, callId:${e.callId}, localParticipantId: ${ta(e.localParticipantId)}
            causeId:${e.causeId}, type:${e.type}`);let i=this.mediaAgent?.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers;return this._createNewCall(e,i,t)}_createNewCall(e,t,i){let n=null,r=null,s=null,a=null;switch(e.type){case"MeetingData":a=e.meetingData;break;case"GroupId":n=e.groupId;break;case"ThreadId":r=e.threadId,s=e.messageId}let o=new yt(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,new tJ(this.callingLogger),t,this.skypeIdentity,n,r,e.callId,e.localParticipantId,this.ecsProvider,this.trouterService,this.accountConfiguration,s,this.locationInfoContent,this.networkInfoContent,a,this.areaContent,this.vdi3);o.on("callStateChanged",async()=>{if(7===o.state&&this._createNewCallInDisconnectedState){let n=this._disconnectingPromiseDefers.get(o.callId);n&&(this._disconnectingPromiseDefers.delete(o.callId),n.resolve(this._createNewCall(e,t,i))),this._invokeDeleteCallInDisconnectedState&&setTimeout(()=>{this.deleteCall(o)},0)}}),this.calls.push(o),this.event("callAdded").raise(o),this.raiseChanged(),i.info(`Created new call with id ${o.callId}`);let l=o.on("replacementRequested",e=>{this.incomingCallMessageHandler.handleMessage(e)});return this.addCallSubscriptionToMap(o,l),o}_getCurrentCall(e,t){let i=null;return"MeetingData"===e.type&&(i=this.getCallUsingMeetingData(e.meetingData,e.callId,e.localParticipantId,void 0,void 0,e.causeId))?(t.info("Call Registry has an entry for this call's meeting data"),i):(i=this.getCall(e.callId,e.localParticipantId,e.causeId))?(t.info("Call Registry has an entry for this callId, participantId"),i):"ThreadId"===e.type&&(i=this.getCallUsingThreadIdMessageId(e.threadId,e.callId,e.messageId,e.causeId))?(t.info("Call Registry has an entry for this threadId, messageId"),i):("GroupId"===e.type&&(i=this.calls.find(t=>t.groupId===e.groupId))&&t.info("Call Registry has an entry for this groupId"),i)}_createCall(e,t,i,n,r=e9(),s){let a=this.logger.createFnLogger("createCall",r);a.info(`threadId:${th(e)}, callId:${t}, localParticipantId: ${ta(i)}, messageId:${n}, groupId:${ta(s)}`);let o=this.generateCreateCallOptions(r,t,i,s,e,n,null),l=this._getCurrentCall(o,a);if(l)return l;let c=this.mediaAgent?.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers;return this._createNewCall(o,c,a)}generateCreateCallOptions(e,t,i,n,r,s,a){return n?{type:"GroupId",callId:t,localParticipantId:i,causeId:e,groupId:n}:r?{type:"ThreadId",callId:t,localParticipantId:i,causeId:e,threadId:r,messageId:s}:{type:"MeetingData",callId:t,localParticipantId:i,causeId:e,meetingData:a}}getCall(e,t,i=e9()){let n=this.logger.createFnLogger(`getCall[callId=${e}][participantId=${ta(t)}]`,i);if(!e)return n.logFailure("callId is undefined"),null;let r=this.calls.find(t=>t.callId===e);return r&&n.info("Call Registry already has an entry for this call"),r}getCurrentCall(e){let t=this.logger.createFnLogger("getCurrentCall",e.causeId);return t.info(`getCurrentCall, callId:${e.callId}, localParticipantId: ${ta(e.localParticipantId)}
            causeId:${e.causeId}, type:${e.type}`),this._getCurrentCall(e,t)}async deleteCallAsync(e){return iT(()=>this.deleteCall(e))}deleteCall(e){let t=this.calls.indexOf(e);return -1!==t&&(this.callSubscriptionsMap.get(e).forEach(e=>{e.dispose()}),this.callSubscriptionsMap.delete(e),this.calls.splice(t,1),this.event("callRemoved").raise(e),this.raiseChanged(),!0)}async setConfiguration(e){this.accountConfiguration=e,this.accountConfiguration&&this.event("accountConfigurationReceived").raise(this.accountConfiguration),this.signalingAgentProvider.getSignalingAgent().update(e)}updateDisplayName(e){return this.skypeIdentity.displayName=e,this.calls.forEach(t=>{t.updateDisplayName(e)}),Promise.resolve()}fireIntent(e,t){return Promise.resolve()}getCallState(e,t){return Promise.reject("Not implemented")}getSetup(){}getEcsConfig(){return Promise.reject()}updateSkypeToken(e){this.logger.debug("CallRegistry.updateSkypeToken() called but not supported in the current set up.")}updateToken(e,t,i,n,r){this.logger.info(`[updateToken], causeId = ${n} tokenType = ${t.tokenType}, factorsJson = ${e}, tokenExpiredTime = ${r}`);try{return this.signalingAgentProvider.getSignalingAgent().updateToken(e,t,i,n,r),Promise.resolve(az())}catch(t){return this.logger.info(`Failed to update token with ${e}, error is ${t}`),Promise.reject(aG(`Failed to update token with ${e}, error is ${t}`))}}onTokenRequired(e){let{requestMetadataJson:t,factorsJson:i,tokenType:n,invalidToken:r}=e;this.logger.info(`[onTokenRequired], tokenType ${n}, factorsJson ${i}, requestMetadataJson=${!!t}`),this.event("tokenRequired").raise(i,n,t,r)}pushHandlingStarted(e){this.logger.info(`handleIncomingCallStarted, causeId=${e}`),this.event("pushHandlingStarted").raise(e)}pushHandlingEnded(e,t){this.logger.info(`pushHandlingEnded, causeId=${e}`),this.event("pushHandlingEnded").raise(e,t)}debugInformation(e){return Promise.resolve(e?`CallInformation
 * CallId=${e.callId}`:void 0)}setLocationInfo(e,t,i=e9()){if(this.logger.info(`setLocationInfo, ${i}, infoType:${e}, contentJson ${t?"is set":"is undefined"}`),t)try{JSON.parse(t)}catch(e){return Promise.reject(`invalid contentJson: ${e}`)}return this.locationInfoType=e,1===this.locationInfoType&&(this.locationInfoContent=t,this.logger.info(`locationInfoContent set to ${this.locationInfoContent}`)),2===this.locationInfoType&&(this.networkInfoContent=t,this.logger.info(`networkInfoContent set to ${this.networkInfoContent}`)),3===this.locationInfoType&&(this.areaContent=t,this.logger.info(`areaContent set to ${this.areaContent}`)),this.event("locationInfoSet").raise(e,t),Promise.resolve()}createDownloader(){return null}async getUnassembledLocalRecordingSessions(e=e9()){return Promise.reject("Not implemented")}submitBrbReport(e,t){return Promise.reject("Not implemented")}extendBrbFeedback(e,t){return Promise.reject("Not implemented")}proxyPushNotification(e){this.logger.info(`Proxying push notification with event ID ${e.eventId}`);try{let t={eventId:e.eventId,payload:yl(e,this.logger)};this.event("proxiedPushNotification").raise(t)}catch(e){this.logger.error(`Error proxying push notification: ${e}`)}}logUploadNotification(e){this.logger.info(`Log upload notification with event ID ${e.eventId}`);try{let t={eventId:e.eventId,payload:yl(e,this.logger)};this.event("logUploadNotification").raise(t)}catch(e){this.logger.error(`Error raising log upload notification: ${e}`)}}sendPush(e,t,i,n){let r={id:e},s=[];return t.forEach(e=>{s.push({id:e})}),this.signalingAgentProvider.getSignalingAgent().sendPushAsync(r,s,i,n)}enableWindowUninitEventHandler(){this._disregardWindowUninitEvents=!1}disableWindowUninitEventHandler(){this._disregardWindowUninitEvents=!0}async enableWindowUninitEventHandlerAsync(){this.enableWindowUninitEventHandler()}async disableWindowUninitEventHandlerAsync(){this.disableWindowUninitEventHandler()}getCallUsingThreadIdMessageId(e,t,i,n){this.logger.info(`[getCallUsingThreadIdMessageId][${n}] threadID: ${th(e)} callId: ${t} messageId: ${i}`);let r=null;return e&&(r=this.calls.find(n=>n.threadId===e&&(t&&n.callId===t||null!=i&&n.messageId===i)))&&this.logger.logFailure(`[getCallUsingThreadIdMessageId][${n}]Call Registry already has an entry for threadId: ${th(r.threadId)}, callId: ${r.callId}, messageId: ${r.messageId}`),r}getCallUsingMeetingData(e,t,i,n,r,s=e9()){let a,o=this.logger.createFnLogger("getCallUsingMeetingData",s);if(o.info(`[callId=${t}][participantId=${ta(i)}] meetingData: ${!!e}
            threadId: ${th(n)} messageId: ${r}`),!t)return o.logFailure("callId is undefined"),null;for(let i of this.calls)if(i.callId===t||au(i.meetingData,e,s,this.logger)){a=i;break}return a}stopCallsWithBeacon(){for(let e of this.calls)e.stopWithBeacon()}addCallSubscriptionToMap(e,t){this.callSubscriptionsMap.set(e,(this.callSubscriptionsMap.get(e)||[]).concat(t))}clearCallSubscription(){this.callSubscriptionsMap.forEach(e=>{e.forEach(e=>{e.dispose()})}),this.callSubscriptionsMap.clear()}};function yl(e,t){let i=t.createFnLogger("decodeNotificationPayload"),n="{}",r=e;if(r?.body?.gp)i.info("using notification.body.gp"),n="string"==typeof r.body.gp?yi(r.body.gp):JSON.stringify(r.body.gp);else if(r?.body?.cp){i.info("using notification.body.cp");let e=atob(r.body.cp);n=yn.inflate(e,{to:"string"})}return n}eM([aM("Initialize",{enableInstantTelemetry:!0})],yo.prototype,"initialize",1),eM([aM("Logout",{enableInstantTelemetry:!0})],yo.prototype,"logout",1);var yc=i(892891),yd=class{constructor(e){this.deviceManager=e}get childDeviceManagers(){return this.deviceManager.getRegisteredDevices()}createPreview(e,t){return this.executeOnVirtualDeviceManager(t=>e(t,"Video"),t)}getRawDeviceMediaStream(e,t,i){return this.executeOnVirtualDeviceManager(i=>i.getRawDeviceMediaStream(e,t),i)}setDeviceEffectsAsync(e,t){return this.executeOnVirtualDeviceManager(e=>e.setVideoEffects(t),e)}setRawMediaStream(e,t,i){this.executeOnVirtualDeviceManager(i=>i.setRawMediaStream(e,t),i)}unsetRawMediaStream(e,t){this.executeOnVirtualDeviceManager(t=>t.unsetRawMediaStream(e),t)}getVirtualDevice(e){return this.childDeviceManagers.find(t=>t.id===e)}executeOnVirtualDeviceManager(e,t){return this.getVirtualDevice(t).getDeviceManagers().map(t=>e(t))}},yu="default_output_device",yh=class e extends tZ{constructor(e){super(),this._deviceManager=e,this.virtualDeviceAdapter=new yd(this._deviceManager),e.on("onDevicesChanged",e=>{let t=this._deviceManager.getDeviceDescriptions(e),i=this._mapDevices(t);this._raiseDevicesChanged(i)}),e.on("onSelectedDevicesChanged",e=>this._raiseDevicesChanged()),e.on("onPermissionStateChanged",e=>this.event("onPermissionStateChanged").raise(e)),e.on("onVideoEffectsEvent",(e,t)=>this.event("videoEffectsEvent").raise(e,t)),e.on("onVideoEffectApplied",()=>this.event("videoEffectApplied").raise()),e.on("onEffectsError",(e,t,i)=>this.event("onEffectsError").raise(p8(e),t,i))}get isAudioOutputSelectionSupported(){return this._deviceManager.isAudioOutputSelectionSupported}getPermissionState(e){return"camera"===e?this.getPermissionStateHelper(this._deviceManager.getPermissionState("camera")):"microphone"===e?this.getPermissionStateHelper(this._deviceManager.getPermissionState("microphone")):"unknown"}async getPermissionStateAsync(e){return this.getPermissionState(e)}askDevicePermission(e){return this._deviceManager.askDevicePermission?this._deviceManager.askDevicePermission(e):Promise.resolve({audio:!0,video:!0})}enumerateDevicesAsync(){return this._deviceManager.enumerateDevicesAsync().then(e=>this._mapDevices(e))}getPreferredCamera(){throw Error("Not implemented")}selectDevices(e){if(Object.keys(e).some(e=>this.isVirtualDevice(e)))throw Error("Virtual Device selection on DM is not supported");let t=(0,yc.assign)({},this._deviceManager.getSelectedDevices(),e);this._deviceManager.selectDevices(t)}selectDevicesAsync(e){return iT(()=>this.selectDevices(e))}getSelectedDevices(){return this._deviceManager.getSelectedDevices()}getSelectedDevicesAsync(){return iT(()=>this.getSelectedDevices())}getDeviceNameAsync(e){return this._deviceManager.getDeviceNameAsync(e)}getSpeakerDeviceDomIdAsync(e,t){return this._deviceManager.getSpeakerDeviceDomIdAsync(e)}mapBrowserDevices(e,t){return Promise.reject(Error("Not implemented"))}async setDeviceEffectsAsync(e,t){return this.isVirtualDevice(e)?void Promise.all(this.virtualDeviceAdapter.setDeviceEffectsAsync(e,t)):this._deviceManager.setVideoEffects(t)}getDeviceEffectsCapabilityAsync(e,t){return this._deviceManager.effectsManager.getEffectsCapability("Video")}setBackgroundImageAsync(e,t,i){return this._deviceManager.effectsManager.configure("Video",{imagePath:t,headers:i})}getImagePropertyAsync(e){return Promise.reject(Error("Not implemented"))}getMicrophoneGeometryArrayInfoAsync(e){return Promise.reject(Error("Not implemented"))}transformImageAsync(e,t,i,n){return Promise.reject(Error("Not implemented"))}setAudioProcessingFlags(e){return this._deviceManager.setAudioProcessingFlags(e)}async sendMessageDeviceVideoEffectsAsync(e,t){return await this._deviceManager.sendMessageDeviceVideoEffectsAsync(e,t)}sendMessageDeviceVideoExtensibilityAsync(e,t){return Promise.reject(Error("Not implemented"))}setVideoCaptureConfigAsync(e,t){return Promise.reject(Error("Not implemented"))}captureVideoFrameWithoutEffectsAsync(e,t,i){return Promise.reject(Error("Not implemented"))}enableSignLanguageDetectionAsync(e,t){return Promise.reject(Error("Not implemented"))}downloadAiModel(e,t){return Promise.reject(Error("Not implemented"))}getSpeakerVolume(){return Promise.reject(Error("Not implemented"))}getSpeakerSystemVolume(){return Promise.reject(Error("Not implemented"))}setSpeakerVolume(e){return Promise.reject(Error("Not implemented"))}setSpeakerSystemVolume(e){return Promise.reject(Error("Not implemented"))}unmuteMicrophone(){return Promise.reject(Error("Not implemented"))}unmuteSpeaker(){return Promise.reject(Error("Not implemented"))}getNrgLevelsForDeviceTuner(e){return Promise.reject(Error("Not implemented"))}async getNrgLevelPollerForDeviceTuner(e){return await this._deviceManager.getNrgLevelPollerForDeviceTuner()}setAudioEffectsAsync(e,t){return this._deviceManager.setAudioEffects(t)}setAecRefStream(e,t){this._deviceManager.setAecRefStream?.(e,t)}getAudioFeatureCapability(e){return this._deviceManager.effectsManager.getEffectsCapability("Audio")}getAudioFeatureProviderName(){return Promise.resolve(this._deviceManager.effectsManager.getAudioEffectsProviderName())}getMicrophoneVolume(){return Promise.reject(Error("Not implemented"))}setMicrophoneVolume(e){return Promise.reject(Error("Not implemented"))}setDeviceTelemetryData(e,t,i,n=0){return Promise.reject(Error("Not implemented"))}getSourceFormats(e){return Promise.reject(Error("Not implemented"))}enableShellSharing(){return Promise.reject(Error("Not implemented"))}disableShellSharing(){return Promise.reject(Error("Not implemeted"))}enableParticipantCameras(){return Promise.reject(Error("Not implemeted"))}registerDerivedSource(e,t){return Promise.reject(Error("Not implemeted"))}unregisterDerivedSource(e){return Promise.reject(Error("Not implemeted"))}startPreview(e,t,i){let n=new fM,r=(async()=>{if("camera"===t.kind&&this.isVirtualDevice(t.device))return this.virtualDeviceAdapter.createPreview(this.startRenderer.bind(this,n,e,i),t.device)[0];if("sharing"===t.kind)return this.startRenderer(n,e,i,this._deviceManager,"ScreenShare");if("camera"!==t.kind||!(0,yc.isUndefined)(t.device))throw Error("Not yet supported");return this.startRenderer(n,e,i,this._deviceManager,"Video")})();return{instance:n,promise:r}}async createPreview(e,t,i){let{instance:n,promise:r}=this.startPreview(e,t,i);return await r,n}async createPreviewRenderer(e,t){return this.createPreview(e,{kind:"camera"},t)}async createScreenSharingPreviewRenderer(e,t){return this.createPreview(e,{kind:"sharing"},t)}getRawDeviceMediaStream(e,t,i){let n=p6(e);return this.isVirtualDevice(i)?this.virtualDeviceAdapter.getRawDeviceMediaStream(n,t,i)[0]:this._deviceManager.getRawDeviceMediaStream(n,t)}setRawMediaStream(e,t,i){let n=p6(t);return this.isVirtualDevice(i)?this.virtualDeviceAdapter.setRawMediaStream(e,n,i):this._deviceManager.setRawMediaStream(e,n)}unsetRawMediaStream(e,t){let i=p6(e);return this.isVirtualDevice(t)?this.virtualDeviceAdapter.unsetRawMediaStream(i,t):this._deviceManager.unsetRawMediaStream(i)}createAudioRenderer(){return this._deviceManager.createAudioRenderer()}startAudioLoopbackDevice(e){return Promise.reject(Error("Not implemented"))}async dispose(e){return this._deviceManager.dispose(e)}async registerCompositeVideoDevice(e,t,i){return this._deviceManager.registerVirtualDevice(e,t,i)}async unregisterCompositeVideoDevice(e){return this._deviceManager.unregisterVirtualDevice(e)}async createAudioPlayer(){return Promise.reject(Error("Not implemented"))}_raiseDevicesChanged(e){(e?Promise.resolve(e):this.enumerateDevicesAsync()).then(e=>{this.raiseChanged(),this.event("devicesChanged").raise(e)})}getPermissionStateHelper(e){switch(e){case"granted":return"granted";case"denied":return"denied";case"prompt":return"prompt";default:return"unknown"}}_mapDevices(e){return e?.map(e=>this._mapDeviceDesc(e))}_mapDeviceDesc(t){let i=e._mapDeviceType(t.kind);return 6===i?{id:t.id,label:t.label,kind:i,position:0,defaultVideoId:t.id,devicesIds:[]}:1===i?{id:t.id,browserId:t.browserId,label:t.label,kind:i,position:e._mapCameraPosition(t.position)}:4===i?{id:null,browserId:null,label:t.label,kind:i,formFactor:t.formFactor,isPcInternalDevice:t.isPcInternalDevice,microphoneId:t.microphoneId,speakerId:t.speakerId}:{id:t.id,browserId:t.browserId===yu?"default":t.browserId,label:t.label,kind:i,isSystemDefault:!!t.isSystemDefault}}static _mapDeviceType(e){switch(e){case"camera":return 1;case"microphone":return 2;case"speaker":return 3;case"compositeAudio":return 4;case"virtualDevice":return 6;default:throw Error(`Invalid device type '${e}'`)}}static _mapCameraPosition(e){switch(e){case"front":return 1;case"back":return 2;case"external":return 3;default:return 0}}isVirtualDevice(e){return e&&this._deviceManager.getRegisteredDevices().some(t=>t.id===e)}async startRenderer(e,t,i,n,r){try{e.initialize(t,n,r),await e.startVideoAsync(),i&&(e.setScalingMode(i.scalingMode),e.setVideoMirroring(!i.ignoreMirroring))}catch(t){throw e.dispose(),t}}},yg=i(83836),yp=i(83836),yf=class extends yp.AbstractLogAppender{constructor(e){super(new yp.StandardLogFormatter(yp.SLF_Flags.Component)),this._logger=e}log(e,t,i,n){if(!this._logger)return;let r=e.level<=yp.LogLevel.Debug4?this._logger.debug:e.level<=yp.LogLevel.Debug2?this._logger.log:e.level<=yp.LogLevel.Debug1?this._logger.info:e.level<=yp.LogLevel.Warning?this._logger.warn:this._logger.error;r&&r.apply(this._logger,[this.formatter().format(e,t,i,n)])}},ym=i(83836),yv=eR(e1()),yS=["CorrelationId","agent_environment_id","UserInfo_TenantId","participant_id","endpoint_id","mediaLegId","metrics_ConfigIds","ts_calling_version","uiVersion"],yy={video:[...yS,"Extensions_WebRTCStats_ssrc_video_recv_framesDecoded","Extensions_WebRTCStats_ssrc_video_recv_packetsReceived","Extensions_WebRTCStats_ssrc_video_recv_ssrc","Extensions_WebRTCStats_ssrc_video_recv_bytesReceived","Extensions_WebRTCStats_ssrc_video_recv_googFrameRateDecoded","Extensions_Video_SubscriptionEvents","Extensions_Video_recv_ResolutionDurations","Extensions_Video_recv_StreamsMax","Extensions_Video_recv_frameRateAvg","Extensions_Video_recv_DurationSeconds","Extensions_Video_recv_FreezeHistogram","Extensions_Video_recv_FreezeTimestamps","Extensions_WebRTCStats_ssrc_video_recv_keyFramesDecoded","Extensions_Video_recv_TotalFreezeDuration","Extensions_Video_recv_packetsLostRateMax","metrics_ReconnectAttempts","metrics_ReconnectConnectedCount","metrics_RetargetCompletedCount","metrics_UFDs","Payload"],sharing:[...yS,"Extensions_WebRTCStats_ssrc_sharing_recv_framesDecoded","Extensions_WebRTCStats_ssrc_sharing_recv_packetsReceived","Extensions_WebRTCStats_ssrc_sharing_recv_ssrc","Extensions_WebRTCStats_ssrc_sharing_recv_bytesReceived","Extensions_WebRTCStats_ssrc_sharing_recv_googFrameRateDecoded","Extensions_WebRTCStats_ssrc_sharing_recv_keyFramesDecoded","Extensions_Sharing_SubscriptionEvents","Extensions_Sharing_recv_ResolutionDurations","Extensions_Sharing_recv_StreamsMax","Extensions_Sharing_recv_frameRateAvg","Extensions_Sharing_recv_DurationSeconds","Extensions_Sharing_recv_FreezeHistogram","Extensions_Sharing_recv_FreezeTimestamps","Extensions_Sharing_recv_TotalFreezeDuration","Extensions_Sharing_recv_packetsLostRateMax","metrics_ReconnectAttempts","metrics_ReconnectConnectedCount","metrics_RetargetCompletedCount","metrics_UFDs","Payload"]},yC=class extends tZ{constructor(){super(...arguments),this.stabilizationTimeInAvg=2e4}send(e){e&&setTimeout(()=>{this.event("sendMidCallTelemetry").raise(yy[e])},this.stabilizationTimeInAvg)}},yb=class extends tZ{constructor(e,t){super(),this._telemetryService=e,this._ecsProvider=t,this._ecsProvider.on("OnECSChanged",()=>ym.RootToolsManager.OnEcsChange())}fetchEcsConfig(e,t){return yv.Resolved().then(()=>this._ecsProvider.getEcsConfig(e,t))}sendTelemetry(e,t){this._telemetryService.getGenericTelemetryLogger&&e?this._telemetryService.getGenericTelemetryLogger(e).sendEvent({eventName:"rt_log",props:t}):this._telemetryService.sendEvents([{eventName:"rt_log",props:t}])}sendMidCallTelemetry(e){Object.keys(yy).includes(e)&&this.event("onMidCallTelemetry").raise(e)}};function yT(e,t,i){if(!yg.RootToolsManager.isDelegateSet()){let n=new yb(e.telemetryService,t);if(yg.RootToolsManager.setDelegate(n),n.on("onMidCallTelemetry",e=>i.send(e)),e.logger){let t=new yf(e.logger);yg.LogFactory.instance().addAppender(t)}}e.logger=new ti("JS.TsCalling.Pluginless",!0),e.mediaAgentFactoryConfig.logger=new ti("JS.TsCalling.MediaAgentUnsafe",!1),e.mediaAgentFactoryConfig.safeLogger=new ti("JS.TsCalling.MediaAgent",!0),e.signalingAgentConfig.logger=new ti("JS.TsCalling.SignalingAgent",!0)}var yE=i(892891),y_=class e{constructor(t){this._prefix=t,this._children=[],this._useConsoleLogger=!1,this.createChild=(t,i)=>{let n="function"==typeof t?"":t,r=new e((this._prefix||"")+n);return this._children.push(r),this._useConsoleLogger&&r.useConsoleLogger(),r},this.createFnLogger=(t,i,...n)=>{let r=`[${i}][${t}]`,s=new e((this._prefix||"")+r);return this._children.push(s),this._useConsoleLogger&&s.useConsoleLogger(),s}}logInfo(){}logFailure(){}logSuccess(){}log(){}debug(){}info(){}warn(){}error(){}useConsoleLogger(){this._useConsoleLogger=!0;let e=(...e)=>{console.info(this._prefix||"",...e)};this.log=e,this.debug=e,this.info=e,this.warn=e,this.error=e,(0,yE.each)(this._children,e=>e.useConsoleLogger())}},yI=class{constructor(e){this.configProvider=e,this.window=mk,this.updateCapabilityOverrides(),this.configProviderSub=e.on("configUpdated",()=>this.updateCapabilityOverrides())}get audio(){return this.getCapability("audio")}get video(){return this.getCapability("video")}get screensharing(){return this.getCapability("screensharing")}get retargeting(){return this.getCapability("retargeting")}dispose(){this.configProviderSub&&this.configProviderSub.dispose()}updateCapabilityOverrides(){let e;this.configProvider.config.capabilities&&(e=this.configProvider.config.capabilities),this.overrides=e||{}}hasMediaCapture(){return!!this.window.navigator.getUserMedia}getCapability(e){return void 0!==this.overrides[e]?!!this.overrides[e]:this.hasMediaCapture()&&this.hasWebRtc()}hasWebRtc(){return void 0!==this.window.RTCPeerConnection}},yw=class e extends no{constructor(e,t,i){super(e),this.logger=e,this.configProvider=t,this.diagnostics=i,this.eventStates=new Map,this.debounceMap=new Map,this.logger.safe.info("Initialized")}signalEvent(e,t,i="Audio",n=!0,r=e9(),s,a){let o={type:e,value:t,isLocalSource:n,mediaType:i,deviceManagerId:s,diagnosticData:a};this.shouldRaiseEvent(o)&&this.diagnostics.registerQualityChangedEvent(o);let l=SP(o),c=this.eventStates.get(l);if(this.configProvider.config.localUFDDebounceTime&&c){clearTimeout(this.debounceMap.get(l));let e=setTimeout(this.raiseEvent.bind(this),this.configProvider.config.localUFDDebounceTime,o,r);this.debounceMap.set(l,e)}else this.raiseEvent(o,r)}raiseEvent(e,t){let i=SP(e);this.shouldRaiseEvent(e)&&(this.eventStates.set(i,e),this.logger.safe.info(`[${t}] Raising UFD ${e.type} for ${e.mediaType}: ${e.value}`),this.event("onQualityChanged").raise(e))}signalDeviceEvent(t,i,n,r){let s=e.getQualityEventType(t,n,this.configProvider);s?this.signalEvent(s,i,n,void 0,e9(),r):this.logger.warn(`Unknown device quality event type: ${t}`)}raisePendingWhitelistingUFD(){this.lastWhitelistingUFD&&(this.logger.safe.debug(`Raising whitelisting UFD ${this.lastWhitelistingUFD.type}: ${this.lastWhitelistingUFD.value}`),this.event("onQualityChanged").raise(this.lastWhitelistingUFD),this.cancelPendingWhitelistingUFD())}cancelPendingWhitelistingUFD(){if(this.lastWhitelistingUFD){let e=SP(this.lastWhitelistingUFD);this.eventStates.delete(e)}this.lastWhitelistingUFD=void 0}applyCurrentState(e){this.cancelPendingWhitelistingUFD();let t=0;for(let i of this.eventStates.values())"Good"!==i.value&&(e(i),t++);t>0&&this.logger.safe.info(`Applied ${t} UFDs`)}reset(){for(let[t,i]of(this.logger.safe.info("Resetting UFD states"),this.eventStates.entries()))e.persistent.has(i.type)||this.eventStates.delete(t);this.lastWhitelistingUFD=void 0}shouldRaiseEvent(t){let i=SP(t),n=this.eventStates.get(i);if(n&&n.value===t.value)if(this.configProvider.config.alwaysRaiseBadDeviceEvents&&e.deviceQualityEvents.has(t.type)&&"Good"!==t.value)return!0;else return!1;return(!!n||"Good"!==t.value)&&("NetworkRelaysNotReachable"!==t.type||(this.lastWhitelistingUFD=t,!1))}static getQualityEventType(e,t,i){switch(e){case 0:return"Audio"===t?"DeviceCaptureNotFunctioning":"VideoCapturerDeviceStartFailed";case 1:return"DeviceRenderNotFunctioning";case 2:return"Audio"===t?"DeviceCaptureNotFunctioning":"VideoCapturerDeviceStartTimedOut";case 3:return"DeviceCaptureMute";case 4:switch(t){case"ScreenShare":return"ScreenshareRecordingDisabled";case"Audio":return i.config.enableSignalingAudioPermissionDeniedUFD?"AudioCapturePermissionDenied":"DeviceCaptureNotMuteButSilent";case"Video":return"VideoCapturePermissionDenied";default:return}default:return}}};yw.persistent=new Set(["ZeroCaptureDevicesEnumerated","ZeroRenderDevicesEnumerated"]),yw.deviceQualityEvents=new Set(["DeviceCaptureNotFunctioning","VideoCapturerDeviceStartFailed","VideoCapturerDeviceStartTimedOut","DeviceCaptureMute","ScreenshareRecordingDisabled","DeviceCaptureNotMuteButSilent","VideoCapturePermissionDenied"]);var yP=yw,yR=i(892891),yA="function",yM="object",yD="undefined",yO="prototype",yk=Object,yN=yk[yO];function yx(e,t){return e||t}function yL(e,t){return e[t]}var yF=void 0,yU=null,y$="",yV="function",yB="object",yH="prototype",yj="__proto__",yq="undefined",yW="constructor",yG="Symbol",yz="length",yJ="name",yK="call",yQ="toString",yY="getOwnPropertyDescriptor",yZ="getOwnPropertySymbols",yX=yx(Object),y0=yL(yX,yH),y1=yx(String),y2=yL(y1,yH),y3=yx(Math),y4=yx(Array),y5=yL(y4,yH),y6=yL(y5,"slice"),y8="_polyfill",y9="__nw21$polytype__";function y7(e,t){try{return{v:e.apply(this,t)}}catch(e){return{e}}}function Ce(e,t,i){var n=y7(e,i);return n.e?t:n.v}function Ct(e){return function(t){return typeof t===e}}function Ci(e){var t="[object "+e+"]";return function(e){return!!(e&&Cn(e)===t)}}function Cn(e){return y0[yQ].call(e)}function Cr(e){return typeof e===yq||e===yq}function Cs(e){return e===yF}function Ca(e){return e===yU||Cr(e)}function Co(e){return e===yU||e===yF}function Cl(e){return!!e||e!==yF}function Cc(e){return e===yU||Cd(typeof e)}function Cd(e){return T||(T=["string","number","boolean",yq,"symbol","bigint"]),e!==yB&&-1!==T.indexOf(e)}var Cu=Ct("string"),Ch=Ct(yV);function Cg(e){return!(!e&&Ca(e))&&!!e&&typeof e===yB}var Cp=yL(y4,"isArray"),Cf=Ci("Date"),Cm=Ct("number"),Cv=Ct("boolean"),CS=Ci("Error");function Cy(e){return!!(e&&e.then&&Ch(e.then))}function CC(e){return!(!e||Ce(function(){return!(e&&0+e)},!e))}function Cb(){}function CT(){return[]}function CE(){return!1}var C_=yx(y1),CI="[object Error]";function Cw(e,t){var i=y$,n=y0[yQ][yK](e);n===CI&&(e={stack:C_(e.stack),message:C_(e.message),name:C_(e.name)});try{i=((i=JSON.stringify(e,yU,t?"number"==typeof t?t:4:yF))?i.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: "):yU)||C_(e)}catch(e){i=" - "+Cw(e,t)}return n+": "+i}function CP(e){throw Error(e)}function CR(e){throw TypeError(e)}function CA(e){Co(e)&&CR("Cannot convert undefined or null to object")}function CM(e){Cu(e)||CR("'"+Cw(e)+"' is not a string")}function CD(e,t){return!!e&&y0.hasOwnProperty[yK](e,t)}var CO=yx(yL(yX,yY),Cb),Ck=yx(yL(yX,"hasOwn"),CN);function CN(e,t){return CA(e),CD(e,t)||!!CO(e,t)}function Cx(e,t,i){if(e&&(Cg(e)||Ch(e))){for(var n in e)if(Ck(e,n)&&-1===t[yK](i||e,n,e[n]))break}}function CL(e,t,i){if(e)for(var n=e[yz]>>>0,r=0;r<n&&(!(r in e)||-1!==t[yK](i||e,e[r],r,e));r++);}var CF=CU;function CU(e,t,i){var n=t?t[e]:yU;return function(t){var r=(t?t[e]:yU)||n;if(r||i){var s=arguments;return(r||i).apply(t,r?y6[yK](s,1):s)}CR('"'+C_(e)+'" not defined for '+Cw(t))}}function C$(e){return function(t){return t[e]}}function CV(e,t){var i,n=yX.getOwnPropertyDescriptor;return!Co(e)&&n&&(i=y7(n,[e,t]).v||yU),i||(i=y7(function(){for(var i in e)if(i===t)return{enumerable:!0}}).v),i&&i.enumerable||!1}var CB=CU("propertyIsEnumerable",yU,CV),CH=yx(yL(yX,yY),Cb),Cj=yx(yL(yX,yZ),CT),Cq={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};function CW(e){var t={};if(t[Cq.c]=!0,t[Cq.e]=!0,e.l){t.get=function(){return e.l.v};var i=CH(e.l,"v");i&&i.set&&(t.set=function(t){e.l.v=t})}return Cx(e,function(e,i){t[Cq[e]]=Cs(i)?t[Cq[e]]:i}),t}var CG=yL(yX,"defineProperty"),Cz=yL(yX,"defineProperties");function CJ(e,t,i){return CG(e,t,CW(i))}function CK(e,t){var i={};return Cx(t,function(e,t){i[e]=CW(t)}),CL(Cj(t),function(e){CB(t,e)&&(i[e]=CW(t[e]))}),Cz(e,i)}function CQ(e,t,i,n,r){var s={};return Cx(e,function(e,n){CY(s,e,t?n:e),CY(s,n,i?n:e)}),n?n(s):s}function CY(e,t,i,n){CG(e,t,{value:i,enumerable:!0,writable:!1})}var CZ=yx(yL(yX,"isFrozen"),CE),CX=yL(yX,"freeze");function C0(e){return e}function C1(e){return CA(e),e[yj]||yU}var C2=yL(yX,"assign"),C3=yL(yX,"keys");function C4(e,t){if((Cp(e)||Cg(e)||Ch(e))&&!CZ(e)){for(var i=0;i<t.length;i++)if(t[i]===e)return e;t.push(e),Cx(e,function(e,i){C4(i,t)}),C6(e)}return e}function C5(e){return CX?C4(e,[]):e}var C6=yx(CX,C0),C8=yx(yL(yX,"getPrototypeOf"),C1);function C9(e){return CQ(e,1,0,C6)}function C7(e){var t={};return Cx(e,function(e,i){CY(t,e,i[1]),CY(t,i[0],i[1])}),C6(t)}function be(e){return C7(e)}var bt=function(e){return CQ(e,0,0,C6)}({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12}),bi="__tsUtils$gblCfg";function bn(){var e;return typeof globalThis!==yq&&(e=globalThis),e||typeof self===yq||(e=self),e||typeof window===yq||(e=window),e||typeof n===yq||(e=n),e}function br(){if(!E){var e=y7(bn).v||{};E=e[bi]=e[bi]||{}}return E}var bs=yL(y3,"max"),ba=CF("slice",y2),bo=CF("substring",y2),bl=CU("substr",y2,bc);function bc(e,t,i){return(CA(e),i<0)?y$:((t=t||0)<0&&(t=bs(t+e[yz],0)),Cr(i))?ba(e,t):ba(e,t,t+i)}function bd(e,t){return bo(e,0,t)}function bu(e,t){return e&&(y7(function(){e[y8]=!0,e[y9]=t}),y7(CJ,[e,y8,{v:!0,w:!1,e:!1}]),y7(CJ,[e,y9,{v:t,w:!1,e:!1}])),e}var bh=yx(yL(yX,"create"),bg);function bg(e,t){var i=null;function n(){}if(Co(e))i={};else{var r=typeof e;r!==yB&&r!==yV&&CR("Prototype must be an Object or function: "+Cw(e)),n[yH]=e,y7(function(){n[yj]=e}),i=new n}return t&&y7(Cz,[i,t]),i}function bp(){return(Date.now||bf)()}function bf(){return new Date().getTime()}function bm(e,t,i){return e.apply(t,i)}function bv(){_=br()}function bS(e,t){var i={};return _||bv(),i.b=_.lzy,CG(i,"v",{configurable:!0,get:function(){var n=bm(e,null,t);return _.lzy||CG(i,"v",{value:n}),i.b=_.lzy,n}}),i}var by=yL(y3,"random"),bC=bS(function(){for(var e=bp().toString(36).slice(2);e.length<16;)e+=by().toString(36).slice(2);return e.substring(0,16)}),bb="_urid",bT="$nw21sym",bE=0;function b_(){if(!I){var e=br();I=e.gblSym=e.gblSym||{k:{},s:{}}}return I}function bI(e){var t="_"+bE+++"_"+bC.v,i=yG+"("+e+")";function n(e,t){CJ(r,e,{v:t,e:!1,w:!1})}var r=bh(null);return n("description",C_(e)),n(yQ,function(){return i+bT+t}),n("valueOf",function(){return r}),n("v",i),n("_uid",t),bu(r,"symbol")}function bw(e){var t=b_();if(!Ck(t.k,e)){var i=bI(e),n=C3(t.s).length;i[bb]=function(){return n+"_"+i[yQ]()},t.k[e]=i,t.s[i[bb]()]=C_(e)}return t.k[e]}function bP(e){w||(w={});var t,i=bt[e];return i&&(t=w[i]=w[i]||bI(yG+"."+i)),t}function bR(e){return CG({toJSON:function(){return e}},"v",{value:e})}var bA="window";function bM(e,t){var i;return function(){return _||bv(),(!i||_.lzy)&&(i=bR(y7(e,t).v)),i.v}}function bD(e){return _||bv(),(!P||!1===e||_.lzy)&&(P=bR(y7(bn).v||yU)),P.v}function bO(e,t){var i;if((i=P&&!1!==t?P.v:bD(t))&&i[e])return i[e];if(e===bA)try{return window}catch(e){}return yU}function bk(){return!!bN()}var bN=bM(bO,["document"]);function bx(){return!!bL()}var bL=bM(bO,[bA]);function bF(){return!!bU()}var bU=bM(bO,["navigator"]),b$=bM(function(){return!!y7(function(){}).v});function bV(){return R=bR(y7(bO,[yG]).v)}function bB(e){var t=(_.lzy?0:R)||bV();return t.v?t.v[e]:yF}function bH(){return!!bj()}function bj(){return _||bv(),((!_.lzy?R:0)||bV()).v}function bq(e,t){var i=bt[e];_||bv();var n=(_.lzy?0:R)||bV();return n.v?n.v[i||e]:t?yF:bP(e)}function bW(e,t){_||bv();var i=(_.lzy?0:R)||bV();return i.v?i.v(e):t?yU:bI(e)}function bG(e){return _||bv(),((A=(_.lzy?0:A)||bR(y7(bB,["for"]).v)).v||bw)(e)}function bz(e){return!!e&&Ch(e.next)}function bJ(e){return!Co(e)&&Ch(e[bq(3)])}function bK(e,t,i){if(e&&(bz(e)||(M||(M=bR(bq(3))),e=e[M.v]?e[M.v]():yU),bz(e))){var n=yF,r=yF;try{for(var s=0;!(r=e.next()).done&&-1!==t[yK](i||e,r.value,s,e);)s++}catch(t){n={e:t},e.throw&&(r=yU,e.throw(n))}finally{try{r&&!r.done&&e.return&&e.return(r)}finally{if(n)throw n.e}}}}function bQ(e,t){return!Cr(t)&&e&&(Cp(t)?bm(e.push,e,t):bz(t)||bJ(t)?bK(t,function(t){e.push(t)}):e.push(t)),e}var bY=CF("indexOf",y5);function bZ(e,t,i){return((e?e.slice:yU)||y6).apply(e,y6[yK](arguments,1))}var bX=CU("includes",y5,function(e,t,i){return -1!==bY(e,t,i)}),b0=yx(yL(yX,"setPrototypeOf"),b1);function b1(e,t){var i;return D||(D=bR(((i={})[yj]=[],i instanceof Array))),D.v?e[yj]=t:Cx(t,function(t,i){return e[t]=i}),e}function b2(e,t,i){function n(){this[yW]=t,y7(CJ,[this,yJ,{v:e,c:!0,e:!1}])}return y7(CJ,[t,yJ,{v:e,c:!0,e:!1}]),(t=b0(t,i))[yH]=i===yU?bh(i):(n[yH]=i[yH],new n),t}function b3(e,t){t&&(e[yJ]=t)}function b4(e,t,i){var n=i||Error,r=n[yH][yJ],s=Error.captureStackTrace;return b2(e,function(){var i=this,a=arguments;try{y7(b3,[n,e]);var o=bm(n,i,y6[yK](a))||i;if(o!==i){var l=C8(i);l!==C8(o)&&b0(o,l)}return s&&s(o,i[yW]),t&&t(o,a),o}finally{y7(b3,[n,r])}},n)}var b5=CU("trim",y2,function(e){return function(t){return CA(t),t&&t.replace&&(t=t.replace(e,y$)),t}}(/^\s+|(?=\s)\s+$/g));function b6(e){if(!e||typeof e!==yB)return!1;N||(N=!bx()||bL());var t=!1;if(e!==N){k||(k=(O=Function[yH][yQ])[yK](yX));try{var i=C8(e);(t=!i)||(CD(i,yW)&&(i=i[yW]),t=!!(i&&typeof i===yV&&O[yK](i)===k))}catch(e){}}return t}function b8(e){return e.value&&To(e),!0}var b9=[Tr,To,Ta,Ts];function b7(e,t,i,n){var r;return CL(e,function(e){if(e.k===t)return r=e,-1}),r||(r={k:t,v:t},e.push(r),n(r)),r.v}function Te(e,t,i,n){var r=i.handler,s=i.path?n?i.path.concat(n):i.path:[],a={handler:i.handler,src:i.src,path:s},o=typeof t,l=!1,c=t===yU;c||(t&&o===yB?l=b6(t):c=Cd(o));var d={type:o,isPrim:c,isPlain:l,value:t,result:t,path:s,origin:i.src,copy:function(t,n){return Te(e,t,n?a:i,n)},copyTo:function(t,i){return Tt(e,t,i,a)}};return d.isPrim?r&&r[yK](i,d)?d.result:t:b7(e,t,s,function(e){CJ(d,"result",{g:function(){return e.v},s:function(t){e.v=t}});for(var t=0,n=r;!(n||(t<b9.length?b9[t++]:b8))[yK](i,d);)n=yU})}function Tt(e,t,i,n){if(!Ca(i))for(var r in i)t[r]=Te(e,i[r],n,r);return t}function Ti(e,t,i){var n={handler:i,src:t,path:[]};return Tt([],e,t,n)}function Tn(e,t){var i={handler:t,src:e};return Te([],e,i)}function Tr(e){var t=e.value;if(Cp(t)){var i=e.result=[];return i.length=t.length,e.copyTo(i,t),!0}return!1}function Ts(e){var t=e.value;return!!Cf(t)&&(e.result=new Date(t.getTime()),!0)}function Ta(e){return e.type===yV}function To(e){var t=e.value;if(t&&e.isPlain){var i=e.result={};return e.copyTo(i,t),!0}return!1}function Tl(e,t){return CL(t,function(t){Ti(e,t)}),e}function Tc(e,t,i,n,r,s,a){return Tl(Tn(e)||{},y6[yK](arguments))}var Td=C$(yz);function Tu(){return _||bv(),(!x||_.lzy)&&(x=bR(y7(bO,["performance"]).v)),x.v}function Th(){var e=Tu();return e&&e.now?e.now():bp()}var Tg=yx(yL(yX,yY),Cb),Tp=CU("endsWith",y2,Tf);function Tf(e,t,i){CM(e);var n=Cu(t)?t:C_(t),r=!Cr(i)&&i<e[yz]?i:e[yz];return bo(e,r-n[yz],r)===n}var Tm=CF("indexOf",y2),Tv=CU("startsWith",y2,TS);function TS(e,t,i){CM(e);var n=Cu(t)?t:C_(t),r=i>0?i:0;return bo(e,r,r+n[yz])===n}var Ty="ref",TC="unref",Tb="hasRef",TT="enabled";function TE(e,t,i){var n,r=!0,s=e?t(yU):yU;function a(){return r=!1,s&&s[TC]&&s[TC](),n}function o(){s&&i(s),s=yU}function l(){return s=t(s),r||a(),n}function c(e){!e&&s&&o(),e&&!s&&l()}return(n={cancel:o,refresh:l})[Tb]=function(){return s&&s[Tb]?s[Tb]():r},n[Ty]=function(){return r=!0,s&&s[Ty]&&s[Ty](),n},n[TC]=a,{h:n=CG(n,TT,{get:function(){return!!s},set:c}),dn:function(){s=yU}}}function T_(e){var t=Ch(e)?e:L;if(!t){var i=br().tmOut||[];Cp(i)&&i.length>0&&Ch(i[0])&&(t=i[0])}return t||setTimeout}function TI(e){var t=Ch(e)?e:F;if(!t){var i=br().tmOut||[];Cp(i)&&i.length>1&&Ch(i[1])&&(t=i[1])}return t||clearTimeout}function Tw(e,t,i){var n=Cp(t),r=n?t.length:0,s=T_(r>0?t[0]:n?yF:t),a=TI(r>1?t[1]:yF),o=i[0];i[0]=function(){l.dn(),bm(o,yF,y6[yK](arguments))};var l=TE(e,function(e){if(e){if(e.refresh)return e.refresh(),e;bm(a,yF,[e])}return bm(s,yF,i)},function(e){bm(a,yF,[e])});return l.h}function TP(e,t){return Tw(!0,yF,y6[yK](arguments))}function TR(e,t,i){return Tw(!0,e,y6[yK](arguments,1))}function TA(e,t){return Tw(!1,yF,y6[yK](arguments))}(bD()||{}).Symbol,(bD()||{}).Reflect;var TM="hasOwnProperty",TD=function(e,t){return(TD=yk.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t[TM](i)&&(e[i]=t[i])})(e,t)};function TO(e,t){function i(){this.constructor=e}typeof t!==yA&&null!==t&&CR("Class extends value "+String(t)+" is not a constructor or null"),TD(e,t),e[yO]=null===t?bh(t):(i[yO]=t[yO],new i)}function Tk(e,t){for(var i=0,n=t.length,r=e.length;i<n;i++,r++)e[r]=t[i];return e}var TN="constructor",Tx="prototype",TL="function",TF="_dynInstFuncs",TU="_isDynProxy",T$="_dynClass",TV="_dynCls$",TB="_dynInstChk",TH=TB,Tj="_dfOpts",Tq="_unknown_",TW="__proto__",TG="_dyn"+TW,Tz="__dynProto$Gbl",TJ="_dynInstProto",TK="useBaseInst",TQ="setInstFuncs",TY=Object,TZ=TY.getPrototypeOf,TX=TY.getOwnPropertyNames,T0=bD(),T1=T0[Tz]||(T0[Tz]={o:((U={})[TQ]=!0,U[TK]=!0,U),n:1e3});function T2(e){return e&&(e===TY[Tx]||e===Array[Tx])}function T3(e){return T2(e)||e===Function[Tx]}function T4(e){var t;if(e){if(TZ)return TZ(e);var i=e[TW]||e[Tx]||(e[TN]?e[TN][Tx]:null);t=e[TG]||i,CD(e,TG)||(delete e[TJ],t=e[TG]=e[TJ]||e[TG],e[TJ]=i)}return t}function T5(e,t){var i=[];if(TX)i=TX(e);else for(var n in e)"string"==typeof n&&CD(e,n)&&i.push(n);if(i&&i.length>0)for(var r=0;r<i.length;r++)t(i[r])}function T6(e,t,i){return t!==TN&&typeof e[t]===TL&&(i||CD(e,t))&&t!==TW&&t!==Tx}function T8(e){CR("DynamicProto: "+e)}function T9(e){var t=bh(null);return T5(e,function(i){!t[i]&&T6(e,i,!1)&&(t[i]=e[i])}),t}function T7(e,t){for(var i=e.length-1;i>=0;i--)if(e[i]===t)return!0;return!1}function Ee(e,t,i,n){function r(e,t,i){var r=t[i];if(r[TU]&&n){var s=e[TF]||{};!1!==s[TH]&&(r=(s[t[T$]]||{})[i]||r)}return function(){return r.apply(e,arguments)}}var s=bh(null);T5(i,function(e){s[e]=r(t,i,e)});for(var a=T4(e),o=[];a&&!T3(a)&&!T7(o,a);)T5(a,function(e){!s[e]&&T6(a,e,!TZ)&&(s[e]=r(t,a,e))}),o.push(a),a=T4(a);return s}function Et(e,t,i,n){var r=null;if(e&&CD(i,T$)){var s=e[TF]||bh(null);if((r=(s[i[T$]]||bh(null))[t])||T8("Missing ["+t+"] "+TL),!r[TB]&&!1!==s[TH]){for(var a=!CD(e,t),o=T4(e),l=[];a&&o&&!T3(o)&&!T7(l,o);){var c=o[t];if(c){a=c===n;break}l.push(o),o=T4(o)}try{a&&(e[t]=r),r[TB]=1}catch(e){s[TH]=!1}}}return r}function Ei(e,t,i){var n=t[e];return n===i&&(n=T4(t)[e]),typeof n!==TL&&T8("["+e+"] is not a "+TL),n}function En(e,t,i,n,r){function s(e,t){var i=function(){return(Et(this,t,e,i)||Ei(t,e,i)).apply(this,arguments)};return i[TU]=1,i}if(!T2(e)){var a=i[TF]=i[TF]||bh(null);if(!T2(a)){var o=a[t]=a[t]||bh(null);!1!==a[TH]&&(a[TH]=!!r),T2(o)||T5(i,function(t){T6(i,t,!1)&&i[t]!==n[t]&&(o[t]=i[t],delete i[t],CD(e,t)&&(!e[t]||e[t][TU])||(e[t]=s(e,t)))})}}}function Er(e,t){if(TZ){for(var i=[],n=T4(t);n&&!T3(n)&&!T7(i,n);){if(n===e)return!0;i.push(n),n=T4(n)}return!1}return!0}function Es(e,t){return CD(e,Tx)?e.name||t||Tq:((e||{})[TN]||{}).name||t||Tq}function Ea(e,t,i,n){CD(e,Tx)||T8("theClass is an invalid class definition.");var r=e[Tx];Er(r,t)||T8("["+Es(e)+"] not in hierarchy of ["+Es(t)+"]");var s=null;CD(r,T$)?s=r[T$]:(s=TV+Es(e,"_")+"$"+T1.n,T1.n++,r[T$]=s);var a=Ea[Tj],o=!!a[TK];o&&n&&void 0!==n[TK]&&(o=!!n[TK]);var l=T9(t),c=Ee(r,t,l,o);i(t,c);var d=!!TZ&&!!a[TQ];d&&n&&(d=!!n[TQ]),En(r,s,t,l,!1!==d)}Ea[Tj]=T1.o;var Eo=C9,El=be,Ec=Eo({Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5});Eo({Unknown:0,NonRetryableStatus:1,CleanStorage:2,MaxInStorageTimeExceeded:3});var Ed="toLowerCase",Eu="blkVal",Eh="length",Eg="rdOnly",Ep="notify",Ef="warnToConsole",Em="throwInternal",Ev="setDf",ES="watch",Ey="logger",EC="apply",Eb="push",ET="splice",EE="hdlr",E_="cancel",EI="initialize",Ew="identifier",EP="removeNotificationListener",ER="addNotificationListener",EA="isInitialized",EM="getNotifyMgr",ED="getPlugin",EO="pollInternalLogs",Ek="name",EN="time",Ex="processNext",EL="getProcessTelContext",EF="enabled",EU="stopPollingInternalLogs",E$="unload",EV="onComplete",EB="version",EH="loggingLevelConsole",Ej="createNew",Eq="teardown",EW="messageId",EG="message",Ez="isAsync",EJ="diagLog",EK="_doTeardown",EQ="update",EY="getNext",EZ="setNextPlugin",EX="protocol",E0="userAgent",E1="split",E2="nodeType",E3="replace",E4="logInternalMessage",E5="type",E6="handler",E8="status",E9="getResponseHeader",E7="getAllResponseHeaders",_e="isChildEvt",_t="data",_i="getCtx",_n="setCtx",_r="complete",_s="urlString",_a="sendPOST",_o="headers",_l="timeout",_c="setRequestHeader",_d="traceId",_u="spanId",_h="traceFlags";function _g(e,t){$||($=b4("AggregationError",function(e,t){t[Eh]>1&&(e.errors=t[1])}));var i=e||"One or more errors occurred.";throw CL(t,function(e,t){i+="\n".concat(t," > ").concat(Cw(e))}),new $(i,t||[])}var _p="Promise",_f="rejected";function _m(e,t){return _v(e,function(e){return t?t({status:"fulfilled",rejected:!1,value:e}):e},function(e){return t?t({status:_f,rejected:!0,reason:e}):e})}function _v(e,t,i,n){var r=e;try{if(Cy(e))(t||i)&&(r=e.then(t,i));else try{t&&(r=t(e))}catch(e){if(i)r=i(e);else throw e}}finally{n&&_S(r,n)}return r}function _S(e,t){var i=e;return t&&(Cy(e)?i=e.finally?e.finally(t):e.then(function(e){return t(),e},function(e){throw t(),e}):t()),i}var _y=!1;function _C(e,t,i,n){B=B||{toString:function(){return"[[PromiseResult]]"}},H=H||{toString:function(){return"[[PromiseIsHandled]]"}};var r={};r[V=V||{toString:function(){return"[[PromiseState]]"}}]={get:t},r[B]={get:i},r[H]={get:n},Cz(e,r)}var _b=["pending","resolving","resolved",_f],_T="dispatchEvent";function _E(e){var t;return e&&e.createEvent&&(t=e.createEvent("Event")),!!t&&t.initEvent}function __(e,t,i,n){var r=bN();j||(j=bR(!!y7(_E,[r]).v));var s=j.v?r.createEvent("Event"):n?new Event(t):{};if(i&&i(s),j.v&&s.initEvent(t,!1,!0),s&&e[_T])e[_T](s);else{var a=e["on"+t];if(a)a(s);else{var o=bO("console");o&&(o.error||o.log)(t,Cw(s))}}}var _I="unhandledRejection",_w=_I.toLowerCase(),_P=[],_R=0,_A=10;function _M(e){return Ch(e)?e.toString():Cw(e)}function _D(e,t,i){var n,r,s=bZ(arguments,3),a=0,o=!1,l=[],c=_R++,d=_P.length>0?_P[_P.length-1]:void 0,u=!1,h=null;function g(t,i){try{return _P.push(c),u=!0,h&&h.cancel(),h=null,e(function(e,r){l.push(function(){try{var s=2===a?t:i,o=Cr(s)?n:Ch(s)?s(n):s;Cy(o)?o.then(e,r):s?e(o):3===a?r(o):e(o)}catch(e){r(e)}}),o&&v()},s)}finally{_P.pop()}}function p(e){return g(void 0,e)}function f(e){var t=e,i=e;return Ch(e)&&(t=function(t){return e&&e(),t},i=function(t){throw e&&e(),t}),g(t,i)}function m(){return _b[a]}function v(){if(l.length>0){var e=l.slice();l=[],u=!0,h&&h.cancel(),h=null,t(e)}}function S(e,t){return function(i){if(a===t){if(2===e&&Cy(i)){a=1,i.then(S(2,1),S(3,1));return}a=e,o=!0,n=i,v(),u||3!==e||h||(h=TP(y,_A))}}}function y(){if(!u)if(u=!0,b$())({env:{__DISABLE_FLUENT_V0_PROVIDERS__:void 0,__ENABLE_GRAPHQL_SUPERMASSIVE__:void 0}}).emit(_I,n,r);else{var e=bL()||bD();q||(q=bR(y7(bO,[_p+"RejectionEvent"]).v)),__(e,_w,function(e){return CJ(e,"promise",{g:function(){return r}}),e.reason=n,e},!!q.v)}}function C(){return"IPromise"+(_y?"["+c+(Cr(d)?"":":"+d)+"]":"")+" "+m()+(o?" - "+_M(n):"")}return CG(r={then:g,catch:p,finally:f},"state",{get:m}),_y&&_C(r,m,function(){return Cn(n)},function(){return u}),bH()&&(r[bq(11)]="IPromise"),r.toString=C,!function(){Ch(i)||CR(_p+": executor is not a function - "+_M(i));var e=S(3,0);try{i.call(r,S(2,0),e)}catch(t){e(t)}}(),r}function _O(e){return function(t){var i=bZ(arguments,1);return e(function(e,i){try{var n=[],r=1;bK(t,function(t,s){t&&(r++,_v(t,function(t){n[s]=t,0==--r&&e(n)},i))}),r--,0===r&&e(n)}catch(e){i(e)}},i)}}function _k(e){return function(t){var i=bZ(arguments,1);return Cy(t)?t:e(function(e){e(t)},i)}}function _N(e){return function(t){var i=bZ(arguments,1);return e(function(e,i){i(t)},i)}}function _x(e){CL(e,function(e){try{e()}catch(e){}})}function _L(e){var t=Cm(e)?e:0;return function(e){TP(function(){_x(e)},t)}}function _F(e,t){return _D(_F,_L(t),e,t)}var _U=_O(_F),_$=_k(_F),_V=_N(_F);function _B(e,t){W||(W=bR(y7(bO,[_p]).v||null));var i=W.v;if(!i)return _F(e);Ch(e)||CR(_p+": executor is not a function - "+Cw(e));var n=0;function r(){return _b[n]}var s=new i(function(t,i){e(function(e){n=2,t(e)},function(e){n=3,i(e)})});return CG(s,"state",{get:r}),s}function _H(e,t){return G||(G=bR(_B)),G.v.call(this,e,t)}var _j=_O(_H),_q="reject",_W="Rejected",_G=0,_z={};function _J(){}function _K(e,t,i){_z[e]||(_z[e]=b4(e));var n=bp();return new _z[e]("Task [".concat(t.id,"] ").concat(i||"","- ").concat(t.st?"Running":"Waiting",": ").concat(_Q(n,t.st||t.cr)))}function _Q(e,t){return(e-t||"0")+" ms"}function _Y(e,t){var i=bp()-t;CL(e,function(e){(e&&!e.rj&&e.st&&e.st<i||!e.st&&e.cr&&e.cr<i)&&e&&e[_q](e.rj||_K("Aborted",e,"Stale "))})}function _Z(e,t){var i=bY(e,t);-1!==i&&e.splice(i,1)}function _X(e,t,i){J=J||{toString:function(){return"[[SchedulerState]]"}},CG(e,z=z||{toString:function(){return"[[SchedulerName]]"}},{get:t}),CG(e,J,{get:i})}function _0(e,t){var i,n,r=[],s=[],a=6e5,o=6e4,l=0,c=(t?t+".":"")+_G++;e=e||_H;var d=function(){var e=Td(r)+Td(s)>0;a>0&&(n||(n=TP(function(){_Y(r,a),_Y(s,a),n&&(n.enabled=Td(r)+Td(s)>0)},o)).unref(),n&&(n.enabled=e))},u=function(e,t){return e.st=bp(),r.push(e),d(),function(i,n){var r=function(t){e.rj=e.rj||t||_K(_W,e),e[_q]=_J,g(e),i=null,n&&n(t),n=null},s=e.id;if(e.rj)r(e.rj);else{e[_q]=r;try{var a=t(s);e.to&&Cy(a)&&(e.t=TP(function(){r(_K("Timeout",e))},e.to)),_v(a,function(t){g(e);try{i&&i(t)}catch(e){n&&n(e)}n=null,i=null},r)}catch(e){r(e)}}}},h=function(t,i,n){return s.push(t),d(),e(function(e,r){_m(i.p,function(){_Z(s,t),u(t,n)(e,r)})})},g=function(e){_Z(r,e),e.t&&e.t.cancel(),e.t=null,i&&i===e&&(i=null,Td(r)+Td(s)===0&&(n&&n.cancel(),n=null))},p={idle:!0,queue:function(t,n,r){var s,a=c+"."+l++;n&&(a+="-("+n+")");var o=((s={id:a,cr:bp(),to:r})[_q]=function(e){o.rj=e||_K(_W,o),o[_q]=_J},s);return i?o.p=h(o,i,t):o.p=e(u(o,t)),i=o,o.p},setStaleTimeout:function(e,t){n&&n.cancel(),n=null,a=e,o=t||e/10,d()}};return CJ(p,"idle",{g:function(){return Td(r)+Td(s)===0}}),_X(p,function(){return c},function(){return{l:i,r:r,w:s}}),p}bq(11);var _1=void 0,_2="",_3="channels",_4="core",_5="createPerfMgr",_6="disabled",_8="extensionConfig",_9="extensions",_7="processTelemetry",Ie="priority",It="eventsSent",Ii="eventsDiscarded",In="eventsSendRequest",Ir="perfEvent",Is="offlineEventsStored",Ia="offlineBatchSent",Io="offlineBatchDrop",Il="getPerfMgr",Ic="domain",Id="path",Iu="Not dynamic - ",Ih=/-([a-z])/g,Ig=/([^\w\d_$])/g,Ip=/^(\d+[\w\d_$])/;function If(e){return!Ca(e)}function Im(e){var t=e;return t&&Cu(t)&&(t=(t=(t=t[E3](Ih,function(e,t){return t.toUpperCase()}))[E3](Ig,"_"))[E3](Ip,function(e,t){return"_"+t})),t}function Iv(e,t){return!!e&&!!t&&-1!==Tm(e,t)}function IS(e){return e&&e.toISOString()||""}function Iy(e){return CS(e)?e[Ek]:_2}function IC(e,t,i,n,r){var s=i;return e&&(s=e[t])!==i&&(!r||r(s))&&(!n||n(i))&&(s=i,e[t]=s),s}function Ib(e,t,i){var n;return e?!(n=e[t])&&Ca(n)&&(n=Cr(i)?{}:i,e[t]=n):n=Cr(i)?{}:i,n}function IT(e,t){var i=null,n=null;return Ch(e)?i=e:n=e,function(){var e=arguments;if(i&&(n=i()),n)return n[t][EC](n,e)}}function IE(e,t,i,n,r){e&&t&&i&&(!1!==r||Cr(e[t]))&&(e[t]=IT(i,n))}function I_(e,t,i,n){return e&&t&&Cg(e)&&Cp(i)&&CL(i,function(i){Cu(i)&&IE(e,i,t,i,n)}),e}function II(e){return e&&C2&&(e=yk(C2({},e))),e}function Iw(e,t,i,n,r,s){var a=arguments,o=a[0]||{},l=a[Eh],c=!1,d=1;for(l>0&&Cv(o)&&(c=o,o=a[d]||{},d++),Cg(o)||(o={});d<l;d++){var u=a[d],h=Cp(u),g=Cg(u);for(var p in u)if(h&&p in u||g&&Ck(u,p)){var f=u[p],m=void 0;if(c&&f&&((m=Cp(f))||b6(f))){var v=o[p];m?Cp(v)||(v=[]):b6(v)||(v={}),f=Iw(c,v,f)}void 0!==f&&(o[p]=f)}}return o}function IP(e){try{return e.responseText}catch(e){}return null}function IR(e,t){return e?"XDomainRequest,Response:"+IP(e):t}function IA(e,t){return e?"XMLHttpRequest,Status:"+e[E8]+",Response:"+IP(e)||e.response||"":t}function IM(e,t){return t&&(Cm(t)?e=[t].concat(e):Cp(t)&&(e=t.concat(e))),e}var ID="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",IO="withCredentials",Ik="timeout";function IN(e,t,i,n,r,s){function a(e,t,i){try{e[t]=i}catch(e){}}void 0===n&&(n=!1),void 0===r&&(r=!1);var o=new XMLHttpRequest;return n&&a(o,ID,n),i&&a(o,IO,i),o.open(e,t,!r),i&&a(o,IO,i),!r&&s&&a(o,Ik,s),o}function Ix(e){var t={};return Cu(e)&&CL(b5(e)[E1](/[\r\n]+/),function(e){if(e){var i=e.indexOf(": ");if(-1!==i){var n=b5(e.substring(0,i))[Ed](),r=b5(e.substring(i+1));t[n]=r}else t[b5(e)]=1}}),t}function IL(e,t,i){if(!e[i]&&t&&t[E9]){var n=t[E9](i);n&&(e[i]=b5(n))}return e}var IF="kill-duration",IU="kill-duration-seconds",I$="time-delta-millis";function IV(e,t){var i={};return e[E7]?i=Ix(e[E7]()):t&&(i=IL(i,e,I$),i=IL(i,e,IF),i=IL(i,e,IU)),i}var IB="location",IH="console",Ij="JSON",Iq="crypto",IW="msCrypto",IG="ReactNative",Iz="msie",IJ="trident/",IK="XMLHttpRequest",IQ=null,IY=null,IZ=!1,IX=null,I0=null;function I1(e,t){var i=!1;if(e){try{if(!(i=t in e)){var n=e[yO];n&&(i=t in n)}}catch(e){}if(!i)try{var r=new e;i=!Cr(r[t])}catch(e){}}return i}function I2(e){if(e&&IZ){var t=bO("__mockLocation");if(t)return t}return typeof location===yM&&location?location:bO(IB)}function I3(){return typeof console!==yD?console:bO(IH)}function I4(){return!!(typeof JSON===yM&&JSON||null!==bO(Ij))}function I5(){return I4()?JSON||bO(Ij):null}function I6(){return bO(Iq)}function I8(){return bO(IW)}function I9(){var e=bU();return!!e&&!!e.product&&e.product===IG}function I7(){var e=bU();if(e&&(e[E0]!==IY||null===IQ)){var t=((IY=e[E0])||_2)[Ed]();IQ=Iv(t,Iz)||Iv(t,IJ)}return IQ}function we(e){return(null===I0||!1===e)&&(I0=bF()&&!!bU().sendBeacon),I0}function wt(e){var t=!1;try{t=!!bO("fetch");var i=bO("Request");t&&e&&i&&(t=I1(i,"keepalive"))}catch(e){}return t}function wi(){return null===IX&&(IX=typeof XDomainRequest!==yD)&&wn()&&(IX=IX&&!I1(bO(IK),"withCredentials")),IX}function wn(){var e=!1;try{e=!!bO(IK)}catch(e){}return e}var wr=0x100000000,ws=0xffffffff,wa=0x75bcd15,wo=0x3ade68b1,wl=!1,wc=0x75bcd15,wd=0x3ade68b1;function wu(e){e<0&&(e>>>=0),wc=wa+e&ws,wd=wo-e&ws,wl=!0}function wh(){try{var e=0x7fffffff&bp();wu((Math.random()*wr^e)+e)}catch(e){}}function wg(e){var t=0,i=I6()||I8();return i&&i.getRandomValues&&(t=i.getRandomValues(new Uint32Array(1))[0]&ws),0===t&&I7()&&(wl||wh(),t=wp()&ws),0===t&&(t=Math.floor(wr*Math.random()|0)),e||(t>>>=0),t}function wp(e){var t=((wd=36969*(65535&wd)+(wd>>16)&ws)<<16)+(65535&(wc=18e3*(65535&wc)+(wc>>16)&ws))>>>0&ws;return e||(t>>>=0),t}function wf(e){void 0===e&&(e=22);for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=wg()>>>0,n=0,r=_2;r[Eh]<e;)n++,r+=t.charAt(63&i),i>>>=6,5===n&&(i=(wg()<<2|3&i)>>>0,n=0);return r}var wm="3.2.1",wv="."+wf(6),wS=0;function wy(e){return 1===e[E2]||9===e[E2]||!+e[E2]}function wC(e,t){var i=t[e.id];if(!i){i={};try{wy(t)&&CJ(t,e.id,{e:!1,v:i})}catch(e){}}return i}function wb(e,t){return void 0===t&&(t=!1),Im(e+wS+++(t?"."+wm:_2)+wv)}function wT(e){var t={id:wb("_aiData-"+(e||_2)+"."+wm),accept:function(e){return wy(e)},get:function(e,i,n,r){var s=e[t.id];return s?s[Im(i)]:(r&&((s=wC(t,e))[Im(i)]=n),n)},kill:function(e,t){if(e&&e[t])try{delete e[t]}catch(e){}}};return t}function wE(e){return e&&Cg(e)&&(e.isVal||e.fb||Ck(e,"v")||Ck(e,"mrg")||Ck(e,"ref")||e.set)}function w_(e,t,i){var n,r=i.dfVal||Cl;if(t&&i.fb){var s=i.fb;Cp(s)||(s=[s]);for(var a=0;a<s[Eh];a++){var o=s[a],l=t[o];if(r(l)?n=l:e&&(r(l=e.cfg[o])&&(n=l),e.set(e.cfg,C_(o),l)),r(n))break}}return!r(n)&&r(i.v)&&(n=i.v),n}function wI(e,t,i){var n,r=i;return i&&wE(i)&&(r=w_(e,t,i)),r&&(wE(r)&&(r=wI(e,t,r)),Cp(r)?(n=[])[Eh]=r[Eh]:b6(r)&&(n={}),n&&(Cx(r,function(i,r){r&&wE(r)&&(r=wI(e,t,r)),n[i]=r}),r=n)),r}function ww(e,t,i,n){var r,s,a,o,l,c,d,u,h=n;wE(h)?(r=h.isVal,s=h.set,c=h[Eg],d=h[Eu],o=h.mrg,!(l=h.ref)&&Cr(l)&&(l=!!o),a=w_(e,t,h)):a=n,d&&e[Eu](t,i);var g=!0,p=t[i];(p||!Ca(p))&&(u=p,g=!1,r&&u!==a&&!r(u)&&(u=a,g=!0),s&&(g=(u=s(u,a,t))===a)),g?u=a?wI(e,t,a):a:(b6(u)||Cp(a))&&o&&a&&(b6(a)||Cp(a))&&Cx(a,function(t,i){ww(e,u,t,i)}),e.set(t,i,u),l&&e.ref(t,i),c&&e[Eg](t,i)}var wP=bG("[[ai_dynCfg_1]]"),wR=bG("[[ai_blkDynCfg_1]]"),wA=bG("[[ai_frcDynCfg_1]]");function wM(e){if(e){var t;if(Cp(e)?(t=[])[Eh]=e[Eh]:b6(e)&&(t={}),t)return Cx(e,function(e,i){t[e]=wM(i)}),t}return e}function wD(e){if(e){var t=e[wP]||e;if(t.cfg&&(t.cfg===e||t.cfg[wP]===t))return t}return null}function wO(e){if(e&&(b6(e)||Cp(e)))try{e[wR]=!0}catch(e){}return e}function wk(e,t,i){var n=!1;return i&&!e[t.blkVal]&&((n=i[wA])||i[wR]||(n=b6(i)||Cp(i))),n}function wN(e){CR("InvalidAccess:"+e)}var wx=["push","pop","shift","unshift","splice"],wL=function(e,t,i,n){e&&e[Em](3,108,"".concat(i," [").concat(t,"] failed - ")+Cw(n))};function wF(e,t,i){Cp(t)&&CL(wx,function(n){var r=t[n];t[n]=function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var a=r[EC](this,n);return wH(e,t,i,"Patching"),a}})}function wU(e,t){var i=Tg(e,t);return i&&i.get}function w$(e,t,i,n){var r={n:i,h:[],trk:function(t){t&&t.fn&&(-1===bY(r.h,t)&&r.h[Eb](t),e.trk(t,r))},clr:function(e){var t=bY(r.h,e);-1!==t&&r.h[ET](t,1)}},s=!0,a=!1;function o(){s&&(a=a||wk(o,e,n),n&&!n[wP]&&a&&(n=wH(e,n,i,"Converting")),s=!1);var t=e.act;return t&&r.trk(t),n}function l(l){if(n!==l){o[e.ro]&&!e.upd&&wN("["+i+"] is read-only:"+Cw(t)),s&&(a=a||wk(o,e,n),s=!1);var c=a&&o[e.rf];if(a)if(c){Cx(n,function(e){n[e]=l?l[e]:_1});try{Cx(l,function(t,i){wV(e,n,t,i)}),l=n}catch(t){wL((e.hdlr||{})[Ey],i,"Assigning",t),a=!1}}else n&&n[wP]&&Cx(n,function(t){var i=wU(n,t);if(i){var r=i[e.prop];r&&r.chng()}});if(l!==n){var d=l&&wk(o,e,l);!c&&d&&(l=wH(e,l,i,"Converting")),n=l,a=d}e.add(r)}}o[e.prop]={chng:function(){e.add(r)}},CJ(t,r.n,{g:o,s:l})}function wV(e,t,i,n){if(t){var r=wU(t,i);r&&r[e.prop]?t[i]=n:w$(e,t,i,n)}return t}function wB(e,t,i,n){if(t){var r=wU(t,i),s=r&&!!r[e.prop],a=n&&n[0],o=n&&n[1],l=n&&n[2];if(!s){if(l)try{wO(t)}catch(t){wL((e.hdlr||{})[Ey],i,"Blocking",t)}try{wV(e,t,i,t[i]),r=wU(t,i)}catch(t){wL((e.hdlr||{})[Ey],i,"State",t)}}a&&(r[e.rf]=a),o&&(r[e.ro]=o),l&&(r[e.blkVal]=!0)}return t}function wH(e,t,i,n){try{Cx(t,function(i,n){wV(e,t,i,n)}),t[wP]||(CG(t,wP,{get:function(){return e[EE]}}),wF(e,t,i))}catch(t){wL((e.hdlr||{})[Ey],i,n,t)}return t}var wj="[[ai_",wq="]]";function wW(e){var t,i,n=bW(wj+"get"+e.uid+wq),r=bW(wj+"ro"+e.uid+wq),s=bW(wj+"rf"+e.uid+wq),a=bW(wj+"blkVal"+e.uid+wq),o=bW(wj+"dtl"+e.uid+wq),l=null,c=null;function d(t,n){var r=i.act;try{i.act=t,t&&t[o]&&(CL(t[o],function(e){e.clr(t)}),t[o]=[]),n({cfg:e.cfg,set:e.set.bind(e),setDf:e[Ev].bind(e),ref:e.ref.bind(e),rdOnly:e[Eg].bind(e)})}catch(t){var s=e[Ey];throw s&&s[Em](1,107,Cw(t)),t}finally{i.act=r||null}}function u(){if(l){var e=l;l=null,c&&c[E_](),c=null;var t=[];if(CL(e,function(e){if(e&&(e[o]&&(CL(e[o],function(t){t.clr(e)}),e[o]=null),e.fn))try{d(e,e.fn)}catch(e){t[Eb](e)}}),l)try{u()}catch(e){t[Eb](e)}t[Eh]>0&&_g("Watcher error(s): ",t)}}function h(e){if(e&&e.h[Eh]>0){l||(l=[]),c||(c=TP(function(){c=null,u()},0));for(var t=0;t<e.h[Eh];t++){var i=e.h[t];i&&-1===bY(l,i)&&l[Eb](i)}}}function g(e,t){if(e){var i=e[o]=e[o]||[];-1===bY(i,t)&&i[Eb](t)}}return(t={prop:n,ro:r,rf:s})[Eu]=a,t[EE]=e,t.add=h,t[Ep]=u,t.use=d,t.trk=g,i=t}function wG(e,t){var i={fn:t,rm:function(){i.fn=null,e=null,t=null}};return CJ(i,"toJSON",{v:function(){return"WatcherHandler"+(i.fn?"":"[X]")}}),e.use(i,t),i}function wz(e,t,i){var n,r,s=wD(t);if(s)return s;var a=wb("dyncfg",!0),o=t&&!1!==i?t:wM(t);function l(){r[Ep]()}function c(t,i,n){try{t=wV(r,t,i,n)}catch(t){wL(e,i,"Setting value",t)}return t[i]}function d(e){return wG(r,e)}function u(e,t){r.use(null,function(i){var n=r.upd;try{Cr(t)||(r.upd=t),e(i)}finally{r.upd=n}})}function h(e,t){var i;return wB(r,e,t,((i={})[0]=!0,i))[t]}function g(e,t){var i;return wB(r,e,t,((i={})[1]=!0,i))[t]}function p(e,t){var i;return wB(r,e,t,((i={})[2]=!0,i))[t]}function f(e,t){return t&&Cx(t,function(t,i){ww(m,e,t,i)}),e}var m=((n={uid:null,cfg:o})[Ey]=e,n[Ep]=l,n.set=c,n[Ev]=f,n[ES]=d,n.ref=h,n[Eg]=g,n[Eu]=p,n._block=u,n);return CJ(m,"uid",{c:!1,e:!1,w:!1,v:a}),wH(r=wW(m),o,"config","Creating"),m}function wJ(e,t){e?(e[Ef](t),e[Em](2,108,t)):wN(t)}function wK(e,t,i,n){var r=wz(i,e||{},n);return t&&r[Ev](r.cfg,t),r}function wQ(e,t,i){var n=e[wP]||e;return n.cfg&&(n.cfg===e||n.cfg[wP]===n)?n[ES](t):(wJ(i,Iu+Cw(e)),wK(e,null,i)[ES](t))}function wY(e,t){if(e&&e[E$])return e[E$](t)}function wZ(e,t,i){var n;return i||(n=_H(function(e){i=e})),e&&Td(e)>0?_m(wY(e[0],t),function(){wZ(bZ(e,1),t,i)}):i(),n}var wX=500,w0="Microsoft_ApplicationInsights_BypassAjaxInstrumentation";function w1(e){return{mrg:!0,v:e}}function w2(e){return{isVal:Cu,v:C_(e||_2)}}var w3=[It,Ii,In,Ir],w4=null;function w5(e,t){return function(){var i=arguments,n=w8(t);if(n){var r=n.listener;r&&r[e]&&r[e][EC](r,i)}}}function w6(){var e=bO("Microsoft");return e&&(w4=e.ApplicationInsights),w4}function w8(e){var t=w4;return t||!0===e.disableDbgExt||(t=w4||w6()),t?t.ChromeDbgExt:null}function w9(e){if(!K){K={};for(var t=0;t<w3[Eh];t++)K[w3[t]]=w5(w3[t],e)}return K}var w7="warnToConsole",Pe="AI (Internal): ",Pt="AI: ",Pi="AITR_",Pn={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},Pr=((Q={})[0]=null,Q[1]="errorToConsole",Q[2]=w7,Q[3]="debugToConsole",Q);function Ps(e){return e?'"'+e[E3](/\"/g,_2)+'"':_2}function Pa(e,t){var i=I3();if(i){var n="log";i[e]&&(n=e),Ch(i[n])&&i[n](t)}}var Po=function(){function e(e,t,i,n){void 0===i&&(i=!1);var r=this;r[EW]=e,r[EG]=(i?Pt:Pe)+e;var s=_2;I4()&&(s=I5().stringify(n));var a=(t?" message:"+Ps(t):_2)+(n?" props:"+Ps(s):_2);r[EG]+=a}return e.dataType="MessageData",e}();function Pl(e,t){return(e||{})[Ey]||new Pc(t)}var Pc=function(){function e(t){this.identifier="DiagnosticLogger",this.queue=[];var i,n,r,s,a,o=0,l={};Ea(e,this,function(e){function c(t,i){if(!d()){var s=!0,a=Pi+i[EW];if(l[a]?s=!1:l[a]=!0,s&&(t<=n&&(e.queue[Eb](i),o++,u(1===t?"error":"warn",i)),o===r)){var c="Internal events throttle limit per PageView reached for this app.",h=new Po(23,c,!1);e.queue[Eb](h),1===t?e.errorToConsole(c):e[Ef](c)}}}function d(){return o>=r}function u(e,i){var n=w8(t||{});n&&n[EJ]&&n[EJ](e,i)}a=function t(t){return wQ(wK(t,Pn,e).cfg,function(e){var t=e.cfg;i=t[EH],n=t.loggingLevelTelemetry,r=t.maxMessageLimit,s=t.enableDebug})}(t||{}),e.consoleLoggingLevel=function(){return i},e[Em]=function(t,n,r,a,o){void 0===o&&(o=!1);var d=new Po(n,r,o,a);if(s)throw Cw(d);var h=Pr[t]||w7;if(Cr(d[EG]))u("throw"+(1===t?"Critical":"Warning"),d);else{if(o){var g=+d[EW];!l[g]&&i>=t&&(e[h](d[EG]),l[g]=!0)}else i>=t&&e[h](d[EG]);c(t,d)}},e.debugToConsole=function(e){Pa("debug",e),u("warning",e)},e[Ef]=function(e){Pa("warn",e),u("warning",e)},e.errorToConsole=function(e){Pa("error",e),u("error",e)},e.resetInternalMessageCount=function(){o=0,l={}},e[E4]=c,e[E$]=function(e){a&&a.rm(),a=null}})}return e.__ieDyn=1,e}();function Pd(e){return e||new Pc}function Pu(e,t,i,n,r,s){void 0===s&&(s=!1),Pd(e)[Em](t,i,n,r,s)}function Ph(e,t){Pd(e)[Ef](t)}var Pg="toGMTString",Pp="toUTCString",Pf="cookie",Pm="expires",Pv="isCookieUseDisabled",PS="disableCookiesUsage",Py="_ckMgr",PC=null,Pb=null,PT=null,PE={},P_={},PI=((Y={cookieCfg:w1(((Z={})[Ic]={fb:"cookieDomain",dfVal:If},Z.path={fb:"cookiePath",dfVal:If},Z.enabled=_1,Z.ignoreCookies=_1,Z.blockedCookies=_1,Z)),cookieDomain:_1,cookiePath:_1})[PS]=_1,Y);function Pw(){X||(X=bS(function(){return bN()}))}function PP(e,t){var i=Pk[Py]||P_[Py];return i||(i=Pk[Py]=Pk(e,t),P_[Py]=i),i}function PR(e){return!e||e.isEnabled()}function PA(e,t){return!!(t&&e&&Cp(e.ignoreCookies))&&-1!==bY(e.ignoreCookies,t)}function PM(e,t){return!!(t&&e&&Cp(e.blockedCookies))&&-1!==bY(e.blockedCookies,t)||PA(e,t)}function PD(e,t){var i=t[EF];if(Ca(i)){var n=void 0;Cr(e[Pv])||(n=!e[Pv]),Cr(e[PS])||(n=!e[PS]),i=n}return i}function PO(e,t){var i;if(e)i=e.getCookieMgr();else if(t){var n=t.cookieCfg;i=n&&n[Py]?n[Py]:Pk(t)}return i||(i=PP(t,(e||{})[Ey])),i}function Pk(e,t){var i,n,r,s,a,o,l,c,d=wQ(e=wK(e||P_,null,t).cfg,function(t){t[Ev](t.cfg,PI),r=(n=t.ref(t.cfg,"cookieCfg"))[Id]||"/",s=n[Ic],a=!1!==PD(e,n),o=n.getCookie||PU,l=n.setCookie||P$,c=n.delCookie||P$},t),u=((i={isEnabled:function(){var i=!1!==PD(e,n)&&a&&PN(t),r=P_[Py];return i&&r&&u!==r&&(i=PR(r)),i},setEnabled:function(e){a=!1!==e,n[EF]=e},set:function(e,t,i,a,o){var c=!1;if(PR(u)&&!PM(n,e)){var d={},h=b5(t||_2),g=Tm(h,";");if(-1!==g&&(h=b5(bd(t,g)),d=Px(bo(t,g+1))),IC(d,Ic,a||s,CC,Cr),!Ca(i)){var p=I7();if(Cr(d[Pm])){var f=bp()+1e3*i;if(f>0){var m=new Date;m.setTime(f),IC(d,Pm,PL(m,p?Pg:Pp)||PL(m,p?Pg:Pp)||_2,CC)}}p||IC(d,"max-age",_2+i,null,Cr)}var v=I2();v&&"https:"===v[EX]&&(IC(d,"secure",null,null,Cr),null===Pb&&(Pb=!PV((bU()||{})[E0])),Pb&&IC(d,"SameSite","None",null,Cr)),IC(d,Id,o||r,null,Cr),l(e,PF(h,d)),c=!0}return c},get:function(e){var t=_2;return PR(u)&&!PA(n,e)&&(t=o(e)),t},del:function(e,t){var i=!1;return PR(u)&&(i=u.purge(e,t)),i},purge:function(e,i){var n,r=!1;if(PN(t)){var s=((n={})[Id]=i||"/",n[Pm]="Thu, 01 Jan 1970 00:00:01 GMT",n);I7()||(s["max-age"]="0"),c(e,PF(_2,s)),r=!0}return r}})[E$]=function(e){d&&d.rm(),d=null},i);return u[Py]=u,u}function PN(e){if(null===PC){PC=!1,X||Pw();try{var t=X.v||{};PC=void 0!==t[Pf]}catch(t){Pu(e,2,68,"Cannot access document.cookie - "+Iy(t),{exception:Cw(t)})}}return PC}function Px(e){var t={};return e&&e[Eh]&&CL(b5(e)[E1](";"),function(e){if(e=b5(e||_2)){var i=Tm(e,"=");-1===i?t[e]=null:t[b5(bd(e,i))]=b5(bo(e,i+1))}}),t}function PL(e,t){return Ch(e[t])?e[t]():null}function PF(e,t){var i=e||_2;return Cx(t,function(e,t){i+="; "+e+(Ca(t)?_2:"="+t)}),i}function PU(e){var t=_2;if(X||Pw(),X.v){var i=X.v[Pf]||_2;PT!==i&&(PE=Px(i),PT=i),t=b5(PE[e]||_2)}return t}function P$(e,t){X||Pw(),X.v&&(X.v[Pf]=e+"="+t)}function PV(e){return!!Cu(e)&&!!(Iv(e,"CPU iPhone OS 12")||Iv(e,"iPad; CPU OS 12")||Iv(e,"Macintosh; Intel Mac OS X 10_14")&&Iv(e,"Version/")&&Iv(e,"Safari")||Iv(e,"Macintosh; Intel Mac OS X 10_14")&&Tp(e,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||Iv(e,"Chrome/5")||Iv(e,"Chrome/6")||Iv(e,"UnrealEngine")&&!Iv(e,"Chrome")||Iv(e,"UCBrowser/12")||Iv(e,"UCBrowser/11"))}var PB={perfEvtsSendAll:!1};function PH(e){e.h=null;var t=e.cb;e.cb=[],CL(t,function(e){y7(e.fn,[e.arg])})}function Pj(e,t,i,n){CL(e,function(e){e&&e[t]&&(i?(i.cb[Eb]({fn:n,arg:e}),i.h=i.h||TP(PH,0,i)):y7(n,[e]))})}var Pq=function(){function e(t){this.listeners=[];var i,n,r=[],s={h:null,cb:[]};n=wK(t,PB)[ES](function(e){i=!!e.cfg.perfEvtsSendAll}),Ea(e,this,function(e){CJ(e,"listeners",{g:function(){return r}}),e[ER]=function(e){r[Eb](e)},e[EP]=function(e){for(var t=bY(r,e);t>-1;)r[ET](t,1),t=bY(r,e)},e[It]=function(e){Pj(r,It,s,function(t){t[It](e)})},e[Ii]=function(e,t){Pj(r,Ii,s,function(i){i[Ii](e,t)})},e[In]=function(e,t){Pj(r,In,t?s:null,function(i){i[In](e,t)})},e[Ir]=function(e){e&&(i||!e[_e]())&&Pj(r,Ir,null,function(t){e[Ez]?TP(function(){return t[Ir](e)},0):t[Ir](e)})},e[Is]=function(e){e&&e[Eh]&&Pj(r,Is,s,function(t){t[Is](e)})},e[Ia]=function(e){e&&e[_t]&&Pj(r,Ia,s,function(t){t[Ia](e)})},e[Io]=function(e,t){if(e>0){var i=t||0;Pj(r,Io,s,function(t){t[Io](e,i)})}},e[E$]=function(e){var t,i=function(){n&&n.rm(),n=null,r=[],s.h&&s.h[E_](),s.h=null,s.cb=[]};if(Pj(r,"unload",null,function(i){var n=i[E$](e);n&&(t||(t=[]),t[Eb](n))}),t)return _H(function(e){return _m(_j(t),function(){i(),e()})});i()}})}return e.__ieDyn=1,e}(),PW="ctx",PG="ParentContextKey",Pz="ChildrenContextKey",PJ=null,PK=function(){function e(t,i,n){var r,s=this;s.start=bp(),s[Ek]=t,s[Ez]=n,s[_e]=function(){return!1},Ch(i)&&CJ(s,"payload",{g:function(){return!r&&Ch(i)&&(r=i(),i=null),r}}),s[_i]=function(t){return t?t===e[PG]||t===e[Pz]?s[t]:(s[PW]||{})[t]:null},s[_n]=function(t,i){t&&(t===e[PG]?(s[t]||(s[_e]=function(){return!0}),s[t]=i):t===e[Pz]?s[t]=i:(s[PW]=s[PW]||{})[t]=i)},s[_r]=function(){var t=0,i=s[_i](e[Pz]);if(Cp(i))for(var n=0;n<i[Eh];n++){var r=i[n];r&&(t+=r[EN])}s[EN]=bp()-s.start,s.exTime=s[EN]-t,s[_r]=function(){}}}return e.ParentContextKey="parent",e.ChildrenContextKey="childEvts",e}(),PQ=function(){function e(t){this.ctx={},Ea(e,this,function(e){e.create=function(e,t,i){return new PK(e,t,i)},e.fire=function(e){e&&(e[_r](),t&&Ch(t[Ir])&&t[Ir](e))},e[_n]=function(t,i){t&&((e[PW]=e[PW]||{})[t]=i)},e[_i]=function(t){return(e[PW]||{})[t]}})}return e.__ieDyn=1,e}(),PY="CoreUtils.doPerf";function PZ(e,t,i,n,r){if(e){var s=e;if(s[Il]&&(s=s[Il]()),s){var a=void 0,o=s[_i](PY);try{if(a=s.create(t(),n,r)){if(o&&a[_n]&&(a[_n](PK[PG],o),o[_i]&&o[_n])){var l=o[_i](PK[Pz]);l||(l=[],o[_n](PK[Pz],l)),l[Eb](a)}return s[_n](PY,a),i(a)}}catch(e){a&&a[_n]&&a[_n]("exception",e)}finally{a&&s.fire(a),s[_n](PY,o)}}}return i()}function PX(){return PJ}function P0(){var e=P1();return bo(e,0,8)+"-"+bo(e,8,12)+"-"+bo(e,12,16)+"-"+bo(e,16,20)+"-"+bo(e,20)}function P1(){for(var e,t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],i=_2,n=0;n<4;n++)i+=t[15&(e=wg())]+t[e>>4&15]+t[e>>8&15]+t[e>>12&15]+t[e>>16&15]+t[e>>20&15]+t[e>>24&15]+t[e>>28&15];var r=t[8+(3&wg())|0];return bl(i,0,8)+bl(i,9,4)+"4"+bl(i,13,3)+r+bl(i,16,3)+bl(i,19,12)}var P2="00000000000000000000000000000000",P3="0000000000000000";function P4(e,t,i){return!!e&&e[Eh]===t&&e!==i&&!!e.match(/^[\da-f]*$/i)}function P5(e){return P4(e,32,P2)}function P6(e){return P4(e,16,P3)}var P8=wT("plugin");function P9(e){return P8.get(e,"state",{},!0)}function P7(e,t){for(var i,n=[],r=null,s=e[EY]();s;){var a=s[ED]();if(a){r&&r[EZ]&&a[_7]&&r[EZ](a);var o=!!(i=P9(a))[EA];a[EA]&&(o=a[EA]()),o||n[Eb](a),r=a,s=s[EY]()}}CL(n,function(n){var r=e[_4]();n[EI](e.getCfg(),r,t,e[EY]()),i=P9(n),n[_4]||i[_4]||(i[_4]=r),i[EA]=!0,delete i[Eq]})}function Re(e){return e.sort(function(e,t){var i=0;if(t){var n=t[_7];e[_7]?i=n?e[Ie]-t[Ie]:1:n&&(i=-1)}else i=e?1:-1;return i})}function Rt(e){var t={};return{getName:function(){return t[Ek]},setName:function(i){e&&e.setName(i),t[Ek]=i},getTraceId:function(){return t[_d]},setTraceId:function(i){e&&e.setTraceId(i),P5(i)&&(t[_d]=i)},getSpanId:function(){return t[_u]},setSpanId:function(i){e&&e.setSpanId(i),P6(i)&&(t[_u]=i)},getTraceFlags:function(){return t[_h]},setTraceFlags:function(i){e&&e.setTraceFlags(i),t[_h]=i}}}var Ri="TelemetryPluginChain",Rn="_hasRun",Rr="_getTelCtx",Rs=0;function Ra(e,t,i){for(;e;){if(e[ED]()===i)return e;e=e[EY]()}return Ru([i],t.config||{},t)}function Ro(e,t,i,n){var r=null,s=[];t||(t=wK({},null,i[Ey])),null!==n&&(r=n?Ra(e,i,n):e);var a={_next:l,ctx:{core:function(){return i},diagLog:function(){return Pl(i,t.cfg)},getCfg:function(){return t.cfg},getExtCfg:d,getConfig:u,hasNext:function(){return!!r},getNext:function(){return r},setNext:function(e){r=e},iterate:h,onComplete:o}};function o(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e&&s[Eb]({func:e,self:Cr(t)?a.ctx:t,args:i})}function l(){var e=r;if(r=e?e[EY]():null,!e){var t=s;t&&t[Eh]>0&&(CL(t,function(e){try{e.func.call(e.self,e.args)}catch(e){Pu(i[Ey],2,73,"Unexpected Exception during onComplete - "+Cw(e))}}),s=[])}return e}function c(e,i){var n=null,r=t.cfg;if(r&&e){var s=r[_8];!s&&i&&(s={}),r[_8]=s,(s=t.ref(r,_8))&&((n=s[e])||!i||(n={}),s[e]=n,n=t.ref(s,e))}return n}function d(e,i){var n=c(e,!0);return i&&Cx(i,function(e,i){if(Ca(n[e])){var r=t.cfg[e];(r||!Ca(r))&&(n[e]=r)}ww(t,n,e,i)}),t[Ev](n,i)}function u(e,i,n){void 0===n&&(n=!1);var r,s=c(e,!1),a=t.cfg;return s&&(s[i]||!Ca(s[i]))?r=s[i]:(a[i]||!Ca(a[i]))&&(r=a[i]),r||!Ca(r)?r:n}function h(e){for(var t;t=a._next();){var i=t[ED]();i&&e(i)}}return a}function Rl(e,t,i,n){var r=wK(t),s=Ro(e,r,i,n),a=s.ctx;function o(e){var t=s._next();return t&&t[_7](e,a),!t}function l(e,t){return void 0===e&&(e=null),Cp(e)&&(e=Ru(e,r.cfg,i,t)),Rl(e||a[EY](),r.cfg,i,t)}return a[Ex]=o,a[Ej]=l,a}function Rc(e,t,i){var n=wK(t.config),r=Ro(e,n,t,i),s=r.ctx;function a(e){var t=r._next();return t&&t[E$](s,e),!t}function o(e,i){return void 0===e&&(e=null),Cp(e)&&(e=Ru(e,n.cfg,t,i)),Rc(e||s[EY](),t,i)}return s[Ex]=a,s[Ej]=o,s}function Rd(e,t,i){var n=wK(t.config),r=Ro(e,n,t,i).ctx;function s(e){return r.iterate(function(t){Ch(t[EQ])&&t[EQ](r,e)})}function a(e,i){return void 0===e&&(e=null),Cp(e)&&(e=Ru(e,n.cfg,t,i)),Rd(e||r[EY](),t,i)}return r[Ex]=s,r[Ej]=a,r}function Ru(e,t,i,n){var r=null,s=!n;if(Cp(e)&&e[Eh]>0){var a=null;CL(e,function(e){if(s||n!==e||(s=!0),s&&e&&Ch(e[_7])){var o=Rh(e,t,i);r||(r=o),a&&a._setNext(o),a=o}})}return n&&!r?Ru([n],t,i):r}function Rh(e,t,i){var n,r=null,s=Ch(e[_7]),a=Ch(e[EZ]),o={getPlugin:function(){return e},getNext:function(){return r},processTelemetry:d,unload:u,update:h,_id:n=e?e[Ew]+"-"+e[Ie]+"-"+Rs++:"Unknown-0-"+Rs++,_setNext:function(e){r=e}};function l(){var n;return e&&Ch(e[Rr])&&(n=e[Rr]()),n||(n=Rl(o,t,i)),n}function c(t,i,s,a,o){var l=!1,c=e?e[Ew]:Ri,d=t[Rn];return d||(d=t[Rn]={}),t.setNext(r),e&&PZ(t[_4](),function(){return c+":"+s},function(){d[n]=!0;try{var e=r?r._id:_2;e&&(d[e]=!1),l=i(t)}catch(e){var a=!r||d[r._id];a&&(l=!0),r&&a||Pu(t[EJ](),1,73,"Plugin ["+c+"] failed during "+s+" - "+Cw(e)+", run flags: "+Cw(d))}},a,o),l}function d(t,i){function n(i){if(!e||!s)return!1;var n=P9(e);return!n[Eq]&&!n[_6]&&(a&&e[EZ](r),e[_7](t,i),!0)}c(i=i||l(),n,"processTelemetry",function(){return{item:t}},!t.sync)||i[Ex](t)}function u(t,i){function n(){var n=!1;if(e){var r=P9(e),s=e[_4]||r[_4];e&&(!s||s===t.core())&&!r[Eq]&&(r[_4]=null,r[Eq]=!0,r[EA]=!1,e[Eq]&&!0===e[Eq](t,i)&&(n=!0))}return n}c(t,n,"unload",function(){},i[Ez])||t[Ex](i)}function h(t,i){function n(){var n=!1;if(e){var r=P9(e),s=e[_4]||r[_4];e&&(!s||s===t.core())&&!r[Eq]&&e[EQ]&&!0===e[EQ](t,i)&&(n=!0)}return n}c(t,n,"update",function(){},!1)||t[Ex](i)}return C6(o)}function Rg(){var e=[];return{add:function(t){t&&e[Eb](t)},run:function(t,i){CL(e,function(e){try{e(t,i)}catch(e){Pu(t[EJ](),2,73,"Unexpected error calling unload handler - "+Cw(e))}}),e=[]}}}function Rp(){var e=[];return{run:function(t){var i=e;e=[],CL(i,function(e){try{(e.rm||e.remove).call(e)}catch(e){Pu(t,2,73,"Unloading:"+Cw(e))}}),ee&&i[Eh]>ee&&(et?et("doUnload",i):Pu(null,1,48,"Max unload hooks exceeded. An excessive number of unload hooks has been detected."))},add:function(t){t&&(bQ(e,t),ee&&e[Eh]>ee&&(et?et("Add",e):Pu(null,1,48,"Max unload hooks exceeded. An excessive number of unload hooks has been detected.")))}}}var Rf="getPlugin",Rm=((ei={})[_8]={isVal:If,v:{}},ei),Rv=function(){function e(){var t,i,n,r,s,a=this;function o(e){void 0===e&&(e=null);var t=e;if(!t){var r=i||Rl(null,{},a[_4]);t=n&&n[Rf]?r[Ej](null,n[Rf]):r[Ej](null,n)}return t}function l(e,t,r){wK(e,Rm,Pl(t)),!r&&t&&(r=t[EL]()[EY]());var s=n;n&&n[Rf]&&(s=n[Rf]()),a[_4]=t,i=Rl(r,e,t,s)}function c(){t=!1,a[_4]=null,i=null,n=null,s=Rp(),r=Rg()}c(),Ea(e,a,function(e){e[EI]=function(e,i,n,r){l(e,i,r),t=!0},e[Eq]=function(t,i){var a,o,l=e[_4];if(l&&(!t||l===t[_4]())){var d=!1,u=t||Rc(null,l,n&&n[Rf]?n[Rf]():n),h=i||(a={reason:0},a[Ez]=!1,a);return e[EK]&&!0===e[EK](u,h,g)?o=!0:g(),o}function g(){d||(d=!0,r.run(u,i),s.run(u[EJ]()),!0===o&&u[Ex](h),c())}},e[EQ]=function(t,i){var r,s=e[_4];if(s&&(!t||s===t[_4]())){var a=!1,o=t||Rd(null,s,n&&n[Rf]?n[Rf]():n),c=i||{reason:0};return e._doUpdate&&!0===e._doUpdate(o,c,d)?r=!0:d(),r}function d(){a||(a=!0,l(o.getCfg(),o.core(),o[EY]()))}},IE(e,"_addUnloadCb",function(){return r},"add"),IE(e,"_addHook",function(){return s},"add"),CJ(e,"_unloadHooks",{g:function(){return s}})}),a[EJ]=function(e){return o(e)[EJ]()},a[EA]=function(){return t},a.setInitialized=function(e){t=e},a[EZ]=function(e){n=e},a[Ex]=function(e,t){t?t[Ex](e):n&&Ch(n[_7])&&n[_7](e,null)},a._getTelCtx=o}return e.__ieDyn=1,e}();function RS(e,t,i){var n={id:t,fn:i};return bQ(e,n),{remove:function(){CL(e,function(t,i){if(t.id===n.id)return e[ET](i,1),-1})}}}function Ry(e,t,i){for(var n=!1,r=e[Eh],s=0;s<r;++s){var a=e[s];if(a)try{if(!1===a.fn[EC](null,[t])){n=!0;break}}catch(e){Pu(i,2,64,"Telemetry initializer failed: "+Iy(e),{exception:Cw(e)},!0)}}return!n}var RC=function(e){function t(){var i,n,r=e.call(this)||this;function s(){i=0,n=[]}return r.identifier="TelemetryInitializerPlugin",r.priority=199,s(),Ea(t,r,function(e,t){e.addTelemetryInitializer=function(e){return RS(n,i++,e)},e[_7]=function(t,i){Ry(n,t,i?i[EJ]():e[EJ]())&&e[Ex](t,i)},e[EK]=function(){s()}}),r}return TO(t,e),t.__ieDyn=1,t}(Rv),Rb="Plugins must provide initialize method",RT="_notificationManager",RE="SDK is still unloading...",R_="SDK is not initialized",RI=C5(((en={cookieCfg:{}})[_9]={rdOnly:!0,ref:!0,v:[]},en[_3]={rdOnly:!0,ref:!0,v:[]},en[_8]={ref:!0,v:{}},en[_5]=_1,en.loggingLevelConsole=0,en.diagnosticLogInterval=_1,en));function Rw(e,t){return new PQ(t)}function RP(e,t,i){var n,r=[],s=[],a={};return CL(i,function(i){(Ca(i)||Ca(i[EI]))&&CP(Rb);var n=i[Ie],o=i[Ew];i&&n&&(Ca(a[n])?a[n]=o:Ph(e,"Two extensions have same priority #"+n+" - "+a[n]+", "+o)),!n||n<t?r[Eb](i):s[Eb](i)}),(n={})[_4]=r,n[_3]=s,n}function RR(e,t){var i=!1;return CL(t,function(t){if(t===e)return i=!0,-1}),i}function RA(e,t,i,n){i&&Cx(i,function(i,r){n&&b6(r)&&b6(t[i])&&RA(e,t[i],r,n),n&&b6(r)&&b6(t[i])?RA(e,t[i],r,n):e.set(t,i,r)})}function RM(e,t){var i=null,n=-1;return CL(e,function(e,r){if(e.w===t)return i=e,n=r,-1}),{i:n,l:i}}function RD(e,t){var i=RM(e,t).l;return i||(i={w:t,rm:function(){var i=RM(e,t);-1!==i.i&&e[ET](i.i,1)}},e[Eb](i)),i}function RO(e,t,i){CL(t,function(t){var n=wQ(e,t.w,i);delete t.w,t.rm=function(){n.rm()}})}function Rk(e,t,i,n){return t.add(e[ES](function(e){var t=e.cfg.disableDbgExt;!0===t&&n&&(i[EP](n),n=null),i&&!n&&!0!==t&&(n=w9(e.cfg),i[ER](n))})),n}function RN(e){return CJ({rm:function(){e.rm()}},"toJSON",{v:function(){return"aicore::onCfgChange<"+JSON.stringify(e)+">"}})}var Rx=function(){function e(){var t,i,n,r,s,a,o,l,c,d,u,h,g,p,f,m,v,S,y,C,b,T,E,_,I,w,P,R;Ea(e,this,function(e){function A(e){return(!w||!w[EF])&&!R&&(e||n&&n.queue[Eh]>0)&&(P||(P=!0,j(t[ES](function(e){var t=e.cfg.diagnosticLogInterval;t&&t>0||(t=1e4);var i=!1;w&&(i=w[EF],w[E_]()),(w=TA(F,t)).unref(),w[EF]=i}))),w[EF]=!0),w}function M(){var e={};_=[];var t=function(t){t&&CL(t,function(t){if(t[Ew]&&t[EB]&&!e[t.identifier]){var i=t[Ew]+"="+t[EB];_[Eb](i),e[t.identifier]=t}})};t(h),u&&CL(u,function(e){t(e)}),t(d)}function D(){i=!1,(t=wK({},RI,e[Ey])).cfg[EH]=1,CJ(e,"config",{g:function(){return t.cfg},s:function(t){e.updateCfg(t,!1)}}),CJ(e,"pluginVersionStringArr",{g:function(){return _||M(),_}}),CJ(e,"pluginVersionString",{g:function(){return I||(_||M(),I=_.join(";")),I||_2}}),CJ(e,"logger",{g:function(){return n||(n=new Pc(t.cfg),t[Ey]=n),n},s:function(e){t[Ey]=e,n!==e&&(wY(n,!1),n=e)}}),e[Ey]=new Pc(t.cfg),E=[];var y=e.config[_9]||[];y.splice(0,y[Eh]),bQ(y,E),p=new RC,r=[],wY(s,!1),s=null,a=null,o=null,wY(l,!1),l=null,c=null,d=[],u=null,h=null,g=!1,f=null,m=wb("AIBaseCore",!0),v=Rg(),C=null,b=null,S=Rp(),T=[],I=null,_=null,R=!1,w=null,P=!1}function O(){var i=Rl(x(),t.cfg,e);return i[EV](A),i}function k(t){var i=RP(e[Ey],wX,d);c=null,I=null,_=null,h=Re(bQ(h=(u||[])[0]||[],i[_3]));var n=bQ(Re(i[_4]),h);E=C6(n);var r=e.config[_9]||[];r.splice(0,r[Eh]),bQ(r,E);var s=O();h&&h[Eh]>0&&P7(s[Ej](h),n),P7(s,n),t&&V(t)}function N(e){var t=null,i=null,n=[];return CL(E,function(t){if(t[Ew]===e&&t!==p)return i=t,-1;t.getChannel&&n[Eb](t)}),!i&&n[Eh]>0&&CL(n,function(t){if(!(i=t.getChannel(e)))return -1}),i&&(t={plugin:i,setEnabled:function(e){P9(i)[_6]=!e},isEnabled:function(){var e=P9(i);return!e[Eq]&&!e[_6]},remove:function(e,t){void 0===e&&(e=!0);var n,r=[i];L(r,((n={reason:1})[Ez]=e,n),function(e){e&&k({reason:32,removed:r}),t&&t(e)})}}),t}function x(){if(!c){var i=(E||[]).slice();-1===bY(i,p)&&i[Eb](p),c=Ru(Re(i),t.cfg,e)}return c}function L(i,n,r){if(i&&i[Eh]>0){var s=Rc(Ru(i,t.cfg,e),e);s[EV](function(){var e=!1,t=[];CL(d,function(n,r){RR(n,i)?e=!0:t[Eb](n)}),d=t,I=null,_=null;var n=[];u&&(CL(u,function(t,r){var s=[];CL(t,function(t){RR(t,i)?e=!0:s[Eb](t)}),n[Eb](s)}),u=n),r&&r(e),A()}),s[Ex](n)}else r(!1)}function F(){if(n&&n.queue){var t=n.queue.slice(0);n.queue[Eh]=0,CL(t,function(t){var i,n=((i={})[Ek]=f||"InternalMessageId: "+t[EW],i.iKey=b,i[EN]=IS(new Date),i.baseType=Po.dataType,i.baseData={message:t[EG]},i);e.track(n)})}}function U(e,t,i,n){var r=1,s=!1,a=null;function o(){r--,s&&0===r&&(a&&a[E_](),a=null,t&&t(s),t=null)}return n=n||5e3,h&&h[Eh]>0&&O()[Ej](h).iterate(function(t){if(t.flush){r++;var s=!1;t.flush(e,function(){s=!0,o()},i)||s||(e&&null==a?a=TP(function(){a=null,o()},n):o())}}),s=!0,o(),!0}function $(){var i;j(t[ES](function(t){if(t.cfg.enablePerfMgr){var n=t.cfg[_5];i!==n&&(n||(n=Rw),Ib(t.cfg,_5,n),i=n,o=null),!a&&!o&&Ch(n)&&(o=n(e,e[EM]()))}else o=null,i=null}))}function V(t){var i=Rd(x(),e);i[EV](A),e._updateHook&&!0===e._updateHook(i,t)||i[Ex](t)}function B(t){var i=e[Ey];i?(Pu(i,2,73,t),A()):CP(t)}function H(t){var i=e[EM]();i&&i[Ii]([t],2)}function j(e){S.add(e)}D(),e._getDbgPlgTargets=function(){return[E]},e[EA]=function(){return i},e[EI]=function(r,a,o,l){g&&CP(RE),e[EA]()&&CP("Core cannot be initialized more than once"),r=(t=wK(r,RI,o||e[Ey],!1)).cfg,j(t[ES](function(e){b=e.cfg.instrumentationKey;var t=e.ref(e.cfg,_8);Cx(t,function(i){e.ref(t,i)}),Ca(b)&&CP("Please provide instrumentation key")})),y=Rk(t,S,(s=l)&&e[EM](),y),$(),e[Ey]=o;var c=r[_9];if((d=[])[Eb].apply(d,Tk(Tk([],a,!1),c,!1)),u=r[_3],k(null),h&&0!==h[Eh]||CP("No "+_3+" available"),u&&u[Eh]>1){var p=e[ED]("TeeChannelController");p&&p.plugin||Pu(n,1,28,"TeeChannel required")}RO(r,T,n),T=null,i=!0,e.releaseQueue(),e[EO]()},e.getChannels=function(){var e=[];return h&&CL(h,function(t){e[Eb](t)}),C6(e)},e.track=function(t){PZ(e[Il](),function(){return"AppInsightsCore:track"},function(){null===t&&(H(t),CP("Invalid telemetry item")),!t[Ek]&&Ca(t[Ek])&&(H(t),CP("telemetry name required")),t.iKey=t.iKey||b,t[EN]=t[EN]||IS(new Date),t.ver=t.ver||"4.0",!g&&e[EA]()?O()[Ex](t):r[Eb](t)},function(){return{item:t}},!t.sync)},e[EL]=O,e[EM]=function(){return s||(s=new Pq(t.cfg),e[RT]=s),s},e[ER]=function(t){e.getNotifyMgr()[ER](t)},e[EP]=function(e){s&&s[EP](e)},e.getCookieMgr=function(){return l||(l=Pk(t.cfg,e[Ey])),l},e.setCookieMgr=function(e){l!==e&&(wY(l,!1),l=e)},e[Il]=function(){return a||o||PX()},e.setPerfMgr=function(e){a=e},e.eventCnt=function(){return r[Eh]},e.releaseQueue=function(){if(i&&r[Eh]>0){var e=r;r=[],CL(e,function(e){O()[Ex](e)})}},e[EO]=function(e){return f=e||null,R=!1,w&&w[E_](),A(!0)},e[EU]=function(){R=!0,w&&w[E_](),F()},I_(e,function(){return p},["addTelemetryInitializer"]),e[E$]=function(t,r,a){void 0===t&&(t=!0),i||CP(R_),g&&CP(RE);var o,c,d=((o={reason:50})[Ez]=t,o.flushComplete=!1,o);t&&!r&&(c=_H(function(e){r=e}));var u=Rc(x(),e);function h(t){d.flushComplete=t,g=!0,v.run(u,d),e[EU](),u[Ex](d)}return u[EV](function(){S.run(e[Ey]),wZ([l,s,n],t,function(){D(),r&&r(d)})},e),F(),U(t,h,6,a)||h(!1),c},e[ED]=N,e.addPlugin=function(e,t,i,n){if(!e){n&&n(!1),B(Rb);return}var r=N(e[Ew]);if(r&&!t){n&&n(!1),B("Plugin ["+e[Ew]+"] is already loaded!");return}var s={reason:16};function a(t){d[Eb](e),s.added=[e],k(s),n&&n(!0)}if(r){var o=[r.plugin];L(o,{reason:2,isAsync:!!i},function(e){e?(s.removed=o,s.reason|=32,a(!0)):n&&n(!1)})}else a(!1)},e.updateCfg=function(i,n){if(void 0===n&&(n=!0),e[EA]()){i=(r={reason:1,cfg:t.cfg,oldCfg:Tc({},t.cfg),newConfig:Tc({},i),merge:n}).newConfig;var r,s=t.cfg;i[_9]=s[_9],i[_3]=s[_3]}t._block(function(e){var t=e.cfg;RA(e,t,i,n),n||Cx(t,function(n){Ck(i,n)||e.set(t,n,_1)}),e[Ev](t,RI)},!0),t[Ep](),r&&V(r)},e.evtNamespace=function(){return m},e.flush=U,e.getTraceCtx=function(e){return C||(C=Rt()),C},e.setTraceCtx=function(e){C=e||null},e.addUnloadHook=j,IE(e,"addUnloadCb",function(){return v},"add"),e.onCfgChange=function(n){var r;return RN(r=i?wQ(t.cfg,n,e[Ey]):RD(T,n))},e.getWParam=function(){return bk()||t.cfg.enableWParam?0:-1}})}return e.__ieDyn=1,e}(),RL="",RF="&NoResponseBody=true",RU="POST",R$=function(){function e(){var t,i,n,r,s,a,o,l,c,d,u,h,g,p=0;Ea(e,this,function(e,f){var m=!0;function v(e,t){b(t,200,{},e)}function S(e,t){Pu(n,2,26,"Failed to send telemetry.",{message:e}),b(t,400,{})}function y(e){S("No endpoint url is provided for the batch",e)}function C(e,t){for(var i,n=0,r=null,s=0;null==r&&s<e[Eh];)n=e[s],l||1!==n?2===n&&wt(t)&&(!t||!u)?r=I:3===n&&we()&&(t?!d:!c)&&(r=E):wi()?r=w:wn()&&(r=_),s++;return r?((i={_transport:n,_isSync:t})[_a]=r,i):null}function b(e,t,i,n){try{e&&e(t,i,n)}catch(e){}}function T(e,t){var i=bU(),n=e[_s];if(!n)return y(t),!0;n=e[_s]+(h?RF:RL);var s=e[_t],a=r?s:new Blob([s],{type:"text/plain;charset=UTF-8"});return i.sendBeacon(n,a)}function E(e,t,i){var a=e[_t];try{if(a)if(T(e,t))v(RL,t);else{var l=s&&s.beaconOnRetry;l&&Ch(l)?l(e,t,T):(o&&o[_a](e,t,!0),Pu(n,2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}catch(e){r&&Ph(n,"Failed to send telemetry using sendBeacon API. Ex:"+Cw(e)),b(t,400*!r,{},RL)}}function _(e,i,n){var a,o,l,c=e[_o]||{};!n&&t&&(a=_H(function(e,t){o=e,l=t})),r&&n&&e.disableXhrSync&&(n=!1);var d=e[_s];if(!d){y(i),o&&o(!1);return}var u=IN(RU,d,m,!0,n,e[_l]);function h(t){var n=s&&s.xhrOnComplete;if(n&&Ch(n))n(t,i,e);else{var a=IP(t);b(i,t[E8],IV(t,r),a)}}return r||u[_c]("Content-type","application/json"),CL(C3(c),function(e){u[_c](e,c[e])}),u.onreadystatechange=function(){!r&&(h(u),4===u.readyState&&o&&o(!0))},u.onload=function(){r&&h(u)},u.onerror=function(e){b(i,r?u[E8]:400,IV(u,r),r?RL:IA(u)),l&&l(e)},u.ontimeout=function(){b(i,r?u[E8]:500,IV(u,r),r?RL:IA(u)),o&&o(!1)},u.send(e[_t]),a}function I(e,i,n){var a,o,l,c,d=e[_s],u=e[_t],f=r?u:new Blob([u],{type:"application/json"}),v=new Headers,S=u[Eh],C=!1,T=!1,E=e[_o]||{},_=((a={method:RU,body:f})[w0]=!0,a);e.headers&&C3(e.headers)[Eh]>0&&(CL(C3(E),function(e){v.append(e,E[e])}),_[_o]=v),m&&r&&(_.credentials="include"),n&&(_.keepalive=!0,p+=S,r?2===e._sendReason&&(C=!0,h&&(d+=RF)):C=!0);var I=new Request(d,_);try{I[w0]=!0}catch(e){}if(!n&&t&&(o=_H(function(e,t){l=e,c=t})),!d){y(i),l&&l(!1);return}function w(e){b(i,400*!r,{},r?RL:e)}function P(e,t,n){var r=e[E8],a=s.fetchOnComplete;a&&Ch(a)?a(e,i,n||RL,t):b(i,r,{},n||RL)}try{_m(fetch(r?d:I,r?_:null),function(t){if(n&&(p-=S,S=0),!T)if(T=!0,t.rejected)w(t.reason&&t.reason[EG]),c&&c(t.reason);else{var i=t.value;try{r||i.ok?r&&!i.body?(P(i,null,RL),l&&l(!0)):_m(i.text(),function(t){P(i,e,t.value),l&&l(!0)}):(w(i.statusText),l&&l(!1))}catch(e){w(Cw(e)),c&&c(e)}}})}catch(e){!T&&(w(Cw(e)),c&&c(e))}return C&&!T&&(T=!0,b(i,200,{}),l&&l(!0)),r&&!T&&e[_l]>0&&g&&g.set(function(){!T&&(T=!0,b(i,500,{}),l&&l(!0))},e[_l]),o}function w(e,t,i){var a=bL(),o=new XDomainRequest,l=e[_t];o.onload=function(){var i=IP(o),n=s&&s.xdrOnComplete;n&&Ch(n)?n(o,t,e):b(t,200,{},i)},o.onerror=function(){b(t,400,{},r?RL:IR(o))},o.ontimeout=function(){b(t,500,{})},o.onprogress=function(){};var c=a&&a.location&&a.location[EX]||"",d=e[_s];if(!d)return void y(t);if(!r&&0!==d.lastIndexOf(c,0)){var u="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.";Pu(n,2,40,". "+u),S(u,t);return}var h=r?d:d[E3](/^(https?:)/,"");o.open(RU,h),e[_l]&&(o[_l]=e[_l]),o.send(l),r&&i?g&&g.set(function(){o.send(l)},0):o.send(l)}function P(){p=0,i=!1,t=!1,n=null,r=null,s=null,a=null,o=null,l=!1,c=!1,d=!1,u=!1,h=!1,g=null}P(),e[EI]=function(t,r){n=r,i&&Pu(n,1,28,"Sender is already initialized"),e.SetConfig(t),i=!0},e._getDbgPlgTargets=function(){return[i,r,a,t]},e.SetConfig=function(e){try{if(s=e.senderOnCompleteCallBack||{},a=!!e.disableCredentials,r=!!e.isOneDs,t=!!e.enableSendPromise,l=!!e.disableXhr,c=!!e.disableBeacon,d=!!e.disableBeaconSync,g=e.timeWrapper,h=!!e.addNoResponse,u=!!e.disableFetchKeepAlive,o={sendPOST:_},r||(m=!1),a){var i=I2();i&&i.protocol&&"file:"===i.protocol[Ed]()&&(m=!1)}return!0}catch(e){}return!1},e.getSyncFetchPayload=function(){return p},e.getSenderInst=function(e,t){return e&&e[Eh]?C(e,t):null},e.getFallbackInst=function(){return o},e[EK]=function(e,t){P()}})}return e.__ieDyn=1,e}(),RV="on",RB="attachEvent",RH="addEventListener",Rj="detachEvent",Rq="removeEventListener",RW="events",RG="visibilitychange",Rz="pagehide",RJ="pageshow",RK="unload",RQ="beforeunload",RY=wb("aiEvtPageHide"),RZ=wb("aiEvtPageShow"),RX=/\.[\.]+/g,R0=/[\.]+$/,R1=1,R2=wT("events"),R3=/^([^.]*)(?:\.(.+)|)/;function R4(e){return e&&e[E3]?e[E3](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,_2):e}function R5(e,t){if(t){var i,n=_2;Cp(t)?(n=_2,CL(t,function(e){(e=R4(e))&&("."!==e[0]&&(e="."+e),n+=e)})):n=R4(t),n&&("."!==n[0]&&(n="."+n),e=(e||_2)+n)}var r=R3.exec(e||_2)||[];return(i={})[E5]=r[1],i.ns=(r[2]||_2).replace(RX,".").replace(R0,_2)[E1](".").sort().join("."),i}function R6(e,t,i){void 0===i&&(i=!0);var n=R2.get(e,RW,{},i),r=n[t];return r||(r=n[t]=[]),r}function R8(e,t,i,n){e&&t&&t[E5]&&(e[Rq]?e[Rq](t[E5],i,n):e[Rj]&&e[Rj](RV+t[E5],i))}function R9(e,t,i,n){var r=!1;return e&&t&&t[E5]&&i&&(e[RH]?(e[RH](t[E5],i,n),r=!0):e[RB]&&(e[RB](RV+t[E5],i),r=!0)),r}function R7(e,t,i,n){for(var r=t[Eh];r--;){var s=t[r];s&&(!i.ns||i.ns===s.evtName.ns)&&(!n||n(s))&&(R8(e,s.evtName,s[E6],s.capture),t[ET](r,1))}}function Ae(e,t,i){if(t[E5])R7(e,R6(e,t[E5]),t,i);else{var n=R2.get(e,RW,{});Cx(n,function(n,r){R7(e,r,t,i)}),0===C3(n)[Eh]&&R2.kill(e,RW)}}function At(e,t){var i;return t?R5("xx",i=Cp(t)?[e].concat(t):[e,t]).ns[E1]("."):e}function Ai(e,t,i,n,r){void 0===r&&(r=!1);var s,a=!1;if(e)try{var o=R5(t,n);if((a=R9(e,o,i,r))&&R2.accept(e)){var l=((s={guid:R1++,evtName:o})[E6]=i,s.capture=r,s);R6(e,o.type)[Eb](l)}}catch(e){}return a}function An(e,t,i,n,r){if(void 0===r&&(r=!1),e)try{var s=R5(t,n),a=!1;Ae(e,s,function(e){return(!!s.ns&&!i||e[E6]===i)&&(a=!0,!0)}),a||R8(e,s,i,r)}catch(e){}}function Ar(e,t,i){var n=!1,r=bL();r&&(n=Ai(r,e,t,i),n=Ai(r.body,e,t,i)||n);var s=bN();return s&&(n=Ai(s,e,t,i)||n),n}function As(e,t,i){var n=bL();n&&(An(n,e,t,i),An(n.body,e,t,i));var r=bN();r&&An(r,e,t,i)}function Aa(e,t,i,n){var r=!1;return t&&e&&e[Eh]>0&&CL(e,function(e){e&&(!i||-1===bY(i,e))&&(r=Ar(e,t,n)||r)}),r}function Ao(e,t,i,n){var r=!1;return t&&e&&Cp(e)&&((r=Aa(e,t,i,n))||!i||!(i[Eh]>0)||(r=Aa(e,t,null,n))),r}function Al(e,t,i){e&&Cp(e)&&CL(e,function(e){e&&As(e,t,i)})}function Ac(e,t,i){return Ao([RQ,RK,Rz],e,t,i)}function Ad(e,t){Al([RQ,RK,Rz],e,t)}function Au(e,t,i){function n(t){var i=bN();e&&i&&"hidden"===i.visibilityState&&e(t)}var r=At(RY,i),s=Aa([Rz],e,t,r);return t&&-1!==bY(t,RG)||(s=Aa([RG],n,t,r)||s),!s&&t&&(s=Au(e,null,i)),s}function Ah(e,t){var i=At(RY,t);Al([Rz],e,i),Al([RG],null,i)}function Ag(e,t,i){function n(t){var i=bN();e&&i&&"visible"===i.visibilityState&&e(t)}var r=At(RZ,i),s=Aa([RJ],e,t,r);return(s=Aa([RG],n,t,r)||s)||!t||(s=Ag(e,null,i)),s}function Ap(e,t){var i=At(RZ,t);Al([RJ],e,i),Al([RG],null,i)}var Af="",Am="https://browser.events.data.microsoft.com/OneCollector/1.0/",Av="version",AS="properties",Ay="initialize",AC="logger",Ab="indexOf",AT="timings",AE="pollInternalLogs",A_="value",AI="kind",Aw="length",AP="processTelemetryStart",AR="1DS-Web-JS-4.2.1",AA=yN.hasOwnProperty,AM=((er={})[0]=0,er[2]=6,er[1]=1,er[3]=7,er[4098]=6,er[4097]=1,er[4099]=7,er);function AD(e){return!(e===Af||Ca(e))}function AO(e){if(e){var t=Tm(e,"-");if(t>-1)return bd(e,t)}return Af}function Ak(e){return!!(e&&Cm(e))&&!!(e>=1)&&!!(e<=4)}function AN(e,t,i){if(!t&&!AD(t)||"string"!=typeof e)return null;var n=typeof t;if("string"===n||"number"===n||"boolean"===n||Cp(t))t={value:t};else if("object"!==n||AA.call(t,"value")){if(Ca(t[A_])||t[A_]===Af||!Cu(t[A_])&&!Cm(t[A_])&&!Cv(t[A_])&&!Cp(t[A_]))return null}else t={value:i?JSON.stringify(t):t};if(Cp(t[A_])&&!AH(t[A_]))return null;if(!Ca(t[AI])){if(Cp(t[A_])||!AV(t[AI]))return null;t[A_]=t[A_].toString()}return t}function Ax(e,t,i){var n=-1;if(!Cr(e))if(t>0&&(32===t?n=8192:t<=13&&(n=t<<5)),AB(i))-1===n&&(n=0),n|=i;else{var r=AM[Aq(e)]||-1;-1!==n&&-1!==r?n|=r:6===r&&(n=r)}return n}function AL(e,t,i){var n;return void 0===i&&(i=!0),e&&(n=e.get(t),i&&n&&decodeURIComponent&&(n=decodeURIComponent(n))),n||Af}function AF(e){void 0===e&&(e="D");var t=P0();return"B"===e?t="{"+t+"}":"P"===e?t="("+t+")":"N"===e&&(t=t.replace(/-/g,Af)),t}function AU(e,t,i,n,r){var s={},a=!1,o=0,l=arguments[Aw],c=arguments;for(Cv(c[0])&&(a=c[0],o++);o<l;o++){var e=c[o];Cx(e,function(e,t){a&&t&&Cg(t)?Cp(t)?(s[e]=s[e]||[],CL(t,function(t,i){t&&Cg(t)?s[e][i]=AU(!0,s[e][i],t):s[e][i]=t})):s[e]=AU(!0,s[e],t):s[e]=t})}return s}bk(),bx();var A$=Th;function AV(e){return 0===e||!!(e>0)&&!!(e<=13)||32===e}function AB(e){return!!(e>=0)&&!!(e<=9)}function AH(e){return e[Aw]>0}function Aj(e,t){var i=e;i[AT]=i[AT]||{},i[AT][AP]=i[AT][AP]||{},i[AT][AP][t]=A$()}function Aq(e){var t=0;if(null!=e){var i=typeof e;"string"===i?t=1:"number"===i?t=2:"boolean"===i?t=3:i===yM&&(t=4,Cp(e)?(t=4096,e[Aw]>0&&(t|=Aq(e[0]))):AA.call(e,"value")&&(t=8192|Aq(e[A_])))}return t}function AW(){return!!bO("chrome")}function AG(e){return e>0}var Az=C5({endpointUrl:Am,propertyStorageOverride:{isVal:AJ}});function AJ(e){return!e||e.getProperty&&e.setProperty||CP("Invalid property storage override passed."),!0}var AK=function(e){function t(){var i=e.call(this)||this;return Ea(t,i,function(e,t){e[Ay]=function(i,n,r,s){PZ(e,function(){return"AppInsightsCore.initialize"},function(){try{t[Ay](wK(i,Az,r||e[AC],!1).cfg,n,r,s)}catch(t){var a=e[AC],o=Cw(t);-1!==o[Ab]("channels")&&(o+="\n - Channels must be provided through config.channels only!"),Pu(a,1,514,"SDK Initialization Failed - no telemetry will be sent: "+o)}},function(){return{config:i,extensions:n,logger:r,notificationManager:s}})},e.track=function(i){PZ(e,function(){return"AppInsightsCore.track"},function(){var n=i;if(n){n[AT]=n[AT]||{},n[AT].trackStart=A$(),Ak(n.latency)||(n.latency=1);var r=n.ext=n.ext||{};r.sdk=r.sdk||{},r.sdk.ver=AR;var s=n.baseData=n.baseData||{};s[AS]=s[AS]||{};var a=s[AS];a[Av]=a[Av]||e.pluginVersionString||Af}t.track(n)},function(){return{item:i}},!i.sync)},e[AE]=function(e){return t[AE](e||"InternalLog")}}),i}return TO(t,e),t.__ieDyn=1,t}(Rx);Eo({NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,Pii_IPv6ScrubLastHextets:14,Pii_DropValue:15,CustomerContent_GenericContent:32});var AQ=Eo({Normal:1,CostDeferred:2,RealTime:3,Immediate:4});Eo({Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9});var AY=Eo({Normal:1,Critical:2});Eo({NONE:0,ERROR:1,WARNING:2,INFORMATION:3});var AZ="REAL_TIME",AX="NEAR_REAL_TIME",A0="BEST_EFFORT",A1="",A2="drop",A3="send",A4="requeue",A5="rspFail",A6="oth",A8="no-cache, no-store",A9="application/x-json-stream",A7="cache-control",Me="content-type",Mt="kill-tokens",Mi="kill-duration",Mn="time-delta-millis",Mr="client-version",Ms="client-id",Ma="time-delta-to-apply-millis",Mo="upload-time",Ml="apikey",Mc="AuthMsaDeviceTicket",Md="WebAuthToken",Mu="AuthXToken",Mh="NoResponseBody",Mg="msfpc",Mp="trace",Mf="user",Mm="allowRequestSending",Mv="firstRequestSent",MS="shouldAddClockSkewHeaders",My="getClockSkewHeaderValue",MC="setClockSkew",Mb="length",MT="concat",ME="iKey",M_="count",MI="events",Mw="push",MP="split",MR="splice",MA="toLowerCase",MM="hdrs",MD="useHdrs",MO="initialize",Mk="setTimeoutOverride",MN="clearTimeoutOverride",Mx="payloadPreprocessor",ML="overrideEndpointUrl",MF="avoidOptions",MU="disableEventTimings",M$="stringifyObjects",MV="enableCompoundKey",MB="disableXhrSync",MH="disableFetchKeepAlive",Mj="addNoResponse",Mq="excludeCsMetaData",MW="useSendBeacon",MG="alwaysUseXhrOverride",Mz="unloadTransports",MJ="serializeOfflineEvt",MK="getOfflineRequestDetails",MQ="createPayload",MY="createOneDSPayload",MZ="payloadBlob",MX="headers",M0="_thePayload",M1="urlString",M2="batches",M3="sendType",M4="addHeader",M5="canSendRequest",M6="sendQueuedRequests",M8="isCompletelyIdle",M9="setUnloading",M7="isTenantKilled",De="sendSynchronousBatch",Dt="_transport",Di="getWParam",Dn="isBeacon",Dr="timings",Ds="isTeardown",Da="isSync",Do="data",Dl="timeout",Dc="_sendReason",Dd="setKillSwitchTenants",Du="_backOffTransmission",Dh="identifier",Dg="disableOptimizeObj",Dp="ignoreMc1Ms0CookieProcessing",Df="eventsLimitInMem",Dm="autoFlushEventsLimit",Dv="disableAutoBatchFlushLimit",DS="overrideInstrumentationKey",Dy="disableTelemetry",DC="baseData",Db="sendAttempt",DT="latency",DE="sync";function D_(e){var t=(e.ext||{}).intweb;return t&&AD(t[Mg])?t[Mg]:null}function DI(e){for(var t=null,i=0;null===t&&i<e[Mb];i++)t=D_(e[i]);return t}var Dw=function(){function e(t,i){var n=i?[][MT](i):[],r=this,s=DI(n);r[ME]=function(){return t},r.Msfpc=function(){return s||A1},r[M_]=function(){return n[Mb]},r[MI]=function(){return n},r.addEvent=function(e){return!!e&&(n[Mw](e),s||(s=D_(e)),!0)},r[MP]=function(i,r){var a;if(i<n[Mb]){var o=n[Mb]-i;Ca(r)||(o=r<o?r:o),a=n[MR](i,o),s=DI(n)}return new e(t,a)}}return e.create=function(t,i){return new e(t,i)},e}(),DP=function(){function e(){var t=!0,i=!0,n=!0,r="use-collector-delta",s=!1;Ea(e,this,function(e){e[Mm]=function(){return t},e[Mv]=function(){n&&(n=!1,s||(t=!1))},e[MS]=function(){return i},e[My]=function(){return r},e[MC]=function(e){s||(e?(r=e,i=!0,s=!0):i=!1,t=!0)}})}return e.__ieDyn=1,e}(),DR=1e3,DA=function(){function e(){var t={};function i(e){var t=[];return e&&CL(e,function(e){t[Mw](b5(e))}),t}Ea(e,this,function(e){e[Dd]=function(e,n){if(e&&n)try{var r=i(e[MP](","));if("this-request-only"===n)return r;for(var s=parseInt(n,10)*DR,a=0;a<r[Mb];++a)t[r[a]]=bp()+s}catch(e){}return[]},e[M7]=function(e){var i=t,n=b5(e);return!!(void 0!==i[n]&&i[n]>bp())||(delete i[n],!1)}})}return e.__ieDyn=1,e}(),DM=.8,DD=1.2,DO=3e3,Dk=6e5;function DN(e){return!(e>=300&&e<500&&429!=e||501==e||505==e)}function Dx(e){var t=0,i=DO*DM;return Math.min(t=Math.pow(2,e)*(Math.floor(Math.random()*(DO*DD-i))+i),Dk)}var DL=20,DF=3984588,DU=65e3,D$=2e6,DV=65e3,DB="metadata",DH="f",Dj=/\./,Dq=function(){function e(t,i,n,r,s,a){var o="data",l="baseData",c="ext",d=!!r,u=!0,h=i,g={},p=!!a,f=s||Ax;Ea(e,this,function(e){function i(e,t){var i=g[e];return void 0===i&&(e.length>=7&&(i=Tv(e,"ext.metadata")||Tv(e,"ext.web")),g[e]=i),i}function r(e,t,s,a,o,l,c){Cx(e,function(e,u){var g=null;if(u||AD(u)){var p=s,f=e,m=o,v=t;if(d&&!a&&Dj.test(e)){var S=e.split("."),y=S.length;if(y>1){m&&(m=m.slice());for(var C=0;C<y-1;C++){var b=S[C];v=v[b]=v[b]||{},p+="."+b,m&&m.push(b)}f=S[y-1]}}if(g=!(a&&i(p,f))&&h&&h.handleField(p,f)?h.value(p,f,u,n):AN(f,u,n)){var T=g.value;if(v[f]=T,l&&l(m,f,g),c&&"object"==typeof T&&!Cp(T)){var E=m;E&&(E=E.slice()).push(f),r(u,T,p+"."+f,a,E,l,c)}}}})}e.createPayload=function(e,t,i,n,r,s){return{apiKeys:[],payloadBlob:A1,overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:e,isTeardown:t,isSync:i,isBeacon:n,sendType:s,sendReason:r}},e.appendPayload=function(i,n,r){var s=i&&n&&!i.overflow;return s&&PZ(t,function(){return"Serializer:appendPayload"},function(){for(var t=n.events(),s=i.payloadBlob,a=i.numEvents,o=!1,l=[],c=[],d=i.isBeacon,u=d?DU:DF,h=d?DV:D$,g=0,p=0;g<t.length;){var f=t[g];if(f){if(a>=r){i.overflow=n.split(g);break}var m=e.getEventBlob(f);if(m&&m.length<=h){var v=m.length;if(s.length+v>u){i.overflow=n.split(g);break}s&&(s+="\n"),s+=m,++p>DL&&(bl(s,0,1),p=0),o=!0,a++}else m?l.push(f):c.push(f),t.splice(g,1),g--}g++}if(l.length>0&&i.sizeExceed.push(Dw.create(n.iKey(),l)),c.length>0&&i.failedEvts.push(Dw.create(n.iKey(),c)),o){i.batches.push(n),i.payloadBlob=s,i.numEvents=a;var S=n.iKey();-1===bY(i.apiKeys,S)&&i.apiKeys.push(S)}},function(){return{payload:i,theBatch:{iKey:n.iKey(),evts:n.events()},max:r}}),s},e.getEventBlob=function(e){try{return PZ(t,function(){return"Serializer.getEventBlob"},function(){var t,i={};i.name=e.name,i.time=e.time,i.ver=e.ver,i.iKey="o:"+AO(e.iKey);var n={};p||(t=function(e,t,i){DW(f,n,e,t,i)});var s=e[c];s&&(i[c]=n,Cx(s,function(e,t){var i=n[e]={};r(t,i,"ext."+e,!0,null,null,!0)}));var a=i[o]={};a.baseType=e.baseType;var d=a[l]={};return r(e.baseData,d,l,!1,[l],t,u),r(e.data,a,o,!1,[],t,u),JSON.stringify(i)},function(){return{item:e}})}catch(e){return null}}})}return e.__ieDyn=1,e}();function DW(e,t,i,n,r){if(r&&t){var s=e(r.value,r.kind,r.propertyType);if(s>-1){var a=t[DB];a||(a=t[DB]={f:{}});var o=a[DH];if(o||(o=a[DH]={}),i)for(var l=0;l<i.length;l++){var c=i[l];o[c]||(o[c]={f:{}});var d=o[c][DH];d||(d=o[c][DH]={}),o=d}o=o[n]={},Cp(r.value)?o.a={t:s}:o.t=s}}}function DG(e,t){return{set:function(i,n){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];return TR([e,t],i,n,r)}}}var Dz="sendAttempt",DJ="&"+Mh+"=true",DK="?cors=true&"+Me[MA]()+"="+A9,DQ=((es={})[1]=A4,es[100]=A4,es[200]="sent",es[8004]=A2,es[8003]=A2,es),DY={},DZ={};function DX(e,t,i){DY[e]=t,!1!==i&&(DZ[t]=e)}function D0(e,t){var i=!1;if(e&&t){var n=C3(e);if(n&&n[Mb]>0)for(var r=t[MA](),s=0;s<n[Mb];s++){var a=n[s];if(a&&CD(t,a)&&a[MA]()===r){i=!0;break}}}return i}function D1(e,t,i,n){t&&i&&i[Mb]>0&&(n&&DY[t]?(e[MM][DY[t]]=i,e[MD]=!0):e.url+="&"+t+"="+i)}function D2(e,t,i){for(var n=0;n<e[Mb];n++)if(e[n].name===t){e[n].value=i;return}e[Mw]({name:t,value:i})}function D3(e,t){for(var i=0;i<e[Mb];i++)if(e[i].name===t)return void e[MR](i,1)}DX(Mc,Mc,!1),DX(Mr,Mr),DX(Ms,"Client-Id"),DX(Ml,Ml),DX(Ma,Ma),DX(Mo,Mo),DX(Mu,Mu);var D4=function(){function e(t,i,n,r){var s,a,o,l,c,d,u,h,g,p,f,m,v,S,y,C,b,T,E,_,I,w,P,R,A,M,D,O,k,N,x,L=!1;Ea(e,this,function(e){B();var F=!0;function U(e,t){try{return x&&x.getSenderInst(e,t)}catch(e){}return null}function $(){try{var e={xdrOnComplete:V,fetchOnComplete:H,xhrOnComplete:j,beaconOnRetry:W};return{enableSendPromise:!1,isOneDs:!0,disableCredentials:!F,disableXhr:!1,disableBeacon:!L,disableBeaconSync:!L,disableFetchKeepAlive:I,timeWrapper:k,addNoResponse:P,senderOnCompleteCallBack:e}}catch(e){}return null}function V(e,t,i){var n=IP(e);q(t,200,{},n),el(n)}function B(){var e;s=null,a=new DA,o=!1,l=new DP,L=!1,c=0,d=null,u=null,h=null,g=null,p=!0,f=[],m={},v=[],S=null,y=!1,C=null,b=!1,T=!1,E=e,_=e,I=e,w=e,P=e,R=[],A=e,M=e,D=[],O=!1,k=DG(),N=!1,x=null}function H(e,t,i,n){var r=function(e,i,n){q(t,e,i,n),el(n)},s={},a=e[MX];a&&a.forEach(function(e,t){s[t]=e}),r(e.status,s,i||A1)}function j(e,t,i){var n=IP(e);q(t,e.status,IV(e,!0),n),el(n)}function q(e,t,i,n){try{e(t,i,n)}catch(e){Pu(u,2,518,Cw(e))}}function W(e,t,i){var n=200,r=e[M0],s=e[M1]+(P?DJ:A1);try{var a=bU();if(r){var o=!!g.getPlugin("LocalStorage"),l=[],c=[];CL(r[M2],function(e){if(l&&e&&e[M_]()>0)for(var t=e[MI](),i=0;i<t[Mb];i++)if(a.sendBeacon(s,S.getEventBlob(t[i])))c[Mw](e[i]);else{l[Mw](e[MP](i));break}else l[Mw](e[MP](0))}),c[Mb]>0&&(r.sentEvts=c),o||ec(l,8003,r[M3],!0)}else n=0}catch(e){Ph(u,"Failed to send telemetry using sendBeacon API. Ex:"+Cw(e)),n=0}finally{q(t,n,{},A1)}}function G(e){return 2===e||3===e}function z(e){return b&&G(e)&&(e=2),e}function J(){return!o&&c<i}function K(){var e=v;return v=[],e}function Q(e,t,i){var n=!1;return e&&e[Mb]>0&&!o&&h[t]&&S&&(n=0!==t||J()&&(i>0||l[Mm]())),n}function Y(e){var t={};return e&&CL(e,function(e,i){t[i]={iKey:e[ME](),evts:e[MI]()}}),t}function Z(e,i,n,r,s){if(e&&0!==e[Mb]){if(o)return void ec(e,1,r);r=z(r);try{var l=e,c=0!==r;PZ(g,function(){return"HttpManager:_sendBatches"},function(o){o&&(e=e.slice(0));for(var l=[],d=null,u=A$(),g=h[r]||(c?h[1]:h[0]),p=g&&g[Dt],f=w&&(b||G(r)||3===p||g._isSync&&2===p);Q(e,r,i);){var m=e.shift();m&&m[M_]()>0&&(a.isTenantKilled(m[ME]())?l[Mw](m):(d=d||S[MQ](i,n,c,f,s,r),S.appendPayload(d,m,t)?null!==d.overflow&&(e=[d.overflow][MT](e),d.overflow=null,et(d,u,A$(),s),u=A$(),d=null):(et(d,u,A$(),s),u=A$(),e=[m][MT](e),d=null)))}d&&et(d,u,A$(),s),e[Mb]>0&&(v=e[MT](v)),ec(l,8004,r)},function(){return{batches:Y(l),retryCount:i,isTeardown:n,isSynchronous:c,sendReason:s,useSendBeacon:G(r),sendType:r}},!c)}catch(e){Pu(u,2,48,"Unexpected Exception sending batch: "+Cw(e))}}}function X(e,t){var i={url:s,hdrs:{},useHdrs:!1};t?(i[MM]=AU(i[MM],m),i.useHdrs=C3(i.hdrs)[Mb]>0):Cx(m,function(e,t){DZ[e]?D1(i,DZ[e],t,!1):(i[MM][e]=t,i[MD]=!0)}),D1(i,Ms,"NO_AUTH",t),D1(i,Mr,AR,t);var n=A1;CL(e.apiKeys,function(e){n[Mb]>0&&(n+=","),n+=e}),D1(i,Ml,n,t),D1(i,Mo,bp().toString(),t);var r=eo(e);if(AD(r)&&(i.url+="&ext.intweb.msfpc="+r),l[MS]()&&D1(i,Ma,l[My](),t),g[Di]){var a=g[Di]();a>=0&&(i.url+="&w="+a)}for(var o=0;o<f[Mb];o++)i.url+="&"+f[o].name+"="+f[o].value;return i}function ee(e,t,i){e[t]=e[t]||{},e[t][d.identifier]=i}function et(e,t,i,n){if(e&&e.payloadBlob&&e.payloadBlob[Mb]>0){var r=!!A,s=h[e.sendType];!G(e[M3])&&e[Dn]&&2===e.sendReason&&(s=h[2]||h[3]||s);var a=T;(e.isBeacon||3===s[Dt])&&(a=!1);var o=X(e,a);a=a||o[MD];var d=A$();PZ(g,function(){return"HttpManager:_doPayloadSend"},function(){for(var h=0;h<e.batches[Mb];h++)for(var f=e[M2][h][MI](),m=0;m<f[Mb];m++){var v=f[m];if(y){var S=v[Dr]=v[Dr]||{};ee(S,"sendEventStart",d),ee(S,"serializationStart",t),ee(S,"serializationCompleted",i)}v[Dz]>0?v[Dz]++:v[Dz]=1}ec(e[M2],1e3+(n||0),e[M3],!0);var C={data:e[MZ],urlString:o.url,headers:o[MM],_thePayload:e,_sendReason:n,timeout:E,disableXhrSync:_,disableFetchKeepAlive:I};a&&(D0(C[MX],A7)||(C[MX][A7]=A8),D0(C[MX],Me)||(C[MX][Me]=A9));var b=null;s&&(b=function(t){l[Mv]();var i=function(t,i){en(t,i,e,n)},r=e[Ds]||e[Da];try{s.sendPOST(t,i,r),M&&M(C,t,r,e[Dn])}catch(e){Ph(u,"Unexpected exception sending payload. Ex:"+Cw(e)),q(i,0,{})}}),PZ(g,function(){return"HttpManager:_doPayloadSend.sender"},function(){if(b)if(0===e[M3]&&c++,r&&!e.isBeacon&&3!==s[Dt]){var t={data:C[Do],urlString:C[M1],headers:AU({},C[MX]),timeout:C[Dl],disableXhrSync:C[MB],disableFetchKeepAlive:C[MH]},i=!1;PZ(g,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{A(t,function(e){i=!0,p||e[M0]||(e[M0]=e[M0]||C[M0],e[Dc]=e[Dc]||C[Dc]),b(e)},e.isSync||e[Ds])}catch(e){i||b(C)}})}else b(C)})},function(){return{thePayload:e,serializationStart:t,serializationCompleted:i,sendReason:n}},e[Da])}e.sizeExceed&&e.sizeExceed[Mb]>0&&ec(e.sizeExceed,8003,e[M3]),e.failedEvts&&e.failedEvts[Mb]>0&&ec(e.failedEvts,8002,e[M3])}function ei(e,t){y&&CL(e,function(e){ee(e[Dr]=e[Dr]||{},"sendEventCompleted",t)})}function en(e,t,i,r){var s=9e3,o=null,d=!1,u=!1;try{var h=!0;if(typeof e!==yD){if(t){l[MC](t[Mn]);var g=t[Mi]||t["kill-duration-seconds"];CL(a[Dd](t[Mt],g),function(e){CL(i[M2],function(t){if(t[ME]()===e){o=o||[];var n=t[MP](0);i.numEvents-=n[M_](),o[Mw](n)}})})}if(200==e||204==e){s=200;return}(!DN(e)||i.numEvents<=0)&&(h=!1),s=9e3+e%1e3}if(h){s=100;var p=i.retryCnt;0===i[M3]&&(p<n?(d=!0,ea(function(){0===i[M3]&&c--,Z(i[M2],p+1,i[Ds],b?2:i[M3],5)},b,Dx(p))):(u=!0,b&&(s=8001)))}}finally{d||(l[MC](),er(i,s,r,u)),ec(o,8004,i[M3])}}function er(t,i,n,r){try{r&&d[Du]();var s=t[M2];200===i&&(s=t.sentEvts||t[M2],r||t[Da]||d._clearBackOff(),es(s)),ec(s,i,t[M3],!0)}finally{0===t[M3]&&(c--,5!==n&&e.sendQueuedRequests(t[M3],n))}}function es(e){if(y){var t=A$();CL(e,function(e){e&&e[M_]()>0&&ei(e[MI](),t)})}}function ea(e,t,i){t?e():k.set(e,i)}function eo(e){for(var t=0;t<e.batches[Mb];t++){var i=e[M2][t].Msfpc();if(i)return encodeURIComponent(i)}return A1}function el(e){var t=D;try{for(var i=0;i<t[Mb];i++)try{t[i](e)}catch(e){Pu(u,1,519,"Response handler failed: "+e)}if(e){var n=JSON.parse(e);AD(n.webResult)&&AD(n.webResult[Mg])&&C.set("MSFPC",n.webResult[Mg],31536e3)}}catch(e){}}function ec(e,t,i,n){if(e&&e[Mb]>0&&r){var s=r[ed(t)];if(s){var a=0!==i;PZ(g,function(){return"HttpManager:_sendBatchesNotification"},function(){ea(function(){try{s.call(r,e,t,a,i)}catch(e){Pu(u,1,74,"send request notification failed: "+e)}},n||a,0)},function(){return{batches:Y(e),reason:t,isSync:a,sendSync:n,sendType:i}},!a)}}}function ed(e){var t=DQ[e];return!AD(t)&&(t=A6,e>=9e3&&e<=9999?t=A5:e>=8e3&&e<=8999?t=A2:e>=1e3&&e<=1999&&(t=A3)),t}e[MO]=function(e,t,i){O||(g=t,C=t.getCookieMgr(),u=(d=i).diagLog(),bQ(R,wQ(e,function(e){var n,r=e.cfg,a=e.cfg.extensionConfig[i.identifier];k=DG(a[Mk],a[MN]),AD(r.anonCookieName)?D2(f,"anoncknm",r.anonCookieName):D3(f,"anoncknm"),A=a[Mx],M=a.payloadListener;var o=a.httpXHROverride;s=(a[ML]?a[ML]:r.endpointUrl)+DK,T=!!Cr(a[MF])||!a[MF],y=!a[MU];var l=a.valueSanitizer,c=a[M$],d=!!r[MV];Cr(a[MV])||(d=!!a[MV]),E=a.xhrTimeout,_=!!a[MB],I=!!a[MH],P=!1!==a[Mj],N=!!a[Mq],t.getPlugin("LocalStorage")&&(I=!0),L=!I9(),S=new Dq(g,l,c,d,Ax,N),Ca(a[MW])||(L=!!a[MW]);var m=$();x?x.SetConfig(m):(x=new R$)[MO](m,u);var v=o,C=a[MG]?o:null,b=a[MG]?o:null,R=[3,2];if(!o){p=!1;var D=[];I9()?(D=[2,1],R=[2,1,3]):D=[1,2,3],(o=U(D=IM(D,a.transports),!1))||Ph(u,"No available transport to send events"),v=U(D,!0)}C||(C=U(R=IM(R,a[Mz]),!0)),w=!p&&(L&&we()||!I&&wt(!0)),(n={})[0]=o,n[1]=v||U([1,2,3],!0),n[2]=C||v||U([1],!0),n[3]=b||U([2,3],!0)||v||U([1],!0),h=n})),O=!0)},e.addResponseHandler=function(e){return D[Mw](e),{rm:function(){var t=D.indexOf(e);t>=0&&D[MR](t,1)}}},e[MJ]=function(e){try{if(S)return S.getEventBlob(e)}catch(e){}return A1},e[MK]=function(){try{var e=S&&S[MQ](0,!1,!1,!1,1,0);return X(e,T)}catch(e){}return null},e[MY]=function(e,i){try{var n=[];CL(e,function(e){i&&(e=II(e));var t=Dw.create(e[ME],[e]);n[Mw](t)});for(var r=null;n[Mb]>0&&S;){var s=n.shift();s&&s[M_]()>0&&(r=r||S[MQ](0,!1,!1,!1,1,0),S.appendPayload(r,s,t))}var a=X(r,T),o={data:r[MZ],urlString:a.url,headers:a[MM],timeout:E,disableXhrSync:_,disableFetchKeepAlive:I};return T&&(D0(o[MX],A7)||(o[MX][A7]=A8),D0(o[MX],Me)||(o[MX][Me]=A9)),o}catch(e){}return null},e._getDbgPlgTargets=function(){return[h[0],a,S,h]},e[M4]=function(e,t){m[e]=t},e.removeHeader=function(e){delete m[e]},e[M5]=function(){return J()&&l[Mm]()},e[M6]=function(e,t){Cr(e)&&(e=0),b&&(e=z(e),t=2),Q(v,e,0)&&Z(K(),0,!1,e,t||0)},e[M8]=function(){return!o&&0===c&&0===v[Mb]},e[M9]=function(e){b=e},e.addBatch=function(e){if(e&&e[M_]()>0){if(a.isTenantKilled(e[ME]()))return!1;v[Mw](e)}return!0},e.teardown=function(){v[Mb]>0&&Z(K(),0,!0,2,2),CL(R,function(e){e&&e.rm&&e.rm()}),R=[]},e.pause=function(){o=!0},e.resume=function(){o=!1,e[M6](0,4)},e[De]=function(e,t,i){e&&e[M_]()>0&&(Ca(t)&&(t=1),b&&(t=z(t),i=2),Z([e],0,!1,t,i||0))}})}return e.__ieDyn=1,e}(),D5=.25,D6=500,D8=20,D9=6,D7=2,Oe=4,Ot=2,Oi=1,On=1e4,Or="eventsDiscarded",Os="",Oa=void 0,Oo=C5({eventsLimitInMem:{isVal:AG,v:1e4},immediateEventLimit:{isVal:AG,v:500},autoFlushEventsLimit:{isVal:AG,v:0},disableAutoBatchFlushLimit:!1,httpXHROverride:{isVal:Ol,v:Oa},overrideInstrumentationKey:Oa,overrideEndpointUrl:Oa,disableTelemetry:!1,ignoreMc1Ms0CookieProcessing:!1,setTimeoutOverride:Oa,clearTimeoutOverride:Oa,payloadPreprocessor:Oa,payloadListener:Oa,disableEventTimings:Oa,valueSanitizer:Oa,stringifyObjects:Oa,enableCompoundKey:Oa,disableOptimizeObj:!1,transports:Oa,unloadTransports:Oa,useSendBeacon:Oa,disableFetchKeepAlive:Oa,avoidOptions:!1,xhrTimeout:Oa,disableXhrSync:Oa,alwaysUseXhrOverride:!1,maxEventRetryAttempts:{isVal:Cm,v:6},maxUnloadEventRetryAttempts:{isVal:Cm,v:2},addNoResponse:Oa,excludeCsMetaData:Oa});function Ol(e){return e&&e.sendPOST}var Oc=function(e){function t(){var i,n,r,s,a,o,l,c,d,u,h,g,p,f,m,v,S,y,C,b,T,E,_,I,w,P,R=e.call(this)||this;R.identifier="PostChannel",R.priority=1011,R.version="4.2.1";var A=!1,M=[],D=!1,O=0,k=0,N={},x=AZ;return Ea(t,R,function(e,t){function R(){Ad(null,C),Ah(null,C),Ap(null,C)}function L(e){var t=e[Di];e[Di]=function(){var i=0;return T&&(i|=2),i|t.call(e)}}function F(e){var t=Os;return e&&e[Mb]&&CL(e,function(e){t&&(t+="\n"),t+=e}),t}function U(e){var t=Os;try{B(e),t=d[MJ](e)}catch(e){}return t}function $(e){"beforeunload"!==(e||bL().event).type&&(v=!0,d[M9](v)),K(2,2)}function V(e){v=!1,d[M9](v)}function B(e){e.ext&&e.ext[Mp]&&delete e.ext[Mp],e.ext&&e.ext[Mf]&&e.ext[Mf].id&&delete e.ext[Mf].id,m&&(e.ext=II(e.ext),e[DC]&&(e[DC]=II(e[DC])),e[Do]&&(e[Do]=II(e[Do])))}function H(e,t){if(e[Db]||(e[Db]=0),e[DT]||(e[DT]=1),B(e),e[DE]){if(l||D)e[DT]=3,e[DE]=!1;else if(d){m&&(e=II(e)),d[De](Dw.create(e[ME],[e]),!0===e[DE]?1:e[DE],3);return}}var i=e[DT],n=k,a=s;4===i&&(n=O,a=r);var o=!1;if(n<a)o=!X(e,t);else{var c=1,u=D8;4===i&&(c=4,u=1),o=!0,ee(e[ME],e[DT],c,u)&&(o=!X(e,t))}o&&ec(Or,[e],Ec.QueueFull)}function j(e,t,i){var n=ei(e,t,i);return d[M6](t,i),n}function q(){return k>0}function W(){if(p>=0&&ei(p,0,f)&&d[M6](0,f),O>0&&!o&&!D){var e=N[x][2];e>=0&&(o=z(function(){o=null,j(4,0,1),W()},e))}var t=N[x][1];a||n||!(t>=0)||D||(q()?a=z(function(){a=null,j(0===c?3:1,0,1),c++,c%=2,W()},t):c=0)}function G(){i=null,A=!1,M=[],n=null,D=!1,O=0,r=500,k=0,s=On,N={},x=AZ,a=null,o=null,l=0,c=0,u={},h=0,I=!1,g=0,p=-1,f=null,m=!0,v=!1,S=D9,y=D7,C=null,w=null,P=!1,b=DG(),d=new D4(D6,Ot,Oi,{requeue:eo,send:eu,sent:eh,drop:eg,rspFail:ep,oth:ef}),ea(),Q(),em()}function z(e,t){0===t&&l&&(t=1);var i=1e3;return l&&(i=Dx(l-1)),b.set(e,t*i)}function J(){return null!==a&&(a.cancel(),a=null,c=0,!0)}function K(e,t){J(),n&&(n.cancel(),n=null),D||j(1,e,t)}function Q(){u[4]={batches:[],iKeyMap:{}},u[3]={batches:[],iKeyMap:{}},u[2]={batches:[],iKeyMap:{}},u[1]={batches:[],iKeyMap:{}}}function Y(e,t,i){var n=u[t];n||(n=u[t=1]);var r=n.iKeyMap[e];return!r&&i&&(r=Dw.create(e),n.batches[Mw](r),n.iKeyMap[e]=r),r}function Z(t,i){d[M5]()&&!l&&(h>0&&k>h&&(i=!0),i&&null==n&&e.flush(t,function(){},20))}function X(e,t){m&&(e=II(e));var i=e[DT],n=Y(e[ME],i,!0);return!!n.addEvent(e)&&(4!==i?(k++,t&&0===e[Db]&&Z(!e.sync,g>0&&n[M_]()>=g)):O++,!0)}function ee(e,t,i,n){for(;i<=t;){var r=Y(e,t,!0);if(r&&r[M_]()>0){var s=r[MP](0,n),a=s[M_]();if(a>0)return 4===i?O-=a:k-=a,ed(Or,[s],Ec.QueueFull),!0}i++}return et(),!1}function et(){for(var e=0,t=0,i=function(i){var n=u[i];n&&n[M2]&&CL(n[M2],function(n){4===i?e+=n[M_]():t+=n[M_]()})},n=1;n<=4;n++)i(n);k=t,O=e}function ei(t,i,n){var r=!1,s=0===i;return!s||d[M5]()?PZ(e.core,function(){return"PostChannel._queueBatches"},function(){for(var e=[],i=4;i>=t;){var n=u[i];n&&n.batches&&n.batches[Mb]>0&&(CL(n[M2],function(t){d.addBatch(t)?r=r||t&&t[M_]()>0:e=e[MT](t[MI]()),4===i?O-=t[M_]():k-=t[M_]()}),n[M2]=[],n.iKeyMap={}),i--}e[Mb]>0&&ec(Or,e,Ec.KillSwitch),r&&p>=t&&(p=-1,f=0)},function(){return{latency:t,sendType:i,sendReason:n}},!s):(p=p>=0?Math.min(p,t):t,f=Math.max(f,n)),r}function en(e,t){j(1,0,t),et(),er(function(){e&&e(),M[Mb]>0?n=z(function(){n=null,en(M.shift(),t)},0):(n=null,W())})}function er(e){d[M8]()?e():n=z(function(){n=null,er(e)},D5)}function es(){J(),ea(),x=AZ,W()}function ea(){(N={})[AZ]=[2,1,0],N[AX]=[6,3,0],N[A0]=[18,9,0]}function eo(t,i){var n=[],r=S;v&&(r=y),CL(t,function(t){t&&t[M_]()>0&&CL(t[MI](),function(t){t&&(t[DE]&&(t[DT]=4,t[DE]=!1),t[Db]<r?(Aj(t,e[Dh]),H(t,!1)):n[Mw](t))})}),n[Mb]>0&&ec(Or,n,Ec.NonRetryableStatus),v&&K(2,2)}function el(t,i){var n=_||{},r=n[t];if(r)try{r.apply(n,i)}catch(i){Pu(e.diagLog(),1,74,t+" notification failed: "+i)}}function ec(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];t&&t[Mb]>0&&el(e,[t][MT](i))}function ed(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];t&&t[Mb]>0&&CL(t,function(t){t&&t[M_]()>0&&el(e,[t.events()][MT](i))})}function eu(e,t,i){e&&e[Mb]>0&&el("eventsSendRequest",[t>=1e3&&t<=1999?t-1e3:0,!0!==i])}function eh(e,t){ed("eventsSent",e,t),W()}function eg(e,t){ed(Or,e,t>=8e3&&t<=8999?t-8e3:Ec.Unknown)}function ep(e){ed(Or,e,Ec.NonRetryableStatus),W()}function ef(e,t){ed(Or,e,Ec.Unknown),W()}function em(){g=E?0:Math.max(D6*(Ot+1),s/6)}G(),e._getDbgPlgTargets=function(){return[d,i]},e[MO]=function(n,a,o){PZ(a,function(){return"PostChannel:initialize"},function(){t[MO](n,a,o),_=a.getNotifyMgr();try{C=At(wb(e[Dh]),a.evtNamespace&&a.evtNamespace()),e._addHook(wQ(n,function(t){var n=t.cfg;i=Rl(null,n,a).getExtCfg(e[Dh],Oo),b=DG(i[Mk],i[MN]),m=!i[Dg]&&AW(),T=i[Dp],L(a),s=i[Df],r=i.immediateEventLimit,h=i[Dm],S=i.maxEventRetryAttempts,y=i.maxUnloadEventRetryAttempts,E=i[Dv],em(),w=i[DS],P=!!i[Dy],I&&R();var o=n.disablePageUnloadEvents||[];I=Ac($,o,C),I=Au($,o,C)||I,I=Ag(V,n.disablePageShowEvents,C)||I})),d[MO](n,e.core,e)}catch(t){throw e.setInitialized(!1),t}},function(){return{theConfig:n,core:a,extensions:o}})},e.processTelemetry=function(t,i){Aj(t,e[Dh]),i=i||e._getTelCtx(i);var n=t;P||A||(w&&(n[ME]=w),H(n,!0),v?K(2,2):W()),e.processNext(n,i)},e.getOfflineSupport=function(){try{var e=d&&d[MK]();if(d)return{getUrl:function(){return e?e.url:null},serialize:U,batch:F,shouldProcess:function(e){return!P},createPayload:function(e){return null},createOneDSPayload:function(e){if(d[MY])return d[MY](e,m)}}}catch(e){}return null},e._doTeardown=function(e,t){K(2,2),A=!0,d.teardown(),R(),G()},e.setEventQueueLimits=function(e,t){i[Df]=s=AG(e)?e:On,i[Dm]=h=AG(t)?t:0,em();var n=k>e;if(!n&&g>0)for(var r=1;!n&&r<=3;r++){var a=u[r];a&&a[M2]&&CL(a[M2],function(e){e&&e[M_]()>=g&&(n=!0)})}Z(!0,n)},e.pause=function(){J(),D=!0,d.pause()},e.resume=function(){D=!1,d.resume(),W()},e._loadTransmitProfiles=function(e){es(),Cx(e,function(e,t){var i=t[Mb];if(i>=2){var n=i>2?t[2]:0;if(t[MR](0,i-2),t[1]<0&&(t[0]=-1),t[1]>0&&t[0]>0){var r=t[0]/t[1];t[0]=Math.ceil(r)*t[1]}n>=0&&t[1]>=0&&n>t[1]&&(n=t[1]),t[Mw](n),N[e]=t}})},e.flush=function(e,t,i){if(void 0===e&&(e=!0),!D)if(i=i||1,e)t||(r=_H(function(e){t=e})),null==n?(J(),ei(1,0,i),n=z(function(){n=null,en(t,i)},0)):M[Mw](t);else{var r,s=J();j(1,1,i),t&&t(),s&&W()}return r},e.setMsaAuthTicket=function(e){d[M4](Mc,e)},e.setAuthPluginHeader=function(e){d[M4](Md,e)},e.removeAuthPluginHeader=function(){d.removeHeader(Md)},e.hasEvents=q,e._setTransmitProfile=function(e){x!==e&&void 0!==N[e]&&(J(),x=e,W())},I_(e,function(){return d},["addResponseHandler"]),e[Du]=function(){l<Oe&&(l++,J(),W())},e._clearBackOff=function(){l&&(l=0,J(),W())}}),R}return TO(t,e),t.__ieDyn=1,t}(Rv),Od="locale",Ou="ver",Oh="browser",Og="browserVer",Op="popSample",Of="eventFlags",Om="name",Ov="serviceName",OS=El({UserExt:[0,"user"],DeviceExt:[1,"device"],TraceExt:[2,"trace"],WebExt:[3,"web"],AppExt:[4,"app"],OSExt:[5,"os"],SdkExt:[6,"sdk"],IntWebExt:[7,"intweb"],UtcExt:[8,"utc"],LocExt:[9,"loc"],CloudExt:[10,"cloud"],DtExt:[11,"dt"]}),Oy=El({id:[0,"id"],ver:[1,Ou],appName:[2,Om],locale:[3,Od],expId:[4,"expId"],env:[5,"env"]}),OC=El({domain:[0,"domain"],browser:[1,Oh],browserVer:[2,Og],screenRes:[3,"screenRes"],userConsent:[4,"userConsent"],consentDetails:[5,"consentDetails"]}),Ob=El({locale:[0,Od],localId:[1,"localId"],id:[2,"id"]}),OT=El({osName:[0,Om],ver:[1,Ou]}),OE=El({ver:[0,Ou],seq:[1,"seq"],installId:[2,"installId"],epoch:[3,"epoch"]}),O_=El({msfpc:[0,"msfpc"],anid:[1,"anid"],serviceName:[2,Ov]}),OI=El({popSample:[0,Op],eventFlags:[1,Of]}),Ow=El({tz:[0,"tz"]}),OP=El({sessionId:[0,"sesId"]}),OR=El({localId:[0,"localId"],deviceClass:[1,"deviceClass"],make:[2,"make"],model:[3,"model"]}),OA=El({role:[0,"role"],roleInstance:[1,"roleInstance"],roleVer:[2,"roleVer"]}),OM=El({traceId:[0,"traceID"],traceName:[1,Om],parentId:[2,"parentID"]}),OD=El({traceId:[0,"traceId"],spanId:[1,"spanId"],traceFlags:[2,"traceFlags"]});function OO(){return void 0===ea&&(ea=!!ON(0)),ea}function Ok(){return OO()?ON(0):null}function ON(e){var t,i,n=null;try{var r=bD();if(!r)return null;i=new Date,(n=0===e?r.localStorage:r.sessionStorage)&&Ch(n.setItem)&&(n.setItem(i,i),t=n.getItem(i)!==i,n.removeItem(i),t&&(n=null))}catch(e){n=null}return n}function Ox(e,t,i){var n=Ok();if(null!==n)try{return n.setItem(t,i),!0}catch(t){ea=!1,Pu(e,1,504,"Browser failed write to local storage. "+t)}return!1}function OL(e,t){var i=Ok();if(null!==i)try{return i.getItem(t)}catch(t){ea=!1,Pu(e,1,503,"Browser failed read of local storage. "+t)}return null}function OF(){return this.getId()}function OU(e){this.setId(e)}var O$=function(){function e(){Ea(e,this,function(e){e.setId=function(t){e.customId=t},e.getId=function(){return Cu(e.customId)?e.customId:e.automaticId}})}return e._staticInit=function(){CJ(e.prototype,"id",{g:OF,s:OU})}(),e}(),OV="ai_session",OB=function(){function e(t,i,n){var r,s,a,o=Pl(t),l=PO(t);Ea(e,this,function(t){var c=wQ(i,function(){t.config=a=i});function d(){var e=l.get(s());if(e&&Ch(e.split))u(e);else{var i=OL(o,s());i&&u(i)}t.automaticSession.getId()||h()}function u(e){var i=t.automaticSession,n=e.split("|");n.length>0&&i.setId(n[0]);try{if(n.length>1){var r=+n[1];i.acquisitionDate=+new Date(r),i.acquisitionDate=i.acquisitionDate>0?i.acquisitionDate:0}if(n.length>2){var s=+n[2];i.renewalDate=+new Date(s),i.renewalDate=i.renewalDate>0?i.renewalDate:0}}catch(e){Pu(o,1,510,"Error parsing ai_session cookie, session will be reset: "+e)}0===i.renewalDate&&Pu(o,2,517,"AI session renewal date is 0, session will be reset.")}function h(){var e=t.automaticSession,i=new Date().getTime(),n=t.config.sessionAsGuid;!Cr(n)&&n?Cv(n)?e.setId(AF()):e.setId(AF(n)):e.setId(wf(a.idLength||22)),e.acquisitionDate=i,e.renewalDate=i,g(e.getId(),e.acquisitionDate,e.renewalDate),OO()||Pu(o,2,505,"Browser does not support local storage. Session durations will be inaccurate.")}function g(e,i,n){var a=i+t.config.sessionExpirationMs,o=n+t.config.sessionRenewalMs,c=new Date,d=[e,i,n];a<o?c.setTime(a):c.setTime(o);var u=t.config.cookieDomain||null;l.set(s(),d.join("|")+";expires="+c.toUTCString(),null,u),r=new Date().getTime()}function p(e,t,i){Ox(o,s(),[e,t,i].join("|"))}n&&n.add(c),s=function(){return t.config.namePrefix?OV+t.config.namePrefix:OV},t.automaticSession=new O$,t.update=function(){t.automaticSession.getId()||d();var i=t.automaticSession,n=t.config,s=new Date().getTime(),a=s-i.acquisitionDate>n.sessionExpirationMs,o=s-i.renewalDate>n.sessionRenewalMs;if(a||o)h();else{var l=r;(!l||s-l>e.cookieUpdateInterval)&&(i.renewalDate=s,g(i.getId(),i.acquisitionDate,i.renewalDate))}},t.backup=function(){var e=t.automaticSession;p(e.getId(),e.acquisitionDate,e.renewalDate)}})}return e.cookieUpdateInterval=6e4,e}(),OH=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function Oj(e,t){void 0===t&&(t=OH);var i=null;if(e)for(var n=e.split(","),r=0;r<n.length;r++)Oq(n[r],t)&&(i?i+=","+n[r]:i=n[r]);return i}function Oq(e,t){if(void 0===t&&(t=OH),!e||e.length<4)return!1;for(var i=!1,n=256,r=e.substring(0,3).toString().toUpperCase(),s=0;s<t.length;s++)if(t[s]+":"===r&&e.length<=n){i=!0;break}return i}function OW(){return this.getExpId()}var OG=function(){function e(t,i,n){var r,s=null,a=OH.slice(0),o="Treatments",l=null;Ea(e,this,function(e){if(p(t),bk()){var c=bN().documentElement;c&&(e.locale=c.lang)}function d(e){var t,i={},n=bN();if(n){t=n&&n.querySelectorAll("meta");for(var r=0;r<t.length;r++){var s=t[r];s.name&&0===s.name.toLowerCase().indexOf(e)&&(i[s.name.replace(e,"")]=s.content)}}return i}function u(e){e!==s&&(s=Oj(e,a))}function h(){return u(AL(r,o)),s}function g(e){return u(e),s}function p(t){var s=wQ(t,function(){r=i&&i.getCookieMgr(),e.env=(l=t||{}).env||d("awa-").env});n&&n.add(s)}e.getExpId=function(){return l.expId?g(l.expId):h()}})}return e.validateAppExpId=Oj,e._staticInit=function(){CJ(e.prototype,"expId",{g:OW})}(),e}(),Oz=function(){return function(){}}(),OJ=function(){return function(){}}();function OK(){return this.getMsfpc()}function OQ(){return this.getAnid()}var OY=function(){function e(t,i,n){var r;Ea(e,this,function(e){(function t(t){var s=wQ(t,function(){r=i&&i.getCookieMgr();var n=t||{};n.serviceName&&(e.serviceName=n.serviceName)});n&&n.add(s)})(t),e.getMsfpc=function(){return AL(r,"MSFPC")},e.getAnid=function(){return AL(r,"ANON").slice(0,34)}})}return e._staticInit=function(){var t=e.prototype;CJ(t,"msfpc",{g:OK}),CJ(t,"anid",{g:OQ})}(),e}(),OZ=function(){return function(){var e=new Date().getTimezoneOffset(),t=e%60,i=(e-t)/60,n="+";i>0&&(n="-"),i=Math.abs(i),t=Math.abs(t),this.tz=n+(i<10?"0"+i:i.toString())+":"+(t<10?"0"+t:t.toString())}}(),OX={"5.1":"XP","6.0":"Vista","6.1":"7","6.2":"8","6.3":"8.1","10.0":"10"},O0="([\\d,.]+)",O1="([\\d,_,.]+)",O2="Unknown",O3=[{r:/windows\sphone\s\d+\.\d+/i,os:"Windows Phone"},{r:/ arm;/i,os:"Windows RT"},{r:/(windows|win32)/i,os:"Windows"},{r:/(ipad|iphone|ipod)(?=.*like mac os x)/i,os:"iOS"},{r:/android/i,os:"Android"},{r:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,os:"Linux"},{r:/CrOS/i,os:"Chrome OS"},{s:"x11",os:"Unix"},{s:"blackberry",os:"BlackBerry"},{s:"symbian",os:"Symbian"},{s:"nokia",os:"Nokia"},{r:/(macintosh|mac os x)/i,os:"Mac OS X"}];function O4(e){for(var t=0;t<O3.length;t++){var i=O3[t];if(i.r&&e.match(i.r)||i.s&&-1!==e.indexOf(i.s))return i.os}return O2}function O5(e,t){return"Windows"===t?O6(e,"Windows NT"):"Android"===t?O6(e,t):"Mac OS X"===t?O8(e):"iOS"===t?O9(e):O2}function O6(e,t){var i=e.match(RegExp(t+" "+O0));return i?OX[i[1]]?OX[i[1]]:i[1]:O2}function O8(e){var t=e.match(RegExp("Mac OS X "+O1));if(t){var i=t[1].replace(/_/g,".");if(i){var n=O7(i);return n?i.split(n)[0]:i}}return O2}function O9(e){var t=e.match(RegExp("OS "+O1));if(t){var i=t[1].replace(/_/g,".");if(i){var n=O7(i);return n?i.split(n)[0]:i}}return O2}function O7(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}var ke=function(){return function(e,t){var i=this,n=null,r=null,s=null,a=null,o=function(e){s=e},l=function(e){a=e},c=function(){return s||n},d=function(){return a||r},u=wQ(e,function(){if((e||{}).populateOperatingSystemInfo){var t=bU()||{},i=e.userAgent||t.userAgent||"",s=(e.userAgentData||{}).platform||(t.userAgentData||{}).platform;if(i){var a=O4(i.toLowerCase());n=a,r=O5(i,a)}(!n||n===O2)&&Cu(s)&&(n=s)}});t&&t.add(u),CJ(i,"name",{s:o,g:c}),CJ(i,"ver",{s:l,g:d})}}(),kt="MicrosoftApplicationsTelemetryDeviceId";function ki(e,t,i,n){t?t.setProperty(i,n):e.set(i,n,31536e3)}function kn(e,t,i){return t?t.getProperty(i)||"":AL(e,i)}var kr=function(){function e(t,i,n){var r,s=0;Ea(e,this,function(e){e.seq=s,e.epoch=wg(!1).toString(),e.getSequenceId=function(){return++s};var a=wQ(t,function(t){r=i&&i.getCookieMgr();var n=t.cfg.propertyStorageOverride;if(r.isEnabled()||n){var s=kn(r,n,kt);s||(s=P0()),ki(r,n,kt,s),e.installId=s}else r.purge(kt)});n&&n.add(a)})}return e.__ieDyn=1,e}(),ks=function(){return function(e,t,i,n,r){var s=this;s.traceId=t||P1();var a=wQ(e,function(){var t=e;if(t.enableDistributedTracing&&!i&&(i=P1().substring(0,16)),s.parentId=s.parentId||i,t.enableApplicationInsightsTrace&&!n){var r=I2();r&&r.pathname&&(n=r.pathname)}s.name=s.name||n});r&&r.add(a)}}(),ka="setLocalId";function ko(){return this.getLocalId()}function kl(e){this[ka](e)}var kc=function(){function e(t,i,n,r){var s,a,o;Ea(e,this,function(l){if(u(i),"undefined"!=typeof navigator){var c=navigator;l.locale=c.userLanguage||c.language}function d(){if(!s.hashIdentifiers&&!s.dropIdentifiers){var e=AL(o,"MUID");e&&(a="t:"+e)}return a}function u(i){var c=wQ(i,function(){if(o=n&&n.getCookieMgr(),s=i,a=null,o&&o.isEnabled()&&(d(),s.enableApplicationInsightsUser)){var r=AL(o,e.userCookieName);if(r){var c=r.split(e.cookieSeparator);c.length>0&&(l.id=c[0])}if(!l.id){l.id=wf(t&&!Cr(t.idLength)?t.idLength:22);var u=IS(new Date);l.accountAcquisitionDate=u;var h=[l.id,u],g=s.cookieDomain?s.cookieDomain:void 0;o.set(e.userCookieName,h.join(e.cookieSeparator),31536e3,g)}}});r&&r.add(c)}l.getLocalId=function(){return a||d()},l[ka]=function(e){a=e}})}return e.cookieSeparator="|",e.userCookieName="ai_user",e._staticInit=function(){CJ(e.prototype,"localId",{g:ko,s:kl})}(),e}(),kd=1048576,ku=2097152,kh=4194304,kg=function(){return function(e,t){var i=this;i.popSample=100;var n=wQ(e,function(){i.eventFlags=0,e.hashIdentifiers&&(i.eventFlags=i.eventFlags|kd),e.dropIdentifiers&&(i.eventFlags=i.eventFlags|ku),e.scrubIpOnly&&(i.eventFlags=i.eventFlags|kh)});t&&t.add(n)}}(),kp=["Required","Analytics","SocialMedia","Advertising"],kf="([\\d,.]+)",km="Unknown",kv="Edg/",kS=[{ua:"OPR/",b:"Opera"},{ua:"PhantomJS",b:"PhantomJS"},{ua:"Edge",b:"Edge"},{ua:kv,b:"Edge"},{ua:"Electron",b:"Electron"},{ua:"Chrome",b:"Chrome"},{ua:"Trident",b:"MSIE"},{ua:"MSIE ",b:"MSIE"},{ua:"Firefox",b:"Firefox"},{ua:"Safari",b:"Safari"},{ua:"SkypeShell",b:"SkypeShell"}],ky=[{br:"Microsoft Edge",b:"Edge"},{br:"Google Chrome",b:"Chrome"},{br:"Opera",b:"Opera"}];function kC(e,t){return t.indexOf(e)>-1}function kb(e,t){for(var i=0;i<t.length;i++)if(e==t[i].brand)return t[i].version;return null}function kT(e){if(e){for(var t=0;t<kS.length;t++)if(kC(kS[t].ua,e))return kS[t].b}return km}function kE(e,t){return"MSIE"===t?k_(e):kI(t,e)}function k_(e){var t=e.match(RegExp("MSIE "+kf));if(t)return t[1];var i=e.match(RegExp("rv:"+kf));if(i)return i[1]}function kI(e,t){"Safari"===e?e="Version":"Edge"===e&&kC(kv,t)&&(e="Edg");var i=t.match(RegExp(e+"/"+kf));return i||"Opera"===e&&(i=t.match(RegExp("OPR/"+kf)))?i[1]:km}function kw(){var e={h:0,w:0},t=bL();return t&&t.screen&&(e.h=screen.height,e.w=screen.width),e}function kP(){return this.getUserConsent()}var kR=function(){function e(t,i,n){var r=PO(i),s=t||{},a=null,o=null,l=null,c=null,d=null,u=null,h=null;Ea(e,this,function(e){T(t);var i=I2();if(i){var g=i.hostname;g&&(e.domain="file:"===i.protocol?"local":g)}var p=kw();function f(e,t){if(Cp(t))try{for(var i=0;i<ky.length;i++){var n=kb(ky[i].br,t);if(n){d=ky[i].b,u=n;return}}}catch(e){}if(e){var r=kT(e);d=r,u=kE(e,r)}}function m(e){l=e}function v(e){c=e}function S(){return l||d}function y(){return c||u}e.screenRes=p.w+"X"+p.h,e.getUserConsent=function(){return s.userConsented||!!AL(r,s.userConsentCookieName||"MSCC")},e.getUserConsentDetails=function(){var e=null;try{var t=s.callback;if(t&&t.userConsentDetails){var i=t.userConsentDetails();if(i){e=s.disableConsentDetailsSanitize?i:{};for(var n=0;n<kp.length;n++){var r=kp[n];e[r]=i[r]||!1}}}return null!==h&&((e=e||{}).GPC_DataSharingOptIn=!!h),e?JSON.stringify(e):null}catch(e){}};var C=function(){return h},b=function(e){h=Cv(e)?e:null,s.gpcDataSharingOptIn=h};function T(e){var t=wQ(e,function(){if((s=e).populateBrowserInfo){var t=s.userAgent,i=(s.userAgentData||{}).brands;if(t!==a||i!==o){if(!t||!i||0===i.length){var n=bU();n&&(t=t||n.userAgent||"",i=i||(n.userAgentData||{}).brands)}f(t,i),a=t,o=i}}h=Cv(s.gpcDataSharingOptIn)?s.gpcDataSharingOptIn:null});n&&n.add(t)}CK(e,{userConsent:{g:e.getUserConsent},browser:{s:m,g:S},browserVer:{s:v,g:y},gpcDataSharingOptIn:{g:C,s:b}})})}return e._staticInit=function(){CJ(e.prototype,"userConsent",{g:kP})}(),e}();function kA(e,t,i,n,r){var s=t.ext[OS[e]];if(s)try{Cx(n,function(e,t){if(Cu(t)||Cm(t)||Cv(t)){var n=s[i[e]];!r&&(n||Cu(n)||Cm(n)||Cv(n))&&(t=n),s[i[e]]=t}})}catch(e){}return s}var kM=function(){function e(t,i,n,r){Ea(e,this,function(e){e.app=new OG(i,n,r),e.cloud=new Oz,e.user=new kc(t,i,n,r),e.os=new ke(i,r),e.web=new kR(i,n,r);var s=new kr(t,n,r),a=new OY(i,n,r),o=new kg(i,r);e.loc=new OZ,e.device=new OJ;var l=new OB(n,i,r);e.session=new O$;var c=void 0,d=kD(new ks(i,c,c,c,r),g()),u=!(i||{}).eventContainExtFields;function h(){var t=e.session;if(t&&Cu(t.customId))return t.customId;l.update();var i=l.automaticSession;if(i){var n=i.getId();n&&Cu(n)&&(t.automaticId=n)}return t.automaticId}function g(){var e=d;return n&&n.getTraceCtx&&(e=n.getTraceCtx(!1)||d),e}e.getTraceCtx=function(){return d},e.getSessionId=h,e.applyApplicationContext=function(t){var i,n=e.app;kA(4,t,Oy,((i={})[0]=n.id,i[1]=n.ver,i[2]=n.name,i[3]=n.locale,i[4]=n.getExpId(),i[5]=n.env,i),u)},e.applyUserContext=function(t){var i,n=e.user;kA(0,t,Ob,((i={})[1]=n.getLocalId(),i[0]=n.locale,i[2]=n.id,i),u)},e.applyWebContext=function(t){var i,n=e.web;kA(3,t,OC,((i={})[0]=n.domain,i[1]=n.browser,i[2]=n.browserVer,i[3]=n.screenRes,i[5]=n.getUserConsentDetails(),i[4]=n.getUserConsent(),i),u)},e.applyOsContext=function(t){var i,n=e.os;kA(5,t,OT,((i={})[0]=n.name,i[1]=n.ver,i),u)},e.applySdkContext=function(e){var t;kA(6,e,OE,((t={})[2]=s.installId,t[1]=s.getSequenceId(),t[3]=s.epoch,t),u)},e.applyIntWebContext=function(e){var t;kA(7,e,O_,((t={})[0]=a.getMsfpc(),t[1]=a.getAnid(),t[2]=a.serviceName,t),u)},e.applyUtcContext=function(e){var t,i=((t={})[0]=o.popSample,t);o.eventFlags>0&&(i[1]=o.eventFlags),kA(8,e,OI,i,u)},e.applyLocContext=function(t){var i;kA(9,t,Ow,((i={})[0]=e.loc.tz,i),u)},e.applySessionContext=function(e){var t;kA(4,e,OP,((t={})[0]=h(),t),u)},e.applyDeviceContext=function(t){var i,n=e.device;kA(1,t,OR,((i={})[0]=n.localId,i[2]=n.make,i[3]=n.model,i[1]=n.deviceClass,i),u)},e.applyCloudContext=function(t){var i,n=e.cloud;kA(10,t,OA,((i={})[0]=n.role,i[1]=n.roleInstance,i[2]=n.roleVer,i),u)},e.applyAITraceContext=function(e){var t;if(i.enableApplicationInsightsTrace){var n=g();n&&kA(2,e,OM,((t={})[0]=n.getTraceId(),t[1]=n.getName(),t[2]=n.getSpanId(),t),!1)}},e.applyDistributedTraceContext=function(e){var t,i=g();if(i){var n=((t={})[0]=i.getTraceId(),t[1]=i.getSpanId(),t),r=i.getTraceFlags();Ca(r)||(n[2]=r),kA(11,e,OD,n,!1)}}})}return e.__ieDyn=1,e}();function kD(e,t){var i=e||{};return{getName:function(){return i.name},setName:function(e){t&&t.setName(e),i.name=e},getTraceId:function(){return i.traceId},setTraceId:function(e){t&&t.setTraceId(e),P5(e)&&(i.traceId=e)},getSpanId:function(){return i.parentId},setSpanId:function(e){t&&t.setSpanId(e),P6(e)&&(i.parentId=e)},getTraceFlags:function(){return i.traceFlags},setTraceFlags:function(e){t&&t.setTraceFlags(e),i.traceFlags=e}}}var kO=[OS[4],OS[0],OS[3],OS[5],OS[6],OS[7],OS[8],OS[9],OS[1],OS[2],OS[11],OS[10]],kk=C5({populateBrowserInfo:!1,populateOperatingSystemInfo:!1,userAgent:w2(),userAgentData:w1({brands:eo,mobile:eo,platform:eo}),userConsentCookieName:w2(),userConsented:!1,serviceName:w2(),env:w2(),expId:w2(),sessionRenewalMs:18e5,sessionExpirationMs:864e5,sessionAsGuid:null,cookieDomain:w2(),namePrefix:w2(),enableApplicationInsightsTrace:!1,enableApplicationInsightsUser:!1,hashIdentifiers:!1,dropIdentifiers:!1,scrubIpOnly:!1,callback:w1({userConsentDetails:null}),gpcDataSharingOptIn:eo,idLength:22,enableDistributedTracing:!1,eventContainExtFields:!1}),kN=function(e){function t(){var i,n,r,s=e.call(this)||this;return s.identifier="SystemPropertiesCollector",s.priority=3,s.version="4.2.1",Ea(t,s,function(e,t){function s(){i=null,n={}}function a(t){var n=e.identifier,s=e.core;e._addHook(wQ(t,function(){r=Rl(null,t,s).getExtCfg(n,kk)})),i=new kM(t,r,s,e._unloadHooks),s&&s.setTraceCtx&&s.setTraceCtx(i.getTraceCtx())}function o(e,t){e&&Cx(e,function(e,i){t[e]||(t[e]=i)})}s(),e.initialize=function(e,i,n){t.initialize(e,i,n),a(e)},e.processTelemetry=function(t,s){Aj(t,e.identifier),s=e._getTelCtx(s);var a=t.ext=t.ext?t.ext:{};t.data=t.data?t.data:{},CL(kO,function(e){a[e]=a[e]||{}}),i&&(i.applyUtcContext(t),i.applyApplicationContext(t),i.applyUserContext(t),i.applyWebContext(t),i.applyOsContext(t),i.applySdkContext(t),i.applyIntWebContext(t),i.applyLocContext(t),i.applySessionContext(t),i.applyDeviceContext(t),r.enableApplicationInsightsTrace&&i.applyAITraceContext(t),r.enableDistributedTracing&&i.applyDistributedTraceContext(t),i.applyCloudContext(t)),CL(C3(a),function(e){0===C3(a[e]).length&&delete a[e]}),o(n,t.data),e.processNext(t,s)},e.getPropertiesContext=function(){return i},e.setProperty=function(e,t){n[e]=t},e._doTeardown=function(e,t){var n=(e||{}).core();if(n&&n.getTraceCtx&&i){var r=n.getTraceCtx(!1);r&&r===i.getTraceCtx()&&n.setTraceCtx(null)}s()},e._getDbgPlgTargets=function(){return[r]}}),s}return TO(t,e),t.__ieDyn=1,t}(Rv),kx=function(){return function(e){this._setOverride=function(t,i){e.setOverride(t,i)},this._getOverride=function(t){return e.getOverride(t)}}}(),kL=function(e){function t(t,i,n){var r=e.call(this,t)||this,s=r;s.setId=function(e){s._setOverride(Oy.id,e)},s.getId=function(){return s._getOverride(Oy.id)},s.setVer=function(e){s._setOverride(Oy.ver,e)},s.getVer=function(){return s._getOverride(Oy.ver)},s.setName=function(e){s._setOverride(Oy.appName,e)},s.getName=function(){return s._getOverride(Oy.appName)},s.setLocale=function(e){s._setOverride(Oy.locale,e)},s.getLocale=function(){return s._getOverride(Oy.locale)},s.setEnv=function(e){s._setOverride(Oy.env,e)},s.getEnv=function(){return s._getOverride(Oy.env)},s.setExpId=function(e){s._setOverride(Oy.expId,OG.validateAppExpId(e))},s.getExpId=function(){return s._getOverride(Oy.expId)};var a=wQ(i,function(){i&&(Cr(i.env)||s.setEnv(i.env),Ca(i.expId)||s.setExpId(i.expId))});return n&&n.add(a),r}return TO(t,e),t}(kx),kF=function(e){function t(t){var i=e.call(this,t)||this,n=i;return n.setRole=function(e){n._setOverride(OA.role,e)},n.getRole=function(){return n._getOverride(OA.role)},n.setRoleInstance=function(e){n._setOverride(OA.roleInstance,e)},n.getRoleInstance=function(){return n._getOverride(OA.roleInstance)},n.setRoleVer=function(e){n._setOverride(OA.roleVer,e)},n.getRoleVer=function(){return n._getOverride(OA.roleVer)},i}return TO(t,e),t}(kx),kU=function(e){function t(t){var i=e.call(this,t)||this,n=i;return n.setProperty=function(e,t){n._setOverride(e,t)},n.getProperty=function(e){return n._getOverride(e)},i}return TO(t,e),t}(kx),k$=function(e){function t(t){var i=e.call(this,t)||this,n=i;return n.setLocalId=function(e){n._setOverride(OR.localId,e)},n.getLocalId=function(){return n._getOverride(OR.localId)},n.setDeviceClass=function(e){n._setOverride(OR.deviceClass,e)},n.getDeviceClass=function(){return n._getOverride(OR.deviceClass)},n.setMake=function(e){n._setOverride(OR.make,e)},n.getMake=function(){return n._getOverride(OR.make)},n.setModel=function(e){n._setOverride(OR.model,e)},n.getModel=function(){return n._getOverride(OR.model)},i}return TO(t,e),t}(kx),kV=function(e){function t(t){var i=e.call(this,t)||this,n=i;return n.setTz=function(e){n._setOverride(Ow.tz,e)},n.getTz=function(){return n._getOverride(Ow.tz)},i}return TO(t,e),t}(kx),kB=function(e){function t(t,i,n){var r=e.call(this,t)||this,s=r,a=null;s.setOsName=function(e){s._setOverride(OT.osName,e)},s.getOsName=function(){return s._getOverride(OT.osName)},s.setVer=function(e){s._setOverride(OT.ver,e)},s.getVer=function(){return s._getOverride(OT.ver)};var o=wQ(i,function(){!a&&i.userAgent&&i.populateOperatingSystemInfo&&(a=new ke(i,n)),a&&(s.setOsName(a.name),s.setVer(a.ver))});return n&&n.add(o),r}return TO(t,e),t}(kx);function kH(e,t){if(e)for(var i=0;i<t.length;i++){var n=t[i];Ca(e[n])&&(e[n]={}),e=e[n]}return e}function kj(e,t,i){if(e&&t){var n=t.split("."),r=n[n.length-1];n.length>1&&(e=kH(e,n.slice(0,-1))),Ca(i)?Cr(e[r])||delete e[r]:e[r]=i}}var kq=function(){return function(e){var t=this,i=[];t.setOverride=function(e,t){e&&i.push({key:e,value:t})},t.hasOverride=function(e){var t=!1;return CL(i,function(i){i.key===e&&(t=!0)}),t},t.getOverride=function(e){var t;return CL(i,function(i){i.key===e&&(t=i.value)}),t},t.applyOverrides=function(t,n){if(i.length>0)try{var r=kH(t,e);CL(i,function(e){kj(r,e.key,e.value)})}catch(e){}}}}(),kW=function(e){function t(t){var i=e.call(this,t)||this,n=i;return n.setLocalId=function(e){n._setOverride(Ob.localId,e)},n.getLocalId=function(){return n._getOverride(Ob.localId)},n.setLocale=function(e){n._setOverride(Ob.locale,e)},n.getLocale=function(){return n._getOverride(Ob.locale)},n.setId=function(e){n._setOverride(Ob.id,e)},n.getId=function(){return n._getOverride(Ob.id)},i}return TO(t,e),t}(kx),kG=function(e){function t(t,i,n){var r=e.call(this,t)||this,s=r;s.setDomain=function(e){s._setOverride(OC.domain,e)},s.getDomain=function(){return s._getOverride(OC.domain)},s.setBrowser=function(e){s._setOverride(OC.browser,e)},s.getBrowser=function(){return s._getOverride(OC.browser)},s.setBrowserVer=function(e){s._setOverride(OC.browserVer,e)},s.getBrowserVer=function(){return s._getOverride(OC.browserVer)},s.setScreenRes=function(e){s._setOverride(OC.screenRes,e)},s.getScreenRes=function(){return s._getOverride(OC.screenRes)},s.setUserConsent=function(e){s._setOverride(OC.userConsent,e)},s.getUserContext=function(){return s._getOverride(OC.userConsent)};var a=wQ(i,function(){i&&!Cr(i.userConsented)&&s.setUserConsent(i.userConsented)});return n&&n.add(a),r}return TO(t,e),t}(kx),kz="ext",kJ="data",kK=function(){return function(e,t,i,n){var r=this,s={};function a(e){for(var t="",i=0;i<e.length;i++)t&&(t+="_"),t+=e[i];return(Cr(s[t])&&(s[t]=new kq(e)),t)?s[t]:null}r.data=new kU(a([kJ])),r.app=new kL(a([kz,OS.AppExt]),t,n),r.user=new kW(a([kz,OS.UserExt])),r.os=new kB(a([kz,OS.OSExt]),t,n),r.web=new kG(a([kz,OS.WebExt]),t,n),r.device=new k$(a([kz,OS.DeviceExt])),r.loc=new kV(a([kz,OS.LocExt])),r.cloud=new kF(a([kz,OS.CloudExt])),r.applyOverrides=function(e,t){var i=C3(s);i&&i.length>0&&CL(i,function(i){s[i].applyOverrides(e,t)})}}}(),kQ=void 0,kY=C5({env:kQ,expId:kQ,populateOperatingSystemInfo:!1,userAgent:kQ,userAgentData:w1({brands:kQ,mobile:kQ,platform:kQ}),userConsented:kQ}),kZ="OverridePropertiesPlugin",kX=function(e){function t(){var i=e.call(this)||this;i.identifier=kZ,i.priority=4,i.version="4.2.1";var n=null;return Ea(t,i,function(e,t){e.initialize=function(i,n,r){t.initialize(i,n,r),e._baseInit(i,n,r)},e.processTelemetry=function(t,n){Aj(t,i.identifier),n=e._getTelCtx(n);var r=e.getOverrideContext();r&&r.applyOverrides(t,n),e.processNext(t,n)},e._baseInit=function(t,r,s){n=new kK(t,i._getTelCtx().getExtCfg(i.identifier,kY),r,e._unloadHooks)},e.setProperty=function(e,t){n&&n.data.setProperty(e,t)},e.getOverrideContext=function(){return n}}),i}return TO(t,e),t.__ieDyn=1,t}(Rv),k0="_dropInst",k1=["channelConfiguration","propertyStorageOverride"];function k2(e){if(e&&Cp(e.extensionConfig)){var t=e.extensionConfig,i={};Cx(t,function(e,t){Ch(t)||Tv(e,"Symbol(")||(i[e]=t)}),e.extensionConfig=i}return e}function k3(e,t){if(t)for(var i=C3(t),n=0;n<i.length;n++){var r=i[n];Ck(e,r)||Tv(r,"Symbol(")||(e[r]=t[r])}}function k4(e,t,i){var n;return CJ(e,t,{g:function(){return Cc(i)?i:(Cp(i)?(Cp(n)||(n=[]),n.length=i.length):Cg(n)||(n={}),Cx(i,function(e,t){Tv(e,"Symbol(")||k4(n,e,t)}),n)}})}function k5(e){return e.pause&&e.teardown&&e.flush}function k6(e,t){var i=null;if(t){t.endpointUrl&&(i=t.endpointUrl);var n=(t.extensionConfig||{})[e]||{};n.overrideEndpointUrl&&(i=n.overrideEndpointUrl)}return i}var k8=C5({cookieCfg:{},channelConfiguration:w1({}),propertyConfiguration:w1({}),extensions:{rdOnly:!0,ref:!0,v:[],blkVal:!0},channels:{rdOnly:!0,ref:!0,v:[],blkVal:!0},extensionConfig:w1({}),createPerfMgr:ec,loggingLevelConsole:0}),k9=C5({propertyConfiguration:w1({}),cookieCfg:w1({}),extensions:{rdOnly:!0,ref:!0,v:[],blkVal:!0},channels:{rdOnly:!0,ref:!0,v:[],blkVal:!0},extensionConfig:w1(((el={})[kZ]=w1({}),el)),createPerfMgr:ec,loggingLevelConsole:0}),k7=function(e){function t(i,n){var r=e.call(this)||this;return Ea(t,r,function(e,t){function r(e){var t=[];return e&&CL(e,function(e){e.iKey===i&&t.push(e)}),t}function s(t){if(e[t]&&e.listeners)for(var i=0;i<e.listeners.length;i++){var n=e.listeners[i];if(n&&n[t])return!0}return!1}var a={eventsSent:function(t){if(s("eventsSent")){var i=r(t);i.length>0&&e.eventsSent(i)}},eventsDiscarded:function(t,i){if(s("eventsDiscarded")){var n=r(t);n.length>0&&e.eventsDiscarded(n,i)}},eventsSendRequest:function(t,i){s("eventsSendRequest")&&e.eventsSendRequest(t,i)},perfEvent:function(t){s("perfEvent")&&e.perfEvent(t)}};n.addNotificationListener(a)}),r}return TO(t,e),t.__ieDyn=1,t}(Pq),Ne=function(){function e(){var t,i,n,r,s,a,o,l,c,d,u,h,g,p,f=null,m=null;Ea(e,this,function(e){function v(){t=wK({},k8,null),i=[],n=null,r=null,s=[],a=[],o={},l=null,c=null,d=null,h=null,g=null,p=!1,t.cfg.loggingLevelConsole=1,u=new Pc(t.cfg),CJ(e,"sharedConfig",{g:function(){return p&&b(),t.cfg}})}function S(e,i){var n;if(void 0===i&&(i=null),e){(k5(e)?a:s).push(e);var r=e.identifier,o=t.cfg.extensionConfig;t.setDf(o,((n={})[r]={ref:!0,v:i||{}},n))}return e}function y(){var e=t.cfg,i=e.channels,n=new Oc,r=n.identifier,s=!1;c=null,d=null,CL(i,function(e){s||CL(e,function(e){if(!Ch(e)&&(S(e),e.identifier===r))return c=e,s=!0,-1})}),s||(c=S(n,e.channelConfiguration),i.length>0?bQ(i[0],c):e.channels.push([c]))}function C(e){var n=t.cfg;i=[],l=S(new kN,n.propertyConfiguration),i.push(l),n.extensions&&CL(n.extensions,function(e){Ch(e)||S(e)}),e&&CL(e,function(e){e&&!Ch(e)&&i.push(S(e))})}function b(){!n&&(p||Pu(e.diagLog(),2,520,"The Shared Manager is not yet created, the returned shared instance will be overwritten"),t.cfg.instrumentationKey=t.cfg.instrumentationKey||"_not_defined_",r=new Pq,(n=new Nt(e,e.diagLog(),r)).initialize(t.cfg,i),n.isInitialized()&&(CK((t=wD(n.config)).cfg,{channelConfiguration:{g:function(){return t.cfg.extensionConfig[c.identifier]}},propertyConfiguration:{g:function(){return t.cfg.extensionConfig[l.identifier]}}}),c&&(d=k6(c.identifier,t.cfg))),f&&n.setCookieMgr(f))}function T(i,n){var r=[],s=t.cfg,a={};if(Cx(s.extensionConfig,function(e,t){e===c.identifier||e===l.identifier||Tv(e,"Symbol(")||(e!==kZ?k4(a,e,t):(a[e]={},k3(a[e],t)))}),n){n.extensions&&n.extensions.length>0&&(r=bQ(r,n.extensions));var o=n.extensionConfig;o&&(Ck(o,c.identifier)&&C3(o).length>0&&Pu(e.diagLog(),2,511,"Instances cannot override the shared Post channel configuration, the shared will be used!"),k3(a,o))}var d={instrumentationKey:i,channels:E(n),extensions:r,extensionConfig:a};return k3(d,n),d}function E(e){var i=t.cfg,n=[[]];return i.channels&&CL(i.channels,function(e,t){Ch(e)||(n[t]=n[t]||[],n[t]=n[t].concat(e))}),e&&e.channels&&CL(e.channels,function(e,t){Ch(e)||(n[t]=n[t]||[],n[t]=n[t].concat(e))}),n}function _(e){var t=[];return i&&i.length>0&&(t=t.concat(i)),e&&e.length>0&&(t=t.concat(e)),t}function I(e,t,i,n){var r=o[e];if(r)if(r.inst&&r.inst.isInitialized())r.inst.unload(t,function(t){i&&i(e,t)},n);else{var s={reason:50,isAsync:t,flushComplete:!1};i&&i(e,s)}}v(),e.diagLog=function(){return u||(u=new Pc(t.cfg)),u},e.getCookieMgr=function(){return b(),f||n.getCookieMgr()},e.setCookieMgr=function(e){f=e,n&&n.setCookieMgr(e)},e.getPerfMgr=function(){return!g&&t&&t.cfg.enablePerfMgr&&(g=m||new PQ(e.getNotifyMgr())),g},e.setPerfMgr=function(e){m=e,g=e},e.create=function(i,r){p?Pu(e.diagLog(),2,514,"Shared Manager has already been initialized."):(t=wK(k2(i?Iw({},i):{}),k8,null),n=null,y(),C(r),p=!0)},e.getInst=function(e){return(o[e]||{}).inst},e.newInst=function(i,s,a){var l=e.getInst(i);if(l)return Pu(e.diagLog(),2,514,"Instance already exists for ["+i+"]"),l;if(b(),n.isInitialized()){var u=T(i,s);if(c){var h=k6(c.identifier,u);d&&h&&d!==h&&Pu(e.diagLog(),2,511,"The endpointUrl mismatch, shared Url ["+d+"] is different from configured ["+h+"] shared will be used!")}var g=new k7(i,r);if(l=new Nt(e,e.diagLog(),g),o[i]={iKey:i,inst:l,notifyMgr:g},l.setPerfMgr(e.getPerfMgr()),l.initialize(u,_(a)),l.isInitialized()){var p=l.config;CK(p,{propertyConfiguration:{g:function(){return p.extensionConfig[kZ]}}});try{delete p.endpointUrl,delete p.channelConfiguration,delete p.propertyStorageOverride}catch(t){Pu(e.diagLog(),2,108,"Failed to remove unused defaults!")}Cx(t.cfg,function(e,t){Ck(p,e)||Tv(e,"Symbol(")||bX(k1,e)||k4(p,e,t)})}else Pu(e.diagLog(),2,520,"Failed to initialize new instance!"),l=null,delete o[i]}return l},e.getSharedPlugin=function(e){b();var t=null,i=n.getPlugin(e);return i&&(t=i.plugin),t},e.getPropertyManager=function(){return b(),l},e.getPostChannel=function(){return b(),c},e.getNotifyMgr=function(){return h||(h=new Pq),h},e.unload=function(e,t,i){var r,s=C3(o),a=s.length+1,l={reason:50,isAsync:e,flushComplete:!1};function c(e,i){0==--a&&(v(),t&&t(i))}return e&&!t&&(r=_H(function(e){t=e})),n&&(CL(s,function(t){I(t,e,function(e,t){c(e,t)},i)}),n.isInitialized()&&(n.unload(e,function(e){c(null,l=e)},i),n=null)),c(null,l),r},e.addUnloadHook=function(e){b(),n.addUnloadHook(e)},e.addSharedPlugin=function(e,t,i,r){return b(),n.addPlugin(e,t,i,r)},e.updateCfg=function(e,t){return b(),n.updateCfg(e,t)},e.evtNamespace=function(){return b(),n.evtNamespace()},e.addUnloadCb=function(e){b(),n.addUnloadCb(e)},e.onCfgChange=function(e){return b(),n.onCfgChange(e)},e[k0]=function(e){e&&o.iKey&&delete o[e]}})}return e.__ieDyn=1,e}(),Nt=function(e){function t(i,n,r){var s,a=e.call(this)||this,o=i;return Ea(t,a,function(e,t){e.getSharedPropertyManager=function(){return o.getPropertyManager()},e.getSharedPostChannel=function(){return o.getPostChannel()},e.getOverridePropertyManager=function(){return s},e.initialize=function(i,a){PZ(e,function(){return"ApplicationInsights:initialize"},function(){var o=[s=new kX];a&&(o=o.concat(a));var l=i.propertyConfiguration||{};if(i.propertyConfiguration)try{delete i.propertyConfiguration}catch(e){i.propertyConfiguration={}}i.extensionConfig=i.extensionConfig||{},i.extensionConfig[s.identifier]=l,i=wK(i,k9,n||e.logger,!1).cfg;try{t.initialize(i,o,n,r)}catch(t){Pu(e.logger,1,514,"Failed to initialize SDK."+Cw(t))}},function(){return{config:i,extensions:a}})},e.unload=function(i,n,r){return o[k0]&&o[k0]((e.config||{}).instrumentationKey),t.unload(i,n,r)}}),a}return TO(t,e),t.__ieDyn=1,t}(AK),Ni=class{constructor(e){this.key=e.config.bwSeedOptions.localStorageKey||"bwSeed",parseInt(localStorage.getItem(this.key))||localStorage.setItem(this.key,e.config.bwSeedOptions.constValue.toString())}getSeed(){let e=parseInt(localStorage.getItem(this.key));return isNaN(e)?void 0:e}saveSeed(e){localStorage.setItem(this.key,e.toString())}static localStorageAvailable(){try{let e=window.localStorage,t="someKey",i="someValue";return e.setItem(t,i),e.removeItem(t),!0}catch(e){return!1}}},Nn=class e{constructor(t){e.value??(e.value=t.config.bwSeedOptions.constValue)}getSeed(){return e.value}saveSeed(t){e.value=t}},Nr=class{constructor(e){this.value=e}addValue(e){}getAggregated(){return this.value}},Ns=class{addValue(e){this.value=e}getAggregated(){return this.value}},Na=class{constructor(e){this.size=e,this.items=[]}clear(){this.items=[]}},No=class extends Na{get isFull(){return this.items.length>=this.size}add(e){return this.isFull&&this.items.shift(),this.items.push(e),!0}},Nl=class extends Na{add(e){return!(this.items.length>=this.size)&&(this.items.push(e),!0)}},Nc=class{constructor(e){this.values=new No(e)}addValue(e){this.values.add(e)}getAggregated(){return Math.floor(nv(this.values.items))}},Nd=class{constructor(){this.bandwidthAverager=new SL}addValue(e){this.bandwidthAverager.captureSample(e)}getAggregated(){return Math.floor(this.bandwidthAverager.avg)}},Nu=-1,Nh=class{constructor(e){this.configProvider=e,this.aggregator=this.getAggregator(),this.storage=this.getStorage(),this.cappingValue=this.configProvider.config.bwSeedOptions.cappingValue,this.minValue=this.configProvider.config.bwSeedOptions.minValue??Nu}getSeed(){let e=this.storage.getSeed()??Nu;return this.cappingValue>0?Math.min(Math.max(e,this.minValue),this.cappingValue):Math.max(e,this.minValue)}saveSeed(e){this.aggregator.addValue(e);let t=this.aggregator.getAggregated();this.storage.saveSeed(t)}getAggregator(){switch(this.configProvider.config.bwSeedOptions.aggregation){case"avg":return this.configProvider.config.bwSeedOptions.aggregateLastN>0?new Nc(this.configProvider.config.bwSeedOptions.aggregateLastN):new Nd;case"last":return new Ns;default:return new Nr(this.configProvider.config.bwSeedOptions.constValue)}}getStorage(){return this.configProvider.config.bwSeedOptions.useLocalStorage&&Ni.localStorageAvailable()?new Ni(this.configProvider):new Nn(this.configProvider)}},Ng=i(892891);function Np(e,t){let i=e.width/e.height,n=(0,Ng.clone)(e);return i>t?n.width=Math.floor(e.height*t):i<t&&(n.height=Math.floor(e.width/t)),n}var Nf=class e{constructor(e,t,i=!0,n=!1,r){this.audio=e,this.video=t,this.withTimeout=i,this.withEffect=n,this.withOverridenStream=r}clone(){let t=nw(this.video);return new e(nw(this.audio),t,this.withTimeout,this.withEffect,this.withOverridenStream)}},Nm=class{constructor(e){this.logger=e}dispose(){}updateVideoConstraints(e,t,i){let n=this.calculateConstraints(t,i);this.logger.safe.info(`Calculated constraints: ${JSON.stringify(n)} from capabilities: ${JSON.stringify(t)}`);let r=n.resolution,s=n.fps,a=r&&(!nx(r.width,e.video.minWidth,e.video.maxWidth)||!nx(r.height,e.video.minHeight,e.video.maxHeight)),o=e.video.fps!==s;if(!a&&!o)return e;let l=e.clone();return a&&this.setResolution(l,r),o&&(l.video.fps=s),l}updateResolution(e,t){let i=e.clone();return this.setResolution(i,t),i}setResolution(e,t){e.video.maxWidth=t.width,e.video.minWidth=t.width,e.video.maxHeight=t.height,e.video.minHeight=t.height}getKey(e){return e.video?nE(e.video)?"video":e.video.deviceId&&e.video.minWidth&&e.video.minHeight?`${e.video.deviceId}x${e.video.minWidth}x${e.video.minHeight}`:e.video.minWidth&&e.video.minHeight?`${e.video.minWidth}x${e.video.minHeight}`:e.video.deviceId?`${e.video.deviceId}`:(this.logger.safe.error(`Cannot create key for constraints: ${vl(e)}`),""):"audio"}convertConstraints(e,t={}){if(!e)return null;let i=nw(t);return e?.deviceId&&(i.deviceId=e.deviceId),i}},Nv=class{constructor(){this.MAX_SHARING_WIDTH=1920,this.MAX_SHARING_HEIGHT=1080}getResolutionTable(e,t){let i=this.constraintToMaxResolution(e,t);return this.generateResolutionTable(i)}constraintToMaxResolution(e,t){let i=this.getPortraitOrLandscapeMaxResolution(e),n=Np({width:e.width,height:e.height},t),r=Math.min(i.width/n.width,i.height/n.height);return this.resizeResolution(n,r)}resizeResolution(e,t){return{width:Math.round(e.width*t),height:Math.round(e.height*t)}}getPortraitOrLandscapeMaxResolution(e){return e.width>e.height?{width:this.MAX_SHARING_WIDTH,height:this.MAX_SHARING_HEIGHT}:{width:this.MAX_SHARING_HEIGHT,height:this.MAX_SHARING_WIDTH}}ceilToMackroblockSize(e){let t=e.width,i=e.height;return{width:Math.ceil(t/nu.MACROBLOCK_SIZE)*nu.MACROBLOCK_SIZE,height:Math.ceil(i/nu.MACROBLOCK_SIZE)*nu.MACROBLOCK_SIZE}}generateResolutionTable(e){return[1,2/3,1/3,1/6].map(t=>this.resizeResolution(e,t)).map(e=>this.ceilToMackroblockSize(e))}},NS=class{constructor(e){this.logger=e,this.FPS_TABLE=[15,7.5,3.75,1.875],this.resolutionTableCalculator=new Nv,this.initialAspectRatio=null}calculateConstraints(e,t){this.initialAspectRatio||(this.initialAspectRatio=t.width/t.height);let i=this.resolutionTableCalculator.getResolutionTable(t,this.initialAspectRatio),n={resolution:i[i.length-1],fps:this.FPS_TABLE[this.FPS_TABLE.length-1]};return i.some(t=>{let i=this.getFs(t);return this.FPS_TABLE.some(r=>{let s=this.getMbps(i,r);return i<=e.maxFs&&r<=e.maxFps&&s<=e.maxMbps&&(n={resolution:t,fps:r},!0)})})?this.logger.safe.info(`Calculated resolution: ${JSON.stringify(n)}`):this.logger.safe.error(`None of available resolutions are suitable: ${JSON.stringify(i)}. Fallback to: ${JSON.stringify(n)}`),n}getMbps(e,t){return e*t}getFs(e){return Math.ceil(e.width/nu.MACROBLOCK_SIZE)*Math.ceil(e.height/nu.MACROBLOCK_SIZE)}},Ny=class{constructor(e,t){this.logger=e,this.maxCapabilities=t}ensureValidity(e){this.throwIfMissing(e);let t=this.calculateMissing(e);return this.maxCapabilities&&this.applyMaxCapabilities(t),this.logger.safe.info(`Validating capabilities ${JSON.stringify(t)}`),t}throwIfMissing(e){if(!e.maxFs&&!e.maxMbps&&!e.maxFps||e.maxFs&&!e.maxMbps&&!e.maxFps||!e.maxFs&&e.maxMbps&&!e.maxFps||!e.maxFs&&!e.maxMbps&&e.maxFps)throw Error(`Missing video capabilities ${JSON.stringify(e)}`)}calculateMissing(e){let t=nI(e);return!e.maxFs&&e.maxMbps&&e.maxFps&&(t.maxFs=e.maxMbps/e.maxFps),e.maxFs&&!e.maxMbps&&e.maxFps&&(t.maxMbps=e.maxFs*e.maxFps),e.maxFs&&e.maxMbps&&!e.maxFps&&(t.maxFps=e.maxMbps/e.maxFs),t}applyMaxCapabilities(e){this.maxCapabilities.maxFs&&(e.maxFs=Math.min(e.maxFs,this.maxCapabilities.maxFs)),this.maxCapabilities.maxMbps&&(e.maxMbps=Math.min(e.maxMbps,this.maxCapabilities.maxMbps)),this.maxCapabilities.maxFps&&(e.maxFps=Math.min(e.maxFps,this.maxCapabilities.maxFps))}},NC=8160,Nb=15,NT=class extends Nm{constructor(e,t){super(e),this.initialConstraints={maxWidth:1920,minWidth:1920,maxHeight:1080,minHeight:1080,fps:15},this.maxCapabilities={maxFs:NC,maxFps:Nb},this.validator=new Ny(this.logger.createChild("CV"),this.maxCapabilities),this.constraintsCalculator=new NS(this.logger.createChild("CC")),t.config.resizeModeForSharing&&(this.initialConstraints.resizeMode=t.config.resizeModeForSharing)}createConstraintsObject(e){if(!e.sharing)throw Error(`Sharing constraints are not presented: ${JSON.stringify(e)}`);let t=this.convertConstraints(e.sharing,this.initialConstraints),i=e.audio?e.audio:null;return i?.deviceId===nu.SYSTEM_AUDIO_SOURCE_ID&&delete i.deviceId,new Nf(i,t,!1,!1,e.withOverridenStream)}generatePolicies(e){return[e]}calculateConstraints(e,t){this.logger.safe.info(`Stream resolution is ${JSON.stringify(t)}`);let i=this.validator.ensureValidity(e);return this.constraintsCalculator.calculateConstraints(i,t)}},NE=class extends NT{constructor(e,t,i){super(e,i);let n=t.screen.width/t.screen.height;n<1&&([this.initialConstraints.maxWidth,this.initialConstraints.maxHeight]=[this.initialConstraints.maxHeight,this.initialConstraints.maxWidth],[this.initialConstraints.minWidth,this.initialConstraints.minHeight]=[this.initialConstraints.minHeight,this.initialConstraints.minWidth]);let r=Np({width:this.initialConstraints.maxWidth,height:this.initialConstraints.maxHeight},n);[this.initialConstraints.maxWidth,this.initialConstraints.maxHeight]=[r.width,r.height],r=Np({width:this.initialConstraints.minWidth,height:this.initialConstraints.minHeight},n),[this.initialConstraints.minWidth,this.initialConstraints.minHeight]=[r.width,r.height]}},N_=class extends Nm{constructor(e,t){super(t),this.configProvider=e}get currentMaxFS(){return this.streamConstraintsMaxFS??this.configProvider.config.webrtcCameraOpenFs}createConstraintsObject(e){let t={};void 0!==e.audioProcessingFlags&&(is.isEngine("Chromium","ChromiumAVD")?(t.autoGainControl=!!(1&e.audioProcessingFlags),t.echoCancellation=!!(2&e.audioProcessingFlags),t.noiseSuppression=!!(4&e.audioProcessingFlags),this.configProvider.config.useGoogPrefixAudioConstraints&&(t.googAutoGainControl=!!(1&e.audioProcessingFlags),t.googAutoGainControl2=!!(1&e.audioProcessingFlags),t.googEchoCancellation=!!(2&e.audioProcessingFlags),t.googHighpassFilter=!!(4&e.audioProcessingFlags),t.googNoiseSuppression=!!(4&e.audioProcessingFlags),t.googTypingNoiseDetection=!!(4&e.audioProcessingFlags))):is.isEngine("Safari","Firefox")?(t.autoGainControl=!!(1&e.audioProcessingFlags),t.echoCancellation=!!(2&e.audioProcessingFlags),t.noiseSuppression=!!(4&e.audioProcessingFlags)):this.logger.warn(`Unsupported browser engine for audio processing flags ${is.getBrowserInfo().engine}`)),e.audio?.sampleRate&&(t.sampleRate=e.audio.sampleRate);let i=this.convertConstraints(e.audio,t);return this.streamConstraintsMaxFS=e.videoMaxFS,new Nf(i,this.convertConstraints(e.video,this.initialVideoConstraints(this.currentMaxFS)),e.withTimeout,e.withEffect,e.withOverridenStream)}calculateConstraints(e){let t=Math.min(e.maxFs,this.currentMaxFS);return{resolution:ra.Send.getResolutionByFs(t),fps:e.maxFps}}initialVideoConstraints(e){let t=ra.Send.getResolutionByFs(e);return{maxWidth:t.width,minWidth:t.width,maxHeight:t.height,minHeight:t.height,fps:this.configProvider.config.maxCameraOpenFps}}},NI=class{static getProvider(e,t,i){if("ScreenShare"===e){let e=i.createChild("SharingCP");return is.isBrowser("Safari")?new NE(e,mk,t):new NT(e,t)}return new N_(t,i.createChild("VideoCP"))}},Nw=class{constructor(e,t,i){this.error=e,this.constraints=t,this.configProvider=i,this.permissionDeniedBySystemErrorMsg=["Permission denied by system","The request is not allowed by the user agent or the platform in the current context, possibly because the user denied permission."]}getMediaError(){let e;switch(this.error.name){case"SourceUnavailableError":case"TrackStartError":case"NotReadableError":case"AbortError":e={type:nu.MEDIA_ERROR.sourceUnavailableError,detail:`media device is already used by another process: ${t$(this.error)}`};break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":e={type:nu.MEDIA_ERROR.constraintNotSatisfiedError,detail:`could not obtain constrained media stream: ${t$(this.error)}`};break;case"DevicesNotFoundError":case"NotFoundError":e=this.configProvider.config.permissionDeniedUFDWorkaround?{type:nu.MEDIA_ERROR.permissionDeniedBySystemError,detail:`no system permissions: ${t$(this.error)}`}:{type:nu.MEDIA_ERROR.devicesNotFoundError,detail:`specified device not found: ${t$(this.error)}`};break;case"NotAllowedError":e=this.permissionDeniedBySystemErrorMsg.some(e=>e===this.error.message)?{type:nu.MEDIA_ERROR.permissionDeniedBySystemError,detail:`no system permissions: ${t$(this.error)}`}:{type:nu.MEDIA_ERROR.permissionDeniedError,detail:`permission to use media device was denied: ${t$(this.error)}`};break;case"PermissionDeniedError":case"PermissionDismissedError":e={type:nu.MEDIA_ERROR.permissionDeniedError,detail:`permission to use media device was denied: ${t$(this.error)}`};break;case nu.MEDIA_ERROR.extensionNotFoundError:e={type:nu.MEDIA_ERROR.extensionNotFoundError,detail:`extension is not found: ${t$(this.error)}`};break;case nu.MEDIA_ERROR.chromeRuntimeNotDefinedError:e={type:nu.MEDIA_ERROR.chromeRuntimeNotDefinedError,detail:`chrome runtime is not defined: ${t$(this.error)}`};break;case nu.MEDIA_ERROR.sharingCancelledError:e=this.getSharingCancelledError(this.error);break;case nu.MEDIA_ERROR.mediaStreamRequestTimedOut:e={type:nu.MEDIA_ERROR.mediaStreamRequestTimedOut,detail:"Media Stream request timed out."};break;default:e=this.error.message===nu.MEDIA_ERROR.sharingCancelledError?this.getSharingCancelledError(this.error):{type:nu.MEDIA_ERROR.mediaStreamRequestError,detail:`media stream request error: ${t$(this.error)}`}}return e.isAudio=!!this.constraints.audio,e.detail+=` constraints: ${t$(vl(this.constraints))}`,e.message=e.detail,e}getSharingCancelledError(e){return{type:nu.MEDIA_ERROR.sharingCancelledError,detail:`screen sharing cancelled: ${t$(e)}`}}},NP=class{constructor(e,t){this.logger=e,this.configProvider=t}static isSupported(){return!0}getStream(e){let t=this.constraintsAdapter.toGumConstraints(e);return this.logger.safe.info(`Constraints to be applied: ${JSON.stringify(vl(t))}`),new Promise((e,i)=>{mk.navigator.getUserMedia(t,e,i)}).catch(t=>{throw new Nw(t,e,this.configProvider).getMediaError()})}applyConstraints(e,t){if(!e?.getVideoTracks()?.[0])return Promise.reject("No video tracks found");let i=e.getVideoTracks()[0];return this.applyConstraintsForTrack(i,t)}applyConstraintsForTrack(e,t){let i=this.constraintsAdapter.toTrackConstraints(t);return e.applyConstraints?(this.logger.safe.info(`Apply constraints: ${JSON.stringify(i)} on ${JSON.stringify(e.id)}`),e.applyConstraints(i).catch(e=>{throw new Nw(e,t,this.configProvider).getMediaError()})):Promise.reject("track.applyConstraints() is not supported")}},NR=class{constructor(e){this.configProvider=e}toGumConstraints(e){let t={};return e.audio&&(t.audio=nw(e.audio),t.audio.deviceId&&delete t.audio.deviceId,e.audio.deviceId&&e.audio.deviceId!==nu.MEDIA_DEVICE.defaultId&&(t.audio.deviceId=e.audio.deviceId)),e.video&&(t.video={mandatory:{}},e.video.deviceId&&(t.video.mandatory.sourceId=e.video.deviceId),e.video.minWidth&&(t.video.mandatory.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.mandatory.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.mandatory.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.mandatory.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.mandatory.maxFrameRate=e.video.fps,this.configProvider.config.setMinFpsForWebkit&&(t.video.mandatory.minFrameRate=this.configProvider.config.minCameraOpenFps,t.video.mandatory.idealFrameRate=e.video.fps)),nE(t.video.mandatory)&&delete t.video.mandatory),t}toTrackConstraints(e){let t={};return e.video&&(e.video.minWidth&&(t.width=e.video.minWidth),e.video.minHeight&&(t.height=e.video.minHeight),e.video.fps&&(t.frameRate=e.video.fps)),t}},NA=class{constructor(e){this.configProvider=e}toGumConstraints(e){let t={};if(e.audio&&(t.audio=nw(e.audio),t.audio.deviceId&&delete t.audio.deviceId,e.audio.deviceId&&e.audio.deviceId!==nu.MEDIA_DEVICE.defaultId&&(t.audio.deviceId={exact:e.audio.deviceId})),e.video)for(let i in t.video={width:{},height:{},frameRate:{}},e.video.deviceId&&(t.video.deviceId={exact:e.video.deviceId}),e.video.minWidth&&(t.video.width.min=e.video.minWidth),e.video.maxWidth&&(t.video.width.max=e.video.maxWidth),e.video.minHeight&&(t.video.height.min=e.video.minHeight),e.video.maxHeight&&(t.video.height.max=e.video.maxHeight),e.video.fps&&(t.video.frameRate.max=e.video.fps,t.video.frameRate.min=this.configProvider.config.minCameraOpenFps,t.video.frameRate.ideal=e.video.fps),t.video)nE(t.video[i])&&delete t.video[i];return t}toTrackConstraints(e){let t={};return e.video&&(e.video.minWidth&&(t.width=e.video.minWidth),e.video.minHeight&&(t.height=e.video.minHeight),e.video.fps&&(t.frameRate=e.video.fps)),t}},NM=class{toGumConstraints(e){if(!e?.video)throw Error(`constraints cannot be applied: ${e}`);let t={video:{}},i=e.video.deviceId&&e.video.deviceId!==nu.DISPLAY_SOURCE_ID;return e.video.resizeMode&&(t.video.resizeMode=e.video.resizeMode),i&&(t.video.deviceId={exact:e.video.deviceId}),e.video.maxWidth&&(t.video.width={max:e.video.maxWidth},i&&(t.video.width.ideal=e.video.maxWidth)),e.video.maxHeight&&(t.video.height={max:e.video.maxHeight},i&&(t.video.height.ideal=e.video.maxHeight)),e.video.fps&&(t.video.frameRate=e.video.fps),e.audio&&(t.audio=!e.audio.deviceId||{deviceId:{exact:e.audio.deviceId}}),t}toTrackConstraints(e){let t=navigator.mediaDevices.getSupportedConstraints();if(!t)throw Error("Constraints are not supported by browser");let i={};return t.width&&e.video.minWidth&&(i.width=e.video.minWidth),t.height&&e.video.minHeight&&(i.height=e.video.minHeight),t.frameRate&&e.video.fps&&(i.frameRate=e.video.fps),i.resizeMode=e.video.resizeMode,i}},ND=class extends NP{constructor(e,t){if(super(t.createChild("WebRTCProvider"),e),this.timeoutId=null,void 0!==navigator.webkitGetUserMedia&&void 0!==webkitRTCPeerConnection&&mA())if(this.configProvider.config.overrideGumFromWebkit&&mw)this.logger.safe.info("Overriding getUserMedia from webkit"),mO();else{this.constraintsAdapter=new NR(e);return}this.constraintsAdapter=new NA(e)}getStream(e){return e.withTimeout&&this.configProvider.config.gumRequestTimeout?Promise.race([this.startGumRequestTimer(e),super.getStream(e).then(t=>{if(!this.timeoutId)throw this.stopStreamAfterTimeout(t,e),this.getMediaStreamTimeoutError(e);return this.stopGumRequestTimer(),t})]).catch(e=>{throw this.stopGumRequestTimer(),e}):super.getStream(e)}getMediaStreamTimeoutError(e){return new Nw({name:nu.MEDIA_ERROR.mediaStreamRequestTimedOut,message:`Media stream request timed out. Constraints: ${t$(vl(e))}`},e,this.configProvider).getMediaError()}startGumRequestTimer(e){return new Promise((t,i)=>{this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,i(this.getMediaStreamTimeoutError(e))},this.configProvider.config.gumRequestTimeout)})}stopGumRequestTimer(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}stopStreamAfterTimeout(e,t){this.logger.safe.info(`Stopping media stream acquired after timeout: ${JSON.stringify(e.id)} with constraints: ${JSON.stringify(t)}`);try{e.getTracks().forEach(e=>{this.logger.safe.info(`Track is stopped: ${JSON.stringify(e.id)}`),e.stop()}),this.logger.safe.info(`Media stream stopped: ${e.id}`)}catch(e){this.logger.safe.warn(`Failed to stop media stream: ${t$(e)}`)}}},NO=class extends NP{constructor(e,t){super(e.createChild("WebRTCDispProvider"),t),this.constraintsAdapter=new NM}static isSupported(){return!!window.navigator.mediaDevices.getDisplayMedia}getStream(e){let t=this.constraintsAdapter.toGumConstraints(e);return this.logger.safe.info(`Constraints to be used: ${JSON.stringify(t)}`),Promise.resolve().then(()=>e.video?.deviceId&&e.video?.deviceId!==nu.DISPLAY_SOURCE_ID?mk.navigator.mediaDevices.getUserMedia(t):mk.navigator.mediaDevices.getDisplayMedia(t)).catch(t=>{throw new Nw(t,e,this.configProvider).getMediaError()})}},Nk=class{constructor(e){this.detail=e}getStream(e){throw this.getError(e)}applyConstraints(e,t){throw this.getError(t)}applyConstraintsForTrack(e,t){throw this.getError(t)}getError(e){return{type:nu.MEDIA_ERROR.unsupportedStream,detail:this.detail,message:this.detail,isAudio:!!e.audio}}},NN=class{static getStreamProvider(e,t,i){return"ScreenShare"===e?NO.isSupported()?new NO(i,t):(i.error("GUM stream provider cannot be created for display stream"),new Nk("Sharing not supported")):new ND(t,i)}},Nx=[30,15,7.5,3.75,1.875];function NL(e){return e?.getVideoTracks?.()[0]?NF(e.getVideoTracks()[0]):null}function NF(e){let t=e?.getSettings?.();return t?{width:t.width,height:t.height}:null}function NU(e){return e?.getVideoTracks?.()[0]?N$(e.getVideoTracks()[0]):0}function N$(e){let t=e?.getSettings?.();return t?nN(Nx,t.frameRate,!0):0}var NV=class extends no{constructor(e,t,i,n,r,s,a){super(a),this.id=e,this.masterStream=t,this.currentConstraints=i,this.constraintsProvider=n,this.streamProvider=r,this.configProvider=s,this._isDisposed=!1,this.masterStreamSubscriptions=[],this.mixerSubscriptions=[],this.parentId=t.id,this.logger=a.createChild(`C:${this.parentId}:${this.id}`),this.subscribeOnMasterStreamEvents()}get rawTrack(){return this.mediaTrack}get rawStream(){return!this.rawMediaStream&&(this.rawMediaStream=new MediaStream([this.mediaTrack]),this.configProvider.config.reassignMediaStreamAudioTrackAfterCreation&&this.rawMediaStream.getAudioTracks().length>0&&(this.rawMediaStream.removeTrack(this.rawMediaStream.getAudioTracks()[0]),this.rawMediaStream.addTrack(this.mediaTrack))),this.rawMediaStream}get deviceId(){return this.masterStream.deviceId}get mediaType(){return this.masterStream.mediaType}get originalMediaStream(){return this.masterStream.getOriginalMediaStream()}getCurrentConstraints(){return this.currentConstraints}getMasterStream(){return this.masterStream}dispose(e){this._isDisposed||(this._isDisposed=!0,this.logger.safe.info(`dispose: ${e}`),this.logger=this.logger.createChild("DISPOSED"),this.event("onStreamClientDisposing").raise(this),this.mediaTrack&&(this.unsubscribeFromMediaTrackEvents(),this.mediaTrack=null),this.masterStream&&(this.unsubscribeFromMasterStreamEvents(),this.masterStream.disposeClient(this),this.masterStream=null),this.unsubscribeFromMixerTrackEvents(),super.dispose(),this.event("onStreamClientDisposed").raise(this))}async applyCapabilities(e){if(!this.mediaTrack)return!1;let t=this.constraintsProvider.updateVideoConstraints(this.currentConstraints,e,this.getResolution());if(!t||!this.configProvider.config.recoverOnStreamUnmute&&this.currentConstraints===t)return!1;let i=async e=>{try{return await this.streamProvider.applyConstraintsForTrack(this.mediaTrack,t),this.currentConstraints=t,!0}catch(t){if(e)throw this.logger.safe.error(`Apply constraints error: ${JSON.stringify(t)}`),t;return this.logger.safe.warn(`Apply constraints failed and will be re-tried, error ${JSON.stringify(t)}`),!1}},n=this.currentConstraints.withEffect&&this.configProvider.config.effectsApplyConstraintsRetryMs;return!await i(!n)&&n&&(await iI(this.configProvider.config.effectsApplyConstraintsRetryMs),await i(!0)),!0}start(){return this.masterStream.start()}clone(e){return this.masterStream||this.logger.safe.error(`clone: master stream is null, reason: ${e}`),this.masterStream.getClient(`streamclient: ${e}`)}setMuted(e,t){this.isMuted=e,this.applyState(t)}setHold(e,t){this.isHold=e,this.applyState(t)}isSameStream(e){return this.parentId===e.parentId}getResolution(){if(!["Video","ScreenShare","PanoramicVideo"].some(e=>e===this.mediaType))return null;let e={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},t=NF(this.mediaTrack),i=t?.width?t:e,n=`Track resolution is ${i.width}x${i.height}.`;return t?.width?this.logger.safe.info(n):this.logger.safe.error(`${n}. Resolution not found, assuming default resolution.'`),i}getFrameRate(){if(!["Video","ScreenShare","PanoramicVideo"].some(e=>e===this.mediaType))return null;let e=N$(this.mediaTrack);return 0===e?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info(`Stream fps is ${e}`),e}update(e){return e?this.mediaTrack?void this.logger.safe.error(`Media track is already created: ${this.mediaTrack.id}`):void(this.mediaTrack=this.getTrackByMediaType(e,this.mediaType),this.updateTrackConstraints(),this.subscribeOnMediaTrackEvents(this.mediaTrack),this.hasMasterAudio=e&&e.getAudioTracks().length>0,this.hasMasterVideo=e&&e.getVideoTracks().length>0,this.hasMasterAudio&&this.hasMasterVideo&&(this.rawMediaStream=e),this.logger.safe.info(`Updated: ${vh(e)}`)):void this.logger.safe.error("No master media stream, skipping update")}resetEffectsOutputConstraints(e){this.masterStream.resetEffectsOutputConstraints(e)}async updateTrackConstraints(){if("ScreenShare"!==this.mediaType)return;let e=this.masterStream.getResolution();if(e){let t=this.currentConstraints.clone();t.video.maxWidth=e.width,t.video.minWidth=e.width,t.video.maxHeight=e.height,t.video.minHeight=e.height;try{await this.streamProvider.applyConstraintsForTrack(this.mediaTrack,t),this.currentConstraints=t}catch(e){this.logger.safe.error(`Apply constraints error: ${JSON.stringify(e)}`)}}}getTrackByMediaType(e,t){return"Audio"===t?e.getAudioTracks()[0]:e.getVideoTracks()[0]}applyState(e){this.mediaTrack?.enabled!==void 0&&(this.mediaTrack.enabled=!this.isMuted&&!this.isHold,this.logger.safe.info(`[${e}] Track ${JSON.stringify(this.mediaTrack.id)} enabled state set to => ${this.mediaTrack.enabled}`))}subscribeOnMediaTrackEvents(e){e.onended=t=>{this.logger.safe.info(`Track ${e.id} ended: ${JSON.stringify(t)}`),this.event("onStreamClientEnded").raise(this,t)},e.onmute=()=>{this.logger.safe.info(`Track ${e.id} muted`),this.event("onStreamClientMuted").raise(this,!0)},e.onunmute=()=>{this.logger.safe.info(`Track ${e.id} unmuted`),this.event("onStreamClientMuted").raise(this,!1)}}unsubscribeFromMediaTrackEvents(){this.mediaTrack.onended=null,this.mediaTrack.onmute=null,this.mediaTrack.onunmute=null}unsubscribeFromMixerTrackEvents(){this.mixerSubscriptions.forEach(e=>e.dispose()),this.mixerSubscriptions=[]}subscribeOnMasterStreamEvents(){this.masterStreamSubscriptions.push(this.masterStream.on("onStreamStarted",(e,t)=>this.event("onStreamClientStarted").raise(this,t)),this.masterStream.on("onStreamError",(e,t)=>this.event("onStreamClientError").raise(this,t)),this.masterStream.on("onStreamTrackMuted",(e,t)=>this.event("onStreamClientMuted").raise(this,t)),this.masterStream.on("onStreamDisposing",e=>this.dispose()),this.masterStream.on("onStreamQualityChanged",(e,t,i,n)=>this.event("onStreamQualityChanged").raise(this,t,i,n)),this.masterStream.on("onStreamTrackEnded",(e,t)=>this.event("onStreamClientEnded").raise(this,t)))}unsubscribeFromMasterStreamEvents(){this.masterStreamSubscriptions.forEach(e=>e.dispose()),this.masterStreamSubscriptions=[]}hasAudio(){return this.hasMasterAudio}hasVideo(){return this.hasMasterVideo}isActive(){return this.mediaTrack?.enabled&&!this.mediaTrack?.muted&&this.mediaTrack?.readyState==="live"}onVideoStreamQualityChanged(e,t,i){this.logger.safe.debug(`onStreamQualityChanged: ${JSON.stringify(e)}@${t}, reason=${i}`),this.masterStream.onVideoStreamQualityChanged(e,t,i)}isDisposed(){return this._isDisposed}},NB=class extends no{constructor(e,t,i,n,r,s){super(s),this.stream=e,this.constraints=t,this.constraintsProvider=i,this.gumStreamProvider=n,this.configProvider=r,this.logger=s,this.clients=[],this.streams=[],this.clientId=0,this.mediaStreamSubscription=this.stream.on("onStreamAcquired",()=>this.onStreamAcquired())}getClient(){let e=new NV(this.clientId++,this.stream,this.constraints,this.constraintsProvider,this.gumStreamProvider,this.configProvider,this.logger);return this.addClient(e),e}disposeClient(e){this.removeClient(e),this.clients.length||this.event("onAllClientsDisposed").raise()}dispose(){this.mediaStreamSubscription.dispose(),this.clients.length&&this.logger.safe.error(`Not all clients are disposed! ${JSON.stringify(this.clients.map(e=>e.id))}`),this.streams.forEach(e=>this.disposeStream(e)),super.dispose()}getOrCreateStream(){let e=this.streams.length?this.streams[this.streams.length-1]:this.stream.rawStream;if(!e)return null;let t=e.clone();return this.logger.safe.info(`Cloned: ${vh(e)} -> ${vh(t)}`),this.resetStream(t),this.streams.push(t),t}addClient(e){this.updateClient(e),this.clients.push(e)}updateClient(e){let t=this.getOrCreateStream();t&&e.update(t)}removeClient(e){let t=this.clients.indexOf(e);this.clients.splice(t,1)}addStream(){this.clients.forEach(e=>this.updateClient(e))}disposeStream(e){e.getTracks().forEach(e=>{this.logger.safe.info(`Stopping track: ${JSON.stringify(e.id)}`),e.stop()})}onStreamAcquired(){this.addStream()}resetStream(e){e.getTracks().forEach(e=>{this.logger.safe.info(`Resetting state for track: ${e.id}`),e.enabled=!0})}},NH=class{constructor(){}getPolicies(e){if(e.audio&&!e.video&&this.hasAudioProcessingConstraints(e))return[e,new Nf({deviceId:e.audio.deviceId},null)];if(!e.video)return[e];let t=this.getSuitableResolutions(e).map(t=>this.getConstraintsForResolution(e,t)),i=new Nf(e.audio,{deviceId:e.video.deviceId},e.withTimeout);return t.push(i),t}getSuitableResolutions(e){return ra.Send.getResolutions().filter(t=>t.width<=e.video.maxWidth&&t.height<=e.video.maxHeight).reverse()}getConstraintsForResolution(e,t){let i=e.clone();return i.video.minWidth=t.width,i.video.minHeight=t.height,i}hasAudioProcessingConstraints(e){let t=e&&e.audio;return t&&(void 0!==t.echoCancellation||void 0!==t.autoGainControl||void 0!==t.noiseSuppression)}},Nj=class{static getStrategy(e,t,i,n,r,s){return s?new Nz(i,n):"Video"===e?new NG(t,i,n,r):new NW(t,i,n)}},Nq=class{constructor(e,t,i){this.gumStreamProvider=e,this.serialQueue=t,this.logger=i}getStream(e){return this.logger.safe.info(`Requesting stream with constraints: ${JSON.stringify(vl(e))}`),this.serialQueue.add(()=>this.request(e))}},NW=class extends Nq{constructor(e,t,i){super(e,t,i.createChild("SimpleStrat"))}request(e){return this.gumStreamProvider.getStream(e)}},NG=class extends Nq{constructor(e,t,i,n){super(e,t,i.createChild("MultStrat")),this.policyGenerator=new NH}request(e){let t=this.policyGenerator.getPolicies(e);return this.makeRequests(t)}makeRequests(e){let t=e[0];return this.logger.safe.info(`Requesting media stream with policy: ${JSON.stringify(t)}`),this.makeRequestWithPolicy(t).catch(t=>{let i=e.slice(1);if(i.length&&nu.MEDIA_ERROR.constraintNotSatisfiedError===t.type)return this.logger.safe.warn("Could not obtain constrained media stream, will attempt weaker policy"),this.makeRequests(i);throw t})}makeRequestWithPolicy(e){return this.gumStreamProvider.getStream(e)}},Nz=class extends Nq{constructor(e,t){super(null,e,t.createChild("WithOveriddenStreamStart"))}request(e){return new Promise((t,i)=>t(e.withOverridenStream))}},NJ=class e extends no{constructor(t,i,n,r,s){super(r),this.serialQueue=i,this.configProvider=n,this.effectManager=s,this.gumRequestTime=0,this.id=e.streamId++,this.logger=r.createChild(`MediaStream:${this.id}`),this.mediaType=this.getMediaType(t),this.initialize(t)}get rawStream(){return this.mediaStream}get deviceId(){return this.originalMediaStream?this.originalMediaStream.getTracks()?.[0]?.getSettings?.()?.deviceId:null}start(){return this.mediaStreamStartPromise||(this.mediaStreamStartPromise=this.startStream(this.currentConstraints)),this.mediaStreamStartPromise}dispose(e){this.event("onStreamDisposing").raise(this),this.stopMediaStream(e).catch(e=>{this.event("onStreamError").raise(this,e)}).finally(()=>{this.constraintsProvider=null,this.serialQueue=null,this.configProvider=null,this.logger=this.logger.createChild("DISPOSED"),this.clientGenerationStrategy.dispose(),this.event("onStreamDisposed").raise(this),super.dispose()})}disposeClient(e){this.clientGenerationStrategy.disposeClient(e)}getClient(e){return this.logger.safe.debug(`getClient: ${e}`),this.clientGenerationStrategy.getClient()}getOriginalMediaStream(){return this.originalMediaStream}getResolution(){if(!["Video","ScreenShare","PanoramicVideo"].some(e=>e===this.mediaType))return null;let e={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},t=NL(this.mediaStream),i=t??e,n=`Stream resolution is ${i.width}x${i.height}.`;return t?this.logger.safe.info(n):this.logger.safe.error(`${n}. Resolution not found, assuming default resolution.'`),i}getFrameRate(){if(!["Video","ScreenShare","PanoramicVideo"].some(e=>e===this.mediaType))return null;let e=NU(this.mediaStream);return 0===e?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info(`Stream fps is ${e}`),e}getMediaType(e){if(e.sharing)return"ScreenShare";if(e.video)return"Video";if(e.audio)return"Audio";throw Error(`Media type is not defined: ${JSON.stringify(e)}`)}resetEffectsOutputConstraints(e){let t=NL(this.originalMediaStream);this.effectManager.resetOutputConstraints("Video",{width:Math.min(e.width,t.width||Number.MAX_SAFE_INTEGER),height:Math.min(e.height,t.height||Number.MAX_SAFE_INTEGER)})}initialize(e){this.constraintsProvider=NI.getProvider(this.mediaType,this.configProvider,this.logger),this.currentConstraints=this.constraintsProvider.createConstraintsObject(e),this.gumStreamProvider=NN.getStreamProvider(this.mediaType,this.configProvider,this.logger),this.mediaStreamRequestStrategy=Nj.getStrategy(this.mediaType,this.gumStreamProvider,this.serialQueue,this.logger,this.configProvider,!!this.currentConstraints.withOverridenStream),this.clientGenerationStrategy=new NB(this,this.currentConstraints,this.constraintsProvider,this.gumStreamProvider,this.configProvider,this.logger),this.clientGenerationStrategy.on("onAllClientsDisposed",()=>this.onAllClientsDisposed())}onAllClientsDisposed(){this.logger.safe.info("All clients are disposed, disposing master stream"),this.dispose()}async startStream(e){try{await this.getOrCreateMediaStream(e),this.event("onStreamStarted").raise(this,this.currentConstraints)}catch(e){throw this.event("onStreamError").raise(this,e),e}}async getOrCreateMediaStream(e){if(this.mediaStream)return Promise.resolve();let t=this.getRequestStartTimestamp(),i=await this.mediaStreamRequestStrategy.getStream(e);return this.gumRequestTime=this.getRequestDuration(t),this.handleMediaStreamRequestSuccess(i,e)}async handleMediaStreamRequestSuccess(e,t){this.logger.safe.info(`Media stream acquired: ${vh(e)} with constraints: ${JSON.stringify(vl(t))}`),this.originalMediaStream=e,this.subscribeToTrackEvents(this.originalMediaStream),this.currentConstraints=t,this.mediaStream=await this.applyEffects(e),this.applyState(this.mediaStream),this.event("onStreamAcquired").raise(this,this.gumRequestTime,"Audio"!==this.mediaType&&this.getResolution()||void 0)}async applyEffects(e){switch(this.mediaType){case"Video":return this.getVideoEffectStream(e);case"Audio":return this.startNoiseSuppression(e);case"ScreenShare":return this.delayScreenShare(e)}return e}async delayScreenShare(e){return this.configProvider.config.useDelayedScreenShareStream?this.effectManager.startEffect("ScreenShare",e):e}async startNoiseSuppression(e){return this.configProvider.config.applyAudioEffectOnDemand&&!this.currentConstraints.withEffect?e:(this.logger.safe.info(`ECS keys for wasmvqe are: ${JSON.stringify(this.configProvider.config.wasmvqe)}`),this.logger.safe.info(`ECS keys for wasmdns are: ${JSON.stringify(this.configProvider.config.wasmdns)}`),await this.effectManager.startEffect("Audio",e))}async getVideoEffectStream(e){if(!this.currentConstraints.withEffect||this.currentConstraints.withOverridenStream&&this.configProvider.config.useRawMediaApiForVideoEffects)return e;this.sub=this.effectManager.on("onVideoStreamQualityChanged",(e,t,i)=>this.onVideoStreamQualityChanged(e,t,i));let t=await this.effectManager.startEffect("Video",e);return this.logger.safe.info(`Media stream switched: ${vh(e)} -> ${vh(t)}`),t}subscribeToTrackEvents(e){let t=e?this.getTrackByMediaType(e,this.mediaType):null;t&&(t.onended=e=>{this.logger.safe.info(`Track ${t.id} ended: ${JSON.stringify(e)}`),this.event("onStreamTrackEnded").raise(this,e)},t.onmute=()=>{this.logger.safe.info(`Track ${t.id} muted`),this.event("onStreamTrackMuted").raise(this,!0)},t.onunmute=()=>{this.logger.safe.info(`Track ${t.id} unmute`),this.event("onStreamTrackMuted").raise(this,!1)})}unsubscribeFromTrackEvents(e){let t=e?this.getTrackByMediaType(e,this.mediaType):null;t&&(t.onended=null,t.onmute=null,t.onunmute=null)}getTrackByMediaType(e,t){return"Audio"===t?e.getAudioTracks()[0]:e.getVideoTracks()[0]}removeVideoEffectStream(){this.sub?.dispose(),this.effectManager.stopEffect("Video",this.mediaStream)}applyState(e){e.getAudioTracks()?.forEach(e=>this.applyAudioState(e));let t=e.getVideoTracks()[0];this.applyVideoState(t)}applyAudioState(e){e&&(this.hasNonDefaultAudioProcessingConstraints()||"ScreenShare"===this.mediaType?this.applyContentHint(e,"music"):this.configProvider.config.defaultAudioContentHint&&this.applyContentHint(e,this.configProvider.config.defaultAudioContentHint),e.muted&&this.event("onStreamTrackMuted").raise(this,!0),this.logger.safe.info(`Audio track added: ${JSON.stringify(e.id)}`))}applyVideoState(e){e&&("ScreenShare"===this.mediaType&&this.configProvider.config.webrtcDisplayStreamContentHint&&this.applyContentHint(e,this.configProvider.config.webrtcDisplayStreamContentHint),this.logger.safe.info(`Video track added: ${JSON.stringify(e.id)}`))}applyContentHint(e,t){this.logger.safe.info(`Apply content hint: ${t}`),e.contentHint=t}hasNonDefaultAudioProcessingConstraints(){let e=this.currentConstraints.audio;if(e){let t,i=this.configProvider.config.defaultAudioProcessingFlags;return(void 0!==e.echoCancellation||void 0!==e.autoGainControl||void 0!==e.noiseSuppression)&&(t=0,void 0!==e.echoCancellation&&(t+=2*!!e.echoCancellation),void 0!==e.autoGainControl&&(t+=+!!e.autoGainControl),void 0!==e.noiseSuppression&&(t+=4*!!e.noiseSuppression)),t!==i}return!1}getRequestStartTimestamp(){return Date.now()}getRequestDuration(e){return 0===e?0:Date.now()-e}stopMediaStream(e){return this.mediaStreamStartPromise?(this.logger.safe.info(`Queueing media stream stop: ${e}`),this.serialQueue.add(()=>this.stopMediaStreamInternal())):Promise.resolve()}stopOneMediaStream(e){try{e.getTracks().forEach(e=>{this.logger.safe.info(`Track is stopped: ${JSON.stringify(e.id)}`),e.stop()}),this.logger.safe.info(`Media stream stopped: ${e.id}`)}catch(e){this.logger.safe.warn(`Failed to stop media stream: ${t$(e)}`)}}stopMediaStreamInternal(){"Video"===this.mediaType&&this.configProvider.config.enableVideoEffects&&this.removeVideoEffectStream(),this.mediaStream&&(this.stopOneMediaStream(this.mediaStream),this.mediaStream=null),this.originalMediaStream&&(this.stopOneMediaStream(this.originalMediaStream),this.unsubscribeFromTrackEvents(this.originalMediaStream),this.originalMediaStream=null)}onVideoStreamQualityChanged(e,t,i){this.logger.safe.debug(`onStreamQualityChanged: ${JSON.stringify(e)}@${t}, reason=${i}`),this.event("onStreamQualityChanged").raise(this,e,t,i)}};NJ.streamId=0;var NK=NJ,NQ=class{static getStrategy(e){switch(e.config.diagnostics.performanceMonitoring.monitoringStrategy){case"decodeTime":default:return new NY(e);case"renderedFps":return new NZ(e);case"rendererVolatility":return new NX(e)}}},NY=class{constructor(e){this.configProvider=e,this.decodeThresholds=this.configProvider.config.diagnostics.performanceMonitoring.decodeThresholds,this.defaultThreshold=this.configProvider.config.diagnostics.performanceMonitoring.defaultThrehold,this.badPerfCount=new Map}checkQuality(e){let t=!1,i=!1,n=ra.Recv.getResolutionRecord(Math.min(e.frameHeight,e.frameWidth)).height,r=this.decodeThresholds[n]||this.defaultThreshold,s=e.decodeTimeTracker.getReport();return(s.median>r.maxDecodeTime&&(this.badPerfCount.set(e.msi,this.badPerfCount.get(e.msi)||1),t=!0),s.median<r.maxDecodeTime&&this.badPerfCount.get(e.msi)&&(this.badPerfCount.set(e.msi,this.badPerfCount.get(e.msi)-1),i=!0),t)?0:i?2:1}},NZ=class{constructor(e){this.configProvider=e,this.fpsDiffThresholds=this.configProvider.config.diagnostics.performanceMonitoring.fpsDiffThresholds,this.defaultFpsDiffThreshold=this.configProvider.config.diagnostics.performanceMonitoring.defaultFpsDiffThreshold,this.badPerfCount=new Map}checkQuality(e){let t=!1,i=!1,n=ra.Recv.getResolutionRecord(Math.min(e.frameHeight,e.frameWidth)).height,r=this.fpsDiffThresholds[n]||this.defaultFpsDiffThreshold,s=e.incomingFps.getReport(),a=e.rendererFps.getReport(),o=s.median-a.median;return(o>=r.fpsDiff&&(this.badPerfCount.set(e.msi,this.badPerfCount.get(e.msi)||1),t=!0),o<r.fpsDiff&&this.badPerfCount.get(e.msi)&&(this.badPerfCount.set(e.msi,this.badPerfCount.get(e.msi)-1),i=!0),t)?0:i?2:1}},NX=class{constructor(e){this.configProvider=e,this.volatilityThresholds=this.configProvider.config.diagnostics.performanceMonitoring.volatilityThresholds,this.defaultVolatilityThreshold=this.configProvider.config.diagnostics.performanceMonitoring.defaultVolatilityThreshold,this.badPerfCount=new Map}checkQuality(e){let t=!1,i=!1,n=ra.Recv.getResolutionRecord(Math.min(e.frameHeight,e.frameWidth)).height,r=this.volatilityThresholds[n]||this.defaultVolatilityThreshold,s=e.rendererFps.getReport(),a=e.incomingFps.getReport(),o=Math.abs(s.volatilityPercent-a.volatilityPercent);return(r&&o>=r&&(this.badPerfCount.set(e.msi,this.badPerfCount.get(e.msi)||1),t=!0),o<r&&this.badPerfCount.get(e.msi)&&(this.badPerfCount.set(e.msi,this.badPerfCount.get(e.msi)-1),i=!0),t)?0:i?2:1}},N0=class{constructor(e,t){this.streamClient=e,this.logger=t,this.rawBaseClient=new fO(e=>this.getStream(e),()=>this.activeRawInputMediaStreamClient?.dispose(),t)}client(){return this.rawBaseClient}disposeActiveMediaStreamClient(){this.logger.info("Disposing active media stream client"),this.activeRawInputMediaStreamClient?.dispose("Disposed by RawDeviceStreamManager"),this.activeRawInputMediaStreamClient=null}async getStream(e=!1){return(this.activeRawInputMediaStreamClient?.originalMediaStream?.active||(this.activeRawInputMediaStreamClient=await this.streamClient(),await this.activeRawInputMediaStreamClient.start()),e)?this.activeRawInputMediaStreamClient.getMasterStream()?.rawStream:this.activeRawInputMediaStreamClient.originalMediaStream}},N1=class{constructor(e,t){this.logger=e,this.raiseTelemetryEvent=t,this.handlerMap=new Map([["Audio",new Map],["Video",new Map],["ScreenShare",new Map]])}dispose(e){this.logger.info(`disposing IRawStream ${e}`),this.handlerMap.get(e).forEach(e=>e.client().dispose())}disposeAll(){this.logger.info("Dispose All clients"),this.handlerMap.forEach(e=>e.forEach(e=>e.client().dispose()))}notifyChange(e){this.handlerMap.get(e).forEach(e=>{e.disposeActiveMediaStreamClient(),e.client().notifyStreamChange()})}createIRawStreamClient(e,t){this.logger.info(`Create new IRawStream client for ${t}`);let i=new N0(e,this.logger);return this.handlerAdded(i,t),i.client()}handlerAdded(e,t){let i=e.client();this.setClientSubscription(i,t),this.handlerMap.get(t).set(i.clientId,e)}deleteRawStreamManagerById(e,t){this.logger.info(`Deleting from map: ${t}`),this.handlerMap.get(t).delete(e)}setClientSubscription(e,t){this.logger.info(`Setting subscription on IRawStream client for ${t}`),e.on("clientDisposed",i=>{this.deleteRawStreamManagerById(e.clientId,t),this.raiseTelemetryEvent("IRawStream_client_disposed",{mediaType:t,clientId:i})}),e.on("rawStreamRequested",e=>{this.raiseTelemetryEvent("IRawStream_media_stream_changed",{mediaType:t,clientId:e})}),e.on("notifiedOnStreamChanged",e=>this.raiseTelemetryEvent("IRawStream_media_stream_changed",{mediaType:t,clientId:e}))}},N2=class extends no{constructor(e,t,i){super(e),this.logger=e,this.configProvider=t,this.audioRendererDiagnostics=i,this.window=mk,this.isMuted=!1,this.isPlayingAllowed=!1,this.hadPlaybackError=!1,this.id=nR(),this.onAudioError=e=>{let t=e&&e.target||this.audio;if(this.hadPlaybackError=!0,t?.error){let e=t.error.code,i=`error with rendering audio code: ${e}, message: ${t.error.message}`;this.event("onAudioPlaybackError").raise(e,nu.MEDIA_ERROR.audioPlaybackError,i),this.logger.safe.error(i)}else this.logger.safe.error("error with audio rendering")},this.onAudioPaused=async()=>{if(this.configProvider.config.audioRendererRestartOnPause&&this.canPlay&&!this.isMuted){let e=e9();this.logger.safe.info(`[${e}] audio playback is paused by OS, resuming it`),await this.startStream(e)}},this.onAudioPlayed=()=>{this.audioRendererDiagnostics?.registerSuccessfullReopen(this.deviceId),this.logger.safe.info("Audio element started playing")}}get canPlay(){return this.stream&&this.isPlayingAllowed}get muted(){return this.isMuted}async setMuted(e,t){return(this.isMuted=e,e)?this.stopStream(t):this.startStream(t)}async getSpeakerVolume(e){let t=this.audio?.volume??0;return this.logger.safe.info(`[${e}] get speaker volume: ${t}`),t}async setSpeakerVolume(e,t){this.assureAudioElement(t),this.audio.volume=e,this.logger.safe.info(`[${t}] set speaker volume: ${e}`)}getStream(){return this.stream}getDeviceId(){return this.deviceId}async play(e){if(this.stream=e,this.isPlayingAllowed=!0,!this.isMuted)return this.startStream()}stop(){this.stopStream(),this.isPlayingAllowed=!1}async setOutputDevice(e,t=e9()){if(!this.audio){this.deviceId=e;return}if(this.configProvider.config.disableAudioOutputSelection)return void this.logger.safe.warn(`[${t}] audio-output selection is disabled, disableAudioOutputSelection: true`);if(!this.audio.setSinkId)return void this.logger.safe.warn(`[${t}] setting output device is not supported`);if(e&&e!==this.currentSinkId){this.logger.safe.info(`[${t}] setting audio output device ID to ${ta(e)}`),this.deviceId=e;try{this.configProvider.config.audioSetSinkIdWorkaround&&this.stream&&!this.stream.active?(this.audio.srcObject=null,await this.audio.setSinkId(e),this.audio.srcObject=this.stream):await this.audio.setSinkId(e),this.currentSinkId=e}catch(e){this.logger.safe.warn(`[${t}] setSinkId operation was aborted with error ${t$(e)}`)}this.configProvider.config.audioRendererRestartOnDeviceError&&this.hadPlaybackError&&!this.isMuted&&(this.audioRendererDiagnostics?.registerReopenRequest(e),this.logger.safe.info(`[${t}] audio playback error happened, restarting audio stream on new device`),await this.startStream(t),this.hadPlaybackError=!1)}}dispose(){this.logger.safe.info("dispose"),super.dispose(),this.audio&&(this.stop(),this.stream=void 0,this.audio.removeEventListener("error",this.onAudioError),this.audio.removeEventListener("pause",this.onAudioPaused),this.audio.removeEventListener("play",this.onAudioPlayed),this.window.document.body.removeChild(this.audio),this.event("onAudioElementRemoved").raise(this.audio),this.currentSinkId=void 0,this.audio=void 0),this.detachGainNode()}async startStream(e=e9()){if(this.canPlay)try{await this.assureAudioElement(e),this.logger.safe.info(`[${e}] attaching stream to renderer: ${this.stream?.id}`),this.configProvider.config.speakerGainLevel&&this.reattachToGainNode(this.stream,this.configProvider.config.speakerGainLevel),this.audio.srcObject=this.stream,await this.audio.play(),this.event("onAudioStateChanged").raise(this.stream,this.id)}catch(t){this.logger.safe.warn(`[${e}] play operation was aborted with error ${t$(t)}`)}}async assureAudioElement(e=e9()){if(!this.audio)return this.logger.safe.info(`[${e}] creating audio element`),this.audio=this.window.document.createElement("audio"),this.audio.addEventListener("error",this.onAudioError),this.audio.addEventListener("pause",this.onAudioPaused),this.audio.addEventListener("play",this.onAudioPlayed),this.window.document.body.appendChild(this.audio),this.audio.autoplay=!0,this.event("onAudioElementAdded").raise(this.audio),this.setOutputDevice(this.deviceId,e)}stopStream(e=e9()){this.audio&&this.canPlay&&(this.detachGainNode(),this.configProvider.config.audioRendererUsePauseOnDetach?(this.logger.safe.info(`[${e}] Pausing with stream: ${this.stream?.id}`),this.audio.pause()):(this.logger.safe.info(`[${e}] Detaching from stream: ${this.stream?.id}`),this.audio.srcObject=null),this.event("onAudioStateChanged").raise(null,this.id))}attachToGainNode(e,t){this.audioContext=new mk.AudioContext,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=t,this.sourceNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination)}detachGainNode(){this.sourceNode?.disconnect(),this.sourceNode=void 0,this.gainNode?.disconnect(),this.gainNode=void 0,this.audioContext?.close(),this.audioContext=void 0}reattachToGainNode(e,t){this.detachGainNode(),this.attachToGainNode(e,t)}},N3=class{constructor(e){this.logger=e,this.queue=Promise.resolve()}add(e,t=e9()){let i;i=e instanceof iE?()=>e.promise:e;let n=this.queue.then(i);return this.queue=n.catch(e=>{if(this.queue){let i="";e instanceof TypeError&&(i=e.stack),this.logger.safe.error(`[${t}] Error from promiseQueue! ${t$(e)} ${i}`)}}),n}dispose(){this.queue=null}},N4=i(892891),N5=((p=N5||{})[p.NONE=0]="NONE",p[p.VIDEO=1]="VIDEO",p[p.AUDIO=2]="AUDIO",p);function N6(e,t,i){let{ssrc:n,keyFramesDecoded:r,nackCount:s,firCount:a,pliCount:o,decoderImplementation:l,packetsLost:c}=e.inboundRTP,{frameRateReceived:d,frameRateDecoded:u,bitrate:h,decodeTime:g,isFrozen:p}=e.extensions??{},{sourceId:f,msid:m,streamSize:v,rendererSize:S}=i,y=e.renderer?.modality===nu.MODALITY.sharing,{audioLevel:C}=t.inboundRTP,{mimeType:b}=t.codec??{},{healedRatio:T,lossRate:E}=t.extensions??{};return{streamSize:{overlayTab:1,format:"{0}x{1}",values:[v?.width,v?.height],undefinedFallback:0},rendererSize:{overlayTab:1,format:"{0}x{1}",values:[S?.width,S?.height],undefinedFallback:0},ssrc:{overlayTab:1,values:[n]},msid:{overlayTab:1,text:"sourceId/msid",format:"{0}/{1}",values:[f(),m()]},fps:{overlayTab:1,text:"FPS(r/d)",format:"{0}/{1}",values:[d,u],highlightUndefined:!0,lowerThreshold:1,upperThreshold:45,allowedDeviationThreshold:.2,suppressHighlighting:y},bitrate:{overlayTab:1,format:"{0} kbps",values:[N9(h)],lowerThreshold:24,suppressHighlighting:y},decodeTime:{overlayTab:1,format:"{0} ms",values:[g],upperThreshold:15,highlightUndefined:!0,suppressHighlighting:y},keyFramesDecoded:{overlayTab:1,text:"KFs",values:[r]},nacksFirsPlisSent:{overlayTab:1,text:"N/F/P",format:"{0}/{1}/{2}",values:[s,a,o],undefinedFallback:0,highlightChange:!0},packetsLost:{overlayTab:1,text:"lost",values:[c],undefinedFallback:0,highlightChange:!0},codecImplementationName:{overlayTab:1,text:"decoder",values:[l],highlightUndefined:!0},isFrozen:{overlayTab:1,values:[p?"YES":"NO"],fixedValueThreshold:"NO"},audioCodec:{overlayTab:2,values:[b?.split("/").pop()]},audioLevel:{overlayTab:2,values:[nB(C,4)]},healedRatio:{overlayTab:2,values:[nB(T,4)],upperThreshold:.2},lossRate:{overlayTab:2,values:[nB(E,4)],upperThreshold:.1}}}function N8(e,t){let{rid:i,ssrc:n,frameWidth:r,frameHeight:s,framesPerSecond:a,keyFramesEncoded:o,nackCount:l,firCount:c,pliCount:d,encoderImplementation:u,qualityLimitationReason:h}=e.outboundRTP,{cameraOpenResolution:g,bitrate:p,encodeTime:f,frameRateEncoded:m,frameRateSent:v,qp:S}=e.extensions??{},{mimeType:y}=t.codec??{},{lossRate:C}=t.extensions??{},{audioLevel:b}=t.mediaSource??{};return{rid:{overlayTab:1,values:[i],hideUndefined:!0},cameraSize:{overlayTab:1,format:"{0}x{1}",values:[g?.width,g?.height]},inputSize:{overlayTab:1,format:"{0}x{1}",values:[e.mediaSource?.width,e.mediaSource?.height]},sentSize:{overlayTab:1,format:"{0}x{1}",values:[r,s]},ssrc:{overlayTab:1,values:[n]},fps:{overlayTab:1,text:"FPS(i/e/s)",format:"{0}/{1}/{2}",values:[a,m,v],lowerThreshold:7,upperThreshold:45,allowedDeviationThreshold:.2},bitrate:{overlayTab:1,format:"{0} kbps",values:[N9(p)],lowerThreshold:24},encodeTime:{overlayTab:1,format:"{0} ms",values:[f],upperThreshold:15},keyFramesEncoded:{overlayTab:1,text:"KFs",values:[o]},qp:{overlayTab:1,values:[S]},nacksFirsPlisRecv:{overlayTab:1,text:"N/F/P",format:"{0}/{1}/{2}",values:[l,c,d],undefinedFallback:0,highlightChange:!0},codecImplementationName:{overlayTab:1,text:"encoder",values:[u],highlightUndefined:!0},qualityLimitationReason:{overlayTab:1,text:"limited",values:[h],fixedValueThreshold:"none"},bwe:{overlayTab:1,format:"{0} kbps",values:[N9(e.transport?.selectedCandidatePair?.availableOutgoingBitrate)],lowerThreshold:100},audioCodec:{overlayTab:2,values:[y?.split("/").pop()]},audioLevel:{overlayTab:2,values:[nB(b,4)]},lossRate:{overlayTab:2,values:[nB(C,4)]}}}function N9(e){return e&&Math.floor((e||0)/1e3)}var N7=class{constructor(e){this.container=e,this.formatRegexPattern=new RegExp(/{(\d+)}/g),this.elements={},this.previousSamples={},this.overlayTab=1,this.createTableCell=(e,t,i)=>{this.elements[e]=document.createElement("td"),this.elements[e].title=e,this.addElementStyle(e,i),this.elements[t].appendChild(this.elements[e])},this.topElement=e.ownerDocument.createElement("div"),this.topElement.classList.add("vdi-occlusion"),this.topElement.style.position="absolute",this.topElement.style.top="0px",this.topElement.style.left="0px",this.topElement.style.zIndex="100",this.topElement.style.transform="inherit",this.topElement.style.backgroundColor="rgba(0, 0, 0, 0.25)",this.topElement.style.pointerEvents="all",this.topElement.style.minWidth="15px",this.topElement.style.minHeight="15px",this.topElement.style.cursor="pointer",this.topElement.onclick=()=>{this.overlayTab=xi(this.overlayTab)},this.container.appendChild(this.topElement),this.table=document.createElement("table"),this.table.style.borderCollapse="collapse",this.table.style.fontSize="smaller",this.topElement.appendChild(this.table)}dispose(){this.topElement.removeChild(this.table),this.container.removeChild(this.topElement),this.table=null,this.topElement=null,this.container=null}createTableColumn(e,t){for(let i of Object.keys(e)){let n=e[i];n.overlayTab===this.overlayTab&&(n.hideUndefined&&n.values.every(e=>!e)||this.createTableRow(i,n,t))}}createTableRow(e,t,i){this.elements[e]||(this.elements[e]=document.createElement("tr"),this.table.appendChild(this.elements[e]));let n=`${e}-title`,r=`${e}-${i}`,s=this.formatValue(t),a=this.previousSamples[r]!==s;this.previousSamples[r]=s;let o=xn(t)||!!(t.highlightChange&&a);this.elements[n]||(this.createTableCell(n,e,!1),this.elements[n].innerText=t.text?t.text:e),this.createTableCell(r,e,!t.suppressHighlighting&&o),this.elements[r].innerText=s}clearTable(){for(;this.table.hasChildNodes();)this.table.removeChild(this.table.lastChild);this.elements={}}getOverlayTab(){return this.overlayTab}addElementStyle(e,t){this.elements[e].style.color=t?"#F72F35":"#FBF719",this.elements[e].style.fontSize="smaller",this.elements[e].style.lineHeight="1",this.elements[e].style.padding="0px 1px 0px 1px",this.elements[e].style.maxWidth="60px",this.elements[e].style.overflow="hidden",this.elements[e].style.whiteSpace="nowrap",this.elements[e].style.textOverflow="ellipsis"}formatValue(e){let{values:t,format:i,undefinedFallback:n="N/A"}=e;return i?i.replace(this.formatRegexPattern,(e,i)=>t?.[i]?.toString()??n.toString()):t?.[0]?.toString()??n.toString()}},xe=class{constructor(e,t,i){if(this.container=t,this.renderer=i,this.subs=[],!e||this.overlay)return;this.overlay=new N7(this.container),this.rendererStats={msid:()=>this.renderer.getLocalMsi(),sourceId:()=>this.renderer.getMsi()},this.subs.push(this.renderer.on("onVideoSizeChanged",(e,t)=>this.rendererStats.streamSize={width:e,height:t})),this.subs.push(this.renderer.on("onRendererSizeChanged",(e,t)=>this.rendererStats.rendererSize={width:Math.ceil(t.width),height:Math.ceil(t.height)}))}setStats(e,t){this.overlay&&(this.overlay.clearTable(),this.overlay.createTableColumn(N6(e,t,this.rendererStats),e.inboundRTP.id))}dispose(){this.subs.forEach(e=>e.dispose()),this.subs=[],this.overlay?.dispose(),this.overlay=null,this.container=null,this.renderer=null}},xt=class{constructor(e,t){if(this.container=t,!e||this.overlay)return;this.overlay=new N7(this.container)}setStats(e,t){if(this.overlay){if(this.overlay.clearTable(),2===this.overlay.getOverlayTab())return void this.overlay.createTableColumn(N8(e,t),e.outboundRTP.id);for(let i of[e,...e.altLayouts??[]])this.overlay.createTableColumn(N8(i,t),i.outboundRTP.id)}}dispose(){this.overlay?.dispose(),this.overlay=null,this.container=null}};function xi(e){let t=Object.keys(N5).filter(e=>isNaN(Number(e))),i=(e+1)%t.length;return N5[t[i]]}function xn(e){let{values:t,lowerThreshold:i,upperThreshold:n,highlightUndefined:r,fixedValueThreshold:s,allowedDeviationThreshold:a}=e;for(let e of t){if(void 0===e&&null===e&&r||s&&s!==e)return!0;if(null==e||!(0,N4.isNumber)(e))break;if(i&&Number(e)<=i||n&&Number(e)>=n)return!0;if(a){let i=(0,N4.mean)(t),n=i*a;if(Math.abs(Number(e)-i)>n)return!0}}return!1}function xr(e){switch(e){case"crop":return"cover";case"stretch":return"fill";default:return"contain"}}var xs=class e extends no{constructor(t,i,n){let r=i.createChild(`${e.rendererId++}`);super(r),this.container=t,this.configProvider=n,this.video=this.container.ownerDocument.createElement("video"),this.lastNotifiedVideoWidth=0,this.lastNotifiedVideoHeight=0,this.isVideoAttached=!1,this.onVideoDataUpdated=()=>{let e=this.video.videoWidth,t=this.video.videoHeight;(e<32||t<32)&&(e=t=0),(this.lastNotifiedVideoWidth!==e||this.lastNotifiedVideoHeight!==t)&&(this.lastNotifiedVideoWidth=e,this.lastNotifiedVideoHeight=t,this.event("onVideoSizeChanged").raise(e,t)),this.playVideo()},this.onVideoError=()=>{this.logger.safe.info(`onVideoError: error with video rendering: ${JSON.stringify(this.video.error)||"no video"}`),this.event("onVideoRendererStateChanged").raise({timestamp:Date.now(),state:"onError",payload:JSON.stringify(this.video.error)||"no video"})},this.onVideoPaused=()=>{this.logger.safe.info("onVideoPaused: video playback is paused"),this.event("onVideoRendererStateChanged").raise({timestamp:Date.now(),state:"onVideoPaused"}),this.playVideo()},this.onVideoPlayed=()=>{this.logger.safe.info("onVideoPlayed"),this.event("onVideoRendererStateChanged").raise({timestamp:Date.now(),state:"onVideoPlayed"})},this.onContextMenu=e=>{e.preventDefault()},this.logger=r,this.video.style.width="100%",this.video.style.height="100%",this.video.setAttribute("playsinline","true"),this.video.disablePictureInPicture=!0,this.video.autoplay=!0,this.video.muted=!0,this.attachEventListeners(),this.logger.safe.info("created")}getVideoElement(){return this.video}dispose(){super.dispose(),this.isVideoAttached&&(this.container.removeChild(this.video),this.isVideoAttached=!1),this.detachEventListeners(),this.attachMediaStream(null),this.video=null,this.stream=null,this.canvas=null,this.context=null}attachMediaStream(e){this.stream!==e&&(this.stream&&(this.video.srcObject=null),e&&(this.video.hidden=0===e.getVideoTracks().length,this.video.srcObject=e,this.isVideoAttached||(this.container.appendChild(this.video),this.isVideoAttached=!0)),this.stream=e)}setScalingMode(e){this.video.style.objectFit=xr(e)}getMediaStream(){return this.stream}getTrackId(){return this.stream?.getTracks()[0]?.id??void 0}async captureFrame(){let e=this.stream;if(!e)throw this.logger.safe.error("Mediastream not found"),Error("Mediastream not found");let t=e.getVideoTracks?.()?.[0]?.getSettings(),i=t?.width,n=t?.height;if(!(i&&n))throw this.logger.safe.error("Failed to get video track width/height"),Error("Failed to get video track width/height");let r=this.getImageData(i,n);return{getSize:()=>({width:i,height:n}),isMirrored:()=>!1,getImageData:()=>r}}async playVideoWithTimeout(){if(this.videoPlayPromise)return this.videoPlayPromise;let e=()=>Promise.race([this.video.play(),new Promise((e,t)=>setTimeout(t,this.configProvider.config.videoPlayTimeout,Error("video play timeout")))]);return this.videoPlayPromise=e().catch(()=>e()).catch(e=>{this.logger.safe.error(`Play video error: ${e}`)}).finally(()=>{this.videoPlayPromise=void 0})}async playVideo(){return this.video?.paused?this.configProvider.config.videoPlayTimeout>-1?this.playVideoWithTimeout():this.video.play().catch(e=>{this.logger.safe.error(`Play video error: ${e}`)}):Promise.resolve()}getImageData(e,t){if(this.canvas??(this.canvas=this.container.ownerDocument.createElement("canvas")),this.context??(this.context=this.canvas.getContext("2d")),!this.context)throw this.logger.safe.error("Failed to get canvas 2d context"),Error("Failed to get canvas 2d context");return this.canvas.width=e,this.canvas.height=t,this.context.drawImage(this.video,0,0,e,t),this.context.getImageData(0,0,e,t)}attachEventListeners(){this.video.addEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.addEventListener("timeupdate",this.onVideoDataUpdated),this.video.addEventListener("error",this.onVideoError),this.video.addEventListener("pause",this.onVideoPaused),this.video.addEventListener("contextmenu",this.onContextMenu),this.video.addEventListener("play",this.onVideoPlayed)}detachEventListeners(){this.video.removeEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.removeEventListener("timeupdate",this.onVideoDataUpdated),this.video.removeEventListener("error",this.onVideoError),this.video.removeEventListener("pause",this.onVideoPaused),this.video.removeEventListener("contextmenu",this.onContextMenu),this.video.removeEventListener("play",this.onVideoPlayed)}};xs.rendererId=0;var xa=xs,xo=class extends xa{constructor(e,t,i,n,r){super(e,i.createChild("local"),n),this.mediaStreamProvider=t,this.mediaType=r,this.isDisposed=!1,this.serialQueue=new N3(this.logger.createChild("rendererQueue")),this.logger.safe.info("ctor"),this.overlayStats=new xt(this.configProvider.config.showStatsInCall,e)}dispose(){this.logger.safe.info("dispose"),this.isDisposed=!0,this.event("onRendererDisposed").raise(this),super.dispose(),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null),this.overlayStats.dispose()}setVideoMirroring(e){this.configProvider.config.localPreviewMirroringSupported&&(this.getVideoElement().style.transform=e?"scaleX(-1)":void 0)}startVideoAsync(e=e9()){return this.logger.safe.info(`[${e}] starting local video`),this.event("onRendererStarted").raise(this),this.serialQueue.add(()=>this.restartVideo(),e)}updateStreamAsync(e=e9()){return this.logger.safe.info(`[${e}] updating local video`),this.serialQueue.add(()=>this.restartVideo(),e)}onDiagnosticUpdated(e){e.video?.send?.length&&e.audio?.send?.length&&this.overlayStats.setStats(e.video.send[0],e.audio.send[0])}async restartVideo(){try{let e;if("Video"===this.mediaType)e=await this.mediaStreamProvider.getVideoStream(!1,"localVideoRenderer");else if("ScreenShare"===this.mediaType)e=await this.mediaStreamProvider.getDisplayStream("localSSRenderer");else throw Error("Not yet supported");if(await e.start(),this.isDisposed)throw e.dispose(),Error("local video renderer is disposed");this.attachStream(e)}catch(e){throw this.mediaStreamProvider.raiseTelemetryEvent("video_preview_error",{mediaType:this.mediaType,error:t$(e)}),e}}attachStream(e){if(this.mediaStream!==e){if(this.mediaStream?.parentId===e?.parentId)return void e.dispose();this.logger.safe.info(`attach media stream ${e?.id}`);try{this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null),e&&super.attachMediaStream(e.rawStream),this.mediaStream=e}catch(t){throw e&&e.dispose(),t}}}},xl=class e extends no{constructor(e,t,i){super(e),this.logger=e,this.configProvider=t,this.effectsManager=i,this.cachedStreamsSubs=new Map,this.cachedStreamsMap=new Map,this.mediaStreamSerialQueue=new N3(this.logger)}getMediaStream(e,t){this.logger.safe.info(`retrieving media stream: ${JSON.stringify(vl(e))}`);let i=this.getSuitableStream(e);i||(this.logger.safe.info(`cached stream is not found. Creating a new one with constraints: ${t$(vl(e))}`),i=this.createCachedStream(e)),this.logger.safe.info(`starting cached stream id=${i.id}`,t);let n=i.getClient(t);return n.start().catch(e=>{this.logger.safe.error(`could not start media stream: ${i.id}, total streams: ${this.cachedStreamsMap.size}, error: ${t$(e)}`),this.removeStream(i)}),n}dispose(){this.cachedStreamsSubs&&(this.cachedStreamsSubs.forEach(e=>{e.forEach(e=>{e.dispose()})}),this.cachedStreamsSubs=null),this.cachedStreamsMap&&(this.cachedStreamsMap.forEach(e=>e.dispose("MSM dispose")),this.cachedStreamsMap=null),this.mediaStreamSerialQueue&&(this.mediaStreamSerialQueue.dispose(),this.mediaStreamSerialQueue=null),super.dispose()}getCachedStreams(){return this.cachedStreamsMap}getActiveConstraints(){let e={audio:!1,video:!1,sharing:!1};return this.cachedStreamsMap.forEach((t,i)=>{i.audio&&(e.audio=!0),i.video&&(e.video=!0),i.sharing&&(e.sharing=!0)}),e}onDevicesChanged(t){if(this.configProvider.config.enablePermissionsWorkaround&&e.isDeviceListEmpty(t))return void this.logger.safe.info("Device list is empty, permission workaround enabled");this.cachedStreamsMap.forEach((e,i)=>{if(!i.sharing){let e=this.isDeviceOutdated(i.audio,t),n=this.isDeviceOutdated(i.video,t);(e||n)&&this.cachedStreamsMap.delete(i)}})}getSuitableStream(e){let t;return this.cachedStreamsMap.forEach((i,n)=>{this.isSuitable(this.addDeviceIdIfNecessary(i,n),e)&&(t=n)}),t&&this.cachedStreamsMap.get(t)}addDeviceIdIfNecessary(e,t){if(!e.deviceId)return t;let i=this.cloneStreamConstraints(t);return t.audio&&void 0===t.audio.deviceId&&(i.audio.deviceId=e.deviceId),t.video&&void 0===t.video.deviceId&&(i.video.deviceId=e.deviceId),t.sharing&&(i.sharing.deviceId=nu.DISPLAY_SOURCE_ID),i}cloneStreamConstraints(e){return{...nw(e),withOverridenStream:e.withOverridenStream}}createCachedStream(e){let t=this.createStream(e);return this.event("onStreamCreated").raise(t.id,t.mediaType,e.force),this.subscribeOnStreamEvents(t),this.logger.safe.info(`created media stream, id: ${t.id} total: ${this.cachedStreamsMap.size}`),this.cachedStreamsMap.set(e,t),t}disposeCurrentDeviceStream(t){for(let[i,n]of this.cachedStreamsMap.entries())!t.sharing&&!i.sharing&&(e.deviceChanged(t.audio,i.audio)||e.deviceChanged(t.video,i.video))&&n.dispose("MSM dispose oneStreamPerDeviceType")}createStream(e){return this.configProvider.config.oneStreamPerDeviceType&&this.disposeCurrentDeviceStream(e),new NK(e,this.mediaStreamSerialQueue,this.configProvider,this.logger,this.effectsManager)}subscribeOnStreamEvents(e){let t=[];t.push(e.on("onStreamAcquired",(e,t,i)=>this.onStreamAcquired(e,t,i))),t.push(e.on("onStreamDisposing",e=>this.onStreamDisposing(e))),this.cachedStreamsSubs.set(e,t)}unsubscribeFromStreamEvents(e){this.cachedStreamsSubs.get(e).forEach(e=>e.dispose()),this.cachedStreamsSubs.delete(e)}removeStream(e){if(this.logger.safe.info(`release media stream generation: ${e.id} cached: ${this.cachedStreamsMap.size}`),!this.cachedStreamsSubs.has(e))return void this.logger.safe.warn(`skipping unknown stream ${e.id}`);this.unsubscribeFromStreamEvents(e),this.cachedStreamsMap.delete(this.getConstraintsForStream(e)),this.getStreamsCountByType("Audio")||this.effectsManager.stopEffect("Audio"),this.cachedStreamsMap.size||this.event("onAllStreamsRemoved").raise()}getConstraintsForStream(e){let t;return this.cachedStreamsMap.forEach((i,n)=>{e===i&&(t=n)}),t}isSuitable(e,t){let i=!!(e.withOverridenStream&&t.withOverridenStream),n=i||t.sharing||this.isAcceptable(e.audio,t.audio)&&e.audioProcessingFlags===t.audioProcessingFlags,r=i||this.isAcceptable(e.video,t.video),s=this.configProvider.config.requireUserActionForAudioSharing&&t.sharing&&!!e.audio!=!!t.audio,a=this.isAcceptable(e.sharing,t.sharing),o=a&&this.isAcceptable(e.audio,t.audio),l=s?o:a,c=e.withEffect===t.withEffect,d=e.withOverridenStream?.id===t.withOverridenStream?.id;return!t.force&&n&&r&&l&&c&&d}isAcceptable(e,t){return!e&&!t||e&&t&&e.deviceId===t.deviceId}isDeviceOutdated(e,t){return e?.deviceId&&!t.some(t=>t.deviceId===e.deviceId)}onStreamDisposing(e){this.logger.safe.info(`onStreamDisposing event ${e.id}`),this.event("onStreamDisposing").raise(e.id,e.mediaType),this.removeStream(e)}onStreamAcquired(e,t,i){let n="Audio"===e.mediaType?void 0:!!e.rawStream.getAudioTracks()[0],r="ScreenShare"===e.mediaType?this.getSharingSource(e):void 0,s="Audio"===e.mediaType||n?e.rawStream?.getAudioTracks?.()[0]?.getSettings?.()?.sampleRate:void 0;this.event("onStreamAcquired").raise({id:e.id,mediaType:e.mediaType,timestamp:t,resolution:i,withAudio:n,source:r,sampleRate:s})}getSharingSource(e){let t=e.rawStream.getVideoTracks()[0],i=t.getConstraints();if(i?.deviceId)return"camera";let n=t.getSettings();return n?.displaySurface??"unknown"}static deviceChanged(e,t){return!!e&&!!t&&e.deviceId!==t.deviceId}static isDeviceListEmpty(e){return e.every(e=>""===e.label)}getStreamsCountByType(e){let t=0;return this.cachedStreamsMap.forEach(i=>{t+=+(i.mediaType===e)}),t}},xc=class{constructor(e){this.configProvider=e,this.data={deviceList:[],deviceSelectionChangeCount:0,deviceSelectionChangeCountFromInterface:0,permissionStates:{microphone:"unknown",camera:"unknown"},devicesCount:{microphone:0,camera:0,speaker:0,compositeAudio:0,audioIngestDevice:0,virtualDevice:0},devicesChangeCount:0,devicesPollChangeCount:0,deviceTelemetryEvents:[],videoEffectsEvents:[],audioEffectsEvents:[],workerEvents:[],audioSourceNumOfReopenRequests:0,audioSourceNumOfSuccessfulReopens:0,audioRenderDeviceErrorFlags:[],audioCaptureDeviceErrorFlags:[]},Object.defineProperty(this.data,"rawUsedDevices",{get:()=>this.rawUsedDevices,configurable:!1,enumerable:!1})}set permissionStates(e){this.data.permissionStates=e}setSelectedDevices(e,t){let i={microphone:nH(e.microphone?.label,this.configProvider.config.devices.piiSafeWords),camera:nH(e.camera?.label,this.configProvider.config.devices.piiSafeWords),speaker:nH(e.speaker?.label,this.configProvider.config.devices.piiSafeWords)};this.rawUsedDevices={microphone:e.microphone?.label,camera:e.camera?.label,speaker:e.speaker?.label},this.data.usedDevices&&(this.data.deviceSelectionChangeCount++,t&&this.data.deviceSelectionChangeCountFromInterface++),this.data.usedDevices=i}setDeviceList(e,t,i){this.data.deviceList=e.map(e=>({label:nH(e.label,this.configProvider.config.devices.piiSafeWords),kind:e.type})),i&&(this.data.deviceDebugStrings=nw(i)),this.data.devicesCount.microphone=e.filter(e=>"microphone"===e.type).length,this.data.devicesCount.camera=e.filter(e=>"camera"===e.type).length,this.data.devicesCount.speaker=e.filter(e=>"speaker"===e.type).length,this.data.devicesCount.compositeAudio=e.filter(e=>"compositeAudio"===e.type).length,this.data.devicesChangeCount++,t&&this.data.devicesPollChangeCount++}registerDeviceTelemetryEvent(e){if("stream_acquired"===e.eventType){let t=e.payload;"Video"===t.mediaType&&(this.data.latestCameraOpenResolution=t.resolution)}"Audio"===e.payload.mediaType&&("stream_acquired"===e.eventType&&(this.data.audioSourceNumOfReopenRequests++,this.data.audioSourceNumOfSuccessfulReopens++),"stream_error"===e.eventType&&this.data.audioSourceNumOfReopenRequests++),tq(this.data.deviceTelemetryEvents,e,this.configProvider.config.diagnostics.collectionLimits.numDeviceEvents)}logAudioDeviceError(e,t){switch(e){case"reconnect_on_audio_playback_error":{let e=this.getAudioPlaybackErrorCode(t.error);this.registerAudioRenderError(e);break}case"enumeration_failed":this.registerAudioRenderError(1),this.registerAudioCaptureError(1);break;case"permissions_state_changed":"denied"===t.microphone&&this.registerAudioCaptureError(0x800000000000);break;case"stream_ended_error":this.registerAudioCaptureError(4194304)}}getAudioPlaybackErrorCode(e){switch(e){case 3:return 4194304;case 4:return 128;default:return 0x8000000000000000}}registerVideoEffectsEvent(e){tq(this.data.videoEffectsEvents,e,this.configProvider.config.diagnostics.collectionLimits.numVideoEffectsEvents)}registerAudioEffectsEvent(e){tq(this.data.audioEffectsEvents,e,this.configProvider.config.diagnostics.collectionLimits.numAudioEffectsEvents)}registerWorkerEvent(e){tq(this.data.workerEvents,e,this.configProvider.config.diagnostics.collectionLimits.numWorkerEvents)}registerAudioCaptureError(e){let t={timestamp:Date.now(),audioDeviceErrorFlag:e};tq(this.data.audioCaptureDeviceErrorFlags,t,this.configProvider.config.diagnostics.collectionLimits.numAudioCaptureErrors)}registerAudioRenderError(e){let t={timestamp:Date.now(),audioDeviceErrorFlag:e};tq(this.data.audioRenderDeviceErrorFlags,t,this.configProvider.config.diagnostics.collectionLimits.numAudioRenderErrors)}getObjectRef(){return this.data}},xd=class{constructor(e,t,i,n,r){this.deviceId=e,this.label=t,this.kind=i,this.groupId=n,this.capabilities=r,this.type=this.getType(this.kind),this.guid=`${this.type}:${this.deviceId}`,this.isSystemDefault=this.deviceId===nu.MEDIA_DEVICE.defaultId}toDeviceDesc(){return{id:this.guid,browserId:this.deviceId,label:this.label,kind:this.type}}getType(e){switch(e){case nu.MEDIA_DEVICE_KIND.audioInput:return nu.MEDIA_DEVICE.microphone;case nu.MEDIA_DEVICE_KIND.audioOutput:return nu.MEDIA_DEVICE.speaker;case nu.MEDIA_DEVICE_KIND.videoInput:return nu.MEDIA_DEVICE.camera;case nu.MEDIA_DEVICE_KIND.compositeAudio:return nu.MEDIA_DEVICE.compositeAudio;case nu.MEDIA_DEVICE_KIND.virtualDevice:return nu.MEDIA_DEVICE.virtualDevice;default:throw Error(`Device kind to recognized: ${e}`)}}},xu=class extends xd{constructor(e,t,i,n){super(e,t,i,n)}},xh=class extends xd{constructor(e,t,i,n,r){super(e,t,i,n,r)}toDeviceDesc(){let e=super.toDeviceDesc();return e.isSystemDefault=this.isSystemDefault,e}},xg=class extends xd{constructor(e,t,i,n,r){if(super(e,t,i,n,r),this.position="unknown",r&&r.facingMode&&1===r.facingMode.length)switch(r.facingMode[0]){case"user":this.position="front";break;case"environment":this.position="back"}}toDeviceDesc(){let e=super.toDeviceDesc();return e.position=this.position,e}},xp=class extends xd{constructor(e,t,i,n,r,s){super(null,i,n,""),this.micDevice=e,this.speakerDevice=t,this.formFactor=r,this.isPcInternalDevice=s,this.guid=null,this.isSystemDefault=!1}get micDeviceId(){return this.micDevice.guid}get speakerDeviceId(){return this.speakerDevice.guid}toDeviceDesc(){let e=super.toDeviceDesc();return e.microphoneId=this.micDeviceId,e.speakerId=this.speakerDeviceId,e.formFactor=this.formFactor,e.isPcInternalDevice=this.isPcInternalDevice,e}};function xf(e){let t=e.getCapabilities&&e.getCapabilities();switch(t&&(delete t.groupId,delete t.deviceId),e.kind){case nu.MEDIA_DEVICE_KIND.audioInput:case nu.MEDIA_DEVICE_KIND.audioOutput:return new xh(e.deviceId,e.label,e.kind,e.groupId,t);case nu.MEDIA_DEVICE_KIND.videoInput:return new xg(e.deviceId,e.label,e.kind,e.groupId,t);default:throw Error(`Device kind is not recognized: ${e.kind}`)}}function xm(e,t,i){return new xp(e,t,i,"compositeAudio",0,!1)}function xv(e){let t={deviceId:nu.MEDIA_DEVICE.defaultId,label:nu.MEDIA_DEVICE.defaultDeviceLabel,kind:xS(e),groupId:"",toJSON:()=>JSON.stringify(t)};return xf(t)}function xS(e){switch(e){case nu.MEDIA_DEVICE.microphone:return nu.MEDIA_DEVICE_KIND.audioInput;case nu.MEDIA_DEVICE.speaker:return nu.MEDIA_DEVICE_KIND.audioOutput;case nu.MEDIA_DEVICE.camera:return nu.MEDIA_DEVICE_KIND.videoInput;default:throw Error(`Device type to recognized: ${e}`)}}function xy(e,t,i,n,r={str:""}){r.str+=`|input(${t.length})`;let s=[];for(let i of[n.config.devices.blacklist[e],n.defaultConfig.devices.blacklist[e]])try{let e=RegExp(i,"i");s=t.filter(t=>i&&t.label.match(e)?(r.str+=`|-blacklisted(${t.label})`,!1):t.deviceId!==nu.MEDIA_DEVICE.communicationsId||(r.str+="|-communications",!1));break}catch(e){r.str+=`|filterError('${i}', ${t$(e)})`,s=t}if(s.length){let t=xC(i,s,r);if(t&&(t.isSystemDefault=!0,r.str+=`|default(${ta(t.guid)})`),t&&t.deviceId!==nu.MEDIA_DEVICE.defaultId&&s.length>1&&(s=s.filter(e=>e.deviceId!==nu.MEDIA_DEVICE.defaultId||(r.str+="|-defaultId",!1))),e===nu.MEDIA_DEVICE.camera||t||(r.str+="|+syntheticDefault",s.unshift(xv(e))),i.forEach(e=>{let t=s.find(t=>t.guid===e.guid);t&&!t.label&&e.label&&(r.str+=`|migrateLabel(${ta(t.guid)})`,t.label=e.label)}),e===nu.MEDIA_DEVICE.speaker){let e=s.filter(e=>""===e.label);e.length>1&&e.length===s.length&&(s=t?[t]:[s[0]],r.str+=`|-filteredEmptyLabels(${e.length})`)}}return s}function xC(e,t,i){if(1===t.length)return i.str+="|default:only",t[0];let n=t.find(e=>e.isSystemDefault&&e.deviceId===nu.MEDIA_DEVICE.defaultId);if(!n)return i.str+="|default:noSynthetic",t.find(e=>e.isSystemDefault)||t[0];{let r=t.filter(e=>e!==n);if(1===r.length)return i.str+="|default:firstNonDefault",r[0];if(""!==n.groupId){let e=r.filter(e=>e.groupId===n.groupId);if(1===e.length)return i.str+=`|default:groupId(${ta(e[0].guid)})`,e[0]}let s=r.map(e=>e.label),a=nD(n.label,s),o=r.find(e=>e.label===a);if(o)return i.str+=`|default:label(${ta(o.guid)})`,o;let l=e.find(e=>e.isSystemDefault);if(l){let e=r.find(e=>e.deviceId===l.deviceId);if(e)return i.str+=`|default:previousList(${ta(e.guid)})`,e}}return i.str+="|default:anyOrNull",t.find(e=>e.isSystemDefault)||null}function xb(e,t,i=.5,n={str:""}){let r=[];if(e.length&&t.length){let s=xT(e.filter(e=>""!==e.groupId),t.filter(e=>""!==e.groupId),n);s.length&&(r.push(...s.map(e=>xm(e.microphone,e.speaker,xI(e.microphone.label,e.speaker.label)))),n.str+=`|directMatched(${r.length})`);let a=r.length;r.push(...x_(e.filter(e=>!r.some(t=>t.micDeviceId===e.guid)),t.filter(e=>!r.some(t=>t.speakerDeviceId===e.guid)),i,n)),n.str+=`|otherMatched(${r.length-a})`}return r}function xT(e,t,i={str:""}){let n=new Set;for(let i of[...e,...t])n.add(i.groupId);let r=[];for(let s of n.values()){let n=e.filter(e=>e.groupId===s),a=t.filter(e=>e.groupId===s);if(n&&a){if(1===n.length&&1===a.length)r.push({microphone:n[0],speaker:a[0]}),i.str+=`|pairSimple(${ta(n[0].guid)}, ${ta(a[0].guid)})`;else if(n.length>1||a.length>1){let e=xE(n,a);for(;e;)i.str+=`|pairComplex(${ta(e.microphone.guid)}, ${ta(e.speaker.guid)})`,r.push(e),e=xE(n=n.filter(t=>t!==e.microphone),a=a.filter(t=>t!==e.speaker))}}}return r}function xE(e,t){let i=999,n=null;if(e.length>0&&t.length>0)for(let r of e)for(let e of t){let t=n$(r.label,e.label);t<i&&(i=t,n={microphone:r,speaker:e})}return n}function x_(e,t,i,n){let r=[];return e.length&&t.length&&e.forEach(e=>{let s=t.filter(t=>t.groupId===e.groupId);if(!s.length){n.str+=`|lbl_nocand(${ta(e.guid)})`;return}let a=nU(e.label,s[0].label).length,o=s.sort((t,i)=>{let n=nU(e.label,t.label),r=nU(e.label,i.label);return n.length>a&&(a=n.length),r.length>a&&(a=r.length),r.length-n.length});if(o.length){let t=a/e.label.length;t>i&&(r.push(xm(e,o[0],xI(e.label,o[0].label))),n.str+=`|lbl_matched(${ta(e.guid)} & ${ta(o[0].guid)}, ${Math.round(1e4*t)/100}%)`)}}),r}function xI(e,t){if(e===t)return e;let i=nU(e,t);i=i.trim().replace(/^\((.+)\)$/,"$1");let n="",r="",s=0,a=[xw(e),xw(t)];if(0===a[0]||0===a[1])return i;for(let e=0;e<i.length;e++)if("("===i[e])s++,r+=i[e];else if(")"===i[e])if(s>0)s--,r+=i[e],n+=r,r="";else break;else s>0?r+=i[e]:n+=i[e];let o=xw(n);return(o===a[0]||o===a[1])&&(n=xI(i,n=n.replace(/\w+\s?\((.+)\)/,"$1"))),n.trim()}function xw(e){let t=["(",")"],i=0;for(let n=0;n<e.length;n++)t.some(t=>e[n]===t)&&i++;return i}var xP={microphone:"",camera:"",speaker:"",compositeAudio:"",audioIngestDevice:"",virtualDevice:""},xR=class extends no{constructor(e,t){super(t),this.configProvider=e,this.logger=t,this.debugInfo=xP,this.lists=new Map,this.lists.set(nu.MEDIA_DEVICE.microphone,[]),this.lists.set(nu.MEDIA_DEVICE.camera,[]),this.configProvider.userAgentConfig.isAudioOutputSelectionSupported&&(this.lists.set(nu.MEDIA_DEVICE.speaker,[]),this.lists.set(nu.MEDIA_DEVICE.compositeAudio,[])),e.userAgentConfig.on("isAudioOutputSelectionSupportedChanged",()=>this.onConfigUpdated()),this.logger.safe.info("Initialized")}get devices(){let e=[];return this.lists.forEach(t=>e.push(...t)),e}getDevicesByType(e){return this.lists.get(e)??[]}updateDevices(e,t=!1){if(nA(this.latestRawList,e))return;this.latestRawList=e;let i=this.devices;this.debugInfo.microphone="microphone",this.debugInfo.camera="camera",this.debugInfo.speaker="speaker",this.debugInfo.compositeAudio="compositeAudio",this.updatePrimitiveDeviceList(nu.MEDIA_DEVICE.microphone,e.filter(e=>e.type===nu.MEDIA_DEVICE.microphone)),this.updatePrimitiveDeviceList(nu.MEDIA_DEVICE.camera,e.filter(e=>e.type===nu.MEDIA_DEVICE.camera)),this.lists.get(nu.MEDIA_DEVICE.speaker)&&(this.updatePrimitiveDeviceList(nu.MEDIA_DEVICE.speaker,e.filter(e=>e.type===nu.MEDIA_DEVICE.speaker)),this.lists.get(nu.MEDIA_DEVICE.compositeAudio)&&this.updateCompositeAudioDeviceList(this.lists.get(nu.MEDIA_DEVICE.microphone),this.lists.get(nu.MEDIA_DEVICE.speaker)));let n=this.lists.get(nu.MEDIA_DEVICE.compositeAudio)||[];this.lists.set(nu.MEDIA_DEVICE.microphone,this.orderDeviceList(this.lists.get(nu.MEDIA_DEVICE.microphone),n)),this.lists.get(nu.MEDIA_DEVICE.speaker)&&this.lists.set(nu.MEDIA_DEVICE.speaker,this.orderDeviceList(this.lists.get(nu.MEDIA_DEVICE.speaker),n));let r=this.lists.get(nu.MEDIA_DEVICE.microphone);this.setTopItemToDefault(r);let s=this.lists.get(nu.MEDIA_DEVICE.speaker);this.setTopItemToDefault(s),nA(i,this.devices)||(this.logger.safe.info("Device lists updated and changed"),this.logger.safe.info(this.debugInfo.microphone),this.logger.safe.info(this.debugInfo.camera),this.logger.safe.info(this.debugInfo.speaker),this.logger.safe.info(this.debugInfo.compositeAudio),this.event("onDevicesChanged").raise(this.devices,t))}updateVirtualDeviceList(e){let t=this.lists.get(nu.MEDIA_DEVICE.virtualDevice),i=e.map(e=>new xu(e.id,e.label,"virtualDevice",""));if(nA(t,i))return void this.logger.safe.info("Device lists did not change.");this.lists.set(nu.MEDIA_DEVICE.virtualDevice,i),this.event("onDevicesChanged").raise(this.devices,!1)}updateActiveMicrophone(e){if(!e||e.deviceId===nu.MEDIA_DEVICE.defaultId)return;let t=this.lists.get(nu.MEDIA_DEVICE.microphone),i=t.findIndex(e=>e.isSystemDefault);if(-1===i||t[i]===e){e.isSystemDefault=!0;return}this.logger.safe.info("Removing synthetic default microphone"),e.isSystemDefault=!0,t.splice(i,1),this.lists.set(nu.MEDIA_DEVICE.microphone,t),this.event("onDevicesChanged").raise(this.devices,!1)}updatePrimitiveDeviceList(e,t){let i={str:this.debugInfo[e]};this.lists.set(e,xy(e,t,this.lists.get(e)||[],this.configProvider,i)),this.debugInfo[e]=i.str}updateCompositeAudioDeviceList(e,t){let i={str:this.debugInfo.compositeAudio};this.lists.set(nu.MEDIA_DEVICE.compositeAudio,xb(e,t,this.configProvider.config.devices.compositeLabelMatchingThreshold,i)),this.debugInfo.compositeAudio=i.str}orderDeviceList(e,t){return e.sort((e,i)=>this.getDevicePriority(i,this.getCompositeAudioDeviceCounterpart(i,t))-this.getDevicePriority(e,this.getCompositeAudioDeviceCounterpart(e,t)))}getCompositeAudioDeviceCounterpart(e,t){let i=t.find(t=>t.micDeviceId===e.guid||t.speakerDeviceId===e.guid);return i?i[e.type===nu.MEDIA_DEVICE.speaker?"micDevice":"speakerDevice"]:null}getDevicePriority(e,t){let i=0;return this.configProvider.config.devices.overrideDefault&&t&&(!e.isSystemDefault&&t.isSystemDefault?(this.debugInfo[e.type]+=`|overrideDefault(${ta(e.guid)})`,i+=10):e.isSystemDefault&&!t.isSystemDefault&&"microphone"===e.type&&(i+=15)),e.isSystemDefault&&(i+=5),t&&(i+=1,t.isSystemDefault&&(i+=2)),i}setTopItemToDefault(e){e?.length&&(e.forEach(e=>e.isSystemDefault=!1),e[0].isSystemDefault=!0)}onConfigUpdated(){let e=!1;this.configProvider.userAgentConfig.isAudioOutputSelectionSupported?this.lists.has(nu.MEDIA_DEVICE.speaker)||(this.lists.set(nu.MEDIA_DEVICE.speaker,[]),this.lists.set(nu.MEDIA_DEVICE.compositeAudio,[]),e=!0):(this.lists.has(nu.MEDIA_DEVICE.speaker)&&(this.lists.delete(nu.MEDIA_DEVICE.speaker),e=!0),this.lists.has(nu.MEDIA_DEVICE.compositeAudio)&&(this.lists.delete(nu.MEDIA_DEVICE.compositeAudio),e=!0)),e&&(this.logger.safe.info("Updating device list due to config update"),this.updateDevices(this.latestRawList||[]))}},xA=class e extends no{constructor(t,i){super(i),this.pollingInterval=0,e.enumeratorUsers.add(this),e.initialize(this,t,i)}startDevicePolling(t){this.pollingInterval=t?e.configProvider.config.devices.pollingIntervalIdle:e.configProvider.config.devices.pollingIntervalActive,e.updatePollingTask()}stopDevicePolling(t){this.pollingInterval=t?0:e.configProvider.config.devices.pollingIntervalIdle,e.updatePollingTask()}dispose(){super.dispose(),this.stopDevicePolling(!0),e.enumeratorUsers.delete(this),0===e.enumeratorUsers.size&&(e.logger.safe.info("disposing"),e.initializeCalled=!1,e.isDeviceListAvailable=new iE,e.list=void 0,e.window.navigator.mediaDevices.ondevicechange=void 0)}static get isPolling(){return 0!==e.currentPollingInterval}static initialize(t,i,n){e.initializeCalled||(e.initializeCalled=!0,e.window=mk,e.configProvider=i,e.logger=n,e.list=new xR(i,n.createChild("DeviceList")),i.userAgentConfig.on("isAudioOutputSelectionSupportedChanged",()=>e.enumerateDevices()),i.on("configUpdated",()=>{void 0!==i.config.devices.pollingIntervalIdle&&null!==e.pollingTimer&&t.startDevicePolling(!0)}),i.config.devices.pollingIntervalIdle&&i.config.devices.idlePollingOnStart&&t.startDevicePolling(!0),e.window.navigator.mediaDevices&&(e.window.navigator.mediaDevices.ondevicechange=()=>{n.safe.info("enumerating due to ondevicechange callback"),e.enumerateDevices().catch(e=>{n.safe.error(`unable to enumerate ondevicechange: ${t$(e)}`)})}),e.enumerateDevices())}static async enumerateDevices(t=!1){if(!e.window.navigator?.mediaDevices?.enumerateDevices){let t=Error("device enumeration unsupported");throw e.isDeviceListAvailable.isPending&&e.isDeviceListAvailable.reject(t),t}if(e.enumerateDevicesPromise&&!t){e.logger.safe.info("enumeration request postponed"),e.hasPendingUpdate=!0,e.isDeviceListAvailable.isPending&&is.isEngine("Firefox")&&e.isDeviceListAvailable.resolve();return}try{if(!e.enumerateDevicesPromise)if(e.configProvider.config.devices.enumerateDevicesTimeout){let t=i_(e.configProvider.config.devices.enumerateDevicesTimeout);e.enumerateDevicesPromise=t.promise,e.window.navigator.mediaDevices.enumerateDevices().then(t.resolve,t.reject)}else e.enumerateDevicesPromise=e.window.navigator.mediaDevices.enumerateDevices();let i=await e.enumerateDevicesPromise;e.list.updateDevices(i.map(e=>xf(e)),t),e.isDeviceListAvailable.isPending&&e.isDeviceListAvailable.resolve()}catch(i){let t=t$(i);throw e.logger.safe.warn(`error with enumerating devices: ${t}`),e.raiseFailedEnumeration(t),e.isDeviceListAvailable.isPending&&e.isDeviceListAvailable.reject(i),i}finally{e.enumerateDevicesPromise=void 0,e.hasPendingUpdate&&(e.hasPendingUpdate=!1,e.logger.safe.info("running postponed enumeration"),e.enumerateDevices())}}static updatePollingTask(){let t=Number.MAX_SAFE_INTEGER;for(let i of e.enumeratorUsers.values())i.pollingInterval<t&&(t=i.pollingInterval);if(t===Number.MAX_SAFE_INTEGER&&(t=0),(e.pollingTimer||e.currentPollingInterval!==t)&&e.pollingTimer&&(e.window.clearTimeout(e.pollingTimer),e.pollingTimer=void 0),e.currentPollingInterval=t,0===t)return;let i=async()=>{if(e.currentPollingInterval)try{await e.enumerateDevices(!0),e.pollingTimer=e.window.setTimeout(i,e.currentPollingInterval)}catch(t){throw e.pollingTimer=null,t}};e.logger.safe.info(`starting device polling with interval ${t}ms`),e.pollingTimer=1,i()}static raiseFailedEnumeration(t){for(let i of e.enumeratorUsers.values())i.event("onDeviceEnumerationfailed").raise(t)}};xA.isDeviceListAvailable=new iE,xA.initializeCalled=!1,xA.currentPollingInterval=0,xA.hasPendingUpdate=!1,xA.enumeratorUsers=new Set;var xM=xA,xD=class extends no{constructor(e,t,i){super(i),this.deviceList=e,this.configProvider=t,this.logger=i,this.userSelectedDevices={microphone:null,camera:null,speaker:null},this.currentlySelectedDevices={microphone:null,camera:null,speaker:null,audioIngestDevice:null},this.deviceList.on("onDevicesChanged",e=>this.onDevicesChanged(e)),e.devices.length>0&&this.onDevicesChanged(e.devices),this.logger.safe.info("Initialized")}get selectedDevices(){return nw(this.currentlySelectedDevices)}selectDevices(e){let t=!1;if(nh(e,(e,i)=>{let n=this.getDeviceToSelect(i,this.deviceList.getDevicesByType("audioIngestDevice"===i?"microphone":i),e);"camera"===i&&(this.userSelectedDevices[i]=n?.guid||this.userSelectedDevices[i]),n?.guid!==this.currentlySelectedDevices[i]?.guid&&(this.userSelectedDevices[i]=n?.guid||this.userSelectedDevices[i],t=!0),this.currentlySelectedDevices[i]=n}),t){let e=nb(this.currentlySelectedDevices).map(e=>JSON.stringify(vo(e,this.configProvider.config.devices.piiSafeWords)));this.logger.safe.info(`Changed from public interface: ${e}`),this.event("onSelectedDevicesChanged").raise(this.selectedDevices,!0)}}getDeviceToSelect(e,t,i){let n,r=this.userSelectedDevices[e];return(i?n=t.find(e=>e.guid===i):r&&(n=t.find(e=>e.guid===r)),"audioIngestDevice"===e)?n:n||t[0]}onDevicesChanged(e){let t=!1;if(Object.keys(this.currentlySelectedDevices).forEach(i=>{let n="audioIngestDevice"===i?"microphone":i,r=e.filter(e=>e.type===n);if(r.length>0){let e=this.getDeviceToSelect(i,r);e?.guid!==this.currentlySelectedDevices[i]?.guid&&(this.currentlySelectedDevices[i]=e,t=!0)}else this.currentlySelectedDevices[i]&&(this.currentlySelectedDevices[i]=null,t=!0)}),t){let e=nb(this.currentlySelectedDevices).map(e=>JSON.stringify(vo(e,this.configProvider.config.devices.piiSafeWords)));this.logger.safe.info(`Changed due to device list change: ${e}`),this.event("onSelectedDevicesChanged").raise(this.selectedDevices,!1)}}},xO=class extends no{constructor(e,t){super(e),this.logger=e,this.mediaStream=t,this.subs=[],this.subscribeOnMediaStreamEvents(t)}acquire(){return this.mediaStream?this.mediaStream.start().then(()=>this.logger.safe.info("Stream acquired")).catch(e=>{throw this.logger.safe.warn(`Failed to acquire the stream: ${t$(e)}`),e}):Promise.reject("Disposed")}dispose(){this.logger.safe.info("Disposing stream"),this.unsubscribeFromMediaStreamEvents(),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null),super.dispose()}subscribeOnMediaStreamEvents(e){this.subs=[e.on("onStreamClientStarted",()=>this.event("onStreamStateChanged").raise("active")),e.on("onStreamClientMuted",(e,t)=>this.event("onStreamStateChanged").raise(t?"inactive":"active")),e.on("onStreamClientEnded",()=>this.event("onStreamStateChanged").raise("stopped")),e.on("onStreamClientError",(e,t)=>{let i=t.type===nu.MEDIA_ERROR.permissionDeniedError||t.type===nu.MEDIA_ERROR.sharingCancelledError;this.event("onStreamStateChanged").raise(i?"cancelled":"failed")})]}unsubscribeFromMediaStreamEvents(){this.subs.forEach(e=>e.dispose()),this.subs=[]}},xk=[nu.MEDIA_STATE.inactive,nu.MEDIA_STATE.receive,nu.MEDIA_STATE.send,nu.MEDIA_STATE.sendReceive],xN=[nu.MEDIA_STATE.inactive,nu.MEDIA_STATE.receive],xx=class extends no{constructor(e,t,i){super(i),this.configProvider=e,this.deviceManager=t,this.logger=i,this.currentState={microphone:"unknown",camera:"unknown"},this.lastGum={audio:!1,video:!1},this.registeredTrackers=new Set,this.accessIssuePermissionOther={audio:!1,video:!1},this.window=mk,this.permittedModalities={audio:xk,video:xk,sharing:xk},this.initialize()}async initialize(){v$.hasPermissionsApi()&&("unknown"===this.currentState.microphone||"unknown"===this.currentState.camera)?(this.logger.safe.info("Initializing"),await this.registerPermissionTracker("microphone"),await this.registerPermissionTracker("camera")):("unknown"===this.currentState.microphone||"unknown"===this.currentState.camera)&&this.logger.safe.warn(`Permissions API is not supported in this browser. Microphone: ${this.currentState.microphone}, camera: ${this.currentState.camera}`)}getPermissionState(e){return this.currentState[e]||"unknown"}isPermissionKnown(e){let t=this.getPermissionState(e);return"unknown"!==t&&"prompt"!==t}get browserPermittedModalities(){return this.permittedModalities}get knownPermissionStates(){return nw(this.currentState)}update(e,t){let i=nw(t);e.audio||delete i.audio,e.video||delete i.video;let n=nw(this.permittedModalities);nh(i,(e,t)=>{this.permittedModalities[t]=e?xk:xN}),nA(n,this.permittedModalities)||this.event("onPermissionStateChanged").raise(this.knownPermissionStates)}async askDevicePermission(e){let t=e?nw(e):{audio:!0,video:this.deviceManager.hasCamera()};if(this.accessIssuePermissionOther={audio:!1,video:!1},this.configProvider.config.permissions.rememberNegative&&(t.audio=t.audio&&this.permittedModalities.audio===xk,t.video=t.video&&this.permittedModalities.video===xk),t.sharing)throw Error("askDevicePermission does not support sharing constraints.");let i={audio:!1,video:!1};this.lastGum={audio:!1,video:!1};let n=async(i,n,r)=>{let s={audio:!!i.audio,video:!!i.video,sharing:!0};return this.configProvider.config.permissions.adpRequestAVLast&&t.audio&&t.video&&(!this.lastGum.audio||!this.lastGum.video)&&(this.logger.safe.info("Prompting for audio and video to ensure omnibar state"),await this.askDevicePermissionPrompt({audio:!0,video:!0},!1)),this.update(t,s),this.deviceManager.raiseTelemetryEvent("ask_device_permission",{constraints:e,resultConstraints:i,error:r,reason:n}),s};await this.initialize();let r=this.getPermissionState("microphone"),s=this.getPermissionState("camera");if(this.logger.safe.info(`Permission state { audio: ${r}, video: ${s} }`),this.configProvider.config.permissions.useNegativeInAdp&&(!t.audio||"denied"===r)&&(!t.video||"denied"===s))return n(i,"navigator_permissions_denied");if(this.configProvider.config.permissions.usePositiveInAdp&&(!t.audio||t.audio&&"granted"===r)&&(!t.video||t.video&&"granted"===s))return n(t,"navigator_permissions_granted");try{return n(this.getConstrainsWithPermissionError(await this.askDevicePermissionPrompt(t,this.configProvider.config.permissions.adpFallback)),"stream_acquisition")}catch(e){return n(i,"stream_acquisition",e)}}updatePermissionsFromDeviceList(e){let t={microphone:void 0,camera:void 0};e.forEach(e=>{"audioinput"===e.kind&&(t.microphone=""===e.label?"denied":"granted"),"videoinput"===e.kind&&(t.camera=""===e.label?"denied":"granted")}),t.microphone&&this.currentState.microphone!==t.microphone&&this.handlePermissionStateChanged("microphone",t.microphone),t.camera&&this.currentState.camera!==t.camera&&this.handlePermissionStateChanged("camera",t.camera)}async askDevicePermissionPrompt(e,t=!0){let i={audio:!1,video:!1};try{let t=this.deviceManager.getMediaStream(e);return t&&(this.lastGum=nw(e),await t.start(),i.audio=t.hasAudio(),i.video=t.hasVideo(),this.disposeLater(t)),i}catch(n){if(e.audio&&e.video&&t){try{i.video=this.configProvider.config.permissions.adpFallbackVideo&&(await this.askDevicePermissionPrompt({video:!0})).video}catch(e){e.type!==nu.MEDIA_ERROR.permissionDeniedError&&e.type!==nu.MEDIA_ERROR.permissionDeniedBySystemError&&(this.accessIssuePermissionOther.video=!0)}try{i.audio=this.configProvider.config.permissions.adpFallbackAudio&&(await this.askDevicePermissionPrompt({audio:!0})).audio}catch(e){e.type!==nu.MEDIA_ERROR.permissionDeniedError&&e.type!==nu.MEDIA_ERROR.permissionDeniedBySystemError&&(this.accessIssuePermissionOther.audio=!0)}}else if(t)throw n;return i}}getConstrainsWithPermissionError(e){return this.configProvider.config.permissions.disableOnPermissionDeniedOnly?{audio:this.accessIssuePermissionOther.audio||e.audio,video:this.accessIssuePermissionOther.video||e.video}:e}disposeLater(e){setTimeout(()=>{e.dispose()},this.configProvider.config.mediaStreamHoldInterval)}async registerPermissionTracker(e){if(!this.registeredTrackers.has(e))try{let t=await this.window.navigator.permissions.query({name:e});this.handlePermissionStateChanged(e,t.state),t.onchange=()=>this.handlePermissionStateChanged(e,t.state),this.registeredTrackers.add(e)}catch(t){this.logger.safe.error(`Error querying permissions for ${e}: ${t$(t)}`)}}handlePermissionStateChanged(e,t){if(this.logger.safe.info(`Permission state for ${e} changed ${this.currentState[e]} -> ${t}`),this.configProvider.config.permissions.enumerateDevicesAfterChange){this.logger.safe.info(`enumerateDevicesAfterChange: ${JSON.stringify(this.configProvider.config.permissions)}`),xM.logger.safe.info("enumerating due to permission change");try{xM.enumerateDevices()}catch(e){xM.logger.safe.error(`unable to enumerate on permission change: ${t$(e)}`)}}this.currentState[e]=t,this.deviceManager.raiseTelemetryEvent("permissions_state_changed",this.knownPermissionStates),this.deviceManager.handlePermissionStateChange()}},xL=class extends tZ{constructor(e,t=nR()){super(),this.dms=e,this.label=t,this.id=nR(),this.receivedEvents=new Map,this.subscribeToDeviceManagers(e)}getDeviceManagers(){return this.dms}dispose(){super.dispose(),this.dms?.forEach(e=>e.dispose()),this.dms=null}subscribeToDeviceManagers(e){e.forEach((e,t)=>{e.on("onVideoEffectsEvent",(...t)=>this.eventHandler("onVideoEffectsEvent",e,()=>this.event("onVideoEffectsEvent").raise(...t))),e.on("onVideoEffectApplied",(...t)=>this.eventHandler("onVideoEffectApplied",e,()=>this.event("onVideoEffectApplied").raise(...t))),e.on("onDeviceTelemetryEvent",e=>this.event("onDeviceTelemetryEvent").raise({deviceId:`${this.id}/${t}`,...e})),e.on("onVideoEffectsTelemetryEvent",e=>this.event("onVideoEffectsTelemetryEvent").raise({deviceId:`${this.id}/${t}`,...e})),e.on("onDevicesPermissionChanged",()=>this.event("onDevicesPermissionChanged").raise(`${this.id}/${t}`)),e.on("onStreamUpdateRequested",(...e)=>this.event("onStreamUpdateRequested").raise(...e))})}eventHandler(e,t,i){let n=this.receivedEvents.get(e);if(n??(n=new Set),n.add(t),this.dms.every(e=>n.has(e))){i(),n.clear();return}this.receivedEvents.set(e,n)}},xF=()=>(e,t,i)=>{let n=i.value;return i.value=function(...e){let t=this;return t.serialQueue.add(n.bind(this,...e))},Reflect.defineProperty(i.value,"name",{value:n.name}),i},xU=class{constructor(e,t,i){this.configProvider=e,this.statistics=t,this.logger=i}isWasmEffectSupported(){return this.configProvider.config.webcv.useWasmEffects?!!window.MediaStreamTrackProcessor||(this.logger.info("wasmEffects disabled, insertable streams are not supported"),!1):(this.logger.info("wasmEffects disabled by feature flag"),!1)}isWebgl2EffectSupported(){return this.isCurrentRendererSupported()&&this.isWebGL2Supported()}isCurrentRendererSupported(){let e=this.configProvider.config.webcv.webGLUnsupportedRenderers,t=!1,i=v$.unmaskedGlRenderer;return i&&!e.some(e=>e===i)?t=!0:(this.statistics.setError("RendererIsNotSupported",`Blacklisted from ${JSON.stringify(e)}`),this.logger.info(`Unsupported renderer: ${t$(i)}`)),t}isWebGL2Supported(){try{let e=document.createElement("canvas").getContext("webgl2");if(!e)return this.statistics.setError("WebGL2IsNotSupported"),this.logger.info("WebGL2 context is not supported"),!1;let t=e.getSupportedExtensions(),i=this.configProvider.config.webcv.webGLRequiredExtensions.filter(e=>!t.includes(e));if(i.length>0)return this.statistics.setError("WebGL2RequiredExtensionsNotSupported","Required WebGL2 extensions not supported."),this.logger.info(`Unsupported WebGL2 extensions: ${t$(i)}`),!1}catch(e){return this.statistics.setError("WebGL2IsNotSupported",`Error: ${t$(e)}`),this.logger.error(`isWebGL2Supported: ${t$(e)}`),!1}return!0}},x$=class{constructor(e){this.loadDuration=-1,this.error=new Nl(e)}hasData(){return this.error.items.length>0||this.loadDuration>0}startLoadTimer(){this.loadStartTimestamp=Date.now()}stopLoadTimer(){this.loadDuration=Date.now()-this.loadStartTimestamp}clearErrors(){this.error.clear()}setError(e,t){this.error.add({type:e,message:t})}registerContentSharingEvent(e){this.lastContentSharingEvent=e}getReport(){return{lastContentSharingEvent:this.lastContentSharingEvent,loadDuration:this.loadDuration,error:this.error.items}}},xV=class extends no{constructor(e,t,i,n){super(i),this.webcvProvider=e,this.configProvider=t,this.logger=i,this.wasmLoader=n,this.serialQueue=new N3(this.logger),this.videoEffectToWebCVEffectMapping={0:m.VideoEffectType.Off,1:m.VideoEffectType.BackgroundBlur,16:m.VideoEffectType.BackgroundReplacement,512:m.VideoEffectType.PresenterMode,256:m.VideoEffectType.None,2048:m.VideoEffectType.None,262144:m.VideoEffectType.None},this.currentEffect=0,this.effectProviderSubs=[],this.statistics=new x$(this.configProvider.config.effectsTelemetryBufferSize),this.processorType=m.ProcessorType.Webgl2,this.queryMessageProcessor=new xB(this.configProvider,this.logger)}get isEffectEnabled(){return 0!==this.currentEffect||0!==this.queryMessageProcessor.payload.effectType}async init(){if(!this.effectProvider)try{this.effectProvider=await this.initializeVideoEffectProvider()}catch(e){throw Error(e)}}async dispose(){this.logger.safe.debug("Dispose"),this.effectProvider&&(this.effectProviderSubs.forEach(e=>e.dispose()),this.effectProviderSubs=null,await this.effectProvider.disposeAsync()),super.dispose()}async configure(e){return(this.logger.safe.debug(`Set config: ${JSON.stringify(e)}`),this.effectConfig={backgroundImageUrl:e.imagePath,headers:e.headers},this.effectProvider)?this.effectProvider.configureEffect(this.effectConfig):void this.logger.safe.debug("WebCV is not initialized. Do nothing")}async setEffectAsync(e){if(this.currentEffect===e)return void this.logger.safe.debug(`Effect ${this.currentEffect} is already set`);this.effectProvider||(this.logger.safe.debug("Initializing effect provider"),await this.init()),this.logger.safe.debug(`Set effect: ${e}`);let t=this.getWebCVEffect(e);if(!t)throw Error(`Effect with type ${e} is not supported`);if(this.shouldCollectStats(e)&&this.notifyAboutLastSessionStats("EffectChanged"),this.currentEffect=e,!this.effectProvider)return void this.logger.safe.debug("WebCV is not initialized. Do nothing");try{await this.effectProvider.setEffectAsync(t)}catch(e){throw await this.handleFailedProcessing(),this.notifyError("FailedToInitialize",`Failed to apply ${t}, error:${t$(e)}`),e}}async processingVideoEffectMessage(e){let t={code:0,response:{effects:[]},type:"EnableEffects"};try{await this.init()}catch(e){return this.logger.error(`Failed to initialize WebCV, error:${t$(e)}`),this.notifyError("FailedToInitialize",`Initialization failed, error:${t$(e)}`),t}let i=this.currentEffect;this.logger.info(`Processing video effect request type: ${JSON.stringify(e.type)}`),t=await this.queryMessageProcessor.processVideoEffectMessage(e),this.queryMessageProcessor.reconfigure&&(await this.configure({imagePath:this.queryMessageProcessor.payload.imageConfig.backgroundImageUrl,headers:this.queryMessageProcessor.payload.imageConfig.headers}),this.queryMessageProcessor.reconfigure=!1);try{this.shouldCollectStats(i)&&this.notifyAboutLastSessionStats("EffectChanged"),await this.effectProvider.setEffectAsync(this.getWebCVEffect(this.queryMessageProcessor.payload.effectType),this.queryMessageProcessor.payload)}catch{this.logger.error("Failed to apply video effect")}return t}async setSourceAsync(e){if(this.logger.safe.debug(`Set source: ${e?e.id:"no stream"}`),!this.effectProvider)return this.logger.safe.debug("WebCV is not initialized. Do nothing"),e;let t=e;try{t=await this.effectProvider.setSourceAsync(e)}catch(e){await this.handleFailedProcessing(),this.notifyError("FailedToInitialize",`Failed to set source, error:${t$(e)}`)}return t}async removeSourceAsync(e){return(this.logger.safe.debug(`Remove source: ${e?e.id:"no stream"}`),this.effectProvider)?this.effectProvider.removeSourceAsync(e):void this.logger.safe.debug("WebCV is not initialized. Do nothing")}async getEffectsCapability(){let e=0,t=await this.getCapability();for(let i of(this.logger.safe.debug(`Get capabilty with return: ${JSON.stringify(t)}`),t))e|=i;return e}getStats(e){if(!this.effectProvider)return;let t=this.effectProvider.getStats(),i=this.statistics.getReport();if(t||i.error.length)return{timestamp:Date.now(),statsReason:e,...this.createTelemetryEvent(t,i)}}getVersion(){return this.effectProvider?.getVersion?.()??"Unknown"}async resetOutputConstraints(e,t=m.EffectQualityChangeReason.ExternalParam){let i={...this.configProvider.config.webcv.qualityConfig};return i.outputResolution=e.height,this.effectProvider?.configureStreamProcessor(i,m.EffectQualityChangeReason.ExternalParam)}createTelemetryEvent(e,t){return{payload:{version:this.getVersion(),...t,...e,isWasmEnabled:this.processorType===m.ProcessorType.Wasm}}}notifyError(e,t){this.statistics.setError(e,t),this.notifyAboutLastSessionStats("EffectError")}notifyAboutLastSessionStats(e){let t=this.getStats(e);t&&this.event("onVideoEffectTelemetryEvent").raise(t)}async initializeVideoEffectProvider(){if(!this.webcvProvider)return this.logger.safe.debug("WebCV provider is not set"),null;this.statistics.startLoadTimer();let e=await this.webcvProvider.getVideoEffectProvider();if(this.statistics.stopLoadTimer(),!e)return this.statistics.setError("FailedToInitialize"),this.logger.safe.warn("WebCV is not initialized"),null;this.logger.safe.debug(`WebCV v${e.getVersion?.()} is initialized`);let t=await this.webcvProvider.getModelConfig();return await e.configureModel(t),this.configProvider.config.webcv.loadWorkerCallback=this.wasmLoader.getWorkerFunction("wasmcv"),this.configProvider.config.webcv.loadTimerWorkerCallback=this.wasmLoader.getWorkerFunction("timer"),await e.configure({...this.configProvider.config.webcv,processorType:this.processorType}),this.effectConfig&&await e.configureEffect(this.effectConfig),this.effectProviderSubs=[e.on("onEffectApplied",()=>this.event("onMediaStreamUpdateRequested").raise("Video")),e.on("onEffectStopped",()=>this.notifyAboutLastSessionStats("EffectStopped")),e.on("onVideoEffectQualityChanged",e=>this.event("onVideoEffectQualityChanged").raise(e)),e.on("onVideoStreamQualityChanged",e=>this.event("onVideoStreamQualityChanged").raise(e.resolution,e.fps,e.reason)),e.on("onCapabilitiesChanged",()=>this.event("onVideoEffectCapabilitiesChanged").raise()),e.on("onFirstFrameProcessed",()=>this.onFirstFrameProcessed()),e.on("onErrorNotified",e=>this.notifyError("WebcvProcessorError",e)),e.on("videoFreezeDetected",e=>this.event("videoFreezeDetected").raise(e))],e}async getCapability(){if(!this.configProvider.config.enableVideoEffects)return this.logger.debug("Video effects disabled"),[0];if(!this.webcvProvider)return this.logger.debug("WebCVProvider is not configured"),[0];let e=new xU(this.configProvider,this.statistics,this.logger.createChild("CapabilityChecker")),t=[0];return e.isWasmEffectSupported()?(t=[0,1,16,262144,512,2048],this.processorType=m.ProcessorType.Wasm):e.isWebgl2EffectSupported()&&(t=[0,1,16],this.processorType=m.ProcessorType.Webgl2),t}getWebCVEffect(e){return this.videoEffectToWebCVEffectMapping[e]||m.VideoEffectType.None}onFirstFrameProcessed(){this.event("onVideoEffectApplied").raise(),this.logger.safe.debug("onVideoEffectApplied event raised")}async handleFailedProcessing(){this.currentEffect=0;try{await this.effectProvider.setEffectAsync(m.VideoEffectType.Off)}catch(e){this.notifyError("WebcvProcessorError",`Failed to handle error state, error:${t$(e)}`)}}shouldCollectStats(e){return 0!==this.currentEffect&&0!==e&&this.currentEffect!==e}};eM([xF()],xV.prototype,"init",1),eM([xF()],xV.prototype,"dispose",1),eM([xF()],xV.prototype,"configure",1),eM([xF()],xV.prototype,"setSourceAsync",1),eM([xF()],xV.prototype,"removeSourceAsync",1),eM([xF()],xV.prototype,"getEffectsCapability",1);var xB=class{constructor(e,t){this.configProvider=e,this.logger=t,this.currentEffects=0,this.currentEffectPayload={effectType:0},this.shouldReconfigure=!1}get payload(){return this.currentEffectPayload.effectType=this.currentEffects,this.currentEffectPayload}get reconfigure(){return this.shouldReconfigure}set reconfigure(e){this.shouldReconfigure=e}async processVideoEffectMessage(e){switch(e.type){case"EnableEffects":return await this.processEnableEffectsMessage(e);case"DisableEffects":return await this.processDisableEffectsMessage(e);case"QueryEffects":return await this.processQueryEffectsMessage(e);default:return this.logger.error(`Unsupported video effect message type: ${e.type}`),null}}async processEnableEffectsMessage(e){let t={code:0,response:{effects:[]},type:"EnableEffects"};for(let i=0;i<e.request.effects.length;i++){let n=e.request.effects[i];switch(n.type){case"BackgroundModification":if("Blur"===n.options.variant){this.currentEffects|=1;let e={type:"BackgroundModification",options:{variant:"Blur"}};t.response.effects.push(e),this.currentEffects&=-262673}else if("Replacement"===n.options.variant){this.currentEffects|=16;let e={type:"BackgroundModification",options:{variant:"Replacement",location:n.options.location}};this.shouldReconfigure=!0,this.currentEffectPayload.imageConfig={backgroundImageUrl:n.options.location,headers:n.options?.headers},t.response.effects.push(e),this.currentEffects&=-262658}else if("WeatherPerson"===n.options.variant){if(!this.configProvider.config.webcv.useWasmEffects){this.logger.error("WeatherPerson effect is not supported on non wasm effect provider");break}this.currentEffects|=512;let e={type:"BackgroundModification",options:{variant:"WeatherPerson"}};t.response.effects.push(e),this.currentEffects&=-262162}else if("Bokeh"===n.options.variant){if(!this.configProvider.config.webcv.useWasmEffects){this.logger.error("Bokeh effect is not supported on non wasm effect provider");break}this.currentEffects|=262144;let e={type:"BackgroundModification",options:{variant:"Bokeh"}};t.response.effects.push(e),this.currentEffects&=-530}break;case"TouchUp":this.logger.error("TouchUp effect is not supported on non wasm effect provider");break;case"AutoAdjust":if(!this.configProvider.config.webcv.useWasmEffects){this.logger.error("AutoAdjust effect is not supported on non wasm effect provider");break}this.currentEffects|=2048,t.response.effects.push({type:"AutoAdjust"})}}return t}async processQueryEffectsMessage(e){let t={code:0,response:{effects:[]},type:"QueryEffects"};if(1&this.currentEffects){let e={type:"BackgroundModification",options:{variant:"Blur"},state:"On"};t.response.effects.push(e)}else{let e={type:"BackgroundModification",options:{variant:"Blur"},state:"Off"};t.response.effects.push(e)}if(262144&this.currentEffects&&this.configProvider.config.webcv.useWasmEffects){let e={type:"BackgroundModification",options:{variant:"Bokeh"},state:"On"};t.response.effects.push(e)}else if(this.configProvider.config.webcv.useWasmEffects){let e={type:"BackgroundModification",options:{variant:"Bokeh"},state:"Off"};t.response.effects.push(e)}else{let e={type:"BackgroundModification",options:{variant:"Bokeh"},state:"Unavailable"};t.response.effects.push(e)}if(16&this.currentEffects){let e={variant:"Replacement",location:""};this.currentEffectPayload?.imageConfig&&(e.location=this.currentEffectPayload?.imageConfig.backgroundImageUrl);let i={type:"BackgroundModification",options:e,state:"On"};t.response.effects.push(i)}else{let e={type:"BackgroundModification",options:{variant:"Replacement",location:""},state:"Off"};t.response.effects.push(e)}if(512&this.currentEffects&&this.configProvider.config.webcv.useWasmEffects){let e={type:"BackgroundModification",options:{variant:"WeatherPerson"},state:"On"};t.response.effects.push(e)}else if(this.configProvider.config.webcv.useWasmEffects){let e={type:"BackgroundModification",options:{variant:"WeatherPerson"},state:"Off"};t.response.effects.push(e)}else{let e={type:"BackgroundModification",options:{variant:"WeatherPerson"},state:"Unavailable"};t.response.effects.push(e)}if(256&this.currentEffects){let e={type:"TouchUp",state:"Unavailable",options:{strength:0}};t.response.effects.push(e)}if(2048&this.currentEffects&&this.configProvider.config.webcv.useWasmEffects){let e={type:"AutoAdjust",state:"On"};t.response.effects.push(e)}else if(this.configProvider.config.webcv.useWasmEffects){let e={type:"AutoAdjust",state:"Off"};t.response.effects.push(e)}else{let e={type:"AutoAdjust",state:"Unavailable"};t.response.effects.push(e)}return t}async processDisableEffectsMessage(e){let t={code:0,response:{effects:[]},type:"DisableEffects"},i=e,n={effects:[]};for(let e=0;e<i.request.effects.length;e++){let t=i.request.effects[e];switch(t.type){case"BackgroundModification":if("Blur"===t.options.variant){let e={type:"BackgroundModification",options:{variant:"Blur"}};n.effects.push(e),this.currentEffects&=-2}if("Bokeh"===t.options.variant){let e={type:"BackgroundModification",options:{variant:"Bokeh"}};n.effects.push(e),this.currentEffects&=-262145}if("Replacement"===t.options.variant){let e={variant:"Replacement",location:""};this.payload?.imageConfig!==void 0&&(e.location=this.payload?.imageConfig.backgroundImageUrl);let t={type:"BackgroundModification",options:e};n.effects.push(t),this.currentEffects&=-17}if("WeatherPerson"===t.options.variant){let e={type:"BackgroundModification",options:{variant:"WeatherPerson"}};n.effects.push(e),this.currentEffects&=-513}break;case"TouchUp":this.logger.error("TouchUp effect is not supported now"),n.effects.push({type:"TouchUp",options:{strength:0}}),this.currentEffects&=-257,this.currentEffectPayload.softfocusStrength=0;break;case"AutoAdjust":n.effects.push({type:"AutoAdjust"}),this.currentEffects&=-2049}}return t.response=n,t}},xH=class extends no{constructor(e,t,i,n,r,s){super(r),this.wasmdnsProvider=e,this.wasmaecProvider=t,this.wasmVqeProvider=i,this.configProvider=n,this.logger=r,this.wasmLoader=s,this.serialQueue=new N3(this.logger),this.stopped=!0,this.hasError=!1,this.isProviderReady=!1,this.statistics=new x$(this.configProvider.config.effectsTelemetryBufferSize),this.noiseSuppressionModeInternal={currentEffect:v.AudioEffectType.Off,contentSharingMode:null,userMode:null},this.processingFlagsInternal={default:this.configProvider.config.defaultAudioProcessingFlags,current:this.configProvider.config.defaultAudioProcessingFlags},this.currentEffectCapability=0,this.contentSharingSessionStarted=!1,this.audioEffectToWasmAudioEffectType={0:v.AudioEffectType.Off,1:v.AudioEffectType.NoiseSuppressionClassic,2:v.AudioEffectType.NoiseSuppressionDeep,4:v.AudioEffectType.EchoCancellationClassic,8:v.AudioEffectType.VoiceQualityEnhancementClassic,16:v.AudioEffectType.VoiceQualityEnhancementDeep},this.noiseSuppressionModeToWasmDnsEffectMapping={Off:v.AudioEffectType.Off,High:v.AudioEffectType.NoiseSuppressionDeep,Low:v.AudioEffectType.NoiseSuppressionClassic},this.configProvider.on("configUpdated",()=>{this.audioProcessingFlags=this.configProvider.config.defaultAudioProcessingFlags})}get isEffectEnabled(){return this.noiseSuppressionModeInternal.currentEffect!==v.AudioEffectType.Off}get audioProcessingFlags(){if(!this.shouldFallbackToNativeProcessing())return this.processingFlagsInternal.current}set audioProcessingFlags(e){e!==this.processingFlagsInternal.default&&(this.logger.debug(`Setting audio processing flags: ${this.processingFlagsInternal.default} -> ${e}`),this.processingFlagsInternal.default=e,this.contentSharingSessionStarted||(this.processingFlagsInternal.current=e,this.requestStreamUpdate()))}shouldFallbackToNativeProcessing(){return this.configProvider.config.wasmvqe.enableVqe||this.configProvider.config.wasmdns.enableNoiseSuppression?this.configProvider.config.wasmvqe.asyncInitialization&&!this.isProviderReady?(this.logger.safe.info("shouldFallbackToNativeProcessing: provider is not yet initialized"),!0):this.hasError?(this.logger.safe.info("shouldFallbackToNativeProcessing: error was encountred initializing the package"),!0):this.configProvider.config.wasmvqe.enableVqe&&!this.wasmVqeProvider?(this.logger.safe.info("shouldFallbackToNativeProcessing: VQE provider is enabled but not loaded"),!0):!!this.configProvider.config.wasmdns.enableNoiseSuppression&&(!this.wasmdnsProvider||!this.wasmaecProvider)&&(this.logger.safe.info("shouldFallbackToNativeProcessing: DNS/AEC provider is enabled but not loaded"),!0):(this.logger.safe.info("shouldFallbackToNativeProcessing: custom processing is not enabled"),!0)}nsModeToVqeMode(e,t){switch(e){case"High":return t?v.VqeMode.DeepVQE:v.VqeMode.DeepNS;case"Low":return t?v.VqeMode.SkypeVQE:v.VqeMode.SkypeNS;default:return t?v.VqeMode.SkypeAEC:v.VqeMode.Off}}vqeModeToNsMode(e){switch(e){case v.VqeMode.DeepVQE:case v.VqeMode.DeepNS:return"High";case v.VqeMode.SkypeVQE:case v.VqeMode.SkypeNS:return"Low";case v.VqeMode.SkypeAEC:case v.VqeMode.Off:default:return"Off"}}vqeModeToAudioEffectType(e){switch(e){case v.VqeMode.DeepVQE:return 16;case v.VqeMode.DeepNS:return 2;case v.VqeMode.SkypeVQE:return 8;case v.VqeMode.SkypeNS:return 1;case v.VqeMode.SkypeAEC:return 4;case v.VqeMode.Off:default:return 0}}audioEffectTypeToVqeMode(e){switch(e){case 16:return v.VqeMode.DeepVQE;case 2:return v.VqeMode.DeepNS;case 8:return v.VqeMode.SkypeVQE;case 1:return v.VqeMode.SkypeNS;case 4:return v.VqeMode.SkypeAEC;default:return v.VqeMode.Off}}async setSourceWithAsyncInitialization(e){if(this.hasError)return e;if(!this.isProviderReady)return this.logger.safe.info("Provider is not ready. Initializing provider async"),this.initialize(),e;if(this.shouldFallbackToNativeProcessing())return this.logger.safe.info("No custom audio effect is used. Fallback to native audio processing"),e;try{let t=await this.vqeProvider.setSourceAsync(e);return this.aecRefStream&&(this.logger.safe.debug(`Setting the reference stream to: ${this.aecRefStream.id}`),this.setAecRefStream(this.aecRefStream,this.rendererId)),t}catch(t){return this.notifyError("WasmVqeProcessorError",`setSourceAsync: Failed to asynchronously set source for VQE (${t})`),e}}async setSourceAsync(e){if(this.logger.safe.debug(`Set source: ${e?e.id:"no stream"}, currentEffect = ${this.noiseSuppressionModeInternal.currentEffect}`),this.stopped||this.stop(),this.shouldFallbackToNativeProcessing())return this.logger.safe.info("No custom audio effect is used. Fallback to native audio processing"),e;if(await this.initializeProvider(),await this.configureEffect(),this.isProviderReady=!0,!this.vqeProvider&&(!this.dnsProvider||!this.aecProvider)){let t=this.vqeProvider?this.dnsProvider?"AEC":"DNS":"VQE";return this.statistics.setError("FailedToInitialize",`setSourceAsync: audio effect provider not initialized (${t}).`),this.logger.safe.warn(`Unable to configure audio effects: audio effect provider not initialized (${t}).`),e}if(!this.configProvider.config.wasmvqe.enableVqe&&!this.configProvider.config.wasmdns.enableNoiseSuppression)return e;if(this.effectProviderSubs=[this.vqeProvider?.on("onEffectStopped",()=>this.notifyAboutLastSessionStats()),this.vqeProvider?.on("onMetricsUpdated",()=>this.notifyAboutLastSessionStats()),this.vqeProvider?.on("onErrorNotified",(e,t)=>this.notifyError("WasmVqeProcessorError",e,t)),this.dnsProvider?.on("onEffectStopped",()=>this.notifyAboutLastSessionStats()),this.dnsProvider?.on("onMetricsUpdated",()=>this.notifyAboutLastSessionStats()),this.dnsProvider?.on("onErrorNotified",e=>this.notifyError("WasmDnsProcessorError",e)),this.aecProvider?.on("onErrorNotified",e=>this.notifyError("WasmAecProcessorError",e))],this.configProvider.config.wasmvqe.enableVqe)try{let t=await this.vqeProvider.setSourceAsync(e);return this.aecRefStream&&(this.logger.safe.debug(`Setting the reference stream to: ${this.aecRefStream.id}`),this.setAecRefStream(this.aecRefStream,this.rendererId)),t}catch(t){return this.notifyError("WasmVqeProcessorError",`setSourceAsync: Failed to asynchronously set source for VQE (${t})`,!0),e}let t=e;try{t=await this.aecProvider.setSourceAsync(e),this.aecRefStream&&(this.logger.safe.debug(`Setting the reference stream to: ${this.aecRefStream.id}`),this.setAecRefStream(this.aecRefStream,this.rendererId))}catch(e){this.notifyError("WasmAecProcessorError",`setSourceAsync: Failed to asynchronously set source for AEC (${e})`)}try{return await this.dnsProvider.setSourceAsync(t)}catch(e){this.notifyError("WasmDnsProcessorError",`setSourceAsync: Failed to asynchronously set source for DNS (${e})`)}return t}setAecRefStream(e,t){try{if(!e&&this.rendererId!==t)return void this.logger.safe.debug(`Ref stream can't be set to null by renderer ${t}`);if(this.logger.safe.debug(`Setting the reference stream to: ${e?e.id:"Null"} requested by renderer ${t}`),this.aecRefStream=e,this.rendererId=t,!this.vqeProvider&&(!this.dnsProvider||!this.aecProvider)){let e=this.vqeProvider?this.dnsProvider?"AEC":"DNS":"VQE";this.statistics.setError("FailedToInitialize",`setAecRefStream: audio effect provider not initialized (${e}).`),this.logger.safe.warn(`Unable to setAecRefStream for audio effects: audio effect provider not initialized (${e}).`);return}this.configProvider.config.wasmvqe.enableAec?this.vqeProvider.setRefStream(e):this.configProvider.config.wasmdns.enableNoiseSuppression&&this.aecProvider.setRefStream(e)}catch(e){this.notifyError("WasmVqeProcessorError",`setRefStream: Failed to set reference stream for echo cancellation (${e})`)}}async setEffectAsync(e){let t=this.audioEffectToWasmAudioEffectType[e];if(this.noiseSuppressionModeInternal.currentEffect===t)return;let i=this.noiseSuppressionModeInternal.currentEffect===v.AudioEffectType.Off&&t!==v.AudioEffectType.Off;if(this.noiseSuppressionModeInternal.currentEffect=t,this.noiseSuppressionModeInternal.userMode=this.audioEffectTypeToVqeMode(e),await this.initializeProvider(),await this.configureEffect(),!this.vqeProvider&&(!this.dnsProvider||!this.aecProvider)){let e=this.vqeProvider?this.dnsProvider?"AEC":"DNS":"VQE";throw this.notifyError("FailedToInitialize",`setEffectAsync: audio effect provider not initialized (${e}).`),Error("FailedToInitialize")}try{this.configProvider.config.wasmvqe.enableVqe?await this.vqeProvider.setEffectAsync(t):this.configProvider.config.wasmdns.enableNoiseSuppression&&(await this.dnsProvider.setEffectAsync(t),await this.aecProvider.setEffectAsync(t)),this.configProvider.config.applyAudioEffectOnDemand&&this.configProvider.config.wasmvqe.enableVqe&&i&&this.requestStreamUpdate(),this.logger.safe.debug(`The audio effect was set to '${t}'`)}catch(e){throw this.notifyError("WasmVqeProcessorError",`setEffectAsync: Failed to apply '${t}' audio effect, error: ${t$(e)}`),e}}stop(){try{this.dnsProvider?.dispose(),this.dnsProvider=null,this.aecProvider?.dispose(),this.aecProvider=null,this.vqeProvider?.dispose(),this.vqeProvider=null,this.effectProviderSubs?.forEach(e=>e?.dispose()),this.effectProviderSubs=null,this.wasmLoaderSub?.dispose(),this.wasmLoaderSub=null,this.stopped=!0,this.isProviderReady=!1,this.logger.safe.debug("The audio effects provider was stopped.")}catch(e){this.logger.safe.error(`Failed to stop the audio effects provider (${e})`)}}dispose(){try{this.hasError=!1,this.contentSharingSessionStarted=!1,this.stop(),this.logger.safe.debug("The audio effects provider was disposed.")}catch(e){this.logger.safe.error(`dispose: Failed to dispose the audio effects provider (${e})`)}}async getEffectsCapability(){return this.currentEffectCapability=0,this.configProvider.config.wasmvqe.enableVqe?(this.currentEffectCapability|=1,this.currentEffectCapability|=2,this.configProvider.config.wasmvqe.enableAec&&(this.currentEffectCapability|=4,this.currentEffectCapability|=8,this.currentEffectCapability|=16)):this.configProvider.config.wasmdns.enableNoiseSuppression&&(this.currentEffectCapability|=1,this.currentEffectCapability|=2,this.currentEffectCapability|=4),this.currentEffectCapability}getVersion(){let e=`WasmDns ${this.dnsProvider?.getVersion()??"Unknown"}`,t=`WasmAec ${this.aecProvider?.getVersion()??"Unknown"}`,i=`WasmVqe ${this.vqeProvider?.getVersion()??"Unknown"}`;return`${e} / ${t} / ${i}`}getStats(){let e=this.configProvider.config.wasmvqe.enableVqe?this.vqeProvider?.getStats():this.dnsProvider?.getStats();if(!e){if(!this.statistics.hasData())return null;e={}}return e.userNoiseSuppressionMethod=this.noiseSuppressionModeInternal.userMode,{timestamp:Date.now(),...this.createTelemetryEvent(e)}}notifyError(e,t,i=!1){this.logger.error(`Audio effect error: ${e}, message: ${t}`),this.statistics.setError(e,t),this.notifyAboutLastSessionStats(),i&&(this.stop(),this.requestStreamUpdate(),this.hasError=!0),this.event("onEffectsError").raise("Audio",e,t)}async signalContentSharingStateChanged(e){let t=null;if(this.logger.safe.info(`Signal content sharing state changed: ${e}`),e){if(this.contentSharingSessionStarted)return;this.noiseSuppressionModeInternal.contentSharingMode=this.configProvider.config.wasmvqe.contentSharingVqeMode,t=this.vqeModeToAudioEffectType(this.configProvider.config.wasmvqe.contentSharingVqeMode),this.processingFlagsInternal.current=this.configProvider.config.wasmvqe.contentSharingAudioProcessingFlags}else{if(!this.contentSharingSessionStarted)return;this.noiseSuppressionModeInternal.contentSharingMode=null,t=this.vqeModeToAudioEffectType(this.noiseSuppressionModeInternal.userMode??this.configProvider.config.wasmvqe.defaultVqeMode),this.processingFlagsInternal.current=this.processingFlagsInternal.default}this.statistics.registerContentSharingEvent({state:e,timestamp:Date.now(),vqeMode:this.audioEffectToWasmAudioEffectType[t],audioProcessingFlags:this.audioProcessingFlags}),this.logger.safe.info(`Content sharing. Parameters to appy: new audio effect: ${t}, new audioProcessingFlags: ${this.audioProcessingFlags}`),this.contentSharingSessionStarted=e,this.vqeProvider&&(await this.vqeProvider.setEffectAsync(this.audioEffectToWasmAudioEffectType[t]),this.requestStreamUpdate())}async initialize(){this.stopped||this.stop(),this.statistics.startLoadTimer(),await this.initializeProvider(),this.effectProviderSubs=[this.vqeProvider?.on("onEffectStopped",()=>this.notifyAboutLastSessionStats()),this.vqeProvider?.on("onMetricsUpdated",()=>this.notifyAboutLastSessionStats()),this.vqeProvider?.on("onErrorNotified",(e,t)=>this.notifyError("WasmVqeProcessorError",e,t))],await this.configureEffect(),this.isProviderReady=!0,this.statistics.stopLoadTimer(),this.requestStreamUpdate()}async initializeProvider(){if(this.configProvider.config.wasmvqe.enableVqe&&!this.vqeProvider){this.logger.safe.debug("Initializing VQE provider ..."),this.vqeProvider=await this.initializeAudioEffectProvider(v.AudioEffectType.VoiceQualityEnhancementDeep);return}this.configProvider.config.wasmdns.enableNoiseSuppression&&!this.dnsProvider&&(this.logger.safe.debug("Initializing DNS provider ..."),this.dnsProvider=await this.initializeAudioEffectProvider(v.AudioEffectType.NoiseSuppressionDeep)),this.configProvider.config.wasmdns.enableNoiseSuppression&&!this.aecProvider&&(this.logger.safe.debug("Initializing AEC provider ..."),this.aecProvider=await this.initializeAudioEffectProvider(v.AudioEffectType.EchoCancellationClassic))}async configureEffect(e){this.statistics.clearErrors();let t=e;if(this.wasmLoaderSub=this.wasmLoader?.on("onLoadError",e=>{this.handleWasmLoaderError(e)}),!t){let e=this.configProvider.mediaConfig.noiseSuppressionMode;this.logger.safe.info(`Configuring the audio effect manager for Noise Suppression mode: ${e}`),"Auto"===e&&(e=this.configProvider.config.wasmvqe.enableVqe?this.vqeModeToNsMode(this.configProvider.config.wasmvqe.defaultVqeMode):this.configProvider.config.wasmdns.noiseSuppressionMode,this.logger.safe.info(`Overriding 'Auto' with ${e}`)),(t={...this.configProvider.config.wasmdns,...this.configProvider.config.wasmvqe}).noiseSuppressionMode=e}if(await this.getEffectsCapability(),this.configProvider.config.wasmvqe.enableVqe)try{if(!this.vqeProvider)return void this.logger.safe.error("VQE provider is not initialized");t.defaultVqeMode=this.noiseSuppressionModeInternal.contentSharingMode??this.noiseSuppressionModeInternal.userMode??this.configProvider.config.wasmvqe.defaultVqeMode,t.loadAudioWorkletCallback=this.wasmLoader?.audioWorklet?.getWasmVqeWorklet,t.loadWasmWorkerCallback=this.wasmLoader?.audioWorklet?.getWasmVqeWorker,this.logger.safe.debug("Configuring VQE audio effects ..."),await this.vqeProvider.configureEffect(t),this.logger.safe.debug(`The audio effects were configured as follows: ${t$(t)}, and current capability is ${this.currentEffectCapability}.`)}catch(e){this.notifyError("FailedToInitialize",`Audio effect provider configuration failed (${e}), while trying to use this configuration: ${t$(t)},
                    under the following capability: ${this.currentEffectCapability}.`,!0)}else if(this.configProvider.config.wasmdns.enableNoiseSuppression){t.noiseSuppressionMode||(this.logger.safe.debug("configureEffect was called without a noiseSuppressionMode. Using noiseSuppressionMode from config provider ..."),t.noiseSuppressionMode=this.configProvider.mediaConfig.noiseSuppressionMode),this.noiseSuppressionModeInternal.currentEffect=this.noiseSuppressionModeToWasmDnsEffectMapping[t.noiseSuppressionMode],this.logger.safe.debug(`currentEffect is ${this.noiseSuppressionModeInternal.currentEffect}`);try{if(!this.dnsProvider||!this.aecProvider)return void this.logger.safe.debug("DNS & AEC providers not initialized");this.logger.safe.debug("Configuring DNS/AEC audio effects ..."),t.loadAudioWorkletCallback=this.wasmLoader?.audioWorklet?.getWasmDnsWorklet,await this.dnsProvider.configureEffect(t),t.loadAudioWorkletCallback=this.wasmLoader?.audioWorklet?.getWasmAecWorklet,await this.aecProvider.configureEffect(t),this.logger.safe.debug(`The audio effects were configured as follows: ${t$(t)}, and current capability is ${this.currentEffectCapability}.`)}catch(e){this.notifyError("FailedToInitialize",`Audio effect provider configuration failed (${e}), while trying to use this configuration: ${t$(t)},
                    under the following capability: ${this.currentEffectCapability}.`,!0)}}}async initializeAudioEffectProvider(e){let t;if(!this.wasmVqeProvider&&e===v.AudioEffectType.VoiceQualityEnhancementDeep)return this.statistics.setError("FailedToInitialize","initializeAudioEffectProvider: WasmVqe package not available."),this.logger.safe.warn("WasmVqe package not available."),null;if(!this.wasmdnsProvider&&e===v.AudioEffectType.NoiseSuppressionDeep)return this.statistics.setError("FailedToInitialize","initializeAudioEffectProvider: WasmDns package not available."),this.logger.safe.warn("WasmDns package not available."),null;if(!this.wasmaecProvider&&e===v.AudioEffectType.EchoCancellationClassic)return this.statistics.setError("FailedToInitialize","initializeAudioEffectProvider: WasmAec package not available."),this.logger.safe.warn("WasmAec package not available."),null;try{this.configProvider.config.wasmvqe.enableVqe&&e===v.AudioEffectType.VoiceQualityEnhancementDeep&&(t=await this.wasmVqeProvider.getAudioEffectProvider()),this.configProvider.config.wasmdns.enableNoiseSuppression&&e===v.AudioEffectType.NoiseSuppressionDeep&&(t=await this.wasmdnsProvider.getAudioEffectProvider()),this.configProvider.config.wasmdns.enableNoiseSuppression&&e===v.AudioEffectType.EchoCancellationClassic&&(t=await this.wasmaecProvider.getAudioEffectProvider())}catch(e){this.logger.safe.warn(`initializeAudioEffectProvider: Failed to initialize the audio effect provider (${e})`),this.statistics.setError("FailedToInitialize",`initializeAudioEffectProvider: Failed to initialize the audio effect provider (${e})`)}return(this.statistics.stopLoadTimer(),t)?(e===v.AudioEffectType.VoiceQualityEnhancementDeep&&this.logger.safe.debug(`WasmVqe v${t.getVersion?.()} initialized!`),e===v.AudioEffectType.NoiseSuppressionDeep&&this.logger.safe.debug(`WasmDns v${t.getVersion?.()} initialized!`),e===v.AudioEffectType.EchoCancellationClassic&&this.logger.safe.debug(`WasmAec v${t.getVersion?.()} initialized!`),t):(this.logger.safe.warn("Unitialized Wasm audio effect provider."),null)}createTelemetryEvent(e){return{payload:{audioEffectsCapability:this.currentEffectCapability,version:this.getVersion(),isProviderReady:this.isProviderReady,...this.statistics.getReport(),...e}}}notifyAboutLastSessionStats(){let e=this.getStats();e&&this.event("onAudioEffectTelemetryEvent").raise(e)}handleWasmLoaderError(e){"wasmvqe"===e&&this.notifyError("FailedToInitialize","Error loading additional scripts",!0)}requestStreamUpdate(){this.hasError||(this.logger.warn("Requesting stream update"),this.event("onMediaStreamUpdateRequested").raise("Audio"))}};eM([xF()],xH.prototype,"setSourceWithAsyncInitialization",1),eM([xF()],xH.prototype,"setSourceAsync",1),eM([xF()],xH.prototype,"setAecRefStream",1),eM([xF()],xH.prototype,"setEffectAsync",1),eM([xF()],xH.prototype,"stop",1),eM([xF()],xH.prototype,"dispose",1);var xj=class{constructor(e){this.logger=e}async setSourceAsync(e){let t=document.createElement("video");return t.srcObject=e,this.logger.info(`Stream settings before play: ${JSON.stringify(this.getSettings(e))}`),await t.play(),this.logger.info(`Stream settings after play: ${JSON.stringify(this.getSettings(e))}`),t.pause(),t.srcObject=null,t.remove(),t=null,e}getSettings(e){return e.getVideoTracks()?.[0]?.getSettings()}},xq=class extends no{constructor(e,t){super(),this.configProvider=e,this.logger=t}get audioProcessingFlags(){return this.audioEffectManager?.audioProcessingFlags}set audioProcessingFlags(e){this.audioEffectManager&&(this.audioEffectManager.audioProcessingFlags=e)}async signalContentSharingStateChanged(e){if(this.configProvider.config.wasmvqe.enableFallbackForContentSharing&&this.configProvider.config.wasmvqe.enableAec)return this.audioEffectManager?.signalContentSharingStateChanged(e)}isEffectEnabled(e){switch(e){case"Video":return this.videoEffectManager?.isEffectEnabled;case"Audio":return this.audioEffectManager?.isEffectEnabled;default:return!1}}addEffectManager(e,t){switch(e){case"Audio":this.addAudioEffectManagerAndSubscribe(t);break;case"Video":this.delayedVideoEffectManager=new xj(this.logger.createChild("DelayedVideoEffectManager")),this.addVideoEffectManagerAndSubscribe(t);break;case"ScreenShare":this.delayedScreenShareEffectManager=new xj(this.logger.createChild("DelayedScreenShareEffectManager"))}}async startEffect(e,t){switch(e){case"Audio":return this.initAudioEffectsWithTimeout(t);case"Video":if(this.configProvider.config.waitForVideoEffectStreamStart){let e=await this.videoEffectManager.setSourceAsync(t);return this.delayedVideoEffectManager.setSourceAsync(e)}return this.videoEffectManager.setSourceAsync(t);case"ScreenShare":return this.delayedScreenShareEffectManager.setSourceAsync(t);default:return t}}async setEffectType(e,t){switch(e){case"Audio":return this.audioEffectManager?.setEffectAsync(t);case"Video":return this.videoEffectManager?.setEffectAsync(t)}}async processingVideoEffectMessage(e){return this.videoEffectManager.processingVideoEffectMessage(e)}stopEffect(e,t){switch(e){case"Audio":this.logger.safe.info("stopping audio effect"),this.audioEffectManager?.dispose();break;case"Video":this.logger.safe.info("stopping video effect"),this.videoEffectManager?.removeSourceAsync(t)}}resetOutputConstraints(e,t,i){"Video"===e&&this.videoEffectManager?.resetOutputConstraints(t,i)}getStats(e,t){switch(e){case"Audio":return this.audioEffectManager?.getStats();case"Video":return this.videoEffectManager?.getStats(t);default:return}}async configure(e,t){if("Video"===e)return this.videoEffectManager?.configure(t)}async getEffectsCapability(e){switch(e){case"Audio":return this.audioEffectManager?.getEffectsCapability();case"Video":return this.videoEffectManager?.getEffectsCapability();default:return 0}}setAecRefStream(e,t){return this.audioEffectManager.setAecRefStream(e,t)}vqeModeToAudioEffectType(e){return this.audioEffectManager.vqeModeToAudioEffectType(e)}nsModeToVqeMode(e,t){return this.audioEffectManager.nsModeToVqeMode(e,t)}getAudioEffectsProviderName(){let e="None";return this.configProvider.config.wasmvqe.enableVqe?e="DeepVqe":this.configProvider.config.wasmdns.enableNoiseSuppression&&(e="DNS"),e}dispose(){super.dispose(),this.audioEffectManager?.dispose(),this.audioEffectManager=null,this.videoEffectManager?.dispose(),this.videoEffectManager=null}async initAudioEffectsWithTimeout(e){return new Promise((t,i)=>{let n=window.setTimeout(()=>{let i=`AudioEffects init timeout. Init took more then ${this.configProvider.config.wasmvqe.initializationTimeoutMs} ms`;this.logger.warn(i),this.audioEffectManager.notifyError("InitializationTimeout",i),t(e)},this.configProvider.config.wasmvqe.initializationTimeoutMs);this.configProvider.config.wasmvqe.asyncInitialization?this.audioEffectManager.setSourceWithAsyncInitialization(e).then(e=>{clearTimeout(n),t(e)}):this.audioEffectManager.setSourceAsync(e).then(e=>{clearTimeout(n),t(e)})})}addAudioEffectManagerAndSubscribe(e){this.audioEffectManager||(this.audioEffectManager=new xH(e.wasmdnsProvider,e.wasmaecProvider,e.wasmVqeProvider,this.configProvider,this.logger.createChild("AudioEffectManager"),e.wasmLoader),this.audioEffectManager.on("onAudioEffectTelemetryEvent",e=>{this.event("onAudioEffectTelemetryEvent").raise(e)}),this.audioEffectManager.on("onMediaStreamUpdateRequested",e=>{this.event("onMediaStreamUpdateRequested").raise(e)}),this.audioEffectManager.on("onEffectsError",(e,t,i)=>{this.event("onEffectsError").raise(e,t,i)}))}addVideoEffectManagerAndSubscribe(e){this.videoEffectManager||(this.videoEffectManager=new xV(e.webcvProvider,this.configProvider,this.logger.createChild("VideoEffectManager"),e.wasmLoader),this.videoEffectManager.on("onMediaStreamUpdateRequested",e=>{this.event("onMediaStreamUpdateRequested").raise(e)}),this.videoEffectManager.on("onVideoEffectQualityChanged",e=>{this.event("onVideoEffectQualityChanged").raise(e)}),this.videoEffectManager.on("onVideoStreamQualityChanged",(e,t,i)=>{this.event("onVideoStreamQualityChanged").raise(e,t,i)}),this.videoEffectManager.on("onVideoEffectCapabilitiesChanged",()=>{this.event("onVideoEffectCapabilitiesChanged").raise()}),this.videoEffectManager.on("onVideoEffectTelemetryEvent",e=>{this.event("onVideoEffectTelemetryEvent").raise(e)}),this.videoEffectManager.on("onVideoEffectApplied",()=>{this.event("onVideoEffectApplied").raise()}),this.videoEffectManager.on("videoFreezeDetected",e=>{this.event("videoFreezeDetected").raise(e)}))}},xW=class{constructor(e){this.audioContext=new mk.AudioContext,e?(this.sourceNode=this.audioContext.createMediaStreamSource(e),this.analyzerNode=this.createAnalyserNode(this.sourceNode),this.freqs=new Uint8Array(this.analyzerNode.frequencyBinCount),this.ffreqs=new Float32Array(this.analyzerNode.frequencyBinCount)):(this.freqs=new Uint8Array(0),this.ffreqs=new Float32Array(0))}dispose(){this.sourceNode.disconnect(),this.audioContext.close(),this.audioContext=null,this.sourceNode=null,this.analyzerNode=null,this.freqs=null}getData(e){return 1===e?this.analyzerNode?.getByteFrequencyData(this.freqs):0===e&&this.analyzerNode?.getByteTimeDomainData(this.freqs),this.freqs}getDataFloat(e){return 1===e?this.analyzerNode?.getFloatFrequencyData(this.ffreqs):0===e&&this.analyzerNode?.getFloatTimeDomainData(this.ffreqs),this.ffreqs}getInputLevel(){return this.analyzerNode?.getByteFrequencyData(this.freqs),nV(this.freqs)}getInputLevelNormalized(e=65535,t=255){return Math.floor(this.getInputLevel()*e/t)}createAnalyserNode(e){let t=this.audioContext.createAnalyser();return t.fftSize=1024,t.smoothingTimeConstant=.1,e.connect(t),t}},xG=class{constructor(e,t){this.getAudioStream=e,this.logger=t,this.initialized=!1,this.disposeCachedStream=!1}async init(){if(this.initialized=!0,!this.cachedStream)return this.createStream();this.createAnalyzer()}getInputLevel(){if(!this.initialized||!this.audioStreamAnalyzer)return 0;try{return this.audioStreamAnalyzer.getDataFloat(0).reduce((e,t)=>Math.max(Math.abs(t),e),0)}catch(e){return this.logger.error(JSON.stringify(e)),0}}getInputLevelNormalized(e,t){throw Error("Method not implemented.")}dispose(e){this.logger.safe.info(`[${e}] AudioStreamAnalyzerWrapper disposed`),this.disposeStreamAnalyzer(),this.disposeStream(),this.initialized=!1}async updateStreamAfterDeviceChange(){this.initialized&&this.disposeCachedStream&&(this.disposeStream(),await this.createStream())}setStream(e,t){if(!this.initialized){this.cachedStream=e;return}"AudioStreamAnalyzerWrapper"!==t&&this.disposeStream(),this.cachedStream=e,this.createAnalyzer()}createAnalyzer(){this.disposeStreamAnalyzer(),this.audioStreamAnalyzer=new xW(this.cachedStream.getMasterStream().rawStream),this.logger.safe.info("AudioStreamAnalyzerWrapper created")}async createStream(){await this.getAudioStream(!1,"AudioStreamAnalyzerWrapper"),this.disposeCachedStream=!0}disposeStreamAnalyzer(){this.audioStreamAnalyzer?.dispose(),this.audioStreamAnalyzer=null}disposeStream(){this.disposeCachedStream&&(this.cachedStream?.getMasterStream()?.dispose(),this.cachedStream?.dispose(),this.cachedStream=null,this.disposeCachedStream=!1)}},xz=class e extends no{constructor(t,i,n,r,s,a,o,l,c,d){super(t),this.logger=t,this.configProvider=i,this.diagnostics=n,this.domOverrides=r,this.ufdManager=s,this.id=nR(),this.virtualDeviceRecord=new Map,this.deviceEnumerator=new xM(this.configProvider,this.logger.createChild("DeviceEnumerator")),this.deviceSelection=new xD(xM.list,this.configProvider,this.logger.createChild("DeviceSelection")),this.permissionManager=new xx(this.configProvider,{getMediaStream:e=>this.getMediaStream({...e,withEffect:!1,withTimeout:!0,force:!1,audioProcessingFlags:e.audio&&!e.video?this.effectsManager.audioProcessingFlags:void 0},"permissionManager"),hasCamera:()=>this.hasDeviceType("camera"),raiseTelemetryEvent:(e,t)=>this.raiseTelemetryEvent(e,t),getActiveConstraints:()=>this.mediaStreamManager.getActiveConstraints(),handlePermissionStateChange:()=>this.handlePermissionStateChange()},this.logger.createChild("PermissionManager")),this.activeRenderers=[],this.selectedDevices={camera:null,microphone:null,speaker:null,audioIngestDevice:null},this.pendingDevices=null,this.deviceManagerSubscriptions=[],this.streamManagerSubscriptions=[],this.streamSubscriptions=new Map,this.rendererSubscriptions=new Map,this.rawDeviceStreamManager=new N1(this.logger.createChild("RawDeviceStream"),this.raiseTelemetryEvent.bind(this)),this.customDeviceMediaStreamMap=new Map,this.clientAudioRenderers=new Map,this.audioStreamAnalyzerWrapper=new xG((e,t)=>this.getAudioStream(e,t),this.logger.createChild("AudioStreamAnalyzerWrapper")),this.audioSharingRequested=!1,this.virtualDeviceSubs=new Map,this.effectsManagerInternal=new xq(this.configProvider,this.logger.createChild("EffectsManager")),this.effectsManagerInternal.addEffectManager("Audio",{wasmdnsProvider:o,wasmaecProvider:l,wasmVqeProvider:c,wasmLoader:d}),this.effectsManagerInternal.addEffectManager("Video",{webcvProvider:a,wasmLoader:d}),this.effectsManagerInternal.addEffectManager("ScreenShare",null),this.mediaStreamManager=new xl(this.logger.createChild("MediaStreamManager"),this.configProvider,this.effectsManager),this.deviceManagerSubscriptions=[this.permissionManager.on("onPermissionStateChanged",e=>this.event("onPermissionStateChanged").raise(e)),xM.list.on("onDevicesChanged",(e,t)=>this.onDevicesChanged(e,t)),this.deviceSelection.on("onSelectedDevicesChanged",(e,t)=>this.onSelectedDevicesChanged(e,t)),this.effectsManager.on("onAudioEffectTelemetryEvent",e=>{this.diagnostics.registerAudioEffectsEvent(nw(e)),this.event("onAudioEffectsTelemetryEvent").raise(e)}),this.effectsManager.on("onMediaStreamUpdateRequested",e=>this.onMediaStreamUpdateRequested(e,!0)),this.effectsManager.on("onVideoEffectQualityChanged",e=>this.onVideoEffectsQualityEventHandler(e)),this.effectsManager.on("onVideoEffectTelemetryEvent",e=>{this.diagnostics.registerVideoEffectsEvent(nw(e)),this.event("onVideoEffectsTelemetryEvent").raise(e)}),this.effectsManager.on("onVideoEffectApplied",()=>{this.raiseTelemetryEvent("video_effect_applied",{}),this.event("onVideoEffectApplied").raise()}),this.effectsManager.on("onEffectsError",(e,t,i)=>this.event("onEffectsError").raise(e,t,i))],this.subscribeOnStreamManagerEvents(),this.subscribeOnDeviceEnumeratorEvents(),this.deviceList.length&&this.onSelectedDevicesChanged(this.deviceSelection.selectedDevices,!1),this.createChildDeviceManager=t=>new e(t,i,new xc(i),r,s,a,o,l,c,d)}get deviceList(){return xM.list.devices}get isDeviceListAvailable(){return xM.isDeviceListAvailable}get isAudioOutputSelectionSupported(){return this.configProvider.userAgentConfig.isAudioOutputSelectionSupported}get effectsManager(){return this.effectsManagerInternal}createPreviewRenderer(e,t){let i=new xo(e,this,this.logger.createChild("videorenderer"),this.configProvider,t);return this.domOverrides.onMediaElementAdded&&this.domOverrides.onMediaElementAdded(i.getVideoElement()),this.subscribeOnRendererEvents(i),i}async askDevicePermission(e){await this.isDeviceListAvailable.promise;let t=await this.permissionManager.askDevicePermission(e);if(this.configProvider.config.devices.enumerateDevicesAfterADP)try{await xM.enumerateDevices()}catch(e){this.logger.safe.warn(`Post-ADP device enumeration failed: ${t$(e)}`)}return t}getPermissionState(e){return this.permissionManager.getPermissionState(e)}handlePermissionStateChange(){this.diagnostics&&(this.diagnostics.permissionStates=this.permissionManager.knownPermissionStates),this.event("onPermissionStateChanged").raise(this.permissionManager.knownPermissionStates)}onMediaStreamUpdateRequested(e,t=!1){"Video"===e&&this.updateRenderersAsync(),"Audio"===e&&t&&this.rawDeviceStreamManager.notifyChange("Audio"),this.event("onStreamUpdateRequested").raise(e,t)}createAudioRenderer(){let e=new N2(this.logger.createChild("CustomAudioRenderer"),this.configProvider),t=e.id;this.clientAudioRenderers.set(t,e);let i=e.play.bind(e),n=e.stop.bind(e);return this.raiseTelemetryEvent("custom_audio_renderer_created",this.getSelectedDevices()),{play:i,stop:n,dispose:()=>{this.clientAudioRenderers.get(t)?.dispose(),this.clientAudioRenderers.delete(t)},setMuted:(t,i=e9())=>e.setMuted(t,i),isMuted:()=>e.muted}}setAudioSharingRequested(e){this.audioSharingRequested=e}createDevicesHandle(e,t,i){let n=e.sharing?"ScreenShare":e.video?"Video":"Audio";return new xO(this.logger.createChild("DevicesHandle"),this.getMediaStream({...e,...i&&{deviceId:i},withTimeout:!1,withEffect:!1,audioProcessingFlags:this.effectsManager.audioProcessingFlags,force:!1,withOverridenStream:this.customDeviceMediaStreamMap.get(n)?.active&&this.customDeviceMediaStreamMap.get(n)},t))}shareSystemSound(e){this.configProvider.config.postponeAudioMixerForAudioSharing&&(this.audioSharingRequested=e,this.event("onAudioSharingToggled").raise(e))}getAllowedModalities(){let e=nI(this.permissionManager.browserPermittedModalities);return this.hasDeviceType("microphone")||(e.audio=[nu.MEDIA_STATE.inactive,nu.MEDIA_STATE.receive]),this.hasDeviceType("camera")||(e.video=[nu.MEDIA_STATE.inactive,nu.MEDIA_STATE.receive]),e}getRawDeviceMediaStream(e,t){if("ScreenShare"!==e&&!this.hasDeviceType(this.getDeviceType(e)))throw Error("NoInputDevice");this.audioSharingRequested=t;let i=this.getStreamHandlerByType(e);if(!i)return this.logger.safe.debug(`method not found for ${e}`),null;let n=this.rawDeviceStreamManager.createIRawStreamClient(i,e);return this.raiseTelemetryEvent("IRawStream_client_created",e),n}setRawMediaStream(e,t){if(!e)throw this.logger.error(`Could not set ${e} as to ${t}`),Error("InvalidStream");this.customDeviceMediaStreamMap.set(t,e),this.onMediaStreamUpdateRequested(t),this.raiseTelemetryEvent("set_raw_outgoing_media_stream",t)}unsetRawMediaStream(e){if(!this.customDeviceMediaStreamMap.get(e))return void this.logger.safe.debug("no custom stream");this.customDeviceMediaStreamMap.delete(e),this.onMediaStreamUpdateRequested(e),this.raiseTelemetryEvent("unset_raw_outgoing_media_stream",e)}async setVideoEffects(e){return this.effectsManager.setEffectType("Video",e)}async sendMessageDeviceVideoEffectsAsync(e,t){return this.effectsManager.processingVideoEffectMessage(t)}async setAudioEffects(e){return this.effectsManager.setEffectType("Audio",e)}setAecRefStream(e,t){this.effectsManager.setAecRefStream(e,t)}async getAudioStream(e,t,i=!1){let n=this.configProvider.config.devices.enumerateBeforeGettingStream;return n&&("always"===n||!xM.isPolling)&&await xM.enumerateDevices(),this.getMediaStream({audio:!0,withTimeout:this.permissionManager.isPermissionKnown("microphone"),withEffect:this.effectsManager.isEffectEnabled("Audio"),audioProcessingFlags:this.effectsManager.audioProcessingFlags,force:e,withOverridenStream:!i&&this.customDeviceMediaStreamMap.get("Audio")?.active&&this.customDeviceMediaStreamMap.get("Audio")},t)}async getVideoStream(e,t,i=!1,n){let r=this.configProvider.config.devices.enumerateBeforeGettingStream;return r&&("always"===r||!xM.isPolling)&&await xM.enumerateDevices(),this.getMediaStream({video:!0,withTimeout:this.permissionManager.isPermissionKnown("camera"),withEffect:!i&&this.configProvider.config.enableVideoEffects&&this.effectsManager.isEffectEnabled("Video"),force:e,withOverridenStream:!i&&this.customDeviceMediaStreamMap.get("Video")?.active&&this.customDeviceMediaStreamMap.get("Video"),videoMaxFS:n},t)}getDisplayStream(e,t=!1){let i=!!(this.configProvider.config.enableAudioSharing&&this.audioSharingRequested);return this.getMediaStream({audio:i,sharing:!0,withTimeout:!1,withEffect:!1,audioProcessingFlags:i?0:void 0,force:!1,withOverridenStream:!t&&this.customDeviceMediaStreamMap.get("ScreenShare")?.active&&this.customDeviceMediaStreamMap.get("ScreenShare")},e)}async enumerateDevicesAsync(){return await this.isDeviceListAvailable.promise,this.getDeviceDescriptions(this.deviceList)}async getDeviceNameAsync(e){await this.isDeviceListAvailable.promise;let t=this.deviceList.find(t=>t.guid===e);return t?.label??""}async getSpeakerDeviceDomIdAsync(e){await this.isDeviceListAvailable.promise;let t=this.deviceList.find(t=>t.guid===e);return t?.deviceId??""}selectDevices(e){if(this.pendingDevices){this.logger.safe.info(`Overriding device selection until enumeration is complete with ${JSON.stringify(va(this.pendingDevices))}`),this.pendingDevices=e;return}if(this.isDeviceListAvailable.isPending){this.logger.safe.info("Postponing device selection until enumeration is complete"),this.pendingDevices=e,this.isDeviceListAvailable.promise.then(()=>{this.logger.safe.info("Performing postponed device selection");let e=this.pendingDevices;this.pendingDevices=null,this.selectDevices(e)});return}this.deviceSelection.selectDevices(e)}getSelectedDevices(){return this.toSelectedDevices(this.deviceSelection.selectedDevices)}setAudioProcessingFlags(e){this.effectsManager.audioProcessingFlags=e}getOutputDeviceId(){return this.selectedDevices.speaker?.deviceId}getDeviceDescriptions(e){return(e||this.deviceList).map(e=>e.toDeviceDesc())}getDevicesCount(){return this.deviceList.reduce((e,t)=>(e[t.type]++,e),{camera:0,speaker:0,microphone:0,compositeAudio:0,virtualDevice:0,audioIngestDevice:0})}async getKnownPermissionStates(){return await this.permissionManager.initialize(),this.permissionManager.knownPermissionStates}getLocalVideoRenderers(){return this.activeRenderers}dispose(){this.deviceManagerSubscriptions?.forEach(e=>e.dispose()),this.deviceManagerSubscriptions=null,this.virtualDeviceSubs?.forEach(e=>e.forEach(e=>e.dispose())),this.virtualDeviceSubs?.clear(),this.virtualDeviceSubs=null,this.virtualDeviceRecord?.forEach(e=>e.dispose()),this.virtualDeviceRecord=null,this.unsubscribeFromStreamManagerEvents(),this.deviceEnumerator.dispose(),this.mediaStreamManager.dispose(),this.activeVideoEffectSub?.dispose(),this.activeVideoStreamForEffect?.dispose(),this.disposeRawStreamAccess(),this.disposeClientAudioRenderer(),this.effectsManager.dispose(),super.dispose()}async registerVirtualDevice(e,t){let i=e.length?e.map(({id:e},t)=>{let i=this.createChildDeviceManager(this.logger.createChild(`VirtualDevice-${t}`));return i.selectDevices({camera:e}),i}):[this.createChildDeviceManager(this.logger.createChild("VirtualDevice"))],n=new xL(i,t),r=n.id,s=[n.on("onVideoEffectApplied",(...e)=>this.event("onVideoEffectApplied").raise(...e)),n.on("onVideoEffectsEvent",(...e)=>this.event("onVideoEffectsEvent").raise(...e)),n.on("onDeviceTelemetryEvent",(...e)=>this.event("onDeviceTelemetryEvent").raise(...e)),n.on("onVideoEffectsTelemetryEvent",(...e)=>this.event("onVideoEffectsTelemetryEvent").raise(...e)),n.on("onDevicesPermissionChanged",(...e)=>this.event("onDevicesPermissionChanged").raise(...e)),n.on("onStreamUpdateRequested",(...e)=>this.event("onStreamUpdateRequested").raise(...e))];return this.virtualDeviceSubs.set(r,s),this.virtualDeviceRecord.set(r,n),xM.list.updateVirtualDeviceList(this.getRegisteredDevices()),this.raiseTelemetryEvent("register_virtual_device",{deviceCount:i.length,id:r}),this.event("onVirtualDevicesChanged").raise(),r}async unregisterVirtualDevice(e){if(!this.virtualDeviceRecord.has(e))return void this.logger.error(`No virtual device found with id ${e}`);this.virtualDeviceSubs.get(e).forEach(e=>e.dispose()),this.virtualDeviceSubs.delete(e),this.virtualDeviceRecord.get(e).dispose(),this.virtualDeviceRecord.delete(e),xM.list.updateVirtualDeviceList(this.getRegisteredDevices()),this.event("onVirtualDevicesChanged").raise(),this.raiseTelemetryEvent("unregister_virtual_device",{id:e})}getRegisteredDevices(){return Array.from(this.virtualDeviceRecord.values())}async getNrgLevelPollerForDeviceTuner(){return await this.audioStreamAnalyzerWrapper.init(),this.audioStreamAnalyzerWrapper}disposeClientAudioRenderer(){this.clientAudioRenderers.size&&(this.clientAudioRenderers.forEach(e=>{e.dispose()}),this.clientAudioRenderers.clear(),this.raiseTelemetryEvent("custom_audio_renderer_disposed",this.getSelectedDevices()))}disposeRawStreamAccess(){this.rawDeviceStreamManager.disposeAll(),this.rawDeviceStreamManager=null}toSelectedDevices(e){return Object.entries(e).reduce((e,[t,i])=>(i&&(e[t]=i.guid),e),{})}getStreamConstraints(e){return{deviceId:e?.deviceId||void 0}}hasDeviceType(e){return nb(this.deviceList).some(t=>t.type===e)}getConstraints(e){if(!e.audio&&!e.video&&!e.sharing)throw Error("requesting nothing");if(this.logger.safe.info(`retrieving media stream: ${JSON.stringify(e)}`),e.sharing){let t,i=this.selectedDevices.audioIngestDevice;return{audio:t=i&&e.deviceId?{deviceId:i.deviceId}:e.audio&&!e.deviceId?{deviceId:nu.SYSTEM_AUDIO_SOURCE_ID}:void 0,sharing:{deviceId:e.deviceId||nu.DISPLAY_SOURCE_ID},withTimeout:e.withTimeout,withEffect:!1,audioProcessingFlags:e.audioProcessingFlags,force:!1,withOverridenStream:e.withOverridenStream}}let t=this.selectedDevices.microphone,i=this.selectedDevices.camera,n=e.audio&&t,r=e.video&&i;if(!n&&!r)throw{type:nu.MEDIA_ERROR.noDeviceSelected,detail:`audio requested ${e.audio}, video requested: ${e.video} Devices: ${JSON.stringify(this.deviceList.map(e=>JSON.stringify(vo(e,this.configProvider.config.devices.piiSafeWords))))}`};let s=this.getStreamConstraints(t),a=this.getStreamConstraints(i);this.configProvider.config.audioSampleRate&&(this.logger.safe.info(`Audio sampleRate constraint overridden to ${this.configProvider.config.audioSampleRate}`),s={...s,sampleRate:{ideal:this.configProvider.config.audioSampleRate}});let o=e.audioProcessingFlags;return void 0!==o&&e.audio&&!e.video&&t?.capabilities&&(t.capabilities.echoCancellation&&!t.capabilities.echoCancellation.includes(!!(2&o))&&(o^=2),t.capabilities.autoGainControl&&!t.capabilities.autoGainControl.includes(!!(1&o))&&(o^=1),t.capabilities.noiseSuppression&&!t.capabilities.noiseSuppression.includes(!!(4&o))&&(o^=4)),o!==e.audioProcessingFlags&&this.logger.safe.warn(`Unable to fulfill processing flags ${e.audioProcessingFlags}, using ${o} instead`),{audio:e.audio?s:void 0,video:e.video?a:void 0,withTimeout:e.withTimeout,withEffect:e.withEffect,audioProcessingFlags:o,force:e.force,withOverridenStream:e.withOverridenStream,videoMaxFS:e.videoMaxFS}}getMediaStream(e,t){let i=this.getConstraints(e),n=this.mediaStreamManager.getMediaStream(i,t);return this.subscribeOnStreamEvents(n),n.start().then(()=>{let i=n.hasAudio(),r=n.hasVideo();i&&(this.signalDeviceGood("Audio",n.rawTrack.muted),this.audioStreamAnalyzerWrapper.setStream(n,t)),r&&this.signalDeviceGood(n.mediaType,n.rawTrack.muted),this.permissionManager.update(e,e)}).catch(t=>this.handleUserMediaError(e,t)),n}signalDeviceGood(e,t){this.ufdManager.signalDeviceEvent(0,"Good",e,this.id),this.ufdManager.signalDeviceEvent(2,"Good",e,this.id),this.ufdManager.signalDeviceEvent(4,"Good",e,this.id),!t&&("Audio"===e||this.configProvider.config.raiseVideoMuteUfd)&&this.ufdManager.signalDeviceEvent(3,"Good",e,this.id)}handleUserMediaError(e,t){let i=this.getMediaType(e),n=e.audio&&e.video,r=(e,t)=>{n||this.ufdManager.signalDeviceEvent(e,t,i,this.id)},s=e=>{n||"Audio"!==i||this.diagnostics.registerAudioRenderError(e)};switch(t.type){case nu.MEDIA_ERROR.permissionDeniedError:"ScreenShare"!==i&&(r(4,"Bad"),s(0x800000000000),this.configProvider.config.permissions.persistOnDeniedError&&this.refreshPermissions(e));break;case nu.MEDIA_ERROR.permissionDeniedBySystemError:r(4,"Bad"),s(0x800000000000);break;case nu.MEDIA_ERROR.sourceUnavailableError:r(0,"Bad"),s(512);break;case nu.MEDIA_ERROR.mediaStreamRequestTimedOut:r(2,"Bad"),s(0x200000000000);break;default:this.logger.safe.error(`getMediaStream() error: ${t$(t)}`),r(0,"Bad"),s(4194304)}}refreshPermissions(e){let t=e.audio&&!e.video,i=!e.audio&&e.video;return t?void this.permissionManager.update({audio:!0},{audio:!1}):i?void this.permissionManager.update({video:!0},{video:!1}):void 0}getMediaType(e){if(e.sharing)return"ScreenShare";if(e.video)return"Video";if(e.audio)return"Audio";throw Error(`mediaType is not defined for this constraint ${JSON.stringify(e)}`)}subscribeOnStreamEvents(e){let t=[];t.push(e.on("onStreamClientStarted",(e,t)=>this.onStreamStarted(e,t))),t.push(e.on("onStreamClientDisposing",e=>this.onStreamDisposing(e))),t.push(e.on("onStreamClientEnded",(e,t)=>this.onStreamEnded(e,t))),t.push(e.on("onStreamClientMuted",(e,t)=>this.onStreamMuted(e,t))),t.push(e.on("onStreamClientError",(e,t)=>this.onStreamError(e,t))),this.configProvider.config.useRawMediaApiForVideoEffects&&t.push(e.on("onStreamClientDisposed",e=>this.removeVideoEffectStream(e))),this.streamSubscriptions.set(e,t)}async removeVideoEffectStream(e){if(e.getCurrentConstraints().withEffect){this.logger.safe.info(`this.activeVideoEffectSub: ${this.activeVideoEffectSub} to be disposed`),this.activeVideoEffectSub?.dispose();let e=await this.activeVideoStreamForEffect?.getMediaStream();this.effectsManager.stopEffect("Video",e)}}unsubscribeFromStreamEvents(e){this.streamSubscriptions.has(e)&&(this.streamSubscriptions.get(e).forEach(e=>e.dispose()),this.streamSubscriptions.delete(e))}subscribeOnRendererEvents(e){let t=[];t.push(e.on("onRendererDisposed",e=>this.onRendererDisposed(e))),t.push(e.on("onRendererStarted",e=>this.onRendererStarted(e))),this.rendererSubscriptions.set(e,t)}unsubscribeFromRendererEvents(e){this.rendererSubscriptions.has(e)&&(this.rendererSubscriptions.get(e).forEach(e=>e.dispose()),this.rendererSubscriptions.delete(e))}subscribeOnStreamManagerEvents(){this.streamManagerSubscriptions=[],this.streamManagerSubscriptions.push(this.mediaStreamManager.on("onAllStreamsRemoved",()=>this.onAllStreamsRemoved())),this.streamManagerSubscriptions.push(this.mediaStreamManager.on("onStreamAcquired",e=>this.onStreamAcquired(e))),this.streamManagerSubscriptions.push(this.mediaStreamManager.on("onStreamCreated",(e,t,i)=>this.onStreamCreated(e,t,i))),this.streamManagerSubscriptions.push(this.mediaStreamManager.on("onStreamDisposing",(e,t)=>this.onMasterStreamDisposing(e,t)))}subscribeOnDeviceEnumeratorEvents(){this.deviceEnumerator.on("onDeviceEnumerationfailed",e=>this.raiseTelemetryEvent("enumeration_failed",{error:e}))}unsubscribeFromStreamManagerEvents(){this.streamManagerSubscriptions.forEach(e=>e.dispose())}async updateRenderersAsync(){try{await Promise.all(this.activeRenderers.map(e=>e.updateStreamAsync())),this.logger.safe.info("Renderers updates finished")}catch(e){this.logger.safe.error(`Error updating renderers: ${t$(e)}`)}}onSelectedDevicesChanged(e,t){let i=this.selectedDevices;if(this.selectedDevices=e,this.diagnostics.setSelectedDevices(e,t),!("camera"in i^"camera"in this.selectedDevices||"microphone"in i^"microphone"in this.selectedDevices)){let e=this.toSelectedDevices(this.selectedDevices),t=this.toSelectedDevices(i);this.event("onSelectedDevicesChanged").raise(e,t),e.microphone!==t.microphone&&(this.rawDeviceStreamManager.notifyChange("Audio"),this.audioStreamAnalyzerWrapper.updateStreamAfterDeviceChange()),e.camera!==t.camera&&this.rawDeviceStreamManager.notifyChange("Video"),this.clientAudioRenderers.forEach(e=>{e.setOutputDevice(this.getOutputDeviceId())})}let n=this.configProvider.config.devices.piiSafeWords;this.raiseTelemetryEvent("selected_devices_changed",{microphone:this.selectedDevices.microphone&&nH(this.selectedDevices.microphone.label,n),camera:this.selectedDevices.camera&&nH(this.selectedDevices.camera.label,n),speaker:this.selectedDevices.speaker&&nH(this.selectedDevices.speaker.label,n),fromInterface:t}),this.updateRenderersAsync()}onDevicesChanged(e,t){this.event("onDevicesChanged").raise(e,t),this.mediaStreamManager.onDevicesChanged(e),this.diagnostics.setDeviceList(e,t,this.getDeviceListDebugInfo());let i=this.getDevicesCount(),n=i.microphone>0,r=i.speaker>0;this.configProvider.config.devices.detectPermChangeTroughDeviceEnumeration&&this.permissionManager.updatePermissionsFromDeviceList(e),this.ufdManager.signalEvent("ZeroCaptureDevicesEnumerated",n?"Good":"Bad"),n||this.diagnostics.registerAudioCaptureError(1),this.isAudioOutputSelectionSupported&&(this.ufdManager.signalEvent("ZeroRenderDevicesEnumerated",r?"Good":"Bad"),r||this.diagnostics.registerAudioRenderError(1));let s=new Map,a=1;this.raiseTelemetryEvent("devices_changed",{devices:e.map(e=>{let t=s.get(e.groupId)||a++;return s.set(e.groupId,t),{label:nH(e.label,this.configProvider.config.devices.piiSafeWords),isSystemDefault:e.isSystemDefault,kind:e.kind,type:e.type,capabilities:e.capabilities,groupId:`${t}`}}),debug:this.getDeviceListDebugInfo()})}getDeviceListDebugInfo(){return xM.list.debugInfo}raiseTelemetryEvent(e,t){this.logger.safe.info(`Device event: ${e}: ${JSON.stringify(this.scrubPayload(e,t))}`);let i={eventType:e,timestamp:Date.now(),payload:t};this.diagnostics.registerDeviceTelemetryEvent(nw(i)),this.diagnostics.logAudioDeviceError(e,t),this.event("onDeviceTelemetryEvent").raise(i)}scrubPayload(e,t){return"devices_changed"===e?{devices:nb(t.devices).map(e=>vo(e,this.configProvider.config.devices.piiSafeWords)),debug:t.debug}:t}async onStreamStarted(e,t){if(this.permissionManager.browserPermittedModalities.audio.some(e=>e===nu.MEDIA_STATE.send)||this.permissionManager.browserPermittedModalities.video.some(e=>e===nu.MEDIA_STATE.send))try{await xM.enumerateDevices()}catch(e){this.logger.safe.warn(`onStreamStarted device enumeration failed: ${t$(e)}`)}if(!e.rawTrack)return void this.logger.safe.warn(`stream:${e.id} is already disposed`);switch(e.mediaType){case"Audio":this.deviceEnumerator.startDevicePolling(),this.updateActiveMicrophone(e,t);break;case"Video":this.deviceEnumerator.startDevicePolling()}this.configProvider.config.useRawMediaApiForVideoEffects&&e.getCurrentConstraints().withEffect&&(this.activeVideoEffectSub=this.effectsManager.on("onVideoStreamQualityChanged",(t,i,n)=>e.onVideoStreamQualityChanged(t,i,n)))}updateActiveMicrophone(e,t){if(e.deviceId){let i=this.deviceList.find(t=>t.deviceId===e.deviceId);if(!i&&"default"!==e.deviceId)return void this.logger.safe.error("Active device not found",`Device id from track: '${ta(e.deviceId)}', known devices: [${this.deviceList.map(e=>JSON.stringify(vo(e,this.configProvider.config.devices.piiSafeWords)))}]}`,JSON.stringify(vl(t)));i&&"default"!==e.deviceId&&t.audio&&t.audio.deviceId===nu.MEDIA_DEVICE.defaultId&&xM.list.updateActiveMicrophone(i)}}onStreamDisposing(e){this.unsubscribeFromStreamEvents(e)}onStreamMuted(e,t){("Audio"===e.mediaType||this.configProvider.config.raiseVideoMuteUfd)&&this.ufdManager.signalDeviceEvent(3,t?"Bad":"Good",e.mediaType,this.id),"Audio"===e.mediaType&&this.event("onAudioStreamMuted").raise(t),this.raiseTelemetryEvent(t?"stream_muted":"stream_unmuted",e.mediaType)}onStreamEnded(e,t){t.error?(this.raiseTelemetryEvent("stream_ended_error",{mediaType:e.mediaType,error:{type:t.error.name,detail:t.error.message}}),"SourceUnavailableError"===t.error.name&&this.ufdManager.signalDeviceEvent(0,"Bad","Audio",this.id)):(("Audio"===e.mediaType||"Video"===e.mediaType)&&this.ufdManager.signalDeviceEvent(0,"Bad",e.mediaType,this.id),this.raiseTelemetryEvent("stream_ended",e.mediaType))}onStreamError(e,t){this.raiseTelemetryEvent("stream_error",{mediaType:e.mediaType,error:t})}onAllStreamsRemoved(){this.deviceEnumerator.stopDevicePolling(),this.audioSharingRequested=!1}onStreamAcquired({id:e,mediaType:t,timestamp:i,resolution:n,withAudio:r,source:s,sampleRate:a}){0!==i&&this.raiseTelemetryEvent("stream_acquired",{id:e,mediaType:t,timestamp:i,resolution:n,withAudio:r,source:s,sampleRate:a})}onStreamCreated(e,t,i){this.raiseTelemetryEvent("stream_created",{id:e,mediaType:t,forced:i||void 0})}onMasterStreamDisposing(e,t){this.raiseTelemetryEvent("stream_disposed",{id:e,mediaType:t})}onRendererDisposed(e){ny(this.activeRenderers,t=>t===e),this.domOverrides.onMediaElementRemoved?.(e.getVideoElement()),this.unsubscribeFromRendererEvents(e)}onRendererStarted(e){this.activeRenderers.push(e),this.event("onLocalRendererStarted").raise(e)}onVideoEffectsQualityEventHandler(e){let t=this.deviceSelection.selectedDevices.camera;if(t?.deviceId){let i={type:"onVideoEffectQualityChanged",payload:{message:e.message,effectType:e.effectType}};this.event("onVideoEffectsEvent").raise(t.deviceId,i)}}getDeviceType(e){if("Video"===e)return"camera";if("Audio"===e)return"microphone";throw Error(`DeviceType for mediaType: ${e} doesn't exist`)}getStreamHandlerByType(e){return"Video"===e?()=>this.getVideoStream(!1,"rawStream",!0):"Audio"===e?()=>this.getAudioStream(!1,"rawStream",!0):"ScreenShare"===e?()=>Promise.resolve(this.getDisplayStream("rawStream",!0)):null}},xJ=i(892891);function xK(){return is.isEngine("ChromiumAVD")?new xZ:is.isEngine("Safari")?new xX:is.isEngine("Firefox")?new x0:mA()?new x1:is.isEngine("Chromium")?new x2:new xQ}var xQ=class{getInitialSettings(){return{skipNegotiationCapabilitiesCheck:!1,resizeModeForSharing:"none",enableAudioProcessingFallback:!0,allowVirtualDeviceInCall:!1,activeSpeaker:{timeToPromote:1e4},dtmf:{toneDuration:200,toneGap:100},mediaStreamHoldInterval:5e3,webrtcContributingSourcesPollingStartDelay:1e3,webrtcContributingSourcesPollingInterval:1e3,webrtcContributingSourcesPollingEmptySources:0,webrtcIceGatheringTimeoutMs:2e4,webrtcAllowedMediaContentType:nu.ALLOWED_CONTENT_TYPES.SDP_NGC,webrtcMediaContentType:nu.CONTENT_TYPE.SDP_NGC,webrtcScreensharingCapabilityMaxFS:8160,webrtcScreensharingCapabilityMaxFPS:1500,webrtcStatHwSilentDetectionDuration:5,webrtcStatHwSilentDetectionLevel:14,webrtcStatPollInterval:1e3,webrtcStatStoredRecordsNumber:60,webrtcHealedRatioWindowSize:5,webrtcStatNetworkDetectionHysteresis:.01,webrtcStatNetworkDetectionBadLevel:.26,webrtcStatNetworkDetectionGoodLevel:.18,webrtcMinAudioSamplesRecvForNetworkRecvQuality:48e4,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMinMultiparty:5e3,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcVideoCapabilityCheckIntervalMaxMultiparty:5500,webrtcScreensharingCapabilityCheckIntervalMin:0,webrtcScreensharingCapabilityCheckIntervalMax:0,webrtcVideoCapabilityMaxFS:3600,webrtcVideoCapabilityMaxFPS:3e3,webrtcMultiPartyRecvVideoMaxFS:3600,webrtcRecvVideoMaxFS:8160,webrtcCameraOpenFs:3600,minCameraOpenFps:15,maxCameraOpenFps:30,maxCameraFsViaCallConstraints:-1,webrtcMultipartyMaxScalingFs:3600,webrtcMaxScalingFs:8160,webrtcVideoScaling:!1,webrtcVideoScalingMultiparty:!0,enableOptimalVideoCount:!0,ovcBandwidthPerVideoReceiver:18e4,ovcSlidingWindowPercentile:.3,ovcSlidingWindowSamples:20,nonEstimatedDefaultVideoReceiversCount:4,ovcMaxCount:4,ovcMaxCountXL:4,ovcMaxCountMultiStream:16,ovcXLParticipantsCount:100,ovcIgnoreFirstSamples:10,ovcAvailableConcurrencyForBiggerGrid:4,ovcMemoryForBiggerGrid:2,ovcRampUpCooldown:15e3,ovcRampDownCooldown:1e4,ovcUseSampleSmoothedV2:!1,useAudioAnalyzer:!0,webrtcVideoSubscriptionDisposeTimeout:2e3,webrtcCompareContentTypeInOffer:!0,iceServerTransport:"udp,tcp,tls",iceHostCandidateOnly:!0,iceUdpAddressType:"ip",iceTcpAddressType:"ip",renegotiationAttempts:3,reconnectTimeLimit:9e4,initialReconnectTimeLimit:0,maxReconnectDelayTime:5,waitForRelayOnReconnect:!0,relayWaitSaneTimeoutMs:25e3,reconnectOnDisconnect:!1,reconnectWithNoRelays:!1,reconnectWithProbes:!1,reconnectWaitTimeAfterProbe:1e3,reconnectOnPcClose:!0,reconnectWakeupTimeLimit:18e4,webrtcSpeakingWhileMutedDetectionWindow:3,webrtcSpeakingWhileMutedBadDuration:3,webrtcSpeakingWhileMutedDetectionLevel:4e3,webrtcNegotiateDisabledDataModality:!1,recoverableMediaErrors:[nu.MEDIA_ERROR.iceConnectionError,nu.MEDIA_ERROR.noNetworkError,nu.MEDIA_ERROR.srtpError,nu.MEDIA_ERROR.incompatibleOffer,nu.MEDIA_ERROR.internalError].join(","),forceReconnectErrors:[nu.MEDIA_ERROR.audioPlaybackError].join(","),sendCallStartupTelemetry:!0,webrtcMultiPartyRecvVideoSignaling:!0,webrtcVideoDelayThreshold:10,webrtcSubscriptionEventLimit:300,webrtcHandleRollback:!0,webrtcHandleRemoteRollback:!0,losingConnectivityTimeoutMs:-1,iceCandidateFilterMDns:!0,webrtcInjectTransportCCAudio:!1,webrtcInjectTransportCCAudioMultiparty:!0,webrtcRejectedFeatures:"byPass",webrtcRequiredFeatures:"nonByPass",webrtcSimulcastStreamsCountForVideo:1,webrtcSimulcastStreamsCountForSharing:1,webrtcFmtParamListSupported:!0,webrtcNegotiatedSsrcRangeForVideo:0,webrtcNegotiatedSsrcRangeForSharing:0,webrtcNegotiatedSsrcRangeForVideoOneToOne:0,webrtcNegotiatedSsrcRangeForSharingOneToOne:0,webrtcAllowRestoreKeyframe:!1,webrtcEnabledCustomBwEstimationForVideo:!1,webrtcDisabledSenderBitrate:1e3,maxStoredPreferredResolutionCount:4,maxStoredQualityLimitationReasonEvents:30,maxStoredUFDCount:50,simulcastTelemetryLayoutsPerSession:5,simulcastTelemetryNumModalitySessions:3,simulcastTelemetryNumFMTP:10,maxSendVideoCapabilities:{enableForVideo:!1,enableForSharing:!1,useMaximumWidthHeight:!1,sendMaxMbps:!1,sendMaxFs:!1,enableSequenceNumber:!1},maxReportedOvershootingEvents:20,broadcastMode:{townHallScenarioNames:["premiumtownhall","basetownhall"]},performanceFallbackMaxFsFor1080pSend:3600,sendVideoCapabilityManager:{priorityOrder:["Performance","BroadcastMode","HardwareEncoder","Software1080P"],allowOptIn:["HardwareEncoder"]},video1080p:{software:{}},permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!0,adpRequestAVLast:!0,rememberNegative:!1,persistOnDeniedError:!0,disableOnPermissionDeniedOnly:!0,enumerateDevicesAfterChange:!0},devices:{blacklist:{microphone:"stereo mix \\(",camera:"(^ir camera|avstream media device)",speaker:"stereo mix \\("},overrideDefault:!1,compositeLabelMatchingThreshold:.5,piiSafeWords:["airpod","bluetooth","hands-free","stereo","wireless","citrix hdx","remote audio","vmware","built-in","integrated","internal","teams","high definition","facetime","macbook","smartaudio","front","rear","back","iphone","ipad","display","displayport","dp","hdmi","amd","nvidia","intel","analog","digital","dock","line( in| out)?","s/pdif","external","thunderbolt\\d*","usb","panoramic","desktop","capture","cable","cam","virtual","manycam","snap camera","obs","vb-audio","vaio","effect","sink","source","default","test"],pollingIntervalActive:3e3,enumerateDevicesTimeout:25e3,enumerateDevicesAfterADP:!1,setSinkImmediately:!0,enumerateBeforeGettingStream:"always",detectPermChangeTroughDeviceEnumeration:!1},useGoogPrefixAudioConstraints:!0,multiviewResolutionLimits:{1:720,2:720,3:540,4:360,more:360},maxSpotlightResolution:1080,excludeUnsizedRenderersFromMultiviewResolutionLimits:!1,multiviewResolutionLimitUpdateThrottleDelay:300,useMultiviewLimitsOnInitialRequest:!0,useApplyChannelParametersForSourceRequests:!0,webrtcSendBandwidthAlwaysReportAfterDrop:!1,webrtcSendBandwidthIgnoredUpdateLimit:6,webrtcSendBandwidthThreshold:.1,webrtcSendBandwidthPreventDuplicateValue:!1,webrtcLastAppliedVideoCapabilitiesCount:5,webrtcLastAppliedVideoCapabilitiesSequenceCount:5,gumRequestTimeout:2e4,overrideGumFromWebkit:!1,setMinFpsForWebkit:!1,videoCaptureFreezeTimeout:5e3,webrtcCloseAfterIceFailure:!0,audioBandwidthInKbps:90,maxBandwidthInKbps:7e3,maxBandwidthInKbpsFallback:7e3,videoBandwidthAllocation:.3,enableQosSupport:!1,forceUnbundledTransport:!1,allowedAudioCodecs:[],allowedVideoCodecs:[],allowedVideoCodecsMultiparty:[{clockRate:9e4,mimeType:"video/H264"},{clockRate:9e4,mimeType:"video/rtx"}],filterCodecsInSdp:!1,filterCodecsInSdpMultiparty:!0,filterCodecsInSdpV2:!1,reduceRtcpFbInSdp:[],reduceRtcpFbInSdpMultiparty:["goog-remb","transport-cc","ccm/fir","nack","nack/pli"],subscribeToSsrcForVideo:!1,audioRendererUsePauseOnDetach:!0,audioRendererRestartOnPause:!1,audioRendererRestartOnDeviceError:!0,disableAudioOutputSelection:!1,useLocalStorageForOneDs:!0,oneDSGzipTelemetryPayload:!0,oneDSDisabledPageUnloadEvents:[],oneDSLocalStorage:{sendStaleEvents:!0,accessThresholdInMs:-1},oneDSNotificationManager:{blockNotificationsOnPageUnload:!0,blockEventsDiscardedNotifications:!0},oneDSEnablePropertyOverride:{browserVersion:!0,browserName:!1},useOneDsLogger:!1,addTelemetryReportingCallback:!0,eventsLimitInMem:200,eventLatency:AQ.Normal,eventLatencyRealTime:AQ.RealTime,enableCompoundKey:!1,telemetryTenants:{signaling:"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",gtcAudit:"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",media:"1cae5691997646c98b01d15beddae7a3-ce16e198-bc32-420f-ac64-42bb916111af-6865",realtimeMedia:"5aea257f81424f5d8574e57a50974ead-d3a768ce-590c-4595-ab85-3dd046114290-6701",tlePlayer:"2efdf03d07594586a5977c404e185186-71b046c4-f48f-4ba7-96d3-2a74b54e1d46-7326"},transmitProfileName:"REAL_TIME",transmitProfileTimings:[],waitReportStatsAtCallStop:!1,oneStreamPerDeviceType:!1,enableWebRtcInternalsLogs:!1,enableMultiViewStats:!0,webrtcBWJumpLowerLimit:1e5,webrtcBWJumpUpperLimit:3e5,uplinkBWStabilizationSlidingWindowSize:10,uplinkBWStabilizationMaxDeviation:.1,uplinkBWStabilizationMinBandwidth:1e5,downlinkBWStabilizationSlidingWindowSize:10,downlinkBWStabilizationMaxDeviation:.1,downlinkBWStabilizationMinBandwidth:1e5,maxKeyFrameTimestampsInBucket:5,enableAudioSharing:!1,audioSharingContextOptions:{sampleRate:48e3},enableStopSharingWithIncomingOffer:!0,enableDevtoolsAPI:!1,enableDataChannel:!0,enableDataChannelPstn:!0,alwaysNegotiateDataChannel:!0,ignoreNonSctpDataChannelInOffer:!1,webrtcDataChannel:{enableFragmentation:!1,fragmentationSize:0,enableSendScheduler:!1,rateLimiterCheckInterval:250,discardOnSendFailure:!1,bufferedAmountLowThreshold:65535,bufferedAmountHighThreshold:262144,maxBitrate:0,maxPacketRate:0,maxQueueSize:524288,dataIds:[]},acceptDisabledDataModality:!0,rejectUnbundledDataModality:!0,sctpPort:5e3,removeRtcpRsizeFromLocalSdp:!1,enableGiveControl:!1,maxStoredDataChannelValues:15,mediaControlPlaneConfig:{enableBweNotifications:!0,enableDominantSpeakerHistory:!0,enableSourceRequests:!0,enableSourceRequestResponse:!1,enableSendBandwidthNotificationsEnabled:!1,storedSRRecordsCount:60,verboseTelemetry:!1,sendBeforeAck:!1,handshakeTimeout:1e4,enableLeaveData:!1,extendBweMessage:!1,signalingDeprecation:{enableSourceRequestQueueing:!1,disableFallbackToSignaling:!1,ignoreHandshakeTimeout:!1},skipMcpHandshakeIfDcAlreadyConnected:!1},localPreviewMirroringSupported:!1,enableVideoEffects:!0,useRawMediaApiForVideoEffects:!1,waitForVideoEffectStreamStart:!1,forceKeyFrameV2ScaleFactor:1.1,effectsTelemetryBufferSize:20,useDelayedScreenShareStream:!1,applyAudioEffectOnDemand:!1,wasmdns:{pTime:10,goodPerfThreshold:8,poorPerfThreshold:10,badPerfThreshold:12,perfWindowLength:10,enableNoiseSuppression:!1,noiseSuppressionMode:"Off",backgroundMode:!1},wasmvqe:{enableAec:!1,enableVqe:!1,asyncInitialization:!1,initializationTimeoutMs:1e4,backgroundMode:!1,performanceThresholdMs:8,performanceWindowDurationSecs:10,defaultVqeMode:v.VqeMode.Off,callType:v.CallType.Conference,audioUsageMode:v.AudioUsageMode.Default,performanceProfile:v.AecPerfProfile.Normal,enableFallbackForContentSharing:!1,contentSharingVqeMode:v.VqeMode.DeepNS,contentSharingAudioProcessingFlags:3},useProfileSuggestionsToNotifyMaxVideoSendCapabilities:!1,webcv:{qualityConfig:{outputFps:{min:10,max:30},outputResolution:720,preserveResolution:!0,degradationLadder:[{resolution:{width:1280,height:720},fps:{min:15,max:30}},{resolution:{width:960,height:540},fps:{min:15,max:30}},{resolution:{width:640,height:360},fps:{min:13,max:30}},{resolution:{width:416,height:234},fps:{min:10,max:20}},{resolution:{width:320,height:180},fps:{min:10,max:20}}],initialLadderResolution:360,improvementFpsThresholdPercent:20,statsIntervalSec:5,enableMaskPropagation:!1,maskPropagationFramesInterval:30},powerPreference:m.PowerPreference.HighPerformance,useInsertableStreams:!1,webGLUnsupportedRenderers:["Google SwiftShader"],webGLRequiredExtensions:["EXT_color_buffer_float","WEBGL_debug_renderer_info","OES_texture_float_linear"],usePreheat:!1,useSharedArrayBuffer:!0,useWasmEffects:!1,processorType:m.ProcessorType.Webgl2},insertFakeCandidateIfNeeded:!0,useSdpCapabilities:!0,enableH264SpsPpsIdrKeyframe:!0,disableMsSdp:!1,disableIceReinvite:!1,iceDisconnectedTimeoutMs:3e4,enableLocalVideoConstraints:!0,webrtcAudioChannelSignalingFeedback:"app recv:dsh",webrtcVideoChannelSignalingFeedback:"app send:src recv:src,vc",webrtcResolutionManagerCooldownTimeout:15e3,webrtcResolutionManagerRetryDelay:5e3,webrtcNativeCpuOveruseDisabled:!1,webrtcDisplayStreamContentHint:"text",h264SendProfileOverride:"42C02A",learnCodecSendCapabilitiesFromSenderApi:!1,addFmtpToInitialSubscription:!0,h264SubscribeProfile:"64001f",notRenderingTimeInterval:{video:3,sharing:10},notRenderingLowBitrateThreshold:6,notRenderingLowFramerateThreshold:3,isBytesRecvUsedInIsRenderingCalculation:!0,useConnectionState:!0,transportStateFailedFix:!0,useDtlsTrasportConnectionCheck:!1,enableSignalingAudioPermissionDeniedUFD:!1,webrtcJitterLowThreshold:.2,webrtcJitterHighThreshold:.35,webrtcJitterSticknessTime:5e3,webrtcLossRateLowThreshold:.2,webrtcLossRateHighThreshold:.3,webrtcLossRateSticknessTime:5e3,webrtcMinPacketsSentForNetworkSendQuality:200,webrtcLossRateWindowSize:3,webrtcJitterWindowSize:3,disableNormalizationToCalculatePacketLossRate:!1,healedRatioPrecision:8,jitterPrecision:3,requestNewStreamOnUnmute:!0,allowMuteOnInactiveSender:!0,raiseVideoMuteUfd:!1,useMediaQualityController:!1,useMediaQualityControllerForceKeyFrame:!1,bandwidthAllocatorV2:{sharingLadder:[8e4,5e5,8e5,1e6,12e5,25e5,3e6],videoLadders:[{maxFS:240,ladder:[4e4,7e4,1e5,15e4,25e4,3e5,35e4]}],defaultVideoMaxFS:240},layoutControlTimeout:1e4,extmapAllowMixed:!1,enableVla:!1,allowRemoteVla:!1,enableNonAdvVla:!1,specCompliantSimulcast:{},specCompliantSimulcastMultiparty:{video:{enableLocally:!1,allowEnableRemotely:!1,layerScaleFactors:[1],minFsForSimulcast:[920],useApplyConstraints:!1,useScaleResolutionDownTo:!1},sharing:{enableLocally:!1,allowEnableRemotely:!1,layerScaleFactors:[1]},allowOverride:!1,constraintsDisableVla:!0,collectResolutionInfo:!0,maxBrControlEnabled:!1,allowedBweOvershootRatio:1,allowResLimit:!1,disableTilde:!1},enforceOpusFmtpMultiparty:{usedtx:1},videoIsRenderingCheck:!1,fixSdpForPartialIceRestart:!1,mapSsrcToTrackForStats:!1,enableVideoOrientationExtension:!1,speakerGainLevel:0,ignoreClosedDtlsTransportState:!1,disconnectOnPageHide:!1,renderThroughCanvas:!1,enableDevicePixelRatio:!0,useSetParametersToApplyCapabilities:!1,useSetParametersToApplySSCapabilities:!1,enablePlatformCallConstraints:!1,enablePlatformCallConstraintsPerCall:!1,enableDynamicCallConstraints:!0,numCallConstraintsEvents:6,setParametersMaxBitrateUndefined:!1,onAddTrackRemoveOtherTracks:!0,avoidFakeStreamsDuringEscalation:!0,navConnectionPollingInterval:1e3,navConnectionNumSamplesToCollect:60,acceptProvisionalAnswer:!1,acceptProvisionalAnswerPstn:!0,acceptProvisionalAnswerFromPstnOnly:!0,createProvisionalAnswer:{enabled:!1,enabledPstn:!1,forceRecvonly:!1,useProvisionalSignalingState:!1,connectTransport:!0,audioState:"active",dtlsRole:"",dtlsRolePstn:""},createProvisionalAnswer1on1:{enabled:!1,enabledPstn:!0,forceRecvonly:!1,useProvisionalSignalingState:!1,connectTransport:!0,audioState:"active",dtlsRole:"active",dtlsRolePstn:"active"},webrtcPranswerCheckAudioEnergy:!1,webrtcPranswerMediaPollingTimeout:500,webrtcPranswerWaitFinalAnswer:!1,webrtcPranswerAudioThreshold:0,webrtcPranswerWaitIntervalBeforePolling:500,webrtcPranswerStopPollingAfterError:!1,disableIncomingDtlsRoleOverride:!1,disableOutgoingDtlsRoleOverride:!1,statsAllowAnyVideoSendTrack:!1,pictureInPicture:{enablePictureInPicture:!1,aspectRatioHorizontal:16,aspectRatioVertical:9,maxActiveStreams:1,minStreamGridCellWidth:160,dominantStreamChangeDebounce:3e3,statisticsBufferSize:20,multiStreamWorkerURL:""},showStatsInCall:!1,useSetStreamsForSender:!0,addPrefixForMsidInSdp:!1,enableMuteSpeakerUnmuteSpeakerWorkaround:!1,alwaysRaiseBadDeviceEvents:!1,removeRecvStreamOnEnded:!0,requiredVideoCodecs:["h264"],primaryVideoCodecs:["h264","vp8","vp9"],removeUnsupportedVideoModality:!1,enableActiveSpeakerBasedDSH:!0,enableInitialSignalingDSHSubscription:!0,enableSignalingDSHFallback:!1,emptyInitialDSH:!0,bwPercentiles:[5,50,95],enableTimerTracker:!0,diagnostics:{useForTelemetry:!1,collectWhileNotConnected:!1,traceLogging:!1,enabledStatsProcessors:{dataChannel:!0,transport:!0,audio:!0,video:!0,sharing:!0,bandwidth:!0,recvVideoStreamsCounter:!0,aggregated:!0,multiview:!0,multipleAudio:!0,simulcast:!0,networkInfo:!0,macroblockRate:!0},collectionLimits:{numOfHistogramSamples:100,numDeviceEvents:200,numVideoEffectsEvents:100,numAudioEffectsEvents:100,numOvershootEvents:100,numIsRenderingEvents:100,numStatsReports:600,numStatsErrors:100,numSubscriptionEvents:100,numPerformanceEvents:50,numUFDs:100,numNativeSessions:3,numSessions:3,numNetworkEvents:50,numReconnects:50,numReconnectRecords:20,numCapabilitiesRequested:60,numCapabilitiesApplied:60,numAudioCaptureErrors:100,numAudioRenderErrors:100,numResolutionSwitches:10,numSamplesForE2E:4,numWorkerEvents:50,numTransportStateEvents:100,numElevation:5,numVideoStatsAfterSubscription:30,numVideoSubscriptionStats:30,numPowerEfficientEncoderEvents:60,numQualityLimitationEvents:30,numMediaLeakEvents:100},telemetryLimits:{numOfHistogramSamples:50,numDeviceEvents:40,numVideoEffectsEvents:20,numAudioEffectsEvents:30,numWorkerEvents:25,numOvershootEvents:20,numIsRenderingEvents:4,numPreferredResolutions:3,numSubscriptionEvents:100,numPerformanceEvents:30,numUFDs:50,numAggregatedSamples:60,numStatsErrors:20,numCapabilitiesRequested:5,numCapabilitiesApplied:3,numNetworkEvents:20,numReconnects:10,numRendererStateChangedEvents:10,numAuthTokenErrors:20,numPowerEfficientEncoderEvents:20,numQualityLimitationEvents:20},teamsRealtimeTelemetry:{pollingInterval:15},performanceMonitoring:{usePerfConstrainedOvc:!1,useCpuSample:!1,useComputePressure:!1,fluctuationSamplesNum:5,enableRemoteVideoCalculator:!1,enableLowerResolution:!1,monitoringStrategy:"decodeTime",decodeThresholds:{1080:{fps:30,maxDecodeTime:20},720:{fps:30,maxDecodeTime:15},540:{fps:30,maxDecodeTime:11},360:{fps:30,maxDecodeTime:9},234:{fps:15,maxDecodeTime:10},180:{fps:15,maxDecodeTime:10}},defaultThrehold:{fps:30,maxDecodeTime:60},fpsDiffThresholds:{1080:{fps:30,fpsDiff:4},720:{fps:30,fpsDiff:4},540:{fps:30,fpsDiff:4},360:{fps:30,fpsDiff:4},234:{fps:15,fpsDiff:2},180:{fps:15,fpsDiff:2}},defaultFpsDiffThreshold:{fps:30,fpsDiff:10},volatilityThresholds:{1080:10,720:10,540:10,360:10,234:5,180:5},defaultVolatilityThreshold:10,remoteVideoTrackInterval:10,telemetryResolutionRequestSpanMs:5e3,cpuMetricCollector:3},features:{useLastSampleDeltaPerSecondConverter:!0,useNewerStatisticsMetrics:!0,logContributingSourcesError:!0,useNewSimulcastTelemetryExtension:!1}},requireUserActionForAudioSharing:!1,postponeAudioMixerForAudioSharing:!1,reassignMediaStreamAudioTrackAfterCreation:!1,deactiveAudioSender:!1,webrctRemoveVideoModalitiesForPstn:!1,removeSendersOnConfigureModalities:!0,negotiationParallelStreamAcquisitionCreateOffer:!1,negotiationParallelStreamAcquisitionCreateAnswer:!1,streamAvailabilityConsiderModalities:!0,setBWSeed:!0,bwSeedOptions:{mids:["*"],aggregation:"last",aggregateLastN:null,constValue:6e5,minValue:-1,cappingValue:15e5,useLocalStorage:!0,localStorageKey:"bwSeed"},stopCallOnAcceptFailure:!0,allowMediaBypass:!0,enablePermissionsWorkaround:!1,disposeSendersSync:!1,disposeStreamsSync:!1,maxVideoStatsAfterSubscription:30,ecsConfigTimeout:2e4,contributingSourcesLogInterval:1e4,useNewTokenApi:!1,audioRendererFailedReconnectTimes:0,audioRendererFailedRetryCodes:[3],effectsApplyConstraintsRetryMs:1e3,isSpotlightEnabled:!0,addAudioStreamBeforeConnection:!1,redReceiveEnabled:!1,mediaEventDictionary:nu.MEDIA_EVENT_FIELDS,smallCallTelemetry:{enable:!1,mediaUFDEventDictionary:{}},applySenderParamsBeforeStart:!0,applyMaxCapabilitiesToSenderParamsDirectly:!1,reuseLastSetParameters:!0,hevcCodecs:["hev1.1.6.L120.90","hev1.1.4.L93.B0","hev1.1.6.L93.B0"],useInactiveAudioTrack:!1,enableRollbackHandler:!1,callElevationDelayReconnect:!0,callElevationDelayReconnectPSTN:!0,enableCachingFMTP:!0,enableCachingFMTPAwait:!1,enableCachingFMTPDelay:0,setDisconnectAfterCleanUp:!1,updateLadderTypeFromVdclc:!1,disableHwEncodingDuringCall:!1,disableHwEncodingParticipantLimit:17,hwEncodingUnsupportedGpus:[],sendResolutionTableOverride:nu.RES_TABLE.SEND,recvResolutionTableOverride:nu.RES_TABLE.RECV,sendVideoLadderOverrideDefault:nu.RES_TABLE.SEND,sendVideoLadderOverride270pHW:[{w:320,h:180,fps:7,minBr:19999,maxBr:125e3},{w:320,h:180,fps:15,minBr:99999,maxBr:25e4},{w:480,h:270,fps:15,minBr:2e5,maxBr:4e5},{w:640,h:360,fps:30,minBr:35e4,maxBr:62e4},{w:960,h:540,fps:30,minBr:5e5,maxBr:1e6},{w:1280,h:720,fps:30,minBr:7e5,maxBr:18e5},{w:1920,h:1080,fps:30,minBr:14e5,maxBr:35e5}],sendVideoLadderOverride360pHW:[{w:320,h:180,fps:7,minBr:19999,maxBr:125e3},{w:320,h:180,fps:15,minBr:99999,maxBr:3e5},{w:640,h:360,fps:15,minBr:25e4,maxBr:4e5},{w:640,h:360,fps:30,minBr:35e4,maxBr:62e4},{w:960,h:540,fps:30,minBr:5e5,maxBr:1e6},{w:1280,h:720,fps:30,minBr:7e5,maxBr:18e5},{w:1920,h:1080,fps:30,minBr:14e5,maxBr:35e5}],maxSendVideoCapabilitiesMultiparty:{enableForVideo:!0,enableForSharing:!1,useMaximumWidthHeight:!0,sendMaxMbps:!1,sendMaxFs:!1,enableSequenceNumber:!1},participantStreamInitialSubscriptions:!0,holdRetryActivationDelay:-1,holdSkipActivation:!0,recoverOnStreamUnmute:!1,isAv1Allowed:!1,audioSharingMemoryLeakFix:!0,h264SdpProfileMultiparty:"64001f",rejectIncompatibleOriginator:!0,coeffOfValidTimeDelayBetweenFramesArrival:2,invalidFPSAboveMax:40,useWakeLockApi:!0,noRequiredCodecsWorkaround:!1,vdiDisconnectedTracking:{enabled:!0,clientPhrases:["failure"]},multiStreamSupported:!1,multiStreamSupportedVBSS:!1,nonMultiStreamChannels:9,useTokenMigrationHeader:!1,clientSupportsAadToken:!1,clientSupportsCaeToken:!1,clientSupportsSkypeToken:!0,supportMissingTokenTypesInResponse:!0,useSkypeTokenWhenNoAuthenticateHeader:!1,useKeyFrameApi:!1,enablePlayVideoOnStreamUnmuteWorkaround:!1,useDeviceHandleForLocalVideo:!0,enableCallStateChangesOnPageClose:!0,remoteUFD:{enabled:!1,enabledViaApi:!1,maxParticipantNumber:20,debounceTime:1e3,list:{},remoteUFDHandlerV2:!0,maxNumberOfBadUFDsForThrottling:3,throttlingTimeInterval:6e4,disableInterval:6e4,bundlingInterval:6e3,maxNumberOfBundles:4,bundlingWindowInterval:6e4},streamModalitiesExcludeData:!0,muteDuringRemotePranswer:!0,syncMuteStateWithAudioDirection:!1,permissionDeniedUFDWorkaround:!1,audioSetSinkIdWorkaround:!1,identifyOneToOneCallWithoutParticipants:!0,emptyIceCandidateMarksGatheredAnswerer:!0,disableSendersTroughSetParametersVideo:!1,disableSendersTroughSetParametersAudio:!1,maxNumberOfPinnedVideos:1,localUFDDebounceTime:0,audioSampleRate:0,lowBatteryThreshold:10,fixExtraNegotiation:!1,fixSharingSendrecvOfferHandling:!1,videoPlayTimeout:-1,pollIntervalBeforeFirstAudioMs:0,tuffAudioStateChanged:!1,watchdog:{enabled:!1,stopCallOnAudioLeak:!1,maxPacketsDiff:10,maxBytesDiff:2e3},skipRollbackSupportCheck:!0,validateStreamDisposal:!1}}getEnforcedSettings(){return{}}},xY=class extends xQ{getInitialSettings(){let e=super.getInitialSettings();return e.oneStreamPerDeviceType=!0,e.removeUnsupportedVideoModality=!0,e.webrtcPranswerWaitForMediaPollingInterval=100,e.localPreviewMirroringSupported=!0,is.isFormFactor("Mobile")&&(e.webrtcCameraOpenFs=920,e.webrtcVideoCapabilityMaxFS=920),e}},xZ=class extends xQ{getEnforcedSettings(){return{useAudioAnalyzer:!1,enableAudioSharing:!1}}},xX=class extends xY{getEnforcedSettings(){let e={webrtcAllowRestoreKeyframe:!0,permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!1,adpRequestAVLast:!1,rememberNegative:!1},devices:{pollingIntervalIdle:1e4},audioRendererRestartOnPause:!0,subscribeToSsrcForVideo:!0,noRequiredCodecsWorkaround:!0,degradationPreference:"maintain-framerate"};return is.isFormFactor("Mobile")&&(e.enableVideoEffects=!1),is.isVersionGreaterOrEqual("15.0")||(e.statsAllowAnyVideoSendTrack=!0),is.isVersionGreaterOrEqual("16.0")&&is.isFormFactor("Mobile")&&(e.enablePermissionsWorkaround=!0),is.isVersionGreaterOrEqual("17.0")&&is.isFormFactor("Mobile")&&(e.recoverOnStreamUnmute=!0,e.enablePlayVideoOnStreamUnmuteWorkaround=!0),e}},x0=class extends xY{getEnforcedSettings(){let e={webrtcAllowRestoreKeyframe:!0,useDtlsTrasportConnectionCheck:!0,videoIsRenderingCheck:!1,fixSdpForPartialIceRestart:!0,mapSsrcToTrackForStats:!0,ignoreClosedDtlsTransportState1on1:!0,subscribeToSsrcForVideo1on1:!0,devices:{enumerateDevicesTimeout:0,pollingIntervalIdle:1e4,idlePollingOnStart:!0},webrtcInjectTransportCCAudioMultiparty:!1,videoCaptureFreezeTimeout:0,filterCodecsInSdp:!0,useSetParametersToApplyCapabilities:!0,removeRecvStreamOnEnded:!0,webrtcDisabledSenderBitrate:0,permissionDeniedUFDWorkaround:!0,removeComfortNoiseChannelParameter:!0};return is.isVersionGreaterOrEqual("123.0")?e.disableAudioOutputSelection=!1:e.disableAudioOutputSelection=!0,e}},x1=class extends xQ{getEnforcedSettings(){let e={requireUserActionForAudioSharing:!0,webrtcAllowRestoreKeyframe:!0,useAudioAnalyzer:!1,enablePlatformCallConstraints:!0,specCompliantSimulcastMultiparty:{video:{layerScaleFactors:[1,2],enableLocally:!0,allowEnableRemotely:!0},maxBrControlEnabled:!0,allowResLimit:!0,allowOverride:!0,disableTilde:!1},extmapAllowMixedMultiparty:!0,enableVlaMultiparty:!0,allowRemoteVlaMultiparty:!0,enableNonAdvVlaMultiparty:!0,useMediaQualityControllerMultiparty:!0,useSdpCapabilities:!1,enableRollbackHandler:!0,allowedAudioCodecs:[{channels:2,clockRate:48e3,mimeType:"audio/opus"},{channels:1,clockRate:8e3,mimeType:"audio/G722"},{channels:1,clockRate:8e3,mimeType:"audio/PCMU"},{channels:1,clockRate:8e3,mimeType:"audio/PCMA"},{clockRate:48e3,mimeType:"audio/CN"},{channels:1,clockRate:8e3,mimeType:"audio/CN"},{channels:1,clockRate:8e3,mimeType:"audio/telephone-event"}],setMinFpsForWebkit:!0,diagnostics:{features:{useLastSampleDeltaPerSecondConverter:!1}},removeRtcpRsizeFromLocalSdp:!0};if("43"===mM()){let t={postponeAudioMixerForAudioSharing:!0,enableAudioSharing:!0,filterCodecsInSdp:!0,webrtcPranswerWaitForMediaPollingInterval:250,specCompliantSimulcastMultiparty:{video:{useApplyConstraints:!1}},localPreviewMirroringSupported:!0,webrtcContributingSourcesPollingStartDelay:3e3,devices:{setSinkImmediately:!1},audioRendererUsePauseOnDetach:!1};return(0,xJ.mergeWith)(e,t,vx)}if("44"===mM()){let t={postponeAudioMixerForAudioSharing:!0,enableAudioSharing:!0,disposeSendersSync:!0,disposeStreamsSync:!0,filterCodecsInSdp:!0,useInactiveAudioTrack:!0,specCompliantSimulcastMultiparty:{video:{useApplyConstraints:!0,minFsForSimulcast:[920]}},webrtcPranswerWaitForMediaPollingInterval:250,webrtcContributingSourcesPollingStartDelay:5e3,audioRendererUsePauseOnDetach:!1};return(0,xJ.mergeWith)(e,t,vx)}if("45"===mM()){let t={setParametersMaxBitrateUndefined:!0,specCompliantSimulcastMultiparty:{video:{useApplyConstraints:!0,minFsForSimulcast:[920]}}};return(0,xJ.mergeWith)(e,t,vx)}return e}},x2=class extends xY{getEnforcedSettings(){let e={removeRtcpRsizeFromLocalSdp:!0};return is.isVersionGreaterOrEqual("74.0")&&(e.webrtcAllowRestoreKeyframe=!0,e.enableAudioSharing=!0),is.isVersionGreaterOrEqual("122.0")&&(e.useKeyFrameApi=!0),is.isFormFactor("RoomAudioProcessing")&&(e.defaultAudioProcessingFlags=0,e.wasmvqe={enableAec:!1,enableVqe:!1,backgroundMode:!1},e.wasmdns={enableNoiseSuppression:!1,backgroundMode:!1}),(is.isBrowser("CiscoOS")||is.isBrowser("ZoomRoom"))&&(e.waitReportStatsAtCallStop=!0,e.setDisconnectAfterCleanUp=!0),is.isFormFactor("Mobile")&&(e.enableAudioSharing=!1,e.audioRendererFailedReconnectTimes=3,e.devices={pollingIntervalIdle:1e4}),is.isBrowser("SamsungTV")&&(e.useSetParametersToApplyCapabilities=!0),is.isVersionGreaterOrEqual("98.0")&&is.isFormFactor("Desktop")&&(e.specCompliantSimulcastMultiparty={video:{layerScaleFactors:[1,2],enableLocally:!0,allowEnableRemotely:!0,useApplyConstraints:!0,minFsForSimulcast:[920],layerScalabilityModes:["L1T1","L1T1","L1T1"],defaultScalabilityMode:"L1T1"},maxBrControlEnabled:!0,allowResLimit:!0,disableTilde:!1},e.extmapAllowMixedMultiparty=!0,e.enableVlaMultiparty=!0,e.allowRemoteVlaMultiparty=!0,e.enableNonAdvVlaMultiparty=!0,e.useMediaQualityControllerMultiparty=!0),is.isVersionGreaterOrEqual("100.0")&&(e.redReceiveEnabledMultiparty=!0),e.webcv={useWasmEffects:!0,processorType:m.ProcessorType.Wasm},e}},x3=class{constructor(e){this.settings=e,this.isTransportUnbundled=!1,this.webrtcRejectedFeatures="",this.webrtcRequiredFeatures="",this.spatialAudioEnabled=!1,this._maxBandwidthInKbps=0,this._noiseSuppressionMode="Auto",this._enableMediaBypass=!1,this.audioContext={enabledLocally:!1,disabledRemotely:!1,enabledForSend:!1,initFailed:!1,initSendFailed:!1,codec:"None",lastUsedCodec:"None"}}setMediaConfiguration(e,t){this.maxBandwidthInKbps=Math.floor((e.maxBandwidthInBps||0)/1e3),this.isTransportUnbundled=this.settings.forceUnbundledTransport||this.settings.enableQosSupport&&(e.enableMediaQoS||!!e.mediaPortRanges),this._mediaPortRanges=e.mediaPortRanges,this._noiseSuppressionMode=e.noiseSuppressionMode||"Auto",this._enableMediaBypass=this.settings.allowMediaBypass&&e.enableMediaBypass,this.webrtcRejectedFeatures=this._enableMediaBypass?"":this.settings.webrtcRejectedFeatures,this.webrtcRequiredFeatures=this._enableMediaBypass?"":this.settings.webrtcRequiredFeatures,this.spatialAudioEnabled=t?t.spatialAudioEnabled:e.enableSpatialAudio}get mediaBypassEnabled(){return this._enableMediaBypass}get noiseSuppressionMode(){return this._noiseSuppressionMode}get maxBandwidthInKbps(){return this._maxBandwidthInKbps}set maxBandwidthInKbps(e){this._maxBandwidthInKbps=e,this.settings.maxBandwidthInKbps&&(this._maxBandwidthInKbps=Math.min(this.settings.maxBandwidthInKbps,this._maxBandwidthInKbps||Number.MAX_SAFE_INTEGER))}get audioPortRange(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.audioMin&&this._mediaPortRanges.audioMax)return{min:this._mediaPortRanges.audioMin,max:this._mediaPortRanges.audioMax}}get videoPortRange(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.videoMin&&this._mediaPortRanges.videoMax)return{min:this._mediaPortRanges.videoMin,max:this._mediaPortRanges.videoMax}}get audioCodecContext(){return this.settings.useInsertableStreams?.audioWasmCodec?.enable?this.audioContext:void 0}},x4=class extends no{constructor(e,t,i={}){super(e),this.logger=e,this.platformCallConstraintsProvider=t,this.platformConfig=xK(),this.sessionCount=0,this._consoleOverrides={},this.uaConfig=new v$(this),this.mediaConfiguration={},this.configReceivedDefer=new iE,this.logger.info(`initializing configProvider ${this.constructor.name} from BrowserInfo: ${is.toString()}`),this.initialSettings=(0,yR.mergeWith)({},(0,yR.cloneDeep)(this.platformConfig.getInitialSettings()),(0,yR.cloneDeep)(i),this.platformConfig.getEnforcedSettings(),vx),this.settings=this.initialSettings,this.disableHWEncodingIfGpuUnsupported(),this.settingsWithoutOverrides=this.initialSettings,this.stackSettings=(0,yR.cloneDeep)(i),this.mediaSettings=new x3(this.settings),this.platformCallConstraintsProvider.changed(()=>{this.updateSettings();let e=this.platformCallConstraintsProvider.constraints,t=vT(this.logger.createChild("SettingsToCallConstraintsConverter"),this.settings,e);this.platformCallConstraintsProvider.addCallConstraintsTelemetryEvent(t,"applied")}),this.configReceivedTimeout=window.setTimeout(()=>{this.configReceivedTimeout=void 0,this.configReceivedDefer.resolve()},this.settings.ecsConfigTimeout),this.logger.safe.info("Initialized")}getCallConstraints(){return this.platformCallConstraintsProvider.constraints}setCallConstraints(e){return this.platformCallConstraintsProvider.setConstraints(e),e}getCallConstraintsTelemetry(){return this.logger.error("Not supported globally, returning empty array"),[]}addCallConstraintsTelemetryEvent(e,t){this.logger.error("Not supported globally")}overrideMaxSessionBandwidth(e){return this.logger.error("Not supported globally"),!1}getIceTransportPolicy(){return this.logger.warn(`Not supported globally, returning default ${nu.ICE_TRANSPORT_POLICY.all}`),nu.ICE_TRANSPORT_POLICY.all}setIceTransportPolicy(e){this.logger.error("Not supported globally")}getConfigReceivedOrTimeout(){return this.configReceivedDefer.promise}getConfigView(e,t){let i=e?"Multiparty":"1on1",n=Object.entries((0,yR.cloneDeep)(this.settings)).reduce((e,[t,n])=>(e[t]=n,t.endsWith(i)&&(e[t.replace(i,"")]=n),e),{}),r=new x3(n);return r.setMediaConfiguration(this.mediaConfiguration,t?.mediaConfig),new vU(this.logger.createChild("ConfigProviderView"),n,r,this.userAgentConfig,this.countryCode,this.platformCallConstraintsProvider,t?.getCallConstraints())}updateConfig(e,t,i,n){this.etag=t||this.etag,this.configIds=i||this.configIds,this.country=n||this.country,this.event("newConfigReceived").raise(e,t,i),this.settingsWithoutOverrides=(0,yR.mergeWith)({},this.settingsWithoutOverrides,e,vx),this.updateSettings(),this.configReceivedTimeout&&(window.clearTimeout(this.configReceivedTimeout),this.configReceivedTimeout=void 0),this.configReceivedDefer.resolve()}updateSessionCount(e){this.sessionCount=e,0===e&&this.pendingSettings&&(this.logSettings("Applying pending configuration",this.pendingSettings),this.updateSettings(this.pendingSettings),this.pendingSettings=null),e>0&&this.configReceivedTimeout&&this.configReceivedDefer.resolve()}get config(){return this.settings}get stackConfig(){return this.stackSettings}get consoleOverrides(){return this._consoleOverrides}get defaultConfig(){return this.initialSettings}get userAgentConfig(){return this.uaConfig}get countryCode(){return this.country}setMediaConfiguration(e){this.mediaConfiguration=e,this.mediaSettings.setMediaConfiguration(e)}get mediaConfig(){return this.mediaSettings}get ETag(){return this.etag}get ecsConfigIds(){return this.configIds}setConsoleOverrides(e){this._consoleOverrides=(0,yR.mergeWith)({},this._consoleOverrides,e,vx),this.updateSettings()}setConsoleOverride(e,t){this._consoleOverrides[e]=t,this.updateSettings()}clearConsoleOverride(e){delete this._consoleOverrides[e],this.updateSettings()}clearAllConsoleOverrides(){this._consoleOverrides={},this.updateSettings()}updateSettings(e=this.settingsWithoutOverrides){if(this.sessionCount>0){this.pendingSettings=e,this.logSettings("pendingSettings updated",e);return}this.settings=this.mergeSettings(e),this.disableHWEncodingIfGpuUnsupported(),this.event("configUpdated").raise(),this.logSettings("Settings updated",this.settings)}logSettings(e,t){let i=Object.entries(t).reduce((e,[t,i])=>(i!==this.initialSettings[t]&&(e[t]=i),e),{});this.logger.safe.info(`${e}: ${JSON.stringify(i)}`)}mergeSettings(e){if(!(e.enablePlatformCallConstraints||this._consoleOverrides.enablePlatformCallConstraints))return this.mergeSettingsWithConsoleOverrides(e);let t=e,{setConsoleOverridesBeforeCallConstraints:i}=this._consoleOverrides;return i&&(t=this.mergeSettingsWithConsoleOverrides(t)),t=this.mergeSettingsWithPlatformConstraints(t),i||(t=this.mergeSettingsWithConsoleOverrides(t)),t}mergeSettingsWithConsoleOverrides(e){return this.logger.safe.info(`Merging settings with console overrides: ${t$(this._consoleOverrides)}`),(0,yR.mergeWith)({},e,this._consoleOverrides,vx)}mergeSettingsWithPlatformConstraints(e){let t=this.platformCallConstraintsProvider.getSettings(e);return this.logger.safe.info(`Merging settings with platform call constraints: ${t$(t)}`),(0,yR.assign)({},e,t,vx)}getVideoSendLadder(){return this.logger.error("getVideoSendLadder() is not supported on ConfigProvider"),ra.Send}disableHWEncodingIfGpuUnsupported(){if(vL(this.settings.preferredH264VideoSendProfile)||vL(this.settings.preferredH264SharingSendProfile)){let e=v$.unmaskedGlRenderer,t=this.settings.hwEncodingUnsupportedGpus||[];e&&t.length>0&&t.some(t=>e.toLowerCase().includes(t.toLowerCase()))&&(this.logger.safe.warn(`Unsupported GPU detected for HW encoding: ${e}. Turning off HW encoding.`),this.settings.preferredH264VideoSendProfile=void 0,this.settings.preferredH264SharingSendProfile=void 0)}}},x5=class{constructor(){this.data={clientDSH:void 0,signalingDSH:void 0,serverDSH:void 0,activeStrategy:void 0,lastMsgOrigin:void 0,changedCountContributingSources:0,changedCountDSH:0}}contributingSourcesChanged(){this.data.changedCountContributingSources++}setCurrentActiveStrategy(e){this.data.activeStrategy=e}resetState(){return this.data.lastMsgOrigin=void 0,this}recordHistoryEvent(e,t){var i,n;this.data.changedCountDSH++,(i=this.data)[n=t+"DSH"]??(i[n]={count:0,duplicateCount:0}),this.data.lastMsgOrigin=t;let r=this.data[t+"DSH"];r.count++,r.firstMsgTime??(r.firstMsgTime=Date.now()),nA(this.data.lastHistory,e)&&r.duplicateCount++,this.data.lastHistory=e,this.data.lastMsgDate=Date.now()}getObjectRef(){return this.data}},x6=class{constructor(e,t,i,n,r,s,a,o){this.mediaStream=e,this.receiver=t,this.modality=i,this.sourceStreamId=n,this.controller=r,this.videoCapabilities=s,this.getMaxAllowedVideoFS=a,this.substreamIndex=o,this.msi=-1,this.operations=Promise.resolve()}dispose(){this.receiver=null,this.mediaStream=null}getId(){return this.mediaStream.id}getModality(){return this.modality}getMsi(){return this.msi}getMediaStream(){return this.mediaStream}getReceiver(){return this.receiver}getSourceStreamId(){return this.sourceStreamId}getSubstreamIndex(){return this.substreamIndex}requestSource(e){this.msi=e;let t=this.operations.then(()=>{let t;return this.videoCapabilities&&(this.videoCapabilities.resetToInitial(),this.getMaxAllowedVideoFS&&this.videoCapabilities.setMaxFS(Math.min(this.getMaxAllowedVideoFS(),this.videoCapabilities.getMaxFS())),t=this.videoCapabilities.buildFmtp(),this.videoCapabilities.resetToInitial()),this.controller.requestSource(this.mediaStream.id,e,t)});return this.operations=t.catch(()=>{}),t}},x8=class{constructor(e){this.subscription=e}get subscribedStream(){return this.subscription.stream?.getMediaStream()}get msi(){return this.checkDisposed(),this.subscription.msi}get modality(){return this.checkDisposed(),this.subscription.modality}get localMsi(){return this.checkDisposed(),this.subscription.localMsi}setOnMediaStreamChangedHandler(e){this.checkDisposed(),this.mediaStreamChanged=e,this.subscription.isStreamReady&&this.notifyMediaStreamChanged()}setOnErrorHandler(e){this.checkDisposed(),this.error=e}dispose(){this.subscription&&(this.subscription.dispose(e9(),this),this.subscription=null)}unsubscribe(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}notifyMediaStreamChanged(){if(this.mediaStreamChanged){let e=this.subscription.stream,t=this.subscription.isStreamReady;this.mediaStreamChanged(e&&t?e.getMediaStream():null)}}notifyError(e){this.error&&this.error(e)}checkDisposed(){if(!this.subscription)throw Error("subscription disposed")}},x9=class extends no{constructor(e,t,i){super(),this.modality=e,this.msi=t,this.disposeDelay=i,this.clients=[],this.streamReady=!1}createClient(){let e=new x8(this);return this.clients.push(e),e}get isStreamReady(){return this.streamReady}get localMsi(){return this.subStream?.getSourceStreamId()}get isInactive(){return!this.clients.length}get stream(){return this.subStream}set stream(e){try{if(e===this.subStream)return;this.subStream&&(this.unsubscribe(!1),this.notifyStreamChanged()),this.subStream=e,e&&(this.streamReady=!1,e.requestSource(this.msi).then(()=>{this.streamReady=!0,this.notifyStreamChanged()}).catch(e=>{this.notifyError(e)}))}catch(e){this.event("onFailed").raise(this,e)}}notifyError(e){this.clients.forEach(t=>{t.notifyError(e)}),this.event("onFailed").raise(this,e)}dispose(e,t){t?(ny(this.clients,e=>e===t),this.isInactive&&(this.disposeTimeout=window.setTimeout(()=>{this.disposeTimeout=null,this.unsubscribeIfInactive()},this.disposeDelay))):(this.clients=[],this.unsubscribe())}unsubscribeIfInactive(){this.isInactive&&(this.disposeTimeout&&clearTimeout(this.disposeTimeout),this.unsubscribe())}unsubscribe(e=!0){this.subStream&&(this.subStream.requestSource(-1).catch(()=>{}),this.streamReady=!1,this.subStream=null),e&&this.event("onDisposed").raise(this)}notifyStreamChanged(){this.clients.forEach(e=>e.notifyMediaStreamChanged()),this.event("onStreamChanged").raise()}},x7=class extends no{constructor(e,t,i,n){super(e),this.configProvider=t,this.diagnostics=n,this.videoSubscriptions=[],this.isMcpSrAvailable=!1,this.subscriptionEvents=new Map,this.setLogger(e),this.diagnostics??(this.diagnostics=new Le(this.configProvider,()=>{})),this.setStreamProvider(i),this.logger.safe.info("created")}getSubscriptionsCount(){return this.videoSubscriptions.filter(e=>e.isStreamReady).length}setStreamProvider(e){this.streamProvider=e,this.streamProvider.setOnStreamsChangedHandler(()=>this.streamsChanged())}setLogger(e){this.logger=e}subscribeVideo(e,t=-2){let i=this.videoSubscriptions.find(i=>i.msi===t&&i.modality===e),n=this.getAvailableStream(e);if(i)!i.stream&&n?this.assignStream(i,n):this.logger.safe.info(`subscription #${t} for modality ${e} already exists, stream assigned: ${!!i.stream}`);else{let r=Date.now();this.disposeInactiveSubscriptionIfNeeded(e),n=this.getAvailableStream(e);let s=n?.getSourceStreamId();this.logger.safe.info(`creating new subscription #${t} for modality ${e}`),this.event("onSubscriptionChanged").raise(1,e,t,s,null),this.diagnostics.addSubscribe(e,t,s),i=new x9(e,t,this.configProvider.config.webrtcVideoSubscriptionDisposeTimeout);let a=[];a.push(i.on("onDisposed",e=>this.onSubscriptionDisposed(e))),a.push(i.on("onStreamChanged",()=>{let n=i.stream?.getId(),s=i.localMsi;if(this.updateTrackIds(),i.isStreamReady){let i=Date.now();this.event("onSubscriptionChanged").raise(2,e,t,s,i-r,n),this.diagnostics.addSubscribed(e,t,s,i-r)}})),a.push(i.on("onFailed",(e,t)=>this.onSubscriptionFailed(e,t))),this.subscriptionEvents.set(i,a),this.videoSubscriptions.push(i),n?this.assignStream(i,n):this.logger.safe.info(`waiting for available stream for subscription #${t}`)}return i.createClient()}dispose(){let e=e9();this.videoSubscriptions.concat().forEach(t=>t.dispose(e)),this.streamProvider.setOnStreamsChangedHandler(null),super.dispose(),this.logger.safe.info("disposed")}reriseSubscribeEvents(){this.logger.safe.info(`rerising subscription events: ${this.videoSubscriptions.length}`);let e=[];this.videoSubscriptions.forEach(t=>{let i=t.modality,n=t.msi,r=t.localMsi;this.event("onSubscriptionChanged").raise(1,i,n,r),this.diagnostics.addSubscribe(i,n,r),e.push(...this.getSubscriptionVideoTrackIds(t))}),this.diagnostics.subscribedTrackIds=e}setDiagnostics(e){this.diagnostics=e??new Le(this.configProvider,e=>{this.logger.safe.warn(`Unhandled stats error from inactive subscription manager: ${e}`)})}streamChangedByMsi(e){this.logger.safe.info(`streams changed, subscriptions active: ${this.videoSubscriptions.length}`);let t=this.videoSubscriptions.find(t=>t.msi===e);if(!t)return void this.logger.safe.error(`Subscription for msi ${e} not found`);this.assignSubscriptionToStream(t)}mcpSourceRequestsAvailable(){this.isMcpSrAvailable=!0}streamsChanged(){this.logger.safe.info(`streams changed, subscriptions active: ${this.videoSubscriptions.length}`),this.videoSubscriptions.forEach(e=>{this.assignSubscriptionToStream(e)})}assignSubscriptionToStream(e){let t=!e.stream||this.isStreamRemoved(e.stream);if(this.logger.safe.info(`Subscription for ${e.modality} #${e.msi} needs new stream: ${t}`),!t)return;let i=this.getAvailableStream(e.modality);i?this.assignStream(e,i):this.resignStream(e)}getAvailableStream(e){let t=this.streamProvider.getStreams();return"video"===e&&!this.isMcpSrAvailable&&this.configProvider.config.multiStreamSupported&&(t=t.filter(e=>void 0===e.getSubstreamIndex())),t.find(t=>e===t.getModality()&&-1===t.getMsi())}isStreamRemoved(e){return!this.streamProvider.getStreams().some(t=>t===e)}assignStream(e,t){this.logger.safe.info(`assigning stream #${t.getId()} to subscription #${e.msi}`),e.stream=t}resignStream(e){if(e.stream)this.logger.safe.info(`removing stream from subscription #${e.msi}`),e.stream=null;else{let t=this.streamProvider.getStreams().filter(t=>e.modality===t.getModality()&&-1!==t.getMsi()).length;this.logger.safe.warn(`no stream available for ${e.modality} #${e.msi}, ${e.modality} used stream count: ${t}`)}}disposeInactiveSubscriptionIfNeeded(e){this.getAvailableStream(e)||this.videoSubscriptions.find(t=>t.modality===e&&t.isInactive)?.unsubscribeIfInactive()}onSubscriptionDisposed(e){let t=e9(),i=e.modality,n=e.msi,r=e.localMsi;this.event("onSubscriptionChanged").raise(3,i,n,r),this.diagnostics.addUnsubscribe(i,n,r),this.logger.safe.info(`disposing subscription for ${i} #${n}`),ny(this.videoSubscriptions,t=>t===e),this.streamsChanged(),this.updateTrackIds(),this.subscriptionEvents.has(e)&&(this.subscriptionEvents.get(e).forEach(e=>e.dispose(t)),this.subscriptionEvents.delete(e))}updateTrackIds(){let e=[],t=[];this.videoSubscriptions.forEach(i=>{if(!i.isStreamReady)return;let n=i.stream?.getId().split("-")[1];t.push(n),e.push(...this.getSubscriptionVideoTrackIds(i))}),this.event("onTrackIdsChanged").raise(e),this.diagnostics.subscribedTrackIds=e,this.configProvider.config.subscribeToSsrcForVideo&&this.event("onTrackSsrcChanged").raise(t)}getSubscriptionVideoTrackIds(e){return e?.stream?.getMediaStream()?.getVideoTracks().map(e=>e.id)??[]}onSubscriptionFailed(e,t){this.event("onSubscriptionFailed").raise(-1,e.modality,e.msi,e.localMsi,t),this.diagnostics.addFailed(e.modality,e.msi,e.localMsi,t$(t))}},Le=class{constructor(e,t){this.configProvider=e,this.addStatsError=t,this.data={video:{events:[],counters:{attempted:0,subscribed:0,unsubscribed:0,failed:0}},sharing:{events:[],counters:{attempted:0,subscribed:0,unsubscribed:0,failed:0}},subscribedTrackIds:[]}}set subscribedTrackIds(e){this.data.subscribedTrackIds=e}addSubscribe(e,t,i){let n=this.getModalityData(e);if(n){let e={evt:1,msi:t,localMsi:i,ts:Date.now()};nq(n.events,e,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents),n.counters.attempted++}}addSubscribed(e,t,i,n){let r=this.getModalityData(e);if(r){let e={evt:2,msi:t,localMsi:i,ts:Date.now(),duration:n};nq(r.events,e,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents),r.counters.subscribed++}}addUnsubscribe(e,t,i){let n=this.getModalityData(e);if(n){let e={evt:3,msi:t,localMsi:i,ts:Date.now()};nq(n.events,e,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents),n.counters.unsubscribed++}}addFailed(e,t,i,n){let r=this.getModalityData(e);if(r){let e={evt:-1,msi:t,localMsi:i,ts:Date.now(),error:n};nq(r.events,e,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents),r.counters.failed++}}getObjectRef(){return this.data}getModalityData(e){switch(e){case nu.MEDIA_TYPE.video:return this.data.video;case nu.MEDIA_TYPE.sharing:return this.data.sharing;default:this.addStatsError(`Unsupported modality ${e}`);return}}},Lt=class{constructor(e,t){this.configProvider=e,this.addStatsError=t,this.data={videoMaxCapabilitiesEvents:[],videoMaxCapabilitiesErrors:[],sharingMaxCapabilitiesEvents:[],sharingMaxCapabilitiesErrors:[],currentVideoSsrcRequestedCapabilities:{},currentVideoSsrcAppliedCapabilities:{},currentSharingSsrcRequestedCapabilities:{},currentSharingSsrcAppliedCapabilities:{},numVideoControlMessages:0,numOutOfOrderVideoControlMessages:0,numWebcamFreezeIntervals:0,numProcessedStreamFreezeIntervals:0}}onMaxCapabilitiesRequested(e){let t={causeId:e.causeId,events:[{eventType:"req",timestamp:Date.now(),capabilities:e.capabilities,isSimulcast:e.isSimulcastEnabled}]};try{if(e.modality===nu.MODALITY.video)for(let i of(nq(this.data.videoMaxCapabilitiesEvents,t,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesRequested),this.data.currentVideoSsrcRequestedCapabilities={},e.capabilities))this.data.currentVideoSsrcRequestedCapabilities[`${i.ssrc??0}`]=i;else if(e.modality===nu.MODALITY.sharing)for(let i of(nq(this.data.sharingMaxCapabilitiesEvents,t,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesRequested),this.data.currentSharingSsrcRequestedCapabilities={},e.capabilities))this.data.currentSharingSsrcRequestedCapabilities[`${i.ssrc??0}`]=i}catch(e){this.addStatsError?.("onMaxCapabilitiesRequested",t$(e))}}onMaxCapabilitiesApplied(e){try{let t=this.getEventForCause(e.modality,e.causeId),i={eventType:"app",timestamp:Date.now(),capabilities:e.capabilities,error:`${e.error}`||"none"};if(t&&(nq(t.events,i,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesApplied,1),e.error&&(e.modality===nu.MODALITY.video?nq(this.data.videoMaxCapabilitiesErrors,t,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesApplied,1):e.modality===nu.MODALITY.sharing&&nq(this.data.sharingMaxCapabilitiesErrors,t,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesApplied,1))),e.modality===nu.MODALITY.video)for(let t of(this.data.currentVideoSsrcAppliedCapabilities={},e.capabilities))this.data.currentVideoSsrcAppliedCapabilities[`${t.ssrc??0}`]=t;else if(e.modality===nu.MODALITY.sharing)for(let t of(this.data.currentSharingSsrcAppliedCapabilities={},e.capabilities))this.data.currentSharingSsrcAppliedCapabilities[`${t.ssrc??0}`]=t}catch(e){this.addStatsError?.("onMaxCapabilitiesApplied",t$(e))}}addVideoControlMessage(e=!1){this.data.numVideoControlMessages++,e&&this.data.numOutOfOrderVideoControlMessages++}getObjectRef(){return this.data}registerWebcamFreeze(){this.data.numWebcamFreezeIntervals++}registerProcessedStreamFreeze(){this.data.numProcessedStreamFreezeIntervals++}getEventForCause(e,t){return(e===nu.MODALITY.video?this.data.videoMaxCapabilitiesEvents:this.data.sharingMaxCapabilitiesEvents).find(e=>e.causeId===t)}},Li=class{constructor(e){this.configProvider=e,this.data={renderers:[],firstTimeToFirstFrameVideo:-1,firstTimeToFirstFrameSharing:-1,timeToFirstFrameSinceSubscriptionStartVideo:-1,timeToFirstFrameSinceSubscriptionStartSharing:-1,isRenderingEvents:{video:[],sharing:[]},preferredResolution:{video:[],sharing:[]},preferredResolutionDurations:{video:{},sharing:{}}},this.videoPreferredResolutionTracker=new Sj,this.sharingPreferredResolutionTracker=new Sj,nW(this.data,{preferredResolution:()=>({video:this.videoPreferredResolutionTracker.keys,sharing:this.sharingPreferredResolutionTracker.keys}),preferredResolutionDurations:()=>({video:this.videoPreferredResolutionTracker.durationRatios,sharing:this.sharingPreferredResolutionTracker.durationRatios})})}setTimeToFirstFrame(e,t){-1!==e&&(t===nu.MODALITY.video&&-1===this.data.firstTimeToFirstFrameVideo?this.data.firstTimeToFirstFrameVideo=e:t===nu.MODALITY.sharing&&-1===this.data.firstTimeToFirstFrameSharing&&(this.data.firstTimeToFirstFrameSharing=e))}setTimeToFirstFrameSinceSubscriptionStart(e,t){-1!==e&&(t===nu.MODALITY.video&&-1===this.data.timeToFirstFrameSinceSubscriptionStartVideo?this.data.timeToFirstFrameSinceSubscriptionStartVideo=e:t===nu.MODALITY.sharing&&-1===this.data.timeToFirstFrameSinceSubscriptionStartSharing&&(this.data.timeToFirstFrameSinceSubscriptionStartSharing=e))}setIsRendering(e,t){this.data.isRenderingEvents[t]&&tq(this.data.isRenderingEvents[t],{isRendering:e,ts:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numIsRenderingEvents)}setPreferredResolution(e,t){if(e.width||e.height){let i=`${e.width}x${e.height}`;t===nu.MODALITY.video?this.videoPreferredResolutionTracker.captureSample(i):t===nu.MODALITY.sharing&&this.sharingPreferredResolutionTracker.captureSample(i)}}newRendererDiagnostics(){let e=new Ln(this,this.configProvider),t=e.on("onDisposed",()=>{this.removeDeadRenderers(),t.dispose()});return this.data.renderers.push(e.getObjectRef()),e}getObjectRef(){return this.data}removeDeadRenderers(){this.data.renderers=this.data.renderers.filter(e=>e.alive)}},Ln=class extends no{constructor(e,t){super(),this.managerDiagnostics=e,this.configProvider=t,this.isAlive=!0,this.data={alive:!0,isRendering:!1,timeToFirstFrame:-1,timeToFirstFrameSinceSubscriptionStart:-1,rendererStates:[]},delete this.data.alive,Object.defineProperty(this.data,"alive",{get:()=>this.isAlive,enumerable:!1,configurable:!1})}set trackId(e){this.data.trackId=e}set rendererSize(e){this.data.rendererSize=e,e.toString=()=>`${e.width}x${e.height}`,this.managerDiagnostics.setPreferredResolution(e,this.data.modality)}set msi(e){this.data.msi=e}set modality(e){this.data.modality=e}set isRendering(e){this.data.isRendering=e,this.managerDiagnostics.setIsRendering(e,this.data.modality)}set timeToFirstFrame(e){this.data.timeToFirstFrame=e,this.managerDiagnostics.setTimeToFirstFrame(e,this.data.modality)}set timeToFirstFrameSinceSubscriptionStart(e){this.data.timeToFirstFrameSinceSubscriptionStart=e,this.managerDiagnostics.setTimeToFirstFrameSinceSubscriptionStart(e,this.data.modality)}addStateChange(e){tq(this.data.rendererStates,e,this.configProvider.config.diagnostics.telemetryLimits.numRendererStateChangedEvents)}dispose(){this.isAlive=!1,this.event("onDisposed").raise()}getObjectRef(){return this.data}},Lr=i(892891),Ls=eR(e5()),La=i(892891);function Lo(e){let t="";return nh(e,(e,i)=>{t+=(t?";":"")+i,void 0!==e&&(t+=`=${e}`)}),t}var Ll=class{constructor(e){this.parameters={},e&&e.split(";").forEach(e=>{let t=e.split("=");this.parameters[t[0]]=t[1]})}setIfMissing(e,t){this.contains(e)||(this.parameters[e]=t)}removeIfPresent(e){this.contains(e)&&delete this.parameters[e]}get(e){return this.parameters[e]}names(){return Object.keys(this.parameters)}contains(e){return this.parameters.hasOwnProperty(e)}toString(){return Lo(this.parameters)}};function Lc(e,t,i){if(!e.rtp)return;let n=e.rtp.filter(e=>e.payload===t)[0];n&&Lu(e,{codec:n.codec,rate:n.rate,payload:n.payload,encoding:n.encoding},e=>(e.rtp.payload=i,e))}function Ld(e){let t=new Set;for(let i of e.media)for(let e of i.rtp??[])t.add(e.payload);let i=[96,127];for(let e=i[0];e<=i[1];e++)if(!t.has(e))return e;let n=[35,64];for(let e=n[0];e<=n[1];e++)if(!t.has(e))return e;return -1}function Lu(e,t,i,n){Lg(e,t,!0,n,i)}function Lh(e,t,i,n){Lg(e,t,!1,n,i)}function Lg(e,t,i,n=!0,r){if(e?.rtp){for(let s=0;s<e.rtp.length;s++){let a=e.rtp[s],o=a.payload;if(t.codec.toLowerCase()!==a.codec.toLowerCase()||t.rate!==a.rate||t.encoding!==a.encoding||t.payload&&t.payload!==a.payload)continue;let l={rtp:a};e.fmtp||(e.fmtp=[]);let c=e.fmtp.find(e=>a.payload===e.payload);l.fmtp=c,e.rtcpFb||(e.rtcpFb=[]),l.rtcpFb=e.rtcpFb.filter(e=>e.payload===a.payload);let d=l.rtcpFb.length>0;if(null===r(l))e.payloads=e.payloads.toString().split(" ").filter(e=>a.payload!==+e).join(" "),e.fmtp=e.fmtp.filter(e=>a.payload!==e.payload),e.rtcpFb=e.rtcpFb.filter(e=>a.payload!==e.payload),e.rtp[s]=null;else{if(l.rtp.payload!==o){let t=l.rtp.payload;e.payloads=e.payloads.toString().split(" ").map(e=>+e===o?t:+e).join(" "),l.fmtp&&(l.fmtp.payload=t),l.rtcpFb&&l.rtcpFb.forEach(e=>e.payload=t),n&&e.fmtp.filter(e=>e.config&&e.config.indexOf(`apt=${o}`)>-1).forEach(e=>e.config=e.config.replace(`apt=${o}`,`apt=${t}`))}!c&&l.fmtp&&e.fmtp.push(l.fmtp),!d&&l.rtcpFb&&l.rtcpFb.forEach(t=>e.rtcpFb.push(t))}if(i)break}e.rtp=e.rtp.filter(e=>!!e)}}function Lp(e,t){if(!e.rtp)return;let i=-1;if(e.rtp.forEach(function(e,n){t.codec.toLowerCase()!==e.codec.toLowerCase()||t.rate!==e.rate||t.encoding!==e.encoding||t.payload&&t.payload!==e.payload||(i=n)}),i>=0&&e.rtp.length>1){let t=e.rtp[i].payload;e.rtp.splice(i,1),e.payloads=e.payloads.split(" ").filter(e=>t!==+e).join(" "),e.fmtp=e.fmtp?.filter(e=>t!==e.payload)}}function Lf(e,t){e.rtp.unshift({payload:t.payload,codec:t.codec,rate:t.rate,encoding:t.encoding}),e.payloads=`${t.payload} ${e.payloads}`}function Lm(e,t,i){return!(!(0,La.isUndefined)(e.rate)&&e.rate!==t.rate||!(0,La.isUndefined)(e.codec)&&e.codec.toLowerCase()!==t.codec.toLowerCase()||!(0,La.isUndefined)(e.encoding)&&(!(0,La.isUndefined)(t.encoding)&&e.encoding!==t.encoding||(0,La.isUndefined)(t.encoding)&&1!==e.encoding))&&(!!(0,La.isUndefined)(e.fmtpLine)||!!i?.find(i=>i.payload===t.payload&&-1!==i.config.toLowerCase().indexOf(e.fmtpLine.toLowerCase())))}function Lv(e,t){return t===e||"*"===t}function LS(e,t,i,n){if(!e.rtp?.length)return;let r=e.rtp.filter(i=>t.some(t=>Lm(t,i,e.fmtp)));if(e.type===nu.MEDIA_TYPE.video&&(r=r.filter(t=>{let i=e.fmtp?.find(e=>e.payload===t.payload&&e.config.startsWith("apt="));if(i){let e=+i.config.split(";")[0].split("=")[1];return r.some(t=>t.payload===e)}return!0})),r.length)e.rtp=r;else{n&&n.warn("Empty rtp list after filtering");return}i&&(e.rtp=(0,La.flatten)(t.map(t=>e.rtp.filter(i=>Lm(t,i,e.fmtp))))),e.payloads=e.rtp.map(e=>e.payload).join(" "),e.fmtp=e.fmtp?.filter(t=>e.rtp.some(e=>Lv(e.payload,t.payload))),e.rtcpFb=e.rtcpFb?.filter(t=>e.rtp.some(e=>Lv(e.payload,t.payload)))}function Ly(e){if(e.label)switch(e.label){case nu.MEDIA_LABEL.audio:return"Audio";case nu.MEDIA_LABEL.video:return"Video";case nu.MEDIA_LABEL.sharing:return"ScreenShare";case nu.MEDIA_LABEL.data:return"Data"}else switch(e.type){case nu.MEDIA_TYPE.audio:return"Audio";case nu.MEDIA_TYPE.video:return"Video";case nu.MEDIA_TYPE.data:case nu.MEDIA_TYPE.dataChannel:return"Data"}return null}function LC(e){if(e.label)switch(e.label){case nu.MEDIA_LABEL.audio:return nu.MODALITY.audio;case nu.MEDIA_LABEL.video:return nu.MODALITY.video;case nu.MEDIA_LABEL.sharing:return nu.MODALITY.sharing;case nu.MEDIA_LABEL.data:return nu.MODALITY.data}else switch(e.type){case nu.MEDIA_TYPE.audio:return nu.MODALITY.audio;case nu.MEDIA_TYPE.video:return nu.MODALITY.video;case nu.MEDIA_TYPE.data:case nu.MEDIA_TYPE.dataChannel:return nu.MODALITY.data}return null}function Lb(e){switch(e){case nu.MODALITY.audio:return nu.MEDIA_LABEL.audio;case nu.MODALITY.video:return nu.MEDIA_LABEL.video;case nu.MODALITY.sharing:return nu.MEDIA_LABEL.sharing;case nu.MODALITY.data:return nu.MEDIA_LABEL.data;default:return null}}function LT(e){return e.media.reduce((e,t)=>{if(0!==t.port){let i=LC(t);if(!(i in e)){let n=t.direction?t.direction.toLowerCase():nu.MEDIA_STATE.sendReceive;e[i]=n}}return e},{})}function LE(e){switch(e){case nu.MODALITY.audio:return nu.MEDIA_TYPE.audio;case nu.MODALITY.video:case nu.MODALITY.sharing:return nu.MEDIA_TYPE.video;case nu.MODALITY.data:return nu.MEDIA_TYPE.data;default:return null}}function L_(e){let t=e.groups?.find(e=>"BUNDLE"===e.type);if(t){let i=t.mids?.toString().split(" ")[0];return e.media.find(e=>i===("number"==typeof e.mid?e.mid.toString():e.mid))||null}return null}function LI(e){return 0===e.port}function Lw(e){let t;return e&&Lu(e,{codec:"h264",rate:9e4},e=>{e.fmtp?.config&&(t=LR(e.fmtp.config))}),t}function LP(e){let t=e.media.map(e=>parseFloat(e.mid||"0"));for(let e=1;e<=Math.max(...t)+1;e++)if(!t.includes(e))return e.toString();return"-1"}function LR(e){let t=new Ll(e);return{maxFs:+t.get(nu.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+t.get(nu.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:t.get(nu.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*t.get(nu.VIDEO_CAPABILITIES.MAX_BR_PATH)}}function LA(e,t){for(let i of e.split(/(?=^m=)/m))if(i.includes(t)){let e=i.match(/a=x-multi-stream:(\d+)/);if(e)return parseInt(e[1])}}var LM=i(892891);function LD(){let e=[{jsep:"active",msSdp:"tcp-act"},{jsep:"passive",msSdp:"tcp-pass"},{jsep:"so",msSdp:"tcp-so"}];function t(e,t){if(e.port&&!e.candidates.length){let i=L_(t);i&&(e.port=i.port,e.connection=i.connection)}}function i(e,t){delete e.generation,delete e["network-id"],delete e["network-cost"],e.transport.match(/tcp/i)&&n(e,t)}function n(t,i){e.some(function(e){if(i){if(e.msSdp===t.transport.toLowerCase())return t.transport="tcp",t.tcptype=e.jsep,!0}else if(t.tcptype&&e.jsep===t.tcptype.toLowerCase())return t.transport=e.msSdp,delete t.tcptype,!0;return!1})}function r(e,t,i){let n=t.connection||i.connection,r=function(e,t,i){return e.port===i&&e.ip===t};return!!n&&(1===e.component?r(e,n.ip,t.port):!!t.rtcp&&r(e,t.rtcp.ip||n.ip,t.rtcp.port))}this.fromMsSdp=function(e){e.candidates=e.candidates||[],e.xCandidatesIpv6&&(e.xCandidatesIpv6.forEach(function(t){e.candidates.push(t)}),delete e.xCandidatesIpv6),e.candidates.forEach(function(e){i(e,!0)})},this.toMsSdp=function(e,n){e.candidates=e.candidates||[],e.candidates.sort(function(t,i){return t.foundation!==i.foundation?t.foundation-i.foundation:t.component!==i.component?t.component-i.component:r(i,e,n)-r(t,e,n)}),e.candidates=e.candidates.filter(function(t,n){i(t,!1);let r=e.candidates[n-1];return!r||r.component!==t.component||r.foundation!==t.foundation}),t(e,n)}}var LO=()=>new LD,Lk=class{toMsSdp(e,t){"offer"===t?e.rtcp&&(e.rtcp={port:e.port}):delete e.rtcp}},LN=()=>new Lk,Lx="mainAudio",LL="mainVideo",LF="applicationsharingVideo",LU="-",L$=[{label:nu.MEDIA_LABEL.audio,id:Lx},{label:nu.MEDIA_LABEL.video,id:LL},{label:nu.MEDIA_LABEL.sharing,id:LF}].reduce((e,t)=>(e[t.label]=t.id,e),{}),LV=nR(),LB=class{constructor(e){this.configuration=e}fromMsSdp(e){if(0===e.port)return;let t="-";if(e.msid){e.ssrcs&&1===e.ssrcs.length&&(this.addStream(e,e.ssrcs[0].id,e.ssrcs[0].value,e.msid),e.ssrcs.shift());let i=e.msid.split(" ");(this.configuration.addPrefixForMsid||i[0]===t)&&(e.msid=this.getMsidValue(i[0],i[1]||i[0],e.label))}if(e.ssrcs)this.updateMsids(e.ssrcs,(i,n)=>this.configuration.addPrefixForMsid||i===t?this.getMsidValue(i,n,e.label):`${i} ${n}`);else{let t=this.getFlowSsrcs(e);t.length>0?t.forEach(i=>{this.addStream(e,i,LV,this.getMsidValue(t[0],t[0],e.label))}):e.xSsrcRange&&this.addStream(e,e.xSsrcRange.ssrcMin,LV,this.getMsidValue(e.xSsrcRange.ssrcMin,e.xSsrcRange.ssrcMin,e.label))}delete e.xSsrcRange}toMsSdp(e,t){let i;0!==e.port&&(e.ssrcs?.[0]&&(i=e.ssrcs[0].id),void 0===i||e.xMultiStream||(e.xSsrcRange={ssrcMin:i,ssrcMax:i+t}))}getFlowSsrcs(e){if(e.ssrcGroups&&e.type===nu.MEDIA_TYPE.video){let t;if(e.ssrcGroups.some(e=>"FID"===e.semantics&&(t=e,!0)),t)return t.ssrcs.split(" ").map(e=>+e)}return[]}addStream(e,t,i,n){e.ssrcs=e.ssrcs||[],e.ssrcs.push({attribute:"cname",id:t,value:i}),e.ssrcs.push({attribute:"msid",id:t,value:n})}updateMsids(e,t){e.filter(e=>"msid"===e.attribute).forEach(e=>{let i=e.value.split(" ");e.value=t(i[0],i[1]||i[0])})}getMsidValue(e,t,i){let n=this.getMsidPrefix(i);return n+e+" "+n+t}getMsidPrefix(e){return L$[e]?L$[e]+LU:""}},LH={audio:"main-audio",video:"main-video"},Lj=class{constructor(e,t){this.context=e,this.mediaManager=t,this.logger=this.context.logger,this.candidateTransform=LO(),this.streamTransform=new LB(this.context.configuration),this.rtcpTransform=LN()}toMsSdp(e,t){return e.msidSemantic={semantic:"WMS",token:"*"},e.media.forEach((i,n)=>{if(i.protocol=nu.PROFILES.rtpSavp,i.label=i.label||this.getLabel(i.type),LI(i)){for(let e in i)i.hasOwnProperty(e)&&0>["type","port","protocol","payloads"].indexOf(e)&&delete i[e];i.payloads="34"}let r=this.getSsrcRangeForIndex(i.direction,n);this.streamTransform.toMsSdp(i,r),i.crypto&&i.crypto.forEach(function(e){e.config+="|2^31"}),0!==i.port&&e.fingerprint&&(i.fingerprint=e.fingerprint),this.candidateTransform.toMsSdp(i,e),this.rtcpTransform.toMsSdp(i,t),i.invalid&&(this.logger.unsafe.error(`Unknown SDP attributes! ${JSON.stringify(i.invalid)}`),delete i.invalid),this.transformExtensions(i,!1),0!==i.port&&(i.type===nu.MEDIA_TYPE.audio&&this.context.configProvider.config.webrtcAudioChannelSignalingFeedback?i.signalingFbXMessage={payload:"*",param:this.context.configProvider.config.webrtcAudioChannelSignalingFeedback}:i.type===nu.MEDIA_TYPE.video&&this.context.configProvider.config.webrtcVideoChannelSignalingFeedback&&(i.signalingFbXMessage={payload:"*",param:this.context.configProvider.config.webrtcVideoChannelSignalingFeedback}))}),delete e.fingerprint,e}fromMsSdp(e,t){for(let i=e.media.length-1;i>=0;--i){let n=e.media[i];if((n.ssrcs?.[0]||n.xSsrcRange)&&(e.msidSemantic={semantic:"WMS",token:"*"}),LI(n)){n.direction||(n.direction="inactive");continue}if(this.streamTransform.fromMsSdp(n),delete n.cryptoscale,n.fingerprint&&this.isOffer(t)&&(!this.context.configProvider.config.disableIncomingDtlsRoleOverride||!n.setup)&&(n.setup="actpass"),n.crypto)for(let e=n.crypto.length-1;e>=0;--e){let t=n.crypto[e];if(t.config.match(/.*\|\d+:\d+/)){n.crypto.splice(e,1);continue}t.config=t.config.replace(/(.*)\|2\^\d+/,"$1")}n.remoteCandidates&&(delete n.candidates,delete n.xCandidatesIpv6,delete n.remoteCandidates),this.candidateTransform.fromMsSdp(n),n.rtcpFbXMessage&&delete n.rtcpFbXMessage,n.invalid&&this.logger.unsafe.info(`Unknown SDP attributes! ${JSON.stringify(n.invalid)}`),this.transformExtensions(n,!0)}return e}transformExtensions(e,t){let i=[{name:nu.ABS_SEND_TIME.EXT_URI,encoded:nu.ABS_SEND_TIME.MSSDP_ENCODED_URI},{name:nu.TRANSPORT_CC.EXT_URI,encoded:nu.TRANSPORT_CC.MSSDP_ENCODED_URI}];e.ext&&e.ext.forEach(function(e){i.some(function(i){let n=t?i.encoded:i.name,r=t?i.name:i.encoded;return n===e.uri&&(e.uri=r,!0)})})}isOffer(e){return"offer"===e}getLabel(e){return LH.hasOwnProperty(e)&&LH[e]||"undefined"}getSsrcRangeForIndex(e,t){let i=this.mediaManager.getMediaEntities()[t],n=i?.getSimulcastContext();return mY(e)&&n?n.getSsrcRange():0}},Lq=0xffffff00,LW=class{constructor(){this.ssrc=Math.floor(Math.random()*(Lq-1))+1}nextAudioStreamSsrc(){return this.nextSsrc(0)}nextVideoStreamSsrc(){return this.nextSsrc(99)}nextSsrc(e){let t=this.ssrc;do t=this.ssrc,this.ssrc=(this.ssrc+e+1)%Lq,0===this.ssrc&&(this.ssrc=1);while(t+e>Lq);return{min:t,max:t+e}}},LG=i(892891),Lz=class{constructor(e,t,i){this.mediaEntity=e,this.logger=t,this.configProvider=i,this.activeRids=[],this.isLocalDescSet=!1,this.enabledLocally=!1,this.enabledRemotely=!1;let n=vt(this.mediaEntity.getModality());if(this.config=LJ(n,this.configProvider),!this.config)return void this.logger.safe.debug(`Simulcast is disabled for ${e.getModality()}`);this.logger.safe.debug(`Adding simulcast info to ${e.getModality()} with mid: ${e.getMid()}, config: ${JSON.stringify(this.config)}`)}get ridList(){return this.config?(0,LG.times)(this.config.layerScaleFactors.length,e=>e+1):[]}localDescriptionIsApplied(){this.isLocalDescSet=!0}enableInLocalDesc(){this.enabledLocally=!0}shouldBeEnabledInLocalDesc(){return!!this.config&&(this.config.enableLocally||this.enabledRemotely)}enableInRemoteDesc(){this.enabledRemotely=!0}shouldBeEnabledInRemoteDesc(){return!!this.config&&(this.enabledLocally||this.config.allowEnableRemotely&&this.isMidRidHeaderExtPresented()&&!this.isLocalDescSet)}shouldUseSimulcast(){return this.shouldBeEnabledInLocalDesc()}getSsrcRange(){return 99*!!this.shouldUseSimulcast()}isMidRidHeaderExtPresented(){let e=this.mediaEntity.getRtpHeaderExtensions();return e?.some(e=>"mid"===e.headerType||"rid"===e.headerType||"rrid"===e.headerType)}};function LJ(e,t){return"Video"===e?t.config.specCompliantSimulcast?.video:"ScreenShare"===e?t.config.specCompliantSimulcast?.sharing:null}var LK=i(892891),LQ=[2812,4218,8437,16875,33750,67500,108e3,135e3,198e3,244800,27e4,352500,52e4],LY=class{constructor(e,t,i,n){this.initialMaxFS=e,this.initialMaxFPS=t,this.isAv1Allowed=i,this.h264SubscribeProfile=n,this.maxFS=e,this.maxFPS=t}setMaxFS(e,t){return this.maxFS!==e&&(this.maxFS=e,!!t)&&(t(this),!0)}getMaxFS(){return this.maxFS}getMaxFPS(){return this.maxFPS}getMaxMBPS(){return this.calculateMbps(this.maxFS,this.maxFPS)}calculateMbps(e,t){return nN(LQ,e*t/100,!0)}resetToInitial(){this.maxFS=this.initialMaxFS,this.maxFPS=this.initialMaxFPS}fmtpParams(){return{"max-fs":this.getMaxFS(),"max-mbps":this.getMaxMBPS(),"max-fps":this.getMaxFPS()}}buildFmtp(){let e=[],t=this.fmtpParams();return this.h264SubscribeProfile&&(t["profile-level-id"]=this.h264SubscribeProfile),e.push(t),this.isAv1Allowed&&((t=this.fmtpParams()).codec="AV1",e.push(t)),e}},LZ=class e{constructor(e,t){this.entity=e,this.configProvider=t,this.supportedSendProfiles={}}toString(){return`MediaEntity: ${this.entity.modality} 
mid: ${this.entity.mid} localRecvCaps: ${JSON.stringify(this.localRecvCapabilities?.buildFmtp())}  remoteRecvCaps: ${JSON.stringify(this.remoteRecvCapabilities)}  localSsrc: ${this.getLocalSsrc()} remoteSsrc: ${this.getRemoteSsrc()} localTrackId: ${this.getLocalTrackId()} remoteStreamId: ${this.getRemoteStreamId()} remoteTrackId: ${this.getRemoteTrackId()} xSourceStreamId: ${this.getXSourceStreamId()} subStreamIndex: ${this.getSubstreamIndex()} extensions: ${JSON.stringify(this.entity.extensions)} rtpExt: ${JSON.stringify(this.entity.rtpExt)}         `}static getVideoCababilities(e,t,i){let n,r;return e!==nu.MEDIA_TYPE.video?null:(t===nu.MODALITY.sharing?(n=i.config.webrtcScreensharingCapabilityMaxFS,r=i.config.webrtcScreensharingCapabilityMaxFPS):(n=i.config.webrtcVideoCapabilityMaxFS,r=i.config.webrtcVideoCapabilityMaxFPS,i.config.useMultiviewLimitsOnInitialRequest&&i.config.multiviewResolutionLimits["1"]&&(n=i.getVideoSendLadder().getMaxFsForHeight(i.config.multiviewResolutionLimits["1"]))),new LY(n,r,i.config.isAv1Allowed&&t===nu.MODALITY.sharing,i.config.h264SubscribeProfile))}static create(t,i,n){let r=LE(i),s=new e({modality:i,mid:n,mtype:r,extensions:{}},t);return s.localRecvCapabilities=e.getVideoCababilities(r,i,t),s}clone(){let t=new e((0,LK.cloneDeep)(this.entity),this.configProvider);return t.setSimulcastContext(this.simulcastContext),t.localRecvCapabilities=this.localRecvCapabilities,t.remoteRecvCapabilities=this.remoteRecvCapabilities,t.supportedSendProfiles=this.supportedSendProfiles,t}getModality(){return this.entity.modality}getType(){return this.entity.mtype}getMid(){return this.entity.mid}disable(){this.entity.mid=null}update(t,i){this.entity.modality!==t&&(this.localRecvCapabilities=e.getVideoCababilities(this.entity.mtype,t,this.configProvider)),this.entity.modality=t,this.entity.mid=i,this.isEnabled()&&this.setExtension("rollback",!1)}isDisabled(){return!this.entity.mid}isEnabled(){return!!this.entity.mid}getLocalRecvCapabilities(){return this.localRecvCapabilities}getRemoteRecvCapabilities(){return{sourceId:this.getXSourceStreamId(),capabilities:this.remoteRecvCapabilities?[this.remoteRecvCapabilities]:[]}}setRemoteRecvCapabilities(e){this.remoteRecvCapabilities=e}getRemoteStreamId(){return this.entity.remoteStreamId}setRemoteStreamId(e){this.entity.remoteStreamId=e}setRemoteSsrc(e){this.entity.remoteSsrc=e}getRemoteSsrc(){return this.entity.remoteSsrc}setLocalSsrc(e){this.entity.localSsrc=e}getLocalSsrc(){return this.entity.localSsrc}getRemoteTrackId(){return this.entity.remoteTrackId}setRemoteTrackId(e){this.entity.remoteTrackId=e}getXSourceStreamId(){return this.entity.xSourceStreamId}setXSourceStreamId(e){this.entity.xSourceStreamId=e}setLocalTrackId(e){this.entity.localTrackId=e}getLocalTrackId(){return this.entity.localTrackId}setSubStreamIndex(e){this.entity.subStreamIndex=e}getSubstreamIndex(){return this.entity.subStreamIndex}getExtension(e){return this.entity.extensions[e]}setExtension(e,t){this.entity.extensions[e]=t}getRtpHeaderExtensions(){return this.entity.rtpExt}setRtpHeaderExtensions(e){this.entity.rtpExt=e}setSimulcastContext(e){this.simulcastContext=e}getSimulcastContext(){return this.simulcastContext}addSupportedSendProfile(e,t){void 0===this.supportedSendProfiles[e]&&(this.supportedSendProfiles[e]=new Set),this.supportedSendProfiles[e].add(t)}isSendProfileSupported(e,t){let i=this.supportedSendProfiles[e];if(void 0!==i){let e=t.slice(0,2);for(let t of i)if(t.startsWith(e))return!0}return!1}serialize(){return nw(this.entity)}},LX={toffset:"toffset","abs-send-time":"abs-send-time","video-orientation":"video-orientation","draft-holmer-rmcat-transport-wide-cc-extensions-01":"transport-cc","video-content-type":"video-content-type","video-timing":"video-timing","color-space":"color-space","video-layers-allocation00":"vla","video-layers-allocation00-non-advertised":"non-adv-vla",mid:"mid","rtp-stream-id":"rid","repaired-rtp-stream-id":"rrid","fast_bandwidth_feedback#version_3":"fast_bandwidth_feedback#version_3","frame-counters-gvc":"frame-counters-gvc"},L0=class{constructor(e){this.context=e,this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.ssrcGenerator=new LW,this.rollbackHandlers=[],this.logger=e.logger.createChild("MM2"),this.configProvider=e.configProvider}fromOffer(e,t,i=!1){this.logger.safe.debug(`fromOffer, modalities: ${JSON.stringify(t)} disableOnly: ${i}`),this.updateMediaEntitiesFromModel(e,i),this.updateSharingEntity(!!t.sharing),e.media.forEach(e=>{this.logger.safe.debug(`Media entity for mid: ${e.mid}, ${this.getMediaEntityByMid(e.mid)}`);let t=this.getMediaEntityByMid(e.mid);t&&this.saveLocalSsrc(t,e)})}fromRemote(e,t){let i=0===this.mediaEntities.length;this.updateMediaEntitiesFromModel(e,!1,t),e.media.forEach((e,t)=>{let i=this.getMediaEntityByMid(e.mid);i&&(this.saveRemoteMsid(i,e),this.saveRemoteSsrc(i,e),this.saveRtpHeaderExtensions(i,e),i.setXSourceStreamId(e.xSourceStreamId||this.generateSourceStreamId(t)),i.setRemoteRecvCapabilities(Lw(e)),i.setSubStreamIndex(e.subStreamIndex)),this.logger.safe.debug(`Media entity for mid: ${e.mid}, ${i}`)}),i&&this.updateReinvitelessState(e)}isEmpty(){return 0===this.mediaEntities.length}createMediaEntity(e,t){let i=LZ.create(this.configProvider,e,t);return this.logger.safe.debug(`Creating media entity for modality: ${e}, mid: ${t}`),this.context.useSimulcast&&!this.mediaEntities.find(t=>t.getModality()===e)&&this.setSimulcastContext(i),i.setExtension("reinviteless",!1),this.mediaEntities.push(i),i}getMediaEntities(){return this.mediaEntities}getMediaEntity(e){return this.mediaEntities[e]}getMediaEntityByMid(e){return this.mediaEntities.find(t=>t.getMid()===e)}getMediaEntitiesByModality(e){return this.mediaEntities.filter(t=>t.getModality()===e)}getMediaEntitiesByMediaType(e){let t=vt(e);return this.getMediaEntitiesByModality(t)}getMediaEntityByRemoteStreamId(e){return this.mediaEntities.find(t=>t.getRemoteStreamId()===e)}getMediaEntityByLocalTrackId(e){return this.mediaEntities.find(t=>t.getLocalTrackId()===e)}getMediaEntityByXSourceStreamId(e){return this.mediaEntities.find(t=>t.getXSourceStreamId()===e)}reset(){this.mediaEntities=[],this.rollbackHandlers=[]}syncModalities(e,t,i=!1){this.logger.safe.debug(`syncModalities, modalities: ${JSON.stringify(t)}, disableOnly: ${i},`),this.fromOffer(e,t,i)}setLocalTracksInfo(e){this.mediaTracks=e}getLocalTracksInfo(){return this.mediaTracks}backup(){this.logger.safe.debug("backup"),this.mediaEntitiesBackup=[],this.mediaEntities.forEach(e=>{this.mediaEntitiesBackup.push(e.clone())})}commit(){this.mediaEntitiesBackup=[],this.mediaEntities.forEach(e=>{e.setExtension("unnegotiatedModality",!1)})}rollback(){this.logger.safe.debug(`rollback, if backup exists: ${!!this.mediaEntitiesBackup.length}`),this.mediaEntitiesBackup.length&&(this.rollbackHandlers.forEach(e=>e(this.mediaEntities,this.mediaEntitiesBackup)),this.mediaEntities.forEach((e,t)=>{this.mediaEntitiesBackup[t]?this.mediaEntities[t]=this.mediaEntitiesBackup[t]:(e.disable(),e.setExtension("rollback",!0))}))}updateMediaEntitiesWithLocalTracks(){if(!this.mediaTracks)return void this.logger.safe.debug("No mediaTracks, not updating local tracks for media entities");this.mediaEntities.forEach(e=>e.setLocalTrackId(null)),this.mediaTracks.forEach(e=>{let t=this.getMediaEntitiesByModality(e.modality)[0];if(!t)return void this.logger.safe.error(`Media entity is not found for modality: ${JSON.stringify(e.modality)}`);this.logger.safe.debug(`Setting local track id ${e.trackId} for modality ${e.modality}`),t.setLocalTrackId(e.trackId)})}updateMediaEntitiesWithActivityState(e,t){this.logger.safe.debug(`Updating activity indexes for ${e} to ${JSON.stringify(t)}`);let i=vi(e),n=this.getMediaEntitiesByModality(i)[0];if(!n)return void this.logger.safe.error(`Media entity is not found for modality: ${JSON.stringify(i)}`);let r=n.getSimulcastContext();r&&(r.activeRids=t)}setRollbackUpdateHandler(e){this.rollbackHandlers.push(e)}saveRtpHeaderExtensions(e,t){if(e.isDisabled())return void e.setRtpHeaderExtensions(void 0);let i=t.ext?.map(e=>this.getHeaderExtension(e));this.logger.safe.debug(`RTP header ext for mid=${t.mid}, modality=${e.getModality()}: ${JSON.stringify(i)}`),e.setRtpHeaderExtensions(i)}getHeaderExtension(e){let t="unknown";for(let[i,n]of Object.entries(LX))if(e.uri.endsWith(i)){t=n;break}return{headerType:t,value:e.value}}saveRemoteMsid(e,t){if(LI(t))e.setRemoteStreamId(null);else if(t.msid)e.setRemoteStreamId(t.msid.split(" ")[0]);else if(t.ssrcs){let i=t.ssrcs.find(e=>"msid"===e.attribute);i?e.setRemoteStreamId(i.value.split(" ")[0]):this.logger.safe.warn(`No ssrc msid for media of type ${t.type} with mid ${t.mid}`)}}saveRemoteSsrc(e,t){if(t.ssrcs?.length){let i=t.ssrcs[0];e.setRemoteSsrc(+i.id)}}saveLocalSsrc(e,t){let i=t.ssrcs?.[0]?.id;if(mY(t.direction))this.logger.safe.debug("has no send direction");else{this.logger.safe.debug(`set local SSRC to ${i}`),e.setLocalSsrc(+i);return}let n=i||e.getLocalSsrc()||this.ssrcGenerator.nextVideoStreamSsrc().min;e.setLocalSsrc(+n)}updateMediaEntitiesFromModel(e,t,i){e.media.forEach((e,n)=>{if(this.mediaEntities[n])if(LI(e))this.logger.safe.debug(`Disabling media entity for mid: ${e.mid}`),this.mediaEntities[n].disable();else{let t=e.mid||this.mediaEntities[n].getMid(),i=this.mediaEntities[n].getModality();this.logger.safe.debug(`Updating media entity for mid: ${t}, modality: ${i}`),this.mediaEntities[n].update(i,t),this.logger.safe.debug(`updated entity: ${this.mediaEntities[n]}`)}else t||this.createMediaEntity(LC(e),e.mid||n.toString());!this.mediaEntities[n]||!i||this.mediaEntities[n].getModality()in i||(this.logger.safe.debug(`Disabling media entity for mid: ${e.mid} as it is not found in modalities ${JSON.stringify(i)}`),this.mediaEntities[n].disable())})}updateSharingEntity(e){if(e&&!this.getMediaEntitiesByModality(nu.MODALITY.sharing).length){let e=this.getMediaEntitiesByModality(nu.MODALITY.video).pop();e.update(nu.MODALITY.sharing,e.getMid())}}setSimulcastContext(e){if(!e||e.getSimulcastContext())return;let t=new Lz(e,this.logger.createChild(`SimContext:${e.getModality()}`),this.configProvider);e.setSimulcastContext(t)}generateSourceStreamId(e){return e+10}updateReinvitelessState(e){let t={[nu.MODALITY.audio]:0,[nu.MODALITY.video]:0,[nu.MODALITY.sharing]:0};for(let i of e.media){let e=LC(i);void 0!==t[e]&&t[e]++;let n=this.getMediaEntityByMid(i.mid);if(n){let r=this.context.reinviteltessContext?.maxStreamsForModality[e]>=t?.[e]&&(!i.direction||"sendrecv"===i.direction);n.setExtension("reinviteless",r)}}}},L1=class{constructor(e){this.modifierList=e}modify(e){for(let t of this.modifierList)t.modify(e)}},L2=class{constructor(e,t,i,n){this.context=e,this.mediaManager=t,this.modalities=i,this.cname=n}build(e){switch(e.sdpSource){case 0:return new L1([new FH(this.context.configProvider),new Fm(this.context.configProvider),new FX(this.mediaManager,this.context.configProvider),new FZ(this.mediaManager),new Fw(this.context.configProvider),new FT(this.context.configProvider),new FB(this.context.configProvider,this.mediaManager,e.sdpType,!1,this.context.getLogger().createChild("OverrideH264SendProfile")),new Fy(this.mediaManager,this.context.configProvider,e.sdpType),new F7(this.context.configProvider,e.sdpType),new FN(this.context.configProvider)]);case 2:return new L1([new L9(this.mediaManager,this.modalities),new Fv,new L7(this.mediaManager,!0),new FG(this.context.configProvider,this.mediaManager),new Fa(this.modalities,this.mediaManager),new FM,new FI,new FP,new FA(this.context.configProvider),new F_(this.context.configProvider),new FV(this.context.configProvider),new FB(this.context.configProvider,this.mediaManager,e.sdpType,!0,this.context.getLogger().createChild("OverrideH264SendProfile")),new Fl,new L5,new FQ(this.mediaManager,this.context.configProvider),new Ff(this.context.configProvider),new F4,new F3(this.context.configProvider),new F0(this.context.configProvider),new Fu(this.mediaManager,this.modalities,this.context.configProvider),new Fs(this.context),new F5(this.context.configProvider),new Fn(this.context.configProvider),new Fy(this.mediaManager,this.context.configProvider,e.sdpType),new FC(this.mediaManager,this.context.configProvider,e.sdpType),new FS(this.mediaManager,this.context.configProvider,this.context.config.isConference),new FO(this.context.configProvider,this.context.getLogger()),new Fd,new F8(this.context.configProvider),new FN(this.context.configProvider),new Ue(e,this.context),new FJ(this.context.configProvider),new Fq(this.context.configProvider)]);case 1:return new L1([new Ft(this.context,this.modalities.data),new L7(this.mediaManager,!1),new Fh(this.context.configProvider),new L9(this.mediaManager,this.modalities),new Fc(this.mediaManager),new FI,new FR(this.context.configProvider),new FE(this.context.configProvider),new L6(this.mediaManager,"offer"===e.sdpType,this.context.configProvider),new FY(this.mediaManager,this.context.getLogger()),new F2(this.context.configProvider,this.mediaManager),new Fo(this.context.config.isConference,this.cname),new Fg(this.mediaManager),new Fp,new Fj(this.context.configProvider),new Fr(this.context.configProvider),new F6(this.context.configProvider),new F9(this.context.configProvider),new FC(this.mediaManager,this.context.configProvider,e.sdpType),new FU(this.mediaManager,this.context.configProvider,e.sdpType,this.context.getLogger().createChild("InjectMultiStream")),new F$(this.mediaManager,this.context.configProvider,this.context.config.isConference,e.sdpType,this.context.config.numVbssChannels),new Fq(this.context.configProvider)])}}},L3=class{constructor(e,t,i){this.context=e,this.mediaManager=t,this.sessionType=i,this.msSdpT=new Lj(this.context,this.mediaManager)}modify(e){this.msSdpT.toMsSdp(e,this.sessionType)}},L4=class{constructor(e,t,i){this.context=e,this.mediaManager=t,this.sessionType=i,this.msSdpT=new Lj(this.context,this.mediaManager)}modify(e){this.msSdpT.fromMsSdp(e,this.sessionType)}},L5=class{constructor(){}modify(e){let t=m6(e),i=e.media.find(e=>!!e.crypto);e.media.forEach(e=>{e.type!==nu.MEDIA_TYPE.dataChannel&&(e.fingerprint&&e.crypto&&delete e.crypto,e.protocol=t.dtls?nu.PROFILES.udpTlsRtpSavpf:nu.PROFILES.rtpSavpf,LI(e)&&e.protocol===nu.PROFILES.rtpSavpf&&i&&(e.crypto=i.crypto))})}},L6=class{constructor(e,t,i){this.mediaManager=e,this.isOffer=t,this.configProvider=i}modify(e){e.media.forEach((e,t)=>{let i=e.setup,n=this.mediaManager.getMediaEntityByMid(e.mid)||this.mediaManager.getMediaEntities()[t];if(!n)return;let r=n.getExtension("setup");i&&n.isEnabled()&&("actpass"!==i?n.setExtension("setup",i):this.isOffer&&void 0!==r&&"actpass"!==r&&!this.configProvider.config.disableOutgoingDtlsRoleOverride&&(e.setup=r))})}},L8=class{modify(e){e.media.forEach(e=>{e.direction===nu.MEDIA_STATE.sendReceive&&(e.direction=nu.MEDIA_STATE.receive),e.direction===nu.MEDIA_STATE.send&&(e.direction=nu.MEDIA_STATE.inactive)})}},L9=class{constructor(e,t){this.mediaManager=e,this.modalities=t}modify(e){let t=0;e.media.forEach((e,i)=>{let n=parseInt(e.mid,10);!isNaN(n)&&n>=t&&(t=n+1)}),e.media.forEach((i,n)=>{let r=this.mediaManager.getMediaEntityByMid(i.mid)||this.mediaManager.getMediaEntities()[n];if(r&&(LI(i)||r.isDisabled()||!(r.getModality()in this.modalities))){let s=r.getExtension("midApplied")?void 0:i.mid||`${t++}`;0===n?i.direction=nu.MEDIA_STATE.inactive:e.media[n]=Ut(i.type,void 0,i.protocol,s)}})}},L7=class{constructor(e,t){this.mediaManager=e,this.remote=t}modify(e){let t=this.mediaManager.getMediaEntities();for(let i=0;i<t.length;i++){let n=t[i],r=e.media[i];if(n.getExtension("rollback")){if(r&&!this.remote)e.media[i]=null;else if(!r&&this.remote){let t=n.getType()===nu.MEDIA_TYPE.data?nu.MEDIA_TYPE.dataChannel:n.getType(),i=t===nu.MEDIA_TYPE.dataChannel?nu.PROFILES.udpDtlsSctp:nu.PROFILES.udpTlsRtpSavpf;e.media.push(Ut(t,void 0,i,void 0))}}}e.media=e.media.filter(e=>e)}},Fe=class{constructor(e){this.mediaManager=e}modify(e){this.mediaManager.getMediaEntities().forEach((t,i)=>{let n=e.media[i];t.getModality()!==nu.MODALITY.data||n&&n.type===nu.MEDIA_TYPE.dataChannel||e.media.splice(i,0,Ut(nu.MEDIA_TYPE.data,nu.MEDIA_LABEL.data,nu.PROFILES.rtpSavp,void 0))})}},Ft=class{constructor(e,t){this.context=e,this.direction=t}modify(e){e.media.forEach(e=>{e.type===nu.MEDIA_TYPE.dataChannel&&(e.type=nu.MEDIA_TYPE.data,e.payloads=nu.PAYLOAD_TYPE.X_DATA)}),vc(this.context)&&Ui(e,nu.MEDIA_TYPE.data).forEach(t=>{t.rtp=t.rtp||[],t.fmtp=t.fmtp||[],t.rtp.push({codec:"x-data",payload:127,rate:9e4}),t.rtp.push({codec:"rtx",payload:126,rate:9e4}),t.fmtp.push({payload:126,config:"apt=127"});let i=this.getNonOverlappingSsrc(e);t.xSsrcRange={ssrcMin:i,ssrcMax:i},t.rtcpMux="rtcp-mux",t.xDataProtocol="sctp",t.direction=this.direction})}getNonOverlappingSsrc(e){let t,i=!0;do t=Math.floor(0xfffffffd*Math.random())+2,Ui(e).forEach(e=>{e?.ssrcs?.[0]?.id===t&&(i=!1)});while(!i);return t}},Fi=class{constructor(e){this.configProvider=e,this.uri="urn:3gpp:video-orientation",this.value=13}modify(e){if(this.configProvider.config.enableVideoOrientationExtension)for(let t of Ui(e,nu.MEDIA_TYPE.video))this.modifyMedia(t)}},Fn=class extends Fi{modifyMedia(e){e.ext??(e.ext=[]),e.ext.some(e=>e.uri===this.uri)||e.ext.push({value:this.getAvailableValue(e.ext),uri:this.uri})}getAvailableValue(e){let t=e.map(e=>e.value);return t.includes(this.value)?Math.max(...t)+1:this.value}},Fr=class extends Fi{modifyMedia(e){e.ext=e.ext?.filter(e=>e.uri!==this.uri)}},Fs=class{constructor(e){this.context=e}modify(e){let t=e.groups?.find(e=>"BUNDLE"===e.type);for(let i=e.media.length-1;i>=0;i--){let n=e.media[i];if(n.type===nu.MEDIA_TYPE.data){let r=this.context.configProvider.config.rejectUnbundledDataModality&&!this.context.configProvider.mediaConfig.isTransportUnbundled&&!t?.mids?.toString().includes(n.mid),s=vc(this.context);s||this.context.configProvider.config.acceptDisabledDataModality?(n.port=s&&!r?n.port:0,n.payloads=nu.PAYLOAD_TYPE.DATA_CHANNEL,n.type=nu.MEDIA_TYPE.dataChannel,n.protocol=nu.PROFILES.udpDtlsSctp,n.sctpPort??(n.sctpPort=this.context.configProvider.config.sctpPort),delete n.xDataProtocol,delete n.rtp,delete n.fmtp,delete n.rtcp,delete n.rtcpMux,delete n.ext,delete n.ssrcs,delete n.ssrcGroups,delete n.xSsrcRange):e.media.splice(i,1)}}}},Fa=class{constructor(e,t){this.modalities=e,this.mediaManager=t}modify(e){Ui(e).forEach(e=>{let t=LC(e),i=this.mediaManager.getMediaEntityByMid(e.mid);this.modalities[t]!==nu.MEDIA_STATE.send||i.getExtension("reinviteless")||e.direction&&e.direction.toLowerCase()===nu.MEDIA_STATE.receive||(e.direction=nu.MEDIA_STATE.receive)})}},Fo=class{constructor(e,t){this.isMultiparty=e,this.cname=t}modify(e){this.isMultiparty&&Ui(e).forEach(e=>{let t=e.direction;(t===nu.MEDIA_STATE.receive||t===nu.MEDIA_STATE.inactive)&&(e.ssrcs?.[0]?e.ssrcs=[{id:e.ssrcs[0].id,attribute:"cname",value:this.cname}]:e.type===nu.MEDIA_TYPE.audio?e.ssrcs=[{id:0xfa17fa17,attribute:"cname",value:this.cname}]:e.type===nu.MEDIA_TYPE.video&&(e.ssrcs=[{id:1,attribute:"cname",value:this.cname}]))})}},Fl=class{modify(e){let t=new Set;Ui(e,nu.MEDIA_TYPE.video).forEach(e=>{e.ssrcs&&e.ssrcs.length>1&&t.add(+e.ssrcs[0].id)});let i=Ui(e,nu.MEDIA_TYPE.video).find(e=>e.direction===nu.MEDIA_STATE.sendReceive||e.direction===nu.MEDIA_STATE.send);Ui(e,nu.MEDIA_TYPE.video).forEach(e=>{let n=e.direction;if((n===nu.MEDIA_STATE.receive||n===nu.MEDIA_STATE.inactive)&&e.ssrcs&&1===e.ssrcs.length){let n=e.ssrcs[0].id;(1===n||i&&i.ssrcs[0].id===n||!i&&t.has(n))&&(delete e.ssrcs,delete e.ssrcGroups)}})}},Fc=class{constructor(e){this.mediaManager=e}modify(e){e.media.forEach((e,t)=>{let i=this.mediaManager.getMediaEntityByMid(e.mid)||this.mediaManager.getMediaEntities()[t];i&&(e.label=Lb(i.getModality()))})}},Fd=class{modify(e){e.media.forEach(e=>{delete e.label})}},Fu=class{constructor(e,t,i){this.mediaManager=e,this.modalities=t,this.configProvider=i}modify(e){let t=this.configProvider.mediaConfig.maxBandwidthInKbps,i=e.bandwidth?.find(e=>"CT"===e.type);i&&(!t||t>+i.limit)&&(t=+i.limit);let n=Math.max(t-(this.configProvider.config.audioBandwidthInKbps||0),0),r=this.configProvider.config.videoBandwidthAllocation&&mY(this.modalities.video)&&mY(this.modalities.sharing);Ui(e,nu.MEDIA_TYPE.video).forEach(e=>{if(delete e.bandwidth,n){let t=n;r&&(t=Math.round(n*(this.mediaManager.getMediaEntityByMid(e.mid).getModality()===nu.MODALITY.video?this.configProvider.config.videoBandwidthAllocation:1-this.configProvider.config.videoBandwidthAllocation))),e.bandwidth=[{limit:t,type:"AS"}]}})}},Fh=class{constructor(e){this.configProvider=e}modify(e){let t=this.configProvider.mediaConfig.maxBandwidthInKbps;t&&(e.bandwidth=[{limit:t,type:"CT"}])}},Fg=class{constructor(e){this.mediaManager=e}modify(e){e.media.forEach((e,t)=>{let i=this.mediaManager.getMediaEntityByMid(e.mid)||this.mediaManager.getMediaEntities()[t];if(!i)return;let n=i.getExtension("iceUfrag");i.setExtension("iceRestart",!!e.iceUfrag&&!!n&&n!==e.iceUfrag),i.setExtension("iceUfrag",e.iceUfrag)})}},Fp=class{modify(e){let t=new Set(["urn:ietf:params:rtp-hdrext:csrc-audio-level","http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"]);Ui(e).forEach(e=>{e.ext&&(e.ext=e.ext.filter(e=>!t.has(e.uri)))})}},Ff=class{constructor(e){this.configProvider=e}modify(e){this.configProvider.config.extmapAllowMixed&&(e.extmapAllowMixed="extmap-allow-mixed")}},Fm=class{constructor(e){this.configProvider=e}modify(e){this.configProvider.config.extmapAllowMixed||delete e.extmapAllowMixed}},Fv=class{modify(e){Ui(e).forEach(e=>{delete e.signalingFbXMessage})}},FS=class{constructor(e,t,i){this.mediaManager=e,this.configProvider=t,this.isConference=i}modify(e){this.configProvider.config.isAv1Allowed&&this.isConference&&this.mediaManager.getMediaEntities().forEach((t,i)=>{let n=e.media[i];t.getModality()===nu.MODALITY.sharing&&this.configProvider.config.av1LevelIndex&&Lh(n,{codec:"AV1",rate:9e4},e=>{let t=(e,t)=>e.replace(/level-idx=\d+((\.\d+)+)?/g,`level-idx=${t}`);e.fmtp.config=t(e.fmtp.config,this.configProvider.config.av1LevelIndex)})})}},Fy=class{constructor(e,t,i){this.mediaManager=e,this.configProvider=t,this.sdpType=i,this.baseModifier=new Fb(this.mediaManager,this.configProvider,this.sdpType,!1)}modify(e){this.configProvider.config.filterCodecsInSdpV2||this.baseModifier.modify(e)}},FC=class{constructor(e,t,i){this.mediaManager=e,this.configProvider=t,this.sdpType=i,this.baseModifier=new Fb(this.mediaManager,this.configProvider,this.sdpType,!0)}modify(e){this.configProvider.config.filterCodecsInSdpV2&&this.baseModifier.modify(e)}},Fb=class{constructor(e,t,i,n=!1){this.mediaManager=e,this.configProvider=t,this.sdpType=i,this.alwaysReorder=n}modify(e){this.configProvider.config.filterCodecsInSdp&&"offer"===this.sdpType&&this.mediaManager.getMediaEntities().forEach((t,i)=>{let n=e.media[i];if(!n)return;let r=vd(this.configProvider,n.type);r.length&&LS(n,vu(r),!!t.getExtension("unnegotiatedModality")||this.alwaysReorder,null)})}},FT=class{constructor(e){this.configProvider=e}modify(e){let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio);if(!t)return;let i=this.configProvider.mediaConfig.audioCodecContext;if(!i?.enabledLocally){this.removeSubstitutionCodec(t,"SatinFB"),this.removeSubstitutionCodec(t,"MUCHv2");return}i.codec!==i.lastUsedCodec&&"None"!==i.lastUsedCodec&&this.removeSubstitutionCodec(t,i.lastUsedCodec),i.enabledLocally&&!i.disabledRemotely&&this.addSubstitutionCodecIfNeeded(t,i.codec,e)}addSubstitutionCodecIfNeeded(e,t,i){if(this.isSubstitutionCodecAdded(e,t))return;let n=Ld(i);if(-1===n)return;let r=Us(t,"SUBSTITUTION");Ua(i,r.payload,n),Lf(e,r)}removeSubstitutionCodec(e,t){Lp(e,Us(t,"SUBSTITUTION"))}isSubstitutionCodecAdded(e,t){let i=!1;return Lu(e,Us(t,"SUBSTITUTION"),()=>{i=!0}),i}},FE=class{constructor(e){this.configProvider=e}modify(e){let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio);if(!t)return;let i=this.configProvider.mediaConfig.audioCodecContext;if(!i?.enabledLocally||i.disabledRemotely){this.removeSubstitutionCodec(t,"SatinFB"),this.removeSubstitutionCodec(t,"MUCHv2");return}let n=Us(i.codec,"SUBSTITUTION"),r=Us(i.codec,"CODEC");Lu(t,n,e=>{e.rtp.codec=r.codec,e.rtp.rate=r.rate,e.rtp.encoding=r.encoding,"SatinFB"===i.codec&&(e.fmtp={payload:r.payload,config:"decoderversion=1"})})}removeSubstitutionCodec(e,t){Lp(e,Us(t,"SUBSTITUTION"))}},F_=class{constructor(e){this.configProvider=e}modify(e){let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio);if(!t)return;let i=this.configProvider.mediaConfig.audioCodecContext;if(!i?.enabledLocally){this.removeCodec(t,"SatinFB"),this.removeCodec(t,"MUCHv2");return}let n=Us(i.codec,"CODEC"),r=Us(i.codec,"SUBSTITUTION"),s=!1;Lu(t,n,e=>{i.enabledForSend&&(e.rtp.codec=r.codec,e.rtp.rate=r.rate,e.rtp.encoding=r.encoding,e.fmtp={payload:n.payload,config:"ptime=20"}),s=!0}),i.disabledRemotely=!s}removeCodec(e,t){Lp(e,Us(t,"CODEC")),Lp(e,Us(t,"SUBSTITUTION"))}},FI=class{modify(e){Lp(e.media.find(e=>e.type===nu.MEDIA_TYPE.audio),{codec:"CN",rate:16e3})}},Fw=class{constructor(e){this.configProvider=e}modify(e){if(this.configProvider.config.disableAddComfortNoiseFB)return;let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio);if(!t)return;let i=!1,n={codec:"CN",rate:48e3};if(Lu(t,n,()=>{i=!0}),i)return;let r=Ld(e);-1!==r&&(n.payload=r,Lf(t,n))}},FP=class{modify(e){Lp(e.media.find(e=>e.type===nu.MEDIA_TYPE.audio),{codec:"g722",rate:8e3,encoding:2})}},FR=class{constructor(e){this.configProvider=e}modify(e){if(!this.configProvider.config.removeComfortNoiseChannelParameter)return;let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio);t&&Lu(t,{codec:"CN",rate:48e3,encoding:1},e=>{delete e.rtp.encoding})}},FA=class{constructor(e){this.configProvider=e}modify(e){let t=this.configProvider.config.enforceOpusFmtp;t&&Lu(e.media.find(e=>e.type===nu.MEDIA_TYPE.audio),{codec:"opus",rate:48e3,encoding:2},e=>{e.fmtp||(e.fmtp={payload:e.rtp.payload});let i=new Ll(e.fmtp.config);Object.keys(t).forEach(e=>{i.removeIfPresent(e),i.setIfMissing(e,`${t[e]}`)}),e.fmtp.config=i.toString()})}},FM=class{modify(e){let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio);if(t&&LI(t)){let i=e.media.find(e=>!!e.iceUfrag);i&&(t.port=9,t.direction="inactive",t.iceUfrag=i.iceUfrag,t.icePwd=i.icePwd,t.rtcpMux="rtcp-mux",i.crypto&&(t.crypto=i.crypto),i.fingerprint&&(t.fingerprint=i.fingerprint,t.setup=i.setup),t.rtp=[{payload:0,codec:"PCMU",rate:8e3}],t.payloads="0")}}},FD=class{constructor(e){this.otherPartyCodecs=e}modify(e){let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio),i=["cn","telephone-event"],n=t.rtp.filter(e=>-1!==this.otherPartyCodecs.indexOf(e.codec.toLowerCase())&&-1===i.indexOf(e.codec.toLowerCase()));if(0===n.length)throw Error("there is no matching primary audio codec");t.rtp.filter(e=>e!==n[0]&&-1===i.indexOf(e.codec.toLowerCase())).forEach(e=>{Lp(t,e)})}},FO=class{constructor(e,t){this.configProvider=e,this.logger=t}modify(e){this.configProvider.config.webrtcInjectTransportCCAudio&&Ui(e,nu.MEDIA_TYPE.audio).forEach(e=>{if(!e.ext?.find(e=>e.uri===nu.TRANSPORT_CC.EXT_URI))return void this.logger.safe.info("transport-cc ext not present in sdp, skipping injecting transport-cc attribute for audio");let t=e.rtp?.find(e=>"opus"===e.codec.toLowerCase());if(!t)return void this.logger.safe.info("opus codec not found, skipping injecting transport-cc attribute for audio");let i=t.payload;e.rtcpFb?.find(e=>e.type===nu.TRANSPORT_CC.ATTRIBUTE&&e.payload===i)?this.logger.safe.info("opus codec already has transport-cc attribute"):(e.rtcpFb=e.rtcpFb||[],e.rtcpFb.push({payload:i,type:nu.TRANSPORT_CC.ATTRIBUTE}),this.logger.safe.info("injected transport-cc attribute"))})}},Fk=class{constructor(e,t){this.mediaManager=e,this.configProvider=t}modify(e){e.media.forEach((e,t)=>{if(LI(e)||e.type!==nu.MEDIA_TYPE.video)return;let i=this.mediaManager.getMediaEntityByMid(e.mid);Lu(e,{codec:"h264",rate:9e4},e=>{let t=i.getLocalRecvCapabilities();if(!t)return;e.fmtp||(e.fmtp={payload:e.rtp.payload});let n=new Ll(e.fmtp.config);this.configProvider.config.h264SdpProfile?(n.removeIfPresent("profile-level-id"),n.setIfMissing("profile-level-id",this.configProvider.config.h264SdpProfile)):n.setIfMissing("profile-level-id","42C02A"),n.setIfMissing("max-fs",t.getMaxFS().toString()),n.setIfMissing("max-mbps",t.getMaxMBPS().toString()),n.setIfMissing("max-fps",t.getMaxFPS().toString()),e.fmtp.config=n.toString()})})}},FN=class{constructor(e){this.configProvider=e}modify(e){if(!this.configProvider.config.removeRtcpRsizeFromLocalSdp)return;let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio);t?.rtcpRsize&&delete t.rtcpRsize}},Fx=class{constructor(e,t){this.configProvider=e,this.numVbssChannels=t}modify(e,t,i,n,r){let s=e.media[r];if(!s)return;let a=s.xMultiStream.startSsrc,o=s.xMultiStream.ssrcGroupRange,l=s.xMultiStream.ssrcRange;delete s.xMultiStream;let c=[];for(let n=t;n<=i;n++){let t=(0,LM.cloneDeep)(s);t.mid=LP(e),t.xSourceStreamId=s.xSourceStreamId,t.subStreamIndex=n,c.push(t.mid);let i=a+n*l;t.ssrcGroups=[{ssrcs:`${i} ${i+o}`,semantics:"FID"}],t.xSsrcRange={ssrcMin:i,ssrcMax:i+l-1},e.media.splice(r+n,0,t)}s.ssrcGroups=[{ssrcs:`${n} ${n+o}`,semantics:"FID"}],s.xSsrcRange={ssrcMin:n,ssrcMax:n+l-1};let d=e.groups.find(e=>e.mids.includes(s.mid));d.mids=`${d.mids} ${c.join(" ")}`}},FL=class extends Fx{constructor(e){super(e)}modify(e){if(!this.configProvider.config.multiStreamSupported||this.configProvider.config.numVideoChannelsGvc<=this.configProvider.config.nonMultiStreamChannels)return;let t=0;for(let i=0;i<e.media.length;i++)if("Video"===Ly(e.media[i])){if(e.media[i].xMultiStream)break;t++}let i=e.media.findIndex(e=>e.xMultiStream&&"Video"===Ly(e)),n=e.media[i];if(!n)return;let r=this.configProvider.config.numVideoChannelsGvc-t-1;n.subStreamIndex=r;let s=0,a=r-1,o=e.media[i].xMultiStream.startSsrc+r*e.media[i].xMultiStream.ssrcRange;super.modify(e,s,a,o,i)}},FF=class extends Fx{constructor(e,t){super(e,t)}modify(e){if(!this.configProvider.config.multiStreamSupportedVBSS||!this.numVbssChannels)return;let t=e.media.findIndex(e=>e.xMultiStream&&"ScreenShare"===Ly(e)),i=e.media[t];if(!i)return;let n=Math.min(i.xMultiStream.numberOfStreams-1,this.numVbssChannels||Number.MAX_SAFE_INTEGER-1),r=1,s=n,a=e.media[t].xMultiStream.startSsrc;i.subStreamIndex=0,super.modify(e,r,s,a,t)}},FU=class{constructor(e,t,i,n){this.mediaManager=e,this.configProvider=t,this.type=i,this.logger=n}modify(e){if(!this.configProvider.config.multiStreamSupported||this.configProvider.config.numVideoChannelsGvc<=this.configProvider.config.nonMultiStreamChannels+1)return;let t=this.mediaManager.getMediaEntitiesByModality(nu.MODALITY.video),i=this.configProvider.config.nonMultiStreamChannels+1;if(t.filter(e=>e.isDisabled()).length>=i){let n=t.filter(e=>e.isDisabled()).length;this.logger.info(`Found ${n} disabled video lines, updating to: ${i}`);let r=e.media.filter(e=>e.label===nu.MEDIA_LABEL.video).length;if(r>=i+1){let t=e.media.map((e,t)=>LI(e)?t:-1).filter(e=>-1!==e).sort((e,t)=>t-e),n=r-i;t.slice(0,n).forEach(t=>{e.media.splice(t,1)})}this.logger.info(`${e.media.filter(e=>e.label===nu.MEDIA_LABEL.video).length} disabled video lines left after update`);return}let n=-1,r=-1;if(t.forEach((t,i)=>{let s=e.media.findIndex(e=>e.mid===t.getMid());i===this.configProvider.config.nonMultiStreamChannels-1&&(r=s),n=s}),-1===n||-1===r)return void this.logger.info("No video media found, skipping injection");let s=e.media[n];e.media.splice(r+1,n-r-1);let a=this.configProvider.config.numVideoChannelsGvc-this.configProvider.config.nonMultiStreamChannels;s.xMultiStream={numberOfStreams:a,startSsrc:1,ssrcRange:1,ssrcGroupRange:1},"answer"===this.type&&(s.xMultiStream.numberOfStreams=Math.min(a,this.configProvider.mediaConfig.multiStreamChannelsOffered),s.ssrcGroups&&delete s.ssrcGroups,s.xSsrcRange&&delete s.xSsrcRange)}},F$=class{constructor(e,t,i,n,r){this.mediaManager=e,this.configProvider=t,this.isMultiParty=i,this.type=n,this.numVbssChannels=r}modify(e){if(!this.configProvider.config.multiStreamSupportedVBSS||!this.isMultiParty||!this.numVbssChannels)return;let t=this.mediaManager.getMediaEntitiesByModality(nu.MODALITY.sharing),i=t?.[0];if(!i)return;let n=e.media.findIndex(e=>e.mid===i.getMid()),r=e.media[n];r&&-1!==n&&(e.media.splice(n+1,t.length-1),r.xMultiStream={numberOfStreams:this.numVbssChannels,startSsrc:parseInt(String(r.ssrcs?.[0].id)),ssrcRange:100,ssrcGroupRange:50},"answer"===this.type&&(r.xMultiStream.numberOfStreams=Math.min(this.numVbssChannels,this.configProvider.mediaConfig.vbssMultiStreamChannelsOffered),r.ssrcGroups&&delete r.ssrcGroups,r.xSsrcRange&&delete r.xSsrcRange))}},FV=class{constructor(e){this.configProvider=e}modify(e){Ui(e,nu.MEDIA_TYPE.video).forEach(e=>{Lu(e,{codec:"h264",rate:9e4},e=>{if(e.fmtp){let t=new Ll,i=new Ll(e.fmtp.config);["level-asymmetry-allowed","packetization-mode","profile-level-id"].forEach(e=>{if(i.contains(e)){let n=i.get(e);"profile-level-id"===e&&(n=this.configProvider.config.h264SendProfileOverride||n),t.setIfMissing(e,n)}}),e.fmtp.config=t.toString()}})})}},FB=class{constructor(e,t,i,n,r){this.configProvider=e,this.mediaManager=t,this.sdpType=i,this.remote=n,this.log=r}process(e,t,i){Ui(e,nu.MEDIA_TYPE.video).forEach(e=>{Ly(e)===t&&Lu(e,{codec:"h264",rate:9e4},t=>{if(t.fmtp){let n=new Ll(t.fmtp.config),r=new Ll,s=!1;for(let t of n.names()){let a=n.get(t);if("profile-level-id"===t){let t=i(this.mediaManager.getMediaEntities().filter(t=>t.getModality()===LC(e)).filter(e=>e.isEnabled()),a);typeof t==typeof a&&t!==a&&(a=t,s=!0)}r.setIfMissing(t,a)}s&&(t.fmtp.config=r.toString())}})})}modify(e){let t=this.configProvider.config.preferredH264SendProfileFallback,i=this.configProvider.config.preferredH264SharingSendProfile,n=this.configProvider.config.preferredH264VideoSendProfile;if(this.remote){let r=e=>(i,n)=>i.some(t=>t.isSendProfileSupported("H264",e))?(this.log.safe.info(`Overriding H264 send profile: ${n} => ${e}`),e):(this.log.safe.info(`Applying fallback H264 profile: ${n} => ${t}`),t);n&&this.process(e,"Video",r(n)),i&&this.process(e,"ScreenShare",r(i))}else"answer"===this.sdpType&&(n||i)&&this.configProvider.config.enableFallbackH264SendProfileForLocalAnswer&&this.process(e,"Video",(e,r)=>r===n||r===i?(this.log.safe.info(`Restoring fallback profile in local answer: ${r} => ${t}`),t):r)}},FH=class{constructor(e){this.configProvider=e}modify(e){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&Ui(e,nu.MEDIA_TYPE.video).forEach(e=>{Lh(e,{codec:"h264",rate:9e4},e=>{if(e.fmtp){let t=new Ll(e.fmtp.config);t.setIfMissing("sps-pps-idr-in-keyframe","1"),e.fmtp.config=t.toString()}})})}},Fj=class{constructor(e){this.configProvider=e}modify(e){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&Ui(e,nu.MEDIA_TYPE.video).forEach(e=>{Lh(e,{codec:"h264",rate:9e4},e=>{if(e.fmtp){let t=new Ll(e.fmtp.config);t.removeIfPresent("sps-pps-idr-in-keyframe"),e.fmtp.config=t.toString()}})})}},Fq=class{constructor(e){this.configProvider=e}modify(e){let t=(e.groups||[]).findIndex(e=>"BUNDLE"===e.type),i=e.groups?e.groups[t]:void 0;i&&(this.configProvider.mediaConfig.isTransportUnbundled?(i.mids=this.createBundleFromMedia(Ui(e,nu.MEDIA_TYPE.video)),i.mids||e.groups.splice(t,1)):i.mids=this.createBundleFromMedia(Ui(e)))}createBundleFromMedia(e){return e.map(e=>e.mid?.toString()).filter(e=>e).join(" ")}},FW=class{modify(e){e.media.forEach(e=>{LI(e)&&e.bundleOnly&&(e.port=9,delete e.invalid)})}},FG=class{constructor(e,t){this.configProvider=e,this.mediaManager=t}modify(e){if(!this.configProvider.mediaConfig.isTransportUnbundled&&!e.groups?.find(e=>"BUNDLE"===e.type)){let t=!1;if(e.media.forEach((e,i)=>{let n=this.mediaManager.getMediaEntityByMid(e.mid)||this.mediaManager.getMediaEntities()[i];n&&(!t&&n.isEnabled()?(e.mid=n.getMid(),t=!0):(n.disable(),e.port=0))}),t){e.groups||(e.groups=[]);let t={type:"BUNDLE"};e.groups.push(t)}}}},Fz=class{constructor(e,t){this.configProvider=e,this.logger=t}modify(e){e.media.forEach(e=>{let t=!!e.candidates;if(e.candidates&&(e.candidates=e.candidates.filter(e=>{let t=!0,i=!0,n=!0;return this.configProvider.config.iceCandidateType&&(t=!!e.type.match(RegExp(this.configProvider.config.iceCandidateType,"i"))),this.configProvider.config.iceCandidateTransport&&(i=!!e.transport.match(RegExp(this.configProvider.config.iceCandidateTransport,"i"))),this.configProvider.config.iceCandidateFilterMDns&&((n=!this.isMdns(e.ip))||this.logger.safe.info(`Filtering out mDNS candidate ${ta(e.ip)}:${ta(e.port)}`)),t&&i&&n})),t&&e.connection&&this.configProvider.config.iceCandidateFilterMDns&&(e.candidates&&0!==e.candidates.length||(e.candidates=[Un(e.port)]),this.isMdns(e.connection.ip)||!this.hasMatchingCandidate(e))){let t=this.getDefaultCandidate(e);e.connection.ip=t.ip,e.port=t.port}})}hasMatchingCandidate(e){let t=e.connection;return t&&!!e.candidates.find(this.createIpAndPortMatcher(t.ip,e.port))}getDefaultCandidate(e){return e.candidates.slice().sort((e,t)=>e.type===t.type?0:"host"===e.type||"relay"===t.type?1:"relay"===e.type||"host"===t.type?-1:0)[0]}isMdns(e){return e.indexOf(".local")>-1||e.indexOf(".encrypted")>-1}createIpAndPortMatcher(e,t){return i=>i.ip===e&&i.port===t}},FJ=class{constructor(e){this.configProvider=e}modify(e){this.configProvider.config.useOneRelayCandidateForRemoteSDP&&e.media.forEach(e=>{if(e.candidates){let t=e.candidates.filter(e=>!!e.type.match(/relay/i));t.length>0&&(e.candidates=t.slice(0,1))}})}},FK=class{modify(e){let t=Ui(e)[0];t&&(t.candidates=[Un()])}},FQ=class{constructor(e,t){this.mediaManager=e,this.configProvider=t}modify(e){e.media.forEach((e,t)=>{this.fromMsSdp(e,t)})}fromMsSdp(e,t){if(LI(e)||e.rids&&e.simulcast)return;let i=this.mediaManager.getMediaEntityByMid(e.mid)||this.mediaManager.getMediaEntities()[t];if(!i)return;let n=i?.getSimulcastContext();n?.shouldBeEnabledInRemoteDesc()&&(n.enableInRemoteDesc(),e.simulcast={dir1:"recv",list1:this.configProvider.config.specCompliantSimulcast?.disableTilde?n.ridList.map(e=>`${e}`).join(";"):n.ridList.map(e=>`${n.activeRids.includes(e)?"":"~"}${e}`).join(";")},e.rids=n.ridList.map(e=>({id:e,direction:"recv"})))}},FY=class{constructor(e,t){this.mediaManager=e,this.logger=t}modify(e){e.media.forEach((e,t)=>{this.toMsSdp(e,t)})}toMsSdp(e,t){let i=this.mediaManager.getMediaEntityByMid(e.mid)||this.mediaManager.getMediaEntities()[t];if(!i)return;let n=i?.getSimulcastContext();n&&(n.localDescriptionIsApplied(),n.shouldBeEnabledInLocalDesc()&&(n.enableInLocalDesc(),this.removeSimulcastEnvelope(e),this.addStreamSsrc(e,i.getLocalSsrc())))}removeSimulcastEnvelope(e){e.rids&&delete e.rids,e.simulcast&&delete e.simulcast}addStreamSsrc(e,t){if(!t)return;if(e.ssrcs)return void this.logger.safe.debug(`Media mid: ${e.mid} already contains ssrc: ${JSON.stringify(e.ssrcs)}`);let i=t;this.setSsrc(e,i)}setSsrc(e,t){e.ssrcs=[{id:t,attribute:"fake_attribute",value:"fake_value"}]}},FZ=class{constructor(e){this.mediaManager=e}modify(e){e.media.forEach((e,t)=>{let i=this.mediaManager.getMediaEntityByMid(e.mid)||this.mediaManager.getMediaEntities()[t];if(!i)return;let n=i?.getLocalTrackId();(!e.msid&&i?.getSimulcastContext()?.shouldUseSimulcast()&&n||i?.getExtension("reinviteless"))&&(e.msid=`- ${n??t}`)})}},FX=class{constructor(e,t){this.mediaManager=e,this.configProvider=t}modify(e){let t=this.mediaManager.getMediaEntities(),i=(0,LM.flatMap)(t,e=>e.getRtpHeaderExtensions()),n=i.find(e=>e?.headerType==="vla")?.value,r=i.find(e=>e?.headerType==="non-adv-vla")?.value,s=n??r??(0,LM.flatMap)(e.media,e=>e.ext||[]).find(e=>e.uri===nu.VLA.EXT_URI)?.value,a=Ur(e,this.configProvider.config.extmapAllowMixed,nu.VLA.DEFAULT_VALUE);e.media.forEach((e,i)=>{let n=Ly(e);if(!(this.configProvider.config.enableVla&&("Video"===n||"ScreenShare"===n))||e.ext?.find(e=>e.uri===nu.VLA.EXT_URI))return;let r=t[i]?.getRtpHeaderExtensions(),o=r?r.find(e=>"vla"===e.headerType)?.value??r.find(e=>"non-adv-vla"===e.headerType)?.value:s??a;o&&(e.ext=e.ext||[],e.ext.push({value:o,uri:nu.VLA.EXT_URI}))})}},F0=class{constructor(e){this.configProvider=e}modify(e){e.media.forEach(e=>{let t=Ly(e);if(this.configProvider.config.allowRemoteVla&&("Video"===t||"ScreenShare"===t))return;let i=e.ext?.findIndex(e=>e.uri===nu.VLA.EXT_URI);i>-1&&e.ext.splice(i,1)})}},F1=class{constructor(e){this.configProvider=e}modify(e,t,i){e.media.forEach(e=>{let n=Ly(e);if(!(this.configProvider.config.enableNonAdvVla&&("Video"===n||"ScreenShare"===n))||e.ext?.find(e=>e.uri===i))return;let r=e.ext?.find(e=>e.uri===t);r&&(r.uri=i)})}},F2=class extends F1{constructor(e,t){super(e),this.mediaManager=t}modify(e){let t=this.mediaManager.getMediaEntities();(0,LM.flatMap)(t,e=>e.getRtpHeaderExtensions()).some(e=>e?.headerType==="vla")||super.modify(e,nu.VLA.EXT_URI,nu.VLA.EXT_URI_NON_ADV)}},F3=class extends F1{constructor(e){super(e)}modify(e){super.modify(e,nu.VLA.EXT_URI_NON_ADV,nu.VLA.EXT_URI)}},F4=class{modify(e){e.media.forEach(e=>{e.ext?.forEach(e=>e.uri=this.normalizeSlashesInUri(e.uri))})}normalizeSlashesInUri(e){return e.replace(/\\/g,"/")}},F5=class{constructor(e){this.configProvider=e}modify(e){if(this.configProvider.config.fixSdpForPartialIceRestart){let[{iceUfrag:t,icePwd:i}={}]=e.media;void 0!==t&&void 0!==i&&e.media.forEach(e=>{e.iceUfrag=t,e.icePwd=i})}}},F6=class{constructor(e){this.configProvider=e}modify(e){if(this.configProvider.config.reduceRtcpFbInSdp?.length)for(let t of Ui(e,nu.MEDIA_TYPE.video))t.rtcpFb=t.rtcpFb&&this.getFbList(t.rtcpFb)}getFbList(e){let t=[],i=[];for(let n of e){let e=n.subtype?`${n.type}/${n.subtype}`:`${n.type}`;t.includes(e)||(this.configProvider.config.reduceRtcpFbInSdp.includes(e)?(t.push(e),i.push({...n,payload:"*"})):i.push(n))}return i}},F8=class{constructor(e){this.configProvider=e}modify(e){if(!this.configProvider.config.redReceiveEnabled)return;let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio),i=0;Lu(t,{codec:"opus",rate:48e3,encoding:2},e=>{i=e.rtp.payload});let n={codec:"RED",rate:8e3};Lu(t,n,e=>{e.rtp.rate=48e3,e.rtp.encoding=2,i&&(e.fmtp={payload:e.rtp.payload,config:`${i}/${i}`})}),Lp(t,n)}},F9=class{constructor(e){this.configProvider=e}modify(e){this.configProvider.config.redReceiveEnabled&&Lu(e.media.find(e=>e.type===nu.MEDIA_TYPE.audio),{codec:"red",rate:48e3,encoding:2},e=>{e.rtp.codec="RED",e.rtp.rate=8e3,delete e.rtp.encoding})}},F7=class{constructor(e,t){this.configProvider=e,this.sdpType=t}modify(e){if(!this.configProvider.config.redReceiveEnabled||"offer"!==this.sdpType)return;let t=e.media.find(e=>e.type===nu.MEDIA_TYPE.audio),i={codec:"red",rate:48e3,encoding:2},n=0;if(Lu(t,i,e=>{n=e.rtp.payload}),n===nu.PAYLOAD_TYPE.MSRTC_RED)return;let r=Ld(e);-1!==r&&(Ua(e,nu.PAYLOAD_TYPE.MSRTC_RED,r),Lu(t,i,e=>{e.rtp.payload=nu.PAYLOAD_TYPE.MSRTC_RED}))}},Ue=class{constructor(e,t){this.modification=e,this.context=t,this.logger=t.getLogger().createChild("IncomingDtlsRoleModifier")}modify(e){if("answer"!==this.modification.sdpType){if("offer"!==this.modification.sdpType||2!==this.modification.sdpSource)return void this.logger.error(`Tried to apply invalid change to DTLS role: ${this.modification.sdpType} ${this.modification.sdpSource}`);if(this.modification.isOrWasProvisional){let t=this.context.config.isPstnCall?this.context.configProvider.config.createProvisionalAnswer.dtlsRolePstn:this.context.configProvider.config.createProvisionalAnswer.dtlsRole;if(!t)return;this.logger.debug(`Configured DTLS role override: ${t}`),e.media.forEach((e,i)=>{let n=e.setup;if("inactive"!==e.direction&&n!==t){if(n&&"actpass"!==n)return void this.logger.warn(`Remote DTLS role is ${n}, cannot change`);e.setup=t,this.logger.debug(`Remote DTLS role changed from ${n} to ${e.setup} for mid=${e.mid}`)}})}}}};function Ut(e,t,i,n){let r=e===nu.MEDIA_TYPE.dataChannel||e===nu.MEDIA_TYPE.data,s={type:e,port:0,label:t,payloads:r?nu.PAYLOAD_TYPE.DATA_CHANNEL:"36",protocol:i,connection:{ip:"10.10.10.10",version:4}};return n&&(s.mid=n),s}function Ui(e,t=null){return e.media.filter(e=>!LI(e)&&(!t||e.type===t))}function Un(e=1234){let t=1234;return{component:1,ip:"10.10.10.10",foundation:"1755259772",priority:0x7e7e28ff,port:9!==e?e:t,transport:"UDP",type:"host"}}function Ur(e,t,i,n=!1){let r,s=(0,LM.flatMap)(e.media,e=>e.ext||[]).map(e=>e.value);if(0===s.length)return i;let a=2,o=14;if(n&&!s.includes(i))return i;for(let e=a;e<=o;e++)if(!s.includes(e)){r=e;break}return!r&&t&&(r=Math.max(...s)+1),r}function Us(e,t){if(!v0[e]?.[t])throw`unsupported codec ${e} or type ${t}`;let i=v0[e][t];return{codec:i.NAME,rate:i.RATE,encoding:i.ENCODING,payload:v0[e].PT}}function Ua(e,t,i){for(let n of e.media)Lc(n,t,i)}var Uo=class e{constructor(e,t,i,n){this.context=e,this.sessionType=t,this.sdp=i,this.remote=n,this.mediaManager=this.context.mediaManager,this.sdpTransform=this.context.sdpTransform,this.logger=this.context.logger.createChild("SessionDescr"),this.sdpModel=Ls.parse(this.sdp),n&&(new FL(this.context.configProvider).modify(this.sdpModel),new FF(this.context.configProvider,this.context.numVbssChannels).modify(this.sdpModel)),this.sdpModel.media.forEach(e=>{(0,Lr.isUndefined)(e.mid)||(e.mid=e.mid.toString())}),this.remote&&!this.context.configProvider.config.disableMsSdp&&new L4(e,this.mediaManager,t).modify(this.sdpModel)}getSdp(){return Ls.write(this.sdpModel)}clone(){return new e(this.context,this.sessionType,this.sdp,this.remote)}getModalities(){return this.modalities||LT(this.sdpModel)}updateModalities(e){this.logger.debug("updateModalities",e),this.modalities=e}getSrtpInfo(){return m6(this.sdpModel)}getVideoCodecs(){let e={};return this.sdpModel.media.forEach(t=>{"video"===t.type&&t.rtp.map(e=>e.codec.toLowerCase()).forEach(t=>e[t]=!0)}),Object.keys(e)}usePrimaryAudioCodecOnly(e){new FD(e).modify(this.sdpModel)}isCodecSwitchSupported(){return!this.sdpModel.media.some(e=>e.type===nu.MEDIA_TYPE.audio&&e.xMediaSettings&&this.containsMediaSetting(e.xMediaSettings,"codecswitchunsupported"))}toLocal(){return this.sdpModel=this.sdpTransform.toLocal(this.sdpModel,this.mediaManager,this.sessionType),this.getSdp()}toOffer(){return this.toOfferAnswer()}toAnswer(){return this.toOfferAnswer()}toOfferAnswer(){let e="offer"===this.sessionType;return new Fz(this.context.configProvider,this.logger).modify(this.sdpModel),new FW().modify(this.sdpModel),e&&this.mediaManager.isEmpty()&&this.mediaManager.fromOffer(this.sdpModel,this.modalities),this.mediaManager.syncModalities(this.sdpModel,this.modalities,!e),this.sdpModel=e?this.sdpTransform.toOffer(this.sdpModel,this.mediaManager,this.modalities):this.sdpTransform.toAnswer(this.sdpModel,this.mediaManager,this.modalities),this.context.configProvider.config.disableMsSdp||new L3(this.context,this.mediaManager,this.sessionType).modify(this.sdpModel),new Fk(this.mediaManager,this.context.configProvider).modify(this.sdpModel),this.modalities=LT(this.sdpModel),this.getSdp()}setModalities(e){this.modalities=e,this.mediaManager.fromRemote(this.sdpModel,this.modalities)}toRemote(e=!1){return this.sdpModel=this.sdpTransform.toRemote(this.sdpModel,this.mediaManager,this.modalities,this.sessionType,e),this.getSdp()}getVideoRecvCapabilities(){return Lw(this.getMediaByLabel(nu.MEDIA_LABEL.video))}getSharingRecvCapabilities(){return Lw(this.getMediaByLabel(nu.MEDIA_LABEL.sharing))}getMediaByType(e){return this.sdpModel.media.find(t=>t.type===e)}isUnbundled(){let e=this.sdpModel.groups?.find(e=>"BUNDLE"===e.type),t=this.sdpModel.media.find(e=>e.type===nu.MEDIA_TYPE.audio),i=this.sdpModel.media.find(e=>e.type===nu.MEDIA_TYPE.video);return e?!e.mids.toString().split(" ").find(e=>e===t.mid):!!i}couldBeUnbundled(){return!this.sdpModel.groups?.find(e=>"BUNDLE"===e.type)||this.hasUnbundledIceCandidates()}containsMediaSetting(e,t){return e.some(e=>-1!==e.settings.indexOf(t))}getMediaByLabel(e){return this.sdpModel.media.find(t=>t.label===e)}hasIceCandidatesForMediaType(e,t=""){let i=this.sdpModel.media?this.sdpModel.media.filter(t=>t.type===e&&!!t.candidates&&0!==t.candidates.length):[];return t?i.some(e=>!!e.candidates&&e.candidates.some(e=>e.type===t)):!!i.length}hasIceCandidates(){return this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.audio)||this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.video)}hasRelayIceCandidates(){return this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.audio,"relay")||this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.video,"relay")}hasUnbundledIceCandidates(){let e=this.sdpModel.media.filter(e=>e.type===nu.MEDIA_TYPE.video&&0!==e.port);return this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.audio)&&(!e.length||this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.video))}hasUnbundledRelayIceCandidates(){let e=this.sdpModel.media.filter(e=>e.type===nu.MEDIA_TYPE.video&&0!==e.port);return this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.audio,"relay")&&(!e.length||this.hasIceCandidatesForMediaType(nu.MEDIA_TYPE.video,"relay"))}isIceRestart(){return this.mediaManager.getMediaEntities().some(e=>e.getExtension("iceRestart"))}isMSRTC(){return!!this.sdpModel.xMediaBw}insertFakeCandidateIfNeeded(){return!this.hasIceCandidates()&&(new FK().modify(this.sdpModel),!0)}forceRecvonly(){new L8().modify(this.sdpModel)}getBweType(){let e=this.sdpModel.media.find(e=>0!==e.port&&e.type===nu.MEDIA_TYPE.video);return e?e.ext?.find(e=>e.uri===nu.TRANSPORT_CC.EXT_URI||e.uri===nu.TRANSPORT_CC.MSSDP_ENCODED_URI)?"SSBWE":"REMB":"Unknown"}fixDataModality(){new Fe(this.mediaManager).modify(this.sdpModel)}isSctpDataChannel(){return this.sdpModel.media.some(e=>e.type===nu.MEDIA_TYPE.data&&e.xDataProtocol?.includes("sctp"))}getPayloadsForMedia(e){let t=this.sdpModel.media.find(t=>t.type===e&&0!==t.port);return t?.rtp??[]}},Ul=class{constructor(e){this.context=e}createLocalOffer(e){return new Uo(this.context,"offer",e)}createRemoteOffer(e){return new Uo(this.context,"offer",e,!0)}createLocalAnswer(e){return new Uo(this.context,"answer",e)}createRemoteAnswer(e){return new Uo(this.context,"answer",e,!0)}},Uc=class{static build(e){return new Ul(e=e||{})}};function Ud(e){let t="";return e.dtls&&(t+="dtls"),e.sdes&&(t+="sdes"),t}var Uu=class{constructor(){this.info={OfferedSrtp:"none",NegotiatedSrtp:"none",IceConnectionState:"none",IceConnectionStatePrevious:"none",SignalingState:"none",SignalingStatePrevious:"none",RelayCandidate:"none",IceTransportPolicy:"none",IceServers:"none",FakeIceCandidate:!1,BweType:"none",SdpSemantics:"none",BundlePolicy:"none",IPAddress:"none",ReflexiveLocalIP:"none",NumberOfInterfaces:0,EncodedStreamWorker:!1,AudioCodecEvents:"none"}}setCandidateDetails(e){"host"===e.type&&"udp"===e.protocol?this.setIPAddressInfo(e.ip):"srflx"===e.type&&this.setReflexiveLocalIP(e.ip)}setOfferedModalities(e){this.offeredModalities=e,this.activeModalities=e}setNegotiatedModalities(e){this.negotiatedModalities=e,this.activeModalities=e}setNegotiatedSrtpInfo(e){this.info.NegotiatedSrtp=Ud(e)}setOfferedSrtpInfo(e){this.info.OfferedSrtp=Ud(e)}setIceConnectionState(e){this.info.IceConnectionStatePrevious=this.info.IceConnectionState,this.info.IceConnectionState=e}setSignalingConnectionState(e){this.info.SignalingStatePrevious=this.info.SignalingState,this.info.SignalingState=e}setRelayCandidateInfo(e){this.info.RelayCandidate=JSON.stringify(e)}fillExtensionInfo(e){nT(e,this.info)}setIceTransportPolicy(e){this.info.IceTransportPolicy=e}setIceServers(e){let t=e.map(e=>{let t={...e};return t.username&&(t.username="true"),t.credential&&(t.credential="true"),t});this.info.IceServers=JSON.stringify(t)}setFakeIceCandidate(e){this.info.FakeIceCandidate=e}setBweType(e){"Unknown"!==e&&(this.info.BweType=e)}setSdpSemantics(e){this.info.SdpSemantics=e}setBundlePolicy(e){this.info.BundlePolicy=e}setEncodedStreamWorkerLoaded(e){this.info.EncodedStreamWorker=e}setAudioCodecEvents(e){this.info.AudioCodecEvents=JSON.stringify(e)}setIPAddressInfo(e){this.info.NumberOfInterfaces+=1,"none"===this.info.IPAddress&&(this.info.IPAddress=e)}setReflexiveLocalIP(e){"none"===this.info.ReflexiveLocalIP&&(this.info.ReflexiveLocalIP=e)}},Uh=class{constructor(){this.presentationAPIUserDuration=0,this.presentationAudioDuration=0,this.isActiveScreenSharing=!1}handleInputLevel(e,t){this.isActiveScreenSharing&&("ScreenShare"===e&&t>0&&(this.presentationAPIUserDuration+=nu.TIME_INTERVAL.SEC_1),"Audio"===e&&t>0&&(this.presentationAudioDuration+=nu.TIME_INTERVAL.SEC_1))}updateScreenSharingStream(e,t){"ScreenShare"===t&&(this.isActiveScreenSharing=!!e)}getPresentationAudioDuration(){return this.presentationAudioDuration}getPresentationAudioAPIUserDuration(){return this.presentationAPIUserDuration}},Ug=class{constructor(e){this.configProvider=e,this.data={adaptations:0,duration:{min:1/0,max:0,total:0},events:[]}}update(e,t,i){if(this.ovc=t??this.ovc,void 0!==this.ovc){if(e>this.ovc)this.overshoot?(this.overshoot.ovc.min=Math.min(this.overshoot.ovc.min,this.ovc),this.overshoot.ovc.max=Math.max(this.overshoot.ovc.max,this.ovc),this.overshoot.subscriptions.min=Math.min(this.overshoot.subscriptions.min,e),this.overshoot.subscriptions.max=Math.max(this.overshoot.subscriptions.max,e)):(this.data.adaptations++,this.overshoot={start:Date.now(),duration:0,reason:i,ovc:{min:this.ovc,max:this.ovc},subscriptions:{min:e,max:e}});else if(this.overshoot){this.overshoot.duration=Date.now()-this.overshoot.start,this.data.duration.min=Math.min(this.data.duration.min,this.overshoot.duration),this.data.duration.max=Math.max(this.data.duration.max,this.overshoot.duration),this.data.duration.total+=this.overshoot.duration,this.data.events.push(this.overshoot),this.overshoot=void 0;let e=this.configProvider.config.diagnostics.collectionLimits.numOvershootEvents;this.data.events.length>e&&(this.data.events.sort((e,t)=>t.duration-e.duration),this.data.events=this.data.events.slice(0,e))}if(this.data.adaptations>0)return{events:[...this.data.events],adaptations:this.data.adaptations,duration:{...this.data.duration}}}}},Up=class e{constructor(e){this.name=e,this.sharedState={mark:new Map,measure:[]}}mark(e,t){let i=nQ();this.sharedState.mark.set(e,{name:e,ts:i,startTime:nB(nY+i),details:t})}measure(e,t){let i=this.sharedState.mark.get(t.start),n=this.sharedState.mark.get(t.end);if(i&&n){let r={...t,parentName:this.name===e?"":this.name};this.sharedState.measure.push({name:e,details:r,duration:nB(n.ts-i.ts),startTime:i.startTime})}}markAndMeasure(e,t,i,n){!1===this.sharedState.mark.has(t)&&this.mark(t,i);let r=this.sharedState.mark.get(e),s=this.sharedState.mark.get(t);if(r&&s){let e={...n,parentName:this.name===t?"":this.name};this.sharedState.measure.push({name:t,details:e,duration:nB(s.ts-r.ts),startTime:r.startTime})}}clone(t){let i=new e(`${this.name}|${t}`);return i.setSharedState(this.sharedState),i}setSharedState(e){this.sharedState=e}getReport(){return this.sharedState.measure.map(e=>({name:e.name,duration:e.duration,ts:e.startTime,parentName:e.details.parentName}))}},Uf=class e{mark(){}measure(){}markAndMeasure(){}clone(){return new e}getReport(){return[]}},Um=class{constructor(e){this.enableTimerTracker=e,this.timerTrackers={},this.timerTrackerOptions={}}getTimerTracker(e,t){if(!this.enableTimerTracker)return new Uf;let i=new Up(e);if(this.timerTrackers[e]){let t=this.timerTrackerOptions[e];if(t?.first)return new Uf;t?.last&&(this.timerTrackers[e]=[i]),t?.all&&this.timerTrackers[e].push(i)}else this.timerTrackers[e]=[i],this.timerTrackerOptions[e]=t;return i}getReport(){if(this.enableTimerTracker)return Object.keys(this.timerTrackers).reduce((e,t)=>{let i=this.timerTrackerOptions[t];return(i.first||i.last)&&(e[t]=[this.timerTrackers[t][0]?.getReport()]),i.all&&(e[t]=Object.values(this.timerTrackers[t]).map(e=>e?.getReport())),e},{})}},Uv=class{constructor(e,t){this.configProvider=e,this.sessionInfo=t,this.data={fakeCandidate:!1,bweType:"Unknown",offeredSrtp:"unknown",negotiatedSrtp:"unknown",callSetupTimeReport:{}},this.timerTrackerManager=new Um(this.configProvider.config.enableTimerTracker),nW(this.data,{callSetupTimeReport:()=>this.timerTrackerManager.getReport()})}getTimerTracker(e,t){return this.timerTrackerManager.getTimerTracker(e,t)}set offeredModalities(e){this.data.offeredModalities=e,this.data.activeModalities=e,this.sessionInfo.setOfferedModalities(e)}set negotiatedModalities(e){this.data.negotiatedModalities=e,this.data.activeModalities=e,this.sessionInfo.setNegotiatedModalities(e)}set fakeCandidate(e){var t;(t=this.data).fakeCandidate||(t.fakeCandidate=e),this.sessionInfo.setFakeIceCandidate(e)}set bweType(e){this.data.bweType=e,this.sessionInfo.setBweType(e)}set negotiatedSrtp(e){this.data.negotiatedSrtp=US(e),this.sessionInfo.setNegotiatedSrtpInfo(e)}set offeredSrtp(e){this.data.offeredSrtp=US(e),this.sessionInfo.setOfferedSrtpInfo(e)}set meetingScenario(e){this.data.meetingScenario=e}set isTownHall(e){this.data.isTownHall=e}set ignoredNonSctpDataChannel(e){this.data.ignoredNonSctpDataChannel=e}getObjectRef(){return this.data}};function US(e){let t="";return e.dtls&&(t+="dtls"),e.sdes&&(t+="sdes"),t}var Uy=class{constructor(e){this.data=e,this.reopenRequestDeviceIds=new Set}registerReopenRequest(e){this.reopenRequestDeviceIds.has(e)||(this.data.sinkNumOfReopenRequests++,this.reopenRequestDeviceIds.add(e))}registerSuccessfullReopen(e){this.reopenRequestDeviceIds.has(e)&&(this.data.sinkNumOfSuccessfulReopens++,this.reopenRequestDeviceIds.delete(e))}getObjectRef(){return this.data}},UC=class{constructor(e){this.configProvider=e,this.data={signalingState:"none",signalingStatePrevious:"none",iceConnectionState:"none",iceConnectionStatePrevious:"none",numCallbacksScheduled:0,numCallbacksExecuted:0,numCallbacksExecutedImmediately:0,scheduledCallbacks:[],events:[],timers:{}},this.scheduledCallbacks=new Map,this.stateTrackers={},nW(this.data,{scheduledCallbacks:()=>this.scheduledCallbacks.values(),timers:()=>{let e={};for(let t of Object.keys(this.stateTrackers))e[t]=this.stateTrackers[t].durations;return e}})}dispose(){for(let e of Object.values(this.stateTrackers))e.dispose()}set hasConnectionState(e){this.data.hasConnectionState=e}set transportState(e){this.data.transportStatePrevious=this.data.transportState,this.data.transportState=e,this.addStateEvent("transport",this.data.transportStatePrevious,this.data.transportState)}set signalingState(e){this.data.signalingStatePrevious=this.data.signalingState,this.data.signalingState=e,this.addStateEvent("signaling",this.data.signalingStatePrevious,this.data.signalingState)}set iceConnectionState(e){this.data.iceConnectionStatePrevious=this.data.iceConnectionState,this.data.iceConnectionState=e,this.addStateEvent("ice",this.data.iceConnectionStatePrevious,this.data.iceConnectionState)}set connectionState(e){this.data.connectionStatePrevious=this.data.connectionState,this.data.connectionState=e,this.addStateEvent("connection",this.data.connectionStatePrevious,this.data.connectionState)}set dtlsTransportState(e){this.data.dtlsTtransportStatePrevious=this.data.dtlsTransportState,this.data.dtlsTransportState=e,this.addStateEvent("dtlsTransport",this.data.dtlsTtransportStatePrevious,this.data.dtlsTransportState)}set provisional(e){this.addStateEvent("provisional",`${this.data.isProvisional}`,`${e}`),this.data.isProvisional=e}scheduleDoOnConnected(e,t,i,n){this.scheduledCallbacks.set(e,`${t}: ${i?"p":""}${n?"n":""}`),this.addCallbackEvent(t,i,n),this.data.numCallbacksScheduled++}runDoOnConnected(e,t=!1){this.scheduledCallbacks.get(e)&&this.scheduledCallbacks.delete(e),this.data.numCallbacksExecuted++,t&&this.data.numCallbacksExecutedImmediately++}getObjectRef(){return this.data}addCallbackEvent(e,t,i){tq(this.data.events,{evType:"callback",timestamp:Date.now(),logName:e,allowProvisional:t,mayRunImmediately:i},this.configProvider.config.diagnostics.collectionLimits.numTransportStateEvents)}addStateEvent(e,t,i){tq(this.data.events,{evType:"stateChanged",timestamp:Date.now(),changedState:e,previous:t,current:i},this.configProvider.config.diagnostics.collectionLimits.numTransportStateEvents);let n=this.stateTrackers[e]??new Ub;n.state=i,this.stateTrackers[e]=n}},Ub=class{constructor(){this.stopwatches={}}set state(e){if(this.stateInternal===e)return;this.running?.stop();let t=this.stopwatches[e]??new UR;this.stopwatches[e]=t,t.start(),this.running=t,this.stateInternal=e}get durations(){let e={};for(let t in this.stopwatches){let i=this.stopwatches[t];e[t]=i.elapsed}return e}dispose(){this.running?.stop(),this.running=void 0}},UT=/profile-level-id=(.{6})/,UE=class{constructor(e,t,i=()=>{},n=()=>this,r=()=>{},s=new x5,a){this.configProvider=e,this.dmDiagnostics=t,this.addSessionStatsError=i,this.newNativeSession=n,this.commitNativeSession=r,this.dshDiagnostics=s,this.getSessionRef=a,this.data={startTime:Date.now(),duration:0,relayCandidate:"none",iceTransportPolicy:"none",iceServers:"none",sdpSemantics:"none",bundlePolicy:"none",iceCandidateErrors:[],H264Profiles:[],h264CodecCapabilities:{sendProfiles:[],receiveProfiles:[]},numInterfaces:0,statsReports:[],aggregatedModalityStats:{},multiViewStats:[],multipleAudioStats:[],networkInfo:[],statsErrors:[],statsOnSubscribed:{},negotiation:{},recvVideoStreamCount:{min:0,max:0,mode:0},reportedReceiveBandwidth:[],reportedSendBandwidthLayouts:[],encodedStreamWorker:!1,audioCodecEvents:"none",totalVideoRecvMblocksRates:{macroblockRateReceivedMax:0,macroblockRateReceivedAvg:0,macroblockRateDecodedMax:0,macroblockRateDecodedAvg:0,macroblockRateMaxDecoderLossPercent:0,macroblockRateDecoderLossPercent:0},loopIntervalMax:-1,loopIntervalMedian:-1,fetchTimeMax:-1,fetchTimeMedian:-1,videoPerformanceEvent:[],localVideoPerformanceEvents:[],presentationAPIUserDuration:0,presentationAudioDuration:0,earlyMediaNumStatsPolls:0,audioRenderer:null,timeToFirstAudioPacket:0},this.presentationAudioTelemetry=new Uh,this.ovcDiagnostics=new Ug(this.configProvider),nW(this.data,{duration:()=>this.data.endTime?this.data.endTime-this.data.startTime:Date.now()-this.data.startTime,bandwidthReport:()=>this.bandwidthStatsRef?.getBandwidthReport(),presentationAPIUserDuration:()=>this.presentationAudioTelemetry.getPresentationAudioAPIUserDuration(),presentationAudioDuration:()=>this.presentationAudioTelemetry.getPresentationAudioDuration()}),Object.defineProperty(this.data,"IPAddress",{enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(this.data,"reflexiveLocalIP",{enumerable:!1,writable:!0,configurable:!0})}get deviceManager(){return this.dmDiagnostics}get audioLevel(){return this.analyzer?.getInputLevelNormalized()}get reflexiveLocalIP(){return this.data.reflexiveLocalIP}set bandwidthDiagnostic(e){this.bandwidthStatsRef=e}get callIsMuted(){return this.getSessionRef?.().callIsMuted}get sharingAudioLevel(){return this.analyzerSharing?.getInputLevelNormalized()}get startTime(){return this.data.startTime}get timeToFirstAudioPacket(){return this.data.timeToFirstAudioPacket}set relayCandidateInfo(e){this.data.relayCandidate=JSON.stringify(e)}set iceTransportPolicy(e){this.data.iceTransportPolicy=e}set reinvitelessContext(e){this.data.reinvitelessContext=e}set iceServers(e){let t=e.map(e=>{let t={...e};return t.username&&(t.username="true"),t.credential&&(t.credential="true"),t});this.data.iceServers=JSON.stringify(t)}set sdpSemantics(e){this.data.sdpSemantics=e}set isCodecsSupported(e){this.data.codecSupport=e}set bundlePolicy(e){this.data.bundlePolicy=e}set usesMixer(e){this.data.usesMixer=e}set isPstnCall(e){this.data.isPstnCall=e}set latestRawReport(e){this.data.latestRawReport=e}set recvVideoStreamsCount(e){this.data.recvVideoStreamCount=e}set aggregatedStatsRef(e){this.data.aggregatedModalityStats=e}set multiViewStats(e){this.data.multiViewStats=e}set multipleAudioStats(e){this.data.multipleAudioStats=e}set videoCapabilities(e){if(!e?.codecs)return;let t=[];e.codecs.forEach(e=>{if("h264"===e.mimeType&&e.sdpFmtpLine){let i=UT.exec(e.sdpFmtpLine)?.[1];i&&t.push(i)}}),this.data.H264Profiles=[...new Set(this.data.H264Profiles.concat(t))]}setSupportedH264Profiles(e,t){if(!e?.codecs&&!t?.codecs)return;let i=e=>{let t=[];return e.codecs?.forEach(e=>{if("h264"===e.mimeType&&e.sdpFmtpLine){let i=UT.exec(e.sdpFmtpLine)?.[1];i&&!t.includes(i)&&t.push(i)}}),t};this.data.h264CodecCapabilities.sendProfiles=i(e),this.data.h264CodecCapabilities.receiveProfiles=i(t)}set sentBWSeed(e){var t;(t=this.data).initialBWSeed??(t.initialBWSeed=e),this.data.sentBWSeed=e}reportedSendBandwidthLayouts(e){tq(this.data.reportedSendBandwidthLayouts,e,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples)}set maxSessionBandwidth(e){this.data.maxSessionBandwidth=e}set bwStabilizationTime(e){this.data.bwStabilizationTime=e}set bwDownlinkStabilizationTime(e){this.data.bwDownlinkStabilizationTime=e}set statsOnSubscribed(e){this.data.statsOnSubscribed=e}set loopIntervalMax(e){this.data.loopIntervalMax=e}set loopIntervalMedian(e){this.data.loopIntervalMedian=e}set fetchTimeMax(e){this.data.fetchTimeMax=e}set fetchTimeMedian(e){this.data.fetchTimeMedian=e}set simulcastReport(e){this.data.simulcast=e}setTotalVideoRecvMblocksRates(e){this.data.totalVideoRecvMblocksRates=e}set dataChannelSessionState(e){this.data.dataChannelSessionState=e}set createChannelFailReason(e){this.data.dataChannelCreationError=e}setCandidateDetails(e){"host"===e.type&&"udp"===e.protocol?(this.data.numInterfaces++,this.data.IPAddress||(this.data.IPAddress=e.ip)):"srflx"!==e.type||this.data.reflexiveLocalIP||(this.data.reflexiveLocalIP=e.ip)}setAudioSendStream(e,t){if(this.configProvider.config.useAudioAnalyzer){let i=new xW(e.rawStream);"ScreenShare"===t&&e.hasAudio()?(this.analyzerSharing?.dispose(),this.analyzerSharing=i):"Audio"===t&&(this.analyzer?.dispose(),this.analyzer=i)}}addNetworkInfo(e){tq(this.data.networkInfo,e,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples)}addIceCandidateError(e){this.data.iceCandidateErrors.push(e)}clearIceCandidateErrors(){this.data.iceCandidateErrors=[]}registerEarlyMediaPoll(){this.data.earlyMediaNumStatsPolls++}addReportedReceiveBandwidth(e){tq(this.data.reportedReceiveBandwidth,e,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples)}addOvcSubscriptionReport(e,t,i){this.data.OVC=this.ovcDiagnostics.update(t,e,i?.reason)}addSubscriptionToOvcEvent(e){this.data.OVC=this.ovcDiagnostics.update(e)}addStatsReport(e){tq(this.data.statsReports,e,this.configProvider.config.diagnostics.collectionLimits.numStatsReports)}addStatsError(e,t){let i=this.data.statsErrors.find(i=>i.error===t&&i.origin===e);i?i.count++:tq(this.data.statsErrors,{origin:e,error:t,count:1},this.configProvider.config.diagnostics.collectionLimits.numStatsErrors),this.addSessionStatsError(`nativeSession:${e}`,t)}setPresentationAudioOnScreenSharing(e,t){this.presentationAudioTelemetry.updateScreenSharingStream(e,t)}handlePresentationAudioInputLevel(){this.presentationAudioTelemetry.handleInputLevel("Audio",this.audioLevel),this.presentationAudioTelemetry.handleInputLevel("ScreenShare",this.sharingAudioLevel)}terminate(){this.data.endTime=Date.now(),this.analyzer?.dispose(),this.analyzer=null,this.analyzerSharing?.dispose(),this.analyzerSharing=null}newQualityManagerDiagnostics(){let e=new Lt(this.configProvider,(e,t)=>this.addStatsError(`qualityManagerDiagnostics:${e}`,t));return this.data.qualityManager=e.getObjectRef(),e}newRemoteVideoManagerDiagnostics(){let e=new Li(this.configProvider);return this.data.remoteVideoManager=e.getObjectRef(),e}newNegotiationDiagnostics(e){let t=new Uv(this.configProvider,e);return this.data.negotiation=t.getObjectRef(),t}newSubscriptionManagerDiagnostics(){let e=new Le(this.configProvider,e=>this.addStatsError("subscriptionManagerDiagnostics",e));return this.data.subscriptionManager=e.getObjectRef(),e}newDataChannelDiagnostics(e){let t=new f2(e);return this.data.dataChannel=t.getObjectRef(),t}newTransportStateDiagnostics(){let e=new UC(this.configProvider);return this.data.transportState=e.getObjectRef(),e}set encodedStreamWorker(e){this.data.encodedStreamWorker=e}set audioCodecEvents(e){this.data.audioCodecEvents=e}getObjectRef(){return this.data}registerVideoPerformanceEvent(e,t,i){let n={type:t,perfEvent:e,resRequestEvent:null,resChangedEvent:[],perfConstrainedOvc:i};tq(this.data.videoPerformanceEvent,n,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples)}registerLocalVideoPerformanceEvent(e){tq(this.data.localVideoPerformanceEvents,{timestamp:Date.now(),description:e.description,activeModalities:e.activeModalities,isTransient:e.isTransient},this.configProvider.config.diagnostics.collectionLimits.numPerformanceEvents)}registerResolutionChangeRequest(e){let t=this.data.videoPerformanceEvent[this.data.videoPerformanceEvent.length-1];t&&(t.resRequestEvent=e)}registerResolutionChangeEvent(e){let t=this.data.videoPerformanceEvent[this.data.videoPerformanceEvent.length-1];e.ts-t?.resRequestEvent?.ts<this.configProvider.config.diagnostics.performanceMonitoring.telemetryResolutionRequestSpanMs&&t.resChangedEvent.push(e)}set contributingSourcesError(e){this.data.contributingSourcesError=e}newAudioRendererDiagnostics(){return(this.data.audioRenderer=this.getSessionRef?.().audioRenderer,this.data.audioRenderer)?new Uy(this.data.audioRenderer):null}firstAudioPacketReceived(){this.data.timeToFirstAudioPacket||(this.data.timeToFirstAudioPacket=Date.now()-this.data.startTime)}},U_=Symbol("sessionDiagnosticsRef"),UI=class{constructor(e,t,i,n,r,s,a){this.logger=e,this.configProvider=t,this.diagnosticsReport=i,this.dmDiagnostics=n,this.ufdDiagnostics=r,this.dshDiagnostics=new x5,this.data={creationTime:Date.now(),callNumber:0,sessionId:"unknown",isMultiParty:!1,dtmfSuccessCount:0,dtmfFailureCount:0,iceInitTime:0,iceConnectedStateTime:0,negotiationCount:0,rejectedNegotiationCount:0,initialNegotiationCompleted:!1,finalAnswerTime:0,transportReconnectedCount:0,rollbackNegotiation:[],activeModalities:{},allowedAudioSend:!0,allowedVideoSend:!0,allowedScreensharingSend:!0,noIceCandidatesEventCount:{good:0,bad:0},noRelayIceCandidatesEventCount:{good:0,bad:0},microphoneInUseEventCount:{good:0,bad:0},cameraInUseEventCount:{good:0,bad:0},cameraFreezeEventCount:{start:0,end:0},rawMedia:{audio:{recv:{numAttempts:0,durationRatio:0},send:{numAttempts:0,durationRatio:0}}},ufds:[],remoteUfds:[],remoteUfdsCount:{},statsErrors:[],webrtcSessions:[],isOngoing:!1,duration:0,callMutedRatio:0,callOsMuted:0,callHwSilent:0,callSwMuted:0,callIsMuted:!1,callSpeakerMuted:0,callIsSpeaking:0,networkRecvUFD:void 0,networkSendUFD:void 0,zeroCaptureDevicesRatio:0,zeroRenderDevicesRatio:0,deviceRenderFailuresRatio:0,deviceCaptureFailuresRatio:0,deviceManager:void 0,ufdManager:void 0,relayTimers:void 0,authTokenFetcherStats:void 0,dominantSpeaker:this.dshDiagnostics.getObjectRef(),[U_]:this,callConstraints:[],audioRenderer:{sinkNumOfReopenRequests:0,sinkNumOfSuccessfulReopens:0},elevation:[],batteryLevel:void 0,mediaLeaks:[]},this.transportDisconnected=!1,this.commonMuteTracker=new UR,this.swMuteTracker=new UR,this.osMuteTracker=new UR,this.speakerMuteTracker=new UR,this.hwSilentTracker=new UR,this.isSpeakingTracker=new UR,this.networkRecvTracker=new UA,this.networkSendTracker=new UA,this.zeroCaptureTracker=new UA,this.zeroRenderTracker=new UA,this.deviceRenderTracker=new UA,this.deviceCaptureTracker=new UA,this.rawMediaTimers={audio:{send:new UR,recv:new UR}},this.dmFragmenter=new UP(this.dmDiagnostics),this.ufdFragmenter=new Uw(this.ufdDiagnostics),this.durationTimer=new UR,this.data.callNumber=s,this.data.sessionId=a,this.durationTimer.start(),nW(this.data,{isOngoing:()=>void 0===this.data.terminationTime,duration:()=>this.durationTimer.elapsed,callMutedRatio:()=>UM(this.commonMuteTracker.elapsed,this.data.duration),callOsMuted:()=>this.osMuteTracker.elapsed,callHwSilent:()=>this.hwSilentTracker.elapsed,callSwMuted:()=>this.swMuteTracker.elapsed,callIsMuted:()=>this.swMuteTracker.isRunning,callSpeakerMuted:()=>this.speakerMuteTracker.elapsed,callIsSpeaking:()=>this.isSpeakingTracker.elapsed,zeroCaptureDevicesRatio:()=>this.zeroCaptureTracker.getRatio("Bad"),zeroRenderDevicesRatio:()=>this.zeroRenderTracker.getRatio("Bad"),deviceRenderFailuresRatio:()=>this.deviceRenderTracker.getRatio("Bad"),deviceCaptureFailuresRatio:()=>this.deviceCaptureTracker.getRatio("Bad"),networkRecvUFD:()=>({good:this.networkRecvTracker.getCount("Good"),poor:this.networkRecvTracker.getCount("Poor"),bad:this.networkRecvTracker.getCount("Bad"),goodRatio:this.networkRecvTracker.getRatio("Good"),poorRatio:this.networkRecvTracker.getRatio("Poor"),badRatio:this.networkRecvTracker.getRatio("Bad")}),networkSendUFD:()=>({good:this.networkSendTracker.getCount("Good"),poor:this.networkSendTracker.getCount("Poor"),bad:this.networkSendTracker.getCount("Bad"),goodRatio:this.networkSendTracker.getRatio("Good"),poorRatio:this.networkSendTracker.getRatio("Poor"),badRatio:this.networkSendTracker.getRatio("Bad")}),deviceManager:()=>this.dmFragmenter.getFragment(this.dmDiagnostics),relayTimers:()=>this._relayManager?.getStats(),authTokenFetcherStats:()=>this._relayManager?.getAuthTokenStats(),callConstraints:()=>this.configProvider.getCallConstraintsTelemetry(),ufdManager:()=>this.ufdFragmenter.getFragment(this.ufdDiagnostics)}),nW(this.data.rawMedia.audio.recv,{durationRatio:()=>UM(this.rawMediaTimers.audio.recv.elapsed,this.data.duration)}),nW(this.data.rawMedia.audio.send,{durationRatio:()=>UM(this.rawMediaTimers.audio.send.elapsed,this.data.duration)})}get telemetryReport(){let e={type:"WebRtcMediaStats",data:this.diagnosticsReport.getSessionTelemetry(this.data.sessionId)},t={};return ng(e.data,(e,i,n)=>{let r=0;mW.test(e)?(r=13,t[i]="IPv4"):mG.test(e)&&(r=4,t[i]="IPv6"),n[i]={type:r,value:e,__VALUE__:!0}}),e.data.metrics.piiFields={type:0,value:JSON.stringify(t),__VALUE__:!0},e}get mediaStatsReport(){return this.diagnosticsReport.getMediaSessionStats(this.data.sessionId)}get realtimeTelemetryReport(){return this.diagnosticsReport.getTeamsRealtimeTelemetry(this.data.sessionId)}get e2eDiagnostics(){return this.diagnosticsReport.getDiagnosticsForE2eTests(this.data.sessionId)}set relayManager(e){this._relayManager=e}set isMultiParty(e){this.data.isMultiParty=e}set mediaLegId(e){this.data.mediaLegId=e.process()}set reconnect(e){this.data.reconnect=e}set relay(e){this.data.relay={address:e.addresses.join(),expires:e.expires,realm:e.realm,credentials:!!(e.username&&e.password),ports:[e.udpPort?`udp:${e.udpPort}`:"",e.tcpPort?`tcp:${e.tcpPort}`:"",e.tlsPort?`tls:${e.tlsPort}`:""].join(","),fqdns:e.fqdns?e.fqdns.join():"none"}}set sessionError(e){this.data.error=e}set dtmfResult(e){e?this.data.dtmfSuccessCount++:this.data.dtmfFailureCount++}set swMute(e){e?this.swMuteTracker.start():this.swMuteTracker.stop(),this.updateCommonMute()}set speakerMute(e){e?this.speakerMuteTracker.start():this.speakerMuteTracker.stop()}set hwSilent(e){e?this.hwSilentTracker.start():this.hwSilentTracker.stop()}set isSpeaking(e){e?this.isSpeakingTracker.start():this.isSpeakingTracker.stop()}set iceInitTime(e){this.data.iceInitTime||(this.data.iceInitTime=e)}set finalAnswerTime(e){this.data.finalAnswerTime||(this.data.finalAnswerTime=e)}set iceConnectedStateTimestamp(e){this.data.iceConnectedStateTime||(this.data.iceConnectedStateTime=e)}set allowedModalities(e){this.data.allowedAudioSend=e.audio.some(e=>mY(e)),this.data.allowedVideoSend=e.video.some(e=>mY(e)),this.data.allowedScreensharingSend=e.sharing.some(e=>mY(e))}negotiationStart(e){var t;(t=this.data).initialNegotiationType??(t.initialNegotiationType=e),this.data.negotiationCount++}negotiationCompleted(e){this.data.initialNegotiationCompleted=!0,this.data.activeModalities=e,this.data.error=void 0}negotiationRejected(){this.data.rejectedNegotiationCount++}registerRollbackEvent(e){this.data.rollbackNegotiation.push({type:e.type,attempt:this.data.rollbackNegotiation.length+1,error:e.error})}registerRawMediaAccess(e,t,i){let n=this.data.rawMedia[e]?.[t];if(n){n.numAttempts++;let r=this.rawMediaTimers[e]?.[t];i?r?.start():r?.stop()}}registerQualityStateChangedEvent(e){switch(e.type){case"NoNetwork":"Good"===e.value?this.data.noIceCandidatesEventCount.good++:this.data.noIceCandidatesEventCount.bad++;break;case"NetworkRelaysNotReachable":"Good"===e.value?this.data.noRelayIceCandidatesEventCount.good++:this.data.noRelayIceCandidatesEventCount.bad++;break;case"DeviceCaptureNotFunctioning":this.deviceCaptureTracker.updateLevel(e.value),"Good"===e.value?this.data.microphoneInUseEventCount.good++:this.data.microphoneInUseEventCount.bad++;break;case"DeviceRenderNotFunctioning":this.deviceRenderTracker.updateLevel(e.value);break;case"VideoCapturerDeviceStartFailed":"Good"===e.value?this.data.cameraInUseEventCount.good++:this.data.cameraInUseEventCount.bad++;break;case"DeviceCaptureMute":"Bad"===e.value?this.osMuteTracker.start():this.osMuteTracker.stop(),this.updateCommonMute();break;case"NetworkRecvQuality":this.networkRecvTracker.updateLevel(e.value);break;case"NetworkSendQuality":this.networkSendTracker.updateLevel(e.value);break;case"ZeroCaptureDevicesEnumerated":this.zeroCaptureTracker.updateLevel(e.value);break;case"ZeroRenderDevicesEnumerated":this.zeroRenderTracker.updateLevel(e.value);break;case"VideoCaptureDeviceFreeze":"Good"===e.value?this.data.cameraFreezeEventCount.end++:this.data.cameraFreezeEventCount.start++}"DeviceSpeakWhileMuted"!==e.type&&nq(this.data.ufds,{...e,timestamp:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numUFDs)}registerRemoteQualityStateChangedEvent(e,t){e.forEach(e=>{var i,n,r;(i=this.data.remoteUfdsCount)[n=SP(e)]??(i[n]={});let s=this.data.remoteUfdsCount[SP(e)];s[r=e.value.toLowerCase()]??(s[r]=0),s[e.value.toLowerCase()]++,tq(this.data.remoteUfds,{...e,participantId:t,timestamp:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numUFDs)})}registerTransportConnected(){this.transportDisconnected&&(this.transportDisconnected=!1,this.data.transportReconnectedCount++)}registerTransportDisconnected(){this.transportDisconnected=!0}registerTransportFailed(){this.transportDisconnected=!1}terminated(e){this.commonMuteTracker.stop(),this.swMuteTracker.stop(),this.osMuteTracker.stop(),this.speakerMuteTracker.stop(),this.hwSilentTracker.stop(),this.isSpeakingTracker.stop(),this.rawMediaTimers.audio.recv.stop(),this.rawMediaTimers.audio.send.stop(),this.networkSendTracker.dispose(),this.networkRecvTracker.dispose(),this.zeroCaptureTracker.dispose(),this.zeroRenderTracker.dispose(),this.deviceCaptureTracker.dispose(),this.data.terminationReason=nw(e),this.data.terminationTime=Date.now(),this.durationTimer.stop(),this.dmFragmenter.terminated(this.dmDiagnostics),this.ufdFragmenter.terminated(this.ufdDiagnostics)}addStatsError(e,t){let i=this.data.statsErrors.find(i=>i.error===t&&i.origin===e);this.logger.safe.error(`Stats error from '${e}': ${t} (${i?.count??1})`),i?i.count++:nq(this.data.statsErrors,{origin:e,error:t,count:1},this.configProvider.config.diagnostics.collectionLimits.numStatsErrors)}newNativeSessionDiag(e=!0){let t;return t=new UE(this.configProvider,this.dmDiagnostics,(e,t)=>this.addStatsError(e,t),e=>this.newNativeSessionDiag(e),()=>this.pushNativeSessionDiag(t.getObjectRef()),this.dshDiagnostics.resetState(),()=>this.getObjectRef()),e&&nq(this.data.webrtcSessions,t.getObjectRef(),this.configProvider.config.diagnostics.collectionLimits.numNativeSessions),t}pushNativeSessionDiag(e){nq(this.data.webrtcSessions,e,this.configProvider.config.diagnostics.collectionLimits.numNativeSessions)}getObjectRef(){return this.data}setBatteryLevel(e){this.data.batteryLevel=e}updateCommonMute(){this.swMuteTracker.isRunning||this.osMuteTracker.isRunning?this.commonMuteTracker.start():this.swMuteTracker.isRunning||this.osMuteTracker.isRunning||this.commonMuteTracker.stop()}registerElevation(e){tq(this.data.elevation,{event:e,timestamp:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numElevation)}registerMediaLeakEvent(e){tq(this.data.mediaLeaks,{...e},this.configProvider.config.diagnostics.collectionLimits.numMediaLeakEvents)}},Uw=class{constructor(e){this.fragmentBase=nw(e)}getFragment(e){let t=this.fragmentTerminated??e,i={};for(let[e,n]of Object.entries(t.count))for(let[t,r]of Object.entries(n)){let n=this.fragmentBase.count[e]?this.fragmentBase.count[e][t]:void 0,s=n?r-n:r;s&&(i[e]??(i[e]={}),i[e][t]=s)}return{count:i}}terminated(e){this.fragmentTerminated=nw(e)}},UP=class{constructor(e){this.initTimestamp=Number.MIN_SAFE_INTEGER,this.terminatedTimestamp=Number.MAX_SAFE_INTEGER,this.fragmentBase=this.sanitizeDiagnostics(e),this.initTimestamp=Date.now()}getFragment(e){let t=this.fragmentTerminated??e;return{devicesChangeCount:t.devicesChangeCount-this.fragmentBase.devicesChangeCount,deviceSelectionChangeCount:t.deviceSelectionChangeCount-this.fragmentBase.deviceSelectionChangeCount,deviceSelectionChangeCountFromInterface:t.deviceSelectionChangeCountFromInterface-this.fragmentBase.deviceSelectionChangeCountFromInterface,devicesPollChangeCount:t.devicesPollChangeCount-this.fragmentBase.devicesPollChangeCount,audioSourceNumOfSuccessfulReopens:t.audioSourceNumOfSuccessfulReopens-this.fragmentBase.audioSourceNumOfSuccessfulReopens||void 0,audioSourceNumOfReopenRequests:t.audioSourceNumOfReopenRequests-this.fragmentBase.audioSourceNumOfReopenRequests||void 0,audioCaptureDeviceErrorFlag:e.audioCaptureDeviceErrorFlags.filter(e=>e.timestamp>this.initTimestamp&&e.timestamp<this.terminatedTimestamp).reduce((e,t)=>Number(BigInt(e)|BigInt(t.audioDeviceErrorFlag)),0),audioRenderDeviceErrorFlag:e.audioRenderDeviceErrorFlags.filter(e=>e.timestamp>this.initTimestamp&&e.timestamp<this.terminatedTimestamp).reduce((e,t)=>Number(BigInt(e)|BigInt(t.audioDeviceErrorFlag)),0)}}terminated(e){this.fragmentTerminated=this.sanitizeDiagnostics(e),this.terminatedTimestamp=Date.now()}sanitizeDiagnostics(e){return{devicesChangeCount:e.devicesChangeCount,deviceSelectionChangeCount:e.deviceSelectionChangeCount,deviceSelectionChangeCountFromInterface:e.deviceSelectionChangeCountFromInterface,devicesPollChangeCount:e.devicesPollChangeCount,audioSourceNumOfSuccessfulReopens:e.audioSourceNumOfSuccessfulReopens,audioSourceNumOfReopenRequests:e.audioSourceNumOfReopenRequests,audioCaptureDeviceErrorFlag:0,audioRenderDeviceErrorFlag:0}}},UR=class{constructor(){this.startTime=0,this.elapsedInternal=0,this.countInternal=0}get isRunning(){return!!this.startTime}get elapsed(){return Math.round(this.startTime?this.elapsedInternal+nQ()-this.startTime:this.elapsedInternal)}get count(){return this.countInternal}start(){!this.startTime&&(this.startTime=nQ(),this.countInternal++)}stop(){this.startTime&&(this.elapsedInternal+=nQ()-this.startTime,this.startTime=0)}},UA=class{constructor(){this.currentLevel="Good",this.stopWatches={},this.startTime=nQ(),this.getStopWatch(this.currentLevel).start()}updateLevel(e){this.currentLevel!==e&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=e,this.getStopWatch(this.currentLevel).start())}getCount(e){let t=this.stopWatches[e];return t?t.count:0}getRatio(e){return UM(this.getStopWatch(e).elapsed,Math.round((this.endTime||nQ())-this.startTime))}dispose(e){this.getStopWatch(this.currentLevel).stop(),this.endTime=nQ()}getStopWatch(e){let t=this.stopWatches[e];return t||(t=new UR,this.stopWatches[e]=t),t}};function UM(e,t){return e/(t||1)}function UD(e,t,i){return{recv:nP({id:t?.inboundRTP.id,ssrc:t?.inboundRTP.ssrc,mediaType:t?.inboundRTP.mediaType??t?.inboundRTP.kind,bytesReceived:n0(e.audio?.recv,e=>e.inboundRTP.bytesReceived),packetsReceived:n0(e.audio?.recv,e=>e.inboundRTP.packetsReceived),packetsLost:n0(e.audio?.recv,e=>e.inboundRTP.packetsLost),googCodecName:t?.codec?.mimeType.split("/").pop(),googTrackId:t?.inboundRTP.trackIdentifier??t?.track?.trackIdentifier,transport_id:t?.transport?.id,transportId:t?.inboundRTP.transportId,transport_selectedCandidatePairId:t?.transport?.selectedCandidatePairId,transport_dtlsCipher:t?.transport?.dtlsCipher,transport_srtpCipher:t?.transport?.srtpCipher,pair_id:t?.transport?.selectedCandidatePair?.id,pair_responsesSent:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.responsesSent),pair_requestsReceived:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.requestsReceived),pair_googRemoteCandidateType:t?.transport?.selectedCandidatePair?.remoteCandidate?.candidateType,pair_consentRequestsSent:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.consentRequestsSent),pair_googTransportType:t?.transport?.selectedCandidatePair?.localCandidate?.protocol,pair_googLocalCandidateType:t?.transport?.selectedCandidatePair?.localCandidate?.candidateType,pair_googWritable:t?.transport?.selectedCandidatePair?.writable,pair_requestsSent:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.requestsSent),pair_googRtt:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.currentRoundTripTime*1e3,!0),pair_googActiveConnection:t?.transport?.selectedCandidatePair?.nominated,pair_packetsDiscardedOnSend:t?.transport?.selectedCandidatePair?.packetsDiscardedOnSend,pair_bytesReceived:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.bytesReceived),pair_responsesReceived:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.responsesReceived),pair_remoteCandidateId:t?.transport?.selectedCandidatePair?.remoteCandidate?.id,pair_localCandidateId:t?.transport?.selectedCandidatePair?.localCandidate?.id,pair_localNetworkType:t?.transport?.selectedCandidatePair?.localCandidate?.networkType,pair_localRelayProtocol:t?.transport?.selectedCandidatePair?.localCandidate?.relayProtocol,pair_packetsSent:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.packetsSent),pair_googLocalAddress:t?.transport?.selectedCandidatePair?.localCandidate?.ip??t?.transport?.selectedCandidatePair?.localCandidate?.address,pair_googRemoteAddress:t?.transport?.selectedCandidatePair?.remoteCandidate?.ip??t?.transport?.selectedCandidatePair?.remoteCandidate?.address,pair_bytesSent:n0(e.audio?.recv,e=>e.transport?.selectedCandidatePair?.bytesSent),pair_googReadable:t?.transport?.selectedCandidatePair?.nominated,googJitterBufferMs:n0(e.audio?.recv,e=>e.extensions?.jitterBufferDelayMs),totalSamplesReceived:n0(e.audio?.recv,e=>e.inboundRTP?.totalSamplesReceived),totalAudioEnergy:t?.inboundRTP?.totalAudioEnergy??t?.track?.totalAudioEnergy,audioOutputLevel:n0(e.audio?.recv,e=>e.inboundRTP?.audioLevel??e.track?.audioLevel),concealedSamples:n0(e.audio?.recv,e=>e.inboundRTP?.concealedSamples),silentConcealedSamples:n0(e.audio?.recv,e=>e.inboundRTP?.silentConcealedSamples),fecPacketsReceived:n0(e.audio?.recv,e=>e.inboundRTP?.fecPacketsReceived),fecPacketsDiscarded:n0(e.audio?.recv,e=>e.inboundRTP?.fecPacketsDiscarded),healedRatio:n0(e.audio?.recv,e=>e.extensions?.healedRatio),jitter:n0(e.audio?.recv,e=>e.inboundRTP?.jitter),packetsDiscarded:n0(e.audio?.recv,e=>e.inboundRTP?.packetsDiscarded)}),send:nP({id:i?.outboundRTP.id,ssrc:i?.outboundRTP.ssrc,mediaType:i?.outboundRTP.mediaType??i?.outboundRTP.kind,bytesSent:n0(e.audio?.send,e=>e.outboundRTP.bytesSent),packetsSent:n0(e.audio?.send,e=>e.outboundRTP.packetsSent),packetsLost:n0(e.audio?.send,e=>e.remoteInboundRTP?.packetsLost),googCodecName:i?.codec?.mimeType.split("/").pop(),googTrackId:i?.mediaSource?.trackIdentifier??i?.track?.trackIdentifier,googRtt:n0(e.audio?.send,e=>(e.remoteInboundRTP?.roundTripTime??0)*1e3,!0),transport_id:i?.transport?.id,transportId:i?.outboundRTP.transportId,transport_selectedCandidatePairId:i?.transport?.selectedCandidatePairId,transport_dtlsCipher:i?.transport?.dtlsCipher,transport_srtpCipher:i?.transport?.srtpCipher,transport_localCertificateId:i?.transport?.localCertificateId,pair_id:i?.transport?.selectedCandidatePair?.id,pair_responsesSent:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.responsesSent),pair_requestsReceived:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.requestsReceived),pair_googRemoteCandidateType:i?.transport?.selectedCandidatePair?.remoteCandidate?.candidateType,pair_consentRequestsSent:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.consentRequestsSent),pair_googTransportType:i?.transport?.selectedCandidatePair?.localCandidate?.protocol,pair_googLocalCandidateType:i?.transport?.selectedCandidatePair?.localCandidate?.candidateType,pair_googWritable:i?.transport?.selectedCandidatePair?.writable,pair_requestsSent:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.requestsSent),pair_googRtt:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.currentRoundTripTime*1e3,!0),pair_googActiveConnection:i?.transport?.selectedCandidatePair?.nominated,pair_packetsDiscardedOnSend:i?.transport?.selectedCandidatePair?.packetsDiscardedOnSend,pair_bytesReceived:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.bytesReceived),pair_responsesReceived:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.responsesReceived),pair_remoteCandidateId:i?.transport?.selectedCandidatePair?.remoteCandidate?.id,pair_localCandidateId:i?.transport?.selectedCandidatePair?.localCandidate?.id,pair_localNetworkType:t?.transport?.selectedCandidatePair?.localCandidate?.networkType,pair_localRelayProtocol:t?.transport?.selectedCandidatePair?.localCandidate?.relayProtocol,pair_packetsSent:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.packetsSent),pair_googLocalAddress:i?.transport?.selectedCandidatePair?.localCandidate?.ip??i?.transport?.selectedCandidatePair?.localCandidate?.address,pair_googRemoteAddress:i?.transport?.selectedCandidatePair?.remoteCandidate?.ip??i?.transport?.selectedCandidatePair?.remoteCandidate?.address,pair_bytesSent:n0(e.audio?.send,e=>e.transport?.selectedCandidatePair?.bytesSent),pair_googReadable:i?.transport?.selectedCandidatePair?.nominated,audioInputLevel:n0(e.audio?.send,e=>e.mediaSource?.audioLevel),totalAudioEnergy:i?.mediaSource?.totalAudioEnergy??i?.track?.totalAudioEnergy,totalSamplesDuration:i?.mediaSource?.totalSamplesDuration,jitter:n0(e.audio?.send,e=>e.remoteInboundRTP?.jitter)})}}function UO(e,t,i,n){return{recv:nP({id:i?.inboundRTP.id,ssrc:i?.inboundRTP.ssrc,mediaType:i?.inboundRTP.mediaType??i?.inboundRTP.kind,bytesReceived:n0(t[e]?.recv,e=>e.inboundRTP.bytesReceived),packetsReceived:n0(t[e]?.recv,e=>e.inboundRTP.packetsReceived),packetsLost:n0(t[e]?.recv,e=>e.inboundRTP.packetsLost),googCodecName:i?.codec?.mimeType.split("/").pop(),codecImplementationName:i?.inboundRTP.decoderImplementation,googTrackId:i?.inboundRTP.trackIdentifier??i?.track?.trackIdentifier,transport_id:i?.transport?.id,transportId:i?.inboundRTP.transportId,transport_selectedCandidatePairId:i?.transport?.selectedCandidatePairId,transport_dtlsCipher:i?.transport?.dtlsCipher,transport_srtpCipher:i?.transport?.srtpCipher,pair_id:i?.transport?.selectedCandidatePair?.id,pair_responsesSent:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.responsesSent),pair_requestsReceived:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.requestsReceived),pair_googRemoteCandidateType:i?.transport?.selectedCandidatePair?.remoteCandidate?.candidateType,pair_consentRequestsSent:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.consentRequestsSent),pair_googTransportType:i?.transport?.selectedCandidatePair?.localCandidate?.protocol,pair_googLocalCandidateType:i?.transport?.selectedCandidatePair?.localCandidate?.candidateType,pair_googWritable:i?.transport?.selectedCandidatePair?.writable,pair_requestsSent:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.requestsSent),pair_googRtt:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.currentRoundTripTime*1e3,!0),pair_googActiveConnection:i?.transport?.selectedCandidatePair?.nominated,pair_packetsDiscardedOnSend:i?.transport?.selectedCandidatePair?.packetsDiscardedOnSend,pair_bytesReceived:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.bytesReceived),pair_responsesReceived:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.responsesReceived),pair_remoteCandidateId:i?.transport?.selectedCandidatePair?.remoteCandidate?.id,pair_localCandidateId:i?.transport?.selectedCandidatePair?.localCandidate?.id,pair_localNetworkType:i?.transport?.selectedCandidatePair?.localCandidate?.networkType,pair_localRelayProtocol:i?.transport?.selectedCandidatePair?.localCandidate?.relayProtocol,pair_packetsSent:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.packetsSent),pair_googLocalAddress:i?.transport?.selectedCandidatePair?.localCandidate?.ip??i?.transport?.selectedCandidatePair?.localCandidate?.address,pair_googRemoteAddress:i?.transport?.selectedCandidatePair?.remoteCandidate?.ip??i?.transport?.selectedCandidatePair?.remoteCandidate?.address,pair_bytesSent:n0(t[e]?.recv,e=>e.transport?.selectedCandidatePair?.bytesSent),pair_googReadable:i?.transport?.selectedCandidatePair?.nominated,decodeTime:n0(t[e]?.recv,e=>e.extensions?.decodeTime),framesDecoded:n0(t[e]?.recv,e=>e.inboundRTP.framesDecoded),googFrameHeightReceived:n0(t[e]?.recv,e=>e.inboundRTP.frameHeight),googFrameWidthReceived:n0(t[e]?.recv,e=>e.inboundRTP.frameWidth),googFrameRateReceived:n0(t[e]?.recv,e=>e.extensions?.frameRateReceived),googNacksSent:n0(t[e]?.recv,e=>e.inboundRTP.nackCount),googPlisSent:n0(t[e]?.recv,e=>e.inboundRTP.pliCount),keyFramesDecoded:n0(t[e]?.recv,e=>e.inboundRTP.keyFramesDecoded),googFirsSent:n0(t[e]?.recv,e=>e.inboundRTP.firCount),googJitterBufferMs:n0(t[e]?.recv,e=>e.extensions?.jitterBufferMs),googFrameRateDecoded:n0(t[e]?.recv,e=>e.extensions?.frameRateDecoded),googFrameRateOutput:i?.extensions?.trackRecvFps,jitter:i?.inboundRTP.jitter}),send:nP({id:n?.outboundRTP.id,rid:n?.outboundRTP.rid,ssrc:n?.outboundRTP.ssrc,mediaType:n?.outboundRTP.mediaType??n?.outboundRTP.kind,bytesSent:n0(t[e]?.send,e=>e.outboundRTP.bytesSent),packetsSent:n0(t[e]?.send,e=>e.outboundRTP.packetsSent),packetsLost:n0(t[e]?.send,e=>e.remoteInboundRTP?.packetsLost),googCodecName:n?.codec?.mimeType.split("/").pop(),codecImplementationName:n?.outboundRTP.encoderImplementation,googTrackId:n?.mediaSource?.trackIdentifier??n?.track?.trackIdentifier,transport_id:n?.transport?.id,transportId:n?.outboundRTP.transportId,transport_selectedCandidatePairId:n?.transport?.selectedCandidatePairId,transport_dtlsCipher:n?.transport?.dtlsCipher,transport_srtpCipher:n?.transport?.srtpCipher,pair_id:n?.transport?.selectedCandidatePair?.id,pair_responsesSent:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.responsesSent),pair_requestsReceived:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.requestsReceived),pair_googRemoteCandidateType:n?.transport?.selectedCandidatePair?.remoteCandidate?.candidateType,pair_consentRequestsSent:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.consentRequestsSent),pair_googTransportType:n?.transport?.selectedCandidatePair?.localCandidate?.protocol,pair_googLocalCandidateType:n?.transport?.selectedCandidatePair?.localCandidate?.candidateType,pair_googWritable:n?.transport?.selectedCandidatePair?.writable,pair_requestsSent:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.requestsSent),pair_googRtt:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.currentRoundTripTime*1e3,!0),pair_googActiveConnection:n?.transport?.selectedCandidatePair?.nominated,pair_packetsDiscardedOnSend:n?.transport?.selectedCandidatePair?.packetsDiscardedOnSend,pair_bytesReceived:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.bytesReceived),pair_responsesReceived:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.responsesReceived),pair_remoteCandidateId:n?.transport?.selectedCandidatePair?.remoteCandidate?.id,pair_localCandidateId:n?.transport?.selectedCandidatePair?.localCandidate?.id,pair_localNetworkType:i?.transport?.selectedCandidatePair?.localCandidate?.networkType,pair_localRelayProtocol:i?.transport?.selectedCandidatePair?.localCandidate?.relayProtocol,pair_packetsSent:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.packetsSent),pair_googLocalAddress:n?.transport?.selectedCandidatePair?.localCandidate?.ip??n?.transport?.selectedCandidatePair?.localCandidate?.address,pair_googRemoteAddress:n?.transport?.selectedCandidatePair?.remoteCandidate?.ip??n?.transport?.selectedCandidatePair?.remoteCandidate?.address,pair_bytesSent:n0(t[e]?.send,e=>e.transport?.selectedCandidatePair?.bytesSent),pair_googReadable:n?.transport?.selectedCandidatePair?.nominated,encodeTime:n0(t[e]?.send,e=>e.extensions?.encodeTime),framesEncoded:n0(t[e]?.send,e=>e.outboundRTP.framesEncoded),googNacksReceived:n0(t[e]?.send,e=>e.outboundRTP.nackCount),googPlisReceived:n0(t[e]?.send,e=>e.outboundRTP.pliCount),googFirsReceived:n0(t[e]?.send,e=>e.outboundRTP.firCount),keyFramesEncoded:n0(t[e]?.send,e=>e.outboundRTP.keyFramesEncoded),googFrameHeightInput:n?.mediaSource?.height,googFrameWidthInput:n?.mediaSource?.width,googFrameRateInput:n0(t[e]?.send,e=>e.mediaSource?.framesPerSecond),googFrameHeightSent:n0(t[e]?.send,e=>e.outboundRTP.frameHeight),googFrameWidthSent:n0(t[e]?.send,e=>e.outboundRTP.frameWidth),googFrameRateSent:n0(t[e]?.send,e=>e.extensions?.frameRateSent),googFrameRateEncoded:n0(t[e]?.send,e=>e.extensions?.frameRateEncoded),googRtt:n0(t[e]?.send,e=>(e.remoteInboundRTP?.roundTripTime??0)*1e3,!0),hugeFramesSent:n?.outboundRTP.hugeFramesSent,qpSum:n0(t[e]?.send,e=>e.outboundRTP.qpSum),qualityLimitationDurations:n?JSON.stringify(n?.outboundRTP.qualityLimitationDurations):void 0,qualityLimitationReason:n?.outboundRTP.qualityLimitationReason,qualityLimitationResolutionChanges:n?.outboundRTP.qualityLimitationResolutionChanges,jitter:n?.remoteInboundRTP?.jitter,retransmittedPacketsSent:n0(t[e]?.send,e=>e.outboundRTP.retransmittedPacketsSent)})}}var Uk=i(892891);function UN(e){let t=(0,Uk.last)((0,Uk.last)(e.statsReports)?.data??[]);return nP({WebRTCStats_data:nP({bytesReceived:t?.bytesReceived,bytesSent:t?.bytesSent,dataChannelIdentifier:t?.dataChannelIdentifier,label:t?.label,messagesReceived:t?.messagesReceived,messagesSent:t?.messagesSent,state:t?.state,timestamp:t?.timestamp}),ProtocolCounters:JSON.stringify(e.dataChannel?.protocolCounters),Error:e.dataChannel?.error,SessionState:e.dataChannelSessionState?.toString(),CreateChannelError:e.dataChannelCreationError})}function Ux(e,t,i){let n=t.config.diagnostics.telemetryLimits,r=e.aggregatedModalityStats,s=nG(r.audio?.recv),a=nG(r.audio?.send),o=nG(r.video?.recv),l=nG(r.video?.send),c=nG(r.sharing?.recv),d=nG(r.sharing?.send),u=i=>i&&nj(nw(i).map(t=>nZ(nj(t.events,n.numCapabilitiesApplied,1),"timestamp",e.startTime)),t.config.diagnostics.telemetryLimits.numCapabilitiesRequested),h=u(e.qualityManager?.videoMaxCapabilitiesEvents),g=u(e.qualityManager?.videoMaxCapabilitiesErrors),p=u(e.qualityManager?.sharingMaxCapabilitiesEvents),f=u(e.qualityManager?.sharingMaxCapabilitiesErrors),m="REMB"!==e.negotiation.bweType?e.bandwidthReport:void 0,v="REMB"===e.negotiation.bweType?e.bandwidthReport:void 0,[S,y,C]=re(s?.aggregated?.customHealerStats?.pullTimings),[b,T,E]=re(s?.aggregated?.customHealerStats?.pullPacketProcessingTimes),[_,I,w]=re(s?.aggregated?.customHealerStats?.pushPacketProcessingTimes),P=e.OVC?{...e.OVC}:void 0;return P?.events!==void 0&&(P.events=P.events.slice(0,n.numOvershootEvents)),nP({...UN(e),BundlePolicy:e.bundlePolicy,FakeIceCandidate:e.negotiation.fakeCandidate,h264AvailableProfiles:JSON.stringify(e.H264Profiles),h264CodecCapabilities:JSON.stringify(e.h264CodecCapabilities),IceConnectionState:e.transportState?.iceConnectionState,IceConnectionStatePrevious:e.transportState?.iceConnectionStatePrevious,IceServers:e.iceServers,IceTransportPolicy:e.iceTransportPolicy,NegotiatedSrtp:JSON.stringify(e.negotiation.negotiatedSrtp),OfferedSrtp:JSON.stringify(e.negotiation.offeredSrtp),RelayCandidate:e.relayCandidate,SdpSemantics:e.sdpSemantics,iceCandidateErrors:JSON.stringify(e.iceCandidateErrors),SignalingState:e.transportState?.signalingState,SignalingStatePrevious:e.transportState?.signalingStatePrevious,WebRTCStats_statsErrors:JSON.stringify(i),MaxSessionBandwidth:e.maxSessionBandwidth,Bandwidth_uplinkStabilizationTime:JSON.stringify(e.bwStabilizationTime),Bandwidth_downlinkStabilizationTime:JSON.stringify(e.bwDownlinkStabilizationTime),totalVideoControlMessages:e.qualityManager?.numVideoControlMessages,outOfOrderVideoControlMessages:e.qualityManager?.numOutOfOrderVideoControlMessages,webcamFreezeIntervals:e.qualityManager?.numWebcamFreezeIntervals,processedStreamFreezeIntervals:e.qualityManager?.numProcessedStreamFreezeIntervals,ReinvitelessContext:JSON.stringify(e.reinvitelessContext),IPAddress:e.IPAddress??"none",ReflexiveLocalIP:e.reflexiveLocalIP??"none",NumberOfInterfaces:e.numInterfaces,StartTime:e.startTime,EndTime:e.endTime,AudioTransportRecvBitrate:s?.transport?.extensions?.recvBWAvg,AudioTransportSendBitrate:s?.transport?.extensions?.sendBWAvg,AudioPayloadRecvBitrate:s?.aggregated?.bitrateAvg,AudioPayloadSendBitrate:a?.aggregated?.bitrateAvg,VideoPayloadRecvBitrate:o?.aggregated?.bitrateAvg,VideoPayloadSendBitrate:l?.aggregated?.bitrateAvg,WebRTCStats_bweStat_googAvailableReceiveBandwidth:n0(r.video?.recv,e=>e.transport?.selectedCandidatePair?.availableIncomingBitrate)??n0(r.video?.send,e=>e.transport?.selectedCandidatePair?.availableIncomingBitrate),WebRTCStats_bweStat_googAvailableSendBandwidth:n0(r.video?.send,e=>e.transport?.selectedCandidatePair?.availableOutgoingBitrate)??n0(r.video?.recv,e=>e.transport?.selectedCandidatePair?.availableOutgoingBitrate),Bandwidth_jumpsHistogram:JSON.stringify(l?.transport?.extensions?.bwJumpsHistogram),StartCallBWESendSide:JSON.stringify(m?.startOfTheCall),EndCallBWESendSide:JSON.stringify(m?.endOfTheCall),BWEStdSendSide:JSON.stringify(m?.std),BwPercentilesSendSide:JSON.stringify(m?.bwPercentiles),AvgBwSendSide:JSON.stringify(m?.avgBwe),StartCallBWE:JSON.stringify(v?.startOfTheCall),EndCallBWE:JSON.stringify(v?.endOfTheCall),BWEStd:JSON.stringify(v?.std),BwPercentiles:JSON.stringify(v?.bwPercentiles),AvgBwe:JSON.stringify(v?.avgBwe),WebRTCStats_ssrc:nP({audio:UD(r,s,a),video:UO("video",r,o,l),sharing:UO("sharing",r,c,d)}),Audio_recv_jitterBufferAvgSize:s?.aggregated?.avgJitterBufferSize,Audio_recv_jitterBufferAvgDelayMs:s?.aggregated?.avgJitterBufferDelayMs,Audio_recv_packetsLostRateMax:nB(s?.aggregated?.lossRateMax,6),Audio_recv_jitterAvg:s?.aggregated?.jitterAvg,Audio_recv_jitterMax:s?.aggregated?.jitterMax,Audio_recv_networkAvgLossRate:nB(s?.aggregated?.networkAvgLossRate,6),Audio_recv_packetsLostAvg:s?.aggregated?.packetsLostAvg,Audio_recv_healedRatioAvg:s?.aggregated?.healedRatioAvg,Audio_recv_healedRatioMax:s?.aggregated?.healedRatioMax,Audio_recv_customhealer_pullTimings:JSON.stringify({avg:S,min:y,max:C}),Audio_recv_customhealer_pullDurations:JSON.stringify({avg:b,min:T,max:E,p50:s?.aggregated?.customHealerStats?.pullPacketProcessingTimeP50,p95:s?.aggregated?.customHealerStats?.pullPacketProcessingTimeP95}),Audio_recv_customhealer_pushDurations:JSON.stringify({avg:_,min:I,max:w,p50:s?.aggregated?.customHealerStats?.pushPacketProcessingTimeP50,p95:s?.aggregated?.customHealerStats?.pushPacketProcessingTimeP95}),Audio_recv_customhealer_pullStartTiming:s?.aggregated?.customHealerStats?.pullStartTiming,Audio_recv_customhealer_pullStrategy:s?.aggregated?.customHealerStats?.pullStrategy,Audio_recv_customhealer_fallbackThreshold:s?.aggregated?.customHealerStats?.fallbackThreshold,Audio_recv_customhealer_hasFallbackTriggered:s?.aggregated?.customHealerStats?.hasFallbackTriggered,Audio_recv_customhealer_audioWorkletAvailable:s?.aggregated?.customHealerStats?.audioWorkletAvailable,Audio_recv_customhealer_audioRendererUsed:s?.aggregated?.customHealerStats?.audioRendererUsed,Audio_recv_audioLevelAvg:s?.aggregated?.audioLevelAvg,Audio_send_rttAvg:a?.aggregated?.rttAvg&&nB(1e3*a.aggregated.rttAvg),Audio_send_rttMax:a?.aggregated?.rttMax&&nB(1e3*a.aggregated.rttMax),Audio_send_RawInputVolume:n0(r.audio?.send,e=>e.aggregated?.rawInputVolume),Audio_send_packetsLostRateMax:nB(a?.aggregated?.lossRateMax,6),Audio_send_presentationAPIUserDuration:e.presentationAPIUserDuration,Audio_send_presentationDuration:e.presentationAudioDuration,Audio_send_audioLevelAvg:a?.aggregated?.audioLevelAvg,Video_recv_MSIDs:JSON.stringify(e.remoteVideoManager?.renderers?.map(e=>e.msi)),Video_recv_DurationSeconds:o?.aggregated?.duration,Video_recv_FreezeHistogram:JSON.stringify(o?.aggregated?.freezeCountHistogram),Video_recv_FreezeTimestamps:JSON.stringify(nX(o?.aggregated?.freezeTimestampsHistogram,e.startTime,n.numOfHistogramSamples)),Video_recv_LongestFreezeDuration:o?.aggregated?.longestFreeze,Video_recv_OngoingFreeze:o?.extensions?.isFrozen,Video_recv_OngoingFreezeDuration:o?.aggregated?.ongoingFreezeDuration,Video_recv_TotalFreezeDuration:o?.aggregated?.totalFreezeDuration,Video_recv_RecvAvgFreezeDuration:o?.aggregated?.avgFreezeDuration,Video_recv_NumResolutionSwitches:o?.aggregated?.numResolutionSwitches,Video_recv_ResolutionDurations:JSON.stringify(o?.aggregated?.resolutionDurations),Video_recv_StreamsMax:e.recvVideoStreamCount.max,Video_recv_StreamsMin:e.recvVideoStreamCount.min,Video_recv_StreamsMode:e.recvVideoStreamCount.mode,Video_recv_TimeToFirstFrame:e.remoteVideoManager?.firstTimeToFirstFrameVideo,Video_recv_TimeToFirstFrameSinceSubscriptionStart:e.remoteVideoManager?.timeToFirstFrameSinceSubscriptionStartVideo,Video_recv_bitrateAvg:o?.aggregated?.bitrateAvg,Video_recv_bitrateMax:o?.aggregated?.bitrateMax,Video_recv_frameRateAvg:o?.aggregated?.avgFrameRate,Video_recv_jitterBufferAvgSize:o?.aggregated?.avgJitterBufferSize,Video_recv_packetsLostRateMax:nB(o?.aggregated?.lossRateMax,6),Video_recv_isRenderingEvents:JSON.stringify(nj(e.remoteVideoManager?.isRenderingEvents.video,n.numIsRenderingEvents)),Video_recv_FpsHarmonicAverage:o?.aggregated?.fpsHarmonicAverage,Video_recv_PreferredResolution:e.remoteVideoManager?.preferredResolution.video?.toString(),Video_recv_PreferredResolutionDurations:JSON.stringify(e.remoteVideoManager?.preferredResolutionDurations.video),Video_recv_statsOnSubscribed:JSON.stringify(e.statsOnSubscribed.video),Video_recv_macroblockRateReceivedMax:o?.aggregated?.macroblockRateStats?.macroblockRateReceivedMax,Video_recv_macroblockRateReceivedAvg:o?.aggregated?.macroblockRateStats?.macroblockRateReceivedAvg,Video_recv_macroblockRateDecodedMax:o?.aggregated?.macroblockRateStats?.macroblockRateDecodedMax,Video_recv_macroblockRateDecodedAvg:o?.aggregated?.macroblockRateStats?.macroblockRateDecodedAvg,Video_recv_macroblockRateMaxDecoderLossPercent:o?.aggregated?.macroblockRateStats?.macroblockRateMaxDecoderLossPercent,Video_recv_macroblockRateDecoderLossPercent:o?.aggregated?.macroblockRateStats?.macroblockRateDecoderLossPercent,totalVideoRecv_macroblockRateReceivedMax:e.totalVideoRecvMblocksRates?.macroblockRateReceivedMax,totalVideoRecv_macroblockRateReceivedAvg:e.totalVideoRecvMblocksRates?.macroblockRateReceivedAvg,totalVideoRecv_macroblockRateDecodedMax:e.totalVideoRecvMblocksRates?.macroblockRateDecodedMax,totalVideoRecv_macroblockRateDecodedAvg:e.totalVideoRecvMblocksRates?.macroblockRateDecodedAvg,totalVideoRecv_macroblockRateMaxDecoderLossPercent:e.totalVideoRecvMblocksRates?.macroblockRateMaxDecoderLossPercent,totalVideoRecv_macroblockRateDecoderLossPercent:e.totalVideoRecvMblocksRates?.macroblockRateDecoderLossPercent,Video_SubscriptionEvents:JSON.stringify(nZ(e.subscriptionManager?.video.events,"ts",e.startTime)),Video_SubscriptionCounters:JSON.stringify(e.subscriptionManager?.video.counters),Video_send_SourceId:l?.mediaEntity?.xSourceStreamId,Video_send_CaptureFramerateAvg:l?.aggregated?.captureFramerateAvg,Video_send_DurationSeconds:l?.aggregated?.duration,Video_send_FreezeIntervals:l?.extensions?.captureFreezeIntervalsCount,Video_send_MaxCapabilities:JSON.stringify(h),Video_send_MaxCapabilitiesErrors:JSON.stringify(g),Video_send_OvershootDurations:JSON.stringify({fs:l?.aggregated?.totalFsOvershootDuration,fps:l?.aggregated?.totalFpsOvershootDuration,br:l?.aggregated?.totalBrOvershootDuration}),Video_send_OvershootEvents:n7(l?.aggregated?.overshootEvents,n.numOvershootEvents,"timestamp",e.startTime),Video_send_QpAvg:l?.aggregated?.qpAvg,Video_send_bitrateAvg:l?.aggregated?.bitrateAvg,Video_send_bitrateMax:l?.aggregated?.bitrateMax,Video_send_frameRateAvg:l?.aggregated?.frameRateAvg,Video_send_AllocateBWAvg:l?.aggregated?.bweAvg,Video_send_CameraOpenWidth:l?.extensions?.cameraOpenResolution?.width,Video_send_CameraOpenHeight:l?.extensions?.cameraOpenResolution?.height,Video_send_packetsLostRateMax:nB(l?.aggregated?.lossRateMax,6),Video_send_resolutionSwitches:JSON.stringify(l?.aggregated?.resolutionSwitches),Video_send_performanceEvents:n7(e.localVideoPerformanceEvents,n.numPerformanceEvents,"timestamp",e.startTime),Video_send_Simulcast:JSON.stringify(e.simulcast?.video),Video_send_powerEfficientEncoderEvents:n7(l?.extensions?.powerEfficientEncoderEvents,n.numPowerEfficientEncoderEvents,"timestamp",e.startTime),Video_send_powerEfficientEncoderEventOnCount:l?.extensions?.powerEfficientEncoderEventOnCount,Video_send_powerEfficientEncoderEventOffCount:l?.extensions?.powerEfficientEncoderEventOffCount,Video_send_qualityLimitationReasonEvents:n7(l?.extensions?.qualityLimitationEvents,n.numQualityLimitationEvents,"timestamp",e.startTime),Video_send_powerEfficientEncoderEventMismatchCount:l?.extensions?.powerEfficientEncoderEventMismatchCount,Sharing_recv_CodecReport:JSON.stringify(c?.aggregated?.codecReport),Sharing_recv_DurationSeconds:c?.aggregated?.duration,Sharing_recv_FreezeHistogram:JSON.stringify(c?.aggregated?.freezeCountHistogram),Sharing_recv_FreezeTimestamps:JSON.stringify(nX(c?.aggregated?.freezeTimestampsHistogram,e.startTime,n.numOfHistogramSamples)),Sharing_recv_LongestFreezeDuration:c?.aggregated?.longestFreeze,Sharing_recv_OngoingFreeze:c?.extensions?.isFrozen,Sharing_recv_OngoingFreezeDuration:c?.aggregated?.ongoingFreezeDuration,Sharing_recv_TotalFreezeDuration:c?.aggregated?.totalFreezeDuration,Sharing_recv_RecvAvgFreezeDuration:c?.aggregated?.avgFreezeDuration,Sharing_recv_NumResolutionSwitches:c?.aggregated?.numResolutionSwitches,Sharing_recv_ResolutionDurations:JSON.stringify(c?.aggregated?.resolutionDurations),Sharing_recv_StreamsMax:e.recvVideoStreamCount.max,Sharing_recv_StreamsMin:e.recvVideoStreamCount.min,Sharing_recv_StreamsMode:e.recvVideoStreamCount.mode,Sharing_recv_TimeToFirstFrame:e.remoteVideoManager?.firstTimeToFirstFrameSharing,Sharing_recv_TimeToFirstFrameSinceSubscriptionStart:e.remoteVideoManager?.timeToFirstFrameSinceSubscriptionStartSharing,Sharing_recv_bitrateAvg:c?.aggregated?.bitrateAvg,Sharing_recv_bitrateMax:c?.aggregated?.bitrateMax,Sharing_recv_frameRateAvg:c?.aggregated?.avgFrameRate,Sharing_recv_jitterBufferAvgSize:c?.aggregated?.avgJitterBufferSize,Sharing_recv_packetsLostRateMax:nB(c?.aggregated?.lossRateMax,6),Sharing_recv_FpsHarmonicAverage:c?.aggregated?.fpsHarmonicAverage,Sharing_recv_isRenderingEvents:JSON.stringify(nj(e.remoteVideoManager?.isRenderingEvents.sharing,n.numIsRenderingEvents)),Sharing_recv_PreferredResolution:e.remoteVideoManager?.preferredResolution.sharing?.toString(),Sharing_recv_PreferredResolutionDurations:JSON.stringify(e.remoteVideoManager?.preferredResolutionDurations.sharing),Sharing_recv_statsOnSubscribed:JSON.stringify(e.statsOnSubscribed.sharing),Sharing_SubscriptionEvents:JSON.stringify(nZ(e.subscriptionManager?.sharing.events,"ts",e.startTime)),Sharing_SubscriptionCounters:JSON.stringify(e.subscriptionManager?.sharing.counters),Sharing_send_CaptureFramerateAvg:d?.aggregated?.captureFramerateAvg,Sharing_send_DurationSeconds:d?.aggregated?.duration,Sharing_send_MaxCapabilities:JSON.stringify(p),Sharing_send_MaxCapabilitiesErrors:JSON.stringify(f),Sharing_send_OvershootDurations:JSON.stringify({fs:d?.aggregated?.totalFsOvershootDuration,fps:d?.aggregated?.totalFpsOvershootDuration,br:d?.aggregated?.totalBrOvershootDuration}),Sharing_send_resolutionSwitches:JSON.stringify(d?.aggregated?.resolutionSwitches),Sharing_send_OvershootEvents:n7(d?.aggregated?.overshootEvents,n.numOvershootEvents,"timestamp",e.startTime),Sharing_send_QpAvg:d?.aggregated?.qpAvg,Sharing_send_bitrateAvg:d?.aggregated?.bitrateAvg,Sharing_send_bitrateMax:d?.aggregated?.bitrateMax,Sharing_send_frameRateAvg:d?.aggregated?.frameRateAvg,Sharing_send_AllocateBWAvg:d?.aggregated?.bweAvg,Sharing_send_packetsLostRateMax:nB(d?.aggregated?.lossRateMax,6),Sharing_send_Simulcast:JSON.stringify(e.simulcast?.sharing),Sharing_send_RawInputVolume:n0(r.sharing?.send,e=>e.aggregated?.rawInputVolume),Sharing_send_qualityLimitationReasonEvents:n7(d?.extensions?.qualityLimitationEvents,n.numQualityLimitationEvents,"timestamp",e.startTime),multipleVideoStreams:JSON.stringify(nZ(e.multiViewStats,"startTime",e.startTime)),multipleAudioStreams:JSON.stringify(nZ(e.multipleAudioStats,"startTime",e.startTime)),ReportedReceiveBandwidth:JSON.stringify(e.reportedReceiveBandwidth),ReportedSendBandwidth:JSON.stringify(e.reportedSendBandwidthLayouts),OVC:JSON.stringify(P),EncodedStreamWorker:e.encodedStreamWorker,AudioCodecEvents:JSON.stringify(e.audioCodecEvents),HevcCodecSupport:JSON.stringify(e.codecSupport),MeetingScenario:JSON.stringify(e.negotiation.meetingScenario),IsTownHall:e.negotiation.isTownHall,IgnoredNonSctpDataChannel:e.negotiation.ignoredNonSctpDataChannel,IsPstnCall:e.isPstnCall,UsesMixer:e.usesMixer,InitialBWSeed:e.initialBWSeed,SentBWSeed:e.sentBWSeed,videoPerformanceEvent:JSON.stringify(e.videoPerformanceEvent),EarlyMedia_NumStatsPolls:e.earlyMediaNumStatsPolls,TimeToFirstAudioPacket:e.timeToFirstAudioPacket,FetchTimeMax:nB(e.fetchTimeMax,1),FetchTimeMedian:nB(e.fetchTimeMedian,1),LoopIntervalMax:nB(e.loopIntervalMax,1),LoopIntervalMedian:nB(e.loopIntervalMedian,1)})}var UL=e=>nP({id:e.outboundRTP.ssrc.toString(),codecName:e.codec?.mimeType?.split("/").pop().toUpperCase(),bitrate:e.extensions?.bitrate,jitter:e.remoteInboundRTP?.jitter,packets:e.outboundRTP.packetsSent,packetsPerSecond:e.extensions?.packetsPerSecond,packetsLost:e.remoteInboundRTP?.packetsLost,packetsLostPerSecond:e.extensions?.packetsLostPerSecond,rtt:e.remoteInboundRTP?.roundTripTime,frameRateInput:e.mediaSource?.framesPerSecond,frameWidthInput:e.mediaSource?.width,frameHeightInput:e.mediaSource?.height,framesEncoded:e.outboundRTP.framesEncoded,frameRateEncoded:e.extensions?.frameRateEncoded,framesSent:e.outboundRTP.framesSent,frameRateSent:e.extensions?.frameRateSent,frameWidthSent:e.outboundRTP.frameWidth,frameHeightSent:e.outboundRTP.frameHeight,keyFramesEncoded:e.outboundRTP.keyFramesEncoded,nackCount:e.outboundRTP.nackCount,firCount:e.outboundRTP.firCount,pliCount:e.outboundRTP.pliCount,transportId:e.outboundRTP.transportId,isFsOvershooting:e.extensions?.isFsOvershooting,isFpsOvershooting:e.extensions?.isFpsOvershooting,isBrOvershooting:e.extensions?.isBrOvershooting,totalFsOvershootDuration:e.extensions?.totalFsOvershootDuration,totalFpsOvershootDuration:e.extensions?.totalFpsOvershootDuration,totalBrOvershootDuration:e.extensions?.totalBrOvershootDuration,altLayouts:e.altLayouts?.map(UL)}),UF=e=>nP({id:e.inboundRTP.ssrc.toString(),codecName:e.codec?.mimeType?.split("/").pop().toUpperCase(),bitrate:e.extensions?.bitrate,jitter:e.inboundRTP.jitter,packets:e.inboundRTP.packetsReceived,packetsPerSecond:e.extensions?.packetsPerSecond,packetsLost:e.inboundRTP.packetsLost,packetsLostPerSecond:e.extensions?.packetsLostPerSecond,packetsDiscarded:e.inboundRTP.packetsDiscarded,rtt:e.remoteOutboundRTP?.roundTripTime,msi:e.renderer?.msi,jitterBufferMs:e.extensions?.jitterBufferMs,frameRateOutput:e.extensions?.frameRateDecoded,frameRateDecoded:e.extensions?.frameRateDecoded,frameRateReceived:e.extensions?.frameRateReceived,frameWidthReceived:e.inboundRTP.frameWidth,frameHeightReceived:e.inboundRTP.frameHeight,longestFreezeDuration:e.extensions?.longestFreeze,totalFreezeDuration:e.extensions?.totalFreezeDuration,framesReceived:e.inboundRTP.framesReceived,framesDropped:e.inboundRTP.framesDropped,framesDecoded:e.inboundRTP.framesDecoded,keyFramesDecoded:e.inboundRTP.keyFramesDecoded,nackCount:e.inboundRTP.nackCount,firCount:e.inboundRTP.firCount,pliCount:e.inboundRTP.pliCount,transportId:e.inboundRTP.transportId}),UU=e=>nP({id:e.outboundRTP.ssrc.toString(),codecName:e.codec?.mimeType?.split("/").pop().toUpperCase(),bitrate:e.extensions?.bitrate,jitter:e.remoteInboundRTP?.jitter,packets:e.outboundRTP.packetsSent,packetsPerSecond:e.extensions?.packetsPerSecond,packetsLost:e.remoteInboundRTP?.packetsLost,packetsLostPerSecond:e.extensions?.packetsLostPerSecond,packetsDiscarded:e.remoteInboundRTP?.packetsDiscarded,rtt:e.remoteInboundRTP?.roundTripTime,audioLevel:e.mediaSource?.audioLevel,transportId:e.outboundRTP.transportId}),U$=e=>nP({id:e.inboundRTP.ssrc.toString(),codecName:e.codec?.mimeType?.split("/").pop().toUpperCase(),bitrate:e.extensions?.bitrate,jitter:e.inboundRTP.jitter,packets:e.inboundRTP.packetsReceived,packetsPerSecond:e.extensions?.packetsPerSecond,packetsLost:e.inboundRTP.packetsLost,packetsLostPerSecond:e.extensions?.packetsLostPerSecond,packetsDiscarded:e.inboundRTP.packetsDiscarded,rtt:e.remoteOutboundRTP?.roundTripTime,jitterBufferMs:e.extensions?.jitterBufferMs,audioLevel:e.inboundRTP.audioLevel,healedRatio:e.extensions?.healedRatio,transportId:e.inboundRTP.transportId}),UV=e=>nP({id:e.id,state:e.state,dataChannelIdentifier:e.dataChannelIdentifier,messagesSent:e.messagesSent,bytesSent:e.bytesSent,messagesReceived:e.messagesReceived,bytesReceived:e.bytesReceived,sendBitrate:e.extensions?.sendBitrate,recvBitrate:e.extensions?.recvBitrate,messagesSentPerSecond:e.extensions?.sendMessageRate,messagesReceivedPerSecond:e.extensions?.recvMessageRate}),UB=e=>nP({id:e.id,rtt:e.selectedCandidatePair?.currentRoundTripTime,availableIncomingBitrate:e.selectedCandidatePair?.availableIncomingBitrate,availableOutgoingBitrate:e.selectedCandidatePair?.availableOutgoingBitrate,relayProtocol:e.selectedCandidatePair?.localCandidate?.relayProtocol,candidateType:`${e.selectedCandidatePair?.localCandidate?.candidateType??""}:${e.selectedCandidatePair?.remoteCandidate?.candidateType??""}`});function UH(e){return(e.audio?.send??[]).map(UU)}function Uj(e){return(e.audio?.recv??[]).map(U$)}function Uq(e){return e.video?.send?.length?e.video.send.map(UL):[]}function UW(e){return(e.video?.recv??[]).map(UF)}function UG(e){return e.sharing?.send?.length?e.sharing.send.map(UL):[]}function Uz(e){return(e.sharing?.recv??[]).map(UF)}function UJ(e){return(e.data??[]).map(UV)}function UK(e){return Object.values(e.transports??{}).map(UB)}function UQ(e){let t=UH(e),i=Uj(e),n=Uq(e),r=UW(e),s=UG(e),a=Uz(e);return{audio:{send:t,recv:i},video:{send:n,recv:r},screenShare:{send:s,recv:a},data:UJ(e),transports:UK(e)}}function UY(e,t){let i=e.qualityManager&&nj(nw(e.qualityManager.videoMaxCapabilitiesEvents),t.config.diagnostics.telemetryLimits.numCapabilitiesRequested),n=e.qualityManager&&nj(nw(e.qualityManager.sharingMaxCapabilitiesEvents),t.config.diagnostics.telemetryLimits.numCapabilitiesRequested);return nP({Video_SubscriptionEvents:JSON.stringify(e.subscriptionManager?.video.events),Sharing_SubscriptionEvents:JSON.stringify(e.subscriptionManager?.sharing.events),Video_send_MaxCapabilities:JSON.stringify(i),Sharing_send_MaxCapabilities:JSON.stringify(n),RelayCandidate:e.relayCandidate,Video_recv_TimeToFirstFrame:e.remoteVideoManager?.firstTimeToFirstFrameVideo,Sharing_recv_TimeToFirstFrame:e.remoteVideoManager?.firstTimeToFirstFrameSharing,Video_recv_TimeToFirstFrameSinceSubscriptionStart:e.remoteVideoManager?.timeToFirstFrameSinceSubscriptionStartVideo,Sharing_recv_TimeToFirstFrameSinceSubscriptionStart:e.remoteVideoManager?.timeToFirstFrameSinceSubscriptionStartSharing,IceServers:e.iceServers})}function UZ(e,t,i){return nP({DeviceEvents:JSON.stringify(nZ(i.deviceManager.deviceTelemetryEvents.filter(e=>e.timestamp>t),"timestamp",e.creationTime)),IceConnectedStateTime:1e4*e.iceConnectedStateTime})}function UX(e,t,i,n){let r=n.config.diagnostics.telemetryLimits,s=e.webrtcSessions[e.webrtcSessions.length-1];return nP({MediaLegId:e.mediaLegId,CreationTime:U0(e.creationTime),CallNumber:e.callNumber,SessionId:e.sessionId,MultiParty:e.isMultiParty,ErrorType:e.error?.type??"none",ErrorDetail:t$(e.error?.detail||e.error)??"none",IncompatibleOffer:e.error?.type===nu.MEDIA_ERROR.incompatibleOffer,TerminationTime:U0(e.terminationTime),TerminationReason_code:e.terminationReason?.code,TerminationReason_subCode:e.terminationReason?.subCode,TerminationReason_phrase:e.terminationReason?.phrase,TerminationReason_remoteTerminated:e.terminationReason?.remoteTerminated,TerminationReason_clientReasonPhrase:e.terminationReason?.clientReasonPhrase,TerminationReason_clientReasonSubCode:e.terminationReason?.clientReasonSubCode,TerminationReason_resultCategories:JSON.stringify(e.terminationReason?.resultCategories),CallDuration:U0(e.duration),IceInitTime:U0(e.iceInitTime),IceConnectedStateTime:U0(e.iceConnectedStateTime),NegotiationCount:e.negotiationCount,RejectedNegotiationCount:e.rejectedNegotiationCount,InitialNegotiationCompleted:e.initialNegotiationCompleted,InitialNegotiationType:e.initialNegotiationType,FinalAnswerTime:U0(e.finalAnswerTime),TransportReconnectedCount:e.transportReconnectedCount,RollbackNegotiation:JSON.stringify(e.rollbackNegotiation),Relay:e.relay?JSON.stringify(e.relay):void 0,ActiveModalities:JSON.stringify(e.activeModalities),AllowedAudioSend:e.allowedAudioSend,AllowedVideoSend:e.allowedVideoSend,AllowedScreensharingSend:e.allowedScreensharingSend,RelayManager:JSON.stringify(e.relayTimers),AuthTokenStats:JSON.stringify(e.authTokenFetcherStats),CallMutedRatio:e.callMutedRatio,CallOsMuted:U0(e.callOsMuted),CallHwSilent:U0(e.callHwSilent),CallSwMuted:U0(e.callSwMuted),CallSpeakerMuted:U0(e.callSpeakerMuted),CallIsSpeaking:U0(e.callIsSpeaking),DtmfSuccess:e.dtmfSuccessCount,DtmfFailure:e.dtmfFailureCount,ContributingSourcesError:s.contributingSourcesError,ReconnectInProgress:e.reconnect?.isReconnecting,RetargetIncomingCount:e.reconnect?.retargetCount.incoming,RetargetOutgoingCount:e.reconnect?.retargetCount.outgoing,RetargetCompletedCount:e.reconnect?.retargetCount.completed,RetargetRejectedCount:e.reconnect?.retargetCount.rejected,EscalationAttemptedCount:e.reconnect?.escalationCount.attempted,EscalationCompletedCount:e.reconnect?.escalationCount.completed,EscalationRejectedCount:e.reconnect?.escalationCount.rejected,Elevation:JSON.stringify(e.elevation),ReconnectAttemptedCount:e.reconnect?.reconnectCount.attempted,ReconnectConnectedCount:e.reconnect?.reconnectCount.connected,ReconnectAttempts:n7(e.reconnect?.records,r.numReconnects,"startTime",e.creationTime),NetworkEvents:n7(e.reconnect?.tmpRecords,r.numNetworkEvents,"startTime",e.creationTime),NoIceCandidatesGoodEventCount:e.noIceCandidatesEventCount.good,NoIceCandidatesBadEventCount:e.noIceCandidatesEventCount.bad,NoRelayIceCandidatesGoodEventCount:e.noRelayIceCandidatesEventCount.good,NoRelayIceCandidatesBadEventCount:e.noRelayIceCandidatesEventCount.bad,MicrophoneInUseGoodEventCount:e.microphoneInUseEventCount.good,MicrophoneInUseBadEventCount:e.microphoneInUseEventCount.bad,CameraInUseGoodEventCount:e.cameraInUseEventCount.good,CameraInUseBadEventCount:e.cameraInUseEventCount.bad,CameraFreezeStartEventCount:e.cameraFreezeEventCount.start,CameraFreezeEndEventCount:e.cameraFreezeEventCount.end,NetworkRecvGood:e.networkRecvUFD.good,NetworkRecvGoodRatio:e.networkRecvUFD.goodRatio,NetworkRecvPoor:e.networkRecvUFD.poor,NetworkRecvPoorRatio:e.networkRecvUFD.poorRatio,NetworkRecvBad:e.networkRecvUFD.bad,NetworkRecvBadRatio:e.networkRecvUFD.badRatio,NetworkSendGood:e.networkSendUFD.good,NetworkSendGoodRatio:e.networkSendUFD.goodRatio,NetworkSendPoor:e.networkSendUFD.poor,NetworkSendPoorRatio:e.networkSendUFD.poorRatio,NetworkSendBad:e.networkSendUFD.bad,NetworkSendBadRatio:e.networkSendUFD.badRatio,Connection_Downlink:n0(s.networkInfo,e=>e.downlink),Connection_EffectiveType:s.networkInfo.map(e=>e.effectiveType).filter(e=>e).join(","),Connection_Rtt:n0(s.networkInfo,e=>e.rtt),Connection_SaveData:nG(s.networkInfo)?.saveData,RawOutputAudioAccessAttempted:e.rawMedia.audio.recv.numAttempts,RawOutputAudioAccessDurationRatio:e.rawMedia.audio.recv.durationRatio,RawInputAudioOverrideAttempted:e.rawMedia.audio.send.numAttempts,RawInputAudioOverrideDurationRatio:e.rawMedia.audio.send.durationRatio,ZeroCaptureDevicesEnumeratedEventRatio:nB(e.zeroCaptureDevicesRatio,nu.NATIVE_RATIO_PRECISION),ZeroRenderDevicesEnumeratedEventRatio:nB(e.zeroRenderDevicesRatio,nu.NATIVE_RATIO_PRECISION),DeviceCaptureNotFunctioningEventRatio:nB(e.deviceCaptureFailuresRatio,nu.NATIVE_RATIO_PRECISION),DeviceRenderNotFunctioningEventRatio:nB(e.deviceRenderFailuresRatio,nu.NATIVE_RATIO_PRECISION),UFDs:n7(e.ufds,r.numUFDs,"timestamp",e.creationTime),remoteUFDs:n7(e.remoteUfds,r.numUFDs,"timestamp",e.creationTime),UFDs_count:JSON.stringify(e.ufdManager.count),remoteUFDs_count:JSON.stringify(e.remoteUfdsCount),MediaQosEnabled:i.configuration.mediaConfig?.enableMediaQoS??!1,PortRangeConfigured:!!i.configuration.mediaConfig?.mediaPortRanges,hardwareConcurrency:i.configuration.userAgentConfig.hardwareConcurrency,ETag:i.configuration.ETag,ConfigIds:i.configuration.configIds,GPUName:i.configuration.userAgentConfig.unmaskedGlRenderer,PermissionStates:JSON.stringify(i.deviceManager.permissionStates),DeviceList:JSON.stringify(i.deviceManager.deviceList),DeviceListDebug:JSON.stringify(i.deviceManager.deviceDebugStrings),DevicesChangeCount:e.deviceManager.devicesChangeCount,DevicesPollChangeCount:e.deviceManager.devicesPollChangeCount,DeviceSelectionChangeCount:e.deviceManager.deviceSelectionChangeCount,DeviceSelectionChangeFromInterfaceCount:e.deviceManager.deviceSelectionChangeCountFromInterface,DevicesCount:JSON.stringify(i.deviceManager.devicesCount),UsedMicrophone:i.deviceManager.usedDevices?.microphone,UsedSpeaker:i.deviceManager.usedDevices?.speaker,UsedCamera:i.deviceManager.usedDevices?.camera,DeviceEvents:n7(i.deviceManager.deviceTelemetryEvents.filter(e=>e.timestamp>t),r.numDeviceEvents,"timestamp",e.creationTime),VideoEffects:n7(i.deviceManager.videoEffectsEvents.filter(e=>e.timestamp>t),r.numVideoEffectsEvents,"timestamp",e.creationTime),AudioEffects:n7(i.deviceManager.audioEffectsEvents.filter(e=>e.timestamp>t),r.numAudioEffectsEvents,"timestamp",e.creationTime),WorkerEvents:n7(i.deviceManager.workerEvents.filter(e=>e.timestamp>t),r.numWorkerEvents,"timestamp",e.creationTime),MediaByPassEnabled:!!i.configuration.mediaConfig.enableMediaBypass,CallConstraints:JSON.stringify(e.callConstraints),DominantSpeaker:JSON.stringify(U1(e.dominantSpeaker,e.terminationTime)),AudioSourceNumOfReopenRequests:e.deviceManager.audioSourceNumOfReopenRequests||void 0,AudioSourceNumOfSuccessfulReopens:e.deviceManager.audioSourceNumOfSuccessfulReopens||void 0,AudioCaptureErrorCodeFlagsInit:e.deviceManager.audioCaptureDeviceErrorFlag,AudioRenderErrorCodeFlagsInit:e.deviceManager.audioRenderDeviceErrorFlag,AudioSinkNumOfReopenRequests:e.audioRenderer.sinkNumOfReopenRequests,AudioSinkNumOfSuccessfulReopens:e.audioRenderer.sinkNumOfSuccessfulReopens,CallSetupTimeTracker:JSON.stringify(e.webrtcSessions[0].negotiation.callSetupTimeReport),LastSessionSetupTimeTracker:e.webrtcSessions.length>1?JSON.stringify(s.negotiation.callSetupTimeReport):void 0,BatteryLevel:e.batteryLevel,BrowserFingerprint:JSON.stringify(is.getBrowserFingerprint()),MediaLeaks:JSON.stringify(e.mediaLeaks)})}function U0(e){return 1e4*e}function U1(e,t=Number(new Date)){if(!e)return;let i=nw(e);return e.lastMsgDate&&(e.timeSinceLastMsg=e.lastMsgDate-t),delete i.lastMsgDate,delete i.lastHistory,nP(i)}function U2(e,t,i=0){let n,r=t.filter(e=>void 0!==e);switch(e){case"Difference":n=r[r.length-1]-r[0];break;case"Average":n=r.reduce((e,t)=>e+t,0)/r.length;break;case"LastValue":n=r[r.length-1]}return n||0===n?`${"number"==typeof n?+n.toFixed(i):n}`:void 0}function U3(e,t,i){return(i?e.map(e=>e?.[t]?.[i]):e.map(e=>e?.[t])).filter(e=>void 0!==e).reduce((e,t)=>e.concat(t),[])}function U4(e){let t=e.find(e=>e?.transports);return t?t.transports[Object.keys(t.transports)[0]]:void 0}function U5(e){let t=e[e.length-1]?.extensions?.powerEfficient;return void 0===t?"":t?"hw":"sw"}function U6(e,t){return e&t?"Bidirectional":e?"ReceiveFromPeer":t?"SendToPeer":"Inactive"}function U8(e){let t=e[e.length-1]?.extensions?.callIsMuted,i=e[e.length-1]?.extensions?.rawInputVolume;return t?"0":!t&&i>0?"2":t||0!==i?void 0:"1"}function U9(e,t){let i=U3(e,"audio","send"),n=U3(e,"audio","recv"),r=U4(e);if(i.length||n.length)return nP({mediaType:"Audio",mediaDirection:U6(n.length,i.length),"Received BW estimate":U2("Average",n.map(e=>e?.transport?.selectedCandidatePair?.availableIncomingBitrate)),"Recv Loss Rate (Avg)":U2("LastValue",n.map(e=>e?.extensions?.lossRate/100),3),"Rtp Packets Received":U2("Difference",n.map(e=>e?.inboundRTP.packetsReceived)),"Rtp Packet Sent":U2("Difference",i.map(e=>e?.outboundRTP.packetsSent)),"Sent BW estimate":U2("Average",i.map(e=>e?.transport?.selectedCandidatePair?.availableOutgoingBitrate)),"Send Audio Codec":U2("LastValue",i.map(e=>e?.codec?.mimeType))?.split("/").pop(),"Send RTT (Avg)":U2("LastValue",i.map(e=>e?.extensions?.rttAvg)),"Audio NW jitter avg":U2("LastValue",n.map(e=>e?.extensions?.jitterAvg),3),"Audio send bps":U2("Average",i.map(e=>e?.extensions?.bitrate)),"JB delay (ms)":U2("LastValue",n.map(e=>e?.extensions?.jitterBufferDelayMs)),"Recv Audio Codec":U2("LastValue",n.map(e=>e?.codec?.mimeType))?.split("/").pop(),"Current Render Device Name":t?.speaker,"Current Capture Device Name":t?.microphone,"Latest Network Type":r?.selectedCandidatePair?.localCandidate?.networkType,"Latest Transport Protocol":r?.selectedCandidatePair?.localCandidate?.protocol,"Latest Reflexive Address":vg(r?.extensions?.reflexiveLocalIP),"Local Address":vg(r?.selectedCandidatePair?.localCandidate?.ip),"Local short-term Healed Data Ratio":U2("LastValue",n.map(e=>e?.extensions?.healedRatio)),"Send activity (0=muted; 1=inactive; 2=active)":U8(i)})}function U7(e){let t={},i=i=>{e.map(e=>e?.video?.[i]).forEach(e=>{e?.forEach(e=>{var n;let r=e?.mediaEntity?.remoteSsrc;t[r]??(t[r]={}),(n=t[r])[i]??(n[i]=[]),t[r][i].push(e)})})};return i("recv"),i("send"),t}function $e(e,t){let i=[];for(let{send:n,recv:r}of Object.values(U7(e))){let e={mediaType:"Camera",mediaDirection:U6(r?.length,n?.length)};r&&(e={...e,...$i(r)}),n&&(e={...e,...$t(n,t)}),i.push(nP(e))}return i}function $t(e,t){let i=U2("LastValue",e.map(e=>e?.codec?.mimeType))?.split("/").pop(),n=i?i+` ${U5(e)}`:void 0;return{"Rtp Packet Sent":U2("Difference",e.map(e=>e?.outboundRTP.packetsSent)),"Sent BW estimate":U2("Average",e.map(e=>e?.transport?.selectedCandidatePair?.availableOutgoingBitrate)),"Send Current Bitrate":U2("Average",e.map(e=>e?.extensions?.bitrate)),"Allocated Send Bandwidth Average":U2("LastValue",e.map(e=>e?.extensions?.bitrateAvg)),"Send Actual Height":U2("LastValue",e.map(e=>e?.outboundRTP.frameHeight)),"Send Actual Width":U2("LastValue",e.map(e=>e?.outboundRTP.frameWidth)),"Send Current Frame Rate":U2("Average",e.map(e=>e?.extensions?.frameRateSent)),"Send RTT (Avg)":U2("LastValue",e.map(e=>e?.extensions?.rttAvg)),"Sent Codec Name":n,"Webcam Freeze Intervals":U2("LastValue",e.map(e=>e?.extensions?.captureFreezeIntervalsCount)),"Current Capture Device Name":t?.camera,"Number of Sync Frame Request per Minute":U2("LastValue",e.map(e=>e?.extensions?.pliRate))}}function $i(e){let t=U2("LastValue",e.map(e=>e?.mediaEntity?.xSourceStreamId)),i=U2("LastValue",e.map(e=>e?.codec?.mimeType))?.split("/").pop(),n=i?i+` ${U5(e)}`:void 0;return{"Recv Loss Rate (Avg)":U2("LastValue",e.map(e=>e?.extensions?.lossRate),3),"Received BW estimate":U2("Average",e.map(e=>e?.transport?.selectedCandidatePair?.availableIncomingBitrate)),"Receive Current Bitrate":U2("Average",e.map(e=>e?.extensions?.bitrate)),"Rtp Packets Received":U2("Difference",e.map(e=>e?.inboundRTP.packetsReceived)),"Receive Actual Height":U2("LastValue",e.map(e=>e?.inboundRTP.frameHeight)),"Receive Actual Width":U2("LastValue",e.map(e=>e?.inboundRTP.frameWidth)),"Receive Current Frame Rate":U2("Average",e.map(e=>e?.extensions?.frameRateReceived)),"Received Codec Name":n,"Received Total Freeze Fraction (ms per min)":U2("LastValue",e.map(e=>e?.extensions?.totalFreezeFraction)),videoSourceId:t?parseInt(t):void 0,"Received Fps Time Weighted Harmonic Average":U2("LastValue",e.map(e=>e?.extensions?.fpsHarmonicAverage))}}function $n(e){let t=U3(e,"sharing","send"),i=U3(e,"sharing","recv");if(!i.length&&!t.length)return;let n={mediaType:"AppSharing",mediaDirection:"Bidirectional","Render Device Name":""};return i.length&&(n={...n,...$i(i)}),t.length&&(n={...n,...$t(t,{microphone:void 0,camera:"Screen sharing",speaker:void 0})}),nP(n)}function $r(e,t,i){let n=U9(e,t);n&&i.channels.push(n);let r=$e(e,t);r.length&&i.channels.push(...r);let s=$n(e);s&&i.channels.push(s)}function $s(e,t){let i=U3(e,"inactiveTracks"),n={channels:[]};return $r(e,t,n),i.length&&$r(i,void 0,n),n}function $a(e,t,i,n,r){return{recv:nP({id:i?.inboundRTP.id,ssrc:i?.inboundRTP.ssrc,mediaType:i?.inboundRTP.mediaType??i?.inboundRTP.kind,bytes:n1(t[e]?.recv,e=>e.inboundRTP.bytesReceived,r),packets:n1(t[e]?.recv,e=>e.inboundRTP.packetsReceived,r),packetsLost:n1(t[e]?.recv,e=>e.inboundRTP.packetsLost,r),codec:i?.codec?.mimeType.split("/").pop(),codecReport:i?.aggregated?.codecReport,framesDecoded:n1(t[e]?.recv,e=>e.inboundRTP.framesDecoded,r),height:n1(t[e]?.recv,e=>e.inboundRTP.frameHeight,r),width:n1(t[e]?.recv,e=>e.inboundRTP.frameWidth,r),frameRate:n1(t[e]?.recv,e=>e.extensions?.frameRateReceived,r)}),send:nP({id:n?.outboundRTP.id,ssrc:n?.outboundRTP.ssrc,mediaType:n?.outboundRTP.mediaType??n?.outboundRTP.kind,bytes:n1(t[e]?.send,e=>e.outboundRTP.bytesSent,r),packets:n1(t[e]?.send,e=>e.outboundRTP.packetsSent,r),packetsLost:n1(t[e]?.send,e=>e.remoteInboundRTP?.packetsLost,r),codec:n?.codec?.mimeType.split("/").pop(),framesEncoded:n1(t[e]?.send,e=>e.outboundRTP.framesEncoded,r),heightInput:n?.mediaSource?.height,widthInput:n?.mediaSource?.width,height:n1(t[e]?.send,e=>e.outboundRTP.frameHeight,r),width:n1(t[e]?.send,e=>e.outboundRTP.frameWidth,r),frameRate:n1(t[e]?.send,e=>e.extensions?.frameRateSent,r)})}}function $o(e,t,i,n){return{recv:nP({id:t?.inboundRTP.id,ssrc:t?.inboundRTP.ssrc,mediaType:t?.inboundRTP.mediaType??t?.inboundRTP.kind,bytes:n1(e.audio?.recv,e=>e.inboundRTP.bytesReceived,n),packets:n1(e.audio?.recv,e=>e.inboundRTP.packetsReceived,n),packetsLost:n1(e.audio?.recv,e=>e.inboundRTP.packetsLost,n),codec:t?.codec?.mimeType.split("/").pop(),audioLevel:n1(e.audio?.recv,e=>Math.floor(65535*e.inboundRTP.audioLevel),n)}),send:nP({id:i?.outboundRTP.id,ssrc:i?.outboundRTP.ssrc,mediaType:i?.outboundRTP.mediaType??i?.outboundRTP.kind,bytes:n1(e.audio?.send,e=>e.outboundRTP.bytesSent,n),packets:n1(e.audio?.send,e=>e.outboundRTP.packetsSent,n),packetsLost:n1(e.audio?.send,e=>e.remoteInboundRTP?.packetsLost,n),codec:i?.codec?.mimeType.split("/").pop(),audioLevel:n1(e.audio?.send,e=>Math.floor(65535*e.aggregated.audioLevel),n)})}}function $l(e){return nP({negotiationCount:e.negotiationCount,rejectedNegotiationCount:e.rejectedNegotiationCount})}function $c(e,t,i,n,r){let s=e.aggregatedModalityStats,a=nG(s.audio?.recv),o=nG(s.audio?.send),l=nG(s.video?.recv),c=nG(s.video?.send),d=nG(s.sharing?.recv),u=nG(s.sharing?.send),h=[],g=[];return e.statsOnSubscribed.video?.forEach(e=>h.push(e)),e.statsOnSubscribed.sharing?.forEach(e=>g.push(e)),nP({multipleVideoStreams:e.multiViewStats,multipleAudioStreams:e.multipleAudioStats,WebRTCStats_ssrc:nP({audio:$o(s,a,o,r),video:$a("video",s,l,c,r),sharing:$a("sharing",s,d,u,r),negotiationStats:$l(t)}),CallSwMuted:1e3*t.callSwMuted,DeviceEvents:nZ(i.deviceManager.deviceTelemetryEvents.filter(e=>e.timestamp>n),"timestamp",t.creationTime),VideoEffects:nZ(i.deviceManager.videoEffectsEvents.filter(e=>e.timestamp>n),"timestamp",t.creationTime),AudioEffects:nZ(i.deviceManager.audioEffectsEvents.filter(e=>e.timestamp>n),"timestamp",t.creationTime),statsErrors:t.statsErrors,WorkerEvents:nZ(i.deviceManager.workerEvents.filter(e=>e.timestamp>n),"timestamp",t.creationTime),transportState:e.transportState})}var $d=class{constructor(e,t){this.rootRef=e,this.configProvider=t}get rawRootRef(){return this.rootRef}getSessionTelemetry(e){let t=this.getLatestSession(e);if(!t)return;let i={metrics:{},Extensions:{}},n=nQ();try{let e=t.callNumber>1?this.rootRef.sessions.find(e=>t.callNumber-1===e.callNumber):void 0,n=e?.terminationTime??0,r=t.webrtcSessions[t.webrtcSessions.length-1];i.metrics=UX(t,n,this.rootRef,this.configProvider),i.Extensions=Ux(r,this.configProvider,t.statsErrors)}catch(e){t[U_].addStatsError("DiagnosticsReport:getSessionTelemetry",t$(e)),i.Extensions.WebRTCStats_statsErrors=JSON.stringify(t.statsErrors)}return i.metrics.ReportGenerationTimeMs=nB(nQ()-n),i}getTeamsRealtimeTelemetry(e){let t=this.getLatestSession(e);if(t)try{let e=t.webrtcSessions[t.webrtcSessions.length-1],i=this.configProvider.config.diagnostics.teamsRealtimeTelemetry.pollingInterval,n=e.statsReports.slice(e.statsReports.length-i);return $s(n,this.rootRef.deviceManager.rawUsedDevices)}catch(e){throw t[U_].addStatsError("DiagnosticsReport:getRealTimeTelemetry",t$(e)),e}}getMediaSessionStats(e){let t=this.getLatestSession(e);if(t)try{let e=t.callNumber>1?this.rootRef.sessions.find(e=>t.callNumber-1===e.callNumber):void 0,i=e?.terminationTime??0,n=t.webrtcSessions[t.webrtcSessions.length-1],r=n?.statsReports.length?n.statsReports[n.statsReports.length-1]:void 0,s=r?UQ(r):void 0;return s&&(s.extensions=UY(n,this.configProvider),s.metrics=UZ(t,i,this.rootRef)),s}catch(e){throw t[U_].addStatsError("DiagnosticsReport:getMediaSessionStats",t$(e)),e}}getDiagnosticsForE2eTests(e){let t=this.getLatestSession(e),i={statsErrors:[]};if(t){try{let e=t.webrtcSessions[t.webrtcSessions.length-1],n=t.callNumber>1?this.rootRef.sessions.find(e=>t.callNumber-1===e.callNumber):void 0,r=n?.terminationTime??0;i=$c(e,t,this.rootRef,r,this.configProvider.config.diagnostics.collectionLimits.numSamplesForE2E)}catch(r){let e="DiagnosticsReport:getDiagnosticsForE2eTests",n=t$(r);t[U_].addStatsError(e,n),nq(i.statsErrors,{origin:e,error:n,count:1},this.configProvider.config.diagnostics.collectionLimits.numStatsErrors)}return i}}getLatestSession(e){return this.rootRef.sessions.filter(t=>t.sessionId===e).sort((e,t)=>e.callNumber-t.callNumber).pop()}},$u=class{constructor(e,t,i){this.configProvider=e,this.deviceManagerDiagnostics=t,this.ufdManagerDiagnostics=i,this.root={creationTime:Date.now(),numTotalSessions:0,deviceManager:this.deviceManagerDiagnostics.getObjectRef(),ufdManager:this.ufdManagerDiagnostics.getObjectRef(),configuration:{stackConfig:this.configProvider.stackConfig,defaultConfig:this.configProvider.defaultConfig,mediaConfig:{},userAgentConfig:{isAudioOutputSelectionSupported:this.configProvider.userAgentConfig.isAudioOutputSelectionSupported,hardwareConcurrency:v$.hardwareConcurrency,unmaskedGlRenderer:v$.unmaskedGlRenderer,hasMediaApi:v$.hasMediaApi(),hasCapabilitiesApi:v$.hasCapabilitiesApi()},consoleOverrides:this.configProvider.consoleOverrides,fullConfig:nw(this.configProvider.config),ecsConfigUpdates:[],ETag:"",configIds:""},browserInfo:is.getBrowserInfo(),sessions:[]},this.diagnosticsReport=new $d(this.root,this.configProvider),this.configProvider.on("newConfigReceived",(e,t,i)=>{this.root.configuration.ecsConfigUpdates.push({timestamp:Date.now(),etag:t,configIds:i,config:e})}),this.configProvider.on("configUpdated",()=>{this.root.configuration.consoleOverrides=this.configProvider.consoleOverrides,this.root.configuration.fullConfig=nw(this.configProvider.config),this.root.configuration.ETag=this.configProvider.ETag,this.root.configuration.configIds=this.configProvider.ecsConfigIds})}get reportGenerator(){return this.diagnosticsReport}get rootRef(){return this.root}set mediaConfig(e){this.root.configuration.mediaConfig=e}newSession(e,t,i){let n=new UI(i,e,this.diagnosticsReport,this.root.deviceManager,this.root.ufdManager,++this.root.numTotalSessions,t);return nq(this.root.sessions,n.getObjectRef(),this.configProvider.config.diagnostics.collectionLimits.numSessions),n}},$h=class e{constructor(e,t){this.safe=e,this.unsafe=t,this.safe||(this.safe=this.unsafe)}warn(...e){this.unsafe.warn(...e)}error(...e){this.unsafe.error(...e)}debug(...e){this.unsafe.debug(...e)}info(...e){this.unsafe.info(...e)}createChild(t){return new e(this.safe.createChild(t),this.unsafe.createChild(t))}},$g=i(892891),$p=class{constructor(e){this.logger=e,this.extensionId="nkeimhogjdpnpccoofpliimaahmaaome",this.editorExtensionId="ncbjelpjchkpbikbpkcchkhkblodoama",this.logId="TeamsWebRTCLogs",this.loggingState="unknown",this.connectionCount=0,window.webRtcInternalsCollector=this}get isExtensionAvailable(){return"unavailable"!==this.loggingState}async updateSessionCount(e){this.isExtensionAvailable&&(0===this.connectionCount&&1===e?("stopped"===this.loggingState&&await this.discardLogs(),await this.initialStartLogging()):0===e&&await this.stopLogging(),this.connectionCount=e)}async collect(){return this.isExtensionAvailable?this.collectPromise?this.collectPromise:this.collectPromise=new Promise(async e=>{try{this.connectionCount>0&&(this.logger.safe.info(`Stopping logger for gathering, open connections: ${this.connectionCount}`),await this.stopLogging()),await this.storeLogs();let t=await this.gatherFromStorage();this.connectionCount>0&&await this.continueLogging(),e(t.length>0?t.join("\r\n"):"")}catch(t){this.logger.safe.error("Error while collecting logs",t),e(JSON.stringify(t))}this.collectPromise=void 0}):""}async initialStartLogging(){try{await this.startLogging()}catch(e){if(e?.includes("A log is already open"))try{let t=e.match(/State=(\w+)/);await this.cleanState(t?.[1]),await this.startLogging()}catch(e){this.logger.safe.error("Error while starting logging at cleanup phase",e),this.loggingState="unknown"}else this.logger.safe.error("Error while starting logging",e),this.loggingState="unavailable"}}async continueLogging(){try{await this.startLogging()}catch(e){this.logger.safe.error("Error while continuing logging",e),this.loggingState="stopped"}}async startLogging(){await this.sendMessage(this.extensionId,{method:"logging.start"}),this.logger.safe.info("Logging started"),this.loggingState="started"}async cleanState(e){try{if("started"===e)await this.stopLogging(),await this.discardLogs();else if("stopped"===e)await this.discardLogs();else throw Error(`Unexpected logging state: ${e}`)}catch(e){this.logger.safe.error("Error while cleaning state",e)}}async stopLogging(){try{await this.sendMessage(this.extensionId,{method:"logging.stop"}),this.logger.safe.info("Logging stopped"),this.loggingState="stopped"}catch(e){this.logger.safe.error("Error while stopping logging",e)}}async discardLogs(){try{await this.sendMessage(this.extensionId,{method:"logging.discard"}),this.logger.safe.info("Logs discarded"),this.loggingState="closed"}catch(e){this.logger.safe.error("Error while discarding logs",e)}}async storeLogs(){try{await this.sendMessage(this.extensionId,{method:"logging.store",logId:this.logId}),this.logger.safe.info(`Logs stored to ${this.logId}`),this.loggingState="closed"}catch(e){this.logger.safe.error("Error while storing logs",e)}}async gatherFromStorage(){let e=[],t={offset:0};do e.push((t=await this.sendMessage(this.editorExtensionId,{api:"getWebRtcLog",logId:this.logId,offset:t.offset})).data),this.logger.safe.info(`Batch gathered with offset: ${t.offset}, moreData: ${t.moreData}`);while(t.moreData);return this.logger.safe.info("Finished gathering"),e}sendMessage(e,t){return new Promise((i,n)=>{let r=chrome.runtime;r.sendMessage(e,t,e=>{if(!e||e?.error){let i=e?JSON.stringify(e.error):r.lastError;n(`sendMessage ${JSON.stringify(t)} failed with error: ${i}`)}i(e)})})}},$f=(()=>{let e;return{getInstance:function(t,i){return i.config.enableWebRtcInternalsLogs&&is.isBrowser("Edge")&&chrome?.runtime?(e||(e=new $p(t)),e):(t.safe.info("WebRTC internal logging is disabled"),{collect:()=>Promise.resolve(""),updateSessionCount:()=>Promise.resolve()})}}})(),$m=class{getId(){return 0}getDeviceId(){return nu.EMPTY_DEVICE_ID}getPreviewAsync(e,t){return Promise.resolve(null)}getDescription(){return"display"}getType(){return 1}getIcon(e,t){return Promise.resolve(null)}},$v=class{constructor(e){this.descr=e}getId(){return 0}getDeviceId(){return this.descr.browserId}getPreviewAsync(e,t){return Promise.resolve(null)}getDescription(){return this.descr.label}getType(){return 3}getIcon(e,t){return Promise.resolve(null)}},$S=class{constructor(e){this.deviceManager=e,this.sharingSource=new $m}onScreensChanged(e){return{dispose:()=>void 0}}enumerateScreensAsync(){return Promise.resolve([this.sharingSource])}enumerateWindowsAsync(){return Promise.resolve([])}async enumerateCamerasAsync(){return(await this.deviceManager.enumerateDevicesAsync()).filter(e=>"camera"===e.kind).map(e=>new $v(e))}},$y=class{constructor(e){this.configProvider=e,this.data={records:[],tmpRecords:[],isReconnecting:!1,networkRecoveredCount:0,disconnectedRecoveredCount:0,reconnectCount:{attempted:0,connected:0},retargetCount:{incoming:0,outgoing:0,completed:0,rejected:0},escalationCount:{attempted:0,completed:0,rejected:0}}}registerState(e){let t="connected"===e?this.activeTmpRecord:this.getTmpRecord();t&&t.events[t.events.length-1]?.type!==e&&(t.events.push({type:e,time:Date.now()-t.startTime}),"networkOnline"===e?this.data.networkRecoveredCount++:"connected"===e&&this.data.disconnectedRecoveredCount++,("reconnect"===e||"connected"===e)&&(t.endTime=Date.now()-t.startTime,this.activeTmpRecord=null))}registerReconnectAttempt(e){this.activeRecord&&(this.activeAttempt={direction:e,startTime:Date.now()-this.activeRecord.startTime,status:!1},this.data.isReconnecting=!0,tq(this.activeRecord.attempts,this.activeAttempt,this.configProvider.config.diagnostics.collectionLimits.numReconnectRecords))}registerReconnectAttemptStatus(e){"completed"===e&&(this.data.isReconnecting=!1),this.activeAttempt&&this.activeRecord&&(this.activeAttempt.endTime=Date.now()-this.activeRecord.startTime,this.activeAttempt.status="completed"===e)}registerReconnect(e){if(this.data.reconnectCount[e]++,this.data.isReconnecting="attempted"===e,"attempted"===e)this.activeRecord||(this.activeRecord={startTime:Date.now(),attempts:[]},tq(this.data.records,this.activeRecord,this.configProvider.config.diagnostics.collectionLimits.numReconnects));else if("connected"===e){if(!this.activeRecord)return;this.activeTmpRecord&&this.registerState("connected"),this.activeRecord.endTime=Date.now()-this.activeRecord.startTime,this.activeRecord=void 0,this.activeAttempt=void 0}}registerRetarget(e){this.data.retargetCount[e]++}registerEscalation(e){this.data.escalationCount[e]++}getObject(){return this.data}getTmpRecord(){return(!this.activeTmpRecord||this.activeTmpRecord.endTime>0)&&(this.activeTmpRecord={startTime:Date.now(),events:[]},this.data.tmpRecords.push(this.activeTmpRecord)),this.activeTmpRecord}},$C=class{constructor(){}process(e){return this.mediaLegId=e||this.mediaLegId||nR().toUpperCase(),this.mediaLegId}},$b=class{constructor(e,t){this.relayManager=e,this.diagnostics=t}initialize(){}setRelayOverride(){}async queryRelaysAsync(e){let t=await this.relayManager.queryRelaysAsync(e);return t.length>0&&(this.diagnostics.relay=t[0]),t}getStats(){return this.relayManager.getStats?.()??{stats:{unavailable:"1"}}}getAuthTokenStats(){return this.relayManager.getAuthTokenStats()}},$T=class{constructor(e,t,i){this.stats=e,this.diag=t,i&&t&&(i.reconnect=t.getObject())}registerState(e){this.diag?.registerState(e)}registerReconnectAttempt(e){this.stats.registerReconnectAttempt(e),this.diag?.registerReconnectAttempt(e)}registerReconnectAttemptStatus(e){switch(e){case"completed":this.stats.registerReconnectAttemptCompleted();break;case"rejected":this.stats.registerReconnectAttemptRejected()}this.diag?.registerReconnectAttemptStatus(e)}registerReconnect(e){switch(e){case"attempted":this.stats.registerReconnectAttempted();break;case"connected":this.stats.registerReconnectConnected()}this.diag?.registerReconnect(e)}registerRetarget(e){switch(e){case"completed":this.stats.registerRetargetCompleted();break;case"rejected":this.stats.registerRetargetRejected();break;case"incoming":this.stats.registerRetargetIncoming();break;case"outgoing":this.stats.registerRetargetOutgoing()}this.diag?.registerRetarget(e)}registerEscalation(e){switch(e){case"attempted":this.stats.registerEscalationStart();break;case"completed":this.stats.registerEscalationCompleted();break;case"rejected":this.stats.registerEscalationRejected()}this.diag?.registerEscalation(e)}},$E=class{constructor(e){this.initialCallbacks=e,this.queueCallbacks={onTerminated:this.genCallback(this.initialCallbacks.onTerminated),onSessionErrorOccurred:this.genCallback(this.initialCallbacks.onSessionErrorOccurred),onNegotiationRequired:this.genCallback(this.initialCallbacks.onNegotiationRequired),onAudioStateChanged:this.genCallback(this.initialCallbacks.onAudioStateChanged),onAudioHwSilentChanged:this.genCallback(this.initialCallbacks.onAudioHwSilentChanged),onTransportDisconnected:this.genCallback(this.initialCallbacks.onTransportDisconnected),onTransportConnected:this.genCallback(this.initialCallbacks.onTransportConnected),onTransportInitialized:this.genCallback(this.initialCallbacks.onTransportInitialized),onTransportFailed:this.genCallback(this.initialCallbacks.onTransportFailed),onUpdateMediaDescriptionsRequired:this.genCallback(this.initialCallbacks.onUpdateMediaDescriptionsRequired),onTeamsRealtimeTelemetryReport:this.genCallback(this.initialCallbacks.onTeamsRealtimeTelemetryReport)},this.queue=[]}flush(){this.queue.forEach(e=>{e.method.apply(null,e.args)}),this.clear()}clear(){this.queue=[]}genCallback(e){return(...t)=>this.queue.push({method:e,args:t})}},$_=class{constructor(e,t){this.relayConfig=e,this.logger=t}async ensureOnline(){if(0===this.relayConfig.length)return this.logger.safe.warn("No TURN servers defined"),0;if(this.probeDeferred)return this.probeDeferred.promise;this.logger.safe.info(`Starting TURN probes with ${JSON.stringify(this.relayConfig[0].urls)}`),this.checkStart=Date.now();let e=0;this.probeDeferred=new iE;let t=async()=>{await this.performCheck()&&this.finalize()},i=()=>{t(),e<3e3&&(e+=1e3),this.probeTimer=setTimeout(i,e)};return i(),this.probeDeferred.promise}finalize(){this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=0),this.probeDeferred&&(this.probeDeferred.resolve(Date.now()-this.checkStart),this.probeDeferred=null)}dispose(){this.finalize()}async performCheck(){this.logger.safe.info("Probing...");let e=this.tryCreatePc();if(!e)return!1;e.createDataChannel("probe");let t=new iE;function i(i){e.onicecandidate=void 0,e.close(),t.resolve(i)}let n=!1;return e.onicecandidate=e=>{let t=e.candidate;if(!t){n||this.logger.safe.info("still offline"),i(n);return}let r=t.type??ve(t.candidate).type;("srflx"===r||"relay"===r)&&(this.logger.safe.info(`Back online through ${r} candidate`),n=!0,"srflx"===r&&(this.ipFromRelay=t.address,i(!0)))},await e.setLocalDescription(await e.createOffer()),t.promise}tryCreatePc(){try{return new mk.RTCPeerConnection({iceServers:this.relayConfig})}catch(e){return this.logger.safe.info(`Failed to create PC, errCode=${e.code}`),null}}},$I=(e,t)=>e.reduce((e,i)=>{let n=[],r=i.addresses&&i.addresses[0],s=i.fqdns&&i.fqdns.length>0,a=t.iceUdpAddressType,o=t.iceTcpAddressType,l=t.iceServerTransport;if(!r&&!s)return e;if(l.includes("udp")&&i.udpPort){let e=s&&("fqdn"===a||!r)?i.fqdns[0]:r;n.push(`turn:${e}:${i.udpPort}?transport=udp`)}if(l.includes("tcp")&&i.tcpPort){let e=s&&("fqdn"===o||!r)?i.fqdns[0]:r;n.push(`turn:${e}:${i.tcpPort}?transport=tcp`)}return l.includes("tls")&&i.tlsPort&&s&&n.push(`turns:${i.fqdns[0]}:${i.tlsPort}`),e.concat({urls:n,credential:i.password,username:i.username})},[]),$w=(e,t)=>e.reduce((e,i)=>{let n=[],r=i.addresses&&i.addresses[0],s=i.fqdns&&i.fqdns.length>0,a=t.iceUdpAddressType,o=t.iceServerTransport;if(!r&&!s)return e;if(o.includes("udp")&&i.udpPort){let e=s&&("fqdn"===a||!r)?i.fqdns[0]:r;n.push(`stun:${e}:${i.udpPort}`)}return o.includes("tls")&&i.tlsPort&&s&&n.push(`turns:${i.fqdns[0]}:${i.tlsPort}`),e.concat({urls:n,credential:i.password,username:i.username})},[]),$P=class{constructor(e,t,i,n,r,s,a,o){this.session=e,this.context=t,this.diagnostics=i,this.sessionOperationQueue=n,this.callback=r,this.sessionCallbacks=s,this.configProvider=a,this.relayManager=o,this.wasConnected=!1,this.isDisconnected=!1,this.isReconnectConference=!1,this.escalationType=0,this._isSignalingStable=!0,this.reconnectDelayTime=0,this._isReconnectScheduled=!1,this.isDisposing=!1,this.isWaitingForNetwork=!1,this.onOnline=()=>{this.logger.safe.info("onOnline: Network is up"),this.diagnostics.registerState("networkOnline"),this.isOnlineDeferred?.resolve(),this.isOnlineDeferred=null},this.onOffline=()=>{this.logger.safe.info("onOffline: Network is down"),this.diagnostics.registerState("networkOffline"),this.isOnlineDeferred=new iE},this.logger=t.getLogger().createChild("ReconnectManagerV2"),this.ufdManager=t.getUfdManager(),this.session.callbacks=s,this.reconnectManagerMessageQueue=new $E(s),window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)}get isOnline(){return!this.isOnlineDeferred}async createRelayProber(){if(!this._relayProber){let e=Date.now(),t=$w(await this.relayManager.queryRelaysAsync({relayType:"turn"}),this.configProvider.config),i=Date.now()-e;this.logger.safe.info(`RelayProber configuration fetched in ${i} ms`),i>5e3&&this.diagnostics.registerState("relayConfigFetched"),this._relayProber=new $_(t,this.logger.createChild("RelayProber"))}return this._relayProber}dispose(){this.isDisposing=!0,window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline),this._relayProber?.dispose(),this.isOnlineDeferred?.reject(Error("dispose")),this.reconnectTimer&&this.resetReconnectTimer()}get settings(){return(this.reconnectSession||this.session).getSessionConfig().config}getCurrentSession(){return this.reconnectSession||this.session}getMainSession(){return this.session||this.reconnectSession}getReconnectSession(){return this.reconnectSession}async onIceDisconnect(e){if(this.wasConnected)this.raiseReconnectEvent("Bad",e);else if(!this.settings.reconnectWithNoRelays&&!this.session.hasRelayCandidates())return void this.onReconnectFailed("no relays",e);if(this.isDisconnected=!0,!this.isReconnecting()&&!this.isWaitingForNetwork)return this.logger.safe.info(`[${e}] reconnect attempt after iceDisconnect error`),this.session.transportStateProvider?.isFailed&&this.diagnostics.registerState("failed"),this.diagnostics.registerReconnect("attempted"),this.reconnectAsync(e)}onTransportDisconnect(e){this.isDisconnected=!0,this.wasConnected&&(this.diagnostics.registerState("disconnected"),this.handleTmpConnectivityLoss(e))}onConnected(e){this.isDisconnected=!1,this.logger.safe.info(`[${e}] set allow UFD`),this.diagnostics.registerState("connected"),this.raiseReconnectEvent("Good",e),this.wasConnected=!0,this._relayProber?.finalize()}onNegotiationCompletedAsync(e){return this.logger.safe.info(`[${e}] handle negotiation completed`),this.setSignalingState(!0),this.isReconnecting()&&(this.diagnostics.registerRetarget("completed"),2===this.escalationType&&this.blockCurrentSession(e)),Promise.resolve()}async onSessionErrorOccurred(e,t){this.logger.safe.info(`[${t}] handle session error`,t$(e)),await this.rejectReconnect(t),this.isReconnectAllowed()?await this.scheduleReconnectRetry(t,!1,!1):this.callback.onSessionErrorOccurred(e,t,this.wasConnected)}onNegotiationRejection(e,t){this.logger.safe.info(`[${t}] handle negotiation rejection`),this.diagnostics.registerRetarget("rejected");let i=1===this.escalationType;return this.rejectReconnect(t).then(()=>{let n=e.type===nu.RENEGOTIATION_ERROR.glare&&i;(e.type!==nu.RENEGOTIATION_ERROR.glare||i)&&(this.isRecoverableError(e.type)||n?this.scheduleReconnectRetry(t,n,i):this.onReconnectFailed(t$(e),t))})}async ensureNetwork(e){let t=this.isOnline;if(!this.isOnline){this.logger.safe.info(`[${e}] waiting for network...`);try{await this.isOnlineDeferred.promise}catch(t){this.logger.safe.info(`${e} call disposed while waiting for network`);return}this.logger.safe.info(`[${e}] network seems up`)}if(this.isDisconnected){let i=await this.createRelayProber(),n=await i.ensureOnline();this.logger.safe.info(`[${e}] probing complete in ${n} ms`),this.diagnostics.registerState("relaysUp"),t&&n<1e3&&this.logger.safe.info(`[${e}] looks like network failed on remote side, recovery was quick`)}}oldSessionIsOnline(e){return!!this.session?.transportStateProvider?.isConnected&&(this.logger.safe.info(`[${e}] old session recovered`),this.isReconnecting()||this.diagnostics.registerReconnect("connected"),!0)}async waitForNetworkAndTryLightweightRecovery(e){let t=this.oldSessionIsOnline(e);if(t||!this.settings.reconnectWithProbes)return t;this.setReconnectTimer(),this.isWaitingForNetwork=!0;let i=this.getMaxNetworkWaitTime();return(this.logger.safe.info(`[${e}] can wait up to ${i} ms`),await Promise.race([this.ensureNetwork(e),iI(i)]),this.isWaitingForNetwork=!1,this.session&&(this.session.transportStateProvider?.isConnected||this.session.transportStateProvider?.isFailed||(this.logger.safe.info(`[${e}] giving session a moment to recover`),await iI(this.settings.reconnectWaitTimeAfterProbe)),this.oldSessionIsOnline(e)))?(this.resetReconnectTimer(),!0):this.checkIfTimerFailed(e)?(this.logger.safe.info(`[${e}] session reconnect timer reached during network checks`),!0):!!this.isDisposing&&(this.logger.safe.info(`[${e}] session is disposed`),!0)}reconnectAsync(e,t=!1,i=!1,n){return this.logger.safe.info(`[${e}] queueing reconnect, force=${t}, escalation=${i}`),this.diagnostics.registerReconnectAttempt(i?"local escalation":"out"),this.context.getSmallCallTelemetry()?.setEventType("reconnect"),this._isReconnectScheduled=!0,i&&(this.escalationType=1,this.onReconnectCompleted=n),this.sessionOperationQueue.queueOperation(async()=>{if(this._isReconnectScheduled=!1,!t&&await this.waitForNetworkAndTryLightweightRecovery(e))return void this.sessionOperationQueue.completeCurrentOperation();if(this.isReconnecting()){this.logger.safe.info(`[${e}] ongoing reconnect is in progress`),this.sessionOperationQueue.completeCurrentOperation();return}this.diagnostics.registerState("reconnect"),await this.initReconnect(e),await this.reconnectSession.configureModalitiesAsync(this.getConfiguredModalities(),e),this.sessionOperationQueue.completeCurrentOperation()},e)}async acceptReconnectStartAsync(e,t){return this.logger.safe.info(`[${t}] accepting reconnect`),this.diagnostics.registerRetarget("incoming"),e?(this.escalationType=2,this.diagnostics.registerEscalation("attempted")):(!this.isReconnecting()&&this.isDisconnected?this.diagnostics.registerReconnect("attempted"):this.isReconnecting()&&await this.rejectReconnect(t),this.diagnostics.registerState("reconnect"),this.diagnostics.registerReconnectAttempt("in")),this.initReconnect(t)}acceptReconnectFinish(e){let t=this.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(t,e).then(()=>t)}isReconnecting(){return!!this.reconnectSession}isReconnectScheduled(){return this._isReconnectScheduled}cleanUp(){this.sessionCallbacks=null,this.reconnectSession=null}async terminateAsync(e){try{await this.session?.terminate(e,{})}catch{}try{await this.terminateReconnectSessionAsync(e,!0)}catch{}this.cleanUp()}completeReconnect(e){return this.logger.safe.info(`[${e}] completing reconnect`),2===this.escalationType&&(this.unblockCurrentSession(e),this.diagnostics.registerEscalation("completed")),this.escalationType=0,this.reconnectSession&&(this.context.config.isConference=this.isReconnectConference,this.disposeActiveSession(e),this.session=this.reconnectSession,this.reconnectManagerMessageQueue.clear(),this.diagnostics.registerReconnectAttemptStatus("completed"),this._isSignalingStable||this.diagnostics.registerRetarget("completed"),this.isDisconnected&&this.diagnostics.registerReconnect("connected"),this.resetReconnectTimer(),this.reconnectDelayTime=0,this.reconnectSession=null,this.negotiationPausePromise=null,this.session.callbacks=this.sessionCallbacks||{}),Promise.resolve()}async rejectReconnect(e){this.logger.safe.info(`[${e}] rejecting reconnect`),this.setSignalingState(!1),2===this.escalationType&&this.diagnostics.registerEscalation("rejected"),this.escalationType=0,this.reconnectSession&&(await this.terminateReconnectSessionAsync(e,!1),this.diagnostics.registerReconnectAttemptStatus("rejected")),this.session&&(this.reconnectManagerMessageQueue.flush(),this.session.callbacks=this.sessionCallbacks,this.unblockCurrentSession(e))}configureModalitiesAsync(e,t,i){this.lastKnownConfiguredModalities=e;let n=[];return this.session&&n.push(this.session.configureModalitiesAsync(e,t,i)),this.reconnectSession&&n.push(this.reconnectSession.configureModalitiesAsync(e,t,i)),Promise.all(n).then(()=>Promise.resolve())}canSendDtmf(){return this.getMainSession().canSendDtmf()}muteHold(e,t){this.getMainSession().muteHold(e,t)}muteInputAsync(e){return this.getMainSession().muteInputAsync(e)}unmuteInputAsync(e){return this.getMainSession().unmuteInputAsync(e)}muteOutputAsync(e){return this.getMainSession().muteOutputAsync(e)}unmuteOutputAsync(e){return this.getMainSession().unmuteOutputAsync(e)}async getSpeakerVolume(e){return this.getMainSession().getSpeakerVolume(e)}async setSpeakerVolume(e,t){return this.getMainSession().setSpeakerVolume(e,t)}_deviceSelectionChanged(){this.session&&this.session.deviceSelectionChanged(),this.reconnectSession&&this.reconnectSession.deviceSelectionChanged()}disposeActiveSession(e){if(!(this.session&&this.isReconnecting()))return Promise.resolve();{this.logger.safe.info(`[${e}] About to dispose current session...`);let t=this.session;return this.lastKnownConfiguredModalities=this.session.getConfiguredModalities(),t.callbacks=this.reconnectManagerMessageQueue.queueCallbacks,t.move(this.reconnectSession,e),this.session=null,t.terminate(e,{},!1)}}registerRetargetOutgoing(){this.diagnostics.registerRetarget("outgoing")}isSignalingStable(){return this._isSignalingStable}getConfiguredModalities(){return this.getMainSession().getConfiguredModalities()||this.lastKnownConfiguredModalities}checkIfTimerFailed(e){return!!(!this.isReconnectAllowed()&&(!this.session||this.session.transportStateProvider?.isFailed))&&(this.onReconnectFailed("the time limit was reached",e),!0)}async scheduleReconnectRetry(e,t,i){let n=this.getReconnectDelayTime();if(this.logger.safe.info(`[${e}] scheduling reconnect retry attempt in ${n}`),await iI(n),t||!this.checkIfTimerFailed(e))return this.reconnectAsync(e,i,i,this.onReconnectCompleted)}isRecoverableError(e){return nu.RENEGOTIATION_ERROR.media===e||nu.RENEGOTIATION_ERROR.signaling===e}async resetReconnectSession(e){this.logger.safe.info(`[${e}] Resetting reconnect session. Session exists: old: ${!!this.session}, new: ${!!this.reconnectSession}`),this.isReconnectConference=0!==this.escalationType||this.context.config.isConference;let t=0!==this.escalationType||this.context.config.isConference&&this.wasConnected&&!this.isDisconnected,i=this.getMainSession(),n=this.configProvider.getConfigView(this.isReconnectConference,i.getSessionConfig()),r=i.clone(t,n);r.callbacks={...this.sessionCallbacks,onTransportConnected:e=>{2!==this.escalationType&&this.completeReconnect(e),this.onReconnectCompleted?.(),this.raiseReconnectEvent("Good",e),this.sessionCallbacks.onTransportConnected(e)}},this.session&&(this.session.callbacks={...this.reconnectManagerMessageQueue.queueCallbacks,onSessionErrorOccurred:(e,t)=>(e.type!==nu.MEDIA_ERROR.iceConnectionError&&this.reconnectManagerMessageQueue.queueCallbacks.onSessionErrorOccurred(e,t),Promise.resolve())}),this.reconnectSession&&(this.reconnectSession.move(r,e),this.logger.safe.info(`[${e}] reconnect session still exists during reconnect clone operation`),await this.terminateReconnectSessionAsync(e,!1)),this.logger.safe.info(`[${e}] New session reset.`),this.reconnectSession=r}async initReconnect(e){this.logger.safe.info(`[${e}] initiate reconnect`),this.setReconnectTimer(),await this.resetReconnectSession(e),this.setSignalingState(!1),this.session&&(this.blockCurrentSession(e),await Promise.all([this.reconnectSession.muteInputAsync(e),this.reconnectSession.muteOutputAsync(e)]))}blockCurrentSession(e){this.logger.safe.debug(`[${e}] blocking current session negotiations`),this.negotiationPausePromise=this.session.pauseNegotiations(e)}unblockCurrentSession(e){this.negotiationPausePromise&&(this.logger.safe.debug(`[${e}] unblocking current session negotiations`),this.negotiationPausePromise.resolve(),this.negotiationPausePromise=null)}raiseReconnectEvent(e,t){this.ufdManager.signalEvent("NetworkReconnect",e,"Audio",!0,t)}async terminateReconnectSessionAsync(e,t){if(this.reconnectSession){let i=new $E(this.sessionCallbacks);this.reconnectSession.callbacks={...i.queueCallbacks,onTerminated:t?this.sessionCallbacks.onTerminated:i.queueCallbacks.onTerminated},await this.reconnectSession.terminate(e,{},!1),i.clear(),this.reconnectSession=null}}setReconnectTimer(){let e=this.wasConnected?this.settings.reconnectTimeLimit:this.settings.initialReconnectTimeLimit;e>0&&!this.reconnectTimer&&(this.reconnectTimerStart=Date.now(),this.reconnectTimer=window.setTimeout(()=>this.resetReconnectTimer(),e))}resetReconnectTimer(){clearTimeout(this.reconnectTimer),this.reconnectTimer=null}isReconnectAllowed(){return!!this.reconnectTimer&&!this.isDisposing}getReconnectDelayTime(){return 1e3*Math.min(++this.reconnectDelayTime,this.settings.maxReconnectDelayTime)}getMaxNetworkWaitTime(){let e=this.reconnectTimerStart>0?Date.now()-this.reconnectTimerStart:0;return Math.max(this.settings.reconnectTimeLimit-e,0)}onReconnectFailed(e,t){this.callback.onSessionErrorOccurred({type:nu.MEDIA_ERROR.iceConnectionError,detail:`Reconnect failed, error - ${t$(e)}`},t,this.wasConnected)}setSignalingState(e){this._isSignalingStable=e}async handleTmpConnectivityLoss(e){this.logger.safe.info(`[${e}] Session went into disconnected state, giving it ${this.settings.losingConnectivityTimeoutMs}ms to recover`),-1!==this.settings.losingConnectivityTimeoutMs&&(await iI(this.settings.losingConnectivityTimeoutMs),this.isDisconnected&&this.raiseReconnectEvent("Poor",e)),this.isDisconnected&&this.settings.reconnectOnDisconnect&&(this.logger.safe.info(`[${e}] Session is still down, triggering reconnect`),this.onIceDisconnect(e))}},$R=class{constructor(e,t){this.stats=e,this.diagnostics=t}set mediaLegId(e){this.stats.setMediaLegId(e.process()),this.diagnostics&&(this.diagnostics.mediaLegId=e)}set isMultiParty(e){e&&this.stats.setMultiParty(),this.diagnostics&&(this.diagnostics.isMultiParty=e)}set allowedModalities(e){this.stats.setSendModalities(e),this.diagnostics&&(this.diagnostics.allowedModalities=e)}set sessionError(e){this.stats.setError(e),this.diagnostics&&(this.diagnostics.sessionError=e)}set finalAnswerTime(e){this.stats.setFinalAnswerTimestamp(e),this.diagnostics&&(this.diagnostics.finalAnswerTime=e)}set dtmfResult(e){this.stats.dtmfResult(e),this.diagnostics&&(this.diagnostics.dtmfResult=e)}set swMute(e){this.stats.setSwMute(e),this.diagnostics&&(this.diagnostics.swMute=e)}set speakerMute(e){this.stats.setSpeakerMute(e),this.diagnostics&&(this.diagnostics.speakerMute=e)}set hwSilent(e){this.stats.setHwSilent(e),this.diagnostics&&(this.diagnostics.hwSilent=e)}set isSpeaking(e){this.stats.setSpeakingState(e),this.diagnostics&&(this.diagnostics.isSpeaking=e)}set iceConnectedStateTimestamp(e){this.stats.setIceConnectedStateTimestamp(e),this.diagnostics&&(this.diagnostics.iceConnectedStateTimestamp=e)}set iceInitTime(e){this.stats.setIceInitTimestamp(e),this.diagnostics&&(this.diagnostics.iceInitTime=e)}set ETag(e){this.stats.setETag(e)}set configIds(e){this.stats.setConfigIds(e)}set relay(e){this.stats.setRelay(e),this.diagnostics&&(this.diagnostics.relay=e)}negotiationStart(e){switch(this.diagnostics?.negotiationStart(e),e){case"Offering":this.stats.negotiation.offering.started();break;case"Answering":this.stats.negotiation.answering.started()}}negotiationCompleted(e){this.stats.negotiation.current.completed(e),this.diagnostics?.negotiationCompleted(e)}negotiationRejected(){this.stats.negotiation.current.rejected(),this.diagnostics?.negotiationRejected()}registerTransportConnected(){this.stats.registerTransportConnected(),this.diagnostics?.registerTransportConnected()}registerTransportDisconnected(){this.stats.registerTransportDisconnected(),this.diagnostics?.registerTransportDisconnected()}registerTransportFailed(){this.stats.registerTransportFailed(),this.diagnostics?.registerTransportFailed()}registerRollbackEvent(e){this.stats.registerRollbackEvent(e),this.diagnostics?.registerRollbackEvent(e)}registerRawMediaAccess(e,t,i){"send"===t?this.stats.registerSetInputRawMedia(i):this.stats.registerOutputRawMediaAccess(),this.diagnostics?.registerRawMediaAccess(e,t,i)}registerQualityStateChangedEvent(e){this.stats.registerQualityStateChangedEvent(e),this.diagnostics?.registerQualityStateChangedEvent(e)}terminated(e){this.stats.terminated(e),this.diagnostics?.terminated(e)}registerRemoteQualityStateChangedEvent(e,t){this.stats.registerRemoteQualityStateChangedEvent(e,t),this.diagnostics?.registerRemoteQualityStateChangedEvent(e,t)}},$A=class{constructor(e){this.logger=e,this.operationQueue=null,this.currentOperationDeferred=null,this.operationQueue=new N3(this.logger)}queueOperation(e,t=e9()){this.logger.safe.info(`[${t}] queueing operation`);let i=new iE,n=this.operationQueue.add(()=>(this.currentOperationDeferred=i,e()),t);return this.operationQueue.add(i,t),n}completeCurrentOperation(){this.currentOperationDeferred&&(this.logger.safe.info("completing operation"),this.currentOperationDeferred.resolve())}},$M=class extends no{constructor(e,t,i,n,r,s,a,o=i.getLogger().createChild("SessionV2",t)){super(o),this.context=i,this.callback=n,this.statistics=r,this.configProvider=s,this.diagnostics=a,this.logger=o,this.audioStreamStates={[nu.STREAMING_STATE.inactive]:[nu.STREAMING_STATE.started,nu.STREAMING_STATE.active,nu.STREAMING_STATE.failed],[nu.STREAMING_STATE.started]:[nu.STREAMING_STATE.active,nu.STREAMING_STATE.removed,nu.STREAMING_STATE.stopped,nu.STREAMING_STATE.failed],[nu.STREAMING_STATE.active]:[nu.STREAMING_STATE.removed,nu.STREAMING_STATE.stopped,nu.STREAMING_STATE.failed]},this.mediaLegId=new $C,this.rejectedNegotiations=0,this.negotiationState=null,this.audioStreamState=nu.STREAMING_STATE.inactive,this.deviceManagerDisposables=[],this.visibilityChangedHandler=()=>{if(this.logger.safe.debug(`document.visibilityState changed: ${document.visibilityState}`),"visible"===document.visibilityState&&(this.getCurrentSession().playVideo(),(!this.wakeLock||this.wakeLock?.released)&&this.requestWakeLock()),"visible"===document.visibilityState&&this.pcClosedInfo){let e=this.pcClosedInfo;this.pcClosedInfo=null,Date.now()<e.timestamp+this.configProvider.config.reconnectWakeupTimeLimit?(this.logger.safe.info(`[${e.causeId}] start reconnect after wakeup`),this.startReconnect(e.causeId)):(this.logger.safe.info(`[${e.causeId}] terminate a call after wakeup because allowed time limit for reconnect exceeded`),this.endCallOnFailure(e.mediaError,e.causeId))}"hidden"===document.visibilityState&&this.context.getSmallCallTelemetry()?.setEventType("visibilityHidden")},this.ufdManager=i.getUfdManager(),this.ufdManagerDisposable=this.ufdManager.on("onQualityChanged",e=>this.qualityChanged(e)),this.sessionOperationQueue=new $A(this.logger),this.mediaLegId=new $C,this.diagnosticsWrapper=new $R(this.statistics,this.diagnostics),this.statistics.setId(t),this.diagnosticsWrapper.mediaLegId=this.mediaLegId,this.diagnosticsWrapper.ETag=this.configProvider.ETag,this.diagnosticsWrapper.configIds=this.configProvider.ecsConfigIds,this.diagnosticsWrapper.isMultiParty=!!i.config.isConference,this.recoverableErrors=this.configProvider.config.recoverableMediaErrors.split(","),this.forceReconnectErrors=this.configProvider.config.forceReconnectErrors.split(",");let l=this.getSessionCallbacks();e.callbacks=l,e.relayManagerProvider=this,this.reconnectManager=new $P(e,i,new $T(this.statistics,this.diagnostics?new $y(this.configProvider):void 0,this.diagnostics),this.sessionOperationQueue,this.getReconnectManagerCallbacks(),l,this.configProvider,this.getRelayManager()),this.deviceManager=this.context.callDeviceManager.getDefaultDeviceManager(),this.deviceManagerDisposables.push(this.deviceManager.on("onPermissionStateChanged",()=>this.diagnosticsWrapper.allowedModalities=this.getAllowedModalities())),this.deviceManagerDisposables.push(this.deviceManager.on("onSelectedDevicesChanged",()=>this.deviceSelectionChanged())),this.deviceManagerDisposables.push(this.deviceManager.on("onDevicesChanged",(e,t)=>this.deviceListChanged(t))),this.statistics.setDevicesCount(this.deviceManager.getDevicesCount()),this.diagnostics&&(this.diagnostics.relayManager=this.getRelayManager()),this.ufdManager.applyCurrentState(e=>this.qualityChanged(e)),document.addEventListener("visibilitychange",this.visibilityChangedHandler),this.requestWakeLock()}async requestWakeLock(){if(v$.isWakeLockSupported()&&this.configProvider.config.useWakeLockApi)try{this.wakeLock=await window.navigator.wakeLock.request("screen")}catch(e){this.logger.safe.info(`Wakelock request failed - ${e.message}`)}}enableTeamsRealTimeTelemetry(){this.realtimeTelemetryInterval||(this.logger.safe.info("teams realtime telemetry is enabled"),this.getSessionCallbacks().onTeamsRealtimeTelemetryReport(),this.realtimeTelemetryInterval=window.setInterval(()=>{this.getSessionCallbacks().onTeamsRealtimeTelemetryReport()},1e3*this.configProvider.config.diagnostics.teamsRealtimeTelemetry.pollingInterval))}getMediaStatsReport(){return this.diagnostics?.mediaStatsReport}createOfferAsync(e,t){return this.sessionOperationQueue.queueOperation(async()=>{this.diagnosticsWrapper.negotiationStart("Offering");try{let i=await this.getCurrentSession().createOfferAsync(e,t);return this.updateSelectedDevices(),i.mediaLegId=this.mediaLegId.process(i.mediaLegId),this.diagnosticsWrapper.mediaLegId=this.mediaLegId,this.reconnectManager.isReconnecting()&&!this.reconnectManager.isSignalingStable()&&(this.reconnectManager.registerRetargetOutgoing(),i.newOffer=!0),i}catch(e){throw this.diagnosticsWrapper.sessionError=e,e}},e)}registerRemoteQualityStateChangedEvent(e,t){this.diagnosticsWrapper.registerRemoteQualityStateChangedEvent(e,t)}setCallConstraints(e,t){return this.getCurrentSession().setCallConstraints(e,t)}processOfferAsync(e,t){return this.sessionOperationQueue.queueOperation(async()=>{this.diagnosticsWrapper.negotiationStart("Answering"),e.mediaLegId=this.mediaLegId.process(e.mediaLegId);try{e.newOffer&&await this.reconnectManager.acceptReconnectStartAsync(e.escalationOccurring,t);let i=await this.getCurrentSession().processOfferAsync(e,t);if(e.newOffer){let e=await this.reconnectManager.acceptReconnectFinish(t);i.sharing===nu.MEDIA_STATE.sendReceive&&(i.sharing=e.sharing===nu.MEDIA_STATE.send?nu.MEDIA_STATE.send:nu.MEDIA_STATE.receive)}return i}catch(e){throw this.diagnosticsWrapper.sessionError=e,e}},t)}async processAnswerAsync(e,t,i,n){try{return this.configProvider.config.muteDuringRemotePranswer&&(i&&!this.callMuteState&&(this.logger.safe.info(`[${t}] Muting input before processing full answer`),await this.muteInputAsync(t),this.lastMuteFromPranswer=!0),!i&&this.lastMuteFromPranswer&&(this.logger.safe.info(`[${t}] Unmuting input before processing full answer`),await this.unmuteInputAsync(t),this.lastMuteFromPranswer=!1)),await this.getCurrentSession().processAnswerAsync(e,t,i,n)}catch(e){throw this.lastMuteFromPranswer=!1,this.diagnosticsWrapper.sessionError=e,e}}async completeNegotiationAsync(e){this.rejectedNegotiations=0;try{let t=await this.getCurrentSession().completeNegotiationAsync(e);return this.negotiationState=t,this.diagnosticsWrapper.finalAnswerTime=Date.now(),this.diagnosticsWrapper.negotiationCompleted?.(t.activeModalities),await this.reconnectManager.onNegotiationCompletedAsync(e),this.sessionOperationQueue.completeCurrentOperation(),this.negotiationState}catch(e){throw this.diagnosticsWrapper.sessionError=e,e}}ignoreNotReconnectError(e){return e.detail?.type!==nu.MEDIA_ERROR.incompatibleOriginator}async rejectNegotiationAsync(e,t){this.logger.safe.info(`[${t}] rejectNegotiationAsync`,e);try{if(this.reconnectManager.isReconnecting()&&this.ignoreNotReconnectError(e))return await this.reconnectManager.onNegotiationRejection(e,t),this.registerNegotiationRejection(this.negotiationState),this.sessionOperationQueue.completeCurrentOperation(),this.negotiationState;{let i=await this.getCurrentSession().rejectNegotiationAsync(e,t,this.isRenegotiationAllowed(e.type));return this.sessionOperationQueue.completeCurrentOperation(),this.registerNegotiationRejection(i),i}}catch(e){throw this.diagnosticsWrapper.sessionError=e,e}}completeEscalationAsync(e){return this.reconnectManager.completeReconnect(e)}rejectEscalationAsync(e){return this.reconnectManager.rejectReconnect(e)}async terminate(e,t){this.logger.safe.info(`terminate reject reason: ${JSON.stringify(t||"")}`),this.registerVideoEffectsTelemetryEvent(this.deviceManager.effectsManager.getStats("Video","StatsQuery")),this.registerAudioEffectsTelemetryEvent(this.deviceManager.effectsManager.getStats("Audio")),this.statistics.setPermissionStates(await this.deviceManager.getKnownPermissionStates()),this.diagnosticsWrapper.terminated(t);let i=()=>this.cleanUp();return this.reconnectManager.terminateAsync(e).then(i,i)}async getStatsAsync(e){return this.configProvider.config.diagnostics.useForTelemetry?this.diagnostics?.telemetryReport:this.getMainSession().getStatsAsync(e).then(e=>this.prepareStats(e))}getLastKnownStats(e=!1){return this.configProvider.config.diagnostics.useForTelemetry?this.diagnostics?.telemetryReport:this.prepareStats(this.getMainSession().getLastKnownStats(e),e)}getCallTechnicalInfo(){return this.diagnostics?.realtimeTelemetryReport}async createAnswerAsync(e,t){try{let i=await this.getCurrentSession().createAnswerAsync(e,t);return this.updateSelectedDevices(),i.mediaLegId=this.mediaLegId.process(i.mediaLegId),this.diagnosticsWrapper.mediaLegId=this.mediaLegId,i}catch(e){throw this.diagnosticsWrapper.sessionError=e,e}}configureModalitiesAsync(e,t,i){return nh(e,(t,i)=>{t||delete e[i]}),this.reconnectManager.configureModalitiesAsync(e,t,i)}getAllowedModalities(){return this.deviceManager.getAllowedModalities()}createRemoteRenderer(e){return this.getMainSession().createRemoteRenderer(e)}async sendDtmf(e){try{let t=await this.getMainSession().sendDtmf(e);return this.diagnosticsWrapper.dtmfResult=!0,t}catch(e){throw this.diagnosticsWrapper.dtmfResult=!1,e}}canSendDtmf(){return this.reconnectManager.canSendDtmf()}muteHold(e,t){this.reconnectManager.muteHold(e,t)}muteInputAsync(e){return this.callMuteState=!0,this.diagnosticsWrapper.swMute=!0,this.lastMuteFromPranswer=!1,this.reconnectManager.muteInputAsync(e)}unmuteInputAsync(e){return this.callMuteState=!1,this.diagnosticsWrapper.swMute=!1,this.lastMuteFromPranswer=!1,this.reconnectManager.unmuteInputAsync(e)}muteOutputAsync(e){return this.diagnosticsWrapper.speakerMute=!0,this.reconnectManager.muteOutputAsync(e)}unmuteOutputAsync(e){return this.diagnosticsWrapper.speakerMute=!1,this.reconnectManager.unmuteOutputAsync(e)}async getSpeakerVolume(e){return this.reconnectManager.getSpeakerVolume(e)}async setSpeakerVolume(e,t){return this.reconnectManager.setSpeakerVolume(e,t)}getAcceptedTypes(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()}useNullAudioStreamClient(){this.getCurrentSession().useNullAudioStreamClient()}createAudioElement(e){this.getCurrentSession().createAudioElement(e)}getIncomingRawAudioStream(e){return this.diagnosticsWrapper.registerRawMediaAccess("audio","recv",!0),this.getCurrentSession().getIncomingRawAudioStream(e)}getUnmixedAudioProvider(){return this.getCurrentSession().getUnmixedAudioProvider()}deviceSelectionChanged(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()}registerDeviceTelemetryEvent(e){this.getCurrentSession().onDeviceEvent(e),this.statistics.registerDeviceTelemetryEvent(e)}registerVideoEffectsTelemetryEvent(e){this.statistics.registerVideoEffectsTelemetryEvent(e)}registerAudioEffectsTelemetryEvent(e){this.statistics.registerAudioEffectsTelemetryEvent(e)}reconnectAsync(e,t=!1,i){return this.reconnectManager.reconnectAsync(e,!0,t,i)}isReconnecting(){return this.reconnectManager.isReconnecting()}getRelayManager(){return this.relayManager??(this.relayManager=new $b(this.context.maContext.getRelayManager(),this.diagnosticsWrapper))}getSessionConfig(){return this.reconnectManager.getCurrentSession().getSessionConfig()}getDiagnostics(){return this.diagnostics}async getAudioSenderStats(){return this.getCurrentSession().getAudioSenderStats()}getLocalMediaTrackId(e){return this.reconnectManager.getMainSession().getLocalMediaTrackId(e)}getSubscriptionManager(){return this.getCurrentSession().getSubscriptionManager()}getDisabledModalities(){return this.getCurrentSession().getDisabledModalities()}configureSpatialAudio(e,t){this.getCurrentSession().configureSpatialAudio(e,t)}setParticipantSpatialAudioPositions(e,t){this.getCurrentSession().setParticipantSpatialAudioPositions(e,t)}startMediaDescriptionsUpdateAsync(e,t){return this.getCurrentSession().startMediaDescriptionsUpdateAsync(e,t)}completeMediaDescriptionsUpdateAsync(e){return this.getCurrentSession().completeMediaDescriptionsUpdateAsync(e)}rejectMediaDescriptionsUpdateAsync(e,t){return this.getCurrentSession().rejectMediaDescriptionsUpdateAsync(e,t)}processNotification(e,t){this.getCurrentSession().processNotification(e,t)}getMediaControlPlaneInstance(){return this.getCurrentSession().getMediaControlPlaneInstance()}async sendBeaconDataViaDataChannel(e){return this.getCurrentSession().sendBeaconDataViaDataChannel?.(e)}async cleanUp(){this.callback=null,this.deviceManagerDisposables.forEach(e=>e.dispose()),this.ufdManagerDisposable.dispose(),this.reconnectManager.dispose(),this.pcClosedInfo=null,document.removeEventListener("visibilitychange",this.visibilityChangedHandler),window.clearInterval(this.realtimeTelemetryInterval),this.wakeLock&&(await this.wakeLock.release(),this.wakeLock=null)}updateSelectedDevices(){let e=this.deviceManager.getSelectedDevices(),t=e=>e?this.deviceManager.getDeviceNameAsync(e).then(e=>nH(e,this.configProvider.config.devices.piiSafeWords)):Promise.resolve("none");Promise.all([t(e.microphone),t(e.speaker),t(e.camera)]).then(([e,t,i])=>{this.statistics.setUsedDevices({microphone:e,speaker:t,camera:i})})}getCurrentSession(){return this.reconnectManager.getCurrentSession()}getMainSession(){return this.reconnectManager.getMainSession()}setAudioStreamState(e,t,i){this.isAudioStateValid(e)?this.raiseAudioStateChanged(e,t,i):this.logger.safe.error(`[${t}] audio state transition is invalid: ${this.audioStreamState} -> ${e}`)}isAudioStateValid(e){return this.audioStreamStates[this.audioStreamState].indexOf(e)>=-1}raiseAudioStateChanged(e,t,i){if(this.logger.safe.info(`[${t}] audio state changed to ${e}`),this.callback.onAudioStateChanged){let t={content:"audio",direction:"receive",stream:e};this.callback.onAudioStateChanged(t,i)}}getReconnectManagerCallbacks(){return{onSessionErrorOccurred:(e,t,i)=>{this.isNetworkMediaError(e)&&!i&&this.ufdManager.raisePendingWhitelistingUFD(),this.endCallOnFailure(e,t)}}}isNetworkMediaError(e){return e.type===nu.MEDIA_ERROR.iceConnectionError||e.type===nu.MEDIA_ERROR.noNetworkError}isRecoverableMediaError(e){return this.recoverableErrors.includes(e.type)}startReconnect(e=e9()){return this.reconnectManager.onIceDisconnect(e)}shouldForceReconnect(e){return this.forceReconnectErrors.includes(e.type)}isUnexpectedPcClose(e){return e.type===nu.MEDIA_ERROR.unexpectedClose}getSessionCallbacks(){return this.sessionCallbacks||(this.sessionCallbacks={onTerminated:()=>{this.logger.safe.warn("call onTerminated"),this.event("onTerminated").raise(this)},onSessionErrorOccurred:(e,t=e9())=>this.isUnexpectedPcClose(e)?this.handlePcClosed(e,t):this.shouldForceReconnect(e)?this.reconnectManager.reconnectAsync(t,!0):this.isRecoverableMediaError(e)?this.reconnectManager.isReconnecting()?this.reconnectManager.onSessionErrorOccurred(e,t):this.startReconnect(t):(this.endCallOnFailure(e,t),Promise.resolve()),onNegotiationRequired:(e,t)=>this.callback.onNegotiationRequired(e,t),onAudioHwSilentChanged:e=>{this.diagnosticsWrapper.hwSilent=e},onAudioStateChanged:(e,t)=>{this.setAudioStreamState(e,t)},onTransportConnected:(e=e9())=>{this.logger.safe.info(`[${e}] Transport connectivity established`),this.ufdManager.cancelPendingWhitelistingUFD(),this.reconnectManager.onConnected(e),this.diagnosticsWrapper.registerTransportConnected(),this.diagnosticsWrapper.iceConnectedStateTimestamp=Date.now(),this.callback?.onTransportConnected(e)},onTransportDisconnected:(e=e9())=>{this.logger.safe.warn(`[${e}] Transport connectivity lost`),this.reconnectManager.onTransportDisconnect(e),this.diagnosticsWrapper.registerTransportDisconnected(),this.callback?.onTransportDisconnected?.(e)},onTransportFailed:()=>{this.diagnosticsWrapper.registerTransportFailed(),this.callback?.onTransportFailed?.()},onTransportInitialized:()=>{this.diagnosticsWrapper.iceInitTime=Date.now()},onUpdateMediaDescriptionsRequired:(e,t)=>this.callback.onUpdateMediaDescriptionsRequired(e,t),onTeamsRealtimeTelemetryReport:()=>this.callback.onRealtimeTelemetryReport()}),this.sessionCallbacks}registerNegotiationRejection(e){this.rejectedNegotiations++,this.diagnosticsWrapper.negotiationRejected?.(),e.rollback&&this.diagnosticsWrapper.registerRollbackEvent(e.rollback)}isRenegotiationAllowed(e){return this.rejectedNegotiations<this.context.configProvider.config.renegotiationAttempts&&!this.reconnectManager.isReconnectScheduled&&(nu.RENEGOTIATION_ERROR.signaling===e||nu.RENEGOTIATION_ERROR.media===e)}prepareStats(e,t=!1){this.statistics.setDeviceList(this.deviceManager.getDeviceDescriptions(),this.deviceManager.getDeviceListDebugInfo()),this.statistics.setRelayManagerTimers(this.getRelayManager().getStats()),this.statistics.setVideoEffectStats(this.context.callDeviceManager.getDeviceManager("Video").effectsManager.getStats("Video","StatsQuery")),this.statistics.setAudioEffectStats(this.deviceManager.effectsManager.getStats("Audio"));let i=this.statistics.generateStatistics(e,this.mediaLegId,t);return this.configProvider.config.diagnostics.features.useNewerStatisticsMetrics&&(i.data.metrics=this.diagnostics?.telemetryReport?.data.metrics),e.data.Extensions?.StartTime||(i.data.Extensions=this.diagnostics?.telemetryReport?.data.Extensions),i}deviceListChanged(e){e&&this.statistics.deviceChangedByPoll(),this.statistics.devicesChanged(),this.statistics.setDevicesCount(this.deviceManager.getDevicesCount())}qualityChanged(e){let t=e.deviceManagerId;if(t&&!this.context.callDeviceManager.hasDevice(t))return void this.logger.info(`${t} - is not added to Call, skipping UFD.`);this.context.getSmallCallTelemetry()?.setEventType(e.type),this.callback?.onQualityChanged&&(this.diagnosticsWrapper.registerQualityStateChangedEvent(e),"DeviceSpeakWhileMuted"===e.type&&(this.diagnosticsWrapper.isSpeaking="Good"!==e.value),this.callback.onQualityChanged(e))}endCallOnFailure(e,t,i){this.callback&&(this.callback.onSessionErrorOccurred&&this.callback.onSessionErrorOccurred(e,t),this.diagnosticsWrapper.sessionError=e,this.setAudioStreamState(nu.STREAMING_STATE.failed,t,i))}async handlePcClosed(e,t){let i=this.configProvider.config.reconnectWakeupTimeLimit;return(this.logger.safe.info(`[${t}] handle unexpected PC closed event`,`visibilityState=${document.visibilityState}, wakeupLimit=${this.configProvider.config.reconnectWakeupTimeLimit}`),"visible"===document.visibilityState)?this.startReconnect(t):i?void(this.pcClosedInfo={timestamp:Date.now(),causeId:t,mediaError:e}):this.endCallOnFailure(e,t,"suspended")}},$D=class{constructor(e){this.creationTime=e,this.records=[],this.activeRecord=null,this.activeAttempt=null,this.reconnectState=!1}getReport(){return this.records.length?JSON.stringify(this.records):""}isReconnecting(){return this.reconnectState}onReconnectStart(){this.reconnectState=!0,this.activeRecord||(this.activeRecord={attempts:[],endTime:null,startTime:Date.now()-this.creationTime},this.records.push(this.activeRecord))}onReconnectAttempt(e){if(!this.activeRecord)return null;this.activeAttempt={direction:e,status:!1,endTime:null,startTime:this.getTimestamp()},this.reconnectState=!0,this.activeRecord.attempts.push(this.activeAttempt)}onReconnectConnected(){if(!this.activeRecord)return null;this.reconnectState=!1,this.activeRecord.endTime=this.getTimestamp(),this.activeRecord=this.activeAttempt=null}onReconnectCompleted(){this.reconnectState=!1,this.resolveReconnectAttempt(!0)}onReconnectRejected(){this.resolveReconnectAttempt(!1)}resolveReconnectAttempt(e){this.activeAttempt&&this.activeRecord&&(this.activeAttempt.status=e,this.activeAttempt.endTime=this.getTimestamp())}getTimestamp(){return Date.now()-this.creationTime-this.activeRecord.startTime}},$O=window.navigator,$k=class{constructor(e="Good"){this.stopWatches=[],this.currentLevel=e,this.getStopWatch(e).start()}updateLevel(e){this.currentLevel!==e&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=e,this.getStopWatch(this.currentLevel).start())}getCount(e){let t=this.stopWatches[e];return t?t.count:0}getElapsed(e){let t=this.stopWatches[e];return t?t.elapsed:0}getStopWatch(e){let t=this.stopWatches[e];return t||(t=new UR,this.stopWatches[e]=t),t}},$N=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\:[0-9]{2,5})?$/),$x=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))(:[0-9]{2,5})?$/),$L=class{constructor(e,t,i){this.configProvider=e,this.callNumber=t,this.sessionDiagnostics=i,this.negotiation={offering:this.offering(),answering:this.answering(),current:this.current()},this.creationTime=Date.now(),this.negotiationCount=0,this.initialNegotiationCompleted=!1,this.activeModalities={},this.multiParty=!1,this.noIceCandidatesGoodEventCount=0,this.noIceCandidatesBadEventCount=0,this.noRelayIceCandidatesGoodEventCount=0,this.noRelayIceCandidatesBadEventCount=0,this.cameraInUseBadEventCount=0,this.cameraInUseGoodEventCount=0,this.microphoneInUseBadEventCount=0,this.microphoneInUseGoodEventCount=0,this.cameraFreezeStartEventCount=0,this.cameraFreezeEndEventCount=0,this.networkRecv=new $k,this.networkSend=new $k,this.retargetIncomingCount=0,this.retargetOutgoingCount=0,this.retargetCompletedCount=0,this.retargetRejectedCount=0,this.reconnectAttemptedCount=0,this.reconnectConnectedCount=0,this.escalationAttemptedCount=0,this.escalationCompletedCount=0,this.escalationRejectedCount=0,this.durationTimer=new UR,this.terminationReason={},this.terminationTime=0,this.sessionId="0",this.rejectedNegotiationCount=0,this.mediaError={type:"none",detail:"none"},this.incompatibleOffer=!1,this.dtmfSuccess=0,this.dtmfFailure=0,this.relay=null,this.relayManagerTimers=null,this.allowedAudioSend=!0,this.allowedVideoSend=!0,this.allowedScreensharingSend=!0,this.iceInitTime=0,this.finalAnswerTime=0,this.iceConnectedStateTime=0,this.usedDevices=null,this.deviceSelectionChangeCount=0,this.devicesChangeCount=0,this.devicesPollChangeCount=0,this.mute=new UR,this.osMute=new UR,this.hwSilent=new UR,this.isSpeaking=new UR,this.swMute=new UR,this.speakerMute=new UR,this.deviceTelemetryEvents=[],this.videoEffectsTelemetryEvents=new No(this.configProvider.config.effectsTelemetryBufferSize),this.audioEffectsTelemetryEvents=new No(this.configProvider.config.effectsTelemetryBufferSize),this.devicesCount=null,this.reconnectStats=new $D(this.creationTime),this.transportDisconnected=!1,this.transportReconnectedCount=0,this.ufds=[],this.remoteUfds=[],this.mediaQosEnabled=!1,this.portRangeConfigured=!1,this.rollbackNegotiation=[],this.rawOutputAudioAccess={attempt:0,timer:new UR},this.rawInputAudioOverride={attempt:0,timer:new UR},this.connectionEffectiveTypeSeries=new No(this.configProvider.config.navConnectionNumSamplesToCollect),this.connectionRttSeries=new No(this.configProvider.config.navConnectionNumSamplesToCollect),this.connectionDownlinkSeries=new No(this.configProvider.config.navConnectionNumSamplesToCollect),this.navigatorConnectionInterval=setInterval(()=>{let e=$O?.connection;e&&("number"==typeof e.downlink&&this.connectionDownlinkSeries.add(e.downlink),"number"==typeof e.rtt&&this.connectionRttSeries.add(e.rtt),"number"==typeof e.effectiveType&&this.connectionEffectiveTypeSeries.add(e.effectiveType))},this.configProvider.config.navConnectionPollingInterval),this.durationTimer.start()}terminated(e){this.terminationReason=nw(e),this.terminationTime=Date.now(),this.durationTimer.stop(),this.osMute.stop(),this.swMute.stop(),this.hwSilent.stop(),this.isSpeaking.stop(),this.mute.stop(),this.speakerMute.stop(),this.rawInputAudioOverride.timer.stop(),this.rawOutputAudioAccess.timer.stop(),clearInterval(this.navigatorConnectionInterval)}setMultiParty(){this.multiParty=!0}updateCommonMute(){this.swMute.isRunning||this.osMute.isRunning?this.mute.start():this.mute.stop()}setDeviceList(e,t){this.deviceList=e.map(e=>({label:nH(e.label,this.configProvider.config.devices.piiSafeWords),kind:e.kind})),t&&(this.deviceDebugStrings=nw(t))}setPermissionStates(e){this.permissionStates=e}setSwMute(e){e?this.swMute.start():this.swMute.stop(),this.updateCommonMute()}setSpeakerMute(e){e?this.speakerMute.start():this.speakerMute.stop()}setHwSilent(e){e?this.hwSilent.start():this.hwSilent.stop()}setSpeakingState(e){e?this.isSpeaking.start():this.isSpeaking.stop()}setETag(e){this.ETag=e}setConfigIds(e){this.configIds=e}setVideoEffectStats(e){e&&this.videoEffectsTelemetryEvents.add(e)}setAudioEffectStats(e){e&&this.audioEffectsTelemetryEvents.add(e)}registerQualityStateChangedEvent(e){switch(e.type){case"NoNetwork":"Good"===e.value?this.noIceCandidatesGoodEventCount++:this.noIceCandidatesBadEventCount++;break;case"NetworkRelaysNotReachable":"Good"===e.value?this.noRelayIceCandidatesGoodEventCount++:this.noRelayIceCandidatesBadEventCount++;break;case"DeviceCaptureNotFunctioning":"Good"===e.value?this.microphoneInUseGoodEventCount++:this.microphoneInUseBadEventCount++;break;case"VideoCapturerDeviceStartFailed":"Good"===e.value?this.cameraInUseGoodEventCount++:this.cameraInUseBadEventCount++;break;case"DeviceCaptureMute":"Audio"===e.mediaType&&("Bad"===e.value?this.osMute.start():this.osMute.stop(),this.updateCommonMute());break;case"NetworkRecvQuality":this.networkRecv.updateLevel(e.value);break;case"NetworkSendQuality":this.networkSend.updateLevel(e.value);break;case"VideoCaptureDeviceFreeze":"Good"===e.value?this.cameraFreezeEndEventCount++:this.cameraFreezeStartEventCount++}"DeviceSpeakWhileMuted"!==e.type&&this.ufds.push({...e,timestamp:Date.now()-this.creationTime}),this.ufds.length>this.configProvider.config.maxStoredUFDCount&&this.ufds.shift()}registerRemoteQualityStateChangedEvent(e,t){e.forEach(e=>{tq(this.remoteUfds,{...e,participantId:t,timestamp:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numUFDs)})}registerRetargetIncoming(){this.retargetIncomingCount++}registerRetargetOutgoing(){this.retargetOutgoingCount++}registerRetargetCompleted(){this.retargetCompletedCount++}registerRetargetRejected(){this.retargetRejectedCount++}registerEscalationStart(){this.escalationAttemptedCount++}registerEscalationCompleted(){this.escalationCompletedCount++}registerEscalationRejected(){this.escalationRejectedCount++}registerRollbackEvent(e){e&&this.rollbackNegotiation.push({type:e.type,attempt:this.rollbackNegotiation.length+1,error:e.error?e.error:""})}registerReconnectAttempted(){this.reconnectAttemptedCount++,this.reconnectStats.onReconnectStart()}registerReconnectConnected(){this.reconnectConnectedCount++,this.reconnectStats.onReconnectConnected()}registerDeviceTelemetryEvent(e){e.timestamp=e.timestamp-this.creationTime,this.deviceTelemetryEvents.push(e)}registerVideoEffectsTelemetryEvent(e){e&&(e.timestamp=e.timestamp-this.creationTime,this.videoEffectsTelemetryEvents.add(e))}registerAudioEffectsTelemetryEvent(e){if(e){e.timestamp=e.timestamp-this.creationTime;let t=this.audioEffectsTelemetryEvents.items.pop();t&&this.audioEffectsChanged(t,e)&&this.audioEffectsTelemetryEvents.add(t),this.audioEffectsTelemetryEvents.add(e)}}audioEffectsChanged(e,t){return e.payload.fallback!==t.payload.fallback||void 0!==t.payload.userNoiseSuppressionMethod&&e.payload.userNoiseSuppressionMethod!==t.payload.userNoiseSuppressionMethod||void 0!==t.payload.userAudioEffect&&e.payload.userAudioEffect!==t.payload.userAudioEffect}registerReconnectAttempt(e){this.reconnectStats.onReconnectAttempt(e)}registerReconnectAttemptCompleted(){this.reconnectStats.onReconnectCompleted()}registerReconnectAttemptRejected(){this.reconnectStats.onReconnectRejected()}setMediaLegId(e){this.mediaLegId=e}setId(e){this.sessionId=e}setError(e){e.type===nu.MEDIA_ERROR.incompatibleOffer&&(this.incompatibleOffer=!0),this.mediaError.type=e.type||nu.MEDIA_ERROR.internalError,this.mediaError.detail=t$(e.detail||e)}setRelay(e){this.relay={address:e.addresses.join(),expires:e.expires,realm:e.realm,credentials:!!(e.username&&e.password),ports:[e.udpPort?`udp:${e.udpPort}`:"",e.tcpPort?`tcp:${e.tcpPort}`:"",e.tlsPort?`tls:${e.tlsPort}`:""].join(","),fqdns:e.fqdns?e.fqdns.join():"none"}}setRelayManagerTimers(e){this.relayManagerTimers=e}setSendModalities(e){this.allowedAudioSend=e.audio.some(e=>mY(e)),this.allowedVideoSend=e.video.some(e=>mY(e)),this.allowedScreensharingSend=e.sharing.some(e=>mY(e))}setIceInitTimestamp(e){this.iceInitTime||(this.iceInitTime=e)}setFinalAnswerTimestamp(e){this.finalAnswerTime||(this.finalAnswerTime=e)}setIceConnectedStateTimestamp(e){this.iceConnectedStateTime||(this.iceConnectedStateTime=e)}dtmfResult(e){e?++this.dtmfSuccess:++this.dtmfFailure}setUsedDevices(e){this.usedDevices&&JSON.stringify(e)!==JSON.stringify(this.usedDevices)&&this.deviceSelectionChangeCount++,this.usedDevices=e}setDevicesCount(e){this.devicesCount=e}setMediaQosEnabled(e){this.mediaQosEnabled=e}setPortRangeConfigured(e){this.portRangeConfigured=e}devicesChanged(){this.devicesChangeCount++}deviceChangedByPoll(){this.devicesPollChangeCount++}registerOutputRawMediaAccess(){this.rawOutputAudioAccess.attempt++,this.rawOutputAudioAccess.timer.start()}registerSetInputRawMedia(e){this.rawInputAudioOverride.attempt++,e?this.rawInputAudioOverride.timer.start():this.rawInputAudioOverride.timer.stop()}getReport(){let e=this.usedDevices||{microphone:"none",speaker:"none",camera:"none"},t=this.sessionDiagnostics?.getObjectRef();return{RawOutputAudioAccessDurationRatio:this.getDurationRatio(this.rawOutputAudioAccess.timer.elapsed),RawOutputAudioAccessAttempted:this.rawOutputAudioAccess.attempt,RawInputAudioOverrideDurationRatio:this.getDurationRatio(this.rawInputAudioOverride.timer.elapsed),RawInputAudioOverrideAttempted:this.rawInputAudioOverride.attempt,SessionId:this.sessionId,CallNumber:this.callNumber,NoIceCandidatesBadEventCount:this.noIceCandidatesBadEventCount,NoIceCandidatesGoodEventCount:this.noIceCandidatesGoodEventCount,NoRelayIceCandidatesBadEventCount:this.noRelayIceCandidatesBadEventCount,NoRelayIceCandidatesGoodEventCount:this.noRelayIceCandidatesGoodEventCount,CameraInUseBadEventCount:this.cameraInUseBadEventCount,CameraInUseGoodEventCount:this.cameraInUseGoodEventCount,MicrophoneInUseBadEventCount:this.microphoneInUseBadEventCount,MicrophoneInUseGoodEventCount:this.microphoneInUseGoodEventCount,CameraFreezeStartEventCount:this.cameraFreezeStartEventCount,CameraFreezeEndEventCount:this.cameraFreezeEndEventCount,RetargetIncomingCount:this.retargetIncomingCount,RetargetOutgoingCount:this.retargetOutgoingCount,RetargetCompletedCount:this.retargetCompletedCount,RetargetRejectedCount:this.retargetRejectedCount,ReconnectAttemptedCount:this.reconnectAttemptedCount,ReconnectConnectedCount:this.reconnectConnectedCount,EscalationAttemptedCount:this.escalationAttemptedCount,EscalationCompletedCount:this.escalationCompletedCount,EscalationRejectedCount:this.escalationRejectedCount,CreationTime:this.getHpTimeFromMillis(this.creationTime),InitTime:this.getHpTimeFromMillis(this.creationTime),TerminationTime:this.getHpTimeFromMillis(this.terminationTime),CallDuration:this.getHpTimeFromMillis(this.getCurrentDuration()),InitialNegotiationType:this.initialNegotiationType||"none",InitialNegotiationCompleted:this.initialNegotiationCompleted,ActiveModalities:JSON.stringify(this.activeModalities),NegotiationCount:this.negotiationCount,RejectedNegotiationCount:this.rejectedNegotiationCount,MediaLegId:this.mediaLegId,MultiParty:this.multiParty,ErrorType:this.mediaError.type,ErrorDetail:this.mediaError.detail,TerminationReason:this.terminationReason,IncompatibleOffer:this.incompatibleOffer,DtmfSuccess:this.dtmfSuccess,DtmfFailure:this.dtmfFailure,Relay:this.relay?JSON.stringify(this.relay):"none",RelayManager:this.relayManagerTimers?JSON.stringify(this.relayManagerTimers):"none",AllowedAudioSend:this.allowedAudioSend,AllowedVideoSend:this.allowedVideoSend,AllowedScreensharingSend:this.allowedScreensharingSend,IceInitTime:this.getHpTimeFromMillis(this.iceInitTime),FinalAnswerTime:this.getHpTimeFromMillis(this.finalAnswerTime),IceConnectedStateTime:this.getHpTimeFromMillis(this.iceConnectedStateTime),UsedMicrophone:e.microphone,UsedSpeaker:e.speaker,UsedCamera:e.camera,DeviceSelectionChangeCount:this.deviceSelectionChangeCount,DevicesChangeCount:this.devicesChangeCount,DevicesPollChangeCount:this.devicesPollChangeCount,DevicesCount:this.devicesCount?JSON.stringify(this.devicesCount):"none",ETag:this.ETag||"",ConfigIds:this.configIds?Array.isArray(this.configIds)?this.configIds.join(","):this.configIds:"",CallMutedRatio:this.getDurationRatio(this.mute.elapsed),CallOsMuted:this.getHpTimeFromMillis(this.osMute.elapsed),CallHwSilent:this.getHpTimeFromMillis(this.hwSilent.elapsed),CallSwMuted:this.getHpTimeFromMillis(this.swMute.elapsed),CallSpeakerMuted:this.getHpTimeFromMillis(this.speakerMute.elapsed),CallIsSpeaking:this.getHpTimeFromMillis(this.isSpeaking.elapsed),NetworkRecvGood:this.networkRecv.getCount("Good")-1,NetworkRecvPoor:this.networkRecv.getCount("Poor"),NetworkRecvBad:this.networkRecv.getCount("Bad"),NetworkSendGood:this.networkSend.getCount("Good")-1,NetworkSendPoor:this.networkSend.getCount("Poor"),NetworkSendBad:this.networkSend.getCount("Bad"),NetworkRecvGoodRatio:this.getDurationRatio(this.networkRecv.getElapsed("Good")),NetworkRecvPoorRatio:this.getDurationRatio(this.networkRecv.getElapsed("Poor")),NetworkRecvBadRatio:this.getDurationRatio(this.networkRecv.getElapsed("Bad")),NetworkSendGoodRatio:this.getDurationRatio(this.networkSend.getElapsed("Good")),NetworkSendPoorRatio:this.getDurationRatio(this.networkSend.getElapsed("Poor")),NetworkSendBadRatio:this.getDurationRatio(this.networkSend.getElapsed("Bad")),DeviceEvents:JSON.stringify(this.deviceTelemetryEvents),DeviceList:JSON.stringify(this.deviceList),DeviceListDebug:JSON.stringify(this.deviceDebugStrings),VideoEffects:JSON.stringify(this.videoEffectsTelemetryEvents.items),AudioEffects:JSON.stringify(this.audioEffectsTelemetryEvents.items),PermissionStates:JSON.stringify(this.permissionStates),ReconnectAttempts:this.reconnectStats.getReport(),NetworkEvents:JSON.stringify(nZ(nj(t?.reconnect?.tmpRecords,this.configProvider.config.diagnostics.telemetryLimits.numNetworkEvents),"startTime",this.creationTime)),ReconnectInProgress:this.reconnectStats.isReconnecting(),TransportReconnectedCount:this.transportReconnectedCount,UFDs:JSON.stringify(this.ufds),remoteUFDs:JSON.stringify(this.remoteUfds),remoteUfdsCount:t?.remoteUfdsCount,MediaQosEnabled:this.mediaQosEnabled,PortRangeConfigured:this.portRangeConfigured,RollbackNegotiation:JSON.stringify(this.rollbackNegotiation),hardwareConcurrency:v$.hardwareConcurrency,GPUName:v$.unmaskedGlRenderer,Connection_Downlink:n0(this.connectionDownlinkSeries.items,e=>e),Connection_EffectiveType:this.connectionEffectiveTypeSeries.items.filter(e=>e).join(","),Connection_Rtt:n0(this.connectionRttSeries.items,e=>e),Connection_SaveData:$O?.connection?.saveData,MediaByPassEnabled:!!this.configProvider.mediaConfig.mediaBypassEnabled,CallConstraints:JSON.stringify(this.configProvider.getCallConstraintsTelemetry()),DominantSpeaker:JSON.stringify(U1(this.sessionDiagnostics?.getObjectRef().dominantSpeaker,this.terminationTime)),CallSetupTimeTracker:JSON.stringify(t?.webrtcSessions[0].negotiation.callSetupTimeReport),LastSessionSetupTimeTracker:t?.webrtcSessions.length>1?JSON.stringify(t?.webrtcSessions[t?.webrtcSessions.length-1].negotiation.callSetupTimeReport):void 0,mediaLeaks:JSON.stringify(t?.mediaLeaks)}}generateStatistics(e,t,i=!1){if(this.setMediaLegId(t.process()),"WebRtcMediaStats"!==e.type)throw Error(`Unknown stats type - ${e.type}`);if(i){let e=this.deviceTelemetryEvents.length;this.deviceTelemetryEvents.splice(0,e-1),this.deviceDebugStrings=xP,this.audioEffectsTelemetryEvents.clear()}e.data.metrics=this.getReport();let n=this.sessionDiagnostics?.getObjectRef().statsErrors;if(n?.length)if(e.data.Extensions?.WebRTCStats?.statsErrors){let t=JSON.parse(e.data.Extensions.WebRTCStats.statsErrors);t.push(...n),e.data.Extensions.WebRTCStats.statsErrors=JSON.stringify(t)}else e.data.Extensions.WebRTCStats.statsErrors=JSON.stringify(n);let r={};return ng(e.data,(e,t,i)=>{let n=0;$N.test(e)?(n=13,r[t]="IPv4"):$x.test(e)&&(n=4,r[t]="IPv6"),i[t]={type:n,value:e,__VALUE__:!0}}),e.data.metrics.piiFields={type:0,value:JSON.stringify(r),__VALUE__:!0},e}registerTransportConnected(){this.transportDisconnected&&(this.transportDisconnected=!1,this.transportReconnectedCount++)}registerTransportDisconnected(){this.transportDisconnected=!0}registerTransportFailed(){this.transportDisconnected=!1}resetError(){this.setError({type:"none",detail:"none"})}offering(){return{started:()=>{this.currentNegotiationType="Offering",this.negotiationStarted()}}}answering(){return{started:()=>{this.currentNegotiationType="Answering",this.negotiationStarted()}}}negotiationStarted(){this.initialNegotiationType=this.initialNegotiationType||this.currentNegotiationType,++this.negotiationCount}current(){return{completed:e=>{this.initialNegotiationCompleted=!0,this.activeModalities=e,this.resetError()},rejected:()=>{++this.rejectedNegotiationCount}}}getDurationRatio(e){let t=this.getCurrentDuration();return e/(0!==t?t:1)}getCurrentDuration(){return this.durationTimer.elapsed}getHpTimeFromMillis(e){return 1e4*e}},$F=class{constructor(e,t,i,n){this.onActiveSpeakersChanged=e,this.onDominantSpeakersChanged=t,this.logger=i,this.diagnostics=n}setStrategy(e){this.disposeStrategy(),this.dshStrategy=e,this.dshStrategy?.setOnDominantSpeakerChanged(this.onDominantSpeakerHistoryChanged.bind(this)),this.diagnostics?.setCurrentActiveStrategy("client")}onContributingSourcesChanged(e){this.onActiveSpeakersChanged(e),this.diagnostics?.contributingSourcesChanged(),this.dshStrategy?.setSources(e)}onDominantSpeakerHistoryChanged(e,t){this.onDominantSpeakersChanged(e),this.diagnostics?.recordHistoryEvent(e,t),"client"!==t&&this.dshStrategy&&(this.logger.safe.info("Disposing client DSH strategy and switching to MP provided DSH"),this.disposeStrategy())}dispose(){this.disposeStrategy(),this.onActiveSpeakersChanged=null,this.onDominantSpeakersChanged=null}disposeStrategy(){this.dshStrategy?.dispose(),this.dshStrategy=null}},$U=class{constructor(e){this.listener=e,this.streams=[]}add(e){this.streams.some(t=>t.getId()===e.getId())||(this.streams.push(e),this.listener.streamAdded(e))}remove(e){let t;ny(this.streams,i=>i.getId()===e&&(t=i,!0))&&this.listener.streamRemoved(t)}getStreams(){return this.streams}clear(){this.streams.forEach(e=>e.dispose()),this.streams=[]}},$$=eR(e5()),$V=class{constructor(e,t,i){this.pc=e,this.configProvider=t,this.logger=i.createChild("MediaRollbackModifier")}modifyDescriptor(e){let t=$$.parse(e.sdp);return $$.parse(this.pc.localDescription.sdp).media.forEach((e,i)=>{let n=t.media[i];(LI(e)&&!e.bundleOnly||!n||LI(n))&&(this.logger.safe.info(`Adding disabled media ${e.type}, position ${i}`),t.media[i]=Ut(e.type,void 0,e.protocol,void 0))}),new Fq(this.configProvider).modify(t),e.sdp=$$.write(t),e}},$B=class{constructor(e,t,i,n){this.logger=e,this.configProvider=t,this.activeSpeakerManager=i,this.contributingSourcesProvider=n,this.lastSources=[],this.emptySourcesCount=0,this.poll=()=>{let e=this.contributingSourcesProvider?.getContributingSources();if(!e){this.logger.safe.info(`Contributing sources are not supported on this client. Retries attempts: ${this.emptySourcesCount}`),this.emptySourcesCount>0?(this.emptySourcesCount--,this.timer=window.setTimeout(this.poll,this.configProvider.config.webrtcContributingSourcesPollingInterval)):this.dispose();return}this.activeSpeakerManager.onContributingSourcesChanged(e.filter(e=>{let t=this.lastSources.find(t=>t.source===e.source);return!t||t.timestamp!==e.timestamp}).map(e=>e.source)),this.updateLastSources(e),this.timer=window.setTimeout(this.poll,this.configProvider.config.webrtcContributingSourcesPollingInterval)},this.emptySourcesCount=this.configProvider.config.webrtcContributingSourcesPollingEmptySources,this.startPolling(this.configProvider.config.webrtcContributingSourcesPollingStartDelay)}dispose(){this.stopPolling(),this.contributingSourcesProvider=void 0}useCustomCodec(e){e?this.stopPolling():this.startPolling()}updateContributingSources(e){this.activeSpeakerManager.onContributingSourcesChanged(e)}startPolling(e=this.configProvider.config.webrtcContributingSourcesPollingInterval){!this.timer&&this.contributingSourcesProvider&&(this.logger.safe.info("Polling started"),this.timer=window.setTimeout(this.poll,e))}stopPolling(){this.timer&&(this.logger.safe.info("Polling stopped"),window.clearTimeout(this.timer),this.timer=void 0)}updateLastSources(e){this.lastSources=e.map(e=>({source:e.source,timestamp:e.timestamp}))}},$H=class{constructor(e,t,i,n){this.logger=e,this.peerConnection=t,this.logDiagnosticsError=i,this.sessionDiagnostics=n}getContributingSources(){try{if(!this.peerConnection?.getReceivers)return;let e=this.peerConnection.getReceivers().find(e=>"audio"===e.track.kind);if(!e)return[];return e.getContributingSources?.()}catch(e){this.logger.safe.error("Failed to get contributing sources",e),this.logDiagnosticsError&&this.sessionDiagnostics&&(this.sessionDiagnostics.contributingSourcesError=`${e}`);return}}},$j=15e3,$q=5e3,$W=class{constructor(e,t,i,n){if(this.settings=e,this.listener=t,this.logger=i,this.configProvider=n,this.lastSendBW=0,this.coolingDown=!1,this.cooldownTimer=null,this.cooldownEnd=0,this.active=!1,this.maxResolution=this.settings.maxResolution,!this.settings.scalingEnabled)return void this.logger.safe.info("Resolution management disabled: no resolution management for 1x1 calls");this.active=!0}dispose(){this.currentResolution=null,this.pendingResolution=null,this.maxResolution=null,this.listener=null,this.active=!1,clearTimeout(this.cooldownTimer),this.cooldownTimer=null,this.listener=null}setMaxResolution(e){let t=this.configProvider.getVideoSendLadder().getResolutionByFs(e);t!==this.maxResolution&&(this.logger.safe.info(`Setting max resolution: ${t}`),this.maxResolution=t,this.lastSendBW&&this.processEstimatedBandwidth(this.lastSendBW))}updateEstimatedSendBandwidth(e){e!==this.lastSendBW&&(this.logger.safe.debug(`Send BW: ${e}`),this.processEstimatedBandwidth(e))}resetCurrentResolution(){this.currentResolution=null}getCurrentResolution(){return this.currentResolution?.fs}setCurrentResolution(e){this.currentResolution=e}applyRes(e){this.pendingResolution=e,(!this.coolingDown||this.currentResolution&&!(e.fs>this.currentResolution.fs))&&(this.coolingDown=!0,this.logger.safe.info(`Changing resolution to ${e}`),this.listener&&this.listener.onResolutionChanged(e.fs).then(t=>{t?(e===this.pendingResolution&&(this.pendingResolution=null),this.coolingDown&&!this.currentResolution&&(this.coolingDown=!1),this.currentResolution=e,this.cooldown()):(this.logger.safe.info("Unable to apply resolution at the moment"),this.cooldown($q))}).catch(e=>{this.logger.safe.error(`Error while applying new resolution: ${JSON.stringify(e)}`),this.pendingResolution=null}))}cooldown(e=$j){!this.active||this.coolingDown&&this.cooldownEnd-Date.now()>$j||(this.cooldownTimer&&clearTimeout(this.cooldownTimer),this.coolingDown=!0,this.cooldownEnd=Date.now()+$j,this.cooldownTimer=setTimeout(()=>{this.logger.safe.debug("Resolution changer cooled down"),this.coolingDown=!1,this.cooldownTimer=null,this.pendingResolution?this.proposeResolution(this.pendingResolution):this.processEstimatedBandwidth(this.lastSendBW)},e))}proposeResolution(e){let t=e;this.maxResolution&&this.maxResolution.fs<t.fs&&(t=this.maxResolution),this.currentResolution&&t.fs===this.currentResolution.fs||this.applyRes(t)}processEstimatedBandwidth(e){let{lowRes:t,highRes:i}=this.configProvider.getVideoSendLadder().getResolutionForBitrate(e),n=e<this.lastSendBW?i:t;e<this.lastSendBW&&n&&this.currentResolution&&this.currentResolution.fs<n.fs||(n&&this.proposeResolution(n),this.lastSendBW=e)}};function $G(e,t){let i=t.config.maxBandwidthInKbpsFallback>0?t.config.maxBandwidthInKbpsFallback:Math.floor(Number.MAX_SAFE_INTEGER/1e3);return Math.min(((t.mediaConfig.maxBandwidthInKbps||i)-(t.config.audioBandwidthInKbps||0))*1e3,e.transport?.selectedCandidatePair?.availableOutgoingBitrate??0)}var $z=class extends no{constructor(e,t){super(t),this.configProvider=e,this.logger=t,this.lastReportedAgo=1/0,this._forceUpdate=!1}forceUpdate(){this._forceUpdate=!0}onBandwidthChanged(e){this._forceUpdate?this.updateBandwidth(e,"forceUpdate"):this.processEstimatedBandwidth(e)}processEstimatedBandwidth(e){if(this.lastReportedAgo++,!e||this.bandwidth===e)return;let t=this.configProvider.config.webrtcSendBandwidthIgnoredUpdateLimit,i=this.configProvider.config.webrtcSendBandwidthThreshold,n=this.lastReportedAgo===1/0,r=!t&&!i,s=t&&this.lastReportedAgo>=t,a=i&&Math.abs((e-this.bandwidth)/this.bandwidth)>=i,o=this.configProvider.config.webrtcSendBandwidthAlwaysReportAfterDrop&&e<this.bandwidth;if(n||r||s||a||o){let t=n|r<<1|s<<2|a<<3|o<<4,i=this.getUpdateReason(t);this.updateBandwidth(e,i)}}updateBandwidth(e,t){this.bandwidth=e,this.logger.safe.debug(`Updating send bandwidth: ${this.bandwidth}, reason: ${t}`),this.notifySendBandwidthChanged()}notifySendBandwidthChanged(){this._forceUpdate=!1,this.event("onSendBandwidthChanged").raise(this.bandwidth),this.lastReportedAgo=0}getUpdateReason(e){return 1&e?"firstReport":2&e?"throttlingDisabled":4&e?"noReportsForTooLong":8&e?"bigMovement":22&e?"drop":"none"}},$J=class{constructor(e,t,i,n,r,s,a){this.listener=e,this.statisticsGatherer=t,this.diagnostics=i,this.logger=n,this.configProvider=r,this.isSimulcastEnabled=a,this.serialQueue=new N3(this.logger),this.modality=nu.MODALITY.video;let o=s.maxResolution?{maxFs:s.maxResolution.fs}:null;this.validator=new Ny(this.logger.createChild("CapsValidator"),o),this.resolutionManager=new $W(s,this,this.logger.createChild("rm"),r),this.statisticsGatherer.on("onDiagnosticUpdated",e=>this.onDiagnosticUpdated(e))}async setMaxCapabilities(e,t){let i={modality:this.modality,causeId:e,capabilities:t,isSimulcastEnabled:this.isSimulcastEnabled};this.statisticsGatherer.onMaxCapabilitiesRequested(i),this.diagnostics?.onMaxCapabilitiesRequested(i),this.causeId=e;let n=this.validator.ensureValidity(t[0]);this.streamSenderParams={...t[0],...n},this.resolutionManager.setMaxResolution(this.streamSenderParams.maxFs),await this.applyCapabilities(this.getParamsToApply())}resetCurrentResolution(){this.resolutionManager.resetCurrentResolution()}getCurrentResolution(){return this.resolutionManager.getCurrentResolution()}setCurrentResolution(e){this.resolutionManager.setCurrentResolution(e)}async onResolutionChanged(e){return this.applyCapabilities(this.getParamsToApply(e))}dispose(){this.resolutionManager.dispose(),this.resolutionManager=null}async applyCapabilities(e){return e?this.lastAppliedSenderParams===e?(this.logger.safe.info(`Capabilities already applied: ${JSON.stringify(e)}`),!0):(this.logger.safe.info(`Capabilities to apply: ${JSON.stringify(e)}`),this.lastAppliedSenderParams=e,this.listener.onReceiveCapabilitiesChanged(this.modality,this.causeId,[e])):(this.logger.safe.error("Send capabilities are not set. Cannot apply constraints"),!1)}getParamsToApply(e){if(!this.streamSenderParams)return null;let t=e||this.resolutionManager.getCurrentResolution();if(!t||this.streamSenderParams.maxFs<=t)return this.streamSenderParams;let i=nI(this.streamSenderParams);return i.maxFs=t,i}onDiagnosticUpdated(e){try{if(!e.video?.send?.length||!e.video.send[0])return;this.configProvider.config.diagnostics.traceLogging&&this.logger.safe.debug("Caught onDiagnosticUpdated: Estimating send bandwidth");let t=$G(e.video.send[0],this.configProvider);this.resolutionManager.updateEstimatedSendBandwidth(t)}catch(e){this.logger.error("Failed to processes diagnostics update: "+e)}}};eM([xF()],$J.prototype,"applyCapabilities",1);var $K=class{constructor(e,t,i,n,r){this.modality=e,this.listener=t,this.statisticsGatherer=i,this.diagnostics=n,this.isSimulcastEnabled=r}setMaxCapabilities(e,t){let i={modality:this.modality,causeId:e,capabilities:t,isSimulcastEnabled:this.isSimulcastEnabled};this.statisticsGatherer.onMaxCapabilitiesRequested(i),this.diagnostics?.onMaxCapabilitiesRequested(i),this.listener.onReceiveCapabilitiesChanged(this.modality,e,t)}dispose(){}resetCurrentResolution(){}getCurrentResolution(){return null}setCurrentResolution(e){}},$Q=class{constructor(e,t,i,n,r,s){this.logger=e,this.settings=t,this.listener=i,this.statsGatherer=n,this.diagnostics=r,this.configProvider=s,this.mediaSourceModels=[],this.pendingCapabilities=new Map}dispose(){this.mediaSourceModels.forEach(e=>{e.handler&&(e.handler.dispose(),e.handler=null)}),this.mediaSourceModels=null}updateRegisteredSources(e){this.logger.safe.info(`Local media params updated: ${JSON.stringify(e)}`);let t=[];this.mediaSourceModels.forEach(e=>t.push(e.sourceId));let i=e.map(e=>e.sourceId),n=nF(t,i);this.removeSourcesWithIds(n);let r=nF(i,t);this.addSourcesWithIds(r,e)}setMaxCapabilities(e,t){for(let i of e){if(!i.capabilities.length)continue;if(!i.sourceId){this.logger.safe.info(`SourceId is not defined to apply recv capabilities: ${JSON.stringify(i)}`);continue}let e=this.getModelWithSourceId(i.sourceId);if(!e){this.logger.safe.info(`Model is not registered for sourceId: ${i.sourceId}`),this.configProvider.config.enableCachingFMTP&&this.pendingCapabilities.set(i.sourceId,i);continue}this.logger.safe.info(`Capabilities handler found for sourceId: ${i.sourceId}`);let n=this.getOrCreateHandlerForModel(e,i.isSimulcast);if(!n){this.logger.safe.info(`Handler is not found for sourceId: ${i.sourceId}`);continue}n.setMaxCapabilities(i.causeId||t,i.capabilities)}this.logger.safe.debug("Max capabilities application completed")}setPendingCapabilities(){if(!this.configProvider.config.enableCachingFMTP)return;this.logger.safe.info(`Apply pending capabilities for sources [${Array.from(this.pendingCapabilities.keys())}]`);let e=Array.from(this.pendingCapabilities.values());this.setMaxCapabilities(e),this.pendingCapabilities.clear()}clearPendingCapabilities(){this.pendingCapabilities.clear()}resetCurrentResolution(){let e=this.mediaSourceModels.find(e=>e.modality===nu.MODALITY.video);e?.handler&&e.handler.resetCurrentResolution()}getCurrentResolution(){let e=this.mediaSourceModels.find(e=>e.modality===nu.MODALITY.video);return e?.handler?e.handler.getCurrentResolution():this.currentResolution?.fs}setCurrentResolution(e){let t=this.mediaSourceModels.find(e=>e.modality===nu.MODALITY.video);t?.handler?t.handler.setCurrentResolution(e):this.currentResolution=e}getOrCreateHandlerForModel(e,t){return e.handler||(e.handler=this.getCapabilitiesHandler(e.modality,t)),e.handler}addSourcesWithIds(e,t){e.forEach(e=>{let i=t.find(t=>t.sourceId===e);this.registerSource(e,i.modality)})}removeSourcesWithIds(e){e.forEach(e=>this.unregisterSource(e))}registerSource(e,t){this.logger.safe.info(`SourceId ${e} registered with mediaType: ${t}`),this.mediaSourceModels.push({modality:t,sourceId:e})}unregisterSource(e){let t=this.mediaSourceModels.find(t=>t.sourceId===e);if(!t)return void this.logger.safe.info(`Model doesn't exist with sourceId ${e}`);t.handler&&t.handler.dispose(),this.mediaSourceModels.splice(this.mediaSourceModels.indexOf(t),1),this.logger.safe.info(`SourceId ${e} unregistered`)}getModelWithSourceId(e){return this.mediaSourceModels.find(t=>t.sourceId===e)}getCapabilitiesHandler(e,t){if(e===nu.MODALITY.audio)return null;if(e===nu.MODALITY.video&&!t&&this.settings.customBwEstimationEnabled){let e=new $J(this.listener,this.statsGatherer,this.diagnostics,this.logger.createChild("ach"),this.configProvider,this.settings,t);return this.currentResolution&&e.setCurrentResolution(this.currentResolution),e}return new $K(e,this.listener,this.statsGatherer,this.diagnostics,t)}},$Y=class extends no{constructor(e,t,i,n,r,s){super(e),this.logger=e,this.multiParty=t,this.configProvider=i,this.mediaManager=n,this.statsGatherer=r,this.diagnostics=s,this.rendererResolutions=new Map,this.rendererResolutionsApplied=new Map,this.rendererResolutionMax=new Map,this.hasPendingLimitResolutionUpdate=!1,this.spotlightedRenderers=[]}addRenderer(e){this.rendererResolutions.set(e,{width:0,height:0}),e.on("onRendererSizeChanged",(e,t)=>{this.onRendererSizeChanged(e,t)}),this.scheduleUpdateLimitedResolutions()}removeRenderer(e){this.rendererResolutions.delete(e),this.rendererResolutionsApplied.delete(e),this.rendererResolutionMax.delete(e),this.scheduleUpdateLimitedResolutions()}clearRenderers(){this.rendererResolutions.clear(),this.rendererResolutionsApplied.clear(),this.rendererResolutionMax.clear()}getMaxAllowedVideoFS(){let e=this.getMaxHeightFromConfig(this.sizedRenderersCount);return this.getMaxFSForHeight(e)}limitResolutionOnPoorPerformance(e){let t=this.getRendererByMsi(e);if(!t)return;let i=t.resolution.height>t.resolution.width,n=ra.Recv.getNextLowerResolution(t.resolution.width,t.resolution.height);if(!n)return;let r={width:i?n.height:n.width,height:i?n.width:n.height};this.rendererResolutionMax.set(t.renderer,r),this.diagnostics?.registerResolutionChangeRequest({ts:Date.now(),msi:t.renderer.getMsi(),res:r}),this.logger.safe.info(`Poor perf. Limiting resolution for renderer msi: ${t.renderer.getMsi()} from ${t.resolution.height}p to ${r.height}p`),this.onRendererSizeChanged(t.renderer,r)}get renderersCount(){return this.rendererResolutions.size}get sizedRenderersCount(){return this.configProvider.config.excludeUnsizedRenderersFromMultiviewResolutionLimits?[...this.rendererResolutions.values()].filter(e=>e.height>0).length:this.renderersCount}getMaxFSForHeight(e){return this.limitMaxFS(ra.Recv.getMaxFsForHeight(e))}getRendererByMsi(e){for(let[t,i]of this.rendererResolutions.entries())if(t.getMsi()===e)return{renderer:t,resolution:i};return null}applyRendererResolution(e,t){this.setMaxFSCapabilities(e,t),this.rendererResolutionsApplied.set(e,t);let i=e.getMediaStream()?.getVideoTracks();i?.[0]&&this.statsGatherer.setPreferredResolution(i[0].id,t,e.getModality())}onRendererSizeChanged(e,t){this.rendererResolutions.set(e,t),this.scheduleUpdateLimitedResolutions()}scheduleUpdateLimitedResolutions(){this.hasPendingLimitResolutionUpdate||(this.hasPendingLimitResolutionUpdate=!0,window.setTimeout(()=>{this.hasPendingLimitResolutionUpdate=!1;let e=this.groupMaxRenderersResolutionsByMsi();for(let[t,i]of(this.logger.safe.info(`Updating resolution limits: renderers count ${this.renderersCount}, with size: ${this.sizedRenderersCount}, resolution limits: ${JSON.stringify(this.configProvider.config.multiviewResolutionLimits)}`),this.spotlightedRenderers=this.findSpotlightedRenderers(),this.spotlightedRenderers.length>0&&this.logger.safe.info(`Spotlighted renderers: ${this.spotlightedRenderers.map(e=>e.getMsi())}, max spotlight height: ${this.configProvider.config.maxSpotlightResolution}`),this.rendererResolutions.entries())){if(!i.height)continue;let n=e.get(t.getMsi()),r=this.limitRendererResolution(t,n||i),s=this.rendererResolutionsApplied.get(t);s&&s.height===r.height&&s.width===r.width||this.applyRendererResolution(t,r)}},this.configProvider.config.multiviewResolutionLimitUpdateThrottleDelay))}findSpotlightedRenderers(){if(this.sizedRenderersCount<=1||!this.configProvider.config.isSpotlightEnabled)return[];let e=!1,t=0;for(let[i,n]of this.rendererResolutions.entries())n.height&&n.height!==t&&(t&&(e=!0),t=n.height);if(!e)return[];let i=new fY((e,t)=>e.resolution.width>t.resolution.width);for(let[e,t]of this.rendererResolutions.entries())i.enqueue({renderer:e,resolution:t});let n=[],r=this.configProvider.config.maxNumberOfPinnedVideos;for(;r;){let e=i.peek()?.resolution?.width,t=[];for(;i.peek()?.resolution?.width===e;)t.push(i.dequeue().renderer);if(r-t.length>=0)r-=t.length,n.push(...t);else break}return n}getMaxHeightFromConfig(e,t=!1){if(t)return this.configProvider.config.maxSpotlightResolution;if(this.configProvider.config.multiviewResolutionLimits[`${e}`])return this.configProvider.config.multiviewResolutionLimits[`${e}`];for(let t of Object.keys(this.configProvider.config.multiviewResolutionLimits).sort((e,t)=>parseInt(e)-parseInt(t)))if(parseInt(t)>e)return this.configProvider.config.multiviewResolutionLimits[t];return this.configProvider.config.multiviewResolutionLimits.more}getMaxHeight(e){let t=this.spotlightedRenderers.some(t=>t.getMsi()===e.getMsi()),i=this.getMaxHeightFromConfig(this.sizedRenderersCount,t),n=this.rendererResolutionMax.get(e);return n&&(i=Math.min(i,Math.min(n.height,n.width))),i}limitRendererResolution(e,t){let i=this.getMaxHeight(e);if(!i)return t;if(t.height>t.width&&t.width>i){let e=i/t.width;return{height:Math.ceil(t.height*e),width:i,limited:!0}}if(t.width>t.height&&t.height>i){let e=i/t.height;return{height:i,width:Math.ceil(t.width*e),limited:!0}}return t}setMaxFSCapabilities(e,t){let i=e.getMediaStream();if(!i)return void this.logger.safe.warn("renderer has no stream attached");let n=this.mediaManager.getMediaEntityByRemoteStreamId(i.id);if(!n?.getLocalRecvCapabilities())return void this.logger.safe.warn(`no capabilities for provided modality: ${e.getModality()}`);let r=t.limited?this.getMaxFSForHeight(Math.min(t.width,t.height)):this.getMaxFS(t.width,t.height),s=n.getLocalRecvCapabilities();s.setMaxFS(r,()=>{if(this.logger.safe.info(`updated max-fs video capability to ${r} for renderer msi: ${e.getMsi()}`),this.multiParty&&this.configProvider.config.webrtcMultiPartyRecvVideoSignaling){let t=e.getMsi(),n=s.buildFmtp();this.event("onSourceRequestRequired").raise(i.id,t,n)}else this.event("onNegotiationRequired").raise()})}getMaxFS(e,t){return this.limitMaxFS(ra.Recv.getMaxFsForHeight(Math.min(e,t)))}limitMaxFS(e){return this.multiParty?Math.min(e,this.configProvider.config.webrtcMultiPartyRecvVideoMaxFS):Math.min(e,this.configProvider.config.webrtcRecvVideoMaxFS)}groupMaxRenderersResolutionsByMsi(){let e=new Map;return this.rendererResolutions.forEach((t,i)=>{let n=i.getMsi(),r=e.get(n);(!r||t.width>r.width&&t.height>r.height)&&e.set(n,t)}),e}},$Z=class extends no{constructor(e,t){super(),this.configProvider=e,this.getModality=t,this.isRendering=!1,this.currentFreezeDuration=0,this.mediaStarted=!1,this.currentLowBitrateDuration=0}updateRenderingTracker(e){let t=e.extensions?.frameRateDecoded||0,i=e.extensions?.frameRateReceived||0,n=e.extensions?.bitrate;void 0!==n&&this.getModality()!==nu.MODALITY.sharing&&this.configProvider.config.isBytesRecvUsedInIsRenderingCalculation&&this.calculateLowBitrateDuration(n,t),t>0&&(this.mediaStarted=!0),0===t||0===i?this.currentFreezeDuration+=nu.TIME_INTERVAL.SEC_1:t>0&&(void 0===i||i>0)&&(this.currentFreezeDuration=0);let r=this.configProvider.config.notRenderingTimeInterval[this.getModality()];this.setIsRendering(r)}calculateLowBitrateDuration(e,t){e/1e3<this.configProvider.config.notRenderingLowBitrateThreshold&&t<this.configProvider.config.notRenderingLowFramerateThreshold?this.currentLowBitrateDuration++:this.currentLowBitrateDuration=0}setIsRendering(e){let t=this.currentFreezeDuration<e&&this.currentLowBitrateDuration<e&&this.mediaStarted;t!==this.isRendering&&(this.isRendering=t,this.event("onIsRenderingChanged").raise(this.isRendering))}},$X=class extends no{constructor(e,t,i,n){super(),this.videoElement=e,this.minInterval=t,this.maxInterval=i,this.window=mk,this.devicePixelRatio=n&&window.devicePixelRatio||1,this.originalVideoElementSize={width:e.offsetWidth,height:e.offsetHeight},this.initializeSizeTracking()}get width(){return this.originalVideoElementSize.width*this.devicePixelRatio}get height(){return this.originalVideoElementSize.height*this.devicePixelRatio}initializeSizeTracking(){let e=Math.floor(Math.random()*Math.abs(this.maxInterval-this.minInterval))+this.minInterval;this.elementSizeTrackingRef=this.window.setInterval(()=>{this.videoElementSizeChanged()&&(this.saveCurrentVideoElementSize(),this.raiseChanged())},e)}triggerVideoElementSizeChange(){this.originalVideoElementSize.height&&this.originalVideoElementSize.width&&this.raiseChanged()}dispose(){this.elementSizeTrackingRef&&this.window.clearInterval(this.elementSizeTrackingRef)}videoElementSizeChanged(){return this.originalVideoElementSize.width!==this.videoElement.offsetWidth||this.originalVideoElementSize.height!==this.videoElement.offsetHeight}saveCurrentVideoElementSize(){this.originalVideoElementSize.width=this.videoElement.offsetWidth,this.originalVideoElementSize.height=this.videoElement.offsetHeight}},$0=class extends xa{constructor(e,t,i,n,r,s){super(r,e.createChild("remote"),t),this.diagnostics=i,this.subscriptionManager=n,this.sessionDiagnostics=s,this.disposed=!1,this.currentIsRendering=!1,this.startTimeTTFF=0,this.timeToFirstFrame=-1,this.isTimeToFirstFrameReported=!1,this.isRenderingTracker=new $Z(this.configProvider,this.getModality.bind(this)),this.isRenderingChangedSubscription=this.isRenderingTracker.on("onIsRenderingChanged",e=>{this.setIsRendering(e)}),this.overlayStats=new xe(this.configProvider.config.showStatsInCall,r,this)}resetTimeToFirstFrameFlag(){this.isTimeToFirstFrameReported=!1}updateStatsOverlay(e,t){this.overlayStats.setStats(e,t)}updateIsRenderingTracker(e){this.isRenderingTracker?.updateRenderingTracker(e)}subscribeVideoAsync(e,t){return this.timeToFirstFrameSinceSubscriptionStart=Date.now(),new Promise((i,n)=>{this.modality=t?nu.MODALITY.sharing:nu.MODALITY.video,this.diagnostics&&(this.diagnostics.msi=e,this.diagnostics.modality=this.modality),this.trackElementSizeChange(),this.unsubscribe(),this.on("onVideoSizeChanged",(t,i)=>{if(this.modality===nu.MODALITY.video&&this.sessionDiagnostics?.registerResolutionChangeEvent({ts:Date.now(),msi:e,res:{width:t,height:i}}),this.isTimeToFirstFrameReported)return;if(-1===this.timeToFirstFrame){let e=Date.now();this.timeToFirstFrame=e-this.startTimeTTFF,this.timeToFirstFrameSinceSubscriptionStart=Date.now()-this.timeToFirstFrameSinceSubscriptionStart}let n=this.getTrackId();n&&(this.diagnostics.timeToFirstFrameSinceSubscriptionStart=this.timeToFirstFrameSinceSubscriptionStart,this.diagnostics.timeToFirstFrame=this.timeToFirstFrame,this.sizeTracker?.triggerVideoElementSizeChange(),this.event("onVideoStarted").raise(this.timeToFirstFrame,this.timeToFirstFrameSinceSubscriptionStart,n),this.isTimeToFirstFrameReported=!0)}),this.on("onVideoRendererStateChanged",e=>{this.diagnostics.addStateChange(e)});let r=this.subscriptionManager.subscribeVideo(this.modality,e);this.subscription=r,this.logger.safe.info(`subscribing renderer to type: ${r.modality} msi: ${r.msi}`),r.setOnMediaStreamChangedHandler(e=>{let t=this.getMediaStream();this.attachMediaStream(e),e&&(this.startTimeTTFF=Date.now());let n=this.getTrackId();n&&this.diagnostics&&(this.diagnostics.trackId=n),this.logger.safe.info(`subscribed renderer to type: ${r.modality} msi: ${r.msi} on stream #${e?e.id:"none"}`),e&&t!==e&&this.sizeTracker?.triggerVideoElementSizeChange(),i()}),r.setOnErrorHandler(t=>{this.logger.safe.error(`failed to subscribe renderer ${t$(t)}`),"webRtcSession cleanup"===JSON.stringify(t)&&(this.logger.safe.info(`Retry to subscribe to video stream with msi: ${e}. Previous session was cleaned up`),this.subscriptionManager.streamChangedByMsi(e),i()),n(t)})})}dispose(){this.disposed?this.logger.safe.warn("renderer already disposed"):(this.disposed=!0,this.logger.safe.info("disposing"),this.unsubscribe(),this.captureIsRenderingEvent(!1),this.sizeTracker?.dispose(),this.isRenderingChangedSubscription?.dispose(),this.overlayStats.dispose(),this.diagnostics?.dispose(),this.event("onRendererDisposed").raise(this),super.dispose())}getModality(){return this.modality}getMsi(){return this.subscription?.msi??-1}getLocalMsi(){return this.subscription?.localMsi}getCurrentResolution(){return this.resolution??{width:0,height:0}}unsubscribeNow(){this.subscription?.unsubscribe(),this.subscription=null}setIsRendering(e){this.currentIsRendering!==e&&(this.currentIsRendering=e,this.captureIsRenderingEvent(e))}trackElementSizeChange(){let e=this.modality===nu.MODALITY.sharing,t=e?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMin:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMin,i=e?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMax:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMax;if(!t||!i)return void this.logger.safe.info("skipping video size tracking");this.sizeTracker=new $X(this.getVideoElement(),t,i,this.configProvider.config.enableDevicePixelRatio),this.sizeTracker.changed(()=>this.onSizeTrackerChanged())}onSizeTrackerChanged(){this.resolution={width:this.sizeTracker.width,height:this.sizeTracker.height},this.logger.safe.info(`video renderer size changed to ${this.resolution.width}x${this.resolution.height}`),this.diagnostics&&(this.diagnostics.rendererSize=this.resolution),this.event("onRendererSizeChanged").raise(this,this.resolution)}unsubscribe(){this.subscription?.dispose(),this.subscription=null}captureIsRenderingEvent(e){this.diagnostics&&(this.diagnostics.isRendering=e),this.event("onIsRenderingChanged").raise(e,this.getModality(),this.getTrackId())}},$1=class{constructor(e,t,i,n,r,s){this.logger=e,this.configProvider=t,this.statsGatherer=i,this.sessionDiagnostics=n,this.remoteVideoResolutionManager=r,this.domOverrides=s,this.remoteRendererSubscriptions=new Map,this.diagnostics=n?.newRemoteVideoManagerDiagnostics()}createRenderer(e,t,i){let n=new $0((i??this.logger).createChild("videorenderer"),this.configProvider,this.diagnostics?.newRendererDiagnostics(),t,e,this.sessionDiagnostics);return this.domOverrides.onMediaElementAdded&&this.domOverrides.onMediaElementAdded(n.getVideoElement()),this.addRenderer(n),n}moveRenderers(e){this.renderers.forEach(t=>{t.resetTimeToFirstFrameFlag(),e.addRenderer(t),this.removeRenderer(t)})}getMaxAllowedVideoFS(){return this.remoteVideoResolutionManager.getMaxAllowedVideoFS()}dispose(){this.renderers.forEach(e=>e.resetTimeToFirstFrameFlag()),this.remoteRendererSubscriptions.forEach((e,t)=>{t.dispose(),e.forEach(e=>e.dispose())}),this.remoteRendererSubscriptions.clear(),this.remoteVideoResolutionManager.clearRenderers()}processStatsReport(e){this.onDiagnosticUpdated(e),this.updateOverlayStats(e)}playVideo(){this.renderers.forEach(e=>e.playVideo())}get renderers(){return Array.from(this.remoteRendererSubscriptions,([e])=>e)}addRenderer(e){this.remoteRendererSubscriptions.set(e,this.subscribeOnEvents(e)),this.logger.safe.info("Added renderer to manager"),this.remoteVideoResolutionManager.addRenderer(e)}generateVideoRecvStats(e){let t=new Map,i=e=>{e?.forEach(e=>{let i=e.inboundRTP?.trackIdentifier??e.track?.trackIdentifier;t.set(i,e)})};return i(e.sharing?.recv),i(e.video?.recv),t}updateOverlayStats(e){let t=this.generateVideoRecvStats(e);this.renderers.forEach(i=>{let n=i.getTrackId();t.has(n)&&e.audio?.recv?.length&&i.updateStatsOverlay(t.get(n),e.audio.recv[0])})}onDiagnosticUpdated(e){let t=[...e.video?.recv??[],...e.sharing?.recv??[]];if(t.length){let e=new Map;t.forEach(t=>{let i=t.inboundRTP?.trackIdentifier??t.track?.trackIdentifier;e.set(i,t)}),this.renderers.forEach(t=>{let i=t.getTrackId();e.has(i)&&t.updateIsRenderingTracker(e.get(i))})}}subscribeOnEvents(e){return[e.on("onRendererDisposed",e=>this.onRendererDisposed(e)),e.on("onVideoStarted",(e,t,i)=>this.onVideoStarted(e,t,i)),e.on("onIsRenderingChanged",(e,t,i)=>this.statsGatherer.setIsRendering(e,t,i))]}onRendererDisposed(e){this.logger.safe.debug("Renderer removed from manager"),this.removeRenderer(e),this.domOverrides.onMediaElementRemoved&&this.domOverrides.onMediaElementRemoved(e.getVideoElement())}removeRenderer(e){this.remoteRendererSubscriptions.get(e).forEach(e=>e.dispose()),this.remoteRendererSubscriptions.delete(e),this.remoteVideoResolutionManager.removeRenderer(e)}onVideoStarted(e,t,i){this.statsGatherer.setTimeToFirstFrame(e,t,i)}},$2=i(892891),$3=[nu.MODALITY.audio,nu.MODALITY.video,nu.MODALITY.sharing],$4=class{constructor(e,t,i,n,r){this.peerConnection=t,this.mediaManager=i,this.reinvitelessContext=r,this.entityTransceiverMap=new Map,this.numVbssChannels=1,this.logger=e.createChild("TM"),this.configProvider=n.configProvider,this.isMultiparty=n.config.isConference,this.isPstnCall=n.config.isPstnCall,this.isParkedCall=n.config.isParkedCall,this.numVideoChannels=this.isMultiparty&&this.configProvider.config.numVideoChannelsGvc||1,n.configProvider.config.enableRollbackHandler&&this.mediaManager.setRollbackUpdateHandler(this.handleMediaEntitiesRollback.bind(this)),this.isMultiparty&&this.configProvider.config.multiStreamSupportedVBSS&&(this.numVbssChannels=n.config.numVbssChannels||1)}getTransceivers(){return this.peerConnection.getTransceivers().filter($8)}assureTransceivers(e){this.assureNegotiatedOrder(),this.addModalities(e),this.logTransceiversInfo("assureTransceivers"),this.setDirections(e)}syncTransceivers(e){this.syncWithMediaEntities(),this.setDirections(e)}assureNegotiatedOrder(){let e=this.getTransceivers();this.mediaManager.getMediaEntities().forEach(t=>{-1!==$3.indexOf(t.getModality())&&($9(this.entityTransceiverMap.get(t),e)||this.createTransceiverForEntity(t))})}addModalities(e){let t=this.mediaManager.isEmpty();for(let i of(this.isMultiparty||!t||this.isPstnCall||(e.video=e.video||"inactive",e.sharing=e.sharing||"inactive"),this.configProvider.config.webrctRemoveVideoModalitiesForPstn&&this.isPstnCall&&!this.isParkedCall&&(delete e.video,delete e.sharing),$3)){let n;if(!this.mediaManager.getMediaEntitiesByModality(i)[0]&&e[i]){switch(i){case nu.MODALITY.video:n=this.numVideoChannels;break;case nu.MODALITY.sharing:n=this.numVbssChannels;break;default:n=1}(0,$2.times)(n,e=>{let n=this.mediaManager.createMediaEntity(i);n.setExtension("reinviteless",t&&this.reinvitelessContext.maxStreamsForModality[i]>e),this.createTransceiverForEntity(n)})}}}createTransceiverForEntity(e){let t=e.getModality();this.logger.safe.info(`createTransceiver: modality=${t}`);let i=t===nu.MODALITY.audio?nu.MEDIA_TYPE.audio:nu.MEDIA_TYPE.video,n=e.getSimulcastContext(),r=this.createTransceiver(i,n);this.setCodecPreferences(r,i,!0),this.setExtensionPreferences(r,t),this.entityTransceiverMap.set(e,r),e.setExtension("unnegotiatedModality",!0)}setCodecPreferences(e,t,i){let n=vd(this.configProvider,t);if(!n?.length||!v$.hasCapabilitiesApi()||this.configProvider.config.filterCodecsInSdp)return;let r=mk.RTCRtpReceiver.getCapabilities(t);if(!r)return;let s=[];if(i)for(let e of n){let t=r.codecs.filter(t=>$5(e,t));s.push(...t)}else for(let e of r.codecs)n.some(t=>$5(t,e))&&s.push(e);s.length&&e.setCodecPreferences&&e.setCodecPreferences(s)}setExtensionPreferences(e,t){if(!this.configProvider.config.headerExtensionsToUpdate?.[t])return;if(!e.getHeaderExtensionsToNegotiate||!e.setHeaderExtensionsToNegotiate)return void this.logger.safe.debug("setExtensionPreferences: transceiver.setHeaderExtensionsToNegotiate is not supported");let i=this.configProvider.config.headerExtensionsToUpdate[t],n=e.getHeaderExtensionsToNegotiate();for(let e of n){let t=i.find(t=>t.uri===e.uri);t&&(e.direction=t.direction)}try{e.setHeaderExtensionsToNegotiate(n)}catch(e){this.logger.safe.error(`setExtensionPreferences: transceiver.setHeaderExtensionsToNegotiate failed, err ${t$(e)}`)}}async createSender(e,t,i){let n=await this.associateTrackWithTransceiver(e,t,i);if(!n)throw Error(`Transceiver for modality=${i} is not found`);let r=this.findEntityForTransceiver(n);return n.direction=i!==nu.MODALITY.sharing||r?.getExtension("reinviteless")?nu.MEDIA_STATE.sendReceive:nu.MEDIA_STATE.send,this.logger.safe.info(`Replace track completed direction:${n.direction} for transceiver mid=${n.mid}`),n.sender}removeSender(e){this.removeSenderInternal(e,!1)}async removeSenderAsync(e){return this.removeSenderInternal(e,!0)}removeSenderInternal(e,t){if("closed"===(this.peerConnection.connectionState||this.peerConnection.iceConnectionState))return void this.logger.safe.info("Not removing sender from pc, connection is closed");let i=this.getTransceivers().find(t=>t.sender===e);if(!i)throw Error(`Transceiver for sender with track=${e.track?.id} is not found`);let n=this.findEntityForTransceiver(i),r=!!n?.getExtension("reinviteless");this.logger.safe.info(`Remove sender with track=${e.track?.id} for transceiver mid=${i.mid}, reinviteless=${r}, doAsync=${t}`);let s=Promise.resolve();if(r&&t?s=i.sender.replaceTrack(null):this.peerConnection.removeTrack(e),t)return s}createTransceiver(e,t){let i={direction:"inactive"};return this.addSimulcastEnvelopeIfNeeded(i,t),this.peerConnection.addTransceiver(e,i)}addSimulcastEnvelopeIfNeeded(e,t){t?.shouldUseSimulcast()&&(e.sendEncodings=(0,$2.times)(t.config.layerScaleFactors.length,e=>{let i={rid:`${t.ridList[e]}`,scaleResolutionDownBy:t.config.layerScaleFactors[e]};if(this.configProvider.config.specCompliantSimulcast?.disableTilde&&(i.active=!1),t.config.layerScalabilityModes?.length>0){let n=t.config.layerScalabilityModes[e];void 0!==n&&n.length>0?i.scalabilityMode=n:this.logger.safe.warn(`Scalability mode was not set for rid: ${i.rid}`)}return this.logger.safe.debug(`Added layer ${e} with rid: ${i.rid} SF: ${i.scaleResolutionDownBy} SM: ${i.scalabilityMode}`),i}))}async associateTrackWithTransceiver(e,t,i){let n=this.findAvailableTransceiverToSend(i);if(n){this.logger.safe.info(`Associate track=${e?.id} (${i}) with existing transceiver mid=${n.mid}`);try{if(this.isMultiparty&&vm(this.configProvider,void 0,i)){this.logger.safe.info(`Disabling encodings for transceiver mid=${n.mid}`);let e=n.sender.getParameters();e.encodings.forEach(e=>e.active=!1),await n.sender.setParameters(e)}await n.sender.replaceTrack(e),this.configProvider.config.useSetStreamsForSender&&n.sender.setStreams&&n.sender.setStreams(t)}catch(e){throw this.logger.safe.error(`replaceTrack failed, err ${JSON.stringify(e)}`),e}return n}return null}syncWithMediaEntities(){let e=this.getTransceivers();this.mediaManager.getMediaEntities().forEach(t=>{let i=this.entityTransceiverMap.get(t);i=$9(i,e)?i:e.find(e=>e.mid===t.getMid()),this.entityTransceiverMap.set(t,i)}),this.logTransceiversInfo("syncWithMediaEntities")}getTransceiversByModality(e){return this.mediaManager.getMediaEntitiesByModality(e).map(e=>this.entityTransceiverMap.get(e)).filter($8)}setDirections(e){let t=!m0(e);for(let i of $3)for(let[n,r]of this.getTransceiversByModality(i).entries()){let s=this.findEntityForTransceiver(r);if(s?.getExtension("reinviteless")&&t){r.direction="sendrecv";continue}let a=e[i]||nu.MEDIA_STATE.inactive;r.direction=0===n&&r.currentDirection?a:$6(a)}this.logTransceiversInfo("setDirections")}handleMediaEntitiesRollback(e,t){e.forEach(e=>{let i=this.entityTransceiverMap.get(e),n=t.find(t=>t.getMid()===e.getMid());this.entityTransceiverMap.set(n,i)}),this.logTransceiversInfo("handleMediaEntitiesRollback")}findAvailableTransceiverToSend(e){let t=this.mediaManager.getMediaEntitiesByModality(e)[0];return this.entityTransceiverMap.get(t)}findEntityForTransceiver(e){for(let[t,i]of this.entityTransceiverMap)if(i===e)return t}logTransceiversInfo(e){let t=`${e}: transceivers details:`;for(let e of $3){let i=this.getTransceiversByModality(e);t+=` ${e}(${i.length}) [${i.map(e=>`mid=${e.mid}, direction=${e.direction}`).join(";")}]`}this.logger.safe.debug(t)}};function $5(e,t){return(!!(0,$2.isUndefined)(e.channels)||e.channels===t.channels)&&(!!(0,$2.isUndefined)(e.clockRate)||e.clockRate===t.clockRate)&&(!!(0,$2.isUndefined)(e.mimeType)||e.mimeType.toLowerCase()===t.mimeType.toLowerCase())&&(!!(0,$2.isUndefined)(e.sdpFmtpLine)||-1!==t.sdpFmtpLine.toLowerCase().indexOf(e.sdpFmtpLine.toLowerCase()))}function $6(e){let t=e;return mY(e)&&(t=mQ(e)),t||nu.MEDIA_STATE.inactive}function $8(e){return e&&"stopped"!==e.direction&&!e.stopped}function $9(e,t){return $8(e)&&-1!==t.indexOf(e)}var $7=class{constructor(e){this.queue=[],this.logger=e}cleanup(){this.queue.forEach(e=>{e.reject({notSent:e.tones})}),this.queue=[]}waitForNotification(e){return e?(this.logger.unsafe.info("sending dtmf tones: ",e),new Promise((t,i)=>{this.queue.push({tones:e,resolve:t,reject:i})})):Promise.reject(Error("invalid input"))}toneSent(e){this.queue[0]&&(e===this.queue[0].tones[0]?(this.queue[0].tones=this.queue[0].tones.substr(1),""===this.queue[0].tones&&(this.queue[0].resolve(),this.queue.shift())):(this.queue[0].reject(Error(`sent tone does not match: expected '${this.queue[0].tones[0]}' got '${e}'`)),this.queue.shift(),this.toneSent(e)))}},Ve=class{constructor(e){this.webRtcSender=null,this.configProvider=e.configProvider,this.queue=new $7(e.logger)}sendDtmf(e,t){return e?.getSenders?(this.syncSender(e),this.webRtcSender)?(this.webRtcSender.ontonechange=this.onToneChange.bind(this),this.webRtcSender.insertDTMF(this.webRtcSender.toneBuffer+t,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(t)):Promise.reject(Error("not available")):Promise.reject(Error("bad peerConnection"))}canSendDtmf(e){return!!e?.getSenders&&(this.syncSender(e),!!this.webRtcSender&&this.webRtcSender.canInsertDTMF)}dispose(){this.queue.cleanup()}syncSender(e){let t=e.getSenders().filter(e=>e.track&&"audio"===e.track.kind).filter(e=>e.dtmf?.canInsertDTMF)[0];this.webRtcSender&&t&&t.dtmf!==this.webRtcSender&&(this.webRtcSender.ontonechange=null,this.queue.cleanup()),this.webRtcSender=t?t.dtmf:null}onToneChange(e){e.tone&&this.queue.toneSent(e.tone)}},Vt=e=>new Ve(e),Vi=i(892891),Vn=class extends no{constructor(e,t){super(t),this.logger=t,this.id=-1,this.parentId=-1,this.rawStream=null,this.rawTrack=null,this.deviceId=null,this.mediaType=e}start(){return this.logger.safe.debug("start"),Promise.resolve()}clone(){return this.logger.safe.debug("clone"),this}setMuted(e,t){this.logger.safe.debug("setMuted")}setHold(e){this.logger.safe.debug("setHold")}getResolution(){return this.logger.safe.debug("getResolution"),{width:240,height:180}}getFrameRate(){return this.logger.safe.debug("getFrameRate"),1}hasAudio(){return this.logger.safe.debug("hasAudio"),!1}hasVideo(){return this.logger.safe.debug("hasVideo"),!1}isSameStream(e){return this.logger.safe.debug("isSameStream"),e===this}applyCapabilities(e){return this.logger.safe.debug("applyCapabilities"),Promise.resolve(!1)}onApplyConstraints(e){this.logger.safe.debug("onApplyConstraints")}update(e){this.logger.safe.debug("update")}isActive(){return!1}isDisposed(){return!1}},Vr=class e extends no{constructor(e,t,i,n,r){super(r),this.callDeviceManager=e,this.configProvider=t,this.sessionConfig=i,this.serialQueue=n,this.logger=r,this.mediaStreams={Audio:null,Video:null,ScreenShare:null},this.streamSubscriptions=new Map,this.deviceManagerSubscriptions=[],this.isNullAudioStream=!1}get currentMediaTypes(){return n_(this.mediaStreams).filter(e=>!!this.mediaStreams[e])}async getStreams(){return this.mediaStreams}useNullAudioStreamClient(){this.isNullAudioStream=!0}async update(e,t){let i=n_(e).filter(t=>e[t]);return nA(i,this.currentMediaTypes)?this.logger.safe.info("Requested modalities have not changed. Do nothing"):(this.logger.safe.info(`Starting media session with modalities: ${JSON.stringify(e)}`),await this.updateStreams(i,t),this.subscribeOnDeviceManagerEvents()),vn(this.mediaStreams)}async stopAsync(){this.logger.safe.info("Stopping streams async"),this.stop()}stop(){this.logger.safe.info("Stopping streams"),this.unsubscribeFromDeviceManagerEvents(),n_(this.mediaStreams).forEach(e=>this.removeStreamByType(e))}dispose(){this.stop(),super.dispose()}async updateStreams(e,t){let i=this.getAvailableMediaTypes(),n=(0,Vi.intersection)(e,i),r=n_(this.mediaStreams).filter(e=>this.mediaStreams[e]),s=t?[]:nF(n,r),a=nF(r,n);s.length&&this.logger.safe.info(`Adding media streams for types: ${JSON.stringify(s)}`),await Promise.all(s.map(async e=>{await this.addStream(e,!1),this.mediaStreams[e]&&this.event("onStreamAdded").raise(e)})),a.length&&this.logger.safe.info(`Removing media streams for types: ${JSON.stringify(a)}`),a.forEach(e=>{this.event("onStreamRemoving").raise(e),this.removeStreamByType(e)})}getAvailableMediaTypes(){let e=this.callDeviceManager.getDefaultDeviceManager().getSelectedDevices(),t=[];return e.microphone&&t.push("Audio"),e.camera&&t.push("Video"),t.push("ScreenShare"),t}async addStream(e,t){if(this.mediaStreams[e])return void this.logger.safe.warn(`Stream with type: ${e} is already registered`);let i=await this.getStream(e,t);this.subscribeOnMediaStreamEvents(i);try{await i.start()}catch(t){this.logger.safe.error(`Media stream request error: ${JSON.stringify(t)}`),this.event("onStreamError").raise(e,t);return}this.mediaStreams[e]=i}removeStreamByType(e){let t=this.mediaStreams[e];if(!t)return void this.logger.safe.warn(`Stream with type: ${e} is not registered`);this.unsubscribeFromMediaStreamEvents(t),t.dispose(),this.mediaStreams[e]=null}async updateStream(e,t,i=!1){i&&"Audio"===e?await this.updateStreamWithEffect(e):(this.removeStreamByType(e),await this.addStream(e,t)),this.event("onStreamUpdated").raise(e)}async updateStreamWithEffect(e){let t=this.mediaStreams[e];t&&this.unsubscribeFromMediaStreamEvents(t);let i=await this.getStreamByMediaType(e,!0);this.subscribeOnMediaStreamEvents(i);try{await i.start()}catch(t){this.logger.safe.error(`updateStreamWithEffect. Media stream request error: ${JSON.stringify(t)}`),this.event("onStreamError").raise(e,t);return}this.mediaStreams[e]=i,t?.dispose()}subscribeOnMediaStreamEvents(e){if(this.streamSubscriptions.has(e))return;let t=[];t.push(e.on("onStreamClientError",(e,t)=>this.onStreamError(e,t))),t.push(e.on("onStreamClientDisposing",e=>this.onStreamDisposing(e))),this.streamSubscriptions.set(e,t)}unsubscribeFromMediaStreamEvents(e){this.streamSubscriptions.has(e)&&(this.streamSubscriptions.get(e).forEach(e=>e.dispose()),this.streamSubscriptions.delete(e))}async getStream(e,t){let i=this.mediaStreams[e];return i?(this.logger.safe.info(`Stream exists with id: ${i.id}, type: ${e}`),i):this.getStreamByMediaType(e,t)}async getStreamByMediaType(e,t){switch(e){case"Audio":return this.isNullAudioStream?new Vn("Audio",this.logger.createChild("NullStreamClient")):this.getDeviceManagerByType("Audio").getAudioStream(t,"sessionStream");case"Video":return this.getDeviceManagerByType("Video").getVideoStream(t,"sessionStream",!1,this.sessionConfig.outgoingVideoMaxFS);case"ScreenShare":return this.getDeviceManagerByType("ScreenShare").getDisplayStream("sessionStream");default:throw Error(`Media type is not supported: ${e}`)}}getMediaTypeForStream(e){let t=Object.keys(this.mediaStreams).find(t=>this.mediaStreams[t]===e);return t||this.logger.safe.error(`Media type is not found for stream: ${t$(e)}`),t}subscribeOnDeviceManagerEvents(){if(0!==this.deviceManagerSubscriptions.length)return;if(this.callDeviceManager.isVirtualDeviceEnabled){let e=this.callDeviceManager.on("onSelectedVirtualDevicesChanged",(e,t)=>{let i=e;if(!e.camera){this.logger.info("Virtual DeviceID for camera is undefined, falling back to default device");let{camera:e}=this.callDeviceManager.getDefaultDeviceManager().getSelectedDevices();i.camera=e}this.callDeviceManager.isModalityEnabled("Video")&&t.camera!==i.camera&&(this.logger.info("Updating stream for camera"),this.updateStreamForVirtualDeviceChange("Video")),this.callDeviceManager.isModalityEnabled("ScreenShare")&&t.screenshare!==i.screenshare&&(this.logger.info("Updating stream for screenshare"),this.updateStreamForVirtualDeviceChange("ScreenShare"))});this.deviceManagerSubscriptions.push(e)}let e=this.callDeviceManager.getDefaultDeviceManager();this.deviceManagerSubscriptions.push(e.on("onSelectedDevicesChanged",(e,t)=>this.onSelectedDevicesChanged(e,t)),e.on("onStreamUpdateRequested",(e,t)=>this.requestStreamUpdate(e,!1,t)),e.on("onAudioSharingToggled",e=>this.onAudioSharingToggled(e)))}unsubscribeFromDeviceManagerEvents(){0!==this.deviceManagerSubscriptions.length&&(this.deviceManagerSubscriptions.forEach(e=>e.dispose()),this.deviceManagerSubscriptions=[])}getMediaTypesToUpdate(e,t){let i=[];return this.currentMediaTypes.some(e=>"Audio"===e)&&e.microphone&&e.microphone!==t.microphone&&i.push("Audio"),!this.callDeviceManager.getSelectedDevices().camera&&this.currentMediaTypes.some(e=>"Video"===e)&&e.camera&&e.camera!==t.camera&&i.push("Video"),i}removeStream(e){let t=this.getMediaTypeForStream(e);this.removeStreamByType(t)}async onSelectedDevicesChanged(t,i){if(this.configProvider.config.enablePermissionsWorkaround&&e.isDeviceListEmpty(t,i))return void this.logger.safe.info("Device list is empty, permission workaround enabled");let n=this.getMediaTypesToUpdate(t,i);this.logger.safe.info(`Media types to update: ${JSON.stringify(n)}`),await Promise.all(n.map(e=>this.updateStream(e,!1)))}async onAudioSharingToggled(e){if(this.configProvider.config.postponeAudioMixerForAudioSharing&&e)return this.updateStream("ScreenShare",!0)}async requestStreamUpdate(e,t,i=!1){if(this.currentMediaTypes.some(t=>t===e)||t)return this.logger.safe.debug(`UpdateStream with media type: ${e}, force: ${t}`),this.updateStream(e,t,i);this.logger.safe.debug(`Stream with media type: ${e} is not active. Do nothing`)}onStreamError(e,t){this.removeStream(e)}onStreamDisposing(e){this.removeStream(e)}static isDeviceListEmpty(e,t){return!e.camera&&!e.microphone||!t.microphone&&!t.camera}getDeviceManagerByType(e){return this.callDeviceManager.getDeviceManager(e)}async updateStreamForVirtualDeviceChange(e){return this.updateStream(e,!1)}};eM([xF()],Vr.prototype,"getStreams",1),eM([xF()],Vr.prototype,"update",1),eM([xF()],Vr.prototype,"stopAsync",1),eM([xF()],Vr.prototype,"onSelectedDevicesChanged",1),eM([xF()],Vr.prototype,"onAudioSharingToggled",1),eM([xF()],Vr.prototype,"requestStreamUpdate",1),eM([xF()],Vr.prototype,"updateStreamForVirtualDeviceChange",1);var Vs=Vr,Va=class extends no{constructor(e,t,i){super(),this.configProvider=t,this.callDeviceManager=i,this.lastFramerateInput=-1,this.trackInfo=[],this.timeoutId=null,this.logger=e.createChild("localStreamWatcher"),this.callDeviceManagerSub=i.on("onSelectedVirtualDevicesChanged",()=>{this.logger.info("VirtualDevice changed, updating subscriptions"),this.handleDeviceManagerChange()})}get effectsManager(){return this.callDeviceManager.getDeviceManager("Video").effectsManager}startWatching(e,t){(this.configProvider.config.videoCaptureFreezeTimeout||t)&&(this.trackInfo=e,this.performanceMonitor=t,this.configProvider.config.videoCaptureFreezeTimeout&&!this.videoEffectManagerSubscription&&(this.videoEffectManagerSubscription=this.effectsManager.on("videoFreezeDetected",e=>this.onVideoFreezeDetected(e))))}stopWatching(){this.trackInfo=[],this.videoEffectManagerSubscription?.dispose(),this.videoEffectManagerSubscription=null,this.performanceMonitor=void 0,0!==this.lastFramerateInput||this.timeoutId||this.event("onVideoCaptureFreeze").raise(!1,!this.effectsManager.isEffectEnabled("Video")),this.disposeTimer(),this.lastFramerateInput=-1}dispose(e){this.callDeviceManagerSub?.dispose(),super.dispose(e),this.stopWatching()}onDiagnosticUpdated(e){let t;if(!this.trackInfo.length||!e.video?.send?.length)return;this.configProvider.config.diagnostics.traceLogging&&this.logger.safe.debug("Caught onDiagnosticUpdated: Updating local video stream watcher");let i=e.video?.send[0],n=[],r=0;if([i,...i.altLayouts??[]].forEach(e=>{let i=e.mediaSource,s=i?.framesPerSecond??0;this.trackInfo.some(e=>e.trackId===i?.trackIdentifier)&&((!t||r<s)&&(t=i,r=s),this.performanceMonitor&&n.push(e.outboundRTP))}),this.performanceMonitor?.monitor(n),this.configProvider.config.videoCaptureFreezeTimeout){if(!t)return void this.logger.safe.warn("WebRTC Stats for send video not found");r!==this.lastFramerateInput&&(0===r?this.scheduleCaptureFreezeStart(t.trackIdentifier,!this.effectsManager.isEffectEnabled("Video")):0===this.lastFramerateInput&&(this.timeoutId?this.disposeTimer():(this.logger.info(`onVideoCaptureFreeze end for trackId: ${t.trackIdentifier}`),this.event("onVideoCaptureFreeze").raise(!1,!this.effectsManager.isEffectEnabled("Video")))),this.lastFramerateInput=r)}}onVideoFreezeDetected(e){this.logger.info(`onVideoCaptureFreeze, webcam freeze detected trackId: ${e}`),this.event("onVideoCaptureFreeze").raise(!1,!0)}scheduleCaptureFreezeStart(e,t){this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.logger.safe.info(`onVideoCaptureFreeze start for trackId: ${e} (isWebcamStream: ${t})`),this.event("onVideoCaptureFreeze").raise(!0,t)},this.configProvider.config.videoCaptureFreezeTimeout)}disposeTimer(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handleDeviceManagerChange(){this.videoEffectManagerSubscription?.dispose(),this.videoEffectManagerSubscription=this.effectsManager.on("videoFreezeDetected",e=>this.onVideoFreezeDetected(e))}},Vo=i(892891),Vl=[5e4,1e6,15e5,2e6,25e5,375e4,4e6],Vc=[7e4,2e5,4e5,8e5,15e5,2499990,25e5];function Vd(e,t){let i=new Vu(e.createChild("BandwidthAllocator"));return i.setLadder("ScreenShare",t.config.sharingBitrateLadderOverride||Vl),i.setLadder("Video",t.config.videoBitrateLadderOverride||Vc),i}var Vu=class{constructor(e){this.logger=e,this.availableBandwidth=0,this.receivers=new Map,this.currentLayout={},this.ladders={}}setAvailableBandwidth(e){this.availableBandwidth=e,this.logger.safe.debug(`Total available bandwidth updated: ${e}`),this.updateLayouts()}getAvailableBandwidth(){return this.availableBandwidth}addReceiverCapability(e,t){this.logger.safe.debug(`Receiver maxBr set: ${e}/${t}`),this.receivers.set(e,t),this.updateLayouts()}getReceiverCapabilities(){let e={};for(let t of Object.keys(this.receivers)){let i=this.receivers.get(t);i&&(e[t]=i)}return e}removeReceiver(e){this.logger.safe.debug(`Receiver maxBr removed: ${e}`),this.receivers.delete(e),this.updateLayouts()}getLayouts(){return this.currentLayout}setLadder(e,t){this.ladders[e]=t}updateLayouts(){let e=this.generateLayouts();(0,Vo.isEqual)(e,this.currentLayout)||(this.currentLayout=e,this.logger.safe.debug(`Bandwidth distribution updated: ${t$(e)}`))}generateLayouts(){let e={},t={};for(let i of Object.keys(this.ladders)){let n=this.receivers.get(i);n&&(t[i]=n||Number.MAX_SAFE_INTEGER,e[i]=0)}let i=this.availableBandwidth,n=0,r=()=>{if(!i)return!1;for(let e of Object.values(t))if(e)return!0;return!1};for(;r();){for(let r of Object.keys(e)){let s=this.ladders[r],a=s[n]||s[s.length-1];a=Math.min(a,i,t[r]),e[r]+=a,i-=a,t[r]-=a}n++}return e}};function Vh(e,t){let i=Object.keys(e).filter(t=>e[t]>0).length>1;for(let n of Object.keys(e)){let r=t.get(n);if(void 0===e[n]||!r?.minValue&&!r?.minValueMixedMode)continue;let s=i?r?.minValueMixedMode:r?.minValue;e[n]=Math.max(s??r?.minValue??0,e[n])}return e}function Vg(e,t){let i=e.config.bandwidthAllocatorV2,n=[],r=-1;for(let e of i.videoLadders)(t>=e.maxFS&&r<e.maxFS||-1===r)&&(n=e.ladder,r=e.maxFS);return n}function Vp(e,t){let i=new Vf(e.createChild("BandwidthAllocator2"));return i.setPriority("ScreenShare","Video"),i.setLadder("ScreenShare",t.config.bandwidthAllocatorV2.sharingLadder),i.setLadder("Video",Vg(t,t.config.bandwidthAllocatorV2.defaultVideoMaxFS)),i}var Vf=class{constructor(e){this.logger=e,this.availableBandwidth=0,this.receivers=new Map,this.currentLayout={},this.ladder=[],this.priority=[]}getReceiverCapabilities(){let e={};for(let t of Object.keys(this.receivers)){let i=this.receivers.get(t);i&&(e[t]=i)}return e}setAvailableBandwidth(e){this.availableBandwidth=e,this.logger.safe.debug(`Total available bandwidth updated: ${e}`),this.updateLayouts()}getAvailableBandwidth(){return this.availableBandwidth}addReceiverCapability(e,t){this.logger.safe.debug(`Receiver maxBr set: ${e}/${t}`),this.receivers.set(e,t),this.updateLayouts()}removeReceiver(e){this.logger.safe.debug(`Receiver maxBr removed: ${e}`),this.receivers.delete(e),this.updateLayouts()}getLayouts(){return this.currentLayout}setPriority(...e){this.priority=e}setLadder(e,t){for(let i of(this.logger.safe.info(`Set ladder for ${e}: ${JSON.stringify(t)}`),this.ladder))delete i[e];-1===this.priority.indexOf(e)&&this.priority.push(e);for(let i=0;i<t.length;++i)i>=this.ladder.length&&this.ladder.push({}),this.ladder[i][e]=t[i]}updateLayouts(){let e=this.generateLayouts();(0,Vo.isEqual)(e,this.currentLayout)||(this.currentLayout=e,this.logger.safe.debug(`Bandwidth distribution updated: ${t$(e)}`))}generateLayouts(){let e={},t=this.availableBandwidth;for(let t of this.priority)this.receivers.get(t)&&(e[t]=0);for(let i=0;i<this.ladder.length&&t;++i){let n=this.ladder[i];for(let i of this.priority){let r=n[i];if(r&&this.receivers.get(i)){let n=Math.max(0,Math.min(r-e[i],t));t-=n,e[i]+=n}}}if(t){let i=t,n=0;for(let e of this.priority)n+=this.receivers.get(e)??0;for(let r of this.priority){let s=this.receivers.get(r);if(s){let a=Math.min(t,Math.ceil(s*i/n));a&&this.logger.safe.info(`[AllocateSurplus][${r}] ${e[r]} + ${s} | ${t}`),t-=a,e[r]+=a}}}return e}},Vm=class{constructor(e,t,i){this.timeout=t,this.logger=i,this.isFirstTimeDeferred=!0,this.internalCallback=t=>{this.logger.safe.debug(`Trigger reason: ${t}`),e()}}invoke(e){if(this.logger.safe.debug(`Schedule shouldDefer: ${e}`),this.isFirstTimeDeferred)return void(e?(this.isFirstTimeDeferred=!1,this.startTimer()):(this.stopTimer(),this.internalCallback("request")));this.timeoutId&&e||this.internalCallback("request")}dispose(){this.stopTimer()}startTimer(){this.timeoutId||(this.timeoutId=setTimeout(()=>{this.internalCallback("timeout"),this.timeoutId=void 0},this.timeout),this.logger.safe.debug(`Timer started for : ${this.timeout}ms`))}stopTimer(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0,this.logger.safe.debug("Timer stopped"))}},Vv=class{constructor(e,t){this.logger=e,this.configProvider=t,this.currentFrameSize=this.configProvider.getVideoSendLadder().initialResolution.fs}setAvailableBandwidth(e){e!==this.lastSendBW&&(this.logger.safe.debug(`Available bandwidth updated ${e}`),this.processEstimatedBandwidth(e))}setMaxFrameSize(e){return(this.logger.safe.debug(`SetMaxFrameSize ${e}`),e===this.maxFrameSize)?void this.logger.safe.debug(`Max frame size did not change. Do nothing, maxFs: ${e}`):(this.maxFrameSize=e,this.lastSendBW)?void(this.logger.safe.debug(`Setting max frame size: ${e}`),this.processEstimatedBandwidth(this.lastSendBW)):void this.logger.safe.debug("Last send bwe is not defined. Do nothing")}getFrameSize(){return this.currentFrameSize}processEstimatedBandwidth(e){if(this.logger.safe.debug(`Process estimated bandwidth ${e}`),0===e){this.lastSendBW=0,this.proposeResolution(0);return}let{lowRes:t,highRes:i}=this.configProvider.getVideoSendLadder().getResolutionForBitrate(e);this.logger.safe.debug("low",t,"hi",i);let n=e<this.lastSendBW?i.fs:t.fs;if(e<this.lastSendBW&&this.currentFrameSize<n)return void this.logger.safe.debug(`proposed resolution is above the existing one, so we should stay on the current resolution, last bw: ${e}`);n&&this.proposeResolution(n),this.logger.safe.debug(`Updating last bw: ${e}`),this.lastSendBW=e}proposeResolution(e){this.logger.safe.debug(`Propose resolution ${e}`);let t=this.maxFrameSize?Math.min(e,this.maxFrameSize):e;t!==this.currentFrameSize&&(this.currentFrameSize=t,this.logger.safe.debug(`Proposed new frame size: ${t} based on bandwidth: ${this.lastSendBW}`))}},VS=1e8,Vy=[{bwe:2e5,param:5e5},{bwe:5e5,param:12e5},{bwe:8e5,param:25e5},{bwe:12e5,param:4e6}],VC=[{bwe:2e5,param:240},{bwe:3e5,param:405},{bwe:5e5,param:920},{bwe:9e5,param:2040}],Vb=(e,t,i)=>{for(let n of i)if(t<n.bwe)return Math.min(e,n.param);return e},VT=(e,t,i=Vy)=>Vb(e,t,i),VE=(e,t,i=VC)=>Vb(e,t,i),V_=class extends no{constructor(e,t,i){super(t),this.configProvider=e,this.logger=t,this.layoutsNumber=i,this.totalBandwidth=VS,this.totalBandwidthMax=0,this.logger.safe.debug("Created")}dispose(){this.logger.safe.debug("Disposed"),this.outputLayouts=null,super.dispose()}setAvailableBandwidth(e){if(this.storeAvailableBandwidth(e),!this.inputLayouts)return void this.logger.safe.debug("Layouts are not set. Skip update");this.recalculateLayouts(),this.checkForChangesAndNotify()}setLayouts(e,t){if(this.storeAvailableBandwidth(t),e.length!==this.layoutsNumber)return void this.logger.safe.warn(`Incorrect number of layouts! ${JSON.stringify(e)}, expected ${this.layoutsNumber}`);this.logger.safe.debug(`Set layouts: ${JSON.stringify(e)}`),this.inputLayouts=this.getPrioritizedLayouts(e),this.recalculateLayouts(),this.checkForChangesAndNotify()}getLayouts(){return this.inputLayouts}getPrioritizedLayouts(e){return e}checkForChangesAndNotify(){let e=this.getLayouts();if(nA(this.outputLayouts,e))return void this.logger.safe.debug("Layout has not changed, skip update");this.outputLayouts=e.slice(),this.event("onLayoutsChanged").raise()}storeAvailableBandwidth(e){this.logger.safe.debug(`Set available bandwidth: ${e}`),this.totalBandwidth=e,this.totalBandwidthMax=Math.max(this.totalBandwidthMax,this.totalBandwidth)}},VI=class extends V_{constructor(e,t){super(e,t,2),this.resolutionManager=new Vv(this.logger.createChild("BWEControlledResolutionManager"),e)}getLayouts(){return this.hiFiLayout?[this.loFiLayout,this.hiFiLayout]:[this.loFiLayout]}dispose(){super.dispose(),this.resolutionManager=null}getHighLayoutBandwidth(e){let t=this.inputLayouts?.[0].maxBr||0,i=Math.max(e-t,0);return this.logger.safe.debug(`Setting available bandwidth for layouts. High: ${i}, low: ${t||"not set"}, total: ${e}`),Math.floor(i*(this.configProvider.config.specCompliantSimulcast?.allowedBweOvershootRatio||1))}recalculateLayouts(){let e=this.hiFiLayout,t=this.getHighLayoutBandwidth(this.totalBandwidth);this.resolutionManager.setAvailableBandwidth(t),this.resolutionManager.setMaxFrameSize(this.inputLayouts[1].maxFs),this.loFiLayout=this.getMinimalLayoutParams(this.inputLayouts),this.hiFiLayout=this.getHighLayoutParams(this.inputLayouts,t,this.loFiLayout),this.loFiLayout=this.adjustLowLayoutBasedOnHighLayout(this.hiFiLayout,this.loFiLayout,e)}adjustLowLayoutBasedOnHighLayout(e,t,i){return this.configProvider.config.useMediaQualityControllerForceKeyFrame&&!e&&i&&(this.logger.safe.debug("Forcing kayframe on low layout due to disabling high layout"),t.keyframe=!0),e&&t.maxBr===e.maxBr&&t.maxBr--,t}getPrioritizedLayouts(e){return e.sort((e,t)=>e.maxFs-t.maxFs?e.maxFs-t.maxFs:e.maxFps-t.maxFps)}getHighLayoutParams(e,t,i){let n=e[1];if(n.maxBr<=t)return this.logger.safe.debug(`High layout bandwidth suits requested caps. Applying as-is: ${JSON.stringify(n)}`),n;let r={...e[1],maxFs:this.resolutionManager.getFrameSize(),maxBr:Math.min(t,e[1].maxBr),maxFps:e[1].maxFps},s=r.maxBr<i.maxBr||r.maxFs<i.maxFs||r.maxFs===i.maxFs&&r.maxFps<=i.maxFps,a=`Potential high layout: ${JSON.stringify(r)}`;return!this.hiFiLayout&&s?(this.logger.safe.debug(`High layout is already disabled. Do nothing. ${a}`),null):this.hiFiLayout&&s?(this.logger.safe.debug(`High layout gets disabled. ${a}`),null):(this.hiFiLayout&&nA(r,this.hiFiLayout)?this.logger.safe.debug(`High layout has not been changed. Do nothing. ${a}`):this.hiFiLayout?this.logger.safe.debug(`High layout updated. ${a}`):this.logger.safe.debug(`High layout enabled. ${a}`),r)}getMinimalLayoutParams(e){let t=Math.min(e[0].maxBr,e[1].maxBr),i=this.configProvider.config.specCompliantSimulcast.maxBrControlEnabled?VT(t,this.totalBandwidth,this.configProvider.config.specCompliantSimulcast.bitrateToBweTable):t;return{...e[0],maxBr:i,maxFps:Math.min(e[0].maxFps,e[1].maxFps),maxFs:Math.min(e[0].maxFs,e[1].maxFs)}}},Vw=class extends V_{constructor(e,t,i){super(t,i,1),this.couldLimitFs=e}getLayouts(){return[this.layout]}recalculateLayouts(){let e=this.inputLayouts[0].maxFs;if(this.configProvider.config.specCompliantSimulcast.allowResLimit&&this.couldLimitFs&&this.totalBandwidthMax){let t=this.configProvider.config.specCompliantSimulcast.fsToBweTable;e=VE(this.inputLayouts[0].maxFs,this.totalBandwidthMax,t)}let t=this.configProvider.config.specCompliantSimulcast.bitrateToBweTable,i=VT(this.inputLayouts[0].maxBr,this.totalBandwidth,t);this.layout={...this.inputLayouts[0],maxFs:e,maxBr:i}}},VP=class extends no{constructor(e){super(e),this.logger=e,this.logger.safe.debug("Created")}dispose(){this.logger.safe.debug("Disposed"),super.dispose()}setAvailableBandwidth(e){this.logger.safe.debug(`Available bandwidth updated ${e}`)}setLayouts(e,t){this.layouts=e,this.setAvailableBandwidth(t)}getLayouts(){return this.layouts}},VR=(e,t)=>e.maxFs===t.maxFs?e.maxFps===t.maxFps?e.maxBr-t.maxBr:e.maxFps-t.maxFps:e.maxFs-t.maxFs,VA=(e,t)=>e.maxFs===t.maxFs?e.maxFps-t.maxFps:e.maxFs-t.maxFs,VM=class extends no{constructor(e,t,i){super(i),this.settings=e,this.configProvider=t,this.logger=i,this.totalBandwidthMax=0,this.totalBandwidth=VS,this.inputLayouts=null,this.outputLayouts=null,this.maxOutputLayers=0,this.ladder=[],this.settings.ladder?this.ladder.push(...this.settings.ladder):this.ladder.push(...t.getVideoSendLadder().getResolutions())}dispose(){this.logger.safe.debug("Disposed"),super.dispose()}setAvailableBandwidth(e){this.updateAvailableBandwidth(e),this.update()}setLayouts(e,t){this.inputLayouts=e,this.updateAvailableBandwidth(t),this.update()}getLayouts(){return this.outputLayouts??[]}updateAvailableBandwidth(e){this.totalBandwidth!==Math.max(1,e)&&(this.logger.safe.debug(`Available bandwidth updated ${e}`),this.totalBandwidth=Math.max(1,e),this.totalBandwidthMax=Math.max(this.totalBandwidthMax,this.totalBandwidth))}debug(e,t,...i){let n,r=e=>({FS:e.maxFs,FPS:e.maxFps,BR:e.maxBr,KF:e.keyframe?"1":"0",id:`rid:${e.rid}`});n=Array.isArray(t)?t.map(r):r(t),this.logger.safe.info(`${e}: <${i.map(e=>JSON.stringify(e)).join("><")}> ${JSON.stringify(n)}`)}update(){let e=this.settings.allowedOvershoot||1,t=this.adjustLayout(this.inputLayouts,this.totalBandwidth*e);if(nA(this.outputLayouts,t))this.logger.safe.debug("Layout has not changed, skip update");else{if(this.settings.allowLayerBitrateOverlap&&t.length&&t.length<this.inputLayouts.length&&(this.setMinimumQuality(t[0],this.inputLayouts),this.debug("SetMinimumQuality",t[0])),this.outputLayouts&&this.settings.forceKeyFrameWhenLayerIsRemoved&&this.outputLayouts.length>t.length)for(let e of t)this.logger.safe.debug(`Force key frame for rid:${e.rid}`),e.keyframe=!0;this.outputLayouts=t,this.maxOutputLayers=Math.max(this.maxOutputLayers,this.outputLayouts.length),this.event("onLayoutsChanged").raise()}}adjustLayout(e,t){let i=[];if(e.length){if(e=e.map(e=>Object.assign({},e)).sort(VR),this.debug("OriginalLayout",e),this.settings.minFrameSizeForSimulcast?.length>1){let t=this.settings.minFrameSizeForSimulcast;3===e.length&&t?.length===2&&e[e.length-1].maxFs<t[1]&&this.debug("DisableLowResStream",e.pop())}for(this.settings.highPriorityLayoutMinFS&&e.length>1&&e[e.length-1].maxFs>=this.settings.highPriorityLayoutMinFS&&this.settings.lowPriorityLayoutMaxFS?.length&&this.limitResolutionOnLowerSimulcastStreams(e);e.length>0&&t>0;){let n=e.shift();this.debug("Next",n,t),this.settings.allowLayerBitrateOverlap||this.setMinimumQuality(n,e);let r=t-n.maxBr;if(i.length>0){if(r<0&&this.degradeBitrateOrResolution(n,t)&&(this.debug("DegradeBitrateOrResolution",n),r=t-n.maxBr),r>=0){let e=!1;for(let t of i)if(e=VA(t,n)>=0,!this.settings.allowLayerBitrateOverlap&&n.maxBr<t.maxBr&&(e=!0),e){this.debug("Drop",n,i.length);break}e||(i.push(n),this.debug("Accept",n,i.length))}}else i.push(n),this.debug("Accept",n,i.length);t=r}this.debug("AdjustedLayout",i,t)}if(1===i.length)if(this.settings.minSinglecastBitrate||this.settings.singlecastLadder){let e=Math.max(this.settings.minSinglecastBitrate??this.totalBandwidth,this.totalBandwidth);this.settings.forceSinglecastLadder&&this.settings.singlecastLadder?this.forceLadder(i[0],e,this.settings.singlecastLadder)&&this.debug("ForceSinglecastLadder",i[0],e):i[0].maxBr>e&&this.degradeBitrateOrResolution(i[0],e,this.settings.singlecastLadder)&&this.debug("DegradeSinglecast",i[0],e)}else{if(this.settings.limitMaxResolution&&this.maxOutputLayers<=1){let e=this.configProvider.config.specCompliantSimulcast?.fsToBweTable;i[0].maxFs=VE(i[0].maxFs,this.totalBandwidthMax,e),this.debug("LimitMaxFS",i[0],this.totalBandwidthMax)}if(this.settings.limitMaxBitrate){let e=this.configProvider.config.specCompliantSimulcast?.bitrateToBweTable;i[0].maxBr=VT(i[0].maxBr,this.totalBandwidth,e),this.debug("LimitMaxBitrate",i[0],this.totalBandwidth)}}return i}limitResolutionOnLowerSimulcastStreams(e){let t=e.pop();if(1===e.length){let t=this.settings.lowPriorityLayoutMaxFS[0];this.degradeResolutionTo(e[0],t)&&this.debug("DegradeResolutionTo",e[0],0,t)}else{let t=[...this.settings.lowPriorityLayoutMaxFS];t.sort(),e.splice(Math.min(2,t.length));for(let i=0;i<e.length;++i)this.degradeResolutionTo(e[i],t[i])&&this.debug("DegradeResolutionTo",e[i],i,t[i])}e.push(t)}setMinimumQuality(e,t){for(let i of t)e.maxBr=Math.min(i.maxBr,e.maxBr),e.maxFs=Math.min(i.maxFs,e.maxFs),e.maxFps=Math.min(i.maxFps,e.maxFps),e.maxMbps=e.maxFs*e.maxFps}degradeResolutionTo(e,t){for(;e.maxFs>t;)if(!this.degradeResolution(e))return!1;return!0}degradeResolution(e){let t=this.mapLayoutToLadder(e);if(t>=this.ladder.length)return!1;if(t>0){let i=this.ladder[t-1];return e.maxBr=Math.min(e.maxBr,i.maxBitrate),e.maxMbps=i.fs*i.fps,e.maxFps=i.fps,e.maxFs=i.fs,!0}return!1}degradeBitrateOrResolution(e,t,i){i??(i=this.ladder);let n=this.mapLayoutToLadder(e,i);if(n>=i.length)return!1;if(t>=i[n].minBitrate)return e.maxBr=t,!0;let r=n;for(;r>0;){let n=i[--r];if(t>=n.minBitrate)return e.maxMbps=n.fs*n.fps,e.maxFps=n.fps,e.maxFs=n.fs,e.maxBr=Math.min(t,n.maxBitrate),!0}return!1}forceLadder(e,t,i){i??(i=this.ladder);let n=this.mapLayoutToLadder(e,i);if(n>=i.length)return!1;let r=Math.min(t,e.maxBr);if(r>=i[n].minBitrate){let t=i[n];return r=Math.min(r,t.maxBitrate),(e.maxMbps!==t.fs*t.fps||e.maxBr!==r)&&(e.maxMbps=t.fs*t.fps,e.maxFps=t.fps,e.maxFs=t.fs,e.maxBr=r,!0)}return this.degradeBitrateOrResolution(e,r,i)}mapLayoutToLadder(e,t){let i=0,n=0;for(t??(t=this.ladder);n<t.length&&!(t[n].fs>e.maxFs)&&(t[n].fs!==e.maxFs||!(t[n].fps>e.maxFps));)i=n++;return i}},VD=((f=VD||{})[f.ThreeStreamSimulcast=0]="ThreeStreamSimulcast",f[f.HardwareEncoder=1]="HardwareEncoder",f[f.Encode1080P=2]="Encode1080P",f[f.BroadcastMode=3]="BroadcastMode",f),VO=class extends no{constructor(e,t){super(t),this.mediaType=e,this.logger=t,this.features={}}notify(){super.raiseChanged()}find(e){var t;return(t=this.features)[e]??(t[e]={})}set(e,t,i){let n=this.find(e),r=!1;return void 0!==t&&n.server!==t&&(this.logger.safe.info(`Server support for [${this.mediaType}][${VD[e]}] changed from ${n.server} to ${t}`),n.server=t,r=!0),void 0!==i&&n.client!==i&&(this.logger.safe.info(`Client support for [${this.mediaType}][${VD[e]}] changed from ${n.client} to ${i}`),n.client=i,r=!0),r}toggleServer(e,t){return!!this.set(e,t,void 0)&&(this.notify(),!0)}toggleClient(e,t){return!!this.set(e,void 0,t)&&(this.notify(),!0)}toggle(e,t){return!!this.set(e,t,t)&&(this.notify(),!0)}hasAnySupport(e){let t=this.find(e);return!0===t.client||!0===t.server}hasFullSupport(e){let t=this.find(e);return!0===t.client&&!0===t.server}hasClientSupport(e){return!0===this.find(e).client}hasServerSupport(e){return!0===this.find(e).server}},Vk=class extends no{constructor(e){for(let t of(super(e),this.logger=e,this.modalities={Video:new VO("Video",this.logger),ScreenShare:new VO("ScreenShare",this.logger)},this.blocked=new Set,Object.keys(this.modalities)))this.modalities[t].changed(()=>{this.notify(this.modalities[t],!1)})}notify(e,t){this.blocked.has(e.mediaType)&&!0!==t||(this.blocked.add(e.mediaType),this.logger.safe.info(`Notify: ${e.mediaType}`),this.event("onVideoFeaturesChanged").raise(e),this.blocked.delete(e.mediaType))}manageFeatureSupport(e){for(let e of Object.values(this.modalities))this.blocked.add(e.mediaType);for(let t of(e(),[...this.blocked]))this.notify(this.modalities[t],!0)}get(e){if(!this.modalities[e])throw this.logger.safe.error(`Unsupported media type: ${e}`),Error(`Unsupported media type: ${e}`);return this.modalities[e]}},VN=class extends no{constructor(e,t,i,n){super(n),this.supportSingleBwControl=e,this.firstTime=t,this.configProvider=i,this.logger=n,this.multiStream=!1,this.wasMultistream=!0,this.deferredOperation=new Vm(()=>this.updateStrategy(),this.configProvider.config.layoutControlTimeout,this.logger.createChild("DeferredOperation")),this.simulcastStrategySettings=void 0,this.wasMultistream=!1,this.createStrategy(this.multiStream,this.firstTime)}configure(e){let t=this.isMultiStream(e);this.multiStream!==t&&(this.multiStream=t,this.simulcastStrategySettings||this.deferredOperation.invoke(this.multiStream&&!this.configProvider.config.specCompliantSimulcast?.maxBrControlEnabled))}onFeaturesChanged(e){let t={},i=this.configProvider.config.specCompliantSimulcast,n=!1;e.hasServerSupport(0)&&(n=!0),e.hasClientSupport(2)&&this.configProvider.config.video1080p?.useSimulcastLayoutControlStrategy&&(n=!0),e.hasClientSupport(3)&&this.configProvider.config.broadcastMode?.prioritizeLayoutOnClient&&(n=!0),t.limitMaxBitrate=i?.maxBrControlEnabled,t.limitMaxResolution=i?.allowResLimit,t.allowedOvershoot=i?.allowedBweOvershootRatio,t.forceKeyFrameWhenLayerIsRemoved=this.configProvider.config.useMediaQualityControllerForceKeyFrame,n&&t.limitMaxResolution&&(t.limitMaxResolution=this.firstTime&&!this.wasMultistream),e.hasClientSupport(2)&&(e.hasClientSupport(1)||(t.highPriorityLayoutMinFS=this.configProvider.config.video1080p?.software?.highPriorityLayoutMinFS,t.lowPriorityLayoutMaxFS=this.configProvider.config.video1080p?.software?.lowPriorityLayoutMaxFS),t.minSinglecastBitrate=this.configProvider.config.video1080p?.minSinglecastBitrate,this.configProvider.config.video1080p?.singlecastLayoutLadder&&(t.singlecastLadder=ri(this.configProvider.config.video1080p.singlecastLayoutLadder)),t.forceSinglecastLadder=this.configProvider.config.video1080p?.forceSinglecastLadder),e.hasClientSupport(3)&&(t.highPriorityLayoutMinFS=this.configProvider.config.broadcastMode?.priorityLayoutMinFS,t.lowPriorityLayoutMaxFS=this.configProvider.config.broadcastMode?.lowPriorityLayoutMaxFS),e.hasServerSupport(0)&&(t.minSinglecastBitrate=t.minSinglecastBitrate??i?.minSinglecastBitrate,t.allowLayerBitrateOverlap=i?.allowLayerBitrateOverlap,i?.singlecastLadder&&(t.singlecastLadder=t.singlecastLadder??ri(i?.singlecastLadder)),i.dropLowResolutionHigherStreams&&(t.minFrameSizeForSimulcast=i.video?.minFsForSimulcast)),!!this.simulcastStrategySettings===n&&nA(t,this.simulcastStrategySettings)||(n?(this.logger.safe.info(`[SLCS] Configure [${this.simulcastStrategySettings?"existing":"initial"}][${this.wasMultistream}]: ${JSON.stringify(t)}`),this.simulcastStrategySettings=t):(this.simulcastStrategySettings&&this.logger.safe.info("[SLCS] Disable"),this.simulcastStrategySettings=void 0),this.deferredOperation.invoke(!1))}setLayouts(e,t){if(nA(this.latestLayouts,e)&&this.latestBandwidth===t)return void this.logger.safe.debug("Layouts and bandwidth are not changed. Skipping update");this.latestLayouts=e,this.latestBandwidth=t,this.strategy.setLayouts(this.latestLayouts,t)}setAvailableBandwidth(e){if(this.latestBandwidth===e)return void this.logger.safe.debug("Bandwidth is not changed. Skipping update");this.strategy.setAvailableBandwidth(e),this.latestBandwidth=e}getLayouts(){return this.strategy.getLayouts()}dispose(){this.strategy.dispose(),this.strategy=null,this.deferredOperation.dispose(),this.deferredOperation=null,super.dispose()}updateStrategy(){this.strategy.dispose(),this.createStrategy(this.multiStream),this.latestLayouts&&this.strategy.setLayouts(this.latestLayouts,this.latestBandwidth)}isMultiStream(e){return e>1}createStrategy(e,t=!1){this.strategy=this.getNewStrategy(e,t),this.strategy.on("onLayoutsChanged",()=>{this.wasMultistream=this.wasMultistream||this.isMultiStream(this.strategy.getLayouts().length),this.event("onLayoutsChanged").raise()})}getNewStrategy(e,t){return this.simulcastStrategySettings?new VM(this.simulcastStrategySettings,this.configProvider,this.logger.createChild("SimulcastLayoutControlStrategy")):e?new VI(this.configProvider,this.logger.createChild("BWEControlledStrategy")):this.configProvider.config.specCompliantSimulcast?.maxBrControlEnabled&&this.supportSingleBwControl?new Vw(t,this.configProvider,this.logger.createChild("BWEControlledStrategySingle")):new VP(this.logger.createChild("NoControlStrategy"))}},Vx=class extends no{constructor(e,t,i){super(t),this.configProvider=e,this.logger=t,this.videoFeatures=i,this.bandwidthAllocator=null,this.sendBandwidthCalculator=new $z(this.configProvider,this.logger.createChild("SendBandwidthCalculator")),this.layoutProviders=new Map,this.hadLayoutProvider=new Set,this.useNewBandwidthAllocator=!1,this.highestVideoMaxFsWithSharingEnabled=0,this.lastBwLayouts={},this.bandwidthAllocator=Vd(this.logger,this.configProvider),this.sendBandwidthCalculator.on("onSendBandwidthChanged",e=>this.onAvailableBandwidthChanged(e)),this.configProvider.config.sendBandwidthSeedValue&&this.bandwidthAllocator.setAvailableBandwidth(this.configProvider.config.sendBandwidthSeedValue),this.useVideoFeatures("Video")&&this.videoFeatures.on("onVideoFeaturesChanged",e=>{if(this.useVideoFeatures(e.mediaType)){let t=this.layoutProviders.get(e.mediaType);t&&t.onFeaturesChanged(e)}if(!this.useNewBandwidthAllocator&&this.configProvider.config.bandwidthAllocatorV2.enableAllocator){let t=!1;e.hasServerSupport(0)&&(t=!0),e.hasClientSupport(2)&&this.configProvider.config.video1080p?.useNewBandwidthAllocator&&(t=!0),t&&this.switchBandwidthAllocator()}})}dispose(){this.bandwidthAllocator=null,this.layoutProviders.forEach(e=>e.dispose()),this.layoutProviders.clear(),this.layoutProviders=null,super.dispose()}addReceiver(e,t){if(this.logger.safe.debug(`Set receiver max capabilities for ${e}: ${JSON.stringify(t)}`),this.configProvider.config.updateLadderTypeFromVdclc){let i=this.configProvider.getVideoSendLadder();t[0].ladderType&&i.getCurrentVideoLadderType()!==t[0].ladderType&&(this.logger.safe.info(`Switching video send ladder from ${i.getCurrentVideoLadderType()} to ${t[0].ladderType} for ${e}`),i.updateVideoSendLadder(t[0].ladderType),this.layoutProviders.get(e)?.dispose(),this.layoutProviders.delete(e))}this.configureProviders(e,t.length);let i=t.map(e=>e.maxBr).reduce((e,t)=>e+t);if(this.useNewBandwidthAllocator&&"Video"===e&&this.layoutProviders.has("ScreenShare")&&this.configProvider.config.bandwidthAllocatorV2.enableDynamicVideoLadder){let e=Math.max(...t.map(e=>e.maxFs));e>this.highestVideoMaxFsWithSharingEnabled&&(this.highestVideoMaxFsWithSharingEnabled=e,this.bandwidthAllocator.setLadder("Video",Vg(this.configProvider,e)))}this.bandwidthAllocator.addReceiverCapability(e,i);let n=this.bandwidthAllocator.getLayouts();this.layoutProviders.get(e).setLayouts(t,n[e]),this.updateBandwidthDistribution()}removeReceiver(e){this.logger.safe.debug(`Removing receiver for ${e}`),this.layoutProviders.get(e)?.dispose(),this.layoutProviders.delete(e),this.highestVideoMaxFsWithSharingEnabled=0,delete this.lastBwLayouts[e],this.bandwidthAllocator.removeReceiver(e),this.updateBandwidthDistribution()}getLayouts(e){return this.layoutProviders.get(e).getLayouts()}onDiagnosticUpdated(e){e.video?.send?.length&&e.video?.send[0]&&(this.configProvider.config.diagnostics.traceLogging&&this.logger.safe.debug("Caught onDiagnosticUpdated: Estimating send bandwidth"),this.sendBandwidthCalculator.onBandwidthChanged($G(e.video.send[0],this.configProvider)))}useVideoFeatures(e){return"Video"===e&&(!!this.configProvider.config.specCompliantSimulcast?.enableSimulcastLayoutControlStrategy||!!this.configProvider.config.broadcastMode?.prioritizeLayoutOnClient||!!this.configProvider.config.video1080p?.useSimulcastLayoutControlStrategy)}switchBandwidthAllocator(){let e=Vp(this.logger,this.configProvider);e.setAvailableBandwidth(this.bandwidthAllocator.getAvailableBandwidth());let t=this.bandwidthAllocator.getReceiverCapabilities();for(let i of Object.keys(t))e.addReceiverCapability(i,t[i]);this.useNewBandwidthAllocator=!0,this.bandwidthAllocator=e,this.updateBandwidthDistribution()}configureProviders(e,t){if(!this.layoutProviders.has(e)){let t=this.createProvider(e);this.layoutProviders.set(e,t)}this.useVideoFeatures(e)&&t>2&&this.videoFeatures.get(e).toggleServer(0,!0),this.layoutProviders.get(e).configure(t)}createProvider(e){let t=new VN("Video"===e,!this.hadLayoutProvider.has(e),this.configProvider,this.logger.createChild(`LG:${e}`));return t.on("onLayoutsChanged",()=>{let i=t.getLayouts();this.logger.safe.debug(`New layouts generated: ${JSON.stringify(i)}`),this.event("onLayoutsUpdated").raise(e)}),this.hadLayoutProvider.add(e),this.useVideoFeatures(e)&&t.onFeaturesChanged(this.videoFeatures.get(e)),t}onAvailableBandwidthChanged(e){this.bandwidthAllocator.setAvailableBandwidth(e),this.updateBandwidthDistribution()}adjustBandwidthDistribution(e,t){let i=new Map;t?(i.set("ScreenShare",this.configProvider.config.bandwidthAllocatorV2?.sharing?.remote),i.set("Video",this.configProvider.config.bandwidthAllocatorV2?.video?.remote)):(i.set("ScreenShare",this.configProvider.config.bandwidthAllocatorV2?.sharing?.local),i.set("Video",this.configProvider.config.bandwidthAllocatorV2?.video?.local));let n=Vh({...e},i);for(let i of["Video","ScreenShare"])n[i]!==e[i]&&this.logger.safe.info(`Adjusted ${t?"remote":"local"} ${i} BWE from ${e[i]} to ${n[i]}`);return n}updateBandwidthDistribution(){let e,t=this.bandwidthAllocator.getLayouts();for(let[i,n]of(e=t,this.useNewBandwidthAllocator&&(e=this.adjustBandwidthDistribution(t,!1)),Object.entries(e)))this.layoutProviders.get(i)?.setAvailableBandwidth(n);if(this.configProvider.config.mediaControlPlaneConfig?.enableSendBandwidthNotificationsEnabled){if(e=t,this.useNewBandwidthAllocator&&(e=this.adjustBandwidthDistribution(t,!0)),this.configProvider.config.webrtcSendBandwidthPreventDuplicateValue)for(let[t,i]of Object.entries(e))i!==this.lastBwLayouts[t]?this.lastBwLayouts[t]=i:delete e[t];Object.entries(e).length>0&&this.event("onBandwidthAllocationUpdated").raise(e)}}},VL=i(892891);function VF(e,t,i){if("Video"!==e||!i)return i;let{maxBitrate:n,maxResolution:r,maxFramerate:s}=t.config.outgoingVideoLimit??{},a=n??1/0,o=r?rl(r):1/0,l=s??1/0;return(t.config.sendVideoCapabilityManager?.isEnabled&&(o=1/0,l=1/0),a===1/0&&o===1/0&&l===1/0)?i:i.map(e=>({...e,maxFs:nf(e.maxFs,o),maxBr:nf(e.maxBr,a),maxFps:nf(e.maxFps,l)}))}var VU=new Set(["maintain-framerate","maintain-resolution","balanced"]),V$=class{constructor(e,t){this.configProvider=e,this.logger=t}async setActive(e,t){let i=this.getSenderParameters(e);return i.encodings[0].active=t,this.setSenderParameters(e,i,"setActive")}getScaleFactor(e,t){if(!t.width||!t.height)return this.logger.safe.warn("Stream resolution is not set yet. Cannot calculate scale factor. Returning 1"),1;let i=this.configProvider.getVideoSendLadder().getResolutionByFs(e),n=Math.min(t.width,t.height)/i.height;return this.logger.safe.debug(`Scale factor is taken from resolution: ${JSON.stringify(t)} and new Fs: ${e} as ${n}`),n<1&&(this.logger.safe.warn("Scale factor cannot be less than 1! Limiting to 1"),n=1),n}async generateKeyFrameIfNeeded(e,t){if(!t.track)return void this.logger.safe.info("No track attached. Skipping");let i=this.getSenderParameters(t),n=e.filter(e=>e.keyframe).map(e=>e.rid);if(0===n.length||!i.encodings.some(e=>e.active))return void this.logger.safe.info("No keyframes needed. Skipping");if(this.configProvider.config.useKeyFrameApi){let e=[];i.encodings.forEach(t=>{t.active&&(!t.rid||n.includes(t.rid))?e.push({keyFrame:!0}):e.push({keyFrame:!1})}),await this.setSenderParameters(t,i,"generateKeyFrameAPI",!0,{encodingOptions:e})}else{let e=i.encodings.map((e,t)=>e.active&&(!e.rid||n.includes(e.rid))?{idx:t,factor:e.scaleResolutionDownBy||1}:null).filter(e=>e);for(let t of e)i.encodings[t.idx].scaleResolutionDownBy=t.factor*this.configProvider.config.forceKeyFrameV2ScaleFactor;this.logger.safe.debug(`Restoring keyframe starting. Update scaleResolutionDownBy for encodings: ${JSON.stringify(i.encodings)}`),await this.setSenderParameters(t,i,"generateKeyFrameStart");let r=this.getSenderParameters(t);for(let t of e)r.encodings[t.idx].scaleResolutionDownBy=t.factor;await this.setSenderParameters(t,r,"generateKeyFrameEnd"),this.logger.safe.debug(`Restoring keyframe completed. Set scaleResolutionDownBy back for encodings: ${JSON.stringify(r.encodings)}`)}}getSenderParameters(e){let t=e.getParameters();if(t.encodings?.length||(t.encodings=[{}]),this.configProvider.config.reuseLastSetParameters&&this.lastSetEncodings){this.logger.safe.info(`Override returned encodings ${JSON.stringify(t.encodings)}`);let e=(0,VL.merge)((0,VL.cloneDeep)(t.encodings),this.lastSetEncodings);this.logger.safe.info(`Overrided encodings ${JSON.stringify(e)}`),t.encodings=e}return t}async setSenderParameters(e,t,i,n=!0,r){try{await e.setParameters(t,r),this.logger.safe.info(`${i}: Parameters applied for sender: encodings: ${JSON.stringify(t.encodings)}, degradationPreference: ${t.degradationPreference}`),this.lastSetEncodings=t.encodings}catch(r){let e=`${i}: setParameters failed. Parameters: ${JSON.stringify(t.encodings)}, error:  ${t$(r)}`;if(this.logger.safe.error(e),n)throw Error(e)}}getAdjustedBitrate(e,t){let i=e||0,{maxBitrate:n}=this.configProvider.getVideoSendLadder().getBitrateForResolution(t.width,t.height);return Math.min(i||n,n)}async updateStreamParameters(e,t,i){if(e.getCurrentConstraints().withEffect&&t?.maxFs){let i=this.configProvider.getVideoSendLadder().getResolutionByFs(t.maxFs),n={width:i.width,height:i.height};this.logger.safe.info(`Applying video constrains for video effetcs ${JSON.stringify(n)}`),e.resetEffectsOutputConstraints(n)}i&&await e.applyCapabilities(t)}augmentDegradationPreference(e,t){VU.has(t)&&e.degradationPreference!==t&&(e.degradationPreference=t,this.logger.safe.info(`degradationPreference changed to: ${e.degradationPreference}`))}async setEncodingsActiveState(e,t,i){this.logger.safe.info(i);let n=this.getSenderParameters(e);return n.encodings.forEach(e=>e.active=t),this.setSenderParameters(e,n,i)}},VV=class{constructor(e,t,i){this.config=e,this.configProvider=t,this.logger=i,this.capabilitiesHelper=new V$(this.configProvider,this.logger)}get streamResolution(){return this.stream?.getCurrentConstraints().withEffect?this._streamResolutionFromCapabilities:this._streamResolution}setSender(e){this.rtpSender=e}updateStream(e){this.stream=e,this._streamResolution=e.getResolution(),this._streamResolutionFromCapabilities=this._streamResolution}setActive(e){return this.capabilitiesHelper.setActive(this.rtpSender,e)}async setCapabilities(e){if((0,VL.isEqual)(this.currentCapabilities,e))return void this.logger.safe.info(`Capabilities already applied: ${JSON.stringify(e)}. Do nothing`);this.defaultCapabilities=(0,VL.cloneDeep)(e),this.currentCapabilities=(0,VL.cloneDeep)(e),await this.applyLastCapabilities(),await this.capabilitiesHelper.generateKeyFrameIfNeeded(e,this.rtpSender)}async updateStreamQualityParams(e,t,i){return!e||(0,VL.isEqual)(this.streamResolution,e)?void this.logger.safe.debug(`Resolution is not defined or same: ${JSON.stringify(e)}@${t}`):(this._streamResolution=e,this._streamResolutionFromCapabilities=e,this.logger.safe.info(`Stream params changed: ${JSON.stringify(e)}@${t}@${i} id: ${this.rtpSender.track?.id}`),this.applyLastCapabilities())}async startSender(){if(vm(this.configProvider,this.stream)||vv(this.configProvider,this.stream))return this.capabilitiesHelper.setEncodingsActiveState(this.rtpSender,!0,"Starting senders.")}async stopSender(){return this.capabilitiesHelper.setEncodingsActiveState(this.rtpSender,!1,"Stopping senders.")}async applyLastCapabilities(){if(!this.currentCapabilities)return void this.logger.safe.info("Capabilities are not set. Do nothing");this.currentCapabilities=VF(this.stream.mediaType,this.configProvider,this.defaultCapabilities),await this.applyStreamCapabilities(this.currentCapabilities);let e=this.capabilitiesHelper.getSenderParameters(this.rtpSender),t=(0,VL.cloneDeep)(e);return this.currentCapabilities.forEach(t=>{let i=this.getEncondingIndexForRid(t.rid,e.encodings);this.updateEncodingsWithCaps(e.encodings[i],t)}),this.capabilitiesHelper.augmentDegradationPreference(e,this.configProvider.config.degradationPreference),this.updateActiveStates(e,this.currentCapabilities),this.logger.safe.info(`Encoding params new: ${JSON.stringify(e.encodings)}, old: ${JSON.stringify(t.encodings)}`),this.capabilitiesHelper.setSenderParameters(this.rtpSender,e,"applyCapabilities")}async applyCallConstraints(e){return this.logger.safe.info(`[${e}] Applying call constraints`),this.applyLastCapabilities()}async applyStreamCapabilities(e){if("Video"!==this.stream.mediaType||!e.length)return;let t=e[0];for(let i of e)t.maxFs<i.maxFs&&(t=i);if(e.length>1){let i=this.configProvider.config.specCompliantSimulcast.video.minFsForSimulcast;if(t=(0,VL.cloneDeep)(t),i?.length>0)for(let n=0;n<i.length;++n)e.length>n+1&&(t.maxFs=Math.max(i[n]||0,t.maxFs),t.maxFps=Math.max(...e.map(e=>e.maxFps)))}let i=this.configProvider.config.specCompliantSimulcast.video.useApplyConstraints;await this.capabilitiesHelper.updateStreamParameters(this.stream,t,i),i&&(this._streamResolution=this.stream.getResolution())}getEncondingIndexForRid(e,t){if(!e)return this.logger.safe.error("No RID found in incoming params. Returning index 0"),0;let i=t.findIndex(t=>t.rid===e);return i<0||i-1>this.config.layerScaleFactors.length?(this.logger.safe.error("Incorrect index deduced from requested RID. Returning index 0"),0):i}updateEncodingsWithCaps(e,t){if(!e)return void this.logger.safe.error(`SenderParams does not exist for caps: ${JSON.stringify(t)}`);if(e.maxBitrate=t.maxBr,e.scaleResolutionDownBy=this.capabilitiesHelper.getScaleFactor(t.maxFs,this.streamResolution),e.maxFramerate=t.maxFps,this.config.defaultScalabilityMode&&(e.scalabilityMode=this.config.defaultScalabilityMode),this.configProvider.config.specCompliantSimulcast.video?.useScaleResolutionDownTo){let i=this.configProvider.getVideoSendLadder().getResolutionByFs(t.maxFs);i?.width&&i.height?e.scaleResolutionDownTo={maxWidth:i.width,maxHeight:i.height}:this.logger.safe.warn("Invalid target resolution obtained. Skipping scaleResolutionDownTo assignment.")}}updateActiveStates(e,t){let i=e.encodings.map(e=>e.rid),n=i.filter(e=>t.some(t=>e===t.rid)),r=nF(i,n);n.forEach(t=>this.changeEncodingState(e,t,!0)),r.forEach(t=>this.changeEncodingState(e,t,!1))}changeEncodingState(e,t,i){let n=e.encodings.find(e=>e.rid===t);if(!n)return void this.logger.safe.error(`Encoding not found for RID: ${t}`);n.active=i}},VB=class{constructor(e,t){this.configProvider=e,this.logger=t,this.capabilitiesHelper=new V$(this.configProvider,this.logger)}get params(){return this.currentCapabilities?.find(e=>"1"===e.rid)??this.currentCapabilities?.[0]}get useSetParameter(){if("ScreenShare"===this.stream.mediaType){if(this.configProvider.config.useSetParametersToApplySSCapabilities)return this.logger.safe.info("useSetParametersToApplySSCapabilities: true"),!0;if(!1===this.configProvider.config.useSetParametersToApplySSCapabilities)return this.logger.safe.info("useSetParametersToApplySSCapabilities: false"),!1}return!!this.configProvider.config.useSetParametersToApplyCapabilities&&(this.logger.safe.info("useSetParametersToApplyCapabilities"),!0)}async applyCallConstraints(e){return this.logger.safe.info(`[${e}] Applying call constraints`),this.applyLastCapabilities(3)}setSender(e){this.rtpSender=e}updateStream(e){this.stream=e,this.streamResolution=e.getResolution()}setActive(e){return this.capabilitiesHelper.setActive(this.rtpSender,e)}async setCapabilities(e){return(0,VL.isEqual)(this.currentCapabilities,e)?void this.logger.safe.info(`Capabilities already applied: ${JSON.stringify(e)}. Do nothing`):1!==e.length?void this.logger.safe.error("Incorrect number of sender params!"):void(this.defaultCapabilities=(0,VL.cloneDeep)(e),this.currentCapabilities=(0,VL.cloneDeep)(e),await this.applyLastCapabilities(0),await this.capabilitiesHelper.generateKeyFrameIfNeeded(e,this.rtpSender))}async updateStreamQualityParams(e,t,i){return!e||(0,VL.isEqual)(this.streamResolution,e)?void this.logger.safe.debug(`Resolution is not defined or same: ${JSON.stringify(e)}@${t}`):(this.streamResolution=e,this.logger.safe.debug(`Stream params changed: ${JSON.stringify(e)}@${t}`),this.applyLastCapabilities(i))}async startSender(e){this.logger.safe.info(`Replace sender with track: ${e.id}`),await this.rtpSender.replaceTrack(e),this.logger.safe.info("replaceTrack completed"),vm(this.configProvider,this.stream)&&await this.capabilitiesHelper.setEncodingsActiveState(this.rtpSender,!0,"Starting senders."),vv(this.configProvider,this.stream)&&await this.capabilitiesHelper.setEncodingsActiveState(this.rtpSender,!0,"Starting senders."),this.configProvider.config.applySenderParamsBeforeStart&&this.currentCapabilities&&await this.capabilitiesHelper.generateKeyFrameIfNeeded(this.currentCapabilities,this.rtpSender)}async stopSender(){if(vm(this.configProvider,this.stream)||vv(this.configProvider,this.stream))return this.capabilitiesHelper.setEncodingsActiveState(this.rtpSender,!1,"Stopping senders.");this.logger.safe.info("Replace sender with track: null"),await this.rtpSender.replaceTrack(null),this.logger.safe.info("replaceTrack completed")}async applyLastCapabilities(e){if(!this.currentCapabilities)return void this.logger.safe.debug("Capabilities are not yet set, nothing to apply");this.currentCapabilities=VF(this.stream.mediaType,this.configProvider,this.defaultCapabilities),this.logger.safe.info(`Applying params: ${JSON.stringify(this.params)}`),await this.applyParams(this.params,e),await this.applyBitrate(this.params.maxBr)}applyBitrate(e){let t=e||0;return"Video"===this.stream.mediaType&&(t=this.capabilitiesHelper.getAdjustedBitrate(t,this.streamResolution)),this.setSingleEncodingParameters(this.rtpSender,{maxBitrate:t},"applyBitrate",!1)}async applyParams(e,t){if(this.useSetParameter)return this.setSingleEncodingParameters(this.rtpSender,{scaleResolutionDownBy:this.capabilitiesHelper.getScaleFactor(e.maxFs,this.streamResolution),maxFramerate:e.maxFps},"applyParams");2!==t&&await this.capabilitiesHelper.updateStreamParameters(this.stream,e,!0)}async setSingleEncodingParameters(e,t,i,n=!0){let r=this.capabilitiesHelper.getSenderParameters(e);return(0,VL.merge)(r.encodings[0],t),0===r.encodings[0].maxBitrate&&(this.configProvider.config.setParametersMaxBitrateUndefined?r.encodings[0].maxBitrate=void 0:delete r.encodings[0].maxBitrate),this.capabilitiesHelper.augmentDegradationPreference(r,this.configProvider.config.degradationPreference),this.capabilitiesHelper.setSenderParameters(this.rtpSender,r,i,n)}},VH=class{constructor(e,t,i){this.transitionStates=e,this.logger=i,this.stateCurrent=t}get state(){return this.stateCurrent}isDestinationStateValid(e){return this.transitionStates[this.stateCurrent].indexOf(e)>-1}setState(e){return this.isDestinationStateValid(e)?(this.stateCurrent=e,!0):(e!==this.stateCurrent&&this.logger.safe.info(`Invalid state transition ${this.stateCurrent} -> ${e}`),!1)}isCurrentStateMatchedWith(e){return this.stateCurrent===e||(this.logger.safe.info(`State does not match. Current: ${this.stateCurrent} required: ${e}`),!1)}},Vj=class extends no{constructor(e,t){super(e),this.logger=e,this.configProvider=t,this.audioContext=new mk.AudioContext(this.configProvider.config.audioSharingContextOptions),this.destination=this.audioContext.createMediaStreamDestination(),this.streamNodeMap=new Map,this.logger.safe.info(`Destination stream: ${this.destination.stream.id}, track: ${this.getDestinationTrack().id}`),this.subscribeOnMediaTrackEvents(this.getDestinationTrack())}get numberOfStreams(){return this.streamNodeMap.size}addSourceStream(e){if(!e.rawStream||this.streamNodeMap.has(e.rawStream))return;let t=e.on("onStreamClientDisposing",()=>{this.removeSourceStream(e.rawStream),t.dispose()});this.logger.safe.info(`Add stream: ${e.rawStream.id}, track: ${Vq(e.rawStream).id}`),this.addStream(e.rawStream,e.mediaType)}getDestinationTrack(){return Vq(this.destination.stream)}dispose(){for(let e of(super.dispose(),this.unsubscribeFromMediaTrackEvents(this.getDestinationTrack()),this.streamNodeMap.keys()))this.removeSourceStream(e);this.audioContext.close(),this.audioContext=null}addStream(e,t="Audio"){let i=this.audioContext.createMediaStreamSource(e);i.connect(this.destination),this.streamNodeMap.set(e,{mediaType:t,sourceNode:i}),this.event("onNumberOfStreamsChanged").raise(this.numberOfStreams)}removeSourceStream(e){let t=this.streamNodeMap.get(e);t&&(this.logger.safe.info(`Remove stream: ${e.id}, track: ${Vq(e).id}`),t.sourceNode.disconnect(),this.streamNodeMap.delete(e),this.event("onNumberOfStreamsChanged").raise(this.numberOfStreams))}subscribeOnMediaTrackEvents(e){e.onended=t=>{this.logger.safe.info(`Track ${e.id} ended: ${JSON.stringify(t)}`)},e.onmute=()=>{this.logger.safe.info(`Track ${e.id} muted`)},e.onunmute=()=>{this.logger.safe.info(`Track ${e.id} unmuted`)}}unsubscribeFromMediaTrackEvents(e){e.onended=null,e.onmute=null,e.onunmute=null}};function Vq(e){return e.getAudioTracks()[0]}var VW=class extends no{constructor(e,t,i,n,r,s,a){super(),this.mediaConnection=e,this.contextStream=i,this.logger=n,this.configProvider=r,this.encStreamsManager=s,this.capabilitiesManager=a,this.isActiveInternal=!1,this.stream=t.clone("streamSender ctor"),this.subscribeOnStreamClientMuted(),this.capabilitiesManager.updateStream(this.stream)}get rawTrack(){return this.audioMixer?.getDestinationTrack()||this.stream.rawTrack}get trackId(){return this.rawTrack?.id}applyCallConstraints(e){return this.capabilitiesManager.applyCallConstraints(e)}async init(){this.sender=await this.createSender(),this.isActiveInternal=!0,this.addStreamTransforms(),this.capabilitiesManager.setSender(this.sender)}async start(){if(this.isActive())return void this.logger.safe.info("Already active. Do nothing");this.logger.safe.info("Starting"),this.isActiveInternal=!0,await this.capabilitiesManager.startSender(this.rawTrack),this.logger.safe.info("Started")}async stop(){if(!this.isActive())return void this.logger.safe.info("Already stopped. Do nothing");this.logger.safe.info("Stopping"),this.isActiveInternal=!1,await this.capabilitiesManager.stopSender(),this.logger.safe.info("Stopped")}async setCapabilities(e){this.configProvider.config.applySenderParamsBeforeStart||await this.start();try{await this.capabilitiesManager.setCapabilities(e)}catch(e){this.logger.safe.error(`Error setting capabilities: ${t$(e)}`)}await this.start()}updateStreamQualityParams(e,t,i){return this.capabilitiesManager.updateStreamQualityParams(e,t,i)}setMuted(e,t,i){this.stream.setMuted(e,t),e&&this.audioMixer&&1!==this.audioMixer.numberOfStreams||this.audioMuteTransform?.mute(e),!this.configProvider.config.requestNewStreamOnUnmute||e||i||this.stream.isActive()||this.event("onNewStreamNeeded").raise()}async setHold(e,t){if(this.configProvider.config.holdSkipActivation)return;let i=!e;this.logger.safe.info(`[${t}] change isActive state to ${i}`);try{return this.capabilitiesManager.setActive(i)}catch(n){let e=this.configProvider.config.holdRetryActivationDelay;if(e>=0)return this.logger.safe.info(`[${t}] retrying after delay of ${e}`),await iI(e),this.logger.safe.info(`[${t}] change isActive state to ${i}, second attempt`),this.capabilitiesManager.setActive(i);throw n}}async setMainStream(e,t){return this.stream.dispose(),this.onStreamClientMutedSubscription?.dispose(),this.stream=e.clone("streamSender setMainStream"),this.stream.setMuted(t),this.audioMixer?.addSourceStream(this.stream),this.isActive()&&(this.logger.safe.info(`Replace sender with track: ${this.rawTrack?.id}`),await this.sender.replaceTrack(this.rawTrack),this.logger.safe.info("Replace completed")),this.capabilitiesManager.updateStream(this.stream),this.subscribeOnStreamClientMuted(),this.capabilitiesManager.applyLastCapabilities(1)}async addAdditionalStream(e){if("Audio"!==this.stream.mediaType)return void this.logger.safe.error("Not adding additional stream for non-audio stream");if(this.configProvider.config.postponeAudioMixerForAudioSharing&&this.setupAudioMixer(),this.audioMixer||this.logger.safe.error(`addAdditionalStream is called when audioMixer is not created. Main stream type is ${this.stream.mediaType}.`),this.audioMixer?.addSourceStream(e),this.audioMuteTransform?.mute(!1),this.configProvider.config.postponeAudioMixerForAudioSharing){if(!this.sender)return void this.logger.safe.error("Sender not created, cannot replace track");this.logger.safe.info(`addAdditionalStream replace sender with track: ${this.rawTrack?.id}`),await this.sender.replaceTrack(this.rawTrack),this.logger.safe.info("addAdditionalStream replace completed")}}dispose(){this.removeSender(),this.cleanUp()}async terminateAsync(){await this.removeSenderAsync(),this.cleanUp()}getActiveStreamIndexes(){return this.getSenderParameters().encodings.filter(e=>e.active).map(e=>+e.rid)}isActive(){return this.sender&&(vm(this.configProvider,this.stream)||vv(this.configProvider,this.stream))?this.getSenderParameters().encodings[0].active:this.isActiveInternal}removeSender(){this.logger.safe.info("Removing sender from pc");try{this.mediaConnection.removeSender(this.sender)}catch(e){this.logger.safe.warn(`Error removing sender: ${t$(e)}`)}}async removeSenderAsync(){this.logger.safe.info("Removing sender from pc");try{await this.mediaConnection.removeSenderAsync(this.sender)}catch(e){this.logger.safe.warn(`Error removing sender: ${t$(e)}`)}}async createSender(){return this.configProvider.config.postponeAudioMixerForAudioSharing||this.setupAudioMixer(),this.mediaConnection.createSender(this.rawTrack,this.contextStream,vi(this.stream.mediaType))}addStreamTransforms(){let e=this.encStreamsManager.initTransformsCollection(this.sender,"Sender",this.stream.mediaType);e&&("Audio"===this.stream.mediaType?this.configProvider.config.useInsertableStreams?.audioExtendedMute&&(this.audioMuteTransform=new SS(this.logger.createChild("SendAudioPayload")),e.addTransform(this.audioMuteTransform)):this.configProvider.config.useInsertableStreams?.videoStreamAnalyzer&&e.addTransform(new Sf(this.logger.createChild(`SendStreamAnalyzer [${this.stream.mediaType}]`))))}setupAudioMixer(){return this.configProvider.config.enableAudioSharing?"Audio"!==this.stream.mediaType?void this.logger.safe.error("Not setting up audio mixer for non-audio stream"):void(this.configProvider.config.audioSharingMemoryLeakFix&&this.audioMixer?this.logger.safe.debug("Audio mixer already created, not creating new one"):this.createAudioMixer()):void this.logger.safe.info("Audio sharing is disabled, not setting up audio mixer")}createAudioMixer(){this.audioMixer=new Vj(this.logger.createChild("AudioMixer"),this.configProvider),this.onNumberOfStreamsChangedSubscription=this.audioMixer.on("onNumberOfStreamsChanged",e=>this.event("onNumberOfStreamsChanged").raise(e)),this.audioMixer.addSourceStream(this.stream)}getSenderParameters(){let e=this.sender.getParameters();return e.encodings?.length||(e.encodings=[{}]),e}subscribeOnStreamClientMuted(){this.configProvider.config.recoverOnStreamUnmute&&(this.onStreamClientMutedSubscription=this.stream.on("onStreamClientMuted",async(e,t)=>{t||await this.capabilitiesManager.applyLastCapabilities(1)}))}cleanUp(){super.dispose(),this.encStreamsManager.clearTransformsCollection(this.sender),this.sender=null,this.audioMixer?.dispose(),this.stream.dispose(),this.onStreamClientMutedSubscription?.dispose(),this.onNumberOfStreamsChangedSubscription?.dispose(),this.stream=null,this.isActiveInternal=!1}},VG=class e extends no{constructor(t,i,n,r,s,a,o,l,c,d,u){super(),this.mediaConnection=t,this.mainStream=i,this.contextStream=n,this.mediaType=r,this.serialQueue=s,this.logger=a,this.configProvider=o,this.isAlwaysActive=l,this.encStreamsManager=c,this.simulcastContext=d,this.sendVideoCapabilityManager=u,this.isMuted=!1,this.isHold=!1,this.previousParameters=[],this.state=new VH(e.transitionStates,"NotStarted",this.logger.createChild("state")),this.pendingStream=null,this.pendingParams=null,this.lastAppliedParams=null,this.mainStream=this.validateStream(i,"ctor"),this.subscribeOnQualityUpdates(this.mainStream),u&&this.sendVideoCapabilityManager.on("onCapabilitiesChanged",e=>{this.event("onMaxVideoSendCapabilitiesChanged").raise(e),this.configProvider.config.applyMaxCapabilitiesToSenderParamsDirectly&&this.lastAppliedParams&&!this.pendingParams&&this.updateParameters(this.lastAppliedParams)})}async start(){this.state.setState("Started")&&(this.sender=new VW(this.mediaConnection,this.validateStream(this.mainStream,"start"),this.contextStream,this.logger.createChild("Sender"),this.configProvider,this.encStreamsManager,this.getCapabilitiesManager(this.simulcastContext)),this.sender.on("onNumberOfStreamsChanged",e=>this.event("onNumberOfStreamsChanged").raise(e)),await this.sender.init(),this.notifyMaxVideoSendCapabilitiesChanged(),this.configProvider.config.deactiveAudioSender&&"Audio"===this.mediaType&&(this.logger.safe.info("start(): Deactivating audio sender"),await this.sender.stop()),this.sender.on("onNewStreamNeeded",()=>{this.logger.safe.info("onNewStreamNeeded"),this.event("onNewStreamNeeded").raise()}))}async activate(){if(this.state.setState("Active")&&(this.pendingStream&&(this.logger.safe.info("activate(): updating from pendingStream"),await this.updateStreamInternal(this.pendingStream),this.pendingStream=null),this.isAlwaysActive&&!this.isMuted&&"Audio"===this.mediaType&&(this.logger.safe.info("activate(): starting sender"),await this.sender.start()),this.isAlwaysActive?(this.event("onSendersChanged").raise(this,!0),this.logger.safe.info("Sender set to always active")):await this.sender.stop(),this.configProvider.config.enableCachingFMTP&&this.pendingParams)){let e=async()=>{this.configProvider.config.enableCachingFMTPDelay>0&&(this.logger.safe.info("Applying delay before applying pending parameters"),await iI(this.configProvider.config.enableCachingFMTPDelay)),this.logger.safe.info("Apply pending parameters");let e=this.updateParametersInternal(this.pendingParams);return this.pendingParams=null,e};this.configProvider.config.enableCachingFMTPAwait?(this.logger.safe.info("Apply pending parameters"),await e()):(this.logger.safe.info("Apply pending parameters in background"),e().catch(e=>this.logger.safe.error("Error applying pending parameters",e)))}}updateStream(e){return this.updateStreamInternal(this.validateStream(e,"updateStream"))}async addAdditionalStream(e){return this.sender.addAdditionalStream(this.validateStream(e,"addAdditionalStream"))}async updateParameters(e){return this.state.isCurrentStateMatchedWith("Active")?this.updateParametersInternal(e):void(this.configProvider.config.enableCachingFMTP?(this.logger.safe.info("Postpone params update until sender is activated"),this.pendingParams=e):this.logger.safe.warn("Ignore params update as sender is not activated"))}async terminateAsync(){this.state.setState("Disposed")&&(this.logger.safe.info("Terminating async"),await this.sender.terminateAsync(),this.cleanUp())}dispose(){this.state.setState("Disposed")&&(this.logger.safe.info("Disposing"),this.sender.dispose(),this.cleanUp())}async setHold(e,t){return this.isHold===e?void this.logger.safe.info(`[${t}] Already in hold=${e} state`):(this.logger.safe.info(`[${t}] Setting hold to: ${e}`),this.isHold=e,this.sender.setHold(e,t))}setMuted(e,t,i){this.logger.safe.info(`[${t}] Setting muted to: ${e}`),this.isMuted=e;let n=this.state.isCurrentStateMatchedWith("Active");n||this.configProvider.config.allowMuteOnInactiveSender?this.sender.setMuted(this.isMuted,t,i):this.logger.safe.info(`[${t}] Sender is not active, postponing muted update`),!this.isMuted&&"Audio"===this.mediaType&&n&&this.sender.start()}getActiveStreamIndexes(){return this.sender?this.sender.getActiveStreamIndexes():[]}getTrackInfo(){return{modality:vi(this.mediaType),trackId:this.sender.trackId}}applyCallConstraints(e){return this.sendVideoCapabilityManager?.applyCallConstraints(e),this.sender.applyCallConstraints(e)}getCapabilitiesManager(e){return e?.shouldUseSimulcast()?new VV(e.config,this.configProvider,this.logger.createChild("SimCapMgrV2")):new VB(this.configProvider,this.logger.createChild("SnglCapMgrV2"))}async updateStreamInternal(e){if(this.logger.info(`updateStreamInternal(): id: ${e.id}, parentId: ${e.parentId}), mediaType: ${this.mediaType}`),!this.state.isCurrentStateMatchedWith("Active")){this.logger.safe.info("Postponing stream update until sender is activated"),this.setPendingStream(e);return}return this.mainStream===e?void this.logger.safe.info("Stream has not been changed. Skipping update"):(this.logger.safe.debug(`Switching streams: ${this.mainStream.parentId}:${this.mainStream.id} -> ${e.parentId}:${e.id}`),this.unsubscribeFromQualityEvents(),this.mainStream.dispose(),this.mainStream=e,this.subscribeOnQualityUpdates(this.mainStream),this.notifyMaxVideoSendCapabilitiesChanged(),await this.sender.setMainStream(this.mainStream,this.isMuted),this.logger.debug(`track info after stream update: ${JSON.stringify(this.getTrackInfo())}`),this.sender.updateStreamQualityParams(this.mainStream.getResolution(),this.mainStream.getFrameRate(),1))}async updateParametersInternal(e){if(this.configProvider.config.applyMaxCapabilitiesToSenderParamsDirectly){this.lastAppliedParams=e;let t=this.sendVideoCapabilityManager?.getCapabilities();t&&(e=e.map(e=>{let i={...e};return i.maxFs>t.maxFs&&(this.logger.safe.info(`Reducing SSRC:${i.ssrc} video FS from ${i.maxFs} to ${t.maxFs}`),i.maxFs=t.maxFs),i.maxFps>t.maxFps&&(this.logger.safe.info(`Reducing SSRC:${i.ssrc} video FPS from ${i.maxFps} to ${t.maxFps}`),i.maxFps=t.maxFps),i}))}await this.sender.setCapabilities(e),nC(this.previousParameters,e,(e,t)=>e.ssrc===t.ssrc)||(this.previousParameters=e,this.event("onSendersChanged").raise(this,!0))}setPendingStream(e){this.pendingStream=e;let t=e.on("onStreamClientDisposing",()=>{this.pendingStream===e&&(this.pendingStream=null,t.dispose())})}subscribeOnQualityUpdates(e){this.sub=e.on("onStreamQualityChanged",(e,t,i,n)=>this.updateStreamQualityParams(t,i,n))}async updateStreamQualityParams(e,t,i){if(i===m.EffectQualityChangeReason.ProfileSuggestion){this.configProvider.config.useProfileSuggestionsToNotifyMaxVideoSendCapabilities&&this.notifyMaxVideoSendCapabilitiesChanged({resolution:e,fps:t});return}return i===m.EffectQualityChangeReason.Performance&&this.notifyMaxVideoSendCapabilitiesChanged({resolution:e,fps:t}),this.sender.updateStreamQualityParams(e,t,2)}unsubscribeFromQualityEvents(){this.sub?.dispose(),this.sub=null}notifyMaxVideoSendCapabilitiesChanged(e){if(!["Video","ScreenShare"].includes(this.mediaType))return;let{width:t,height:i}=e?.resolution??this.mainStream.getResolution(),n=e?.fps??this.mainStream.getFrameRate();if(!t||!i||!n)return;let r=new rn(t,i),s={maxFs:r.fs,maxMbps:r.fs*n,maxFps:n,maxWidth:r.width,maxHeight:r.height};this.logger.safe.info(`Capabilities for ${this.mediaType} stream: ${JSON.stringify(s)}`),this.sendVideoCapabilityManager?this.sendVideoCapabilityManager.manage(s,!e):this.event("onMaxVideoSendCapabilitiesChanged").raise(s)}cleanUp(){this.sendVideoCapabilityManager?.dispose(),this.sendVideoCapabilityManager=null,this.unsubscribeFromQualityEvents(),this.mainStream.dispose(),this.mainStream=null,this.pendingStream&&this.pendingStream.dispose(),this.pendingStream=null,this.sender=null,this.contextStream=null,this.event("onSendersChanged").raise(this,!1),super.dispose()}validateStream(e,t){return e?this.configProvider.config.validateStreamDisposal&&e?.isDisposed()?(this.logger.safe.info(`Stream is disposed, using NullStreamClient, mediaType: ${this.mediaType}, reason: ${t}`),new Vn(this.mediaType,this.logger.createChild("NullStreamClient"))):e:(this.logger.safe.info(`Stream is missing, using NullStreamClient, mediaType: ${this.mediaType}, reason: ${t}`),new Vn(this.mediaType,this.logger.createChild("NullStreamClient")))}};VG.transitionStates={NotStarted:["Started","Disposed"],Started:["Active","Disposed"],Active:["NotStarted","Disposed"],Disposed:[]},eM([xF()],VG.prototype,"start",1),eM([xF()],VG.prototype,"activate",1),eM([xF()],VG.prototype,"updateStream",1),eM([xF()],VG.prototype,"addAdditionalStream",1),eM([xF()],VG.prototype,"updateParameters",1),eM([xF()],VG.prototype,"terminateAsync",1),eM([xF()],VG.prototype,"setHold",1),eM([xF()],VG.prototype,"updateStreamQualityParams",1);var Vz=VG,VJ=class{constructor(e){this.durationThreshold=e,this.signals={}}track(e,t){void 0===this.signals[e]&&(this.signals[e]={wasNotified:!1}),this.signals[e].currentTime=nQ(),!!this.signals[e].currentState!=!!t&&(this.signals[e].currentState=t,this.signals[e].lastChanged=this.signals[e].currentTime,this.signals[e].wasNotified=!1)}update(e){let t=[];for(let t of Object.keys(e))void 0===this.signals[t]&&(this.signals[t]={wasNotified:!1});for(let t of Object.keys(this.signals))this.track(t,e[t]);for(let e in this.signals){let i=this.signals[e];if(void 0!==i.currentState){if(i.wasNotified)continue;i.currentTime-i.lastChanged>=this.durationThreshold&&(i.wasNotified=!0,t.push(i.currentState))}}return t}},VK=class extends no{constructor(e,t){super(),this.logger=e,this.timeout=-1,this.signals=new VJ(t.performanceMonitor.durationThreshold??3e3),this.config={monitorQualityLimitationReasons:t.performanceMonitor?.monitorQualityLimitationReasons,monitorMaxFS:t.performanceMonitor?.monitorMaxFS,mitigationTimeout:t.performanceMonitor?.mitigation?.timeout,startupDelay:t.performanceMonitor?.startupDelay}}key(e,t){return`${e.rid}:${t}`}suspend(e){e>0&&(this.logger.safe.info(`Suspending for ${(e/1e3).toFixed(1)} seconds`),this.timeout=nQ()+e)}acceptLayout(e){return e.some(e=>void 0===e.rid)?(this.logger.safe.info("Ignore layout with missing RID"),!1):!(this.caps&&Math.max(0,...e.map(e=>e.maxFs))>this.caps.maxFs)||(this.logger.safe.info("Ignore layout update while waiting for maxCapabilities to propagate to server"),!1)}resetLayout(){this.signals.update({}),this.layout=void 0}updateMaxCapabilities(e){this.logger.safe.info(`Max capabilities updated: ${JSON.stringify(e)}`),this.caps&&e.maxFs<this.caps.maxFs&&this.layout?.length>0&&(this.logger.safe.info("Stop monitoring current layout as maxFS will be reduced"),this.resetLayout()),this.caps=e}updateLayout(e){if((e||this.layout)&&this.logger.safe.info(`New layout: ${JSON.stringify(e)}`),e&&this.acceptLayout(e)){if((e=e.map(e=>Object.assign({},e))).sort((e,t)=>e.maxFs===t.maxFs?e.maxFps===t.maxFps?e.maxBr-t.maxBr:e.maxFps-t.maxFps:e.maxFs-t.maxFs),this.layout?.length)for(let t=0;t<e?.length;++t){let i=e[t],n=this.layout.find(e=>e.rid===i.rid);n&&n.maxFs!==i.maxFs&&(this.logger.safe.info(`Reset '${this.key(n,"FS")}'`),this.signals.track(this.key(n,"FS"),void 0))}this.layout=e,-1===this.timeout&&(this.timeout=0,this.logger.safe.info("Starting performance monitor"),this.suspend(this.config.startupDelay))}else this.resetLayout(),this.timeout=-1}onMitigationApplied(){this.logger.safe.info("Mitigation was applied - resetting current layout"),this.resetLayout(),this.suspend(this.config.mitigationTimeout)}monitor(e){let t={},i=0;if(!this.layout||this.layout.length<1||e.length<this.layout.length||this.timeout>nQ())return void this.signals.update(t);for(this.timeout>0&&(this.logger.safe.info("Resuming"),this.timeout=0),i=0;i<this.layout.length;++i){let n=this.layout[i],r=e.find(e=>e.rid===n.rid);if(r){let e=Math.ceil(r.frameWidth/nu.MACROBLOCK_SIZE)*Math.ceil(r.frameHeight/nu.MACROBLOCK_SIZE);if(this.config.monitorQualityLimitationReasons){let e=r.qualityLimitationReason;-1!==this.config.monitorQualityLimitationReasons.indexOf(`${e}`)&&(t[this.key(n,"QL")]={layout:n,type:"QL",expected:"none",actual:e})}this.config.monitorMaxFS&&e<n.maxFs&&(t[this.key(n,"FS")]={layout:n,type:"FS",expected:n.maxFs,actual:e})}}let n=this.signals.update(t).map(e=>{let t=Object.assign({},e);return t.layout=this.layout?.find(e=>e.rid===t.layout.rid)??t.layout,t});n.length&&(this.logger.safe.info(`Raise event: ${JSON.stringify(n)}`),this.event("onVideoQualityDegraded").raise(n))}},VQ=class extends no{constructor(e,t,i,n){super(e),this.logger=e,this.configProvider=t,this.diagnostics=i,this.videoFeatureManager=n,this.activeModalities=new Set,this.callbacks=[];let r=this.configProvider.config.specCompliantSimulcast?.performanceMonitor?.mitigation??{};this.config={allowDisabling1080pSinglecast:r.enableFor1080pSinglecast,allowDisabling1080pSimulcast:r.enableFor1080pSimulcast,allowDisablingThreeStreamSimulcast:r.enableForThreeStreamSimulcast,allowReversals:r.enableReversals}}hasSoftwareEncodedVideoAndSharing(){return!(this.videoFeatureManager.get("Video").hasClientSupport(1)||this.videoFeatureManager.get("ScreenShare").hasClientSupport(1))&&this.hasActiveSenders("Video","ScreenShare")}hasActiveSenders(...e){return e.every(e=>this.activeModalities.has(e))}getAdaptationInfo(e,t){return{description:e,activeModalities:[...this.activeModalities],isTransient:t&&this.config.allowReversals}}notify(e){this.logger.safe.warn(`${e.description} activeModalities: ${e.activeModalities.join("/")} isTansient: ${e.isTransient}`),this.diagnostics.registerLocalVideoPerformanceEvent(e)}schedule(e,t,i){this.callbacks.push({mediaType:e,state:t,callback:i})}override(e,t,i){this.configProvider.config[e]=t,this.logger.safe.info(`Overwriting ${e} with ${this.configProvider.config[e]}. Reason: ${i}`)}disable1080pSoftwareEncode(e){let t=this.videoFeatureManager.get("Video");if(!e.find(e=>e.maxFs===nu.MAX_FS_1080P)||!t.hasClientSupport(2)||t.hasClientSupport(1))return!1;if(1===e.length&&!this.config.allowDisabling1080pSinglecast)return this.logger.safe.info("Will not disable 1080p for singlecast"),!1;if(e.length>1&&!this.config.allowDisabling1080pSimulcast)return this.logger.safe.info("Will not disable 1080p for simulcast"),!1;let i=this.configProvider.config.performanceFallbackMaxFsFor1080pSend,n={},r={webrtcCameraOpenFs:this.configProvider.config.webrtcCameraOpenFs,maxCameraFsViaCallConstraints:this.configProvider.config.maxCameraFsViaCallConstraints,webrtcVideoCapabilityMaxFS:this.configProvider.config.webrtcVideoCapabilityMaxFS};for(let e in r)r[e]>0&&(n[e]=Math.min(i,r[e]));let s=Object.keys(n);if(s.some(e=>r[e]!==n[e])){s.forEach(e=>{this.override(e,n[e],"mitigating 1080p performance issues")}),this.event("onNewStreamNeeded").raise(n.webrtcCameraOpenFs);let e=this.getAdaptationInfo("Disabled software 1080p",this.hasSoftwareEncodedVideoAndSharing());return e.isTransient&&this.schedule("ScreenShare",!1,()=>{s.forEach(e=>{this.override(e,r[e],"removing mitigation for 1080p performance issues")}),this.event("onNewStreamNeeded").raise(),this.notify(this.getAdaptationInfo("Re-enabled software 1080p",!0))}),this.notify(e),!0}return!1}disableThreeStreamSimulcast(e){let t=this.videoFeatureManager.get("Video");if(3!==e.length)return!1;if(!this.config.allowDisablingThreeStreamSimulcast)return this.logger.safe.info("Will not disable 3-stream simulcast"),!1;if(t.hasClientSupport(1))return!1;if(t.hasFullSupport(0)){let e=this.getAdaptationInfo("Disabled 3-stream simulcast",this.hasSoftwareEncodedVideoAndSharing());return t.toggleClient(0,!1),e.isTransient&&this.schedule("ScreenShare",!1,()=>{t.toggleClient(0,!0),this.notify(this.getAdaptationInfo("Re-enabled Three stream simulcast",!0))}),this.notify(e),!0}return!1}updateSenderState(e,t){if(t===this.activeModalities.has(e))return;t?this.activeModalities.add(e):this.activeModalities.delete(e);let i=this.callbacks.filter(i=>i.mediaType===e&&i.state===t);for(let n of(this.callbacks=this.callbacks.filter(i=>i.mediaType!==e||i.state!==t),i))n.callback()}mitigatePerformanceIssue(e){return!!(this.disable1080pSoftwareEncode(e)||this.disableThreeStreamSimulcast(e))}},VY=class{constructor(e,t,i){this.callback=e,this.logger=t,this.settings=i,this.triggers=0,this.budget=0,this.budget=this.burst}get interval(){return this.settings?.interval??0}get burst(){return this.settings?.burst??0}cancel(){this.timer&&(clearTimeout(this.timer),this.timer=void 0)}schedule(){this.timer||(this.timer=setTimeout(()=>{this.cancel(),this.commit()||(this.budget=Math.min(this.budget+1,this.burst)),this.budget<this.burst&&this.schedule()},this.interval))}commit(){return this.triggers>0&&(this.callback.apply(this),this.triggers=0,!0)}dispose(){this.cancel()}trigger(){if(++this.triggers,0===this.burst&&0===this.interval)return void this.commit();this.burst?(this.budget>0&&(--this.budget,this.commit(),this.cancel(),this.budget||this.logger.safe.warn(`Max burst limit reached: ${this.burst}`)),this.triggers>0&&this.logger.safe.debug(`Triggered while out of budget: ${this.triggers} / ${this.burst}`),this.schedule()):this.timer||(this.commit(),this.schedule())}},VZ=class extends no{constructor(e,t,i,n){super(e),this.logger=e,this.configProvider=t,this.frameSizeLimits={},this.initialMaxFS=this.configProvider.config.webrtcCameraOpenFs,this.subs=[],this.cadence=new VY(this.commitCallConstraints.bind(this),this.logger.createChild("Cadence"),this.configProvider.config.sendVideoCapabilityManager?.constraintsCadence),this.configProvider.config.enableVideoFeatureManager&&i&&(this.features=i.get("Video"),this.subs.push(i.on("onVideoFeaturesChanged",e=>{"Video"===e.mediaType&&this.onFeaturesChanged(e)}))),n&&this.subs.push(n.on("onNewStreamNeeded",e=>{this.limitFrameSize("Performance",e),this.updateConstraintsAndNotify()})),this.configProvider.config.video1080p?.software?.isEnabled&&this.limitFrameSize("Software1080P",nu.MAX_FS_1080P),this.settings=this.configProvider.config.sendVideoCapabilityManager,this.settings.defaultFS&&(this.initialMaxFS=this.settings.defaultFS);let r=this.getCallConstraints().maxFS;r&&r!==this.initialMaxFS&&(this.logger.safe.info(`Detected initial resolution opt-in: ${this.initialMaxFS} => ${r}`),this.limitFrameSize("Opt-In",r))}getCapabilities(){if(this.appliedCapabilities)return{...this.appliedCapabilities}}applyCallConstraints(e){this.lastCauseId=e,this.cadence.trigger()}manage(e,t){t&&(this.streamConstraints={maxFPS:e.maxFps,maxFS:e.maxFs},this.features&&this.streamConstraints.maxFS>=nu.MAX_FS_1080P&&this.configProvider.config.video1080p?.useSimulcastLayoutControlStrategy&&this.features.toggleClient(2,!0)),this.requestedCapabilities={...e},this.updateConstraintsAndNotify()}dispose(e){for(let t of this.subs)t.dispose(e);this.subs=[],this.cadence.dispose(),super.dispose()}onFeaturesChanged(e){let t=(t,i)=>{this.limitFrameSize(VD[t],e.hasClientSupport(t)?i:void 0)};t(1,this.configProvider.config.hardwareEncodedVideoMaxFS),t(3,this.configProvider.config.broadcastMode?.maxVideoFS),this.updateConstraintsAndNotify()}getCallConstraints(){let e=this.configProvider.config.outgoingVideoLimit,t={},i="number"==typeof e?e:e?.maxResolution;return i&&(t.maxFS=rl(i)),t.maxFPS="number"==typeof e?void 0:e?.maxFramerate,t}commitCallConstraints(){this.limitFrameSize("Opt-In",this.getCallConstraints().maxFS,this.lastCauseId),this.updateConstraintsAndNotify()}buildCapabilities(){let e={...this.requestedCapabilities};if(this.constraints?.maxFS<e.maxFs||this.constraints?.maxFPS<e.maxFps){e.maxFps=nf(this.constraints.maxFPS,e.maxFps),e.maxFs=nf(this.constraints.maxFS,e.maxFs);let t={...this.configProvider.getVideoSendLadder().getResolutionByFs(e.maxFs)};e.maxMbps=t.fs*e.maxFps,e.maxWidth=t.width,e.maxHeight=t.height}return e}limitFrameSize(e,t,i){this.frameSizeLimits[e]!==t&&(i?this.logger.safe.info(`[${i}] FS limit for '${e}' changed from ${this.frameSizeLimits[e]} to ${t}`):this.logger.safe.info(`FS limit for '${e}' changed from ${this.frameSizeLimits[e]} to ${t}`),this.frameSizeLimits[e]=t)}notify(){this.appliedCapabilities=this.buildCapabilities(),this.requestedCapabilities.maxFs!==this.appliedCapabilities.maxFs&&this.logger.safe.debug(`Changed video send capability max-fs from ${this.requestedCapabilities.maxFs} to ${this.appliedCapabilities.maxFs}`),this.requestedCapabilities.maxFps!==this.appliedCapabilities.maxFps&&this.logger.safe.debug(`Changed video send capability max-fps from ${this.requestedCapabilities.maxFps} to ${this.appliedCapabilities.maxFps}`),this.logger.safe.info(`Reporting video capabilities: ${JSON.stringify(this.appliedCapabilities)}`),this.event("onCapabilitiesChanged").raise(this.appliedCapabilities)}updateConstraintsAndNotify(){this.updateConstraints()&&this.notify()}updateConstraints(){let e=this.getCallConstraints(),t={},i=!1;for(let e of this.settings.priorityOrder)if(this.frameSizeLimits[e]>0){i=-1!==this.settings.allowOptIn.indexOf(e),t.maxFS=this.frameSizeLimits[e],this.logger.safe.info(`Using FS ${t.maxFS} from '${e}'. Opt-In is ${i?"allowed":"not allowed"}`);break}if(void 0===t.maxFS&&(t.maxFS=this.initialMaxFS,i=this.settings.maxFS>this.initialMaxFS),t.maxFPS=e.maxFPS,this.frameSizeLimits["Opt-In"]>0){let e=this.frameSizeLimits["Opt-In"];(e<t.maxFS||i)&&(this.logger.safe.info(`Applying opt-in: ${t.maxFS} => ${e}`),t.maxFS=e)}if(this.streamConstraints&&(this.logger.safe.debug(`Applying stream constraints: ${JSON.stringify(this.streamConstraints)} to ${JSON.stringify(t)}`),t.maxFS&&(t.maxFS=nf(t.maxFS,this.streamConstraints.maxFS)),t.maxFPS&&(t.maxFPS=nf(t.maxFPS,this.streamConstraints.maxFPS))),(t.maxFS!==this.constraints?.maxFS||t.maxFPS!==this.constraints?.maxFPS)&&(this.logger.safe.info(`Final constraints changed from ${JSON.stringify(this.constraints)} to ${JSON.stringify(t)}`),this.constraints=t),this.constraints&&this.requestedCapabilities){if(this.appliedCapabilities){let e=this.buildCapabilities();return e.maxFs!==this.appliedCapabilities.maxFs||e.maxFps!==this.appliedCapabilities.maxFps}return!0}return!1}},VX=class extends no{constructor(e,t,i,n,r,s,a,o,l,c,d){super(t),this.mediaManager=e,this.logger=t,this.callDeviceManager=i,this.configProvider=n,this.sessionConfig=r,this.statisticsGatherer=s,this.diagnostics=a,this.qmDiagnostics=o,this.isMultiparty=l,this.encStreamsManager=c,this.videoFeatureManager=d,this.senders=new Map,this.senderSubs=new Map,this.senderId=0,this.previousMediaModalities={Audio:!1,Video:!1,ScreenShare:!1},this.muted=new Map([["Audio",!1],["Video",!1]]),this.serialQueue=new N3(this.logger),this.streamsProvider=new Vs(this.callDeviceManager,this.configProvider,this.sessionConfig,this.serialQueue,this.logger.createChild("StreamsProvider")),this.streamProviderSubscriptions=[this.streamsProvider.on("onStreamAdded",e=>this.onStreamUpdated(e,!1)),this.streamsProvider.on("onStreamUpdated",e=>this.onStreamUpdated(e,!0))],this.localVideoStreamWatcher=new Va(this.logger,this.configProvider,this.callDeviceManager),this.localVideoStreamWatcherSub=this.localVideoStreamWatcher.on("onVideoCaptureFreeze",(e,t)=>this.onVideoCaptureFreeze(e,t)),this.configProvider.config.useMediaQualityController&&(this.mediaQualityController=new Vx(this.configProvider,this.logger.createChild("MQC"),this.videoFeatureManager),this.mediaQualityController.on("onLayoutsUpdated",e=>{let t=this.mediaQualityController.getLayouts(e);return this.logger.safe.debug(`Update layouts for ${e}: ${JSON.stringify(t)}`),"Video"===e&&this.simulcastPerformanceMonitor&&this.simulcastPerformanceMonitor.updateLayout(t),this.updateParameters(this.lastCauseId,e,t)}),this.mediaQualityController.on("onBandwidthAllocationUpdated",e=>{this.event("onBandwidthAllocationChanged").raise(e)})),this.configProvider.config.specCompliantSimulcast?.performanceMonitor&&(this.simulcastPerformanceMonitor=new VK(this.logger.createChild("SPM"),this.configProvider.config.specCompliantSimulcast),this.simulcastPerformanceMonitor.on("onVideoQualityDegraded",e=>this.onVideoQualityDegraded(e))),this.configProvider.config.specCompliantSimulcast?.performanceMonitor?.mitigation&&(this.simulcastPerformanceAdaptationManager=new VQ(this.logger.createChild("SPAM"),this.configProvider,this.diagnostics,this.videoFeatureManager),this.simulcastPerformanceAdaptationManager.on("onNewStreamNeeded",e=>{this.configProvider.config.sendVideoCapabilityManager?.isEnabled||(this.sessionConfig.outgoingVideoMaxFS=e,this.streamsProvider.requestStreamUpdate("Video",!0))}))}dispose(){this.senders.forEach((e,t)=>{this.event("onSendStreamChanged").raise(null,t),this.configProvider.config.disposeSendersSync?e.dispose():e.terminateAsync()}),this.senders.clear(),this.senderSubs.forEach(e=>e.forEach(e=>e.dispose())),this.senderSubs.clear(),this.streamProviderSubscriptions.forEach(e=>e.dispose()),this.streamProviderSubscriptions=[],this.configProvider.config.disposeStreamsSync?this.streamsProvider.stop():this.streamsProvider.stopAsync(),this.localVideoStreamWatcherSub.dispose(),this.localVideoStreamWatcher.dispose(),this.logger=this.logger.createChild("DISPOSED"),this.mediaQualityController?.dispose(),super.dispose()}registerRtpSenderManager(e){this.logger.safe.debug(`Registering RTP sender manager ${e}`),this.mediaConnection=e}useNullAudioStreamClient(){this.logger.safe.debug("Using null audio stream client"),this.streamsProvider.useNullAudioStreamClient()}get pendingStreamsPromise(){return this.streamsPromise}clearStreamsPromise(){this.streamsPromise=void 0}async update(e,t,i,n){let r,s;n?.mark("startUpdateStreams");let a=V0(e,this.configProvider.config.streamModalitiesExcludeData),o=(1&t)!=0,l=(2&t)!=0,c=(4&t)!=0;c&&(a={Audio:!0,Video:!1,Data:!1,ScreenShare:!1});let d=c?Promise.resolve(a):this.streamsProvider.update(a,o);return l||c?(delete a.Data,r=nI(a),s=o?void 0:r):s=r=await d,this.logger.safe.info(`[${i}] Streams updated, modalities requested: ${JSON.stringify(a)} (flags: ${t}), result: ${JSON.stringify(r)}`),n?.markAndMeasure("startUpdateStreams","updateStreamsWithModalities"),await this.updateSenders(s,i),n?.markAndMeasure("updateStreamsWithModalities","updateSenders"),l&&(this.streamsPromise=(async()=>{let t=await d;return this.streamsPromise=void 0,await this.updateSenders(t,i),this.setAndUpdateLocalTracksInfo(!1),this.mergeAndSaveModalities(t,e)})()),this.applyMuteState(i,!0),this.setAndUpdateLocalTracksInfo(!1),this.mergeAndSaveModalities(r,e)}mergeAndSaveModalities(e,t){this.previousMediaModalities=nI(e);let i=nI(t);return nh(t,(t,n)=>{let r=vt(n);mY(t)&&!e[r]&&(i[n]=mQ(t))}),i}async activate(e){this.logger.safe.info(`[${e}] activate senders`),await Promise.all([...this.senders.values()].map(async e=>e.activate())),this.setAndUpdateLocalTracksInfo(!1)}applyCallConstraints(e){let t=this.senders.get("Video");return t?t.applyCallConstraints(e):(this.logger.info(`[${e}] Caching call constraints until sender is created`),this.callConstraintsCauseId=e,this.applyCallConstraintsDeferred=new iE,this.applyCallConstraintsDeferred.promise)}async applyCapabilities(e,t,i){this.logger.safe.info(`[${e}] Applying incoming ${t} FMTP: ${JSON.stringify(i)}`);let n=vt(t);this.lastCauseId=e;let r=i;return this.mediaQualityController&&(this.mediaQualityController.addReceiver(n,i),r=this.mediaQualityController.getLayouts(n)),this.simulcastPerformanceAdaptationManager?.updateSenderState(n,!0),this.updateParameters(e,n,r)}getLocalMediaSources(){let e=this.getTracksInfo(),t=[];return e.forEach(e=>{t.some(t=>t.modality===e.modality)||t.push({sourceId:this.getSourceIdForTrack(e),modality:e.modality})}),t}setMuted(e,t,i){this.muted.set(e,t),this.applyMuteState(i,!1)}async setHold(e,t){await Promise.all([...this.senders.values()].map(async i=>i.setHold(e,t)))}onDiagnosticUpdated(e){this.mediaQualityController?.onDiagnosticUpdated(e),this.localVideoStreamWatcher.onDiagnosticUpdated(e)}async updateParameters(e,t,i){try{let n=this.senders.get(t);n?await n.updateParameters(i):this.logger.safe.info(`[${this.lastCauseId}] Capabilities ignored ${JSON.stringify(i)}, no ${JSON.stringify(t)} sender`),this.logger.safe.debug(`[${e}] Capabilities completed`);let r={modality:vi(t),causeId:e,capabilities:i};this.statisticsGatherer.onMaxCapabilitiesApplied(r),this.qmDiagnostics.onMaxCapabilitiesApplied(r)}catch(s){let n=t$(s);this.logger.safe.error(`[${e}] Error applying capabilities ${n}`);let r={modality:vi(t),causeId:e,capabilities:i,error:n};this.statisticsGatherer.onMaxCapabilitiesApplied(r),this.qmDiagnostics.onMaxCapabilitiesApplied(r)}}applyMuteState(e,t){for(let[i,n]of this.muted)this.senders.get(i)&&this.senders.get(i).setMuted(n,e,t)}setAndUpdateLocalTracksInfo(e){let t=this.getTracksInfo();this.logger.safe.debug(`Local tracks info: ${JSON.stringify(t)}`),this.mediaManager.setLocalTracksInfo(t),e&&(this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.configProvider.config.mapSsrcToTrackForStats&&this.statisticsGatherer.updateStatsWithLocalSsrcTrackInfo())}getTracksInfo(){let e=[];return this.senders.forEach(t=>e.push(t.getTrackInfo())),e}async updateSenders(e,t=e9()){let i=await this.streamsProvider.getStreams(),n=e||vn(i);this.logger.safe.info(`[${t}] Updating senders with modalities: ${JSON.stringify(n)}, override: ${!!e}`),await Promise.all(n_(n).map(async e=>{let i=n[e];if(i===this.previousMediaModalities[e])return;if(!i){this.logger.safe.info(`[${t}] Removing sender for ${JSON.stringify(e)}`),await this.removeSender(e);return}let r=(await this.streamsProvider.getStreams())?.[e];if(await this.createAndStartSender(r,e),this.logger.safe.info(`[${t}] Sender for ${JSON.stringify(e)} is added`),this.applyCallConstraintsDeferred&&"Video"===e){let e=this.senders.get("Video");try{await e.applyCallConstraints(this.callConstraintsCauseId),this.applyCallConstraintsDeferred.resolve()}catch(e){this.applyCallConstraintsDeferred.reject(e)}this.applyCallConstraintsDeferred=void 0,this.callConstraintsCauseId=void 0}await this.addAudioSharingStream(r),this.event("onSendStreamChanged").raise(r,e)})),this.logger.safe.info(`[${t}] Senders updated. Enabled: ${JSON.stringify(Object.keys(n).filter(e=>n[e]))}`)}createCapabilityManager(e,t){if("Video"===e&&this.configProvider.config.sendVideoCapabilityManager?.isEnabled)return new VZ(t.createChild("SVCM"),this.configProvider,this.videoFeatureManager,this.simulcastPerformanceAdaptationManager)}createAndStartSender(e,t){if(this.senders.get(t))return this.logger.safe.error(`Sender already created, modality: ${JSON.stringify(t)}`),this.senders.get(t).start();let i=this.mediaManager.getMediaEntitiesByModality(vi(t))[0],n=i?.getSimulcastContext(),r=!this.configProvider.config.specCompliantSimulcast?.disableTilde&&!!n?.shouldUseSimulcast(),s="Audio"===t||!this.isMultiparty||r,a=this.logger.createChild(`Sender_${JSON.stringify(t)}:${this.senderId++}`),o=this.createCapabilityManager(t,a),l=new Vz(this.mediaConnection,e,new MediaStream,t,this.serialQueue,a,this.configProvider,s,this.encStreamsManager,n,o);this.senders.set(t,l);let c=[l.on("onSendersChanged",(e,t)=>this.onSenderStateChanged(e,t)),l.on("onNewStreamNeeded",()=>this.streamsProvider.requestStreamUpdate(t,!0)),l.on("onMaxVideoSendCapabilitiesChanged",e=>{this.event("onMaxVideoSendCapabilitiesChanged").raise(t,e),"Video"===t&&this.simulcastPerformanceMonitor&&this.simulcastPerformanceMonitor.updateMaxCapabilities(e)}),l.on("onNumberOfStreamsChanged",e=>this.event("onNumberOfStreamsChanged").raise(e))];return this.senderSubs.set(l,c),l.start()}async removeSender(e){let t=this.senders.get(e);t&&(this.senders.delete(e),this.event("onSendStreamChanged").raise(null,e),await t.terminateAsync(),this.senderSubs.get(t).forEach(e=>e.dispose()),this.senderSubs.delete(t),this.logger.safe.info(`Removed sender with mediaType: ${JSON.stringify(e)}`)),this.mediaQualityController?.removeReceiver(e),this.simulcastPerformanceAdaptationManager?.updateSenderState(e,!1),"Video"===e&&this.simulcastPerformanceMonitor&&this.simulcastPerformanceMonitor.updateLayout(void 0)}getSourceIdForTrack(e){let t=e.trackId,i=this.mediaManager.getMediaEntityByLocalTrackId(t);return i?(this.logger.safe.info(`Media entity found: ${JSON.stringify(i.getXSourceStreamId())}`),i.getXSourceStreamId()):(this.logger.safe.error(`Media entity is not found for stream: ${JSON.stringify(t)}`),0)}onVideoCaptureFreeze(e,t){e||(t?this.qmDiagnostics.registerWebcamFreeze():this.qmDiagnostics.registerProcessedStreamFreeze()),this.event("onVideoCaptureFreeze").raise(e)}onVideoQualityDegraded(e){let t=this.mediaQualityController?.getLayouts("Video")??[],i=!1;for(let n of e)if(this.logger.safe.warn(`rid:${n.layout.rid} ${n.type} degraded - expected: ${n.expected}, actual: ${n.actual}`),!i&&this.simulcastPerformanceAdaptationManager)switch(n.type){case"QL":"cpu"===n.actual&&(i=this.simulcastPerformanceAdaptationManager.mitigatePerformanceIssue(t));break;case"FS":"1"===n.layout.rid&&(i=this.simulcastPerformanceAdaptationManager.mitigatePerformanceIssue(t))}i&&this.simulcastPerformanceMonitor&&this.simulcastPerformanceMonitor.onMitigationApplied()}async onStreamUpdated(e,t){if(!this.senders.has(e))return void this.logger.safe.warn(`Sender with media type ${e} does not exist, do not update media stream`);let i=(await this.streamsProvider.getStreams())[e];if(!this.configProvider.config.validateStreamDisposal){if(i?.isDisposed())return void this.logger.safe.info(`Stream is already disposed for mediaType: ${e}`);this.event("onSendStreamChanged").raise(i,e)}let n=this.senders.get(e);await this.addAudioSharingStream(i),await n.updateStream(i),this.logger.safe.debug(`Stream updated for mediaType: ${e}, updated: ${t}`),this.setAndUpdateLocalTracksInfo(t)}onSenderStateChanged(e,t){if(this.mediaManager.updateMediaEntitiesWithActivityState(e.mediaType,e.getActiveStreamIndexes()),this.statisticsGatherer.onSendersChanged(e.mediaType,t),"Video"===e.mediaType)if(t){let e=this.getTracksInfo().filter(e=>e.modality===nu.MODALITY.video);this.localVideoStreamWatcher.startWatching(e,this.simulcastPerformanceMonitor)}else this.localVideoStreamWatcher.stopWatching()}async addAudioSharingStream(e){if(this.configProvider.config.validateStreamDisposal&&e?.isDisposed())return void this.logger.safe.info("Stream is already disposed, skipping audio sharing stream addition");e?.mediaType==="ScreenShare"&&e?.hasAudio()&&(this.logger.safe.info("Adding audio stream from sharing to audio sender"),await this.senders.get("Audio")?.addAdditionalStream(e))}};function V0(e,t=!0){let i={Audio:mY(e.audio),Video:mY(e.video),ScreenShare:mY(e.sharing)};return t||(i.Data=mY(e.data)),i}var V1=class extends no{constructor(e,t,i,n,r){super(i),this.pc=e,this.cryptoMethod=t,this.logger=i,this.configProvider=n,this.diagnostics=r,this.iceConnectionStateInternal="new",this.isWaitingAcceptProvisionalInternal=!1,this.state="new",this.toBeCalledOnConnected=[],this.toBeCalledOnProvisionalConnected=[],this.handleSignalingStateChange=()=>{let e=this.pc.signalingState,t=this.signalingStateInternal;if(this.logger.safe.info(`RTCPeerConnection onsignalingstatechange signalingState: ${this.signalingStateInternal} -> ${e}`),this.signalingStateInternal=e,this.diagnostics.signalingState=e,this.event("signalingStateChanged").raise(this.signalingStateInternal,t,e9()),!this.configProvider.config.useDtlsTrasportConnectionCheck||this.transport||1!==this.cryptoMethod||this.hasPcConnectionState)return;let i=this.pc.getReceivers().find(e=>!!e.transport);this.transport=i?.transport,this.transport&&(this.transport.onstatechange=this.handleDtlsTransportStateChange)},this.handleIceConnectionStateChange=()=>{let e=this.pc.iceConnectionState;this.logger.safe.info(`RTCPeerConnection oniceconnectionstatechange iceConnectionState: ${e} pc.signalingState: ${this.pc.signalingState}`),this.iceConnectionStateInternal=e,this.diagnostics.iceConnectionState=e,this.event("iceConnectionStateChanged").raise(this.iceConnectionStateInternal,e9()),this.shouldRaise(0)&&this.updateState(e)},this.handleConnectionStateChange=()=>{let e=this.pc.connectionState;this.logger.safe.info(`RTCPeerConnection onconnectionStatechange connectionState: ${e} pc.signalingState: ${this.pc.signalingState}`),this.connectionStateInternal=e,this.diagnostics.connectionState=e,this.event("connectionStateChanged").raise(this.connectionStateInternal,e9()),this.shouldRaise(1)&&this.updateState(e)},this.handleDtlsTransportStateChange=()=>{let e=this.transport.state;this.logger.safe.info(`RTCDtlsTransport onstatechange state: ${e} pc.signalingState: ${this.pc.signalingState}`),this.dtlsStateInternal=e,this.diagnostics.dtlsTransportState=e,this.event("dtlsTransportStateChanged").raise(this.dtlsStateInternal,e9()),this.shouldRaise(3)&&this.updateState(e)},this.iceConnectionStateInternal=this.pc.iceConnectionState,this.connectionStateInternal=this.pc.connectionState,this.signalingStateInternal=this.pc.signalingState,this.pc.oniceconnectionstatechange=this.handleIceConnectionStateChange,this.pc.onsignalingstatechange=this.handleSignalingStateChange,this.logger.safe.debug(`ctor ctryptoMethod ${1===this.cryptoMethod?"dtls":"sdes"}, hasPcConnectionState ${this.hasPcConnectionState}`),1===this.cryptoMethod&&this.hasPcConnectionState&&(this.pc.onconnectionstatechange=this.handleConnectionStateChange),this.diagnostics.hasConnectionState=this.hasPcConnectionState}get hasPcConnectionState(){return"connectionState"in this.pc&&this.configProvider.config.useConnectionState}get isWaitingAcceptProvisional(){return this.isWaitingAcceptProvisionalInternal}set isWaitingAcceptProvisional(e){this.isWaitingAcceptProvisionalInternal!==e&&(this.logger.safe.debug(`isProvisional set ${this.isWaitingAcceptProvisionalInternal} -> ${e}`),this.isWaitingAcceptProvisionalInternal=e,this.diagnostics.provisional=e,this.updateState(this.state,!1))}get iceConnectionState(){return this.iceConnectionStateInternal}get signalingState(){return this.signalingStateInternal}get isIceConnected(){return"connected"===this.iceConnectionStateInternal||"completed"===this.iceConnectionStateInternal}get isTransportConnected(){return"connected"===this.state||"completed"===this.state}get isFailed(){return this.configProvider.config.transportStateFailedFix?"failed"===this.state:"failed"===this.state||"closed"===this.state}get isConnected(){return this.isTransportConnected&&"closed"!==this.signalingStateInternal}doOnConnected(e,t="unknown",i=!1,n=!0){if(this.diagnostics.scheduleDoOnConnected(e,t,i,n),n&&this.isConnected&&(i||!this.isWaitingAcceptProvisionalInternal)){this.logger.safe.info(`Running callback immediately ${t}`),this.diagnostics.runDoOnConnected(e,!0),e();return}if(i){this.logger.safe.info(`Queuing provisional connected callback '${t}'`),this.toBeCalledOnProvisionalConnected.push(e);return}this.logger.safe.info(`Queuing connected callback '${t}'`),this.toBeCalledOnConnected.push(e)}dispose(){this.pc.oniceconnectionstatechange=void 0,this.pc.onsignalingstatechange=void 0,this.transport&&(this.transport.onstatechange=void 0),this.pc.onconnectionstatechange&&(this.pc.onconnectionstatechange=void 0),this.diagnostics.dispose()}updateState(e,t=!0){if(t&&(this.statePrevious=this.state),this.state=e,this.event("stateChanged").raise(this.state,this.statePrevious,e9()),this.diagnostics.transportState=e,this.isConnected){if(!this.isWaitingAcceptProvisionalInternal&&this.toBeCalledOnConnected.length)for(this.logger.safe.info(`Running ${this.toBeCalledOnConnected.length} callbacks on connected`);this.toBeCalledOnConnected.length;){let e=this.toBeCalledOnConnected.shift();this.diagnostics.runDoOnConnected(e),e()}if(this.toBeCalledOnProvisionalConnected.length)for(this.logger.safe.info(`Running ${this.toBeCalledOnProvisionalConnected.length} callbacks on provisional connected`);this.toBeCalledOnProvisionalConnected.length;){let e=this.toBeCalledOnProvisionalConnected.shift();this.diagnostics.runDoOnConnected(e),e()}}}shouldRaise(e){switch(e){case 3:if(1!==this.cryptoMethod)throw Error(`DTLS transport is used with cryptoMethod=${this.cryptoMethod}`);if(this.configProvider.config.ignoreClosedDtlsTransportState&&"closed"===this.transport.state)return!1;return!0;case 1:return 1===this.cryptoMethod&&!this.transport;case 0:if(this.configProvider.config.ignoreClosedDtlsTransportState&&this.transport&&"closed"===this.pc.iceConnectionState)return!0;return 0===this.cryptoMethod||!this.transport&&!this.hasPcConnectionState||this.transport&&"disconnected"===this.pc.iceConnectionState||this.transport?.state==="connected"&&"connected"===this.pc.iceConnectionState;default:return this.logger.safe.error(`unknown StateMethod=${e}`),!1}}},V2=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.recvExtenders=new Map,this.sendExtenders=new Map}processStats(e){if(!e)return;let t=new Set;if(e.send)for(let i of(this.diagnostics.handlePresentationAudioInputLevel(),e.send))try{t.add(i.outboundRTP.id);let e=this.sendExtenders.get(i.outboundRTP.id)??new V5(this.diagnostics,this.configProvider);i.outboundRTP.bytesSent<e.lastBytes&&(e=new V5(this.diagnostics,this.configProvider)),this.sendExtenders.set(i.outboundRTP.id,e),e.processSample(i)}catch(e){this.diagnostics.addStatsError("AudioStatsProcessor:send",t$(e))}if(n3(this.sendExtenders,t),t.clear(),e.recv)for(let i of e.recv)try{t.add(i.inboundRTP.id);let e=this.recvExtenders.get(i.inboundRTP.id)??new V3(this.configProvider);i.inboundRTP.bytesReceived<e.lastBytes&&(e=new V3(this.configProvider)),this.recvExtenders.set(i.inboundRTP.id,e),e.processSample(i)}catch(e){this.diagnostics.addStatsError("AudioStatsProcessor:recv",t$(e))}n3(this.recvExtenders,t)}},V3=class{constructor(e){this.configProvider=e,this.useLastSampleDeltaPerSecondConverter=this.configProvider.config.diagnostics.features.useLastSampleDeltaPerSecondConverter,this.duration=0,this.lossRateCalculator=new SJ(this.configProvider.config.disableNormalizationToCalculatePacketLossRate),this.bytesReceivedDiff=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.totalSamplesReceivedDiff=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.concealedSamplesDiff=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.silentConcealedSamplesDiff=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.packetsDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.packetsLostDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.concealedRatioAverager=new SL,this.stretchedRatioAverager=new SL,this.codecSwitchesTracker=new SH,this.packetDurationTracker=new SH,this.jitterAverager=new SL,this.jitterBufferDelayAverager=new SL,this.lastBytes=0}processSample(e){let t,i,n,r,s,a=this.lossRateCalculator.calculate(e.inboundRTP.packetsReceived,e.inboundRTP.packetsLost)??0;this.lastBytes=e.inboundRTP.bytesReceived,this.bytesReceivedDiff.captureSample(e.inboundRTP.bytesReceived,e.inboundRTP.timestamp),this.totalSamplesReceivedDiff.captureSample(e.inboundRTP.totalSamplesReceived,e.inboundRTP.timestamp),this.concealedSamplesDiff.captureSample(e.inboundRTP.concealedSamples,e.inboundRTP.timestamp),this.silentConcealedSamplesDiff.captureSample(e.inboundRTP.silentConcealedSamples,e.inboundRTP.timestamp);let o=this.bytesReceivedDiff.delta&&8*this.bytesReceivedDiff.delta;this.packetsDelta.captureSample(e.inboundRTP.packetsReceived,e.inboundRTP.timestamp),this.packetsLostDelta.captureSample(e.inboundRTP.packetsLost,e.inboundRTP.timestamp);let l=e.inboundRTP.jitterBufferDelay&&e.inboundRTP.jitterBufferEmittedCount&&nB(e.inboundRTP.jitterBufferDelay/e.inboundRTP.jitterBufferEmittedCount*1e3,0),c=e.inboundRTP.jitterBufferDelay&&e.inboundRTP.totalReceivedPackets&&nB(e.inboundRTP.jitterBufferDelay/e.inboundRTP.totalReceivedPackets*1e3,0);if(this.jitterAverager.captureSample(1e3*e.inboundRTP.jitter),this.jitterBufferDelayAverager.captureSample(e.inboundRTP.jitterBufferDelay),t=this.totalSamplesReceivedDiff.delta&&this.concealedSamplesDiff.delta&&this.silentConcealedSamplesDiff.delta&&nB((this.concealedSamplesDiff.delta-this.silentConcealedSamplesDiff.delta)/this.totalSamplesReceivedDiff.delta),e.customHealerStats){e.customHealerStats.numSamplesPerFrame&&(r=e.customHealerStats.decodedSamples/e.customHealerStats.numSamplesPerFrame,s=e.customHealerStats.cngSamples/e.customHealerStats.numSamplesPerFrame),t=e.customHealerStats.healedSamples/(e.customHealerStats.decodedSamples+e.customHealerStats.healedSamples),n=e.customHealerStats.concealSamples&&e.customHealerStats.concealSamples/(e.customHealerStats.decodedSamples+e.customHealerStats.healedSamples),i=e.customHealerStats.stretchSamples&&e.customHealerStats.stretchSamples/(e.customHealerStats.decodedSamples+e.customHealerStats.healedSamples);let a=e.customHealerStats.packetDurationInMs&&e.customHealerStats.packetDurationInMs>100?100:e.customHealerStats.packetDurationInMs;this.concealedRatioAverager.captureSample(n),this.stretchedRatioAverager.captureSample(i),this.codecSwitchesTracker.captureSample(`${e.customHealerStats.pullAdspPayloadType}`),this.packetDurationTracker.captureSample(`${a}`)}e.extensions={lossRate:a,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,healedRatio:t,jitterBufferMs:l,jitterBufferAvgDelayMs:c,bitrate:o||0,customHealerStats:e.customHealerStats&&{concealedDataRatio:n,concealedDataRatioMax:this.concealedRatioAverager.maxSample,stretchedDataRatio:i,stretchedDataRatioMax:this.stretchedRatioAverager.maxSample,numberOfDecodedFrames:r,usageMetricsCodecId:this.codecSwitchesTracker.sortedDurations,percentageOfPtime:this.packetDurationTracker.durationRatios,pushPacketProcessingTimes:e.customHealerStats.pushProcessingTimes,pullPacketProcessingTimes:e.customHealerStats.pullProcessingTimes,pullProcessingTimePerStreamNumber:e.customHealerStats.pullProcessingTimePerStreamNumber,pullTimings:e.customHealerStats.pullTimings,pullStartTiming:e.customHealerStats.pullStartTiming,pullStrategy:e.customHealerStats.pullStrategy,fallbackThreshold:e.customHealerStats.fallbackThreshold,hasFallbackTriggered:e.customHealerStats.hasFallbackTriggered,audioWorkletAvailable:e.customHealerStats.audioWorkletAvailable,audioRendererUsed:e.customHealerStats.audioRendererUsed,cnpPushCount:e.customHealerStats.cnpPushCount,cnpPullCount:e.customHealerStats.cnpPullCount,numberOfCNFrames:s,redPacketsCount:e.customHealerStats.redPacketsCount,pullNumOfStreamsCounter:e.customHealerStats.pullNumOfStreamsCounter},jitterAvg:nB(this.jitterAverager.avg),jitterBufferDelayMs:nB(this.jitterBufferDelayAverager.avg)},this.duration++}},V4=class{constructor(){this.duration=0,this.lossRateAverager=new SL,this.bitrateAverager=new SL,this.jitterBufferAverager=new SL,this.jitterBufferAvgDelayMsAverager=new SL,this.jitterAverager=new SL,this.healedRatioAverager=new SL}processSample(e,t,i){let n=e[0],r={inboundRTP:n.inboundRTP};if(n.transport&&Object.defineProperty(r,"transport",{value:n.transport,configurable:!1,enumerable:!1}),n.codec&&(r.codec=n.codec),n.track&&(r.track=n.track),n.remoteOutboundRTP&&(r.remoteOutboundRTP=n.remoteOutboundRTP),n.extensions){this.lossRateAverager.captureSample(n.extensions.lossRate),this.bitrateAverager.captureSample(n.extensions.bitrate),this.healedRatioAverager.captureSample(n.extensions.healedRatio),this.jitterBufferAverager.captureSample(n.extensions.jitterBufferMs),this.jitterBufferAvgDelayMsAverager.captureSample(n.extensions.jitterBufferAvgDelayMs),this.jitterAverager.captureSample(1e3*n.inboundRTP.jitter);let e=n.inboundRTP.packetsReceived+n.inboundRTP.packetsLost;r.aggregated={lossRateMax:this.lossRateAverager.maxSample,lossRateAvg:this.lossRateAverager.avg,networkAvgLossRate:e>0?n.inboundRTP.packetsLost/e:0,packetsLostAvg:this.duration>0?n.inboundRTP.packetsLost/this.duration:0,duration:this.duration,bitrateAvg:nB(this.bitrateAverager.avg,0),bitrateMax:nB(this.bitrateAverager.maxSample,0),jitterAvg:this.jitterAverager.avg,jitterMax:this.jitterAverager.maxSample,avgJitterBufferSize:this.jitterBufferAverager.avg,avgJitterBufferDelayMs:this.jitterBufferAvgDelayMsAverager.avg,healedRatioAvg:this.healedRatioAverager.avg,healedRatioMax:this.healedRatioAverager.maxSample,customHealerStats:n.extensions.customHealerStats&&{concealedDataRatio:n.extensions.customHealerStats.concealedDataRatio,concealedDataRatioMax:n.extensions.customHealerStats.concealedDataRatioMax,stretchedDataRatio:n.extensions.customHealerStats.stretchedDataRatio,stretchedDataRatioMax:n.extensions.customHealerStats.stretchedDataRatioMax,numberOfDecodedFrames:n.extensions.customHealerStats.numberOfDecodedFrames,usageMetricsCodecId:n.extensions.customHealerStats.usageMetricsCodecId,percentageOfPtime:n.extensions.customHealerStats.percentageOfPtime,pushPacketProcessingTimes:n.extensions.customHealerStats.pushPacketProcessingTimes,pullPacketProcessingTimes:n.extensions.customHealerStats.pullPacketProcessingTimes,pullProcessingTimePerStreamNumber:n.extensions.customHealerStats.pullProcessingTimePerStreamNumber,pullTimings:n.extensions.customHealerStats.pullTimings,pullStartTiming:n.extensions.customHealerStats.pullStartTiming,pullStrategy:n.extensions.customHealerStats.pullStrategy,fallbackThreshold:n.extensions.customHealerStats.fallbackThreshold,hasFallbackTriggered:n.extensions.customHealerStats.hasFallbackTriggered,audioWorkletAvailable:n.extensions.customHealerStats.audioWorkletAvailable,audioRendererUsed:n.extensions.customHealerStats.audioRendererUsed,cnpPushCount:n.extensions.customHealerStats.cnpPushCount,cnpPullCount:n.extensions.customHealerStats.cnpPullCount,numberOfCNFrames:n.extensions.customHealerStats.numberOfCNFrames,redPacketsCount:n.extensions.customHealerStats.redPacketsCount,pullNumOfStreamsCounter:n.extensions.customHealerStats.pullNumOfStreamsCounter},audioLevelAvg:n.inboundRTP.totalSamplesDuration&&nB(n.inboundRTP.totalAudioEnergy/n.inboundRTP.totalSamplesDuration,6)},this.duration++}nq(t,r,i)}},V5=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.useLastSampleDeltaPerSecondConverter=this.configProvider.config.diagnostics.features.useLastSampleDeltaPerSecondConverter,this.duration=0,this.lossRateCalculator=new SJ(this.configProvider.config.disableNormalizationToCalculatePacketLossRate),this.packetsDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.packetsLostDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.bytesSendDiff=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.rttAverager=new SL,this.lastBytes=0}processSample(e){let t=this.lossRateCalculator.calculate(e.remoteInboundRTP?.packetsReceived,e.remoteInboundRTP?.packetsLost)??0;this.packetsDelta.captureSample(e.outboundRTP.packetsSent,e.outboundRTP.timestamp),this.packetsLostDelta.captureSample(e.remoteInboundRTP?.packetsLost,e.remoteInboundRTP?.timestamp),this.lastBytes=e.outboundRTP.bytesSent,this.bytesSendDiff.captureSample(e.outboundRTP.bytesSent,e.outboundRTP.timestamp);let i=this.bytesSendDiff.delta;this.rttAverager.captureSample((e.remoteInboundRTP?.roundTripTime??0)*1e3),e.extensions={lossRate:t,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,bitrate:i?8*i:0,rttAvg:nB(this.rttAverager.avg),callIsMuted:this.diagnostics.callIsMuted,rawInputVolume:this.diagnostics.audioLevel},this.duration++}},V6=class{constructor(e){this.diagnostics=e,this.duration=0,this.lossRateAverager=new SL,this.bitrateAverager=new SL,this.rttAverager=new SL}processSample(e,t,i){let n=e[0],r={outboundRTP:n.outboundRTP};n.transport&&Object.defineProperty(r,"transport",{value:n.transport,configurable:!1,enumerable:!1}),n.codec&&(r.codec=n.codec),n.track&&(r.track=n.track),n.mediaSource&&(r.mediaSource=n.mediaSource),n.remoteInboundRTP&&(r.remoteInboundRTP=n.remoteInboundRTP),n.extensions&&(this.lossRateAverager.captureSample(n.extensions.lossRate),this.bitrateAverager.captureSample(n.extensions.bitrate),this.rttAverager.captureSample(n.remoteInboundRTP?.roundTripTime),r.aggregated={duration:this.duration,lossRateMax:this.lossRateAverager.maxSample,bitrateAvg:nB(this.bitrateAverager.avg,0),bitrateMax:nB(this.bitrateAverager.maxSample,0),rttAvg:nB(this.rttAverager.avg),rttMax:nB(this.rttAverager.maxSample),rawInputVolume:this.diagnostics.audioLevel,audioLevel:n.track?.audioLevel??n.mediaSource?.audioLevel,audioLevelAvg:n.mediaSource?.totalSamplesDuration&&nB(n.mediaSource?.totalAudioEnergy/n.mediaSource?.totalSamplesDuration,6)},this.duration++),nq(t,r,i)}},V8=i(892891),V9=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.recvExtenders=new Map,this.sendExtenders=new Map}processStats(e){if(!e)return;let t=new Set;if(e.send&&(0,V8.flatMap)(e.send,e=>[e,...e.altLayouts??[]]).forEach(e=>{try{t.add(e.outboundRTP.id);let i=this.sendExtenders.get(e.outboundRTP.id)??new Bt(this.diagnostics,this.configProvider);e.outboundRTP.bytesSent<i.lastBytes&&(i=new Bt(this.diagnostics,this.configProvider)),this.sendExtenders.set(e.outboundRTP.id,i),i.processSample(e)}catch(e){this.diagnostics.addStatsError("VideoStatsProcessor:send",t$(e))}}),n3(this.sendExtenders,t),t.clear(),e.recv)for(let i of e.recv)try{t.add(i.inboundRTP.id);let e=this.recvExtenders.get(i.inboundRTP.id)??new V7(this.configProvider);i.inboundRTP.bytesReceived<e.lastBytes&&(e=new V7(this.configProvider)),this.recvExtenders.set(i.inboundRTP.id,e),e.processSample(i)}catch(e){this.diagnostics.addStatsError("VideoStatsProcessor:recv",t$(e))}n3(this.recvExtenders,t)}},V7=class{constructor(e){this.configProvider=e,this.useLastSampleDeltaPerSecondConverter=this.configProvider.config.diagnostics.features.useLastSampleDeltaPerSecondConverter,this.duration=0,this.lossRateCalculator=new SJ(this.configProvider.config.disableNormalizationToCalculatePacketLossRate),this.bytesReceivedDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.framesReceivedDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.framesDecodedDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.trackFramesDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.decodeTimeDelta=this.useLastSampleDeltaPerSecondConverter?new S$(2):new SU,this.packetsDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.packetsLostDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.freezeHistogram=new SB(this.configProvider.config.diagnostics.collectionLimits.numOfHistogramSamples),this.harmonicDecodedFps=new Sq(this.configProvider.config.webrtcStatPollInterval*this.configProvider.config.coeffOfValidTimeDelayBetweenFramesArrival,this.configProvider.config.invalidFPSAboveMax),this.prevTimeToFirstFrame=-1,this.hasPrevFramerate=!1,this.lastBytes=0,this.macroblockStatsTracker=new S0}processSample(e){let t=this.lossRateCalculator.calculate(e.inboundRTP.packetsReceived,e.inboundRTP.packetsLost)??0;this.framesReceivedDelta.captureSample(e.inboundRTP.framesReceived,e.inboundRTP.timestamp),this.framesDecodedDelta.captureSample(e.inboundRTP.framesDecoded,e.inboundRTP.timestamp),this.trackFramesDelta.captureSample(e.inboundRTP.framesReceived??e.track?.framesReceived,e.inboundRTP.timestamp),this.packetsDelta.captureSample(e.inboundRTP.packetsReceived,e.inboundRTP.timestamp),this.packetsLostDelta.captureSample(e.inboundRTP.packetsLost,e.inboundRTP.timestamp);let i=this.framesReceivedDelta.delta,n=this.framesDecodedDelta.delta;this.harmonicDecodedFps.captureSample(n),this.decodeTimeDelta.captureSample(e.inboundRTP.totalDecodeTime,e.inboundRTP.timestamp);let r=this.decodeTimeDelta.delta&&n&&nB(this.decodeTimeDelta.delta/n*1e3,2),s=n>0&&i>0,a=e.renderer?.timeToFirstFrame??(s?0:-1);this.freezeHistogram.active=-1!==a&&-1!==this.prevTimeToFirstFrame&&!s,e.mediaEntity?.modality==="sharing"&&(this.freezeHistogram.active=this.freezeHistogram.active&&!this.hasPrevFramerate),this.prevTimeToFirstFrame=a,this.hasPrevFramerate=s,this.lastBytes=e.inboundRTP.bytesReceived,this.bytesReceivedDelta.captureSample(e.inboundRTP.bytesReceived,e.inboundRTP.timestamp);let o=this.bytesReceivedDelta.delta,l=e.inboundRTP.jitterBufferEmittedCount&&nB((e.inboundRTP.jitterBufferDelay??0)/e.inboundRTP.jitterBufferEmittedCount*1e3),c=SX(e.inboundRTP.frameWidth,e.inboundRTP.frameHeight,i||0),d=SX(e.inboundRTP.frameWidth,e.inboundRTP.frameHeight,n||0);this.macroblockStatsTracker.captureSample(c,d),e.extensions={lossRate:t,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,frameRateReceived:i,frameRateDecoded:n,trackRecvFps:this.trackFramesDelta.delta,decodeTime:r||0,jitterBufferMs:l,bitrate:o?8*o:0,isFrozen:this.freezeHistogram.active,macroblockRateReceived:c,macroblockRateDecoded:d,macroblockRateStats:this.macroblockStatsTracker.getReport(),longestFreeze:this.freezeHistogram.longestDuration,totalFreezeDuration:this.freezeHistogram.totalDuration,powerEfficient:void 0!==e.inboundRTP.powerEfficientDecoder?e.inboundRTP.powerEfficientDecoder:SQ(e.inboundRTP.decoderImplementation),totalFreezeFraction:this.duration?this.freezeHistogram.totalDuration/this.duration:0,fpsHarmonicAverage:nB(this.harmonicDecodedFps.harmonicMean)},this.duration++}},Be=class{constructor(e){this.configProvider=e,this.duration=0,this.lossRateAverager=new SL,this.bitrateAverager=new SL,this.jitterAverager=new SL,this.frameRateAverager=new SL,this.freezeHistogram=new SB(this.configProvider.config.diagnostics.collectionLimits.numOfHistogramSamples),this.harmonicDecodedFps=new Sq(this.configProvider.config.webrtcStatPollInterval*this.configProvider.config.coeffOfValidTimeDelayBetweenFramesArrival,this.configProvider.config.invalidFPSAboveMax),this.resolutionDurations=new SH,this.codecCalculator=new S1}processSample(e,t,i){let n=e.sort((e,t)=>t.inboundRTP.frameHeight*t.inboundRTP.frameWidth-e.inboundRTP.frameHeight*e.inboundRTP.frameWidth)[0],r={inboundRTP:n.inboundRTP};n.transport&&Object.defineProperty(r,"transport",{value:n.transport,configurable:!1,enumerable:!1}),n.codec&&(r.codec=n.codec,this.configProvider.config.isAv1Allowed&&n.mediaEntity?.modality==="sharing"&&this.codecCalculator.captureSample(n.codec.mimeType,n.renderer?.msi)),n.track&&(r.track=n.track),n.remoteOutboundRTP&&(r.remoteOutboundRTP=n.remoteOutboundRTP),n.extensions&&(r.extensions=n.extensions),n.extensions&&(this.harmonicDecodedFps.captureSample(n.extensions.frameRateDecoded),this.lossRateAverager.captureSample(n.extensions.lossRate),this.bitrateAverager.captureSample(n.extensions.bitrate),this.jitterAverager.captureSample((n.inboundRTP.jitter??0)*1e3),this.frameRateAverager.captureSample(n.extensions.frameRateReceived??n.extensions.frameRateDecoded),this.freezeHistogram.active=n.extensions.isFrozen,n.inboundRTP.frameWidth&&n.inboundRTP.frameHeight&&this.resolutionDurations.captureSample(`${n.inboundRTP.frameWidth}x${n.inboundRTP.frameHeight}`),r.aggregated={lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,avgFrameRate:nB(this.frameRateAverager.avg),fpsHarmonicAverage:nB(this.harmonicDecodedFps.harmonicMean),avgJitterBufferSize:nB(this.jitterAverager.avg),bitrateAvg:nB(this.bitrateAverager.avg,0),bitrateMax:nB(this.bitrateAverager.maxSample,0),bitrateMinNonZero:nB(this.bitrateAverager.minNonZeroSample,0),ongoingFreezeDuration:this.freezeHistogram.ongoingDuration,numFreezes:this.freezeHistogram.numEvents,avgFreezeDuration:nB(this.freezeHistogram.avgDuration),longestFreeze:this.freezeHistogram.longestDuration,totalFreezeDuration:this.freezeHistogram.totalDuration,freezeCountHistogram:this.freezeHistogram.counts,freezeTimestampsHistogram:this.freezeHistogram.timestamps,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios,macroblockRateStats:n.extensions.macroblockRateStats,codecReport:this.codecCalculator?.report},this.duration++),tq(t,r,i)}},Bt=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.useLastSampleDeltaPerSecondConverter=this.configProvider.config.diagnostics.features.useLastSampleDeltaPerSecondConverter,this.duration=0,this.lossRateCalculator=new SJ(this.configProvider.config.disableNormalizationToCalculatePacketLossRate),this.lossRateAverager=new SL,this.freezeHistogram=new SB(this.configProvider.config.diagnostics.collectionLimits.numOfHistogramSamples),this.hasPrevFramerate=!1,this.captureFreezeIntervalsCount=0,this.bytesSendDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.encodedFramesDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.sentFramesDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.packetsDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.packetsLostDelta=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.harmonicEncodedFps=new Sq(this.configProvider.config.webrtcStatPollInterval*this.configProvider.config.coeffOfValidTimeDelayBetweenFramesArrival,this.configProvider.config.invalidFPSAboveMax),this.encodeTimeDelta=this.useLastSampleDeltaPerSecondConverter?new S$(2):new SU,this.qpDelta=this.useLastSampleDeltaPerSecondConverter?new S$(3):new SU,this.fsOvershoot=new Sz("fs"),this.fpsOvershoot=new Sz("fps",1),this.brOvershoot=new Sz("br"),this.plisDelta=new SU,this.pliRate=new SY(60),this.resolutionSwitcherTracker=new SZ(this.configProvider.config.diagnostics.collectionLimits.numResolutionSwitches),this.bitrateAverager=new SL,this.rttAverager=new SL,this.qualityLimitationEventsTracker=new S2(this.configProvider.config.diagnostics.collectionLimits.numQualityLimitationEvents),this.powerEfficientEncoderChangeTracker=new S3(this.configProvider.config.diagnostics.collectionLimits.numPowerEfficientEncoderEvents),this.lastBytes=0}processSample(e){let t=this.lossRateCalculator.calculate(e.remoteInboundRTP?.packetsReceived,e.remoteInboundRTP?.packetsLost);this.lossRateAverager.captureSample(t),this.plisDelta.captureSample(e.outboundRTP.pliCount),this.pliRate.captureSample(this.plisDelta.delta),this.packetsDelta.captureSample(e.outboundRTP.packetsSent,e.outboundRTP.timestamp),this.packetsLostDelta.captureSample(e.remoteInboundRTP?.packetsLost,e.remoteInboundRTP?.timestamp),this.lastBytes=e.outboundRTP.bytesSent,this.bytesSendDelta.captureSample(e.outboundRTP.bytesSent,e.outboundRTP.timestamp);let i=this.bytesSendDelta.delta,n=i?8*i:void 0;this.bitrateAverager.captureSample(n),this.rttAverager.captureSample((e.remoteInboundRTP?.roundTripTime??0)*1e3),this.encodedFramesDelta.captureSample(e.outboundRTP.framesEncoded,e.outboundRTP.timestamp);let r=this.encodedFramesDelta.delta;this.sentFramesDelta.captureSample(e.outboundRTP.framesSent,e.outboundRTP.timestamp);let s=this.sentFramesDelta.delta||0;this.harmonicEncodedFps.captureSample(r);let a=e.mediaSource?.framesPerSecond;0===a&&void 0!==this.lastCaptureFramerate&&this.lastCaptureFramerate>0&&this.captureFreezeIntervalsCount++,this.lastCaptureFramerate=a;let o=r>0&&s>0;this.freezeHistogram.active=!o,e.mediaEntity?.modality==="sharing"&&(this.freezeHistogram.active=this.freezeHistogram.active&&!this.hasPrevFramerate),this.hasPrevFramerate=o,this.encodeTimeDelta.captureSample(e.outboundRTP.totalEncodeTime,e.outboundRTP.timestamp);let l=this.encodeTimeDelta.delta&&r&&nB(this.encodeTimeDelta.delta/r*1e3,2);this.qpDelta.captureSample(e.outboundRTP.qpSum,e.outboundRTP.timestamp);let c=this.qpDelta.delta&&r&&nB(this.qpDelta.delta/r,2);e.outboundRTP.frameWidth&&e.outboundRTP.frameHeight&&this.resolutionSwitcherTracker.captureSample(e.outboundRTP.frameWidth,e.outboundRTP.frameHeight);let d=this.diagnostics.deviceManager?.latestCameraOpenResolution,u=e.appliedCapabilities??e.requestedCapabilities;u&&(void 0!==e.outboundRTP.frameHeight&&void 0!==e.outboundRTP.frameWidth&&this.fsOvershoot.captureSample(e.outboundRTP.frameHeight/16*(e.outboundRTP.frameWidth/16),u.maxFs),this.fpsOvershoot.captureSample(s,u.maxFps),u.maxBr&&this.brOvershoot.captureSample(n,u.maxBr));let h=[...this.fsOvershoot.events,...this.brOvershoot.events,...this.fpsOvershoot.events];h.sort((e,t)=>e.timestamp-t.timestamp),e.outboundRTP.frameHeight&&(e.outboundRTP.powerEfficientEncoder||e.outboundRTP.encoderImplementation)&&this.powerEfficientEncoderChangeTracker.captureSample(e.outboundRTP),this.qualityLimitationEventsTracker.captureSample(e.outboundRTP.qualityLimitationReason),e.extensions={cameraOpenResolution:d,lossRate:t,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,pliRate:this.pliRate.getRate(),frameRateEncoded:this.encodedFramesDelta.delta,frameRateSent:s,bitrate:n||0,encodeTime:l||0,qp:c||0,isFrozen:this.freezeHistogram.active,longestFreeze:this.freezeHistogram.longestDuration,totalFreezeDuration:this.freezeHistogram.totalDuration,ongoingFreezeDuration:this.freezeHistogram.ongoingDuration,freezeCountHistogram:this.freezeHistogram.counts,captureFreezeIntervalsCount:this.captureFreezeIntervalsCount,isFsOvershooting:this.fsOvershoot.isOvershooting,isFpsOvershooting:this.fpsOvershoot.isOvershooting,isBrOvershooting:this.brOvershoot.isOvershooting,totalFsOvershootDuration:this.fsOvershoot.totalDuration,totalFpsOvershootDuration:this.fpsOvershoot.totalDuration,totalBrOvershootDuration:this.brOvershoot.totalDuration,overshootEvents:h,powerEfficient:this.powerEfficientEncoderChangeTracker.curPowerEfficientEncoderState,powerEfficientEncoderEvents:this.powerEfficientEncoderChangeTracker.events,powerEfficientEncoderEventOnCount:this.powerEfficientEncoderChangeTracker.eventOnCount,powerEfficientEncoderEventOffCount:this.powerEfficientEncoderChangeTracker.eventOffCount,qualityLimitationEvents:this.qualityLimitationEventsTracker.getReport(),powerEfficientEncoderEventMismatchCount:this.powerEfficientEncoderChangeTracker.eventMismatchCount,bitrateAvg:nB(this.bitrateAverager.avg,0),rttAvg:nB(this.rttAverager.avg)},this.duration++}},Bi=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.duration=0,this.lossRateAverager=new SL,this.bitrateAverager=new SL,this.sendBWEAverager=new SL,this.rttAverager=new SL,this.framerateAverager=new SL,this.captureFpsAverager=new SL,this.captureFreezeIntervalsCount=0,this.lastCaptureFps=void 0,this.resolutionDurations=new SH,this.fsOvershoot=new Sz("fs"),this.fpsOvershoot=new Sz("fps",1),this.brOvershoot=new Sz("br"),this.harmonicEncodedFps=new Sq(this.configProvider.config.webrtcStatPollInterval*this.configProvider.config.coeffOfValidTimeDelayBetweenFramesArrival,this.configProvider.config.invalidFPSAboveMax)}processSample(e,t,i){e.length>1&&e.sort((e,t)=>{let i=e.appliedCapabilities??e.requestedCapabilities,n=t.appliedCapabilities??t.requestedCapabilities;return i?.maxMbps&&n?.maxMbps?n.maxMbps-i.maxMbps:0});let n=e[0],r={outboundRTP:n.outboundRTP};if(n.transport&&Object.defineProperty(r,"transport",{value:n.transport,configurable:!1,enumerable:!1}),n.codec&&(r.codec=n.codec),n.track&&(r.track=n.track),n.mediaSource&&(r.mediaSource=n.mediaSource),n.remoteInboundRTP&&(r.remoteInboundRTP=n.remoteInboundRTP),n.extensions&&(r.extensions=n.extensions),n.mediaEntity&&(r.mediaEntity=n.mediaEntity),n.extensions){this.lossRateAverager.captureSample(n.extensions.lossRate),this.bitrateAverager.captureSample(n.extensions.bitrate),this.sendBWEAverager.captureSample(n.transport?.selectedCandidatePair?.availableOutgoingBitrate),this.rttAverager.captureSample(n.remoteInboundRTP?.roundTripTime),this.framerateAverager.captureSample(n.extensions.frameRateSent);let e=n.mediaSource?.framesPerSecond;this.captureFpsAverager.captureSample(e),0===e&&void 0!==this.lastCaptureFps&&this.lastCaptureFps>0&&this.captureFreezeIntervalsCount++,this.lastCaptureFps=e,n.outboundRTP.frameWidth&&n.outboundRTP.frameHeight&&this.resolutionDurations.captureSample(`${n.outboundRTP.frameWidth}x${n.outboundRTP.frameHeight}`);let t=n.appliedCapabilities??n.requestedCapabilities;t&&(void 0!==n.outboundRTP.frameHeight&&void 0!==n.outboundRTP.frameWidth&&this.fsOvershoot.captureSample(n.outboundRTP.frameHeight/16*(n.outboundRTP.frameWidth/16),t.maxFs),this.fpsOvershoot.captureSample(n.extensions.frameRateSent,t.maxFps),t.maxBr&&this.brOvershoot.captureSample(n.extensions?.bitrate,t.maxBr)),this.harmonicEncodedFps.captureSample(n.extensions.frameRateEncoded);let i=[...this.fsOvershoot.events,...this.fpsOvershoot.events,...this.brOvershoot.events];i.sort((e,t)=>e.timestamp-t.timestamp),r.aggregated={lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,frameRateAvg:nB(this.framerateAverager.avg),captureFramerateAvg:nB(this.captureFpsAverager.avg),fpsHarmonicAverage:nB(this.harmonicEncodedFps.harmonicMean),qpAvg:nB(n.outboundRTP.qpSum/n.outboundRTP.framesSent),rttAvg:nB(this.rttAverager.avg),bitrateAvg:nB(this.bitrateAverager.avg,0),bitrateMax:nB(this.bitrateAverager.maxSample,0),bitrateMinNonZero:nB(this.bitrateAverager.minNonZeroSample,0),bweAvg:nB(this.sendBWEAverager.avg,0),captureFreezeIntervalsCount:this.captureFreezeIntervalsCount,rawInputVolume:this.diagnostics.sharingAudioLevel,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios,isFsOvershooting:this.fsOvershoot.isOvershooting,isFpsOvershooting:this.fpsOvershoot.isOvershooting,isBrOvershooting:this.brOvershoot.isOvershooting,totalFsOvershootDuration:this.fsOvershoot.totalDuration,totalFpsOvershootDuration:this.fpsOvershoot.totalDuration,totalBrOvershootDuration:this.brOvershoot.totalDuration,overshootEvents:i},this.duration++}tq(t,r,i)}},Bn=class{constructor(e){this.configProvider=e,this.samplesCountPerSubscription=0,this.data=new No(this.configProvider.config.diagnostics.collectionLimits.numVideoSubscriptionStats)}prepareCollectingStatsOnSubscribed(e){this.samplesCountPerSubscription=0,this.data.add({timestamp:Date.now(),framesDecoded:[],bytesReceived:[],height:[],msi:e})}captureStatsOnSubscribed(e,t,i){if(this.samplesCountPerSubscription>=this.configProvider.config.diagnostics.collectionLimits.numVideoStatsAfterSubscription)return;let n=nG(this.data.items);n&&(e&&n.framesDecoded.push(e),t&&n.bytesReceived.push(t),i&&n.height.push(i)),this.samplesCountPerSubscription++}get videoStatsOnSubscribed(){return this.data.items}},Br=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.extenders=new Map}processStats(e){let t=new Set;for(let i in e)try{t.add(i);let n=e[i],r=this.extenders.get(n.id)??new Bs(this.configProvider,this.diagnostics);this.extenders.set(n.id,r),r.processSample(n)}catch(e){this.diagnostics.addStatsError("TransportStatsProcessor",t$(e))}n3(this.extenders,t)}},Bs=class{constructor(e,t){this.configProvider=e,this.diagnostics=t,this.useLastSampleDeltaPerSecondConverter=this.configProvider.config.diagnostics.features.useLastSampleDeltaPerSecondConverter,this.bwJumpsHistogramCollector=new SB(this.configProvider.config.diagnostics.collectionLimits.numOfHistogramSamples),this.sendBWEAverager=new SL,this.recvBWEAverager=new SL,this.sendBW=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.recvBW=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.sendBWAverager=new SL,this.recvBWAverager=new SL}processSample(e){this.sendBWEAverager.captureSample(e.selectedCandidatePair?.availableOutgoingBitrate),this.recvBWEAverager.captureSample(e.selectedCandidatePair?.availableIncomingBitrate),this.sendBW.captureSample(e.selectedCandidatePair?.bytesSent,e.selectedCandidatePair?.timestamp),this.recvBW.captureSample(e.selectedCandidatePair?.bytesReceived,e.selectedCandidatePair?.timestamp);let t=this.sendBW.delta,i=this.recvBW.delta,n=t?8*t:void 0,r=i?8*i:void 0;this.sendBWAverager.captureSample(n),this.recvBWAverager.captureSample(r);let s=e.selectedCandidatePair?.availableOutgoingBitrate;s&&(this.bwJumpsHistogramCollector.active=this.bwJumpsHistogramCollector.active&&s<this.configProvider.config.webrtcBWJumpUpperLimit||s<this.configProvider.config.webrtcBWJumpLowerLimit),e.extensions={sendBWEAvg:nB(this.sendBWEAverager.avg,0),sendBWEMax:nB(this.sendBWEAverager.maxSample,0),recvBWEAvg:nB(this.recvBWEAverager.avg,0),recvBWEMax:nB(this.recvBWEAverager.maxSample,0),sendBitrate:n,recvBitrate:r,sendBWAvg:nB(this.sendBWAverager.avg,0),sendBWMax:nB(this.sendBWAverager.maxSample,0),recvBWAvg:nB(this.recvBWAverager.avg,0),recvBWMax:nB(this.recvBWAverager.maxSample,0),bwJumpsHistogram:this.bwJumpsHistogramCollector.counts,reflexiveLocalIP:this.diagnostics.reflexiveLocalIP}}},Ba=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.extenders=new Map}processStats(e){if(!e)return;let t=new Set;for(let i of e)try{t.add(i.id);let e=this.extenders.get(i.id)??new Bo(this.configProvider);this.extenders.set(i.id,e),e.processSample(i)}catch(e){this.diagnostics.addStatsError("DataChannelStatsProcessor",t$(e))}n3(this.extenders,t)}},Bo=class{constructor(e){this.configProvider=e,this.useLastSampleDeltaPerSecondConverter=this.configProvider.config.diagnostics.features.useLastSampleDeltaPerSecondConverter,this.sendBytesDeltaCalculator=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.recvBytesDeltaCalculator=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.sendMessagesDeltaCalculator=this.useLastSampleDeltaPerSecondConverter?new S$:new SU,this.recvMessagesDeltaCalculator=this.useLastSampleDeltaPerSecondConverter?new S$:new SU}processSample(e){this.sendBytesDeltaCalculator.captureSample(e.bytesSent,e.timestamp),this.recvBytesDeltaCalculator.captureSample(e.bytesReceived,e.timestamp);let t=this.sendBytesDeltaCalculator.delta,i=this.recvBytesDeltaCalculator.delta,n=t?8*t:void 0,r=i?8*i:void 0;this.sendMessagesDeltaCalculator.captureSample(e.messagesSent,e.timestamp),this.recvMessagesDeltaCalculator.captureSample(e.messagesReceived,e.timestamp),e.extensions={sendBitrate:n,recvBitrate:r,sendMessageRate:this.sendMessagesDeltaCalculator.delta,recvMessageRate:this.recvMessagesDeltaCalculator.delta}}},Bl=class{constructor(e,t,i,n){this.slidingWindowSize=e,this.maxDeviation=t,this.minBandwidth=i,this.directionalityCheck=n,this.slidingWindow=new No(this.slidingWindowSize),this.currentModality=null,this.previousModality=null,this.inProcess=!1}processBandwidth(e,t,i){this.currentModality?this.handleStopEvent(t,i):this.handleStartEvent(t,i),this.inProcess&&(this.stabilizationTime++,this.slidingWindow.add(e),this.inProcess=!this.slidingWindow.isFull||!this.isBandwidthStable())}getReport(e=!1){if(void 0!==this.stabilizationTime)return{time:this.inProcess?this.stabilizationTime:Math.max(this.stabilizationTime-this.slidingWindowSize,0),bandwidth:e?nB(this.averageBandwidth,2):this.averageBandwidth,finished:!this.inProcess,modality:this.previousModality}}handleStartEvent(e,t){this.currentModality=this.GetModalityString(e),t&&this.currentModality&&!this.previousModality&&(this.previousModality=this.currentModality,this.stabilizationTime=0,this.slidingWindow.clear(),this.inProcess=!0)}handleStopEvent(e,t){t&&(this.directionalityCheck(e.audio)||this.directionalityCheck(e.video)||this.directionalityCheck(e.sharing))||(this.currentModality=null,this.inProcess=!1)}GetModalityString(e){let t=this.directionalityCheck(e.audio)?nu.MODALITY.audio:null;return[t,this.directionalityCheck(e.video)?nu.MODALITY.video:null,this.directionalityCheck(e.sharing)?nu.MODALITY.sharing:null].filter(Boolean).join(", ")}isBandwidthStable(){if(this.averageBandwidth=nv(this.slidingWindow.items),this.averageBandwidth<this.minBandwidth)return!1;{let e=this.averageBandwidth*this.maxDeviation,t=this.averageBandwidth-e,i=this.averageBandwidth+e;return this.slidingWindow.items.every(e=>nx(e,t,i))}}},Bc=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.uplinkStabilizationTelemetry=new Bl(this.configProvider.config.uplinkBWStabilizationSlidingWindowSize,this.configProvider.config.uplinkBWStabilizationMaxDeviation,this.configProvider.config.uplinkBWStabilizationMinBandwidth,mY),this.downlinkStabilizationTelemetry=new Bl(this.configProvider.config.downlinkBWStabilizationSlidingWindowSize,this.configProvider.config.downlinkBWStabilizationMaxDeviation,this.configProvider.config.downlinkBWStabilizationMinBandwidth,mZ),this.bandwidthCalculator=new SK,this.bandwidthAvg=new SL}processStats(e){let t=this.diagnostics.getObjectRef(),i=t?.negotiation.activeModalities;if(!i||!e.transports)return;let n=e.transports[Object.keys(e.transports)[0]],r=t?.reportedReceiveBandwidth?.[t.reportedReceiveBandwidth.length-1],s=n?.selectedCandidatePair?.availableOutgoingBitrate,a=e.audio?.send?.length>0||e.video?.send?.length>0||e.sharing?.send?.length>0,o=e.audio?.recv?.length>0||e.video?.recv?.length>0||e.sharing?.recv?.length>0;this.bweType!==t?.negotiation.bweType&&(this.bandwidthCalculator=new SK,this.bandwidthAvg=new SL,this.bweType=t?.negotiation.bweType);let l=t?.negotiation.bweType==="REMB"?"availableIncomingBitrate":"availableOutgoingBitrate",c=n?.selectedCandidatePair?.[l];this.bandwidthCalculator.captureSample(c),this.bandwidthAvg.captureSample(c);try{this.uplinkStabilizationTelemetry.processBandwidth(s,i,a),this.downlinkStabilizationTelemetry.processBandwidth(r,i,o)}catch(e){this.diagnostics.addStatsError("BandwidthStatsProcessor",t$(e))}}getStabilizedReport(e=!1){return this.uplinkStabilizationTelemetry.getReport(e)}getDownlinkStabilizedReport(e=!1){return this.downlinkStabilizationTelemetry.getReport(e)}calculateBwPercentiles(){if(!this.bandwidthCalculator.getFirst())return;let e=this.configProvider.config.bwPercentiles,t={};return e.forEach(e=>{Object.defineProperty(t,e,{value:this.bandwidthCalculator.calculatePercentile(e/100),enumerable:!0})}),t}getBandwidthReport(){let e=this.bandwidthCalculator.getFirst(),t=this.bandwidthCalculator.getLast(),i=this.bandwidthCalculator.calculateStd();return{startOfTheCall:e,endOfTheCall:t,std:i,bwPercentiles:this.calculateBwPercentiles(),avgBwe:nB(this.bandwidthAvg.avg,2)}}},Bd=class{constructor(e,t){this.diagnostics=e,this.configProvider=t,this.videoSimulcastStreamsData={},this.videoLayoutProcessor=new Bu(this.diagnostics,nu.MODALITY.video),this.sharingSimulcastStreamsData={},this.sharingLayoutProcessor=new Bu(this.diagnostics,nu.MODALITY.sharing)}processStats(e){if(e.video?.send?.length){let t=e.video.send[0],i=[t,...t.altLayouts??[]];this.processSimulcastStream(i,this.videoSimulcastStreamsData),this.videoLayoutProcessor.processLayout(i)}if(e.sharing?.send?.length){let t=e.sharing.send[0],i=[t,...t.altLayouts??[]];this.processSimulcastStream(i,this.sharingSimulcastStreamsData),this.sharingLayoutProcessor.processLayout(i)}this.diagnostics.simulcastReport=this.getSimulcastDiagnostics()}processSimulcastStream(e,t){let{numAggregatedSamples:i}=this.configProvider.config.diagnostics.telemetryLimits;for(let n of e){let e=n.outboundRTP.rid;if(!e)continue;t[e]??(t[e]={sentLayerProcessor:new Bg,appliedLayerProcessor:new Bg,requestedLayerProcessor:new Bg,encoderProcessor:new Bh,debugResolutionTracker:new SH,outboundStats:[],report:{ssrc:n.outboundRTP.ssrc,time:{requested:0,applied:0,sent:0},duration:{requested:0,applied:0,sent:0},restarts:{requested:0,applied:0,sent:0},resolution:{requested:{},applied:{},sent:{}},switching:{requested:{},applied:{},sent:{}},framerate:{requested:{},applied:{},sent:{}},bitrate:{requested:{},applied:{},sent:{}},encoder:{},stats:{},overshootEvents:[]}});let r=t[e],{sentLayer:s,requestedLayer:a,appliedLayer:o}=this.getLayers(n);r.sentLayerProcessor.processLayer(s),r.appliedLayerProcessor.processLayer(o),r.requestedLayerProcessor.processLayer(a),r.encoderProcessor.processVideo(n),o&&s&&r.debugResolutionTracker.captureSample(`${o.width}x${o.height}:${s.width}x${s.height}`),tq(r.outboundStats,n.outboundRTP,i),r.report.time.sent=r.sentLayerProcessor.getTime(),r.report.time.applied=r.appliedLayerProcessor.getTime(),r.report.time.requested=r.requestedLayerProcessor.getTime(),r.report.duration.sent=r.sentLayerProcessor.getDuration(),r.report.duration.applied=r.appliedLayerProcessor.getDuration(),r.report.duration.requested=r.requestedLayerProcessor.getDuration(),r.report.restarts.sent=r.sentLayerProcessor.getRestarts(),r.report.restarts.applied=r.appliedLayerProcessor.getRestarts(),r.report.restarts.requested=r.requestedLayerProcessor.getRestarts(),r.report.resolution.sent=r.sentLayerProcessor.getResolutionDurations(),r.report.resolution.applied=r.appliedLayerProcessor.getResolutionDurations(),r.report.resolution.requested=r.requestedLayerProcessor.getResolutionDurations(),r.report.resolution.debug=r.debugResolutionTracker.durations,r.report.switching.sent=r.sentLayerProcessor.getResolutionSwitches(),r.report.switching.applied=r.appliedLayerProcessor.getResolutionSwitches(),r.report.switching.requested=r.requestedLayerProcessor.getResolutionSwitches(),r.report.framerate.sent=r.sentLayerProcessor.getFpsDurations(),r.report.framerate.applied=r.appliedLayerProcessor.getFpsDurations(),r.report.framerate.requested=r.requestedLayerProcessor.getFpsDurations(),r.report.bitrate.sent=r.sentLayerProcessor.getBitrateDurations(),r.report.bitrate.applied=r.appliedLayerProcessor.getBitrateDurations(),r.report.bitrate.requested=r.requestedLayerProcessor.getBitrateDurations(),r.report.encoder=r.encoderProcessor.getEncoderReport(),r.report.stats.fir=n0(r.outboundStats,e=>e.firCount),r.report.stats.nack=n0(r.outboundStats,e=>e.nackCount),r.report.stats.pli=n0(r.outboundStats,e=>e.pliCount),r.report.stats.packetsSent=n0(r.outboundStats,e=>e.packetsSent),r.report.overshootEvents=n.extensions?.overshootEvents,r.report.totalBrOvershootDuration=n.extensions?.totalBrOvershootDuration,r.report.totalFpsOvershootDuration=n.extensions?.totalFpsOvershootDuration,r.report.totalFsOvershootDuration=n.extensions?.totalFsOvershootDuration,r.report.totalFreezeDuration=n.extensions?.totalFreezeDuration,r.report.ongoingFreezeDuration=n.extensions?.ongoingFreezeDuration,r.report.freezeHistogram=n.extensions?.freezeCountHistogram}}getSimulcastDiagnostics(){if(!(nE(this.videoSimulcastStreamsData)&&nE(this.sharingSimulcastStreamsData)))return{video:{streams:Object.fromEntries(Object.entries(this.videoSimulcastStreamsData).map(([e,{report:t}])=>[e,t])),layouts:this.videoLayoutProcessor.getLayoutReport()},sharing:{streams:Object.fromEntries(Object.entries(this.sharingSimulcastStreamsData).map(([e,{report:t}])=>[e,t])),layouts:this.sharingLayoutProcessor.getLayoutReport()}}}getLayers(e){let t=e.outboundRTP.rid,i=this.diagnostics.getObjectRef().qualityManager,n=e=>Object.values(e).find(e=>e.rid===t),r=n(e.mediaEntity?.modality==="sharing"?i.currentSharingSsrcAppliedCapabilities:i.currentVideoSsrcAppliedCapabilities),s=n(e.mediaEntity?.modality==="sharing"?i.currentSharingSsrcRequestedCapabilities:i.currentVideoSsrcRequestedCapabilities);return{sentLayer:e.outboundRTP.frameHeight&&{height:e.outboundRTP.frameHeight,width:e.outboundRTP.frameWidth,framerate:e.extensions?.frameRateSent,bitrate:e.extensions?.bitrate},appliedLayer:r&&Bp(r),requestedLayer:s&&Bp(s)}}},Bu=class{constructor(e,t){this.diagnostics=e,this.modality=t,this.sentResolutionTracker=new SH,this.requestedResolutionTracker=new SH,this.appliedResolutionTracker=new SH,this.debugResolutionTracker=new SH}processLayout(e){let t=e=>e.filter(e=>e.width&&e.height).sort((e,t)=>e.height-t.height).map(e=>`${e.width}x${e.height}`).join(":"),i=e=>Object.values(e).map(Bp),n=t(e.map(e=>({height:e.outboundRTP.frameHeight,width:e.outboundRTP.frameWidth,framerate:e.extensions?.frameRateSent,bitrate:e.extensions?.bitrate}))),r=this.diagnostics.getObjectRef().qualityManager,s="sharing"===this.modality?r.currentSharingSsrcAppliedCapabilities:r.currentVideoSsrcAppliedCapabilities,a="sharing"===this.modality?r.currentSharingSsrcRequestedCapabilities:r.currentVideoSsrcRequestedCapabilities,o=t(i(s)),l=t(i(a));n&&this.sentResolutionTracker.captureSample(n),l&&this.requestedResolutionTracker.captureSample(l),o&&this.appliedResolutionTracker.captureSample(o),o&&n&&this.debugResolutionTracker.captureSample(`${o}->${n}`)}getLayoutReport(){return{requested:this.requestedResolutionTracker.durations,sent:this.sentResolutionTracker.durations,applied:this.appliedResolutionTracker.durations,debug:this.debugResolutionTracker.durations}}},Bh=class{constructor(){this.report={}}processVideo(e){var t,i;let{encoderImplementation:n,frameWidth:r,frameHeight:s,rid:a}=e.outboundRTP,{encodeTime:o}=e.extensions;if(!n||!s)return;let l=S4(n,a),c=`${r}x${s}`;(t=this.report)[l]??(t[l]={resolutionTracker:new SH,encodingHistograms:{},report:{resolution:{},encodeTime:{},restarts:0}});let d=this.report[l];d.resolutionTracker.captureSample(c),(i=d.encodingHistograms)[c]??(i[c]=new SH),d.encodingHistograms[c].captureSample(Bv(o)),d.report.resolution=d.resolutionTracker.durations,d.report.encodeTime[c]=d.encodingHistograms[c].durations,this.prevEncoder&&this.prevEncoder!==l&&d.report.restarts++,this.prevEncoder=l}getEncoderReport(){return Object.fromEntries(Object.entries(this.report).map(([e,{report:t}])=>[e,t]))}},Bg=class{constructor(){this.resolutionTracker=new SH,this.switchingTracker=new SH,this.fpsTracker=new SH,this.bitrateTracker=new SH,this.durationTracker=new UR,this.startedAt=0}processLayer(e){e?(this.startedAt||(this.startedAt=nQ()),this.durationTracker.start(),this.resolutionTracker.captureSample(`${e.width}x${e.height}`),this.fpsTracker.captureSample(Bm(e.framerate)),this.bitrateTracker.captureSample(Bf(e.bitrate)),this.lastLayout&&(this.lastLayout.width!==e.width||this.lastLayout.height!==e.height)&&this.switchingTracker.captureSample([this.lastLayout,e].sort((e,t)=>e.width-t.width).map(e=>`${e.width}x${e.height}`).join(":"))):this.durationTracker.stop(),this.lastLayout=e}getResolutionDurations(){return this.resolutionTracker.durations}getResolutionSwitches(){return this.switchingTracker.durations}getFpsDurations(){return this.fpsTracker.durations}getBitrateDurations(){return this.bitrateTracker.durations}getRestarts(){return Math.max(0,this.durationTracker.count-1)}getTime(){return this.startedAt}getDuration(){return this.durationTracker.elapsed}};function Bp(e){let t={...ra.Send.getResolutionByFs(e.maxFs)};return 405===e.maxFs&&(t.width=426,t.height=240),{width:t.width,height:t.height,framerate:e.maxFps,bitrate:e.maxBr}}function Bf(e){return BS(e,[{limit:4e6,label:"4M+"},{limit:25e5,label:"2.5M-4M"},{limit:15e5,label:"1.5M-2.5M"},{limit:1e6,label:"1M-1.5M"},{limit:8e5,label:"800k-1M"},{limit:5e5,label:"500k-800k"},{limit:25e4,label:"250k-500k"},{limit:1e5,label:"100k-250k"},{limit:5e4,label:"50k-100k"},{limit:1e4,label:"10k-50k"},{limit:0,label:"0-10k"}])}function Bm(e){return BS(e,[{limit:60,label:"60+"},{limit:30,label:"31-60"},{limit:15,label:"16-30"},{limit:7,label:"8-15"},{limit:3,label:"4-7"},{limit:1,label:"1-3"}])}function Bv(e){return BS(e,[{limit:100,label:"100+ ms"},{limit:30,label:"30-100 ms"},{limit:10,label:"10-30 ms"},{limit:5,label:"5-10 ms"},{limit:2,label:"2-5 ms"},{limit:1,label:"1-2 ms"}])}function BS(e,t){for(let{limit:i,label:n}of t)if(e>i)return n;return`${e}`}var By=class{constructor(e,t){this.configProvider=e,this.diagnostics=t,this.dataChannelStatsProcessor=new Ba(this.diagnostics,this.configProvider),this.transportStatsProcessor=new Br(this.diagnostics,this.configProvider),this.audioStatsProcessor=new V2(this.diagnostics,this.configProvider),this.videoStatsProcessor=new V9(this.diagnostics,this.configProvider),this.sharingStatsProcessor=new V9(this.diagnostics,this.configProvider),this.bandwidthStatsProcessor=new Bc(this.diagnostics,this.configProvider),this.simulcastStatsProcessor=new Bd(this.diagnostics,this.configProvider),this.macroblockStatsTracker=new S0,this.statsAggregators={audio:{recv:new V4,send:new V6(this.diagnostics)},video:{recv:new Be(this.configProvider),send:new Bi(this.diagnostics,this.configProvider)},sharing:{recv:new Be(this.configProvider),send:new Bi(this.diagnostics,this.configProvider)}},this.aggregatedModalityStats={},this.recvVideoStreamsCounter=new SF,this.multiviewData={},this.multipleAudioData={},this.multiviewKeySet=new Set,this.multipleAudioKeySet=new Set,this.statsOnSubscribedData={video:{},sharing:{}},this.statsOnSubscribed={video:[],sharing:[]},this.diagnostics.aggregatedStatsRef=this.aggregatedModalityStats,this.diagnostics.statsOnSubscribed=this.statsOnSubscribed,this.diagnostics.bandwidthDiagnostic=this.bandwidthStatsProcessor}processStats(e){let t=this.configProvider.config.diagnostics.enabledStatsProcessors;this.execute(()=>this.dataChannelStatsProcessor.processStats(e.data),"dataChannelStatsProcessor",t.dataChannel),this.execute(()=>this.transportStatsProcessor.processStats(e.transports),"transportStatsProcessor",t.transport),this.execute(()=>this.audioStatsProcessor.processStats(e.audio),"audioStatsProcessor",t.audio),this.execute(()=>this.videoStatsProcessor.processStats(e.video),"videoStatsProcessor",t.video),this.execute(()=>this.sharingStatsProcessor.processStats(e.sharing),"sharingStatsProcessor",t.sharing),this.execute(()=>{this.bandwidthStatsProcessor.processStats(e),this.diagnostics.bwStabilizationTime=this.bandwidthStatsProcessor.getStabilizedReport(!0),this.diagnostics.bwDownlinkStabilizationTime=this.bandwidthStatsProcessor.getDownlinkStabilizedReport(!0)},"bandwidthStatsProcessor",t.bandwidth),this.execute(()=>{this.recvVideoStreamsCounter.captureSample(e.video?.recv?.length),this.diagnostics.recvVideoStreamsCount={min:this.recvVideoStreamsCounter.min,max:this.recvVideoStreamsCounter.max,mode:this.recvVideoStreamsCounter.mode}},"recvVideoStreamsCounter",t.recvVideoStreamsCounter),this.execute(()=>this.processAggregated(e),"processAggregated",t.aggregated),this.execute(()=>this.processMultiview(e.video?.recv??[]),"processMultiview",t.multiview),this.execute(()=>this.processMultipleAudio(e.audio?.recv??[]),"processMultipleAudio",t.multipleAudio),this.execute(()=>this.simulcastStatsProcessor.processStats(e),"processSimulcastStats",t.simulcast),this.execute(()=>this.processNetworkInfoStats(),"processNetworkInfoStats",t.networkInfo),this.execute(()=>this.processMacroblockRateStats(e.video?.recv),"processMacroblockRateStats",t.macroblockRate)}signalNoConnection(){this.transportStatsProcessor=new Br(this.diagnostics,this.configProvider),this.audioStatsProcessor=new V2(this.diagnostics,this.configProvider),this.videoStatsProcessor=new V9(this.diagnostics,this.configProvider),this.sharingStatsProcessor=new V9(this.diagnostics,this.configProvider)}processNetworkInfoStats(){let e=navigator?.connection;e&&this.diagnostics.addNetworkInfo({downlink:e.downlink,rtt:e.rtt,effectiveType:e.effectiveType,saveData:e.saveData})}processMultiview(e){let t=new Set;for(let i of e){let e=i.inboundRTP.id;t.add(e);let n=this.multiviewData[e];n&&this.multiviewKeySet.has(e)?n.stats.duration++:((n={bitrateAverager:new SL,jitterAverager:new SL,frameRateAverager:new SL,freezeHistogram:new SB(this.configProvider.config.diagnostics.collectionLimits.numOfHistogramSamples),resolutionDurations:new SH,isRenderingEvents:[],statsOnSubscribed:new Bn(this.configProvider),stats:{ssrc:i.inboundRTP.ssrc,startTime:Date.now(),duration:0,framesDecoded:[],bytesReceived:[],height:[],width:[]}}).statsOnSubscribed.prepareCollectingStatsOnSubscribed(i.renderer?.msi),this.multiviewData[e]=n),n.statsOnSubscribed.captureStatsOnSubscribed(i.inboundRTP.framesDecoded,i.inboundRTP.bytesReceived,i.inboundRTP.frameHeight),n.bitrateAverager.captureSample(i.extensions?.bitrate),n.jitterAverager.captureSample((i.inboundRTP.jitter??0)*1e3),n.frameRateAverager.captureSample(i.extensions.frameRateReceived),n.freezeHistogram.active=i.extensions?.isFrozen,i.inboundRTP.frameWidth&&i.inboundRTP.frameHeight&&n.resolutionDurations.captureSample(`${i.inboundRTP.frameWidth}x${i.inboundRTP.frameHeight}`);let r=i.renderer?.isRendering??!1;(!n.isRenderingEvents.length&&r||n.isRenderingEvents.length&&nG(n.isRenderingEvents).isRendering!==r)&&nq(n.isRenderingEvents,{isRendering:r,ts:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numIsRenderingEvents),n.stats.frameRateAvg=nB(n.frameRateAverager.avg),n.stats.bitrateAvg=nB(n.bitrateAverager.avg,0),n.stats.bitrateMax=nB(n.bitrateAverager.maxSample,0),n.stats.bitrateMinNonZero=nB(n.bitrateAverager.minNonZeroSample),n.stats.freezeHistogram=n.freezeHistogram.counts,n.stats.freezeTimestamps=n.freezeHistogram.timestamps,n.stats.avgFreezeDuration=nB(n.freezeHistogram.avgDuration),n.stats.totalFreezeDuration=n.freezeHistogram.totalDuration,n.stats.ongoingFreeze=n.freezeHistogram.active,n.stats.ongoingFreezeDuration=n.freezeHistogram.ongoingDuration,n.stats.numResolutionSwitches=n.resolutionDurations.changeCount,n.stats.rendererSize=`${i.renderer?.rendererSize?.width}x${i.renderer?.rendererSize?.height}`,n.stats.resolutionDurations=n.resolutionDurations.durations,n.stats.timeToFirstFrame=i.renderer?.timeToFirstFrame,n.stats.timeToFirstFrameSinceSubscriptionStart=i.renderer?.timeToFirstFrameSinceSubscriptionStart,n.stats.isRenderingEvents=n.isRenderingEvents,n.stats.statsOnSubscribed=n.statsOnSubscribed.videoStatsOnSubscribed,n.stats.msi=i.renderer?.msi,n.stats.rendererStates=i.renderer?.rendererStates,nq(n.stats.framesDecoded,i.inboundRTP.framesDecoded,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples),nq(n.stats.bytesReceived,i.inboundRTP.bytesReceived,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples),nq(n.stats.height,i.inboundRTP.frameHeight,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples),nq(n.stats.width,i.inboundRTP.frameWidth,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples);let s=i.extensions?.macroblockRateStats??{};for(let e in s)n.stats[e]=nB(s[e],0)}this.diagnostics.multiViewStats=Object.values(this.multiviewData).map(e=>e.stats),this.multiviewKeySet=t}processMultipleAudio(e){if(e.length<2)return;let t=new Set;for(let i of e){let e=i.inboundRTP.id;t.add(e);let n=this.multipleAudioData[e];n&&this.multipleAudioKeySet.has(e)?n.stats.duration++:(n={bitrateAverager:new SL,packetsLostAverager:new SL,audioLevelAverager:new SL,stats:{ssrc:i.inboundRTP.ssrc,startTime:Date.now(),duration:0,bytesReceived:[],packetsReceived:[],packetsLost:[],audioLevel:[]}},this.multipleAudioData[e]=n),n.bitrateAverager.captureSample(i.extensions?.bitrate),n.packetsLostAverager.captureSample(i.inboundRTP.packetsLost),n.audioLevelAverager.captureSample(i.inboundRTP.audioLevel),n.stats.bitrateAvg=nB(n.bitrateAverager.avg,0),n.stats.bitrateMax=nB(n.bitrateAverager.maxSample,0),n.stats.bitrateMinNonZero=nB(n.bitrateAverager.minNonZeroSample),n.stats.packetsLostAvg=nB(n.packetsLostAverager.avg),n.stats.audioLevelAvg=nB(n.audioLevelAverager.avg,2);let r=this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples;nq(n.stats.bytesReceived,i.inboundRTP.bytesReceived,r),nq(n.stats.packetsReceived,i.inboundRTP.packetsReceived,r),nq(n.stats.packetsLost,i.inboundRTP.packetsLost,r),nq(n.stats.audioLevel,i.inboundRTP.audioLevel,r)}this.diagnostics.multipleAudioStats=Object.values(this.multipleAudioData).map(e=>e.stats),this.multipleAudioKeySet=t}processAggregated(e){for(let t of["audio","video","sharing"])if(e[t])for(let i in e[t])this.processAggregatedModality(e,t,i)}processAggregatedModality(e,t,i){var n,r;e[t]?.[i]?.length&&((n=this.aggregatedModalityStats)[t]??(n[t]={}),(r=this.aggregatedModalityStats[t])[i]??(r[i]=[]),this.statsAggregators[t][i].processSample(e[t][i],this.aggregatedModalityStats[t][i],this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples),("sharing"===t||"video"===t)&&"recv"===i&&this.processStatsOnSubscribed(e[t][i],t))}processStatsOnSubscribed(e,t){let i=new Set;for(let n of e)if(n.inboundRTP){let e=`${n.inboundRTP.id}x${n.renderer?.msi}`,r=this.statsOnSubscribedData[t]?.[e];i.add(e),r||((r=new Bn(this.configProvider)).prepareCollectingStatsOnSubscribed(n.renderer?.msi),this.statsOnSubscribedData[t][e]=r,this.statsOnSubscribed[t].push(...r.videoStatsOnSubscribed)),r.captureStatsOnSubscribed(n.inboundRTP.framesDecoded,n.inboundRTP.bytesReceived,n.inboundRTP.frameHeight)}n2(this.statsOnSubscribedData[t],i)}processMacroblockRateStats(e){if(!e?.length)return;let t=0,i=0;for(let n of e)t+=n.extensions?.macroblockRateReceived,i+=n.extensions?.macroblockRateDecoded;this.macroblockStatsTracker.captureSample(t,i),this.diagnostics.setTotalVideoRecvMblocksRates(this.macroblockStatsTracker.getReport())}execute(e,t,i){try{i&&e()}catch(e){this.diagnostics.addStatsError(`webrtcStatistics:${t}`,t$(e))}}},BC=i(892891),Bb=class{constructor(e,t,i,n){this.logger=e,this.configProvider=t,this.diagnostics=i,this.mediaManager=n,this.webrtcStats=new By(this.configProvider,this.diagnostics),this.ssrcToRecvTrackMap=new Map,this.activeChannels={}}setAudioDecoderStatsProvider(e){this.audioDecoderStatsProvider=e}setAudioEncoderCodecName(e){this.audioEncoderCodecName=e}signalNoConnection(){this.webrtcStats.signalNoConnection()}processRawReport(e){this.diagnostics.latestRawReport=e;let t={loopTime:-1,fetchTime:-1,convertTime:-1,processingTime:-1,legacyProcessingTime:-1};try{let i=nQ(),n=i,r=this.convertStatsReport(e);return r.perfCounters=t,t.convertTime=(i=nQ())-n,n=i,this.webrtcStats.processStats(r),this.diagnostics.addStatsReport(r),t.processingTime=(i=nQ())-n,r}catch(t){let e=t$(t);this.logger.safe.error(`Error processing raw stats: ${e}`),this.diagnostics.addStatsError("StatisticsGatherer:processRawReport",e);return}}setSsrcTrackPair(e,t){null===t?this.ssrcToRecvTrackMap.delete(e):this.ssrcToRecvTrackMap.set(e,t)}convertStatsReport(e){let t={transports:this.processTransportStats(e)};return this.appendPcStats(e,t),this.appendSendMediaStats(e,t),this.appendRecvMediaStats(e,t),e["data-channel"]&&(t.data=Object.values(e["data-channel"])),t}processTransportStats(e){if(e.transport){let t={};for(let i in e.transport){let n=e.transport[i];if(t[i]=nI(n),n.selectedCandidatePairId){let r=nI(e["candidate-pair"][n.selectedCandidatePairId]);r.localCandidate=e["local-candidate"][r.localCandidateId],r.remoteCandidate=e["remote-candidate"][r.remoteCandidateId],t[i].selectedCandidatePair=r}n.localCertificateId&&e.certificate&&(t[i].localCertificate=e.certificate[n.localCertificateId]),n.remoteCertificateId&&e.certificate&&(t[i].remoteCertificate=e.certificate[n.remoteCertificateId])}return t}if(e["candidate-pair"]){let t={};for(let i in e["candidate-pair"]){let n=nI(e["candidate-pair"][i]);n.selected&&(n.localCandidate=e["local-candidate"][n.localCandidateId],n.remoteCandidate=e["remote-candidate"][n.remoteCandidateId],t.faketransport={id:"faketransport",timestamp:n.timestamp,type:"transport",selectedCandidatePair:n,selectedCandidatePairId:n.id})}return t}}appendPcStats(e,t){let i="";e["peer-connection"]&&(Object.keys(e["peer-connection"]).forEach(e=>{""===i?i=e:(this.logger.safe.error(`Unexpected second peer connection stats id ${e}, also found ${i}`),this.diagnostics.addStatsError("StatisticsGatherer","Unexpected second peer connection stats"))}),t.peerConnection=e["peer-connection"][i])}appendSendMediaStats(e,t){var i,n,r,s;for(let a in e["outbound-rtp"]){let o=e["outbound-rtp"][a],l={outboundRTP:o};o.codecId&&e.codec&&(l.codec=e.codec[o.codecId]),Object.defineProperty(l,"transport",{value:t.transports[o.transportId??"faketransport"],configurable:!1,enumerable:!1}),o.remoteId&&e["remote-inbound-rtp"]&&(l.remoteInboundRTP=e["remote-inbound-rtp"][o.remoteId]),o.mediaSourceId&&e["media-source"]&&(l.mediaSource=e["media-source"][o.mediaSourceId]),o.trackId&&e.track&&(l.track=e.track[o.trackId]);let c=Bw(this.mediaManager,l.track?.trackIdentifier??l.mediaSource?.trackIdentifier,o.rid)??BI(this.mediaManager,o.ssrc,o.rid)??BM(this.mediaManager,l.outboundRTP.mid,o.rid);if(!c?.getLocalTrackId())continue;l.mediaEntity=c.serialize(),!l.mediaSource&&l.mediaEntity&&e["media-source"]&&(l.mediaSource=Object.values(e["media-source"]).find(e=>e.trackIdentifier===l.mediaEntity.localTrackId));let d="video"===o.kind?c?.getModality()==="sharing"?"sharing":"video":o.kind;if((i=this.activeChannels)[d]??(i[d]={}),(n=this.activeChannels[d]).send??(n.send={}),!mY(this.diagnostics.getObjectRef().negotiation.activeModalities?.[d])){this.activeChannels[d].send[o.id]&&"sharing"!==d&&(t.inactiveTracks??(t.inactiveTracks={}),(r=t.inactiveTracks)[d]??(r[d]={}),(s=t.inactiveTracks[d]).send??(s.send=[]),t.inactiveTracks[d].send.push(this.activeChannels[d].send[o.id]));continue}if(t[d]||(t[d]={}),t[d].send||(t[d].send=[]),"video"===o.kind){let e=BP(this.diagnostics,d,o.ssrc)??BP(this.diagnostics,d,0);e&&(l.requestedCapabilities=e);let i=BR(this.diagnostics,d,o.ssrc)??BR(this.diagnostics,d,0);i&&(l.appliedCapabilities=i);let n=t[d].send.find(e=>e.outboundRTP.trackId===l.outboundRTP.trackId);if(n){let e=parseInt(n.outboundRTP.rid,10)>parseInt(l.outboundRTP.rid,10);if(!n.altLayouts&&e&&(n.altLayouts=[]),e)n.altLayouts.push(l);else{l.altLayouts=[n,...n.altLayouts??[]],delete n.altLayouts;let e=t[d].send.indexOf(n);t[d].send[e]=l}continue}}"audio"===o.kind&&l.codec&&this.audioEncoderCodecName&&"None"!==this.audioEncoderCodecName&&(this.configProvider.config.diagnostics.traceLogging&&this.logger.safe.debug("replacing send audio codec with custom audio encoder codec"),l.codec.mimeType=this.audioEncoderCodecName),this.activeChannels[d].send[o.id]=l,t[d].send.push(l)}}appendRecvMediaStats(e,t){var i,n,r,s;let a=this.diagnostics.getObjectRef().subscriptionManager?.subscribedTrackIds;for(let o in e["inbound-rtp"]){let l=e["inbound-rtp"][o],c={inboundRTP:l};l.codecId&&e.codec&&(c.codec=e.codec[l.codecId]),"audio"===l.kind&&c.inboundRTP.ssrc===this.audioDecoderStatsProvider?.ssrc&&(this.configProvider.config.diagnostics.traceLogging&&this.logger.safe.debug("replacing recv audio stats with custom audio decoder stats"),c.codec||(c.codec={transportId:l.transportId??"faketransport",id:"fakeCodec",payloadType:999,timestamp:l.timestamp,type:"codec",mimeType:"unk"}),c.codec.mimeType=this.audioDecoderStatsProvider.codecName,c.inboundRTP=(0,BC.merge)(c.inboundRTP,this.audioDecoderStatsProvider.getWebRtcCompatibleStats()),c.customHealerStats=this.audioDecoderStatsProvider.getWasmStats()),t.transports[l.transportId??"faketransport"]&&Object.defineProperty(c,"transport",{value:t.transports[l.transportId??"faketransport"],configurable:!1,enumerable:!1}),l.remoteId&&e["remote-outbound-rtp"]&&(c.remoteOutboundRTP=e["remote-outbound-rtp"][l.remoteId]);let d=c.inboundRTP.trackIdentifier??this.ssrcToRecvTrackMap.get(l.ssrc);if(l.trackId||d){l.trackId&&e.track?c.track=e.track[l.trackId]:d&&(c.track={id:"ssrcToTrackId",kind:l.kind,timestamp:l.timestamp,type:"track",trackIdentifier:d});let t=BA(this.diagnostics,c.track?.trackIdentifier);t&&(c.renderer=t)}let u=B_(this.mediaManager,c.track?.trackIdentifier)??BE(this.mediaManager,l.ssrc);if(!u)continue;c.mediaEntity=u.serialize();let h="video"===l.kind&&c.track?u?.getModality()==="sharing"?"sharing":"video":l.kind;if((i=this.activeChannels)[h]??(i[h]={}),(n=this.activeChannels[h]).recv??(n.recv={}),"video"===l.kind&&!a.some(e=>e&&e===c.track?.trackIdentifier)){this.activeChannels[h].recv[l.id]&&"sharing"!==h&&(t.inactiveTracks??(t.inactiveTracks={}),(r=t.inactiveTracks)[h]??(r[h]={}),(s=t.inactiveTracks[h]).recv??(s.recv=[]),t.inactiveTracks[h].recv.push(this.activeChannels[h].recv[l.id]));continue}mZ(this.diagnostics.getObjectRef().negotiation.activeModalities?.[h])&&(t[h]||(t[h]={}),t[h].recv||(t[h].recv=[]),this.activeChannels[h].recv[l.id]=c,t[h].recv.push(c))}}};function BT(e,t){return!t||e.getSimulcastContext()?.activeRids.map(String).some(e=>e===t)}function BE(e,t){return e.getMediaEntities().find(e=>e.getRemoteSsrc()===t)}function B_(e,t){let i=e.getMediaEntities();return void 0!==t?i.find(e=>e.getRemoteTrackId()===t):void 0}function BI(e,t,i){return e.getMediaEntities().find(e=>e.getLocalSsrc()===t&&BT(e,i))}function Bw(e,t,i){let n=e.getMediaEntities();return t?n.find(e=>e.getLocalTrackId()===t&&BT(e,i)):void 0}function BP(e,t,i){let n=e.getObjectRef().qualityManager;return"video"===t?n?.currentVideoSsrcRequestedCapabilities[`${i}`]:"sharing"===t?n?.currentSharingSsrcRequestedCapabilities[`${i}`]:void 0}function BR(e,t,i){let n=e.getObjectRef().qualityManager;return"video"===t?n?.currentVideoSsrcAppliedCapabilities[`${i}`]:"sharing"===t?n?.currentSharingSsrcAppliedCapabilities[`${i}`]:void 0}function BA(e,t){return e.getObjectRef().remoteVideoManager?.renderers.find(e=>e.trackId===t)}function BM(e,t,i){let n=e.getMediaEntities();return t?n.find(e=>e.getMid()===t&&BT(e,i)):void 0}var BD=class{constructor(){this.googCandidatePair={},this.ssrc={},this.googComponent={},this.VideoBwe={bweforvideo:{}}}},BO=class{constructor(){this.statistics=new BD,this.statsDiffMap=new Map,this.ssrcTrackMap=new Map}build(e){return this.statistics=new BD,this.constructGoogCandidatePair(e),this.constructGoogSsrc(e),this.constructGoogComponent(e),this.constructDataChannel(e),this.constructBwe(e),this.statistics}setSsrcTrackPair(e,t){null===t?this.ssrcTrackMap.delete(e):this.ssrcTrackMap.set(e,t)}setAudioDecoderStatsProvider(e){this.audioDecoderStatsProvider=e}setAudioEncoderCodecName(e){this.audioEncoderCodecName=e}constructGoogSsrc(e){let t={};if(e.hasOwnProperty("outbound-rtp")){let i=e["outbound-rtp"];Object.keys(i).forEach(n=>{let r=`ssrc_${i[n].ssrc}_send`,s=this.constructSendSsrc(e,i[n]);t[r]=s})}if(e.hasOwnProperty("inbound-rtp")){let i=e["inbound-rtp"];Object.keys(i).forEach(n=>{let r=`ssrc_${i[n].ssrc}_recv`,s=this.constructRecvSsrc(e,i[n]);t[r]=s})}this.statistics.ssrc=t}constructSendSsrc(e,t){let i=t.trackId?e.track[t.trackId]:null,n=t.mediaSourceId?e["media-source"][t.mediaSourceId]:null,r=e["remote-inbound-rtp"]?.[t.remoteId],s=`ssrc_${t.ssrc}_send`,a=n?.trackIdentifier??i?.trackIdentifier??this.ssrcTrackMap.get(t.ssrc),o={id:s,ssrc:t.ssrc,mediaType:t.mediaType??t.kind,bytesSent:t.bytesSent,bytesSentDiff:this.calculateDiff(s,t.bytesSent,4),packetsSent:t.packetsSent,packetsLost:r?.packetsLost,jitter:r?.jitter,googRtt:this.getRtt(r),googCodecName:this.getCodec(e,t.codecId),transportId:t.transportId,googTrackId:a};return"audio"===o.mediaType&&(o={...o,...this.constructAudioSendSsrc(t,n)}),"video"===o.mediaType&&(o={...o,...this.constructVideoSendSsrc(t,n,s,i)}),nP(o)}constructAudioSendSsrc(e,t){let i={audioInputLevel:t?.audioLevel,totalAudioEnergy:t?.totalAudioEnergy,fecPacketsSent:e.fecPacketsSent};return this.audioEncoderCodecName&&"None"!==this.audioEncoderCodecName&&(i.googCodecName=this.audioEncoderCodecName),i}constructVideoSendSsrc(e,t,i,n){return{framesEncoded:e.framesEncoded,googFrameRateEncoded:this.calculateDiff(i,e.framesEncoded,2),googFrameRateSent:this.calculateDiff(i,e.framesSent??n?.framesSent,1),googFrameRateInput:t?.framesPerSecond,googFrameHeightSent:e.frameHeight??n?.frameHeight,googFrameWidthSent:e.frameWidth??n?.frameWidth,googFrameHeightInput:t?.height,googFrameWidthInput:t?.width,hugeFramesSent:e.hugeFramesSent??n?.hugeFramesSent,keyFramesEncoded:e.keyFramesEncoded,qpSum:e.qpSum,qp:this.calculateDiff(i,e.qpSum,8),googPlisReceived:e.pliCount,googFirsReceived:e.firCount,googNacksReceived:e.nackCount,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,codecImplementationName:e.encoderImplementation,rid:e.rid,encodeTime:e.totalEncodeTime&&Math.round(1e3*this.calculateDiff(i,e.totalEncodeTime,6))}}constructRecvSsrc(e,t){let i=t.trackId?e.track[t.trackId]:null,n=`ssrc_${t.ssrc}_recv`,r=t.trackIdentifier??i?.trackIdentifier??this.ssrcTrackMap.get(t.ssrc),s={id:n,ssrc:t.ssrc,mediaType:t.mediaType??t.kind,bytesReceived:t.bytesReceived,bytesReceivedDiff:this.calculateDiff(n,t.bytesReceived,5),packetsReceived:t.packetsReceived,packetsLost:t.packetsLost,jitter:t.jitter,googJitterBufferMs:t.jitterBufferEmittedCount&&Math.round(t.jitterBufferDelay/t.jitterBufferEmittedCount*1e3),googCodecName:this.getCodec(e,t.codecId),googTrackId:r,transportId:t.transportId};return"audio"===s.mediaType&&(s={...s,...this.constructAudioRecvSsrc(t,i)}),"video"===s.mediaType&&(s={...s,...this.constructVideoRecvSsrc(t,n,i)}),nP(s)}constructAudioRecvSsrc(e,t){let i=this.audioDecoderStatsProvider?.ssrc===e.ssrc?this.audioDecoderStatsProvider?.getWebRtcCompatibleStats():e,n={audioOutputLevel:i.audioLevel??t?.audioLevel,totalAudioEnergy:i.totalAudioEnergy??t?.totalAudioEnergy,concealedSamples:i.concealedSamples,silentConcealedSamples:i.silentConcealedSamples,totalSamplesReceived:i.totalSamplesReceived,healedRatio:i.totalSamplesReceived&&(i.concealedSamples-i.silentConcealedSamples)/i.totalSamplesReceived,fecPacketsReceived:i.fecPacketsReceived,fecPacketsDiscarded:i.fecPacketsDiscarded,packetsDiscarded:i.packetsDiscarded};if(this.audioDecoderStatsProvider?.ssrc===e.ssrc){n.googJitterBufferMs=i.jitterBufferEmittedCount&&Math.round(i.jitterBufferDelay/i.jitterBufferEmittedCount*1e3),n.googCodecName=this.audioDecoderStatsProvider.codecName;let e=this.audioDecoderStatsProvider.getDecoderStats();n.pushCount=e.pushCount,n.pushErrCount=e.pushErrCount,n.pullCount=e.pullCount,n.pullErrCount=e.pullErrCount}return n}constructVideoRecvSsrc(e,t,i){return{framesDecoded:e.framesDecoded,googFrameRateDecoded:this.calculateDiff(t,e.framesDecoded,3),googFrameRateReceived:this.calculateDiff(t,e.framesReceived??i?.framesReceived,0),googFrameHeightReceived:e.frameHeight??i?.frameHeight,googFrameWidthReceived:e.frameWidth??i?.frameWidth,keyFramesDecoded:e.keyFramesDecoded,googPlisSent:e.pliCount,googFirsSent:e.firCount,googNacksSent:e.nackCount,codecImplementationName:e.decoderImplementation,decodeTime:e.totalDecodeTime&&Math.round(1e3*this.calculateDiff(t,e.totalDecodeTime,7))}}constructGoogCandidatePair(e){let t=e["candidate-pair"];t&&Object.keys(t).forEach(i=>{let n=this.constructPair(e,t[i]);this.statistics.googCandidatePair[n.id]=n})}constructPair(e,t){let i=e["local-candidate"][t.localCandidateId],n=e["remote-candidate"][t.remoteCandidateId];return nP({bytesReceived:t.bytesReceived,bytesSent:t.bytesSent,googTransportType:i.protocol,googRtt:t.currentRoundTripTime?Math.round(1e3*t.currentRoundTripTime):void 0,googLocalAddress:`${i.ip?i.ip:i.address}:${i.port}`,googLocalCandidateType:i.candidateType,localRelayProtocol:i.relayProtocol,localNetworkType:i.networkType,googRemoteAddress:`${n.ip?n.ip:n.address}:${n.port}`,googRemoteCandidateType:n.candidateType,googActiveConnection:t.nominated,requestsReceived:t.requestsReceived,requestsSent:t.requestsSent,responsesReceived:t.responsesReceived,responsesSent:t.responsesSent,consentRequestsSent:t.consentRequestsSent,id:t.id,remoteCandidateId:t.remoteCandidateId,localCandidateId:t.localCandidateId,googWritable:t.writable,selected:t.selected,packetsDiscardedOnSend:t.packetsDiscardedOnSend})}constructGoogComponent(e){e.transport&&Object.keys(e.transport).forEach(t=>{this.statistics.googComponent[t]={id:t,selectedCandidatePairId:e.transport[t].selectedCandidatePairId}})}constructDataChannel(e){if(!e.hasOwnProperty("data-channel"))return;let t=e["data-channel"];this.statistics.data=Object.keys(t).map(e=>{let i=t[e];return{bytesReceived:i.bytesReceived,bytesSent:i.bytesSent,dataChannelIdentifier:i.dataChannelIdentifier,label:i.label,messagesReceived:i.messagesReceived,messagesSent:i.messagesSent,protocol:i.protocol,state:i.state,timestamp:i.timestamp,type:i.type}})}constructBwe(e){let t=Object.values(e["outbound-rtp"]??{})?.find(e=>{let t=e.mediaType??e.kind;return"audio"===t||"video"===t});if(!t)return;let i=e.transport?.[t.transportId];if(!i)return;let n=e["candidate-pair"]?.[i.selectedCandidatePairId];if(!n)return;let r={googAvailableSendBandwidth:n.availableOutgoingBitrate,googAvailableReceiveBandwidth:n.availableIncomingBitrate};this.statistics.VideoBwe.bweforvideo=nP(r)}getRtt(e){let t=e?.roundTripTime;return t?Math.round(1e3*t):void 0}getCodec(e,t){if(t&&e.codec&&e.codec[t])return e.codec[t].mimeType.split("/").pop()}calculateDiff(e,t,i){if(void 0===t)return;let n=t,r=this.statsDiffMap.has(e)?this.statsDiffMap.get(e):new Map;if(r.has(i)){let e=r.get(i);e<=t&&(n=t-e)}return r.set(i,t),this.statsDiffMap.set(e,r),isNaN(n)?void 0:n}},Bk=i(892891),BN=class{constructor(e){this.configProvider=e,this.audioAnalyzers=new Map,this.jitterBufferDuration=0,this.jitterBufferTotal=0,this.jitterTotal=0,this.jitterDuration=0,this.rttDuration=0,this.rttTotal=0,this.rttMax=0,this.jitterMax=0}captureJitterBuffer(e){this.jitterBufferDuration+=nu.TIME_INTERVAL.SEC_1,this.jitterBufferTotal+=e}captureJitter(e){let t=1e3*e;this.jitterTotal+=t,this.jitterMax=Math.max(t,this.jitterMax),this.jitterDuration+=nu.TIME_INTERVAL.SEC_1}getJitterAvg(){return this.jitterDuration?nB(this.jitterTotal/this.jitterDuration):0}getAvgJitterBuffer(){return this.jitterBufferDuration?Math.round(this.jitterBufferTotal/this.jitterBufferDuration):0}captureRtt(e){if(null!==e){let t=parseInt(e);this.rttDuration+=nu.TIME_INTERVAL.SEC_1,this.rttTotal+=t,this.rttMax=Math.max(this.rttMax,t)}}getAvgRtt(){return this.rttDuration?nB(this.rttTotal/this.rttDuration):0}getMaxRtt(){return this.rttMax}getJitterMax(){return this.jitterMax}updateSendStream(e,t){if(!this.configProvider.config.useAudioAnalyzer)return;let i=this.audioAnalyzers.get(t);i&&(i.dispose(),this.audioAnalyzers.delete(t)),e?.rawStream?.getAudioTracks().length&&this.audioAnalyzers.set(t,new xW(e.rawStream))}getInputLevel(e){let t=this.audioAnalyzers.get(e);return t?.getInputLevelNormalized()}},Bx=class{constructor(e,t){this.dropBadBandwidth=e,this.dropGoodBandwidth=t,this.dropDurationCounts={},Object.keys(nu.HISTOGRAM_BATCH).forEach(e=>{this.dropDurationCounts[e]=0})}recordSendBandwidth(e){this.currentDropDuration&&e<this.dropGoodBandwidth||e<this.dropBadBandwidth?this.initiateDrop():this.currentDropDuration&&e>this.dropGoodBandwidth&&this.recoverDrop()}getReport(){let e=nI(this.dropDurationCounts);return this.currentDropDuration&&(e.ongoingDuration=this.currentDropDuration),e}initiateDrop(){this.currentDropDuration?this.currentDropDuration++:this.currentDropDuration=1}recoverDrop(){for(let e of Object.keys(nu.HISTOGRAM_BATCH))if(this.currentDropDuration<=nu.HISTOGRAM_BATCH[e]){this.dropDurationCounts[e]+=1,this.currentDropDuration=0;break}}},BL=class{constructor(e){this.configProvider=e,this.qualityLimitationReasonEvents=[]}setQualityLimitationReason(e){this.lastQualityLimitationReason!==e&&this.qualityLimitationReasonEvents.push({event:e,startTime:Date.now(),endTime:Date.now()}),this.qualityLimitationReasonEvents.length>this.configProvider.config.maxStoredQualityLimitationReasonEvents&&this.qualityLimitationReasonEvents.shift(),this.lastQualityLimitationReason=e}getQualityLimitationReasonEvents(){return this.qualityLimitationReasonEvents.reduce((e,t,i)=>"none"===t.event?e:[...e,{...t,endTime:this.qualityLimitationReasonEvents[i+1]?.startTime??Date.now()}],[])}},BF=class{constructor(){this.bitrateData={[nu.MEDIA_DIRECTION.SEND]:{lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0,allocateBW:0,allocateBWSamples:0},[nu.MEDIA_DIRECTION.RECV]:{lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0}}}captureSample(e,t){let i=Date.now()/1e3;if(0!==this.bitrateData[e].lastTimestamp&&t>this.bitrateData[e].lastBytes){let n=i-this.bitrateData[e].lastTimestamp,r=(t-this.bitrateData[e].lastBytes)*8/n;this.onBitrateSample(e,r)}this.bitrateData[e].lastTimestamp=i,this.bitrateData[e].lastBytes=t}getMax(e){return Math.round(this.bitrateData[e].maxSample)}getAvg(e){return 0===this.bitrateData[e].nSamples?0:Math.round(this.bitrateData[e].bitrateTotal/this.bitrateData[e].nSamples)}stopCapture(e){this.bitrateData[e].lastBytes=0,this.bitrateData[e].lastTimestamp=0}onBitrateSample(e,t){t>this.bitrateData[e].maxSample&&(this.bitrateData[e].maxSample=t),this.bitrateData[e].bitrateTotal+=t,this.bitrateData[e].nSamples++}captureAllocateBandwidth(e){if(e){let t=parseInt(e[e.length-1]);this.bitrateData[nu.MEDIA_DIRECTION.SEND].allocateBW+=t,this.bitrateData[nu.MEDIA_DIRECTION.SEND].allocateBWSamples+=1}}getAllocateBandwidthAvg(){let e=this.bitrateData[nu.MEDIA_DIRECTION.SEND].allocateBW,t=this.bitrateData[nu.MEDIA_DIRECTION.SEND].allocateBWSamples;if(e>0&&t>0)return Math.floor(e/t)}},BU=class{constructor(e,t){this.maxAppliedCapabilitiesCount=t,this.events=[],this.events.push({eventType:"req",timestamp:Date.now(),capabilities:e.capabilities,isSimulcast:e.isSimulcastEnabled})}setMaxCapabilitiesApplied(e){this.events.push({eventType:"app",timestamp:Date.now(),capabilities:e.capabilities,error:e.error?`${e.error}`:"none"}),this.maxAppliedCapabilitiesCount&&this.events.length>this.maxAppliedCapabilitiesCount+1&&this.events.splice(1,1)}getEvents(){return this.events}},B$=class{constructor(e,t){this.configProvider=e,this.logger=t,this.resolutionChangeRequestRecords={},this.currentResolutionsByRid={},this.resolutionChangeCounterByRid={},this.events=[],this.errors=[]}setMaxCapabilitesRequested(e){let t=new BU(e,this.configProvider.config.webrtcLastAppliedVideoCapabilitiesCount);this.events.push({causeId:e.causeId,seq:t}),this.recordResolutionChange(e),this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.length>this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.shift()}setMaxCapabilitesApplied(e){let t=this.events.find(t=>t.causeId===e.causeId);if(!t)return void this.logger.safe.warn(`Requested capabilities with id ${e.causeId} not found`);t.seq.setMaxCapabilitiesApplied(e),e.error&&this.errors.push(t)}getEvents(){return this.events.map(e=>({causeId:e.causeId,events:e.seq.getEvents()}))}getErrors(){return this.errors.map(e=>({causeId:e.causeId,events:e.seq.getEvents()}))}getResolutionRecords(){if(this.configProvider.config.specCompliantSimulcast?.collectResolutionInfo)return{req:this.resolutionChangeRequestRecords,count:this.resolutionChangeCounterByRid}}recordResolutionChange(e){if(this.configProvider.config.specCompliantSimulcast?.collectResolutionInfo){let t=Object.keys(this.currentResolutionsByRid),i=e=>e.rid||"default";[...t,...e.capabilities.map(e=>i(e))].forEach(t=>{let n=e.capabilities.find(e=>i(e)===t),r=this.currentResolutionsByRid[t]||0,s=n?.maxFs||0;if(r===s)return;this.resolutionChangeRequestRecords[t]||(this.resolutionChangeRequestRecords[t]=[],this.resolutionChangeCounterByRid[t]=0);let a=this.resolutionChangeRequestRecords[t].find(e=>e.from===r&&e.to===s);a?a.counter++:this.resolutionChangeRequestRecords[t].push({from:r,to:s,counter:1}),this.currentResolutionsByRid[t]=s,this.resolutionChangeCounterByRid[t]++})}}},BV=class{constructor(){this.delayCur=[],this.delayTotal=0,this.delayEventCount=0}analyzeDelay(e,t){if(t&&""!==t){this.delayCur.length===e&&this.delayCur.shift();let i=parseInt(t);this.delayCur.push(i),this.delayTotal+=i,this.delayEventCount+=nu.TIME_INTERVAL.SEC_1}}getDelayCur(){if(this.delayCur.length>0){let e=this.delayCur.reduce((e,t)=>e+t)/this.delayCur.length;return e<0?0:e}}getDelayAvg(){if(this.delayEventCount>0&&this.delayTotal>0){let e=this.delayTotal/this.delayEventCount;return e<0?0:e}}},BB=class{constructor(){this.mediaData={[nu.MEDIA_DIRECTION.SEND]:{totalMediaDuration:-1,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0},[nu.MEDIA_DIRECTION.RECV]:{totalMediaDuration:-1,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0}},this.gatheringSendData=!1}captureMediaData(e,t,i){let n=this.mediaData[e];if(e===nu.MEDIA_DIRECTION.SEND&&(this.gatheringSendData=!0),t){let e=parseInt(t[t.length-1],10);n.totalFrameCount+=e}if(i){-1===n.totalMediaDuration&&(n.totalMediaDuration=0);let e=parseInt(i[i.length-1],10);!n.mediaStarted&&e>0&&(n.mediaStarted=!0,n.mediaStartTimestamp=new Date)}n.mediaStarted&&(n.totalMediaDuration+=nu.TIME_INTERVAL.SEC_1)}captureFrameRate(e){let t=this.mediaData[nu.MEDIA_DIRECTION.SEND];if(e){let i=parseInt(e[e.length-1],10);t.cameraFrameRate+=i}}stopRecvDataGathering(){let e=this.mediaData[nu.MEDIA_DIRECTION.RECV],t=new Date().getTime();e.timeSinceLastDecode=e.totalMediaDuration>0?Math.round((t-e.mediaStartTimestamp.getTime())/1e3):0,e.mediaStarted=!1}isGatheringSendData(){return this.gatheringSendData}stopSendDataGathering(){let e=this.mediaData[nu.MEDIA_DIRECTION.SEND],t=new Date;e.timeSinceLastDecode=e.totalMediaDuration>0?Math.round((t.getTime()-e.mediaStartTimestamp.getTime())/1e3):0,this.gatheringSendData=!1,e.mediaStarted=!1}getAvgFrameRate(e){let t=this.mediaData[e];if(t.totalMediaDuration>0&&t.totalFrameCount>0)return t.totalFrameCount/t.totalMediaDuration}getTotalDuration(e){let t=this.mediaData[e];return t.totalMediaDuration>=0?t.totalMediaDuration:void 0}getTimeSinceLastDecode(e){let t=this.mediaData[e];return t.timeSinceLastDecode>0?t.timeSinceLastDecode:void 0}getSendCameraFramerate(){let e=this.mediaData[nu.MEDIA_DIRECTION.SEND];if(e.totalMediaDuration>0)return e.cameraFrameRate/e.totalMediaDuration}},BH={fs:0,fps:1},Bj=class{constructor(e){this.logger=e,this.allowed=new Map,this.lastParams=new Map,this.currentEvents=new Map,this.finishedEvents=[]}setMaxCapabilities(e){e.forEach(e=>{if(e.ssrc||0===e.ssrc){this.finishIfActive(e.ssrc),this.allowed.set(e.ssrc,{fs:e.maxFs+BH.fs,fps:e.maxFps+BH.fps});let t=this.lastParams.get(e.ssrc);t&&this.setCurrentParams(e.ssrc,t.fs,t.fps)}})}setCurrentParams(e,t,i){this.lastParams.set(e,{fs:t,fps:i});let n=this.getAllowedParams(e);n&&(t>n.fs||i>n.fps)?(this.captureOvershoot(e,i,n.fps,"fps"),this.captureOvershoot(e,t,n.fs,"fs")):n&&this.finishIfActive(e)}flush(){this.currentEvents.forEach((e,t)=>this.finishIfActive(t))}getEvents(){let e=[...nw(this.finishedEvents)],t=Date.now();return this.currentEvents.forEach(i=>i.forEach(i=>e.push({ssrc:i.ssrc,timestamp:i.timestamp,duration:t-i.timestamp,overshootType:i.overshootType,amount:i.amount}))),e}captureOvershoot(e,t,i,n){let r=this.currentEvents.get(e)||[],s=r.findIndex(e=>e.overshootType===n),a=r[s],o=t-i,l=BH[n];o<=l&&a?(a.duration=Date.now()-a.timestamp,this.finishedEvents.push(a),this.logger.debug(`stopped overshooting ${n} by ${a.amount}`),r.splice(s,1)):o>l&&!a?(this.logger.safe.info(`overshooting ${n} by ${t-i}`),r.push({ssrc:e,timestamp:Date.now(),duration:-1,overshootType:n,amount:{min:o,max:o}})):o>l&&a&&(a.amount={min:Math.min(a.amount.min,o),max:Math.max(a.amount.max,o)}),r.length?this.currentEvents.set(e,r):this.currentEvents.has(e)&&this.currentEvents.delete(e)}getAllowedParams(e){let t=this.allowed.get(e);return t||this.allowed.get(0)}finishIfActive(e){let t=this.currentEvents.get(e);if(t){let i=Date.now();t.forEach(t=>{t.duration=i-t.timestamp,this.finishedEvents.push(t),this.logger.debug(`finished overshooting ${t.overshootType} by min:${t.amount.min} max:${t.amount.max} for ${t.duration}ms for ssrc ${e}`)}),this.currentEvents.delete(e)}}},Bq=class{constructor(){this.qpData={[nu.MEDIA_DIRECTION.SEND]:{frames:0,qpSum:0},[nu.MEDIA_DIRECTION.RECV]:{frames:0,qpSum:0}}}captureQpData(e,t,i){let n=this.qpData[e];if(i&&i.length>0){let e=parseInt(i[i.length-1],10);e>0&&(n.frames=e)}if(t){let e=parseInt(t,10);e>0&&(n.qpSum=e)}}getQpAverage(e){let t=this.qpData[e];if(t.qpSum>0&&t.frames>0)return t.qpSum/t.frames}},BW=class{constructor(){this.resolutionChangedCount=0,this.resDurations={},this.preferredResolutionDurations={},this.preferredResolutions=[]}get resolutionSwitchCount(){return this.resolutionChangedCount}get resolutionDurationRatios(){return this.countResolutionDurationRatio(this.resDurations)}get preferredResolutionDurationRatios(){return this.countResolutionDurationRatio(this.preferredResolutionDurations)}get preferredResolution(){return this.preferredResolutions}captureSample(e){e&&e.width&&e.height&&(this.isResolutionChanged(this.lastResolution,e)&&this.resolutionChanged(e),this.updateResolutionDuration(this.getResolutionKey(e),this.resDurations)),this.lastPreferredResolution&&this.updatePreferredResolutionDurations()}capturePreferredResolution(e,t){let i=this.getResolutionKey(e);this.preferredResolution.includes(i)||(this.preferredResolutions.length>=t&&this.preferredResolutions.shift(),this.preferredResolutions.push(i)),this.isResolutionChanged(this.lastPreferredResolution,e)&&(this.preferredResolutionChanged(e),this.updatePreferredResolutionDurations())}getResolutionKey(e){return`${e.width}x${e.height}`}isResolutionChanged(e,t){return!e||e.width!==t.width||e.height!==t.height}countResolutionDurationRatio(e){let t={},i=0;for(let t in e)i+=e[t];for(let n in e)t[n]=nB(e[n]/i*100,2);return t}updatePreferredResolutionDurations(){this.updateResolutionDuration(this.getResolutionKey(this.lastPreferredResolution),this.preferredResolutionDurations)}updateResolutionDuration(e,t){t[e]||(t[e]=0),t[e]++}preferredResolutionChanged(e){this.lastPreferredResolution=e}resolutionChanged(e){this.lastResolution=e,this.resolutionChangedCount++}},BG=class{constructor(){this.streamsTimers={}}countRecvStreams(e){let t=`${e}`;this.streamsTimers.hasOwnProperty(t)||(this.streamsTimers[t]=0),this.streamsTimers[t]++}getStreamCounts(){let e={min:void 0,max:void 0,mode:void 0},t=Object.keys(this.streamsTimers).map(Number);return 0===t.length||1===t.length&&0===t[0]||(e.min=Math.min(...t.filter(e=>e>0)),e.max=Math.max(...t),e.mode=t.reduce((e,t)=>this.streamsTimers[t]>this.streamsTimers[e]?t:e,t[0])),e}},Bz=class{constructor(e){this.configProvider=e,this.subscriptionEvents=[],this.subscriptionCounters={attempted:0,subscribed:0,unsubscribed:0,failed:0}}addSubscriptionEvent(e){switch(this.subscriptionEvents.length>this.configProvider.config.webrtcSubscriptionEventLimit&&this.subscriptionEvents.shift(),this.subscriptionEvents.push(e),e.evt){case 1:this.subscriptionCounters.attempted++;break;case 2:this.subscriptionCounters.subscribed++;break;case 3:this.subscriptionCounters.unsubscribed++;break;case -1:this.subscriptionCounters.failed++}}getSubscriptionEvents(){return this.subscriptionEvents.length>0?{events:this.subscriptionEvents}:void 0}getSubscriptionCounters(){return this.subscriptionEvents.length>0?this.subscriptionCounters:void 0}},BJ=class{constructor(e,t,i){this.startTime=e,this.configProvider=t,this.logger=i,this.subscriptionCounter=0,this.videoDelayTelemetry=new BV,this.videoSubscriptionEvents=new Bz(this.configProvider),this.videoQPEvents=new Bq,this.videoResolutionTelemetry=new BW,this.videoGeneralTelemetry=new BB,this.videoStreamsCounters=new BG,this.videoBitrate=new BF,this.videoMaxCapabilities=new B$(this.configProvider,this.logger),this.videoOvershoot=new Bj(this.logger),this.videoQualityLimitations=new BL(this.configProvider),this.videoStatsOnSubscribed=new Bn(this.configProvider),this.videoResolutionSwitchTracker=new SZ(this.configProvider.config.diagnostics?.collectionLimits?.numResolutionSwitches),this.timeToFirstFrame=-1,this.timeToFirstFrameSinceSubscriptionStart=-1,this.currentTrackId="",this.isRenderingEvents=[]}get trackId(){return this.currentTrackId}set trackId(e){this.currentTrackId=e}get isRecvDataGatheringEnabled(){return this.subscriptionCounter>0}startStopRecvDataGathering(e){this.logger.safe.info(`Receive data gathering is ${e?"enabled":"disabled"}`),e?this.subscriptionCounter++:this.subscriptionCounter--,this.subscriptionCounter<0&&this.logger.safe.error(`Subscription counter should not be less than 0. Actual value is ${this.subscriptionCounter}`),0===this.subscriptionCounter&&this.stopRecvGathering()}stopDataGathering(){this.stopRecvGathering(),this.stopSendGathering()}stopRecvGathering(){this.videoGeneralTelemetry.stopRecvDataGathering(),this.videoBitrate.stopCapture(nu.MEDIA_DIRECTION.RECV)}isSendGathering(){return this.videoGeneralTelemetry.isGatheringSendData()}stopSendGathering(){this.videoGeneralTelemetry.stopSendDataGathering(),this.videoBitrate.stopCapture(nu.MEDIA_DIRECTION.SEND),this.videoOvershoot.flush()}analyzeDelay(e,t){this.videoDelayTelemetry.analyzeDelay(e,t)}getDelayCur(){return this.videoDelayTelemetry.getDelayCur()}getDelayAvg(){return this.videoDelayTelemetry.getDelayAvg()}addSubscriptionEvent(e){this.videoSubscriptionEvents.addSubscriptionEvent(e)}getSubscriptionEvents(){return this.videoSubscriptionEvents.getSubscriptionEvents()}getSubscriptionCounters(){return this.videoSubscriptionEvents.getSubscriptionCounters()}captureQpData(e,t,i){this.videoQPEvents.captureQpData(e,t,i)}getQpAverage(e){return this.videoQPEvents.getQpAverage(e)}captureMediaData(e,t,i){this.videoGeneralTelemetry.captureMediaData(e,t,i)}captureFrameRate(e){this.videoGeneralTelemetry.captureFrameRate(e)}getTotalDuration(e){return this.videoGeneralTelemetry.getTotalDuration(e)}captureResolutionSample(e){this.videoResolutionTelemetry.captureSample(e)}countRecvStreams(e){this.videoStreamsCounters.countRecvStreams(e)}captureBitrateSample(e,t){this.videoBitrate.captureSample(e,t)}captureAllocateBandwidth(e){this.videoBitrate.captureAllocateBandwidth(e)}capturePreferredResolution(e,t){this.videoResolutionTelemetry.capturePreferredResolution(e,t)}setMaxCapabilitesRequested(e,t=!1){this.videoMaxCapabilities.setMaxCapabilitesRequested(e),!t&&(1!==e.capabilities.length||e.capabilities[0]?.ssrc)&&this.setMaxCapabilitiesOvershoot(e.capabilities)}setMaxCapabilitesApplied(e,t=!1){this.videoMaxCapabilities.setMaxCapabilitesApplied(e),!t&&(1!==e.capabilities.length||e.capabilities[0]?.ssrc)&&this.setMaxCapabilitiesOvershoot(e.capabilities)}getMaxCapabilitiesEvents(){return JSON.stringify(this.videoMaxCapabilities.getEvents())}getMaxCapabilitiesResolutionChanges(){let e=this.videoMaxCapabilities.getResolutionRecords();return e?JSON.stringify(e):""}getMaxCapabilitiesErrors(){let e=this.videoMaxCapabilities.getErrors();return e?JSON.stringify(e):""}setCurrentParameters(e,t,i){this.videoOvershoot.setCurrentParams(e,t.height/16*(t.width/16),i)}setMaxCapabilitiesOvershoot(e){this.videoOvershoot.setMaxCapabilities(e)}getOvershootEvents(){let e=this.videoOvershoot.getEvents();return(e=e.slice(Math.max(0,e.length-(this.configProvider.config.maxReportedOvershootingEvents+1)),e.length)).forEach(e=>e.timestamp=e.timestamp-this.startTime),JSON.stringify(e)}getOvershootTotalDurations(){let e=this.videoOvershoot.getEvents();return e.forEach(e=>e.timestamp=e.timestamp-this.startTime),JSON.stringify({fs:e.reduce((e,t)=>"fs"===t.overshootType?e+t.duration:e,0),fps:e.reduce((e,t)=>"fps"===t.overshootType?e+t.duration:e,0)})}setQualityLimitationReason(e){this.videoQualityLimitations.setQualityLimitationReason(e)}getQualityLimitationReasonEvents(){return this.videoQualityLimitations.getQualityLimitationReasonEvents()}captureTimeToFirstFrame(e,t){-1!==e&&(this.timeToFirstFrame=e,this.timeToFirstFrameSinceSubscriptionStart=t)}getTimeToFirstFrame(){return this.timeToFirstFrame}setIsRendering(e){nq(this.isRenderingEvents,{isRendering:e,ts:Date.now()},this.configProvider.config.diagnostics.telemetryLimits.numIsRenderingEvents)}setMsi(e){this.msi=e}setLocalMsi(e){this.localMsi=e}prepareCollectingStatsOnSubscribed(e){this.videoStatsOnSubscribed.prepareCollectingStatsOnSubscribed(e)}captureStatsOnSubscribed(e,t,i){this.videoStatsOnSubscribed.captureStatsOnSubscribed(e,t,i)}calculateResolutinSwitches(e,t){this.videoResolutionSwitchTracker.captureSample(e,t)}getReport(e,t,i=!1){let n={};if(n[t+"DurationSeconds"]=this.getTotalDuration(e),n[t+"QpAvg"]=this.getQpAverage(e),n[t+"frameRateAvg"]=this.videoGeneralTelemetry.getAvgFrameRate(e),n[t+"bitrateAvg"]=this.videoBitrate.getAvg(e),n[t+"bitrateMax"]=this.videoBitrate.getMax(e),e===nu.MEDIA_DIRECTION.SEND)n[t+"DelayCur"]=this.getDelayCur(),n[t+"DelayAvg"]=this.getDelayAvg(),n[t+"TimeSinceLastEncodeStart"]=this.videoGeneralTelemetry.getTimeSinceLastDecode(e),n[t+"AllocateBWAvg"]=this.videoBitrate.getAllocateBandwidthAvg(),n[t+"CaptureFramerateAvg"]=this.videoGeneralTelemetry.getSendCameraFramerate(),n[t+"MaxCapabilities"]=i?"":this.getMaxCapabilitiesEvents(),n[t+"MaxCapabilitiesErrors"]=i?"":this.getMaxCapabilitiesErrors(),n[t+"OvershootEvents"]=this.getOvershootEvents(),n[t+"OvershootDurations"]=this.getOvershootTotalDurations(),n[t+"qualityLimitationReasonEvents"]=JSON.stringify(this.getQualityLimitationReasonEvents()),n[t+"MaxCapabilitiesResolutions"]=this.getMaxCapabilitiesResolutionChanges(),n[t+"ResolutionsSwitches"]=this.videoResolutionSwitchTracker.switches?JSON.stringify(this.videoResolutionSwitchTracker.switches):"";else if(e===nu.MEDIA_DIRECTION.RECV){n[t+"TimeSinceLastDecodeStart"]=this.videoGeneralTelemetry.getTimeSinceLastDecode(e),n[t+"NumResolutionSwitches"]=this.videoResolutionTelemetry.resolutionSwitchCount,n[t+"PreferredResolution"]=this.videoResolutionTelemetry.preferredResolution,n[t+"PreferredResolutionDurations"]=JSON.stringify(this.videoResolutionTelemetry.preferredResolutionDurationRatios),n[t+"ResolutionDurations"]=JSON.stringify(this.videoResolutionTelemetry.resolutionDurationRatios);let i=this.videoStreamsCounters.getStreamCounts();n[t+"StreamsMin"]=i.min,n[t+"StreamsMax"]=i.max,n[t+"StreamsMode"]=i.mode,n[t+"TimeToFirstFrame"]=this.timeToFirstFrame,n[t+"TimeToFirstFrameSinceSubscriptionStart"]=this.timeToFirstFrameSinceSubscriptionStart,n[t+"LocalMsi"]=this.localMsi,n[t+"Msi"]=this.msi,n[t+"isRenderingEvents"]=JSON.stringify(this.isRenderingEvents),n[t+"statsOnSubscribed"]=JSON.stringify(this.videoStatsOnSubscribed.videoStatsOnSubscribed)}return n}},BK=["googFrameHeightReceived","googFrameWidthReceived","googFrameHeightSent","googFrameWidthSent","googFrameRateInput","googFrameRateSent","googNacksSent","googNacksReceived","googPlisSent","googPlisReceived","googFirsSent","googFirsReceived","framesDecoded","googFrameRateDecoded","googFrameRateReceived","framesEncoded","packetsLost","packetsSent","packetsReceived","bytesReceived","bytesSent","googEncodeUsagePercent","audioInputLevel","audioOutputLevel","googDecodingCTN","googDecodingPLC","keyFramesEncoded","keyFramesDecoded","googRtt","concealedSamples","silentConcealedSamples","totalSamplesReceived","healedRatio","jitter","googJitterBufferMs","qpSum","fecPacketsReceived","fecPacketsDiscarded","fecPacketsSent","packetsDiscarded","pushCount","pushErrCount","pullCount","pullErrCount"],BQ=["bytesSent","bytesReceived","googRtt","packetsSent","requestsSent","consentRequestsSent","responsesSent","requestsReceived","responsesReceived"],BY=["googAvailableReceiveBandwidth","googAvailableSendBandwidth","googTransmitBitrate"];function BZ(e,t,i){let n=i.value;i.value=function(...e){try{return n.apply(this,e)}catch(e){this.processStatsError(t,e)}},Reflect.defineProperty(i.value,"name",{value:n.name})}var BX=10,B0=class{constructor(e,t,i,n,r){this.logger=e,this.sessionInfo=t,this.configProvider=i,this.mediaManager=n,this.multiparty=r,this.statsErrors=[],this.subscribedTrackIds=[],this.iceCandidateErrors=[],this.terminated=!1,this.hwSilent=!1,this.isSpeaking=!1,this.audioTelemetry=new BN(this.configProvider),this.cameraOpenResolution={width:0,height:0},this.streamSenderStarted={},this.totalVideoControlMessages=0,this.outOfOrderVideoControlMessages=0,this.subscribedTrackSsrc=[],this.multiViewVideoTelemetry={},this.h264AvailableProfiles=[],this.h264CodecCapabilities={sendProfiles:[],receiveProfiles:[]},this.timeToFirstFrame={},this.timeToFirstFrameSinceSubscriptionStart={},this.missedInitialPreferredResolution={},this.MSIDs=new Set,this.MSIDsPairs={},this.timerTrackerManager=new Um(this.configProvider.config.enableTimerTracker),this.highestFidelitySsrcPerModality={},this.extensions={WebRTCStats:{},AudioTransportRecvBitrate:0,AudioTransportSendBitrate:0,AudioPayloadSendBitrate:0,AudioPayloadRecvBitrate:0,VideoPayloadSendBitrate:0,VideoPayloadRecvBitrate:0,TimerAudioTransportRecvBitrate:0,TimerAudioTransportSendBitrate:0,TimerAudioPayloadRecvBitrate:0,TimerAudioPayloadSendBitrate:0,TimerVideoPayloadRecvBitrate:0,TimerVideoPayloadSendBitrate:0,StartTime:Date.now(),EndTime:Date.now(),Audio_recv_jitterBufferAvgSize:0,Audio_recv_jitterMax:0,Audio_recv_jitterAvg:0,Audio_send_rttAvg:0,Audio_send_rttMax:0,MaxSessionBandwidth:0,Video_recv_MSIDs:[],Audio_send_presentationUserAPIDuration:"",Audio_send_presentationDuration:""},this.report={type:"WebRtcMediaStats",data:{Extensions:this.extensions}},this.lastSSRCs=new Map,this.videoTelemetry=new BJ(this.extensions.StartTime,this.configProvider,this.logger.createChild("Video")),this.sharingTelemetry=new BJ(this.extensions.StartTime,this.configProvider,this.logger.createChild("Sharing")),this.bandwidthTelemetry=new Bx(this.configProvider.config.webrtcBWJumpLowerLimit,this.configProvider.config.webrtcBWJumpUpperLimit),this.stabilizationTelemetry=new Bl(this.configProvider.config.uplinkBWStabilizationSlidingWindowSize,this.configProvider.config.uplinkBWStabilizationMaxDeviation,this.configProvider.config.uplinkBWStabilizationMinBandwidth,mY),this.storedRecordsNumber=Number(this.configProvider.config.webrtcStatStoredRecordsNumber),this.hwSilentDetectionDuration=Number(this.configProvider.config.webrtcStatHwSilentDetectionDuration),this.hwSilentDetectionLevel=Number(this.configProvider.config.webrtcStatHwSilentDetectionLevel),this.speakingWhileMutedBadDuration=Number(this.configProvider.config.webrtcSpeakingWhileMutedBadDuration),this.speakingWhileMutedDetectionLevel=Number(this.configProvider.config.webrtcSpeakingWhileMutedDetectionLevel),this.videoDelayTimePeriod=this.configProvider.config.webrtcVideoDelayThreshold,this.maxStoredPreferredResolutions=this.configProvider.config.maxStoredPreferredResolutionCount}get currentVideoRecvTrackId(){return this.extensions.WebRTCStats.ssrc_video_recv?.googTrackId}get currentSharingRecvTrackId(){return this.extensions.WebRTCStats.ssrc_sharing_recv?.googTrackId}get isMultiViewVideoTelemetry(){return Object.getOwnPropertyNames(this.multiViewVideoTelemetry).length>0}onDeviceEvent(e){if("stream_acquired"===e.eventType){let t=e.payload;"Video"===t.mediaType&&(this.cameraOpenResolution=t.resolution)}}onMaxCapabilitiesRequested(e){(e.modality===nu.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesRequested(e),this.mapHighestFidelitySsrc(e)}onMaxCapabilitiesApplied(e){(e.modality===nu.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesApplied(e),this.mapHighestFidelitySsrc(e)}setSubscribedTrackIds(e){this.subscribedTrackIds=e||[]}setSubscribedTrackSsrc(e){this.subscribedTrackSsrc=e||[]}addSubscriptionEvent(e,t,i,n,r,s,a){let o={evt:e,ts:Date.now()-this.extensions.StartTime,msi:i,localMsi:n,duration:s};r&&(o.error=t$(r));let l=this.getHandlerForModality(t);if(l.addSubscriptionEvent(o),a&&this.setMSIDsPair(i,n,a),1===e||3===e){let t=1===e;l.startStopRecvDataGathering(t)}2===e&&l.prepareCollectingStatsOnSubscribed(i)}setMSIDsPair(e,t,i){let n=`ssrc_${i.replace(/\D/g,"")}_recv`;this.MSIDsPairs[n]={msi:e,localMsi:t}}getHandlerForModality(e){switch(e){case nu.MODALITY.video:return this.videoTelemetry;case nu.MODALITY.sharing:return this.sharingTelemetry;default:throw Error(`Handler not found for modality: ${e}`)}}setTerminated(){this.extensions.EndTime=new Date().getTime(),this.terminated=!0}startWaitingForStreamStart(e){this.streamStartDetection||this.sessionInfo.setOfferedModalities(e),this.streamStartDetection=!0}processStatsDict(e){if(this.constructWebRtcReportForSingleStream(this.extensions.WebRTCStats,e),this.streamStartDetection&&(this.setStartTime(this.sessionInfo.offeredModalities)||this.terminated)&&(this.streamStartDetection=!1),Object.keys(this.missedInitialPreferredResolution).length>0&&(this.currentVideoRecvTrackId||this.currentSharingRecvTrackId)&&this.setMissedInitialPreferredResolution(),this.constructWebRTCDataReport(this.extensions.WebRTCStats,e),this.calculateHwSilentState(),this.calculateSpeakingState(),this.sessionInfo.activeModalities&&(this.processBandwidthStats(),this.processAudioStats(),this.processVideoStatsRecv(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_recv,!0),this.processVideoStatsSend(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_send),this.processSharingStats(),this.processStreamsCounters()),this.configProvider.config.enableMultiViewStats){let t=this.extensions.WebRTCStats[nu.MULTIPLE_RECV_STREAMS]?this.extensions.WebRTCStats[nu.MULTIPLE_RECV_STREAMS]:{};for(let i of(this.constructWebRtcReportForMultipleStreams(t,e),Object.keys(t))){let e=t[i];this.processVideoStatsRecv(this.multiViewVideoTelemetry[i],e)}this.extensions.WebRTCStats[nu.MULTIPLE_RECV_STREAMS]=t}this.extensions.WebRTCStats.statsErrors=JSON.stringify(this.statsErrors)}setTimeToFirstFrame(e,t,i){i in this.timeToFirstFrame||(this.timeToFirstFrame[i]=e,this.timeToFirstFrameSinceSubscriptionStart[i]=t)}getCurrentTimeToFirstFrame(e){return this.timeToFirstFrame[e]?this.timeToFirstFrame[e]:-1}getCurrentTimeToFirstFrameSinceSubscriptionStart(e){return this.timeToFirstFrameSinceSubscriptionStart[e]?this.timeToFirstFrameSinceSubscriptionStart[e]:-1}addVideoControlMessage(e){this.totalVideoControlMessages++,e&&this.outOfOrderVideoControlMessages++}setStreamSenderStarted(e,t){this.streamSenderStarted[e]=t}addReportedReceiveBandwidth(e){this.limitCaptureAmount(this.extensions,"ReportedReceiveBandwidth",e)}processBandwidthStats(){let e=this.extensions.WebRTCStats.bweStat?.googAvailableSendBandwidth;if(e){let t=this.streamSenderStarted.Video||this.streamSenderStarted.ScreenShare;this.bandwidthTelemetry.recordSendBandwidth(e[e.length-1]),this.stabilizationTelemetry.processBandwidth(parseInt(e[e.length-1]),this.sessionInfo.activeModalities,t)}}processAudioStats(){if(this.extensions.WebRTCStats.ssrc_audio_send&&this.limitCaptureAmount(this.extensions,"Audio_send_RawInputVolume",this.audioTelemetry.getInputLevel("Audio")),this.extensions.WebRTCStats.ssrc_audio_recv?.googJitterBufferMs!==void 0&&this.audioTelemetry.captureJitterBuffer((0,Bk.last)(this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs)),this.extensions.WebRTCStats.ssrc_audio_recv?.jitter!==void 0&&this.audioTelemetry.captureJitter((0,Bk.last)(this.extensions.WebRTCStats.ssrc_audio_recv.jitter)),this.extensions.WebRTCStats.ssrc_audio_send?.googRtt){let e=this.extensions.WebRTCStats.ssrc_audio_send.googRtt;this.audioTelemetry.captureRtt(e[e.length-1])}}stopGatheringIfNeeded(e,t,i,n){let r=`${t}${i}`;n!==this.lastSSRCs.get(r)&&(this.lastSSRCs.set(r,n),t===nu.MEDIA_DIRECTION.SEND?e.stopSendGathering():e.stopRecvGathering())}processVideoStatsSend(e,t){t&&mY(this.sessionInfo.activeModalities.video)?(this.stopGatheringIfNeeded(e,nu.MEDIA_DIRECTION.SEND,"Video",t.ssrc),e.captureMediaData(nu.MEDIA_DIRECTION.SEND,t.googFrameRateSent,t.framesEncoded),e.captureFrameRate(t.googFrameRateInput),e.analyzeDelay(this.videoDelayTimePeriod,t.googAvgEncodeMs),e.captureQpData(nu.MEDIA_DIRECTION.SEND,t.qpSum,t.framesEncoded),e.captureBitrateSample(nu.MEDIA_DIRECTION.SEND,this.getLastSampleInt(t.bytesSent)),e.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat?.googAvailableSendBandwidth),e.setCurrentParameters(parseInt(t.ssrc),{width:this.getLastSampleInt(t.googFrameWidthSent),height:this.getLastSampleInt(t.googFrameHeightSent)},this.getLastSampleInt(t.googFrameRateSent)),e.setQualityLimitationReason(t.qualityLimitationReason),this.configProvider.config.specCompliantSimulcast?.collectResolutionInfo&&e.calculateResolutinSwitches(this.getLastSampleInt(t.googFrameWidthSent),this.getLastSampleInt(t.googFrameHeightSent))):e.isSendGathering()&&(e.stopSendGathering(),this.lastSSRCs.delete(`${nu.MEDIA_DIRECTION.SEND}Video`))}processVideoStatsRecv(e,t,i=!1){t&&mZ(this.sessionInfo.activeModalities.video)&&this.videoTelemetry.isRecvDataGatheringEnabled?(i&&this.stopGatheringIfNeeded(e,nu.MEDIA_DIRECTION.RECV,"Video",t.ssrc),e.trackId=t.googTrackId,e.captureMediaData(nu.MEDIA_DIRECTION.RECV,t.googFrameRateReceived,t.googFrameRateDecoded),e.captureTimeToFirstFrame(this.getCurrentTimeToFirstFrame(t.googTrackId),this.getCurrentTimeToFirstFrameSinceSubscriptionStart(t.googTrackId)),e.captureQpData(nu.MEDIA_DIRECTION.RECV,t.qpSum,t.framesDecoded),e.captureBitrateSample(nu.MEDIA_DIRECTION.RECV,this.getLastSampleInt(t.bytesReceived)),e.captureResolutionSample({width:this.getLastSampleInt(t.googFrameWidthReceived),height:this.getLastSampleInt(t.googFrameHeightReceived)}),e.captureStatsOnSubscribed(this.getLastSampleInt(t.framesDecoded),this.getLastSampleInt(t.bytesReceived),this.getLastSampleInt(t.googFrameHeightReceived))):i&&this.lastSSRCs.delete(`${nu.MEDIA_DIRECTION.RECV}Video`)}processSharingStats(){let e=this.extensions.WebRTCStats.ssrc_sharing_send,t=this.extensions.WebRTCStats.ssrc_sharing_recv;e&&mY(this.sessionInfo.activeModalities.sharing)?(this.stopGatheringIfNeeded(this.sharingTelemetry,nu.MEDIA_DIRECTION.SEND,"Sharing",e.ssrc),this.sharingTelemetry.captureMediaData(nu.MEDIA_DIRECTION.SEND,e.googFrameRateSent,e.framesEncoded),this.sharingTelemetry.captureFrameRate(e.googFrameRateInput),this.sharingTelemetry.analyzeDelay(this.videoDelayTimePeriod,e.googAvgEncodeMs),this.sharingTelemetry.captureQpData(nu.MEDIA_DIRECTION.SEND,e.qpSum,e.framesEncoded),this.sharingTelemetry.captureBitrateSample(nu.MEDIA_DIRECTION.SEND,this.getLastSampleInt(e.bytesSent)),this.sharingTelemetry.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat?.googAvailableSendBandwidth),this.sharingTelemetry.setCurrentParameters(parseInt(e.ssrc),{width:this.getLastSampleInt(e.googFrameWidthSent),height:this.getLastSampleInt(e.googFrameHeightSent)},this.getLastSampleInt(e.googFrameRateSent)),this.limitCaptureAmount(this.extensions,"Sharing_send_RawInputVolume",this.audioTelemetry.getInputLevel("ScreenShare"))):this.sharingTelemetry.isSendGathering()&&(this.sharingTelemetry.stopSendGathering(),this.lastSSRCs.delete(`${nu.MEDIA_DIRECTION.SEND}Sharing`)),t&&mZ(this.sessionInfo.activeModalities.sharing)&&this.sharingTelemetry.isRecvDataGatheringEnabled?(this.stopGatheringIfNeeded(this.sharingTelemetry,nu.MEDIA_DIRECTION.RECV,"Sharing",t.ssrc),this.sharingTelemetry.trackId=t.googTrackId,this.sharingTelemetry.captureMediaData(nu.MEDIA_DIRECTION.RECV,t.googFrameRateReceived,t.googFrameRateDecoded),this.sharingTelemetry.captureTimeToFirstFrame(this.getCurrentTimeToFirstFrame(t.googTrackId),this.getCurrentTimeToFirstFrameSinceSubscriptionStart(t.googTrackId)),this.sharingTelemetry.captureQpData(nu.MEDIA_DIRECTION.RECV,t.qpSum,t.framesDecoded),this.sharingTelemetry.captureBitrateSample(nu.MEDIA_DIRECTION.RECV,this.getLastSampleInt(t.bytesReceived)),this.sharingTelemetry.captureResolutionSample({width:this.getLastSampleInt(t.googFrameWidthReceived),height:this.getLastSampleInt(t.googFrameHeightReceived)}),this.sharingTelemetry.captureStatsOnSubscribed(this.getLastSampleInt(t.framesDecoded),this.getLastSampleInt(t.bytesReceived))):this.lastSSRCs.delete(`${nu.MEDIA_DIRECTION.RECV}Sharing`)}processStreamsCounters(){let e=this.extensions.WebRTCStats.recvCounters;e&&(this.videoTelemetry.countRecvStreams(e[nu.MODALITY.video]),this.sharingTelemetry.countRecvStreams(e[nu.MODALITY.sharing]))}setMissedInitialPreferredResolution(){nh(this.missedInitialPreferredResolution,(e,t)=>{this.setPreferredResolution(t,e)}),this.missedInitialPreferredResolution={}}setPreferredResolution(e,t,i){if((i!==nu.MEDIA_TYPE.video||this.currentVideoRecvTrackId)&&(i!==nu.MEDIA_TYPE.sharing||this.currentSharingRecvTrackId)||(this.missedInitialPreferredResolution[e]=t),this.currentVideoRecvTrackId===e&&this.videoTelemetry.capturePreferredResolution(t,this.maxStoredPreferredResolutions),this.currentSharingRecvTrackId===e&&this.sharingTelemetry.capturePreferredResolution(t,this.maxStoredPreferredResolutions),this.isMultiViewVideoTelemetry){let i=this.multiViewVideoTelemetry[this.getSsrcIdFromMultipleVideoStream(e)];i&&i.capturePreferredResolution(t,this.maxStoredPreferredResolutions)}}setIsRendering(e,t,i){t===nu.MEDIA_TYPE.video&&this.videoTelemetry.setIsRendering(e),t===nu.MEDIA_TYPE.sharing&&this.sharingTelemetry.setIsRendering(e),this.isMultiViewVideoTelemetry&&this.multiViewVideoTelemetry[this.getSsrcIdFromMultipleVideoStream(i)]?.setIsRendering(e)}setMaxSessionBandwidth(e){this.extensions.MaxSessionBandwidth=e}isSubscribed(e,t){let i=this.subscribedTrackIds.some(t=>t===e);return!i&&this.configProvider.config.subscribeToSsrcForVideo&&(i=this.subscribedTrackSsrc.some(e=>e===`${t}`)),i||!this.multiparty&&this.configProvider.config.subscribeToSsrcForVideo}getReport(e=!1,t=!1){try{t&&this.resetPairValues(),e||(this.videoTelemetry.stopDataGathering(),this.sharingTelemetry.stopDataGathering());let i=this.videoTelemetry.getTotalDuration(nu.MEDIA_DIRECTION.RECV),n=this.videoTelemetry.getTotalDuration(nu.MEDIA_DIRECTION.SEND),r=this.sharingTelemetry.getTotalDuration(nu.MEDIA_DIRECTION.RECV),s=this.sharingTelemetry.getTotalDuration(nu.MEDIA_DIRECTION.SEND);if(i>=0&&(nh(this.videoTelemetry.getReport(nu.MEDIA_DIRECTION.RECV,"Video_recv_",t),(e,t)=>this.extensions[t]=e),!nE(this.multiViewVideoTelemetry))){let e=[];for(let i of Object.keys(this.multiViewVideoTelemetry)){let n={id:i};nh(this.multiViewVideoTelemetry[i].getReport(nu.MEDIA_DIRECTION.RECV,"Video",t),(e,t)=>{void 0!==e&&(n[t]=e)}),e.push(n)}this.extensions[nu.MULTIPLE_RECV_STREAMS]=JSON.stringify(e)}for(let e of(r>=0&&nh(this.sharingTelemetry.getReport(nu.MEDIA_DIRECTION.RECV,"Sharing_recv_",t),(e,t)=>this.extensions[t]=e),n>=0&&(nh(this.videoTelemetry.getReport(nu.MEDIA_DIRECTION.SEND,"Video_send_",t),(e,t)=>this.extensions[t]=e),this.extensions.Bandwidth_jumpsHistogram=JSON.stringify(this.bandwidthTelemetry.getReport()),this.extensions.Bandwidth_uplinkStabilizationTime=JSON.stringify(this.stabilizationTelemetry.getReport(!0)),this.extensions.Video_send_CameraOpenWidth=this.cameraOpenResolution.width,this.extensions.Video_send_CameraOpenHeight=this.cameraOpenResolution.height),s>=0&&nh(this.sharingTelemetry.getReport(nu.MEDIA_DIRECTION.SEND,"Sharing_send_",t),(e,t)=>this.extensions[t]=e),this.iceCandidateErrors.length>0&&(this.extensions.iceCandidateErrors=JSON.stringify(this.iceCandidateErrors)),this.extensions.Audio_recv_jitterBufferAvgSize=this.audioTelemetry.getAvgJitterBuffer(),this.extensions.Audio_recv_jitterMax=this.audioTelemetry.getJitterMax(),this.extensions.Audio_recv_jitterAvg=this.audioTelemetry.getJitterAvg(),this.extensions.Video_SubscriptionEvents=t?"":JSON.stringify(this.videoTelemetry.getSubscriptionEvents()),this.extensions.Video_SubscriptionCounters=t?"":JSON.stringify(this.videoTelemetry.getSubscriptionCounters()),this.extensions.Sharing_SubscriptionEvents=t?"":JSON.stringify(this.sharingTelemetry.getSubscriptionEvents()),this.extensions.Sharing_SubscriptionCounters=t?"":JSON.stringify(this.sharingTelemetry.getSubscriptionCounters()),this.extensions.Audio_send_rttAvg=this.audioTelemetry.getAvgRtt(),this.extensions.Audio_send_rttMax=this.audioTelemetry.getMaxRtt(),Object.keys(this.extensions)))void 0===this.extensions[e]&&delete this.extensions[e];return delete this.extensions.WebRTCStats[nu.MULTIPLE_RECV_STREAMS],this.sessionInfo.fillExtensionInfo(this.extensions),Object.keys(this.extensions.WebRTCStats).length>0&&!this.extensions.WebRTCStats.hasStatsError&&this.calculateAverages(),this.extensions.H264_available_profiles=this.h264AvailableProfiles.join(),this.extensions.H264_codec_capabilities=JSON.stringify(this.h264CodecCapabilities),this.extensions.Video_recv_MSIDs=Array.from(this.MSIDs),this.totalVideoControlMessages>0&&(this.extensions.totalVideoControlMessages=this.totalVideoControlMessages,this.extensions.outOfOrderVideoControlMessages=this.outOfOrderVideoControlMessages),nw(this.report)}catch(e){throw this.processStatsError("Report",e),{error:e,partialReport:nw(this.report)}}}getAudioHwSilent(){return this.hwSilent}getSpeakingState(){return this.isSpeaking}addIceCandidateError(e){this.iceCandidateErrors.push(e)}clearIceCandidateErrors(){this.iceCandidateErrors=[]}addH264AvailableProfiles(e){this.h264AvailableProfiles=[...new Set(this.h264AvailableProfiles.concat(e))]}setSupportedH264Profiles(e,t){this.h264CodecCapabilities.sendProfiles=e,this.h264CodecCapabilities.receiveProfiles=t}updateSendStream(e,t){this.audioTelemetry.updateSendStream(e,t)}getTimerTracker(e,t){return this.timerTrackerManager.getTimerTracker(e,t)}resetPairValues(){Object.keys(this.extensions.WebRTCStats).forEach(e=>{delete this.extensions.WebRTCStats[e].pair})}limitCaptureAmount(e,t,i){void 0!==i&&(e[t]=Array.isArray(e[t])?e[t]:[],e[t].push(i),e[t].length>this.storedRecordsNumber&&e[t].shift())}setStartTime(e){let t=this.extensions.WebRTCStats;if(!t.ssrc_audio_send||!t.ssrc_audio_recv)return!1;let i=(e,t)=>e&&(!t||-1!==t)?new Date().getTime():t;return this.extensions.TimerAudioPayloadRecvBitrate=mZ(e.audio)?i(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioPayloadRecvBitrate):-1,this.extensions.TimerAudioPayloadSendBitrate=mY(e.audio)?i(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioPayloadSendBitrate):-1,this.extensions.TimerAudioTransportRecvBitrate=mZ(e.audio)?i(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioTransportRecvBitrate):-1,this.extensions.TimerAudioTransportSendBitrate=mY(e.audio)?i(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioTransportSendBitrate):-1,!!t.ssrc_video_send&&!!t.ssrc_video_recv&&(this.extensions.TimerVideoPayloadRecvBitrate=mZ(e.video)?i(t.ssrc_video_recv.bytesReceived,this.extensions.TimerVideoPayloadRecvBitrate):-1,this.extensions.TimerVideoPayloadSendBitrate=mY(e.video)?i(t.ssrc_video_send.bytesSent,this.extensions.TimerVideoSendBitrate):-1,!!this.extensions.TimerVideoPayloadRecvBitrate&&!!this.extensions.TimerVideoPayloadSendBitrate&&!!this.extensions.TimerAudioPayloadRecvBitrate&&!!this.extensions.TimerAudioPayloadSendBitrate&&!!this.extensions.TimerAudioTransportRecvBitrate&&!!this.extensions.TimerAudioTransportSendBitrate)}calculateAverages(){let e=this.extensions.EndTime,t=(t,i)=>t&&e-i>0&&0!==i&&-1!==i?Math.round(8*t/(e-i)):0,i=e=>{let t=e.split(".").reduce((e,t)=>null==e?e:e[t],this.extensions.WebRTCStats);return Array.isArray(t)?t[t.length-1]:t};this.extensions.AudioPayloadRecvBitrate=t(i("ssrc_audio_recv.bytesReceived"),this.extensions.TimerAudioPayloadRecvBitrate),this.extensions.AudioPayloadSendBitrate=t(i("ssrc_audio_send.bytesSent"),this.extensions.TimerAudioPayloadSendBitrate),this.extensions.VideoPayloadRecvBitrate=t(i("ssrc_video_recv.bytesReceived"),this.extensions.TimerVideoPayloadRecvBitrate),this.extensions.VideoPayloadSendBitrate=t(i("ssrc_video_send.bytesSent"),this.extensions.TimerVideoPayloadSendBitrate),this.extensions.AudioTransportRecvBitrate=t(i("ssrc_audio_send.pair.bytesReceived"),this.extensions.TimerAudioTransportRecvBitrate),this.extensions.AudioTransportSendBitrate=t(i("ssrc_audio_send.pair.bytesSent"),this.extensions.TimerAudioTransportSendBitrate)}addFilteredFields(e,t,i=[]){for(let n in t)if(t.hasOwnProperty(n)&&"type"!==n)if(-1!==i.indexOf(n)){let i=e[n]||[];i.push(this.formatFields(t,n)),i.length>this.storedRecordsNumber&&i.shift(),e[n]||(e[n]=i)}else e[n]=t[n]}formatFields(e,t){let i=e[t];switch(t){case"audioInputLevel":case"audioOutputLevel":return Math.floor(65535*i);case"googJitterBufferMs":return parseInt(i);case"healedRatio":return nB(parseFloat(i),this.configProvider.config.healedRatioPrecision);case"jitter":return nB(parseFloat(i),this.configProvider.config.jitterPrecision);default:return i}}processSource(e,t,i){let n;if(this.addFilteredFields(e,t,BK),t.transportId){let r=i.googComponent?.[t.transportId];e.transport||(e.transport={}),r&&(this.addFilteredFields(e.transport,r),r.selectedCandidatePairId&&(n=i.googCandidatePair?.[r.selectedCandidatePairId]))}else n=Object.values(i.googCandidatePair).find(e=>e.selected);n&&(e.pair||(e.pair={}),this.addFilteredFields(e.pair,n,BQ))}getWebrtcReport(e,t,i,n){let r=e.ssrc[i],s=n?r.id.replace(/[0-9]+/,n):r.id;t[s]?r.ssrc!==t[s].ssrc&&(s.endsWith("video_send")?this.videoTelemetry.stopSendGathering():s.endsWith("video_recv")?this.videoTelemetry.stopRecvGathering():s.endsWith("sharing_send")?this.sharingTelemetry.stopSendGathering():s.endsWith("sharing_recv")&&this.sharingTelemetry.stopRecvGathering()):t[s]={},this.processSource(t[s],r,e)}constructWebRTCDataReport(e,t){if(!t.data?.length)return;let i=t.data.sort((e,t)=>t.timestamp-e.timestamp);e.data=i.find(e=>"open"===e.state)||i[0]}constructWebRtcReportForSingleStream(e,t){if(!t.ssrc)return;let i=this.selectSsrcsToCollect(t.ssrc);e.recvCounters=i.recvCounters,delete i.recvCounters,delete i.multiRecv,nh(i,i=>{nh(i,(i,n)=>{this.getWebrtcReport(t,e,i,n)})}),t.VideoBwe?.bweforvideo&&(e.bweStat||(e.bweStat={}),this.addFilteredFields(e.bweStat,t.VideoBwe.bweforvideo,BY))}constructWebRtcReportForMultipleStreams(e,t){t.ssrc&&this.selectSsrcsToCollect(t.ssrc).multiRecv.forEach(i=>this.getWebrtcReport(t,e,i))}getMediaType(e,t){let i=t?t.getModality():e.mediaType;return e.googTrackId?.match("applicationsharing")&&i!==nu.MEDIA_TYPE.sharing&&(i=nu.MEDIA_TYPE.sharing),i}selectSsrcsToCollect(e){let t={send:{},recv:{},recvCounters:{video:0,sharing:0},multiRecv:[]};if(!this.sessionInfo.activeModalities)return t;let i=[];for(let n of Object.keys(e)){let r=e[n],s=r.googTrackId;if(!s&&r.mediaType!==nu.MEDIA_TYPE.audio)continue;let a=this.getMediaEntity(s,r),o=this.getMediaType(r,a),l=a?.getXSourceStreamId();if(n.endsWith("send"))switch(o){case nu.MEDIA_TYPE.audio:mY(this.sessionInfo.activeModalities.audio)&&(t.send.audio=n);break;case nu.MEDIA_TYPE.video:if(this.extensions.Video_send_SourceId=l,this.highestFidelitySsrcPerModality[nu.MODALITY.video]===r.ssrc){t.send.video=n;break}this.streamSenderStarted.Video&&mY(this.sessionInfo.activeModalities.video)&&a?.getLocalTrackId()&&(a?.getLocalTrackId()===r.googTrackId||this.configProvider.config.statsAllowAnyVideoSendTrack&&!t.send.video)&&(!r.rid||"1"===r.rid)&&(t.send.video=n);break;case nu.MEDIA_TYPE.sharing:if(this.highestFidelitySsrcPerModality[nu.MODALITY.sharing]===r.ssrc){t.send.sharing=n;break}this.streamSenderStarted.ScreenShare&&mY(this.sessionInfo.activeModalities.sharing)&&a?.getLocalTrackId()===r.googTrackId&&(t.send.sharing=n);break;default:this.logger.warn(`Unknown media type '${o}'`)}else if(n.endsWith("recv"))switch(o){case nu.MEDIA_TYPE.audio:mZ(this.sessionInfo.activeModalities.audio)&&(t.recv.audio=n);break;case nu.MEDIA_TYPE.video:void 0!==l&&this.MSIDs.add(l),this.isSubscribed(r.googTrackId,r.ssrc)&&mZ(this.sessionInfo.activeModalities.video)&&(i.push(r),+r.googFrameRateReceived>0&&t.recvCounters[nu.MODALITY.video]++);break;case nu.MEDIA_TYPE.sharing:this.isSubscribed(r.googTrackId,r.ssrc)&&mZ(this.sessionInfo.activeModalities.sharing)&&(t.recv.sharing=n,+r.googFrameRateReceived>0&&t.recvCounters[nu.MODALITY.sharing]++);break;default:this.logger.warn(`Unknown media type '${o}'`)}}if(i.length>0){let e=(i=i.sort((e,t)=>t.googFrameHeightReceived-e.googFrameHeightReceived)).find(e=>e.mediaType===nu.MEDIA_TYPE.video);e&&(t.recv.video=e.id),this.multiparty&&this.configProvider.config.enableMultiViewStats&&(t.multiRecv=i.map(e=>e.id),t.multiRecv.forEach(e=>{this.multiViewVideoTelemetry[e]||(this.multiViewVideoTelemetry[e]=new BJ(this.extensions.StartTime,this.configProvider,this.logger.createChild(`Video[${e}]`,"Video")),this.multiViewVideoTelemetry[e].setMsi(this.MSIDsPairs[e]?.msi),this.multiViewVideoTelemetry[e].setLocalMsi(this.MSIDsPairs[e]?.localMsi),this.multiViewVideoTelemetry[e].prepareCollectingStatsOnSubscribed(this.MSIDsPairs[e]?.msi))}))}return t}getMediaEntityForTrack(e){if(e)return this.mediaManager.getMediaEntities().find(t=>t.getLocalTrackId()===e||t.getRemoteTrackId()===e)}getMediaEntityByRemoteSsrc(e){if(e)return this.mediaManager.getMediaEntities().find(t=>t.getRemoteSsrc()===+e)}getMediaEntity(e,t){let i=`${t.ssrc}`,n=t.id,r=this.getMediaEntityForTrack(e);return!r&&this.configProvider.config.subscribeToSsrcForVideo&&n.endsWith("recv")&&(r=this.getMediaEntityByRemoteSsrc(i)),r}calculateHwSilentState(){let e=this.extensions.WebRTCStats.ssrc_audio_send?.audioInputLevel;if(!e||e.length<2*this.hwSilentDetectionDuration)return;let t=!0;for(let i=e.length-this.hwSilentDetectionDuration-1;i<e.length;i++)if(e[i]>this.hwSilentDetectionLevel){t=!1;break}this.hwSilent!==t&&(this.hwSilent=t,this.logger.safe.info(`HW silent changed to ${this.hwSilent}`))}calculateSpeakingState(){let e=this.configProvider.config.useAudioAnalyzer?this.extensions.Audio_send_RawInputVolume:this.extensions.WebRTCStats.ssrc_audio_send?.audioInputLevel;if(!e||e.length<=this.speakingWhileMutedBadDuration)return;let t=!1;for(let i=e.length-this.speakingWhileMutedBadDuration;i<e.length;i++)if(e[i]>this.speakingWhileMutedDetectionLevel){t=!0;break}this.isSpeaking=t}processStatsError(e,t){let i=t$(t);this.logger.safe.error(`webrtcStatistics error [${e}]: ${i}`);let n=this.statsErrors.find(t=>t.error===i&&t.origin===e);n?n.count++:this.statsErrors.push({origin:e,error:i,count:1}),this.statsErrors.length>BX&&this.statsErrors.splice(1)}getLastSampleInt(e){return"number"==typeof e?e:e&&parseInt(e[e.length-1])||0}getSsrcIdFromMultipleVideoStream(e){let t,i=this.extensions.WebRTCStats[nu.MULTIPLE_RECV_STREAMS]||{};for(let n in i){let r=i[n];if(r&&r.googTrackId===e){t=n;break}}return t}mapHighestFidelitySsrc(e){if(0===e.capabilities.length)return;let t=e.capabilities.slice().sort((e,t)=>(t?.maxMbps||0)-(e?.maxMbps||0));this.highestFidelitySsrcPerModality[e.modality]=t[0]?.ssrc}};eM([BZ],B0.prototype,"onDeviceEvent",1),eM([BZ],B0.prototype,"onMaxCapabilitiesRequested",1),eM([BZ],B0.prototype,"onMaxCapabilitiesApplied",1),eM([BZ],B0.prototype,"addSubscriptionEvent",1),eM([BZ],B0.prototype,"processBandwidthStats",1),eM([BZ],B0.prototype,"processAudioStats",1),eM([BZ],B0.prototype,"processVideoStatsSend",1),eM([BZ],B0.prototype,"processVideoStatsRecv",1),eM([BZ],B0.prototype,"processSharingStats",1),eM([BZ],B0.prototype,"processStreamsCounters",1),eM([BZ],B0.prototype,"setMissedInitialPreferredResolution",1),eM([BZ],B0.prototype,"setPreferredResolution",1),eM([BZ],B0.prototype,"setIsRendering",1),eM([BZ],B0.prototype,"setMaxSessionBandwidth",1),eM([BZ],B0.prototype,"setStartTime",1),eM([BZ],B0.prototype,"calculateAverages",1),eM([BZ],B0.prototype,"addFilteredFields",1),eM([BZ],B0.prototype,"formatFields",1),eM([BZ],B0.prototype,"processSource",1),eM([BZ],B0.prototype,"getWebrtcReport",1),eM([BZ],B0.prototype,"constructWebRTCDataReport",1),eM([BZ],B0.prototype,"constructWebRtcReportForSingleStream",1),eM([BZ],B0.prototype,"constructWebRtcReportForMultipleStreams",1),eM([BZ],B0.prototype,"selectSsrcsToCollect",1),eM([BZ],B0.prototype,"calculateHwSilentState",1),eM([BZ],B0.prototype,"calculateSpeakingState",1);var B1="VideoBwe",B2="bweforvideo",B3="googAvailableReceiveBandwidth",B4="googAvailableSendBandwidth",B5="mediaType",B6="framesDecoded",B8="googFrameRateDecoded",B9="googFrameRateReceived",B7="googFrameRateInput",He="googTrackId",Ht=class extends no{constructor(e,t,i,n){super(),this.logger=e,this.configProvider=t,this.mediaManager=i,this.window=mk,this._sessionInfo=new Uu,this.statisticsMapper=new BO,this.webRtcStatistics=new B0(this.logger.createChild("WebrtcStatistics"),this._sessionInfo,this.configProvider,i,n)}setAudioDecoderStatsProvider(e){this.statisticsMapper?.setAudioDecoderStatsProvider(e)}setAudioEncoderCodecName(e){this.statisticsMapper?.setAudioEncoderCodecName(e)}get sessionInfo(){return this._sessionInfo}get isDisposed(){return null===this.pc&&0===this.interval}initialize(e){this.pc=e}startWaitingForStreamStart(e){this.webRtcStatistics.startWaitingForStreamStart(e)}onDeviceEvent(e){this.webRtcStatistics.onDeviceEvent(e)}onMaxCapabilitiesRequested(e){this.webRtcStatistics.onMaxCapabilitiesRequested(e)}onMaxCapabilitiesApplied(e){this.webRtcStatistics.onMaxCapabilitiesApplied(e)}onSendersChanged(e,t){this.webRtcStatistics.setStreamSenderStarted(e,t)}addSubscriptionEvent(e,t,i,n,r,s,a){this.webRtcStatistics.addSubscriptionEvent(e,t,i,n,r,s,a)}setSubscribedTrackIds(e){this.webRtcStatistics.setSubscribedTrackIds(e)}setSubscribedTrackSsrc(e){this.webRtcStatistics.setSubscribedTrackSsrc(e)}setPreferredResolution(e,t,i){this.webRtcStatistics.setPreferredResolution(e,t,i)}setIsRendering(e,t,i){this.webRtcStatistics.setIsRendering(e,t,i)}setMaxSessionBandwidth(e){this.webRtcStatistics.setMaxSessionBandwidth(e)}setTerminated(){this.webRtcStatistics.setTerminated()}addIceCandidateError(e){this.webRtcStatistics.addIceCandidateError(e)}clearIceCandidateErrors(){this.webRtcStatistics.clearIceCandidateErrors()}updateSendStream(e,t){this.webRtcStatistics.updateSendStream(e,t)}getTimerTracker(e,t){return this.webRtcStatistics.getTimerTracker(e,t)}setH264AvailableProfiles(e){if(!e?.codecs)return;let t=[];e.codecs.forEach(e=>{if("h264"===e.mimeType&&e.sdpFmtpLine){let i=/profile-level-id=(.{6})/.exec(e.sdpFmtpLine);i?.[1]&&(t=t.concat(i[1]))}}),this.webRtcStatistics.addH264AvailableProfiles(t)}setSupportedH264Profiles(e,t){if(!e?.codecs&&!t?.codecs)return;let i=e=>{let t=[];return e.codecs?.forEach(e=>{if("h264"===e.mimeType&&e.sdpFmtpLine){let i=/profile-level-id=(.{6})/.exec(e.sdpFmtpLine)?.[1];i&&!t.includes(i)&&t.push(i)}}),t},n=i(e),r=i(t);this.webRtcStatistics.setSupportedH264Profiles(n,r)}processRawReport(e){this.processStatsDict(this.statisticsMapper.build(e))}getReport(e,t=!1){let i=this.webRtcStatistics.getReport(e,t);return this.addStreamInfoForE2ETests(i),i}dispose(){this.interval&&(this.window.clearInterval(this.interval),this.interval=0),this.pc=null}getLastStatistics(){return this.statistics}setTimeToFirstFrame(e,t,i){this.webRtcStatistics.setTimeToFirstFrame(e,t,i)}addVideoControlMessage(e=!1){this.webRtcStatistics.addVideoControlMessage(e)}setSsrcTrackPair(e,t){this.statisticsMapper.setSsrcTrackPair(e,t)}updateStatsWithLocalSsrcTrackInfo(){for(let e of this.mediaManager.getMediaEntities()){let t=e.getLocalSsrc();t&&this.statisticsMapper.setSsrcTrackPair(t,e.getLocalTrackId())}}addReportedReceiveBandwidth(e){this.webRtcStatistics.addReportedReceiveBandwidth(e)}addStreamInfoForE2ETests(e){let t=this._sessionInfo.negotiatedModalities;if(t&&!this.isDisposed)try{e.localStreams=this.getSendersReport(this.pc.getSenders(),{audio:mY(t.audio),video:mY(t.video)}),e.remoteStreams=this.getReceiversReport(this.pc.getReceivers(),{audio:mZ(t.audio),video:mZ(t.video)})}catch(e){this.logger.safe.warn(`addStreamInfoForE2ETests failed: ${t$(e)}`)}}getReceiversReport(e,t){let i=[];return e.forEach(e=>{let n={tracks:[]};i.push(n),e.track&&("audio"===e.track.kind&&t.audio||"video"===e.track.kind&&t.video)&&n.tracks.push({stream:void 0,track:e.track})}),i}getSendersReport(e,t){let i=[],n={tracks:[]};return i.push(n),e.forEach(e=>{e.track&&("audio"===e.track.kind&&t.audio||"video"===e.track.kind&&t.video)&&n.tracks.push({stream:void 0,track:e.track})}),i}processStatsDict(e){this.webRtcStatistics.processStatsDict(e);let t=0,i=0,n=e[B1]?.[B2];n&&(t=Number(n[B3]),i=Number(n[B4]));let r=((this.configProvider.mediaConfig.maxBandwidthInKbps||Math.floor(Number.MAX_SAFE_INTEGER/1e3))-(this.configProvider.config.audioBandwidthInKbps||0))*1e3,s={estimatedReceiveBandwidth:Math.min(isNaN(t)?0:t,r),estimatedSendBandwidth:Math.min(isNaN(i)?0:i,r),remoteVideoStreams:{},localVideoStreams:{},isSpeaking:this.webRtcStatistics.getSpeakingState(),audioHwSilent:this.webRtcStatistics.getAudioHwSilent()};nh(e.ssrc,e=>{if("video"!==e[B5])return;let t=e[He],i=e.id;-1!==i.indexOf("_recv")?s.remoteVideoStreams[t]={trackId:t,frameRateReceived:Number(e[B9]),frameRateDecoded:Number(e[B8]),framesDecoded:Number(e[B6])}:t&&-1!==i.indexOf("_send")&&(s.localVideoStreams[t]={trackId:t,ssrc:Number(e.ssrc),frameRateInput:Number(e[B7])})}),nA(this.statistics,s)||(this.statistics=s,this.notifyStatisticsChanged())}notifyStatisticsChanged(){this.event("onStatisticsChanged").raise(this.statistics)}},Hi=class extends no{constructor(e,t,i,n,r,s){super(),this.logger=e,this.configProvider=t,this.diagnostics=i,this.mediaManager=n,this.modalityWatchdog=s,this.window=mk,this.loopIntervalTracker=new SW(this.configProvider.config.diagnostics.performanceMonitoring.fluctuationSamplesNum),this.loopIntervalAggregator=new SG,this.fetchTimeTracker=new SW(this.configProvider.config.diagnostics.performanceMonitoring.fluctuationSamplesNum),this.fetchTimeAggregator=new SG,this.gathererV1=new Ht(this.logger.createChild("V1"),this.configProvider,this.mediaManager,r),this.gathererV1.on("onStatisticsChanged",e=>this.event("onStatisticsChanged").raise(e)),this.gathererV2=new Bb(this.logger.createChild("V2"),this.configProvider,this.diagnostics,this.mediaManager)}initialize(e){this.pc=e,this.gathererV1.initialize(e),this.configProvider.config.pollIntervalBeforeFirstAudioMs?this.interval??(this.interval=this.window.setInterval(()=>this.processStats(),this.configProvider.config.pollIntervalBeforeFirstAudioMs)):this.interval??(this.interval=this.window.setInterval(()=>this.processStats(),this.configProvider.config.webrtcStatPollInterval))}setAudioDecoderStatsProvider(e){this.gathererV1.setAudioDecoderStatsProvider(e),this.gathererV2.setAudioDecoderStatsProvider(e)}setAudioEncoderCodecName(e){this.gathererV1.setAudioEncoderCodecName(e),this.gathererV2.setAudioEncoderCodecName(e)}dispose(){super.dispose(),this.interval&&(this.window.clearInterval(this.interval),this.interval=void 0),this.gathererV1.dispose(),this.pc=void 0}get isDisposed(){return!this.pc&&void 0===this.interval}resetStatPollingInterval(){this.interval&&this.window.clearInterval(this.interval),this.interval=this.window.setInterval(()=>this.processStats(),this.configProvider.config.webrtcStatPollInterval)}async processStats(){if(this.configProvider.config.diagnostics.collectWhileNotConnected){if(!this.pc||"closed"===this.pc.iceConnectionState)return}else if(!this.pc||"connected"!==this.pc.iceConnectionState&&"completed"!==this.pc.iceConnectionState)return void this.gathererV2.signalNoConnection();let e=nQ(),t=void 0===this.loopTimer?-1:e-this.loopTimer;this.loopTimer=e,this.loopIntervalTracker.captureSample(t),this.loopIntervalAggregator.captureSample(this.loopIntervalTracker.getReport());let i=this.loopIntervalAggregator.getReport();i&&(this.diagnostics.loopIntervalMax=i.max,this.diagnostics.loopIntervalMedian=i.median);let n={};(await this.pc.getStats()).forEach(e=>{this.cleanupPii(e);let t=e.type;delete e.type,n[t]??(n[t]={}),n[t][e.id]=e});let r=nQ()-e;this.fetchTimeTracker.captureSample(r),this.fetchTimeAggregator.captureSample(this.fetchTimeTracker.getReport());let s=this.fetchTimeAggregator.getReport();s&&(this.diagnostics.fetchTimeMax=s.max,this.diagnostics.fetchTimeMedian=s.median),this.modalityWatchdog?.processReport(n);let a=this.gathererV2.processRawReport(n),o=nQ();this.gathererV1.processRawReport(n),o=nQ()-o,a&&(this.configProvider.config.diagnostics.traceLogging&&this.logger.safe.debug("Raising onDiagnosticUpdated event"),this.event("onDiagnosticUpdated").raise(a)),a?.perfCounters&&(a.perfCounters.loopTime=t,a.perfCounters.fetchTime=r,a.perfCounters.legacyProcessingTime=o)}cleanupPii(e){switch(e.type){case"local-candidate":case"remote-candidate":{let t=e;Object.defineProperty(t,"address",{enumerable:!1}),Object.defineProperty(t,"url",{enumerable:!1}),Object.defineProperty(t,"relatedAddress",{enumerable:!1}),Object.defineProperty(t,"ip",{enumerable:!1}),Object.defineProperty(t,"usernameFragment",{enumerable:!1});break}case"certificate":{let t=e;Object.defineProperty(t,"fingerprint",{enumerable:!1}),Object.defineProperty(t,"base64Certificate",{enumerable:!1})}}}get sessionInfo(){return this.gathererV1.sessionInfo}onMaxCapabilitiesApplied(e){this.gathererV1.onMaxCapabilitiesApplied(e)}clearIceCandidateErrors(){this.gathererV1.clearIceCandidateErrors()}setSsrcTrackPair(e,t){this.gathererV1.setSsrcTrackPair(e,t),this.gathererV2.setSsrcTrackPair(e,t)}addSubscriptionEvent(e,t,i,n,r,s,a){this.gathererV1.addSubscriptionEvent(e,t,i,n,r,s,a)}setSubscribedTrackSsrc(e){this.gathererV1.setSubscribedTrackSsrc(e)}addIceCandidateError(e){this.gathererV1.addIceCandidateError(e)}setH264AvailableProfiles(e){this.gathererV1.setH264AvailableProfiles(e)}setSupportedH264Profiles(e,t){this.gathererV1.setSupportedH264Profiles(e,t)}setTerminated(){this.gathererV1.setTerminated()}onDeviceEvent(e){this.gathererV1.onDeviceEvent(e)}getReport(e,t=!1){let i=this.gathererV1.getReport(e,t),n=this.loopIntervalAggregator.getReport();n&&(i.data.Extensions.LoopIntervalMax=`${nB(n.max,1)}`,i.data.Extensions.LoopIntervalMedian=`${nB(n.median,1)}`);let r=this.fetchTimeAggregator.getReport();r&&(i.data.Extensions.FetchTimeMax=`${nB(r.max,1)}`,i.data.Extensions.FetchTimeMedian=`${nB(r.median,1)}`);let s=this.diagnostics.getObjectRef();i.data.Extensions.multipleVideoStreams=JSON.stringify(nZ(s.multiViewStats,"startTime",s.startTime)),i.data.Extensions.multipleAudioStreams=JSON.stringify(nZ(s.multipleAudioStats,"startTime",s.startTime)),i.data.Extensions.videoPerformanceEvent=JSON.stringify(s.videoPerformanceEvent);let a=s.bandwidthReport;"REMB"===s.negotiation.bweType?(i.data.Extensions.StartCallBWE=JSON.stringify(a?.startOfTheCall),i.data.Extensions.EndCallBWE=JSON.stringify(a?.endOfTheCall),i.data.Extensions.BWEStd=JSON.stringify(a?.std),i.data.Extensions.BwPercentiles=JSON.stringify(a?.bwPercentiles),i.data.Extensions.AvgBwe=JSON.stringify(a?.avgBwe)):(i.data.Extensions.StartCallBWESendSide=JSON.stringify(a?.startOfTheCall),i.data.Extensions.EndCallBWESendSide=JSON.stringify(a?.endOfTheCall),i.data.Extensions.BWEStdSendSide=JSON.stringify(a?.std),i.data.Extensions.BwPercentilesSendSide=JSON.stringify(a?.bwPercentiles),i.data.Extensions.AvgBwSendSide=JSON.stringify(a?.avgBwe)),i.data.Extensions.UsesMixer=JSON.stringify(s.usesMixer),i.data.Extensions.IsPstnCall=JSON.stringify(s.isPstnCall),i.data.Extensions.InitialBWSeed=JSON.stringify(s.initialBWSeed),i.data.Extensions.SentBWSeed=JSON.stringify(s.sentBWSeed),i.data.Extensions.Bandwidth_downlinkStabilizationTime=JSON.stringify(s.bwDownlinkStabilizationTime),i.data.Extensions.ReinvitelessContext=JSON.stringify(s.reinvitelessContext),i.data.Extensions.ReportedSendBandwidth=JSON.stringify(s.reportedSendBandwidthLayouts),i.data.Extensions.Data_ProtocolCounters=JSON.stringify(s.dataChannel?.protocolCounters),i.data.Extensions.Data_Error=s.dataChannel?.error,i.data.Extensions.Data_SessionState=s.dataChannelSessionState?.toString(),i.data.Extensions.Data_CreateChannelError=s.dataChannelCreationError;let o=s.aggregatedModalityStats?.video?.recv||[],l=s.aggregatedModalityStats?.audio?.recv||[],c=s.aggregatedModalityStats?.sharing?.recv||[],d=s.aggregatedModalityStats?.video?.send||[],u=s.aggregatedModalityStats?.sharing?.send||[],h=o[o.length-1],g=c[c.length-1],p=l[l.length-1],f=d[d.length-1],m=u[u.length-1],v=h?.aggregated?.macroblockRateStats??{},S=p?.aggregated?.customHealerStats??{};if(S?.pullPacketProcessingTimes){let e=n5(S.pullPacketProcessingTimes);S.pullPacketProcessingTimeP50=e.getPercentile(.5),S.pullPacketProcessingTimeP95=e.getPercentile(.95)}if(S?.pushPacketProcessingTimes){let e=n5(S.pushPacketProcessingTimes);S.pushPacketProcessingTimeP50=e.getPercentile(.5),S.pushPacketProcessingTimeP95=e.getPercentile(.95)}for(let e in v)i.data.Extensions[`Video_recv_${e}`]=`${nB(v[e],0)}`;for(let e in s.totalVideoRecvMblocksRates)i.data.Extensions[`totalVideoRecv_${e}`]=`${nB(s.totalVideoRecvMblocksRates[e],0)}`;for(let e in S)if(void 0!==S[e]){let t="number"!=typeof S[e]?JSON.stringify(S[e]):S[e];i.data.Extensions[`Audio_recv_customHealer_${e}`]=t}return i.data.Extensions.MeetingScenario=JSON.stringify(s.negotiation.meetingScenario),i.data.Extensions.IsTownHall=JSON.stringify(s.negotiation.isTownHall),i.data.Extensions.IgnoredNonSctpDataChannel=JSON.stringify(s.negotiation.ignoredNonSctpDataChannel),i.data.Extensions.Audio_send_presentationAPIUserDuration=JSON.stringify(s.presentationAPIUserDuration),i.data.Extensions.Audio_send_presentationDuration=JSON.stringify(s.presentationAudioDuration),i.data.Extensions.CodecSupport=JSON.stringify(s.codecSupport),i.data.Extensions.Video_recv_FpsHarmonicAverage=h?.extensions.fpsHarmonicAverage?.toString(),i.data.Extensions.Sharing_recv_FpsHarmonicAverage=g?.extensions.fpsHarmonicAverage?.toString(),i.data.Extensions.Sharing_recv_CodecReport=JSON.stringify(g?.aggregated?.codecReport),i.data.Extensions.Video_send_performanceEvents=n7(s.localVideoPerformanceEvents,this.configProvider.config.diagnostics.telemetryLimits.numPerformanceEvents,"timestamp",s.startTime),f&&(i.data.Extensions.Video_send_FreezeIntervals=JSON.stringify(f?.extensions?.captureFreezeIntervalsCount)),h&&(i.data.Extensions.Video_recv_FreezeHistogram=JSON.stringify(h.aggregated?.freezeCountHistogram),i.data.Extensions.Video_recv_LongestFreezeDuration=JSON.stringify(h?.aggregated?.longestFreeze),i.data.Extensions.Video_recv_OngoingFreeze=JSON.stringify(h?.extensions?.isFrozen),i.data.Extensions.Video_recv_OngoingFreezeDuration=JSON.stringify(h?.aggregated?.ongoingFreezeDuration),i.data.Extensions.Video_recv_TotalFreezeDuration=JSON.stringify(h?.aggregated?.totalFreezeDuration),i.data.Extensions.Video_recv_RecvAvgFreezeDuration=JSON.stringify(h?.aggregated?.avgFreezeDuration),i.data.Extensions.Video_recv_FreezeTimestamps=JSON.stringify(nX(h?.aggregated?.freezeTimestampsHistogram,s.startTime,this.configProvider.config.diagnostics.telemetryLimits.numOfHistogramSamples))),g&&(i.data.Extensions.Sharing_recv_FreezeHistogram=JSON.stringify(g.aggregated?.freezeCountHistogram),i.data.Extensions.Sharing_recv_LongestFreezeDuration=JSON.stringify(g?.aggregated?.longestFreeze),i.data.Extensions.Sharing_recv_OngoingFreeze=JSON.stringify(g?.extensions?.isFrozen),i.data.Extensions.Sharing_recv_OngoingFreezeDuration=JSON.stringify(g?.aggregated?.ongoingFreezeDuration),i.data.Extensions.Sharing_recv_TotalFreezeDuration=JSON.stringify(g?.aggregated?.totalFreezeDuration),i.data.Extensions.Sharing_recv_RecvAvgFreezeDuration=JSON.stringify(g?.aggregated?.avgFreezeDuration),i.data.Extensions.Sharing_recv_FreezeTimestamps=JSON.stringify(nX(g?.aggregated?.freezeTimestampsHistogram,s.startTime,this.configProvider.config.diagnostics.telemetryLimits.numOfHistogramSamples))),i.data.Extensions.EarlyMedia={NumStatsPolls:`${s.earlyMediaNumStatsPolls}`},i.data.Extensions.TimeToFirstAudioPacket=`${s.timeToFirstAudioPacket}`,i.data.Extensions.Audio_recv_packetsLostRateMax=`${nB(p?.aggregated?.lossRateMax,6)||0}`,i.data.Extensions.Audio_recv_networkAvgLossRate=`${nB(p?.aggregated?.networkAvgLossRate,6)||0}`,i.data.Extensions.Video_recv_packetsLostRateMax=`${nB(h?.aggregated?.lossRateMax,6)||0}`,i.data.Extensions.Sharing_recv_packetsLostRateMax=`${nB(g?.aggregated?.lossRateMax,6)||0}`,i.data.Extensions.Video_send_packetsLostRateMax=`${nB(f?.aggregated?.lossRateMax,6)||0}`,i.data.Extensions.Sharing_send_packetsLostRateMax=`${nB(m?.aggregated?.lossRateMax,6)||0}`,i.data.Extensions.Audio_recv_healedRatioAvg=`${nB(p?.aggregated?.healedRatioAvg,6)||0}`,i.data.Extensions.Audio_recv_healedRatioMax=`${nB(p?.aggregated?.healedRatioMax,6)||0}`,i.data.Extensions.Video_send_Simulcast=JSON.stringify(s.simulcast?.video),i.data.Extensions.Sharing_send_Simulcast=JSON.stringify(s.simulcast?.sharing),i.data.Extensions.Video_send_powerEfficientEncoderEvents=n7(f?.extensions?.powerEfficientEncoderEvents,this.configProvider.config.diagnostics.telemetryLimits.numPowerEfficientEncoderEvents,"timestamp",s.startTime),i.data.Extensions.Video_send_powerEfficientEncoderEventOnCount=JSON.stringify(f?.extensions?.powerEfficientEncoderEventOnCount),i.data.Extensions.Video_send_powerEfficientEncoderEventOffCount=JSON.stringify(f?.extensions?.powerEfficientEncoderEventOffCount),i.data.Extensions.Video_send_powerEfficientEncoderEventMismatchCount=JSON.stringify(f?.extensions?.powerEfficientEncoderEventMismatchCount),nP(i)}startWaitingForStreamStart(e){this.gathererV1.startWaitingForStreamStart(e)}getTimerTracker(e,t){return this.gathererV1.getTimerTracker(e,t)}getLastStatistics(){return this.gathererV1.getLastStatistics()}updateSendStream(e,t){this.gathererV1.updateSendStream(e,t)}setSubscribedTrackIds(e){this.gathererV1.setSubscribedTrackIds(e)}setMaxSessionBandwidth(e){this.gathererV1.setMaxSessionBandwidth(e)}updateStatsWithLocalSsrcTrackInfo(){this.gathererV1.updateStatsWithLocalSsrcTrackInfo()}onSendersChanged(e,t){this.gathererV1.onSendersChanged(e,t)}setPreferredResolution(e,t,i){this.gathererV1.setPreferredResolution(e,t,i)}setIsRendering(e,t,i){this.gathererV1.setIsRendering(e,t,i)}setTimeToFirstFrame(e,t,i){this.gathererV1.setTimeToFirstFrame(e,t,i)}addVideoControlMessage(e){this.gathererV1.addVideoControlMessage(e)}onMaxCapabilitiesRequested(e){this.gathererV1.onMaxCapabilitiesRequested(e)}addReportedReceiveBandwidth(e){this.gathererV1.addReportedReceiveBandwidth(e)}},Hn=class{constructor(e,t,i,n,r){this.recvStream=e,this.mainTrack=t,this.receiveStreamCollection=i,this.logger=n,this.settings=r,this.removeOtherTracks(t),this.subscribeOnStreamEvents()}get stream(){return this.recvStream.getMediaStream()}dispose(){this.unsubscribeFromStreamEvents(),this.receiveStreamCollection=null,this.mainTrack=null,this.recvStream.dispose()}getId(){return this.recvStream.getId()}getModality(){return this.recvStream.getModality()}getMsi(){return this.recvStream.getMsi()}getMediaStream(){return this.stream}getReceiver(){return this.recvStream.getReceiver()}requestSource(e){return this.recvStream.requestSource(e)}getSourceStreamId(){return this.recvStream.getSourceStreamId()}getSubstreamIndex(){return this.recvStream.getSubstreamIndex()}removeOtherTracks(e){this.settings.onAddTrackRemoveOtherTracks&&this.stream.getTracks().forEach(t=>{t.id!==e.id&&this.stream.removeTrack(t)})}subscribeOnStreamEvents(){let e=e=>this.logger.safe.info(`${e} track: ${this.mainTrack.id}, stream: ${this.stream.id}`);this.stream.onremovetrack=()=>{e("onremovetrack"),this.receiveStreamCollection.remove(this.stream.id)},this.mainTrack.onended=()=>{e("onended"),this.settings.removeRecvStreamOnEnded&&this.receiveStreamCollection.remove(this.stream.id)},this.mainTrack.onmute=()=>e("onmute"),this.mainTrack.onunmute=()=>e("onunmute")}unsubscribeFromStreamEvents(){this.stream.onremovetrack=null,this.mainTrack.onended=null,this.mainTrack.onmute=null,this.mainTrack.onunmute=null}},Hr=class{constructor(e){this.startTimestamp=0,this.totalTime=0,this.lastActiveTime=0,this.id=e}},Hs=class{constructor(e){this.speakersHistory=[],this.sources=[],this.configProvider=e.configProvider,this.ping=this.setupTimer()}setSources(e=[]){let t=e.map(this.getOrCreateSource.bind(this)),i=this.excludeSources(this.sources,t);t.forEach(e=>{this.isAlreadyActive(e)||this.updateSourceTimestamp(e),this.updateSourceLastActiveTime(e)}),i.forEach(e=>{this.updateTotalTime(e),this.resetStartTimestamp(e)}),this.ping||(this.ping=this.setupTimer())}setOnDominantSpeakerChanged(e){this.callback=e}dispose(){this.clearTimer(),this.sources=null,this.callback=null}excludeSources(e,t){return e.filter(e=>!t.some(t=>e.id===t.id))}trigger(){if(!this.hasAnyoneSpoken())return void this.clearTimer();let e=(e,t)=>t.totalTime-e.totalTime||t.lastActiveTime-e.lastActiveTime,t=e=>e.id,i=this.sources.map(this.updateTotalTime).sort(e).map(t).slice(0,this.configProvider.config.ovcMaxCount);i.length&&!nA(this.speakersHistory,i)&&(this.speakersHistory=i,this.callback&&this.callback(this.speakersHistory,"client")),this.sources.map(this.resetTotalTime).filter(this.isAlreadyActive).forEach(this.updateSourceTimestamp)}isAlreadyActive(e){return!!e.startTimestamp}setupTimer(){return window.setInterval(this.trigger.bind(this),this.configProvider.config.activeSpeaker.timeToPromote)}clearTimer(){this.ping&&(clearInterval(this.ping),this.ping=null)}getOrCreateSource(e){if(this.isExist(e))return this.sourceById(e);{let t=new Hr(e);return this.sources.push(t),t}}isExist(e){return this.sources.some(t=>e===t.id)}hasAnyoneSpoken(){return this.sources.some(e=>0!==e.startTimestamp||0!==e.totalTime)}sourceById(e){return this.sources.find(t=>e===t.id)}updateSourceTimestamp(e){e.startTimestamp=Date.now()}updateSourceLastActiveTime(e){e.lastActiveTime=Date.now()}updateTotalTime(e){return e.startTimestamp&&(e.totalTime+=Date.now()-e.startTimestamp),e}resetStartTimestamp(e){return e.startTimestamp=0,e}resetTotalTime(e){return e.totalTime=0,e}},Ha=eR(e5()),Ho=class{getCapabilities(e){let t=RTCRtpReceiver.getCapabilities(e);return t.codecs.forEach(e=>{e.mimeType=e.mimeType.toLowerCase().split("/").pop()}),Promise.resolve(t)}},Hl=class{getCapabilities(e){let t=RTCRtpSender.getCapabilities(e);return t.codecs.forEach(e=>{e.mimeType=e.mimeType.toLowerCase().split("/").pop()}),Promise.resolve(t)}},Hc=class{constructor(e,t){this.noRequiredCodecsWorkaround=t,this.selfGlobal=e.global.capabilityGatherer=e.global.capabilityGatherer||{},this.getCapabilities("video")}async getCapabilities(e){if("video"!==e&&"audio"!==e)return Promise.reject(Error(`capabilities for ${e} are not supported`));if(!this.selfGlobal.gatherTask){let e=new iE;this.selfGlobal.gatherTask=e.promise;let t=void 0!==mk.webkitRTCPeerConnection,i=t?new mk.webkitRTCPeerConnection(null):new mk.RTCPeerConnection(null),n=e=>t?new Promise((t,n)=>{i.createOffer(t,n,e)}):(this.noRequiredCodecsWorkaround&&i.addTrack(i.addTransceiver("video").receiver.track),i.createOffer(e));try{let t=await n({offerToReceiveVideo:1,offerToReceiveAudio:1}),r={};Ha.parse(t.sdp).media.forEach(e=>{r[e.type]=e.rtp.map(t=>{let i={mimeType:t.codec.toLowerCase()};if("video"===e.type){let n=e.fmtp?.find(e=>e.payload===t.payload);i.sdpFmtpLine=n?.config}return i})}),i.close(),e.resolve(r)}catch(t){this.selfGlobal.gatherTask=null,i.close(),e.reject(t)}}return this.selfGlobal.gatherTask.then(t=>({codecs:t[e]}))}},Hd=(e,t,i=!1,n=!1)=>n?new Hl:!t&&v$.hasCapabilitiesApi()?new Ho:new Hc(e,i),Hu=class extends no{constructor(e,t){super(),this.configProvider=e,this.logger=t,this.bandwidthEstimationAvailable=!1,this.smoothingWindow=[],this.totalSamples=0,this.isStarted=!1,this.maxCountStatic=this.configProvider.config.ovcMaxCount,this.previousParticipantsCount=0,this.isMcpSrAvailable=!1;let i=window.navigator;this.updateStaticConstraint(i.hardwareConcurrency,this.configProvider.config.ovcAvailableConcurrencyForBiggerGrid,4),this.updateStaticConstraint(i.deviceMemory,this.configProvider.config.ovcMemoryForBiggerGrid,4),this.throttler=new Hh(this.logger.createChild("ovcThrottler"),this.configProvider.config.ovcRampDownCooldown,this.configProvider.config.ovcRampUpCooldown)}start(){this.logger.safe.debug("Starting OptimalVideoCountCalculator"),this.isStarted=!0,this.throttler.changed(()=>this.event("calculatorStateChanged").raise(2,{ovc:this.throttler.value,ovcPayload:this.payload}))}stop(){this.isStarted=!1}dispose(){super.dispose(),this.logger.safe.debug("Disposing OptimalVideoCountCalculator"),this.throttler.dispose()}processEstimatedBandwidth(e){this.bandwidthConstrainedOvc=this.getOVCEstimate(e),this.payload={bandwidth:e,reason:0},this.throttler.setValue(this.getOvcValue(),0)}updateParticipantCount(e){if(!this.configProvider||e===this.previousParticipantsCount)return;let t=this.configProvider.config.ovcXLParticipantsCount;e>t&&this.previousParticipantsCount<=t&&(this.maxCountStatic=this.configProvider.config.ovcMaxCountXL),e<=t&&this.previousParticipantsCount>t&&(this.configProvider.config.multiStreamSupported&&this.isMcpSrAvailable?this.maxCountStatic=this.configProvider.config.ovcMaxCountMultiStream:this.maxCountStatic=this.configProvider.config.ovcMaxCount),this.previousParticipantsCount=e,this.payload?.bandwidth&&(this.bandwidthConstrainedOvc=this.getOVCEstimate(this.payload.bandwidth),this.payload.reason=2),this.throttler.setValue(this.getOvcValue(),2)}setPerfConstrainedValue(e){this.perfConstrainedOvc=e,this.logger.safe.info(`Setting perfConstrainedOvc to ${e}`),this.payload&&this.getOvcValue()===e&&(this.payload={reason:1}),this.throttler.setValue(this.getOvcValue(),1)}mcpSourceRequestsAvailable(){this.configProvider.config.multiStreamSupported&&(this.isMcpSrAvailable=!0,this.maxCountStatic===this.configProvider.config.ovcMaxCount&&(this.maxCountStatic=this.configProvider.config.ovcMaxCountMultiStream),this.payload?.bandwidth&&(this.bandwidthConstrainedOvc=this.getOVCEstimate(this.payload.bandwidth),this.payload.reason=2),this.throttler.setValue(this.getOvcValue(),2))}getOVCEstimate(e){this.bandwidthEstimationAvailable||(this.bandwidthEstimationAvailable=this.isStarted&&e>0&&(this.totalSamples++>=this.configProvider.config.ovcIgnoreFirstSamples||Math.floor(e)/this.configProvider.config.ovcBandwidthPerVideoReceiver>=this.configProvider.config.nonEstimatedDefaultVideoReceiversCount));let t=this.configProvider.config.nonEstimatedDefaultVideoReceiversCount;return this.bandwidthEstimationAvailable&&(t=Math.floor(this.sampleSmoothed(e)/this.configProvider.config.ovcBandwidthPerVideoReceiver)),t}getOvcValue(){return Math.max(1,Math.min(this.bandwidthConstrainedOvc??this.maxCountStatic,this.perfConstrainedOvc??this.maxCountStatic,this.maxCountStatic))}sampleSmoothedV2(e){return tq(this.smoothingWindow,e,this.configProvider.config.ovcSlidingWindowSamples),nS(this.smoothingWindow)}sampleSmoothed(e){if(this.configProvider.config.ovcUseSampleSmoothedV2)return this.sampleSmoothedV2(e);if(this.smoothingWindow.length>=this.configProvider.config.ovcSlidingWindowSamples?this.smoothingWindow.shift():this.smoothingWindow.length===this.configProvider.config.ovcSlidingWindowSamples-1&&(this.smoothingWindow=this.smoothingWindow.map(()=>e)),this.smoothingWindow.push(e),!(this.smoothingWindow.length>=this.configProvider.config.ovcSlidingWindowSamples))return e;{let e=this.smoothingWindow.slice().sort(),t=nv(e);return e[e.length-1]-(e[e.length-1]-t*(1-this.configProvider.config.ovcSlidingWindowPercentile))}}updateStaticConstraint(e,t,i){e&&e<t&&(this.maxCountStatic=Math.min(this.maxCountStatic,i))}},Hh=class extends no{constructor(e,t,i){super(e),this.logger=e,this.throttleDownCooldown=t,this.throttleUpCooldown=i,this.wasRampingUp=!0,this.lastUpdateTime=0}get value(){return this.lastValue}setValue(e,t){if(e===this.lastValue)return;let i=e>this.lastValue,n=void 0!==this.lastValue&&i!==this.wasRampingUp?i?this.throttleUpCooldown:this.throttleDownCooldown:-1,r=Date.now();r-this.lastUpdateTime<n&&(2!==t||i)||(void 0!==this.lastValue&&(this.lastUpdateTime=r,this.wasRampingUp=i),this.logger.safe.info(`optimal video receivers count updated ${this.lastValue} -> ${e}, reason: ${t}`),this.lastValue=e,this.raiseChanged())}},Hg=class e{constructor(e,t=30){this.logger=e,this.maxEventNum=t,this.report=[],this.started=!1}isSupported(){return!!window.chrome?.runtime?.connect}start(){if(!this.isSupported)return void this.logger.debug("Chrome runtime is not supported");this.started=!0,this.logger.debug("Starting collecting CPU metric"),this.port=window.chrome.runtime.connect(e.extensionID,{name:e.extensionName}),this.port.onMessage.addListener(e=>{e&&nq(this.report,{timeStamp:Date.now(),value:e},this.maxEventNum)})}stop(){this.port?.disconnect(),this.port=null,this.started=!1}getSamples(){return this.report}getLastSample(){return nG(this.report)}getCurrentCpuSample(){return new Promise((t,i)=>{this.started&&t(nG(this.report)),this.isSupported()||i("Not supported"),this.port=window.chrome.runtime.connect(e.extensionID,{name:e.extensionName}),this.port.onMessage.addListener(e=>{this.stop(),e||i("Not supported"),t({timeStamp:Date.now(),value:e})})})}clearStats(){this.report=[]}};Hg.extensionID="nkeimhogjdpnpccoofpliimaahmaaome",Hg.extensionName="processCpu";var Hp=Hg,Hf=class{constructor(e){this.logger=e,this.started=!1}static isSupported(){return void 0!==globalThis.PressureObserver}get cpuState(){return this.currentCpuState}start(){if(this.logger.safe.debug("Starting CPU pressure observer"),this.started)return void this.logger.safe.debug("CPU pressure observer is already started");try{this.cpuObserver=new globalThis.PressureObserver(e=>{e.forEach(t=>{"cpu"===t.source&&this.currentCpuState!==t.state&&(this.logger.safe.debug(`CPU pressure state changed: ${JSON.stringify(e)}`),this.currentCpuState=t.state)})},{sampleRate:1})}catch(e){throw this.logger.safe.error(`Error while creating pressure observer: ${e}`),e}this.started=!0,this.cpuObserver?.observe("cpu")}stop(){this.started=!1,this.cpuObserver?.disconnect()}},Hm=class extends no{constructor(e,t,i,n){super(),this.statsGatherer=e,this.diagnostics=t,this.configProvider=i,this.logger=n,this.paused=!1,this.started=!1,this.trackInterval=this.configProvider.config.diagnostics.performanceMonitoring.remoteVideoTrackInterval,this.badPerfIds=new Set,this.perfTrackerMap=new Map,this.subs=[],this.rendererFpsCap=40,this.configProvider.config.diagnostics.performanceMonitoring.useComputePressure&&Hf.isSupported()&&(this.cpuPressureObserver=new Hf(this.logger)),this.configProvider.config.diagnostics.performanceMonitoring.useCpuSample&&(this.cpuMetricCollector=new Hp(this.logger,this.configProvider.config.diagnostics.performanceMonitoring.cpuMetricCollector))}start(){if(this.logger.safe.debug("Starting RemoteVideoPerformanceCalculator"),this.started)return void this.logger.safe.debug("RemoteVideoPerformanceCalculator already running. Do nothing.");this.calculatorStrategy=NQ.getStrategy(this.configProvider),this.started=!0,this.cpuPressureObserver?.start(),this.subs.push(this.statsGatherer.on("onDiagnosticUpdated",e=>this.processStats(e)))}stop(){this.logger.safe.debug("Stopping RemoteVideoPerformanceCalculator"),this.started=!1,this.subs.forEach(e=>{e.dispose()}),this.cpuMetricCollector?.stop(),this.cpuPressureObserver?.stop()}dispose(){this.logger.safe.debug("Disposing RemoteVideoPerformanceCalculator"),this.cleanupMaps(),this.stop()}cleanupMaps(){this.badPerfIds.clear(),this.perfTrackerMap.clear()}async processStats(e){try{if(this.paused||!e.video?.recv?.length)return;this.configProvider.config.diagnostics.traceLogging&&this.logger.safe.debug("Caught onDiagnosticUpdated: Calculating remote video performance"),e.video?.recv?.forEach(async t=>{let i=t.renderer?.msi;if(!this.perfTrackerMap.has(i)){let e={id:t.mediaEntity?.remoteTrackId,decodeTimeTracker:new SW(this.trackInterval),macroblockLossTracker:new SW(this.trackInterval),macroblockMaxLossTracker:0,freezeDurationPercent:0,frameHeight:0,frameWidth:0,rendererFps:new SW(this.trackInterval),incomingFps:new SW(this.trackInterval),framesReceived:0,framesDecoded:0,decoder:"",msi:i};this.perfTrackerMap.set(i,e)}let n=this.perfTrackerMap.get(i);n.decodeTimeTracker.captureSample(t.extensions?.decodeTime);let r=t.extensions?.macroblockRateStats?.macroblockRateDecoderLossPercent;n.macroblockLossTracker.captureSample(r),n.macroblockMaxLossTracker=t.extensions?.macroblockRateStats?.macroblockRateMaxDecoderLossPercent,t.extensions?.duration&&(n.freezeDurationPercent=t.extensions?.totalFreezeDuration/t.extensions?.duration*100),n.frameHeight=t.inboundRTP.frameHeight||0,n.frameWidth=t.inboundRTP.frameWidth||0,t.extensions?.frameRateDecoded!==void 0&&void 0!==t.inboundRTP.framesPerSecond&&t.extensions?.frameRateDecoded<=this.rendererFpsCap&&t.inboundRTP.framesPerSecond<=this.rendererFpsCap&&(n.rendererFps.captureSample(t.extensions?.frameRateDecoded),n.incomingFps.captureSample(t.inboundRTP.framesPerSecond)),t.inboundRTP.framesReceived&&t.inboundRTP.framesDecoded&&(n.framesReceived=t.inboundRTP.framesReceived,n.framesDecoded=t.inboundRTP.framesDecoded),n.decoder=t.inboundRTP.decoderImplementation,n.rendererFps.isReportComplete()&&n.incomingFps.isReportComplete()&&n.decodeTimeTracker.isReportComplete()&&(this.paused=!0,await this.checkQuality(n,e.perfCounters,e.video?.recv?.length),this.paused=!1)})}catch(e){this.logger.error("Failed to processes diagnostics update: "+e)}}async checkQuality(e,t,i){let n;if(!i)return;let r=[];try{n=await this.cpuMetricCollector?.getCurrentCpuSample()}catch{this.logger.safe.debug("CPU sampling is not supported")}let s={ts:Date.now(),trackId:e.id,decodeTime:e.decodeTimeTracker.getReport(),macroblockLossPercent:e.macroblockLossTracker.getReport(),macroblockMaxLossPercent:e.macroblockMaxLossTracker,freezeDurationPercent:e.freezeDurationPercent,perfCounters:t,cpuUsage:n,rendererFps:e.rendererFps.getReport(),incomingFps:e.incomingFps.getReport(),framesDecoded:e.framesDecoded,framesReceived:e.framesReceived,msi:e.msi,frameHeight:e.frameHeight,decoder:e.decoder};r.push(s);let a=this.calculatorStrategy.checkQuality(e);if(0===a){if(this.logger.safe.debug(`Bad perf detected for msi ${e.msi}: ${JSON.stringify(r)}`),this.configProvider.config.diagnostics.performanceMonitoring.usePerfConstrainedOvc&&!ra.Recv.getNextLowerResolution(e.frameWidth,e.frameHeight)){let e=Math.max(i-1,1);this.logger.info(`Min resolution reached, decreasing OVC to: ${e}`),this.diagnostics.registerVideoPerformanceEvent(r,1,e),this.event("calculatorStateChanged").raise(2,{ovc:e}),this.perfTrackerMap.clear();return}this.diagnostics.registerVideoPerformanceEvent(r,1),this.event("calculatorStateChanged").raise(1,{msi:e.msi})}2===a&&(this.diagnostics.registerVideoPerformanceEvent(r,0),this.logger.safe.debug(`Good perf detected for msi ${e.msi}: ${JSON.stringify(r)}`),this.event("calculatorStateChanged").raise(0,{msi:e.msi})),this.perfTrackerMap.delete(e.msi)}},Hv=class extends no{constructor(e,t,i,n){super(),this.statsGatherer=e,this.diagnostics=t,this.configProvider=i,this.logger=n,this.calculators=new Map,this.subs=[]}on(e,t){switch(e){case"onIncomingVideoQualityChanged":this.addCalculator(0),this.startCalculator(0);break;case"onOptimalVideoCountChanged":this.addCalculator(2),this.startCalculator(2)}return this.subscribe({changed:void 0,on:{name:String(e),handler:t}})}addCalculator(e){let t=this.calculators.get(e);if(!t){switch(e){case 0:if(!this.configProvider.config.diagnostics.performanceMonitoring.enableRemoteVideoCalculator)return;t=new Hm(this.statsGatherer,this.diagnostics,this.configProvider,this.logger.createChild("RemoteVideoPerformanceCalculator"));break;case 2:if(!this.configProvider.config.enableOptimalVideoCount)return;t=new Hu(this.configProvider,this.logger.createChild("OptimalVideoCountCalculator"));break;case 1:throw Error("Not implemented")}this.subs.push(t.on("calculatorStateChanged",(t,i)=>{this.handleChanged(e,t,i)})),this.calculators.set(e,t)}}startCalculator(e){this.logger.safe.debug(`adding calculator with id ${e}`);let t=this.calculators.get(e);t&&t.start()}stopCalculator(e){this.logger.safe.debug(`stopping calculator with id ${e}`);let t=this.calculators.get(e);t&&t.stop()}processNotification(e,t){switch(e){case"BandwidthNotification":this.calculators.get(2)?.processEstimatedBandwidth(t.bw);break;case"ParticipantCountChanged":this.calculators.get(2)?.updateParticipantCount(t.count);break;case"McpSourceRequestsAvailable":this.calculators.get(2)?.mcpSourceRequestsAvailable();break;default:this.logger.safe.info(`Notification message handler not found for type: ${e}`)}}dispose(){super.dispose(),this.calculators.forEach(e=>{e.dispose()}),this.subs.forEach(e=>{e.dispose()})}handleChanged(e,t,i){switch(this.logger.info(`calculatorStateChanged  ${t}: calculatorType ${e} ${JSON.stringify(i)}`),e){case 0:if(2===t){this.calculators.get(2)?.setPerfConstrainedValue(i?.ovc);break}this.configProvider.config.diagnostics.performanceMonitoring.enableLowerResolution&&this.event("onIncomingVideoQualityChanged").raise(t,i?.msi);break;case 2:this.event("onOptimalVideoCountChanged").raise(i?.ovc,i?.ovcPayload)}}},HS=i(892891),Hy=class{constructor(e,t,i,n){this.lowThreshold=e,this.highThreshold=t,this.isLowerBetter=i,this.curInLowerRange=i,this.stateTracker=new HC(n)}onSample(e,t){let i=this.curInLowerRange;this.curInLowerRange?e>this.highThreshold&&(i=!1):e<this.lowThreshold&&(i=!0);let n=this.stateTracker.onNewState(this.getQuality(i),t);return n!==this.getQuality(this.curInLowerRange)&&(this.curInLowerRange=i),n}getQuality(e){return e===this.isLowerBetter?"Good":"Bad"}},HC=class{constructor(e){this.stickinessTime=e}onNewState(e,t){return"Good"!==e&&"Bad"!==e?this.curState:0===this.stickinessTime?e:(e===this.curState?this.stickTimerStarted=0:"Bad"===this.curState?0===this.stickTimerStarted?this.stickTimerStarted=t:t-this.stickTimerStarted>this.stickinessTime&&(this.curState=e,this.stickTimerStarted=0):(this.curState=e,this.stickTimerStarted=0),this.curState)}},Hb=class{constructor(e){this.configProvider=e,this.outboundNetworkQuality="Good",this.inboundNetworkQuality="Good",this.jitterAccumulator=new No(this.configProvider.config.webrtcJitterWindowSize),this.healedRatioAccumulator=new No(this.configProvider.config.webrtcHealedRatioWindowSize),this.jitterStateProcessor=new Hy(e.config.webrtcJitterLowThreshold,e.config.webrtcJitterHighThreshold,!0,e.config.webrtcJitterSticknessTime),this.lossRateStateProcessor=new Hy(e.config.webrtcLossRateLowThreshold,e.config.webrtcLossRateHighThreshold,!0,e.config.webrtcLossRateSticknessTime)}processReport(e){e.audio?.recv?.length&&(this.inboundNetworkQuality=this.processInboundSample((0,HS.last)(e.audio.recv))),e.audio?.send?.length&&(this.outboundNetworkQuality=this.processOutboundSample((0,HS.last)(e.audio.send)))}getInboundNetworkQuality(){return this.inboundNetworkQuality}getOutboundNetworkQuality(){return this.outboundNetworkQuality}processInboundSample(e){let t=this.inboundNetworkQuality,{totalSamplesReceived:i}=e.inboundRTP,{healedRatio:n}=e.extensions??{};null!=n&&this.healedRatioAccumulator.add(n);let r=(0,HS.mean)(this.healedRatioAccumulator.items);return i&&!(i<this.configProvider.config.webrtcMinAudioSamplesRecvForNetworkRecvQuality)&&r&&this.healedRatioAccumulator.isFull?this.determineInboundQualityLevel(r):t}determineInboundQualityLevel(e){let t=this.inboundNetworkQuality,i=this.configProvider.config.webrtcStatNetworkDetectionHysteresis,n=this.configProvider.config.webrtcStatNetworkDetectionBadLevel,r=this.configProvider.config.webrtcStatNetworkDetectionGoodLevel,s=n+i/2,a=n-i/2,o=r+i/2;return e<r-i/2?"Good":e<o?"Good"===t?"Good":"Poor":e<a?"Poor":e<s?"Bad"===t?"Bad":"Poor":"Bad"}processOutboundSample(e){let t=this.outboundNetworkQuality,{packetsSent:i,timestamp:n}=e.outboundRTP,{jitter:r}=e.remoteInboundRTP??{},{lossRate:s}=e.extensions??{};if(!i||i<this.configProvider.config.webrtcMinPacketsSentForNetworkSendQuality)return t;null!=r&&this.jitterAccumulator.add(r);let a=(0,HS.mean)(this.jitterAccumulator.items),o=this.jitterAccumulator.isFull?this.jitterStateProcessor.onSample(a,n):"Good",l=s?this.lossRateStateProcessor.onSample(s,n):"Good";return"Good"===o&&"Good"===l?"Good":"Bad"}},HT=i(892891),HE=class{constructor(e){this.configProvider=e,this.speechWindow=new No(e.config.webrtcSpeakingWhileMutedDetectionWindow)}processReport(e){if(!e.audio?.send?.length)return!1;let t=e.audio.send[0],{rawInputVolume:i,callIsMuted:n}=t.extensions??{},{audioLevel:r}=t.mediaSource??{},{useAudioAnalyzer:s,webrtcSpeakingWhileMutedDetectionLevel:a}=this.configProvider.config;if(!n)return this.speechWindow.clear(),!1;let o=s?i:r;return null!=o&&this.speechWindow.add(o),!!this.speechWindow.isFull&&(0,HT.mean)(this.speechWindow.items)>a}},H_=class{constructor(e){this.context=e,this.cname=nR()}toLocal(e,t,i){return this.modify({sdpSource:0,sdpType:i},e,t)}toOffer(e,t,i){return this.modify({sdpSource:1,sdpType:"offer"},e,t,i)}toAnswer(e,t,i){return this.modify({sdpSource:1,sdpType:"answer"},e,t,i)}toRemote(e,t,i,n,r=!1){return this.modify({sdpSource:2,sdpType:n,isOrWasProvisional:r},e,t,i)}modify(e,t,i,n){let r=new L2(this.context,i,n,this.cname).build(e),s=nw(t);return r.modify(s),s}},HI=eR(e5()),Hw=class{constructor(e,t,i,n,r){this.logger=e,this.RtcDescType=t,this.sessionDescription=i,this.negotiationQueue=n,this.mediaManager=r}configure(e){this.peerConnection=e}renegotiateNow(){return this.renegotiate(null,!0)}renegotiate(e,t=!1,i="local"){if(!this.peerConnection)throw Error("trying to renegotiate without a peerConnection");let n="local"===i?this.createNegotiationTaskForHaveLocalOffer(e):this.createNegotiationTaskForHaveRemoteOffer();return t?(this.logger.safe.info(`forced ${i} renegotiation starting`),Promise.resolve(n())):this.negotiationQueue.add(n)}normalizeRemoteSdpSDES(e,t){if(t.media[0].crypto)e.media.forEach(e=>{delete e.fingerprint,delete e.setup,e.crypto=e.crypto.filter(e=>t.media[0].crypto.some(t=>t.id===e.id)).slice(0,1)}),e.fingerprint&&delete e.fingerprint;else{let t=this.mediaManager.getMediaEntities().find(e=>void 0!==e.getExtension("setup"));e.media.forEach(e=>{let i=t?.getExtension("setup")||"actpass";"actpass"===e.setup&&(e.setup="active"===i?"passive":"active")})}}normalizeRemoteSdpExtensions(e,t){e.media.forEach((e,i)=>{let n=new Set(t.media[i].ext?.map(e=>e.value)||[]);e.ext=e.ext?.filter(e=>n.has(e.value))})}createNegotiationTaskForHaveLocalOffer(e){return async()=>{let t=this.peerConnection.remoteDescription.sdp,i=this.peerConnection.localDescription.sdp;this.logger.safe.info(`local renegotiation starting remoteSdp=${!!t} localSdp=${!!i}`);let n=HI.parse(t),r=HI.parse(i);this.normalizeRemoteSdpSDES(n,r),this.normalizeRemoteSdpExtensions(n,r),t=HI.write(n);let s=new this.RtcDescType({sdp:t,type:"answer"});e&&e.forEach(e=>{s=e.modifyDescriptor(s)});try{this.logger.safe.info("creating offer");let e=await this.peerConnection.createOffer(),t=this.sessionDescription.createLocalOffer(e.sdp),i=new this.RtcDescType({sdp:t.toLocal(),type:"offer"});this.logger.safe.info("setting local description"),this.logger.unsafe.debug(`local description, sdp: ${i.sdp}`),await this.peerConnection.setLocalDescription(i),this.logger.safe.info("setting remote description"),this.logger.unsafe.debug(`remote description, sdp: ${s.sdp}`),await this.peerConnection.setRemoteDescription(s),this.logger.safe.debug("local renegotiation done")}catch(e){throw this.logger.safe.error("local renegotiation failed: ",e.toString()),e}}}createNegotiationTaskForHaveRemoteOffer(){return this.logger.safe.info("createNegotiationTaskForRemote"),async()=>{this.logger.safe.info("proceed with setting local sdp start");try{this.logger.safe.info("creating answer");let e=await this.peerConnection.createAnswer();this.logger.safe.info("applying answer");let t=this.sessionDescription.createLocalAnswer(e.sdp),i=new this.RtcDescType({sdp:t.toLocal(),type:"answer"});this.logger.safe.info("setting [answer] local description"),this.logger.unsafe.debug(`[answer] local description, sdp: ${i.sdp}`),await this.peerConnection.setLocalDescription(i),this.logger.safe.info("local answer for renegotiation is done")}catch(e){throw this.logger.safe.error("local answer for renegotiation failed: ",e.toString()),e}}}},HP=class{get sdp(){return this.originalDescription.sdp}set sdp(e){this.originalDescription=new mk.RTCSessionDescription({sdp:e,type:this.originalDescription.type})}get type(){return this.originalDescription.type}set type(e){this.originalDescription=new mk.RTCSessionDescription({sdp:this.originalDescription.sdp,type:e})}constructor(e){this.originalDescription=new mk.RTCSessionDescription(e)}toJSON(){return this.originalDescription.toJSON()}},HR=class{constructor(e,t,i,n,r,s,a,o,l,c,d){this.logger=e,this.configProvider=t,this.diagnostics=i,this.reinvitelessContext=n,this.mediaManager=r,this.audioCodecManager=s,this.ufdManager=a,this.sessionContext=o,this.qualityManager=l,this.streamSendersManager=c,this.callbacks=d,this.negotiationQueue=new N3(this.logger),this.negotiatedModalitiesInternal={},this.disabledModalitiesInternal={},this.initiatorInternal=!1,this.noIceCandidates=!1,this.noRelayIceCandidates=!1,this.isRollbackSupported=!1,this.canTriggerRenegotiation=!0,this.triggerRenegotiationFlag=!1,this.capabilityGatherer=Hd({global:this.sessionContext.maContext},this.configProvider.config.useSdpCapabilities,this.configProvider.config.noRequiredCodecsWorkaround),this.mediaContentTypeInternal=nL("webrtcMediaContentType",this.sessionContext.config,this.configProvider.config),this.allowedMediaContentTypeInternal=nL("webrtcAllowedMediaContentType",this.sessionContext.config,this.configProvider.config).concat(),this.negotiationCompletedDefer=new iE,this.iceCandidatesDeferred=new iE,this.iceCandidateReceivedInternal=!1,this.initialNegotiationCompleted=!1,this.terminated=!1,this.sessionDescription=Uc.build({sdpTransform:new H_(this.sessionContext),mediaManager:this.mediaManager,logger:this.logger,configProvider:this.configProvider,configuration:{addPrefixForMsid:this.configProvider.config.addPrefixForMsidInSdp},numVbssChannels:this.sessionContext.config.numVbssChannels}),this.negotiationEmulator=new Hw(this.logger.createChild("negotiationEmulator"),HP,this.sessionDescription,this.negotiationQueue,this.mediaManager),this.negotiationCompletedDefer.promise.catch(()=>{}),this.negotiationCompletedDefer.reject("placeholder")}get configuredModalities(){return this.configuredModalitiesInternal}get offeredModalities(){return this.offeredModalitiesInternal}get disabledModalities(){return this.disabledModalitiesInternal}get negotiatedModalities(){return this.negotiatedModalitiesInternal}get allowedMediaContentType(){return this.allowedMediaContentTypeInternal}get mediaContentType(){return this.mediaContentTypeInternal}get negotiationCompletedPromise(){return this.negotiationCompletedDefer}get iceRelayGatheringStartTime(){return this.iceRelayCandidatesGatherStartTime}get iceCandidatesDefer(){return this.iceCandidatesDeferred}get initiator(){return this.initiatorInternal}set rollbackSupported(e){this.isRollbackSupported=e}set iceCandidateReceived(e){this.iceCandidateReceivedInternal=e}setInternals(e,t,i){this.logger.safe.debug(`Setting internals tm: ${!!e} tsp: ${!!t} dc: ${!!i}`),this.transceiverManager=e,this.transportStateProvider=t,this.dataChannel=i}terminate(e){this.logger.safe.info(`[${e}] terminating`),this.terminated=!0,this.canTriggerRenegotiation=!1,this.negotiatedModalitiesInternal={},this.resetCandidateGathering(e),this.negotiationCompletedDefer.reject("webRtcSession cleanup"),this.negotiationQueue.dispose()}pauseNegotiations(e=e9()){let t=new iE;return this.negotiationCompletedDefer.promise.catch(()=>{}).then(()=>{this.setNegotiationPromise(t,e)}),t}async configureModalities(e,t,i){let n=async()=>{if(await this.configureModalitiesPromise,!e.audio&&!e.video&&!e.sharing)throw Error(`Invalid parameters! ${JSON.stringify(e)}`);let n=nI(e),r=nI(this.negotiatedModalities);this.configProvider.config.alwaysNegotiateDataChannel&&(delete n.data,delete r.data);let s=!this.configuredModalities||!m4(n,r);this.logger.safe.info(`[${t}] configureModalities ${t$(this.configuredModalities)} -> ${t$(e)} (${s?`update from ${t$(this.negotiatedModalities)}`:"fulfilled"})`),this.configuredModalities=e,s&&!this.updateSendStreamsReinviteless(t,i)&&(this.configProvider.config.removeSendersOnConfigureModalities&&!m0(this.configuredModalities)&&await this.streamSendersManager.update(e,1,t),this.triggerRenegotiation(!1,t,i))};return this.configureModalitiesPromise=n(),this.configureModalitiesPromise.catch(e=>{this.logger.safe.warn(`[${t}] Error during configuring modalities: ${t$(e)}`)}),this.configureModalitiesPromise}async completeNegotiation(e){this.mediaManager.commit();let t=m3(this.configProvider,this.configuredModalities,this.negotiatingModalities,this.negotiatedModalities)&&!this.triggerRenegotiationFlag;this.canTriggerRenegotiation=!0,this.logger.safe.info(`[${e}] negotiation completed isComplete: ${t} configured: ${JSON.stringify(this.configuredModalities)} negotiating: ${JSON.stringify(this.negotiatingModalities)} offered: ${JSON.stringify(this.offeredModalities)} negotiated: ${JSON.stringify(this.negotiatedModalities)}`);let i=this.negotiatedModalities;if(this.streamSendersManager.pendingStreamsPromise){this.logger.safe.info(`[${e}] Waiting for stream acquisitions to complete...`);let n=await this.streamSendersManager.pendingStreamsPromise;this.streamSendersManager.clearStreamsPromise(),this.logger.safe.info(`[${e}] Stream acquisitions completed: ${t$(n)}`),m3(this.configProvider,n,this.negotiatingModalities,this.negotiatedModalities)||(this.logger.safe.warn(`[${e}] Some streams were not acquired successfully, considering the negotiation as incomplete`),i=n,t=!1)}return t||this.triggerRenegotiation(!1,e),this.initialNegotiationCompleted=!0,this.negotiationCompletedDefer.resolve(),{isComplete:t,activeModalities:i,offeredModalities:this.offeredModalities,attemptedModalities:this.negotiatingModalities,configuredModalities:this.configuredModalities,initiator:this.initiatorInternal}}async rejectNegotiation(e,t,i=!1){let n;this.mediaManager.rollback(),this.logger.safe.warn(`[${t}] negotiation rejected isComplete: ${!i} error: ${t$(e)} configured: ${JSON.stringify(this.configuredModalities)} negotiating: ${JSON.stringify(this.negotiatingModalities)} offered: ${JSON.stringify(this.offeredModalities)} negotiated: ${JSON.stringify(this.negotiatedModalities)}`),this.qualityManager.clearPendingCapabilities();let r=m8(this.negotiatedModalities,this.negotiatingModalities);this.logger.safe.debug(`[${t}] configured modalities for rollback: ${JSON.stringify(r)}`),this.transceiverManager?.syncTransceivers(r),this.sessionContext.getSmallCallTelemetry()?.setEventType("rejectNegotiation"),this.dataChannel?.updateDataModalityState(this.negotiatingModalities.data);let s=m0(r);m0(this.negotiatedModalities)!==s&&await this.streamSendersManager.setHold(s,t),s?this.logger.safe.info(`[${t}] Hold is configured. Not updating streams`):await this.streamSendersManager.update(r,0,t);let a=this.transportStateProvider?.signalingState;if("have-local-offer"===a){n={},this.logger.safe.info(`[${t}] rolling back local description`);try{if(!this.isRollbackSupported||this.configProvider.config.webrtcHandleRollback){n.type="LocalRN",this.logger.safe.info(`[${t}] rolling back using local renegotiation`);let e=[this.callbacks.getRollbackModifier(this.logger)];await this.negotiationEmulator.renegotiate(e,!0),this.logger.safe.info(`[${t}] rolling back using local complete`)}else this.logger.safe.info(`[${t}] rolling back using rollback`),n.type="Rollback",await this.callbacks.setLocalDescription({type:"rollback"})}catch(e){this.logger.safe.error(`[${t}] rollback error: ${t$(e)}`),n.error=e}}else if("have-remote-offer"===a){n={};try{if(!this.isRollbackSupported||this.configProvider.config.webrtcHandleRemoteRollback){n.type="RemoteRN",this.logger.safe.info(`[${t}] applying answer for remote renegotiation`);let e=[this.callbacks.getRollbackModifier(this.logger)];await this.negotiationEmulator.renegotiate(e,!0,"remote")}else this.logger.safe.info(`[${t}] rolling back using rollback on remote description`),n.type="Rollback",await this.callbacks.setRemoteDescription({type:"rollback"})}catch(e){this.logger.safe.error(`[${t}] rollback error: ${t$(e)}`),n.error=e}}else this.callbacks.hasPC()&&this.logger.safe.error(`[${t}] cannot rollback local description in current state: ${this.transportStateProvider.signalingState}`);return this.canTriggerRenegotiation=!0,this.negotiationCompletedDefer.reject("negotiation rejected"),i&&(this.logger.safe.info(`[${t}] retrying failed negotiation`),this.triggerRenegotiation(!1,t)),{isComplete:!i,activeModalities:r,offeredModalities:this.offeredModalities,attemptedModalities:this.negotiatingModalities,configuredModalities:this.configuredModalities,initiator:this.initiatorInternal,rollback:n}}triggerRenegotiation(e,t=e9(),i){this.canTriggerRenegotiation?(this.canTriggerRenegotiation=!1,this.triggerRenegotiationFlag=!1,this.logger.safe.info(`[${t}] triggering renegotiation`),this.mediaManager.backup(),this.callbacks.onNegotiationRequired(t,i)):e&&(this.logger.safe.info(`[${t}] renegotiation postponed`),this.triggerRenegotiationFlag=!0)}configureCrypto(e){if(this.offeredDescription){let t=this.offeredDescription.getSrtpInfo();if(this.diagnostics.offeredSrtp=t,!t.dtls&&t.sdes)return this.logger.safe.warn("configuring peer connection to use sdes"),e.optional.push({DtlsSrtpKeyAgreement:!1}),this.diagnostics.negotiatedSrtp={sdes:!0},0}return this.diagnostics.negotiatedSrtp={dtls:!0},1}createOffer(e,t){let i=this.negotiationQueue.add(()=>this.createOfferAsync(e,t),e);return this.resetNegotiationQueue(e),i}processOffer(e,t){let i=this.negotiationQueue.add(()=>this.processOfferAsync(e,t),t);return this.resetNegotiationQueue(t),i}async createAnswer(e,t){let i;if((this.sessionContext.config.isPstnCall?!this.configProvider.config.createProvisionalAnswer.enabledPstn:!this.configProvider.config.createProvisionalAnswer.enabled)&&e)return this.logger.safe.info("createAnswer(): Ignoring provisional answer"),{blob:"",contentType:this.mediaContentType};let n=e?"pranswer":"answer",r=e?"createProvisionalAnswerAsync":"createAnswerAsync",s=this.diagnostics.getTimerTracker(r,{first:!0});if(s.mark("start"),this.logger.safe.info(`[${t}] create [${n}] offered: ${JSON.stringify(this.offeredModalities)} configured: ${JSON.stringify(this.configuredModalities)}`),!this.configuredModalities)throw Error("no configured modalities to create answer for");let a=this.negotiatingModalities=m1(this.offeredModalities,this.configuredModalities);await this.callbacks.assurePC(t,s.clone("assurePeerConnectionAsync"));let o=this.transportStateProvider.isWaitingAcceptProvisional;if(this.transportStateProvider.isWaitingAcceptProvisional=e,s.markAndMeasure("start","assurePeerConnectionAsync"),this.logger.safe.info(`[${t}] updatePeerConnectionStreamsAsync, pc state: ${this.transportStateProvider.signalingState}`),!this.offeredDescription.isCodecSwitchSupported())try{let e=(await this.capabilityGatherer.getCapabilities(nu.MEDIA_TYPE.audio)).codecs.map(e=>e.mimeType);this.offeredDescription.usePrimaryAudioCodecOnly(e)}catch(e){this.logger.safe.error(`[${t}] failed to set primary codec based on audio capability ${t$(e)}`)}if(s.markAndMeasure("assurePeerConnectionAsync","handleCodecSwitchUnsupported"),this.audioCodecManager.prepareForNegotiation(this.initiatorInternal),this.offeredDescription.setModalities(a),await this.detectSendProfileSupport(),s.markAndMeasure("handleCodecSwitchUnsupported","detectSendProfileSupport"),"have-local-pranswer"===this.transportStateProvider.signalingState&&this.configProvider.config.createProvisionalAnswer.useProvisionalSignalingState)this.logger.safe.info(`[${t}] skipping [${n}] set remote description in have-local-pranswer state, negotiated:`,a);else{let i=this.offeredDescription.toRemote(e||o);this.logger.safe.info(`[${t}] create [${n}] set remote description, negotiated:`,a),this.logger.unsafe.info(`[${t}] setRemoteDescription, sdp:`,i),await this.callbacks.setRemoteDescription({sdp:i,type:"offer"})}s.markAndMeasure("detectSendProfileSupport","setRemoteDescription"),this.dataChannel?.updateDataModalityState(this.negotiatingModalities.data),await this.updateStreamSenders(s,t,e,a),s.markAndMeasure("setRemoteDescription","assureStreamsAndDataChannel"),this.callbacks.onTransportInitialized(),"have-local-pranswer"===this.transportStateProvider.signalingState&&this.configProvider.config.createProvisionalAnswer.useProvisionalSignalingState?(i=this.callbacks.getLocalDescription(),this.logger.safe.info(`[${t}] skipping [${n}] createAnswer in have-local-pranswer state, returning applied local description`),this.logger.unsafe.info(`[${t}] previous localDescription, sdp:`,i.sdp)):(i=this.configProvider.config.createProvisionalAnswer.useProvisionalSignalingState?await this.callbacks.createAnswer({type:n}):await this.callbacks.createAnswer(),this.logger.safe.info(`[${t}] create [${n}] answer from peer connection type: ${i.type}`),this.logger.unsafe.info(`[${t}] created answer, sdp:`,i.sdp)),s.markAndMeasure("assureStreamsAndDataChannel","createAnswer");let l=this.sessionDescription.createLocalAnswer(i.sdp);this.hasIceCandidates(l)||this.resetCandidateGathering(t),this.callbacks.startWaitingForStreamStart(a),this.setupIceGatheringTimeout(t);let c={sdp:l.toLocal(),type:this.configProvider.config.createProvisionalAnswer.useProvisionalSignalingState?n:"answer"};this.logger.safe.info(`[${t}] create [${n}] set local description, type: ${c.type}`),this.logger.unsafe.info(`[${t}] localDescription sdp:`,c.sdp),await this.callbacks.setLocalDescription({sdp:c.sdp,type:c.type}),s.markAndMeasure("createAnswer","sLD"),await this.iceCandidatesDeferred.promise,s.markAndMeasure("sLD","candidates");let d=this.sessionDescription.createLocalAnswer(this.callbacks.getLocalDescription().sdp);this.fixLocalDescription(d),d.updateModalities(a),this.checkIceCandidates(d),e&&this.configProvider.config.createProvisionalAnswer.forceRecvonly&&(this.logger.safe.info(`[${t}] create [${n}] munge returned local sdp to recvonly modalities`),d.forceRecvonly());let u=d.toAnswer();this.audioCodecManager.decoder?.setRecvPayloads(d.getPayloadsForMedia(nu.MEDIA_TYPE.audio)),this.checkAudioCodecNegotiated(t),e?this.logger.safe.debug(`[${t}] create [${n}] skip stream senders manager activation`):(this.logger.safe.debug(`[${t}] create [${n}] activating stream senders manager`),await this.streamSendersManager.activate(t)),s.markAndMeasure("candidates","streamSendersManagerActivate"),e?this.logger.safe.debug(`[${t}] create [${n}] skip updating sources and capabilities`):(this.logger.safe.debug(`[${t}] create [${n}] updating sources and capabilities`),this.callbacks.updateLocalMediaSources(),this.applyReceiveCapabilities(t)),a=d.getModalities(),this.reinvitelessContext.enabled&&(a=m8(this.negotiatingModalities,a)),m3(this.configProvider,this.configuredModalities,this.negotiatingModalities,a)||this.triggerRenegotiation(!0,t),this.negotiatedModalities=a,this.diagnostics.bweType=d.getBweType(),this.logger.safe.info(`[${t}] CREATE ${n.toUpperCase()} completed`),this.logger.unsafe.info(`[${t}] outgoing sdp:`,u);let h={blob:u,contentType:this.mediaContentType};return this.configProvider.countryCode&&(h.clientLocation=this.configProvider.countryCode),this.reinvitelessContext.enabled&&(h.mediaDescriptions=this.getMediaDescriptions(a)),this.callbacks.setBWSeed(h),s.markAndMeasure("start",r),h}async detectSendProfileSupport(){if(this.configProvider.config.preferredH264VideoSendProfile||this.configProvider.config.preferredH264SharingSendProfile){let e=this.capabilityGatherer;this.configProvider.config.learnCodecSendCapabilitiesFromSenderApi&&(e=Hd({global:this.sessionContext.maContext},this.configProvider.config.useSdpCapabilities,this.configProvider.config.noRequiredCodecsWorkaround,!0));let t=await e.getCapabilities("video"),i=this.mediaManager.getMediaEntities().filter(e=>{let t=e.getModality();return t===nu.MEDIA_TYPE.video||t===nu.MEDIA_TYPE.sharing}).filter(e=>e.isEnabled());for(let e of t.codecs)if(e.sdpFmtpLine&&e.mimeType.toLocaleLowerCase().includes("h264")){let t=e.sdpFmtpLine.match(/profile-level-id=([a-fA-F0-9]{6})/);t?.length===2&&i.forEach(e=>e.addSupportedSendProfile("H264",t[1]))}}}async updateStreamSenders(e,t,i,n){this.transceiverManager.syncTransceivers(n),this.mediaManager.getMediaEntities().forEach(e=>{e.setExtension("midApplied",!0)});let r=m0(this.negotiatingModalities);if(m0(this.negotiatedModalities)!==r&&(e.mark("startConfigureHold"),await this.streamSendersManager.setHold(r,t),e.markAndMeasure("startConfigureHold","configureHold")),r)this.logger.safe.info(`[${t}] Hold is configured. Not updating streams`);else{let r=this.configProvider.config.negotiationParallelStreamAcquisitionCreateAnswer&&!this.initialNegotiationCompleted?2:0;i&&(r=4),await this.streamSendersManager.update(n,r,t,e.clone("updateStreams"))}}configureBroadcastScenario(e,t){let i=this.configProvider.config.broadcastMode;this.diagnostics.meetingScenario=e.meetingScenario,(i?.prioritizeLayoutOnServer||i?.prioritizeLayoutOnClient||i?.maxSessionBandwidthKbps)&&e.meetingScenario&&i.townHallScenarioNames?.length&&-1!==i.townHallScenarioNames.map(e=>e.toLowerCase()).indexOf(e.meetingScenario.toLowerCase())&&(this.sessionContext.config.isTownHall=!0,this.diagnostics.isTownHall=!0,i?.maxSessionBandwidthKbps&&this.configProvider.overrideMaxSessionBandwidth(i.maxSessionBandwidthKbps)&&(this.logger.safe.info(`Adjusting maxSessionBandwidth for TownHall: ${this.configProvider.mediaConfig.maxBandwidthInKbps}`),this.triggerRenegotiation(!0,t)))}async processAnswer(e,t,i,n=!1){try{let r=e.blob;this.logger.unsafe.debug(i?`[${t}] PROCESS PRANSWER`:`[${t}] PROCESS ANSWER`,"sdp:",r);let s=i?"pranswer":"answer";if(i&&(!HA(this.sessionContext,n)||"have-local-offer"!==this.transportStateProvider.signalingState))return void this.logger.safe.info(`[${t}] process [${s}] ignored`);this.configureBroadcastScenario(e,t);let a=this.diagnostics.getTimerTracker(`${i?"processProvisionalAnswerAsync":"processAnswerAsync"}`,{first:!0});a.mark("start");let o=this.sessionDescription.createRemoteAnswer(r),l=mK(o.getModalities());this.reinvitelessContext.enabled&&(l=m8(this.offeredModalities,l)),o.setModalities(l),await this.detectSendProfileSupport();let c=o.toRemote();if(i||(-1===this.allowedMediaContentType.indexOf(this.mediaContentType)&&this.allowedMediaContentType.push(this.mediaContentType),m0(l)||(await this.streamSendersManager.update(l,1,t),a.markAndMeasure("start","streamSendersManagerUpdate"),mY(this.offeredModalities.data)&&!l.data&&this.dataChannel?.disable()),this.negotiatedModalities=l,this.callbacks.updateLocalMediaSources(),this.diagnostics.bweType=o.getBweType()),this.callbacks.onTransportInitialized(),this.logger.unsafe.info(`[${t}] process [${s}] set remote description`,"negotiated:",l,"sdp:",c),a.mark("startSetRemoteDescription"),await this.callbacks.setRemoteDescription({sdp:c,type:s}),a.markAndMeasure("startSetRemoteDescription","setRemoteDescription"),i)return;await this.streamSendersManager.activate(t),a.markAndMeasure("setRemoteDescription","streamSendersManagerActivate"),this.applyReceiveCapabilities(t),this.checkAudioCodecNegotiated(t),this.transceiverManager.syncTransceivers(l),a.markAndMeasure("start","processAnswerAsync")}catch(e){if(i)return void this.logger.safe.warn(`Error thrown during pranswer generation, ignoring: ${t$(e)}`);throw e}}async createOfferAsync(e,t){let i,n=this.diagnostics.getTimerTracker("createOfferAsync",{first:!0});if(n.mark("start"),this.logger.safe.info(`[${e}] create [offer] configured: ${JSON.stringify(this.configuredModalities)}`),this.initiatorInternal=!0,!this.configuredModalities)throw Error("no configured modalities to create offer for");this.canTriggerRenegotiation=!1,this.negotiatingModalities=this.configuredModalities,await this.callbacks.assurePC(e,n.clone("assurePeerConnectionAsync")),n.markAndMeasure("start","assurePeerConnectionAsync"),this.logger.safe.info(`[${e}] updatePeerConnectionStreamsAsync, pc state: ${JSON.stringify(this.transportStateProvider.signalingState)}`),m0(this.negotiatingModalities)&&!nE(this.negotiatedModalities)&&Object.keys(this.negotiatingModalities).forEach(e=>{void 0===this.negotiatedModalities[e]&&delete this.negotiatingModalities[e]}),this.transceiverManager?.assureTransceivers(this.negotiatingModalities),this.dataChannel?.updateDataModalityState(this.negotiatingModalities.data);let r=m0(this.negotiatingModalities);m0(this.negotiatedModalities)!==r&&(n?.mark("startConfigureHold"),await this.streamSendersManager.setHold(r,e),n?.markAndMeasure("startConfigureHold","configureHold")),r?(this.logger.safe.info(`[${e}] Hold is configured. Not updating streams`),i=this.negotiatingModalities):(i=await this.streamSendersManager.update(this.negotiatingModalities,this.configProvider.config.negotiationParallelStreamAcquisitionCreateOffer&&!this.initialNegotiationCompleted?2:0,e,n.clone("updateStreams")),this.dataChannel&&this.negotiatingModalities.data&&(i.data=this.negotiatingModalities.data)),n.markAndMeasure("assurePeerConnectionAsync","assureStreamsAndDataChannel"),this.offeredModalities=i,!vc(this.sessionContext)&&this.configProvider.config.webrtcNegotiateDisabledDataModality&&!this.offeredModalities[nu.MODALITY.data]&&this.sessionContext.config?.isConference&&(this.offeredModalities[nu.MODALITY.data]=nu.MEDIA_STATE.inactive),this.audioCodecManager.prepareForNegotiation(this.initiatorInternal),this.logger.safe.info(`[${e}] create [offer] offered: ${JSON.stringify(this.offeredModalities)}`);let s=await this.callbacks.createOffer();n.markAndMeasure("assureStreamsAndDataChannel","createOffer"),this.logger.unsafe.info(`[${e}] create [offer] offer from peer connection, sdp: ${s.sdp}`);let a=this.sessionDescription.createLocalOffer(s.sdp);this.hasIceCandidates(a)||this.resetCandidateGathering(e),this.callbacks.startWaitingForStreamStart(i),this.setupIceGatheringTimeout(e);let o=a.toLocal();this.logger.unsafe.info(`[${e}] create [offer] set local description`,"sdp:",o),await this.callbacks.setLocalDescription({sdp:o,type:"offer"}),n.markAndMeasure("createOffer","sLD"),await this.iceCandidatesDeferred.promise,n.markAndMeasure("sLD","candidates");let l=this.sessionDescription.createLocalOffer(this.callbacks.getLocalDescription().sdp);this.fixLocalDescription(l),l.updateModalities(this.offeredModalities),this.checkIceCandidates(l);let c=l.toOffer();this.logger.unsafe.info(`[${e}] CREATE OFFER`,"sdp:",c);let d={blob:c,contentType:this.mediaContentType};""===this.configProvider.mediaConfig.webrtcRequiredFeatures||this.sessionContext.config.isConference||(d.requiredFeatures=this.configProvider.mediaConfig.webrtcRequiredFeatures),this.audioCodecManager.decoder?.setRecvPayloads(l.getPayloadsForMedia(nu.MEDIA_TYPE.audio)),this.configProvider.countryCode&&(d.clientLocation=this.configProvider.countryCode),this.mediaManager.getMediaEntities().forEach(e=>{e.setExtension("midApplied",!0)});let u=a.isIceRestart();return this.logger.safe.info(`[${e}] ICE restart: ${u}`),this.configProvider.mediaConfig.isTransportUnbundled&&this.offeredDescription?.isMSRTC()&&u&&!this.sessionContext.config.isConference&&a.getSrtpInfo().sdes&&(d.newOffer=!0),this.reinvitelessContext.enabled&&(this.mediaManager.updateMediaEntitiesWithLocalTracks(),d.mediaDescriptions=this.getMediaDescriptions(this.offeredModalities)),t&&(d.negotiationTag=t),this.callbacks.setBWSeed(d),n.markAndMeasure("start","createOfferAsync"),d}async processOfferAsync(e,t){let i=this.diagnostics.getTimerTracker("processOfferAsync",{first:!0});i.mark("start"),this.mediaManager.backup();let n=e.blob;if(this.logger.unsafe.info(`[${t}] process [offer]`,"sdp:",n),this.configProvider.config.webrtcCompareContentTypeInOffer&&nO(e.contentType,this.allowedMediaContentType),this.configureBroadcastScenario(e,t),this.offerOriginator&&this.offerOriginator!==e.originator&&this.configProvider.config.rejectIncompatibleOriginator)throw{detail:"mediaContent.originator is different on renegotiation",type:nu.MEDIA_ERROR.incompatibleOriginator};if(this.offerOriginator=e.originator,e.requiredFeatures){let t=this.configProvider.mediaConfig.webrtcRejectedFeatures.split(",");nk(e.requiredFeatures.split(","),t)}this.initiatorInternal=!1,this.offeredDescription=this.sessionDescription.createRemoteOffer(n),this.extractMultiStreamValues(n,t),this.canTriggerRenegotiation=!1,this.offeredModalities=mK(this.offeredDescription.getModalities()),this.callbacks.hasPC()||(this.configProvider.mediaConfig.isTransportUnbundled?this.configProvider.mediaConfig.isTransportUnbundled=this.offeredDescription.couldBeUnbundled():this.configProvider.mediaConfig.isTransportUnbundled=this.offeredDescription.isUnbundled());let r=this.configProvider.config.removeUnsupportedVideoModality?this.offeredModalities:nI(this.offeredModalities);if(mY(this.offeredModalities.video)||mZ(this.offeredModalities.video)||mY(this.offeredModalities.sharing)||mZ(this.offeredModalities.sharing)){let e=this.offeredDescription.getVideoCodecs();try{if(!this.configProvider.config.skipNegotiationCapabilitiesCheck){i.mark("startGetCapabilities");let n=await this.capabilityGatherer.getCapabilities("video");i.markAndMeasure("startGetCapabilities","getCapabilities"),n.codecs.some(t=>e.some(e=>t.mimeType===e&&this.configProvider.config.primaryVideoCodecs.includes(e)))||(this.logger.safe.warn(`[${t}] offer doesn't contain any supported video codecs`),this.disabledModalities.video=r.video,this.disabledModalities.sharing=r.sharing,delete r.video,delete r.sharing)}}catch(e){this.logger.safe.error(`[${t}] failed to get video capability ${t$(e)}`)}}return(!vc(this.sessionContext)&&(mY(this.offeredModalities.data)||mZ(this.offeredModalities.data))||this.configProvider.config.ignoreNonSctpDataChannelInOffer&&!this.offeredDescription?.isSctpDataChannel()||this.dataChannel?.state==="Failed")&&(this.logger.safe.info(`[${t}] Supressing data modality as data channel is not possible`),this.configProvider.config.ignoreNonSctpDataChannelInOffer&&!this.offeredDescription?.isSctpDataChannel()&&(this.diagnostics.ignoredNonSctpDataChannel=!0),r=nI(r),delete r.data),i.markAndMeasure("start","processOfferAsync"),this.logger.safe.info(`[${t}] process [offer] offered: ${JSON.stringify(this.offeredModalities)} acceptable: ${JSON.stringify(r)}`),r}async startMediaDescriptionsUpdate(e,t){this.dataChannel?.updateDataModalityState(this.reinvitelessRequestedModalities?.data);let i=m0(this.negotiatedModalities),n=m0(this.reinvitelessRequestedModalities);return i!==n&&await this.streamSendersManager.setHold(n,e),n?this.reinvitelessAppliedModalities=this.reinvitelessRequestedModalities:(this.reinvitelessAppliedModalities=await this.streamSendersManager.update(this.reinvitelessRequestedModalities,0,e),this.dataChannel&&this.reinvitelessRequestedModalities.data&&(this.reinvitelessAppliedModalities.data=this.reinvitelessRequestedModalities.data)),this.callbacks.updateLocalMediaSources(),await this.streamSendersManager.activate(e),this.getMediaDescriptions(this.reinvitelessAppliedModalities,t)}async completeMediaDescriptionsUpdate(e){this.logger.safe.info(`[${e}] complete media descriptions update`),this.negotiatedModalities=this.reinvitelessAppliedModalities;let t=this.reinvitelessAppliedModalities,i=this.reinvitelessRequestedModalities;return this.reinvitelessAppliedModalities={},this.reinvitelessRequestedModalities={},{appliedModalities:t,requestedModalities:i}}async rejectMediaDescriptionsUpdate(e,t=!1){this.logger.safe.info(`[${e}] reject media descriptions update`),t&&(this.logger.safe.info(`[${e}] trigger renegotiation after failed media descriptions update`),this.triggerRenegotiation(!1,e));let i=await this.streamSendersManager.update(this.negotiatedModalities,1,e),n=this.reinvitelessRequestedModalities;return this.reinvitelessAppliedModalities={},this.reinvitelessRequestedModalities={},{appliedModalities:i,requestedModalities:n}}getMediaDescriptions(e,t){if(m0(e))return{};let i=[];for(let t of this.mediaManager.getMediaEntities()){if(!t.getExtension("reinviteless"))continue;let n=e[t.getModality()],r={mid:t.getMid(),direction:!t.getLocalTrackId()&&mY(n)?mQ(n):n,subStreamIndex:t.getSubstreamIndex()};i.push(r)}return{descriptions:i,negotiationTag:t}}updateSendStreamsReinviteless(e,t){if(nE(this.negotiatedModalities)||m0(this.negotiatedModalities)||m0(this.configuredModalities))return!1;for(let[e,t]of(this.reinvitelessRequestedModalities=nI(this.negotiatedModalities),Object.entries(this.configuredModalities))){let i=this.mediaManager.getMediaEntitiesByModality(e)[0];i?.getExtension("reinviteless")&&(this.reinvitelessRequestedModalities[e]=t)}return!nA(this.reinvitelessRequestedModalities,this.negotiatedModalities)&&(this.callbacks.onUpdateMediaDescriptionsRequired(e,t),nA(this.reinvitelessRequestedModalities,this.configuredModalities))}checkAudioCodecNegotiated(e){let t=this.audioCodecManager.negotiationCompleted();if(this.audioCodecManager.decoder?.getUnmixedAudioProvider()?.configured){let i=t?"Good":"Bad";this.ufdManager.signalEvent("SpatialAudioMUCHUnavailable",i,"Audio",!0,e)}}fixLocalDescription(e){this.configProvider.config.insertFakeCandidateIfNeeded&&(this.iceCandidateReceivedInternal||!this.iceCandidateReceivedInternal&&this.transportStateProvider.isIceConnected)&&(this.diagnostics.fakeCandidate=e.insertFakeCandidateIfNeeded()),e.fixDataModality()}applyReceiveCapabilities(e){let t=this.mediaManager.getMediaEntities().map(e=>e.getRemoteRecvCapabilities());this.sessionContext.config?.isConference?this.qualityManager.setPendingCapabilities():this.qualityManager.setMaxCapabilities(t,e)}resetNegotiationQueue(e){this.negotiationCompletedDefer.reject("promise expired"),this.setNegotiationPromise(new iE,e)}setNegotiationPromise(e,t=e9()){this.terminated||(this.negotiationCompletedDefer=e,this.negotiationQueue.add(this.negotiationCompletedDefer,t))}hasIceCandidates(e){return this.configProvider.mediaConfig.isTransportUnbundled?e.hasUnbundledIceCandidates():e.hasIceCandidates()}checkIceCandidates(e){let t=this.hasIceCandidates(e);if(t===this.noIceCandidates&&(this.noIceCandidates=!this.noIceCandidates,this.ufdManager.signalEvent("NoNetwork",this.noIceCandidates?"Bad":"Good"),this.noIceCandidates))throw{type:nu.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};if(t){let t=this.hasRelayIceCandidates(e);if(t===this.noRelayIceCandidates){if(!t&&this.transportStateProvider.isIceConnected)return;this.noRelayIceCandidates=!this.noRelayIceCandidates,this.ufdManager.signalEvent("NetworkRelaysNotReachable",this.noRelayIceCandidates?"Bad":"Good")}}}hasRelayIceCandidates(e){return this.configProvider.mediaConfig.isTransportUnbundled?e.hasUnbundledRelayIceCandidates():e.hasRelayIceCandidates()}setupIceGatheringTimeout(e){this.iceRelayCandidatesGatherStartTime=Date.now();let t=this.sessionContext.config.webrtcIceGatheringTimeoutIncreased?this.configProvider.config.relayWaitSaneTimeoutMs:this.configProvider.config.webrtcIceGatheringTimeoutMs;if(!t)return;this.iceCandidatesTimer&&clearTimeout(this.iceCandidatesTimer);let i=this.iceCandidatesDeferred;this.iceCandidatesTimer=window.setTimeout(()=>{this.iceCandidatesTimer=void 0,i.isPending&&(this.logger.safe.warn(`[${e}] ICE candidates gathering terminated due to timeout ${t}`),i.resolve())},t)}resetCandidateGathering(e){this.logger.safe.info(`[${e}] reset candidate gathering`),this.iceCandidatesDeferred.promise.then(()=>{},()=>{}),this.iceCandidatesDeferred.reject(Error("reset candidate gathering")),this.iceCandidatesDeferred=new iE,this.iceCandidateReceivedInternal=!1}extractMultiStreamValues(e,t){if(this.configProvider.config.multiStreamSupported){let i=LA(e,"a=label:"+Lb(nu.MODALITY.video)),n=this.configProvider.config.numVideoChannelsGvc-this.configProvider.config.nonMultiStreamChannels;this.configProvider.mediaConfig.multiStreamChannelsOffered=i,i<n&&(this.logger.safe.info(`Received ${i} multi stream channels, ${n} channels supported`),this.triggerRenegotiation(!0,t))}this.configProvider.config.multiStreamSupportedVBSS&&(this.configProvider.mediaConfig.vbssMultiStreamChannelsOffered=LA(e,"a=label:"+Lb(nu.MODALITY.sharing)))}set offeredModalities(e){this.offeredModalitiesInternal=e,this.diagnostics.offeredModalities=e}set negotiatedModalities(e){this.logger.safe.info(`setNegotiatedModalities ${JSON.stringify(e)}`),this.negotiatedModalitiesInternal=e,this.diagnostics.negotiatedModalities=e}set configuredModalities(e){this.configuredModalitiesInternal=e}};function HA(e,t=!1){let i=!e.configProvider.config.acceptProvisionalAnswerFromPstnOnly||t;return e.config.isPstnCall?e.configProvider.config.acceptProvisionalAnswerPstn&&i:e.configProvider.config.acceptProvisionalAnswer}var HM=class{constructor(e){this.mcpConfig=e,this.data={sourceRequestsSignaling:{},sourceRequestsMCP:{},fallbackMCPMessagesCounter:0,sourceRequestsResponses:{},errors:[],delayedSRsCounter:0,timedOutSRsCounter:0,sendSRsErrorCounter:0,ignoredSRsCounter:0,delayDurations:[]}}setRecord(e,t,i){let n={sequenceNumber:t,timestamp:Date.now(),sourceId:i?.sourceId,fmtp:i?.fmtParams};e.records??(e.records=[]),tq(e.records,n,this.mcpConfig.storedSRRecordsCount)}recordSignalingOperation(e,t){var i;(i=this.data.sourceRequestsSignaling)[e]??(i[e]={counter:0}),this.data.sourceRequestsSignaling[e].counter++}recordMCPOperation(e,t,i){var n;(n=this.data.sourceRequestsMCP)[e]??(n[e]={counter:0}),this.data.sourceRequestsMCP[e].counter++,this.mcpConfig.verboseTelemetry&&this.setRecord(this.data.sourceRequestsMCP[e],t,i)}recordError(e,t){let i=[Date.now(),t,e];tq(this.data.errors,i,this.mcpConfig.storedSRRecordsCount)}recordSignalingOperationDuration(e,t){let i=this.data.sourceRequestsSignaling[e]?.records?.find(e=>e.sequenceNumber===t);i&&(i.duration=Date.now()-i.timestamp)}recordMCPMessageFallback(e,t){if(this.data.fallbackMCPMessagesCounter++,this.mcpConfig.verboseTelemetry){let i=this.data.sourceRequestsMCP[t]?.records?.find(t=>t.sequenceNumber===e);i&&(i.fallback=!0,i.fallbackTimestamp=Date.now())}}recordSrResultReceived(e,t,i){var n;if(this.mcpConfig.verboseTelemetry){let n=this.data.sourceRequestsMCP[i]?.records?.find(e=>e.sequenceNumber===t);n&&(n.duration=Date.now()-n.timestamp,n.result=e)}(n=this.data.sourceRequestsResponses)[e]??(n[e]=0),this.data.sourceRequestsResponses[e]++}recordDelayedSR(){this.data.delayedSRsCounter++}recordTimedOutSR(){this.data.timedOutSRsCounter++}recordSendSrError(){this.data.sendSRsErrorCounter++}recordIgnoredSR(){this.data.ignoredSRsCounter++}recordSRDelayDuration(e,t){let i={sequenceNumber:e,delayDuration:t};tq(this.data.delayDurations,i,this.mcpConfig.storedSRRecordsCount)}getObjectRef(){return this.data}},HD=5,HO=class{constructor(e){this.mcpConfig=e,this.storage={createTime:Date.now(),startedCount:0,stoppedCount:0,clientCapabilities:[],events:[]},this.sourceRequestSenderDiagnostics=new HM(this.mcpConfig)}get getSourceRequestSenderDiagnostics(){return this.sourceRequestSenderDiagnostics}logStarted(){if(this.storage.startedCount++,this.storage.startedCount>HD)return;let e={startedTs:Hk(this.storage.createTime),mpCapabilities:{},sentMessages:{},recvMessages:{},sentFailed:0,recvFailed:0,cachedDshReceived:!1};this.storage.events.push(e),this.lastEventConnecting=!0}logStopped(){this.storage.stoppedCount++;let e=this.getCurrentDCSessionEvent();e&&(e.stoppedTs=Hk(this.storage.createTime)),this.lastEventConnecting=!1}logSentMsg(e){var t,i;let n=this.getCurrentDCSessionEvent();n&&((t=n.sentMessages)[i=e.type]??(t[i]=0),n.sentMessages[e.type]++)}logReceivedMsg(e){var t,i;this.lastEventConnecting=!1;let n=this.getCurrentDCSessionEvent();n&&((t=n.recvMessages)[i=e.type]??(t[i]=0),n.recvMessages[e.type]++,"dsh"!==e.type||n.handshakeDuration||(n.cachedDshReceived=!0))}logHandshakeStarted(e){let t=this.getCurrentDCSessionEvent();t&&(t.handshakeStartedTs=Date.now()),this.storage.clientCapabilities=e}logHandshakeCompleted(e){let t=this.getCurrentDCSessionEvent();t&&(t.handshakeDuration||(t.handshakeDuration=Hk(t.handshakeStartedTs)),t.mpCapabilities.send=e.send_capabilities,t.mpCapabilities.recv=e.receive_capabilities)}logHandshakeFailed(e){let t=this.getCurrentDCSessionEvent();t&&(t.handshakeDuration=Hk(t.handshakeStartedTs),t.handshakeFailedWithError=e)}logSentFailed(e){let t=this.getCurrentDCSessionEvent();t&&(t.sentFailed++,t.lastSentFailed={ts:Hk(this.storage.createTime),error:e})}logRecvFailed(e){let t=this.getCurrentDCSessionEvent();t&&(t.recvFailed++,t.lastRecvFailed={ts:Hk(this.storage.createTime),error:e})}logTimeout(){if(this.storage.startedCount>=HD&&!this.lastEventConnecting)return;let e={timeoutTs:Date.now()},t=this.getCurrentDCSessionEvent();t&&(e.handshakeStartedTs=t.handshakeStartedTs),this.lastEventConnecting&&this.storage.events.pop(),this.storage.events.push(e),this.lastEventConnecting=!1}getReport(){let e=this.sourceRequestSenderDiagnostics.getObjectRef();return this.storage.sourceRequestsReport=e,this.storage}getCurrentDCSessionEvent(){let e=this.storage.events[this.storage.events.length-1];return this.storage.startedCount<=HD&&e?.startedTs!==void 0?e:null}};function Hk(e){return Date.now()-e}var HN=0xfffffffc,Hx=class extends tZ{constructor(e,t,i){super(),this.dataChannel=e,this.logger=t,this.mcpConfig=i,this.mcpState="Created",this.handshakeTimeout=null,this.telemetryLogger=new HO(this.mcpConfig),this.mcpSupportedFeatures={sourceRequestsEnabled:!1,sourceRequestsResponseEnabled:!1,dominantSpeakerHistoryEnabled:this.mcpConfig?.enableDominantSpeakerHistory,senderSideBandwidthEstimationEnabled:!1,sendLeaveDataEnabled:!1},this.subscribeToDataChannel()}getTelemetryLogger(){return this.telemetryLogger}mcpFeaturesSupported(e){return this.mcpSupportedFeatures[e]}switchMcpFeature(e,t){this.logger.warn(`Switching ${e} to ${t}`),this.mcpSupportedFeatures[e]=t}getConfig(){return this.mcpConfig??{}}getMcpState(){return this.mcpState}dispose(){super.dispose(),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=null,this.mcpState="Inactive",this.switchMcpFeature("sourceRequestsEnabled",!1),this.switchMcpFeature("sourceRequestsResponseEnabled",!1)}getTelemetryReport(){return this.logger.debug(`Telemetry ${JSON.stringify(this.telemetryLogger.getReport())}`),this.telemetryLogger.getReport()}async sendMsg(e){if(Array.isArray(e)||"leave"!==e.type||this.mcpConfig.enableLeaveData)return this.sendMsgInternal(e)}async onDCStarted(){if(this.mcpConfig.skipMcpHandshakeIfDcAlreadyConnected&&("Handshaking"===this.mcpState||"Active"===this.mcpState))return void this.logger.safe.info("Skipping handshake: MCP is already in handshaking or active state");this.logger.safe.info("Data channel is started, starting handshake"),this.telemetryLogger.logStarted(),await this.startHandshake()}async onDCStopped(){this.logger.safe.info("Data channel handler is stopped"),this.telemetryLogger.logStopped(),this.mcpState="Inactive"}subscribeToDataChannel(){this.dataChannel.on("onStateChanged",()=>this.onDataChannelStateChanged()),this.dataChannel.on("onmessage",(e,t,i)=>this.processIncomingData(e,i))}onDataChannelStateChanged(){switch(this.dataChannel.state){case"Connected":this.onDCStarted();break;case"Closed":case"Destroyed":this.onDCStopped()}}async startHandshake(){try{this.mcpState="Handshaking",this.event("mcpHandshakeStarted").raise();let e=[];this.mcpConfig.enableDominantSpeakerHistory&&e.push("dsh"),this.mcpConfig.enableBweNotifications&&e.push("bwe"),this.mcpConfig.enableSourceRequests&&e.push("sr"),this.mcpConfig.enableSendBandwidthNotificationsEnabled&&e.push("ssbwe"),this.mcpConfig.enableLeaveData&&e.push("leave"),this.telemetryLogger.logHandshakeStarted(e),this.logger.safe.info(`Send syn, client capabilities: ${JSON.stringify(e)}`),await this.sendMsgInternal({type:"syn",client_capabilities:e}),this.handshakeTimeout=window.setTimeout(()=>{this.handshakeTimeout=null,this.telemetryLogger.logTimeout(),this.mcpState="TimedOut",this.logger.safe.warn(`Timeout after ${this.mcpConfig.handshakeTimeout}ms, raising onHandshakeTimeout`),this.event("onHandshakeTimeout").raise()},this.mcpConfig.handshakeTimeout)}catch(e){this.logger.error(`Handshake failed with: ${t$(e)}`),this.telemetryLogger.logHandshakeFailed(t$(e))}}async sendMsgInternal(e){let t=Array.isArray(e)?e:[e],i=new TextEncoder().encode(JSON.stringify(t)),n=new Uint8Array(1+i.length);n[0]=1,n.set(i,1);try{for(let e of(await this.dataChannel.sendMessage(18,void 0,n,[HN]),t))this.telemetryLogger.logSentMsg(e)}catch(e){throw this.logger.safe.error(`Send failed: ${t$(e)}`),this.telemetryLogger.logSentFailed(t$(e)),e}}processIncomingData(e,t){let i;if(18!==e)return;if(1!==t[0]){let e=`Unsupported header version ${t[0]}`;this.logger.safe.info(e),this.telemetryLogger.logRecvFailed(e);return}let n=new DataView(t.buffer,1);try{let e=new TextDecoder().decode(n);i=JSON.parse(e)}catch(e){this.logger.error(`Failed to parse received data, error ${t$(e)}`),this.telemetryLogger.logRecvFailed(t$(e));return}for(let e of i)switch(this.telemetryLogger.logReceivedMsg(e),e.type){case"syn":break;case"ack":this.processAckMsg(e);break;case"bwe":this.processBweMsg(e);break;case"dsh":this.processDshMsg(e);break;case"sr_res":this.processSrResMsg(e);break;default:{let t=`Unsupported msg type ${e.type}`;this.logger.error(t),this.telemetryLogger.logRecvFailed(t)}}}processDshMsg(e){this.mcpConfig.enableDominantSpeakerHistory&&(this.logger.debug(`DSH received: ${JSON.stringify(e)}`),this.event("mpDshChanged").raise(e.history))}processSrResMsg(e){this.event("mpSrResReceived").raise(e.sequenceNumber,e.result),this.mcpState="Active"}processBweMsg(e){this.mcpConfig.enableBweNotifications&&(this.mcpConfig.extendBweMessage?this.event("mpSendBandwidthChanged").raise(e.bw,e.video_bw):this.event("mpSendBandwidthChanged").raise(e.bw))}processAckMsg(e){this.telemetryLogger.logHandshakeCompleted(e),this.logger.safe.info(`Ack received: ${JSON.stringify(e)}`),this.switchMcpFeature("dominantSpeakerHistoryEnabled",!!(this.mcpConfig.enableDominantSpeakerHistory&&e.send_capabilities?.includes("dsh"))),this.switchMcpFeature("sourceRequestsEnabled",!!(this.mcpConfig.enableSourceRequests&&e.receive_capabilities?.includes("sr"))),this.switchMcpFeature("sourceRequestsResponseEnabled",!!(this.mcpConfig.enableSourceRequestResponse&&e.send_capabilities?.includes("sr_res"))),this.switchMcpFeature("senderSideBandwidthEstimationEnabled",!!(this.mcpConfig.enableSendBandwidthNotificationsEnabled&&e.receive_capabilities?.includes("ssbwe"))),this.switchMcpFeature("sendLeaveDataEnabled",!!(this.mcpConfig.enableLeaveData&&e.receive_capabilities?.includes("leave"))),this.logger.safe.info(`Mcp handshake completed:
            Dominant speaker history: ${this.mcpSupportedFeatures.dominantSpeakerHistoryEnabled},
            Source requests: ${this.mcpSupportedFeatures.sourceRequestsEnabled},
            Source requests response: ${this.mcpSupportedFeatures.sourceRequestsResponseEnabled},
            Bandwidth estimation response: ${this.mcpSupportedFeatures.senderSideBandwidthEstimationEnabled},
            Leave data: ${this.mcpSupportedFeatures.sendLeaveDataEnabled}`),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=null,this.mcpState="Active",this.event("mcpHandshakeCompleted").raise()}},HL=class{constructor(e,t,i){this.mediaControlPlane=e,this.sendSignalingMessage=t,this.logger=i,this.pendingSourceRequests=new Map,this.mediaControlPlane&&(this.diagnostics=this.mediaControlPlane.getTelemetryLogger().getSourceRequestSenderDiagnostics,this.mcpConfig=this.mediaControlPlane?.getConfig(),this.mediaControlPlane.on("mpSrResReceived",(e,t)=>this.onMsgReceived(e,t)),this.mediaControlPlane?.on("mcpHandshakeCompleted",()=>this.onMcpHandshakeCompleted()),this.mediaControlPlane?.on("onHandshakeTimeout",()=>this.onMcpHandshakeTimeout()),this.mediaControlPlane?.on("mcpHandshakeStarted",()=>this.onMcpHandshakeStarted()))}mapToSignalingOperation(e){switch(e){case"ApplyChannelParametersSourceRequest":case"ApplyChannelParametersVideoCapabilities":return 0;case"ControlVideoStreaming":return 1;default:return this.logger.error("Unknown send operation"),null}}send(e,t,i,n){switch(e){case"ApplyChannelParametersSourceRequest":return this.sendMcpMessage(e,t,i,n);case"ApplyChannelParametersVideoCapabilities":case"ControlVideoStreaming":if(this.sendSignalingMessage)return this.diagnostics?.recordSignalingOperation(e),this.sendSignalingMessage(this.mapToSignalingOperation(e),t);return Promise.reject(Error("no signaling session"));default:return this.logger.warn(`Unable to send message reason: Operation unknown ${e}`),Promise.reject(Error("Unable to send message"))}}setPendingSourceRequest(e,t,i,n,r,s){this.pendingSourceRequests.set(e,{sequenceNumber:e,deferred:t,signalingMessage:n,operation:r,state:i,mcpMessage:s,timestamp:Date.now()})}isAllowedToSendMcpMessage(){if(!this.mediaControlPlane)return!1;let e=this.mediaControlPlane.getMcpState();return"Created"!==e&&("Handshaking"===e?this.mcpConfig?.sendBeforeAck&&this.mcpConfig?.enableSourceRequests:"Active"===e&&this.mediaControlPlane.mcpFeaturesSupported("sourceRequestsEnabled"))}isAllowedToDelay(){let e=this.mediaControlPlane?.getMcpState();return("Created"===e||"Handshaking"===e)&&this.mcpConfig?.enableSourceRequests&&this.mcpConfig?.signalingDeprecation.enableSourceRequestQueueing}async sendMcpMessage(e,t,i,n){if(this.isAllowedToSendMcpMessage()){let r=new iE;"Handshaking"===this.mediaControlPlane.getMcpState()?this.setPendingSourceRequest(i,r,1,n,e):this.setPendingSourceRequest(i,r,2);try{if(this.diagnostics.recordMCPOperation(e,i,t.controlVideoStreaming?.controlInfo),await this.mediaControlPlane.sendMsg(t),this.logger.safe.info(`Sending ${t.type} by MCP sequenceNumber:${i}`),!this.mcpConfig?.enableSourceRequestResponse||!this.mediaControlPlane.mcpFeaturesSupported("sourceRequestsResponseEnabled"))return this.clearPendingSourceRequest(i),Promise.resolve();return r.promise}catch(t){let e=t$(t);this.diagnostics.recordError(e,i),this.diagnostics.recordSendSrError(),this.logger.safe.error(`sendMsgInternal failed with error: ${e}`),this.clearPendingSourceRequest(i)}}else if(this.isAllowedToDelay()){let r=new iE;return this.setPendingSourceRequest(i,r,0,n,e,t),this.logger.safe.info(`Queueuing ${t.type} with sequence number:${i} until MCP handshake is completed`),this.diagnostics?.recordDelayedSR(),r.promise}return this.sendSignalingMessage?this.mcpConfig?.signalingDeprecation.disableFallbackToSignaling?(this.diagnostics?.recordIgnoredSR(),Promise.reject(Error("Fallback to signaling channel is disabled"))):(this.diagnostics?.recordSignalingOperation(e),this.logger.safe.info(`Sending SR by signaling sequenceNumber:${i}`),this.sendSignalingMessage(this.mapToSignalingOperation(e),n)):(this.diagnostics?.recordIgnoredSR(),Promise.reject(Error("no signaling session")))}async resendPendingMessageThroughSignaling(e,t){this.diagnostics.recordMCPMessageFallback(e,t);let i=this.pendingSourceRequests.get(e);try{this.diagnostics.recordSignalingOperation(i.operation),await this.sendSignalingMessage(this.mapToSignalingOperation(i.operation),i.signalingMessage),i.deferred.resolve()}catch{this.logger.warn(`Failed to resend source request via signaling ${e}`),i.deferred.reject(Error("Sending source request failed via signaling"))}finally{this.clearPendingSourceRequest(e)}}clearPendingSourceRequest(e){this.pendingSourceRequests.get(e)&&this.pendingSourceRequests.delete(e)}onMsgReceived(e,t){if(this.logger.safe.info(`Received SR result: ${t} for sequenceNumber: ${e}`),this.diagnostics.recordSrResultReceived(t,e,"ApplyChannelParametersSourceRequest"),!this.mcpConfig?.enableSourceRequestResponse||!this.mediaControlPlane.mcpFeaturesSupported("sourceRequestsResponseEnabled"))return void this.logger.safe.info(`Source request response not supported, ignoring result for sequenceNumber: ${e}`);let i=this.pendingSourceRequests.get(e);if(!i)return void this.logger.warn(`No pending SR found for sequenceNumber: ${e}`);switch(t){case"ok":case"duplicate":case"out_of_order":i.deferred.resolve();break;default:i.deferred.reject(`SequenceNumber: ${e} failed with ${t}!`)}this.clearPendingSourceRequest(e)}processPendingSourceRequests(e){let t=Array.from(this.pendingSourceRequests.entries());if(0===t.length)return;let i=this.mcpConfig?.signalingDeprecation.disableFallbackToSignaling,n=this.mcpConfig?.signalingDeprecation.ignoreHandshakeTimeout;for(let[r,s]of t){if(e&&this.diagnostics?.recordTimedOutSR(),!i){this.resendPendingMessageThroughSignaling(r,s.operation);continue}e&&n||(s.deferred.reject(`SR with sequence number: ${r} has failed`),this.diagnostics?.recordIgnoredSR(),this.clearPendingSourceRequest(r))}}onMcpHandshakeCompleted(){if(this.logger.safe.info("MCP handshake is completed"),!this.mediaControlPlane.mcpFeaturesSupported("sourceRequestsEnabled")){this.logger.safe.error("Source requests not supported in MCP"),this.processPendingSourceRequests(!1);return}let e=Array.from(this.pendingSourceRequests.entries()).filter(([e,t])=>0===t.state);if(0===e.length)return void this.logger.safe.info("No pending source requests to process");for(let[t,i]of(this.logger.safe.info("Send all the pending source requests in WaitingForHandshake state"),e)){let e=Date.now()-i.timestamp;this.diagnostics?.recordSRDelayDuration(t,e),this.clearPendingSourceRequest(t),this.sendMcpMessage(i.operation,i.mcpMessage,t).then(()=>{i.deferred.resolve()}).catch(()=>{i.deferred.reject(`SR with sequence number: ${t} has failed`)})}}onMcpHandshakeTimeout(){this.logger.safe.info("MCP handshake timed out"),this.processPendingSourceRequests(!0)}onMcpHandshakeStarted(){if(this.logger.safe.info("MCP handshake started"),!this.mcpConfig?.sendBeforeAck)return void this.logger.safe.info("Send before ACK not enabled, skipping pending requests");let e=Array.from(this.pendingSourceRequests.entries()).filter(([e,t])=>0===t.state);if(0!==e.length)for(let[t,i]of e){let e=Date.now()-i.timestamp;this.diagnostics?.recordSRDelayDuration(t,e),this.clearPendingSourceRequest(t),this.sendMcpMessage(i.operation,i.mcpMessage,t,i.signalingMessage).then(()=>{i.deferred.resolve()}).catch(()=>{i.deferred.reject(`SR with sequence number: ${t} has failed`)})}}},HF=class{constructor(e,t,i,n,r){this.logger=e,this.qualityManager=t,this.diagnostics=i,this.configProvider=n,this.statsGatherer=r,this.previousSequenceNumber=new Map}dispose(){this.cleanupDevToolsInjector(),this.logger=this.logger.createChild("DISPOSED")}handleMessage(e){let t=e.controlInfo[0].sourceId;if(this.previousSequenceNumber.has(t)&&e.sequenceNumber<this.previousSequenceNumber.get(t))return this.statsGatherer.addVideoControlMessage(!0),this.diagnostics?.addVideoControlMessage(!0),this.logger.safe.info(`Discarded old media stream control message for sourceId ${t}: (${JSON.stringify(e)})`),Promise.resolve();this.previousSequenceNumber.set(t,e.sequenceNumber),this.statsGatherer.addVideoControlMessage(),this.diagnostics?.addVideoControlMessage(),this.configProvider.config.enableDevtoolsAPI&&this.injectFmtpHandler(e);let i={controlVideoStreaming:e};return this.configureResolution(i),Promise.resolve()}configureResolution(e){this.logger.safe.info(`Signaling FMTP: ${JSON.stringify(e.controlVideoStreaming)}`);let t=String(e.controlVideoStreaming.sequenceNumber),i=e.controlVideoStreaming.controlInfo[0].fmtParamsList,n=e.controlVideoStreaming.controlInfo[0].fmtParams,r=i&&this.configProvider.config.webrtcFmtParamListSupported?this.parseFmtParamsList(i):[this.parseFmtParams(n)],s=+e.controlVideoStreaming.controlInfo[0].sourceId,a=[{causeId:t,isSimulcast:r.some(e=>void 0!==e.rid)||r.length>1,capabilities:r,sourceId:s}];this.qualityManager.setMaxCapabilities(a)}parseFmtParamsList(e){return e.map(e=>this.parseFmtParams(e))}parseFmtParams(e){let t=new Ll(e);return{maxFs:+t.get(nu.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+t.get(nu.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:t.get(nu.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*t.get(nu.VIDEO_CAPABILITIES.MAX_BR_PATH),ssrc:+t.get(nu.VIDEO_CAPABILITIES.SSRC_PATH),rid:t.get(nu.VIDEO_CAPABILITIES.RID_PATH),keyframe:this.shouldGenerateKeyFrame(t),vlaDebug:t.get(nu.VIDEO_CAPABILITIES.VLA_DEBUG),ladderType:t.get(nu.VIDEO_CAPABILITIES.LADDER_TYPE)?+t.get(nu.VIDEO_CAPABILITIES.LADDER_TYPE):void 0}}shouldGenerateKeyFrame(e){return e.get(nu.VIDEO_CAPABILITIES.KEYFRAME_PATH)?!!+e.get(nu.VIDEO_CAPABILITIES.KEYFRAME_PATH):this.configProvider.config.webrtcAllowRestoreKeyframe}injectFmtpHandler(e){let t=window;t?.webMA&&(t.webMA.fmtp||(t.webMA.fmtp={handleMessage:this.handleMessage.bind(this)}),t.webMA.fmtp.lastFmtp=e)}cleanupDevToolsInjector(){let e=window;e?.webMA&&delete e.webMA.fmtp}},HU=class e{constructor(e){this.configProvider=e}getVideoControlMessage(t,i,n){let r={controlVideoStreaming:{sequenceNumber:++e.sequence,globalTimeStamp:new Date().toString(),controlInfo:[{control:"start",sourceId:i,streamMsid:t}]}};return n&&(r.controlVideoStreaming.controlInfo[0].fmtParams=Lo(n)),r}getSourceRequestMessage(t,i,n,r){if(!n)throw Error("Failed to construct SourceRequestMessage, missing fmtParams");let s={sourceId:i,streamMsid:t,fmtParams:n};return s.subStreamIndex=r,{type:"sr",controlVideoStreaming:{sequenceNumber:++e.sequence,controlInfo:s}}}getSignalingSourceRequestMessage(t,i,n,r,s){if(!r)throw Error("Failed to construct SourceRequestMessage, missing fmtParams");let a={sourceId:i,streamMsid:t,fmtParams:r};return a.subStreamIndex=s,{applyChannelParameters:{multiChannelParameter:{mids:[n],mediaParameter:JSON.stringify({controlVideoStreaming:{sequenceNumber:++e.sequence,controlInfo:a}})}}}}getBandwidthInfoMessage(e){return{type:"ssbwe",BwMessage:e}}getMaxVideoSendCapabilitiesMessage(t){let{streamMIDs:i,capabilities:n,useMax:r,sendMaxFs:s,sendMaxMbps:a}=t,o=n9(n.maxWidth),l=n9(n.maxHeight);r&&(o=l=Math.max(o,l));let c={[nu.VIDEO_CAPABILITIES.MAX_FPS_PATH]:n.maxFps,[nu.VIDEO_CAPABILITIES.MAX_WIDTH]:o,[nu.VIDEO_CAPABILITIES.MAX_HEIGHT]:l};return s&&(c[nu.VIDEO_CAPABILITIES.MAX_FS_PATH]=n.maxFs),a&&(c[nu.VIDEO_CAPABILITIES.MAX_MBPS_PATH]=n.maxMbps),this.configProvider.config.maxSendVideoCapabilities.enableSequenceNumber&&(c[nu.VIDEO_CAPABILITIES.SEQUENCE_NUMBER]=++e.sequence),{applyChannelParameters:{multiChannelParameter:{mids:i,mediaParameter:JSON.stringify({maxVideoSendCapabilities:{caps:c}})}}}}getMaxVideoSendCapabilitiesContent(t,i,n,r){let s,a,o,l,c={};if(n){let e=n9(n.maxWidth),t=n9(n.maxHeight);this.configProvider.config.maxSendVideoCapabilities.useMaximumWidthHeight&&(e=t=Math.max(e,t)),c[nu.VIDEO_CAPABILITIES.MAX_WIDTH]=e,c[nu.VIDEO_CAPABILITIES.MAX_HEIGHT]=t,c[nu.VIDEO_CAPABILITIES.MAX_FPS_PATH]=n.maxFps,this.configProvider.config.maxSendVideoCapabilities.sendMaxFs&&(c[nu.VIDEO_CAPABILITIES.MAX_FS_PATH]=n.maxFs),this.configProvider.config.maxSendVideoCapabilities.sendMaxMbps&&(c[nu.VIDEO_CAPABILITIES.MAX_MBPS_PATH]=n.maxMbps)}else r&&[nu.VIDEO_CAPABILITIES.MAX_WIDTH,nu.VIDEO_CAPABILITIES.MAX_HEIGHT,nu.VIDEO_CAPABILITIES.MAX_FPS_PATH,nu.VIDEO_CAPABILITIES.MAX_FS_PATH,nu.VIDEO_CAPABILITIES.MAX_MBPS_PATH].forEach(e=>{r[e]&&(c[e]=r[e])});let d=t.getSimulcastContext();if(d&&d.config.layerScaleFactors.length>2&&(s=d.config.layerScaleFactors.length,a=d.config.layerScaleFactors.length,i.hasClientSupport(0)||(a=2),this.configProvider.config.minFrameSizeForThreeStreamSimulcast&&n&&n.maxFs<this.configProvider.config.minFrameSizeForThreeStreamSimulcast&&(a=2)),void 0!==s&&(c[nu.VIDEO_CAPABILITIES.MAX_STREAMS]=s),void 0!==a&&(c[nu.VIDEO_CAPABILITIES.MAX_LAYERS]=a),i.hasClientSupport(3)&&this.configProvider.config.broadcastMode?.prioritizeLayoutOnServer){let e=this.configProvider.config.broadcastMode;e.priorityLayoutMinFS&&e.priorityLayoutMinFPS&&(l=e.priorityLayoutMinFS*e.priorityLayoutMinFPS),e.priorityLayoutMinBitrate&&(o=e.priorityLayoutMinBitrate)}return o&&(c[nu.VIDEO_CAPABILITIES.PRIORITY_LAYOUT_MIN_BITRATE]=o),l&&(c[nu.VIDEO_CAPABILITIES.PRIORITY_LAYOUT_MIN_MBPR]=l),i.hasClientSupport(1)&&this.configProvider.config.preferredHardwareLadderType&&(c[nu.VIDEO_CAPABILITIES.LADDER_TYPE]=this.configProvider.config.preferredHardwareLadderType),this.configProvider.config.maxSendVideoCapabilities.enableSequenceNumber&&(c[nu.VIDEO_CAPABILITIES.SEQUENCE_NUMBER]=++e.sequence),c}getMultiChannelParametersMessage(e,t){return{applyChannelParameters:{multiChannelParameter:{mids:e,mediaParameter:JSON.stringify(t)}}}}};HU.sequence=0;var H$=HU,HV=class{constructor(e,t,i,n){this.logger=e,this.configProvider=t,this.sender=i,this.mediaControlPlane=n,this.messageGenerator=new H$(this.configProvider),this.lastVideoSendMaxCapabilities={}}sendSourceRequest(e,t,i,n,r){if(this.configProvider.config.useApplyChannelParametersForSourceRequests){let s=this.messageGenerator.getSourceRequestMessage(e,t,n,r),a=this.messageGenerator.getSignalingSourceRequestMessage(e,t,i,n,r);return this.sendMessage("ApplyChannelParametersSourceRequest",s,a)}let s=this.messageGenerator.getVideoControlMessage(e,t,n?.[0]);return this.sendMessage("ControlVideoStreaming",s)}sendMaxVideoSendCapabilities(e,t){let i=this.messageGenerator.getMaxVideoSendCapabilitiesMessage({streamMIDs:e,capabilities:t,sendMaxFs:this.configProvider.config.maxSendVideoCapabilities.sendMaxFs,sendMaxMbps:this.configProvider.config.maxSendVideoCapabilities.sendMaxMbps,useMax:this.configProvider.config.maxSendVideoCapabilities.useMaximumWidthHeight});return this.sendMessage("ApplyChannelParametersVideoCapabilities",i)}async sendBandwidthInfo(e){let t=this.messageGenerator.getBandwidthInfoMessage(e);return this.logger.safe.debug(`sending SSBWE message: ${JSON.stringify(t)}`),this.mediaControlPlane?.sendMsg(t)}sendMaxVideoSendCapabilitiesV2(e,t,i){if(void 0===this.lastVideoSendMaxCapabilities[e.getMid()]){if(!i)return this.logger.safe.info("Skip sending empty max-capabilities message"),Promise.resolve();this.lastVideoSendMaxCapabilities[e.getMid()]={}}let n=this.messageGenerator.getMaxVideoSendCapabilitiesContent(e,t,i,this.lastVideoSendMaxCapabilities[e.getMid()]),r=n[nu.VIDEO_CAPABILITIES.SEQUENCE_NUMBER];if(delete n[nu.VIDEO_CAPABILITIES.SEQUENCE_NUMBER],i||!nA(this.lastVideoSendMaxCapabilities[e.getMid()],n)){this.lastVideoSendMaxCapabilities[e.getMid()]={...n},void 0!==r&&(n[nu.VIDEO_CAPABILITIES.SEQUENCE_NUMBER]=r);let t=this.messageGenerator.getMultiChannelParametersMessage([e.getMid()],{maxVideoSendCapabilities:{caps:n}});return this.sendMessage("ApplyChannelParametersVideoCapabilities",t)}return this.logger.safe.info("Skip sending duplicate max-capabilties message"),Promise.resolve()}async sendMessage(e,t,i){let n;return"ApplyChannelParametersSourceRequest"===e&&(n=t.controlVideoStreaming.sequenceNumber),this.logger.safe.info(`sending video control message: ${JSON.stringify(t)}`),this.sender.send(e,t,n,i)}},HB=0,HH=class e{constructor(e,t,i,n){this.context=e,this.callId=t,this.callback=i,this.modalityWatchdog=n,this.callbacks={},this.multiParty=this.context.config?.isConference,this.configProvider=this.context.configProvider,this.logger=this.context.getLogger().createChild(`webrtc2-${++HB}`),this.videoFeatureManager=new Vk(this.logger.createChild("VFM")),this.ufdManager=this.context.getUfdManager(),this.deviceManager=this.context.callDeviceManager.getDefaultDeviceManager(),this.capabilityGatherer=Hd({global:this.context.maContext},this.configProvider.config.useSdpCapabilities,this.configProvider.config.noRequiredCodecsWorkaround),this.reinvitelessContext=Hj(this.context.config.reinvitelessConfig,this.multiParty),this.iceHostCandidateOnly=this.multiParty&&nL("iceHostCandidateOnly",this.context.config,this.configProvider.config),this.mediaManager=new L0({logger:this.logger,configProvider:this.configProvider,numVideoChannels:this.multiParty&&this.configProvider.config.numVideoChannelsGvc||1,useSimulcast:this.multiParty,reinviteltessContext:this.reinvitelessContext}),this.receiveStreamCollection=new $U({streamAdded:e=>this.streamAdded(e),streamRemoved:e=>this.streamRemoved(e)}),this.diagnostics=this.context.diagnostics,this.qmDiagnostics=this.diagnostics.newQualityManagerDiagnostics(),this.statsGatherer=new Hi(this.logger.createChild("stats"),this.configProvider,this.diagnostics,this.mediaManager,this.multiParty,this.modalityWatchdog),this.networkQualityDiagnostics=new Hb(this.configProvider),this.speechDetectionDiagnostics=new HE(this.configProvider),this.qualityManager=new $Q(this.logger.createChild("qm"),{scalingEnabled:this.configProvider.config.webrtcVideoScaling,customBwEstimationEnabled:this.configProvider.config.webrtcEnabledCustomBwEstimationForVideo},this,this.statsGatherer,this.qmDiagnostics,this.configProvider),this.activeSpeakerManager=new $F(this.callback.onContributingSourcesChanged,this.callback.onDominantSpeakerChanged,this.logger.createChild("ActiveSpeakerManager"),this.diagnostics.dshDiagnostics),this.wasConnected=!1,this.isAudioInputMuted=this.context.config.muted,this.isAudioOutputMuted=!1,this.relayCandidateGathered=!1,this.iceDisconnectedTimer=null,this.statisticsReport=Promise.resolve({type:"WebRtcMediaStats",data:{}}),this.terminated=!1,this.dtmfSender=Vt({logger:this.logger,configProvider:this.configProvider}),this.streamsChangedNotificationScheduled=!1,this.subscriptionManager=new x7(this.logger.createChild("subs"),this.configProvider,{getStreams:()=>this.receiveStreamCollection.getStreams(),setOnStreamsChangedHandler:e=>this.streamsChangedListener=e},this.diagnostics.newSubscriptionManagerDiagnostics()),this.remoteVideoResolutionManager=new $Y(this.logger.createChild("rvrm"),this.multiParty,this.configProvider,this.mediaManager,this.statsGatherer,this.diagnostics),this.remoteVideoManager=new $1(this.logger.createChild("RemoteVideoManager"),this.configProvider,this.statsGatherer,this.diagnostics,this.remoteVideoResolutionManager,this.context.maContext.domOverrides),this.encStreamsManager=new vV(this.configProvider,this.context.maContext.getEncodedStreamsWorkerProvider?.(),this.logger.createChild("EncodedStreamsManager")),this.streamSendersManager=new VX(this.mediaManager,this.logger.createChild("SSM"),this.context.callDeviceManager,this.configProvider,this.context.config,this.statsGatherer,this.diagnostics,this.qmDiagnostics,this.multiParty,this.encStreamsManager,this.videoFeatureManager),this.hwSilent=!1,this.deviceManagerSubs=[],this.isMuteHold=!1,this.rawIncomingAudioStreamManager=new fL(this.logger.createChild("rawIncomingAudioStream")),this.useNullAudioStream=!1,this.audioCodecManager=new So(this.encStreamsManager,this.logger,this.configProvider),this.perfMonitorSubs=[],this.performanceMonitor=new Hv(this.statsGatherer,this.diagnostics,this.configProvider,this.logger.createChild("PerformanceMonitor")),this.negotiation=new HR(this.logger.createChild("negotiation"),this.configProvider,this.diagnostics.newNegotiationDiagnostics(this.statsGatherer.sessionInfo),this.reinvitelessContext,this.mediaManager,this.audioCodecManager,this.ufdManager,this.context,this.qualityManager,this.streamSendersManager,{onNegotiationRequired:(e,t)=>this.callbacks.onNegotiationRequired?.(e,t),onUpdateMediaDescriptionsRequired:(e,t)=>this.callbacks.onUpdateMediaDescriptionsRequired?.(e,t),updateLocalMediaSources:this.updateLocalMediaSources.bind(this),assurePC:this.assurePeerConnectionAsync.bind(this),hasPC:()=>!!this.peerConnection,createOffer:e=>this.peerConnection.createOffer(e),createAnswer:e=>this.peerConnection.createAnswer(e),setLocalDescription:e=>this.peerConnection.setLocalDescription(e),getLocalDescription:()=>this.peerConnection.localDescription,setRemoteDescription:e=>this.peerConnection.setRemoteDescription(e),setBWSeed:this.setBWSeed.bind(this),onTransportInitialized:()=>this.callbacks.onTransportInitialized(),startWaitingForStreamStart:e=>{this.statsGatherer.startWaitingForStreamStart(e)},getRollbackModifier:e=>new $V(this.peerConnection,this.configProvider,e)}),this.streamConfigurationHandler=new HF(this.logger,this.qualityManager,this.qmDiagnostics,this.configProvider,this.statsGatherer),this.pauseNegotiations=this.negotiation.pauseNegotiations.bind(this.negotiation),this.configureModalitiesAsync=this.negotiation.configureModalities.bind(this.negotiation),this.createOfferAsync=this.negotiation.createOffer.bind(this.negotiation),this.processOfferAsync=this.negotiation.processOffer.bind(this.negotiation),this.createAnswerAsync=this.negotiation.createAnswer.bind(this.negotiation),this.processAnswerAsync=this.negotiation.processAnswer.bind(this.negotiation),this.completeNegotiationAsync=this.negotiation.completeNegotiation.bind(this.negotiation),this.rejectNegotiationAsync=this.negotiation.rejectNegotiation.bind(this.negotiation),this.startMediaDescriptionsUpdateAsync=this.negotiation.startMediaDescriptionsUpdate.bind(this.negotiation),this.completeMediaDescriptionsUpdateAsync=this.negotiation.completeMediaDescriptionsUpdate.bind(this.negotiation),this.rejectMediaDescriptionsUpdateAsync=this.negotiation.rejectMediaDescriptionsUpdate.bind(this.negotiation),this.statsGatherer.on("onDiagnosticUpdated",e=>this.processStatsReport(e)),this.statsGatherer.on("onStatisticsChanged",e=>this.processLegacyStats(e)),this.remoteVideoResolutionManager.on("onNegotiationRequired",()=>this.negotiation.triggerRenegotiation(!0)),this.remoteVideoResolutionManager.on("onSourceRequestRequired",(e,t,i)=>this.requestSource(e,t,i)),this.setSubsForSubscriptionManager(),this.setSubsForStreamManagerEvents(),this.configProvider.mediaConfig.maxBandwidthInKbps&&(this.statsGatherer.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.diagnostics.maxSessionBandwidth=this.configProvider.mediaConfig.maxBandwidthInKbps),this.createAudioRenderer(),this.setSubsForDeviceManager(),this.context.callDeviceManager.isVirtualDeviceEnabled&&this.setupCallDeviceManagerSubs(),this.configProvider.config.enableActiveSpeakerBasedDSH&&this.activeSpeakerManager.setStrategy(new Hs({configProvider:this.configProvider})),this.perfMonitorSubs.push(this.performanceMonitor.on("onIncomingVideoQualityChanged",(e,t)=>{this.onIncomingVideoQualityChanged(e,t)})),this.configProvider.config.webrtcVideoScaling&&(this.perfMonitorSubs.push(this.performanceMonitor.on("onOptimalVideoCountChanged",(e,t)=>{this.onOptimalVideoCountChanged(e,t)})),this.onOptimalVideoCountChanged(this.configProvider.config.nonEstimatedDefaultVideoReceiversCount)),this.configProvider.config.setBWSeed&&(this.bandwidthCache=new Nh(this.configProvider)),this.diagnostics.reinvitelessContext=this.reinvitelessContext,this.diagnostics.usesMixer=this.context.config.isConference,this.diagnostics.isPstnCall=this.context.config.isPstnCall,this.multiParty&&this.configProvider.config.enableVideoFeatureManager&&this.videoFeatureManager.manageFeatureSupport(()=>{if(this.detectVideoFeatures(),this.configProvider.config.enableDevtoolsAPI){let e=window?.webMA;e?.initVideoFeatures&&e.initVideoFeatures(this.videoFeatureManager)}})}initializeMediaControlPlane(e){let t=this.dataChannel.getDataChannel(e);if(!t)return void this.logger.safe.error(`[${e}] Unable to initialize MediaControlPlane due to datachannel creation failure`);this.mediaControlPlane=new Hx(t,this.logger.createChild("MediaControlPlane"),this.configProvider.config.mediaControlPlaneConfig),this.mediaControlPlane.on("mpSendBandwidthChanged",(e,t)=>{void 0!==t?this.performanceMonitor.processNotification("BandwidthNotification",{bw:t}):this.performanceMonitor.processNotification("BandwidthNotification",{bw:e}),this.bandwidthCache?.saveSeed(e),this.statsGatherer.addReportedReceiveBandwidth(e),this.diagnostics.addReportedReceiveBandwidth(e)}),this.mediaControlPlane.on("mcpHandshakeCompleted",()=>{this.callback.onUpdateSignalingDSHMessageSubscription(!this.mediaControlPlane.mcpFeaturesSupported("dominantSpeakerHistoryEnabled")),this.mediaControlPlane.mcpFeaturesSupported("dominantSpeakerHistoryEnabled")&&this.diagnostics.dshDiagnostics.setCurrentActiveStrategy("server"),this.mediaControlPlane.mcpFeaturesSupported("sourceRequestsEnabled")&&(this.subscriptionManager.mcpSourceRequestsAvailable(),this.notifyStreamsChanged()),this.mediaControlPlane.mcpFeaturesSupported("senderSideBandwidthEstimationEnabled")&&this.configProvider.config.specCompliantSimulcast.enableSimulcastLayoutControlStrategy&&this.videoFeatureManager.get("Video").toggleServer(0,!0)}),this.mediaControlPlane.on("onHandshakeTimeout",()=>{this.configProvider.config.enableSignalingDSHFallback&&this.callback.onUpdateSignalingDSHMessageSubscription(!0)}),this.mediaControlPlane.on("mpDshChanged",e=>{this.activeSpeakerManager.onDominantSpeakerHistoryChanged(e,"server")})}async sendBeaconDataViaDataChannel(e){return this.mediaControlPlane?.sendMsg({type:"leave",...e})}getMediaControlPlaneInstance(){return this.mediaControlPlane}getAcceptedTypes(){return this.negotiation.allowedMediaContentType}clone(t,i){let n=nI(this.context);n.config=nI(this.context.config),n.config.webrtcMediaContentType=this.negotiation.mediaContentType,n.config.webrtcAllowedMediaContentType=this.negotiation.allowedMediaContentType,n.configProvider=i,n.diagnostics=this.context.diagnostics?.newNativeSession(!1),t?(n.config.isConference=!0,n.config.isPstnCall=!1):(n.config.iceHostCandidateOnly=!1,this.configProvider.config.waitForRelayOnReconnect&&(n.config.webrtcIceGatheringTimeoutIncreased=!0));let r=new e(n,this.callId,this.callback,this.modalityWatchdog);return this.useNullAudioStream&&r.useNullAudioStreamClient(),this.relayManagerProvider&&(r.relayManagerProvider=this.relayManagerProvider),r.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,r}async setCallConstraints(e,t){let i=this.configProvider.setCallConstraints(e);if(this.logger.safe.info(`[${t}] Setting call constraints ${JSON.stringify(i)}, enableDynamicCallConstraints: ${this.configProvider.config.enableDynamicCallConstraints}`),this.configProvider.config.enableDynamicCallConstraints)try{await this.streamSendersManager.applyCallConstraints(t),this.configProvider.addCallConstraintsTelemetryEvent(i,"applied")}catch(e){throw this.logger.safe.error(`Error while applying constraints: ${e}`),e}else this.configProvider.addCallConstraintsTelemetryEvent(i,"applied");return i}setInternals(e,t){this.logger.safe.info(`[${t}] Setting internals from previous session`),this.diagnostics.commitNativeSession(),e.subscriptionManager&&(this.subscriptionManager?.dispose(),this.subscriptionManager=e.subscriptionManager,this.subscriptionManager.setDiagnostics(this.diagnostics.newSubscriptionManagerDiagnostics()),this.subscriptionManager.setStreamProvider({getStreams:()=>this.receiveStreamCollection.getStreams(),setOnStreamsChangedHandler:e=>this.streamsChangedListener=e}),this.subscriptionManager.setLogger(this.logger.createChild("subs")),this.setSubsForSubscriptionManager(),this.subscriptionManager.reriseSubscribeEvents(),this.notifyStreamsChanged()),e.audioRenderer&&(e.audioRenderer.play(this.audioRenderer.getStream()),this.audioRenderer=e.audioRenderer),e.remoteVideoManager?.moveRenderers(this.remoteVideoManager),e.rawIncomingAudioStreamManager&&this.rawIncomingAudioStreamManager.updateHandlers(e.rawIncomingAudioStreamManager.handlerMap),this.audioRenderer.getStream()&&this.rawIncomingAudioStreamManager.streamChanged(this.audioRenderer.getStream())}setSubsForDeviceManager(){let e=this.getVideoDeviceManager();this.configProvider.config.enablePlayVideoOnStreamUnmuteWorkaround&&this.deviceManagerSubs.push(e.on("onAudioStreamMuted",t=>{t||(this.remoteVideoManager.playVideo(),e.getLocalVideoRenderers().forEach(e=>e.playVideo()))}))}setSubsForSubscriptionManager(){this.subscriptionManagerSubs=[this.subscriptionManager.on("onTrackIdsChanged",e=>this.statsGatherer.setSubscribedTrackIds(e)),this.subscriptionManager.on("onTrackSsrcChanged",e=>this.statsGatherer.setSubscribedTrackSsrc(e)),this.subscriptionManager.on("onSubscriptionChanged",(e,t,i,n,r,s)=>this.onSubscriptionChanged(e,t,i,n,r,s)),this.subscriptionManager.on("onSubscriptionFailed",(e,t,i,n,r)=>this.statsGatherer.addSubscriptionEvent(e,t,i,n,r))]}onSubscriptionChanged(e,t,i,n,r,s){t===nu.MODALITY.video&&(2===e&&this.diagnostics.addSubscriptionToOvcEvent(this.subscriptionManager.getSubscriptionsCount()),3===e&&this.diagnostics.addSubscriptionToOvcEvent(this.subscriptionManager.getSubscriptionsCount())),this.statsGatherer.addSubscriptionEvent(e,t,i,n,null,r,s)}setSubsForStreamManagerEvents(){this.streamSendersManager.on("onSendStreamChanged",(e,t)=>{this.statsGatherer.updateSendStream(e,t),e?.hasAudio()&&this.diagnostics.setAudioSendStream(e,t),this.diagnostics.setPresentationAudioOnScreenSharing(e,t)}),this.streamSendersManager.on("onVideoCaptureFreeze",e=>{this.transportStateProvider.isConnected&&!this.transportStateProvider.isWaitingAcceptProvisional&&this.ufdManager.signalEvent("VideoCaptureDeviceFreeze",e?"Bad":"Good","Video")}),this.streamSendersManager.on("onMaxVideoSendCapabilitiesChanged",(e,t)=>this.onMaxVideoSendCapabilitiesChanged(e,t)),this.streamSendersManager.on("onBandwidthAllocationChanged",e=>this.onSendBandwidthChanged(e)),this.streamSendersManager.on("onNumberOfStreamsChanged",e=>{this.modalityWatchdog?.updateNumberOfStreams(e)})}move(e,t){this.logger.safe.info(`[${t}] moving to new session`),e.setInternals({subscriptionManager:this.subscriptionManager,audioRenderer:this.audioRenderer,remoteVideoManager:this.remoteVideoManager,rawIncomingAudioStreamManager:this.rawIncomingAudioStreamManager},t),e.muteHold(this.isMuteHold,t),this.isAudioInputMuted?e.muteInputAsync(t):e.unmuteInputAsync(t),this.isAudioOutputMuted?e.muteOutputAsync(t):e.unmuteOutputAsync(t),this.subscriptionManager=null,this.audioRenderer=null,this.rawIncomingAudioStreamManager=null,this.callbacks.onTerminated=null}setMute(e,t,i){this.logger.safe.info(`[${i}] call setMute for ${e} with mute state ${t}`),this.streamSendersManager.setMuted(e,t,i),this.processLegacyStats(this.statsGatherer.getLastStatistics())}getConfiguredModalities(){return this.negotiation.configuredModalities}getDisabledModalities(){return this.negotiation.disabledModalities}createAudioElement(e){this.configProvider.config.devices.setSinkImmediately&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),this.audioRenderer.assureAudioElement(e)}useNullAudioStreamClient(){this.useNullAudioStream=!0,this.streamSendersManager.useNullAudioStreamClient()}createRemoteRenderer(e){return this.remoteVideoManager.createRenderer(e,this.subscriptionManager,this.logger)}getStatsAsync(e){if(this.statsGatherer&&!this.statsGatherer.isDisposed){if(this.audioCodecManager){let e=this.audioCodecManager.getSessionEvents();this.statsGatherer.sessionInfo.setAudioCodecEvents(e),this.diagnostics.audioCodecEvents=e}this.statisticsReport=this.statisticsReport.then(()=>this.statsGatherer.getReport(e)).catch(e=>(this.logger.safe.error(`getting statistics should never fail: ${e.error}`),e.partialReport))}return this.statisticsReport}getLastKnownStats(e){return this.statsGatherer.getReport(!1,e)}muteHold(e,t){for(let i of(this.logger.safe.info(`[${t}] set muteHold state ${e}`),this.isMuteHold=e,[nu.MODALITY.audio,nu.MODALITY.video,nu.MODALITY.sharing].filter(e=>mY(this.negotiation.negotiatedModalities[e])&&(e!==nu.MODALITY.audio||!this.isAudioInputMuted))))this.setMute(vt(i),e,t)}async muteInputAsync(e){this.isAudioInputMuted=!0,this.setMute("Audio",!0,e)}async unmuteInputAsync(e){this.isAudioInputMuted=!1,this.setMute("Audio",!1,e)}async muteOutputAsync(e){return this.isAudioOutputMuted=!0,this.audioCodecManager.decoder?.disableStreamsMixer(!0),this.audioRenderer?.setMuted(!0,e)}async unmuteOutputAsync(e){return this.isAudioOutputMuted=!1,this.audioCodecManager.decoder?.disableStreamsMixer(!1),this.audioRenderer?.setMuted(!1,e)}async getSpeakerVolume(e){return this.audioRenderer?.getSpeakerVolume(e)||0}async setSpeakerVolume(e,t){return this.audioRenderer?.setSpeakerVolume(e,t)}sendDtmf(e){return this.dtmfSender.sendDtmf(this.peerConnection,e)}canSendDtmf(){return this.dtmfSender.canSendDtmf(this.peerConnection)}onDeviceEvent(e){this.statsGatherer.onDeviceEvent(e)}deviceSelectionChanged(){this.peerConnection&&this.audioRenderer?.getStream()&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId())}async terminate(e,t,i=!0){this.logger.safe.info(`[${e}] terminate`),this.statsGatherer.setTerminated(),this.diagnostics.terminate(),this.perfMonitorSubs.forEach(e=>e?.dispose()),this.performanceMonitor.dispose(),this.terminated=!0,this.negotiation.terminate(e),await this.audioCodecManager.decoder?.storeApiRecording(),this.rawIncomingAudioStreamManager?.dispose(),this.remoteVideoManager.dispose(),this.dataChannel&&(this.dataChannel.dispose(),this.dataChannel=null),this.logger.safe.info(`[${e}] reset peer connection`),this.contributingSources?.dispose(),this.activeSpeakerManager.dispose(),this.qualityManager?.dispose(),this.qualityManager=null,this.audioRenderer?.dispose(),this.dtmfSender?.dispose(),this.dtmfSender=null,this.streamSendersManager?.dispose(),this.streamSendersManager=null,this.transceiverManager=null,this.encStreamsManager.dispose(),this.receiveStreamCollection.clear(),this.transportStateProvider?.dispose(),this.transportStateProvider=null,this.audioCodecManager.dispose(),this.mediaManager.reset(),this.mediaControlPlane?.dispose(),this.peerConnection?.close(),this.peerConnection=null,this.negotiation.negotiationEmulator.configure(null),this.peerConnectionPromise=null,this.subscriptionManagerSubs.forEach(e=>e.dispose()),this.subscriptionManager&&this.subscriptionManager.dispose(),this.deviceManagerSubs.forEach(e=>e.dispose()),this.callDeviceManagerSub?.dispose(),this.clearIceDisconnectedTimer(),this.callbacks.onTerminated&&this.callbacks.onTerminated();try{i&&await this.getStatsAsync(!1)}catch(t){this.logger.safe.error(`[${e}] Error while gathering stats ${t$(t)}`)}finally{this.statsGatherer.dispose()}}getIncomingRawAudioStream(e){this.logger.info("IRawStream for incoming audio stream requested");let t=this.audioRenderer.getStream();return this.rawIncomingAudioStreamManager.createIRawStreamClient(t,e)}getUnmixedAudioProvider(){return this.audioCodecManager.decoder?.getUnmixedAudioProvider()}configureSpatialAudio(e,t){if(this.configProvider.mediaConfig.spatialAudioEnabled=e,!this.audioCodecManager.configureSpatialAudio(e,t))return void this.ufdManager.signalEvent("SpatialAudioMUCHUnavailable","Bad","Audio",!0,t)}setParticipantSpatialAudioPositions(e,t){if(!this.audioCodecManager?.decoder||!this.getUnmixedAudioProvider()?.configured)throw this.logger.safe.error(`[${t}] setParticipantSpatialAudioPositions is called while MUCH audio decoder is not created or not enabled`),"setParticipantSpatialAudioPositions not allowed";this.audioCodecManager.decoder?.setParticipantSpatialAudioPositions(e)}processNotification(e,t){if("McpSourceRequestsAvailable"===e&&(this.subscriptionManager.mcpSourceRequestsAvailable(),this.notifyStreamsChanged()),"DominantSpeakerInfo"===e&&this.activeSpeakerManager.onDominantSpeakerHistoryChanged(t.previousDominantSpeakerHistory,"signaling"),"ControlVideoStreaming"===e&&this.streamConfigurationHandler.handleMessage(t),this.performanceMonitor.processNotification(e,t),this.configProvider.config.disableHwEncodingDuringCall)if("ParticipantCountChanged"===e){if(t.count>=this.configProvider.config.disableHwEncodingParticipantLimit){let e=this.configProvider.getVideoSendLadder().getCurrentVideoLadderType();this.videoFeatureManager.get("Video").hasClientSupport(1)&&(2===e||3===e)&&(this.logger.safe.info(`XL call detected. Turning off video HW encoding (${e}) in XL call`),this.turnOffVideoHWEncoding())}}else this.logger.safe.info(`Notification message handler not found for type: ${e}`)}turnOffVideoHWEncoding(){this.configProvider.config.preferredH264VideoSendProfile=void 0,this.negotiation.triggerRenegotiation(!0),this.videoFeatureManager.get("Video").toggleClient(1,!1)}processStatsReport(e){try{!this.diagnostics.timeToFirstAudioPacket&&e.audio?.recv?.[0]?.inboundRTP?.packetsReceived>0&&(this.diagnostics.firstAudioPacketReceived(),this.logger.info(`First audio packet received via getStats: ${this.diagnostics.timeToFirstAudioPacket}`),this.configProvider.config.tuffAudioStateChanged&&this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.active,e9()),this.statsGatherer.resetStatPollingInterval()),this.remoteVideoManager.processStatsReport(e),this.networkQualityDiagnostics.processReport(e);let t=this.networkQualityDiagnostics.getInboundNetworkQuality();this.ufdManager.signalEvent("NetworkRecvQuality",t);let i=this.networkQualityDiagnostics.getOutboundNetworkQuality();for(let t of(this.ufdManager.signalEvent("NetworkSendQuality",this.isAudioInputMuted?"Good":i),this.ufdManager.signalEvent("DeviceSpeakWhileMuted",this.speechDetectionDiagnostics.processReport(e)?"Bad":"Good"),this.streamSendersManager.onDiagnosticUpdated(e),this.getVideoDeviceManager().getLocalVideoRenderers()))t.onDiagnosticUpdated(e)}catch(e){this.logger.error("Failed to processes diagnostics update: "+e)}}processLegacyStats(e){e&&this.hwSilent!==e.audioHwSilent&&(this.hwSilent=e.audioHwSilent,this.callbacks.onAudioHwSilentChanged&&this.callbacks.onAudioHwSilentChanged(this.hwSilent))}assurePeerConnectionAsync(e,t){return this.peerConnectionPromise??(this.peerConnectionPromise=this.getPeerConnectionPromise(e,t)),this.peerConnectionPromise}async getPeerConnectionPromise(e,t){if(!this.relayManagerProvider)throw Error("relay manager provider is not set!");this.logger.safe.info(`[${e}] fetching relay details from RelayManager...`);let i={relayType:"turn",isRemoteClientLync:this.context.config.isRemoteClientLync};t.mark("startQueryRelaysAsync");let n=await this.relayManagerProvider.getRelayManager().queryRelaysAsync(i);if(t.markAndMeasure("startQueryRelaysAsync","queryRelaysAsync"),this.terminated)throw Error("session already disposed");let r={optional:[]},s=$I(n,this.configProvider.config),a=this.negotiation.configureCrypto(r);this.configureCpuThreshold(r),this.logger.safe.info("create peer connection");let o="unified-plan",l=this.context.configProvider.mediaConfig.isTransportUnbundled?"balanced":"max-bundle";try{this.peerConnection=new mk.RTCPeerConnection({iceServers:s,rtcpMuxPolicy:"require",iceTransportPolicy:this.configProvider.getIceTransportPolicy(),iceCandidatePoolSize:this.configProvider.config.iceCandidatePoolSize,bundlePolicy:l,sdpSemantics:o,audioPortRange:this.configProvider.mediaConfig.audioPortRange,videoPortRange:this.configProvider.mediaConfig.videoPortRange,enableDtlsSrtp:1===a,encodedInsertableStreams:!!this.configProvider.config.useInsertableStreams},r)}catch(e){throw e.code===DOMException.INVALID_STATE_ERR&&this.ufdManager.signalEvent("NoNetwork","Bad"),e}let c=this.peerConnection;this.negotiation.rollbackSupported=1===a&&this.context.configProvider.userAgentConfig.isBrowserRollbackSupported,this.negotiation.negotiationEmulator.configure(c),this.statsGatherer.initialize(c),this.statsGatherer.sessionInfo.setIceServers(s),this.statsGatherer.sessionInfo.setIceTransportPolicy(this.configProvider.getIceTransportPolicy()),this.statsGatherer.sessionInfo.setSdpSemantics(o),this.statsGatherer.sessionInfo.setBundlePolicy(l),this.diagnostics.iceServers=s,this.diagnostics.iceTransportPolicy=this.configProvider.getIceTransportPolicy(),this.diagnostics.sdpSemantics=o,this.diagnostics.bundlePolicy=l,await this.checkVideoCodecsSupport(),t.markAndMeasure("queryRelaysAsync","checkVideoCodecsSupport"),c.onnegotiationneeded=()=>{this.logger.safe.info(`onnegotiationneeded signalingState: ${c.signalingState}`)},c.onicecandidateerror=e=>{let t=e,[i,n]=[t.address,t.port];if(this.logger.safe.warn(`On ICE candidate error ${t.url} | ${i}:${n}: code ${t.errorCode}: ${t.errorText}`),!this.transportStateProvider.isConnected||this.negotiation.iceCandidatesDefer.isPending){let e={address:i,port:+n,url:t.url,errorCode:t.errorCode,errorText:t.errorText};this.statsGatherer.addIceCandidateError(e),this.diagnostics.addIceCandidateError(e)}},c.onaddstream=e=>{this.logger.safe.info(`onaddstream stream: ${e.stream.id}`)};let d=(e,t,i,n)=>{this.logger.safe.info(`ontrack processing ${e.kind}: ${t.id}`);let r=t.active;if(!t.active&&this.configProvider.config.useInactiveAudioTrack&&"audio"===e.kind&&(this.logger.safe.warn("ontrack override forcing to use inactive audio stream"),r=!0),!r||n?.currentDirection==="stopped"||n?.stopped)return void this.logger.safe.info("ontrack ignore non active stream");let s=this.mediaManager.getMediaEntityByRemoteStreamId(t.id);if(!s&&(this.logger.safe.info(`cannot find media entity with stream id ${t.id} trying to fallback`),t.getAudioTracks()[0]&&(s=this.mediaManager.getMediaEntitiesByModality(nu.MODALITY.audio)[0])),s){let n=this.createReceiveStream(t,i,e,s);s.setRemoteTrackId(e.id),this.addReceiveStreamTransforms(i,s.getModality()),this.receiveStreamCollection.add(n)}else this.logger.safe.error(`could not find media entity for an added stream: ${t.id}`)};c.ontrack=e=>{let{track:t,receiver:i,transceiver:n}=e,r=e.streams[0]??new MediaStream([t]),s=this.configProvider.config.addAudioStreamBeforeConnection&&nu.TRACK_KIND.audio===t.kind,a=()=>d(t,r,i,n);if(!s&&!this.transportStateProvider.isConnected||this.transportStateProvider.isWaitingAcceptProvisional){this.logger.safe.info(`ontrack queueing to be run once connected ${t.kind}: ${r.id}`),this.transportStateProvider.doOnConnected(a,"ontrack",!1);return}a()},c.onremovestream=e=>{this.logger.safe.info(`onremovestream ${e.stream.id}`),this.transportStateProvider.doOnConnected(()=>this.receiveStreamCollection.remove(e.stream.id),"onremovestream")},c.onicecandidate=t=>{let i=t.candidate;if(i){let t=ve(i.candidate);if(this.logger.safe.info(`[${e}] onicecandidate candidate: component:${t.component} protocol:${t.protocol} prio:${t.priority} type:${t.type} port:${t.port}`),this.logger.unsafe.info(`[${e}] candidate details: ${i.candidate}`),"1"!==t.component)return;if(this.negotiation.iceCandidateReceived=!0,this.statsGatherer.sessionInfo.setCandidateDetails(t),this.diagnostics.setCandidateDetails(t),!this.relayCandidateGathered&&i.candidate.indexOf("typ relay")>-1){let e={priority:i.priority?.toString()||t.priority,time:Date.now()-this.negotiation.iceRelayGatheringStartTime};this.statsGatherer.sessionInfo.setRelayCandidateInfo(e),this.diagnostics.relayCandidateInfo=e,this.relayCandidateGathered=!0}}else this.logger.safe.info(`[${e}] onicecandidate candidate: null`);if(!this.negotiation.iceCandidatesDefer.isPending)return;let n=!this.context.config.webrtcIceGatheringTimeoutIncreased||this.configProvider.config.emptyIceCandidateMarksGatheredAnswerer&&!this.negotiation.initiator,r=this.iceHostCandidateOnly||0===s.length;if(!i&&n||r){i&&this.logger.safe.info(`[${e}] Not waiting for ICE candidates, hoping that host/prflx is enough`),this.logger.safe.info(`[${e}] Is connected:`,this.transportStateProvider.isConnected,this.transportStateProvider.iceConnectionState,this.transportStateProvider.signalingState);let t=!0;this.context.configProvider.mediaConfig.isTransportUnbundled&&i&&(t=this.negotiation.sessionDescription.createLocalOffer(c.localDescription.sdp).hasUnbundledIceCandidates()),t&&this.completeCandidateGathering(e)}else if(this.relayCandidateGathered){let t=!0;this.context.configProvider.mediaConfig.isTransportUnbundled&&(t=this.negotiation.sessionDescription.createLocalOffer(c.localDescription.sdp).hasUnbundledRelayIceCandidates()),t&&(this.statsGatherer.clearIceCandidateErrors(),this.diagnostics.clearIceCandidateErrors(),this.completeCandidateGathering(e))}},c.onicegatheringstatechange=()=>{this.logger.safe.info(`onicegatheringstatechange iceGatheringState: ${c.iceGatheringState}`)},this.transportStateProvider=new V1(c,a,this.logger.createChild("TransportStateProvider"),this.configProvider,this.diagnostics.newTransportStateDiagnostics()),this.transportStateProvider.on("stateChanged",(i,n,r)=>{if(this.terminated)return;let s=this.wasConnected?r:e;if(this.statsGatherer.sessionInfo.setIceConnectionState(i),"connecting"===i&&t.mark("transportConnecting"),"connected"===i||"completed"===i)t.markAndMeasure("transportConnecting","transportConnected"),this.onTransportConnected(s);else if("failed"===i||"closed"===i&&"failed"!==n){if(this.negotiation.iceCandidatesDefer.isPending){this.logger.safe.info(`[${s}] ice failed while gathering candidates, suppressing error`),this.completeCandidateGathering(s);return}this.raiseError({type:nu.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"},s),this.configProvider.config.webrtcCloseAfterIceFailure&&c.close(),this.callbacks.onTransportFailed?.()}"disconnected"===i?(this.callbacks.onTransportDisconnected?.(e),this.startIceDisconnectedTimer(s)):this.clearIceDisconnectedTimer()}),this.transportStateProvider.on("signalingStateChanged",(t,i,n)=>{this.configProvider.config.reconnectOnPcClose&&!this.terminated&&"closed"===t&&this.transportStateProvider.isTransportConnected&&this.raiseError({type:nu.MEDIA_ERROR.unexpectedClose,detail:"PeerConnection is closed"},n),"have-remote-pranswer"===i&&"stable"===t&&this.configProvider.config.webrtcPranswerWaitFinalAnswer&&this.transportStateProvider.isTransportConnected&&(this.logger.safe.info(`[${n}] remote final answer, activating audio`),this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.active,e))}),this.transceiverManager=new $4(this.logger,this.peerConnection,this.mediaManager,this.context,this.reinvitelessContext),this.streamSendersManager.registerRtpSenderManager(this.transceiverManager),vc(this.context)&&!this.dataChannel&&(this.dataChannel=new f9(this.peerConnection,this.diagnostics,this.logger,this.configProvider),this.callback.onDataChannelUpdated?.(this.dataChannel),this.multiParty&&this.initializeMediaControlPlane(e)),this.sourceRequestSender=new HL(this.mediaControlPlane,this.context.sendWebRtcMediaNotificationAsyncCallback,this.logger.createChild("SourceRequestSender")),this.mediaMessageController=new HV(this.logger.createChild("SourceRequester"),this.configProvider,this.sourceRequestSender,this.mediaControlPlane),this.negotiation.setInternals(this.transceiverManager,this.transportStateProvider,this.dataChannel),this.multiParty&&(this.contributingSources=new $B(this.logger.createChild("ContributingSources"),this.configProvider,this.activeSpeakerManager,new $H(this.logger.createChild("ContributingSourcesProvider"),c,this.configProvider.config.diagnostics.features.logContributingSourcesError,this.diagnostics))),t.mark("startInitialize"),await this.encStreamsManager.initialize(),t.markAndMeasure("startInitialize","encStreamsManagerInitialize");let u=this.encStreamsManager.isWorkerLoaded();await this.initAudioCodec(u),t.markAndMeasure("startInitialize","initAudioCodec"),this.statsGatherer.sessionInfo.setEncodedStreamWorkerLoaded(u),this.diagnostics.encodedStreamWorker=u}configureCpuThreshold(e){this.configProvider.config.webrtcNativeCpuOveruseDisabled&&this.multiParty&&e.optional.push({googCpuOveruseDetection:!1})}completeCandidateGathering(e){this.negotiation.iceCandidatesDefer.isPending&&(this.logger.safe.info(`[${e}] ICE candidates gathered completely`),this.negotiation.iceCandidatesDefer.resolve())}detectVideoFeatures(){let e=this.videoFeatureManager.get("Video"),t=this.configProvider.config.specCompliantSimulcast;if(t?.enableSimulcastLayoutControlStrategy&&t?.video?.layerScaleFactors?.length>2&&e.toggleClient(0,!0),this.context.config.isTownHall){let t=this.configProvider.config.broadcastMode;(t?.prioritizeLayoutOnServer||t?.prioritizeLayoutOnClient)&&e.toggleClient(3,!0),t?.maxSessionBandwidthKbps&&(this.statsGatherer.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.diagnostics.maxSessionBandwidth=this.configProvider.mediaConfig.maxBandwidthInKbps)}let i=this.mediaManager.getMediaEntitiesByModality("video"),n=this.configProvider.config.preferredH264VideoSendProfile;vL(n)&&i.length>0&&i[0].isSendProfileSupported("H264",n)&&e.toggleClient(1,!0)}onTransportConnected(e){if(this.statsGatherer.clearIceCandidateErrors(),this.diagnostics.clearIceCandidateErrors(),!this.terminated){if(this.transportStateProvider.isWaitingAcceptProvisional){this.logger.safe.info(`[${e}] transport connected provisional`),this.configProvider.config.createProvisionalAnswer.audioState&&this.callbacks.onAudioStateChanged?.(this.configProvider.config.createProvisionalAnswer.audioState,e),this.configProvider.config.createProvisionalAnswer.connectTransport&&this.callbacks.onTransportConnected?.(e);return}this.logger.safe.info(`[${e}] audio transport connected`),this.wasConnected=!0,this.configProvider.config.webrtcPranswerWaitForMediaPollingInterval&&"have-remote-pranswer"===this.transportStateProvider.signalingState?this.handleEarlyMediaAudioState(e):this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.active,e),this.multiParty&&this.configProvider.config.enableVideoFeatureManager&&(this.videoFeatureManager.manageFeatureSupport(()=>{this.detectVideoFeatures()}),this.configProvider.config.maxSendVideoCapabilities.enableForVideoV2&&this.videoFeatureManager.on("onVideoFeaturesChanged",e=>{if("Video"===e.mediaType&&this.configProvider.config.maxSendVideoCapabilities.enableForVideoV2){let t=this.mediaManager.getMediaEntitiesByModality("video");t.length>0&&this.mediaMessageController.sendMaxVideoSendCapabilitiesV2(t[0],e)}})),this.callbacks.onTransportConnected?.(e)}}async getAudioSenderStats(e=.5){let t=this.peerConnection?.getSenders().filter(e=>e.track?.kind==="audio")[0];if(!t)return Promise.resolve(void 0);try{let i=1e3*e,n=i_(i,"Unable to get audio receiver stats report");for(let e of(t.getStats().then(n.resolve,n.reject),(await n.promise).values()))if("outbound-rtp"===e.type)return Promise.resolve(e)}catch(e){this.logger.safe.error(`Error getting audio sender stats: ${t$(e)}`)}return Promise.resolve(void 0)}playVideo(){this.remoteVideoManager.playVideo()}handleEarlyMediaAudioState(e){let t=this.peerConnection.getReceivers().filter(e=>"audio"===e.track.kind)[0];if(!t){this.logger.safe.warn(`[${e}] Connected transport with provisional answer with no audio receiver`),this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.active,e);return}this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.started,e);let i=this.configProvider.config.webrtcPranswerMediaPollingTimeout,n=this.configProvider.config.webrtcPranswerWaitForMediaPollingInterval;this.logger.safe.info(`[${e}] Starting polling for early media audio stats`);let r=async()=>{try{let s;if(!this.canPollAudioStats())return;this.logger.safe.debug(`[${e}] Polling audio receiver stats to detect early media start`);let a=i_(i,"Unable to get audio receiver stats report");t.getStats().then(a.resolve,a.reject);let o=await a.promise;for(let e of(this.diagnostics.registerEarlyMediaPoll(),o.values()))if("inbound-rtp"===e.type){s=e;break}if(!this.canPollAudioStats())return void this.logger.safe.info(`[${e}] Finished polling early media audio stats, terminated: ${!this.terminated}`);if((this.configProvider.config.webrtcPranswerCheckAudioEnergy?s?.totalAudioEnergy:s?.bytesReceived)>this.configProvider.config.webrtcPranswerAudioThreshold){this.logger.safe.info(`[${e}] Finished polling early media audio stats, activating audio`),this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.active,e);return}this.logger.safe.info(`[${e}] No audio data received yet, polling again in ${n}ms`),setTimeout(r,n)}catch(i){let t=t$(i);if(this.logger.safe.error(`[${e}] Error polling stats for pranswer: ${t}. Will stop polling: ${this.configProvider.config.webrtcPranswerStopPollingAfterError}`),this.diagnostics.addStatsError("WebrtcSession::earlyMediaPolling",t),this.configProvider.config.webrtcPranswerStopPollingAfterError)return void this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.active,e);setTimeout(r,n)}};setTimeout(r,this.configProvider.config.webrtcPranswerWaitIntervalBeforePolling)}canPollAudioStats(){return!this.terminated&&"have-remote-pranswer"===this.transportStateProvider.signalingState}startIceDisconnectedTimer(e){this.configProvider.config.iceDisconnectedTimeoutMs&&(this.iceDisconnectedTimer=setTimeout(()=>{this.logger.safe.error(`[${e}] ice disconnected for ${this.configProvider.config.iceDisconnectedTimeoutMs}ms. Raise ${nu.MEDIA_ERROR.iceConnectionError}`),this.raiseError({type:nu.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},e)},this.configProvider.config.iceDisconnectedTimeoutMs))}clearIceDisconnectedTimer(){this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null)}raiseError(e,t=e9()){this.logger.safe.error(`[${t}] Media error occurred type: ${e.type} detail: ${e.detail}`),this.callbacks.onSessionErrorOccurred&&this.callbacks.onSessionErrorOccurred(e,t)}notifyStreamsChanged(){this.streamsChangedNotificationScheduled||(this.logger.safe.info("Scheduling NotifyStreamsChanged"),this.streamsChangedNotificationScheduled=!0,this.negotiation.negotiationCompletedPromise.promise.catch(()=>{}).then(()=>{this.streamsChangedNotificationScheduled=!1,this.logger.safe.info("Executing NotifyStreamsChanged callback"),this.streamsChangedListener?.()}))}async streamAdded(e){if(nu.MODALITY.audio===e.getModality()&&(this.webrtcAudioRecvStream=e.getMediaStream(),await this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),await this.updateAudioRendererStream(this.webrtcAudioRecvStream)),this.configProvider.config.mapSsrcToTrackForStats){let t=this.mediaManager.getMediaEntityByRemoteStreamId(e.getMediaStream().id);this.statsGatherer.setSsrcTrackPair(t.getRemoteSsrc(),t.getRemoteTrackId())}this.notifyStreamsChanged()}async updateAudioRendererStream(e){await this.audioRenderer.play(e),this.rawIncomingAudioStreamManager.streamChanged(e)}streamRemoved(e){if(nu.MODALITY.audio===e.getModality())this.audioRenderer.getStream()===e.getMediaStream()&&(this.audioRenderer.stop(),this.rawIncomingAudioStreamManager.streamChanged(null)),this.webrtcAudioRecvStream=null;else if(nu.MODALITY.video===e.getModality()){let t=this.mediaManager.getMediaEntityByRemoteStreamId(e.getMediaStream().id);t?.getLocalRecvCapabilities()?.resetToInitial()}this.clearReceiveStreamTransforms(e.getReceiver()),e.dispose(),this.notifyStreamsChanged()}hasRelayCandidates(){return this.relayCandidateGathered}createReceiveStream(e,t,i,n){let r=this.configProvider.config.addFmtpToInitialSubscription?n.getLocalRecvCapabilities():null,s=this.configProvider.config.useMultiviewLimitsOnInitialRequest&&n.getModality()!==nu.MODALITY.sharing?()=>this.remoteVideoManager.getMaxAllowedVideoFS():null;return new Hn(new x6(e,t,n.getModality(),+n.getXSourceStreamId(),this,r,s,n.getSubstreamIndex()),i,this.receiveStreamCollection,this.logger.createChild("RecvStream"),this.configProvider.config)}async requestSource(e,t,i){if(!this.multiParty)return;let n=this.mediaManager.getMediaEntityByRemoteStreamId(e);if((this.isMuteHold||this.negotiation.negotiatedModalities[n.getModality()]===nu.MEDIA_STATE.inactive)&&-1!==t)return await iI(10),this.requestSource(e,t,i);if(this.negotiation.negotiationCompletedPromise.isPending)try{await this.negotiation.negotiationCompletedPromise.promise}catch(e){this.logger.safe.info("source request should be sent even if negotiation rejected",e)}if(!this.transportStateProvider.isConnected||this.transportStateProvider.isWaitingAcceptProvisional){this.logger.safe.info("requestSource is postponed till transport is connected");let e=new iE;this.transportStateProvider.doOnConnected(()=>e.resolve(),"requestSource"),await e.promise}return this.mediaMessageController.sendSourceRequest(n.getXSourceStreamId(),t,n?.getMid(),i,n.getSubstreamIndex())}async onReceiveCapabilitiesChanged(e,t,i){if(!this.streamSendersManager)return!1;try{return await this.streamSendersManager.applyCapabilities(t,e,i),!0}catch(e){return!1}}onOptimalVideoCountChanged(e,t){this.callback.onOptimalVideoReceiversCountChanged&&this.callback.onOptimalVideoReceiversCountChanged(e),this.diagnostics.addOvcSubscriptionReport(e,this.subscriptionManager?.getSubscriptionsCount(),t)}async onSendBandwidthChanged(e){if(!this.transportStateProvider.isConnected||this.transportStateProvider.isWaitingAcceptProvisional||!this.mediaControlPlane.mcpFeaturesSupported("senderSideBandwidthEstimationEnabled"))return;let t=[];for(let i of Object.keys(e)){let n=this.mediaManager.getMediaEntitiesByModality(vi(i)).filter(e=>e.isEnabled()&&null!==e.getLocalTrackId());if(0===n.length||0===e[i])return;t.push({streamMsid:n[0].getXSourceStreamId(),bw:e[i]})}await this.mediaMessageController.sendBandwidthInfo(t),this.diagnostics.reportedSendBandwidthLayouts(e)}onMaxVideoSendCapabilitiesChanged(e,t){("Video"===e&&this.configProvider.config.maxSendVideoCapabilities.enableForVideo||"ScreenShare"===e&&this.configProvider.config.maxSendVideoCapabilities.enableForSharing)&&this.transportStateProvider.doOnConnected(()=>this.notifyMaxVideoCapabilitiesChanged(e,t),"maxCapabilities")}notifyMaxVideoCapabilitiesChanged(e,t){let i=vi(e),n=this.mediaManager.getMediaEntitiesByModality(i)[0];if(!n)return;let r=n.getMid();"Video"===e&&this.configProvider.config.maxSendVideoCapabilities.enableForVideoV2?this.mediaMessageController.sendMaxVideoSendCapabilitiesV2(n,this.videoFeatureManager.get("Video"),t):this.mediaMessageController.sendMaxVideoSendCapabilities([r],t)}createAudioRenderer(){this.audioRenderer=new N2(this.logger.createChild("AudioRenderer"),this.configProvider,this.diagnostics.newAudioRendererDiagnostics()),this.ufdManager.signalDeviceEvent(1,"Good","Audio"),this.context.maContext.domOverrides.onMediaElementAdded&&this.audioRenderer.on("onAudioElementAdded",this.context.maContext.domOverrides.onMediaElementAdded),this.context.maContext.domOverrides.onMediaElementRemoved&&this.audioRenderer.on("onAudioElementRemoved",this.context.maContext.domOverrides.onMediaElementRemoved),this.audioRenderer.on("onAudioPlaybackError",(e,t,i)=>this.onAudioPlaybackError(e,t,i)),this.audioRenderer.on("onAudioStateChanged",(e,t)=>this.deviceManager.effectsManager.setAecRefStream(e,t))}onAudioPlaybackError(e,t,i){let n={type:t,detail:i,isAudio:!0};this.ufdManager.signalDeviceEvent(1,"Bad","Audio"),this.deviceManager.raiseTelemetryEvent("reconnect_on_audio_playback_error",{error:e,mediaError:t,message:i}),this.context.reconnectRetry&&this.configProvider.config.audioRendererFailedRetryCodes?.includes(e)&&(this.logger.warn(`Reconnect required, attempt No: ${this.context.reconnectRetry}`),this.context.reconnectRetry--,this.raiseError(n))}getSessionConfig(){return this.configProvider}getLocalMediaTrackId(e){let t=this.mediaManager.getLocalTracksInfo(),i=vi(e),n=t.find(e=>e.modality===i);return n?n.trackId:null}addReceiveStreamTransforms(e,t){let i=this.encStreamsManager.initTransformsCollection(e,"Receiver",vt(t));i&&t!==nu.MODALITY.audio&&this.configProvider.config.useInsertableStreams?.videoStreamAnalyzer&&i.addTransform(new Sf(this.logger.createChild(`RecvStreamAnalyzer [${t}/${e.track.id}]`)))}clearReceiveStreamTransforms(e){this.encStreamsManager.clearTransformsCollection(e)}async checkVideoCodecsSupport(){try{let e=await this.capabilityGatherer.getCapabilities("video");this.statsGatherer.setH264AvailableProfiles(e);let t=Hd({global:this.context.maContext},this.configProvider.config.useSdpCapabilities,this.configProvider.config.noRequiredCodecsWorkaround,!0),i=await t.getCapabilities("video"),n=Hd({global:this.context.maContext},!1),r=await n.getCapabilities("video");this.statsGatherer.setSupportedH264Profiles(i,r);let s=await v$.isCodecsSupported(this.configProvider.config.hevcCodecs);this.diagnostics.videoCapabilities=e,this.diagnostics.setSupportedH264Profiles(i,r),this.diagnostics.isCodecsSupported=s;let a=new Set(e?.codecs?.map(e=>e.mimeType.toLocaleLowerCase())||[]);for(let e of this.configProvider.config.requiredVideoCodecs)if(!a.has(e)){this.ufdManager.signalEvent("NoRequiredVideoCodecs","Bad","Video");break}}catch(e){this.logger.safe.error(`failed to get video capability ${t$(e)}`)}}setBWSeed(e){if(!this.bandwidthCache)return;let t=this.bandwidthCache.getSeed();e.applyChannelParameters={multiChannelParameter:{mids:this.configProvider.config.bwSeedOptions.mids,mediaParameter:JSON.stringify({sendSideBWSeed:{seedValueBitsPerSec:t}})}},this.diagnostics.sentBWSeed=t}getSubscriptionManager(){return this.subscriptionManager}async initAudioCodec(e){await this.audioCodecManager.init(e,this.isAudioOutputMuted),this.audioCodecManager.encoder?.on("codecChanged",e=>this.statsGatherer.setAudioEncoderCodecName(e));let t=this.audioCodecManager.decoder;t&&(t.on("usedDecoderChanged",e=>{this.updateAudioRendererStream(e?t.stream:this.webrtcAudioRecvStream),this.statsGatherer.setAudioDecoderStatsProvider(e?t.getStatsProvider():void 0),this.contributingSources?.useCustomCodec(e)}),t.on("contributingSourcesChanged",e=>this.contributingSources?.updateContributingSources(e)),t.on("firstAudioPacketReceived",()=>{this.diagnostics.firstAudioPacketReceived(),this.logger.info(`First audio packet received via insertable streams: ${this.diagnostics.timeToFirstAudioPacket}`),this.configProvider.config.tuffAudioStateChanged&&this.callbacks.onAudioStateChanged?.(nu.STREAMING_STATE.active,e9())}),this.audioCodecManager.on("negotiationNeeded",e=>this.negotiation.triggerRenegotiation(!0,e)))}onIncomingVideoQualityChanged(e,t){1===e&&this.remoteVideoResolutionManager.limitResolutionOnPoorPerformance(t)}getVideoDeviceManager(){return this.context.callDeviceManager.getDeviceManager("Video")}setupCallDeviceManagerSubs(){this.callDeviceManagerSub=this.context.callDeviceManager.on("onSelectedVirtualDevicesChanged",()=>{this.logger.info("VirtualDevice changed, disposing deviceManager subscriptions"),this.deviceManagerSubs.forEach(e=>e.dispose()),this.logger.info("New subscriptions for deviceManager created"),this.setSubsForDeviceManager()})}updateLocalMediaSources(){this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.configProvider.config.mapSsrcToTrackForStats&&this.statsGatherer.updateStatsWithLocalSsrcTrackInfo();let e=this.streamSendersManager.getLocalMediaSources();this.qualityManager.updateRegisteredSources(e)}};function Hj(e,t){let i=(t?e?.maxReinvitelessMediaForVideoMultiparty:e?.maxReinvitelessMediaForVideo1on1)||0,n=(t?e?.maxReinvitelessMediaForVBSSMultiparty:e?.maxReinvitelessMediaForVBSS1on1)||0;return{enabled:i>0||n>0,maxStreamsForModality:{video:i,sharing:n}}}var Hq=class{constructor(e,t,i,n,r,s,a,o){this.logger=e,this.context=t,this.configProvider=i,this.diagnostics=n,this.ufdManager=r,this.deviceManager=s,this.capabilities=a,this.midCallTelemetry=o,this.activeSessions=[],this.pendingDeviceTelemetryEvents=[],this.pendingVideoEffectsTelemetryEvents=[],this.pendingAudioEffectsTelemetryEvents=[],this.callsCount=0,this.mediaConfig={},this.configProvider.on("configUpdated",()=>this.configApplied()),this.deviceManager.on("onDeviceTelemetryEvent",e=>this.onDeviceTelemetryEvent(e)),this.deviceManager.on("onVideoEffectsTelemetryEvent",e=>this.onVideoEffectsTelemetryEvent(e)),this.deviceManager.on("onAudioEffectsTelemetryEvent",e=>this.onAudioEffectsTelemetryEvent(e))}createSession(e,t,i,n,r,s,a){let o=(0,$g.merge)({},this.mediaConfig,s);this.configProvider.setMediaConfiguration(o);let l=this.configProvider.getConfigView(i?.isConference),c=this.logger,d=t.correlationId,u=this.diagnostics.newSession(l,d,this.logger.createChild("sessionDiagnostics"));a?.setTelemetryEventReporter(u.registerMediaLeakEvent.bind(u)),r?.setDiagnosticsReport(this.diagnostics.reportGenerator);let h={getLogger:()=>c,getUfdManager:()=>this.ufdManager,sendWebRtcMediaNotificationAsyncCallback:(e,i)=>t.sendWebRtcMediaNotificationAsync(e,i),maContext:this.context,config:i??{},configProvider:l,diagnostics:u.newNativeSessionDiag(),reconnectRetry:l.config.audioRendererFailedReconnectTimes,callDeviceManager:n,getSmallCallTelemetry:()=>r},g=new HH(h,d,e,a),p=new $L(l,++this.callsCount,u);p.setMediaQosEnabled(!!o.enableMediaQoS),p.setPortRangeConfigured(!!o.mediaPortRanges);let f=new $M(g,d,h,e,p,this.configProvider,u);for(f.on("onTerminated",e=>this.onSessionTerminated(e)),this.activeSessions.push(f),this.configProvider.updateSessionCount(this.activeSessions.length),this.webRtcInternalsCollector=$f.getInstance(this.logger.createChild("WebRtcInternals"),l),this.webRtcInternalsCollector.updateSessionCount(this.activeSessions.length);this.pendingDeviceTelemetryEvents.length>0;)f.registerDeviceTelemetryEvent(this.pendingDeviceTelemetryEvents.pop());for(;this.pendingVideoEffectsTelemetryEvents.length>0;)f.registerVideoEffectsTelemetryEvent(this.pendingVideoEffectsTelemetryEvents.pop());for(;this.pendingAudioEffectsTelemetryEvents.length>0;)f.registerAudioEffectsTelemetryEvent(this.pendingAudioEffectsTelemetryEvents.pop());return f}getDeviceManager(){return this.deviceManager}getCapabilities(){return this.capabilities}getScreenSharingManager(){return new $S(this.deviceManager)}updateConfig(e,t,i,n){this.configProvider.updateConfig(e,t,i,n)}getConfig(){return this.configProvider.config}getConfigProvider(){return this.configProvider}setMediaConfig(e){(0,$g.merge)(this.mediaConfig,e),this.diagnostics.mediaConfig=this.mediaConfig}getMediaLogs(){return this.webRtcInternalsCollector?this.webRtcInternalsCollector.collect():Promise.resolve("")}getDiagnosticsData(){return this.diagnostics.rootRef}dispose(e){return Promise.all([...this.activeSessions.map(async t=>{await t.terminate(e,{}).catch(()=>{}),t.dispose()})]).then(()=>{},()=>{})}handleSendMidCallTelemetry(e){this.midCallTelemetry?.on("sendMidCallTelemetry",e)}configApplied(){window&&(this.configProvider.config.enableDevtoolsAPI?window.webMA||this.injectDevtoolsAPI():window.webMA&&delete window.webMA)}injectDevtoolsAPI(){let e=[],t={config:{addOverride:(e,t)=>this.configProvider.setConsoleOverride(e,t),setOverrides:e=>this.configProvider.setConsoleOverrides(e),clearOverride:e=>this.configProvider.clearConsoleOverride(e),clearAllOverrides:()=>this.configProvider.clearAllConsoleOverrides(),setPlatformConstraints:e=>this.configProvider.setCallConstraints(e),setCallConstraints:e=>{this.activeSessions.length&&this.activeSessions[this.activeSessions.length-1].setCallConstraints(e,"webMA")},setRelayConfigOverride:e=>this.context.getRelayManager().setRelayOverride(e),manageVideoFeatures:t=>{e.push(t)}},diagnosticsReport:this.diagnostics.reportGenerator,initVideoFeatures:t=>{e.forEach(e=>{e((e,i,n)=>{let r,s=VD[n];if(void 0!==s&&("video"===i?r=t.get("Video"):"sharing"===i&&(r=t.get("Video")),void 0!==r))if(e)return r.toggleServer(s,!0),!0;else return r.toggleClient(s,!0),!0;return!1})})},deviceManager:{setAudioProcessingFlags:e=>this.deviceManager.setAudioProcessingFlags(e)},ufdManager:{raiseUFD:(e,t="Bad",i="Video")=>this.ufdManager.signalEvent(e,t,i)}};window.webMA=t}onDeviceTelemetryEvent(e){this.activeSessions.length>0?this.activeSessions.forEach(t=>t.registerDeviceTelemetryEvent(e)):this.pendingDeviceTelemetryEvents.push(e)}onVideoEffectsTelemetryEvent(e){this.activeSessions.length>0?this.activeSessions.forEach(t=>t.registerVideoEffectsTelemetryEvent(e)):this.pendingVideoEffectsTelemetryEvents.push(e)}onAudioEffectsTelemetryEvent(e){this.activeSessions.length>0?this.activeSessions.forEach(t=>t.registerAudioEffectsTelemetryEvent(e)):this.pendingAudioEffectsTelemetryEvents.push(e)}onSessionTerminated(e){ny(this.activeSessions,t=>t===e),this.configProvider.updateSessionCount(this.activeSessions.length),this.webRtcInternalsCollector.updateSessionCount(this.activeSessions.length),0===this.activeSessions.length&&this.ufdManager.reset()}},HW=class{static build(e,t,i,n,r,s,a,o){return new Hq(e,t,i,n,r,s,a,o)}};HW.constants=nu,HW.helper=mq;var HG=class extends tZ{constructor(e,t,i){super(),this.logger=e,this.callbacks=t,this.deviceManagerDiagnostics=i,this.createWasmCVWorker=()=>(this.logger.info("Creating wasmcv worker"),this.create({msg:"wasmcv"})),this.createEncodedStreamsWorker=()=>(this.logger.info("Creating encoded-stream worker"),this.create({msg:"encoded-stream"})),this.createTimerWorker=()=>(this.logger.info("Creating timer worker"),this.create({msg:"timer"})),this.getWasmVqeWorker=()=>(this.logger.info("Creating wasmvqe worker"),this.create({msg:"wasmvqe"}))}getWorkerFunction(e){if(this.logger.info(`getWorkerFunction, loaderName: ${e}`),!this.callbacks?.createGenericWebRTCWorker)switch(e){case"encoded-stream":return this.callbacks?.createEncodedStreamsWorker;case"wasmcv":return this.callbacks?.createWasmCVWorker;default:return}switch(e){case"encoded-stream":return this.createEncodedStreamsWorker;case"wasmcv":return this.createWasmCVWorker;case"timer":return this.createTimerWorker;default:return}}get audioWorklet(){return this.callbacks?.createGenericWebRTCWorker?{getWasmVqeWorker:this.getWasmVqeWorker,getWasmDnsWorklet:this.callbacks?.audioWorklet?.getWasmDnsWorklet,getWasmAecWorklet:this.callbacks?.audioWorklet?.getWasmAecWorklet,getWasmVqeWorklet:this.callbacks?.audioWorklet?.getWasmVqeWorklet,getEncodedStreamsTimerWorklet:this.callbacks?.audioWorklet?.getEncodedStreamsTimerWorklet,getEncodedStreamsDecoderWorklet:this.callbacks?.audioWorklet?.getEncodedStreamsDecoderWorklet,getEncodedStreamsRendererWorklet:this.callbacks?.audioWorklet?.getEncodedStreamsRendererWorklet}:this.callbacks?.audioWorklet}create(e){let t;try{t=this.callbacks.createGenericWebRTCWorker()}catch(e){return}let i=Date.now(),n=i=>{let r=JSON.stringify(i);this.logger.error(`Worker ${JSON.stringify(e)} error: ${r}`),this.deviceManagerDiagnostics?.registerWorkerEvent({timestamp:Date.now(),workerType:e.msg,msg:"generic-worker-error",payload:r}),t.removeEventListener("error",n),this.event("onLoadError").raise(e.msg)},r=s=>{let a;s?.data?.msg==="wasm-worker-loaded"&&(this.logger.info(`Worker ${JSON.stringify(e)} event: ${JSON.stringify(s.data)}`),a={timestamp:Date.now(),workerType:e.msg,workerLoadTimeMs:Date.now()-i,msg:JSON.stringify(s?.data?.msg),payload:JSON.stringify(s?.data?.payload)},t.removeEventListener("message",r)),s?.data?.msg==="wasm-worker-load-error"&&n(s),a&&this.deviceManagerDiagnostics?.registerWorkerEvent(a)};return t.addEventListener("error",n),t.addEventListener("message",r),t.postMessage(e),t}},Hz=class e{constructor(e,t,i,n,r){this.workerProvider=e,this.workerUrl=t,this.workletUrl=i,this.decoderUrl=n,this.rendererUrl=r}static async create(t,i){let n=t.getWorkerFunction("encoded-stream"),r=!n&&i?await i.getWorkerUrl():void 0;try{let i=await t.audioWorklet?.getEncodedStreamsTimerWorklet?.(),s=await t.audioWorklet?.getEncodedStreamsDecoderWorklet?.(),a=await t.audioWorklet?.getEncodedStreamsRendererWorklet?.();return new e(n,r,i,s,a)}catch(t){return new e(n,r,void 0,void 0,void 0)}}getTimerWorkletUrl(){return this.workletUrl}getDecoderWorkletUrl(){return this.decoderUrl}getRendererWorkletUrl(){return this.rendererUrl}getWorker(e){try{if(e.safe.info("creating worker"),this.workerProvider)return this.workerProvider();if(this.workerUrl)return e.safe.warn("WasmLoader didn't provide worker function, falling back to legacy worker provider"),new Worker(this.workerUrl);e.safe.error("no worker provider")}catch(t){e.safe.error(`failed to create worker ${t$(t)}`)}return null}},HJ=class{constructor(){this.data={count:{}}}registerQualityChangedEvent(e){var t,i,n;(t=this.data.count)[i=SP(e)]??(t[i]={});let r=this.data.count[SP(e)];r[n=e.value.toLowerCase()]??(r[n]=0),r[e.value.toLowerCase()]++}getObjectRef(){return this.data}},HK=class{constructor(e,t,i){this.mediaAgents=[],e.logger??(e.logger=new y_),e.domOverrides??(e.domOverrides={}),this.config=e;let n=e.mediaSettings;mR(e.clientInformation),this.logger=new $h(e.safeLogger?.createChild("MA",n.debug),e.logger.createChild("MA",n.debug)),this.configProvider=new x4(this.logger.createChild("configProvider"),i,n);let r=new xc(this.configProvider),s=new HJ;this.mediaAgentDiagnostics=new $u(this.configProvider,r,s),this.ufdManager=new yP(this.logger.createChild("UFD"),this.configProvider,s),this.wasmLoader=new HG(this.logger.createChild("WasmLoader"),e.createWasmWorkerCbs,r),this.deviceManager=new xz(this.logger.createChild("DeviceManager"),this.configProvider,r,e.domOverrides,this.ufdManager,e.webcvProvider,e.wasmdnsProvider,e.wasmaecProvider,e.wasmVqeProvider,this.wasmLoader),this.capabilities=new yI(this.configProvider),ra.initialize(this.configProvider),t.on("OnECSChanged",()=>{let e=t.getEcsConfig("SkypeWebMedia","mediaAgent");e?this.configProvider.updateConfig(e,t.ETag,t.getEcsConfig("ConfigIDs","SkypeWebMedia"),t.getEcsConfig("Headers","CountryCode")):this.logger.warn("No SkypeWebMedia.mediaAgent config.")})}getDeviceManager(){return this.deviceManager}async buildAgent(e,t,i){if(!v$.hasMediaApi())throw[new HQ(`${e} not supported by media agent provider`,"not_supported")];if(this.config?.detectH264Support&&!await v$.hasH264CodecSupport(this.config.logger))throw[new HQ("H264 is not supported","not_supported")];let n=await Hz.create(this.wasmLoader,this.config.encodedStreamsWorkerProvider),r={getRelayManager:()=>t.getOrCreateRelayManager(),getWebCVProvider:()=>this.config.webcvProvider,getWasmDnsProvider:()=>this.config.wasmdnsProvider,getWasmAecProvider:()=>this.config.wasmaecProvider,getWasmVqeProvider:()=>this.config.wasmVqeProvider,getEncodedStreamsWorkerProvider:()=>n,domOverrides:this.config.domOverrides,configProvider:this.configProvider};t.setConfigProvider(this.configProvider);let s=HW.build(this.logger,r,this.configProvider,this.mediaAgentDiagnostics,this.ufdManager,this.deviceManager,this.capabilities,i);return s.constants=HW.constants,this.mediaAgents.push(s),s}async dispose(e){return Promise.all([this.deviceManager.dispose(),this.ufdManager.dispose(),this.configProvider.dispose(),this.capabilities.dispose(),...this.mediaAgents.map(t=>t.dispose(e))]).then(()=>{this.mediaAgents=[]})}},HQ=class extends Error{constructor(e,t="failure"){super(e),this.reason=t}},HY=class{constructor(e){this.logger=e,this.supportedPlatforms=new Map([["Chrome","59.0"],["Edge","79.0"],["Safari","13.1"],["Electron","3.0"],["Firefox","96.0"],["Maglev","1.0"]]),this.experimentalPlatforms=new Map}getPlatformSupportLevel(e,t){let i=is.getBrowserInfo(),n="Safari"===i.engine?"Safari":i.name,r=this.supportedPlatforms.get(n);if(e&&r&&is.isVersionGreaterOrEqual(r))return 1;if(e&&"applewebview"===t)return this.logger.info("AppleWebView platform. Return full support"),1;if(e&&!r){if(is.isEngine("Chromium","ChromiumAVD"))return 2;let e=this.experimentalPlatforms.get(i.name);if(e&&is.isVersionGreaterOrEqual(e))return 2}return this.logger.info(`Platform is not supported. BrowserInfo: ${is.toString()}`),0}},HZ=class extends tZ{constructor(e,t,i){super(),this.relayManagerProvider=e,this.configProvider=t,this.logger=i,this.currentInfo={},this.currentAreaContent={},this.isEnabled=!1,this.isEnabled=this.configProvider.config.enableE911,t.on("configUpdated",()=>{let e=this.isEnabled;this.isEnabled=this.configProvider.config.enableE911,this.isEnabled&&(e!==this.isEnabled||!this.prober)&&(this.prober?.dispose(),this.prober=void 0,this.configProvider.config.probeE911OnInit&&this.probeForIP("config"))})}get info(){return this.currentInfo}get areaContent(){return this.currentAreaContent}async getInfo(){return this.isEnabled&&!this.prober&&await this.probeForIP("publicGetInfo"),this.currentInfo}setClientInfo(e,t){if(this.isEnabled)switch(this.logger.info(`Client info for ${e} set`),e){case 3:this.mergeClientAreaInfo(JSON.parse(t));break;case 1:case 0:break;case 2:this.mergeClientNetworkInfo(JSON.parse(t))}}mergeClientAreaInfo(e){let t=JSON.stringify(this.currentAreaContent);this.currentAreaContent.geoCoordinates=e.geoCoordinates,nP(this.currentAreaContent),JSON.stringify(this.currentAreaContent)!==t&&this.raiseChanged()}mergeClientNetworkInfo(e){if(0===Object.keys(e).length){let e=Object.keys(this.currentInfo).length+Object.keys(this.currentAreaContent).length;this.currentInfo={},this.currentAreaContent={},e>0&&this.raiseChanged();return}let t=this.currentInfo.bssid!==e.bssid||this.currentInfo.bssidv6!==e.bssidv6||this.currentInfo.mac!==e.mac||this.currentInfo.macv6!==e.macv6||this.currentInfo.subnetLengthIpv4!==e.subnetLengthIpv4||this.currentInfo.subnetLengthIpv6!==e.subnetLengthIpv6,i=this.currentInfo.e911;this.currentInfo.bssid=e.bssid,this.currentInfo.bssidv6=e.bssidv6,this.currentInfo.e911=e.e911,this.currentInfo.mac=e.mac,this.currentInfo.macv6=e.macv6,this.currentInfo.subnetLengthIpv4=e.subnetLengthIpv4,this.currentInfo.subnetLengthIpv6=e.subnetLengthIpv6,nP(this.currentInfo),t?this.probeForIP("clientNetworkInfoChanged").then(e=>{e||this.raiseChanged()}):JSON.stringify(i)!==JSON.stringify(e.e911)&&this.raiseChanged()}async probeForIP(e){return this.probingPromise?(this.logger.info(`Probing already in progress, tried to start for: ${e}`),this.probingPromise):(this.probingPromise=this.probeForIPInternal(e),this.probingPromise.then(e=>(this.probingPromise=void 0,e)).catch(e=>(this.probingPromise=void 0,this.logger.error(`E911 probing failed: ${t$(e)}`),!1)))}async probeForIPInternal(e){this.logger.info(`Probing for public IP address: ${e}`);let t=await this.ensureProber();if(await t.ensureOnline(),t.ipFromRelay){if((this.currentInfo.ipv4||this.currentInfo.ipv6)!==t.ipFromRelay)return delete this.currentInfo.ipv4,delete this.currentInfo.ipv6,this.currentInfo[mW.test(t.ipFromRelay)?"ipv4":"ipv6"]=t.ipFromRelay,this.raiseChanged(),!0}else if(0!==Object.keys(this.currentInfo).length)return this.currentInfo={},this.raiseChanged(),!0;return!1}async ensureProber(){if(this.prober)return this.prober;let e=$w(await this.relayManagerProvider.getOrCreateRelayManager().queryRelaysAsync({relayType:"turn"}),this.configProvider.config);return this.prober=new $_(e,new $h(this.logger.createChild("Prober"),this.logger.createChild("ProberUnsafe"))),this.prober}},HX=class extends tZ{constructor(e){super(),this.ecsFilters=e,this.config=null}get ETag(){return this.etag}async setEcsConfig(e){this.config=JSON.parse(e.ecsBlob),this.etag=e.etag,this.event("OnECSChanged").raise()}async setUserEcsServerUrl(e,t){throw Error("Not implemented")}async getUserEcsServerUrl(e){throw Error("Not implemented")}async setActiveUserForEcs(e){throw Error("Not implemented")}async getEcsQueryParameters(){let e={};e.CLRelease=tX();let t="_TS_BUILC_VERSION_".replace("C","D"),i=this.ecsFilters?.["UserInfo.Ring"]?.value,n=this.getTeamsExperience();e.CLRelease===t&&(e.CLRelease="9999.99"),i&&(e.audienceGroup=i,e.teamsRing=i),n&&(e.Experience=n),this.ecsFilters?.vdi?.value==="vdi3"&&(e.vdi="vdi3");let r=is.getBrowserInfo();return e.BrowserName=r.name,e.BrowserEngine=r.engine,e.BrowserEngineVersion=r.engineVersion,e.BrowserVersion=r.version,e.FormFactor=r.formFactor,e.OsName=r.osName,e.OsVer=r.osVersion,v$.hardwareConcurrency&&(e.CPUCount=v$.hardwareConcurrency),JSON.stringify(e)}async ecsGetUserQueryParameters(e){return this.getEcsQueryParameters()}async shouldTriggerCQF(e,t,i){throw Error("Not implemented")}getEcsConfig(e,t){let i=this.config?.[e];return t?i?.[t]:i}createEcsConfiguration(){return new class{constructor(e){this.provider=e}getBoolean(e,t){return this.provider.getEcsConfig(e,t)}getNumber(e,t){return this.provider.getEcsConfig(e,t)}getString(e,t){return JSON.stringify(this.provider.getEcsConfig(e,t))}}(this)}getTeamsExperience(){return this.ecsFilters?.isTeams2?.value===!0?"teams2":this.ecsFilters?.isTeams2?.value===!1?"teams1":void 0}},H0=class{constructor(e){this._sharingSource=e}getId(){return this._sharingSource.getId()}getDeviceId(){return this._sharingSource.getDeviceId()}getType(){return this.mapSharingSourceType(this._sharingSource.getType())}getPreview(e,t,i){return Promise.reject("not implemented")}getPreviewAsync(e,t){return this._sharingSource.getPreviewAsync(e,t)}getDescription(){return this._sharingSource.getDescription()}getIcon(e,t){return this._sharingSource.getIcon(e,t)}getBounds(){}mapSharingSourceType(e){switch(e){case 1:return 1;case 2:return 2;case 3:return 3;default:throw Error("Invalid sharing source type")}}},H1=class extends tZ{constructor(e){super(),this._screenSharingManager=e,this._screenSharingManager.onScreensChanged(()=>{this.event("screensChanged").raise()})}enumerateScreensAsync(){return this._screenSharingManager.enumerateScreensAsync().then(e=>e.map(e=>new H0(e)))}enumerateWindowsAsync(){return this._screenSharingManager.enumerateWindowsAsync().then(e=>e.map(e=>new H0(e)))}enumerateCamerasAsync(){return this._screenSharingManager.enumerateCamerasAsync().then(e=>e.map(e=>new H0(e)))}},H2=i(83836),H3=(e,t)=>{if(!t)return e;let i={...e};return t.ngIncoming&&t.ngOutgoing&&(i.cloudScreenSharingFlag=H4(H6(t.ngIncoming.isVBSSEnabled,t.ngOutgoing.isVBSSEnabled),e.cloudScreenSharingFlag)),t.ngOutgoing&&(i.emergencyCallCountry=H8(t.ngOutgoing.isEmergencyCallingEnabled,e.emergencyCallCountry),i.isGVCOutgoingEnabled=H4(t.ngOutgoing.isGVCEnabled,e.isGVCOutgoingEnabled),i.brokerEnabledOutgoing=H4(t.ngOutgoing.isBrokerEnabled,e.brokerEnabledOutgoing)),t.ngIncoming&&(i.isGVCJoiningEnabled=H4(t.ngIncoming.isGVCEnabled,e.isGVCJoiningEnabled),i.brokerEnabledIncoming=H4(t.ngIncoming.isBrokerEnabled,e.brokerEnabledIncoming)),i.conversationServiceUrl=H5(t.conversationServiceUrl,e.conversationServiceUrl),i.uploadLogRequestUrl=H5(t.uploadLogRequestUrl,e.uploadLogRequestUrl),i.isConversationServiceUrlFromEcs=!!t.conversationServiceUrl,i.isUploadLogRequestUrlFromEcs=!!t.uploadLogRequestUrl,i.callingTokenLogicalUrl=H5(t.callingTokenLogicalUrl,e.callingTokenLogicalUrl),i.doHostlessCalling=H4(t.allowHostlessCalls,e.doHostlessCalling),i.supportsCompressedServicePayload=H4(t.supportCompressedTrouterPayload,e.supportsCompressedServicePayload),i.brokerRequestBatching=H4(t.allowBrokerSubscribeBatching,e.brokerRequestBatching),i.brokerExclusively=H4(t.brokerExclusively,e.brokerExclusively),i.handleMediaOfferFromPushNotification=H4(t.handleMediaOfferFromPushNotification,e.handleMediaOfferFromPushNotification),i.handleNewOfferRequest=H4(t.handleNewOfferRequest,e.handleNewOfferRequest),i.sendProgressFromCC=H4(t.sendProgressFromCC,e.sendProgressFromCC),i.useInternalHttpDispatcher=H4(t.webInternalHttpDispatcher,e.useInternalHttpDispatcher),(t.webInternalHttpDispatcherConfigNetworkRequest||e.requestTypeHttpDispatcherConfigMap)&&(t.webInternalHttpDispatcherConfigNetworkRequest=t.webInternalHttpDispatcherConfigNetworkRequest||{},e.requestTypeHttpDispatcherConfigMap=e.requestTypeHttpDispatcherConfigMap||{},i.requestTypeHttpDispatcherConfigMap={...e.requestTypeHttpDispatcherConfigMap,...t.webInternalHttpDispatcherConfigNetworkRequest}),(t.operationTypeHttpDispatcherConfigMap||e.operationTypeHttpDispatcherConfigMap)&&(t.operationTypeHttpDispatcherConfigMap=t.operationTypeHttpDispatcherConfigMap||{},e.operationTypeHttpDispatcherConfigMap=e.operationTypeHttpDispatcherConfigMap||{},i.operationTypeHttpDispatcherConfigMap={...e.operationTypeHttpDispatcherConfigMap,...t.operationTypeHttpDispatcherConfigMap}),(t.csaTimeoutConfiguration||e.csaTimeoutConfiguration)&&(t.csaTimeoutConfiguration=t.csaTimeoutConfiguration||{},e.csaTimeoutConfiguration=e.csaTimeoutConfiguration||{},i.csaTimeoutConfiguration={...e.csaTimeoutConfiguration,...t.csaTimeoutConfiguration}),i.autoJoinOnConflict=H4(t.autoJoinOnConflict,e.autoJoinOnConflict),i.enableQuickSendAcceptanceAck=H4(t.enableQuickSendAcceptanceAck,e.enableQuickSendAcceptanceAck),i.supportMediaRetargetWhileIncomingRenegotiation=H4(t.supportMediaRetargetWhileIncomingRenegotiation,e.supportMediaRetargetWhileIncomingRenegotiation),i.enableCallEstablishmentTimeoutsForStartJoinCall=H4(t.enableCallEstablishmentTimeoutsForStartJoinCall,e.enableCallEstablishmentTimeoutsForStartJoinCall),i.callingServiceSupportsCAETokens=H4(t.callingServiceSupportsCAETokens,e.callingServiceSupportsCAETokens),i.callingServiceSupportsAADTokens=H4(t.callingServiceSupportsAADTokens,e.callingServiceSupportsAADTokens),i.aadTokenExpirationTimeInSeconds=H4(t.aadTokenExpirationTimeInSeconds,e.aadTokenExpirationTimeInSeconds),i.caeTokenExpirationTimeInSeconds=H4(t.caeTokenExpirationTimeInSeconds,e.caeTokenExpirationTimeInSeconds),i.disableTokenMigrationHeader=H4(t.disableTokenMigrationHeader,e.disableTokenMigrationHeader),i.enablePublishTokenTelemetry=H4(t.enablePublishTokenTelemetry,e.enablePublishTokenTelemetry),i.refreshTimeBeforeTokenTimeoutInSeconds=H4(t.refreshTimeBeforeTokenTimeoutInSeconds,e.refreshTimeBeforeTokenTimeoutInSeconds),i.forceClearExpiredTokens=H4(t.forceClearExpiredTokens,e.forceClearExpiredTokens),i.enableRefreshToken=H4(t.enableRefreshToken,e.enableRefreshToken),i.enableAsyncDisablePreheat=H4(t.enableAsyncDisablePreheat,e.enableAsyncDisablePreheat),i.enablePreheatInStreamingMode=H4(t.enablePreheatInStreamingMode,e.enablePreheatInStreamingMode),i.skipOfferGenerationForStreamingUser=H4(t.skipOfferGenerationForStreamingUser,e.skipOfferGenerationForStreamingUser),i.forceLowercaseHttpHeaders=H4(t.forceLowercaseHttpHeaders,e.forceLowercaseHttpHeaders),i.enableResolveScreenSharingWhenNegotiationComplete=H4(t.enableResolveScreenSharingWhenNegotiationComplete,e.enableResolveScreenSharingWhenNegotiationComplete),i.maxReinvitelessMediaForVideoForWeb=H4(t.maxReinvitelessMediaForVideoForWeb,e.maxReinvitelessMediaForVideoForWeb),i.maxReinvitelessMediaForVBSSForWeb=H4(t.maxReinvitelessMediaForVBSSForWeb,e.maxReinvitelessMediaForVBSSForWeb),i.enableRefreshTokenRetry=H4(t.enableRefreshTokenRetry,e.enableRefreshTokenRetry),i.enableRefreshTokenRetryInSeconds=H4(t.enableRefreshTokenRetryInSeconds,e.enableRefreshTokenRetryInSeconds),i.enableConversationTypeUpdateOnCallEnd=H4(t.enableConversationTypeUpdateOnCallEnd,e.enableConversationTypeUpdateOnCallEnd),i.supportMissingTokenTypesInResponse=H4(t.supportMissingTokenTypesInResponse,e.supportMissingTokenTypesInResponse),i.useSkypeTokenWhenNoAuthenticateHeader=H4(t.useSkypeTokenWhenNoAuthenticateHeader,e.useSkypeTokenWhenNoAuthenticateHeader),i.enableAutoPromotion=H4(t.enableAutoPromotion,e.enableAutoPromotion),i.enableTokenCache=H4(t.enableTokenCache,e.enableTokenCache),i.enableBatchedSendMessageStatus=H4(t.enableBatchedSendMessageStatus,e.enableBatchedSendMessageStatus),i.enableBatchedReceiveMessage=H4(t.enableBatchedReceiveMessage,e.enableBatchedReceiveMessage),i.enableTokenCacheForGenericTokenAPI=H4(t.enableTokenCacheForGenericTokenAPI,e.enableTokenCacheForGenericTokenAPI),i.disableRealTimeModeFromRoster=H4(t.disableRealTimeModeFromRoster,e.disableRealTimeModeFromRoster),i.enableLongOutgoing1To1SetupTimeoutForWeb=H4(t.enableLongOutgoing1To1SetupTimeoutForWeb,e.enableLongOutgoing1To1SetupTimeoutForWeb),i.checkAttendeeRoleInCreateContentSharing=H4(t.checkAttendeeRoleInCreateContentSharing,e.checkAttendeeRoleInCreateContentSharing),i.enableSpecificErrorCodesForCallEnd=H4(t.enableSpecificErrorCodesForCallEnd,e.enableSpecificErrorCodesForCallEnd),i.enableSplitConversationEndUrl=H4(t.enableSplitConversationEndUrl,e.enableSplitConversationEndUrl),i.enableFetchRequestWithKeepAlive=H4(t.enableFetchRequestWithKeepAlive,e.enableFetchRequestWithKeepAlive),i.enableFetchApiForBeacon=H4(t.enableFetchApiForBeacon,e.enableFetchApiForBeacon),i.nullifyAuthTokenManagerOnReset=H4(t.nullifyAuthTokenManagerOnReset,e.nullifyAuthTokenManagerOnReset),i};function H4(e,t){return null==e?t:e}function H5(e,t){return e||t}function H6(e,t){return t&&e?"enabled":e?"recvOnly":!1===e&&!1===t?"disabled":void 0}function H8(e,t){return!1===e?"":t}var H9="SkypeCalling",H7=class{constructor(e,t,i,n){this.signalingAgentConfig=e,this.ecsProvider=t,this.logger=i,this.telemetryLogger=n,this.ecsProvider.on("OnECSChanged",()=>this.onEcsUpdate()),this.signalingAgentConfig.clientInformation+=`/TsCallingVersion=${tX()}/Ovb=${t0()}`,this.signalingAgentConfig.piiScrubber={omit:H2.pii.Omit,mri:H2.pii.Mri},this.signalingAgent=new pm(this.getSignalingAgentConfig())}getSignalingAgent(){return this.signalingAgent}onEcsUpdate(){let e=this.ecsProvider.getEcsConfig(H9);this.logger.info(`onEcsUpdate, ecsTag=${this.ecsProvider.ETag||""}, ecsConfig=${JSON.stringify(e)}`),this.signalingAgentConfig=H3(this.signalingAgentConfig,e),this.signalingAgentConfig.ecsEtag=this.ecsProvider.ETag,this.signalingAgent.updateSignalingAgentConfig(this.getSignalingAgentConfig())}getSignalingAgentConfig(){return this.signalingAgentConfig.oneDsTelemetryLogger=this.telemetryLogger,this.signalingAgentConfig}},je=(e,t,i,n)=>new H7(e,t,i,n),jt=eR(i(892891)),ji="toLowerCase",jn="blkVal",jr="length",js="rdOnly",ja="notify",jo="warnToConsole",jl="throwInternal",jc="setDf",jd="watch",ju="logger",jh="apply",jg="push",jp="splice",jf="hdlr",jm="cancel",jv="initialize",jS="identifier",jy="isInitialized",jC="getPlugin",jb="name",jT="time",jE="processNext",j_="getProcessTelContext",jI="unload",jw="loggingLevelConsole",jP="createNew",jR="teardown",jA="messageId",jM="message",jD="isAsync",jO="diagLog",jk="_doTeardown",jN="update",jx="getNext",jL="setNextPlugin",jF="userAgent",jU="nodeType",j$="replace",jV="logInternalMessage",jB="isChildEvt",jH="getCtx",jj="setCtx",jq="complete";function jW(e,t){ed||(ed=b4("AggregationError",function(e,t){t[jr]>1&&(e.errors=t[1])}));var i=e||"One or more errors occurred.";throw CL(t,function(e,t){i+="\n".concat(t," > ").concat(Cw(e))}),new ed(i,t||[])}var jG=void 0,jz="",jJ="core",jK="disabled",jQ="extensionConfig",jY="processTelemetry",jZ="priority",jX="perfEvent",j0="getPerfMgr",j1="Not dynamic - ",j2=/-([a-z])/g,j3=/([^\w\d_$])/g,j4=/^(\d+[\w\d_$])/;function j5(e){return!Ca(e)}function j6(e){var t=e;return t&&Cu(t)&&(t=(t=(t=t[j$](j2,function(e,t){return t.toUpperCase()}))[j$](j3,"_"))[j$](j4,function(e,t){return"_"+t})),t}function j8(e,t){return!!e&&!!t&&-1!==Tm(e,t)}function j9(e){return e&&e.toISOString()||""}function j7(e,t){var i=null,n=null;return Ch(e)?i=e:n=e,function(){var e=arguments;if(i&&(n=i()),n)return n[t][jh](n,e)}}function qe(e,t,i,n,r){e&&t&&i&&(!1!==r||Cr(e[t]))&&(e[t]=j7(i,n))}var qt="console",qi="JSON",qn="crypto",qr="msCrypto",qs="msie",qa="trident/",qo=null,ql=null;function qc(){return typeof console!==yD?console:bO(qt)}function qd(){return!!(typeof JSON===yM&&JSON||null!==bO(qi))}function qu(){return qd()?JSON||bO(qi):null}function qh(){return bO(qn)}function qg(){return bO(qr)}function qp(){var e=bU();if(e&&(e[jF]!==ql||null===qo)){var t=((ql=e[jF])||jz)[ji]();qo=j8(t,qs)||j8(t,qa)}return qo}var qf=0x100000000,qm=0xffffffff,qv=0x75bcd15,qS=0x3ade68b1,qy=!1,qC=0x75bcd15,qb=0x3ade68b1;function qT(e){e<0&&(e>>>=0),qC=qv+e&qm,qb=qS-e&qm,qy=!0}function qE(){try{var e=0x7fffffff&bp();qT((Math.random()*qf^e)+e)}catch(e){}}function q_(e){var t=0,i=qh()||qg();return i&&i.getRandomValues&&(t=i.getRandomValues(new Uint32Array(1))[0]&qm),0===t&&qp()&&(qy||qE(),t=qI()&qm),0===t&&(t=Math.floor(qf*Math.random()|0)),e||(t>>>=0),t}function qI(e){var t=((qb=36969*(65535&qb)+(qb>>16)&qm)<<16)+(65535&(qC=18e3*(65535&qC)+(qC>>16)&qm))>>>0&qm;return e||(t>>>=0),t}var qw="3.3.1",qP="."+function(e){void 0===e&&(e=22);for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=q_()>>>0,n=0,r=jz;r[jr]<e;)n++,r+=t.charAt(63&i),i>>>=6,5===n&&(i=(q_()<<2|3&i)>>>0,n=0);return r}(6),qR=0;function qA(e){return 1===e[jU]||9===e[jU]||!+e[jU]}function qM(e,t){var i=t[e.id];if(!i){i={};try{qA(t)&&CJ(t,e.id,{e:!1,v:i})}catch(e){}}return i}function qD(e,t){return void 0===t&&(t=!1),j6(e+qR+++(t?"."+qw:jz)+qP)}function qO(e){var t={id:qD("_aiData-"+(e||jz)+"."+qw),accept:function(e){return qA(e)},get:function(e,i,n,r){var s=e[t.id];return s?s[j6(i)]:(r&&((s=qM(t,e))[j6(i)]=n),n)},kill:function(e,t){if(e&&e[t])try{delete e[t]}catch(e){}}};return t}function qk(e){return e&&Cg(e)&&(e.isVal||e.fb||Ck(e,"v")||Ck(e,"mrg")||Ck(e,"ref")||e.set)}function qN(e,t,i){var n,r=i.dfVal||Cl;if(t&&i.fb){var s=i.fb;Cp(s)||(s=[s]);for(var a=0;a<s[jr];a++){var o=s[a],l=t[o];if(r(l)?n=l:e&&(r(l=e.cfg[o])&&(n=l),e.set(e.cfg,C_(o),l)),r(n))break}}return!r(n)&&r(i.v)&&(n=i.v),n}function qx(e,t,i){var n,r=i;return i&&qk(i)&&(r=qN(e,t,i)),r&&(qk(r)&&(r=qx(e,t,r)),Cp(r)?(n=[])[jr]=r[jr]:b6(r)&&(n={}),n&&(Cx(r,function(i,r){r&&qk(r)&&(r=qx(e,t,r)),n[i]=r}),r=n)),r}function qL(e,t,i,n){var r,s,a,o,l,c,d,u,h=n;qk(h)?(r=h.isVal,s=h.set,c=h[js],d=h[jn],o=h.mrg,!(l=h.ref)&&Cr(l)&&(l=!!o),a=qN(e,t,h)):a=n,d&&e[jn](t,i);var g=!0,p=t[i];(p||!Ca(p))&&(u=p,g=!1,r&&u!==a&&!r(u)&&(u=a,g=!0),s&&(g=(u=s(u,a,t))===a)),g?u=a?qx(e,t,a):a:(b6(u)||Cp(a))&&o&&a&&(b6(a)||Cp(a))&&Cx(a,function(t,i){qL(e,u,t,i)}),e.set(t,i,u),l&&e.ref(t,i),c&&e[js](t,i)}var qF=bG("[[ai_dynCfg_1]]"),qU=bG("[[ai_blkDynCfg_1]]"),q$=bG("[[ai_frcDynCfg_1]]");function qV(e){if(e){var t;if(Cp(e)?(t=[])[jr]=e[jr]:b6(e)&&(t={}),t)return Cx(e,function(e,i){t[e]=qV(i)}),t}return e}function qB(e){if(e){var t=e[qF]||e;if(t.cfg&&(t.cfg===e||t.cfg[qF]===t))return t}return null}function qH(e){if(e&&(b6(e)||Cp(e)))try{e[qU]=!0}catch(e){}return e}function qj(e,t,i){var n=!1;return i&&!e[t.blkVal]&&((n=i[q$])||i[qU]||(n=b6(i)||Cp(i))),n}function qq(e){CR("InvalidAccess:"+e)}var qW=["push","pop","shift","unshift","splice"],qG=function(e,t,i,n){e&&e[jl](3,108,"".concat(i," [").concat(t,"] failed - ")+Cw(n))};function qz(e,t,i){Cp(t)&&CL(qW,function(n){var r=t[n];t[n]=function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var a=r[jh](this,n);return qZ(e,t,i,"Patching"),a}})}function qJ(e,t){var i=Tg(e,t);return i&&i.get}function qK(e,t,i,n){var r={n:i,h:[],trk:function(t){t&&t.fn&&(-1===bY(r.h,t)&&r.h[jg](t),e.trk(t,r))},clr:function(e){var t=bY(r.h,e);-1!==t&&r.h[jp](t,1)}},s=!0,a=!1;function o(){s&&(a=a||qj(o,e,n),n&&!n[qF]&&a&&(n=qZ(e,n,i,"Converting")),s=!1);var t=e.act;return t&&r.trk(t),n}function l(l){if(n!==l){o[e.ro]&&!e.upd&&qq("["+i+"] is read-only:"+Cw(t)),s&&(a=a||qj(o,e,n),s=!1);var c=a&&o[e.rf];if(a)if(c){Cx(n,function(e){n[e]=l?l[e]:jG});try{Cx(l,function(t,i){qQ(e,n,t,i)}),l=n}catch(t){qG((e.hdlr||{})[ju],i,"Assigning",t),a=!1}}else n&&n[qF]&&Cx(n,function(t){var i=qJ(n,t);if(i){var r=i[e.prop];r&&r.chng()}});if(l!==n){var d=l&&qj(o,e,l);!c&&d&&(l=qZ(e,l,i,"Converting")),n=l,a=d}e.add(r)}}o[e.prop]={chng:function(){e.add(r)}},CJ(t,r.n,{g:o,s:l})}function qQ(e,t,i,n){if(t){var r=qJ(t,i);r&&r[e.prop]?t[i]=n:qK(e,t,i,n)}return t}function qY(e,t,i,n){if(t){var r=qJ(t,i),s=r&&!!r[e.prop],a=n&&n[0],o=n&&n[1],l=n&&n[2];if(!s){if(l)try{qH(t)}catch(t){qG((e.hdlr||{})[ju],i,"Blocking",t)}try{qQ(e,t,i,t[i]),r=qJ(t,i)}catch(t){qG((e.hdlr||{})[ju],i,"State",t)}}a&&(r[e.rf]=a),o&&(r[e.ro]=o),l&&(r[e.blkVal]=!0)}return t}function qZ(e,t,i,n){try{Cx(t,function(i,n){qQ(e,t,i,n)}),t[qF]||(CG(t,qF,{get:function(){return e[jf]}}),qz(e,t,i))}catch(t){qG((e.hdlr||{})[ju],i,n,t)}return t}var qX="[[ai_",q0="]]";function q1(e){var t,i,n=bW(qX+"get"+e.uid+q0),r=bW(qX+"ro"+e.uid+q0),s=bW(qX+"rf"+e.uid+q0),a=bW(qX+"blkVal"+e.uid+q0),o=bW(qX+"dtl"+e.uid+q0),l=null,c=null;function d(t,n){var r=i.act;try{i.act=t,t&&t[o]&&(CL(t[o],function(e){e.clr(t)}),t[o]=[]),n({cfg:e.cfg,set:e.set.bind(e),setDf:e[jc].bind(e),ref:e.ref.bind(e),rdOnly:e[js].bind(e)})}catch(t){var s=e[ju];throw s&&s[jl](1,107,Cw(t)),t}finally{i.act=r||null}}function u(){if(l){var e=l;l=null,c&&c[jm](),c=null;var t=[];if(CL(e,function(e){if(e&&(e[o]&&(CL(e[o],function(t){t.clr(e)}),e[o]=null),e.fn))try{d(e,e.fn)}catch(e){t[jg](e)}}),l)try{u()}catch(e){t[jg](e)}t[jr]>0&&jW("Watcher error(s): ",t)}}function h(e){if(e&&e.h[jr]>0){l||(l=[]),c||(c=TP(function(){c=null,u()},0));for(var t=0;t<e.h[jr];t++){var i=e.h[t];i&&-1===bY(l,i)&&l[jg](i)}}}function g(e,t){if(e){var i=e[o]=e[o]||[];-1===bY(i,t)&&i[jg](t)}}return(t={prop:n,ro:r,rf:s})[jn]=a,t[jf]=e,t.add=h,t[ja]=u,t.use=d,t.trk=g,i=t}function q2(e,t){var i={fn:t,rm:function(){i.fn=null,e=null,t=null}};return CJ(i,"toJSON",{v:function(){return"WatcherHandler"+(i.fn?"":"[X]")}}),e.use(i,t),i}function q3(e,t,i){var n,r,s=qB(t);if(s)return s;var a=qD("dyncfg",!0),o=t&&!1!==i?t:qV(t);function l(){r[ja]()}function c(t,i,n){try{t=qQ(r,t,i,n)}catch(t){qG(e,i,"Setting value",t)}return t[i]}function d(e){return q2(r,e)}function u(e,t){r.use(null,function(i){var n=r.upd;try{Cr(t)||(r.upd=t),e(i)}finally{r.upd=n}})}function h(e,t){var i;return qY(r,e,t,((i={})[0]=!0,i))[t]}function g(e,t){var i;return qY(r,e,t,((i={})[1]=!0,i))[t]}function p(e,t){var i;return qY(r,e,t,((i={})[2]=!0,i))[t]}function f(e,t){return t&&Cx(t,function(t,i){qL(m,e,t,i)}),e}var m=((n={uid:null,cfg:o})[ju]=e,n[ja]=l,n.set=c,n[jc]=f,n[jd]=d,n.ref=h,n[js]=g,n[jn]=p,n._block=u,n);return CJ(m,"uid",{c:!1,e:!1,w:!1,v:a}),qZ(r=q1(m),o,"config","Creating"),m}function q4(e,t){e?(e[jo](t),e[jl](2,108,t)):qq(t)}function q5(e,t,i,n){var r=q3(i,e||{},n);return t&&r[jc](r.cfg,t),r}function q6(e,t,i){var n=e[qF]||e;return n.cfg&&(n.cfg===e||n.cfg[qF]===n)?n[jd](t):(q4(i,j1+Cw(e)),q5(e,null,i)[jd](t))}var q8=null;function q9(){var e=bO("Microsoft");return e&&(q8=e.ApplicationInsights),q8}function q7(e){var t=q8;return t||!0===e.disableDbgExt||(t=q8||q9()),t?t.ChromeDbgExt:null}var We="warnToConsole",Wt="AI (Internal): ",Wi="AI: ",Wn="AITR_",Wr={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},Ws=((eu={})[0]=null,eu[1]="errorToConsole",eu[2]=We,eu[3]="debugToConsole",eu);function Wa(e){return e?'"'+e[j$](/\"/g,jz)+'"':jz}function Wo(e,t){var i=qc();if(i){var n="log";i[e]&&(n=e),Ch(i[n])&&i[n](t)}}var Wl=function(){function e(e,t,i,n){void 0===i&&(i=!1);var r=this;r[jA]=e,r[jM]=(i?Wi:Wt)+e;var s=jz;qd()&&(s=qu().stringify(n));var a=(t?" message:"+Wa(t):jz)+(n?" props:"+Wa(s):jz);r[jM]+=a}return e.dataType="MessageData",e}();function Wc(e,t){return(e||{})[ju]||new Wd(t)}var Wd=function(){function e(t){this.identifier="DiagnosticLogger",this.queue=[];var i,n,r,s,a,o=0,l={};Ea(e,this,function(e){function c(t,i){if(!d()){var s=!0,a=Wn+i[jA];if(l[a]?s=!1:l[a]=!0,s&&(t<=n&&(e.queue[jg](i),o++,u(1===t?"error":"warn",i)),o===r)){var c="Internal events throttle limit per PageView reached for this app.",h=new Wl(23,c,!1);e.queue[jg](h),1===t?e.errorToConsole(c):e[jo](c)}}}function d(){return o>=r}function u(e,i){var n=q7(t||{});n&&n[jO]&&n[jO](e,i)}a=function t(t){return q6(q5(t,Wr,e).cfg,function(e){var t=e.cfg;i=t[jw],n=t.loggingLevelTelemetry,r=t.maxMessageLimit,s=t.enableDebug})}(t||{}),e.consoleLoggingLevel=function(){return i},e[jl]=function(t,n,r,a,o){void 0===o&&(o=!1);var d=new Wl(n,r,o,a);if(s)throw Cw(d);var h=Ws[t]||We;if(Cr(d[jM]))u("throw"+(1===t?"Critical":"Warning"),d);else{if(o){var g=+d[jA];!l[g]&&i>=t&&(e[h](d[jM]),l[g]=!0)}else i>=t&&e[h](d[jM]);c(t,d)}},e.debugToConsole=function(e){Wo("debug",e),u("warning",e)},e[jo]=function(e){Wo("warn",e),u("warning",e)},e.errorToConsole=function(e){Wo("error",e),u("error",e)},e.resetInternalMessageCount=function(){o=0,l={}},e[jV]=c,e[jI]=function(e){a&&a.rm(),a=null}})}return e.__ieDyn=1,e}();function Wu(e){return e||new Wd}function Wh(e,t,i,n,r,s){void 0===s&&(s=!1),Wu(e)[jl](t,i,n,r,s)}var Wg="ctx",Wp="ParentContextKey",Wf="ChildrenContextKey",Wm=function(){function e(t,i,n){var r,s=this;s.start=bp(),s[jb]=t,s[jD]=n,s[jB]=function(){return!1},Ch(i)&&CJ(s,"payload",{g:function(){return!r&&Ch(i)&&(r=i(),i=null),r}}),s[jH]=function(t){return t?t===e[Wp]||t===e[Wf]?s[t]:(s[Wg]||{})[t]:null},s[jj]=function(t,i){t&&(t===e[Wp]?(s[t]||(s[jB]=function(){return!0}),s[t]=i):t===e[Wf]?s[t]=i:(s[Wg]=s[Wg]||{})[t]=i)},s[jq]=function(){var t=0,i=s[jH](e[Wf]);if(Cp(i))for(var n=0;n<i[jr];n++){var r=i[n];r&&(t+=r[jT])}s[jT]=bp()-s.start,s.exTime=s[jT]-t,s[jq]=function(){}}}return e.ParentContextKey="parent",e.ChildrenContextKey="childEvts",e}();!function(){function e(t){this.ctx={},Ea(e,this,function(e){e.create=function(e,t,i){return new Wm(e,t,i)},e.fire=function(e){e&&(e[jq](),t&&Ch(t[jX])&&t[jX](e))},e[jj]=function(t,i){t&&((e[Wg]=e[Wg]||{})[t]=i)},e[jH]=function(t){return(e[Wg]||{})[t]}})}e.__ieDyn=1}();var Wv="CoreUtils.doPerf";function WS(e,t,i,n,r){if(e){var s=e;if(s[j0]&&(s=s[j0]()),s){var a=void 0,o=s[jH](Wv);try{if(a=s.create(t(),n,r)){if(o&&a[jj]&&(a[jj](Wm[Wp],o),o[jH]&&o[jj])){var l=o[jH](Wm[Wf]);l||(l=[],o[jj](Wm[Wf],l)),l[jg](a)}return s[jj](Wv,a),i(a)}}catch(e){a&&a[jj]&&a[jj]("exception",e)}finally{a&&s.fire(a),s[jj](Wv,o)}}}return i()}function Wy(){var e=WC();return bo(e,0,8)+"-"+bo(e,8,12)+"-"+bo(e,12,16)+"-"+bo(e,16,20)+"-"+bo(e,20)}function WC(){for(var e,t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],i=jz,n=0;n<4;n++)i+=t[15&(e=q_())]+t[e>>4&15]+t[e>>8&15]+t[e>>12&15]+t[e>>16&15]+t[e>>20&15]+t[e>>24&15]+t[e>>28&15];var r=t[8+(3&q_())|0];return bl(i,0,8)+bl(i,9,4)+"4"+bl(i,13,3)+r+bl(i,16,3)+bl(i,19,12)}var Wb=qO("plugin");function WT(e){return Wb.get(e,"state",{},!0)}var WE="TelemetryPluginChain",W_="_hasRun",WI="_getTelCtx",Ww=0;function WP(e,t,i){for(;e;){if(e[jC]()===i)return e;e=e[jx]()}return WO([i],t.config||{},t)}function WR(e,t,i,n){var r=null,s=[];t||(t=q5({},null,i[ju])),null!==n&&(r=n?WP(e,i,n):e);var a={_next:l,ctx:{core:function(){return i},diagLog:function(){return Wc(i,t.cfg)},getCfg:function(){return t.cfg},getExtCfg:d,getConfig:u,hasNext:function(){return!!r},getNext:function(){return r},setNext:function(e){r=e},iterate:h,onComplete:o}};function o(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e&&s[jg]({func:e,self:Cr(t)?a.ctx:t,args:i})}function l(){var e=r;if(r=e?e[jx]():null,!e){var t=s;t&&t[jr]>0&&(CL(t,function(e){try{e.func.call(e.self,e.args)}catch(e){Wh(i[ju],2,73,"Unexpected Exception during onComplete - "+Cw(e))}}),s=[])}return e}function c(e,i){var n=null,r=t.cfg;if(r&&e){var s=r[jQ];!s&&i&&(s={}),r[jQ]=s,(s=t.ref(r,jQ))&&((n=s[e])||!i||(n={}),s[e]=n,n=t.ref(s,e))}return n}function d(e,i){var n=c(e,!0);return i&&Cx(i,function(e,i){if(Ca(n[e])){var r=t.cfg[e];(r||!Ca(r))&&(n[e]=r)}qL(t,n,e,i)}),t[jc](n,i)}function u(e,i,n){void 0===n&&(n=!1);var r,s=c(e,!1),a=t.cfg;return s&&(s[i]||!Ca(s[i]))?r=s[i]:(a[i]||!Ca(a[i]))&&(r=a[i]),r||!Ca(r)?r:n}function h(e){for(var t;t=a._next();){var i=t[jC]();i&&e(i)}}return a}function WA(e,t,i,n){var r=q5(t),s=WR(e,r,i,n),a=s.ctx;function o(e){var t=s._next();return t&&t[jY](e,a),!t}function l(e,t){return void 0===e&&(e=null),Cp(e)&&(e=WO(e,r.cfg,i,t)),WA(e||a[jx](),r.cfg,i,t)}return a[jE]=o,a[jP]=l,a}function WM(e,t,i){var n=q5(t.config),r=WR(e,n,t,i),s=r.ctx;function a(e){var t=r._next();return t&&t[jI](s,e),!t}function o(e,i){return void 0===e&&(e=null),Cp(e)&&(e=WO(e,n.cfg,t,i)),WM(e||s[jx](),t,i)}return s[jE]=a,s[jP]=o,s}function WD(e,t,i){var n=q5(t.config),r=WR(e,n,t,i).ctx;function s(e){return r.iterate(function(t){Ch(t[jN])&&t[jN](r,e)})}function a(e,i){return void 0===e&&(e=null),Cp(e)&&(e=WO(e,n.cfg,t,i)),WD(e||r[jx](),t,i)}return r[jE]=s,r[jP]=a,r}function WO(e,t,i,n){var r=null,s=!n;if(Cp(e)&&e[jr]>0){var a=null;CL(e,function(e){if(s||n!==e||(s=!0),s&&e&&Ch(e[jY])){var o=Wk(e,t,i);r||(r=o),a&&a._setNext(o),a=o}})}return n&&!r?WO([n],t,i):r}function Wk(e,t,i){var n,r=null,s=Ch(e[jY]),a=Ch(e[jL]),o={getPlugin:function(){return e},getNext:function(){return r},processTelemetry:d,unload:u,update:h,_id:n=e?e[jS]+"-"+e[jZ]+"-"+Ww++:"Unknown-0-"+Ww++,_setNext:function(e){r=e}};function l(){var n;return e&&Ch(e[WI])&&(n=e[WI]()),n||(n=WA(o,t,i)),n}function c(t,i,s,a,o){var l=!1,c=e?e[jS]:WE,d=t[W_];return d||(d=t[W_]={}),t.setNext(r),e&&WS(t[jJ](),function(){return c+":"+s},function(){d[n]=!0;try{var e=r?r._id:jz;e&&(d[e]=!1),l=i(t)}catch(e){var a=!r||d[r._id];a&&(l=!0),r&&a||Wh(t[jO](),1,73,"Plugin ["+c+"] failed during "+s+" - "+Cw(e)+", run flags: "+Cw(d))}},a,o),l}function d(t,i){function n(i){if(!e||!s)return!1;var n=WT(e);return!n[jR]&&!n[jK]&&(a&&e[jL](r),e[jY](t,i),!0)}c(i=i||l(),n,"processTelemetry",function(){return{item:t}},!t.sync)||i[jE](t)}function u(t,i){function n(){var n=!1;if(e){var r=WT(e),s=e[jJ]||r[jJ];e&&(!s||s===t.core())&&!r[jR]&&(r[jJ]=null,r[jR]=!0,r[jy]=!1,e[jR]&&!0===e[jR](t,i)&&(n=!0))}return n}c(t,n,"unload",function(){},i[jD])||t[jE](i)}function h(t,i){function n(){var n=!1;if(e){var r=WT(e),s=e[jJ]||r[jJ];e&&(!s||s===t.core())&&!r[jR]&&e[jN]&&!0===e[jN](t,i)&&(n=!0)}return n}c(t,n,"update",function(){},!1)||t[jE](i)}return C6(o)}function WN(){var e=[];return{add:function(t){t&&e[jg](t)},run:function(t,i){CL(e,function(e){try{e(t,i)}catch(e){Wh(t[jO](),2,73,"Unexpected error calling unload handler - "+Cw(e))}}),e=[]}}}function Wx(){var e=[];return{run:function(t){var i=e;e=[],CL(i,function(e){try{(e.rm||e.remove).call(e)}catch(e){Wh(t,2,73,"Unloading:"+Cw(e))}}),eh&&i[jr]>eh&&(eg?eg("doUnload",i):Wh(null,1,48,"Max unload hooks exceeded. An excessive number of unload hooks has been detected."))},add:function(t){t&&(bQ(e,t),eh&&e[jr]>eh&&(eg?eg("Add",e):Wh(null,1,48,"Max unload hooks exceeded. An excessive number of unload hooks has been detected.")))}}}var WL="getPlugin",WF=((ep={})[jQ]={isVal:j5,v:{}},ep),WU=function(){function e(){var t,i,n,r,s,a=this;function o(e){void 0===e&&(e=null);var t=e;if(!t){var r=i||WA(null,{},a[jJ]);t=n&&n[WL]?r[jP](null,n[WL]):r[jP](null,n)}return t}function l(e,t,r){q5(e,WF,Wc(t)),!r&&t&&(r=t[j_]()[jx]());var s=n;n&&n[WL]&&(s=n[WL]()),a[jJ]=t,i=WA(r,e,t,s)}function c(){t=!1,a[jJ]=null,i=null,n=null,s=Wx(),r=WN()}c(),Ea(e,a,function(e){e[jv]=function(e,i,n,r){l(e,i,r),t=!0},e[jR]=function(t,i){var a,o,l=e[jJ];if(l&&(!t||l===t[jJ]())){var d=!1,u=t||WM(null,l,n&&n[WL]?n[WL]():n),h=i||(a={reason:0},a[jD]=!1,a);return e[jk]&&!0===e[jk](u,h,g)?o=!0:g(),o}function g(){d||(d=!0,r.run(u,i),s.run(u[jO]()),!0===o&&u[jE](h),c())}},e[jN]=function(t,i){var r,s=e[jJ];if(s&&(!t||s===t[jJ]())){var a=!1,o=t||WD(null,s,n&&n[WL]?n[WL]():n),c=i||{reason:0};return e._doUpdate&&!0===e._doUpdate(o,c,d)?r=!0:d(),r}function d(){a||(a=!0,l(o.getCfg(),o.core(),o[jx]()))}},qe(e,"_addUnloadCb",function(){return r},"add"),qe(e,"_addHook",function(){return s},"add"),CJ(e,"_unloadHooks",{g:function(){return s}})}),a[jO]=function(e){return o(e)[jO]()},a[jy]=function(){return t},a.setInitialized=function(e){t=e},a[jL]=function(e){n=e},a[jE]=function(e,t){t?t[jE](e):n&&Ch(n[jY])&&n[jY](e,null)},a._getTelCtx=o}return e.__ieDyn=1,e}(),W$="",WV="timings",WB="processTelemetryStart";function WH(e){if(e){var t=Tm(e,"-");if(t>-1)return bd(e,t)}return W$}yN.hasOwnProperty,(ef={})[0]=0,ef[2]=6,ef[1]=1,ef[3]=7,ef[4098]=6,ef[4097]=1,ef[4099]=7,bk(),bx();var Wj=Th;function Wq(e,t){var i=e;i[WV]=i[WV]||{},i[WV][WB]=i[WV][WB]||{},i[WV][WB][t]=Wj()}function WW(e){return e>0}function WG(e){return Cm(e)&&e>=1&&e<=2}!function(e){e[e.LocalStorage=1]="LocalStorage",e[e.SessionStorage=2]="SessionStorage",e[e.IndexedDb=3]="IndexedDb"}(em||(em={}));var Wz="readwrite",WJ="result",WK="DBError: Unable to open database",WQ="Database is not open",WY="DBError: Failed to Open Cursor",WZ="DBError: Failed to delete the database",WX="DBError: Database does not exist",W0="DBError: Database upgrade required",W1="DBError: Feature not supported",W2=["indexedDB"],W3=Ch,W4=Cu,W5=0;function W6(){var e=bD()||{},t=null;if(e)try{for(var i=0;i<W2.length;i++)if((t=e[W2[i]])&&W3(t.open))return t}catch(e){t=null}return t||null}function W8(e,t){bO("QUnit")&&console&&console.log("  ["+j9(new Date)+"]: IndexedDbHelper ["+e+"] "+t)}function W9(e,t,i){e&&e.warnToConsole("IndexedDbHelper ["+t+"] "+i)}function W7(e,t,i,n){return function(r){i(Error(t)),W8(e,"["+n+"] event rejected")}}var Ge=[];function Gt(e,t){for(var i=null,n=0;n<Ge.length;n++)if((i=Ge[n]).name===e)return i;return i={name:e,sch:_0(_F,"IndexedDbHelper["+e+"]"),dbHdl:[],add:function(t){i.dbHdl.push(t),W8(e,"- dbOpened (add) -- hdls ["+i.dbHdl.length+"]")},remove:function(t){for(var n=i.dbHdl,r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1);break}W8(e,"- dbClosed (remove) -- hdls ["+i.dbHdl.length+"]")},isOpen:function(){return i.dbHdl.length>0},openHdl:function(){return i.dbHdl.length>0?i.dbHdl[0]:null}},Ge.push(i),i}var Gi=function(){function e(t){var i=W5++,n=0;Ea(e,this,function(e){var r=W6()||null;function s(e,r,s){var l=e.db,c=n++;W8(e.dbName,"["+i+":"+c+"] txn.open - "+r+" -- "+s);var d=l.transaction(r,Wz);return d.onabort=function(){W9(t,e.dbName,"["+i+":"+c+"] txn.onabort - "+r+" -- "+s+" -- "+Cw(d.error))},d.onerror=function(){W9(t,e.dbName,"["+i+":"+c+"] txn.onerror - "+r+" -- "+s)},d.oncomplete=function(){W8(e.dbName,"["+i+":"+c+"] txn.oncomplete - "+r+" -- "+s)},{db:e,store:d.objectStore(r),tx:d,tbl:r,openCursor:function(t,i){return o(e,r,t,i)},newTransaction:function(t){return a(e,r,t)}}}function a(e,t,i){if(!e||!e.db)return _V(Error(WQ));try{var n=i(s(e,t,"openStore"));if(Cy(n))return n;return _$(n)}catch(e){return _V(e)}}function o(e,t,i,n){if(!e||!e.db)return _V(Error(WQ));var r=null;return i&&W4(i)?r=new Gn(i):i&&i.isMatch&&(r=i),_F(function(i,a){var o=[],l=null,c=null;r&&r.keyRange&&(c=r.keyRange());var d=s(e,t,"openCursor");(l=c?d.store.openCursor(c):d.store.openCursor()).onerror=W7(d.db.dbName,WY,a,"openCursor"),l.onsuccess=function(e){var t=e.target[WJ];if(!t)return void i(o);var s={store:d,cursor:t,continue:function(){t.continue()},done:function(){i(o)}},l=t.value;if(r&&!r.isMatch(l))return void s.continue();if(n)try{switch(n(s,l,o)){case 2:i(o);break;case 1:break;default:s.continue()}}catch(e){a(e)}else o.push(l),s.continue()}})}function l(e,t,i,n){return Gt(e).sch.queue(i,t,n)}e.isAvailable=function(){return!!r},e.openDb=function(e,i,n,s){return l(e,"openDb",function(l){return _F(function(c,d){var u=!1;function h(t,n,r,s,l){var c={db:n,dbName:e,dbVersion:i,ctx:null,isNew:s,txn:r?r.transaction:null};return l||(c.openStore=function(e,t){return a(c,e,t)},c.openCursor=function(e,t,i){return o(c,e,t,i)}),c}function g(e,t){var i=h(null,e,t,!0,!0);if(!s){try{t.transaction&&t.transaction.abort()}finally{d(Error(W0))}return}u=!0,_m(s(i),function(e){if(e.rejected)try{t.transaction&&t.transaction.abort()}finally{d(e.reason)}else i.txn||(i.txn=t.transaction)})}function p(i,r){var s=Gt(e);s.add(i),i.onabort=function(n){W9(t,e,"onabort -- closing the Db"),s.remove(i)},i.onerror=function(n){W9(t,e,"onerror -- closing the Db"),s.remove(i)},i.onclose=function(n){W9(t,e,"onclose -- closing the Db"),s.remove(i)},i.onversionchange=function(n){W9(t,e,"onversionchange -- force closing the Db"),i.close(),s.remove(i)};var a=null,o=null;s.dbHdl.length>0&&(o=s.dbHdl[0]),a=h(s,o,r,u);try{_v(n(a),c,d)}catch(e){d(e)}}var f=Gt(e);if(null==r)d(Error("No available storage factory"));else if(f.isOpen())_v(n(h(f,f.openHdl(),null,!1)),c,d);else{var m=r.open(e,i);m.onblocked=function(i){W9(t,e,"Db Open Blocked event ["+l+"] - "+(m.error||"")),d(Error(WK))},m.onerror=function(i){W9(t,e,"Db Open Error event ["+l+"] - "+(m.error||"")),d(Error(WK))},m.onupgradeneeded=function(t){W8(e,"Db Open Create/Upgrade needed event ["+l+"]");try{var i=t.target[WJ];if(!i)return void d(Error(WK));g(i,m)}catch(t){W7(e,WK,d,l)(t)}},m.onsuccess=function(e){var t=e.target[WJ];if(!t)return void d(Error(WK));p(t,m)}}})})},e.closeDb=function(e){l(e,"closeDb",function(t){var i=Gt(e),n=i.dbHdl,r=n.length;if(r>0){for(var s=0;s<r;s++)n[s].close();i.dbHdl=[]}return 1}).catch(function(e){})},e.deleteDb=function(e){return null!=r&&l(e,"deleteDb",function(i){var n=Gt(e),s=n.dbHdl,a=s.length;if(a>0){W9(t,e,"Db is open ["+a+"] force closing");for(var o=0;o<a;o++)s[o].close();n.dbHdl=[]}return _F(function(n,s){setTimeout(function(){try{W8(e,"["+i+"] starting");var a=r.deleteDatabase(e);a.onerror=function(n){W9(t,e,"["+i+"] error!!"),s(Error(WZ))},a.onblocked=function(n){W9(t,e,"["+i+"] blocked!!"),s(Error(WZ))},a.onupgradeneeded=function(n){W9(t,e,"["+i+"] upgrade needed!!"),s(Error(WZ))},a.onsuccess=function(t){W8(e,"["+i+"] complete"),n(!0)},W8(e,"["+i+"] started")}catch(n){W9(t,e,"["+i+"] threw - "+n),s(Error(WZ+" - "+n))}},0)})})},e.getDbDetails=function(e){return l(e,"getDbDetails",function(t){return null!=r&&r.databases?_F(function(t,i){r.databases().then(function(n){for(var r=0;r<n.length;r++)if(n[r].name===e)return void t(n[r]);i(Error(WX))},i)}):_V(Error(W1))},2e3)}})}return e.__ieDyn=1,e}(),Gn=function(){function e(t){var i=[],n=null;Ea(e,this,function(e){e.keyRange=function(){return n},e.parseQuery=function(t){if(i=[],t)for(var r=t.split(";"),s=0;s<r.length;s++){var a=r[s],o=a.indexOf("=");if(-1!==o){var l=a.substring(0,o),c=a.substring(o+1);0===l.indexOf("#")&&(l=l.substring(1),n||(n=IDBKeyRange.bound(c,c+"￿"))),e.startsWith(l,c)}}},e.startsWith=function(e,t){i.push({name:e,value:t,type:0})},e.contains=function(e,t){i.push({name:e,value:t,type:1})},e.isMatch=function(e){if(!i||0===i.length)return!0;if(!e)return!1;for(var t=0;t<i.length;t++){var n=i[t],r=e[n.name];if(r){if(0===n.type){if(0!==r.indexOf(n.value))return!1}else if(1===n.type&&-1===r.indexOf(n.value))return!1}}return!0},t&&e.parseQuery(t)})}return e.__ieDyn=1,e}(),Gr=10,Gs=1,Ga=6e5,Go=6048e5,Gl="Unknown",Gc=-1,Gd="DBError: Unable to add event",Gu="DBError: Unable to update iKey",Gh=1,Gg="Evts",Gp="iKey",Gf=WG;function Gm(){return new Date().getTime()}function Gv(e,t){return function(i){return t(Error(e))}}function GS(e){e.objectStoreNames.contains(Gg)||e.createObjectStore(Gg,{keyPath:"key"}).createIndex("EvntId","key",{unique:!1}),e.objectStoreNames.contains(Gp)||e.createObjectStore(Gp,{keyPath:"iKey"}).createIndex("iKey","iKey",{unique:!0})}function Gy(e){return e.openStore(Gp,function(t){return _F(function(i,n){var r={iKey:e.ctx.iKey,tm:Gm()},s=t.store.put(r);s.onsuccess=function(e){i(s.result.toString())},s.onerror=function(e){n(Error(Gd))},s.onerror=Gv(Gu,n)})})}function GC(e){for(var t=[],i=2;i>=1;i--)for(var n=0;n<e.length;n++){var r=e[n];r&&r.evt.persistence===i&&t.push(r.evt)}return t}function Gb(e,t){for(var i=0;i<e.length;i++)if(t.tm<e[i].tm)return void e.splice(i,0,t);e.push(t)}function GT(e,t){for(var i=t.length,n=0;n<i;n++)if(e===t[n].id)return n;return -1}function GE(e,t){var i=e.tm;return Gm()-i>t}function G_(e){return function(t){return e.continue()}}function GI(e){var t=e.cursor.delete();return t.onerror=G_(e),t.onsuccess=G_(e),1}function Gw(e,t){return e.openCursor(Gg,t,function(e,t,i){return i.push(t),0})}function GP(e,t,i){return e.openCursor(Gg,t,function(e,t,n){return i(t)?(n.push(t),GI(e)):0})}function GR(e){return _F(function(t,i){var n=!1;e.openCursor(Gp,null,function(e,t,i){var r=t.tm;return Gm()-r<Go?0:(n=!0,2)}).then(function(){if(!n)return void t([]);var r={};GP(e,null,function(e){if(!e||!e.evt||!e.evt.iKey)return!0;var t=e.tm;return Gm()-t>Go||(r[e.evt.iKey]=1,!1)}).then(function(){var n=[];e.openCursor(Gp,null,function(e,t,i){var s=t.tm;return Gm()-s<Go||r[t.iKey]?0:(n.push(t),GI(e))}).then(function(){t(n)},i)},i)},i)})}function GA(e,t){return e.openCursor(Gg,"#key="+e.ctx.iKeyPrefix(),function(i,n){var r=n.key;if(0===r.indexOf(e.ctx.iKeyPrefix())&&-1===r.indexOf(e.ctx.evtKeyPrefix())&&GE(n,t)){n.key=e.ctx.evtKeyPrefix()+n.id;var s=i.store.store.put(n);return s.onerror=G_(i),s.onsuccess=function(e){try{GI(i)}catch(e){i.continue()}},1}return 0})}function GM(e,t){return _F(function(i,n){GR(e).then(function(){GA(e,t).then(i,i)},n)})}function GD(e,t){return _F(function(i,n){var r=0,s=e.ctx.evtKeyPrefix();function a(){i(r)}function o(e,t){return _F(function(i){var n=e.store.delete(t.key);n.onsuccess=function(e){r++,i()},n.onerror=function(e){i()}})}function l(t){if(0===t.length)return void a();e.openStore(Gg,function(e){for(var i=[],n=0;n<t.length;n++)i.push(o(e,t[n]));return _U(i).then(a,a)})}e.openCursor(Gg,"#key="+s,function(e,i,n){return i.evt.persistence<=t&&0===i.key.indexOf(s)&&(Gb(n,i),n.length>Gr&&n.splice(n.length-1,1)),0}).then(l,function(){i(0)})})}var GO=function(){function e(t,i){Ea(e,this,function(e){var n=null,r=null,s=Gl,a=null,o=null,l=null,c=Gc,d=0,u=Ga;function h(e){function t(e){return _F(function(t,i){GS(e.db),t()})}function i(t){return _F(function(i,n){t.ctx={iKey:s,storageId:a,iKeyPrefix:function(){return o},evtKeyPrefix:function(){return l}},_v(Gy(t),function(){_v(e(t),i,n)},n)})}return n.openDb(r,Gh,i,t)}function g(e,t,i){return _F(function(n,r){function s(t,i){GD(e,t).then(function(e){e>0&&(d-=e),i(e)},function(e){i(0)})}function a(e){n(t.evt)}function o(){e.openStore(Gg,function(o){var l=o.store.put(t);l.onsuccess=function(r){i&&Gy(e).then(a,a),d++,n(t.evt)},l.onerror=function(a){if(!i)return void r(Error(Gd));function o(i){0===i&&r(Error(Gd)),g(e,t,!1).then(function(e){n(t.evt)},function(){r(Error(Gd))})}s(1,function(e){e>0?o(e):t.evt.persistence>=2?s(2,function(e){o(e)}):r(Error(Gd))})}})}c>0&&d>=c?s(1,function(e){0===e?t.evt.persistence>=2?s(2,function(e){o()}):r(Error(Gd)):o()}):o()})}e.id=t,e.initialize=function(t){var d=t.itemCtx.diagLog();if(!(n=new Gi(d)).isAvailable())return n=null,!1;var g=t.itemCtx.getCfg(),p=t.storageConfig;s=g.instrumentationKey||s,a=e.id||t.id||Wy(),l=(o=s+"::")+a+"::",u=p.accessThresholdInMs||u;var f=q6(p,function(){c=p.maxStorageItems;var t=p.indexedDbName;r&&t!==r&&r&&_m(e.clear(),function(e){r=t,h(function(e){return e.isNew?[]:GM(e,u)}).then(function(e){},function(e){d.warnToConsole("IndexedDbProvider failed to initialize - "+(e||"<unknown>")),n=null})}),r=t});return i&&i.add(f),h(function(e){return e.isNew?[]:GM(e,u)}).then(function(e){},function(e){d.warnToConsole("IndexedDbProvider failed to initialize - "+(e||"<unknown>")),n=null}),!0},e._getDbgPlgTargets=function(){return[r]},e.supportsSyncRequests=function(){return!1},e.getAllEvents=function(){return null!=n&&n.isAvailable()?h(function(e){return _F(function(t,i){Gw(e,"#key="+e.ctx.evtKeyPrefix()).then(function(e){d=e.length,t(GC(e))},i)})}):[]},e.addEvent=function(e,t,i){return null!=n&&n.isAvailable()?(t.id=t.id||Wy(),Gf(t.persistence)||(t.persistence=1),h(function(i){var n=e||t.id,r={key:i.ctx.evtKeyPrefix()+n,id:n,evt:t,tm:Gm(),v:Gs};return g(i,r,!0)})):t},e.removeEvents=function(e){if(null==n||!n.isAvailable())return[];var t=[];return _F(function(i,n){h(function(i){return i.openCursor(Gg,"#key="+i.ctx.iKey,function(i,n,r){if(-1!==GT(n.id,e)){var s=i.cursor.delete();return s.onerror=G_(i),s.onsuccess=function(){t.push(n.evt),i.continue()},1}return 0})}).then(function(e){d-=t.length,i(t)},function(e){d-=t.length,i(t)})})},e.clear=function(){return null!=n&&n.isAvailable()?_F(function(e,t){h(function(e){return GP(e,"#key="+e.ctx.evtKeyPrefix(),function(t){return 0===t.key.indexOf(e.ctx.evtKeyPrefix())})}).then(function(t){d=0,e(GC(t))},t)}):[]},e.moveStaleEvents=function(){h(function(e){return GM(e,u)})},e.teardown=function(){n&&n.closeDb(r)}})}return e.__ieDyn=1,e}(),Gk=10,GN="3",Gx="Version",GL="AWTEvents",GF=5e6;function GU(e,t){var i=!1;return t instanceof DOMException&&(22===t.code||"QuotaExceededError"===t.name||1014===t.code||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length&&(i=!0),i}function G$(e){var t=bD()||{},i=null;try{if(i=t[e]){var n="__storage_test__";i.setItem(n,n),i.removeItem(n)}}catch(e){GU(i,e)||(i=null)}return i}function GV(e,t){if(e)for(var i=C3(e),n=0;n<i.length;n++){var r=i[n];if(!t(e[r],r))break}}function GB(e){var t=!0;return GV(e,function(e,i){return e&&(t=!1),t}),t}function GH(e,t){for(var i=1,n=0,r=function(){var e=[],r=t[i];if(GV(r,function(t,i){return e.push(i),++n<Gk}),n>0){for(var s=0;s<e.length;s++)delete r[e[s]];return{value:!0}}i++};i<=e&&n<Gk;){var s=r();if("object"==typeof s)return s.value}return n>0}var Gj=WG,Gq=function(){function e(t,i,n){Ea(e,this,function(e){var r=null,s=GL,a=null,o=GN,l=null,c=null,d=GF,u=6e5,h=null,g=null;function p(e,t){return{key:e,db:t}}function f(e,t){void 0===t&&(t=!0);var i=null;if(r){var n=r.getItem(e);if(n)try{i=JSON.parse(n)}catch(t){r.removeItem(e)}}return t&&!i&&(i={events:{1:{},2:{},3:{}},lastAccessTime:0}),p(e,i)}function m(e,t){void 0===t&&(t=!0);var i=!0,n=e.db;if(n){t&&(n.lastAccessTime=new Date().getTime());for(var s=1;s<=2;s++)if(!GB(n.events[s])){i=!1;break}}try{if(i)r&&r.removeItem(e.key);else{var a=JSON.stringify(n);if(a.length>d)return!1;r&&r.setItem(e.key,a)}}catch(e){return!1}return!0}function v(e){var t=[],i=f(e,!1),n=i.db;if(n){var s=n.events;try{for(var a=1;a<=2;a++)GV(s[a],function(e,i){return e&&t.push(e),!0})}catch(e){}r&&r.removeItem(i.key)}return t}function S(){if(r){for(var e=r.getItem(h),t=[],i=f(g),n=!1,a=0;a<r.length;a++){var l=r.key(a);if(0===l.indexOf(s)&&l!==h){if(e!==GN){t.push(p(l,null));continue}var d=f(l,!1),v=d.db;if(v){if(new Date().getTime()-v.lastAccessTime>u){for(var S=1,y=function(){var e=v.events[S],t=i.db.events[S];GV(e,function(i,n){return(WH(i.iKey)||i.iKey)===c&&(t[n]=i,delete e[n]),!0}),S++};S<=2;)y();n=!0,t.push(d)}}else t.push(p(l,null))}}for(var a=0;a<t.length;a++)m(t[a],!1);n&&m(i),r.setItem(h,o)}}e.id=i,r=G$(t)||null,e._getDbgPlgTargets=function(){return[s,d]},e.initialize=function(t){if(!r)return!1;var i=t.storageConfig;a=e.id||t.id||Wy(),c=WH(l=t.itemCtx.getCfg().instrumentationKey)||l,u=i.accessThresholdInMs?i.accessThresholdInMs:u;var o=q6(i,function(){d=i.maxStorageSizeInBytes;var t=i.storageKey;s&&t!==s&&_m(e.clear(),function(e){g=(s=t)+"."+a,h=s+Gx,S()})});return n&&n.add(o),g=(s=i.storageKey)+"."+a,h=s+Gx,S(),!0},e.supportsSyncRequests=function(){return!0},e.getAllEvents=function(){try{var e=[],t=f(g,!1).db;if(t)for(var i=t.events,n=2;n>=1;n--)GV(i[n],function(t){return t&&(WH(t.iKey)||t.iKey)===c&&e.push(t),!0});return e}catch(e){return _V(e)}},e.addEvent=function(e,t,i){try{var n=f(g);t.id=t.id||Wy(),Gj(t.persistence)||(t.persistence=1);for(var r=t.persistence,s=t.id,a=n.db.events;;){if(a[r][s]=t,m(n))return t;if(delete a[r][s],!GH(r,a))return _V(Error("Unable to free up event space"))}}catch(e){return _V(e)}},e.removeEvents=function(e){try{var t=f(g,!1),i=t.db;if(i){var n=i.events;try{for(var r=0;r<e.length;++r){var s=e[r];delete n[s.persistence][s.id]}if(m(t))return e}catch(e){}e=v(t.key)}return e}catch(e){return _V(e)}},e.clear=function(){try{var e=[],t=f(g,!1),i=t.db;if(i){for(var n=i.events,r=function(t){var i=n[t];GV(i,function(t){return t&&(WH(t.iKey)||t.iKey)===c&&(delete i[t.id],e.push(t)),!0})},s=2;s>=1;s--)r(s);m(t)}return e}catch(e){return _V(e)}},e.teardown=function(){try{var e=f(g,!1),t=e.db;t&&(t.lastAccessTime=0,m(e,!1))}catch(e){}},e.moveStaleEvents=function(){S()}})}return e.__ieDyn=1,e}(),GW="4.3.1",GG="LocalStorage",Gz=5,GJ=WG,GK=void 0,GQ="AppInsightEvents.1",GY=C5({maxStorageSizeInBytes:{isVal:WW,v:5e6},storageKey:"AWTEvents",minPersistenceLevel:{isVal:GJ,v:1},providers:[em.LocalStorage,em.IndexedDb],indexedDbName:GQ,maxStorageItems:{isVal:WW,v:GK}}),GZ=function(e){function t(){var i=e.call(this)||this;return i.identifier=GG,i.priority=1009,i.version=GW,Ea(t,i,function(e,t){var i,n,r,s;function a(){i=!1,n=!1,r=null,s=[]}function o(e,t){r||(r=_0(_F,"LocalStorage")),r.queue(function(e){return t(e)},e).catch(function(e){})}function l(t){WS(e.core,function(){return"LocalStorageChannel:_sendStoredEventsToNextPlugin"},function(){o("sendToNext",function(i){return _m(t.provider.getAllEvents(),function(i){for(var n=i.value||[],r=0;r<n.length;r++)try{var s=n[r];(WH(s.iKey)||s.iKey)===t.tenantId&&e.processNext(s,t.coreRootCtx.createNew())}catch(e){}})})},function(){return{iKeyConfig:t}})}function c(t,i){WS(e.core,function(){return"LocalStorageChannel:_removeEvents"},function(){o("removeEvents",function(e){var n=[];if(CL(i,function(e){(WH(e.iKey)||e.iKey)===t.tenantId&&n.push(e)}),n.length>0)return _m(t.provider.removeEvents(n),function(e){})})},function(){return{iKeyConfig:t,events:i}})}function d(e,t){return!t.sync&&!(t.persistence<e.minPersistenceCacheLevel)}function u(t){var i=new GO(void 0,e._unloadHooks);return i.initialize(t)||(i=null),i}function h(t,i){var n=new Gq(t,void 0,e._unloadHooks);return n.initialize(i)||(n=null),n}function g(e){for(var t=e.storageConfig.providers,i=null,n=0;!i&&n<t.length&&n<Gz;)switch(t[n++]){case em.LocalStorage:i=h("localStorage",e);break;case em.SessionStorage:i=h("sessionStorage",e);break;case em.IndexedDb:i=u(e)}return i}function p(e,t){if(e.length!==t.length)return!1;var i=!0;return CL(e,function(e,n){if(e!==t[n])return i=!1,-1}),i}function f(t,i,n,r){t&&(t.extensionConfig=t.extensionConfig||[]),!r&&i&&(r=i.getProcessTelContext().getNext());var s=null,a=e._getTelCtx().getNext();return a&&(s=a.getPlugin()),WA(r,t,i,s)}function m(t,i,n,r){var a=!1;if(CL(s,function(e){if(e.iKey===t.instrumentationKey)return a=!0,-1}),!a){var o=null;e._addHook(q6(t,function(n){o=WA(null,n.cfg,i).getExtCfg(e.identifier,GY);var r=!1,a=null,d=t.instrumentationKey;if(CL(s,function(e){if(e.iKey===d)return r=!0,a=e,-1}),r&&a){var u=o.providers;p(u,a.preProviders)||_m(h.clear(),function(e){if(!e.rejected)try{var t=s.indexOf(a);-1!==t&&s.splice(t,1);var n=g(a.providerContext);a.provider=n,a.preProviders=u.slice();var r=a.preListener;r&&i.removeNotificationListener(r);var o={eventsSent:function(e){c(a,e)},eventsDiscarded:function(e,t){c(a,e)}};a.preListener=o,s.push(a),i.addNotificationListener(o),l(a)}catch(e){}})}}));var d=f(t,i,n,r),u={itemCtx:d,storageConfig:o,id:e.id};if(!Cu(t.instrumentationKey))return;var h=g(u),m={iKey:t.instrumentationKey,tenantId:WH(t.instrumentationKey)||t.instrumentationKey,minPersistenceCacheLevel:1,coreRootCtx:d,providerContext:u,provider:h,preProviders:o.providers.slice()};if(h){GJ(o.minPersistenceLevel||-1)&&(m.minPersistenceCacheLevel=o.minPersistenceLevel);var v={eventsSent:function(e){c(m,e)},eventsDiscarded:function(e,t){c(m,e)}};m.preListener=v,s.push(m),i.addNotificationListener(v),l(m)}else s.push(m)}}a(),e.initialize=function(e,n,s,a){WS(n,function(){return"LocalStorageChannel.initialize"},function(){i||(t.initialize(e,n,s),t.setInitialized(!1),i=!0,r=_0(_F,"LocalStorage")),m(e,n,s,a)},function(){return{coreConfig:e,core:n,extensions:s,pluginChain:a}})},e.processTelemetry=function(t,r){var a=n,l=t;if(i&&!a){r=e._getTelCtx(r),Wq(t,e.identifier);var c=null;CL(s,function(e){e.iKey===t.iKey&&(c=e)});var u=c?c.provider:null;if(l.sync||!u)return void e.processNext(l,r);l.id=l.id||Wy(),WG(l.persistence)||(l.persistence=1),d(c,l)&&o("processTelemetry",function(e){return u.addEvent(l.id,l,r)})}e.processNext(l,r)},e.pause=function(){n=!0},e.resume=function(){WS(e.core,function(){return"LocalStorageChannel:resume"},function(){n=!1,CL(s,function(e){e.provider&&l(e)})})},e._doTeardown=function(e,t){CL(s,function(e){var t=e.provider;t&&t.teardown()}),a()},e.flush=function(e,t,i){},e._getDbgPlgTargets=function(){return[s]},e._sendStale=function(e){CL(s,function(t){if(t&&t.iKey===e&&t.provider)return t.provider.moveStaleEvents(),l(t),-1})}}),i}return TO(t,e),t.__ieDyn=1,t}(WU),GX=eR(eK()),G0="LocalStorage",G1=class{constructor(e,t,i,n,r,s){this.logger=e,this.configProvider=t,this.clientInfo=i,this.contextProvider=n,this.accountCollectorURL=r,this.envOverride=s,this.manager=new Ne,this.managerConfig=this.createConfigForManager(),this.currentTransmitProfile=nu.REPORTING_PROFILE.RT_PROFILE,this.initManager(),this.uiVersion=this.getUiVersion(),this.configProvider.on("configUpdated",()=>this.updateChannelConfig())}createLogger(e,t){return new G2(e,this.manager,this.logger,this.configProvider,this.uiVersion,t,this.contextProvider,this.envOverride)}createConfigForManager(){return{channels:[],extensionConfig:{},propertyConfiguration:{populateBrowserInfo:!0,populateOperatingSystemInfo:!0},channelConfiguration:{eventsLimitInMem:this.configProvider.config.eventsLimitInMem,disableFetchKeepAlive:this.configProvider.config.oneDSDisableFetchKeepAlive,useSendBeacon:this.configProvider.config.oneDSUseSendBeacon,payloadPreprocessor:this.configProvider.config.oneDSGzipTelemetryPayload?this.getGzipPayloadProcessor():void 0},endpointUrl:this.accountCollectorURL,enableCompoundKey:this.configProvider.config.enableCompoundKey,disablePageUnloadEvents:this.configProvider.config.oneDSDisabledPageUnloadEvents}}getUiVersion(){let e=this.clientInfo.match(/^.*?\/(\d+\/)(.*?)\/.*$/);return e?e[1]+e[2]:this.clientInfo}updateChannelConfig(){this.configProvider.config.eventsLimitInMem!==this.managerConfig.channelConfiguration.eventsLimitInMem&&this.manager.getPostChannel().setEventQueueLimits(this.configProvider.config.eventsLimitInMem),this.setTransmitProfile()}initManager(){this.initLocalStorageChannel(),this.manager.create(this.managerConfig,[]),this.manager.getNotifyMgr().addNotificationListener({eventsDiscarded:(e,t)=>this.logDiscardedEvents(e,t),eventsSent:e=>this.logSentEvents(e)}),this.configProvider.config.oneDSEnablePropertyOverride?.browserVersion&&(this.manager.getPropertyManager().getPropertiesContext().web.browserVer=is.getBrowserInfo().version),this.configProvider.config.oneDSEnablePropertyOverride?.browserName&&(this.manager.getPropertyManager().getPropertiesContext().web.browser=is.getBrowserInfo().name),this.setTransmitProfile()}initLocalStorageChannel(){if(!this.configProvider.config.useLocalStorageForOneDs)return;let e=new GZ;this.managerConfig.channels.push([e]);let t={storageKey:"TsCalling",accessThresholdInMs:this.configProvider.config.oneDSLocalStorage.accessThresholdInMs??6e5};this.managerConfig.extensionConfig[G0]=t}logDiscardedEvents(e,t){let i="discarded events:";e.forEach(e=>i=`${i+e.name};`),this.logger.info(`${i} reason:${t}`)}logSentEvents(e){let t=e[0]?.data?.CorrelationId&&nL("value",e[0].data.CorrelationId),i=`sent events: ${t}:`;e.forEach(e=>{i=`${i+e.name};`}),this.logger.info(`${i}`)}setTransmitProfile(){this.configProvider.config.transmitProfileTimings.length&&this.manager.getPostChannel()._loadTransmitProfiles({[this.configProvider.config.transmitProfileName]:this.configProvider.config.transmitProfileTimings}),this.configProvider.config.transmitProfileName!==this.currentTransmitProfile&&this.manager.getPostChannel()._setTransmitProfile(this.configProvider.config.transmitProfileName),this.currentTransmitProfile=this.configProvider.config.transmitProfileName}getGzipPayloadProcessor(){return(e,t)=>{try{e.data=GX.default.gzip(e.data),e.urlString+="&content-encoding=gzip"}catch(e){this.logger.warn("Failed to gzip with pako: ",e)}t(e)}}},G2=class{constructor(e,t,i,n,r,s,a,o){this.tenant=e,this.manager=t,this.logger=i,this.configProvider=n,this.uiVersion=r,this.eventLatency=s,this.contextProvider=a,this.envOverride=o,this.instanceConfig={extensions:[],extensionConfig:{}};let{oneDSLocalStorage:l,oneDSNotificationManager:c}=this.configProvider.config;c.blockEventsDiscardedNotifications&&this.blockEventsDiscarded(),c.blockNotificationsOnPageUnload&&this.blockNotificationListenersOnPageUnload(),l.sendStaleEvents&&this.sendStaleEvents()}sendEvent(e){this.setEnvPropertiesToEveryEvent();let t=e.props,i={};switch(this.logger.info(`preparing event for delivery: ${e.props?.CorrelationId??""}/${e.eventName}`),this.tenant){case"signaling":t.SkypeId&&(i.user_id={value:t.SkypeId,kind:10},i.Skype_InitiatingUser_Username={value:t.SkypeId,kind:10},i.SkypeId={value:t.SkypeId,kind:10},delete t.SkypeId),this.uiVersion&&(i.ui_version={value:this.uiVersion,kind:0});break;case"media":case"tlePlayer":this.uiVersion&&(i.uiVersion={value:this.uiVersion,kind:0});break;case"realtimeMedia":this.uiVersion&&(i["AppInfo.Version"]={value:this.uiVersion,kind:0})}for(let e of Object.keys(t)){let n=t[e];i[e]={value:n?.value??n,kind:n?.piiKind??0}}let n={name:e.eventName,data:i,latency:this.eventLatency,persistence:AY.Normal,sync:this.configProvider.config.oneDSEventSendType};this.configProvider.config.smallCallTelemetry.enable&&"mdsc_webrtc_call_session"===n.name&&(n.sync=this.configProvider.config.smallCallTelemetry.eventSendType),this.logger.info(`about to send event ${JSON.stringify(jt.omit(n,["LocalUser","TargetUser"]))}`),this.applicationInsights.track(n)}sendStaleEvents(){this.logger.info("preparing to send stalled telemetry events");let e=this.applicationInsights.getPlugin(G0).plugin;e._sendStale&&e._sendStale(this.tenantToken)}get applicationInsights(){return this.manager.getInst(this.tenantToken)??this.manager.newInst(this.tenantToken,this.instanceConfig,[])}get tenantToken(){return this.configProvider.config.telemetryTenants[this.tenant]}blockNotificationListenersOnPageUnload(){let e=!1,t=()=>{e=!0},i=()=>{e=!1};window.addEventListener("beforeunload",t),window.addEventListener("unload",t),window.addEventListener("pagehide",t),window.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?t():i()}),this.applicationInsights.getNotifyMgr().listeners.forEach(t=>{let{eventsSent:i,eventsDiscarded:n}=t;i&&(t.eventsSent=t=>{e?this.logger.info("1DS eventSent was not raised due to page unload"):i(t)}),n&&(t.eventsDiscarded=(t,i)=>{e?this.logger.log("1DS eventsDiscarded was not raised due to page unload"):n(t,i)})})}blockEventsDiscarded(){this.applicationInsights.getNotifyMgr().listeners.forEach(e=>{e.eventsDiscarded=(e,t)=>{this.logger.log(`1DS eventsDiscarded with reason ${t} was not raised due to configuration`)}})}setEnvPropertiesToEveryEvent(){let e=this.contextProvider?.();if(!nA(this.ctx,e)&&(this.ctx=e,this.ctx))if(this.envOverride){for(let e of Object.keys(this.envOverride||{}))if(this.ctx[e]){let t=this.ctx[e].piiKind??0,i=n4(this.ctx[e].value);this.manager.getPropertyManager().setProperty(this.envOverride[e],{value:i,kind:t})}}else for(let e of Object.keys(this.ctx)){let t=this.ctx[e].piiKind??0,i=n4(this.ctx[e].value);this.manager.getPropertyManager().setProperty(e,{value:i,kind:t})}}},G3=class extends Error{constructor(e,t=1){super(e),this.callSupport=t}};function G4(e){let t={};return e.telemetryLoggers?t=e.telemetryLoggers:e.telemetryService?.getGenericTelemetryLogger&&e.telemetryTenants?Object.keys(e.telemetryTenants).forEach(i=>t[i]=e.telemetryService.getGenericTelemetryLogger(e.telemetryTenants[i])):e.telemetryService&&(e.telemetryService.sendEvents||e.telemetryService.getCallingAdapter)&&(e.telemetryService.sendEvents&&(t.media={sendEvent(t){t.eventName&&(t.eventName=t.eventName.replace(/^(mdsc_)/,"")),e.telemetryService.sendEvents([t])}},t.tlePlayer={sendEvent(t){t.eventName&&(t.eventName=t.eventName.replace(/^(mdsc_)/,"")),e.telemetryService.sendEvents([t])}}),e.telemetryService?.sendRealTimeEvents&&(t.realtimeMedia={sendEvent(t){t.eventName&&(t.eventName=t.eventName.replace(/^(mdsc_)/,"")),e.telemetryService.sendRealTimeEvents([t])}}),e.telemetryService.getCallingAdapter&&(t.signaling={sendEvent(t){e.telemetryService.getCallingAdapter().sendEvent(t.eventName,t.props)}})),t}function G5(e,t,i,n,r,s){let a={signaling:[],media:[],tlePlayer:[],realtimeMedia:[]},o={signaling:{sendEvent:e=>a.signaling.push(e)},media:{sendEvent:e=>a.media.push(e)},tlePlayer:{sendEvent:e=>a.tlePlayer.push(e)},realtimeMedia:{sendEvent:e=>a.realtimeMedia.push(e)},gtcAudit:{sendEvent:e=>a.realtimeMedia.push(e)}};return t.getConfigReceivedOrTimeout().then(async()=>{let l=(await r)?.serviceUrls?.OneDsCollectorUrl;if(l=l??t.config.collectorUrl){let r=new G1(e,t,i,n,l);o.signaling=r.createLogger("signaling",t.config.eventLatency),o.media=r.createLogger("media",t.config.eventLatency),o.tlePlayer=r.createLogger("tlePlayer",t.config.eventLatency),o.gtcAudit=r.createLogger("gtcAudit",AQ.Immediate);let s=new G1(e,t,i,n,l,{"UserInfo.Ring":"Ring","UserInfo.TenantId":"TenantId","AppInfo.ClientType":"client_type","UserInfo.ETag":"AppInfo.EcsEtag",appversion:"First/Second Client VDI Desktop Version",vdiMode:"First/Second Client VDI Mode",vdiConnectedState:"First/Second Client VDI Connected State",vdiShimVersion:"First/Second Client VDI Shim Version",vdiProvider:"First/Second Client VDI Provider Version"});o.realtimeMedia=s.createLogger("realtimeMedia",t.config.eventLatencyRealTime)}else o=G4(s);for(let[e,t]of Object.entries(a))for(let i of t)o[e].sendEvent(i)}),o}var G6=class e extends tZ{constructor(e,t){super(),this._config=e,this._ecsProvider=t,this.callRegistries=[],this._logger=new tJ(this._config.logger).createChild("PluginlessStack"),this._platformManager=new HY(this._logger.createChild("PlatformManager")),this._waitForAccountConfiguration=new iE,this.platformCallConstraintsProvider=new rC(this._logger.createChild("PlatformConstraintsProvider"))}async initializeMediaAgent(e){let t;if(this._mediaAgent)throw new G3("Media agent is already initialized");let i=null;if(!this._mediaAgentProvider)throw new G3("PluginlessStack initialize MediaAgent error, Media Stack not initialized",i);try{this._relayManagerProvider=new rx(e,this._signalingAgentProvider,this._logger),t=await this._mediaAgentProvider.buildAgent(this._config.platformType,this._relayManagerProvider,this._midCallTelemetry)}catch(e){i=e.some(e=>"incompatible_version"===e.reason)?2:1}if(!this._config.usePlatformSupportApi&&!this._config.callSettings?.useLwjForAllCalls)if(i)throw new G3("PluginlessStack initialization failed",i);else{let e=new HY(this._logger.createChild("PlatformManager")).getPlatformSupportLevel(!0,this._config.platformType);if(1!==e&&2!==e)throw new G3("PluginlessStack initialization failed",1)}t?(this._screenSharingManager=new H1(t.getScreenSharingManager()),this._waitForAccountConfigurationTimeout=window.setTimeout(()=>{this._waitForAccountConfiguration.resolve(void 0),this._waitForAccountConfigurationTimeout=void 0},3e4),this._oneDsTelemetryLoggers=G5(this._logger.createChild("OneDsLogger"),t.getConfigProvider(),sd(e.clientInformation),this._config.telemetryContextProvider,this._waitForAccountConfiguration.promise,this._config),t.getConfigProvider().config.useOneDsLogger&&(this.signalingLoggerAdapter={sendEvent:(e,t)=>{let i={eventName:e,props:t};this._oneDsTelemetryLoggers.signaling.sendEvent(i)}}),this._mediaAgent=t,this._e911=new HZ(this._relayManagerProvider,this._mediaAgent.getConfigProvider(),this._logger.createChild("E911")),this._e911?.changed(()=>{this.event("e911InfoChanged").raise(this._e911?.info,this._e911?.areaContent)})):this._deviceManager=new nn}async initializeSignalingAgentProvider(e){this._trouterService=e.trouterService,this._signalingAgentProvider=je(e.signalingAgentConfig,this._ecsProvider,this._config.logger,this.signalingLoggerAdapter)}static async build(t,i,n){try{let r=new e({detectH264Support:t.mediaAgentFactoryConfig.detectH264Support,domOverrides:t.mediaAgentFactoryConfig.domOverrides,mediaSettings:t.mediaAgentFactoryConfig.settings,logger:t.logger,telemetryLoggers:t.telemetryLoggers,telemetryService:t.telemetryService,telemetryTenants:t.telemetryTenants,telemetryContextProvider:t.telemetryContextProvider,platformType:t.platformType,callSettings:t.callSettings,usePlatformSupportApi:t.usePlatformSupportApi,clientInformation:t.signalingAgentConfig.clientInformation,vdi3:t.vdi3},i);return r.initializeMediaProvider({detectH264Support:t.mediaAgentFactoryConfig.detectH264Support,domOverrides:t.mediaAgentFactoryConfig.domOverrides,mediaSettings:t.mediaAgentFactoryConfig.settings,logger:t.mediaAgentFactoryConfig.logger,safeLogger:t.mediaAgentFactoryConfig.safeLogger,webcvProvider:t.mediaAgentFactoryConfig.webcvProvider,wasmdnsProvider:t.mediaAgentFactoryConfig.wasmdnsProvider,wasmaecProvider:t.mediaAgentFactoryConfig.wasmaecProvider,wasmVqeProvider:t.mediaAgentFactoryConfig.wasmVqeProvider,createWasmWorkerCbs:t.mediaAgentFactoryConfig.createWasmWorkerCbs,encodedStreamsWorkerProvider:t.mediaAgentFactoryConfig.encodedStreamsWorkerProvider,clientInformation:t.signalingAgentConfig.clientInformation}),r.setMidCallTelemetry(n),r.initializeSignalingAgentProvider({signalingAgentConfig:t.signalingAgentConfig,trouterService:t.trouterService}),await r.initializeMediaAgent({httpRequestDispatcher:t.mediaAgentFactoryConfig.httpRequestDispatcher,tokenProvider:t.mediaAgentFactoryConfig.tokenProvider,configProvider:t.mediaAgentFactoryConfig.configProvider,appStateProvider:t.mediaAgentFactoryConfig.appStateProvider,clientInformation:t.signalingAgentConfig.clientInformation,trapTokenCredentialsProvider:t.mediaAgentFactoryConfig.trapTokenCredentialsProvider,relayManager:t.mediaAgentFactoryConfig.relayManager}),r}catch(e){if(e instanceof G3)throw e;throw new G3(`${e}`)}}static async buildBaseStack(t,i){let n=new e(t,i);return n.initializeMediaProvider({detectH264Support:t.detectH264Support,domOverrides:t.domOverrides,mediaSettings:t.mediaSettings,logger:t.logger,safeLogger:t.safeLogger,webcvProvider:t.webcvProvider,wasmdnsProvider:t.wasmdnsProvider,wasmaecProvider:t.wasmaecProvider,wasmVqeProvider:t.wasmVqeProvider,createWasmWorkerCbs:t.createWasmWorkerCbs,encodedStreamsWorkerProvider:t.encodedStreamsWorkerProvider,clientInformation:t.clientInformation}),n}async init(){}async dispose(e=e9()){let t=this._logger.createFnLogger("dispose",e);t.info("Dispose"),this._ecsProvider.dispose(),this._e911?.dispose();let i=e=>{t.warn("Failed:",e)},n=this.callRegistries.map(t=>t.dispose(e).catch(i));await Promise.all(n),await this._mediaAgentProvider.dispose(e),t.info("media agent is disposed"),this.callRegistries=[],t.info("call registries are disposed"),this._screenSharingManager&&(this._screenSharingManager.dispose(e),this._screenSharingManager=void 0,t.info("screensharing manager is disposed")),this._deviceManager=void 0,super.dispose()}getCallRegistry(){return(this._logger.info("returning default callRegistry"),this.callRegistries[0])?this.callRegistries[0]:this._createCallRegistry()}async createCallRegistry(e,t=e9()){let i=e?tu(e.id):void 0,n=this._logger.createFnLogger(`createCallRegistry[identity=${i}]`,t),r=this.callRegistries.find(t=>t.identity===e.id);return r&&!r.isDisposing?(n.info(`callRegistry already exists for ${tu(e.id)}`),r):(r?.isDisposing&&await r.disposePromise,this._createCallRegistry(e))}createCompositor(e){throw Error("Method not implemented.")}_createCallRegistry(e){if(!this._trouterService)throw new G3("Unable to create call registry, trouter service undefined");if(!this._mediaAgent)throw new G3("Unable to create call registry, media agent undefined");if(!this._signalingAgentProvider)throw new G3("Unable to create call registry, signaling agent undefined");let t=new yo(this._trouterService,this._signalingAgentProvider,this._mediaAgent,this._logger,G4(this._config),this._ecsProvider,e,this._oneDsTelemetryLoggers,this._config.vdi3);return t.on("disposed",()=>{this.callRegistries.splice(this.callRegistries.indexOf(t),1)}),t.on("accountConfigurationReceived",e=>{this._waitForAccountConfiguration.isPending&&(this._waitForAccountConfiguration.resolve(e),window.clearTimeout(this._waitForAccountConfigurationTimeout)),this._relayManagerProvider.getOrCreateRelayManager().setDefaultRelayConfig(e.relayConfig),this._relayManagerProvider.getOrCreateRelayManager().setClientSupportsGenericTokenApi(e.clientSupportsGenericTokenAPI)}),t.on("locationInfoSet",(e,t)=>{this._e911?.setClientInfo(e,t)}),this._relayManagerProvider.getOrCreateRelayManager(),this.callRegistries.push(t),t}initializeMediaProvider(e){let t=(0,tz.assign)({},e);this._mediaAgentProvider=new HK(t,this._ecsProvider,this.platformCallConstraintsProvider),this._deviceManager=new yh(this._mediaAgentProvider.getDeviceManager())}setMidCallTelemetry(e){this._midCallTelemetry=e}getDeviceManager(){return this._deviceManager}async getDeviceManagerAsync(){return this._deviceManager}createDeviceManager(e){return this._deviceManager}getScreenSharingManager(){return this._screenSharingManager}getSetup(){}getEcsProvider(){return this._ecsProvider}async getEcsProviderAsync(){return this._ecsProvider}getCallFeedback(){return null}getAiMdp(){return null}fireIntent(e,t){}getVersion(){return{build:tX(),ovb:t0()}}async getVersionAsync(){return{build:tX(),ovb:t0()}}getMediaStatus(){return null}getVideoCapabilityLimits(){return null}async setMediaConfig(e){this._mediaAgent.setMediaConfig(e)}async getE911Info(){return this._e911?.getInfo()}setPlatformCallConstraints(e){this.platformCallConstraintsProvider.setConstraints(e)}getPlatformSupportLevel(){return this._platformManager.getPlatformSupportLevel(!!this._mediaAgent)}async getPlatformSupportLevelAsync(){return this.getPlatformSupportLevel()}getLiveStreamClient(){let e=()=>G4(this._config).tlePlayer;return new ni(this._ecsProvider.createEcsConfiguration(),this._logger.createChild("LiveStreamClient"),e)}createVoipCallCoordinator(){}async setLogFileName(e,t,i){throw Error("not supported")}aggregateDiagnosticLogs(e){return Promise.reject("not supported")}submitBrbReport(e,t){return Promise.reject("not supported")}extendBrbFeedback(e,t){return Promise.reject("not supported")}async addOcclusion(e,t,i,n,r,s){}async removeOcclusion(e,t,i,n){}async addCrashInfoMetadata(e){}openPrivacySettings(){throw Error("not supported")}async flushLogs(){throw Error("not supported")}getDebugDump(){return this._mediaAgent&&ty(JSON.stringify(this._mediaAgent.getDiagnosticsData()))}async getStageCapability(){throw Error("not supported")}async getAiCameraCapability(){throw Error("not supported")}createAiCameraManager(){throw Error("not supported")}async disposeMediaAgent(e=e9()){if(!this._mediaAgent)throw new G3("_mediaAgent is not initialized");await this._mediaAgent?.dispose(e),this._mediaAgent=null}async updateSignalingAgentProviderConfig(e){if(!this._signalingAgentProvider)throw new G3("_signalingAgentProvider not initialized");this._trouterService=e.trouterService,this._signalingAgentProvider.getSignalingAgent().updateSignalingAgentConfig(e.signalingAgentConfig)}},G8={build(e,t=!0){let i=new HX(e.telemetryContextProvider?.()),n=new yC;return t&&yT(e,i,n),G6.build(e,i,n)},buildBaseStack(e){let t=new HX(e.telemetryContextProvider?.());return G6.buildBaseStack(e,t)},getVersion:()=>({build:tX(),ovb:t0()})},G9=[{className:yt,props:["callId","endpointId","participantId","callMode","spamRiskLevel","spamStirAttestation","groupId","threadId","messageId","backroomThreadId","lobbyThreadId","streamThreadId","callType","conversationType","calleeAlternateId","callerMri","acceptedElsewhereBy","state","terminatedReason","failureType","callEndDiagnosticsInfo","transferDiagnosticsInfo","capabilities","transferState","parkState","origin","isPreheatEnabled","publishedStates","participants","dominantSpeakerInfo","slowedDownActiveTalkerInfo","callStartedAt","callHeldAt","participantCounts","conversationStartTime","isAudioStreamConnected","isVideoOn","isScreenSharingOn","isIncomingOneOnOneVideoCall","localMediaStreams","mediaStreams","isMuted","isServerMuted","isSpeakerMuted","conversationId","isEmergency","isCast","isHuddleGroupCall","label","isHostless","endpoints","meetingDetails","meetingStates","role","meetingRole","advancedMeetingRole","meetingRoles","participantType","tenantId","transferorMri","transferorDisplayName","transferorType","consultativeCallId","callQueueInfo","incomingCallType","invitationData","customHeaderContext","clientTransferContext","onBehalfOfMri","onBehalfOfUserDisplayName","callPhoneLineType","forwardingDestinationType","optimalVideoCount","maxIncomingVideoCount","maxIncomingVbssCount","contentSharingSessions","screenSharingControl","ptzHandler","broadcastMeeting","broadcastMetadata","dataChannelAdapter","meetingData","meetingInfo","region","meetingGroupDetails","breakoutDetails","videoLayout","callLimits","redirectionProperties","fromApplicationType","maskedIdentityDetails","complianceRecordingContent","bannerContent","callQueueSupervisorContent","supervisorCallQueueMri","meetingLayoutDetails","compositionServiceDetails","joinAsStreamingUser","otpIdentity","enableCaptcha","groupKeyManagerMri","sendSignalLevel","displayNameSource","getIncomingRawAudioStream","getUnmixedAudioProvider","init","initAsync","setDeviceManager","forceUpdate","join","joinCallWithoutCallModality","start","startCallToVoicemail","startCallWithNudge","startWithMeetingData","joinWithMeetingData","subscribeWithMeetingData","startAndUnpark","unpark","joinPreheatedCall","park","updateMeetingRoles","acknowledge","accept","reject","admitParticipant","admit","addParticipant","nudgeParticipants","updateParticipantsProperties","callMeBack","removeParticipant","stop","cancelNudge","mute","unmute","muteParticipants","muteSpeaker","unmuteSpeaker","getSpeakerVolume","setSpeakerVolume","hold","unhold","updateEndpointMetadata","sendDtmfTone","setMaxVideoChannels","setMaxVbssChannels","startVideo","stopVideo","startAudio","stopAudio","startScreenSharing","changeCropRegion","stopScreenSharing","isRecordingLocally","startLocalRecording","stopLocalRecording","includeSystemAudioInLocalRecording","startDataChannel","stopDataChannel","sendUserEvents","shareSystemSound","startFaceStream","stopFaceStream","startInRoomFaceAtrribution","stopInRoomFaceAtrribution","startMultichannelAudioDevice","stopMultichannelAudioDevice","transferCall","callBlindTransfer","callSafeTransfer","transferCallToVoicemail","callConsultativeTransfer","consultativeTransferWithPickupCode","callRedirect","assimilate","merge","getServerHoldLocation","getJoinBlob","getTechnicalInformationJson","createContentSharingSession","setAudioUsageMode","setAudioMidcallConfig","setAudioMidcallConfigJson","setParticipantSpatialAudioPositions","reconnect","provideCallQualityFeedback","dumpVideoSourceImages","addGroupModality","addParticipants","addBroadcastModality","mergeWithPickupCode","publishState","publishStatesForEveryone","removeState","removeStatesForEveryone","updateMeetingSettings","updateMeetingGroups","updateMeetingLiveState","updateParticipantInterpretationState","joinMeetingGroup","leaveMeetingGroup","mergeParticipants","sendMessages","setMeetingLayout","updateMonitorSession","updateMeetingStates","showCQFInfo","isCqfRendered","provideCallQualityFeedbackEx","searchParticipants","getAllParticipants","getMediaTelemetry","getMediaSessionStats","getMediaSessionStatsAsync","getMediaLogs","setVideoMidcallConfigJson","pictureInPicture","setPlatformCallConstraints","setCallConstraints","switchInterpreterGroup","setLiveInterpretationAttributes","selectDevices","getSelectDevices","createStage","setAudioStreamConnectedAsync","setSpamRiskLevelAsync","setSpamStirAttestationAsync","setDominantSpeakerInfoAsync","setSlowedDownActiveTalkerInfoAsync","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:yo,props:["calls","identity","setConfiguration","updateDisplayName","updateSkypeToken","updateToken","fireIntent","getSetup","getEcsConfig","dispose","createCallAsync","getCall","getCallState","debugInformation","setLocationInfo","createDownloader","getUnassembledLocalRecordingSessions","submitBrbReport","extendBrbFeedback","initialize","logout","init","uninit","login","createCall","createCallWithGroupId","createCallWithMeetingData","deleteCall","deleteCallAsync","enableWindowUninitEventHandler","disableWindowUninitEventHandler","enableWindowUninitEventHandlerAsync","disableWindowUninitEventHandlerAsync","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:fG,props:["id","displayName","role","tenantId","voiceLevel","isServerMuted","state","stateReason","streams","participantCapabilities","acceptedBy","endpoints","contentSharingRole","callEndDiagnosticsInfo","balanceUpdates","meetingRole","advancedMeetingRole","meetingRoles","participantType","otpIdentity","getSourceIdForMediaType","getDiagnosticData","getDiagnosticDataAsync","isIdentityMasked","nonMaskedId","nonMaskedDisplayName","nonMaskedObjectId","maskedIdSeqNumber","version","propertyBag","dispose","disposeAsync","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:yh,props:["getPermissionState","getPermissionStateAsync","isAudioOutputSelectionSupported","askDevicePermission","enumerateDevicesAsync","getPreferredCamera","selectDevices","getSelectedDevices","startPreview","createPreview","createPreviewRenderer","createScreenSharingPreviewRenderer","getDeviceNameAsync","getSpeakerDeviceDomIdAsync","setDeviceEffectsAsync","getDeviceEffectsCapabilityAsync","setBackgroundImageAsync","getImagePropertyAsync","transformImageAsync","sendMessageDeviceVideoEffectsAsync","sendMessageDeviceVideoExtensibilityAsync","setVideoCaptureConfigAsync","captureVideoFrameWithoutEffectsAsync","enableSignLanguageDetectionAsync","downloadAiModel","setAudioProcessingFlags","getSpeakerVolume","getSpeakerSystemVolume","setSpeakerVolume","setSpeakerSystemVolume","unmuteMicrophone","unmuteSpeaker","getNrgLevelsForDeviceTuner","getNrgLevelPollerForDeviceTuner","setAudioEffectsAsync","getAudioFeatureCapability","getMicrophoneVolume","setMicrophoneVolume","setDeviceTelemetryData","getSourceFormats","enableShellSharing","disableShellSharing","enableParticipantCameras","registerDerivedSource","unregisterDerivedSource","getMicrophoneGeometryArrayInfoAsync","startAudioLoopbackDevice","getRawDeviceMediaStream","setRawMediaStream","unsetRawMediaStream","createAudioRenderer","getPersonalizedNoiseSuppression","getRtcAudioManager","dispose","registerCompositeVideoDevice","unregisterCompositeVideoDevice","createAudioPlayer","mapBrowserDevices","createSharingSourceForFoundationGuid","createSharingSourceForEphemeralId","setAudioProcessingFlagsAsync","selectDevicesAsync","getSelectedDevicesAsync","getAudioFeatureProviderName","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:HX,props:["setEcsConfig","setUserEcsServerUrl","getUserEcsServerUrl","setActiveUserForEcs","getEcsQueryParameters","ecsGetUserQueryParameters","shouldTriggerCQF"]},{className:mB,props:["controlState","role","enableScreenSharingControl","setScreenSharingControlFeatureFlag","isScreenSharingControlEnabled","initControlForSharer","initControlForViewer","shutdownControlForSharer","shutdownControlForViewer","sendRemoteControlEvent","setRenderer","setPointerImage","setLocalPointerImage","setRemotePointerImage","startPointerMode","stopPointerMode","requestControl","acceptControlRequest","denyControlRequest","grantControl","terminateControl","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:fz,props:["contentSharingState","contentSharingStatus","contentSharingTerminationReason","contentSharingIdentity","contentSharingGuid","startContentSharing","joinContentSharing","updateContentSharingSessionState","takeContentSharingControl","updateContentSharingParticipantStateToViewer","stopContentSharing","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:f7,props:["addHandler","removeHandler","updateNegotiationTag"]},{className:fV,props:["id","type","rank","label","mediaSourceId","dynamicVirtualParticipantId","deviceCapabilities","ordinal","getRawStream","start","stop","selectVideoTrack","setVideoStreamConfig","getDiagnosticData","getStats","isAvailable","isStreaming","participantId","endpointId","negotiationTag","isActive","dispose","disposeAsync","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:f$,props:["id","type","rank","label","mediaSourceId","dynamicVirtualParticipantId","deviceCapabilities","ordinal","getRawStream","start","stop","selectVideoTrack","setVideoStreamConfig","getDiagnosticData","getStats","isAvailable","isStreaming","participantId","endpointId","negotiationTag","isActive","dispose","disposeAsync","changed","on","once","changedAsync","onAsync","onceAsync"]},{className:G6,props:["init","getCallRegistry","createCallRegistry","callRegistries","cancelOperation","getDeviceManager","createDeviceManager","getScreenSharingManager","getSetup","getEcsProvider","getCallFeedback","getAiMdp","getVersion","getMediaStatus","getVideoCapabilityLimits","setMediaConfig","fireIntent","getE911Info","getLocationInfo","setAllowPrivacySensitiveApis","getGeolocationCapabilityState","getLiveStreamClient","getUmsStream","createVoipCallCoordinator","setLogFileName","aggregateDiagnosticLogs","addCrashInfoMetadata","addOcclusion","removeOcclusion","extendBrbFeedback","getDebugDump","flushLogs","getStageCapability","getAiCameraCapability","createAiCameraManager","dispose","getVersionAsync","getDeviceManagerAsync","getEcsProviderAsync","changed","on","once","changedAsync","onAsync","onceAsync"].concat(["getPlatformSupportLevel","setPlatformCallConstraints","createCompositor","initializeMediaAgent","initializeSignalingAgentProvider","disposeMediaAgent","updateSignalingAgentProviderConfig","getPlatformSupportLevelAsync","openPrivacySettings"])}];return"object"==typeof eS.exports&&"object"==typeof ev&&(eS.exports=((e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of Object.getOwnPropertyNames(t))Object.prototype.hasOwnProperty.call(e,r)||r===i||Object.defineProperty(e,r,{get:()=>t[r],enumerable:!(n=Object.getOwnPropertyDescriptor(t,r))||n.enumerable});return e})(eS.exports,ev)),eS.exports})},367173:function(e,t,i){!function(t,n){e.exports=n(i(892891))}(window,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,(function(t){return e[t]}).bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreElectronControlCapturer=void 0;var r=i(2),s=i(6),a=65535,o=3e3,l=250,c=18,d=17,u=16,h=91,g=50,p=30;function f(e){switch(e){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}t.SlimCoreElectronControlCapturer=function(e){function t(t,i,n,r){void 0===n&&(n=!0),void 0===r&&(r=1);var s,a,o=this;return(o=e.call(this)||this)._logger=t,o._element=i,o._captureRegionPreserveAspectRatio=n,o._mouseMoveCount=0,o._mouseMoveStartTime=0,o._isMouseDown=!1,o._isMouseOnRenderer=!1,o._captureMode=0,o._pollTimerID=0,o._resizeTimerID=0,o._mouseMoveThrottlingEnabled=!1,o._handleResizeEvents=function(){clearTimeout(o._resizeTimerID),o._resizeTimerID=window.setTimeout(function(){o.updateCaptureRegion()},l)},o._handleMouseLeave=function(e){!o._isOnScreenContent(e)&&o._isMouseOnRenderer&&(o._raiseCaptureEvent(2),o._logger.info("Mouse leaving render region")),o._isMouseOnRenderer=!1},o._handleMouseEnter=function(e){o._isOnScreenContent(e)&&(o._isMouseOnRenderer=!0,o._raiseCaptureEvent(1),o._logger.info("Mouse entering render region"))},o._handleLosingFocus=function(){o._syncKeyStates(!0)},o._handleClick=function(e){o._isOnScreenContent(e)&&(o._raiseCaptureEvent(0),o._logger.info("Mouse clicked"))},o._handleMouseMove=function(e){if(!o._isOnScreenContent(e)&&o._isMouseOnRenderer){o._raiseCaptureEvent(2),o._isMouseOnRenderer=!1,o._logger.info("Mouse leaving render region");return}if(o._isOnScreenContent(e)&&!o._isMouseOnRenderer&&(o._raiseCaptureEvent(1),o._isMouseOnRenderer=!0,o._logger.info("Mouse entering render region")),2===o._captureMode||3===o._captureMode){if(o._mouseMoveCount++,o._mouseMoveThrottlingEnabled){if(!o._isOnScreenContent(e)||!o._shouldMoveMouse())return}else if(!o._isOnScreenContent(e)||o._mouseMoveCount%2==0)return;var t={type:0};o._normalizeMousePosition(e,t),o._raiseMouseEvent(t)}},o._handleMouseDown=function(e){if((2===o._captureMode||3===o._captureMode)&&o._isOnScreenContent(e)){var t={type:2,buttonType:f(e.button),buttonDown:!0};o._isMouseDown=!0,o._normalizeMousePosition(e,t),o._raiseMouseEvent(t)}},o._handleMouseUp=function(e){if((2===o._captureMode||3===o._captureMode)&&o._isOnScreenContent(e)){var t={type:2,buttonType:f(e.button),buttonDown:!1};o._isMouseDown=!1,o._normalizeMousePosition(e,t),o._raiseMouseEvent(t)}},o._handleKeyDown=function(e){o._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!1}),e.stopPropagation(),e.preventDefault()},o._handleKeyUp=function(e){o._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!0}),e.stopPropagation(),e.preventDefault()},o._handleWheel=function(e){o._raiseMouseEvent({type:1,wheelRotation:e.deltaY>0?-120:120})},o._handleContextMenu=function(e){e.preventDefault()},o._ensureCanReceiveKeyboardInput(),null==(a=null==(s=o._element.ownerDocument)?void 0:s.defaultView)||a.addEventListener("resize",o._handleResizeEvents,!1),o._captureRegion={left:0,top:0,width:o._element.clientWidth,height:o._element.clientHeight},o._videoSize={width:Math.floor(i.clientHeight*r),height:i.clientHeight},o._origElementSize={width:0,height:0},o._checkElementSize(),o._mouseMoveStartTime=new Date(0).getTime(),o}return n(t,e),Object.defineProperty(t.prototype,"captureMode",{get:function(){return this._captureMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"captureRegion",{get:function(){return this._captureRegion},enumerable:!1,configurable:!0}),t.prototype.setMouseMoveThrottlingFeatureFlag=function(e){this._mouseMoveThrottlingEnabled=e},t.prototype.dispose=function(t){var i,n;this._logger.info("dispose causeId: ".concat(t)),window.clearTimeout(this._pollTimerID),null==(n=null==(i=this._element.ownerDocument)?void 0:i.defaultView)||n.removeEventListener("resize",this._handleResizeEvents,!1),e.prototype.dispose.call(this,t)},t.prototype.updateVideoSize=function(e,t){this._videoSize.width=e,this._videoSize.height=t,this.updateCaptureRegion()},t.prototype.updateCaptureRegion=function(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)},t.prototype.setCaptureMode=function(e){3===this._captureMode&&3!==e&&this._syncKeyStates(!0),this._captureMode=e,0!==e?(this._element.addEventListener("click",this._handleClick),this._element.addEventListener("pointermove",this._handleMouseMove),this._element.addEventListener("pointerdown",this._handleMouseDown),this._element.addEventListener("pointerup",this._handleMouseUp),this._element.addEventListener("pointerenter",this._handleMouseEnter),this._element.addEventListener("pointerleave",this._handleMouseLeave),3===e?(this._element.addEventListener("wheel",this._handleWheel),this._element.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("keyup",this._handleKeyUp),this._element.addEventListener("contextmenu",this._handleContextMenu),this._element.addEventListener("blur",this._handleLosingFocus)):(this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))):(this._element.removeEventListener("pointermove",this._handleMouseMove),this._element.removeEventListener("pointerdown",this._handleMouseDown),this._element.removeEventListener("pointerup",this._handleMouseUp),this._element.removeEventListener("pointerenter",this._handleMouseEnter),this._element.removeEventListener("pointerleave",this._handleMouseLeave),this._element.removeEventListener("click",this._handleClick),this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))},t.prototype._ensureCanReceiveKeyboardInput=function(){this._element.tabIndex=this._element.tabIndex},t.prototype._checkElementSize=function(){var e=this;(this._origElementSize.width!==this._element.clientWidth||this._origElementSize.height!==this._element.clientHeight)&&(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout(function(){e._checkElementSize()},o)},t.prototype._raiseMouseEvent=function(e){this.event("mouseControlEvent").raise(e)},t.prototype._raiseKeyboardEvent=function(e){this.event("keyboardControlEvent").raise(e)},t.prototype._raiseCaptureEvent=function(e){this.event("ctrlCaptureEvent").raise(e)},t.prototype._normalizeMousePosition=function(e,t){t.xPos=(e.offsetX-this._captureRegion.left)/this._captureRegion.width*a,t.yPos=(e.offsetY-this._captureRegion.top)/this._captureRegion.height*a},t.prototype._isOnScreenContent=function(e){var t=this._captureRegion.left,i=this._captureRegion.left+this._captureRegion.width,n=this._captureRegion.top,r=this._captureRegion.top+this._captureRegion.height;return t<=e.offsetX&&e.offsetX<i&&n<=e.offsetY&&e.offsetY<r},t.prototype._shouldMoveMouse=function(){if(this._mouseMoveStartTime){var e=new Date().getTime(),t=e-this._mouseMoveStartTime;if(this._isMouseDown&&t>=p||!this._isMouseDown&&t>=g)return this._mouseMoveStartTime=e,!0}else this._mouseMoveStartTime=new Date().getTime();return!1},t.prototype._syncKeyStates=function(e){this._raiseKeyboardEvent({codeType:1,code:d,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:u,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:c,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:h,repeat:!1,keyUp:e}),this._logger.info("Synced Key states.")},t.formatMouseEvent=function(e){return s.ScreenSharingControlProtocol.encodeMouseEvent(e)},t.formatKeyboardEvent=function(e){return s.ScreenSharingControlProtocol.encodeKeyboardEvent(e)},t}(r.default)},function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r=this&&this.__spreadArray||function(e,t,i){if(i||2==arguments.length)for(var n,r=0,s=t.length;r<s;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.changed=function(e,t){return this.subscribe({changed:{skipEventConfig:t,handler:e},on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,i){var n,r=this,s=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];n.dispose(i),r._toEventCallback(t).apply(void 0,e)};return n=this.on(e,this._fromEventCallback(s))},t.prototype.raiseChanged=function(e){var t=this;this.raiseEvents(function(i){if(i.changed){var n=i.changed,r=n.skipEventConfig,s=n.handler,a=t.getShouldSkipChangedEvent(e,r);a||s()}})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return t._raiseEventImpl.apply(t,r([String(e)],i,!1))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.raiseEvents(function(i){var n;return i.on&&i.on.name===e&&(n=i.on).handler.apply(n,t)})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t.prototype.getShouldSkipChangedEvent=function(e,t){return!!(null==e?void 0:e.skipParticipantsUpdatesOnCall)&&!!(null==t?void 0:t.skipParticipantsUpdatesOnCall)},t}(i(3).EventSourceImpl)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceImpl=void 0;var n=i(4),r=i(5);t.EventSourceImpl=function(){function e(e){this.subscriptions=[],this.eventLogger=e}return e.prototype.subscribe=function(e){return new s(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach(function(i){try{void 0!==i.eventHandler&&e(i.eventHandler)}catch(e){t.eventLogger&&t.eventLogger.warn&&t.eventLogger.warn("Event handler exception caught!",(0,r.stringifyObject)(e))}})},e}();var s=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;n.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=void 0},e}()},function(t,i){t.exports=e},function(e,t,i){"use strict";function n(e){var t={};return e.forEach(function(e,i){t[i.toString()]=e}),JSON.stringify(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.stringToBuffer=t.stringifyObject=t.isPromiseLike=t.isStringBase64=t.getRandomizedTimeout=void 0,t.getRandomizedTimeout=function(e){return Math.floor(e*(1-(Math.floor(11*Math.random())+10)/100))},t.isStringBase64=function(e){if(!e)return!1;try{return atob(e),!0}catch(e){return!1}},t.isPromiseLike=function(e){return!!e&&"function"==typeof e.then},t.stringifyObject=function(e){if(!e)return"".concat(e);if(e instanceof Map)return n(e);var t=e.toString();return t.endsWith("[object Object]")?JSON.stringify(e):t},t.stringToBuffer=function(e){for(var t=new Uint8Array(new ArrayBuffer(e.length)),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}},function(e,t,i){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingControlProtocol=void 0,function(e){var t=7,i=3;e.encodeMouseEvent=function(e){if(!e)return new Uint8Array(0);e.buttonType||(e.buttonType=0),e.xPos||(e.xPos=0),e.yPos||(e.yPos=0),e.wheelRotation||(e.wheelRotation=0);var i=new ArrayBuffer(t),n=new DataView(i),r=3&e.type,s=(7&e.buttonType)<<2,a=!!e.buttonDown<<5,o=!!e.wheelButtonDown<<6,l=0;return n.setUint8(0,1),n.setUint8(1,r|s|a|o|l),n.setUint16(2,e.xPos,!0),n.setUint16(4,e.yPos,!0),n.setUint8(6,e.wheelRotation),new Uint8Array(i)},e.encodeKeyboardEvent=function(e){var t=new ArrayBuffer(i),n=new DataView(t),r=3&e.codeType,s=0,a=!!e.keyUp<<4,o=!!e.repeat<<5,l=0,c=0;return n.setUint8(0,0),n.setUint8(1,r|s|a|o|l|c),n.setUint8(2,e.code),new Uint8Array(t)},e.decodeEventType=function(e){return e[0]},e.decodeMouseEvent=function(e){if(1!==e[0]||e.length!==t)return null;var i=new DataView(e.buffer),n=i.getUint8(1);return{type:3&n,buttonType:n>>2&7,buttonDown:!!(n>>5&1),wheelButtonDown:!!(n>>6&1),xPos:i.getUint16(2,!0),yPos:i.getUint16(4,!0),wheelRotation:i.getUint8(6)}},e.decodeKeyboardEvent=function(e){if(0!==e[0]||e.length!==i)return null;var t=new DataView(e.buffer),n=t.getUint8(1);return{codeType:3&n,code:t.getUint8(2),repeat:!!(n>>5&1),keyUp:!!(n>>4&1)}}}(n=t.ScreenSharingControlProtocol||(t.ScreenSharingControlProtocol={}))}])})},235268:function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{_:()=>n})},22046:function(e,t,i){"use strict";i.d(t,{MG:()=>T});var n=i(632735),r=i(312788);function s(e,t,i){let n,r=i.initialDeps??[];return()=>{var s,a,o,l;let c,d;i.key&&(null==(s=i.debug)?void 0:s.call(i))&&(c=Date.now());let u=e();if(!(u.length!==r.length||u.some((e,t)=>r[t]!==e)))return n;if(r=u,i.key&&(null==(a=i.debug)?void 0:a.call(i))&&(d=Date.now()),n=t(...u),i.key&&(null==(o=i.debug)?void 0:o.call(i))){let e=Math.round((Date.now()-c)*100)/100,t=Math.round((Date.now()-d)*100)/100,n=t/16,r=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${r(t,5)} /${r(e,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*n,120))}deg 100% 31%);`,null==i?void 0:i.key)}return null==(l=null==i?void 0:i.onChange)||l.call(i,n),n}}function a(e,t){if(void 0!==e)return e;throw Error(`Unexpected undefined${t?`: ${t}`:""}`)}let o=(e,t)=>1>Math.abs(e-t),l=(e,t,i)=>{let n;return function(...r){e.clearTimeout(n),n=e.setTimeout(()=>t.apply(this,r),i)}},c=e=>e,d=e=>{let t=Math.max(e.startIndex-e.overscan,0),i=Math.min(e.endIndex+e.overscan,e.count-1),n=[];for(let e=t;e<=i;e++)n.push(e);return n},u=(e,t)=>{let i=e.scrollElement;if(!i)return;let n=e.targetWindow;if(!n)return;let r=e=>{let{width:i,height:n}=e;t({width:Math.round(i),height:Math.round(n)})};if(r(i.getBoundingClientRect()),!n.ResizeObserver)return()=>{};let s=new n.ResizeObserver(e=>{let t=e[0];if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return void r({width:e.inlineSize,height:e.blockSize})}r(i.getBoundingClientRect())});return s.observe(i,{box:"border-box"}),()=>{s.unobserve(i)}},h={passive:!0},g="undefined"==typeof window||"onscrollend"in window,p=(e,t)=>{let i=e.scrollElement;if(!i)return;let n=e.targetWindow;if(!n)return;let r=0,s=g?()=>void 0:l(n,()=>{t(r,!1)},e.options.isScrollingResetDelay),a=n=>()=>{r=i[e.options.horizontal?"scrollLeft":"scrollTop"],s(),t(r,n)},o=a(!0),c=a(!1);return c(),i.addEventListener("scroll",o,h),i.addEventListener("scrollend",c,h),()=>{i.removeEventListener("scroll",o),i.removeEventListener("scrollend",c)}},f=(e,t,i)=>{if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return Math.round(e[i.options.horizontal?"inlineSize":"blockSize"])}return Math.round(e.getBoundingClientRect()[i.options.horizontal?"width":"height"])},m=(e,{adjustments:t=0,behavior:i},n)=>{var r,s;let a=e+t;null==(s=null==(r=n.scrollElement)?void 0:r.scrollTo)||s.call(r,{[n.options.horizontal?"left":"top"]:a,behavior:i})};class v{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(()=>{let e=null,t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{this._measureElement(e.target,e)})}):null);return{disconnect:()=>{var e;return null==(e=t())?void 0:e.disconnect()},observe:e=>{var i;return null==(i=t())?void 0:i.observe(e,{box:"border-box"})},unobserve:e=>{var i;return null==(i=t())?void 0:i.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,i])=>{void 0===i&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:c,rangeExtractor:d,onChange:()=>{},measureElement:f,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,...e}},this.notify=(e,t)=>{var i,n;let{startIndex:r,endIndex:s}=this.range??{startIndex:void 0,endIndex:void 0},a=this.calculateRange();(e||r!==(null==a?void 0:a.startIndex)||s!==(null==a?void 0:a.endIndex))&&(null==(n=(i=this.options).onChange)||n.call(i,this,t))},this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.scrollElement=null},this._didMount=()=>(this.measureElementCache.forEach(this.observer.observe),()=>{this.observer.disconnect(),this.cleanup()}),this._willUpdate=()=>{var e;let t=this.options.getScrollElement();this.scrollElement!==t&&(this.cleanup(),this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.notify(!1,!1)})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.scrollOffset<e?"forward":"backward":null,this.scrollOffset=e;let i=this.isScrolling;this.isScrolling=t,this.notify(i!==t,t)})))},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.getMeasurementOptions=s(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey],(e,t,i,n)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:i,getItemKey:n}),{key:!1}),this.getFurthestMeasurement=(e,t)=>{let i=new Map,n=new Map;for(let r=t-1;r>=0;r--){let t=e[r];if(i.has(t.lane))continue;let s=n.get(t.lane);if(null==s||t.end>s.end?n.set(t.lane,t):t.end<s.end&&i.set(t.lane,!0),i.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurements=s(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:i,getItemKey:n},r)=>{let s=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];let a=this.measurementsCache.slice(0,s);for(let o=s;o<e;o++){let e=n(o),s=1===this.options.lanes?a[o-1]:this.getFurthestMeasurement(a,o),l=s?s.end+this.options.gap:t+i,c=r.get(e),d="number"==typeof c?c:this.options.estimateSize(o),u=l+d,h=s?s.lane:o%this.options.lanes;a[o]={index:o,start:l,size:d,end:u,key:e,lane:h}}return this.measurementsCache=a,a},{key:!1,debug:()=>this.options.debug}),this.calculateRange=s(()=>[this.getMeasurements(),this.getSize(),this.scrollOffset],(e,t,i)=>this.range=e.length>0&&t>0?y({measurements:e,outerSize:t,scrollOffset:i}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=s(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(e,t,i,n)=>null===t?[]:e({startIndex:t.startIndex,endIndex:t.endIndex,overscan:i,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{let t=this.options.indexAttribute,i=e.getAttribute(t);return i?parseInt(i,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{let i=this.measurementsCache[this.indexFromElement(e)];if(!i||!e.isConnected)return void this.measureElementCache.forEach((t,i)=>{t===e&&(this.observer.unobserve(e),this.measureElementCache.delete(i))});let n=this.measureElementCache.get(i.key);n!==e&&(n&&this.observer.unobserve(n),this.observer.observe(e),this.measureElementCache.set(i.key,e));let r=this.options.measureElement(e,t,this);this.resizeItem(i,r)},this.resizeItem=(e,t)=>{let i=t-(this.itemSizeCache.get(e.key)??e.size);0!==i&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(e,i,this):e.start<this.scrollOffset+this.scrollAdjustments)&&this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(e.index),this.itemSizeCache=new Map(this.itemSizeCache.set(e.key,t)),this.notify(!0,!1))},this.measureElement=e=>{e&&this._measureElement(e,void 0)},this.getVirtualItems=s(()=>[this.getIndexes(),this.getMeasurements()],(e,t)=>{let i=[];for(let n=0,r=e.length;n<r;n++){let r=t[e[n]];i.push(r)}return i},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{let t=this.getMeasurements();return a(t[S(0,t.length-1,e=>a(t[e]).start,e)])},this.getOffsetForAlignment=(e,t)=>{let i=this.getSize();"auto"===t&&(t=e<=this.scrollOffset?"start":e>=this.scrollOffset+i?"end":"start"),"start"===t||("end"===t?e-=i:"center"===t&&(e-=i/2));let n=this.options.horizontal?"scrollWidth":"scrollHeight";return Math.max(Math.min((this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[n]:this.scrollElement[n]:0)-this.getSize(),e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));let i=a(this.getMeasurements()[e]);if("auto"===t)if(i.end>=this.scrollOffset+this.getSize()-this.options.scrollPaddingEnd)t="end";else{if(!(i.start<=this.scrollOffset+this.options.scrollPaddingStart))return[this.scrollOffset,t];t="start"}let n="end"===t?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(n,t),t]},this.isDynamicMode=()=>this.measureElementCache.size>0,this.cancelScrollToIndex=()=>{null!==this.scrollToIndexTimeoutId&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(e,{align:t="start",behavior:i}={})=>{this.cancelScrollToIndex(),"smooth"===i&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:i})},this.scrollToIndex=(e,{align:t="auto",behavior:i}={})=>{e=Math.max(0,Math.min(e,this.options.count-1)),this.cancelScrollToIndex(),"smooth"===i&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");let[n,r]=this.getOffsetForIndex(e,t);this._scrollToOffset(n,{adjustments:void 0,behavior:i}),"smooth"!==i&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.measureElementCache.has(this.options.getItemKey(e))){let[t]=this.getOffsetForIndex(e,r);o(t,this.scrollOffset)||this.scrollToIndex(e,{align:r,behavior:i})}else this.scrollToIndex(e,{align:r,behavior:i})}))},this.scrollBy=(e,{behavior:t}={})=>{this.cancelScrollToIndex(),"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.scrollOffset+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;let t,i=this.getMeasurements();return(t=0===i.length?this.options.paddingStart:1===this.options.lanes?(null==(e=i[i.length-1])?void 0:e.end)??0:Math.max(...i.slice(-this.options.lanes).map(e=>e.end)))-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(e,{adjustments:t,behavior:i})=>{this.options.scrollToFn(e,{behavior:i,adjustments:t},this)},this.measure=()=>{var e,t;this.itemSizeCache=new Map,null==(t=(e=this.options).onChange)||t.call(e,this,!1)},this.setOptions(e),this.scrollRect=this.options.initialRect,this.scrollOffset="function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}),this.notify(!1,!1)}}let S=(e,t,i,n)=>{for(;e<=t;){let r=(e+t)/2|0,s=i(r);if(s<n)e=r+1;else{if(!(s>n))return r;t=r-1}}return e>0?e-1:0};function y({measurements:e,outerSize:t,scrollOffset:i}){let n=e.length-1,r=S(0,n,t=>e[t].start,i),s=r;for(;s<n&&e[s].end<i+t;)s++;return{startIndex:r,endIndex:s}}let C="undefined"!=typeof document?n.useLayoutEffect:n.useEffect;function b(e){let t=n.useReducer(()=>({}),{})[1],i={...e,onChange:(i,n)=>{var s;n?(0,r.flushSync)(t):t(),null==(s=e.onChange)||s.call(e,i,n)}},[s]=n.useState(()=>new v(i));return s.setOptions(i),n.useEffect(()=>s._didMount(),[]),C(()=>s._willUpdate()),s}function T(e){return b({observeElementRect:u,observeElementOffset:p,scrollToFn:m,...e})}},969550:function(e,t,i){"use strict";i.d(t,{x:()=>s});var n={},r=void 0;try{r=window}catch(e){}function s(e,t){if(void 0!==r){var i=r.__packages__=r.__packages__||{};i[e]&&n[e]||(n[e]=t,(i[e]=i[e]||[]).push(t))}}s("@uifabric/set-version","6.0.0")},981090:function(e,t,i){"use strict";i.d(t,{fm:()=>I,M_:()=>w,Ye:()=>C,jG:()=>r.j});var n,r=i(808272),s=i(231191),a=i(116357),o="__globalSettings__",l="__callbacks__",c=0,d=function(){function e(){}return e.getValue=function(e,t){var i=u();return void 0===i[e]&&(i[e]="function"==typeof t?t():t),i[e]},e.setValue=function(e,t){var i=u(),n=i[l],r=i[e];if(t!==r){i[e]=t;var s={oldValue:r,value:t,key:e};for(var a in n)n.hasOwnProperty(a)&&n[a](s)}return t},e.addChangeListener=function(e){var t=e.__id__,i=h();t||(t=e.__id__=String(c++)),i[t]=e},e.removeChangeListener=function(e){var t=h();delete t[e.__id__]},e}();function u(){var e,t=(0,a.J)()||{};return t[o]||(t[o]=((e={})[l]={},e)),t[o]}function h(){return u()[l]}function g(e){console&&console.warn&&console.warn(e)}var p=0,f=1,m=2,v="__stylesheet__",S="undefined"!=typeof navigator&&/rv:11.0/.test(navigator.userAgent),y={};try{y=window}catch(e){}var C=function(){function e(e){this._rules=[],this._preservedRules=[],this._rulesToInsert=[],this._counter=0,this._keyToClassName={},this._onResetCallbacks=[],this._classNameToArgs={},this._config=(0,s.__assign)({injectionMode:f,defaultPrefix:"css",namespace:void 0,cspSettings:void 0},e),this._keyToClassName=this._config.classNameCache||{}}return e.getInstance=function(){var t;if(!(n=y[v])||n._lastStyleElement&&n._lastStyleElement.ownerDocument!==document){var i=(null==(t=y)?void 0:t.FabricConfig)||{};n=y[v]=new e(i.mergeStyles)}return n},e.prototype.setConfig=function(e){this._config=(0,s.__assign)((0,s.__assign)({},this._config),e)},e.prototype.onReset=function(e){this._onResetCallbacks.push(e)},e.prototype.getClassName=function(e){var t=this._config.namespace;return(t?t+"-":"")+(e||this._config.defaultPrefix)+"-"+this._counter++},e.prototype.cacheClassName=function(e,t,i,n){this._keyToClassName[t]=e,this._classNameToArgs[e]={args:i,rules:n}},e.prototype.classNameFromKey=function(e){return this._keyToClassName[e]},e.prototype.getClassNameCache=function(){return this._keyToClassName},e.prototype.argsFromClassName=function(e){var t=this._classNameToArgs[e];return t&&t.args},e.prototype.insertedRulesFromClassName=function(e){var t=this._classNameToArgs[e];return t&&t.rules},e.prototype.insertRule=function(e,t){var i=this._config.injectionMode!==p?this._getStyleElement():void 0;if(t&&this._preservedRules.push(e),i)switch(this._config.injectionMode){case f:var n=i.sheet;try{n.insertRule(e,n.cssRules.length)}catch(e){}break;case m:i.appendChild(document.createTextNode(e))}else this._rules.push(e);this._config.onInsertRule&&this._config.onInsertRule(e)},e.prototype.getRules=function(e){return(e?this._preservedRules.join(""):"")+this._rules.join("")+this._rulesToInsert.join("")},e.prototype.reset=function(){this._rules=[],this._rulesToInsert=[],this._counter=0,this._classNameToArgs={},this._keyToClassName={},this._onResetCallbacks.forEach(function(e){return e()})},e.prototype.resetKeys=function(){this._keyToClassName={}},e.prototype._getStyleElement=function(){var e=this;return!this._styleElement&&"undefined"!=typeof document&&(this._styleElement=this._createStyleElement(),S||window.requestAnimationFrame(function(){e._styleElement=void 0})),this._styleElement},e.prototype._createStyleElement=function(){var e=document.head,t=document.createElement("style");t.setAttribute("data-merge-styles","true");var i=this._config.cspSettings;if(i&&i.nonce&&t.setAttribute("nonce",i.nonce),this._lastStyleElement)e.insertBefore(t,this._lastStyleElement.nextElementSibling);else{var n=this._findPlaceholderStyleTag();n?e.insertBefore(t,n.nextElementSibling):e.insertBefore(t,e.childNodes[0])}return this._lastStyleElement=t,t},e.prototype._findPlaceholderStyleTag=function(){var e=document.head;return e?e.querySelector("style[data-merge-styles]"):null},e}(),b="icons",T=d.getValue(b,{__options:{disableWarnings:!1,warnOnMissingIcons:!0},__remapped:{}}),E=C.getInstance();E&&E.onReset&&E.onReset(function(){for(var e in T)T.hasOwnProperty(e)&&T[e].subset&&(T[e].subset.className=void 0)});var _=function(e){return e.toLowerCase()};function I(e,t){var i=(0,s.__assign)((0,s.__assign)({},e),{isRegistered:!1,className:void 0}),n=e.icons;for(var r in t=t?(0,s.__assign)((0,s.__assign)({},T.__options),t):T.__options,n)if(n.hasOwnProperty(r)){var a=n[r],o=_(r);T[o]?A(r):T[o]={code:a,subset:i}}}function w(e,t){T.__remapped[_(e)]=_(t)}var P=[],R=void 0;function A(e){var t=T.__options,i=2e3,n=10;t.disableWarnings||(P.push(e),void 0===R&&(R=setTimeout(function(){g("Some icons were re-registered. Applications should only call registerIcons for any given icon once. Redefining what an icon is may have unintended consequences. Duplicates include: \n"+P.slice(0,n).join(", ")+(P.length>n?" (+ "+(P.length-n)+" more)":"")),R=void 0,P=[]},i)))}(0,i(969550).x)("@uifabric/styling","7.18.0");var M="customizations",D={settings:{},scopedSettings:{},inCustomizerContext:!1},O=d.getValue(M,{settings:{},scopedSettings:{},inCustomizerContext:!1}),k=[],N=function(){function e(){}return e.reset=function(){O.settings={},O.scopedSettings={}},e.applySettings=function(t){O.settings=(0,s.__assign)((0,s.__assign)({},O.settings),t),e._raiseChange()},e.applyScopedSettings=function(t,i){O.scopedSettings[t]=(0,s.__assign)((0,s.__assign)({},O.scopedSettings[t]),i),e._raiseChange()},e.getSettings=function(e,t,i){void 0===i&&(i=D);for(var n={},r=t&&i.scopedSettings[t]||{},s=t&&O.scopedSettings[t]||{},a=0,o=e;a<o.length;a++){var l=o[a];n[l]=r[l]||i.settings[l]||s[l]||O.settings[l]}return n},e.applyBatchedUpdates=function(t,i){e._suppressUpdates=!0;try{t()}catch(e){}e._suppressUpdates=!1,i||e._raiseChange()},e.observe=function(e){k.push(e)},e.unobserve=function(e){k=k.filter(function(t){return t!==e})},e._raiseChange=function(){e._suppressUpdates||k.forEach(function(e){return e()})},e}();i(58366);var x=(0,r.j)({}),L="theme";function F(){if(!N.getSettings([L]).theme){var e,t,i,n=(0,a.J)();(null==(i=null==(t=n)?void 0:t.FabricConfig)?void 0:i.theme)&&(x=(0,r.j)(n.FabricConfig.theme)),N.applySettings(((e={})[L]=x,e))}}F(),F()},116357:function(e,t,i){"use strict";i.d(t,{J:()=>s});var n=!1,r=void 0;try{r=window}catch(e){}function s(e){if(!n&&void 0!==r){var t=e;return t&&t.ownerDocument&&t.ownerDocument.defaultView?t.ownerDocument.defaultView:r}}},838766:function(e,t,i){"use strict";i.d(t,{D:()=>o,Z:()=>l});let{toString:n,hasOwnProperty:r}=Object.prototype,s=Function.prototype.toString,a=new Map;function o(e,t){try{return c(e,t)}finally{a.clear()}}let l=o;function c(e,t){if(e===t)return!0;let i=n.call(e);if(i!==n.call(t))return!1;switch(i){case"[object Array]":if(e.length!==t.length)break;case"[object Object]":{if(p(e,t))return!0;let i=d(e),n=d(t),s=i.length;if(s!==n.length)return!1;for(let e=0;e<s;++e)if(!r.call(t,i[e]))return!1;for(let n=0;n<s;++n){let r=i[n];if(!c(e[r],t[r]))return!1}return!0}case"[object Error]":return e.name===t.name&&e.message===t.message;case"[object Number]":if(e!=e)return t!=t;case"[object Boolean]":case"[object Date]":return+e==+t;case"[object RegExp]":case"[object String]":return e==`${t}`;case"[object Map]":case"[object Set]":{if(e.size!==t.size)return!1;if(p(e,t))return!0;let n=e.entries(),r="[object Map]"===i;for(;;){let e=n.next();if(e.done)break;let[i,s]=e.value;if(!t.has(i)||r&&!c(s,t.get(i)))return!1}return!0}case"[object Uint16Array]":case"[object Uint8Array]":case"[object Uint32Array]":case"[object Int32Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object ArrayBuffer]":e=new Uint8Array(e),t=new Uint8Array(t);case"[object DataView]":{let i=e.byteLength;if(i===t.byteLength)for(;i--&&e[i]===t[i];);return -1===i}case"[object AsyncFunction]":case"[object GeneratorFunction]":case"[object AsyncGeneratorFunction]":case"[object Function]":{let i=s.call(e);if(i!==s.call(t))return!1;return!g(i,h)}}return!1}function d(e){return Object.keys(e).filter(u,e)}function u(e){return void 0!==this[e]}let h="{ [native code] }";function g(e,t){let i=e.length-t.length;return i>=0&&e.indexOf(t,i)===i}function p(e,t){let i=a.get(e);if(i){if(i.has(t))return!0}else a.set(e,i=new Set);return i.add(t),!1}},756571:function(e,t,i){"use strict";let n,r,s;i.d(t,{Z:()=>t0});var a={};function o(e,t){return function(){return e.apply(t,arguments)}}i.r(a),i.d(a,{hasBrowserEnv:()=>eF,hasStandardBrowserEnv:()=>e$,hasStandardBrowserWebWorkerEnv:()=>eV,navigator:()=>eU,origin:()=>eB});let{toString:l}=Object.prototype,{getPrototypeOf:c}=Object,d=(n=Object.create(null),e=>{let t=l.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())}),u=e=>(e=e.toLowerCase(),t=>d(t)===e),h=e=>t=>typeof t===e,{isArray:g}=Array,p=h("undefined");function f(e){return null!==e&&!p(e)&&null!==e.constructor&&!p(e.constructor)&&y(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let m=u("ArrayBuffer");function v(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&m(e.buffer)}let S=h("string"),y=h("function"),C=h("number"),b=e=>null!==e&&"object"==typeof e,T=e=>!0===e||!1===e,E=e=>{if("object"!==d(e))return!1;let t=c(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},_=u("Date"),I=u("File"),w=u("Blob"),P=u("FileList"),R=e=>b(e)&&y(e.pipe),A=e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||y(e.append)&&("formdata"===(t=d(e))||"object"===t&&y(e.toString)&&"[object FormData]"===e.toString()))},M=u("URLSearchParams"),[D,O,k,N]=["ReadableStream","Request","Response","Headers"].map(u),x=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function L(e,t,{allOwnKeys:i=!1}={}){let n,r;if(null!=e)if("object"!=typeof e&&(e=[e]),g(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{let r,s=i?Object.getOwnPropertyNames(e):Object.keys(e),a=s.length;for(n=0;n<a;n++)r=s[n],t.call(null,e[r],r,e)}}function F(e,t){let i;t=t.toLowerCase();let n=Object.keys(e),r=n.length;for(;r-- >0;)if(t===(i=n[r]).toLowerCase())return i;return null}let U="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:i.g,$=e=>!p(e)&&e!==U;function V(){let{caseless:e}=$(this)&&this||{},t={},i=(i,n)=>{let r=e&&F(t,n)||n;E(t[r])&&E(i)?t[r]=V(t[r],i):E(i)?t[r]=V({},i):g(i)?t[r]=i.slice():t[r]=i};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&L(arguments[e],i);return t}let B=(e,t,i,{allOwnKeys:n}={})=>(L(t,(t,n)=>{i&&y(t)?e[n]=o(t,i):e[n]=t},{allOwnKeys:n}),e),H=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),j=(e,t,i,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},q=(e,t,i,n)=>{let r,s,a,o={};if(t=t||{},null==e)return t;do{for(s=(r=Object.getOwnPropertyNames(e)).length;s-- >0;)a=r[s],(!n||n(a,e,t))&&!o[a]&&(t[a]=e[a],o[a]=!0);e=!1!==i&&c(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},W=(e,t,i)=>{e=String(e),(void 0===i||i>e.length)&&(i=e.length),i-=t.length;let n=e.indexOf(t,i);return -1!==n&&n===i},G=e=>{if(!e)return null;if(g(e))return e;let t=e.length;if(!C(t))return null;let i=Array(t);for(;t-- >0;)i[t]=e[t];return i},z=(r="undefined"!=typeof Uint8Array&&c(Uint8Array),e=>r&&e instanceof r),J=(e,t)=>{let i,n=(e&&e[Symbol.iterator]).call(e);for(;(i=n.next())&&!i.done;){let n=i.value;t.call(e,n[0],n[1])}},K=(e,t)=>{let i,n=[];for(;null!==(i=e.exec(t));)n.push(i);return n},Q=u("HTMLFormElement"),Y=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,i){return t.toUpperCase()+i}),Z=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),X=u("RegExp"),ee=(e,t)=>{let i=Object.getOwnPropertyDescriptors(e),n={};L(i,(i,r)=>{let s;!1!==(s=t(i,r,e))&&(n[r]=s||i)}),Object.defineProperties(e,n)},et=e=>{ee(e,(t,i)=>{if(y(e)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;if(y(e[i])){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},ei=(e,t)=>{let i={};return(e=>{e.forEach(e=>{i[e]=!0})})(g(e)?e:String(e).split(t)),i},en=()=>{},er=(e,t)=>null!=e&&Number.isFinite(e*=1)?e:t,es="abcdefghijklmnopqrstuvwxyz",ea="0123456789",eo={DIGIT:ea,ALPHA:es,ALPHA_DIGIT:es+es.toUpperCase()+ea},el=(e=16,t=eo.ALPHA_DIGIT)=>{let i="",{length:n}=t;for(;e--;)i+=t[Math.random()*n|0];return i};function ec(e){return!!(e&&y(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])}let ed=e=>{let t=Array(10),i=(e,n)=>{if(b(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;let r=g(e)?[]:{};return L(e,(e,t)=>{let s=i(e,n+1);p(s)||(r[t]=s)}),t[n]=void 0,r}}return e};return i(e,0)},eu=u("AsyncFunction"),eh=e=>e&&(b(e)||y(e))&&y(e.then)&&y(e.catch),eg=((e,t)=>{let i,n;return e?setImmediate:t?(i=`axios@${Math.random()}`,n=[],U.addEventListener("message",({source:e,data:t})=>{e===U&&t===i&&n.length&&n.shift()()},!1),e=>{n.push(e),U.postMessage(i,"*")}):e=>setTimeout(e)})("function"==typeof setImmediate,y(U.postMessage)),ep="undefined"!=typeof queueMicrotask?queueMicrotask.bind(U):eg,ef={isArray:g,isArrayBuffer:m,isBuffer:f,isFormData:A,isArrayBufferView:v,isString:S,isNumber:C,isBoolean:T,isObject:b,isPlainObject:E,isReadableStream:D,isRequest:O,isResponse:k,isHeaders:N,isUndefined:p,isDate:_,isFile:I,isBlob:w,isRegExp:X,isFunction:y,isStream:R,isURLSearchParams:M,isTypedArray:z,isFileList:P,forEach:L,merge:V,extend:B,trim:x,stripBOM:H,inherits:j,toFlatObject:q,kindOf:d,kindOfTest:u,endsWith:W,toArray:G,forEachEntry:J,matchAll:K,isHTMLForm:Q,hasOwnProperty:Z,hasOwnProp:Z,reduceDescriptors:ee,freezeMethods:et,toObjectSet:ei,toCamelCase:Y,noop:en,toFiniteNumber:er,findKey:F,global:U,isContextDefined:$,ALPHABET:eo,generateString:el,isSpecCompliantForm:ec,toJSONObject:ed,isAsyncFn:eu,isThenable:eh,setImmediate:eg,asap:ep};function em(e,t,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}ef.inherits(em,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ef.toJSONObject(this.config),code:this.code,status:this.status}}});let ev=em.prototype,eS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{eS[e]={value:e}}),Object.defineProperties(em,eS),Object.defineProperty(ev,"isAxiosError",{value:!0}),em.from=(e,t,i,n,r,s)=>{let a=Object.create(ev);return ef.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),em.call(a,e.message,t,i,n,r),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};let ey=em,eC=null;function eb(e){return ef.isPlainObject(e)||ef.isArray(e)}function eT(e){return ef.endsWith(e,"[]")?e.slice(0,-2):e}function eE(e,t,i){return e?e.concat(t).map(function(e,t){return e=eT(e),!i&&t?"["+e+"]":e}).join(i?".":""):t}function e_(e){return ef.isArray(e)&&!e.some(eb)}let eI=ef.toFlatObject(ef,{},null,function(e){return/^is[A-Z]/.test(e)}),ew=function(e,t,i){if(!ef.isObject(e))throw TypeError("target must be an object");t=t||new(eC||FormData);let n=(i=ef.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!ef.isUndefined(t[e])})).metaTokens,r=i.visitor||c,s=i.dots,a=i.indexes,o=(i.Blob||"undefined"!=typeof Blob&&Blob)&&ef.isSpecCompliantForm(t);if(!ef.isFunction(r))throw TypeError("visitor must be a function");function l(e){if(null===e)return"";if(ef.isDate(e))return e.toISOString();if(!o&&ef.isBlob(e))throw new ey("Blob is not supported. Use a Buffer instead.");return ef.isArrayBuffer(e)||ef.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,i,r){let o=e;if(e&&!r&&"object"==typeof e){if(ef.endsWith(i,"{}"))i=n?i:i.slice(0,-2),e=JSON.stringify(e);else if(ef.isArray(e)&&e_(e)||(ef.isFileList(e)||ef.endsWith(i,"[]"))&&(o=ef.toArray(e)))return i=eT(i),o.forEach(function(e,n){ef.isUndefined(e)||null===e||t.append(!0===a?eE([i],n,s):null===a?i:i+"[]",l(e))}),!1}return!!eb(e)||(t.append(eE(r,i,s),l(e)),!1)}let d=[],u=Object.assign(eI,{defaultVisitor:c,convertValue:l,isVisitable:eb});function h(e,i){if(!ef.isUndefined(e)){if(-1!==d.indexOf(e))throw Error("Circular reference detected in "+i.join("."));d.push(e),ef.forEach(e,function(e,n){!0===(!(ef.isUndefined(e)||null===e)&&r.call(t,e,ef.isString(n)?n.trim():n,i,u))&&h(e,i?i.concat(n):[n])}),d.pop()}}if(!ef.isObject(e))throw TypeError("data must be an object");return h(e),t};function eP(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function eR(e,t){this._pairs=[],e&&ew(e,this,t)}let eA=eR.prototype;eA.append=function(e,t){this._pairs.push([e,t])},eA.toString=function(e){let t=e?function(t){return e.call(this,t,eP)}:eP;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};let eM=eR;function eD(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eO(e,t,i){let n;if(!t)return e;let r=i&&i.encode||eD,s=i&&i.serialize;if(n=s?s(t,i):ef.isURLSearchParams(t)?t.toString():new eM(t,i).toString(r)){let t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}class ek{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ef.forEach(this.handlers,function(t){null!==t&&e(t)})}}let eN=ek,ex={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eL={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:eM,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},eF="undefined"!=typeof window&&"undefined"!=typeof document,eU="object"==typeof navigator&&navigator||void 0,e$=eF&&(!eU||0>["ReactNative","NativeScript","NS"].indexOf(eU.product)),eV="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,eB=eF&&window.location.href||"http://localhost",eH={...a,...eL};function ej(e,t){return ew(e,new eH.classes.URLSearchParams,Object.assign({visitor:function(e,t,i,n){return eH.isNode&&ef.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function eq(e){return ef.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}function eW(e){let t,i,n={},r=Object.keys(e),s=r.length;for(t=0;t<s;t++)n[i=r[t]]=e[i];return n}let eG=function(e){function t(e,i,n,r){let s=e[r++];if("__proto__"===s)return!0;let a=Number.isFinite(+s),o=r>=e.length;return(s=!s&&ef.isArray(n)?n.length:s,o)?ef.hasOwnProp(n,s)?n[s]=[n[s],i]:n[s]=i:(n[s]&&ef.isObject(n[s])||(n[s]=[]),t(e,i,n[s],r)&&ef.isArray(n[s])&&(n[s]=eW(n[s]))),!a}if(ef.isFormData(e)&&ef.isFunction(e.entries)){let i={};return ef.forEachEntry(e,(e,n)=>{t(eq(e),n,i,0)}),i}return null};function ez(e,t,i){if(ef.isString(e))try{return(t||JSON.parse)(e),ef.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(i||JSON.stringify)(e)}let eJ={transitional:ex,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let i,n=t.getContentType()||"",r=n.indexOf("application/json")>-1,s=ef.isObject(e);if(s&&ef.isHTMLForm(e)&&(e=new FormData(e)),ef.isFormData(e))return r?JSON.stringify(eG(e)):e;if(ef.isArrayBuffer(e)||ef.isBuffer(e)||ef.isStream(e)||ef.isFile(e)||ef.isBlob(e)||ef.isReadableStream(e))return e;if(ef.isArrayBufferView(e))return e.buffer;if(ef.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return ej(e,this.formSerializer).toString();if((i=ef.isFileList(e))||n.indexOf("multipart/form-data")>-1){let t=this.env&&this.env.FormData;return ew(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),ez(e)):e}],transformResponse:[function(e){let t=this.transitional||eJ.transitional,i=t&&t.forcedJSONParsing,n="json"===this.responseType;if(ef.isResponse(e)||ef.isReadableStream(e))return e;if(e&&ef.isString(e)&&(i&&!this.responseType||n)){let i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw ey.from(e,ey.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:eH.classes.FormData,Blob:eH.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ef.forEach(["delete","get","head","post","put","patch"],e=>{eJ.headers[e]={}});let eK=eJ,eQ=ef.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eY=e=>{let t,i,n,r={};return e&&e.split("\n").forEach(function(e){n=e.indexOf(":"),t=e.substring(0,n).trim().toLowerCase(),i=e.substring(n+1).trim(),!t||r[t]&&eQ[t]||("set-cookie"===t?r[t]?r[t].push(i):r[t]=[i]:r[t]=r[t]?r[t]+", "+i:i)}),r},eZ=Symbol("internals");function eX(e){return e&&String(e).trim().toLowerCase()}function e0(e){return!1===e||null==e?e:ef.isArray(e)?e.map(e0):String(e)}function e1(e){let t,i=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;t=n.exec(e);)i[t[1]]=t[2];return i}let e2=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function e3(e,t,i,n,r){if(ef.isFunction(n))return n.call(this,t,i);if(r&&(t=i),ef.isString(t)){if(ef.isString(n))return -1!==t.indexOf(n);if(ef.isRegExp(n))return n.test(t)}}function e4(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function e5(e,t){let i=ef.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+i,{value:function(e,i,r){return this[n].call(this,t,e,i,r)},configurable:!0})})}class e6{constructor(e){e&&this.set(e)}set(e,t,i){let n=this;function r(e,t,i){let r=eX(t);if(!r)throw Error("header name must be a non-empty string");let s=ef.findKey(n,r);s&&void 0!==n[s]&&!0!==i&&(void 0!==i||!1===n[s])||(n[s||t]=e0(e))}let s=(e,t)=>ef.forEach(e,(e,i)=>r(e,i,t));if(ef.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(ef.isString(e)&&(e=e.trim())&&!e2(e))s(eY(e),t);else if(ef.isHeaders(e))for(let[t,n]of e.entries())r(n,t,i);else null!=e&&r(t,e,i);return this}get(e,t){if(e=eX(e)){let i=ef.findKey(this,e);if(i){let e=this[i];if(!t)return e;if(!0===t)return e1(e);if(ef.isFunction(t))return t.call(this,e,i);if(ef.isRegExp(t))return t.exec(e);throw TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=eX(e)){let i=ef.findKey(this,e);return!!(i&&void 0!==this[i]&&(!t||e3(this,this[i],i,t)))}return!1}delete(e,t){let i=this,n=!1;function r(e){if(e=eX(e)){let r=ef.findKey(i,e);r&&(!t||e3(i,i[r],r,t))&&(delete i[r],n=!0)}}return ef.isArray(e)?e.forEach(r):r(e),n}clear(e){let t=Object.keys(this),i=t.length,n=!1;for(;i--;){let r=t[i];(!e||e3(this,this[r],r,e,!0))&&(delete this[r],n=!0)}return n}normalize(e){let t=this,i={};return ef.forEach(this,(n,r)=>{let s=ef.findKey(i,r);if(s){t[s]=e0(n),delete t[r];return}let a=e?e4(r):String(r).trim();a!==r&&delete t[r],t[a]=e0(n),i[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return ef.forEach(this,(i,n)=>{null!=i&&!1!==i&&(t[n]=e&&ef.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let i=new this(e);return t.forEach(e=>i.set(e)),i}static accessor(e){let t=(this[eZ]=this[eZ]={accessors:{}}).accessors,i=this.prototype;function n(e){let n=eX(e);t[n]||(e5(i,e),t[n]=!0)}return ef.isArray(e)?e.forEach(n):n(e),this}}e6.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ef.reduceDescriptors(e6.prototype,({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[i]=e}}}),ef.freezeMethods(e6);let e8=e6;function e9(e,t){let i=this||eK,n=t||i,r=e8.from(n.headers),s=n.data;return ef.forEach(e,function(e){s=e.call(i,s,r.normalize(),t?t.status:void 0)}),r.normalize(),s}function e7(e){return!!(e&&e.__CANCEL__)}function te(e,t,i){ey.call(this,null==e?"canceled":e,ey.ERR_CANCELED,t,i),this.name="CanceledError"}ef.inherits(te,ey,{__CANCEL__:!0});let tt=te;function ti(e,t,i){let n=i.config.validateStatus;!i.status||!n||n(i.status)?e(i):t(new ey("Request failed with status code "+i.status,[ey.ERR_BAD_REQUEST,ey.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function tn(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}let tr=function(e,t){let i,n=Array(e=e||10),r=Array(e),s=0,a=0;return t=void 0!==t?t:1e3,function(o){let l=Date.now(),c=r[a];i||(i=l),n[s]=o,r[s]=l;let d=a,u=0;for(;d!==s;)u+=n[d++],d%=e;if((s=(s+1)%e)===a&&(a=(a+1)%e),l-i<t)return;let h=c&&l-c;return h?Math.round(1e3*u/h):void 0}},ts=function(e,t){let i,n,r=0,s=1e3/t,a=(t,s=Date.now())=>{r=s,i=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{let t=Date.now(),o=t-r;o>=s?a(e,t):(i=e,n||(n=setTimeout(()=>{n=null,a(i)},s-o)))},()=>i&&a(i)]},ta=(e,t,i=3)=>{let n=0,r=tr(50,250);return ts(i=>{let s=i.loaded,a=i.lengthComputable?i.total:void 0,o=s-n,l=r(o),c=s<=a;n=s,e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&c?(a-s)/l:void 0,event:i,lengthComputable:null!=a,[t?"download":"upload"]:!0})},i)},to=(e,t)=>{let i=null!=e;return[n=>t[0]({lengthComputable:i,total:e,loaded:n}),t[1]]},tl=e=>(...t)=>ef.asap(()=>e(...t)),tc=eH.hasStandardBrowserEnv?function(){let e,t=eH.navigator&&/(msie|trident)/i.test(eH.navigator.userAgent),i=document.createElement("a");function n(e){let n=e;return t&&(i.setAttribute("href",n),n=i.href),i.setAttribute("href",n),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return e=n(window.location.href),function(t){let i=ef.isString(t)?n(t):t;return i.protocol===e.protocol&&i.host===e.host}}():function(){return function(){return!0}}(),td=eH.hasStandardBrowserEnv?{write(e,t,i,n,r,s){let a=[e+"="+encodeURIComponent(t)];ef.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),ef.isString(n)&&a.push("path="+n),ef.isString(r)&&a.push("domain="+r),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read(e){let t=document.cookie.match(RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function tu(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function th(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function tg(e,t){return e&&!tu(t)?th(e,t):t}let tp=e=>e instanceof e8?{...e}:e;function tf(e,t){t=t||{};let i={};function n(e,t,i){return ef.isPlainObject(e)&&ef.isPlainObject(t)?ef.merge.call({caseless:i},e,t):ef.isPlainObject(t)?ef.merge({},t):ef.isArray(t)?t.slice():t}function r(e,t,i){return ef.isUndefined(t)?ef.isUndefined(e)?void 0:n(void 0,e,i):n(e,t,i)}function s(e,t){if(!ef.isUndefined(t))return n(void 0,t)}function a(e,t){return ef.isUndefined(t)?ef.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(i,r,s){return s in t?n(i,r):s in e?n(void 0,i):void 0}let l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t)=>r(tp(e),tp(t),!0)};return ef.forEach(Object.keys(Object.assign({},e,t)),function(n){let s=l[n]||r,a=s(e[n],t[n],n);ef.isUndefined(a)&&s!==o||(i[n]=a)}),i}let tm=e=>{let t,i=tf({},e),{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:o,auth:l}=i;if(i.headers=o=e8.from(o),i.url=eO(tg(i.baseURL,i.url),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),ef.isFormData(n)){if(eH.hasStandardBrowserEnv||eH.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(t=o.getContentType())){let[e,...i]=t?t.split(";").map(e=>e.trim()).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...i].join("; "))}}if(eH.hasStandardBrowserEnv&&(r&&ef.isFunction(r)&&(r=r(i)),r||!1!==r&&tc(i.url))){let e=s&&a&&td.read(a);e&&o.set(s,e)}return i},tv="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,i){let n,r,s,a,o,l=tm(e),c=l.data,d=e8.from(l.headers).normalize(),{responseType:u,onUploadProgress:h,onDownloadProgress:g}=l;function p(){a&&a(),o&&o(),l.cancelToken&&l.cancelToken.unsubscribe(n),l.signal&&l.signal.removeEventListener("abort",n)}let f=new XMLHttpRequest;function m(){if(!f)return;let n=e8.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());ti(function(e){t(e),p()},function(e){i(e),p()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(l.method.toUpperCase(),l.url,!0),f.timeout=l.timeout,"onloadend"in f?f.onloadend=m:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(m)},f.onabort=function(){f&&(i(new ey("Request aborted",ey.ECONNABORTED,e,f)),f=null)},f.onerror=function(){i(new ey("Network Error",ey.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded",n=l.transitional||ex;l.timeoutErrorMessage&&(t=l.timeoutErrorMessage),i(new ey(t,n.clarifyTimeoutError?ey.ETIMEDOUT:ey.ECONNABORTED,e,f)),f=null},void 0===c&&d.setContentType(null),"setRequestHeader"in f&&ef.forEach(d.toJSON(),function(e,t){f.setRequestHeader(t,e)}),ef.isUndefined(l.withCredentials)||(f.withCredentials=!!l.withCredentials),u&&"json"!==u&&(f.responseType=l.responseType),g&&([s,o]=ta(g,!0),f.addEventListener("progress",s)),h&&f.upload&&([r,a]=ta(h),f.upload.addEventListener("progress",r),f.upload.addEventListener("loadend",a)),(l.cancelToken||l.signal)&&(n=t=>{f&&(i(!t||t.type?new tt(null,e,f):t),f.abort(),f=null)},l.cancelToken&&l.cancelToken.subscribe(n),l.signal&&(l.signal.aborted?n():l.signal.addEventListener("abort",n)));let v=tn(l.url);if(v&&-1===eH.protocols.indexOf(v))return void i(new ey("Unsupported protocol "+v+":",ey.ERR_BAD_REQUEST,e));f.send(c||null)})},tS=(e,t)=>{let{length:i}=e=e?e.filter(Boolean):[];if(t||i){let i,n=new AbortController,r=function(e){if(!i){i=!0,a();let t=e instanceof Error?e:this.reason;n.abort(t instanceof ey?t:new tt(t instanceof Error?t.message:t))}},s=t&&setTimeout(()=>{s=null,r(new ey(`timeout ${t} of ms exceeded`,ey.ETIMEDOUT))},t),a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));let{signal:o}=n;return o.unsubscribe=()=>ef.asap(a),o}},ty=function*(e,t){let i,n=e.byteLength;if(!t||n<t)return void(yield e);let r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},tC=async function*(e,t){for await(let i of tb(e))yield*ty(i,t)},tb=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);let t=e.getReader();try{for(;;){let{done:e,value:i}=await t.read();if(e)break;yield i}}finally{await t.cancel()}},tT=(e,t,i,n)=>{let r,s=tC(e,t),a=0,o=e=>{!r&&(r=!0,n&&n(e))};return new ReadableStream({async pull(e){try{let{done:t,value:n}=await s.next();if(t){o(),e.close();return}let r=n.byteLength;if(i){let e=a+=r;i(e)}e.enqueue(new Uint8Array(n))}catch(e){throw o(e),e}},cancel:e=>(o(e),s.return())},{highWaterMark:2})},tE="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,t_=tE&&"function"==typeof ReadableStream,tI=tE&&("function"==typeof TextEncoder?(s=new TextEncoder,e=>s.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer())),tw=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},tP=t_&&tw(()=>{let e=!1,t=new Request(eH.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),tR=65536,tA=t_&&tw(()=>ef.isReadableStream(new Response("").body)),tM={stream:tA&&(e=>e.body)};tE&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{tM[t]||(tM[t]=ef.isFunction(e[t])?e=>e[t]():(e,i)=>{throw new ey(`Response type '${t}' is not supported`,ey.ERR_NOT_SUPPORT,i)})})})(new Response);let tD=async e=>{if(null==e)return 0;if(ef.isBlob(e))return e.size;if(ef.isSpecCompliantForm(e)){let t=new Request(eH.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return ef.isArrayBufferView(e)||ef.isArrayBuffer(e)?e.byteLength:(ef.isURLSearchParams(e)&&(e+=""),ef.isString(e))?(await tI(e)).byteLength:void 0},tO=async(e,t)=>{let i=ef.toFiniteNumber(e.getContentLength());return null==i?tD(t):i},tk={http:eC,xhr:tv,fetch:tE&&(async e=>{let t,i,{url:n,method:r,data:s,signal:a,cancelToken:o,timeout:l,onDownloadProgress:c,onUploadProgress:d,responseType:u,headers:h,withCredentials:g="same-origin",fetchOptions:p}=tm(e);u=u?(u+"").toLowerCase():"text";let f=tS([a,o&&o.toAbortSignal()],l),m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});try{if(d&&tP&&"get"!==r&&"head"!==r&&0!==(i=await tO(h,s))){let e,t=new Request(n,{method:"POST",body:s,duplex:"half"});if(ef.isFormData(s)&&(e=t.headers.get("content-type"))&&h.setContentType(e),t.body){let[e,n]=to(i,ta(tl(d)));s=tT(t.body,tR,e,n)}}ef.isString(g)||(g=g?"include":"omit");let a="credentials"in Request.prototype;t=new Request(n,{...p,signal:f,method:r.toUpperCase(),headers:h.normalize().toJSON(),body:s,duplex:"half",credentials:a?g:void 0});let o=await fetch(t),l=tA&&("stream"===u||"response"===u);if(tA&&(c||l&&m)){let e={};["status","statusText","headers"].forEach(t=>{e[t]=o[t]});let t=ef.toFiniteNumber(o.headers.get("content-length")),[i,n]=c&&to(t,ta(tl(c),!0))||[];o=new Response(tT(o.body,tR,i,()=>{n&&n(),m&&m()}),e)}u=u||"text";let v=await tM[ef.findKey(tM,u)||"text"](o,e);return!l&&m&&m(),await new Promise((i,n)=>{ti(i,n,{data:v,headers:e8.from(o.headers),status:o.status,statusText:o.statusText,config:e,request:t})})}catch(i){if(m&&m(),i&&"TypeError"===i.name&&/fetch/i.test(i.message))throw Object.assign(new ey("Network Error",ey.ERR_NETWORK,e,t),{cause:i.cause||i});throw ey.from(i,i&&i.code,e,t)}})};ef.forEach(tk,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});let tN=e=>`- ${e}`,tx=e=>ef.isFunction(e)||null===e||!1===e,tL=e=>{let t,i,{length:n}=e=ef.isArray(e)?e:[e],r={};for(let s=0;s<n;s++){let n;if(i=t=e[s],!tx(t)&&void 0===(i=tk[(n=String(t)).toLowerCase()]))throw new ey(`Unknown adapter '${n}'`);if(i)break;r[n||"#"+s]=i}if(!i){let e=Object.entries(r).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new ey("There is no suitable adapter to dispatch the request "+(n?e.length>1?"since :\n"+e.map(tN).join("\n"):" "+tN(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function tF(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new tt(null,e)}function tU(e){return tF(e),e.headers=e8.from(e.headers),e.data=e9.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),tL(e.adapter||eK.adapter)(e).then(function(t){return tF(e),t.data=e9.call(e,e.transformResponse,t),t.headers=e8.from(t.headers),t},function(t){return!e7(t)&&(tF(e),t&&t.response&&(t.response.data=e9.call(e,e.transformResponse,t.response),t.response.headers=e8.from(t.response.headers))),Promise.reject(t)})}let t$="1.7.7",tV={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{tV[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});let tB={};tV.transitional=function(e,t,i){function n(e,t){return"[Axios v"+t$+"] Transitional option '"+e+"'"+t+(i?". "+i:"")}return(i,r,s)=>{if(!1===e)throw new ey(n(r," has been removed"+(t?" in "+t:"")),ey.ERR_DEPRECATED);return t&&!tB[r]&&(tB[r]=!0,console.warn(n(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,r,s)}};let tH=function(e,t,i){if("object"!=typeof e)throw new ey("options must be an object",ey.ERR_BAD_OPTION_VALUE);let n=Object.keys(e),r=n.length;for(;r-- >0;){let s=n[r],a=t[s];if(a){let t=e[s],i=void 0===t||a(t,s,e);if(!0!==i)throw new ey("option "+s+" must be "+i,ey.ERR_BAD_OPTION_VALUE);continue}if(!0!==i)throw new ey("Unknown option "+s,ey.ERR_BAD_OPTION)}},tj=tV;class tq{constructor(e){this.defaults=e,this.interceptors={request:new eN,response:new eN}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=Error();let i=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?i&&!String(e.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+i):e.stack=i}catch(e){}}throw e}}_request(e,t){let i,n;"string"==typeof e?(t=t||{}).url=e:t=e||{};let{transitional:r,paramsSerializer:s,headers:a}=t=tf(this.defaults,t);void 0!==r&&tH(r,{silentJSONParsing:tj.transitional(tj.boolean),forcedJSONParsing:tj.transitional(tj.boolean),clarifyTimeoutError:tj.transitional(tj.boolean)},!1),null!=s&&(ef.isFunction(s)?t.paramsSerializer={serialize:s}:tH(s,{encode:tj.function,serialize:tj.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=a&&ef.merge(a.common,a[t.method]);a&&ef.forEach(["delete","get","head","post","put","patch","common"],e=>{delete a[e]}),t.headers=e8.concat(o,a);let l=[],c=!0;this.interceptors.request.forEach(function(e){("function"!=typeof e.runWhen||!1!==e.runWhen(t))&&(c=c&&e.synchronous,l.unshift(e.fulfilled,e.rejected))});let d=[];this.interceptors.response.forEach(function(e){d.push(e.fulfilled,e.rejected)});let u=0;if(!c){let e=[tU.bind(this),void 0];for(e.unshift.apply(e,l),e.push.apply(e,d),n=e.length,i=Promise.resolve(t);u<n;)i=i.then(e[u++],e[u++]);return i}n=l.length;let h=t;for(u=0;u<n;){let e=l[u++],t=l[u++];try{h=e(h)}catch(e){t.call(this,e);break}}try{i=tU.call(this,h)}catch(e){return Promise.reject(e)}for(u=0,n=d.length;u<n;)i=i.then(d[u++],d[u++]);return i}getUri(e){return eO(tg((e=tf(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}ef.forEach(["delete","get","head","options"],function(e){tq.prototype[e]=function(t,i){return this.request(tf(i||{},{method:e,url:t,data:(i||{}).data}))}}),ef.forEach(["post","put","patch"],function(e){function t(t){return function(i,n,r){return this.request(tf(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}tq.prototype[e]=t(),tq.prototype[e+"Form"]=t(!0)});let tW=tq;class tG{constructor(e){let t;if("function"!=typeof e)throw TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});let i=this;this.promise.then(e=>{if(!i._listeners)return;let t=i._listeners.length;for(;t-- >0;)i._listeners[t](e);i._listeners=null}),this.promise.then=e=>{let t,n=new Promise(e=>{i.subscribe(e),t=e}).then(e);return n.cancel=function(){i.unsubscribe(t)},n},e(function(e,n,r){i.reason||(i.reason=new tt(e,n,r),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason)return void e(this.reason);this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new tG(function(t){e=t}),cancel:e}}}let tz=tG;function tJ(e){return function(t){return e.apply(null,t)}}function tK(e){return ef.isObject(e)&&!0===e.isAxiosError}let tQ={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tQ).forEach(([e,t])=>{tQ[t]=e});let tY=tQ;function tZ(e){let t=new tW(e),i=o(tW.prototype.request,t);return ef.extend(i,tW.prototype,t,{allOwnKeys:!0}),ef.extend(i,t,null,{allOwnKeys:!0}),i.create=function(t){return tZ(tf(e,t))},i}let tX=tZ(eK);tX.Axios=tW,tX.CanceledError=tt,tX.CancelToken=tz,tX.isCancel=e7,tX.VERSION=t$,tX.toFormData=ew,tX.AxiosError=ey,tX.Cancel=tX.CanceledError,tX.all=function(e){return Promise.all(e)},tX.spread=tJ,tX.isAxiosError=tK,tX.mergeConfig=tf,tX.AxiosHeaders=e8,tX.formToJSON=e=>eG(ef.isHTMLForm(e)?new FormData(e):e),tX.getAdapter=tL,tX.HttpStatusCode=tY,tX.default=tX;let t0=tX},997844:function(e,t,i){"use strict";function n(e){if(!Array.isArray(e))return Array.from(e);for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}i.d(t,{Qp:()=>S,tG:()=>y});var r=!1;if("undefined"!=typeof window){var s={get passive(){r=!0;return}};window.addEventListener("testPassive",null,s),window.removeEventListener("testPassive",null,s)}var a="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),o=[],l=!1,c=-1,d=void 0,u=void 0,h=function(e){return o.some(function(t){return!!(t.options.allowTouchMove&&t.options.allowTouchMove(e))})},g=function(e){var t=e||window.event;return!!h(t.target)||t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1)},p=function(e){if(void 0===u){var t=!!e&&!0===e.reserveScrollBarGap,i=window.innerWidth-document.documentElement.clientWidth;t&&i>0&&(u=document.body.style.paddingRight,document.body.style.paddingRight=i+"px")}void 0===d&&(d=document.body.style.overflow,document.body.style.overflow="hidden")},f=function(){void 0!==u&&(document.body.style.paddingRight=u,u=void 0),void 0!==d&&(document.body.style.overflow=d,d=void 0)},m=function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight},v=function(e,t){var i=e.targetTouches[0].clientY-c;return!h(e.target)&&(t&&0===t.scrollTop&&i>0||m(t)&&i<0?g(e):(e.stopPropagation(),!0))},S=function(e,t){if(!e)return void console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");if(!o.some(function(t){return t.targetElement===e})){var i={targetElement:e,options:t||{}};o=[].concat(n(o),[i]),a?(e.ontouchstart=function(e){1===e.targetTouches.length&&(c=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&v(t,e)},l||(document.addEventListener("touchmove",g,r?{passive:!1}:void 0),l=!0)):p(t)}},y=function(e){if(!e)return void console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");o=o.filter(function(t){return t.targetElement!==e}),a?(e.ontouchstart=null,e.ontouchmove=null,l&&0===o.length&&(document.removeEventListener("touchmove",g,r?{passive:!1}:void 0),l=!1)):o.length||f()}},350999:function(e,t){"use strict";var i;i={value:!0},t.createChangeEmitter=function(){var e=[],t=e;function i(){t===e&&(t=e.slice())}return{listen:function(e){if("function"!=typeof e)throw Error("Expected listener to be a function.");var n=!0;return i(),t.push(e),function(){if(n){n=!1,i();var r=t.indexOf(e);t.splice(r,1)}}},emit:function(){for(var i=e=t,n=0;n<i.length;n++)i[n].apply(i,arguments)}}}},40841:function(e){!function(){"use strict";var t={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var i=arguments[t];i&&(e=r(e,n(i)))}return e}function n(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var n="";for(var s in e)t.call(e,s)&&e[s]&&(n=r(n,s));return n}function r(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i,Object.defineProperty(e.exports,"__esModule",{value:!0})):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return i}):window.classNames=i}()},860045:function(e,t,i){"use strict";function n(e){var t,i,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(i=n(e[t]))&&(r&&(r+=" "),r+=i);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,i=0,r="";i<arguments.length;)(e=arguments[i++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}i.r(t),i.d(t,{clsx:()=>r,default:()=>s});let s=r},406417:function(e,t,i){"use strict";function n(e){return null!=e&&"object"==typeof e&&1===e.nodeType}function r(e,t){return(!t||"hidden"!==e)&&"visible"!==e&&"clip"!==e}function s(e,t){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var i=getComputedStyle(e,null);return r(i.overflowY,t)||r(i.overflowX,t)}return!1}function a(e,t,i,n,r,s,a,o){return s<e&&a>t||s>e&&a<t?0:s<=e&&o<=i||a>=t&&o>=i?s-e-n:a>t&&o<i||s<e&&o>i?a-t+r:0}i.d(t,{Z:()=>o});let o=function(e,t){var i=t.scrollMode,r=t.block,o=t.inline,l=t.boundary,c=t.skipOverflowHiddenElements,d="function"==typeof l?l:function(e){return e!==l};if(!n(e))throw TypeError("Invalid target");for(var u=document.scrollingElement||document.documentElement,h=[],g=e;n(g)&&d(g);){if((g=g.parentNode)===u){h.push(g);break}(!(g===document.body&&s(g))||s(document.documentElement))&&s(g,c)&&h.push(g)}for(var p=window.visualViewport?visualViewport.width:innerWidth,f=window.visualViewport?visualViewport.height:innerHeight,m=window.scrollX||pageXOffset,v=window.scrollY||pageYOffset,S=e.getBoundingClientRect(),y=S.height,C=S.width,b=S.top,T=S.right,E=S.bottom,_=S.left,I="start"===r||"nearest"===r?b:"end"===r?E:b+y/2,w="center"===o?_+C/2:"end"===o?T:_,P=[],R=0;R<h.length;R++){var A=h[R],M=A.getBoundingClientRect(),D=M.height,O=M.width,k=M.top,N=M.right,x=M.bottom,L=M.left;if("if-needed"===i&&b>=0&&_>=0&&E<=f&&T<=p&&b>=k&&E<=x&&_>=L&&T<=N)break;var F=getComputedStyle(A),U=parseInt(F.borderLeftWidth,10),$=parseInt(F.borderTopWidth,10),V=parseInt(F.borderRightWidth,10),B=parseInt(F.borderBottomWidth,10),H=0,j=0,q="offsetWidth"in A?A.offsetWidth-A.clientWidth-U-V:0,W="offsetHeight"in A?A.offsetHeight-A.clientHeight-$-B:0;if(u===A)H="start"===r?I:"end"===r?I-f:"nearest"===r?a(v,v+f,f,$,B,v+I,v+I+y,y):I-f/2,j="start"===o?w:"center"===o?w-p/2:"end"===o?w-p:a(m,m+p,p,U,V,m+w,m+w+C,C),H=Math.max(0,H+v),j=Math.max(0,j+m);else{H="start"===r?I-k-$:"end"===r?I-x+B+W:"nearest"===r?a(k,x,D,$,B+W,I,I+y,y):I-(k+D/2)+W/2,j="start"===o?w-L-U:"center"===o?w-(L+O/2)+q/2:"end"===o?w-N+V+q:a(L,N,O,U,V+q,w,w+C,C);var G=A.scrollLeft,z=A.scrollTop;H=Math.max(0,Math.min(z+H,A.scrollHeight-D+W)),j=Math.max(0,Math.min(G+j,A.scrollWidth-O+q)),I+=z-H,w+=G-j}P.push({el:A,top:H,left:j})}return P}},64859:function(e,t,i){"use strict";function n(e,t){if(null==e)throw TypeError("assign requires that input parameter not be null or undefined");for(var i in t=t||{})Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}i.d(t,{Z:()=>n})},954333:function(e,t,i){"use strict";i.d(t,{Z:()=>s});var n=i(600907),r=i(496256);function s(e,t){(0,r.Z)(2,arguments);var i=(0,n.Z)(e),s=(0,n.Z)(t);return i.getTime()===s.getTime()}},392118:function(e,t,i){"use strict";i.d(t,{Z:()=>a});var n=i(2715),r=i(496256);function s(e,t,i){(0,r.Z)(2,arguments);var s=(0,n.Z)(e,i),a=(0,n.Z)(t,i);return s.getTime()===a.getTime()}function a(e,t){return(0,r.Z)(1,arguments),s(e,Date.now(),t)}},281537:function(e,t,i){"use strict";i.d(t,{Z:()=>s});var n=i(482757),r=i(496256);function s(e){return(0,r.Z)(1,arguments),(0,n.Z)(e,Date.now())}},801360:function(e,t,i){"use strict";i.d(t,{Z:()=>eh});var n=i(552775),r=i(241919),s=i(600907),a=i(64859),o=i(12907),l=i(422774),c=i(316949),d=i(910420),u=i(762559),h=i(496256);function g(e,t,i){(0,h.Z)(2,arguments);var n=i||{},r=n.locale,a=r&&r.options&&r.options.weekStartsOn,o=null==a?0:(0,d.Z)(a),l=null==n.weekStartsOn?o:(0,d.Z)(n.weekStartsOn);if(!(l>=0&&l<=6))throw RangeError("weekStartsOn must be between 0 and 6 inclusively");var c=(0,s.Z)(e),u=(0,d.Z)(t),g=7*((u%7+7)%7<l)+u-c.getUTCDay();return c.setUTCDate(c.getUTCDate()+g),c}function p(e,t){(0,h.Z)(2,arguments);var i=(0,d.Z)(t);i%7==0&&(i-=7);var n=1,r=(0,s.Z)(e),a=7*((i%7+7)%7<n)+i-r.getUTCDay();return r.setUTCDate(r.getUTCDate()+a),r}var f=i(270069);function m(e,t){(0,h.Z)(2,arguments);var i=(0,s.Z)(e),n=(0,d.Z)(t),r=(0,f.Z)(i)-n;return i.setUTCDate(i.getUTCDate()-7*r),i}var v=i(402731);function S(e,t,i){(0,h.Z)(2,arguments);var n=(0,s.Z)(e),r=(0,d.Z)(t),a=(0,v.Z)(n,i)-r;return n.setUTCDate(n.getUTCDate()-7*a),n}var y=i(401309),C=i(246784),b=36e5,T=6e4,E=1e3,_=/^(1[0-2]|0?\d)/,I=/^(3[0-1]|[0-2]?\d)/,w=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,P=/^(5[0-3]|[0-4]?\d)/,R=/^(2[0-3]|[0-1]?\d)/,A=/^(2[0-4]|[0-1]?\d)/,M=/^(1[0-1]|0?\d)/,D=/^(1[0-2]|0?\d)/,O=/^[0-5]?\d/,k=/^[0-5]?\d/,N=/^\d/,x=/^\d{1,2}/,L=/^\d{1,3}/,F=/^\d{1,4}/,U=/^-?\d+/,$=/^-?\d/,V=/^-?\d{1,2}/,B=/^-?\d{1,3}/,H=/^-?\d{1,4}/,j=/^([+-])(\d{2})(\d{2})?|Z/,q=/^([+-])(\d{2})(\d{2})|Z/,W=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,G=/^([+-])(\d{2}):(\d{2})|Z/,z=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function J(e,t,i){var n=t.match(e);if(!n)return null;var r=parseInt(n[0],10);return{value:i?i(r):r,rest:t.slice(n[0].length)}}function K(e,t){var i=t.match(e);return i?"Z"===i[0]?{value:0,rest:t.slice(1)}:{value:("+"===i[1]?1:-1)*((i[2]?parseInt(i[2],10):0)*b+(i[3]?parseInt(i[3],10):0)*T+(i[5]?parseInt(i[5],10):0)*E),rest:t.slice(i[0].length)}:null}function Q(e,t){return J(U,e,t)}function Y(e,t,i){switch(e){case 1:return J(N,t,i);case 2:return J(x,t,i);case 3:return J(L,t,i);case 4:return J(F,t,i);default:return J(RegExp("^\\d{1,"+e+"}"),t,i)}}function Z(e,t,i){switch(e){case 1:return J($,t,i);case 2:return J(V,t,i);case 3:return J(B,t,i);case 4:return J(H,t,i);default:return J(RegExp("^-?\\d{1,"+e+"}"),t,i)}}function X(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function ee(e,t){var i,n=t>0,r=n?t:1-t;if(r<=50)i=e||100;else{var s=r+50,a=100*Math.floor(s/100),o=e>=s%100;i=e+a-100*!!o}return n?i:1-i}var et=[31,28,31,30,31,30,31,31,30,31,30,31],ei=[31,29,31,30,31,30,31,31,30,31,30,31];function en(e){return e%400==0||e%4==0&&e%100!=0}let er={G:{priority:140,parse:function(e,t,i,n){switch(t){case"G":case"GG":case"GGG":return i.era(e,{width:"abbreviated"})||i.era(e,{width:"narrow"});case"GGGGG":return i.era(e,{width:"narrow"});default:return i.era(e,{width:"wide"})||i.era(e,{width:"abbreviated"})||i.era(e,{width:"narrow"})}},set:function(e,t,i,n){return t.era=i,e.setUTCFullYear(i,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["R","u","t","T"]},y:{priority:130,parse:function(e,t,i,n){var r=function(e){return{year:e,isTwoDigitYear:"yy"===t}};switch(t){case"y":return Y(4,e,r);case"yo":return i.ordinalNumber(e,{unit:"year",valueCallback:r});default:return Y(t.length,e,r)}},validate:function(e,t,i){return t.isTwoDigitYear||t.year>0},set:function(e,t,i,n){var r=e.getUTCFullYear();if(i.isTwoDigitYear){var s=ee(i.year,r);return e.setUTCFullYear(s,0,1),e.setUTCHours(0,0,0,0),e}var a="era"in t&&1!==t.era?1-i.year:i.year;return e.setUTCFullYear(a,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","u","w","I","i","e","c","t","T"]},Y:{priority:130,parse:function(e,t,i,n){var r=function(e){return{year:e,isTwoDigitYear:"YY"===t}};switch(t){case"Y":return Y(4,e,r);case"Yo":return i.ordinalNumber(e,{unit:"year",valueCallback:r});default:return Y(t.length,e,r)}},validate:function(e,t,i){return t.isTwoDigitYear||t.year>0},set:function(e,t,i,n){var r=(0,u.Z)(e,n);if(i.isTwoDigitYear){var s=ee(i.year,r);return e.setUTCFullYear(s,0,n.firstWeekContainsDate),e.setUTCHours(0,0,0,0),(0,C.Z)(e,n)}var a="era"in t&&1!==t.era?1-i.year:i.year;return e.setUTCFullYear(a,0,n.firstWeekContainsDate),e.setUTCHours(0,0,0,0),(0,C.Z)(e,n)},incompatibleTokens:["y","R","u","Q","q","M","L","I","d","D","i","t","T"]},R:{priority:130,parse:function(e,t,i,n){return"R"===t?Z(4,e):Z(t.length,e)},set:function(e,t,i,n){var r=new Date(0);return r.setUTCFullYear(i,0,4),r.setUTCHours(0,0,0,0),(0,y.Z)(r)},incompatibleTokens:["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]},u:{priority:130,parse:function(e,t,i,n){return"u"===t?Z(4,e):Z(t.length,e)},set:function(e,t,i,n){return e.setUTCFullYear(i,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["G","y","Y","R","w","I","i","e","c","t","T"]},Q:{priority:120,parse:function(e,t,i,n){switch(t){case"Q":case"QQ":return Y(t.length,e);case"Qo":return i.ordinalNumber(e,{unit:"quarter"});case"QQQ":return i.quarter(e,{width:"abbreviated",context:"formatting"})||i.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return i.quarter(e,{width:"narrow",context:"formatting"});default:return i.quarter(e,{width:"wide",context:"formatting"})||i.quarter(e,{width:"abbreviated",context:"formatting"})||i.quarter(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,i){return t>=1&&t<=4},set:function(e,t,i,n){return e.setUTCMonth((i-1)*3,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]},q:{priority:120,parse:function(e,t,i,n){switch(t){case"q":case"qq":return Y(t.length,e);case"qo":return i.ordinalNumber(e,{unit:"quarter"});case"qqq":return i.quarter(e,{width:"abbreviated",context:"standalone"})||i.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return i.quarter(e,{width:"narrow",context:"standalone"});default:return i.quarter(e,{width:"wide",context:"standalone"})||i.quarter(e,{width:"abbreviated",context:"standalone"})||i.quarter(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,i){return t>=1&&t<=4},set:function(e,t,i,n){return e.setUTCMonth((i-1)*3,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]},M:{priority:110,parse:function(e,t,i,n){var r=function(e){return e-1};switch(t){case"M":return J(_,e,r);case"MM":return Y(2,e,r);case"Mo":return i.ordinalNumber(e,{unit:"month",valueCallback:r});case"MMM":return i.month(e,{width:"abbreviated",context:"formatting"})||i.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return i.month(e,{width:"narrow",context:"formatting"});default:return i.month(e,{width:"wide",context:"formatting"})||i.month(e,{width:"abbreviated",context:"formatting"})||i.month(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,i){return t>=0&&t<=11},set:function(e,t,i,n){return e.setUTCMonth(i,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]},L:{priority:110,parse:function(e,t,i,n){var r=function(e){return e-1};switch(t){case"L":return J(_,e,r);case"LL":return Y(2,e,r);case"Lo":return i.ordinalNumber(e,{unit:"month",valueCallback:r});case"LLL":return i.month(e,{width:"abbreviated",context:"standalone"})||i.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return i.month(e,{width:"narrow",context:"standalone"});default:return i.month(e,{width:"wide",context:"standalone"})||i.month(e,{width:"abbreviated",context:"standalone"})||i.month(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,i){return t>=0&&t<=11},set:function(e,t,i,n){return e.setUTCMonth(i,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]},w:{priority:100,parse:function(e,t,i,n){switch(t){case"w":return J(P,e);case"wo":return i.ordinalNumber(e,{unit:"week"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=1&&t<=53},set:function(e,t,i,n){return(0,C.Z)(S(e,i,n),n)},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","i","t","T"]},I:{priority:100,parse:function(e,t,i,n){switch(t){case"I":return J(P,e);case"Io":return i.ordinalNumber(e,{unit:"week"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=1&&t<=53},set:function(e,t,i,n){return(0,y.Z)(m(e,i,n),n)},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]},d:{priority:90,subPriority:1,parse:function(e,t,i,n){switch(t){case"d":return J(I,e);case"do":return i.ordinalNumber(e,{unit:"date"});default:return Y(t.length,e)}},validate:function(e,t,i){var n=en(e.getUTCFullYear()),r=e.getUTCMonth();return n?t>=1&&t<=ei[r]:t>=1&&t<=et[r]},set:function(e,t,i,n){return e.setUTCDate(i),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","w","I","D","i","e","c","t","T"]},D:{priority:90,subPriority:1,parse:function(e,t,i,n){switch(t){case"D":case"DD":return J(w,e);case"Do":return i.ordinalNumber(e,{unit:"date"});default:return Y(t.length,e)}},validate:function(e,t,i){return en(e.getUTCFullYear())?t>=1&&t<=366:t>=1&&t<=365},set:function(e,t,i,n){return e.setUTCMonth(0,i),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]},E:{priority:90,parse:function(e,t,i,n){switch(t){case"E":case"EE":case"EEE":return i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return i.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});default:return i.day(e,{width:"wide",context:"formatting"})||i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,i){return t>=0&&t<=6},set:function(e,t,i,n){return(e=g(e,i,n)).setUTCHours(0,0,0,0),e},incompatibleTokens:["D","i","e","c","t","T"]},e:{priority:90,parse:function(e,t,i,n){var r=function(e){var t=7*Math.floor((e-1)/7);return(e+n.weekStartsOn+6)%7+t};switch(t){case"e":case"ee":return Y(t.length,e,r);case"eo":return i.ordinalNumber(e,{unit:"day",valueCallback:r});case"eee":return i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});case"eeeee":return i.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});default:return i.day(e,{width:"wide",context:"formatting"})||i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,i){return t>=0&&t<=6},set:function(e,t,i,n){return(e=g(e,i,n)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]},c:{priority:90,parse:function(e,t,i,n){var r=function(e){var t=7*Math.floor((e-1)/7);return(e+n.weekStartsOn+6)%7+t};switch(t){case"c":case"cc":return Y(t.length,e,r);case"co":return i.ordinalNumber(e,{unit:"day",valueCallback:r});case"ccc":return i.day(e,{width:"abbreviated",context:"standalone"})||i.day(e,{width:"short",context:"standalone"})||i.day(e,{width:"narrow",context:"standalone"});case"ccccc":return i.day(e,{width:"narrow",context:"standalone"});case"cccccc":return i.day(e,{width:"short",context:"standalone"})||i.day(e,{width:"narrow",context:"standalone"});default:return i.day(e,{width:"wide",context:"standalone"})||i.day(e,{width:"abbreviated",context:"standalone"})||i.day(e,{width:"short",context:"standalone"})||i.day(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,i){return t>=0&&t<=6},set:function(e,t,i,n){return(e=g(e,i,n)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]},i:{priority:90,parse:function(e,t,i,n){var r=function(e){return 0===e?7:e};switch(t){case"i":case"ii":return Y(t.length,e);case"io":return i.ordinalNumber(e,{unit:"day"});case"iii":return i.day(e,{width:"abbreviated",context:"formatting",valueCallback:r})||i.day(e,{width:"short",context:"formatting",valueCallback:r})||i.day(e,{width:"narrow",context:"formatting",valueCallback:r});case"iiiii":return i.day(e,{width:"narrow",context:"formatting",valueCallback:r});case"iiiiii":return i.day(e,{width:"short",context:"formatting",valueCallback:r})||i.day(e,{width:"narrow",context:"formatting",valueCallback:r});default:return i.day(e,{width:"wide",context:"formatting",valueCallback:r})||i.day(e,{width:"abbreviated",context:"formatting",valueCallback:r})||i.day(e,{width:"short",context:"formatting",valueCallback:r})||i.day(e,{width:"narrow",context:"formatting",valueCallback:r})}},validate:function(e,t,i){return t>=1&&t<=7},set:function(e,t,i,n){return(e=p(e,i,n)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]},a:{priority:80,parse:function(e,t,i,n){switch(t){case"a":case"aa":case"aaa":return i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return i.dayPeriod(e,{width:"narrow",context:"formatting"});default:return i.dayPeriod(e,{width:"wide",context:"formatting"})||i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,i,n){return e.setUTCHours(X(i),0,0,0),e},incompatibleTokens:["b","B","H","K","k","t","T"]},b:{priority:80,parse:function(e,t,i,n){switch(t){case"b":case"bb":case"bbb":return i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return i.dayPeriod(e,{width:"narrow",context:"formatting"});default:return i.dayPeriod(e,{width:"wide",context:"formatting"})||i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,i,n){return e.setUTCHours(X(i),0,0,0),e},incompatibleTokens:["a","B","H","K","k","t","T"]},B:{priority:80,parse:function(e,t,i,n){switch(t){case"B":case"BB":case"BBB":return i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return i.dayPeriod(e,{width:"narrow",context:"formatting"});default:return i.dayPeriod(e,{width:"wide",context:"formatting"})||i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,i,n){return e.setUTCHours(X(i),0,0,0),e},incompatibleTokens:["a","b","t","T"]},h:{priority:70,parse:function(e,t,i,n){switch(t){case"h":return J(D,e);case"ho":return i.ordinalNumber(e,{unit:"hour"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=1&&t<=12},set:function(e,t,i,n){var r=e.getUTCHours()>=12;return r&&i<12?e.setUTCHours(i+12,0,0,0):r||12!==i?e.setUTCHours(i,0,0,0):e.setUTCHours(0,0,0,0),e},incompatibleTokens:["H","K","k","t","T"]},H:{priority:70,parse:function(e,t,i,n){switch(t){case"H":return J(R,e);case"Ho":return i.ordinalNumber(e,{unit:"hour"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=0&&t<=23},set:function(e,t,i,n){return e.setUTCHours(i,0,0,0),e},incompatibleTokens:["a","b","h","K","k","t","T"]},K:{priority:70,parse:function(e,t,i,n){switch(t){case"K":return J(M,e);case"Ko":return i.ordinalNumber(e,{unit:"hour"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=0&&t<=11},set:function(e,t,i,n){return e.getUTCHours()>=12&&i<12?e.setUTCHours(i+12,0,0,0):e.setUTCHours(i,0,0,0),e},incompatibleTokens:["a","b","h","H","k","t","T"]},k:{priority:70,parse:function(e,t,i,n){switch(t){case"k":return J(A,e);case"ko":return i.ordinalNumber(e,{unit:"hour"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=1&&t<=24},set:function(e,t,i,n){var r=i<=24?i%24:i;return e.setUTCHours(r,0,0,0),e},incompatibleTokens:["a","b","h","H","K","t","T"]},m:{priority:60,parse:function(e,t,i,n){switch(t){case"m":return J(O,e);case"mo":return i.ordinalNumber(e,{unit:"minute"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=0&&t<=59},set:function(e,t,i,n){return e.setUTCMinutes(i,0,0),e},incompatibleTokens:["t","T"]},s:{priority:50,parse:function(e,t,i,n){switch(t){case"s":return J(k,e);case"so":return i.ordinalNumber(e,{unit:"second"});default:return Y(t.length,e)}},validate:function(e,t,i){return t>=0&&t<=59},set:function(e,t,i,n){return e.setUTCSeconds(i,0),e},incompatibleTokens:["t","T"]},S:{priority:30,parse:function(e,t,i,n){var r=function(e){return Math.floor(e*Math.pow(10,-t.length+3))};return Y(t.length,e,r)},set:function(e,t,i,n){return e.setUTCMilliseconds(i),e},incompatibleTokens:["t","T"]},X:{priority:10,parse:function(e,t,i,n){switch(t){case"X":return K(j,e);case"XX":return K(q,e);case"XXXX":return K(W,e);case"XXXXX":return K(z,e);default:return K(G,e)}},set:function(e,t,i,n){return t.timestampIsSet?e:new Date(e.getTime()-i)},incompatibleTokens:["t","T","x"]},x:{priority:10,parse:function(e,t,i,n){switch(t){case"x":return K(j,e);case"xx":return K(q,e);case"xxxx":return K(W,e);case"xxxxx":return K(z,e);default:return K(G,e)}},set:function(e,t,i,n){return t.timestampIsSet?e:new Date(e.getTime()-i)},incompatibleTokens:["t","T","X"]},t:{priority:40,parse:function(e,t,i,n){return Q(e)},set:function(e,t,i,n){return[new Date(1e3*i),{timestampIsSet:!0}]},incompatibleTokens:"*"},T:{priority:20,parse:function(e,t,i,n){return Q(e)},set:function(e,t,i,n){return[new Date(i),{timestampIsSet:!0}]},incompatibleTokens:"*"}};var es=10,ea=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,eo=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,el=/^'([^]*?)'?$/,ec=/''/g,ed=/\S/,eu=/[a-zA-Z]/;function eh(e,t,i,u){(0,h.Z)(3,arguments);var g,p=String(e),f=String(t),m=u||{},v=m.locale||n.Z;if(!v.match)throw RangeError("locale must contain match property");var S=v.options&&v.options.firstWeekContainsDate,y=null==S?1:(0,d.Z)(S),C=null==m.firstWeekContainsDate?y:(0,d.Z)(m.firstWeekContainsDate);if(!(C>=1&&C<=7))throw RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var b=v.options&&v.options.weekStartsOn,T=null==b?0:(0,d.Z)(b),E=null==m.weekStartsOn?T:(0,d.Z)(m.weekStartsOn);if(!(E>=0&&E<=6))throw RangeError("weekStartsOn must be between 0 and 6 inclusively");if(""===f)if(""===p)return(0,s.Z)(i);else return new Date(NaN);var _={firstWeekContainsDate:C,weekStartsOn:E,locale:v},I=[{priority:es,subPriority:-1,set:eg,index:0}],w=f.match(eo).map(function(e){var t=e[0];return"p"===t||"P"===t?(0,o.Z[t])(e,v.formatLong,_):e}).join("").match(ea),P=[];for(g=0;g<w.length;g++){var R=w[g];!m.useAdditionalWeekYearTokens&&(0,c.Do)(R)&&(0,c.qp)(R,f,e),!m.useAdditionalDayOfYearTokens&&(0,c.Iu)(R)&&(0,c.qp)(R,f,e);var A=R[0],M=er[A];if(M){var D=M.incompatibleTokens;if(Array.isArray(D)){for(var O=void 0,k=0;k<P.length;k++){var N=P[k].token;if(-1!==D.indexOf(N)||N===A){O=P[k];break}}if(O)throw RangeError("The format string mustn't contain `".concat(O.fullToken,"` and `").concat(R,"` at the same time"))}else if("*"===M.incompatibleTokens&&P.length)throw RangeError("The format string mustn't contain `".concat(R,"` and any other token at the same time"));P.push({token:A,fullToken:R});var x=M.parse(p,R,v.match,_);if(!x)return new Date(NaN);I.push({priority:M.priority,subPriority:M.subPriority||0,set:M.set,validate:M.validate,value:x.value,index:I.length}),p=x.rest}else{if(A.match(eu))throw RangeError("Format string contains an unescaped latin alphabet character `"+A+"`");if("''"===R?R="'":"'"===A&&(R=ep(R)),0!==p.indexOf(R))return new Date(NaN);p=p.slice(R.length)}}if(p.length>0&&ed.test(p))return new Date(NaN);var L=I.map(function(e){return e.priority}).sort(function(e,t){return t-e}).filter(function(e,t,i){return i.indexOf(e)===t}).map(function(e){return I.filter(function(t){return t.priority===e}).sort(function(e,t){return t.subPriority-e.subPriority})}).map(function(e){return e[0]}),F=(0,s.Z)(i);if(isNaN(F))return new Date(NaN);var U=(0,r.Z)(F,(0,l.Z)(F)),$={};for(g=0;g<L.length;g++){var V=L[g];if(V.validate&&!V.validate(U,V.value,_))return new Date(NaN);var B=V.set(U,$,V.value,_);B[0]?(U=B[0],(0,a.Z)($,B[1])):U=B}return U}function eg(e,t){if(t.timestampIsSet)return e;var i=new Date(0);return i.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),i.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),i}function ep(e){return e.match(el)[1].replace(ec,"'")}},61133:function(e){"use strict";var t="%[a-f0-9]{2}",i=RegExp("("+t+")|([^%]+?)","gi"),n=RegExp("("+t+")+","gi");function r(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var i=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],r(i),r(n))}function s(e){try{return decodeURIComponent(e)}catch(s){for(var t=e.match(i)||[],n=1;n<t.length;n++)t=(e=r(t,n).join("")).match(i)||[];return e}}function a(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},i=n.exec(e);i;){try{t[i[0]]=decodeURIComponent(i[0])}catch(e){var r=s(i[0]);r!==i[0]&&(t[i[0]]=r)}i=n.exec(e)}t["%C2"]="�";for(var a=Object.keys(t),o=0;o<a.length;o++){var l=a[o];e=e.replace(RegExp(l,"g"),t[l])}return e}e.exports=function(e){if("string"!=typeof e)throw TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return a(e)}}},316951:function(e){!function(t,i){e.exports=i()}(0,function(){"use strict";let{entries:e,setPrototypeOf:t,isFrozen:i,getPrototypeOf:n,getOwnPropertyDescriptor:r}=Object,{freeze:s,seal:a,create:o}=Object,{apply:l,construct:c}="undefined"!=typeof Reflect&&Reflect;s||(s=function(e){return e}),a||(a=function(e){return e}),l||(l=function(e,t,i){return e.apply(t,i)}),c||(c=function(e,t){return new e(...t)});let d=E(Array.prototype.forEach),u=E(Array.prototype.pop),h=E(Array.prototype.push),g=E(String.prototype.toLowerCase),p=E(String.prototype.toString),f=E(String.prototype.match),m=E(String.prototype.replace),v=E(String.prototype.indexOf),S=E(String.prototype.trim),y=E(Object.prototype.hasOwnProperty),C=E(RegExp.prototype.test),b=_(TypeError);function T(e){return"number"==typeof e&&isNaN(e)}function E(e){return function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return l(e,t,n)}}function _(e){return function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return c(e,i)}}function I(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;t&&t(e,null);let s=n.length;for(;s--;){let t=n[s];if("string"==typeof t){let e=r(t);e!==t&&(i(n)||(n[s]=e),t=e)}e[t]=!0}return e}function w(e){for(let t=0;t<e.length;t++)y(e,t)||(e[t]=null);return e}function P(t){let i=o(null);for(let[n,r]of e(t))y(t,n)&&(Array.isArray(r)?i[n]=w(r):r&&"object"==typeof r&&r.constructor===Object?i[n]=P(r):i[n]=r);return i}function R(e,t){for(;null!==e;){let i=r(e,t);if(i){if(i.get)return E(i.get);if("function"==typeof i.value)return E(i.value)}e=n(e)}return function(){return null}}let A=s(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),M=s(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),D=s(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),O=s(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),k=s(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),N=s(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),x=s(["#text"]),L=s(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),F=s(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),U=s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),$=s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),V=a(/\{\{[\w\W]*|[\w\W]*\}\}/gm),B=a(/<%[\w\W]*|[\w\W]*%>/gm),H=a(/\${[\w\W]*}/gm),j=a(/^data-[\-\w.\u00B7-\uFFFF]/),q=a(/^aria-[\-\w]+$/),W=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),G=a(/^(?:\w+script|data):/i),z=a(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),J=a(/^html$/i);var K=Object.freeze({__proto__:null,MUSTACHE_EXPR:V,ERB_EXPR:B,TMPLIT_EXPR:H,DATA_ATTR:j,ARIA_ATTR:q,IS_ALLOWED_URI:W,IS_SCRIPT_OR_DATA:G,ATTR_WHITESPACE:z,DOCTYPE_NAME:J,CUSTOM_ELEMENT:a(/^[a-z][.\w]*(-[.\w]+)+$/i)});let Q=1,Y=3,Z=7,X=8,ee=9,et=function(){return"undefined"==typeof window?null:window},ei=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let i=null,n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(i=t.getAttribute(n));let r="dompurify"+(i?"#"+i:"");try{return e.createPolicy(r,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+r+" could not be created."),null}};function en(){let t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et(),n=e=>en(e);if(n.version="3.1.4",n.removed=[],!i||!i.document||i.document.nodeType!==ee)return n.isSupported=!1,n;let{document:r}=i,a=r,l=a.currentScript,{DocumentFragment:c,HTMLTemplateElement:E,Node:_,Element:w,NodeFilter:V,NamedNodeMap:B=i.NamedNodeMap||i.MozNamedAttrMap,HTMLFormElement:H,DOMParser:j,trustedTypes:q}=i,G=w.prototype,z=R(G,"cloneNode"),er=R(G,"nextSibling"),es=R(G,"childNodes"),ea=R(G,"parentNode");if("function"==typeof E){let e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let eo="",{implementation:el,createNodeIterator:ec,createDocumentFragment:ed,getElementsByTagName:eu}=r,{importNode:eh}=a,eg={};n.isSupported="function"==typeof e&&"function"==typeof ea&&el&&void 0!==el.createHTMLDocument;let{MUSTACHE_EXPR:ep,ERB_EXPR:ef,TMPLIT_EXPR:em,DATA_ATTR:ev,ARIA_ATTR:eS,IS_SCRIPT_OR_DATA:ey,ATTR_WHITESPACE:eC,CUSTOM_ELEMENT:eb}=K,{IS_ALLOWED_URI:eT}=K,eE=null,e_=I({},[...A,...M,...D,...k,...x]),eI=null,ew=I({},[...L,...F,...U,...$]),eP=Object.seal(o(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),eR=null,eA=null,eM=!0,eD=!0,eO=!1,ek=!0,eN=!1,ex=!0,eL=!1,eF=!1,eU=!1,e$=!1,eV=!1,eB=!1,eH=!0,ej=!1,eq="user-content-",eW=!0,eG=!1,ez={},eJ=null,eK=I({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),eQ=null,eY=I({},["audio","video","img","source","image","track"]),eZ=null,eX=I({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),e0="http://www.w3.org/1998/Math/MathML",e1="http://www.w3.org/2000/svg",e2="http://www.w3.org/1999/xhtml",e3=e2,e4=!1,e5=null,e6=I({},[e0,e1,e2],p),e8=null,e9=["application/xhtml+xml","text/html"],e7="text/html",te=null,tt=null,ti=255,tn=r.createElement("form"),tr=function(e){return e instanceof RegExp||e instanceof Function},ts=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!tt||tt!==e){if(e&&"object"==typeof e||(e={}),e=P(e),e8=-1===e9.indexOf(e.PARSER_MEDIA_TYPE)?e7:e.PARSER_MEDIA_TYPE,te="application/xhtml+xml"===e8?p:g,eE=y(e,"ALLOWED_TAGS")?I({},e.ALLOWED_TAGS,te):e_,eI=y(e,"ALLOWED_ATTR")?I({},e.ALLOWED_ATTR,te):ew,e5=y(e,"ALLOWED_NAMESPACES")?I({},e.ALLOWED_NAMESPACES,p):e6,eZ=y(e,"ADD_URI_SAFE_ATTR")?I(P(eX),e.ADD_URI_SAFE_ATTR,te):eX,eQ=y(e,"ADD_DATA_URI_TAGS")?I(P(eY),e.ADD_DATA_URI_TAGS,te):eY,eJ=y(e,"FORBID_CONTENTS")?I({},e.FORBID_CONTENTS,te):eK,eR=y(e,"FORBID_TAGS")?I({},e.FORBID_TAGS,te):{},eA=y(e,"FORBID_ATTR")?I({},e.FORBID_ATTR,te):{},ez=!!y(e,"USE_PROFILES")&&e.USE_PROFILES,eM=!1!==e.ALLOW_ARIA_ATTR,eD=!1!==e.ALLOW_DATA_ATTR,eO=e.ALLOW_UNKNOWN_PROTOCOLS||!1,ek=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,eN=e.SAFE_FOR_TEMPLATES||!1,ex=!1!==e.SAFE_FOR_XML,eL=e.WHOLE_DOCUMENT||!1,e$=e.RETURN_DOM||!1,eV=e.RETURN_DOM_FRAGMENT||!1,eB=e.RETURN_TRUSTED_TYPE||!1,eU=e.FORCE_BODY||!1,eH=!1!==e.SANITIZE_DOM,ej=e.SANITIZE_NAMED_PROPS||!1,eW=!1!==e.KEEP_CONTENT,eG=e.IN_PLACE||!1,eT=e.ALLOWED_URI_REGEXP||W,e3=e.NAMESPACE||e2,eP=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&tr(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(eP.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&tr(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(eP.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(eP.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),eN&&(eD=!1),eV&&(e$=!0),ez&&(eE=I({},x),eI=[],!0===ez.html&&(I(eE,A),I(eI,L)),!0===ez.svg&&(I(eE,M),I(eI,F),I(eI,$)),!0===ez.svgFilters&&(I(eE,D),I(eI,F),I(eI,$)),!0===ez.mathMl&&(I(eE,k),I(eI,U),I(eI,$))),e.ADD_TAGS&&(eE===e_&&(eE=P(eE)),I(eE,e.ADD_TAGS,te)),e.ADD_ATTR&&(eI===ew&&(eI=P(eI)),I(eI,e.ADD_ATTR,te)),e.ADD_URI_SAFE_ATTR&&I(eZ,e.ADD_URI_SAFE_ATTR,te),e.FORBID_CONTENTS&&(eJ===eK&&(eJ=P(eJ)),I(eJ,e.FORBID_CONTENTS,te)),eW&&(eE["#text"]=!0),eL&&I(eE,["html","head","body"]),eE.table&&(I(eE,["tbody"]),delete eR.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw b('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw b('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');eo=(t=e.TRUSTED_TYPES_POLICY).createHTML("")}else void 0===t&&(t=ei(q,l)),null!==t&&"string"==typeof eo&&(eo=t.createHTML(""));s&&s(e),tt=e}},ta=I({},["mi","mo","mn","ms","mtext"]),to=I({},["foreignobject","annotation-xml"]),tl=I({},["title","style","font","a","script"]),tc=I({},[...M,...D,...O]),td=I({},[...k,...N]),tu=function(e){let t=ea(e);t&&t.tagName||(t={namespaceURI:e3,tagName:"template"});let i=g(e.tagName),n=g(t.tagName);return!!e5[e.namespaceURI]&&(e.namespaceURI===e1?t.namespaceURI===e2?"svg"===i:t.namespaceURI===e0?"svg"===i&&("annotation-xml"===n||ta[n]):!!tc[i]:e.namespaceURI===e0?t.namespaceURI===e2?"math"===i:t.namespaceURI===e1?"math"===i&&to[n]:!!td[i]:e.namespaceURI===e2?(t.namespaceURI!==e1||!!to[n])&&(t.namespaceURI!==e0||!!ta[n])&&!td[i]&&(tl[i]||!tc[i]):"application/xhtml+xml"===e8&&!!e5[e.namespaceURI])},th=function(e){h(n.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.remove()}},tg=function(e,t){try{h(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){h(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!eI[e])if(e$||eV)try{th(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},tp=function(e){let i=null,n=null;if(eU)e="<remove></remove>"+e;else{let t=f(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===e8&&e3===e2&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");let s=t?t.createHTML(e):e;if(e3===e2)try{i=new j().parseFromString(s,e8)}catch(e){}if(!i||!i.documentElement){i=el.createDocument(e3,"template",null);try{i.documentElement.innerHTML=e4?eo:s}catch(e){}}let a=i.body||i.documentElement;return(e&&n&&a.insertBefore(r.createTextNode(n),a.childNodes[0]||null),e3===e2)?eu.call(i,eL?"html":"body")[0]:eL?i.documentElement:a},tf=function(e){return ec.call(e.ownerDocument||e,e,V.SHOW_ELEMENT|V.SHOW_COMMENT|V.SHOW_TEXT|V.SHOW_PROCESSING_INSTRUCTION|V.SHOW_CDATA_SECTION,null)},tm=function(e){return e instanceof H&&(void 0!==e.__depth&&"number"!=typeof e.__depth||void 0!==e.__removalCount&&"number"!=typeof e.__removalCount||"string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof B)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},tv=function(e){return"function"==typeof _&&e instanceof _},tS=function(e,t,i){eg[e]&&d(eg[e],e=>{e.call(n,t,i,tt)})},ty=function(e){let t=null;if(tS("beforeSanitizeElements",e,null),tm(e))return th(e),!0;let i=te(e.nodeName);if(tS("uponSanitizeElement",e,{tagName:i,allowedTags:eE}),e.hasChildNodes()&&!tv(e.firstElementChild)&&C(/<[/\w]/g,e.innerHTML)&&C(/<[/\w]/g,e.textContent)||e.nodeType===Z||ex&&e.nodeType===X&&C(/<[/\w]/g,e.data))return th(e),!0;if(!eE[i]||eR[i]){if(!eR[i]&&tb(i)&&(eP.tagNameCheck instanceof RegExp&&C(eP.tagNameCheck,i)||eP.tagNameCheck instanceof Function&&eP.tagNameCheck(i)))return!1;if(eW&&!eJ[i]){let t=ea(e)||e.parentNode,i=es(e)||e.childNodes;if(i&&t){let n=i.length;for(let r=n-1;r>=0;--r){let n=z(i[r],!0);n.__removalCount=(e.__removalCount||0)+1,t.insertBefore(n,er(e))}}}return th(e),!0}return e instanceof w&&!tu(e)||("noscript"===i||"noembed"===i||"noframes"===i)&&C(/<\/no(script|embed|frames)/i,e.innerHTML)?(th(e),!0):(eN&&e.nodeType===Y&&(t=e.textContent,d([ep,ef,em],e=>{t=m(t,e," ")}),e.textContent!==t&&(h(n.removed,{element:e.cloneNode()}),e.textContent=t)),tS("afterSanitizeElements",e,null),!1)},tC=function(e,t,i){if(eH&&("id"===t||"name"===t)&&(i in r||i in tn||"__depth"===i||"__removalCount"===i))return!1;if(eD&&!eA[t]&&C(ev,t));else if(eM&&C(eS,t));else if(!eI[t]||eA[t]){if(!(tb(e)&&(eP.tagNameCheck instanceof RegExp&&C(eP.tagNameCheck,e)||eP.tagNameCheck instanceof Function&&eP.tagNameCheck(e))&&(eP.attributeNameCheck instanceof RegExp&&C(eP.attributeNameCheck,t)||eP.attributeNameCheck instanceof Function&&eP.attributeNameCheck(t))||"is"===t&&eP.allowCustomizedBuiltInElements&&(eP.tagNameCheck instanceof RegExp&&C(eP.tagNameCheck,i)||eP.tagNameCheck instanceof Function&&eP.tagNameCheck(i))))return!1}else if(eZ[t]);else if(C(eT,m(i,eC,"")));else if(("src"===t||"xlink:href"===t||"href"===t)&&"script"!==e&&0===v(i,"data:")&&eQ[e]);else if(eO&&!C(ey,m(i,eC,"")));else if(i)return!1;return!0},tb=function(e){return"annotation-xml"!==e&&f(e,eb)},tT=function(e){tS("beforeSanitizeAttributes",e,null);let{attributes:i}=e;if(!i)return;let r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:eI},s=i.length;for(;s--;){let{name:a,namespaceURI:o,value:l}=i[s],c=te(a),h="value"===a?l:S(l);if(r.attrName=c,r.attrValue=h,r.keepAttr=!0,r.forceKeepAttr=void 0,tS("uponSanitizeAttribute",e,r),h=r.attrValue,r.forceKeepAttr||(tg(a,e),!r.keepAttr))continue;if(!ek&&C(/\/>/i,h)||ex&&C(/((--!?|])>)|<\/(style|title)/i,h)){tg(a,e);continue}eN&&d([ep,ef,em],e=>{h=m(h,e," ")});let g=te(e.nodeName);if(tC(g,c,h)){if(ej&&("id"===c||"name"===c)&&(tg(a,e),h=eq+h),t&&"object"==typeof q&&"function"==typeof q.getAttributeType)if(o);else switch(q.getAttributeType(g,c)){case"TrustedHTML":h=t.createHTML(h);break;case"TrustedScriptURL":h=t.createScriptURL(h)}try{o?e.setAttributeNS(o,a,h):e.setAttribute(a,h),tm(e)?th(e):u(n.removed)}catch(e){}}}tS("afterSanitizeAttributes",e,null)},tE=function e(t){let i=null,n=tf(t);for(tS("beforeSanitizeShadowDOM",t,null);i=n.nextNode();){if(tS("uponSanitizeShadowNode",i,null),ty(i))continue;let t=ea(i);i.nodeType===Q&&(t&&t.__depth?i.__depth=(i.__removalCount||0)+t.__depth+1:i.__depth=1),(i.__depth>=ti||i.__depth<0||T(i.__depth))&&th(i),i.content instanceof c&&(i.content.__depth=i.__depth,e(i.content)),tT(i)}tS("afterSanitizeShadowDOM",t,null)};return n.sanitize=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,s=null,o=null,l=null;if((e4=!e)&&(e="\x3c!--\x3e"),"string"!=typeof e&&!tv(e))if("function"==typeof e.toString){if("string"!=typeof(e=e.toString()))throw b("dirty is not a string, aborting")}else throw b("toString is not a function");if(!n.isSupported)return e;if(eF||ts(i),n.removed=[],"string"==typeof e&&(eG=!1),eG){if(e.nodeName){let t=te(e.nodeName);if(!eE[t]||eR[t])throw b("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof _)(s=(r=tp("\x3c!----\x3e")).ownerDocument.importNode(e,!0)).nodeType===Q&&"BODY"===s.nodeName||"HTML"===s.nodeName?r=s:r.appendChild(s);else{if(!e$&&!eN&&!eL&&-1===e.indexOf("<"))return t&&eB?t.createHTML(e):e;if(!(r=tp(e)))return e$?null:eB?eo:""}r&&eU&&th(r.firstChild);let u=tf(eG?e:r);for(;o=u.nextNode();){if(ty(o))continue;let e=ea(o);o.nodeType===Q&&(e&&e.__depth?o.__depth=(o.__removalCount||0)+e.__depth+1:o.__depth=1),(o.__depth>=ti||o.__depth<0||T(o.__depth))&&th(o),o.content instanceof c&&(o.content.__depth=o.__depth,tE(o.content)),tT(o)}if(eG)return e;if(e$){if(eV)for(l=ed.call(r.ownerDocument);r.firstChild;)l.appendChild(r.firstChild);else l=r;return(eI.shadowroot||eI.shadowrootmode)&&(l=eh.call(a,l,!0)),l}let h=eL?r.outerHTML:r.innerHTML;return eL&&eE["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&C(J,r.ownerDocument.doctype.name)&&(h="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+h),eN&&d([ep,ef,em],e=>{h=m(h,e," ")}),t&&eB?t.createHTML(h):h},n.setConfig=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ts(e),eF=!0},n.clearConfig=function(){tt=null,eF=!1},n.isValidAttribute=function(e,t,i){return tt||ts({}),tC(te(e),te(t),i)},n.addHook=function(e,t){"function"==typeof t&&(eg[e]=eg[e]||[],h(eg[e],t))},n.removeHook=function(e){if(eg[e])return u(eg[e])},n.removeHooks=function(e){eg[e]&&(eg[e]=[])},n.removeAllHooks=function(){eg={}},n}return en()})},851225:function(e,t,i){"use strict";i.d(t,{Z:()=>a});let n={active:!0,breakpoints:{},delay:4e3,jump:!1,playOnInit:!0,stopOnFocusIn:!0,stopOnInteraction:!0,stopOnMouseEnter:!1,stopOnLastSnap:!1,rootNode:null};function r(e,t){let i=e.scrollSnapList();return"number"==typeof t?i.map(()=>t):t(i,e)}function s(e,t){let i=e.rootNode();return t&&t(i)||i}function a(e={}){let t,i,o,l,c=null,d=0,u=!1,h=!1,g=!1,p=!1;function f(c,d){i=c;let{mergeOptions:u,optionsAtMedia:h}=d,g=u(n,a.globalOptions);if(t=h(u(g,e)),i.scrollSnapList().length<=1)return;p=t.jump,o=!1,l=r(i,t.delay);let{eventStore:f,ownerDocument:m}=i.internalEngine(),v=!!i.internalEngine().options.watchDrag,b=s(i,t.rootNode);f.add(m,"visibilitychange",C),v&&i.on("pointerDown",T),v&&!t.stopOnInteraction&&i.on("pointerUp",E),t.stopOnMouseEnter&&f.add(b,"mouseenter",_),t.stopOnMouseEnter&&!t.stopOnInteraction&&f.add(b,"mouseleave",I),t.stopOnFocusIn&&i.on("slideFocusStart",y),t.stopOnFocusIn&&!t.stopOnInteraction&&f.add(i.containerNode(),"focusout",S),t.playOnInit&&S()}function m(){let{ownerWindow:e}=i.internalEngine();e.clearTimeout(d),d=e.setTimeout(w,l[i.selectedScrollSnap()]),c=new Date().getTime(),i.emit("autoplay:timerset")}function v(){let{ownerWindow:e}=i.internalEngine();e.clearTimeout(d),d=0,c=null,i.emit("autoplay:timerstopped")}function S(){if(!o){if(b()){g=!0;return}u||i.emit("autoplay:play"),m(),u=!0}}function y(){o||(u&&i.emit("autoplay:stop"),v(),u=!1)}function C(){if(b())return g=u,y();g&&S()}function b(){let{ownerDocument:e}=i.internalEngine();return"hidden"===e.visibilityState}function T(){h||y()}function E(){h||S()}function _(){h=!0,y()}function I(){h=!1,S()}function w(){let{index:e}=i.internalEngine(),n=e.clone().add(1).get(),r=i.scrollSnapList().length-1,s=t.stopOnLastSnap&&n===r;if(i.canScrollNext()?i.scrollNext(p):i.scrollTo(0,p),i.emit("autoplay:select"),s)return y();S()}return{name:"autoplay",options:e,init:f,destroy:function(){i.off("pointerDown",T).off("pointerUp",E).off("slideFocusStart",y),y(),o=!0,u=!1},play:function(e){void 0!==e&&(p=e),S()},stop:function(){u&&y()},reset:function(){u&&S()},isPlaying:function(){return u},timeUntilNext:function(){return c?l[i.selectedScrollSnap()]-(new Date().getTime()-c):null}}}a.globalOptions=void 0},652443:function(e,t,i){"use strict";function n(e,t,i){return Math.min(Math.max(e,t),i)}function r(e){return"number"==typeof e&&!isNaN(e)}function s(e={}){let t,i,a,o,l=1,c=0,d=.68,u=[],h=0,g=0,p=0,f=!1;function m(){E(t.selectedScrollSnap(),l)}function v(){f=!1}function S(){f=!1,h=0,g=0}function y(){let e=t.internalEngine().scrollBody.duration();g=e?0:l,f=!0,e||m()}function C(e){let{axis:i}=t.internalEngine(),n=i.scroll.toUpperCase();return`translate${n}(${i.direction(e)}px)`}function b(){let{translate:e,slideLooper:i}=t.internalEngine();e.clear(),e.toggleActive(!1),i.loopPoints.forEach(({translate:e})=>{e.clear(),e.toggleActive(!1)})}function T(e){let{scrollSnaps:i,location:n,target:s}=t.internalEngine();r(e)&&!(u[e]<.5)&&(n.set(i[e]),s.set(n))}function E(e,i){t.scrollSnapList().forEach((r,s)=>{let a=Math.abs(i),o=u[s],d=s===e,h=n(d?o+a:o-a,c,l);u[s]=h;let g=d&&f,p=t.previousScrollSnap();g&&(u[p]=1-h),d&&I(e,h),_(s)})}function _(e){let i=t.internalEngine().slideRegistry[e],{scrollSnaps:n,containerRect:r}=t.internalEngine(),s=u[e];i.forEach(i=>{let a=t.slideNodes()[i].style,o=parseFloat(s.toFixed(2)),l=o>c,d=C(l?n[e]:r.width+2);l&&(a.transform=d),a.opacity=o.toString(),a.pointerEvents=s>.5?"auto":"none",l||(a.transform=d)})}function I(e,i){let{index:n,dragHandler:r,scrollSnaps:s}=t.internalEngine(),a=r.pointerDown(),o=1/(s.length-1),l=e,c=a?t.selectedScrollSnap():t.previousScrollSnap();if(a&&l===c){let e=-1*Math.sign(h);l=c,c=n.clone().set(c).add(e).get()}p=c*o+(l-c)*o*i}function w(){let{dragHandler:e,index:i,scrollBody:n}=t.internalEngine(),r=t.selectedScrollSnap();if(!e.pointerDown())return r;let s=Math.sign(n.velocity()),a=Math.sign(h),o=i.clone().set(r).add(-1*s).get();return s&&a?a===s?o:r:null}function P(e){let{dragHandler:t,scrollBody:n}=e.internalEngine(),s=t.pointerDown(),a=n.velocity(),o=n.duration(),c=w(),p=!r(c);if(s){if(!a)return;h+=a,g=Math.abs(a/i),T(c)}if(!s){if(!o||p)return;g+=(l-u[c])/o,g*=d}p||E(c,g)}function R(){let{target:e,location:i}=t.internalEngine(),n=Math.abs(e.get()-i.get())>=1,s=w(),a=!r(s);return P(t),!a&&!n&&u[s]>.999}function A(){return p}return{name:"fade",options:e,init:function(e){let r=(t=e).selectedScrollSnap(),{scrollBody:s,containerRect:d,axis:h}=t.internalEngine();i=n(.75*h.measureSize(d),200,500),f=!1,u=t.scrollSnapList().map((e,t)=>t===r?l:c),a=s.settled,o=t.scrollProgress,s.settled=R,t.scrollProgress=A,t.on("select",y).on("slideFocus",m).on("pointerDown",S).on("pointerUp",v),b(),m()},destroy:function(){let{scrollBody:e}=t.internalEngine();e.settled=a,t.scrollProgress=o,t.off("select",y).off("slideFocus",m).off("pointerDown",S).off("pointerUp",v),t.slideNodes().forEach(e=>{let t=e.style;t.opacity="",t.transform="",t.pointerEvents="",e.getAttribute("style")||e.removeAttribute("style")})}}}i.d(t,{Z:()=>s}),s.globalOptions=void 0},57749:function(e,t,i){"use strict";function n(e){return"number"==typeof e}function r(e){return"string"==typeof e}function s(e){return"boolean"==typeof e}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return Math.abs(e)}function l(e){return Math.sign(e)}function c(e,t){return o(e-t)}function d(e,t){if(0===e||0===t||o(e)<=o(t))return 0;let i=c(o(e),o(t));return o(i/e)}function u(e){return Math.round(100*e)/100}function h(e){return v(e).map(Number)}function g(e){return e[p(e)]}function p(e){return Math.max(0,e.length-1)}function f(e,t){return t===p(e)}function m(e,t=0){return Array.from(Array(e),(e,i)=>t+i)}function v(e){return Object.keys(e)}function S(e,t){return[e,t].reduce((e,t)=>(v(t).forEach(i=>{let n=e[i],r=t[i],s=a(n)&&a(r);e[i]=s?S(n,r):r}),e),{})}function y(e,t){return void 0!==t.MouseEvent&&e instanceof t.MouseEvent}function C(e,t){let i={start:n,center:s,end:a};function n(){return 0}function s(e){return a(e)/2}function a(e){return t-e}return{measure:function(n,s){return r(e)?i[e](n):e(t,n,s)}}}function b(){let e=[],t={add:function(i,n,r,s={passive:!0}){let a;if("addEventListener"in i)i.addEventListener(n,r,s),a=()=>i.removeEventListener(n,r,s);else{let e=i;e.addListener(r),a=()=>e.removeListener(r)}return e.push(a),t},clear:function(){e=e.filter(e=>e())}};return t}function T(e,t,i,n){let r=b(),s=1e3/60,a=null,o=0,l=0;function c(e){if(!l)return;a||(a=e,i(),i());let r=e-a;for(a=e,o+=r;o>=s;)i(),o-=s;n(o/s),l&&(l=t.requestAnimationFrame(c))}function d(){t.cancelAnimationFrame(l),a=null,o=0,l=0}function u(){a=null,o=0}return{init:function(){r.add(e,"visibilitychange",()=>{e.hidden&&u()})},destroy:function(){d(),r.clear()},start:function(){l||(l=t.requestAnimationFrame(c))},stop:d,update:i,render:n}}function E(e,t){let i="rtl"===t,n="y"===e,r=n?"y":"x",s=n?"x":"y",a=!n&&i?-1:1;function o(e){let{height:t,width:i}=e;return n?t:i}function l(e){return e*a}return{scroll:r,cross:s,startEdge:function e(){return n?"top":i?"right":"left"}(),endEdge:n?"bottom":i?"left":"right",measureSize:o,direction:l}}function _(e=0,t=0){let i=o(e-t);function n(t){return t<e}function r(e){return e>t}function s(e){return n(e)||r(e)}function a(i){return s(i)?n(i)?e:t:i}function l(e){return i?e-i*Math.ceil((e-t)/i):e}return{length:i,max:t,min:e,constrain:a,reachedAny:s,reachedMax:r,reachedMin:n,removeOffset:l}}function I(e,t,i){let{constrain:n}=_(0,e),r=e+1,s=a(t);function a(e){return i?o((r+e)%r):n(e)}function l(){return s}function c(e){return d().set(l()+e)}function d(){return I(e,l(),i)}let u={get:l,set:function(e){return s=a(e),u},add:c,clone:d};return u}function w(e,t,i,n,r,a,u,h,g,p,f,m,v,S,C,T,E,I,w){let{cross:P,direction:R}=e,A=["INPUT","SELECT","TEXTAREA"],M={passive:!1},D=b(),O=b(),k=_(50,225).constrain(S.measure(20)),N={mouse:300,touch:400},x={mouse:500,touch:600},L=C?43:25,F=!1,U=0,$=0,V=!1,B=!1,H=!1,j=!1;function q(){let e=j?i:t;O.add(e,"touchmove",K,M).add(e,"touchend",Q).add(e,"mousemove",K,M).add(e,"mouseup",Q)}function W(e){let t=e.nodeName||"";return A.includes(t)}function G(){return(C?x:N)[j?"mouse":"touch"]}function z(e,t){let i=m.add(-1*l(e)),n=f.byDistance(e,!C).distance;return C||o(e)<k?n:E&&t?.5*n:f.byIndex(i.get(),0).distance}function J(e){let t=y(e,n);j=t,H=C&&t&&!e.buttons&&F,F=c(r.get(),u.get())>=2,(!t||0===e.button)&&(W(e.target)||(V=!0,a.pointerDown(e),p.useFriction(0).useDuration(0),r.set(u),q(),U=a.readPoint(e),$=a.readPoint(e,P),v.emit("pointerDown")))}function K(e){if(!y(e,n)&&e.touches.length>=2)return Q(e);let t=a.readPoint(e),i=a.readPoint(e,P),s=c(t,U),o=c(i,$);if(!B&&!j&&(!e.cancelable||!(B=s>o)))return Q(e);let l=a.pointerMove(e);s>T&&(H=!0),p.useFriction(.3).useDuration(.75),h.start(),r.add(R(l)),e.preventDefault()}function Q(e){let t=f.byDistance(0,!1).index!==m.get(),i=a.pointerUp(e)*G(),n=z(R(i),t),r=d(i,n),s=L-10*r,o=I+r/50;B=!1,V=!1,O.clear(),p.useDuration(s).useFriction(o),g.distance(n,!C),j=!1,v.emit("pointerUp")}function Y(e){H&&(e.stopPropagation(),e.preventDefault(),H=!1)}return{init:function(e){if(!w)return;function i(t){(s(w)||w(e,t))&&J(t)}let n=t;D.add(n,"dragstart",e=>e.preventDefault(),M).add(n,"touchmove",()=>void 0,M).add(n,"touchend",()=>void 0).add(n,"touchstart",i).add(n,"mousedown",i).add(n,"touchcancel",Q).add(n,"contextmenu",Q).add(n,"click",Y,!0)},destroy:function(){D.clear(),O.clear()},pointerDown:function(){return V}}}function P(e,t){let i,n,r=170;function s(e){return e.timeStamp}function a(i,n){let r=n||e.scroll,s=`client${"x"===r?"X":"Y"}`;return(y(i,t)?i:i.touches[0])[s]}return{pointerDown:function(e){return i=e,n=e,a(e)},pointerMove:function(e){let t=a(e)-a(n),o=s(e)-s(i)>r;return n=e,o&&(i=e),t},pointerUp:function(e){if(!i||!n)return 0;let t=a(n)-a(i),l=s(e)-s(i),c=s(e)-s(n)>r,d=t/l;return l&&!c&&o(d)>.1?d:0},readPoint:a}}function R(){return{measure:function(e){let{offsetTop:t,offsetLeft:i,offsetWidth:n,offsetHeight:r}=e;return{top:t,right:i+n,bottom:t+r,left:i,width:n,height:r}}}}function A(e){return{measure:function(t){return t/100*e}}}function M(e,t,i,n,r,a,l){let c,d,u=[e].concat(n),h=[],g=!1;function p(e){return r.measureSize(l.measure(e))}return{init:function(r){a&&(d=p(e),h=n.map(p),c=new ResizeObserver(e=>{(s(a)||a(r,e))&&l(e)}),i.requestAnimationFrame(()=>{u.forEach(e=>c.observe(e))}));function l(i){for(let s of i){if(g)return;let i=s.target===e,a=n.indexOf(s.target),l=i?d:h[a];if(o(p(i?e:n[a])-l)>=.5){r.reInit(),t.emit("resize");break}}}},destroy:function(){g=!0,c&&c.disconnect()}}}function D(e,t,i,n,r,s){let a=0,c=0,d=r,u=s,h=e.get(),g=0;function p(e){return d=e,m}function f(e){return u=e,m}let m={direction:function(){return c},duration:function(){return d},velocity:function(){return a},seek:function(){let t=n.get()-e.get(),r=0;return d?(i.set(e),a+=t/d,a*=u,h+=a,e.add(a),r=h-g):(a=0,i.set(n),e.set(n),r=t),c=l(r),g=h,m},settled:function(){return .001>o(n.get()-t.get())},useBaseFriction:function(){return f(s)},useBaseDuration:function(){return p(r)},useFriction:f,useDuration:p};return m}function O(e,t,i,n,r){let s=r.measure(10),a=r.measure(50),l=_(.1,.99),c=!1;function d(){return!c&&!!e.reachedAny(i.get())&&!!e.reachedAny(t.get())}function u(r){if(!d())return;let c=e.reachedMin(t.get())?"min":"max",u=o(e[c]-t.get()),h=i.get()-t.get(),g=l.constrain(u/a);i.subtract(h*g),!r&&o(h)<s&&(i.set(e.constrain(i.get())),n.useDuration(25).useBaseFriction())}return{shouldConstrain:d,constrain:u,toggleActive:function(e){c=!e}}}function k(e,t,i,n,r){let s=_(-t+e,0),a=u(),o=d();function l(e,t){return 1>=c(e,t)}function d(){let e=a[0],t=g(a);return _(a.lastIndexOf(e),a.indexOf(t)+1)}function u(){return i.map((e,t)=>{let{min:n,max:r}=s,a=s.constrain(e),o=!t,c=f(i,t);return o?r:c||l(n,a)?n:l(r,a)?r:a}).map(e=>parseFloat(e.toFixed(3)))}return{snapsContained:function(){if(t<=e+r)return[s.max];if("keepSnaps"===n)return a;let{min:i,max:l}=o;return a.slice(i,l)}(),scrollContainLimit:o}}function N(e,t,i){let n=t[0];return{limit:_(i?n-e:g(t),n)}}function x(e,t,i,n){let r=.1,{reachedMin:s,reachedMax:a}=_(t.min+r,t.max+r);function o(e){return 1===e?a(i.get()):-1===e&&s(i.get())}return{loop:function(t){if(!o(t))return;let i=-1*t*e;n.forEach(e=>e.add(i))}}}function L(e){let{max:t,length:i}=e;return{get:function(e){let n=e-t;return i?-(n/i):0}}}function F(e,t,i,n,r){let{startEdge:s,endEdge:a}=e,{groupSlides:l}=r,c=u().map(t.measure),d=h();function u(){return l(n).map(e=>g(e)[a]-e[0][s]).map(o)}function h(){return n.map(e=>i[s]-e[s]).map(e=>-o(e))}function p(){return l(d).map(e=>e[0]).map((e,t)=>e+c[t])}return{snaps:d,snapsAligned:p()}}function U(e,t,i,n,r,s){let{groupSlides:a}=r,{min:o,max:l}=n;return{slideRegistry:function(){let n=a(s),r=!e||"keepSnaps"===t;return 1===i.length?[s]:r?n:n.slice(o,l).map((e,t,i)=>{let n=!t,r=f(i,t);return n?m(g(i[0])+1):r?m(p(s)-g(i)[0]+1,g(i)[0]):e})}()}}function $(e,t,i,n,r){let{reachedAny:s,removeOffset:a,constrain:c}=n;function d(e){return e.concat().sort((e,t)=>o(e)-o(t))[0]}function u(i){let n=e?a(i):c(i),{index:r}=t.map((e,t)=>({diff:h(e-n,0),index:t})).sort((e,t)=>o(e.diff)-o(t.diff))[0];return{index:r,distance:n}}function h(t,n){let r=[t,t+i,t-i];if(!e)return t;if(!n)return d(r);let s=r.filter(e=>l(e)===n);return s.length?d(s):g(r)-i}return{byDistance:function(i,n){let a=r.get()+i,{index:o,distance:l}=u(a),c=!e&&s(a);if(!n||c)return{index:o,distance:i};let d=i+h(t[o]-l,0);return{index:o,distance:d}},byIndex:function(e,i){let n=h(t[e]-r.get(),i);return{index:e,distance:n}},shortcut:h}}function V(e,t,i,n,r,s,a){function o(r){let o=r.distance,l=r.index!==t.get();s.add(o),o&&(n.duration()?e.start():(e.update(),e.render(1),e.update())),l&&(i.set(t.get()),t.set(r.index),a.emit("select"))}return{distance:function(e,t){o(r.byDistance(e,t))},index:function(e,i){let n=t.clone().set(e);o(r.byIndex(n.get(),i))}}}function B(e,t,i,r,a,o,l,c){let d={passive:!0,capture:!0},u=0;function h(e){"Tab"===e.code&&(u=new Date().getTime())}return{init:function(g){c&&(o.add(document,"keydown",h,!1),t.forEach((e,t)=>{o.add(e,"focus",e=>{(s(c)||c(g,e))&&p(t)},d)}));function p(t){if(new Date().getTime()-u>10)return;l.emit("slideFocusStart"),e.scrollLeft=0;let s=i.findIndex(e=>e.includes(t));n(s)&&(a.useDuration(0),r.index(s,0),l.emit("slideFocus"))}}}}function H(e){let t=e;function i(e){return n(e)?e:e.get()}return{get:function(){return t},set:function(e){t=i(e)},add:function(e){t+=i(e)},subtract:function(e){t-=i(e)}}}function j(e,t){let i="x"===e.scroll?a:o,n=t.style,r=null,s=!1;function a(e){return`translate3d(${e}px,0px,0px)`}function o(e){return`translate3d(0px,${e}px,0px)`}return{clear:function(){!s&&(n.transform="",t.getAttribute("style")||t.removeAttribute("style"))},to:function(t){if(s)return;let a=u(e.direction(t));a!==r&&(n.transform=i(a),r=a)},toggleActive:function(e){s=!e}}}function q(e,t,i,n,r,s,a,o,l){let c=.5,d=h(r),u=h(r).reverse(),g=S().concat(y());function p(e,t){return e.reduce((e,t)=>e-r[t],t)}function f(e,t){return e.reduce((e,i)=>p(e,t)>0?e.concat([i]):e,[])}function m(e){return s.map((i,r)=>({start:i-n[r]+c+e,end:i+t-c+e}))}function v(t,n,r){let s=m(n);return t.map(t=>{let n=r?0:-i,a=r?i:0,c=r?"end":"start",d=s[t][c];return{index:t,loopPoint:d,slideLocation:H(-1),translate:j(e,l[t]),target:()=>o.get()>d?n:a}})}function S(){return v(f(u,a[0]),i,!1)}function y(){return v(f(d,t-a[0]-1),-i,!0)}return{canLoop:function(){return g.every(({index:e})=>.1>=p(d.filter(t=>t!==e),t))},clear:function(){g.forEach(e=>e.translate.clear())},loop:function(){g.forEach(e=>{let{target:t,translate:i,slideLocation:n}=e,r=t();r!==n.get()&&(i.to(r),n.set(r))})},loopPoints:g}}function W(e,t,i){let n,r=!1;return{init:function(a){i&&(n=new MutationObserver(e=>{!r&&(s(i)||i(a,e))&&o(e)})).observe(e,{childList:!0});function o(e){for(let i of e)if("childList"===i.type){a.reInit(),t.emit("slidesChanged");break}}},destroy:function(){n&&n.disconnect(),r=!0}}}function G(e,t,i,n){let r,s={},a=null,o=null,l=!1;function c(e){return v(s).reduce((t,i)=>{let n=parseInt(i),{isIntersecting:r}=s[n],a=e&&r,o=!e&&!r;return(a||o)&&t.push(n),t},[])}return{init:function(){r=new IntersectionObserver(e=>{l||(e.forEach(e=>{s[t.indexOf(e.target)]=e}),a=null,o=null,i.emit("slidesInView"))},{root:e.parentElement,threshold:n}),t.forEach(e=>r.observe(e))},destroy:function(){r&&r.disconnect(),l=!0},get:function(e=!0){if(e&&a)return a;if(!e&&o)return o;let t=c(e);return e&&(a=t),e||(o=t),t}}}function z(e,t,i,n,r,s){let{measureSize:a,startEdge:l,endEdge:c}=e,d=i[0]&&r,u=m(),h=v(),p=i.map(a);function m(){if(!d)return 0;let e=i[0];return o(t[l]-e[l])}function v(){return d?parseFloat(s.getComputedStyle(g(n)).getPropertyValue(`margin-${c}`)):0}function S(){return i.map((e,t,i)=>{let n=!t,r=f(i,t);return n?p[t]+u:r?p[t]+h:i[t+1][l]-e[l]}).map(o)}return{slideSizes:p,slideSizesWithGaps:S(),startGap:u,endGap:h}}function J(e,t,i,r,s,a,l,c,d){let{startEdge:u,endEdge:f,direction:m}=e,v=n(i);function S(e,t){return h(e).filter(e=>e%t==0).map(i=>e.slice(i,i+t))}function y(e){return e.length?h(e).reduce((i,n,h)=>{let v=g(i)||0,S=0===v,y=n===p(e),C=s[u]-a[v][u],b=s[u]-a[n][f],T=!r&&S?m(l):0,E=o(b-(!r&&y?m(c):0)-(C+T));return h&&E>t+d&&i.push(n),y&&i.push(e.length),i},[]).map((t,i,n)=>{let r=Math.max(n[i-1]||0);return e.slice(r,t)}):[]}return{groupSlides:function(e){return v?S(e,i):y(e)}}}function K(e,t,i,n,r,s,a){let{align:o,axis:l,direction:c,startIndex:d,loop:u,duration:f,dragFree:m,dragThreshold:v,inViewThreshold:S,slidesToScroll:y,skipSnaps:_,containScroll:K,watchResize:Q,watchSlides:Y,watchDrag:Z,watchFocus:X}=s,ee=2,et=R(),ei=et.measure(t),en=i.map(et.measure),er=E(l,c),es=er.measureSize(ei),ea=A(es),eo=C(o,es),el=!u&&!!K,{slideSizes:ec,slideSizesWithGaps:ed,startGap:eu,endGap:eh}=z(er,ei,en,i,u||!!K,r),eg=J(er,es,y,u,ei,en,eu,eh,ee),{snaps:ep,snapsAligned:ef}=F(er,eo,ei,en,eg),em=-g(ep)+g(ed),{snapsContained:ev,scrollContainLimit:eS}=k(es,em,ef,K,ee),ey=el?ev:ef,{limit:eC}=N(em,ey,u),eb=I(p(ey),d,u),eT=eb.clone(),eE=h(i),e_=({dragHandler:e,scrollBody:t,scrollBounds:i,options:{loop:n}})=>{n||i.constrain(e.pointerDown()),t.seek()},eI=({scrollBody:e,translate:t,location:i,offsetLocation:n,previousLocation:r,scrollLooper:s,slideLooper:a,dragHandler:o,animation:l,eventHandler:c,scrollBounds:d,options:{loop:u}},h)=>{let g=e.settled(),p=!d.shouldConstrain(),f=u?g:g&&p;f&&!o.pointerDown()&&(l.stop(),c.emit("settle")),f||c.emit("scroll");let m=i.get()*h+r.get()*(1-h);n.set(m),u&&(s.loop(e.direction()),a.loop()),t.to(n.get())},ew=T(n,r,()=>e_(eB),e=>eI(eB,e)),eP=.68,eR=ey[eb.get()],eA=H(eR),eM=H(eR),eD=H(eR),eO=H(eR),ek=D(eA,eD,eM,eO,f,eP),eN=$(u,ey,em,eC,eO),ex=V(ew,eb,eT,ek,eN,eO,a),eL=L(eC),eF=b(),eU=G(t,i,a,S),{slideRegistry:e$}=U(el,K,ey,eS,eg,eE),eV=B(e,i,e$,ex,ek,eF,a,X),eB={ownerDocument:n,ownerWindow:r,eventHandler:a,containerRect:ei,slideRects:en,animation:ew,axis:er,dragHandler:w(er,e,n,r,eO,P(er,r),eA,ew,ex,ek,eN,eb,a,ea,m,v,_,eP,Z),eventStore:eF,percentOfView:ea,index:eb,indexPrevious:eT,limit:eC,location:eA,offsetLocation:eD,previousLocation:eM,options:s,resizeHandler:M(t,a,r,i,er,Q,et),scrollBody:ek,scrollBounds:O(eC,eD,eO,ek,ea),scrollLooper:x(em,eC,eD,[eA,eD,eM,eO]),scrollProgress:eL,scrollSnapList:ey.map(eL.get),scrollSnaps:ey,scrollTarget:eN,scrollTo:ex,slideLooper:q(er,es,em,ec,ed,ep,ey,eD,i),slideFocus:eV,slidesHandler:W(t,a,Y),slidesInView:eU,slideIndexes:eE,slideRegistry:e$,slidesToScroll:eg,target:eO,translate:j(er,t)};return eB}function Q(){let e,t={};function i(e){return t[e]||[]}let n={init:function(t){e=t},emit:function(t){return i(t).forEach(i=>i(e,t)),n},off:function(e,r){return t[e]=i(e).filter(e=>e!==r),n},on:function(e,r){return t[e]=i(e).concat([r]),n},clear:function(){t={}}};return n}i.d(t,{Z:()=>ee});let Y={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Z(e){function t(e,t){return S(e,t||{})}function i(i){let n=i.breakpoints||{},r=v(n).filter(t=>e.matchMedia(t).matches).map(e=>n[e]).reduce((e,i)=>t(e,i),{});return t(i,r)}return{mergeOptions:t,optionsAtMedia:i,optionsMediaQueries:function(t){return t.map(e=>v(e.breakpoints||{})).reduce((e,t)=>e.concat(t),[]).map(e.matchMedia)}}}function X(e){let t=[];return{init:function(i,n){return(t=n.filter(({options:t})=>!1!==e.optionsAtMedia(t).active)).forEach(t=>t.init(i,e)),n.reduce((e,t)=>Object.assign(e,{[t.name]:t}),{})},destroy:function(){t=t.filter(e=>e.destroy())}}}function ee(e,t,i){let n,s,a,o,l=e.ownerDocument,c=l.defaultView,d=Z(c),u=X(d),h=b(),g=Q(),{mergeOptions:p,optionsAtMedia:f,optionsMediaQueries:m}=d,{on:v,off:S,emit:y}=g,C=A,T=!1,E=p(Y,ee.globalOptions),_=p(E),I=[];function w(){let{container:t,slides:i}=_;a=(r(t)?e.querySelector(t):t)||e.children[0];let n=r(i)?a.querySelectorAll(i):i;o=[].slice.call(n||a.children)}function P(t){let i=K(e,a,o,l,c,t,g);return t.loop&&!i.slideLooper.canLoop()?P(Object.assign({},t,{loop:!1})):i}function R(e,t){!T&&(_=f(E=p(E,e)),I=t||I,w(),n=P(_),m([E,...I.map(({options:e})=>e)]).forEach(e=>h.add(e,"change",A)),_.active&&(n.translate.to(n.location.get()),n.animation.init(),n.slidesInView.init(),n.slideFocus.init(k),n.eventHandler.init(k),n.resizeHandler.init(k),n.slidesHandler.init(k),n.options.loop&&n.slideLooper.loop(),a.offsetParent&&o.length&&n.dragHandler.init(k),s=u.init(k,I)))}function A(e,t){let i=O();M(),R(p({startIndex:i},e),t),g.emit("reInit")}function M(){n.dragHandler.destroy(),n.eventStore.clear(),n.translate.clear(),n.slideLooper.clear(),n.resizeHandler.destroy(),n.slidesHandler.destroy(),n.slidesInView.destroy(),n.animation.destroy(),u.destroy(),h.clear()}function D(e,t,i){_.active&&!T&&(n.scrollBody.useBaseFriction().useDuration(!0===t?0:_.duration),n.scrollTo.index(e,i||0))}function O(){return n.index.get()}let k={canScrollNext:function(){return n.index.add(1).get()!==O()},canScrollPrev:function(){return n.index.add(-1).get()!==O()},containerNode:function(){return a},internalEngine:function(){return n},destroy:function(){T||(T=!0,h.clear(),M(),g.emit("destroy"),g.clear())},off:S,on:v,emit:y,plugins:function(){return s},previousScrollSnap:function(){return n.indexPrevious.get()},reInit:C,rootNode:function(){return e},scrollNext:function(e){D(n.index.add(1).get(),e,-1)},scrollPrev:function(e){D(n.index.add(-1).get(),e,1)},scrollProgress:function(){return n.scrollProgress.get(n.location.get())},scrollSnapList:function(){return n.scrollSnapList},scrollTo:D,selectedScrollSnap:O,slideNodes:function(){return o},slidesInView:function(){return n.slidesInView.get()},slidesNotInView:function(){return n.slidesInView.get(!1)}};return R(t,i),setTimeout(()=>g.emit("init"),0),k}ee.globalOptions=void 0},255885:function(e){"use strict";var t=Object.prototype.hasOwnProperty;function i(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}e.exports=function(e,n){if(i(e,n))return!0;if("object"!=typeof e||null===e||"object"!=typeof n||null===n)return!1;var r=Object.keys(e),s=Object.keys(n);if(r.length!==s.length)return!1;for(var a=0;a<r.length;a++)if(!t.call(n,r[a])||!i(e[r[a]],n[r[a]]))return!1;return!0}},686068:function(e){"use strict";e.exports=function(e,t){for(var i={},n=Object.keys(e),r=Array.isArray(t),s=0;s<n.length;s++){var a=n[s],o=e[a];(r?-1!==t.indexOf(a):t(a,o,e))&&(i[a]=o)}return i}},144870:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(212673);t.eventEmitterAsyncIterator=function(e,t){var i,r=[],s=[],a="string"==typeof t?[t]:t,o=!0,l=function(e){0!==r.length?r.shift()({value:e,done:!1}):s.push(e)},c=function(){return new Promise(function(e){0!==s.length?e({value:s.shift(),done:!1}):r.push(e)})},d=function(){o&&(o=!1,u(),r.forEach(function(e){return e({value:void 0,done:!0})}),r.length=0,s.length=0)},u=function(){for(var t=0,i=a;t<i.length;t++){var n=i[t];e.removeListener(n,l)}};return function(){for(var t=0,i=a;t<i.length;t++){var n=i[t];e.addListener(n,l)}}(),(i={next:function(){return o?c():this.return()},return:function(){return d(),Promise.resolve({value:void 0,done:!0})},throw:function(e){return d(),Promise.reject(e)}})[n.$$asyncIterator]=function(){return this},i}},95181:function(e,t,i){"use strict";t.PubSub=i(67942).PubSub,t.withFilter=i(597050).withFilter},67942:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(697531),r=i(144870);t.PubSub=function(){function e(e){void 0===e&&(e={}),this.ee=e.eventEmitter||new n.EventEmitter,this.subscriptions={},this.subIdCounter=0}return e.prototype.publish=function(e,t){return this.ee.emit(e,t),!0},e.prototype.subscribe=function(e,t){return this.ee.addListener(e,t),this.subIdCounter=this.subIdCounter+1,this.subscriptions[this.subIdCounter]=[e,t],Promise.resolve(this.subIdCounter)},e.prototype.unsubscribe=function(e){var t=this.subscriptions[e],i=t[0],n=t[1];delete this.subscriptions[e],this.ee.removeListener(i,n)},e.prototype.asyncIterator=function(e){return r.eventEmitterAsyncIterator(this.ee,e)},e}()},597050:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(212673);t.withFilter=function(e,t){return function(i,r,s,a){var o,l=e(i,r,s,a),c=function(){return l.next().then(function(e){return Promise.all([e,Promise.resolve(t(e.value,r,s,a)).catch(function(){return!1})])}).then(function(e){var t=e[0];return!0===e[1]||!0===t.done?t:c()})};return(o={next:function(){return c()},return:function(){return l.return()},throw:function(e){return l.throw(e)}})[n.$$asyncIterator]=function(){return this},o}}},946303:function(e,t,i){"use strict";function n(e){var t=e.split(/\r\n|[\n\r]/g),i=s(e);if(0!==i)for(var n=1;n<t.length;n++)t[n]=t[n].slice(i);for(var a=0;a<t.length&&r(t[a]);)++a;for(var o=t.length;o>a&&r(t[o-1]);)--o;return t.slice(a,o).join("\n")}function r(e){for(var t=0;t<e.length;++t)if(" "!==e[t]&&"	"!==e[t])return!1;return!0}function s(e){for(var t,i=!0,n=!0,r=0,s=null,a=0;a<e.length;++a)switch(e.charCodeAt(a)){case 13:10===e.charCodeAt(a+1)&&++a;case 10:i=!1,n=!0,r=0;break;case 9:case 32:++r;break;default:n&&!i&&(null===s||r<s)&&(s=r),n=!1}return null!=(t=s)?t:0}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=-1===e.indexOf("\n"),r=" "===e[0]||"	"===e[0],s='"'===e[e.length-1],a="\\"===e[e.length-1],o=!n||s||a||i,l="";return o&&!(n&&r)&&(l+="\n"+t),l+=t?e.replace(/\n/g,"\n"+t):e,o&&(l+="\n"),'"""'+l.replace(/"""/g,'\\"""')+'"""'}i.d(t,{LZ:()=>a,W7:()=>n})},390953:function(e,t,i){"use strict";i.d(t,{Qc:()=>d});var n=i(664856),r=i(513830),s=i(303526),a=i(765685),o=i(244680),l=i(203140),c=i(639230);function d(e,t){return new u(e,t).parseDocument()}var u=function(){function e(e,t){var i=(0,o.T)(e)?e:new o.H(e);this._lexer=new c.h(i),this._options=t}var t=e.prototype;return t.parseName=function(){var e=this.expectToken(a.T.NAME);return{kind:r.h.NAME,value:e.value,loc:this.loc(e)}},t.parseDocument=function(){var e=this._lexer.token;return{kind:r.h.DOCUMENT,definitions:this.many(a.T.SOF,this.parseDefinition,a.T.EOF),loc:this.loc(e)}},t.parseDefinition=function(){if(this.peek(a.T.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else if(this.peek(a.T.BRACE_L))return this.parseOperationDefinition();else if(this.peekDescription())return this.parseTypeSystemDefinition();throw this.unexpected()},t.parseOperationDefinition=function(){var e,t=this._lexer.token;if(this.peek(a.T.BRACE_L))return{kind:r.h.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(t)};var i=this.parseOperationType();return this.peek(a.T.NAME)&&(e=this.parseName()),{kind:r.h.OPERATION_DEFINITION,operation:i,name:e,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseOperationType=function(){var e=this.expectToken(a.T.NAME);switch(e.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(e)},t.parseVariableDefinitions=function(){return this.optionalMany(a.T.PAREN_L,this.parseVariableDefinition,a.T.PAREN_R)},t.parseVariableDefinition=function(){var e=this._lexer.token;return{kind:r.h.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(a.T.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(a.T.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(e)}},t.parseVariable=function(){var e=this._lexer.token;return this.expectToken(a.T.DOLLAR),{kind:r.h.VARIABLE,name:this.parseName(),loc:this.loc(e)}},t.parseSelectionSet=function(){var e=this._lexer.token;return{kind:r.h.SELECTION_SET,selections:this.many(a.T.BRACE_L,this.parseSelection,a.T.BRACE_R),loc:this.loc(e)}},t.parseSelection=function(){return this.peek(a.T.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function(){var e,t,i=this._lexer.token,n=this.parseName();return this.expectOptionalToken(a.T.COLON)?(e=n,t=this.parseName()):t=n,{kind:r.h.FIELD,alias:e,name:t,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(a.T.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(i)}},t.parseArguments=function(e){var t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(a.T.PAREN_L,t,a.T.PAREN_R)},t.parseArgument=function(){var e=this._lexer.token,t=this.parseName();return this.expectToken(a.T.COLON),{kind:r.h.ARGUMENT,name:t,value:this.parseValueLiteral(!1),loc:this.loc(e)}},t.parseConstArgument=function(){var e=this._lexer.token;return{kind:r.h.ARGUMENT,name:this.parseName(),value:(this.expectToken(a.T.COLON),this.parseValueLiteral(!0)),loc:this.loc(e)}},t.parseFragment=function(){var e=this._lexer.token;this.expectToken(a.T.SPREAD);var t=this.expectOptionalKeyword("on");return!t&&this.peek(a.T.NAME)?{kind:r.h.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(e)}:{kind:r.h.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseFragmentDefinition=function(){var e,t=this._lexer.token;return(this.expectKeyword("fragment"),(null==(e=this._options)?void 0:e.experimentalFragmentVariables)===!0)?{kind:r.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}:{kind:r.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseFragmentName=function(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()},t.parseValueLiteral=function(e){var t=this._lexer.token;switch(t.kind){case a.T.BRACKET_L:return this.parseList(e);case a.T.BRACE_L:return this.parseObject(e);case a.T.INT:return this._lexer.advance(),{kind:r.h.INT,value:t.value,loc:this.loc(t)};case a.T.FLOAT:return this._lexer.advance(),{kind:r.h.FLOAT,value:t.value,loc:this.loc(t)};case a.T.STRING:case a.T.BLOCK_STRING:return this.parseStringLiteral();case a.T.NAME:switch(this._lexer.advance(),t.value){case"true":return{kind:r.h.BOOLEAN,value:!0,loc:this.loc(t)};case"false":return{kind:r.h.BOOLEAN,value:!1,loc:this.loc(t)};case"null":return{kind:r.h.NULL,loc:this.loc(t)};default:return{kind:r.h.ENUM,value:t.value,loc:this.loc(t)}}case a.T.DOLLAR:if(!e)return this.parseVariable()}throw this.unexpected()},t.parseStringLiteral=function(){var e=this._lexer.token;return this._lexer.advance(),{kind:r.h.STRING,value:e.value,block:e.kind===a.T.BLOCK_STRING,loc:this.loc(e)}},t.parseList=function(e){var t=this,i=this._lexer.token,n=function(){return t.parseValueLiteral(e)};return{kind:r.h.LIST,values:this.any(a.T.BRACKET_L,n,a.T.BRACKET_R),loc:this.loc(i)}},t.parseObject=function(e){var t=this,i=this._lexer.token,n=function(){return t.parseObjectField(e)};return{kind:r.h.OBJECT,fields:this.any(a.T.BRACE_L,n,a.T.BRACE_R),loc:this.loc(i)}},t.parseObjectField=function(e){var t=this._lexer.token,i=this.parseName();return this.expectToken(a.T.COLON),{kind:r.h.OBJECT_FIELD,name:i,value:this.parseValueLiteral(e),loc:this.loc(t)}},t.parseDirectives=function(e){for(var t=[];this.peek(a.T.AT);)t.push(this.parseDirective(e));return t},t.parseDirective=function(e){var t=this._lexer.token;return this.expectToken(a.T.AT),{kind:r.h.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e),loc:this.loc(t)}},t.parseTypeReference=function(){var e,t=this._lexer.token;return(this.expectOptionalToken(a.T.BRACKET_L)?(e=this.parseTypeReference(),this.expectToken(a.T.BRACKET_R),e={kind:r.h.LIST_TYPE,type:e,loc:this.loc(t)}):e=this.parseNamedType(),this.expectOptionalToken(a.T.BANG))?{kind:r.h.NON_NULL_TYPE,type:e,loc:this.loc(t)}:e},t.parseNamedType=function(){var e=this._lexer.token;return{kind:r.h.NAMED_TYPE,name:this.parseName(),loc:this.loc(e)}},t.parseTypeSystemDefinition=function(){var e=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(e.kind===a.T.NAME)switch(e.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(e)},t.peekDescription=function(){return this.peek(a.T.STRING)||this.peek(a.T.BLOCK_STRING)},t.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");var i=this.parseDirectives(!0),n=this.many(a.T.BRACE_L,this.parseOperationTypeDefinition,a.T.BRACE_R);return{kind:r.h.SCHEMA_DEFINITION,description:t,directives:i,operationTypes:n,loc:this.loc(e)}},t.parseOperationTypeDefinition=function(){var e=this._lexer.token,t=this.parseOperationType();this.expectToken(a.T.COLON);var i=this.parseNamedType();return{kind:r.h.OPERATION_TYPE_DEFINITION,operation:t,type:i,loc:this.loc(e)}},t.parseScalarTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");var i=this.parseName(),n=this.parseDirectives(!0);return{kind:r.h.SCALAR_TYPE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),a=this.parseFieldsDefinition();return{kind:r.h.OBJECT_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:a,loc:this.loc(e)}},t.parseImplementsInterfaces=function(){var e;if(!this.expectOptionalKeyword("implements"))return[];if((null==(e=this._options)?void 0:e.allowLegacySDLImplementsInterfaces)===!0){var t=[];this.expectOptionalToken(a.T.AMP);do t.push(this.parseNamedType());while(this.expectOptionalToken(a.T.AMP)||this.peek(a.T.NAME));return t}return this.delimitedMany(a.T.AMP,this.parseNamedType)},t.parseFieldsDefinition=function(){var e;return(null==(e=this._options)?void 0:e.allowLegacySDLEmptyFields)===!0&&this.peek(a.T.BRACE_L)&&this._lexer.lookahead().kind===a.T.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(a.T.BRACE_L,this.parseFieldDefinition,a.T.BRACE_R)},t.parseFieldDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseArgumentDefs();this.expectToken(a.T.COLON);var s=this.parseTypeReference(),o=this.parseDirectives(!0);return{kind:r.h.FIELD_DEFINITION,description:t,name:i,arguments:n,type:s,directives:o,loc:this.loc(e)}},t.parseArgumentDefs=function(){return this.optionalMany(a.T.PAREN_L,this.parseInputValueDef,a.T.PAREN_R)},t.parseInputValueDef=function(){var e,t=this._lexer.token,i=this.parseDescription(),n=this.parseName();this.expectToken(a.T.COLON);var s=this.parseTypeReference();this.expectOptionalToken(a.T.EQUALS)&&(e=this.parseValueLiteral(!0));var o=this.parseDirectives(!0);return{kind:r.h.INPUT_VALUE_DEFINITION,description:i,name:n,type:s,defaultValue:e,directives:o,loc:this.loc(t)}},t.parseInterfaceTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),a=this.parseFieldsDefinition();return{kind:r.h.INTERFACE_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:a,loc:this.loc(e)}},t.parseUnionTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseUnionMemberTypes();return{kind:r.h.UNION_TYPE_DEFINITION,description:t,name:i,directives:n,types:s,loc:this.loc(e)}},t.parseUnionMemberTypes=function(){return this.expectOptionalToken(a.T.EQUALS)?this.delimitedMany(a.T.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseEnumValuesDefinition();return{kind:r.h.ENUM_TYPE_DEFINITION,description:t,name:i,directives:n,values:s,loc:this.loc(e)}},t.parseEnumValuesDefinition=function(){return this.optionalMany(a.T.BRACE_L,this.parseEnumValueDefinition,a.T.BRACE_R)},t.parseEnumValueDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseDirectives(!0);return{kind:r.h.ENUM_VALUE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseInputObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseInputFieldsDefinition();return{kind:r.h.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInputFieldsDefinition=function(){return this.optionalMany(a.T.BRACE_L,this.parseInputValueDef,a.T.BRACE_R)},t.parseTypeSystemExtension=function(){var e=this._lexer.lookahead();if(e.kind===a.T.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)},t.parseSchemaExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var t=this.parseDirectives(!0),i=this.optionalMany(a.T.BRACE_L,this.parseOperationTypeDefinition,a.T.BRACE_R);if(0===t.length&&0===i.length)throw this.unexpected();return{kind:r.h.SCHEMA_EXTENSION,directives:t,operationTypes:i,loc:this.loc(e)}},t.parseScalarTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var t=this.parseName(),i=this.parseDirectives(!0);if(0===i.length)throw this.unexpected();return{kind:r.h.SCALAR_TYPE_EXTENSION,name:t,directives:i,loc:this.loc(e)}},t.parseObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:r.h.OBJECT_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInterfaceTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:r.h.INTERFACE_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseUnionTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseUnionMemberTypes();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:r.h.UNION_TYPE_EXTENSION,name:t,directives:i,types:n,loc:this.loc(e)}},t.parseEnumTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseEnumValuesDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:r.h.ENUM_TYPE_EXTENSION,name:t,directives:i,values:n,loc:this.loc(e)}},t.parseInputObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseInputFieldsDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:r.h.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:i,fields:n,loc:this.loc(e)}},t.parseDirectiveDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(a.T.AT);var i=this.parseName(),n=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var o=this.parseDirectiveLocations();return{kind:r.h.DIRECTIVE_DEFINITION,description:t,name:i,arguments:n,repeatable:s,locations:o,loc:this.loc(e)}},t.parseDirectiveLocations=function(){return this.delimitedMany(a.T.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function(){var e=this._lexer.token,t=this.parseName();if(void 0!==l.B[t.value])return t;throw this.unexpected(e)},t.loc=function(e){var t;if((null==(t=this._options)?void 0:t.noLocation)!==!0)return new s.Ye(e,this._lexer.lastToken,this._lexer.source)},t.peek=function(e){return this._lexer.token.kind===e},t.expectToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t;throw(0,n.h)(this._lexer.source,t.start,"Expected ".concat(g(e),", found ").concat(h(t),"."))},t.expectOptionalToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t},t.expectKeyword=function(e){var t=this._lexer.token;if(t.kind===a.T.NAME&&t.value===e)this._lexer.advance();else throw(0,n.h)(this._lexer.source,t.start,'Expected "'.concat(e,'", found ').concat(h(t),"."))},t.expectOptionalKeyword=function(e){var t=this._lexer.token;return t.kind===a.T.NAME&&t.value===e&&(this._lexer.advance(),!0)},t.unexpected=function(e){var t=null!=e?e:this._lexer.token;return(0,n.h)(this._lexer.source,t.start,"Unexpected ".concat(h(t),"."))},t.any=function(e,t,i){this.expectToken(e);for(var n=[];!this.expectOptionalToken(i);)n.push(t.call(this));return n},t.optionalMany=function(e,t,i){if(this.expectOptionalToken(e)){var n=[];do n.push(t.call(this));while(!this.expectOptionalToken(i));return n}return[]},t.many=function(e,t,i){this.expectToken(e);var n=[];do n.push(t.call(this));while(!this.expectOptionalToken(i));return n},t.delimitedMany=function(e,t){this.expectOptionalToken(e);var i=[];do i.push(t.call(this));while(this.expectOptionalToken(e));return i},e}();function h(e){var t=e.value;return g(e.kind)+(null!=t?' "'.concat(t,'"'):"")}function g(e){return(0,c.u)(e)?'"'.concat(e,'"'):e}},24579:function(e,t,i){"use strict";i.d(t,{Xr:()=>n,YF:()=>r});var n="function"==typeof Symbol&&null!=Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Symbol&&null!=Symbol.toStringTag?Symbol.toStringTag:"@@toStringTag"},54961:function(e,t,i){"use strict";i.d(t,{ob:()=>b,Ep:()=>y,Hp:()=>T,q_:()=>q,lX:()=>F,PP:()=>J});var n=i(690395),r=i.n(n),s=i(256784),a=i.n(s);function o(e){return"/"===e.charAt(0)}function l(e,t){for(var i=t,n=i+1,r=e.length;n<r;i+=1,n+=1)e[i]=e[n];e.pop()}let c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e&&e.split("/")||[],n=t&&t.split("/")||[],r=e&&o(e),s=t&&o(t),a=r||s;if(e&&o(e)?n=i:i.length&&(n.pop(),n=n.concat(i)),!n.length)return"/";var c=void 0;if(n.length){var d=n[n.length-1];c="."===d||".."===d||""===d}else c=!1;for(var u=0,h=n.length;h>=0;h--){var g=n[h];"."===g?l(n,h):".."===g?(l(n,h),u++):u&&(l(n,h),u--)}if(!a)for(;u--;)n.unshift("..");!a||""===n[0]||n[0]&&o(n[0])||n.unshift("");var p=n.join("/");return c&&"/"!==p.substr(-1)&&(p+="/"),p};var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function u(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(Array.isArray(e))return Array.isArray(t)&&e.length===t.length&&e.every(function(e,i){return u(e,t[i])});var i=void 0===e?"undefined":d(e);if(i!==(void 0===t?"undefined":d(t)))return!1;if("object"===i){var n=e.valueOf(),r=t.valueOf();if(n!==e||r!==t)return u(n,r);var s=Object.keys(e),a=Object.keys(t);return s.length===a.length&&s.every(function(i){return u(e[i],t[i])})}return!1}let h=u;var g=function(e){return"/"===e.charAt(0)?e:"/"+e},p=function(e){return"/"===e.charAt(0)?e.substr(1):e},f=function(e,t){return RegExp("^"+t+"(\\/|\\?|#|$)","i").test(e)},m=function(e,t){return f(e,t)?e.substr(t.length):e},v=function(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e},S=function(e){var t=e||"/",i="",n="",r=t.indexOf("#");-1!==r&&(n=t.substr(r),t=t.substr(0,r));var s=t.indexOf("?");return -1!==s&&(i=t.substr(s),t=t.substr(0,s)),{pathname:t,search:"?"===i?"":i,hash:"#"===n?"":n}},y=function(e){var t=e.pathname,i=e.search,n=e.hash,r=t||"/";return i&&"?"!==i&&(r+="?"===i.charAt(0)?i:"?"+i),n&&"#"!==n&&(r+="#"===n.charAt(0)?n:"#"+n),r},C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},b=function(e,t,i,n){var r=void 0;"string"==typeof e?(r=S(e)).state=t:(void 0===(r=C({},e)).pathname&&(r.pathname=""),r.search?"?"!==r.search.charAt(0)&&(r.search="?"+r.search):r.search="",r.hash?"#"!==r.hash.charAt(0)&&(r.hash="#"+r.hash):r.hash="",void 0!==t&&void 0===r.state&&(r.state=t));try{r.pathname=decodeURI(r.pathname)}catch(e){if(e instanceof URIError)throw URIError('Pathname "'+r.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.');throw e}return i&&(r.key=i),n?r.pathname?"/"!==r.pathname.charAt(0)&&(r.pathname=c(r.pathname,n.pathname)):r.pathname=n.pathname:r.pathname||(r.pathname="/"),r},T=function(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash&&e.key===t.key&&h(e.state,t.state)};let E=function(){var e=null,t=[];return{setPrompt:function(t){return r()(null==e,"A history supports only one prompt at a time"),e=t,function(){e===t&&(e=null)}},confirmTransitionTo:function(t,i,n,s){if(null!=e){var a="function"==typeof e?e(t,i):e;"string"==typeof a?"function"==typeof n?n(a,s):(r()(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),s(!0)):s(!1!==a)}else s(!0)},appendListener:function(e){var i=!0,n=function(){i&&e.apply(void 0,arguments)};return t.push(n),function(){i=!1,t=t.filter(function(e){return e!==n})}},notifyListeners:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.forEach(function(e){return e.apply(void 0,i)})}}};var _=!!("undefined"!=typeof window&&window.document&&window.document.createElement),I=function(e,t,i){return e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},w=function(e,t,i){return e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent("on"+t,i)},P=function(e,t){return t(window.confirm(e))},R=function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history},A=function(){return -1===window.navigator.userAgent.indexOf("Trident")},M=function(){return -1===window.navigator.userAgent.indexOf("Firefox")},D=function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")},O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},N="popstate",x="hashchange",L=function(){try{return window.history.state||{}}catch(e){return{}}};let F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a()(_,"Browser history needs a DOM");var t=window.history,i=R(),n=!A(),s=e.forceRefresh,o=void 0!==s&&s,l=e.getUserConfirmation,c=void 0===l?P:l,d=e.keyLength,u=void 0===d?6:d,h=e.basename?v(g(e.basename)):"",p=function(e){var t=e||{},i=t.key,n=t.state,s=window.location,a=s.pathname+s.search+s.hash;return r()(!h||f(a,h),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+a+'" to begin with "'+h+'".'),h&&(a=m(a,h)),b(a,n,i)},S=function(){return Math.random().toString(36).substr(2,u)},C=E(),T=function(e){k(ee,e),ee.length=t.length,C.notifyListeners(ee.location,ee.action)},M=function(e){D(e)||$(p(e.state))},F=function(){$(p(L()))},U=!1,$=function(e){if(U)U=!1,T();else{var t="POP";C.confirmTransitionTo(e,t,c,function(i){i?T({action:t,location:e}):V(e)})}},V=function(e){var t=ee.location,i=H.indexOf(t.key);-1===i&&(i=0);var n=H.indexOf(e.key);-1===n&&(n=0);var r=i-n;r&&(U=!0,G(r))},B=p(L()),H=[B.key],j=function(e){return h+y(e)},q=function(e,n){r()((void 0===e?"undefined":O(e))!=="object"||void 0===e.state||void 0===n,"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var s="PUSH",a=b(e,n,S(),ee.location);C.confirmTransitionTo(a,s,c,function(e){if(e){var n=j(a),l=a.key,c=a.state;if(i)if(t.pushState({key:l,state:c},null,n),o)window.location.href=n;else{var d=H.indexOf(ee.location.key),u=H.slice(0,-1===d?0:d+1);u.push(a.key),H=u,T({action:s,location:a})}else r()(void 0===c,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=n}})},W=function(e,n){r()((void 0===e?"undefined":O(e))!=="object"||void 0===e.state||void 0===n,"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var s="REPLACE",a=b(e,n,S(),ee.location);C.confirmTransitionTo(a,s,c,function(e){if(e){var n=j(a),l=a.key,c=a.state;if(i)if(t.replaceState({key:l,state:c},null,n),o)window.location.replace(n);else{var d=H.indexOf(ee.location.key);-1!==d&&(H[d]=a.key),T({action:s,location:a})}else r()(void 0===c,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(n)}})},G=function(e){t.go(e)},z=function(){return G(-1)},J=function(){return G(1)},K=0,Q=function(e){1===(K+=e)?(I(window,N,M),n&&I(window,x,F)):0===K&&(w(window,N,M),n&&w(window,x,F))},Y=!1,Z=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=C.setPrompt(e);return Y||(Q(1),Y=!0),function(){return Y&&(Y=!1,Q(-1)),t()}},X=function(e){var t=C.appendListener(e);return Q(1),function(){Q(-1),t()}},ee={length:t.length,action:"POP",location:B,createHref:j,push:q,replace:W,go:G,goBack:z,goForward:J,block:Z,listen:X};return ee};var U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},$="hashchange",V={hashbang:{encodePath:function(e){return"!"===e.charAt(0)?e:"!/"+p(e)},decodePath:function(e){return"!"===e.charAt(0)?e.substr(1):e}},noslash:{encodePath:p,decodePath:g},slash:{encodePath:g,decodePath:g}},B=function(){var e=window.location.href,t=e.indexOf("#");return -1===t?"":e.substring(t+1)},H=function(e){return window.location.hash=e},j=function(e){var t=window.location.href.indexOf("#");window.location.replace(window.location.href.slice(0,t>=0?t:0)+"#"+e)};let q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a()(_,"Hash history needs a DOM");var t=window.history,i=M(),n=e.getUserConfirmation,s=void 0===n?P:n,o=e.hashType,l=void 0===o?"slash":o,c=e.basename?v(g(e.basename)):"",d=V[l],u=d.encodePath,h=d.decodePath,p=function(){var e=h(B());return r()(!c||f(e,c),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+e+'" to begin with "'+c+'".'),c&&(e=m(e,c)),b(e)},S=E(),C=function(e){U(et,e),et.length=t.length,S.notifyListeners(et.location,et.action)},R=!1,A=null,D=function(){var e=B(),t=u(e);if(e!==t)j(t);else{var i=p(),n=et.location;if(!R&&T(n,i)||A===y(i))return;A=null,O(i)}},O=function(e){if(R)R=!1,C();else{var t="POP";S.confirmTransitionTo(e,t,s,function(i){i?C({action:t,location:e}):k(e)})}},k=function(e){var t=et.location,i=F.lastIndexOf(y(t));-1===i&&(i=0);var n=F.lastIndexOf(y(e));-1===n&&(n=0);var r=i-n;r&&(R=!0,z(r))},N=B(),x=u(N);N!==x&&j(x);var L=p(),F=[y(L)],q=function(e){return"#"+u(c+y(e))},W=function(e,t){r()(void 0===t,"Hash history cannot push state; it is ignored");var i="PUSH",n=b(e,void 0,void 0,et.location);S.confirmTransitionTo(n,i,s,function(e){if(e){var t=y(n),s=u(c+t),a=B()!==s;if(a){A=t,H(s);var o=F.lastIndexOf(y(et.location)),l=F.slice(0,-1===o?0:o+1);l.push(t),F=l,C({action:i,location:n})}else r()(!1,"Hash history cannot PUSH the same path; a new entry will not be added to the history stack"),C()}})},G=function(e,t){r()(void 0===t,"Hash history cannot replace state; it is ignored");var i="REPLACE",n=b(e,void 0,void 0,et.location);S.confirmTransitionTo(n,i,s,function(e){if(e){var t=y(n),r=u(c+t),s=B()!==r;s&&(A=t,j(r));var a=F.indexOf(y(et.location));-1!==a&&(F[a]=t),C({action:i,location:n})}})},z=function(e){r()(i,"Hash history go(n) causes a full page reload in this browser"),t.go(e)},J=function(){return z(-1)},K=function(){return z(1)},Q=0,Y=function(e){1===(Q+=e)?I(window,$,D):0===Q&&w(window,$,D)},Z=!1,X=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=S.setPrompt(e);return Z||(Y(1),Z=!0),function(){return Z&&(Z=!1,Y(-1)),t()}},ee=function(e){var t=S.appendListener(e);return Y(1),function(){Y(-1),t()}},et={length:t.length,action:"POP",location:L,createHref:q,push:W,replace:G,go:z,goBack:J,goForward:K,block:X,listen:ee};return et};var W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},z=function(e,t,i){return Math.min(Math.max(e,t),i)};let J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.getUserConfirmation,i=e.initialEntries,n=void 0===i?["/"]:i,s=e.initialIndex,a=void 0===s?0:s,o=e.keyLength,l=void 0===o?6:o,c=E(),d=function(e){G(w,e),w.length=w.entries.length,c.notifyListeners(w.location,w.action)},u=function(){return Math.random().toString(36).substr(2,l)},h=z(a,0,n.length-1),g=n.map(function(e){return"string"==typeof e?b(e,void 0,u()):b(e,void 0,e.key||u())}),p=y,f=function(e,i){r()((void 0===e?"undefined":W(e))!=="object"||void 0===e.state||void 0===i,"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var n="PUSH",s=b(e,i,u(),w.location);c.confirmTransitionTo(s,n,t,function(e){if(e){var t=w.index,i=t+1,r=w.entries.slice(0);r.length>i?r.splice(i,r.length-i,s):r.push(s),d({action:n,location:s,index:i,entries:r})}})},m=function(e,i){r()((void 0===e?"undefined":W(e))!=="object"||void 0===e.state||void 0===i,"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var n="REPLACE",s=b(e,i,u(),w.location);c.confirmTransitionTo(s,n,t,function(e){e&&(w.entries[w.index]=s,d({action:n,location:s}))})},v=function(e){var i=z(w.index+e,0,w.entries.length-1),n="POP",r=w.entries[i];c.confirmTransitionTo(r,n,t,function(e){e?d({action:n,location:r,index:i}):d()})},S=function(){return v(-1)},C=function(){return v(1)},T=function(e){var t=w.index+e;return t>=0&&t<w.entries.length},_=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c.setPrompt(e)},I=function(e){return c.appendListener(e)},w={length:g.length,action:"POP",location:g[h],index:h,entries:g,createHref:p,push:f,replace:m,go:v,goBack:S,goForward:C,canGo:T,block:_,listen:I};return w}},559431:function(e){!function(t,i){e.exports=i()}(0,function(){"use strict";var e={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,n=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,s=Object.getOwnPropertyDescriptor,a=Object.getPrototypeOf,o=a&&a(Object);return function l(c,d,u){if("string"!=typeof d){if(o){var h=a(d);h&&h!==o&&l(c,h,u)}var g=n(d);r&&(g=g.concat(r(d)));for(var p=0;p<g.length;++p){var f=g[p];if(!e[f]&&!t[f]&&(!u||!u[f])){var m=s(d,f);try{i(c,f,m)}catch(e){}}}}return c}})},256784:function(e){"use strict";e.exports=function(e,t,i,n,r,s,a,o){if(!e){var l;if(void 0===t)l=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[i,n,r,s,a,o],d=0;(l=Error(t.replace(/%s/g,function(){return c[d++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}},222598:function(e,t,i){"use strict";i.d(t,{Dy:()=>c,G0:()=>et,IX:()=>K,MQ:()=>F,O7:()=>H,Rn:()=>o,Vp:()=>l,Z_:()=>V,_4:()=>$,dt:()=>Y,i0:()=>G,jV:()=>en,pk:()=>B,r$:()=>X,yR:()=>d});var n=i(862643),r=function(){var e=function(t,i){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),s=function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=n.t$,o=function(e,t,i){return a([{value:e,context:t,message:i}])},l=n.F2,c=function(){function e(e,t,i,n){this.name=e,this.is=t,this.validate=i,this.encode=n,this.decode=this.decode.bind(this)}return e.prototype.pipe=function(t,i){var r=this;return void 0===i&&(i="pipe(".concat(this.name,", ").concat(t.name,")")),new e(i,t.is,function(e,i){var s=r.validate(e,i);return(0,n.nM)(s)?s:t.validate(s.right,i)},this.encode===d&&t.encode===d?d:function(e){return r.encode(t.encode(e))})},e.prototype.asDecoder=function(){return this},e.prototype.asEncoder=function(){return this},e.prototype.decode=function(e){return this.validate(e,[{key:"",type:this,actual:e}])},e}(),d=function(e){return e};function u(e){return e.displayName||e.name||"<function".concat(e.length,">")}function h(e,t,i,n){for(var r=e.length,s=Array(r+1),a=0;a<r;a++)s[a]=e[a];return s[r]={key:t,type:i,actual:n},s}function g(e,t){for(var i=t.length,n=0;n<i;n++)e.push(t[n])}var p=Object.prototype.hasOwnProperty;function f(e){return Object.keys(e).map(function(t){return"".concat(t,": ").concat(e[t].name)}).join(", ")}function m(e){for(var t=0;t<e.length;t++)if(e[t].encode!==d)return!1;return!0}function v(e){return"{ ".concat(f(e)," }")}function S(e){return"Partial<".concat(e,">")}function y(e){return"("+e.map(function(e){return e.name}).join(" | ")+")"}function C(e,t){for(var i=!0,n=!0,r=!q.is(e),s=0,a=t;s<a.length;s++){var o=a[s];o!==e&&(i=!1),q.is(o)&&(n=!1)}if(i)return e;if(n)return t[t.length-1];for(var l={},c=0,d=t;c<d.length;c++){var o=d[c];for(var u in o)(!p.call(l,u)||r||o[u]!==e[u])&&(l[u]=o[u])}return l}function b(e){return e.length>0}var T={};function E(e,t){for(var i=[],n=0,r=e;n<r.length;n++){var s=r[n];-1!==t.indexOf(s)&&i.push(s)}return i}function _(e,t){if(e===T)return t;if(t===T)return e;var i=Object.assign({},e);for(var n in t)if(p.call(e,n)){var r=E(e[n],t[n]);if(b(r))i[n]=r;else{i=T;break}}else i[n]=t[n];return i}function I(e,t){if(e===T||t===T)return T;var i=T;for(var n in e)p.call(t,n)&&0===E(e[n],t[n]).length&&(i===T&&(i={}),i[n]=e[n].concat(t[n]));return i}function w(e){return"LiteralType"===e._tag}function P(e){return"InterfaceType"===e._tag}function R(e){return"StrictType"===e._tag}function A(e){return"ExactType"===e._tag}function M(e){return"RefinementType"===e._tag}function D(e){return"IntersectionType"===e._tag}function O(e){return"UnionType"===e._tag}function k(e){return"RecursiveType"===e._tag}var N=[];function x(e){if(-1!==N.indexOf(e))return T;if(P(e)||R(e)){var t=T;for(var i in e.props){var n=e.props[i];w(n)&&(t===T&&(t={}),t[i]=[n.value])}return t}if(A(e)||M(e))return x(e.type);if(D(e))return e.types.reduce(function(e,t){return _(e,x(t))},T);if(O(e))return e.types.slice(1).reduce(function(e,t){return I(e,x(t))},x(e.types[0]));if(k(e)){N.push(e);var r=x(e.type);return N.pop(),r}return T}function L(e){for(var t=x(e[0]),i=Object.keys(t),n=e.length,r=function(i){for(var r=t[i].slice(),s=[t[i]],a=1;a<n;a++){var o=x(e[a])[i];if(void 0===o||o.some(function(e){return -1!==r.indexOf(e)}))return"continue-keys";r.push.apply(r,o),s.push(o)}return{value:[i,s]}},s=0,a=i;s<a.length;s++){var o=r(a[s]);if("object"==typeof o)return o.value;if("continue-keys"===o)continue}}var F=new(function(e){function t(){var t=e.call(this,"null",function(e){return null===e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="NullType",t}return r(t,e),t}(c)),U=new(function(e){function t(){var t=e.call(this,"undefined",function(e){return void 0===e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="UndefinedType",t}return r(t,e),t}(c));new(function(e){function t(){var t=e.call(this,"void",U.is,U.validate,d)||this;return t._tag="VoidType",t}return r(t,e),t}(c));var $=new(function(e){function t(){var t=e.call(this,"unknown",function(e){return!0},l,d)||this;return t._tag="UnknownType",t}return r(t,e),t}(c)),V=new(function(e){function t(){var t=e.call(this,"string",function(e){return"string"==typeof e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="StringType",t}return r(t,e),t}(c)),B=new(function(e){function t(){var t=e.call(this,"number",function(e){return"number"==typeof e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="NumberType",t}return r(t,e),t}(c));new(function(e){function t(){var t=e.call(this,"bigint",function(e){return"bigint"==typeof e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="BigIntType",t}return r(t,e),t}(c));var H=new(function(e){function t(){var t=e.call(this,"boolean",function(e){return"boolean"==typeof e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="BooleanType",t}return r(t,e),t}(c)),j=new(function(e){function t(){var t=e.call(this,"UnknownArray",Array.isArray,function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="AnyArrayType",t}return r(t,e),t}(c)),q=new(function(e){function t(){var t=e.call(this,"UnknownRecord",function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="AnyDictionaryType",t}return r(t,e),t}(c)),W=function(e){function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.value=s,a._tag="LiteralType",a}return r(t,e),t}(c);function G(e,t){void 0===t&&(t=JSON.stringify(e));var i=function(t){return t===e};return new W(t,i,function(t,n){return i(t)?l(e):o(t,n)},d,e)}!function(e){r(function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.keys=s,a._tag="KeyofType",a},e)}(c);var z=function(e){function t(t,i,n,r,s,a){var o=e.call(this,t,i,n,r)||this;return o.type=s,o.predicate=a,o._tag="RefinementType",o}return r(t,e),t}(c);(function(e,t,i){er(e,t,"Int")})(B,function(e){return Number.isInteger(e)},"Int"),Object.defineProperty(function(e){function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.runDefinition=s,a._tag="RecursiveType",a}return r(t,e),t}(c).prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});var J=function(e){function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.type=s,a._tag="ArrayType",a}return r(t,e),t}(c);function K(e,t){return void 0===t&&(t="Array<".concat(e.name,">")),new J(t,function(t){return j.is(t)&&t.every(e.is)},function(t,i){var r=j.validate(t,i);if((0,n.nM)(r))return r;for(var s=r.right,o=s.length,c=s,d=[],u=0;u<o;u++){var p=s[u],f=e.validate(p,h(i,String(u),e,p));if((0,n.nM)(f))g(d,f.left);else{var m=f.right;m!==p&&(c===s&&(c=s.slice()),c[u]=m)}}return d.length>0?a(d):l(c)},e.encode===d?d:function(t){return t.map(e.encode)},e)}var Q=function(e){function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.props=s,a._tag="InterfaceType",a}return r(t,e),t}(c);function Y(e,t){void 0===t&&(t=v(e));var i=Object.keys(e),r=i.map(function(t){return e[t]}),o=i.length;return new Q(t,function(e){if(q.is(e)){for(var t=0;t<o;t++){var n=i[t],s=e[n];if(void 0===s&&!p.call(e,n)||!r[t].is(s))return!1}return!0}return!1},function(e,t){var c=q.validate(e,t);if((0,n.nM)(c))return c;for(var d=c.right,u=d,f=[],m=0;m<o;m++){var v=i[m],S=u[v],y=r[m],C=y.validate(S,h(t,v,y,S));if((0,n.nM)(C))g(f,C.left);else{var b=C.right;b===S&&(void 0!==b||p.call(u,v))||(u===d&&(u=s({},d)),u[v]=b)}}return f.length>0?a(f):l(u)},m(r)?d:function(e){for(var t=s({},e),n=0;n<o;n++){var a=i[n],l=r[n].encode;l!==d&&(t[a]=l(e[a]))}return t},e)}var Z=function(e){function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.props=s,a._tag="PartialType",a}return r(t,e),t}(c);function X(e,t){void 0===t&&(t=S(v(e)));var i=Object.keys(e),r=i.map(function(t){return e[t]}),o=i.length;return new Z(t,function(t){if(q.is(t)){for(var n=0;n<o;n++){var r=i[n],s=t[r];if(void 0!==s&&!e[r].is(s))return!1}return!0}return!1},function(t,r){var c=q.validate(t,r);if((0,n.nM)(c))return c;for(var d=c.right,u=d,p=[],f=0;f<o;f++){var m=i[f],v=u[m],S=e[m],y=S.validate(v,h(r,m,S,v));if((0,n.nM)(y))void 0!==v&&g(p,y.left);else{var C=y.right;C!==v&&(u===d&&(u=s({},d)),u[m]=C)}}return p.length>0?a(p):l(u)},m(r)?d:function(e){for(var t=s({},e),n=0;n<o;n++){var a=i[n],l=e[a];void 0!==l&&(t[a]=r[n].encode(l))}return t},e)}!function(e){r(function t(t,i,n,r,s,a){var o=e.call(this,t,i,n,r)||this;return o.domain=s,o.codomain=a,o._tag="DictionaryType",o},e)}(c);var ee=function(e){function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.types=s,a._tag="UnionType",a}return r(t,e),t}(c);function et(e,t){void 0===t&&(t=y(e));var i=L(e);if(void 0===i||!(e.length>0))return new ee(t,function(t){return e.some(function(e){return e.is(t)})},function(t,i){for(var r=[],s=0;s<e.length;s++){var o=e[s],c=o.validate(t,h(i,String(s),o,t));if(!(0,n.nM)(c))return l(c.right);g(r,c.left)}return a(r)},m(e)?d:function(i){for(var n=0,r=e;n<r.length;n++){var s=r[n];if(s.is(i))return s.encode(i)}throw Error("no codec found to encode value in union type ".concat(t))},e);var r=i[0],s=i[1],c=s.length,u=function(e){for(var t=0;t<c;t++)if(-1!==s[t].indexOf(e))return t};return new es(t,function(t){if(q.is(t)){var i=u(t[r]);return void 0!==i&&e[i].is(t)}return!1},function(t,i){var s=q.validate(t,i);if((0,n.nM)(s))return s;var a=s.right,l=u(a[r]);if(void 0===l)return o(t,i);var c=e[l];return c.validate(a,h(i,String(l),c,a))},m(e)?d:function(i){var n=u(i[r]);if(void 0!==n)return e[n].encode(i);throw Error("no codec found to encode value in union codec ".concat(t))},e,r)}var ei=function(e){function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.types=s,a._tag="IntersectionType",a}return r(t,e),t}(c);function en(e,t){void 0===t&&(t="(".concat(e.map(function(e){return e.name}).join(" & "),")"));var i=e.length;return new ei(t,function(t){return e.every(function(e){return e.is(t)})},0===e.length?l:function(t,r){for(var s=[],o=[],c=0;c<i;c++){var d=e[c],u=d.validate(t,h(r,String(c),d,t));(0,n.nM)(u)?g(o,u.left):s.push(u.right)}return o.length>0?a(o):l(C(t,s))},0===e.length?d:function(t){return C(t,e.map(function(e){return e.encode(t)}))},e)}function er(e,t,i){return void 0===i&&(i="(".concat(e.name," | ").concat(u(t),")")),new z(i,function(i){return e.is(i)&&t(i)},function(i,r){var s=e.validate(i,r);if((0,n.nM)(s))return s;var a=s.right;return t(a)?l(a):o(a,r)},e.encode,e,t)}!function(e){r(function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.types=s,a._tag="TupleType",a},e)}(c),function(e){r(function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.type=s,a._tag="ReadonlyType",a},e)}(c),function(e){r(function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.type=s,a._tag="ReadonlyArrayType",a},e)}(c),function(e){r(function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.type=s,a._tag="ExactType",a},e)}(c),new(function(e){function t(){var t=e.call(this,"Function",function(e){return"function"==typeof e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="FunctionType",t}return r(t,e),t}(c)),new(function(e){function t(){var t=e.call(this,"never",function(e){return!1},function(e,t){return o(e,t)},function(){throw Error("cannot encode never")})||this;return t._tag="NeverType",t}return r(t,e),t}(c)),new(function(e){function t(){var t=e.call(this,"any",function(e){return!0},l,d)||this;return t._tag="AnyType",t}return r(t,e),t}(c)),er(B,Number.isInteger,"Integer");var es=function(e){function t(t,i,n,r,s,a){var o=e.call(this,t,i,n,r,s)||this;return o.tag=a,o}return r(t,e),t}(ee);new(function(e){function t(){var t=e.call(this,"object",function(e){return null!==e&&"object"==typeof e},function(e,i){return t.is(e)?l(e):o(e,i)},d)||this;return t._tag="ObjectType",t}return r(t,e),t}(c)),function(e){r(function t(t,i,n,r,s){var a=e.call(this,t,i,n,r)||this;return a.props=s,a._tag="StrictType",a},e)}(c)},879930:function(e){var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},216459:function(e){"use strict";e.exports=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}},212673:function(e,t,i){"use strict";i.r(t),i.d(t,{$$asyncIterator:()=>f,$$iterator:()=>s,createAsyncIterator:()=>y,createIterator:()=>u,forAwaitEach:()=>T,forEach:()=>g,getAsyncIterator:()=>v,getAsyncIteratorMethod:()=>S,getIterator:()=>c,getIteratorMethod:()=>d,isArrayLike:()=>o,isAsyncIterable:()=>m,isCollection:()=>l,isIterable:()=>a});var n="function"==typeof Symbol?Symbol:void 0,r=n&&n.iterator,s=r||"@@iterator";function a(e){return!!d(e)}function o(e){var t=null!=e&&e.length;return"number"==typeof t&&t>=0&&t%1==0}function l(e){return Object(e)===e&&(o(e)||a(e))}function c(e){var t=d(e);if(t)return t.call(e)}function d(e){if(null!=e){var t=r&&e[r]||e["@@iterator"];if("function"==typeof t)return t}}function u(e){if(null!=e){var t=c(e);if(t)return t;if(o(e))return new h(e)}}function h(e){this._o=e,this._i=0}function g(e,t,i){if(null!=e){if("function"==typeof e.forEach)return e.forEach(t,i);var n,r=0,s=c(e);if(s){for(;!(n=s.next()).done;)if(t.call(i,n.value,r++,e),r>9999999)throw TypeError("Near-infinite iteration.")}else if(o(e))for(;r<e.length;r++)e.hasOwnProperty(r)&&t.call(i,e[r],r,e)}}h.prototype[s]=function(){return this},h.prototype.next=function(){return void 0===this._o||this._i>=this._o.length?(this._o=void 0,{value:void 0,done:!0}):{value:this._o[this._i++],done:!1}};var p=n&&n.asyncIterator,f=p||"@@asyncIterator";function m(e){return!!S(e)}function v(e){var t=S(e);if(t)return t.call(e)}function S(e){if(null!=e){var t=p&&e[p]||e["@@asyncIterator"];if("function"==typeof t)return t}}function y(e){if(null!=e){var t=v(e);if(t)return t;var i=u(e);if(i)return new C(i)}}function C(e){this._i=e}function b(e,t,i){var n;return new Promise(function(r){r((n=e[t](i)).value)}).then(function(e){return{value:e,done:n.done}})}function T(e,t,i){var n=y(e);if(n){var r=0;return new Promise(function(s,a){function o(){return n.next().then(function(n){return n.done?s():Promise.resolve(t.call(i,n.value,r++,e)).then(o).catch(a),null}).catch(a),null}o()})}}C.prototype[f]=function(){return this},C.prototype.next=function(e){return b(this._i,"next",e)},C.prototype.return=function(e){return this._i.return?b(this._i,"return",e):Promise.resolve({value:e,done:!0})},C.prototype.throw=function(e){return this._i.throw?b(this._i,"throw",e):Promise.reject(e)}},239361:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i(e){this.message=e}function n(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new i("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,a=0,o=0,l="";s=n.charAt(o++);~s&&(r=a%4?64*r+s:s,a++%4)&&(l+=String.fromCharCode(255&r>>(-2*a&6))))s=t.indexOf(s);return l}i.prototype=Error(),i.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||n},506541:function(e,t,i){var n=i(239361);function r(e){return decodeURIComponent(n(e).replace(/(.)/g,function(e,t){var i=t.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return r(t)}catch(e){return n(t)}}},803668:function(e,t,i){"use strict";var n=i(506541);function r(e){this.message=e}function s(e,t){if("string"!=typeof e)throw new r("Invalid token specified");var i=+(!0!==(t=t||{}).header);try{return JSON.parse(n(e.split(".")[i]))}catch(e){throw new r("Invalid token specified: "+e.message)}}r.prototype=Error(),r.prototype.name="InvalidTokenError",e.exports=s,e.exports.default=s,Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.InvalidTokenError=r},848331:function(e,t,i){"use strict";i.d(t,{PW:()=>s,Vm:()=>m,ev:()=>c,r$:()=>a,ub:()=>v});var n="undefined"!=typeof WeakRef,r=class{constructor(e){n&&"object"==typeof e?this._weakRef=new WeakRef(e):this._instance=e}deref(){var e,t;let i;return this._weakRef?(i=null==(e=this._weakRef)?void 0:e.deref())||delete this._weakRef:(null==(t=null==(i=this._instance)?void 0:i.isDisposed)?void 0:t.call(i))&&delete this._instance,i}},s="keyborg:focusin",a="keyborg:focusout";function o(e){let t=e.HTMLElement,i=t.prototype.focus,n=!1;return t.prototype.focus=function(){n=!0},e.document.createElement("button").focus(),t.prototype.focus=i,n}var l=!1;function c(e){let t=e.focus;t.__keyborgNativeFocus?t.__keyborgNativeFocus.call(e):e.focus()}function d(e){let t=e;l||(l=o(t));let i=t.HTMLElement.prototype.focus;if(i.__keyborgNativeFocus)return;t.HTMLElement.prototype.focus=g;let n=new Set,c=e=>{let t=e.target;if(!t)return;let i=new CustomEvent(a,{cancelable:!0,bubbles:!0,composed:!0,detail:{originalEvent:e}});t.dispatchEvent(i)},d=e=>{let t=e.target;if(!t)return;let i=e.composedPath()[0],r=new Set;for(;i;)i.nodeType===Node.DOCUMENT_FRAGMENT_NODE?(r.add(i),i=i.host):i=i.parentNode;for(let e of n){let t=e.deref();t&&r.has(t)||(n.delete(e),t&&(t.removeEventListener("focusin",d,!0),t.removeEventListener("focusout",c,!0)))}u(t,e.relatedTarget||void 0)},u=(e,t,i)=>{var a;let o=e.shadowRoot;if(o){for(let e of n)if(e.deref()===o)return;o.addEventListener("focusin",d,!0),o.addEventListener("focusout",c,!0),n.add(new r(o));return}let u={relatedTarget:t,originalEvent:i},g=new CustomEvent(s,{cancelable:!0,bubbles:!0,composed:!0,detail:u});g.details=u,(l||h.lastFocusedProgrammatically)&&(u.isFocusedProgrammatically=e===(null==(a=h.lastFocusedProgrammatically)?void 0:a.deref()),h.lastFocusedProgrammatically=void 0),e.dispatchEvent(g)},h=t.__keyborgData={focusInHandler:d,focusOutHandler:c,shadowTargets:n};function g(){let e=t.__keyborgData;return e&&(e.lastFocusedProgrammatically=new r(this)),i.apply(this,arguments)}t.document.addEventListener("focusin",t.__keyborgData.focusInHandler,!0),t.document.addEventListener("focusout",t.__keyborgData.focusOutHandler,!0);let p=t.document.activeElement;for(;p&&p.shadowRoot;)u(p),p=p.shadowRoot.activeElement;g.__keyborgNativeFocus=i}function u(e){let t=e,i=t.HTMLElement.prototype,n=i.focus.__keyborgNativeFocus,r=t.__keyborgData;if(r){for(let e of(t.document.removeEventListener("focusin",r.focusInHandler,!0),t.document.removeEventListener("focusout",r.focusOutHandler,!0),r.shadowTargets)){let t=e.deref();t&&(t.removeEventListener("focusin",r.focusInHandler,!0),t.removeEventListener("focusout",r.focusOutHandler,!0))}r.shadowTargets.clear(),delete t.__keyborgData}n&&(i.focus=n)}var h=500,g=0,p=class{constructor(e,t){this._isNavigatingWithKeyboard_DO_NOT_USE=!1,this._onFocusIn=e=>{if(this._isMouseOrTouchUsedTimer||this.isNavigatingWithKeyboard)return;let t=e.detail;t.relatedTarget&&(t.isFocusedProgrammatically||void 0===t.isFocusedProgrammatically||(this.isNavigatingWithKeyboard=!0))},this._onMouseDown=e=>{0!==e.buttons&&(0!==e.clientX||0!==e.clientY||0!==e.screenX||0!==e.screenY)&&this._onMouseOrTouch()},this._onMouseOrTouch=()=>{let e=this._win;e&&(this._isMouseOrTouchUsedTimer&&e.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=e.setTimeout(()=>{delete this._isMouseOrTouchUsedTimer},1e3)),this.isNavigatingWithKeyboard=!1},this._onKeyDown=e=>{this.isNavigatingWithKeyboard?this._shouldDismissKeyboardNavigation(e)&&this._scheduleDismiss():this._shouldTriggerKeyboardNavigation(e)&&(this.isNavigatingWithKeyboard=!0)},this.id="c"+ ++g,this._win=e;let i=e.document;if(t){let e=t.triggerKeys,i=t.dismissKeys;(null==e?void 0:e.length)&&(this._triggerKeys=new Set(e)),(null==i?void 0:i.length)&&(this._dismissKeys=new Set(i))}i.addEventListener(s,this._onFocusIn,!0),i.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),i.addEventListener("touchstart",this._onMouseOrTouch,!0),i.addEventListener("touchend",this._onMouseOrTouch,!0),i.addEventListener("touchcancel",this._onMouseOrTouch,!0),d(e)}get isNavigatingWithKeyboard(){return this._isNavigatingWithKeyboard_DO_NOT_USE}set isNavigatingWithKeyboard(e){this._isNavigatingWithKeyboard_DO_NOT_USE!==e&&(this._isNavigatingWithKeyboard_DO_NOT_USE=e,this.update())}dispose(){let e=this._win;if(e){this._isMouseOrTouchUsedTimer&&(e.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=void 0),this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),u(e);let t=e.document;t.removeEventListener(s,this._onFocusIn,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener("touchstart",this._onMouseOrTouch,!0),t.removeEventListener("touchend",this._onMouseOrTouch,!0),t.removeEventListener("touchcancel",this._onMouseOrTouch,!0),delete this._win}}isDisposed(){return!!this._win}update(){var e,t;let i=null==(t=null==(e=this._win)?void 0:e.__keyborg)?void 0:t.refs;if(i)for(let e of Object.keys(i))f.update(i[e],this.isNavigatingWithKeyboard)}_shouldTriggerKeyboardNavigation(e){var t;if("Tab"===e.key)return!0;let i=null==(t=this._win)?void 0:t.document.activeElement,n=!this._triggerKeys||this._triggerKeys.has(e.keyCode),r=i&&("INPUT"===i.tagName||"TEXTAREA"===i.tagName||i.isContentEditable);return n&&!r}_shouldDismissKeyboardNavigation(e){var t;return null==(t=this._dismissKeys)?void 0:t.has(e.keyCode)}_scheduleDismiss(){let e=this._win;if(e){this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);let t=e.document.activeElement;this._dismissTimer=e.setTimeout(()=>{this._dismissTimer=void 0;let i=e.document.activeElement;t&&i&&t===i&&(this.isNavigatingWithKeyboard=!1)},h)}}},f=class e{constructor(e,t){this._cb=[],this._id="k"+ ++g,this._win=e;let i=e.__keyborg;i?(this._core=i.core,i.refs[this._id]=this):(this._core=new p(e,t),e.__keyborg={core:this._core,refs:{[this._id]:this}})}static create(t,i){return new e(t,i)}static dispose(e){e.dispose()}static update(e,t){e._cb.forEach(e=>e(t))}dispose(){var e;let t=null==(e=this._win)?void 0:e.__keyborg;null!=t&&t.refs[this._id]&&(delete t.refs[this._id],0===Object.keys(t.refs).length&&(t.core.dispose(),delete this._win.__keyborg)),this._cb=[],delete this._core,delete this._win}isNavigatingWithKeyboard(){var e;return!!(null==(e=this._core)?void 0:e.isNavigatingWithKeyboard)}subscribe(e){this._cb.push(e)}unsubscribe(e){let t=this._cb.indexOf(e);t>=0&&this._cb.splice(t,1)}setVal(e){this._core&&(this._core.isNavigatingWithKeyboard=e)}};function m(e,t){return f.create(e,t)}function v(e){f.dispose(e)}},300459:function(e,t,i){"use strict";var n=i(315704);function r(){}function s(){}s.resetWarningCache=r,e.exports=function(){function e(e,t,i,r,s,a){if(a!==n){var o=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var i={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:r};return i.PropTypes=i,i}},260216:function(e,t,i){e.exports=i(300459)()},315704:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},972124:function(e,t,i){"use strict";let n=i(434111),r=i(61133),s=i(354867),a=i(686068),o=e=>null==e;function l(e){switch(e.arrayFormat){case"index":return t=>(i,n)=>{let r=i.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?i:null===n?[...i,u(t,e)+"["+r+"]"]:[...i,u(t,e)+"["+u(r,e)+"]="+u(n,e)]};case"bracket":return t=>(i,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?i:null===n?[...i,u(t,e)+"[]"]:[...i,u(t,e)+"[]="+u(n,e)];case"comma":case"separator":return t=>(i,n)=>null==n||0===n.length?i:0===i.length?[u(t,e)+"="+u(n,e)]:[[i,u(n,e)].join(e.arrayFormatSeparator)];default:return t=>(i,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?i:null===n?[...i,u(t,e)]:[...i,u(t,e)+"="+u(n,e)]}}function c(e){let t;switch(e.arrayFormat){case"index":return(e,i,n)=>{if(t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),!t){n[e]=i;return}void 0===n[e]&&(n[e]={}),n[e][t[1]]=i};case"bracket":return(e,i,n)=>{if(t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),!t){n[e]=i;return}if(void 0===n[e]){n[e]=[i];return}n[e]=[].concat(n[e],i)};case"comma":case"separator":return(t,i,n)=>{let r="string"==typeof i&&i.includes(e.arrayFormatSeparator),s="string"==typeof i&&!r&&h(i,e).includes(e.arrayFormatSeparator);i=s?h(i,e):i;let a=r||s?i.split(e.arrayFormatSeparator).map(t=>h(t,e)):null===i?i:h(i,e);n[t]=a};default:return(e,t,i)=>{if(void 0===i[e]){i[e]=t;return}i[e]=[].concat(i[e],t)}}}function d(e){if("string"!=typeof e||1!==e.length)throw TypeError("arrayFormatSeparator must be single character string")}function u(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function h(e,t){return t.decode?r(e):e}function g(e){return Array.isArray(e)?e.sort():"object"==typeof e?g(Object.keys(e)).sort((e,t)=>Number(e)-Number(t)).map(t=>e[t]):e}function p(e){let t=e.indexOf("#");return -1!==t&&(e=e.slice(0,t)),e}function f(e){let t="",i=e.indexOf("#");return -1!==i&&(t=e.slice(i)),t}function m(e){let t=(e=p(e)).indexOf("?");return -1===t?"":e.slice(t+1)}function v(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):t.parseBooleans&&null!==e&&("true"===e.toLowerCase()||"false"===e.toLowerCase())&&(e="true"===e.toLowerCase()),e}function S(e,t){d((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);let i=c(t),n=Object.create(null);if("string"!=typeof e||!(e=e.trim().replace(/^[?#&]/,"")))return n;for(let r of e.split("&")){if(""===r)continue;let[e,a]=s(t.decode?r.replace(/\+/g," "):r,"=");a=void 0===a?null:["comma","separator"].includes(t.arrayFormat)?a:h(a,t),i(h(e,t),a,n)}for(let e of Object.keys(n)){let i=n[e];if("object"==typeof i&&null!==i)for(let e of Object.keys(i))i[e]=v(i[e],t);else n[e]=v(i,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce((e,t)=>{let i=n[t];return i&&"object"==typeof i&&!Array.isArray(i)?e[t]=g(i):e[t]=i,e},Object.create(null))}t.extract=m,t.parse=S,t.stringify=(e,t)=>{if(!e)return"";d((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);let i=i=>t.skipNull&&o(e[i])||t.skipEmptyString&&""===e[i],n=l(t),r={};for(let t of Object.keys(e))i(t)||(r[t]=e[t]);let s=Object.keys(r);return!1!==t.sort&&s.sort(t.sort),s.map(i=>{let r=e[i];return void 0===r?"":null===r?u(i,t):Array.isArray(r)?r.reduce(n(i),[]).join("&"):u(i,t)+"="+u(r,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);let[i,n]=s(e,"#");return Object.assign({url:i.split("?")[0]||"",query:S(m(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:h(n,t)}:{})},t.stringifyUrl=(e,i)=>{i=Object.assign({encode:!0,strict:!0},i);let n=p(e.url).split("?")[0]||"",r=t.extract(e.url),s=Object.assign(t.parse(r,{sort:!1}),e.query),a=t.stringify(s,i);a&&(a=`?${a}`);let o=f(e.url);return e.fragmentIdentifier&&(o=`#${u(e.fragmentIdentifier,i)}`),`${n}${a}${o}`},t.pick=(e,i,n)=>{n=Object.assign({parseFragmentIdentifier:!0},n);let{url:r,query:s,fragmentIdentifier:o}=t.parseUrl(e,n);return t.stringifyUrl({url:r,query:a(s,i),fragmentIdentifier:o},n)},t.exclude=(e,i,n)=>{let r=Array.isArray(i)?e=>!i.includes(e):(e,t)=>!i(e,t);return t.pick(e,r,n)}},183975:function(e,t,i){"use strict";var n,r,s,a,o,l,c=i(632735),d=i(909146);function u(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h=new Set,g={};function p(e,t){f(e,t),f(e+"Capture",t)}function f(e,t){for(g[e]=t,e=0;e<t.length;e++)h.add(t[e])}var m="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,v=Object.prototype.hasOwnProperty,S=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,y={},C={};function b(e){return!!v.call(C,e)||!v.call(y,e)&&(S.test(e)?C[e]=!0:(y[e]=!0,!1))}function T(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":if(n)return!1;if(null!==i)return!i.acceptsBooleans;return"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e;default:return!1}}function E(e,t,i,n){if(null==t||T(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function _(e,t,i,n,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var I={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){I[e]=new _(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];I[t]=new _(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){I[e]=new _(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){I[e]=new _(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){I[e]=new _(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){I[e]=new _(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){I[e]=new _(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){I[e]=new _(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){I[e]=new _(e,5,!1,e.toLowerCase(),null,!1,!1)});var w=/[\-:]([a-z])/g;function P(e){return e[1].toUpperCase()}function R(e,t,i,n){var r=I.hasOwnProperty(t)?I[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(E(t,i,r,n)&&(i=null),n||null===r?b(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(w,P);I[t]=new _(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(w,P);I[t]=new _(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(w,P);I[t]=new _(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){I[e]=new _(e,1,!1,e.toLowerCase(),null,!1,!1)}),I.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){I[e]=new _(e,1,!1,e.toLowerCase(),null,!0,!0)});var A=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),D=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),L=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),B=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var H=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var j=Symbol.iterator;function q(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=j&&e[j]||e["@@iterator"])?e:null}var W,G=Object.assign;function z(e){if(void 0===W)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);W=t&&t[1]||""}return"\n"+W+e}var J=!1;function K(e,t){if(!e||J)return"";J=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var n=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){n=e}e.call(t.prototype)}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var r=t.stack.split("\n"),s=n.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{J=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?z(e):""}function Q(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=K(e.type,!1);case 11:return e=K(e.type.render,!1);case 1:return e=K(e.type,!0);default:return""}}function Y(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case O:return"Fragment";case D:return"Portal";case N:return"Profiler";case k:return"StrictMode";case U:return"Suspense";case $:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case L:return(e.displayName||"Context")+".Consumer";case x:return(e._context.displayName||"Context")+".Provider";case F:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case V:return null!==(t=e.displayName||null)?t:Y(e.type)||"Memo";case B:t=e._payload,e=e._init;try{return Y(e(t))}catch(e){}}return null}function Z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Y(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function X(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ee(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function et(e){var t=ee(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var r=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ei(e){e._valueTracker||(e._valueTracker=et(e))}function en(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=ee(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function er(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function es(e,t){var i=t.checked;return G({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function ea(e,t){var i=null==t.defaultValue?"":t.defaultValue;e._wrapperState={initialChecked:null!=t.checked?t.checked:t.defaultChecked,initialValue:i=X(null!=t.value?t.value:i),controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function eo(e,t){null!=(t=t.checked)&&R(e,"checked",t,!1)}function el(e,t){eo(e,t);var i=X(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ed(e,t.type,i):t.hasOwnProperty("defaultValue")&&ed(e,t.type,X(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ec(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(("submit"===n||"reset"===n)&&(void 0===t.value||null===t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ed(e,t,i){("number"!==t||er(e.ownerDocument)!==e)&&(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var eu=Array.isArray;function eh(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(r=0,i=""+X(i),t=null;r<e.length;r++){if(e[r].value===i){e[r].selected=!0,n&&(e[r].defaultSelected=!0);return}null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function eg(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(u(91));return G({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ep(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(u(92));if(eu(i)){if(1<i.length)throw Error(u(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:X(i)}}function ef(e,t){var i=X(t.value),n=X(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function em(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ev(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function eS(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ev(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ey,eC=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,i,n,r){MSApp.execUnsafeLocalFunction(function(){return e(t,i,n,r)})}:e}(function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ey=ey||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ey.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function eb(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType){i.nodeValue=t;return}}e.textContent=t}var eT={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},eE=["Webkit","ms","Moz","O"];function e_(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||eT.hasOwnProperty(e)&&eT[e]?(""+t).trim():t+"px"}function eI(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=e_(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(eT).forEach(function(e){eE.forEach(function(t){eT[t=t+e.charAt(0).toUpperCase()+e.substring(1)]=eT[e]})});var ew=G({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eP(e,t){if(t){if(ew[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(u(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(u(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(u(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(u(62))}}function eR(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var eA=null;function eM(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var eD=null,eO=null,ek=null;function eN(e){if(e=n5(e)){if("function"!=typeof eD)throw Error(u(280));var t=e.stateNode;t&&(t=n8(t),eD(e.stateNode,e.type,t))}}function ex(e){eO?ek?ek.push(e):ek=[e]:eO=e}function eL(){if(eO){var e=eO,t=ek;if(ek=eO=null,eN(e),t)for(e=0;e<t.length;e++)eN(t[e])}}function eF(e,t){return e(t)}function eU(){}var e$=!1;function eV(e,t,i){if(e$)return e(t,i);e$=!0;try{return eF(e,t,i)}finally{e$=!1,(null!==eO||null!==ek)&&(eU(),eL())}}function eB(e,t){var i=e.stateNode;if(null===i)return null;var n=n8(i);if(null===n)return null;switch(i=n[t],t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n="button"!==(e=e.type)&&"input"!==e&&"select"!==e&&"textarea"!==e),e=!n;break;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(u(231,t,typeof i));return i}var eH=!1;if(m)try{var ej={};Object.defineProperty(ej,"passive",{get:function(){eH=!0}}),window.addEventListener("test",ej,ej),window.removeEventListener("test",ej,ej)}catch(e){eH=!1}function eq(e,t,i,n,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(e){this.onError(e)}}var eW=!1,eG=null,ez=!1,eJ=null,eK={onError:function(e){eW=!0,eG=e}};function eQ(e,t,i,n,r,s,a,o,l){eW=!1,eG=null,eq.apply(eK,arguments)}function eY(e,t,i,n,r,s,a,o,l){if(eQ.apply(this,arguments),eW){if(eW){var c=eG;eW=!1,eG=null}else throw Error(u(198));ez||(ez=!0,eJ=c)}}function eZ(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do 0!=(4098&(t=e).flags)&&(i=t.return),e=t.return;while(e)}return 3===t.tag?i:null}function eX(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function e0(e){if(eZ(e)!==e)throw Error(u(188))}function e1(e){var t=e.alternate;if(!t){if(null===(t=eZ(e)))throw Error(u(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(n=r.return)){i=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===i)return e0(r),e;if(s===n)return e0(r),t;s=s.sibling}throw Error(u(188))}if(i.return!==n.return)i=r,n=s;else{for(var a=!1,o=r.child;o;){if(o===i){a=!0,i=r,n=s;break}if(o===n){a=!0,n=r,i=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===i){a=!0,i=s,n=r;break}if(o===n){a=!0,n=s,i=r;break}o=o.sibling}if(!a)throw Error(u(189))}}if(i.alternate!==n)throw Error(u(190))}if(3!==i.tag)throw Error(u(188));return i.stateNode.current===i?e:t}function e2(e){return null!==(e=e1(e))?e3(e):null}function e3(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=e3(e);if(null!==t)return t;e=e.sibling}return null}var e4=d.unstable_scheduleCallback,e5=d.unstable_cancelCallback,e6=d.unstable_shouldYield,e8=d.unstable_requestPaint,e9=d.unstable_now,e7=d.unstable_getCurrentPriorityLevel,te=d.unstable_ImmediatePriority,tt=d.unstable_UserBlockingPriority,ti=d.unstable_NormalPriority,tn=d.unstable_LowPriority,tr=d.unstable_IdlePriority,ts=null,ta=null;function to(e){if(ta&&"function"==typeof ta.onCommitFiberRoot)try{ta.onCommitFiberRoot(ts,e,void 0,128==(128&e.current.flags))}catch(e){}}var tl=Math.clz32?Math.clz32:tu,tc=Math.log,td=Math.LN2;function tu(e){return 0==(e>>>=0)?32:31-(tc(e)/td|0)|0}var th=64,tg=4194304;function tp(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 0x1000000:case 0x2000000:case 0x4000000:return 0x7c00000&e;case 0x8000000:return 0x8000000;case 0x10000000:return 0x10000000;case 0x20000000:return 0x20000000;case 0x40000000:return 0x40000000;default:return e}}function tf(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,s=e.pingedLanes,a=0xfffffff&i;if(0!==a){var o=a&~r;0!==o?n=tp(o):0!=(s&=a)&&(n=tp(s))}else 0!=(a=i&~r)?n=tp(a):0!==s&&(n=tp(s));if(0===n)return 0;if(0!==t&&t!==n&&0==(t&r)&&((r=n&-n)>=(s=t&-t)||16===r&&0!=(4194240&s)))return t;if(0!=(4&n)&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-tl(t)),n|=e[i],t&=~r;return n}function tm(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return -1}}function tv(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-tl(s),o=1<<a,l=r[a];-1===l?(0==(o&i)||0!=(o&n))&&(r[a]=tm(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function tS(e){return 0!=(e=-0x40000001&e.pendingLanes)?e:0x40000000&e?0x40000000:0}function ty(){var e=th;return 0==(4194240&(th<<=1))&&(th=64),e}function tC(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function tb(e,t,i){e.pendingLanes|=t,0x20000000!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-tl(t)]=i}function tT(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-tl(i),s=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~s}}function tE(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-tl(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var t_=0;function tI(e){return 1<(e&=-e)?4<e?0!=(0xfffffff&e)?16:0x20000000:4:1}var tw,tP,tR,tA,tM,tD=!1,tO=[],tk=null,tN=null,tx=null,tL=new Map,tF=new Map,tU=[],t$="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tV(e,t){switch(e){case"focusin":case"focusout":tk=null;break;case"dragenter":case"dragleave":tN=null;break;case"mouseover":case"mouseout":tx=null;break;case"pointerover":case"pointerout":tL.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":tF.delete(t.pointerId)}}function tB(e,t,i,n,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},null!==t&&null!==(t=n5(t))&&tP(t)):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r)),e}function tH(e,t,i,n,r){switch(t){case"focusin":return tk=tB(tk,e,t,i,n,r),!0;case"dragenter":return tN=tB(tN,e,t,i,n,r),!0;case"mouseover":return tx=tB(tx,e,t,i,n,r),!0;case"pointerover":var s=r.pointerId;return tL.set(s,tB(tL.get(s)||null,e,t,i,n,r)),!0;case"gotpointercapture":return s=r.pointerId,tF.set(s,tB(tF.get(s)||null,e,t,i,n,r)),!0}return!1}function tj(e){var t=n4(e.target);if(null!==t){var i=eZ(t);if(null!==i){if(13===(t=i.tag)){if(null!==(t=eX(i))){e.blockedOn=t,tM(e.priority,function(){tR(i)});return}}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=3===i.tag?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function tq(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=t1(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=n5(i))&&tP(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);eA=n,i.target.dispatchEvent(n),eA=null,t.shift()}return!0}function tW(e,t,i){tq(e)&&i.delete(t)}function tG(){tD=!1,null!==tk&&tq(tk)&&(tk=null),null!==tN&&tq(tN)&&(tN=null),null!==tx&&tq(tx)&&(tx=null),tL.forEach(tW),tF.forEach(tW)}function tz(e,t){e.blockedOn===t&&(e.blockedOn=null,tD||(tD=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,tG)))}function tJ(e){function t(t){return tz(t,e)}if(0<tO.length){tz(tO[0],e);for(var i=1;i<tO.length;i++){var n=tO[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==tk&&tz(tk,e),null!==tN&&tz(tN,e),null!==tx&&tz(tx,e),tL.forEach(t),tF.forEach(t),i=0;i<tU.length;i++)(n=tU[i]).blockedOn===e&&(n.blockedOn=null);for(;0<tU.length&&null===(i=tU[0]).blockedOn;)tj(i),null===i.blockedOn&&tU.shift()}var tK=A.ReactCurrentBatchConfig,tQ=!0;function tY(e,t,i,n){var r=t_,s=tK.transition;tK.transition=null;try{t_=1,tX(e,t,i,n)}finally{t_=r,tK.transition=s}}function tZ(e,t,i,n){var r=t_,s=tK.transition;tK.transition=null;try{t_=4,tX(e,t,i,n)}finally{t_=r,tK.transition=s}}function tX(e,t,i,n){if(tQ){var r=t1(e,t,i,n);if(null===r)nM(e,t,n,t0,i),tV(e,n);else if(tH(r,e,t,i,n))n.stopPropagation();else if(tV(e,n),4&t&&-1<t$.indexOf(e)){for(;null!==r;){var s=n5(r);if(null!==s&&tw(s),null===(s=t1(e,t,i,n))&&nM(e,t,n,t0,i),s===r)break;r=s}null!==r&&n.stopPropagation()}else nM(e,t,n,null,i)}}var t0=null;function t1(e,t,i,n){if(t0=null,null!==(e=n4(e=eM(n))))if(null===(t=eZ(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=eX(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return t0=e,null}function t2(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(e7()){case te:return 1;case tt:return 4;case ti:case tn:return 16;case tr:return 0x20000000;default:return 16}default:return 16}}var t3=null,t4=null,t5=null;function t6(){if(t5)return t5;var e,t,i=t4,n=i.length,r="value"in t3?t3.value:t3.textContent,s=r.length;for(e=0;e<n&&i[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&i[n-t]===r[s-t];t++);return t5=r.slice(e,1<t?1-t:void 0)}function t8(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function t9(){return!0}function t7(){return!1}function ie(e){function t(t,i,n,r,s){for(var a in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?t9:t7,this.isPropagationStopped=t7,this}return G(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=t9)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=t9)},persist:function(){},isPersistent:t9}),t}var it,ii,ir,is={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ia=ie(is),io=G({},is,{view:0,detail:0}),il=ie(io),ic=G({},io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ib,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ir&&(ir&&"mousemove"===e.type?(it=e.screenX-ir.screenX,ii=e.screenY-ir.screenY):ii=it=0,ir=e),it)},movementY:function(e){return"movementY"in e?e.movementY:ii}}),id=ie(ic),iu=ie(G({},ic,{dataTransfer:0})),ih=ie(G({},io,{relatedTarget:0})),ig=ie(G({},is,{animationName:0,elapsedTime:0,pseudoElement:0})),ip=ie(G({},is,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),im=ie(G({},is,{data:0})),iv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iC(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=iy[e])&&!!t[e]}function ib(){return iC}var iT=ie(G({},io,{key:function(e){if(e.key){var t=iv[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=t8(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?iS[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ib,charCode:function(e){return"keypress"===e.type?t8(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?t8(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),iE=ie(G({},ic,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),i_=ie(G({},io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ib})),iI=ie(G({},is,{propertyName:0,elapsedTime:0,pseudoElement:0})),iw=ie(G({},ic,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),iP=[9,13,27,32],iR=m&&"CompositionEvent"in window,iA=null;m&&"documentMode"in document&&(iA=document.documentMode);var iM=m&&"TextEvent"in window&&!iA,iD=m&&(!iR||iA&&8<iA&&11>=iA),iO=" ",ik=!1;function iN(e,t){switch(e){case"keyup":return -1!==iP.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ix(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var iL=!1;function iF(e,t){switch(e){case"compositionend":return ix(t);case"keypress":if(32!==t.which)return null;return ik=!0,iO;case"textInput":return(e=t.data)===iO&&ik?null:e;default:return null}}function iU(e,t){if(iL)return"compositionend"===e||!iR&&iN(e,t)?(e=t6(),t5=t4=t3=null,iL=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return iD&&"ko"!==t.locale?null:t.data}}var i$={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iV(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!i$[e.type]:"textarea"===t}function iB(e,t,i,n){ex(n),0<(t=nO(t,"onChange")).length&&(i=new ia("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var iH=null,ij=null;function iq(e){n_(e,0)}function iW(e){if(en(n6(e)))return e}function iG(e,t){if("change"===e)return t}var iz=!1;if(m){if(m){var iJ="oninput"in document;if(!iJ){var iK=document.createElement("div");iK.setAttribute("oninput","return;"),iJ="function"==typeof iK.oninput}n=iJ}else n=!1;iz=n&&(!document.documentMode||9<document.documentMode)}function iQ(){iH&&(iH.detachEvent("onpropertychange",iY),ij=iH=null)}function iY(e){if("value"===e.propertyName&&iW(ij)){var t=[];iB(t,ij,e,eM(e)),eV(iq,t)}}function iZ(e,t,i){"focusin"===e?(iQ(),iH=t,ij=i,iH.attachEvent("onpropertychange",iY)):"focusout"===e&&iQ()}function iX(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return iW(ij)}function i0(e,t){if("click"===e)return iW(t)}function i1(e,t){if("input"===e||"change"===e)return iW(t)}function i2(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var i3="function"==typeof Object.is?Object.is:i2;function i4(e,t){if(i3(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!v.call(t,r)||!i3(e[r],t[r]))return!1}return!0}function i5(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function i6(e,t){var i,n=i5(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}n:{for(;n;){if(n.nextSibling){n=n.nextSibling;break n}n=n.parentNode}n=void 0}n=i5(n)}}function i8(e,t){return!!e&&!!t&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?i8(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function i9(e){e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window;for(var t=er(e.document);t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(e){i=!1}if(i)e=t.contentWindow;else break;t=er(e.document)}return t}function i7(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function ne(e,t){var i=i9(t);t=e.focusedElem;var n=e.selectionRange;if(i!==t&&t&&t.ownerDocument&&i8(t.ownerDocument.documentElement,t)){if(null!==n&&i7(t)){if(e=n.start,void 0===(i=n.end)&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if((i=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){i=i.getSelection();var r=t.textContent.length,s=Math.min(n.start,r);n=void 0===n.end?s:Math.min(n.end,r),!i.extend&&s>n&&(r=n,n=s,s=r),r=i6(t,s);var a=i6(t,n);r&&a&&(1!==i.rangeCount||i.anchorNode!==r.node||i.anchorOffset!==r.offset||i.focusNode!==a.node||i.focusOffset!==a.offset)&&((e=e.createRange()).setStart(r.node,r.offset),i.removeAllRanges(),s>n?(i.addRange(e),i.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)1===i.nodeType&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for("function"==typeof t.focus&&t.focus(),t=0;t<e.length;t++)(i=e[t]).element.scrollLeft=i.left,i.element.scrollTop=i.top}}var nt=m&&"documentMode"in document&&11>=document.documentMode,ni=null,nn=null,nr=null,ns=!1;function na(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;ns||null==ni||ni!==er(n)||(n="selectionStart"in(n=ni)&&i7(n)?{start:n.selectionStart,end:n.selectionEnd}:{anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},nr&&i4(nr,n)||(nr=n,0<(n=nO(nn,"onSelect")).length&&(t=new ia("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=ni)))}function no(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var nl={animationend:no("Animation","AnimationEnd"),animationiteration:no("Animation","AnimationIteration"),animationstart:no("Animation","AnimationStart"),transitionend:no("Transition","TransitionEnd")},nc={},nd={};function nu(e){if(nc[e])return nc[e];if(!nl[e])return e;var t,i=nl[e];for(t in i)if(i.hasOwnProperty(t)&&t in nd)return nc[e]=i[t];return e}m&&(nd=document.createElement("div").style,"AnimationEvent"in window||(delete nl.animationend.animation,delete nl.animationiteration.animation,delete nl.animationstart.animation),"TransitionEvent"in window||delete nl.transitionend.transition);var nh=nu("animationend"),ng=nu("animationiteration"),np=nu("animationstart"),nf=nu("transitionend"),nm=new Map,nv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function nS(e,t){nm.set(e,t),p(t,[e])}for(var ny=0;ny<nv.length;ny++){var nC=nv[ny];nS(nC.toLowerCase(),"on"+(nC[0].toUpperCase()+nC.slice(1)))}nS(nh,"onAnimationEnd"),nS(ng,"onAnimationIteration"),nS(np,"onAnimationStart"),nS("dblclick","onDoubleClick"),nS("focusin","onFocus"),nS("focusout","onBlur"),nS(nf,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),p("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),p("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),p("onBeforeInput",["compositionend","keypress","textInput","paste"]),p("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),p("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),p("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nT=new Set("cancel close invalid load scroll toggle".split(" ").concat(nb));function nE(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,eY(n,t,void 0,e),e.currentTarget=null}function n_(e,t){t=0!=(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;n:{var s=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break n;nE(r,o,c),s=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break n;nE(r,o,c),s=l}}}if(ez)throw e=eJ,ez=!1,eJ=null,e}function nI(e,t){var i=t[n1];void 0===i&&(i=t[n1]=new Set);var n=e+"__bubble";i.has(n)||(nA(t,e,2,!1),i.add(n))}function nw(e,t,i){var n=0;t&&(n|=4),nA(i,e,n,t)}var nP="_reactListening"+Math.random().toString(36).slice(2);function nR(e){if(!e[nP]){e[nP]=!0,h.forEach(function(t){"selectionchange"!==t&&(nT.has(t)||nw(t,!1,e),nw(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[nP]||(t[nP]=!0,nw("selectionchange",!1,t))}}function nA(e,t,i,n){switch(t2(t)){case 1:var r=tY;break;case 4:r=tZ;break;default:r=tX}i=r.bind(null,t,i,e),r=void 0,eH&&("touchstart"===t||"touchmove"===t||"wheel"===t)&&(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function nM(e,t,i,n,r){var s=n;if(0==(1&t)&&0==(2&t)&&null!==n)n:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=n4(o)))return;if(5===(l=a.tag)||6===l){n=s=a;continue n}o=o.parentNode}}n=n.return}eV(function(){var n=s,r=eM(i),a=[];n:{var o=nm.get(e);if(void 0!==o){var l=ia,c=e;switch(e){case"keypress":if(0===t8(i))break n;case"keydown":case"keyup":l=iT;break;case"focusin":c="focus",l=ih;break;case"focusout":c="blur",l=ih;break;case"beforeblur":case"afterblur":l=ih;break;case"click":if(2===i.button)break n;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=id;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=iu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=i_;break;case nh:case ng:case np:l=ig;break;case nf:l=iI;break;case"scroll":l=il;break;case"wheel":l=iw;break;case"copy":case"cut":case"paste":l=ip;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=iE}var d=0!=(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var g,p=n;null!==p;){var f=(g=p).stateNode;if(5===g.tag&&null!==f&&(g=f,null!==h&&null!=(f=eB(p,h))&&d.push(nD(p,f,g))),u)break;p=p.return}0<d.length&&(o=new l(o,c,null,i,r),a.push({event:o,listeners:d}))}}if(0==(7&t)){if((o="mouseover"===e||"pointerover"===e,l="mouseout"===e||"pointerout"===e,!(o&&i!==eA&&(c=i.relatedTarget||i.fromElement)&&(n4(c)||c[n0])))&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(c=i.relatedTarget||i.toElement,l=n,null!==(c=c?n4(c):null)&&(u=eZ(c),c!==u||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(d=id,f="onMouseLeave",h="onMouseEnter",p="mouse",("pointerout"===e||"pointerover"===e)&&(d=iE,f="onPointerLeave",h="onPointerEnter",p="pointer"),u=null==l?o:n6(l),g=null==c?o:n6(c),(o=new d(f,p+"leave",l,i,r)).target=u,o.relatedTarget=g,f=null,n4(r)===n&&((d=new d(h,p+"enter",c,i,r)).target=g,d.relatedTarget=u,f=d),u=f,l&&c)r:{for(d=l,h=c,p=0,g=d;g;g=nk(g))p++;for(g=0,f=h;f;f=nk(f))g++;for(;0<p-g;)d=nk(d),p--;for(;0<g-p;)h=nk(h),g--;for(;p--;){if(d===h||null!==h&&d===h.alternate)break r;d=nk(d),h=nk(h)}d=null}else d=null;null!==l&&nN(a,o,l,d,!1),null!==c&&null!==u&&nN(a,u,c,d,!0)}n:{if("select"===(l=(o=n?n6(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m,v=iG;else if(iV(o))if(iz)v=i1;else{v=iX;var S=iZ}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(v=i0);if(v&&(v=v(e,n))){iB(a,v,i,r);break n}S&&S(e,o,n),"focusout"===e&&(S=o._wrapperState)&&S.controlled&&"number"===o.type&&ed(o,"number",o.value)}switch(S=n?n6(n):window,e){case"focusin":(iV(S)||"true"===S.contentEditable)&&(ni=S,nn=n,nr=null);break;case"focusout":nr=nn=ni=null;break;case"mousedown":ns=!0;break;case"contextmenu":case"mouseup":case"dragend":ns=!1,na(a,i,r);break;case"selectionchange":if(nt)break;case"keydown":case"keyup":na(a,i,r)}if(iR)r:{switch(e){case"compositionstart":var y="onCompositionStart";break r;case"compositionend":y="onCompositionEnd";break r;case"compositionupdate":y="onCompositionUpdate";break r}y=void 0}else iL?iN(e,i)&&(y="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(y="onCompositionStart");y&&(iD&&"ko"!==i.locale&&(iL||"onCompositionStart"!==y?"onCompositionEnd"===y&&iL&&(m=t6()):(t4="value"in(t3=r)?t3.value:t3.textContent,iL=!0)),0<(S=nO(n,y)).length&&(y=new im(y,e,null,i,r),a.push({event:y,listeners:S}),m?y.data=m:null!==(m=ix(i))&&(y.data=m))),(m=iM?iF(e,i):iU(e,i))&&0<(n=nO(n,"onBeforeInput")).length&&(r=new im("onBeforeInput","beforeinput",null,i,r),a.push({event:r,listeners:n}),r.data=m)}n_(a,t)})}function nD(e,t,i){return{instance:e,listener:t,currentTarget:i}}function nO(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=eB(e,i))&&n.unshift(nD(e,s,r)),null!=(s=eB(e,t))&&n.push(nD(e,s,r))),e=e.return}return n}function nk(e){if(null===e)return null;do e=e.return;while(e&&5!==e.tag);return e||null}function nN(e,t,i,n,r){for(var s=t._reactName,a=[];null!==i&&i!==n;){var o=i,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=eB(i,s))&&a.unshift(nD(i,l,o)):r||null!=(l=eB(i,s))&&a.push(nD(i,l,o))),i=i.return}0!==a.length&&e.push({event:t,listeners:a})}var nx=/\r\n?/g,nL=/\u0000|\uFFFD/g;function nF(e){return("string"==typeof e?e:""+e).replace(nx,"\n").replace(nL,"")}function nU(e,t,i){if(t=nF(t),nF(e)!==t&&i)throw Error(u(425))}function n$(){}var nV=null,nB=null;function nH(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nj="function"==typeof setTimeout?setTimeout:void 0,nq="function"==typeof clearTimeout?clearTimeout:void 0,nW="function"==typeof Promise?Promise:void 0,nG="function"==typeof queueMicrotask?queueMicrotask:void 0!==nW?function(e){return nW.resolve(null).then(e).catch(nz)}:nj;function nz(e){setTimeout(function(){throw e})}function nJ(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n){e.removeChild(r),tJ(t);return}n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);tJ(t)}function nK(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function nQ(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var nY=Math.random().toString(36).slice(2),nZ="__reactFiber$"+nY,nX="__reactProps$"+nY,n0="__reactContainer$"+nY,n1="__reactEvents$"+nY,n2="__reactListeners$"+nY,n3="__reactHandles$"+nY;function n4(e){var t=e[nZ];if(t)return t;for(var i=e.parentNode;i;){if(t=i[n0]||i[nZ]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=nQ(e);null!==e;){if(i=e[nZ])return i;e=nQ(e)}return t}i=(e=i).parentNode}return null}function n5(e){return(e=e[nZ]||e[n0])&&(5===e.tag||6===e.tag||13===e.tag||3===e.tag)?e:null}function n6(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(u(33))}function n8(e){return e[nX]||null}var n9=[],n7=-1;function re(e){return{current:e}}function rt(e){0>n7||(e.current=n9[n7],n9[n7]=null,n7--)}function ri(e,t){n9[++n7]=e.current,e.current=t}var rn={},rr=re(rn),rs=re(!1),ra=rn;function ro(e,t){var i=e.type.contextTypes;if(!i)return rn;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in i)s[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function rl(e){return null!=(e=e.childContextTypes)}function rc(){rt(rs),rt(rr)}function rd(e,t,i){if(rr.current!==rn)throw Error(u(168));ri(rr,t),ri(rs,i)}function ru(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,"function"!=typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in t))throw Error(u(108,Z(e)||"Unknown",r));return G({},i,n)}function rh(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||rn,ra=rr.current,ri(rr,e),ri(rs,rs.current),!0}function rg(e,t,i){var n=e.stateNode;if(!n)throw Error(u(169));i?(n.__reactInternalMemoizedMergedChildContext=e=ru(e,t,ra),rt(rs),rt(rr),ri(rr,e)):rt(rs),ri(rs,i)}var rp=null,rf=!1,rm=!1;function rv(e){null===rp?rp=[e]:rp.push(e)}function rS(e){rf=!0,rv(e)}function ry(){if(!rm&&null!==rp){rm=!0;var e=0,t=t_;try{var i=rp;for(t_=1;e<i.length;e++){var n=i[e];do n=n(!0);while(null!==n)}rp=null,rf=!1}catch(t){throw null!==rp&&(rp=rp.slice(e+1)),e4(te,ry),t}finally{t_=t,rm=!1}}return null}var rC=[],rb=0,rT=null,rE=0,r_=[],rI=0,rw=null,rP=1,rR="";function rA(e,t){rC[rb++]=rE,rC[rb++]=rT,rT=e,rE=t}function rM(e,t,i){r_[rI++]=rP,r_[rI++]=rR,r_[rI++]=rw,rw=e;var n=rP;e=rR;var r=32-tl(n)-1;n&=~(1<<r),i+=1;var s=32-tl(t)+r;if(30<s){var a=r-r%5;s=(n&(1<<a)-1).toString(32),n>>=a,r-=a,rP=1<<32-tl(t)+r|i<<r|n,rR=s+e}else rP=1<<s|i<<r|n,rR=e}function rD(e){null!==e.return&&(rA(e,1),rM(e,1,0))}function rO(e){for(;e===rT;)rT=rC[--rb],rC[rb]=null,rE=rC[--rb],rC[rb]=null;for(;e===rw;)rw=r_[--rI],r_[rI]=null,rR=r_[--rI],r_[rI]=null,rP=r_[--rI],r_[rI]=null}var rk=null,rN=null,rx=!1,rL=null;function rF(e,t){var i=lT(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function rU(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,rk=e,rN=nK(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,rk=e,rN=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(e.memoizedState={dehydrated:t,treeContext:i=null!==rw?{id:rP,overflow:rR}:null,retryLane:0x40000000},(i=lT(18,null,null,0)).stateNode=t,i.return=e,e.child=i,rk=e,rN=null,!0);default:return!1}}function r$(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function rV(e){if(rx){var t=rN;if(t){var i=t;if(!rU(e,t)){if(r$(e))throw Error(u(418));t=nK(i.nextSibling);var n=rk;t&&rU(e,t)?rF(n,i):(e.flags=-4097&e.flags|2,rx=!1,rk=e)}}else{if(r$(e))throw Error(u(418));e.flags=-4097&e.flags|2,rx=!1,rk=e}}}function rB(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;rk=e}function rH(e){if(e!==rk)return!1;if(!rx)return rB(e),rx=!0,!1;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nH(e.type,e.memoizedProps)),t&&(t=rN)){if(r$(e))throw rj(),Error(u(418));for(;t;)rF(e,t),t=nK(t.nextSibling)}if(rB(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(u(317));n:{for(t=0,e=e.nextSibling;e;){if(8===e.nodeType){var t,i=e.data;if("/$"===i){if(0===t){rN=nK(e.nextSibling);break n}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}rN=null}}else rN=rk?nK(e.stateNode.nextSibling):null;return!0}function rj(){for(var e=rN;e;)e=nK(e.nextSibling)}function rq(){rN=rk=null,rx=!1}function rW(e){null===rL?rL=[e]:rL.push(e)}var rG=A.ReactCurrentBatchConfig;function rz(e,t){if(e&&e.defaultProps)for(var i in t=G({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}var rJ=re(null),rK=null,rQ=null,rY=null;function rZ(){rY=rQ=rK=null}function rX(e){var t=rJ.current;rt(rJ),e._currentValue=t}function r0(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function r1(e,t){rK=e,rY=rQ=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(aM=!0),e.firstContext=null)}function r2(e){var t=e._currentValue;if(rY!==e)if(e={context:e,memoizedValue:t,next:null},null===rQ){if(null===rK)throw Error(u(308));rQ=e,rK.dependencies={lanes:0,firstContext:e}}else rQ=rQ.next=e;return t}var r3=null;function r4(e){null===r3?r3=[e]:r3.push(e)}function r5(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,r4(t)):(i.next=r.next,r.next=i),t.interleaved=i,r6(e,n)}function r6(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var r8=!1;function r9(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function r7(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function se(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function st(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!=(2&oP)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,r6(e,i)}return null===(r=n.interleaved)?(t.next=t,r4(n)):(t.next=r.next,r.next=t),n.interleaved=t,r6(e,i)}function si(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&i))){var n=t.lanes;n&=e.pendingLanes,i|=n,t.lanes=i,tE(e,i)}}function sn(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===s?r=s=a:s=s.next=a,i=i.next}while(null!==i);null===s?r=s=t:s=s.next=t}else r=s=t;i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},e.updateQueue=i;return}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function sr(e,t,i,n){var r=e.updateQueue;r8=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var d=e.alternate;null!==d&&(o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l)}if(null!==s){var u=r.baseState;for(a=0,d=c=l=null,o=s;;){var h=o.lane,g=o.eventTime;if((n&h)===h){null!==d&&(d=d.next={eventTime:g,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});n:{var p=e,f=o;switch(h=t,g=i,f.tag){case 1:if("function"==typeof(p=f.payload)){u=p.call(g,u,h);break n}u=p;break n;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(h="function"==typeof(p=f.payload)?p.call(g,u,h):p))break n;u=G({},u,h);break n;case 2:r8=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[o]:h.push(o))}else g={eventTime:g,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=g,l=u):d=d.next=g,a|=h;if(null===(o=o.next))if(null===(o=r.shared.pending))break;else o=(h=o).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}if(null===d&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do a|=r.lane,r=r.next;while(r!==t)}else null===s&&(r.shared.lanes=0);ox|=a,e.lanes=a,e.memoizedState=u}}function ss(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=i,"function"!=typeof r)throw Error(u(191,r));r.call(n)}}}var sa=(new c.Component).refs;function so(e,t,i,n){i=null==(i=i(n,t=e.memoizedState))?t:G({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var sl={isMounted:function(e){return!!(e=e._reactInternals)&&eZ(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=oX(),r=o0(e),s=se(n,r);s.payload=t,null!=i&&(s.callback=i),null!==(t=st(e,s,r))&&(o1(t,e,r,n),si(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=oX(),r=o0(e),s=se(n,r);s.tag=1,s.payload=t,null!=i&&(s.callback=i),null!==(t=st(e,s,r))&&(o1(t,e,r,n),si(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=oX(),n=o0(e),r=se(i,n);r.tag=2,null!=t&&(r.callback=t),null!==(t=st(e,r,n))&&(o1(t,e,n,i),si(t,e,n))}};function sc(e,t,i,n,r,s,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,a):!t.prototype||!t.prototype.isPureReactComponent||!i4(i,n)||!i4(r,s)}function sd(e,t,i){var n=!1,r=rn,s=t.contextType;return"object"==typeof s&&null!==s?s=r2(s):(r=rl(t)?ra:rr.current,s=(n=null!=(n=t.contextTypes))?ro(e,r):rn),t=new t(i,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=sl,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function su(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&sl.enqueueReplaceState(t,t.state,null)}function sh(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs=sa,r9(e);var s=t.contextType;"object"==typeof s&&null!==s?r.context=r2(s):r.context=ro(e,s=rl(t)?ra:rr.current),r.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(so(e,t,s,i),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&sl.enqueueReplaceState(r,r.state,null),sr(e,i,r,n),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function sg(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(u(309));var n=i.stateNode}if(!n)throw Error(u(147,e));var r=n,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:((t=function(e){var t=r.refs;t===sa&&(t=r.refs={}),null===e?delete t[s]:t[s]=e})._stringRef=s,t)}if("string"!=typeof e)throw Error(u(284));if(!i._owner)throw Error(u(290,e))}return e}function sp(e,t){throw Error(u(31,"[object Object]"===(e=Object.prototype.toString.call(t))?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function sf(e){return(0,e._init)(e._payload)}function sm(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=lI(e,t)).index=0,e.sibling=null,e}function s(t,i,n){return(t.index=n,e)?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function o(e,t,i,n){return null===t||6!==t.tag?(t=lA(i,e.mode,n)).return=e:(t=r(t,i)).return=e,t}function l(e,t,i,n){var s=i.type;return s===O?d(e,t,i.props.children,n,i.key):(null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===B&&sf(s)===t.type)?(n=r(t,i.props)).ref=sg(e,t,i):(n=lw(i.type,i.key,i.props,null,e.mode,n)).ref=sg(e,t,i),n.return=e,n)}function c(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?(t=lM(i,e.mode,n)).return=e:(t=r(t,i.children||[])).return=e,t}function d(e,t,i,n,s){return null===t||7!==t.tag?(t=lP(i,e.mode,n,s)).return=e:(t=r(t,i)).return=e,t}function h(e,t,i){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=lA(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case M:return(i=lw(t.type,t.key,t.props,null,e.mode,i)).ref=sg(e,null,t),i.return=e,i;case D:return(t=lM(t,e.mode,i)).return=e,t;case B:return h(e,(0,t._init)(t._payload),i)}if(eu(t)||q(t))return(t=lP(t,e.mode,i,null)).return=e,t;sp(e,t)}return null}function g(e,t,i,n){var r=null!==t?t.key:null;if("string"==typeof i&&""!==i||"number"==typeof i)return null!==r?null:o(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case M:return i.key===r?l(e,t,i,n):null;case D:return i.key===r?c(e,t,i,n):null;case B:return g(e,t,(r=i._init)(i._payload),n)}if(eu(i)||q(i))return null!==r?null:d(e,t,i,n,null);sp(e,i)}return null}function p(e,t,i,n,r){if("string"==typeof n&&""!==n||"number"==typeof n)return o(t,e=e.get(i)||null,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case M:return l(t,e=e.get(null===n.key?i:n.key)||null,n,r);case D:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case B:return p(e,t,i,(0,n._init)(n._payload),r)}if(eu(n)||q(n))return d(t,e=e.get(i)||null,n,r,null);sp(t,n)}return null}function f(r,a,o,l){for(var c=null,d=null,u=a,f=a=0,m=null;null!==u&&f<o.length;f++){u.index>f?(m=u,u=null):m=u.sibling;var v=g(r,u,o[f],l);if(null===v){null===u&&(u=m);break}e&&u&&null===v.alternate&&t(r,u),a=s(v,a,f),null===d?c=v:d.sibling=v,d=v,u=m}if(f===o.length)return i(r,u),rx&&rA(r,f),c;if(null===u){for(;f<o.length;f++)null!==(u=h(r,o[f],l))&&(a=s(u,a,f),null===d?c=u:d.sibling=u,d=u);return rx&&rA(r,f),c}for(u=n(r,u);f<o.length;f++)null!==(m=p(u,r,f,o[f],l))&&(e&&null!==m.alternate&&u.delete(null===m.key?f:m.key),a=s(m,a,f),null===d?c=m:d.sibling=m,d=m);return e&&u.forEach(function(e){return t(r,e)}),rx&&rA(r,f),c}function m(r,a,o,l){var c=q(o);if("function"!=typeof c)throw Error(u(150));if(null==(o=c.call(o)))throw Error(u(151));for(var d=c=null,f=a,m=a=0,v=null,S=o.next();null!==f&&!S.done;m++,S=o.next()){f.index>m?(v=f,f=null):v=f.sibling;var y=g(r,f,S.value,l);if(null===y){null===f&&(f=v);break}e&&f&&null===y.alternate&&t(r,f),a=s(y,a,m),null===d?c=y:d.sibling=y,d=y,f=v}if(S.done)return i(r,f),rx&&rA(r,m),c;if(null===f){for(;!S.done;m++,S=o.next())null!==(S=h(r,S.value,l))&&(a=s(S,a,m),null===d?c=S:d.sibling=S,d=S);return rx&&rA(r,m),c}for(f=n(r,f);!S.done;m++,S=o.next())null!==(S=p(f,r,m,S.value,l))&&(e&&null!==S.alternate&&f.delete(null===S.key?m:S.key),a=s(S,a,m),null===d?c=S:d.sibling=S,d=S);return e&&f.forEach(function(e){return t(r,e)}),rx&&rA(r,m),c}function v(e,n,s,o){if("object"==typeof s&&null!==s&&s.type===O&&null===s.key&&(s=s.props.children),"object"==typeof s&&null!==s){switch(s.$$typeof){case M:n:{for(var l=s.key,c=n;null!==c;){if(c.key===l){if((l=s.type)===O){if(7===c.tag){i(e,c.sibling),(n=r(c,s.props.children)).return=e,e=n;break n}}else if(c.elementType===l||"object"==typeof l&&null!==l&&l.$$typeof===B&&sf(l)===c.type){i(e,c.sibling),(n=r(c,s.props)).ref=sg(e,c,s),n.return=e,e=n;break n}i(e,c);break}t(e,c),c=c.sibling}s.type===O?((n=lP(s.props.children,e.mode,o,s.key)).return=e,e=n):((o=lw(s.type,s.key,s.props,null,e.mode,o)).ref=sg(e,n,s),o.return=e,e=o)}return a(e);case D:n:{for(c=s.key;null!==n;){if(n.key===c)if(4===n.tag&&n.stateNode.containerInfo===s.containerInfo&&n.stateNode.implementation===s.implementation){i(e,n.sibling),(n=r(n,s.children||[])).return=e,e=n;break n}else{i(e,n);break}t(e,n),n=n.sibling}(n=lM(s,e.mode,o)).return=e,e=n}return a(e);case B:return v(e,n,(c=s._init)(s._payload),o)}if(eu(s))return f(e,n,s,o);if(q(s))return m(e,n,s,o);sp(e,s)}return"string"==typeof s&&""!==s||"number"==typeof s?(s=""+s,null!==n&&6===n.tag?(i(e,n.sibling),(n=r(n,s)).return=e):(i(e,n),(n=lA(s,e.mode,o)).return=e),a(e=n)):i(e,n)}return v}var sv=sm(!0),sS=sm(!1),sy={},sC=re(sy),sb=re(sy),sT=re(sy);function sE(e){if(e===sy)throw Error(u(174));return e}function s_(e,t){switch(ri(sT,t),ri(sb,e),ri(sC,sy),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:eS(null,"");break;default:t=eS(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}rt(sC),ri(sC,t)}function sI(){rt(sC),rt(sb),rt(sT)}function sw(e){sE(sT.current);var t=sE(sC.current),i=eS(t,e.type);t!==i&&(ri(sb,e),ri(sC,i))}function sP(e){sb.current===e&&(rt(sC),rt(sb))}var sR=re(0);function sA(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var sM=[];function sD(){for(var e=0;e<sM.length;e++)sM[e]._workInProgressVersionPrimary=null;sM.length=0}var sO=A.ReactCurrentDispatcher,sk=A.ReactCurrentBatchConfig,sN=0,sx=null,sL=null,sF=null,sU=!1,s$=!1,sV=0,sB=0;function sH(){throw Error(u(321))}function sj(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!i3(e[i],t[i]))return!1;return!0}function sq(e,t,i,n,r,s){if(sN=s,sx=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sO.current=null===e||null===e.memoizedState?av:aS,e=i(n,r),s$){s=0;do{if(s$=!1,sV=0,25<=s)throw Error(u(301));s+=1,sF=sL=null,t.updateQueue=null,sO.current=ay,e=i(n,r)}while(s$)}if(sO.current=am,t=null!==sL&&null!==sL.next,sN=0,sF=sL=sx=null,sU=!1,t)throw Error(u(300));return e}function sW(){var e=0!==sV;return sV=0,e}function sG(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===sF?sx.memoizedState=sF=e:sF=sF.next=e,sF}function sz(){if(null===sL){var e=sx.alternate;e=null!==e?e.memoizedState:null}else e=sL.next;var t=null===sF?sx.memoizedState:sF.next;if(null!==t)sF=t,sL=e;else{if(null===e)throw Error(u(310));e={memoizedState:(sL=e).memoizedState,baseState:sL.baseState,baseQueue:sL.baseQueue,queue:sL.queue,next:null},null===sF?sx.memoizedState=sF=e:sF=sF.next=e}return sF}function sJ(e,t){return"function"==typeof t?t(e):t}function sK(e){var t=sz(),i=t.queue;if(null===i)throw Error(u(311));i.lastRenderedReducer=e;var n=sL,r=n.baseQueue,s=i.pending;if(null!==s){if(null!==r){var a=r.next;r.next=s.next,s.next=a}n.baseQueue=r=s,i.pending=null}if(null!==r){s=r.next,n=n.baseState;var o=a=null,l=null,c=s;do{var d=c.lane;if((sN&d)===d)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:e(n,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(o=l=h,a=n):l=l.next=h,sx.lanes|=d,ox|=d}c=c.next}while(null!==c&&c!==s);null===l?a=n:l.next=o,i3(n,t.memoizedState)||(aM=!0),t.memoizedState=n,t.baseState=a,t.baseQueue=l,i.lastRenderedState=n}if(null!==(e=i.interleaved)){r=e;do s=r.lane,sx.lanes|=s,ox|=s,r=r.next;while(r!==e)}else null===r&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function sQ(e){var t=sz(),i=t.queue;if(null===i)throw Error(u(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,s=t.memoizedState;if(null!==r){i.pending=null;var a=r=r.next;do s=e(s,a.action),a=a.next;while(a!==r);i3(s,t.memoizedState)||(aM=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),i.lastRenderedState=s}return[s,n]}function sY(){}function sZ(e,t){var i=sx,n=sz(),r=t(),s=!i3(n.memoizedState,r);if(s&&(n.memoizedState=r,aM=!0),n=n.queue,ae(s1.bind(null,i,n,e),[e]),n.getSnapshot!==t||s||null!==sF&&1&sF.memoizedState.tag){if(i.flags|=2048,s5(9,s0.bind(null,i,n,r,t),void 0,null),null===oR)throw Error(u(349));0!=(30&sN)||sX(i,t,r)}return r}function sX(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=sx.updateQueue)?(t={lastEffect:null,stores:null},sx.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function s0(e,t,i,n){t.value=i,t.getSnapshot=n,s2(t)&&s3(e)}function s1(e,t,i){return i(function(){s2(t)&&s3(e)})}function s2(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!i3(e,i)}catch(e){return!0}}function s3(e){var t=r6(e,1);null!==t&&o1(t,e,1,-1)}function s4(e){var t=sG();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,t.queue=e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sJ,lastRenderedState:e},e=e.dispatch=ah.bind(null,sx,e),[t.memoizedState,e]}function s5(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=sx.updateQueue)?(t={lastEffect:null,stores:null},sx.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function s6(){return sz().memoizedState}function s8(e,t,i,n){var r=sG();sx.flags|=e,r.memoizedState=s5(1|t,i,void 0,void 0===n?null:n)}function s9(e,t,i,n){var r=sz();n=void 0===n?null:n;var s=void 0;if(null!==sL){var a=sL.memoizedState;if(s=a.destroy,null!==n&&sj(n,a.deps)){r.memoizedState=s5(t,i,s,n);return}}sx.flags|=e,r.memoizedState=s5(1|t,i,s,n)}function s7(e,t){return s8(8390656,8,e,t)}function ae(e,t){return s9(2048,8,e,t)}function at(e,t){return s9(4,2,e,t)}function ai(e,t){return s9(4,4,e,t)}function an(e,t){return"function"==typeof t?(t(e=e()),function(){t(null)}):null!=t?(t.current=e=e(),function(){t.current=null}):void 0}function ar(e,t,i){return i=null!=i?i.concat([e]):null,s9(4,4,an.bind(null,t,e),i)}function as(){}function aa(e,t){var i=sz();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&sj(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function ao(e,t){var i=sz();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&sj(t,n[1])?n[0]:(i.memoizedState=[e=e(),t],e)}function al(e,t,i){return 0==(21&sN)?(e.baseState&&(e.baseState=!1,aM=!0),e.memoizedState=i):(i3(i,t)||(i=ty(),sx.lanes|=i,ox|=i,e.baseState=!0),t)}function ac(e,t){var i=t_;t_=0!==i&&4>i?i:4,e(!0);var n=sk.transition;sk.transition={};try{e(!1),t()}finally{t_=i,sk.transition=n}}function ad(){return sz().memoizedState}function au(e,t,i){var n=o0(e);i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},ag(e)?ap(t,i):null!==(i=r5(e,t,i,n))&&(o1(i,e,n,oX()),af(i,t,n))}function ah(e,t,i){var n=o0(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(ag(e))ap(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,i);if(r.hasEagerState=!0,r.eagerState=o,i3(o,a)){var l=t.interleaved;null===l?(r.next=r,r4(t)):(r.next=l.next,l.next=r),t.interleaved=r;return}}catch(e){}finally{}null!==(i=r5(e,t,r,n))&&(o1(i,e,n,r=oX()),af(i,t,n))}}function ag(e){var t=e.alternate;return e===sx||null!==t&&t===sx}function ap(e,t){s$=sU=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function af(e,t,i){if(0!=(4194240&i)){var n=t.lanes;n&=e.pendingLanes,t.lanes=i|=n,tE(e,i)}}var am={readContext:r2,useCallback:sH,useContext:sH,useEffect:sH,useImperativeHandle:sH,useInsertionEffect:sH,useLayoutEffect:sH,useMemo:sH,useReducer:sH,useRef:sH,useState:sH,useDebugValue:sH,useDeferredValue:sH,useTransition:sH,useMutableSource:sH,useSyncExternalStore:sH,useId:sH,unstable_isNewReconciler:!1},av={readContext:r2,useCallback:function(e,t){return sG().memoizedState=[e,void 0===t?null:t],e},useContext:r2,useEffect:s7,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,s8(4194308,4,an.bind(null,t,e),i)},useLayoutEffect:function(e,t){return s8(4194308,4,e,t)},useInsertionEffect:function(e,t){return s8(4,2,e,t)},useMemo:function(e,t){return t=void 0===t?null:t,sG().memoizedState=[e=e(),t],e},useReducer:function(e,t,i){var n=sG();return n.memoizedState=n.baseState=t=void 0!==i?i(t):t,n.queue=e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},e=e.dispatch=au.bind(null,sx,e),[n.memoizedState,e]},useRef:function(e){return sG().memoizedState=e={current:e}},useState:s4,useDebugValue:as,useDeferredValue:function(e){return sG().memoizedState=e},useTransition:function(){var e=s4(!1),t=e[0];return e=ac.bind(null,e[1]),sG().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=sx,r=sG();if(rx){if(void 0===i)throw Error(u(407));i=i()}else{if(i=t(),null===oR)throw Error(u(349));0!=(30&sN)||sX(n,t,i)}r.memoizedState=i;var s={value:i,getSnapshot:t};return r.queue=s,s7(s1.bind(null,n,s,e),[e]),n.flags|=2048,s5(9,s0.bind(null,n,s,i,t),void 0,null),i},useId:function(){var e=sG(),t=oR.identifierPrefix;if(rx){var i=rR,n=rP;t=":"+t+"R"+(i=(n&~(1<<32-tl(n)-1)).toString(32)+i),0<(i=sV++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=sB++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},aS={readContext:r2,useCallback:aa,useContext:r2,useEffect:ae,useImperativeHandle:ar,useInsertionEffect:at,useLayoutEffect:ai,useMemo:ao,useReducer:sK,useRef:s6,useState:function(){return sK(sJ)},useDebugValue:as,useDeferredValue:function(e){return al(sz(),sL.memoizedState,e)},useTransition:function(){return[sK(sJ)[0],sz().memoizedState]},useMutableSource:sY,useSyncExternalStore:sZ,useId:ad,unstable_isNewReconciler:!1},ay={readContext:r2,useCallback:aa,useContext:r2,useEffect:ae,useImperativeHandle:ar,useInsertionEffect:at,useLayoutEffect:ai,useMemo:ao,useReducer:sQ,useRef:s6,useState:function(){return sQ(sJ)},useDebugValue:as,useDeferredValue:function(e){var t=sz();return null===sL?t.memoizedState=e:al(t,sL.memoizedState,e)},useTransition:function(){return[sQ(sJ)[0],sz().memoizedState]},useMutableSource:sY,useSyncExternalStore:sZ,useId:ad,unstable_isNewReconciler:!1};function aC(e,t){try{var i="",n=t;do i+=Q(n),n=n.return;while(n);var r=i}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:r,digest:null}}function ab(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function aT(e,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var aE="function"==typeof WeakMap?WeakMap:Map;function a_(e,t,i){(i=se(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){oj||(oj=!0,oq=n),aT(e,t)},i}function aI(e,t,i){(i=se(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){aT(e,t)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(i.callback=function(){aT(e,t),"function"!=typeof n&&(null===oW?oW=new Set([this]):oW.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:null!==i?i:""})}),i}function aw(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new aE;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=lm.bind(null,e,t,i),t.then(e,e))}function aP(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function aR(e,t,i,n,r){return 0==(1&e.mode)?e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=se(-1,1)).tag=2,st(i,t,1))),i.lanes|=1):(e.flags|=65536,e.lanes=r),e}var aA=A.ReactCurrentOwner,aM=!1;function aD(e,t,i,n){t.child=null===e?sS(t,null,i,n):sv(t,e.child,i,n)}function aO(e,t,i,n,r){i=i.render;var s=t.ref;return(r1(t,r),n=sq(e,t,i,n,s,r),i=sW(),null===e||aM)?(rx&&i&&rD(t),t.flags|=1,aD(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,aZ(e,t,r))}function ak(e,t,i,n,r){if(null===e){var s=i.type;return"function"!=typeof s||lE(s)||void 0!==s.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=lw(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,aN(e,t,s,n,r))}if(s=e.child,0==(e.lanes&r)){var a=s.memoizedProps;if((i=null!==(i=i.compare)?i:i4)(a,n)&&e.ref===t.ref)return aZ(e,t,r)}return t.flags|=1,(e=lI(s,n)).ref=t.ref,e.return=t,t.child=e}function aN(e,t,i,n,r){if(null!==e){var s=e.memoizedProps;if(i4(s,n)&&e.ref===t.ref)if(aM=!1,t.pendingProps=n=s,0==(e.lanes&r))return t.lanes=e.lanes,aZ(e,t,r);else 0!=(131072&e.flags)&&(aM=!0)}return aF(e,t,i,n,r)}function ax(e,t,i){var n=t.pendingProps,r=n.children,s=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ri(oO,oD),oD|=i;else{if(0==(0x40000000&i))return e=null!==s?s.baseLanes|i:i,t.lanes=t.childLanes=0x40000000,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ri(oO,oD),oD|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:i,ri(oO,oD),oD|=n}else null!==s?(n=s.baseLanes|i,t.memoizedState=null):n=i,ri(oO,oD),oD|=n;return aD(e,t,r,i),t.child}function aL(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function aF(e,t,i,n,r){var s=rl(i)?ra:rr.current;return(s=ro(t,s),r1(t,r),i=sq(e,t,i,n,s,r),n=sW(),null===e||aM)?(rx&&n&&rD(t),t.flags|=1,aD(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,aZ(e,t,r))}function aU(e,t,i,n,r){if(rl(i)){var s=!0;rh(t)}else s=!1;if(r1(t,r),null===t.stateNode)aY(e,t),sd(t,i,n),sh(t,i,n,r),n=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;c="object"==typeof c&&null!==c?r2(c):ro(t,c=rl(i)?ra:rr.current);var d=i.getDerivedStateFromProps,u="function"==typeof d||"function"==typeof a.getSnapshotBeforeUpdate;u||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==n||l!==c)&&su(t,a,n,c),r8=!1;var h=t.memoizedState;a.state=h,sr(t,n,a,r),l=t.memoizedState,o!==n||h!==l||rs.current||r8?("function"==typeof d&&(so(t,i,d,n),l=t.memoizedState),(o=r8||sc(t,i,o,n,h,l,c))?(u||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=o):("function"==typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,r7(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:rz(t.type,o),a.props=c,u=t.pendingProps,h=a.context,l="object"==typeof(l=i.contextType)&&null!==l?r2(l):ro(t,l=rl(i)?ra:rr.current);var g=i.getDerivedStateFromProps;(d="function"==typeof g||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==u||h!==l)&&su(t,a,n,l),r8=!1,h=t.memoizedState,a.state=h,sr(t,n,a,r);var p=t.memoizedState;o!==u||h!==p||rs.current||r8?("function"==typeof g&&(so(t,i,g,n),p=t.memoizedState),(c=r8||sc(t,i,c,n,h,p,l)||!1)?(d||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(n,p,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,p,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=p),a.props=n,a.state=p,a.context=l,n=c):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return a$(e,t,i,n,s,r)}function a$(e,t,i,n,r,s){aL(e,t);var a=0!=(128&t.flags);if(!n&&!a)return r&&rg(t,i,!1),aZ(e,t,s);n=t.stateNode,aA.current=t;var o=a&&"function"!=typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=sv(t,e.child,null,s),t.child=sv(t,null,o,s)):aD(e,t,o,s),t.memoizedState=n.state,r&&rg(t,i,!0),t.child}function aV(e){var t=e.stateNode;t.pendingContext?rd(e,t.pendingContext,t.pendingContext!==t.context):t.context&&rd(e,t.context,!1),s_(e,t.containerInfo)}function aB(e,t,i,n,r){return rq(),rW(r),t.flags|=256,aD(e,t,i,n),t.child}var aH={dehydrated:null,treeContext:null,retryLane:0};function aj(e){return{baseLanes:e,cachePool:null,transitions:null}}function aq(e,t,i){var n,r=t.pendingProps,s=sR.current,a=!1,o=0!=(128&t.flags);if((n=o)||(n=(null===e||null!==e.memoizedState)&&0!=(2&s)),n?(a=!0,t.flags&=-129):(null===e||null!==e.memoizedState)&&(s|=1),ri(sR,1&s),null===e)return(rV(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated))?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=0x40000000,null):(o=r.children,e=r.fallback,a?(r=t.mode,a=t.child,o={mode:"hidden",children:o},0==(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=o):a=lR(o,r,0,null),e=lP(e,r,i,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=aj(i),t.memoizedState=aH,e):aW(t,o));if(null!==(s=e.memoizedState)&&null!==(n=s.dehydrated))return az(e,t,o,r,n,s,i);if(a){a=r.fallback,o=t.mode,n=(s=e.child).sibling;var l={mode:"hidden",children:r.children};return 0==(1&o)&&t.child!==s?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=lI(s,l)).subtreeFlags=0xe00000&s.subtreeFlags,null!==n?a=lI(n,a):(a=lP(a,o,i,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,o=null===(o=e.child.memoizedState)?aj(i):{baseLanes:o.baseLanes|i,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~i,t.memoizedState=aH,r}return e=(a=e.child).sibling,r=lI(a,{mode:"visible",children:r.children}),0==(1&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function aW(e,t){return(t=lR({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function aG(e,t,i,n){return null!==n&&rW(n),sv(t,e.child,null,i),e=aW(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function az(e,t,i,n,r,s,a){if(i)return 256&t.flags?(t.flags&=-257,aG(e,t,a,n=ab(Error(u(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=n.fallback,r=t.mode,n=lR({mode:"visible",children:n.children},r,0,null),s=lP(s,r,a,null),s.flags|=2,n.return=t,s.return=t,n.sibling=s,t.child=n,0!=(1&t.mode)&&sv(t,e.child,null,a),t.child.memoizedState=aj(a),t.memoizedState=aH,s);if(0==(1&t.mode))return aG(e,t,a,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var o=n.dgst;return n=o,aG(e,t,a,n=ab(s=Error(u(419)),n,void 0))}if(o=0!=(a&e.childLanes),aM||o){if(null!==(n=oR)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 0x1000000:case 0x2000000:case 0x4000000:r=32;break;case 0x20000000:r=0x10000000;break;default:r=0}0!==(r=0!=(r&(n.suspendedLanes|a))?0:r)&&r!==s.retryLane&&(s.retryLane=r,r6(e,r),o1(n,e,r,-1))}return ls(),aG(e,t,a,n=ab(Error(u(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=lS.bind(null,e),r._reactRetry=t,null):(e=s.treeContext,rN=nK(r.nextSibling),rk=t,rx=!0,rL=null,null!==e&&(r_[rI++]=rP,r_[rI++]=rR,r_[rI++]=rw,rP=e.id,rR=e.overflow,rw=t),t=aW(t,n.children),t.flags|=4096,t)}function aJ(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),r0(e.return,t,i)}function aK(e,t,i,n,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=i,s.tailMode=r)}function aQ(e,t,i){var n=t.pendingProps,r=n.revealOrder,s=n.tail;if(aD(e,t,n.children,i),0!=(2&(n=sR.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))n:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&aJ(e,i,t);else if(19===e.tag)aJ(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)break n;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ri(sR,n),0==(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(r=null,i=t.child;null!==i;)null!==(e=i.alternate)&&null===sA(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),aK(t,!1,r,i,s);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===sA(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}aK(t,!0,i,null,s);break;case"together":aK(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function aY(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function aZ(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),ox|=t.lanes,0==(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(u(153));if(null!==t.child){for(i=lI(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=lI(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function aX(e,t,i){switch(t.tag){case 3:aV(t),rq();break;case 5:sw(t);break;case 1:rl(t.type)&&rh(t);break;case 4:s_(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;ri(rJ,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState)){if(null!==n.dehydrated)return ri(sR,1&sR.current),t.flags|=128,null;if(0!=(i&t.child.childLanes))return aq(e,t,i);return ri(sR,1&sR.current),null!==(e=aZ(e,t,i))?e.sibling:null}ri(sR,1&sR.current);break;case 19:if(n=0!=(i&t.childLanes),0!=(128&e.flags)){if(n)return aQ(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),ri(sR,sR.current),!n)return null;break;case 22:case 23:return t.lanes=0,ax(e,t,i)}return aZ(e,t,i)}function a0(e,t){if(!rx)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function a1(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=0xe00000&r.subtreeFlags,n|=0xe00000&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function a2(e,t,i){var n=t.pendingProps;switch(rO(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return a1(t),null;case 1:case 17:return rl(t.type)&&rc(),a1(t),null;case 3:return n=t.stateNode,sI(),rt(rs),rt(rr),sD(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(null===e||null===e.child)&&(rH(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==rL&&(o5(rL),rL=null))),s(e,t),a1(t),null;case 5:sP(t);var l=sE(sT.current);if(i=t.type,null!==e&&null!=t.stateNode)a(e,t,i,n,l),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(u(166));return a1(t),null}if(e=sE(sC.current),rH(t)){n=t.stateNode,i=t.type;var c=t.memoizedProps;switch(n[nZ]=t,n[nX]=c,e=0!=(1&t.mode),i){case"dialog":nI("cancel",n),nI("close",n);break;case"iframe":case"object":case"embed":nI("load",n);break;case"video":case"audio":for(l=0;l<nb.length;l++)nI(nb[l],n);break;case"source":nI("error",n);break;case"img":case"image":case"link":nI("error",n),nI("load",n);break;case"details":nI("toggle",n);break;case"input":ea(n,c),nI("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!c.multiple},nI("invalid",n);break;case"textarea":ep(n,c),nI("invalid",n)}for(var d in eP(i,c),l=null,c)if(c.hasOwnProperty(d)){var h=c[d];"children"===d?"string"==typeof h?n.textContent!==h&&(!0!==c.suppressHydrationWarning&&nU(n.textContent,h,e),l=["children",h]):"number"==typeof h&&n.textContent!==""+h&&(!0!==c.suppressHydrationWarning&&nU(n.textContent,h,e),l=["children",""+h]):g.hasOwnProperty(d)&&null!=h&&"onScroll"===d&&nI("scroll",n)}switch(i){case"input":ei(n),ec(n,c,!0);break;case"textarea":ei(n),em(n);break;case"select":case"option":break;default:"function"==typeof c.onClick&&(n.onclick=n$)}n=l,t.updateQueue=n,null!==n&&(t.flags|=4)}else{d=9===l.nodeType?l:l.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ev(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=d.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof n.is?e=d.createElement(i,{is:n.is}):(e=d.createElement(i),"select"===i&&(d=e,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):e=d.createElementNS(e,i),e[nZ]=t,e[nX]=n,r(e,t,!1,!1),t.stateNode=e;n:{switch(d=eR(i,n),i){case"dialog":nI("cancel",e),nI("close",e),l=n;break;case"iframe":case"object":case"embed":nI("load",e),l=n;break;case"video":case"audio":for(l=0;l<nb.length;l++)nI(nb[l],e);l=n;break;case"source":nI("error",e),l=n;break;case"img":case"image":case"link":nI("error",e),nI("load",e),l=n;break;case"details":nI("toggle",e),l=n;break;case"input":ea(e,n),l=es(e,n),nI("invalid",e);break;case"option":default:l=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},l=G({},n,{value:void 0}),nI("invalid",e);break;case"textarea":ep(e,n),l=eg(e,n),nI("invalid",e)}for(c in eP(i,l),h=l)if(h.hasOwnProperty(c)){var p=h[c];"style"===c?eI(e,p):"dangerouslySetInnerHTML"===c?null!=(p=p?p.__html:void 0)&&eC(e,p):"children"===c?"string"==typeof p?("textarea"!==i||""!==p)&&eb(e,p):"number"==typeof p&&eb(e,""+p):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(g.hasOwnProperty(c)?null!=p&&"onScroll"===c&&nI("scroll",e):null!=p&&R(e,c,p,d))}switch(i){case"input":ei(e),ec(e,n,!1);break;case"textarea":ei(e),em(e);break;case"option":null!=n.value&&e.setAttribute("value",""+X(n.value));break;case"select":e.multiple=!!n.multiple,null!=(c=n.value)?eh(e,!!n.multiple,c,!1):null!=n.defaultValue&&eh(e,!!n.multiple,n.defaultValue,!0);break;default:"function"==typeof l.onClick&&(e.onclick=n$)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break n;case"img":n=!0;break n;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return a1(t),null;case 6:if(e&&null!=t.stateNode)o(e,t,e.memoizedProps,n);else{if("string"!=typeof n&&null===t.stateNode)throw Error(u(166));if(i=sE(sT.current),sE(sC.current),rH(t)){if(n=t.stateNode,i=t.memoizedProps,n[nZ]=t,(c=n.nodeValue!==i)&&null!==(e=rk))switch(e.tag){case 3:nU(n.nodeValue,i,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&nU(n.nodeValue,i,0!=(1&e.mode))}c&&(t.flags|=4)}else(n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[nZ]=t,t.stateNode=n}return a1(t),null;case 13:if(rt(sR),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rx&&null!==rN&&0!=(1&t.mode)&&0==(128&t.flags))rj(),rq(),t.flags|=98560,c=!1;else if(c=rH(t),null!==n&&null!==n.dehydrated){if(null===e){if(!c)throw Error(u(318));if(!(c=null!==(c=t.memoizedState)?c.dehydrated:null))throw Error(u(317));c[nZ]=t}else rq(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;a1(t),c=!1}else null!==rL&&(o5(rL),rL=null),c=!0;if(!c)return 65536&t.flags?t:null}if(0!=(128&t.flags))return t.lanes=i,t;return(n=null!==n)!=(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!=(1&t.mode)&&(null===e||0!=(1&sR.current)?0===ok&&(ok=3):ls())),null!==t.updateQueue&&(t.flags|=4),a1(t),null;case 4:return sI(),s(e,t),null===e&&nR(t.stateNode.containerInfo),a1(t),null;case 10:return rX(t.type._context),a1(t),null;case 19:if(rt(sR),null===(c=t.memoizedState))return a1(t),null;if(n=0!=(128&t.flags),null===(d=c.rendering))if(n)a0(c,!1);else{if(0!==ok||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(d=sA(e))){for(t.flags|=128,a0(c,!1),null!==(n=d.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;null!==i;)c=i,e=n,c.flags&=0xe00002,null===(d=c.alternate)?(c.childLanes=0,c.lanes=e,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,e=d.dependencies,c.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return ri(sR,1&sR.current|2),t.child}e=e.sibling}null!==c.tail&&e9()>oB&&(t.flags|=128,n=!0,a0(c,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=sA(d))){if(t.flags|=128,n=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),a0(c,!0),null===c.tail&&"hidden"===c.tailMode&&!d.alternate&&!rx)return a1(t),null}else 2*e9()-c.renderingStartTime>oB&&0x40000000!==i&&(t.flags|=128,n=!0,a0(c,!1),t.lanes=4194304);c.isBackwards?(d.sibling=t.child,t.child=d):(null!==(i=c.last)?i.sibling=d:t.child=d,c.last=d)}if(null!==c.tail)return t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=e9(),t.sibling=null,i=sR.current,ri(sR,n?1&i|2:1&i),t;return a1(t),null;case 22:case 23:return lt(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!=(1&t.mode)?0!=(0x40000000&oD)&&(a1(t),6&t.subtreeFlags&&(t.flags|=8192)):a1(t),null;case 24:case 25:return null}throw Error(u(156,t.tag))}function a3(e,t){switch(rO(t),t.tag){case 1:return rl(t.type)&&rc(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return sI(),rt(rs),rt(rr),sD(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return sP(t),null;case 13:if(rt(sR),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(u(340));rq()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return rt(sR),null;case 4:return sI(),null;case 10:return rX(t.type._context),null;case 22:case 23:return lt(),null;default:return null}}r=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},s=function(){},a=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,sE(sC.current);var s,a=null;switch(i){case"input":r=es(e,r),n=es(e,n),a=[];break;case"select":r=G({},r,{value:void 0}),n=G({},n,{value:void 0}),a=[];break;case"textarea":r=eg(e,r),n=eg(e,n),a=[];break;default:"function"!=typeof r.onClick&&"function"==typeof n.onClick&&(e.onclick=n$)}for(c in eP(i,n),i=null,r)if(!n.hasOwnProperty(c)&&r.hasOwnProperty(c)&&null!=r[c])if("style"===c){var o=r[c];for(s in o)o.hasOwnProperty(s)&&(i||(i={}),i[s]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(g.hasOwnProperty(c)?a||(a=[]):(a=a||[]).push(c,null));for(c in n){var l=n[c];if(o=null!=r?r[c]:void 0,n.hasOwnProperty(c)&&l!==o&&(null!=l||null!=o))if("style"===c)if(o){for(s in o)!o.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(i||(i={}),i[s]="");for(s in l)l.hasOwnProperty(s)&&o[s]!==l[s]&&(i||(i={}),i[s]=l[s])}else i||(a||(a=[]),a.push(c,i)),i=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,o=o?o.__html:void 0,null!=l&&o!==l&&(a=a||[]).push(c,l)):"children"===c?"string"!=typeof l&&"number"!=typeof l||(a=a||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(g.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&nI("scroll",e),a||o===l||(a=[])):(a=a||[]).push(c,l))}i&&(a=a||[]).push("style",i);var c=a;(t.updateQueue=c)&&(t.flags|=4)}},o=function(e,t,i,n){i!==n&&(t.flags|=4)};var a4=!1,a5=!1,a6="function"==typeof WeakSet?WeakSet:Set,a8=null;function a9(e,t){var i=e.ref;if(null!==i)if("function"==typeof i)try{i(null)}catch(i){lf(e,t,i)}else i.current=null}function a7(e,t,i){try{i()}catch(i){lf(e,t,i)}}var oe=!1;function ot(e,t){if(e=e.containerInfo,nV=tQ,i7(e=i9(e))){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else n:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r,s=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{i.nodeType,a.nodeType}catch(e){i=null;break n}var o=0,l=-1,c=-1,d=0,h=0,g=e,p=null;r:for(;;){for(;g!==i||0!==s&&3!==g.nodeType||(l=o+s),g!==a||0!==n&&3!==g.nodeType||(c=o+n),3===g.nodeType&&(o+=g.nodeValue.length),null!==(r=g.firstChild);)p=g,g=r;for(;;){if(g===e)break r;if(p===i&&++d===s&&(l=o),p===a&&++h===n&&(c=o),null!==(r=g.nextSibling))break;p=(g=p).parentNode}g=r}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(nB={focusedElem:e,selectionRange:i},tQ=!1,a8=t;null!==a8;)if(e=(t=a8).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,a8=e;else for(;null!==a8;){t=a8;try{var f=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var m=f.memoizedProps,v=f.memoizedState,S=t.stateNode,y=S.getSnapshotBeforeUpdate(t.elementType===t.type?m:rz(t.type,m),v);S.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var C=t.stateNode.containerInfo;1===C.nodeType?C.textContent="":9===C.nodeType&&C.documentElement&&C.removeChild(C.documentElement);break;default:throw Error(u(163))}}catch(e){lf(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,a8=e;break}a8=t.return}return f=oe,oe=!1,f}function oi(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&a7(t,i,s)}r=r.next}while(r!==n)}}function on(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function or(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"==typeof t?t(e):t.current=e}}function os(e){var t=e.alternate;null!==t&&(e.alternate=null,os(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[nZ],delete t[nX],delete t[n1],delete t[n2],delete t[n3]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oa(e){return 5===e.tag||3===e.tag||4===e.tag}function oo(e){n:for(;;){for(;null===e.sibling;){if(null===e.return||oa(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags||null===e.child||4===e.tag)continue n;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ol(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!=(i=i._reactRootContainer)||null!==t.onclick||(t.onclick=n$));else if(4!==n&&null!==(e=e.child))for(ol(e,t,i),e=e.sibling;null!==e;)ol(e,t,i),e=e.sibling}function oc(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(oc(e,t,i),e=e.sibling;null!==e;)oc(e,t,i),e=e.sibling}var od=null,ou=!1;function oh(e,t,i){for(i=i.child;null!==i;)og(e,t,i),i=i.sibling}function og(e,t,i){if(ta&&"function"==typeof ta.onCommitFiberUnmount)try{ta.onCommitFiberUnmount(ts,i)}catch(e){}switch(i.tag){case 5:a5||a9(i,t);case 6:var n=od,r=ou;od=null,oh(e,t,i),od=n,ou=r,null!==od&&(ou?(e=od,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):od.removeChild(i.stateNode));break;case 18:null!==od&&(ou?(e=od,i=i.stateNode,8===e.nodeType?nJ(e.parentNode,i):1===e.nodeType&&nJ(e,i),tJ(e)):nJ(od,i.stateNode));break;case 4:n=od,r=ou,od=i.stateNode.containerInfo,ou=!0,oh(e,t,i),od=n,ou=r;break;case 0:case 11:case 14:case 15:if(!a5&&null!==(n=i.updateQueue)&&null!==(n=n.lastEffect)){r=n=n.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(0!=(2&s)?a7(i,t,a):0!=(4&s)&&a7(i,t,a)),r=r.next}while(r!==n)}oh(e,t,i);break;case 1:if(!a5&&(a9(i,t),"function"==typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(e){lf(i,t,e)}oh(e,t,i);break;case 21:default:oh(e,t,i);break;case 22:1&i.mode?(a5=(n=a5)||null!==i.memoizedState,oh(e,t,i),a5=n):oh(e,t,i)}}function op(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new a6),t.forEach(function(t){var n=ly.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))})}}function of(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n];try{var s=e,a=t,o=a;n:for(;null!==o;){switch(o.tag){case 5:od=o.stateNode,ou=!1;break n;case 3:case 4:od=o.stateNode.containerInfo,ou=!0;break n}o=o.return}if(null===od)throw Error(u(160));og(s,a,r),od=null,ou=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(e){lf(r,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)om(t,e),t=t.sibling}function om(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(of(t,e),ov(e),4&n){try{oi(3,e,e.return),on(3,e)}catch(t){lf(e,e.return,t)}try{oi(5,e,e.return)}catch(t){lf(e,e.return,t)}}break;case 1:of(t,e),ov(e),512&n&&null!==i&&a9(i,i.return);break;case 5:if(of(t,e),ov(e),512&n&&null!==i&&a9(i,i.return),32&e.flags){var r=e.stateNode;try{eb(r,"")}catch(t){lf(e,e.return,t)}}if(4&n&&null!=(r=e.stateNode)){var s=e.memoizedProps,a=null!==i?i.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===o&&"radio"===s.type&&null!=s.name&&eo(r,s),eR(o,a);var c=eR(o,s);for(a=0;a<l.length;a+=2){var d=l[a],h=l[a+1];"style"===d?eI(r,h):"dangerouslySetInnerHTML"===d?eC(r,h):"children"===d?eb(r,h):R(r,d,h,c)}switch(o){case"input":el(r,s);break;case"textarea":ef(r,s);break;case"select":var g=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;null!=p?eh(r,!!s.multiple,p,!1):!!s.multiple!==g&&(null!=s.defaultValue?eh(r,!!s.multiple,s.defaultValue,!0):eh(r,!!s.multiple,s.multiple?[]:"",!1))}r[nX]=s}catch(t){lf(e,e.return,t)}}break;case 6:if(of(t,e),ov(e),4&n){if(null===e.stateNode)throw Error(u(162));r=e.stateNode,s=e.memoizedProps;try{r.nodeValue=s}catch(t){lf(e,e.return,t)}}break;case 3:if(of(t,e),ov(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{tJ(t.containerInfo)}catch(t){lf(e,e.return,t)}break;case 4:default:of(t,e),ov(e);break;case 13:of(t,e),ov(e),8192&(r=e.child).flags&&(s=null!==r.memoizedState,r.stateNode.isHidden=s,s&&(null===r.alternate||null===r.alternate.memoizedState)&&(oV=e9())),4&n&&op(e);break;case 22:if(d=null!==i&&null!==i.memoizedState,1&e.mode?(a5=(c=a5)||d,of(t,e),a5=c):of(t,e),ov(e),8192&n){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!d&&0!=(1&e.mode))for(a8=e,d=e.child;null!==d;){for(h=a8=d;null!==a8;){switch(p=(g=a8).child,g.tag){case 0:case 11:case 14:case 15:oi(4,g,g.return);break;case 1:a9(g,g.return);var f=g.stateNode;if("function"==typeof f.componentWillUnmount){n=g,i=g.return;try{f.props=(t=n).memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(e){lf(n,i,e)}}break;case 5:a9(g,g.return);break;case 22:if(null!==g.memoizedState){ob(h);continue}}null!==p?(p.return=g,a8=p):ob(h)}d=d.sibling}n:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,c?(s=r.style,"function"==typeof s.setProperty?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,a=null!=(l=h.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,o.style.display=e_("display",a))}catch(t){lf(e,e.return,t)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(t){lf(e,e.return,t)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break;for(;null===h.sibling;){if(null===h.return||h.return===e)break n;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:of(t,e),ov(e),4&n&&op(e);case 21:}}function ov(e){var t=e.flags;if(2&t){try{n:{for(var i=e.return;null!==i;){if(oa(i)){var n=i;break n}i=i.return}throw Error(u(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(eb(r,""),n.flags&=-33);var s=oo(e);oc(e,s,r);break;case 3:case 4:var a=n.stateNode.containerInfo,o=oo(e);ol(e,o,a);break;default:throw Error(u(161))}}catch(t){lf(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function oS(e,t,i){a8=e,oy(e,t,i)}function oy(e,t,i){for(var n=0!=(1&e.mode);null!==a8;){var r=a8,s=r.child;if(22===r.tag&&n){var a=null!==r.memoizedState||a4;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||a5;o=a4;var c=a5;if(a4=a,(a5=l)&&!c)for(a8=r;null!==a8;)l=(a=a8).child,22===a.tag&&null!==a.memoizedState?oT(r):null!==l?(l.return=a,a8=l):oT(r);for(;null!==s;)a8=s,oy(s,t,i),s=s.sibling;a8=r,a4=o,a5=c}oC(e,t,i)}else 0!=(8772&r.subtreeFlags)&&null!==s?(s.return=r,a8=s):oC(e,t,i)}}function oC(e){for(;null!==a8;){var t=a8;if(0!=(8772&t.flags)){var i=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:a5||on(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!a5)if(null===i)n.componentDidMount();else{var r=t.elementType===t.type?i.memoizedProps:rz(t.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&ss(t,s,n);break;case 3:var a=t.updateQueue;if(null!==a){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}ss(t,a,i)}break;case 5:var o=t.stateNode;if(null===i&&4&t.flags){i=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var d=c.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&tJ(h)}}}break;default:throw Error(u(163))}a5||512&t.flags&&or(t)}catch(e){lf(t,t.return,e)}}if(t===e){a8=null;break}if(null!==(i=t.sibling)){i.return=t.return,a8=i;break}a8=t.return}}function ob(e){for(;null!==a8;){var t=a8;if(t===e){a8=null;break}var i=t.sibling;if(null!==i){i.return=t.return,a8=i;break}a8=t.return}}function oT(e){for(;null!==a8;){var t=a8;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{on(4,t)}catch(e){lf(t,i,e)}break;case 1:var n=t.stateNode;if("function"==typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(e){lf(t,r,e)}}var s=t.return;try{or(t)}catch(e){lf(t,s,e)}break;case 5:var a=t.return;try{or(t)}catch(e){lf(t,a,e)}}}catch(e){lf(t,t.return,e)}if(t===e){a8=null;break}var o=t.sibling;if(null!==o){o.return=t.return,a8=o;break}a8=t.return}}var oE=Math.ceil,o_=A.ReactCurrentDispatcher,oI=A.ReactCurrentOwner,ow=A.ReactCurrentBatchConfig,oP=0,oR=null,oA=null,oM=0,oD=0,oO=re(0),ok=0,oN=null,ox=0,oL=0,oF=0,oU=null,o$=null,oV=0,oB=1/0,oH=null,oj=!1,oq=null,oW=null,oG=!1,oz=null,oJ=0,oK=0,oQ=null,oY=-1,oZ=0;function oX(){return 0!=(6&oP)?e9():-1!==oY?oY:oY=e9()}function o0(e){return 0==(1&e.mode)?1:0!=(2&oP)&&0!==oM?oM&-oM:null!==rG.transition?(0===oZ&&(oZ=ty()),oZ):0!==(e=t_)?e:e=void 0===(e=window.event)?16:t2(e.type)}function o1(e,t,i,n){if(50<oK)throw oK=0,oQ=null,Error(u(185));tb(e,i,n),(0==(2&oP)||e!==oR)&&(e===oR&&(0==(2&oP)&&(oL|=i),4===ok&&o8(e,oM)),o2(e,n),1===i&&0===oP&&0==(1&t.mode)&&(oB=e9()+500,rf&&ry()))}function o2(e,t){var i=e.callbackNode;tv(e,t);var n=tf(e,e===oR?oM:0);if(0===n)null!==i&&e5(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&e5(i),1===t)0===e.tag?rS(o9.bind(null,e)):rv(o9.bind(null,e)),nG(function(){0==(6&oP)&&ry()}),i=null;else{switch(tI(n)){case 1:i=te;break;case 4:i=tt;break;case 16:default:i=ti;break;case 0x20000000:i=tr}i=lC(i,o3.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function o3(e,t){if(oY=-1,oZ=0,0!=(6&oP))throw Error(u(327));var i=e.callbackNode;if(lg()&&e.callbackNode!==i)return null;var n=tf(e,e===oR?oM:0);if(0===n)return null;if(0!=(30&n)||0!=(n&e.expiredLanes)||t)t=la(e,n);else{t=n;var r=oP;oP|=2;var s=lr();for((oR!==e||oM!==t)&&(oH=null,oB=e9()+500,li(e,t));;)try{ll();break}catch(t){ln(e,t)}rZ(),o_.current=s,oP=r,null!==oA?t=0:(oR=null,oM=0,t=ok)}if(0!==t){if(2===t&&0!==(r=tS(e))&&(n=r,t=o4(e,r)),1===t)throw i=oN,li(e,0),o8(e,n),o2(e,e9()),i;if(6===t)o8(e,n);else{if(r=e.current.alternate,0==(30&n)&&!o6(r)&&(2===(t=la(e,n))&&0!==(s=tS(e))&&(n=s,t=o4(e,s)),1===t))throw i=oN,li(e,0),o8(e,n),o2(e,e9()),i;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(u(345));case 2:case 5:lu(e,o$,oH);break;case 3:if(o8(e,n),(0x7c00000&n)===n&&10<(t=oV+500-e9())){if(0!==tf(e,0))break;if(((r=e.suspendedLanes)&n)!==n){oX(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nj(lu.bind(null,e,o$,oH),t);break}lu(e,o$,oH);break;case 4:if(o8(e,n),(4194240&n)===n)break;for(r=-1,t=e.eventTimes;0<n;){var a=31-tl(n);s=1<<a,(a=t[a])>r&&(r=a),n&=~s}if(n=r,10<(n=(120>(n=e9()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*oE(n/1960))-n)){e.timeoutHandle=nj(lu.bind(null,e,o$,oH),n);break}lu(e,o$,oH);break;default:throw Error(u(329))}}}return o2(e,e9()),e.callbackNode===i?o3.bind(null,e):null}function o4(e,t){var i=oU;return e.current.memoizedState.isDehydrated&&(li(e,t).flags|=256),2!==(e=la(e,t))&&(t=o$,o$=i,null!==t&&o5(t)),e}function o5(e){null===o$?o$=e:o$.push.apply(o$,e)}function o6(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],s=r.getSnapshot;r=r.value;try{if(!i3(s(),r))return!1}catch(e){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function o8(e,t){for(t&=~oF,t&=~oL,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-tl(t),n=1<<i;e[i]=-1,t&=~n}}function o9(e){if(0!=(6&oP))throw Error(u(327));lg();var t=tf(e,0);if(0==(1&t))return o2(e,e9()),null;var i=la(e,t);if(0!==e.tag&&2===i){var n=tS(e);0!==n&&(t=n,i=o4(e,n))}if(1===i)throw i=oN,li(e,0),o8(e,t),o2(e,e9()),i;if(6===i)throw Error(u(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,lu(e,o$,oH),o2(e,e9()),null}function o7(e,t){var i=oP;oP|=1;try{return e(t)}finally{0===(oP=i)&&(oB=e9()+500,rf&&ry())}}function le(e){null!==oz&&0===oz.tag&&0==(6&oP)&&lg();var t=oP;oP|=1;var i=ow.transition,n=t_;try{if(ow.transition=null,t_=1,e)return e()}finally{t_=n,ow.transition=i,0==(6&(oP=t))&&ry()}}function lt(){oD=oO.current,rt(oO)}function li(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,nq(i)),null!==oA)for(i=oA.return;null!==i;){var n=i;switch(rO(n),n.tag){case 1:null!=(n=n.type.childContextTypes)&&rc();break;case 3:sI(),rt(rs),rt(rr),sD();break;case 5:sP(n);break;case 4:sI();break;case 13:case 19:rt(sR);break;case 10:rX(n.type._context);break;case 22:case 23:lt()}i=i.return}if(oR=e,oA=e=lI(e.current,null),oM=oD=t,ok=0,oN=null,oF=oL=ox=0,o$=oU=null,null!==r3){for(t=0;t<r3.length;t++)if(null!==(n=(i=r3[t]).interleaved)){i.interleaved=null;var r=n.next,s=i.pending;if(null!==s){var a=s.next;s.next=r,n.next=a}i.pending=n}r3=null}return e}function ln(e,t){for(;;){var i=oA;try{if(rZ(),sO.current=am,sU){for(var n=sx.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}sU=!1}if(sN=0,sF=sL=sx=null,s$=!1,sV=0,oI.current=null,null===i||null===i.return){ok=1,oN=t,oA=null;break}n:{var s=e,a=i.return,o=i,l=t;if(t=oM,o.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l,d=o,h=d.tag;if(0==(1&d.mode)&&(0===h||11===h||15===h)){var g=d.alternate;g?(d.updateQueue=g.updateQueue,d.memoizedState=g.memoizedState,d.lanes=g.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=aP(a);if(null!==p){p.flags&=-257,aR(p,a,o,s,t),1&p.mode&&aw(s,c,t),t=p,l=c;var f=t.updateQueue;if(null===f){var m=new Set;m.add(l),t.updateQueue=m}else f.add(l);break n}if(0==(1&t)){aw(s,c,t),ls();break n}l=Error(u(426))}else if(rx&&1&o.mode){var v=aP(a);if(null!==v){0==(65536&v.flags)&&(v.flags|=256),aR(v,a,o,s,t),rW(aC(l,o));break n}}s=l=aC(l,o),4!==ok&&(ok=2),null===oU?oU=[s]:oU.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var S=a_(s,l,t);sn(s,S);break n;case 1:o=l;var y=s.type,C=s.stateNode;if(0==(128&s.flags)&&("function"==typeof y.getDerivedStateFromError||null!==C&&"function"==typeof C.componentDidCatch&&(null===oW||!oW.has(C)))){s.flags|=65536,t&=-t,s.lanes|=t;var b=aI(s,o,t);sn(s,b);break n}}s=s.return}while(null!==s)}ld(i)}catch(e){t=e,oA===i&&null!==i&&(oA=i=i.return);continue}break}}function lr(){var e=o_.current;return o_.current=am,null===e?am:e}function ls(){(0===ok||3===ok||2===ok)&&(ok=4),null===oR||0==(0xfffffff&ox)&&0==(0xfffffff&oL)||o8(oR,oM)}function la(e,t){var i=oP;oP|=2;var n=lr();for((oR!==e||oM!==t)&&(oH=null,li(e,t));;)try{lo();break}catch(t){ln(e,t)}if(rZ(),oP=i,o_.current=n,null!==oA)throw Error(u(261));return oR=null,oM=0,ok}function lo(){for(;null!==oA;)lc(oA)}function ll(){for(;null!==oA&&!e6();)lc(oA)}function lc(e){var t=l(e.alternate,e,oD);e.memoizedProps=e.pendingProps,null===t?ld(e):oA=t,oI.current=null}function ld(e){var t=e;do{var i=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(i=a2(i,t,oD))){oA=i;return}}else{if(null!==(i=a3(i,t))){i.flags&=32767,oA=i;return}if(null!==e)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ok=6,oA=null;return}}if(null!==(t=t.sibling)){oA=t;return}oA=t=e}while(null!==t);0===ok&&(ok=5)}function lu(e,t,i){var n=t_,r=ow.transition;try{ow.transition=null,t_=1,lh(e,t,i,n)}finally{ow.transition=r,t_=n}return null}function lh(e,t,i,n){do lg();while(null!==oz);if(0!=(6&oP))throw Error(u(327));i=e.finishedWork;var r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(u(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(tT(e,s),e===oR&&(oA=oR=null,oM=0),0==(2064&i.subtreeFlags)&&0==(2064&i.flags)||oG||(oG=!0,lC(ti,function(){return lg(),null})),s=0!=(15990&i.flags),0!=(15990&i.subtreeFlags)||s){s=ow.transition,ow.transition=null;var a=t_;t_=1;var o=oP;oP|=4,oI.current=null,ot(e,i),om(i,e),ne(nB,e.containerInfo),tQ=!!nV,nB=nV=null,e.current=i,oS(i,e,r),e8(),oP=o,t_=a,ow.transition=s}else e.current=i;if(oG&&(oG=!1,oz=e,oJ=r),0===(s=e.pendingLanes)&&(oW=null),to(i.stateNode,n),o2(e,e9()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)n((r=t[i]).value,{componentStack:r.stack,digest:r.digest});if(oj)throw oj=!1,e=oq,oq=null,e;return 0!=(1&oJ)&&0!==e.tag&&lg(),0!=(1&(s=e.pendingLanes))?e===oQ?oK++:(oK=0,oQ=e):oK=0,ry(),null}function lg(){if(null!==oz){var e=tI(oJ),t=ow.transition,i=t_;try{if(ow.transition=null,t_=16>e?16:e,null===oz)var n=!1;else{if(e=oz,oz=null,oJ=0,0!=(6&oP))throw Error(u(331));var r=oP;for(oP|=4,a8=e.current;null!==a8;){var s=a8,a=s.child;if(0!=(16&a8.flags)){var o=s.deletions;if(null!==o){for(var l=0;l<o.length;l++){var c=o[l];for(a8=c;null!==a8;){var d=a8;switch(d.tag){case 0:case 11:case 15:oi(8,d,s)}var h=d.child;if(null!==h)h.return=d,a8=h;else for(;null!==a8;){var g=(d=a8).sibling,p=d.return;if(os(d),d===c){a8=null;break}if(null!==g){g.return=p,a8=g;break}a8=p}}}var f=s.alternate;if(null!==f){var m=f.child;if(null!==m){f.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}a8=s}}if(0!=(2064&s.subtreeFlags)&&null!==a)a.return=s,a8=a;else for(;null!==a8;){if(s=a8,0!=(2048&s.flags))switch(s.tag){case 0:case 11:case 15:oi(9,s,s.return)}var S=s.sibling;if(null!==S){S.return=s.return,a8=S;break}a8=s.return}}var y=e.current;for(a8=y;null!==a8;){var C=(a=a8).child;if(0!=(2064&a.subtreeFlags)&&null!==C)C.return=a,a8=C;else for(a=y;null!==a8;){if(o=a8,0!=(2048&o.flags))try{switch(o.tag){case 0:case 11:case 15:on(9,o)}}catch(e){lf(o,o.return,e)}if(o===a){a8=null;break}var b=o.sibling;if(null!==b){b.return=o.return,a8=b;break}a8=o.return}}if(oP=r,ry(),ta&&"function"==typeof ta.onPostCommitFiberRoot)try{ta.onPostCommitFiberRoot(ts,e)}catch(e){}n=!0}return n}finally{t_=i,ow.transition=t}}return!1}function lp(e,t,i){t=a_(e,t=aC(i,t),1),e=st(e,t,1),t=oX(),null!==e&&(tb(e,1,t),o2(e,t))}function lf(e,t,i){if(3===e.tag)lp(e,e,i);else for(;null!==t;){if(3===t.tag){lp(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===oW||!oW.has(n))){e=aI(t,e=aC(i,e),1),t=st(t,e,1),e=oX(),null!==t&&(tb(t,1,e),o2(t,e));break}}t=t.return}}function lm(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=oX(),e.pingedLanes|=e.suspendedLanes&i,oR===e&&(oM&i)===i&&(4===ok||3===ok&&(0x7c00000&oM)===oM&&500>e9()-oV?li(e,0):oF|=i),o2(e,t)}function lv(e,t){0===t&&(0==(1&e.mode)?t=1:(t=tg,0==(0x7c00000&(tg<<=1))&&(tg=4194304)));var i=oX();null!==(e=r6(e,t))&&(tb(e,t,i),o2(e,i))}function lS(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),lv(e,i)}function ly(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(u(314))}null!==n&&n.delete(t),lv(e,i)}function lC(e,t){return e4(e,t)}function lb(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lT(e,t,i,n){return new lb(e,t,i,n)}function lE(e){return!(!(e=e.prototype)||!e.isReactComponent)}function l_(e){if("function"==typeof e)return+!!lE(e);if(null!=e){if((e=e.$$typeof)===F)return 11;if(e===V)return 14}return 2}function lI(e,t){var i=e.alternate;return null===i?((i=lT(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=0xe00000&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function lw(e,t,i,n,r,s){var a=2;if(n=e,"function"==typeof e)lE(e)&&(a=1);else if("string"==typeof e)a=5;else n:switch(e){case O:return lP(i.children,r,s,t);case k:a=8,r|=8;break;case N:return(e=lT(12,i,t,2|r)).elementType=N,e.lanes=s,e;case U:return(e=lT(13,i,t,r)).elementType=U,e.lanes=s,e;case $:return(e=lT(19,i,t,r)).elementType=$,e.lanes=s,e;case H:return lR(i,r,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case x:a=10;break n;case L:a=9;break n;case F:a=11;break n;case V:a=14;break n;case B:a=16,n=null;break n}throw Error(u(130,null==e?e:typeof e,""))}return(t=lT(a,i,t,r)).elementType=e,t.type=n,t.lanes=s,t}function lP(e,t,i,n){return(e=lT(7,e,n,t)).lanes=i,e}function lR(e,t,i,n){return(e=lT(22,e,n,t)).elementType=H,e.lanes=i,e.stateNode={isHidden:!1},e}function lA(e,t,i){return(e=lT(6,e,null,t)).lanes=i,e}function lM(e,t,i){return(t=lT(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function lD(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tC(0),this.expirationTimes=tC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tC(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function lO(e,t,i,n,r,s,a,o,l){return e=new lD(e,t,i,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=lT(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},r9(s),e}function lk(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:D,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}function lN(e){if(!e)return rn;e=e._reactInternals;n:{if(eZ(e)!==e||1!==e.tag)throw Error(u(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break n;case 1:if(rl(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break n}}t=t.return}while(null!==t);throw Error(u(171))}if(1===e.tag){var i=e.type;if(rl(i))return ru(e,i,t)}return t}function lx(e,t,i,n,r,s,a,o,l){return(e=lO(i,n,!0,e,r,s,a,o,l)).context=lN(null),i=e.current,(s=se(n=oX(),r=o0(i))).callback=null!=t?t:null,st(i,s,r),e.current.lanes=r,tb(e,r,n),o2(e,n),e}function lL(e,t,i,n){var r=t.current,s=oX(),a=o0(r);return i=lN(i),null===t.context?t.context=i:t.pendingContext=i,(t=se(s,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=st(r,t,a))&&(o1(e,r,a,s),si(e,r,a)),a}function lF(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function lU(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function l$(e,t){lU(e,t),(e=e.alternate)&&lU(e,t)}function lV(){return null}l=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||rs.current)aM=!0;else{if(0==(e.lanes&i)&&0==(128&t.flags))return aM=!1,aX(e,t,i);aM=0!=(131072&e.flags)}else aM=!1,rx&&0!=(1048576&t.flags)&&rM(t,rE,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;aY(e,t),e=t.pendingProps;var r=ro(t,rr.current);r1(t,i),r=sq(null,t,n,e,r,i);var s=sW();return t.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,rl(n)?(s=!0,rh(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r9(t),r.updater=sl,t.stateNode=r,r._reactInternals=t,sh(t,n,e,i),t=a$(null,t,n,!0,s,i)):(t.tag=0,rx&&s&&rD(t),aD(null,t,r,i),t=t.child),t;case 16:n=t.elementType;n:{switch(aY(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=l_(n),e=rz(n,e),r){case 0:t=aF(null,t,n,e,i);break n;case 1:t=aU(null,t,n,e,i);break n;case 11:t=aO(null,t,n,e,i);break n;case 14:t=ak(null,t,n,rz(n.type,e),i);break n}throw Error(u(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:rz(n,r),aF(e,t,n,r,i);case 1:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:rz(n,r),aU(e,t,n,r,i);case 3:n:{if(aV(t),null===e)throw Error(u(387));n=t.pendingProps,r=(s=t.memoizedState).element,r7(e,t),sr(t,n,null,i);var a=t.memoizedState;if(n=a.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){r=aC(Error(u(423)),t),t=aB(e,t,n,i,r);break n}else if(n!==r){r=aC(Error(u(424)),t),t=aB(e,t,n,i,r);break n}else for(rN=nK(t.stateNode.containerInfo.firstChild),rk=t,rx=!0,rL=null,i=sS(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling;else{if(rq(),n===r){t=aZ(e,t,i);break n}aD(e,t,n,i)}t=t.child}return t;case 5:return sw(t),null===e&&rV(t),n=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,nH(n,r)?a=null:null!==s&&nH(n,s)&&(t.flags|=32),aL(e,t),aD(e,t,a,i),t.child;case 6:return null===e&&rV(t),null;case 13:return aq(e,t,i);case 4:return s_(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=sv(t,null,n,i):aD(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:rz(n,r),aO(e,t,n,r,i);case 7:return aD(e,t,t.pendingProps,i),t.child;case 8:case 12:return aD(e,t,t.pendingProps.children,i),t.child;case 10:n:{if(n=t.type._context,r=t.pendingProps,s=t.memoizedProps,a=r.value,ri(rJ,n._currentValue),n._currentValue=a,null!==s)if(i3(s.value,a)){if(s.children===r.children&&!rs.current){t=aZ(e,t,i);break n}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var o=s.dependencies;if(null!==o){a=s.child;for(var l=o.firstContext;null!==l;){if(l.context===n){if(1===s.tag){(l=se(-1,i&-i)).tag=2;var c=s.updateQueue;if(null!==c){var d=(c=c.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}s.lanes|=i,null!==(l=s.alternate)&&(l.lanes|=i),r0(s.return,i,t),o.lanes|=i;break}l=l.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(u(341));a.lanes|=i,null!==(o=a.alternate)&&(o.lanes|=i),r0(a,i,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}aD(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,r1(t,i),n=n(r=r2(r)),t.flags|=1,aD(e,t,n,i),t.child;case 14:return r=rz(n=t.type,t.pendingProps),r=rz(n.type,r),ak(e,t,n,r,i);case 15:return aN(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:rz(n,r),aY(e,t),t.tag=1,rl(n)?(e=!0,rh(t)):e=!1,r1(t,i),sd(t,n,r),sh(t,n,r,i),a$(null,t,n,!0,e,i);case 19:return aQ(e,t,i);case 22:return ax(e,t,i)}throw Error(u(156,t.tag))};var lB="function"==typeof reportError?reportError:function(e){console.error(e)};function lH(e){this._internalRoot=e}function lj(e){this._internalRoot=e}function lq(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function lW(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function lG(){}function lz(e,t,i,n,r){if(r){if("function"==typeof n){var s=n;n=function(){var e=lF(a);s.call(e)}}var a=lx(t,n,e,0,null,!1,!1,"",lG);return e._reactRootContainer=a,e[n0]=a.current,nR(8===e.nodeType?e.parentNode:e),le(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof n){var o=n;n=function(){var e=lF(l);o.call(e)}}var l=lO(e,0,!1,null,null,!1,!1,"",lG);return e._reactRootContainer=l,e[n0]=l.current,nR(8===e.nodeType?e.parentNode:e),le(function(){lL(t,l,i,n)}),l}function lJ(e,t,i,n,r){var s=i._reactRootContainer;if(s){var a=s;if("function"==typeof r){var o=r;r=function(){var e=lF(a);o.call(e)}}lL(t,a,e,r)}else a=lz(i,t,e,r,n);return lF(a)}lj.prototype.render=lH.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(u(409));lL(e,t,null,null)},lj.prototype.unmount=lH.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;le(function(){lL(null,e,null,null)}),t[n0]=null}},lj.prototype.unstable_scheduleHydration=function(e){if(e){var t=tA();e={blockedOn:null,target:e,priority:t};for(var i=0;i<tU.length&&0!==t&&t<tU[i].priority;i++);tU.splice(i,0,e),0===i&&tj(e)}},tw=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=tp(t.pendingLanes);0!==i&&(tE(t,1|i),o2(t,e9()),0==(6&oP)&&(oB=e9()+500,ry()))}break;case 13:le(function(){var t=r6(e,1);null!==t&&o1(t,e,1,oX())}),l$(e,1)}},tP=function(e){if(13===e.tag){var t=r6(e,0x8000000);null!==t&&o1(t,e,0x8000000,oX()),l$(e,0x8000000)}},tR=function(e){if(13===e.tag){var t=o0(e),i=r6(e,t);null!==i&&o1(i,e,t,oX()),l$(e,t)}},tA=function(){return t_},tM=function(e,t){var i=t_;try{return t_=e,t()}finally{t_=i}},eD=function(e,t,i){switch(t){case"input":if(el(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=n8(n);if(!r)throw Error(u(90));en(n),el(n,r)}}}break;case"textarea":ef(e,i);break;case"select":null!=(t=i.value)&&eh(e,!!i.multiple,t,!1)}},eF=o7,eU=le;var lK={usingClientEntryPoint:!1,Events:[n5,n6,n8,ex,eL,o7]},lQ={findFiberByHostInstance:n4,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},lY={bundleType:lQ.bundleType,version:lQ.version,rendererPackageName:lQ.rendererPackageName,rendererConfig:lQ.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:A.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=e2(e))?null:e.stateNode},findFiberByHostInstance:lQ.findFiberByHostInstance||lV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lZ=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lZ.isDisabled&&lZ.supportsFiber)try{ts=lZ.inject(lY),ta=lZ}catch(e){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lK,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!lq(t))throw Error(u(200));return lk(e,t,null,i)},t.createRoot=function(e,t){if(!lq(e))throw Error(u(299));var i=!1,n="",r=lB;return null!=t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=lO(e,1,!1,null,null,i,!1,n,r),e[n0]=t.current,nR(8===e.nodeType?e.parentNode:e),new lH(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(u(188));throw Error(u(268,e=Object.keys(e).join(",")))}return e=null===(e=e2(t))?null:e.stateNode},t.flushSync=function(e){return le(e)},t.hydrate=function(e,t,i){if(!lW(t))throw Error(u(200));return lJ(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!lq(e))throw Error(u(405));var n=null!=i&&i.hydratedSources||null,r=!1,s="",a=lB;if(null!=i&&(!0===i.unstable_strictMode&&(r=!0),void 0!==i.identifierPrefix&&(s=i.identifierPrefix),void 0!==i.onRecoverableError&&(a=i.onRecoverableError)),t=lx(t,null,e,1,null!=i?i:null,r,!1,s,a),e[n0]=t.current,nR(e),n)for(e=0;e<n.length;e++)r=(r=(i=n[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,r]:t.mutableSourceEagerHydrationData.push(i,r);return new lj(t)},t.render=function(e,t,i){if(!lW(t))throw Error(u(200));return lJ(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!lW(e))throw Error(u(40));return!!e._reactRootContainer&&(le(function(){lJ(null,null,e,!1,function(){e._reactRootContainer=null,e[n0]=null})}),!0)},t.unstable_batchedUpdates=o7,t.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!lW(i))throw Error(u(200));if(null==e||void 0===e._reactInternals)throw Error(u(38));return lJ(e,t,i,!1,n)},t.version="18.2.0"},312788:function(e,t,i){"use strict";function n(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}n(),e.exports=i(183975)},910901:function(e,t,i){"use strict";i.d(t,{a:()=>s});var n=i(632735),r=i(114187);function s(e){var t=e.i18n,i=e.defaultNS,s=e.children,a=(0,n.useMemo)(function(){return{i18n:t,defaultNS:i}},[t,i]);return(0,n.createElement)(r.OO.Provider,{value:a},s)}},819798:function(e,t,i){"use strict";i.d(t,{c:()=>D});var n=i(505474),r=i.n(n),s=i(687002),a=i.n(s),o=i(920566),l=i.n(o),c=i(632735),d=i(521432),u=i.n(d),h=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function g(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},i=e.match(/<\/?([^\s]+?)[/\s>]/);if(i&&(t.name=i[1],(u()[i[1]]||"/"===e.charAt(e.length-2))&&(t.voidElement=!0),t.name.startsWith("!--"))){var n=e.indexOf("--\x3e");return{type:"comment",comment:-1!==n?e.slice(4,n):""}}for(var r=new RegExp(h),s=null;null!==(s=r.exec(e));)if(s[0].trim())if(s[1]){var a=s[1].trim(),o=[a,""];a.indexOf("=")>-1&&(o=a.split("=")),t.attrs[o[0]]=o[1],r.lastIndex--}else s[2]&&(t.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return t}var p=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,f=/^\s*$/,m=Object.create(null);let v=function(e,t){t||(t={}),t.components||(t.components=m);var i,n=[],r=[],s=-1,a=!1;if(0!==e.indexOf("<")){var o=e.indexOf("<");n.push({type:"text",content:-1===o?e:e.substring(0,o)})}return e.replace(p,function(o,l){if(a){if(o!=="</"+i.name+">")return;a=!1}var c,d="/"!==o.charAt(1),u=o.startsWith("\x3c!--"),h=l+o.length,p=e.charAt(h);if(u){var m=g(o);return s<0?n.push(m):(c=r[s]).children.push(m),n}if(d&&(s++,"tag"===(i=g(o)).type&&t.components[i.name]&&(i.type="component",a=!0),i.voidElement||a||!p||"<"===p||i.children.push({type:"text",content:e.slice(h,e.indexOf("<",h))}),0===s&&n.push(i),(c=r[s-1])&&c.children.push(i),r[s]=i),(!d||i.voidElement)&&(s>-1&&(i.voidElement||i.name===o.slice(2,-1))&&(i=-1==--s?n:r[s]),!a&&"<"!==p&&p)){c=-1===s?n:r[s].children;var v=e.indexOf("<",h),S=e.slice(h,-1===v?void 0:v);f.test(S)&&(S=" "),(v>-1&&s+c.length>=0||" "!==S)&&c.push({type:"text",content:S})}}),n};var S=i(114187),y=i(316715),C=["format"],b=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function T(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function E(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?T(Object(i),!0).forEach(function(t){l()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _(e,t){if(!e)return!1;var i=e.props?e.props.children:e.children;return t?i.length>0:!!i}function I(e){return e?e.props?e.props.children:e.children:[]}function w(e){return"[object Array]"===Object.prototype.toString.call(e)&&e.every(function(e){return(0,c.isValidElement)(e)})}function P(e){return Array.isArray(e)?e:[e]}function R(e,t){var i=E({},t);return i.props=Object.assign(e.props,t.props),i}function A(e,t){if(!e)return"";var i="",n=P(e),s=t.transSupportBasicHtmlNodes&&t.transKeepBasicHtmlNodesFor?t.transKeepBasicHtmlNodesFor:[];return n.forEach(function(e,n){if("string"==typeof e)i+="".concat(e);else if((0,c.isValidElement)(e)){var o=Object.keys(e.props).length,l=s.indexOf(e.type)>-1,d=e.props.children;if(!d&&l&&0===o)i+="<".concat(e.type,"/>");else if(d||l&&0===o)if(e.props.i18nIsDynamicList)i+="<".concat(n,"></").concat(n,">");else if(l&&1===o&&"string"==typeof d)i+="<".concat(e.type,">").concat(d,"</").concat(e.type,">");else{var u=A(d,t);i+="<".concat(n,">").concat(u,"</").concat(n,">")}else i+="<".concat(n,"></").concat(n,">")}else if(null===e)(0,y.ZK)("Trans: the passed in value is invalid - seems you passed in a null child.");else if("object"===a()(e)){var h=e.format,g=Object.keys(r()(e,C));if(1===g.length){var p=h?"".concat(g[0],", ").concat(h):g[0];i+="{{".concat(p,"}}")}else(0,y.ZK)("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",e)}else(0,y.ZK)("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",e)}),i}function M(e,t,i,n,r,s){if(""===t)return[];var o=n.transKeepBasicHtmlNodesFor||[],l=t&&new RegExp(o.join("|")).test(t);if(!e&&!l)return[t];var d={};function u(e){P(e).forEach(function(e){"string"!=typeof e&&(_(e)?u(I(e)):"object"!==a()(e)||(0,c.isValidElement)(e)||Object.assign(d,e))})}u(e);var h=v("<0>".concat(t,"</0>")),g=E(E({},d),r);function p(e,t,i){var n=I(e),r=m(n,t.children,i);return w(n)&&0===r.length?n:r}function f(e,t,i,n,r){e.dummy&&(e.children=t),i.push((0,c.cloneElement)(e,E(E({},e.props),{},{key:n}),r?void 0:t))}function m(t,r,d){var u=P(t);return P(r).reduce(function(t,r,h){var v=r.children&&r.children[0]&&r.children[0].content&&i.services.interpolator.interpolate(r.children[0].content,g,i.language);if("tag"===r.type){var S=u[parseInt(r.name,10)];!S&&1===d.length&&d[0][r.name]&&(S=d[0][r.name]),S||(S={});var y=0!==Object.keys(r.attrs).length?R({props:r.attrs},S):S,C=(0,c.isValidElement)(y),b=C&&_(r,!0)&&!r.voidElement,T=l&&"object"===a()(y)&&y.dummy&&!C,I="object"===a()(e)&&null!==e&&Object.hasOwnProperty.call(e,r.name);if("string"==typeof y){var w=i.services.interpolator.interpolate(y,g,i.language);t.push(w)}else if(_(y)||b){var P=p(y,r,d);f(y,P,t,h)}else if(T){var A=m(u,r.children,d);t.push((0,c.cloneElement)(y,E(E({},y.props),{},{key:h}),A))}else if(Number.isNaN(parseFloat(r.name)))if(I){var M=p(y,r,d);f(y,M,t,h,r.voidElement)}else if(n.transSupportBasicHtmlNodes&&o.indexOf(r.name)>-1)if(r.voidElement)t.push((0,c.createElement)(r.name,{key:"".concat(r.name,"-").concat(h)}));else{var D=m(u,r.children,d);t.push((0,c.createElement)(r.name,{key:"".concat(r.name,"-").concat(h)},D))}else if(r.voidElement)t.push("<".concat(r.name," />"));else{var O=m(u,r.children,d);t.push("<".concat(r.name,">").concat(O,"</").concat(r.name,">"))}else if("object"!==a()(y)||C)1===r.children.length&&v?t.push((0,c.cloneElement)(y,E(E({},y.props),{},{key:h}),v)):t.push((0,c.cloneElement)(y,E(E({},y.props),{},{key:h})));else{var k=r.children[0]?v:null;k&&t.push(k)}}else if("text"===r.type){var N=n.transWrapTextNodes,x=s?n.unescape(i.services.interpolator.interpolate(r.content,g,i.language)):i.services.interpolator.interpolate(r.content,g,i.language);N?t.push((0,c.createElement)(N,{key:"".concat(r.name,"-").concat(h)},x)):t.push(x)}return t},[])}return I(m([{dummy:!0,children:e||[]}],h,P(e||[]))[0])}function D(e){var t=e.children,i=e.count,n=e.parent,s=e.i18nKey,a=e.context,o=e.tOptions,l=void 0===o?{}:o,d=e.values,u=e.defaults,h=e.components,g=e.ns,p=e.i18n,f=e.t,m=e.shouldUnescape,v=r()(e,b),C=(0,c.useContext)(S.OO)||{},T=C.i18n,_=C.defaultNS,I=p||T||(0,S.nI)();if(!I)return(0,y.O4)("You will need to pass in an i18next instance by using i18nextReactModule"),t;var w=f||I.t.bind(I)||function(e){return e};a&&(l.context=a);var P=E(E({},(0,S.JP)()),I.options&&I.options.react),R=g||w.ns||_||I.options&&I.options.defaultNS;R="string"==typeof R?[R]:R||["translation"];var D=u||A(t,P)||P.transEmptyNodeValue||s,O=P.hashTransKey,k=s||(O?O(D):D),N=d?l.interpolation:{interpolation:E(E({},l.interpolation),{},{prefix:"#$?",suffix:"?$#"})},x=E(E(E(E({},l),{},{count:i},d),N),{},{defaultValue:D,ns:R}),L=M(h||t,k?w(k,x):D,I,P,x,m),F=void 0!==n?n:P.defaultTransParent;return F?(0,c.createElement)(F,v,L):L}},114187:function(e,t,i){"use strict";i.d(t,{JP:()=>p,nI:()=>m,OO:()=>g,zv:()=>f});var n,r=i(404988),s=i.n(r),a=i(719590),o=i.n(a);i(920566);var l=i(632735),c=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,d={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"\xa9","&#169;":"\xa9","&reg;":"\xae","&#174;":"\xae","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},u=function(e){return d[e]},h={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:function(e){return e.replace(c,u)}},g=(0,l.createContext)();function p(){return h}var f=function(){function e(){s()(this,e),this.usedNamespaces={}}return o()(e,[{key:"addUsedNamespaces",value:function(e){var t=this;e.forEach(function(e){t.usedNamespaces[e]||(t.usedNamespaces[e]=!0)})}},{key:"getUsedNamespaces",value:function(){return Object.keys(this.usedNamespaces)}}]),e}();function m(){return n}},316715:function(e,t,i){"use strict";function n(){if(console&&console.warn){for(var e,t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];"string"==typeof i[0]&&(i[0]="react-i18next:: ".concat(i[0])),(e=console).warn.apply(e,i)}}i.d(t,{DC:()=>a,F0:()=>l,Gf:()=>c,O4:()=>s,ZK:()=>n});var r={};function s(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];"string"==typeof t[0]&&r[t[0]]||("string"==typeof t[0]&&(r[t[0]]=new Date),n.apply(void 0,t))}function a(e,t,i){e.loadNamespaces(t,function(){if(e.isInitialized)i();else{var t=function t(){setTimeout(function(){e.off("initialized",t)},0),i()};e.on("initialized",t)}})}function o(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.languages[0],r=!!t.options&&t.options.fallbackLng,s=t.languages[t.languages.length-1];if("cimode"===n.toLowerCase())return!0;var a=function(e,i){var n=t.services.backendConnector.state["".concat(e,"|").concat(i)];return -1===n||2===n};return(!(i.bindI18n&&i.bindI18n.indexOf("languageChanging")>-1)||!t.services.backendConnector.backend||!t.isLanguageChangingTo||!!a(t.isLanguageChangingTo,e))&&!!(t.hasResourceBundle(n,e)||!t.services.backendConnector.backend||t.options.resources&&!t.options.partialBundledLanguages||a(n,e)&&(!r||a(s,e)))}function l(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.languages&&t.languages.length?void 0===t.options.ignoreJSONStructure?o(e,t,i):t.hasLoadedNamespace(e,{precheck:function(t,n){if(i.bindI18n&&i.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!n(t.isLanguageChangingTo,e))return!1}}):(s("i18n.languages were undefined or empty",t.languages),!0)}function c(e){return e.displayName||e.name||("string"==typeof e&&e.length>0?e:"Unknown")}},626697:function(e,t){"use strict";var i=60103,n=60106,r=60107,s=60108,a=60114,o=60109,l=60110,c=60112,d=60113,u=60120,h=60115,g=60116,p=60121,f=60122,m=60117,v=60129,S=60131;if("function"==typeof Symbol&&Symbol.for){var y=Symbol.for;i=y("react.element"),n=y("react.portal"),r=y("react.fragment"),s=y("react.strict_mode"),a=y("react.profiler"),o=y("react.provider"),l=y("react.context"),c=y("react.forward_ref"),d=y("react.suspense"),u=y("react.suspense_list"),h=y("react.memo"),g=y("react.lazy"),p=y("react.block"),f=y("react.server.block"),m=y("react.fundamental"),v=y("react.debug_trace_mode"),S=y("react.legacy_hidden")}function C(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case r:case a:case s:case d:case u:return e;default:switch(e=e&&e.$$typeof){case l:case c:case g:case h:case o:return e;default:return t}}case n:return t}}}var b=o,T=i,E=c,_=r,I=g,w=h,P=n,R=a,A=s,M=d;t.ContextConsumer=l,t.ContextProvider=b,t.Element=T,t.ForwardRef=E,t.Fragment=_,t.Lazy=I,t.Memo=w,t.Portal=P,t.Profiler=R,t.StrictMode=A,t.Suspense=M,t.isAsyncMode=function(){return!1},t.isConcurrentMode=function(){return!1},t.isContextConsumer=function(e){return C(e)===l},t.isContextProvider=function(e){return C(e)===o},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return C(e)===c},t.isFragment=function(e){return C(e)===r},t.isLazy=function(e){return C(e)===g},t.isMemo=function(e){return C(e)===h},t.isPortal=function(e){return C(e)===n},t.isProfiler=function(e){return C(e)===a},t.isStrictMode=function(e){return C(e)===s},t.isSuspense=function(e){return C(e)===d},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===a||e===v||e===s||e===d||e===u||e===S||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===h||e.$$typeof===o||e.$$typeof===l||e.$$typeof===c||e.$$typeof===m||e.$$typeof===p||e[0]===f)||!1},t.typeOf=C},72594:function(e,t,i){"use strict";e.exports=i(626697)},214911:function(e,t,i){"use strict";i.d(t,{VK:()=>d});var n=i(853038),r=i(387143),s=i(632735),a=i(54961);i(260216);var o=i(385851),l=i(648518),c=i(192163),d=function(e){function t(){for(var t,i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).history=(0,a.lX)(t.props),t}return(0,r.Z)(t,e),t.prototype.render=function(){return s.createElement(n.F0,{history:this.history,children:this.props.children})},t}(s.Component);s.Component;var u=function(e,t){return"function"==typeof e?e(t):e},h=function(e,t){return"string"==typeof e?(0,a.ob)(e,null,null,t):e},g=function(e){return e},p=s.forwardRef;function f(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}void 0===p&&(p=g);var m=p(function(e,t){var i=e.innerRef,n=e.navigate,r=e.onClick,a=(0,l.Z)(e,["innerRef","navigate","onClick"]),c=a.target,d=(0,o.Z)({},a,{onClick:function(e){try{r&&r(e)}catch(t){throw e.preventDefault(),t}e.defaultPrevented||0!==e.button||c&&"_self"!==c||f(e)||(e.preventDefault(),n())}});return g!==p?d.ref=t||i:d.ref=i,s.createElement("a",d)}),v=p(function(e,t){var i=e.component,r=void 0===i?m:i,d=e.replace,f=e.to,v=e.innerRef,S=(0,l.Z)(e,["component","replace","to","innerRef"]);return s.createElement(n.s6.Consumer,null,function(e){e||(0,c.Z)(!1);var i=e.history,n=h(u(f,e.location),e.location),l=n?i.createHref(n):"",m=(0,o.Z)({},S,{href:l,navigate:function(){var t=u(f,e.location),n=(0,a.Ep)(e.location)===(0,a.Ep)(h(t));(d||n?i.replace:i.push)(t)}});return g!==p?m.ref=t||v:m.innerRef=v,s.createElement(r,m)})}),S=function(e){return e},y=s.forwardRef;function C(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.filter(function(e){return e}).join(" ")}void 0===y&&(y=S),y(function(e,t){var i=e["aria-current"],r=void 0===i?"page":i,a=e.activeClassName,d=void 0===a?"active":a,g=e.activeStyle,p=e.className,f=e.exact,m=e.isActive,b=e.location,T=e.sensitive,E=e.strict,_=e.style,I=e.to,w=e.innerRef,P=(0,l.Z)(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return s.createElement(n.s6.Consumer,null,function(e){e||(0,c.Z)(!1);var i=b||e.location,a=h(u(I,i),i),l=a.pathname,R=l&&l.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),A=R?(0,n.LX)(i.pathname,{path:R,exact:f,sensitive:T,strict:E}):null,M=!!(m?m(A,i):A),D="function"==typeof p?p(M):p,O="function"==typeof _?_(M):_;M&&(D=C(D,d),O=(0,o.Z)({},O,g));var k=(0,o.Z)({"aria-current":M&&r||null,className:D,style:O,to:a},P);return S!==y?k.ref=t||w:k.innerRef=w,s.createElement(v,k)})})},853038:function(e,t,i){"use strict";i.d(t,{AW:()=>F,F0:()=>E,LX:()=>x,TH:()=>B,k6:()=>V,l_:()=>M,rs:()=>U,s6:()=>T});var n=i(387143),r=i(632735),s=i(260216),a=i.n(s),o=i(54961),l=i(192163),c=i(385851),d=i(712816),u=i.n(d);i(72594),i(648518),i(559431);var h=0x3fffffff,g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:{};function p(){var e="__global_unique_id__";return g[e]=(g[e]||0)+1}function f(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function m(e){var t=[];return{on:function(e){t.push(e)},off:function(e){t=t.filter(function(t){return t!==e})},get:function(){return e},set:function(i,n){e=i,t.forEach(function(t){return t(e,n)})}}}function v(e){return Array.isArray(e)?e[0]:e}function S(e,t){var i,s,o="__create-react-context-"+p()+"__",l=function(e){function i(){for(var t,i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).emitter=m(t.props.value),t}(0,n.Z)(i,e);var r=i.prototype;return r.getChildContext=function(){var e;return(e={})[o]=this.emitter,e},r.componentWillReceiveProps=function(e){if(this.props.value!==e.value){var i,n=this.props.value,r=e.value;f(n,r)?i=0:0!=(i=("function"==typeof t?t(n,r):h)|0)&&this.emitter.set(e.value,i)}},r.render=function(){return this.props.children},i}(r.Component);(i={})[o]=a().object.isRequired,l.childContextTypes=i;var c=function(t){function i(){for(var e,i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).observedBits=void 0,e.state={value:e.getValue()},e.onUpdate=function(t,i){((0|e.observedBits)&i)!=0&&e.setState({value:e.getValue()})},e}(0,n.Z)(i,t);var r=i.prototype;return r.componentWillReceiveProps=function(e){var t=e.observedBits;this.observedBits=null==t?h:t},r.componentDidMount=function(){this.context[o]&&this.context[o].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=null==e?h:e},r.componentWillUnmount=function(){this.context[o]&&this.context[o].off(this.onUpdate)},r.getValue=function(){return this.context[o]?this.context[o].get():e},r.render=function(){return v(this.props.children)(this.state.value)},i}(r.Component);return(s={})[o]=a().object,c.contextTypes=s,{Provider:l,Consumer:c}}var y=r.createContext||S,C=function(e){var t=y();return t.displayName=e,t},b=C("Router-History"),T=C("Router"),E=function(e){function t(t){var i;return(i=e.call(this,t)||this).state={location:t.history.location},i._isMounted=!1,i._pendingLocation=null,t.staticContext||(i.unlisten=t.history.listen(function(e){i._pendingLocation=e})),i}(0,n.Z)(t,e),t.computeRootMatch=function(e){return{path:"/",url:"/",params:{},isExact:"/"===e}};var i=t.prototype;return i.componentDidMount=function(){var e=this;this._isMounted=!0,this.unlisten&&this.unlisten(),this.props.staticContext||(this.unlisten=this.props.history.listen(function(t){e._isMounted&&e.setState({location:t})})),this._pendingLocation&&this.setState({location:this._pendingLocation})},i.componentWillUnmount=function(){this.unlisten&&(this.unlisten(),this._isMounted=!1,this._pendingLocation=null)},i.render=function(){return r.createElement(T.Provider,{value:{history:this.props.history,location:this.state.location,match:t.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},r.createElement(b.Provider,{children:this.props.children||null,value:this.props.history}))},t}(r.Component);r.Component;var _=function(e){function t(){return e.apply(this,arguments)||this}(0,n.Z)(t,e);var i=t.prototype;return i.componentDidMount=function(){this.props.onMount&&this.props.onMount.call(this,this)},i.componentDidUpdate=function(e){this.props.onUpdate&&this.props.onUpdate.call(this,this,e)},i.componentWillUnmount=function(){this.props.onUnmount&&this.props.onUnmount.call(this,this)},i.render=function(){return null},t}(r.Component),I={},w=1e4,P=0;function R(e){if(I[e])return I[e];var t=u().compile(e);return P<w&&(I[e]=t,P++),t}function A(e,t){return void 0===e&&(e="/"),void 0===t&&(t={}),"/"===e?e:R(e)(t,{pretty:!0})}function M(e){var t=e.computedMatch,i=e.to,n=e.push,s=void 0!==n&&n;return r.createElement(T.Consumer,null,function(e){e||(0,l.Z)(!1);var n=e.history,a=e.staticContext,d=s?n.push:n.replace,u=(0,o.ob)(t?"string"==typeof i?A(i,t.params):(0,c.Z)({},i,{pathname:A(i.pathname,t.params)}):i);return a?(d(u),null):r.createElement(_,{onMount:function(){d(u)},onUpdate:function(e,t){var i=(0,o.ob)(t.to);(0,o.Hp)(i,(0,c.Z)({},u,{key:i.key}))||d(u)},to:i})})}var D={},O=1e4,k=0;function N(e,t){var i=""+t.end+t.strict+t.sensitive,n=D[i]||(D[i]={});if(n[e])return n[e];var r=[],s={regexp:u()(e,r,t),keys:r};return k<O&&(n[e]=s,k++),s}function x(e,t){void 0===t&&(t={}),("string"==typeof t||Array.isArray(t))&&(t={path:t});var i=t,n=i.path,r=i.exact,s=void 0!==r&&r,a=i.strict,o=void 0!==a&&a,l=i.sensitive,c=void 0!==l&&l;return[].concat(n).reduce(function(t,i){if(!i&&""!==i)return null;if(t)return t;var n=N(i,{end:s,strict:o,sensitive:c}),r=n.regexp,a=n.keys,l=r.exec(e);if(!l)return null;var d=l[0],u=l.slice(1),h=e===d;return s&&!h?null:{path:i,url:"/"===i&&""===d?"/":d,isExact:h,params:a.reduce(function(e,t,i){return e[t.name]=u[i],e},{})}},null)}function L(e){return 0===r.Children.count(e)}var F=function(e){function t(){return e.apply(this,arguments)||this}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this;return r.createElement(T.Consumer,null,function(t){t||(0,l.Z)(!1);var i=e.props.location||t.location,n=e.props.computedMatch?e.props.computedMatch:e.props.path?x(i.pathname,e.props):t.match,s=(0,c.Z)({},t,{location:i,match:n}),a=e.props,o=a.children,d=a.component,u=a.render;return Array.isArray(o)&&L(o)&&(o=null),r.createElement(T.Provider,{value:s},s.match?o?"function"==typeof o?o(s):o:d?r.createElement(d,s):u?u(s):null:"function"==typeof o?o(s):null)})},t}(r.Component);r.Component;var U=function(e){function t(){return e.apply(this,arguments)||this}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this;return r.createElement(T.Consumer,null,function(t){t||(0,l.Z)(!1);var i,n,s=e.props.location||t.location;return r.Children.forEach(e.props.children,function(e){if(null==n&&r.isValidElement(e)){i=e;var a=e.props.path||e.props.from;n=a?x(s.pathname,(0,c.Z)({},e.props,{path:a})):t.match}}),n?r.cloneElement(i,{location:s,computedMatch:n}):null})},t}(r.Component),$=r.useContext;function V(){return $(b)}function B(){return $(T).location}},712816:function(e,t,i){var n=i(879930);e.exports=S,e.exports.parse=s,e.exports.compile=a,e.exports.tokensToFunction=c,e.exports.tokensToRegExp=v;var r=RegExp("(\\\\.)|([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))","g");function s(e,t){for(var i,n=[],s=0,a=0,o="",l=t&&t.delimiter||"/";null!=(i=r.exec(e));){var c=i[0],h=i[1],g=i.index;if(o+=e.slice(a,g),a=g+c.length,h){o+=h[1];continue}var p=e[a],f=i[2],m=i[3],v=i[4],S=i[5],y=i[6],C=i[7];o&&(n.push(o),o="");var b=null!=f&&null!=p&&p!==f,T="+"===y||"*"===y,E="?"===y||"*"===y,_=i[2]||l,I=v||S;n.push({name:m||s++,prefix:f||"",delimiter:_,optional:E,repeat:T,partial:b,asterisk:!!C,pattern:I?u(I):C?".*":"[^"+d(_)+"]+?"})}return a<e.length&&(o+=e.substr(a)),o&&n.push(o),n}function a(e,t){return c(s(e,t))}function o(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function l(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function c(e){for(var t=Array(e.length),i=0;i<e.length;i++)"object"==typeof e[i]&&(t[i]=RegExp("^(?:"+e[i].pattern+")$"));return function(i,r){for(var s="",a=i||{},c=(r||{}).pretty?o:encodeURIComponent,d=0;d<e.length;d++){var u,h=e[d];if("string"==typeof h){s+=h;continue}var g=a[h.name];if(null==g)if(h.optional){h.partial&&(s+=h.prefix);continue}else throw TypeError('Expected "'+h.name+'" to be defined');if(n(g)){if(!h.repeat)throw TypeError('Expected "'+h.name+'" to not repeat, but received `'+JSON.stringify(g)+"`");if(0===g.length)if(h.optional)continue;else throw TypeError('Expected "'+h.name+'" to not be empty');for(var p=0;p<g.length;p++){if(u=c(g[p]),!t[d].test(u))throw TypeError('Expected all "'+h.name+'" to match "'+h.pattern+'", but received `'+JSON.stringify(u)+"`");s+=(0===p?h.prefix:h.delimiter)+u}continue}if(u=h.asterisk?l(g):c(g),!t[d].test(u))throw TypeError('Expected "'+h.name+'" to match "'+h.pattern+'", but received "'+u+'"');s+=h.prefix+u}return s}}function d(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function u(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function h(e,t){return e.keys=t,e}function g(e){return e.sensitive?"":"i"}function p(e,t){var i=e.source.match(/\((?!\?)/g);if(i)for(var n=0;n<i.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return h(e,t)}function f(e,t,i){for(var n=[],r=0;r<e.length;r++)n.push(S(e[r],t,i).source);return h(RegExp("(?:"+n.join("|")+")",g(i)),t)}function m(e,t,i){return v(s(e,i),t,i)}function v(e,t,i){n(t)||(i=t||i,t=[]);for(var r=(i=i||{}).strict,s=!1!==i.end,a="",o=0;o<e.length;o++){var l=e[o];if("string"==typeof l)a+=d(l);else{var c=d(l.prefix),u="(?:"+l.pattern+")";t.push(l),l.repeat&&(u+="(?:"+c+u+")*"),a+=u=l.optional?l.partial?c+"("+u+")?":"(?:"+c+"("+u+"))?":c+"("+u+")"}}var p=d(i.delimiter||"/"),f=a.slice(-p.length)===p;return r||(a=(f?a.slice(0,-p.length):a)+"(?:"+p+"(?=$))?"),s?a+="$":a+=r&&f?"":"(?="+p+"|$)",h(RegExp("^"+a,g(i)),t)}function S(e,t,i){return(n(t)||(i=t||i,t=[]),i=i||{},e instanceof RegExp)?p(e,t):n(e)?f(e,t,i):m(e,t,i)}},989849:function(e,t,i){"use strict";i.d(t,{ZP:()=>m});var n=i(648518),r=i(387143);i(260216);var s=i(632735),a=i(312788);let o=!1;var l=i(128803),c="unmounted",d="exited",u="entering",h="entered",g="exiting",p=function(e){function t(t,i){var n,r=e.call(this,t,i)||this,s=i,a=s&&!s.isMounting?t.enter:t.appear;return r.appearStatus=null,t.in?a?(n=d,r.appearStatus=u):n=h:n=t.unmountOnExit||t.mountOnEnter?c:d,r.state={status:n},r.nextCallback=null,r}(0,r.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===c?{status:d}:null};var i=t.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==u&&i!==h&&(t=u):(i===u||i===h)&&(t=g)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,i,n=this.props.timeout;return e=t=i=n,null!=n&&"number"!=typeof n&&(e=n.exit,t=n.enter,i=void 0!==n.appear?n.appear:t),{exit:e,enter:t,appear:i}},i.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===u?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&this.state.status===d&&this.setState({status:c})},i.performEnter=function(e){var t=this,i=this.props.enter,n=this.context?this.context.isMounting:e,r=this.props.nodeRef?[n]:[a.findDOMNode(this),n],s=r[0],l=r[1],c=this.getTimeouts(),d=n?c.appear:c.enter;if(!e&&!i||o)return void this.safeSetState({status:h},function(){t.props.onEntered(s)});this.props.onEnter(s,l),this.safeSetState({status:u},function(){t.props.onEntering(s,l),t.onTransitionEnd(d,function(){t.safeSetState({status:h},function(){t.props.onEntered(s,l)})})})},i.performExit=function(){var e=this,t=this.props.exit,i=this.getTimeouts(),n=this.props.nodeRef?void 0:a.findDOMNode(this);if(!t||o)return void this.safeSetState({status:d},function(){e.props.onExited(n)});this.props.onExit(n),this.safeSetState({status:g},function(){e.props.onExiting(n),e.onTransitionEnd(i.exit,function(){e.safeSetState({status:d},function(){e.props.onExited(n)})})})},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(n){i&&(i=!1,t.nextCallback=null,e(n))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var i=this.props.nodeRef?this.props.nodeRef.current:a.findDOMNode(this),n=null==e&&!this.props.addEndListener;if(!i||n)return void setTimeout(this.nextCallback,0);if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],s=r[0],o=r[1];this.props.addEndListener(s,o)}null!=e&&setTimeout(this.nextCallback,e)},i.render=function(){var e=this.state.status;if(e===c)return null;var t=this.props,i=t.children,r=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,n.Z)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return s.createElement(l.Z.Provider,{value:null},"function"==typeof i?i(e,r):s.cloneElement(s.Children.only(i),r))},t}(s.Component);function f(){}p.contextType=l.Z,p.propTypes={},p.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:f,onEntering:f,onEntered:f,onExit:f,onExiting:f,onExited:f},p.UNMOUNTED=c,p.EXITED=d,p.ENTERING=u,p.ENTERED=h,p.EXITING=g;let m=p},128803:function(e,t,i){"use strict";i.d(t,{Z:()=>n});let n=i(632735).createContext(null)},62848:function(e,t,i){"use strict";i.d(t,{qj:()=>O,aV:()=>e2});var n,r,s=i(404988),a=i.n(s),o=i(719590),l=i.n(o),c=i(21581),d=i.n(c),u=i(180852),h=i.n(u),g=i(804546),p=i.n(g),f=i(920566),m=i.n(f),v=i(632735);function S(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function y(e){function t(t){var i=this.constructor.getDerivedStateFromProps(e,t);return null!=i?i:null}this.setState(t.bind(this))}function C(e,t){try{var i=this.props,n=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(i,n)}finally{this.props=i,this.state=n}}function b(e){var t=e.prototype;if(!t||!t.isReactComponent)throw Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var i=null,n=null,r=null;if("function"==typeof t.componentWillMount?i="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(i="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?n="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(n="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?r="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(r="UNSAFE_componentWillUpdate"),null!==i||null!==n||null!==r)throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+(e.displayName||e.name)+" uses "+("function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()")+" but also contains the following legacy lifecycles:"+(null!==i?"\n  "+i:"")+(null!==n?"\n  "+n:"")+(null!==r?"\n  "+r:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks");if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=S,t.componentWillReceiveProps=y),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=C;var s=t.componentDidUpdate;t.componentDidUpdate=function(e,t,i){var n=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:i;s.call(this,e,t,n)}}return e}function T(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function E(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?T(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _(e,t,i){return t=h()(t),d()(e,I()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function I(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(I=function(){return!!e})()}S.__suppressDeprecationWarning=!0,y.__suppressDeprecationWarning=!0,C.__suppressDeprecationWarning=!0;var w=function(e){function t(){var e;a()(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=_(this,t,[].concat(n)),m()(e,"state",{scrollToColumn:0,scrollToRow:0,instanceProps:{prevScrollToColumn:0,prevScrollToRow:0}}),m()(e,"_columnStartIndex",0),m()(e,"_columnStopIndex",0),m()(e,"_rowStartIndex",0),m()(e,"_rowStopIndex",0),m()(e,"_onKeyDown",function(t){var i=e.props,n=i.columnCount,r=i.disabled,s=i.mode,a=i.rowCount;if(!r){var o=e._getScrollState(),l=o.scrollToColumn,c=o.scrollToRow,d=e._getScrollState(),u=d.scrollToColumn,h=d.scrollToRow;switch(t.key){case"ArrowDown":h="cells"===s?Math.min(h+1,a-1):Math.min(e._rowStopIndex+1,a-1);break;case"ArrowLeft":u="cells"===s?Math.max(u-1,0):Math.max(e._columnStartIndex-1,0);break;case"ArrowRight":u="cells"===s?Math.min(u+1,n-1):Math.min(e._columnStopIndex+1,n-1);break;case"ArrowUp":h="cells"===s?Math.max(h-1,0):Math.max(e._rowStartIndex-1,0)}(u!==l||h!==c)&&(t.preventDefault(),e._updateScrollState({scrollToColumn:u,scrollToRow:h}))}}),m()(e,"_onSectionRendered",function(t){var i=t.columnStartIndex,n=t.columnStopIndex,r=t.rowStartIndex,s=t.rowStopIndex;e._columnStartIndex=i,e._columnStopIndex=n,e._rowStartIndex=r,e._rowStopIndex=s}),e}return p()(t,e),l()(t,[{key:"setScrollIndexes",value:function(e){var t=e.scrollToColumn,i=e.scrollToRow;this.setState({scrollToRow:i,scrollToColumn:t})}},{key:"render",value:function(){var e=this.props,t=e.className,i=e.children,n=this._getScrollState(),r=n.scrollToColumn,s=n.scrollToRow;return v.createElement("div",{className:t,onKeyDown:this._onKeyDown},i({onSectionRendered:this._onSectionRendered,scrollToColumn:r,scrollToRow:s}))}},{key:"_getScrollState",value:function(){return this.props.isControlled?this.props:this.state}},{key:"_updateScrollState",value:function(e){var t=e.scrollToColumn,i=e.scrollToRow,n=this.props,r=n.isControlled,s=n.onScrollToChange;"function"==typeof s&&s({scrollToColumn:t,scrollToRow:i}),r||this.setState({scrollToColumn:t,scrollToRow:i})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.isControlled?{}:e.scrollToColumn!==t.instanceProps.prevScrollToColumn||e.scrollToRow!==t.instanceProps.prevScrollToRow?E(E({},t),{},{scrollToColumn:e.scrollToColumn,scrollToRow:e.scrollToRow,instanceProps:{prevScrollToColumn:e.scrollToColumn,prevScrollToRow:e.scrollToRow}}):{}}}])}(v.PureComponent);function P(e,t){var n=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:i.g,r=void 0!==n.document&&n.document.attachEvent;if(!r){var s=function(){var e=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||function(e){return n.setTimeout(e,20)};return function(t){return e(t)}}(),a=function(){var e=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.clearTimeout;return function(t){return e(t)}}(),o=function(e){var t=e.__resizeTriggers__,i=t.firstElementChild,n=t.lastElementChild,r=i.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,r.style.width=i.offsetWidth+1+"px",r.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight},l=function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height},c=function(e){if(!(e.target.className&&"function"==typeof e.target.className.indexOf&&0>e.target.className.indexOf("contract-trigger")&&0>e.target.className.indexOf("expand-trigger"))){var t=this;o(this),this.__resizeRAF__&&a(this.__resizeRAF__),this.__resizeRAF__=s(function(){l(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach(function(i){i.call(t,e)}))})}},d=!1,u="",h="animationstart",g="Webkit Moz O ms".split(" "),p="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),f="",m=n.document.createElement("fakeelement");if(void 0!==m.style.animationName&&(d=!0),!1===d){for(var v=0;v<g.length;v++)if(void 0!==m.style[g[v]+"AnimationName"]){u="-"+(f=g[v]).toLowerCase()+"-",h=p[v],d=!0;break}}var S="resizeanim",y="@"+u+"keyframes "+S+" { from { opacity: 0; } to { opacity: 0; } } ",C=u+"animation: 1ms "+S+"; "}var b=function(t){if(!t.getElementById("detectElementResize")){var i=(y||"")+".resize-triggers { "+(C||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',n=t.head||t.getElementsByTagName("head")[0],r=t.createElement("style");r.id="detectElementResize",r.type="text/css",null!=e&&r.setAttribute("nonce",e),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(t.createTextNode(i)),n.appendChild(r)}};return{addResizeListener:function(e,t){if(r)e.attachEvent("onresize",t);else{if(!e.__resizeTriggers__){var i=e.ownerDocument,s=n.getComputedStyle(e);s&&"static"==s.position&&(e.style.position="relative"),b(i),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=i.createElement("div")).className="resize-triggers";var a=i.createElement("div");a.className="expand-trigger",a.appendChild(i.createElement("div"));var l=i.createElement("div");l.className="contract-trigger",e.__resizeTriggers__.appendChild(a),e.__resizeTriggers__.appendChild(l),e.appendChild(e.__resizeTriggers__),o(e),e.addEventListener("scroll",c,!0),h&&(e.__resizeTriggers__.__animationListener__=function(t){t.animationName==S&&o(e)},e.__resizeTriggers__.addEventListener(h,e.__resizeTriggers__.__animationListener__))}e.__resizeListeners__.push(t)}},removeResizeListener:function(e,t){if(r)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",c,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(h,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}function R(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function A(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?R(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):R(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function M(e,t,i){return t=h()(t),d()(e,D()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function D(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(D=function(){return!!e})()}m()(w,"defaultProps",{disabled:!1,isControlled:!1,mode:"edges",scrollToColumn:0,scrollToRow:0}),b(w);var O=function(e){function t(){var e;a()(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=M(this,t,[].concat(n)),m()(e,"state",{height:e.props.defaultHeight||0,width:e.props.defaultWidth||0}),m()(e,"_parentNode",void 0),m()(e,"_autoSizer",void 0),m()(e,"_window",void 0),m()(e,"_detectElementResize",void 0),m()(e,"_onResize",function(){var t=e.props,i=t.disableHeight,n=t.disableWidth,r=t.onResize;if(e._parentNode){var s=e._parentNode.offsetHeight||0,a=e._parentNode.offsetWidth||0,o=(e._window||window).getComputedStyle(e._parentNode)||{},l=parseInt(o.paddingLeft,10)||0,c=parseInt(o.paddingRight,10)||0,d=parseInt(o.paddingTop,10)||0,u=parseInt(o.paddingBottom,10)||0,h=s-d-u,g=a-l-c;(i||e.state.height===h)&&(n||e.state.width===g)||(e.setState({height:s-d-u,width:a-l-c}),r({height:s,width:a}))}}),m()(e,"_setRef",function(t){e._autoSizer=t}),e}return p()(t,e),l()(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._window=this._autoSizer.parentNode.ownerDocument.defaultView,this._detectElementResize=P(e,this._window),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,i=e.className,n=e.disableHeight,r=e.disableWidth,s=e.style,a=this.state,o=a.height,l=a.width,c={overflow:"visible"},d={};return n||(c.height=0,d.height=o),r||(c.width=0,d.width=l),v.createElement("div",{className:i,ref:this._setRef,style:A(A({},c),s)},t(d))}}])}(v.Component);function k(e,t,i){return t=h()(t),d()(e,N()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function N(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(N=function(){return!!e})()}m()(O,"defaultProps",{onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}});var x=function(e){function t(){var e;a()(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=k(this,t,[].concat(n)),m()(e,"_child",v.createRef()),m()(e,"_measure",function(){var t=e.props,i=t.cache,n=t.columnIndex,r=void 0===n?0:n,s=t.parent,a=t.rowIndex,o=void 0===a?e.props.index||0:a,l=e._getCellMeasurements(),c=l.height,d=l.width;(c!==i.getHeight(o,r)||d!==i.getWidth(o,r))&&(i.set(o,r,d,c),s&&"function"==typeof s.recomputeGridSize&&s.recomputeGridSize({columnIndex:r,rowIndex:o}))}),m()(e,"_registerChild",function(t){!t||t instanceof Element||console.warn("CellMeasurer registerChild expects to be passed Element or null"),e._child.current=t,t&&e._maybeMeasureCell()}),e}return p()(t,e),l()(t,[{key:"componentDidMount",value:function(){this._maybeMeasureCell()}},{key:"componentDidUpdate",value:function(){this._maybeMeasureCell()}},{key:"render",value:function(){var e=this,t=this.props.children,i="function"==typeof t?t({measure:this._measure,registerChild:this._registerChild}):t;return null===i?i:(0,v.cloneElement)(i,{ref:function(t){"function"==typeof i.ref?i.ref(t):i.ref&&(i.ref.current=t),e._child.current=t}})}},{key:"_getCellMeasurements",value:function(){var e=this.props.cache,t=this._child.current;if(!t||!t.ownerDocument||!t.ownerDocument.defaultView||!(t instanceof t.ownerDocument.defaultView.HTMLElement))return{height:0,width:0};var i=t.style.width,n=t.style.height;e.hasFixedWidth()||(t.style.width="auto"),e.hasFixedHeight()||(t.style.height="auto");var r=Math.ceil(t.offsetHeight),s=Math.ceil(t.offsetWidth);return i&&(t.style.width=i),n&&(t.style.height=n),{height:r,width:s}}},{key:"_maybeMeasureCell",value:function(){var e=this.props,t=e.cache,i=e.columnIndex,n=void 0===i?0:i,r=e.parent,s=e.rowIndex,a=void 0===s?this.props.index||0:s;if(!t.has(a,n)){var o=this._getCellMeasurements(),l=o.height,c=o.width;t.set(a,n,c,l),r&&"function"==typeof r.invalidateCellSizeAfterRender&&r.invalidateCellSizeAfterRender({columnIndex:n,rowIndex:a})}}}])}(v.PureComponent);m()(x,"__internalCellMeasurerFlag",!1);var L=i(40444),F=i.n(L),U=i(416950),$=i.n(U);i(260216);var V=i(860045);function B(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t={};return function(i){var n=i.callback,r=i.indices,s=Object.keys(r),a=!e||s.every(function(e){var t=r[e];return Array.isArray(t)?t.length>0:t>=0}),o=s.length!==Object.keys(t).length||s.some(function(e){var i=t[e],n=r[e];return Array.isArray(n)?i.join(",")!==n.join(","):i!==n});t=r,a&&o&&n(r)}}let H=!!("undefined"!=typeof window&&window.document&&window.document.createElement);function j(e){if((!n&&0!==n||e)&&H){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),n=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return n}function q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function W(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?q(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function G(e,t,i){return t=h()(t),d()(e,z()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(z=function(){return!!e})()}var J=150,K="observed",Q="requested",Y=function(e){function t(){var e;a()(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=G(this,t,[].concat(n)),m()(e,"state",{isScrolling:!1,scrollLeft:0,scrollTop:0}),m()(e,"_calculateSizeAndPositionDataOnNextUpdate",!1),m()(e,"_onSectionRenderedMemoizer",B()),m()(e,"_onScrollMemoizer",B(!1)),m()(e,"_invokeOnSectionRenderedHelper",function(){var t=e.props,i=t.cellLayoutManager,n=t.onSectionRendered;e._onSectionRenderedMemoizer({callback:n,indices:{indices:i.getLastRenderedIndices()}})}),m()(e,"_setScrollingContainerRef",function(t){e._scrollingContainer=t}),m()(e,"_updateScrollPositionForScrollToCell",function(){var t=e.props,i=t.cellLayoutManager,n=t.height,r=t.scrollToAlignment,s=t.scrollToCell,a=t.width,o=e.state,l=o.scrollLeft,c=o.scrollTop;if(s>=0){var d=i.getScrollPositionForCell({align:r,cellIndex:s,height:n,scrollLeft:l,scrollTop:c,width:a});(d.scrollLeft!==l||d.scrollTop!==c)&&e._setScrollPosition(d)}}),m()(e,"_onScroll",function(t){if(t.target===e._scrollingContainer){e._enablePointerEventsAfterDelay();var i=e.props,n=i.cellLayoutManager,r=i.height,s=i.isScrollingChange,a=i.width,o=e._scrollbarSize,l=n.getTotalSize(),c=l.height,d=l.width,u=Math.max(0,Math.min(d-a+o,t.target.scrollLeft)),h=Math.max(0,Math.min(c-r+o,t.target.scrollTop));if(e.state.scrollLeft!==u||e.state.scrollTop!==h){var g=t.cancelable?K:Q;e.state.isScrolling||s(!0),e.setState({isScrolling:!0,scrollLeft:u,scrollPositionChangeReason:g,scrollTop:h})}e._invokeOnScrollMemoizer({scrollLeft:u,scrollTop:h,totalWidth:d,totalHeight:c})}}),e._scrollbarSize=j(),void 0===e._scrollbarSize?(e._scrollbarSizeMeasured=!1,e._scrollbarSize=0):e._scrollbarSizeMeasured=!0,e}return p()(t,e),l()(t,[{key:"recomputeCellSizesAndPositions",value:function(){this._calculateSizeAndPositionDataOnNextUpdate=!0,this.forceUpdate()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.cellLayoutManager,i=e.scrollLeft,n=e.scrollToCell,r=e.scrollTop;this._scrollbarSizeMeasured||(this._scrollbarSize=j(),this._scrollbarSizeMeasured=!0,this.setState({})),n>=0?this._updateScrollPositionForScrollToCell():(i>=0||r>=0)&&this._setScrollPosition({scrollLeft:i,scrollTop:r}),this._invokeOnSectionRenderedHelper();var s=t.getTotalSize(),a=s.height,o=s.width;this._invokeOnScrollMemoizer({scrollLeft:i||0,scrollTop:r||0,totalHeight:a,totalWidth:o})}},{key:"componentDidUpdate",value:function(e,t){var i=this.props,n=i.height,r=i.scrollToAlignment,s=i.scrollToCell,a=i.width,o=this.state,l=o.scrollLeft,c=o.scrollPositionChangeReason,d=o.scrollTop;c===Q&&(l>=0&&l!==t.scrollLeft&&l!==this._scrollingContainer.scrollLeft&&(this._scrollingContainer.scrollLeft=l),d>=0&&d!==t.scrollTop&&d!==this._scrollingContainer.scrollTop&&(this._scrollingContainer.scrollTop=d)),(n!==e.height||r!==e.scrollToAlignment||s!==e.scrollToCell||a!==e.width)&&this._updateScrollPositionForScrollToCell(),this._invokeOnSectionRenderedHelper()}},{key:"componentWillUnmount",value:function(){this._disablePointerEventsTimeoutId&&clearTimeout(this._disablePointerEventsTimeoutId)}},{key:"render",value:function(){var e=this.props,t=e.autoHeight,i=e.cellCount,n=e.cellLayoutManager,r=e.className,s=e.height,a=e.horizontalOverscanSize,o=e.id,l=e.noContentRenderer,c=e.style,d=e.verticalOverscanSize,u=e.width,h=this.state,g=h.isScrolling,p=h.scrollLeft,f=h.scrollTop;(this._lastRenderedCellCount!==i||this._lastRenderedCellLayoutManager!==n||this._calculateSizeAndPositionDataOnNextUpdate)&&(this._lastRenderedCellCount=i,this._lastRenderedCellLayoutManager=n,this._calculateSizeAndPositionDataOnNextUpdate=!1,n.calculateSizeAndPositionData());var m=n.getTotalSize(),S=m.height,y=m.width,C=Math.max(0,p-a),b=Math.max(0,f-d),T=Math.min(y,p+u+a),E=Math.min(S,f+s+d),_=s>0&&u>0?n.cellRenderers({height:E-b,isScrolling:g,width:T-C,x:C,y:b}):[],I={boxSizing:"border-box",direction:"ltr",height:t?"auto":s,position:"relative",WebkitOverflowScrolling:"touch",width:u,willChange:"transform"},w=S>s?this._scrollbarSize:0,P=y>u?this._scrollbarSize:0;return I.overflowX=y+w<=u?"hidden":"auto",I.overflowY=S+P<=s?"hidden":"auto",v.createElement("div",{ref:this._setScrollingContainerRef,"aria-label":this.props["aria-label"],className:(0,V.default)("ReactVirtualized__Collection",r),id:o,onScroll:this._onScroll,role:"grid",style:W(W({},I),c),tabIndex:0},i>0&&v.createElement("div",{className:"ReactVirtualized__Collection__innerScrollContainer",style:{height:S,maxHeight:S,maxWidth:y,overflow:"hidden",pointerEvents:g?"none":"",width:y}},_),0===i&&l())}},{key:"_enablePointerEventsAfterDelay",value:function(){var e=this;this._disablePointerEventsTimeoutId&&clearTimeout(this._disablePointerEventsTimeoutId),this._disablePointerEventsTimeoutId=setTimeout(function(){(0,e.props.isScrollingChange)(!1),e._disablePointerEventsTimeoutId=null,e.setState({isScrolling:!1})},J)}},{key:"_invokeOnScrollMemoizer",value:function(e){var t=this,i=e.scrollLeft,n=e.scrollTop,r=e.totalHeight,s=e.totalWidth;this._onScrollMemoizer({callback:function(e){var i=e.scrollLeft,n=e.scrollTop,a=t.props,o=a.height;(0,a.onScroll)({clientHeight:o,clientWidth:a.width,scrollHeight:r,scrollLeft:i,scrollTop:n,scrollWidth:s})},indices:{scrollLeft:i,scrollTop:n}})}},{key:"_setScrollPosition",value:function(e){var t=e.scrollLeft,i=e.scrollTop,n={scrollPositionChangeReason:Q};t>=0&&(n.scrollLeft=t),i>=0&&(n.scrollTop=i),(t>=0&&t!==this.state.scrollLeft||i>=0&&i!==this.state.scrollTop)&&this.setState(n)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return 0===e.cellCount&&(0!==t.scrollLeft||0!==t.scrollTop)?{scrollLeft:0,scrollTop:0,scrollPositionChangeReason:Q}:e.scrollLeft!==t.scrollLeft||e.scrollTop!==t.scrollTop?{scrollLeft:null!=e.scrollLeft?e.scrollLeft:t.scrollLeft,scrollTop:null!=e.scrollTop?e.scrollTop:t.scrollTop,scrollPositionChangeReason:Q}:null}}])}(v.PureComponent);m()(Y,"defaultProps",{"aria-label":"grid",horizontalOverscanSize:0,noContentRenderer:function(){return null},onScroll:function(){return null},onSectionRendered:function(){return null},scrollToAlignment:"auto",scrollToCell:-1,style:{},verticalOverscanSize:0}),Y.propTypes={},b(Y);let Z=Y;var X=function(){function e(t){var i=t.height,n=t.width,r=t.x,s=t.y;a()(this,e),this.height=i,this.width=n,this.x=r,this.y=s,this._indexMap={},this._indices=[]}return l()(e,[{key:"addCellIndex",value:function(e){var t=e.index;this._indexMap[t]||(this._indexMap[t]=!0,this._indices.push(t))}},{key:"getCellIndices",value:function(){return this._indices}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y," ").concat(this.width,"x").concat(this.height)}}])}(),ee=100,et=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee;a()(this,e),this._sectionSize=t,this._cellMetadata=[],this._sections={}}return l()(e,[{key:"getCellIndices",value:function(e){var t=e.height,i=e.width,n=e.x,r=e.y,s={};return this.getSections({height:t,width:i,x:n,y:r}).forEach(function(e){return e.getCellIndices().forEach(function(e){s[e]=e})}),Object.keys(s).map(function(e){return s[e]})}},{key:"getCellMetadata",value:function(e){var t=e.index;return this._cellMetadata[t]}},{key:"getSections",value:function(e){for(var t=e.height,i=e.width,n=e.x,r=e.y,s=Math.floor(n/this._sectionSize),a=Math.floor((n+i-1)/this._sectionSize),o=Math.floor(r/this._sectionSize),l=Math.floor((r+t-1)/this._sectionSize),c=[],d=s;d<=a;d++)for(var u=o;u<=l;u++){var h="".concat(d,".").concat(u);this._sections[h]||(this._sections[h]=new X({height:this._sectionSize,width:this._sectionSize,x:d*this._sectionSize,y:u*this._sectionSize})),c.push(this._sections[h])}return c}},{key:"getTotalSectionCount",value:function(){return Object.keys(this._sections).length}},{key:"toString",value:function(){var e=this;return Object.keys(this._sections).map(function(t){return e._sections[t].toString()})}},{key:"registerCell",value:function(e){var t=e.cellMetadatum,i=e.index;this._cellMetadata[i]=t,this.getSections(t).forEach(function(e){return e.addCellIndex({index:i})})}}])}();function ei(e){for(var t=e.cellCount,i=e.cellSizeAndPositionGetter,n=e.sectionSize,r=[],s=new et(n),a=0,o=0,l=0;l<t;l++){var c=i({index:l});if(null==c.height||isNaN(c.height)||null==c.width||isNaN(c.width)||null==c.x||isNaN(c.x)||null==c.y||isNaN(c.y))throw Error("Invalid metadata returned for cell ".concat(l,":\n        x:").concat(c.x,", y:").concat(c.y,", width:").concat(c.width,", height:").concat(c.height));a=Math.max(a,c.y+c.height),o=Math.max(o,c.x+c.width),r[l]=c,s.registerCell({cellMetadatum:c,index:l})}return{cellMetadata:r,height:a,sectionManager:s,width:o}}function en(e){var t=e.align,i=void 0===t?"auto":t,n=e.cellOffset,r=e.cellSize,s=e.containerSize,a=e.currentOffset,o=n,l=o-s+r;switch(i){case"start":return o;case"end":return l;case"center":return o-(s-r)/2;default:return Math.max(l,Math.min(o,a))}}function er(e,t,i){return t=h()(t),d()(e,es()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function es(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(es=function(){return!!e})()}var ea=function(e){function t(e,i){var n;return a()(this,t),(n=er(this,t,[e,i]))._cellMetadata=[],n._lastRenderedCellIndices=[],n._cellCache=[],n._isScrollingChange=n._isScrollingChange.bind(n),n._setCollectionViewRef=n._setCollectionViewRef.bind(n),n}return p()(t,e),l()(t,[{key:"forceUpdate",value:function(){void 0!==this._collectionView&&this._collectionView.forceUpdate()}},{key:"recomputeCellSizesAndPositions",value:function(){this._cellCache=[],this._collectionView.recomputeCellSizesAndPositions()}},{key:"render",value:function(){var e=$()({},(F()(this.props),this.props));return v.createElement(Z,$()({cellLayoutManager:this,isScrollingChange:this._isScrollingChange,ref:this._setCollectionViewRef},e))}},{key:"calculateSizeAndPositionData",value:function(){var e=this.props,t=ei({cellCount:e.cellCount,cellSizeAndPositionGetter:e.cellSizeAndPositionGetter,sectionSize:e.sectionSize});this._cellMetadata=t.cellMetadata,this._sectionManager=t.sectionManager,this._height=t.height,this._width=t.width}},{key:"getLastRenderedIndices",value:function(){return this._lastRenderedCellIndices}},{key:"getScrollPositionForCell",value:function(e){var t=e.align,i=e.cellIndex,n=e.height,r=e.scrollLeft,s=e.scrollTop,a=e.width,o=this.props.cellCount;if(i>=0&&i<o){var l=this._cellMetadata[i];r=en({align:t,cellOffset:l.x,cellSize:l.width,containerSize:a,currentOffset:r,targetIndex:i}),s=en({align:t,cellOffset:l.y,cellSize:l.height,containerSize:n,currentOffset:s,targetIndex:i})}return{scrollLeft:r,scrollTop:s}}},{key:"getTotalSize",value:function(){return{height:this._height,width:this._width}}},{key:"cellRenderers",value:function(e){var t=this,i=e.height,n=e.isScrolling,r=e.width,s=e.x,a=e.y,o=this.props,l=o.cellGroupRenderer,c=o.cellRenderer;return this._lastRenderedCellIndices=this._sectionManager.getCellIndices({height:i,width:r,x:s,y:a}),l({cellCache:this._cellCache,cellRenderer:c,cellSizeAndPositionGetter:function(e){var i=e.index;return t._sectionManager.getCellMetadata({index:i})},indices:this._lastRenderedCellIndices,isScrolling:n})}},{key:"_isScrollingChange",value:function(e){e||(this._cellCache=[])}},{key:"_setCollectionViewRef",value:function(e){this._collectionView=e}}])}(v.PureComponent);function eo(e){var t=e.cellCache,i=e.cellRenderer,n=e.cellSizeAndPositionGetter,r=e.indices,s=e.isScrolling;return r.map(function(e){var r=n({index:e}),a={index:e,isScrolling:s,key:e,style:{height:r.height,left:r.x,position:"absolute",top:r.y,width:r.width}};return s?(e in t||(t[e]=i(a)),t[e]):i(a)}).filter(function(e){return!!e})}function el(e,t,i){return t=h()(t),d()(e,ec()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function ec(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ec=function(){return!!e})()}m()(ea,"defaultProps",{"aria-label":"grid",cellGroupRenderer:eo}),ea.propTypes={},function(e){function t(e,i){var n;return a()(this,t),(n=el(this,t,[e,i]))._registerChild=n._registerChild.bind(n),n}return p()(t,e),l()(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,i=t.columnMaxWidth,n=t.columnMinWidth,r=t.columnCount,s=t.width;(i!==e.columnMaxWidth||n!==e.columnMinWidth||r!==e.columnCount||s!==e.width)&&this._registeredChild&&this._registeredChild.recomputeGridSize()}},{key:"render",value:function(){var e=this.props,t=e.children,i=e.columnMaxWidth,n=e.columnMinWidth,r=e.columnCount,s=e.width,a=i?Math.min(i,s):s,o=s/r;return t({adjustedWidth:Math.min(s,(o=Math.floor(o=Math.min(a,o=Math.max(n||1,o))))*r),columnWidth:o,getColumnWidth:function(){return o},registerChild:this._registerChild})}},{key:"_registerChild",value:function(e){if(e&&"function"!=typeof e.recomputeGridSize)throw Error("Unexpected child type registered; only Grid/MultiGrid children are supported.");this._registeredChild=e,this._registeredChild&&this._registeredChild.recomputeGridSize()}}])}(v.PureComponent).propTypes={};var ed=i(687002),eu=i.n(ed);function eh(e){var t=e.cellCount,i=e.cellSize,n=e.computeMetadataCallback,r=e.computeMetadataCallbackProps,s=e.nextCellsCount,a=e.nextCellSize,o=e.nextScrollToIndex,l=e.scrollToIndex,c=e.updateScrollOffsetForScrollToIndex;(t!==s||("number"==typeof i||"number"==typeof a)&&i!==a)&&(n(r),l>=0&&l===o&&c())}var eg=i(505474),ep=i.n(eg),ef=function(){function e(t){var i=t.cellCount,n=t.cellSizeGetter,r=t.estimatedCellSize;a()(this,e),m()(this,"_cellSizeAndPositionData",{}),m()(this,"_lastMeasuredIndex",-1),m()(this,"_lastBatchedIndex",-1),m()(this,"_cellCount",void 0),m()(this,"_cellSizeGetter",void 0),m()(this,"_estimatedCellSize",void 0),this._cellSizeGetter=n,this._cellCount=i,this._estimatedCellSize=r}return l()(e,[{key:"areOffsetsAdjusted",value:function(){return!1}},{key:"configure",value:function(e){var t=e.cellCount,i=e.estimatedCellSize,n=e.cellSizeGetter;this._cellCount=t,this._estimatedCellSize=i,this._cellSizeGetter=n}},{key:"getCellCount",value:function(){return this._cellCount}},{key:"getEstimatedCellSize",value:function(){return this._estimatedCellSize}},{key:"getLastMeasuredIndex",value:function(){return this._lastMeasuredIndex}},{key:"getOffsetAdjustment",value:function(){return 0}},{key:"getSizeAndPositionOfCell",value:function(e){if(e<0||e>=this._cellCount)throw Error("Requested index ".concat(e," is outside of range 0..").concat(this._cellCount));if(e>this._lastMeasuredIndex)for(var t=this.getSizeAndPositionOfLastMeasuredCell(),i=t.offset+t.size,n=this._lastMeasuredIndex+1;n<=e;n++){var r=this._cellSizeGetter({index:n});if(void 0===r||isNaN(r))throw Error("Invalid size returned for cell ".concat(n," of value ").concat(r));null===r?(this._cellSizeAndPositionData[n]={offset:i,size:0},this._lastBatchedIndex=e):(this._cellSizeAndPositionData[n]={offset:i,size:r},i+=r,this._lastMeasuredIndex=e)}return this._cellSizeAndPositionData[e]}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function(){return this._lastMeasuredIndex>=0?this._cellSizeAndPositionData[this._lastMeasuredIndex]:{offset:0,size:0}}},{key:"getTotalSize",value:function(){var e=this.getSizeAndPositionOfLastMeasuredCell();return e.offset+e.size+(this._cellCount-this._lastMeasuredIndex-1)*this._estimatedCellSize}},{key:"getUpdatedOffsetForIndex",value:function(e){var t,i=e.align,n=void 0===i?"auto":i,r=e.containerSize,s=e.currentOffset,a=e.targetIndex;if(r<=0)return 0;var o=this.getSizeAndPositionOfCell(a),l=o.offset,c=l-r+o.size;switch(n){case"start":t=l;break;case"end":t=c;break;case"center":t=l-(r-o.size)/2;break;default:t=Math.max(c,Math.min(l,s))}return Math.max(0,Math.min(this.getTotalSize()-r,t))}},{key:"getVisibleCellRange",value:function(e){var t=e.containerSize,i=e.offset;if(0===this.getTotalSize())return{};var n=i+t,r=this._findNearestCell(i),s=this.getSizeAndPositionOfCell(r);i=s.offset+s.size;for(var a=r;i<n&&a<this._cellCount-1;)a++,i+=this.getSizeAndPositionOfCell(a).size;return{start:r,stop:a}}},{key:"resetCell",value:function(e){this._lastMeasuredIndex=Math.min(this._lastMeasuredIndex,e-1)}},{key:"_binarySearch",value:function(e,t,i){for(;t<=e;){var n=t+Math.floor((e-t)/2),r=this.getSizeAndPositionOfCell(n).offset;if(r===i)return n;r<i?t=n+1:r>i&&(e=n-1)}return t>0?t-1:0}},{key:"_exponentialSearch",value:function(e,t){for(var i=1;e<this._cellCount&&this.getSizeAndPositionOfCell(e).offset<t;)e+=i,i*=2;return this._binarySearch(Math.min(e,this._cellCount-1),Math.floor(e/2),t)}},{key:"_findNearestCell",value:function(e){if(isNaN(e))throw Error("Invalid offset ".concat(e," specified"));e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredCell(),i=Math.max(0,this._lastMeasuredIndex);return t.offset>=e?this._binarySearch(i,0,e):this._exponentialSearch(i,e)}}])}(),em=15e5,ev=0xffff8c,eS=function(){return"undefined"!=typeof window},ey=function(){return!!window.chrome},eC=function(){return eS()&&ey()?ev:em},eb=["maxScrollSize"],eT=function(){function e(t){var i=t.maxScrollSize,n=void 0===i?eC():i,r=ep()(t,eb);a()(this,e),m()(this,"_cellSizeAndPositionManager",void 0),m()(this,"_maxScrollSize",void 0),this._cellSizeAndPositionManager=new ef(r),this._maxScrollSize=n}return l()(e,[{key:"areOffsetsAdjusted",value:function(){return this._cellSizeAndPositionManager.getTotalSize()>this._maxScrollSize}},{key:"configure",value:function(e){this._cellSizeAndPositionManager.configure(e)}},{key:"getCellCount",value:function(){return this._cellSizeAndPositionManager.getCellCount()}},{key:"getEstimatedCellSize",value:function(){return this._cellSizeAndPositionManager.getEstimatedCellSize()}},{key:"getLastMeasuredIndex",value:function(){return this._cellSizeAndPositionManager.getLastMeasuredIndex()}},{key:"getOffsetAdjustment",value:function(e){var t=e.containerSize,i=e.offset,n=this._cellSizeAndPositionManager.getTotalSize(),r=this.getTotalSize();return Math.round(this._getOffsetPercentage({containerSize:t,offset:i,totalSize:r})*(r-n))}},{key:"getSizeAndPositionOfCell",value:function(e){return this._cellSizeAndPositionManager.getSizeAndPositionOfCell(e)}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function(){return this._cellSizeAndPositionManager.getSizeAndPositionOfLastMeasuredCell()}},{key:"getTotalSize",value:function(){return Math.min(this._maxScrollSize,this._cellSizeAndPositionManager.getTotalSize())}},{key:"getUpdatedOffsetForIndex",value:function(e){var t=e.align,i=void 0===t?"auto":t,n=e.containerSize,r=e.currentOffset,s=e.targetIndex;r=this._safeOffsetToOffset({containerSize:n,offset:r});var a=this._cellSizeAndPositionManager.getUpdatedOffsetForIndex({align:i,containerSize:n,currentOffset:r,targetIndex:s});return this._offsetToSafeOffset({containerSize:n,offset:a})}},{key:"getVisibleCellRange",value:function(e){var t=e.containerSize,i=e.offset;return i=this._safeOffsetToOffset({containerSize:t,offset:i}),this._cellSizeAndPositionManager.getVisibleCellRange({containerSize:t,offset:i})}},{key:"resetCell",value:function(e){this._cellSizeAndPositionManager.resetCell(e)}},{key:"_getOffsetPercentage",value:function(e){var t=e.containerSize,i=e.offset,n=e.totalSize;return n<=t?0:i/(n-t)}},{key:"_offsetToSafeOffset",value:function(e){var t=e.containerSize,i=e.offset,n=this._cellSizeAndPositionManager.getTotalSize(),r=this.getTotalSize();return n===r?i:Math.round(this._getOffsetPercentage({containerSize:t,offset:i,totalSize:n})*(r-t))}},{key:"_safeOffsetToOffset",value:function(e){var t=e.containerSize,i=e.offset,n=this._cellSizeAndPositionManager.getTotalSize(),r=this.getTotalSize();return n===r?i:Math.round(this._getOffsetPercentage({containerSize:t,offset:i,totalSize:r})*(n-t))}}])}(),eE=-1,e_=1;function eI(e){var t=e.cellCount,i=e.overscanCellsCount,n=e.scrollDirection,r=e.startIndex,s=e.stopIndex;return n===e_?{overscanStartIndex:Math.max(0,r),overscanStopIndex:Math.min(t-1,s+i)}:{overscanStartIndex:Math.max(0,r-i),overscanStopIndex:Math.min(t-1,s)}}function ew(e){var t=e.cellSize,i=e.cellSizeAndPositionManager,n=e.previousCellsCount,r=e.previousCellSize,s=e.previousScrollToAlignment,a=e.previousScrollToIndex,o=e.previousSize,l=e.scrollOffset,c=e.scrollToAlignment,d=e.scrollToIndex,u=e.size,h=e.sizeJustIncreasedFromZero,g=e.updateScrollIndexCallback,p=i.getCellCount(),f=d>=0&&d<p,m=u!==o||h||!r||"number"==typeof t&&t!==r;f&&(m||c!==s||d!==a)?g(d):!f&&p>0&&(u<o||p<n)&&l>i.getTotalSize()-u&&g(p-1)}function eP(e){for(var t=e.cellCache,i=e.cellRenderer,n=e.columnSizeAndPositionManager,r=e.columnStartIndex,s=e.columnStopIndex,a=e.deferredMeasurementCache,o=e.horizontalOffsetAdjustment,l=e.isScrolling,c=e.isScrollingOptOut,d=e.parent,u=e.rowSizeAndPositionManager,h=e.rowStartIndex,g=e.rowStopIndex,p=e.styleCache,f=e.verticalOffsetAdjustment,m=e.visibleColumnIndices,S=e.visibleRowIndices,y=[],C=n.areOffsetsAdjusted()||u.areOffsetsAdjusted(),b=!l&&!C,T=h;T<=g;T++)for(var E=u.getSizeAndPositionOfCell(T),_=r;_<=s;_++){var I=n.getSizeAndPositionOfCell(_),w=_>=m.start&&_<=m.stop&&T>=S.start&&T<=S.stop,P="".concat(T,"-").concat(_),R=void 0;b&&p[P]?R=p[P]:a&&!a.has(T,_)?R={height:"auto",left:0,position:"absolute",top:0,width:"auto"}:(R={height:E.size,left:I.offset+o,position:"absolute",top:E.offset+f,width:I.size},p[P]=R);var A={columnIndex:_,isScrolling:l,isVisible:w,key:P,parent:d,rowIndex:T,style:R},M=void 0;(c||l)&&!o&&!f?(t[P]||(t[P]=i(A)),M=t[P]):M=i(A),null!=M&&!1!==M&&(M.props.role||(M=v.cloneElement(M,{role:"gridcell"})),y.push(M))}return y}var eR=(r="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).requestAnimationFrame||r.webkitRequestAnimationFrame||r.mozRequestAnimationFrame||r.oRequestAnimationFrame||r.msRequestAnimationFrame||function(e){return r.setTimeout(e,1e3/60)},eA=r.cancelAnimationFrame||r.webkitCancelAnimationFrame||r.mozCancelAnimationFrame||r.oCancelAnimationFrame||r.msCancelAnimationFrame||function(e){r.clearTimeout(e)},eM=eR,eD=eA,eO=function(e){return eD(e.id)},ek=function(e,t){Promise.resolve().then(function(){i=Date.now()});var i,n=function(){Date.now()-i>=t?e.call():r.id=eM(n)},r={id:eM(n)};return r};function eN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function ex(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?eN(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eN(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function eL(e,t,i){return t=h()(t),d()(e,eF()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function eF(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(eF=function(){return!!e})()}var eU=150,e$="observed",eV="requested",eB=function(){return null},eH=function(e){function t(e){var i;return a()(this,t),i=eL(this,t,[e]),m()(i,"_onGridRenderedMemoizer",B()),m()(i,"_onScrollMemoizer",B(!1)),m()(i,"_deferredInvalidateColumnIndex",null),m()(i,"_deferredInvalidateRowIndex",null),m()(i,"_recomputeScrollLeftFlag",!1),m()(i,"_recomputeScrollTopFlag",!1),m()(i,"_horizontalScrollBarSize",0),m()(i,"_verticalScrollBarSize",0),m()(i,"_scrollbarPresenceChanged",!1),m()(i,"_scrollingContainer",void 0),m()(i,"_childrenToDisplay",void 0),m()(i,"_columnStartIndex",void 0),m()(i,"_columnStopIndex",void 0),m()(i,"_rowStartIndex",void 0),m()(i,"_rowStopIndex",void 0),m()(i,"_renderedColumnStartIndex",0),m()(i,"_renderedColumnStopIndex",0),m()(i,"_renderedRowStartIndex",0),m()(i,"_renderedRowStopIndex",0),m()(i,"_initialScrollTop",void 0),m()(i,"_initialScrollLeft",void 0),m()(i,"_disablePointerEventsTimeoutId",void 0),m()(i,"_styleCache",{}),m()(i,"_cellCache",{}),m()(i,"_debounceScrollEndedCallback",function(){i._disablePointerEventsTimeoutId=null,i.setState({isScrolling:!1,needToResetStyleCache:!1})}),m()(i,"_invokeOnGridRenderedHelper",function(){var e=i.props.onSectionRendered;i._onGridRenderedMemoizer({callback:e,indices:{columnOverscanStartIndex:i._columnStartIndex,columnOverscanStopIndex:i._columnStopIndex,columnStartIndex:i._renderedColumnStartIndex,columnStopIndex:i._renderedColumnStopIndex,rowOverscanStartIndex:i._rowStartIndex,rowOverscanStopIndex:i._rowStopIndex,rowStartIndex:i._renderedRowStartIndex,rowStopIndex:i._renderedRowStopIndex}})}),m()(i,"_setScrollingContainerRef",function(e){i._scrollingContainer=e,"function"==typeof i.props.elementRef?i.props.elementRef(e):"object"===eu()(i.props.elementRef)&&(i.props.elementRef.current=e)}),m()(i,"_onScroll",function(e){e.target===i._scrollingContainer&&i.handleScrollEvent(e.target)}),i.state={instanceProps:{columnSizeAndPositionManager:new eT({cellCount:e.columnCount,cellSizeGetter:function(i){return t._wrapSizeGetter(e.columnWidth)(i)},estimatedCellSize:t._getEstimatedColumnSize(e)}),rowSizeAndPositionManager:new eT({cellCount:e.rowCount,cellSizeGetter:function(i){return t._wrapSizeGetter(e.rowHeight)(i)},estimatedCellSize:t._getEstimatedRowSize(e)}),prevColumnWidth:e.columnWidth,prevRowHeight:e.rowHeight,prevColumnCount:e.columnCount,prevRowCount:e.rowCount,prevIsScrolling:!0===e.isScrolling,prevScrollToColumn:e.scrollToColumn,prevScrollToRow:e.scrollToRow,scrollbarSize:0,scrollbarSizeMeasured:!1},isScrolling:!1,scrollDirectionHorizontal:e_,scrollDirectionVertical:e_,scrollLeft:0,scrollTop:0,scrollPositionChangeReason:null,needToResetStyleCache:!1},e.scrollToRow>0&&(i._initialScrollTop=i._getCalculatedScrollTop(e,i.state)),e.scrollToColumn>0&&(i._initialScrollLeft=i._getCalculatedScrollLeft(e,i.state)),i}return p()(t,e),l()(t,[{key:"getOffsetForCell",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alignment,i=void 0===t?this.props.scrollToAlignment:t,n=e.columnIndex,r=void 0===n?this.props.scrollToColumn:n,s=e.rowIndex,a=void 0===s?this.props.scrollToRow:s,o=ex(ex({},this.props),{},{scrollToAlignment:i,scrollToColumn:r,scrollToRow:a});return{scrollLeft:this._getCalculatedScrollLeft(o),scrollTop:this._getCalculatedScrollTop(o)}}},{key:"getTotalRowsHeight",value:function(){return this.state.instanceProps.rowSizeAndPositionManager.getTotalSize()}},{key:"getTotalColumnsWidth",value:function(){return this.state.instanceProps.columnSizeAndPositionManager.getTotalSize()}},{key:"handleScrollEvent",value:function(e){var t=e.scrollLeft,i=void 0===t?0:t,n=e.scrollTop,r=void 0===n?0:n;if(!(r<0)){this._debounceScrollEnded();var s=this.props,a=s.autoHeight,o=s.autoWidth,l=s.height,c=s.width,d=this.state.instanceProps,u=d.scrollbarSize,h=d.rowSizeAndPositionManager.getTotalSize(),g=d.columnSizeAndPositionManager.getTotalSize(),p=Math.min(Math.max(0,g-c+u),i),f=Math.min(Math.max(0,h-l+u),r);if(this.state.scrollLeft!==p||this.state.scrollTop!==f){var m={isScrolling:!0,scrollDirectionHorizontal:p!==this.state.scrollLeft?p>this.state.scrollLeft?e_:eE:this.state.scrollDirectionHorizontal,scrollDirectionVertical:f!==this.state.scrollTop?f>this.state.scrollTop?e_:eE:this.state.scrollDirectionVertical,scrollPositionChangeReason:e$};a||(m.scrollTop=f),o||(m.scrollLeft=p),m.needToResetStyleCache=!1,this.setState(m)}this._invokeOnScrollMemoizer({scrollLeft:p,scrollTop:f,totalColumnsWidth:g,totalRowsHeight:h})}}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,i=e.rowIndex;this._deferredInvalidateColumnIndex="number"==typeof this._deferredInvalidateColumnIndex?Math.min(this._deferredInvalidateColumnIndex,t):t,this._deferredInvalidateRowIndex="number"==typeof this._deferredInvalidateRowIndex?Math.min(this._deferredInvalidateRowIndex,i):i}},{key:"measureAllCells",value:function(){var e=this.props,t=e.columnCount,i=e.rowCount,n=this.state.instanceProps;n.columnSizeAndPositionManager.getSizeAndPositionOfCell(t-1),n.rowSizeAndPositionManager.getSizeAndPositionOfCell(i-1)}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,i=void 0===t?0:t,n=e.rowIndex,r=void 0===n?0:n,s=this.props,a=s.scrollToColumn,o=s.scrollToRow,l=this.state.instanceProps;l.columnSizeAndPositionManager.resetCell(i),l.rowSizeAndPositionManager.resetCell(r),this._recomputeScrollLeftFlag=a>=0&&(this.state.scrollDirectionHorizontal===e_?i<=a:i>=a),this._recomputeScrollTopFlag=o>=0&&(this.state.scrollDirectionVertical===e_?r<=o:r>=o),this._styleCache={},this._cellCache={},this.forceUpdate()}},{key:"scrollToCell",value:function(e){var t=e.columnIndex,i=e.rowIndex,n=this.props.columnCount,r=this.props;n>1&&void 0!==t&&this._updateScrollLeftForScrollToColumn(ex(ex({},r),{},{scrollToColumn:t})),void 0!==i&&this._updateScrollTopForScrollToRow(ex(ex({},r),{},{scrollToRow:i}))}},{key:"componentDidMount",value:function(){var e=this.props,i=e.getScrollbarSize,n=e.height,r=e.scrollLeft,s=e.scrollToColumn,a=e.scrollTop,o=e.scrollToRow,l=e.width,c=this.state.instanceProps;if(this._initialScrollTop=0,this._initialScrollLeft=0,this._handleInvalidatedGridSize(),c.scrollbarSizeMeasured||this.setState(function(e){var t=ex(ex({},e),{},{needToResetStyleCache:!1});return t.instanceProps.scrollbarSize=i(),t.instanceProps.scrollbarSizeMeasured=!0,t}),"number"==typeof r&&r>=0||"number"==typeof a&&a>=0){var d=t._getScrollToPositionStateUpdate({prevState:this.state,scrollLeft:r,scrollTop:a});d&&(d.needToResetStyleCache=!1,this.setState(d))}this._scrollingContainer&&(this._scrollingContainer.scrollLeft!==this.state.scrollLeft&&(this._scrollingContainer.scrollLeft=this.state.scrollLeft),this._scrollingContainer.scrollTop!==this.state.scrollTop&&(this._scrollingContainer.scrollTop=this.state.scrollTop));var u=n>0&&l>0;s>=0&&u&&this._updateScrollLeftForScrollToColumn(),o>=0&&u&&this._updateScrollTopForScrollToRow(),this._invokeOnGridRenderedHelper(),this._invokeOnScrollMemoizer({scrollLeft:r||0,scrollTop:a||0,totalColumnsWidth:c.columnSizeAndPositionManager.getTotalSize(),totalRowsHeight:c.rowSizeAndPositionManager.getTotalSize()}),this._maybeCallOnScrollbarPresenceChange()}},{key:"componentDidUpdate",value:function(e,t){var i=this,n=this.props,r=n.autoHeight,s=n.autoWidth,a=n.columnCount,o=n.height,l=n.rowCount,c=n.scrollToAlignment,d=n.scrollToColumn,u=n.scrollToRow,h=n.width,g=this.state,p=g.scrollLeft,f=g.scrollPositionChangeReason,m=g.scrollTop,v=g.instanceProps;this._handleInvalidatedGridSize();var S=a>0&&0===e.columnCount||l>0&&0===e.rowCount;f===eV&&(!s&&p>=0&&(p!==this._scrollingContainer.scrollLeft||S)&&(this._scrollingContainer.scrollLeft=p),!r&&m>=0&&(m!==this._scrollingContainer.scrollTop||S)&&(this._scrollingContainer.scrollTop=m));var y=(0===e.width||0===e.height)&&o>0&&h>0;if(this._recomputeScrollLeftFlag?(this._recomputeScrollLeftFlag=!1,this._updateScrollLeftForScrollToColumn(this.props)):ew({cellSizeAndPositionManager:v.columnSizeAndPositionManager,previousCellsCount:e.columnCount,previousCellSize:e.columnWidth,previousScrollToAlignment:e.scrollToAlignment,previousScrollToIndex:e.scrollToColumn,previousSize:e.width,scrollOffset:p,scrollToAlignment:c,scrollToIndex:d,size:h,sizeJustIncreasedFromZero:y,updateScrollIndexCallback:function(){return i._updateScrollLeftForScrollToColumn(i.props)}}),this._recomputeScrollTopFlag?(this._recomputeScrollTopFlag=!1,this._updateScrollTopForScrollToRow(this.props)):ew({cellSizeAndPositionManager:v.rowSizeAndPositionManager,previousCellsCount:e.rowCount,previousCellSize:e.rowHeight,previousScrollToAlignment:e.scrollToAlignment,previousScrollToIndex:e.scrollToRow,previousSize:e.height,scrollOffset:m,scrollToAlignment:c,scrollToIndex:u,size:o,sizeJustIncreasedFromZero:y,updateScrollIndexCallback:function(){return i._updateScrollTopForScrollToRow(i.props)}}),this._invokeOnGridRenderedHelper(),p!==t.scrollLeft||m!==t.scrollTop){var C=v.rowSizeAndPositionManager.getTotalSize(),b=v.columnSizeAndPositionManager.getTotalSize();this._invokeOnScrollMemoizer({scrollLeft:p,scrollTop:m,totalColumnsWidth:b,totalRowsHeight:C})}this._maybeCallOnScrollbarPresenceChange()}},{key:"componentWillUnmount",value:function(){this._disablePointerEventsTimeoutId&&eO(this._disablePointerEventsTimeoutId)}},{key:"render",value:function(){var e=this.props,t=e.autoContainerWidth,i=e.autoHeight,n=e.autoWidth,r=e.className,s=e.containerProps,a=e.containerRole,o=e.containerStyle,l=e.height,c=e.id,d=e.noContentRenderer,u=e.role,h=e.style,g=e.tabIndex,p=e.width,f=this.state,m=f.instanceProps,S=f.needToResetStyleCache,y=this._isScrolling(),C={boxSizing:"border-box",direction:"ltr",height:i?"auto":l,position:"relative",width:n?"auto":p,WebkitOverflowScrolling:"touch",willChange:"transform"};S&&(this._styleCache={}),this.state.isScrolling||this._resetStyleCache(),this._calculateChildrenToRender(this.props,this.state);var b=m.columnSizeAndPositionManager.getTotalSize(),T=m.rowSizeAndPositionManager.getTotalSize(),E=T>l?m.scrollbarSize:0,_=b>p?m.scrollbarSize:0;(_!==this._horizontalScrollBarSize||E!==this._verticalScrollBarSize)&&(this._horizontalScrollBarSize=_,this._verticalScrollBarSize=E,this._scrollbarPresenceChanged=!0),C.overflowX=b+E<=p?"hidden":"auto",C.overflowY=T+_<=l?"hidden":"auto";var I=this._childrenToDisplay,w=0===I.length&&l>0&&p>0;return v.createElement("div",$()({ref:this._setScrollingContainerRef},s,{"aria-label":this.props["aria-label"],"aria-readonly":this.props["aria-readonly"],className:(0,V.default)("ReactVirtualized__Grid",r),id:c,onScroll:this._onScroll,role:u,style:ex(ex({},C),h),tabIndex:g}),I.length>0&&v.createElement("div",{className:"ReactVirtualized__Grid__innerScrollContainer",role:a,style:ex({width:t?"auto":b,height:T,maxWidth:b,maxHeight:T,overflow:"hidden",pointerEvents:y?"none":"",position:"relative"},o)},I),w&&d())}},{key:"_calculateChildrenToRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,i=e.cellRenderer,n=e.cellRangeRenderer,r=e.columnCount,s=e.deferredMeasurementCache,a=e.height,o=e.overscanColumnCount,l=e.overscanIndicesGetter,c=e.overscanRowCount,d=e.rowCount,u=e.width,h=e.isScrollingOptOut,g=t.scrollDirectionHorizontal,p=t.scrollDirectionVertical,f=t.instanceProps,m=this._initialScrollTop>0?this._initialScrollTop:t.scrollTop,v=this._initialScrollLeft>0?this._initialScrollLeft:t.scrollLeft,S=this._isScrolling(e,t);if(this._childrenToDisplay=[],a>0&&u>0){var y=f.columnSizeAndPositionManager.getVisibleCellRange({containerSize:u,offset:v}),C=f.rowSizeAndPositionManager.getVisibleCellRange({containerSize:a,offset:m}),b=f.columnSizeAndPositionManager.getOffsetAdjustment({containerSize:u,offset:v}),T=f.rowSizeAndPositionManager.getOffsetAdjustment({containerSize:a,offset:m});this._renderedColumnStartIndex=y.start,this._renderedColumnStopIndex=y.stop,this._renderedRowStartIndex=C.start,this._renderedRowStopIndex=C.stop;var E=l({direction:"horizontal",cellCount:r,overscanCellsCount:o,scrollDirection:g,startIndex:"number"==typeof y.start?y.start:0,stopIndex:"number"==typeof y.stop?y.stop:-1}),_=l({direction:"vertical",cellCount:d,overscanCellsCount:c,scrollDirection:p,startIndex:"number"==typeof C.start?C.start:0,stopIndex:"number"==typeof C.stop?C.stop:-1}),I=E.overscanStartIndex,w=E.overscanStopIndex,P=_.overscanStartIndex,R=_.overscanStopIndex;if(s){if(!s.hasFixedHeight()){for(var A=P;A<=R;A++)if(!s.has(A,0)){I=0,w=r-1;break}}if(!s.hasFixedWidth()){for(var M=I;M<=w;M++)if(!s.has(0,M)){P=0,R=d-1;break}}}this._childrenToDisplay=n({cellCache:this._cellCache,cellRenderer:i,columnSizeAndPositionManager:f.columnSizeAndPositionManager,columnStartIndex:I,columnStopIndex:w,deferredMeasurementCache:s,horizontalOffsetAdjustment:b,isScrolling:S,isScrollingOptOut:h,parent:this,rowSizeAndPositionManager:f.rowSizeAndPositionManager,rowStartIndex:P,rowStopIndex:R,scrollLeft:v,scrollTop:m,styleCache:this._styleCache,verticalOffsetAdjustment:T,visibleColumnIndices:y,visibleRowIndices:C}),this._columnStartIndex=I,this._columnStopIndex=w,this._rowStartIndex=P,this._rowStopIndex=R}}},{key:"_debounceScrollEnded",value:function(){var e=this.props.scrollingResetTimeInterval;this._disablePointerEventsTimeoutId&&eO(this._disablePointerEventsTimeoutId),this._disablePointerEventsTimeoutId=ek(this._debounceScrollEndedCallback,e)}},{key:"_handleInvalidatedGridSize",value:function(){if("number"==typeof this._deferredInvalidateColumnIndex&&"number"==typeof this._deferredInvalidateRowIndex){var e=this._deferredInvalidateColumnIndex,t=this._deferredInvalidateRowIndex;this._deferredInvalidateColumnIndex=null,this._deferredInvalidateRowIndex=null,this.recomputeGridSize({columnIndex:e,rowIndex:t})}}},{key:"_invokeOnScrollMemoizer",value:function(e){var t=this,i=e.scrollLeft,n=e.scrollTop,r=e.totalColumnsWidth,s=e.totalRowsHeight;this._onScrollMemoizer({callback:function(e){var i=e.scrollLeft,n=e.scrollTop,a=t.props,o=a.height;(0,a.onScroll)({clientHeight:o,clientWidth:a.width,scrollHeight:s,scrollLeft:i,scrollTop:n,scrollWidth:r})},indices:{scrollLeft:i,scrollTop:n}})}},{key:"_isScrolling",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state;return Object.hasOwnProperty.call(e,"isScrolling")?!!e.isScrolling:!!t.isScrolling}},{key:"_maybeCallOnScrollbarPresenceChange",value:function(){if(this._scrollbarPresenceChanged){var e=this.props.onScrollbarPresenceChange;this._scrollbarPresenceChanged=!1,e({horizontal:this._horizontalScrollBarSize>0,size:this.state.instanceProps.scrollbarSize,vertical:this._verticalScrollBarSize>0})}}},{key:"scrollToPosition",value:function(e){var i=e.scrollLeft,n=e.scrollTop,r=t._getScrollToPositionStateUpdate({prevState:this.state,scrollLeft:i,scrollTop:n});r&&(r.needToResetStyleCache=!1,this.setState(r))}},{key:"_getCalculatedScrollLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state;return t._getCalculatedScrollLeft(e,i)}},{key:"_updateScrollLeftForScrollToColumn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,n=t._getScrollLeftForScrollToColumnStateUpdate(e,i);n&&(n.needToResetStyleCache=!1,this.setState(n))}},{key:"_getCalculatedScrollTop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state;return t._getCalculatedScrollTop(e,i)}},{key:"_resetStyleCache",value:function(){var e=this._styleCache,t=this._cellCache,i=this.props.isScrollingOptOut;this._cellCache={},this._styleCache={};for(var n=this._rowStartIndex;n<=this._rowStopIndex;n++)for(var r=this._columnStartIndex;r<=this._columnStopIndex;r++){var s="".concat(n,"-").concat(r);this._styleCache[s]=e[s],i&&(this._cellCache[s]=t[s])}}},{key:"_updateScrollTopForScrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,n=t._getScrollTopForScrollToRowStateUpdate(e,i);n&&(n.needToResetStyleCache=!1,this.setState(n))}}],[{key:"getDerivedStateFromProps",value:function(e,i){var n,r,s={};0===e.columnCount&&0!==i.scrollLeft||0===e.rowCount&&0!==i.scrollTop?(s.scrollLeft=0,s.scrollTop=0):(e.scrollLeft!==i.scrollLeft&&e.scrollToColumn<0||e.scrollTop!==i.scrollTop&&e.scrollToRow<0)&&Object.assign(s,t._getScrollToPositionStateUpdate({prevState:i,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}));var a=i.instanceProps;return s.needToResetStyleCache=!1,(e.columnWidth!==a.prevColumnWidth||e.rowHeight!==a.prevRowHeight)&&(s.needToResetStyleCache=!0),a.columnSizeAndPositionManager.configure({cellCount:e.columnCount,estimatedCellSize:t._getEstimatedColumnSize(e),cellSizeGetter:t._wrapSizeGetter(e.columnWidth)}),a.rowSizeAndPositionManager.configure({cellCount:e.rowCount,estimatedCellSize:t._getEstimatedRowSize(e),cellSizeGetter:t._wrapSizeGetter(e.rowHeight)}),(0===a.prevColumnCount||0===a.prevRowCount)&&(a.prevColumnCount=0,a.prevRowCount=0),e.autoHeight&&!1===e.isScrolling&&!0===a.prevIsScrolling&&Object.assign(s,{isScrolling:!1}),eh({cellCount:a.prevColumnCount,cellSize:"number"==typeof a.prevColumnWidth?a.prevColumnWidth:null,computeMetadataCallback:function(){return a.columnSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:e,nextCellsCount:e.columnCount,nextCellSize:"number"==typeof e.columnWidth?e.columnWidth:null,nextScrollToIndex:e.scrollToColumn,scrollToIndex:a.prevScrollToColumn,updateScrollOffsetForScrollToIndex:function(){n=t._getScrollLeftForScrollToColumnStateUpdate(e,i)}}),eh({cellCount:a.prevRowCount,cellSize:"number"==typeof a.prevRowHeight?a.prevRowHeight:null,computeMetadataCallback:function(){return a.rowSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:e,nextCellsCount:e.rowCount,nextCellSize:"number"==typeof e.rowHeight?e.rowHeight:null,nextScrollToIndex:e.scrollToRow,scrollToIndex:a.prevScrollToRow,updateScrollOffsetForScrollToIndex:function(){r=t._getScrollTopForScrollToRowStateUpdate(e,i)}}),a.prevColumnCount=e.columnCount,a.prevColumnWidth=e.columnWidth,a.prevIsScrolling=!0===e.isScrolling,a.prevRowCount=e.rowCount,a.prevRowHeight=e.rowHeight,a.prevScrollToColumn=e.scrollToColumn,a.prevScrollToRow=e.scrollToRow,a.scrollbarSize=e.getScrollbarSize(),void 0===a.scrollbarSize?(a.scrollbarSizeMeasured=!1,a.scrollbarSize=0):a.scrollbarSizeMeasured=!0,s.instanceProps=a,ex(ex(ex({},s),n),r)}},{key:"_getEstimatedColumnSize",value:function(e){return"number"==typeof e.columnWidth?e.columnWidth:e.estimatedColumnSize}},{key:"_getEstimatedRowSize",value:function(e){return"number"==typeof e.rowHeight?e.rowHeight:e.estimatedRowSize}},{key:"_getScrollToPositionStateUpdate",value:function(e){var t=e.prevState,i=e.scrollLeft,n=e.scrollTop,r={scrollPositionChangeReason:eV};return("number"==typeof i&&i>=0&&(r.scrollDirectionHorizontal=i>t.scrollLeft?e_:eE,r.scrollLeft=i),"number"==typeof n&&n>=0&&(r.scrollDirectionVertical=n>t.scrollTop?e_:eE,r.scrollTop=n),"number"==typeof i&&i>=0&&i!==t.scrollLeft||"number"==typeof n&&n>=0&&n!==t.scrollTop)?r:{}}},{key:"_wrapSizeGetter",value:function(e){return"function"==typeof e?e:function(){return e}}},{key:"_getCalculatedScrollLeft",value:function(e,t){var i=e.columnCount,n=e.height,r=e.scrollToAlignment,s=e.scrollToColumn,a=e.width,o=t.scrollLeft,l=t.instanceProps;if(i>0){var c=i-1,d=s<0?c:Math.min(c,s),u=l.rowSizeAndPositionManager.getTotalSize(),h=l.scrollbarSizeMeasured&&u>n?l.scrollbarSize:0;return l.columnSizeAndPositionManager.getUpdatedOffsetForIndex({align:r,containerSize:a-h,currentOffset:o,targetIndex:d})}return 0}},{key:"_getScrollLeftForScrollToColumnStateUpdate",value:function(e,i){var n=i.scrollLeft,r=t._getCalculatedScrollLeft(e,i);return"number"==typeof r&&r>=0&&n!==r?t._getScrollToPositionStateUpdate({prevState:i,scrollLeft:r,scrollTop:-1}):{}}},{key:"_getCalculatedScrollTop",value:function(e,t){var i=e.height,n=e.rowCount,r=e.scrollToAlignment,s=e.scrollToRow,a=e.width,o=t.scrollTop,l=t.instanceProps;if(n>0){var c=n-1,d=s<0?c:Math.min(c,s),u=l.columnSizeAndPositionManager.getTotalSize(),h=l.scrollbarSizeMeasured&&u>a?l.scrollbarSize:0;return l.rowSizeAndPositionManager.getUpdatedOffsetForIndex({align:r,containerSize:i-h,currentOffset:o,targetIndex:d})}return 0}},{key:"_getScrollTopForScrollToRowStateUpdate",value:function(e,i){var n=i.scrollTop,r=t._getCalculatedScrollTop(e,i);return"number"==typeof r&&r>=0&&n!==r?t._getScrollToPositionStateUpdate({prevState:i,scrollLeft:-1,scrollTop:r}):{}}}])}(v.PureComponent);m()(eH,"defaultProps",{"aria-label":"grid","aria-readonly":!0,autoContainerWidth:!1,autoHeight:!1,autoWidth:!1,cellRangeRenderer:eP,containerRole:"row",containerStyle:{},estimatedColumnSize:100,estimatedRowSize:30,getScrollbarSize:j,noContentRenderer:eB,onScroll:function(){},onScrollbarPresenceChange:function(){},onSectionRendered:function(){},overscanColumnCount:0,overscanIndicesGetter:eI,overscanRowCount:10,role:"grid",scrollingResetTimeInterval:eU,scrollToAlignment:"auto",scrollToColumn:-1,scrollToRow:-1,style:{},tabIndex:0,isScrollingOptOut:!1}),b(eH);let ej=eH;var eq=1;function eW(e){var t=e.cellCount,i=e.overscanCellsCount,n=e.scrollDirection,r=e.startIndex,s=e.stopIndex;return(i=Math.max(1,i),n===eq)?{overscanStartIndex:Math.max(0,r-1),overscanStopIndex:Math.min(t-1,s+i)}:{overscanStartIndex:Math.max(0,r-i),overscanStopIndex:Math.min(t-1,s+1)}}var eG=i(559571),ez=i.n(eG);function eJ(e,t,i){return t=h()(t),d()(e,eK()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function eK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(eK=function(){return!!e})()}var eQ=function(e){function t(e,i){var n;return a()(this,t),(n=eJ(this,t,[e,i]))._loadMoreRowsMemoizer=B(),n._onRowsRendered=n._onRowsRendered.bind(n),n._registerChild=n._registerChild.bind(n),n}return p()(t,e),l()(t,[{key:"resetLoadMoreRowsCache",value:function(e){this._loadMoreRowsMemoizer=B(),e&&this._doStuff(this._lastRenderedStartIndex,this._lastRenderedStopIndex)}},{key:"render",value:function(){return(0,this.props.children)({onRowsRendered:this._onRowsRendered,registerChild:this._registerChild})}},{key:"_loadUnloadedRanges",value:function(e){var t=this,i=this.props.loadMoreRows;e.forEach(function(e){var n=i(e);n&&n.then(function(){eY({lastRenderedStartIndex:t._lastRenderedStartIndex,lastRenderedStopIndex:t._lastRenderedStopIndex,startIndex:e.startIndex,stopIndex:e.stopIndex})&&t._registeredChild&&eX(t._registeredChild,t._lastRenderedStartIndex)})})}},{key:"_onRowsRendered",value:function(e){var t=e.startIndex,i=e.stopIndex;this._lastRenderedStartIndex=t,this._lastRenderedStopIndex=i,this._doStuff(t,i)}},{key:"_doStuff",value:function(e,t){var i,n=this,r=this.props,s=r.isRowLoaded,a=r.minimumBatchSize,o=r.rowCount,l=r.threshold,c=eZ({isRowLoaded:s,minimumBatchSize:a,rowCount:o,startIndex:Math.max(0,e-l),stopIndex:Math.min(o-1,t+l)}),d=(i=[]).concat.apply(i,ez()(c.map(function(e){return[e.startIndex,e.stopIndex]})));this._loadMoreRowsMemoizer({callback:function(){n._loadUnloadedRanges(c)},indices:{squashedUnloadedRanges:d}})}},{key:"_registerChild",value:function(e){this._registeredChild=e}}])}(v.PureComponent);function eY(e){var t=e.lastRenderedStartIndex,i=e.lastRenderedStopIndex,n=e.startIndex,r=e.stopIndex;return!(n>i||r<t)}function eZ(e){for(var t=e.isRowLoaded,i=e.minimumBatchSize,n=e.rowCount,r=e.startIndex,s=e.stopIndex,a=[],o=null,l=null,c=r;c<=s;c++)t({index:c})?null!==l&&(a.push({startIndex:o,stopIndex:l}),o=l=null):(l=c,null===o&&(o=c));if(null!==l){for(var d=Math.min(Math.max(l,o+i-1),n-1),u=l+1;u<=d;u++)if(t({index:u}))break;else l=u;a.push({startIndex:o,stopIndex:l})}if(a.length)for(var h=a[0];h.stopIndex-h.startIndex+1<i&&h.startIndex>0;){var g=h.startIndex-1;if(t({index:g}))break;h.startIndex=g}return a}function eX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i="function"==typeof e.recomputeGridSize?e.recomputeGridSize:e.recomputeRowHeights;i?i.call(e,t):e.forceUpdate()}function e0(e,t,i){return t=h()(t),d()(e,e1()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function e1(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(e1=function(){return!!e})()}m()(eQ,"defaultProps",{minimumBatchSize:10,rowCount:0,threshold:15}),eQ.propTypes={};var e2=function(e){function t(){var e;a()(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=e0(this,t,[].concat(n)),m()(e,"Grid",void 0),m()(e,"_cellRenderer",function(t){var i=t.parent,n=t.rowIndex,r=t.style,s=t.isScrolling,a=t.isVisible,o=t.key,l=e.props.rowRenderer,c=Object.getOwnPropertyDescriptor(r,"width");return c&&c.writable&&(r.width="100%"),l({index:n,style:r,isScrolling:s,isVisible:a,key:o,parent:i})}),m()(e,"_setRef",function(t){e.Grid=t}),m()(e,"_onScroll",function(t){var i=t.clientHeight,n=t.scrollHeight,r=t.scrollTop;(0,e.props.onScroll)({clientHeight:i,scrollHeight:n,scrollTop:r})}),m()(e,"_onSectionRendered",function(t){var i=t.rowOverscanStartIndex,n=t.rowOverscanStopIndex,r=t.rowStartIndex,s=t.rowStopIndex;(0,e.props.onRowsRendered)({overscanStartIndex:i,overscanStopIndex:n,startIndex:r,stopIndex:s})}),e}return p()(t,e),l()(t,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,i=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:i,columnIndex:0}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,i=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:i,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,i=void 0===t?0:t,n=e.rowIndex,r=void 0===n?0:n;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:i})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e,columnIndex:0})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"render",value:function(){var e=this.props,t=e.className,i=e.noRowsRenderer,n=e.scrollToIndex,r=e.width,s=(0,V.default)("ReactVirtualized__List",t);return v.createElement(ej,$()({},this.props,{autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:s,columnWidth:r,columnCount:1,noContentRenderer:i,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:n}))}}])}(v.PureComponent);m()(e2,"defaultProps",{autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:eW,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}});var e3=i(943408),e4=i.n(e3);function e5(e,t,i,n){for(var r=i+1;t<=i;){var s=t+i>>>1;e[s]>=n?(r=s,i=s-1):t=s+1}return r}function e6(e,t,i,n,r){for(var s=i+1;t<=i;){var a=t+i>>>1;r(e[a],n)>=0?(s=a,i=a-1):t=a+1}return s}let e8=function(e,t,i,n,r){return"function"==typeof i?e6(e,void 0===n?0:0|n,void 0===r?e.length-1:0|r,t,i):e5(e,void 0===i?0:0|i,void 0===n?e.length-1:0|n,t)};var e9=0,e7=1,te=2;function tt(e,t,i,n,r){this.mid=e,this.left=t,this.right=i,this.leftPoints=n,this.rightPoints=r,this.count=(t?t.count:0)+(i?i.count:0)+n.length}var ti=tt.prototype;function tn(e,t){e.mid=t.mid,e.left=t.left,e.right=t.right,e.leftPoints=t.leftPoints,e.rightPoints=t.rightPoints,e.count=t.count}function tr(e,t){var i=tg(t);e.mid=i.mid,e.left=i.left,e.right=i.right,e.leftPoints=i.leftPoints,e.rightPoints=i.rightPoints,e.count=i.count}function ts(e,t){var i=e.intervals([]);i.push(t),tr(e,i)}function ta(e,t){var i=e.intervals([]),n=i.indexOf(t);return n<0?e9:(i.splice(n,1),tr(e,i),e7)}function to(e,t,i){for(var n=0;n<e.length&&e[n][0]<=t;++n){var r=i(e[n]);if(r)return r}}function tl(e,t,i){for(var n=e.length-1;n>=0&&e[n][1]>=t;--n){var r=i(e[n]);if(r)return r}}function tc(e,t){for(var i=0;i<e.length;++i){var n=t(e[i]);if(n)return n}}function td(e,t){return e-t}function tu(e,t){var i=e[0]-t[0];return i||e[1]-t[1]}function th(e,t){var i=e[1]-t[1];return i||e[0]-t[0]}function tg(e){if(0===e.length)return null;for(var t=[],i=0;i<e.length;++i)t.push(e[i][0],e[i][1]);t.sort(td);for(var n=t[t.length>>1],r=[],s=[],a=[],i=0;i<e.length;++i){var o=e[i];o[1]<n?r.push(o):n<o[0]?s.push(o):a.push(o)}var l=a,c=a.slice();return l.sort(tu),c.sort(th),new tt(n,tg(r),tg(s),l,c)}function tp(e){this.root=e}ti.intervals=function(e){return e.push.apply(e,this.leftPoints),this.left&&this.left.intervals(e),this.right&&this.right.intervals(e),e},ti.insert=function(e){var t=this.count-this.leftPoints.length;if(this.count+=1,e[1]<this.mid)this.left?4*(this.left.count+1)>3*(t+1)?ts(this,e):this.left.insert(e):this.left=tg([e]);else if(e[0]>this.mid)this.right?4*(this.right.count+1)>3*(t+1)?ts(this,e):this.right.insert(e):this.right=tg([e]);else{var i=e8(this.leftPoints,e,tu),n=e8(this.rightPoints,e,th);this.leftPoints.splice(i,0,e),this.rightPoints.splice(n,0,e)}},ti.remove=function(e){var t=this.count-this.leftPoints;if(e[1]<this.mid){if(!this.left)return e9;if(4*(this.right?this.right.count:0)>3*(t-1))return ta(this,e);var i=this.left.remove(e);return i===te?(this.left=null,this.count-=1,e7):(i===e7&&(this.count-=1),i)}if(e[0]>this.mid){if(!this.right)return e9;if(4*(this.left?this.left.count:0)>3*(t-1))return ta(this,e);var i=this.right.remove(e);return i===te?(this.right=null,this.count-=1,e7):(i===e7&&(this.count-=1),i)}if(1===this.count)if(this.leftPoints[0]===e)return te;else return e9;if(1===this.leftPoints.length&&this.leftPoints[0]===e){if(this.left&&this.right){for(var n=this,r=this.left;r.right;)n=r,r=r.right;if(n===this)r.right=this.right;else{var s=this.left,i=this.right;n.count-=r.count,n.right=r.left,r.left=s,r.right=i}tn(this,r),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?tn(this,this.left):tn(this,this.right);return e7}for(var s=e8(this.leftPoints,e,tu);s<this.leftPoints.length&&this.leftPoints[s][0]===e[0];++s)if(this.leftPoints[s]===e){this.count-=1,this.leftPoints.splice(s,1);for(var i=e8(this.rightPoints,e,th);i<this.rightPoints.length;++i)if(this.rightPoints[i][1]!==e[1])break;else if(this.rightPoints[i]===e)return this.rightPoints.splice(i,1),e7}return e9},ti.queryPoint=function(e,t){if(e<this.mid){if(this.left){var i=this.left.queryPoint(e,t);if(i)return i}return to(this.leftPoints,e,t)}if(!(e>this.mid))return tc(this.leftPoints,t);if(this.right){var i=this.right.queryPoint(e,t);if(i)return i}return tl(this.rightPoints,e,t)},ti.queryInterval=function(e,t,i){if(e<this.mid&&this.left){var n=this.left.queryInterval(e,t,i);if(n)return n}if(t>this.mid&&this.right){var n=this.right.queryInterval(e,t,i);if(n)return n}return t<this.mid?to(this.leftPoints,t,i):e>this.mid?tl(this.rightPoints,e,i):tc(this.leftPoints,i)};var tf=tp.prototype;function tm(e){return new tp(e&&0!==e.length?tg(e):null)}tf.insert=function(e){this.root?this.root.insert(e):this.root=new tt(e[0],null,null,[e],[e])},tf.remove=function(e){if(this.root){var t=this.root.remove(e);return t===te&&(this.root=null),t!==e9}return!1},tf.queryPoint=function(e,t){if(this.root)return this.root.queryPoint(e,t)},tf.queryInterval=function(e,t,i){if(e<=t&&this.root)return this.root.queryInterval(e,t,i)},Object.defineProperty(tf,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(tf,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});var tv=function(){function e(){a()(this,e),m()(this,"_columnSizeMap",{}),m()(this,"_intervalTree",tm()),m()(this,"_leftMap",{})}return l()(e,[{key:"estimateTotalHeight",value:function(e,t,i){var n=e-this.count;return this.tallestColumnSize+Math.ceil(n/t)*i}},{key:"range",value:function(e,t,i){var n=this;this._intervalTree.queryInterval(e,e+t,function(e){var t=e4()(e,3),r=t[0],s=(t[1],t[2]);return i(s,n._leftMap[s],r)})}},{key:"setPosition",value:function(e,t,i,n){this._intervalTree.insert([i,i+n,e]),this._leftMap[e]=t;var r=this._columnSizeMap,s=r[t];void 0===s?r[t]=i+n:r[t]=Math.max(s,i+n)}},{key:"count",get:function(){return this._intervalTree.count}},{key:"shortestColumnSize",get:function(){var e=this._columnSizeMap,t=0;for(var i in e){var n=e[i];t=0===t?n:Math.min(t,n)}return t}},{key:"tallestColumnSize",get:function(){var e=this._columnSizeMap,t=0;for(var i in e)t=Math.max(t,e[i]);return t}}])}();function tS(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function ty(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?tS(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tS(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function tC(e,t,i){return t=h()(t),d()(e,tb()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function tb(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tb=function(){return!!e})()}var tT={},tE=150,t_=function(e){function t(){var e;a()(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=tC(this,t,[].concat(n)),m()(e,"state",{isScrolling:!1,scrollTop:0}),m()(e,"_debounceResetIsScrollingId",void 0),m()(e,"_invalidateOnUpdateStartIndex",null),m()(e,"_invalidateOnUpdateStopIndex",null),m()(e,"_positionCache",new tv),m()(e,"_startIndex",null),m()(e,"_startIndexMemoized",null),m()(e,"_stopIndex",null),m()(e,"_stopIndexMemoized",null),m()(e,"_debounceResetIsScrollingCallback",function(){e.setState({isScrolling:!1})}),m()(e,"_setScrollingContainerRef",function(t){e._scrollingContainer=t}),m()(e,"_onScroll",function(t){var i=e.props.height,n=t.currentTarget.scrollTop,r=Math.min(Math.max(0,e._getEstimatedTotalHeight()-i),n);n===r&&(e._debounceResetIsScrolling(),e.state.scrollTop!==r&&e.setState({isScrolling:!0,scrollTop:r}))}),e}return p()(t,e),l()(t,[{key:"clearCellPositions",value:function(){this._positionCache=new tv,this.forceUpdate()}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.rowIndex;null===this._invalidateOnUpdateStartIndex?(this._invalidateOnUpdateStartIndex=t,this._invalidateOnUpdateStopIndex=t):(this._invalidateOnUpdateStartIndex=Math.min(this._invalidateOnUpdateStartIndex,t),this._invalidateOnUpdateStopIndex=Math.max(this._invalidateOnUpdateStopIndex,t))}},{key:"recomputeCellPositions",value:function(){var e=this._positionCache.count-1;this._positionCache=new tv,this._populatePositionCache(0,e),this.forceUpdate()}},{key:"componentDidMount",value:function(){this._checkInvalidateOnUpdate(),this._invokeOnScrollCallback(),this._invokeOnCellsRenderedCallback()}},{key:"componentDidUpdate",value:function(e,t){this._checkInvalidateOnUpdate(),this._invokeOnScrollCallback(),this._invokeOnCellsRenderedCallback(),this.props.scrollTop!==e.scrollTop&&this._debounceResetIsScrolling()}},{key:"componentWillUnmount",value:function(){this._debounceResetIsScrollingId&&eO(this._debounceResetIsScrollingId)}},{key:"render",value:function(){var e,t=this,i=this.props,n=i.autoHeight,r=i.cellCount,s=i.cellMeasurerCache,a=i.cellRenderer,o=i.className,l=i.height,c=i.id,d=i.keyMapper,u=i.overscanByPixels,h=i.role,g=i.style,p=i.tabIndex,f=i.width,S=i.rowDirection,y=this.state,C=y.isScrolling,b=y.scrollTop,T=[],E=this._getEstimatedTotalHeight(),_=this._positionCache.shortestColumnSize,I=this._positionCache.count,w=0;if(this._positionCache.range(Math.max(0,b-u),l+2*u,function(i,n,r){void 0===e?(w=i,e=i):(w=Math.min(w,i),e=Math.max(e,i)),T.push(a({index:i,isScrolling:C,key:d(i),parent:t,style:m()(m()(m()(m()({height:s.getHeight(i)},"ltr"===S?"left":"right",n),"position","absolute"),"top",r),"width",s.getWidth(i))}))}),_<b+l+u&&I<r)for(var P=Math.min(r-I,Math.ceil((b+l+u-_)/s.defaultHeight*f/s.defaultWidth)),R=I;R<I+P;R++)e=R,T.push(a({index:R,isScrolling:C,key:d(R),parent:this,style:{width:s.getWidth(R)}}));return this._startIndex=w,this._stopIndex=e,v.createElement("div",{ref:this._setScrollingContainerRef,"aria-label":this.props["aria-label"],className:(0,V.default)("ReactVirtualized__Masonry",o),id:c,onScroll:this._onScroll,role:h,style:ty({boxSizing:"border-box",direction:"ltr",height:n?"auto":l,overflowX:"hidden",overflowY:E<l?"hidden":"auto",position:"relative",width:f,WebkitOverflowScrolling:"touch",willChange:"transform"},g),tabIndex:p},v.createElement("div",{className:"ReactVirtualized__Masonry__innerScrollContainer",style:{width:"100%",height:E,maxWidth:"100%",maxHeight:E,overflow:"hidden",pointerEvents:C?"none":"",position:"relative"}},T))}},{key:"_checkInvalidateOnUpdate",value:function(){if("number"==typeof this._invalidateOnUpdateStartIndex){var e=this._invalidateOnUpdateStartIndex,t=this._invalidateOnUpdateStopIndex;this._invalidateOnUpdateStartIndex=null,this._invalidateOnUpdateStopIndex=null,this._populatePositionCache(e,t),this.forceUpdate()}}},{key:"_debounceResetIsScrolling",value:function(){var e=this.props.scrollingResetTimeInterval;this._debounceResetIsScrollingId&&eO(this._debounceResetIsScrollingId),this._debounceResetIsScrollingId=ek(this._debounceResetIsScrollingCallback,e)}},{key:"_getEstimatedTotalHeight",value:function(){var e=this.props,t=e.cellCount,i=e.cellMeasurerCache,n=Math.max(1,Math.floor(e.width/i.defaultWidth));return this._positionCache.estimateTotalHeight(t,n,i.defaultHeight)}},{key:"_invokeOnScrollCallback",value:function(){var e=this.props,t=e.height,i=e.onScroll,n=this.state.scrollTop;this._onScrollMemoized!==n&&(i({clientHeight:t,scrollHeight:this._getEstimatedTotalHeight(),scrollTop:n}),this._onScrollMemoized=n)}},{key:"_invokeOnCellsRenderedCallback",value:function(){(this._startIndexMemoized!==this._startIndex||this._stopIndexMemoized!==this._stopIndex)&&((0,this.props.onCellsRendered)({startIndex:this._startIndex,stopIndex:this._stopIndex}),this._startIndexMemoized=this._startIndex,this._stopIndexMemoized=this._stopIndex)}},{key:"_populatePositionCache",value:function(e,t){for(var i=this.props,n=i.cellMeasurerCache,r=i.cellPositioner,s=e;s<=t;s++){var a=r(s),o=a.left,l=a.top;this._positionCache.setPosition(s,o,l,n.getHeight(s))}}}],[{key:"getDerivedStateFromProps",value:function(e,t){return void 0!==e.scrollTop&&t.scrollTop!==e.scrollTop?{isScrolling:!0,scrollTop:e.scrollTop}:null}}])}(v.PureComponent);function tI(e){return e}function tw(){}m()(t_,"defaultProps",{autoHeight:!1,keyMapper:tI,onCellsRendered:tw,onScroll:tw,overscanByPixels:20,role:"grid",scrollingResetTimeInterval:tE,style:tT,tabIndex:0,rowDirection:"ltr"}),b(t_);var tP=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a()(this,e),m()(this,"_cellMeasurerCache",void 0),m()(this,"_columnIndexOffset",void 0),m()(this,"_rowIndexOffset",void 0),m()(this,"columnWidth",function(e){var i=e.index;t._cellMeasurerCache.columnWidth({index:i+t._columnIndexOffset})}),m()(this,"rowHeight",function(e){var i=e.index;t._cellMeasurerCache.rowHeight({index:i+t._rowIndexOffset})});var n=i.cellMeasurerCache,r=i.columnIndexOffset,s=void 0===r?0:r,o=i.rowIndexOffset,l=void 0===o?0:o;this._cellMeasurerCache=n,this._columnIndexOffset=s,this._rowIndexOffset=l}return l()(e,[{key:"clear",value:function(e,t){this._cellMeasurerCache.clear(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"clearAll",value:function(){this._cellMeasurerCache.clearAll()}},{key:"defaultHeight",get:function(){return this._cellMeasurerCache.defaultHeight}},{key:"defaultWidth",get:function(){return this._cellMeasurerCache.defaultWidth}},{key:"hasFixedHeight",value:function(){return this._cellMeasurerCache.hasFixedHeight()}},{key:"hasFixedWidth",value:function(){return this._cellMeasurerCache.hasFixedWidth()}},{key:"getHeight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._cellMeasurerCache.getHeight(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"getWidth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._cellMeasurerCache.getWidth(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"has",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._cellMeasurerCache.has(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"set",value:function(e,t,i,n){this._cellMeasurerCache.set(e+this._rowIndexOffset,t+this._columnIndexOffset,i,n)}}])}(),tR=["rowIndex"],tA=["columnIndex","rowIndex"],tM=["columnIndex"],tD=["onScroll","onSectionRendered","onScrollbarPresenceChange","scrollLeft","scrollToColumn","scrollTop","scrollToRow"];function tO(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function tk(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?tO(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tO(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function tN(e,t,i){return t=h()(t),d()(e,tx()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function tx(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tx=function(){return!!e})()}var tL=20,tF=function(e){function t(e,i){a()(this,t),n=tN(this,t,[e,i]),m()(n,"state",{scrollLeft:0,scrollTop:0,scrollbarSize:0,showHorizontalScrollbar:!1,showVerticalScrollbar:!1}),m()(n,"_deferredInvalidateColumnIndex",null),m()(n,"_deferredInvalidateRowIndex",null),m()(n,"_bottomLeftGridRef",function(e){n._bottomLeftGrid=e}),m()(n,"_bottomRightGridRef",function(e){n._bottomRightGrid=e}),m()(n,"_cellRendererBottomLeftGrid",function(e){var t=e.rowIndex,i=ep()(e,tR),r=n.props,s=r.cellRenderer,a=r.fixedRowCount;return t===r.rowCount-a?v.createElement("div",{key:i.key,style:tk(tk({},i.style),{},{height:tL})}):s(tk(tk({},i),{},{parent:n,rowIndex:t+a}))}),m()(n,"_cellRendererBottomRightGrid",function(e){var t=e.columnIndex,i=e.rowIndex,r=ep()(e,tA),s=n.props,a=s.cellRenderer,o=s.fixedColumnCount,l=s.fixedRowCount;return a(tk(tk({},r),{},{columnIndex:t+o,parent:n,rowIndex:i+l}))}),m()(n,"_cellRendererTopRightGrid",function(e){var t=e.columnIndex,i=ep()(e,tM),r=n.props,s=r.cellRenderer,a=r.columnCount,o=r.fixedColumnCount;return t===a-o?v.createElement("div",{key:i.key,style:tk(tk({},i.style),{},{width:tL})}):s(tk(tk({},i),{},{columnIndex:t+o,parent:n}))}),m()(n,"_columnWidthRightGrid",function(e){var t=e.index,i=n.props,r=i.columnCount,s=i.fixedColumnCount,a=i.columnWidth,o=n.state,l=o.scrollbarSize;return o.showHorizontalScrollbar&&t===r-s?l:"function"==typeof a?a({index:t+s}):a}),m()(n,"_onScroll",function(e){var t=e.scrollLeft,i=e.scrollTop;n.setState({scrollLeft:t,scrollTop:i});var r=n.props.onScroll;r&&r(e)}),m()(n,"_onScrollbarPresenceChange",function(e){var t=e.horizontal,i=e.size,r=e.vertical,s=n.state,a=s.showHorizontalScrollbar,o=s.showVerticalScrollbar;if(t!==a||r!==o){n.setState({scrollbarSize:i,showHorizontalScrollbar:t,showVerticalScrollbar:r});var l=n.props.onScrollbarPresenceChange;"function"==typeof l&&l({horizontal:t,size:i,vertical:r})}}),m()(n,"_onScrollLeft",function(e){var t=e.scrollLeft;n._onScroll({scrollLeft:t,scrollTop:n.state.scrollTop})}),m()(n,"_onScrollTop",function(e){var t=e.scrollTop;n._onScroll({scrollTop:t,scrollLeft:n.state.scrollLeft})}),m()(n,"_rowHeightBottomGrid",function(e){var t=e.index,i=n.props,r=i.fixedRowCount,s=i.rowCount,a=i.rowHeight,o=n.state,l=o.scrollbarSize;return o.showVerticalScrollbar&&t===s-r?l:"function"==typeof a?a({index:t+r}):a}),m()(n,"_topLeftGridRef",function(e){n._topLeftGrid=e}),m()(n,"_topRightGridRef",function(e){n._topRightGrid=e});var n,r=e.deferredMeasurementCache,s=e.fixedColumnCount,o=e.fixedRowCount;return n._maybeCalculateCachedStyles(!0),r&&(n._deferredMeasurementCacheBottomLeftGrid=o>0?new tP({cellMeasurerCache:r,columnIndexOffset:0,rowIndexOffset:o}):r,n._deferredMeasurementCacheBottomRightGrid=s>0||o>0?new tP({cellMeasurerCache:r,columnIndexOffset:s,rowIndexOffset:o}):r,n._deferredMeasurementCacheTopRightGrid=s>0?new tP({cellMeasurerCache:r,columnIndexOffset:s,rowIndexOffset:0}):r),n}return p()(t,e),l()(t,[{key:"forceUpdateGrids",value:function(){this._bottomLeftGrid&&this._bottomLeftGrid.forceUpdate(),this._bottomRightGrid&&this._bottomRightGrid.forceUpdate(),this._topLeftGrid&&this._topLeftGrid.forceUpdate(),this._topRightGrid&&this._topRightGrid.forceUpdate()}},{key:"invalidateCellSizeAfterRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,i=void 0===t?0:t,n=e.rowIndex,r=void 0===n?0:n;this._deferredInvalidateColumnIndex="number"==typeof this._deferredInvalidateColumnIndex?Math.min(this._deferredInvalidateColumnIndex,i):i,this._deferredInvalidateRowIndex="number"==typeof this._deferredInvalidateRowIndex?Math.min(this._deferredInvalidateRowIndex,r):r}},{key:"measureAllCells",value:function(){this._bottomLeftGrid&&this._bottomLeftGrid.measureAllCells(),this._bottomRightGrid&&this._bottomRightGrid.measureAllCells(),this._topLeftGrid&&this._topLeftGrid.measureAllCells(),this._topRightGrid&&this._topRightGrid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,i=void 0===t?0:t,n=e.rowIndex,r=void 0===n?0:n,s=this.props,a=s.fixedColumnCount,o=s.fixedRowCount,l=Math.max(0,i-a),c=Math.max(0,r-o);this._bottomLeftGrid&&this._bottomLeftGrid.recomputeGridSize({columnIndex:i,rowIndex:c}),this._bottomRightGrid&&this._bottomRightGrid.recomputeGridSize({columnIndex:l,rowIndex:c}),this._topLeftGrid&&this._topLeftGrid.recomputeGridSize({columnIndex:i,rowIndex:r}),this._topRightGrid&&this._topRightGrid.recomputeGridSize({columnIndex:l,rowIndex:r}),this._leftGridWidth=null,this._topGridHeight=null,this._maybeCalculateCachedStyles(!0)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.scrollLeft,i=e.scrollTop;if(t>0||i>0){var n={};t>0&&(n.scrollLeft=t),i>0&&(n.scrollTop=i),this.setState(n)}this._handleInvalidatedGridSize()}},{key:"componentDidUpdate",value:function(){this._handleInvalidatedGridSize()}},{key:"render",value:function(){var e=this.props,t=e.onScroll,i=e.onSectionRendered,n=(e.onScrollbarPresenceChange,e.scrollLeft,e.scrollToColumn),r=(e.scrollTop,e.scrollToRow),s=ep()(e,tD);if(this._prepareForRender(),0===this.props.width||0===this.props.height)return null;var a=this.state,o=a.scrollLeft,l=a.scrollTop;return v.createElement("div",{style:this._containerOuterStyle},v.createElement("div",{style:this._containerTopStyle},this._renderTopLeftGrid(s),this._renderTopRightGrid(tk(tk({},s),{},{onScroll:t,scrollLeft:o}))),v.createElement("div",{style:this._containerBottomStyle},this._renderBottomLeftGrid(tk(tk({},s),{},{onScroll:t,scrollTop:l})),this._renderBottomRightGrid(tk(tk({},s),{},{onScroll:t,onSectionRendered:i,scrollLeft:o,scrollToColumn:n,scrollToRow:r,scrollTop:l}))))}},{key:"_getBottomGridHeight",value:function(e){return e.height-this._getTopGridHeight(e)}},{key:"_getLeftGridWidth",value:function(e){var t=e.fixedColumnCount,i=e.columnWidth;if(null==this._leftGridWidth)if("function"==typeof i){for(var n=0,r=0;r<t;r++)n+=i({index:r});this._leftGridWidth=n}else this._leftGridWidth=i*t;return this._leftGridWidth}},{key:"_getRightGridWidth",value:function(e){return e.width-this._getLeftGridWidth(e)}},{key:"_getTopGridHeight",value:function(e){var t=e.fixedRowCount,i=e.rowHeight;if(null==this._topGridHeight)if("function"==typeof i){for(var n=0,r=0;r<t;r++)n+=i({index:r});this._topGridHeight=n}else this._topGridHeight=i*t;return this._topGridHeight}},{key:"_handleInvalidatedGridSize",value:function(){if("number"==typeof this._deferredInvalidateColumnIndex){var e=this._deferredInvalidateColumnIndex,t=this._deferredInvalidateRowIndex;this._deferredInvalidateColumnIndex=null,this._deferredInvalidateRowIndex=null,this.recomputeGridSize({columnIndex:e,rowIndex:t}),this.forceUpdate()}}},{key:"_maybeCalculateCachedStyles",value:function(e){var t=this.props,i=t.columnWidth,n=t.enableFixedColumnScroll,r=t.enableFixedRowScroll,s=t.height,a=t.fixedColumnCount,o=t.fixedRowCount,l=t.rowHeight,c=t.style,d=t.styleBottomLeftGrid,u=t.styleBottomRightGrid,h=t.styleTopLeftGrid,g=t.styleTopRightGrid,p=t.width,f=e||s!==this._lastRenderedHeight||p!==this._lastRenderedWidth,m=e||i!==this._lastRenderedColumnWidth||a!==this._lastRenderedFixedColumnCount,v=e||o!==this._lastRenderedFixedRowCount||l!==this._lastRenderedRowHeight;(e||f||c!==this._lastRenderedStyle)&&(this._containerOuterStyle=tk({height:s,overflow:"visible",width:p},c)),(e||f||v)&&(this._containerTopStyle={height:this._getTopGridHeight(this.props),position:"relative",width:p},this._containerBottomStyle={height:s-this._getTopGridHeight(this.props),overflow:"visible",position:"relative",width:p}),(e||d!==this._lastRenderedStyleBottomLeftGrid)&&(this._bottomLeftGridStyle=tk({left:0,overflowX:"hidden",overflowY:n?"auto":"hidden",position:"absolute"},d)),(e||m||u!==this._lastRenderedStyleBottomRightGrid)&&(this._bottomRightGridStyle=tk({left:this._getLeftGridWidth(this.props),position:"absolute"},u)),(e||h!==this._lastRenderedStyleTopLeftGrid)&&(this._topLeftGridStyle=tk({left:0,overflowX:"hidden",overflowY:"hidden",position:"absolute",top:0},h)),(e||m||g!==this._lastRenderedStyleTopRightGrid)&&(this._topRightGridStyle=tk({left:this._getLeftGridWidth(this.props),overflowX:r?"auto":"hidden",overflowY:"hidden",position:"absolute",top:0},g)),this._lastRenderedColumnWidth=i,this._lastRenderedFixedColumnCount=a,this._lastRenderedFixedRowCount=o,this._lastRenderedHeight=s,this._lastRenderedRowHeight=l,this._lastRenderedStyle=c,this._lastRenderedStyleBottomLeftGrid=d,this._lastRenderedStyleBottomRightGrid=u,this._lastRenderedStyleTopLeftGrid=h,this._lastRenderedStyleTopRightGrid=g,this._lastRenderedWidth=p}},{key:"_prepareForRender",value:function(){(this._lastRenderedColumnWidth!==this.props.columnWidth||this._lastRenderedFixedColumnCount!==this.props.fixedColumnCount)&&(this._leftGridWidth=null),(this._lastRenderedFixedRowCount!==this.props.fixedRowCount||this._lastRenderedRowHeight!==this.props.rowHeight)&&(this._topGridHeight=null),this._maybeCalculateCachedStyles(),this._lastRenderedColumnWidth=this.props.columnWidth,this._lastRenderedFixedColumnCount=this.props.fixedColumnCount,this._lastRenderedFixedRowCount=this.props.fixedRowCount,this._lastRenderedRowHeight=this.props.rowHeight}},{key:"_renderBottomLeftGrid",value:function(e){var t=e.enableFixedColumnScroll,i=e.fixedColumnCount,n=e.fixedRowCount,r=e.rowCount,s=e.hideBottomLeftGridScrollbar,a=this.state.showVerticalScrollbar;if(!i)return null;var o=+!!a,l=this._getBottomGridHeight(e),c=this._getLeftGridWidth(e),d=this.state.showVerticalScrollbar?this.state.scrollbarSize:0,u=s?c+d:c,h=v.createElement(ej,$()({},e,{cellRenderer:this._cellRendererBottomLeftGrid,className:this.props.classNameBottomLeftGrid,columnCount:i,deferredMeasurementCache:this._deferredMeasurementCacheBottomLeftGrid,height:l,onScroll:t?this._onScrollTop:void 0,ref:this._bottomLeftGridRef,rowCount:Math.max(0,r-n)+o,rowHeight:this._rowHeightBottomGrid,style:this._bottomLeftGridStyle,tabIndex:null,width:u}));return s?v.createElement("div",{className:"BottomLeftGrid_ScrollWrapper",style:tk(tk({},this._bottomLeftGridStyle),{},{height:l,width:c,overflowY:"hidden"})},h):h}},{key:"_renderBottomRightGrid",value:function(e){var t=e.columnCount,i=e.fixedColumnCount,n=e.fixedRowCount,r=e.rowCount,s=e.scrollToColumn,a=e.scrollToRow;return v.createElement(ej,$()({},e,{cellRenderer:this._cellRendererBottomRightGrid,className:this.props.classNameBottomRightGrid,columnCount:Math.max(0,t-i),columnWidth:this._columnWidthRightGrid,deferredMeasurementCache:this._deferredMeasurementCacheBottomRightGrid,height:this._getBottomGridHeight(e),onScroll:this._onScroll,onScrollbarPresenceChange:this._onScrollbarPresenceChange,ref:this._bottomRightGridRef,rowCount:Math.max(0,r-n),rowHeight:this._rowHeightBottomGrid,scrollToColumn:s-i,scrollToRow:a-n,style:this._bottomRightGridStyle,width:this._getRightGridWidth(e)}))}},{key:"_renderTopLeftGrid",value:function(e){var t=e.fixedColumnCount,i=e.fixedRowCount;return t&&i?v.createElement(ej,$()({},e,{className:this.props.classNameTopLeftGrid,columnCount:t,height:this._getTopGridHeight(e),ref:this._topLeftGridRef,rowCount:i,style:this._topLeftGridStyle,tabIndex:null,width:this._getLeftGridWidth(e)})):null}},{key:"_renderTopRightGrid",value:function(e){var t=e.columnCount,i=e.enableFixedRowScroll,n=e.fixedColumnCount,r=e.fixedRowCount,s=e.scrollLeft,a=e.hideTopRightGridScrollbar,o=this.state,l=o.showHorizontalScrollbar,c=o.scrollbarSize;if(!r)return null;var d=+!!l,u=this._getTopGridHeight(e),h=this._getRightGridWidth(e),g=l?c:0,p=u,f=this._topRightGridStyle;a&&(p=u+g,f=tk(tk({},this._topRightGridStyle),{},{left:0}));var m=v.createElement(ej,$()({},e,{cellRenderer:this._cellRendererTopRightGrid,className:this.props.classNameTopRightGrid,columnCount:Math.max(0,t-n)+d,columnWidth:this._columnWidthRightGrid,deferredMeasurementCache:this._deferredMeasurementCacheTopRightGrid,height:p,onScroll:i?this._onScrollLeft:void 0,ref:this._topRightGridRef,rowCount:r,scrollLeft:s,style:f,tabIndex:null,width:h}));return a?v.createElement("div",{className:"TopRightGrid_ScrollWrapper",style:tk(tk({},this._topRightGridStyle),{},{height:u,width:h,overflowX:"hidden"})},m):m}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.scrollLeft!==t.scrollLeft||e.scrollTop!==t.scrollTop?{scrollLeft:null!=e.scrollLeft&&e.scrollLeft>=0?e.scrollLeft:t.scrollLeft,scrollTop:null!=e.scrollTop&&e.scrollTop>=0?e.scrollTop:t.scrollTop}:null}}])}(v.PureComponent);function tU(e,t,i){return t=h()(t),d()(e,t$()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function t$(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t$=function(){return!!e})()}function tV(e){var t=e.className,i=e.columns,n=e.style;return v.createElement("div",{className:t,role:"row",style:n},i)}m()(tF,"defaultProps",{classNameBottomLeftGrid:"",classNameBottomRightGrid:"",classNameTopLeftGrid:"",classNameTopRightGrid:"",enableFixedColumnScroll:!1,enableFixedRowScroll:!1,fixedColumnCount:0,fixedRowCount:0,scrollToColumn:-1,scrollToRow:-1,style:{},styleBottomLeftGrid:{},styleBottomRightGrid:{},styleTopLeftGrid:{},styleTopRightGrid:{},hideTopRightGridScrollbar:!1,hideBottomLeftGridScrollbar:!1}),tF.propTypes={},b(tF),function(e){function t(e,i){var n;return a()(this,t),(n=tU(this,t,[e,i])).state={clientHeight:0,clientWidth:0,scrollHeight:0,scrollLeft:0,scrollTop:0,scrollWidth:0},n._onScroll=n._onScroll.bind(n),n}return p()(t,e),l()(t,[{key:"render",value:function(){var e=this.props.children,t=this.state,i=t.clientHeight,n=t.clientWidth,r=t.scrollHeight,s=t.scrollLeft,a=t.scrollTop,o=t.scrollWidth;return e({clientHeight:i,clientWidth:n,onScroll:this._onScroll,scrollHeight:r,scrollLeft:s,scrollTop:a,scrollWidth:o})}},{key:"_onScroll",value:function(e){var t=e.clientHeight,i=e.clientWidth,n=e.scrollHeight,r=e.scrollLeft,s=e.scrollTop,a=e.scrollWidth;this.setState({clientHeight:t,clientWidth:i,scrollHeight:n,scrollLeft:r,scrollTop:s,scrollWidth:a})}}])}(v.PureComponent).propTypes={};let tB="ASC",tH="DESC";function tj(e){var t=e.sortDirection,i=(0,V.default)("ReactVirtualized__Table__sortableHeaderIcon",{"ReactVirtualized__Table__sortableHeaderIcon--ASC":t===tB,"ReactVirtualized__Table__sortableHeaderIcon--DESC":t===tH});return v.createElement("svg",{className:i,width:18,height:18,viewBox:"0 0 24 24"},t===tB?v.createElement("path",{d:"M7 14l5-5 5 5z"}):v.createElement("path",{d:"M7 10l5 5 5-5z"}),v.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))}function tq(e){var t=e.dataKey,i=e.label,n=e.sortBy,r=e.sortDirection,s=n===t,a=[v.createElement("span",{className:"ReactVirtualized__Table__headerTruncatedText",key:"label",title:"string"==typeof i?i:null},i)];return s&&a.push(v.createElement(tj,{key:"SortIndicator",sortDirection:r})),a}function tW(e){var t=e.className,i=e.columns,n=e.index,r=e.key,s=e.onRowClick,a=e.onRowDoubleClick,o=e.onRowMouseOut,l=e.onRowMouseOver,c=e.onRowRightClick,d=e.rowData,u=e.style,h={"aria-rowindex":n+1};return(s||a||o||l||c)&&(h["aria-label"]="row",h.tabIndex=0,s&&(h.onClick=function(e){return s({event:e,index:n,rowData:d})}),a&&(h.onDoubleClick=function(e){return a({event:e,index:n,rowData:d})}),o&&(h.onMouseOut=function(e){return o({event:e,index:n,rowData:d})}),l&&(h.onMouseOver=function(e){return l({event:e,index:n,rowData:d})}),c&&(h.onContextMenu=function(e){return c({event:e,index:n,rowData:d})})),v.createElement("div",$()({},h,{className:t,key:r,role:"row",style:u}),i)}function tG(e){var t=e.cellData;return null==t?"":String(t)}function tz(e){var t=e.dataKey,i=e.rowData;return"function"==typeof i.get?i.get(t):i[t]}function tJ(e,t,i){return t=h()(t),d()(e,tK()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function tK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tK=function(){return!!e})()}tj.propTypes={};var tQ=function(e){function t(){return a()(this,t),tJ(this,t,arguments)}return p()(t,e),l()(t)}(v.Component);function tY(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function tZ(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?tY(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tY(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function tX(e,t,i){return t=h()(t),d()(e,t0()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function t0(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t0=function(){return!!e})()}m()(tQ,"defaultProps",{cellDataGetter:tz,cellRenderer:tG,defaultSortDirection:tB,flexGrow:0,flexShrink:1,headerRenderer:tq,style:{}}),tQ.propTypes={};var t1=function(e){function t(e){var i;return a()(this,t),(i=tX(this,t,[e])).state={scrollbarWidth:0},i._createColumn=i._createColumn.bind(i),i._createRow=i._createRow.bind(i),i._onScroll=i._onScroll.bind(i),i._onSectionRendered=i._onSectionRendered.bind(i),i._setRef=i._setRef.bind(i),i._setGridElementRef=i._setGridElementRef.bind(i),i}return p()(t,e),l()(t,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,i=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:i}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,i=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:i,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,i=void 0===t?0:t,n=e.rowIndex,r=void 0===n?0:n;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:i})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"getScrollbarWidth",value:function(){if(this.GridElement){var e=this.GridElement,t=e.clientWidth||0;return(e.offsetWidth||0)-t}return 0}},{key:"componentDidMount",value:function(){this._setScrollbarWidth()}},{key:"componentDidUpdate",value:function(){this._setScrollbarWidth()}},{key:"render",value:function(){var e=this,t=this.props,i=t.children,n=t.className,r=t.disableHeader,s=t.gridClassName,a=t.gridStyle,o=t.headerHeight,l=t.headerRowRenderer,c=t.height,d=t.id,u=t.noRowsRenderer,h=t.rowClassName,g=t.rowStyle,p=t.scrollToIndex,f=t.style,m=t.width,S=this.state.scrollbarWidth,y=r?c:c-o,C="function"==typeof h?h({index:-1}):h,b="function"==typeof g?g({index:-1}):g;return this._cachedColumnStyles=[],v.Children.toArray(i).forEach(function(t,i){var n=e._getFlexStyleForColumn(t,t.props.style||tQ.defaultProps.style);e._cachedColumnStyles[i]=tZ({overflow:"hidden"},n)}),v.createElement("div",{"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-colcount":v.Children.toArray(i).length,"aria-rowcount":this.props.rowCount,className:(0,V.default)("ReactVirtualized__Table",n),id:d,role:"grid",style:f},!r&&l({className:(0,V.default)("ReactVirtualized__Table__headerRow",C),columns:this._getHeaderColumns(),style:tZ({height:o,overflow:"hidden",paddingRight:S,width:m},b)}),v.createElement(ej,$()({},this.props,{elementRef:this._setGridElementRef,"aria-readonly":null,autoContainerWidth:!0,className:(0,V.default)("ReactVirtualized__Table__Grid",s),cellRenderer:this._createRow,columnWidth:m,columnCount:1,height:y,id:void 0,noContentRenderer:u,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,role:"rowgroup",scrollbarWidth:S,scrollToRow:p,style:tZ(tZ({},a),{},{overflowX:"hidden"})})))}},{key:"_createColumn",value:function(e){var t=e.column,i=e.columnIndex,n=e.isScrolling,r=e.parent,s=e.rowData,a=e.rowIndex,o=this.props.onColumnClick,l=t.props,c=l.cellDataGetter,d=l.cellRenderer,u=l.className,h=l.columnData,g=l.dataKey,p=l.id,f=d({cellData:c({columnData:h,dataKey:g,rowData:s}),columnData:h,columnIndex:i,dataKey:g,isScrolling:n,parent:r,rowData:s,rowIndex:a}),m=function(e){o&&o({columnData:h,dataKey:g,event:e})},S=this._cachedColumnStyles[i],y="string"==typeof f?f:null;return v.createElement("div",{"aria-colindex":i+1,"aria-describedby":p,className:(0,V.default)("ReactVirtualized__Table__rowColumn",u),key:"Row"+a+"-Col"+i,onClick:m,role:"gridcell",style:S,title:y},f)}},{key:"_createHeader",value:function(e){var t,i,n,r,s,a=e.column,o=e.index,l=this.props,c=l.headerClassName,d=l.headerStyle,u=l.onHeaderClick,h=l.sort,g=l.sortBy,p=l.sortDirection,f=a.props,m=f.columnData,S=f.dataKey,y=f.defaultSortDirection,C=f.disableSort,b=f.headerRenderer,T=f.id,E=f.label,_=!C&&h,I=(0,V.default)("ReactVirtualized__Table__headerColumn",c,a.props.headerClassName,{ReactVirtualized__Table__sortableHeaderColumn:_}),w=this._getFlexStyleForColumn(a,tZ(tZ({},d),a.props.headerStyle)),P=b({columnData:m,dataKey:S,disableSort:C,label:E,sortBy:g,sortDirection:p});if(_||u){var R=g!==S?y:p===tH?tB:tH,A=function(e){_&&h({defaultSortDirection:y,event:e,sortBy:S,sortDirection:R}),u&&u({columnData:m,dataKey:S,event:e})},M=function(e){("Enter"===e.key||" "===e.key)&&A(e)};s=a.props["aria-label"]||E||S,r="none",n=0,t=A,i=M}return g===S&&(r=p===tB?"ascending":"descending"),v.createElement("div",{"aria-label":s,"aria-sort":r,className:I,id:T,key:"Header-Col"+o,onClick:t,onKeyDown:i,role:"columnheader",style:w,tabIndex:n},P)}},{key:"_createRow",value:function(e){var t=this,i=e.rowIndex,n=e.isScrolling,r=e.key,s=e.parent,a=e.style,o=this.props,l=o.children,c=o.onRowClick,d=o.onRowDoubleClick,u=o.onRowRightClick,h=o.onRowMouseOver,g=o.onRowMouseOut,p=o.rowClassName,f=o.rowGetter,m=o.rowRenderer,S=o.rowStyle,y=this.state.scrollbarWidth,C="function"==typeof p?p({index:i}):p,b="function"==typeof S?S({index:i}):S,T=f({index:i}),E=v.Children.toArray(l).map(function(e,r){return t._createColumn({column:e,columnIndex:r,isScrolling:n,parent:s,rowData:T,rowIndex:i,scrollbarWidth:y})}),_=(0,V.default)("ReactVirtualized__Table__row",C),I=tZ(tZ({},a),{},{height:this._getRowHeight(i),overflow:"hidden",paddingRight:y},b);return m({className:_,columns:E,index:i,isScrolling:n,key:r,onRowClick:c,onRowDoubleClick:d,onRowRightClick:u,onRowMouseOver:h,onRowMouseOut:g,rowData:T,style:I})}},{key:"_getFlexStyleForColumn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="".concat(e.props.flexGrow," ").concat(e.props.flexShrink," ").concat(e.props.width,"px"),n=tZ(tZ({},t),{},{flex:i,msFlex:i,WebkitFlex:i});return e.props.maxWidth&&(n.maxWidth=e.props.maxWidth),e.props.minWidth&&(n.minWidth=e.props.minWidth),n}},{key:"_getHeaderColumns",value:function(){var e=this,t=this.props,i=t.children;return(t.disableHeader?[]:v.Children.toArray(i)).map(function(t,i){return e._createHeader({column:t,index:i})})}},{key:"_getRowHeight",value:function(e){var t=this.props.rowHeight;return"function"==typeof t?t({index:e}):t}},{key:"_onScroll",value:function(e){var t=e.clientHeight,i=e.scrollHeight,n=e.scrollTop;(0,this.props.onScroll)({clientHeight:t,scrollHeight:i,scrollTop:n})}},{key:"_onSectionRendered",value:function(e){var t=e.rowOverscanStartIndex,i=e.rowOverscanStopIndex,n=e.rowStartIndex,r=e.rowStopIndex;(0,this.props.onRowsRendered)({overscanStartIndex:t,overscanStopIndex:i,startIndex:n,stopIndex:r})}},{key:"_setRef",value:function(e){this.Grid=e}},{key:"_setGridElementRef",value:function(e){this.GridElement=e}},{key:"_setScrollbarWidth",value:function(){var e=this.getScrollbarWidth();this.setState({scrollbarWidth:e})}}])}(v.PureComponent);m()(t1,"defaultProps",{disableHeader:!1,estimatedRowSize:30,headerHeight:0,headerStyle:{},noRowsRenderer:function(){return null},onRowsRendered:function(){return null},onScroll:function(){return null},overscanIndicesGetter:eW,overscanRowCount:10,rowRenderer:tW,headerRowRenderer:tV,rowStyle:{},scrollToAlignment:"auto",scrollToIndex:-1,style:{}}),t1.propTypes={};var t2=[],t3=null,t4=null;function t5(){t4&&(t4=null,document.body&&null!=t3&&(document.body.style.pointerEvents=t3),t3=null)}function t6(){t5(),t2.forEach(function(e){return e.__resetIsScrolling()})}function t8(){t4&&eO(t4);var e=0;t2.forEach(function(t){e=Math.max(e,t.props.scrollingResetTimeInterval)}),t4=ek(t6,e)}function t9(e){e.currentTarget===window&&null==t3&&document.body&&(t3=document.body.style.pointerEvents,document.body.style.pointerEvents="none"),t8(),t2.forEach(function(t){t.props.scrollElement===e.currentTarget&&t.__handleWindowScrollEvent()})}function t7(e,t){t2.some(function(e){return e.props.scrollElement===t})||t.addEventListener("scroll",t9),t2.push(e)}function ie(e,t){!(t2=t2.filter(function(t){return t!==e})).length&&(t.removeEventListener("scroll",t9),t4&&(eO(t4),t5()))}var it=function(e){return e===window},ii=function(e){return e.getBoundingClientRect()};function ir(e,t){if(!e)return{height:t.serverHeight,width:t.serverWidth};if(!it(e))return ii(e);var i=window,n=i.innerHeight,r=i.innerWidth;return{height:"number"==typeof n?n:0,width:"number"==typeof r?r:0}}function is(e,t){if(it(t)&&document.documentElement){var i=document.documentElement,n=ii(e),r=ii(i);return{top:n.top-r.top,left:n.left-r.left}}var s=ia(t),a=ii(e),o=ii(t);return{top:a.top+s.top-o.top,left:a.left+s.left-o.left}}function ia(e){return it(e)&&document.documentElement?{top:"scrollY"in window?window.scrollY:document.documentElement.scrollTop,left:"scrollX"in window?window.scrollX:document.documentElement.scrollLeft}:{top:e.scrollTop,left:e.scrollLeft}}function io(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function il(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?io(Object(i),!0).forEach(function(t){m()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):io(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function ic(e,t,i){return t=h()(t),d()(e,id()?Reflect.construct(t,i||[],h()(e).constructor):t.apply(e,i))}function id(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(id=function(){return!!e})()}var iu=150,ih=function(){return"undefined"!=typeof window?window:void 0},ig=function(e){function t(){var e;a()(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=ic(this,t,[].concat(n)),m()(e,"_window",ih()),m()(e,"_isMounted",!1),m()(e,"_positionFromTop",0),m()(e,"_positionFromLeft",0),m()(e,"_detectElementResize",void 0),m()(e,"_child",void 0),m()(e,"_windowScrollerRef",v.createRef()),m()(e,"state",il(il({},ir(e.props.scrollElement,e.props)),{},{isScrolling:!1,scrollLeft:0,scrollTop:0})),m()(e,"_registerChild",function(t){!t||t instanceof Element||console.warn("WindowScroller registerChild expects to be passed Element or null"),e._child=t,e.updatePosition()}),m()(e,"_onChildScroll",function(t){var i=t.scrollTop;if(e.state.scrollTop!==i){var n=e.props.scrollElement;n&&("function"==typeof n.scrollTo?n.scrollTo(0,i+e._positionFromTop):n.scrollTop=i+e._positionFromTop)}}),m()(e,"_registerResizeListener",function(t){t===window?window.addEventListener("resize",e._onResize,!1):e._detectElementResize.addResizeListener(t,e._onResize)}),m()(e,"_unregisterResizeListener",function(t){t===window?window.removeEventListener("resize",e._onResize,!1):t&&e._detectElementResize.removeResizeListener(t,e._onResize)}),m()(e,"_onResize",function(){e.updatePosition()}),m()(e,"__handleWindowScrollEvent",function(){if(e._isMounted){var t=e.props.onScroll,i=e.props.scrollElement;if(i){var n=ia(i),r=Math.max(0,n.left-e._positionFromLeft),s=Math.max(0,n.top-e._positionFromTop);e.setState({isScrolling:!0,scrollLeft:r,scrollTop:s}),t({scrollLeft:r,scrollTop:s})}}}),m()(e,"__resetIsScrolling",function(){e.setState({isScrolling:!1})}),e}return p()(t,e),l()(t,[{key:"updatePosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.scrollElement,t=this.props.onResize,i=this.state,n=i.height,r=i.width,s=this._child||this._windowScrollerRef.current;if(s instanceof Element&&e){var a=is(s,e);this._positionFromTop=a.top,this._positionFromLeft=a.left}var o=ir(e,this.props);(n!==o.height||r!==o.width)&&(this.setState({height:o.height,width:o.width}),t({height:o.height,width:o.width})),!0===this.props.updateScrollTopOnUpdatePosition&&(this.__handleWindowScrollEvent(),this.__resetIsScrolling())}},{key:"componentDidMount",value:function(){var e=this.props.scrollElement;this._detectElementResize=P(),this.updatePosition(e),e&&(t7(this,e),this._registerResizeListener(e)),this._isMounted=!0}},{key:"componentDidUpdate",value:function(e,t){var i=this.props.scrollElement,n=e.scrollElement;n!==i&&null!=n&&null!=i&&(this.updatePosition(i),ie(this,n),t7(this,i),this._unregisterResizeListener(n),this._registerResizeListener(i))}},{key:"componentWillUnmount",value:function(){var e=this.props.scrollElement;e&&(ie(this,e),this._unregisterResizeListener(e)),this._isMounted=!1}},{key:"render",value:function(){var e=this.props.children,t=this.state,i=t.isScrolling,n=t.scrollTop,r=t.scrollLeft,s=t.height,a=t.width;return v.createElement("div",{ref:this._windowScrollerRef},e({onChildScroll:this._onChildScroll,registerChild:this._registerChild,height:s,isScrolling:i,scrollLeft:r,scrollTop:n,width:a}))}}])}(v.PureComponent);m()(ig,"defaultProps",{onResize:function(){},onScroll:function(){},scrollingResetTimeInterval:iu,scrollElement:ih(),serverHeight:0,serverWidth:0})},943062:function(e,t,i){"use strict";i.d(t,{Z:()=>d});var n=i(632735);function r(e){var t=e.lastRenderedStartIndex,i=e.lastRenderedStopIndex,n=e.startIndex,r=e.stopIndex;return!(n>i||r<t)}function s(e){for(var t=e.isItemLoaded,i=e.itemCount,n=e.minimumBatchSize,r=e.startIndex,s=e.stopIndex,a=[],o=null,l=null,c=r;c<=s;c++)t(c)?null!==l&&(a.push(o,l),o=l=null):(l=c,null===o&&(o=c));if(null!==l){for(var d=Math.min(Math.max(l,o+n-1),i-1),u=l+1;u<=d;u++)if(t(u))break;else l=u;a.push(o,l)}if(a.length)for(;a[1]-a[0]+1<n&&a[0]>0;){var h=a[0]-1;if(t(h))break;a[0]=h}return a}var a=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e};let d=function(e){function t(){a(this,t);for(var e,i,n,r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=n=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n._lastRenderedStartIndex=-1,n._lastRenderedStopIndex=-1,n._memoizedUnloadedRanges=[],n._onItemsRendered=function(e){var t=e.visibleStartIndex,i=e.visibleStopIndex;n._lastRenderedStartIndex=t,n._lastRenderedStopIndex=i,n._ensureRowsLoaded(t,i)},n._setRef=function(e){n._listRef=e},c(n,i)}return l(t,e),o(t,[{key:"resetloadMoreItemsCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._memoizedUnloadedRanges=[],e&&this._ensureRowsLoaded(this._lastRenderedStartIndex,this._lastRenderedStopIndex)}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return(0,this.props.children)({onItemsRendered:this._onItemsRendered,ref:this._setRef})}},{key:"_ensureRowsLoaded",value:function(e,t){var i=this.props,n=i.isItemLoaded,r=i.itemCount,a=i.minimumBatchSize,o=void 0===a?10:a,l=i.threshold,c=void 0===l?15:l,d=s({isItemLoaded:n,itemCount:r,minimumBatchSize:o,startIndex:Math.max(0,e-c),stopIndex:Math.min(r-1,t+c)});(this._memoizedUnloadedRanges.length!==d.length||this._memoizedUnloadedRanges.some(function(e,t){return d[t]!==e}))&&(this._memoizedUnloadedRanges=d,this._loadUnloadedRanges(d))}},{key:"_loadUnloadedRanges",value:function(e){for(var t=this,i=this.props.loadMoreItems||this.props.loadMoreRows,n=function(n){var s=e[n],a=e[n+1],o=i(s,a);null!=o&&o.then(function(){r({lastRenderedStartIndex:t._lastRenderedStartIndex,lastRenderedStopIndex:t._lastRenderedStopIndex,startIndex:s,stopIndex:a})&&null!=t._listRef&&("function"==typeof t._listRef.resetAfterIndex?t._listRef.resetAfterIndex(s,!0):("function"==typeof t._listRef._getItemStyleCache&&t._listRef._getItemStyleCache(-1),t._listRef.forceUpdate()))})},s=0;s<e.length;s+=2)n(s)}}]),t}(n.PureComponent)},721767:function(e,t,i){"use strict";i.d(t,{S_:()=>_,t7:()=>I,wy:()=>P});var n=i(385851),r=i(387143),s=i(12911),a=i(889454),o=i(632735),l=i(648518),c="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function d(e,t){t.cancelAnimationFrame(e.id)}function u(e,t,i){var n=c();function r(){c()-n>=t?e.call(null):s.id=i.requestAnimationFrame(r)}var s={id:i.requestAnimationFrame(r)};return s}var h=null;function g(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=window),null===h||e){var i=t.document.createElement("div"),n=i.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var r=t.document.createElement("div"),s=r.style;s.width="100px",s.height="100px",i.appendChild(r),t.document.body.appendChild(i),i.scrollLeft>0?h="positive-descending":(i.scrollLeft=1,h=0===i.scrollLeft?"negative":"positive-ascending"),t.document.body.removeChild(i)}return h}var p=150,f=function(e,t){return e};function m(e){var t,i,l=e.getItemOffset,c=e.getEstimatedTotalSize,h=e.getItemSize,m=e.getOffsetForIndexAndAlignment,S=e.getStartIndexForOffset,y=e.getStopIndexForStartIndex,C=e.initInstanceProps,b=e.shouldResetStyleCacheOnItemSizeChange,T=e.validateProps;return i=t=function(e){function t(t){var i;return(i=e.call(this,t)||this)._instanceProps=C(i.props,(0,s.Z)((0,s.Z)(i))),i._outerRef=void 0,i._resetIsScrollingTimeoutId=null,i._window=void 0,i.state={instance:(0,s.Z)((0,s.Z)(i)),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof i.props.initialScrollOffset?i.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},i._callOnItemsRendered=void 0,i._callOnItemsRendered=(0,a.Z)(function(e,t,n,r){return i.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:n,visibleStopIndex:r})}),i._callOnScroll=void 0,i._callOnScroll=(0,a.Z)(function(e,t,n){return i.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:n})}),i._getItemStyle=void 0,i._getItemStyle=function(e){var t,n=i.props,r=n.direction,s=n.itemSize,a=n.layout,o=i._getItemStyleCache(b&&s,b&&a,b&&r);if(o.hasOwnProperty(e))t=o[e];else{var c=l(i.props,e,i._instanceProps),d=h(i.props,e,i._instanceProps),u="horizontal"===r||"horizontal"===a,g="rtl"===r,p=u?c:0;o[e]=t={position:"absolute",left:g?void 0:p,right:g?p:void 0,top:u?0:c,height:u?"100%":d,width:u?d:"100%"}}return t},i._getItemStyleCache=void 0,i._getItemStyleCache=(0,a.Z)(function(e,t,i){return{}}),i._onScrollHorizontal=function(e){var t=e.currentTarget,n=t.clientWidth,r=t.scrollLeft,s=t.scrollWidth;i.setState(function(e){if(e.scrollOffset===r)return null;var t=i.props.direction,a=r;if("rtl"===t)switch(g(!1,i._window)){case"negative":a=-r;break;case"positive-descending":a=s-n-r}return a=Math.max(0,Math.min(a,s-n)),{isScrolling:!0,scrollDirection:e.scrollOffset<r?"forward":"backward",scrollOffset:a,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._onScrollVertical=function(e){var t=e.currentTarget,n=t.clientHeight,r=t.scrollHeight,s=t.scrollTop;i.setState(function(e){if(e.scrollOffset===s)return null;var t=Math.max(0,Math.min(s,r-n));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._outerRefSetter=function(e){var t=i.props.outerRef;i._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},i._resetIsScrollingDebounced=function(){null!==i._resetIsScrollingTimeoutId&&d(i._resetIsScrollingTimeoutId,i._window),i._resetIsScrollingTimeoutId=u(i._resetIsScrolling,p,i._window)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},function(){i._getItemStyleCache(-1,null)})},i}(0,r.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return v(e,t),T(e),null};var i=t.prototype;return i.scrollTo=function(e){e=Math.max(0,e),this.setState(function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},i.scrollToItem=function(e,t){void 0===t&&(t="auto");var i=this.props.itemCount,n=this.state.scrollOffset;e=Math.max(0,Math.min(e,i-1)),this.scrollTo(m(this.props,e,t,n,this._instanceProps))},i.componentDidMount=function(){var e=this.props,t=e.direction,i=e.initialScrollOffset,n=e.layout;if(e.window,"number"==typeof i&&null!=this._outerRef){var r=this._outerRef;"horizontal"===t||"horizontal"===n?r.scrollLeft=i:r.scrollTop=i}this._window=window,null!=this._outerRef&&this._outerRef.parentNode&&this._outerRef.parentNode.ownerDocument&&this._outerRef.parentNode.ownerDocument.defaultView&&(this._window=this._outerRef.parentNode.ownerDocument.defaultView),this._callPropsCallbacks()},i.componentDidUpdate=function(){var e=this.props,t=e.direction,i=e.layout,n=this.state,r=n.scrollOffset;if(n.scrollUpdateWasRequested&&null!=this._outerRef){var s=this._outerRef;if("horizontal"===t||"horizontal"===i)if("rtl"===t)switch(g(!1,this._window)){case"negative":s.scrollLeft=-r;break;case"positive-ascending":s.scrollLeft=r;break;default:var a=s.clientWidth,o=s.scrollWidth;s.scrollLeft=o-a-r}else s.scrollLeft=r;else s.scrollTop=r}this._callPropsCallbacks()},i.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&d(this._resetIsScrollingTimeoutId,this._window)},i.render=function(){var e=this.props,t=e.children,i=e.className,r=e.direction,s=e.height,a=e.innerRef,l=e.innerElementType,d=e.innerTagName,u=e.itemCount,h=e.itemData,g=e.itemKey,p=void 0===g?f:g,m=e.layout,v=e.outerElementType,S=e.outerTagName,y=e.style,C=e.useIsScrolling,b=e.width,T=this.state.isScrolling,E="horizontal"===r||"horizontal"===m,_=E?this._onScrollHorizontal:this._onScrollVertical,I=this._getRangeToRender(),w=I[0],P=I[1],R=[];if(u>0)for(var A=w;A<=P;A++)R.push((0,o.createElement)(t,{data:h,key:p(A,h),index:A,isScrolling:C?T:void 0,style:this._getItemStyle(A)}));var M=c(this.props,this._instanceProps);return(0,o.createElement)(v||S||"div",{className:i,onScroll:_,ref:this._outerRefSetter,style:(0,n.Z)({position:"relative",height:s,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:r},y)},(0,o.createElement)(l||d||"div",{children:R,ref:a,style:{height:E?"100%":M,pointerEvents:T?"none":void 0,width:E?M:"100%"}}))},i._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],i=e[1],n=e[2],r=e[3];this._callOnItemsRendered(t,i,n,r)}if("function"==typeof this.props.onScroll){var s=this.state,a=s.scrollDirection,o=s.scrollOffset,l=s.scrollUpdateWasRequested;this._callOnScroll(a,o,l)}},i._getRangeToRender=function(){var e=this.props,t=e.itemCount,i=e.overscanCount,n=this.state,r=(n.isScrolling,n.scrollDirection,n.scrollOffset);if(0===t)return[0,0,0,0];var s=S(this.props,r,this._instanceProps),a=y(this.props,s,r,this._instanceProps);return[Math.max(0,s-Math.max(1,i)),Math.max(0,Math.min(t-1,a+Math.max(1,i))),s,a]},t}(o.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},i}var v=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},S=50,y=function(e,t,i){var n=e.itemSize,r=i.itemMetadataMap,s=i.lastMeasuredIndex;if(t>s){var a=0;if(s>=0){var o=r[s];a=o.offset+o.size}for(var l=s+1;l<=t;l++){var c=n(l);r[l]={offset:a,size:c},a+=c}i.lastMeasuredIndex=t}return r[t]},C=function(e,t,i){var n=t.itemMetadataMap,r=t.lastMeasuredIndex;return(r>0?n[r].offset:0)>=i?b(e,t,r,0,i):T(e,t,Math.max(0,r),i)},b=function(e,t,i,n,r){for(;n<=i;){var s=n+Math.floor((i-n)/2),a=y(e,s,t).offset;if(a===r)return s;a<r?n=s+1:a>r&&(i=s-1)}return n>0?n-1:0},T=function(e,t,i,n){for(var r=e.itemCount,s=1;i<r&&y(e,i,t).offset<n;)i+=s,s*=2;return b(e,t,Math.min(i,r-1),Math.floor(i/2),n)},E=function(e,t){var i=e.itemCount,n=t.itemMetadataMap,r=t.estimatedItemSize,s=t.lastMeasuredIndex,a=0;if(s>=i&&(s=i-1),s>=0){var o=n[s];a=o.offset+o.size}return a+(i-s-1)*r},_=m({getItemOffset:function(e,t,i){return y(e,t,i).offset},getItemSize:function(e,t,i){return i.itemMetadataMap[t].size},getEstimatedTotalSize:E,getOffsetForIndexAndAlignment:function(e,t,i,n,r){var s=e.direction,a=e.height,o=e.layout,l=e.width,c="horizontal"===s||"horizontal"===o?l:a,d=y(e,t,r),u=Math.max(0,Math.min(E(e,r)-c,d.offset)),h=Math.max(0,d.offset-c+d.size);switch("smart"===i&&(i=n>=h-c&&n<=u+c?"auto":"center"),i){case"start":return u;case"end":return h;case"center":return Math.round(h+(u-h)/2);default:if(n>=h&&n<=u)return n;if(n<h)return h;return u}},getStartIndexForOffset:function(e,t,i){return C(e,i,t)},getStopIndexForStartIndex:function(e,t,i,n){for(var r=e.direction,s=e.height,a=e.itemCount,o=e.layout,l=e.width,c="horizontal"===r||"horizontal"===o?l:s,d=y(e,t,n),u=i+c,h=d.offset+d.size,g=t;g<a-1&&h<u;)h+=y(e,++g,n).size;return g},initInstanceProps:function(e,t){var i={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||S,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,n){void 0===n&&(n=!0),i.lastMeasuredIndex=Math.min(i.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),n&&t.forceUpdate()},i},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}}),I=m({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,i,n){var r=e.direction,s=e.height,a=e.itemCount,o=e.itemSize,l=e.layout,c=e.width,d="horizontal"===r||"horizontal"===l?c:s,u=Math.max(0,a*o-d),h=Math.min(u,t*o),g=Math.max(0,t*o-d+o);switch("smart"===i&&(i=n>=g-d&&n<=h+d?"auto":"center"),i){case"start":return h;case"end":return g;case"center":var p=Math.round(g+(h-g)/2);if(p<Math.ceil(d/2))return 0;if(p>u+Math.floor(d/2))return u;return p;default:if(n>=g&&n<=h)return n;if(n<g)return g;return h}},getStartIndexForOffset:function(e,t){return Math.max(0,Math.min(e.itemCount-1,Math.floor(t/e.itemSize)))},getStopIndexForStartIndex:function(e,t,i){var n=e.direction,r=e.height,s=e.itemCount,a=e.itemSize,o=e.layout,l=e.width,c=Math.ceil((("horizontal"===n||"horizontal"===o?l:r)+i-t*a)/a);return Math.max(0,Math.min(s-1,t+c-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}});function w(e,t){for(var i in e)if(!(i in t))return!0;for(var n in t)if(e[n]!==t[n])return!0;return!1}function P(e,t){var i=e.style,n=(0,l.Z)(e,["style"]),r=t.style,s=(0,l.Z)(t,["style"]);return!w(i,r)&&!w(n,s)}},976094:function(e,t,i){"use strict";var n=i(632735),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,s={},c=null,d=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:d,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},274512:function(e,t,i){"use strict";e.exports=i(976094)},567757:function(e,t,i){"use strict";i.d(t,{qC:()=>o});var n=i(632735);i(255885),i(559431),i(350999),i(917387);var r=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")},s=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e};function o(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}!function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}s(t,e),t.prototype.render=function(){return null}}(n.Component)},143891:function(module,__unused_webpack_exports,__webpack_require__){!function(e,t,i){module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):t[e]=i()}("reqwest",this,function(){var context=this||self;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else try{XHR2=__webpack_require__(546433)}catch(ex){throw Error("Peer dependency `xhr2` required! Please npm install xhr2")}var XHR2,lastValue,httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(!0===e.crossOrigin){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,i){return function(){return e._aborted?i(e.request):e._timedOut?i(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):i(e.request)))}}function setHeaders(e,t){var i,n=t.headers||{};n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var r="undefined"!=typeof FormData&&t.data instanceof FormData;for(i in t.crossOrigin||n[requestedWith]||(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||r||(n[contentType]=t.contentType||defaultHeaders.contentType),n)n.hasOwnProperty(i)&&"setRequestHeader"in e&&e.setRequestHeader(i,n[i])}function setCredentials(e,t){void 0!==t.withCredentials&&void 0!==e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,i,n){var r=uniqid++,s=e.jsonpCallback||"callback",a=e.jsonpCallbackName||reqwest.getcallbackPrefix(r),o=RegExp("((^|\\?|&)"+s+")=([^&]+)"),l=n.match(o),c=doc.createElement("script"),d=0,u=-1!==navigator.userAgent.indexOf("MSIE 10.0");return l?"?"===l[3]?n=n.replace(o,"$1="+a):a=l[3]:n=urlappend(n,s+"="+a),context[a]=generalCallback,c.type="text/javascript",c.src=n,c.async=!0,void 0===c.onreadystatechange||u||(c.htmlFor=c.id="_reqwest_"+r),c.onload=c.onreadystatechange=function(){if(c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||d)return!1;c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t(lastValue),lastValue=void 0,head.removeChild(c),d=1},head.appendChild(c),{abort:function(){c.onload=c.onreadystatechange=null,i({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(c),d=1}}}function getRequest(e,t){var i,n=this.o,r=(n.method||"GET").toUpperCase(),s="string"==typeof n?n:n.url,a=!1!==n.processData&&n.data&&"string"!=typeof n.data?reqwest.toQueryString(n.data):n.data||null,o=!1;return(("jsonp"==n.type||"GET"==r)&&a&&(s=urlappend(s,a),a=null),"jsonp"==n.type)?handleJsonp(n,e,t,s):((i=n.xhr&&n.xhr(n)||xhr(n)).open(r,s,!1!==n.async),setHeaders(i,n),setCredentials(i,n),context[xDomainRequest]&&i instanceof context[xDomainRequest]?(i.onload=e,i.onerror=t,i.onprogress=function(){},o=!0):i.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(i),o?setTimeout(function(){i.send(a)},200):i.send(a),i)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(null!==e){if(e.match("json"))return"json";if(e.match("javascript"))return"js";if(e.match("text"))return"html";if(e.match("xml"))return"xml"}}function init(o,fn){this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,i){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=i,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,i);complete(e)}fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var i,n,r,s,a=e.name,o=e.tagName.toLowerCase(),l=function(e){e&&!e.disabled&&t(a,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&a)switch(o){case"input":/reset|button|image|file/i.test(e.type)||(i=/checkbox/i.test(e.type),n=/radio/i.test(e.type),r=e.value,(!(i||n)||e.checked)&&t(a,normalize(i&&""===r?"on":r)));break;case"textarea":t(a,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())l(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(s=0;e.length&&s<e.length;s++)e.options[s].selected&&l(e.options[s])}}function eachFormElement(){var e,t,i=this,n=function(e,t){var n,r,s;for(n=0;n<t.length;n++)for(r=0,s=e[byTag](t[n]);r<s.length;r++)serial(s[r],i)};for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,i),n(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,i){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(i)):e[t]=i},arguments),e}function buildParams(e,t,i,n){var r,s,a,o=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)a=t[s],i||o.test(e)?n(e,a):buildParams(e+"["+("object"==typeof a?s:"")+"]",a,i,n);else if(t&&"[object Object]"===t.toString())for(r in t)buildParams(e+"["+r+"]",t[r],i,n);else n(e,t)}return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},catch:function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,i){e.push({name:t,value:i})},arguments),e},reqwest.serialize=function(){if(0==arguments.length)return"";var e,t,i=Array.prototype.slice.call(arguments,0);return(e=i.pop())&&e.nodeType&&i.push(e)&&(e=null),e&&(e=e.type),(t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString).apply(null,i)},reqwest.toQueryString=function(e,t){var i,n,r=t||!1,s=[],a=encodeURIComponent,o=function(e,t){t="function"==typeof t?t():null==t?"":t,s[s.length]=a(e)+"="+a(t)};if(isArray(e))for(n=0;e&&n<e.length;n++)o(e[n].name,e[n].value);else for(i in e)e.hasOwnProperty(i)&&buildParams(i,e[i],r,o);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){for(var t in e=e||{})globalSetupOptions[t]=e[t]},reqwest})},930094:function(e,t,i){"use strict";i.d(t,{_:()=>s});var n=i(695882),r=i(17122);function s(e,t){var i=(0,r.m)(e)?e:function(){return e},s=function(e){return e.error(i())};return new n.y(t?function(e){return t.schedule(s,0,e)}:s)}},681841:function(e,t,i){"use strict";i.d(t,{$:()=>d});var n=i(231191),r=i(695882),s=i(838717),a=i(629269),o=i(602480),l=i(537377),c=i(641796);function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,c.jO)(e),d=(0,a.k)(e);return d.length?new r.y(function(e){var t=d.map(function(){return[]}),r=d.map(function(){return!1});e.add(function(){t=r=null});for(var a=function(a){(0,s.Xf)(d[a]).subscribe((0,l.x)(e,function(s){if(t[a].push(s),t.every(function(e){return e.length})){var o=t.map(function(e){return e.shift()});e.next(i?i.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(o))):o),t.some(function(e,t){return!e.length&&r[t]})&&e.complete()}},function(){r[a]=!0,t[a].length||e.complete()}))},o=0;!e.closed&&o<d.length;o++)a(o);return function(){t=r=null}}):o.E}},846792:function(e,t,i){"use strict";i.d(t,{g:()=>r});var n=i(756006);function r(e,t){return(0,n.x)(function(i,n){return t?t(i[e],n[e]):i[e]===n[e]})}},345242:function(e,t,i){"use strict";i.d(t,{G:()=>s});var n=i(655634),r=i(537377);function s(){return(0,n.e)(function(e,t){var i,n=!1;e.subscribe((0,r.x)(t,function(e){var r=i;i=e,n&&t.next([r,e]),n=!0}))})}},415207:function(e,t,i){"use strict";i.d(t,{a:()=>o});var n=i(838717),r=i(611216),s=i(655634),a=i(537377);function o(e){return(0,s.e)(function(t,i){var s,o,l=!1,c=function(){s=t.subscribe((0,a.x)(i,void 0,void 0,function(t){o||(o=new r.x,(0,n.Xf)(e(o)).subscribe((0,a.x)(i,function(){return s?c():l=!0}))),o&&o.next(t)})),l&&(s.unsubscribe(),s=null,l=!1,c())};c()})}},960194:function(e,t,i){"use strict";i.d(t,{O:()=>a});var n=i(468982),r=i(641796),s=i(655634);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,r.yG)(e);return(0,s.e)(function(t,r){(i?(0,n.z)(e,t,i):(0,n.z)(e,t)).subscribe(r)})}},580990:function(e,t,i){"use strict";i.d(t,{U:()=>s,z:()=>r});var n=i(483872);function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(e)}function s(e){return 0===e.length?n.y:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}},539666:function(e,t){"use strict";function i(e,t){var i=e.length;for(e.push(t);0<i;){var n=i-1>>>1,r=e[n];if(0<s(r,t))e[n]=t,e[i]=r,i=n;else break}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;for(var n=0,r=e.length,a=r>>>1;n<a;){var o=2*(n+1)-1,l=e[o],c=o+1,d=e[c];if(0>s(l,i))c<r&&0>s(d,l)?(e[n]=d,e[c]=i,n=c):(e[n]=l,e[o]=i,n=o);else if(c<r&&0>s(d,i))e[n]=d,e[c]=i,n=c;else break}}return t}function s(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a,o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var d=[],u=[],h=1,g=null,p=3,f=!1,m=!1,v=!1,S="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,C="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var t=n(u);null!==t;){if(null===t.callback)r(u);else if(t.startTime<=e)r(u),t.sortIndex=t.expirationTime,i(d,t);else break;t=n(u)}}function T(e){if(v=!1,b(e),!m)if(null!==n(d))m=!0,k(E);else{var t=n(u);null!==t&&N(T,t.startTime-e)}}function E(e,i){m=!1,v&&(v=!1,y(w),w=-1),f=!0;var s=p;try{for(b(i),g=n(d);null!==g&&(!(g.expirationTime>i)||e&&!A());){var a=g.callback;if("function"==typeof a){g.callback=null,p=g.priorityLevel;var o=a(g.expirationTime<=i);i=t.unstable_now(),"function"==typeof o?g.callback=o:g===n(d)&&r(d),b(i)}else r(d);g=n(d)}if(null!==g)var l=!0;else{var c=n(u);null!==c&&N(T,c.startTime-i),l=!1}return l}finally{g=null,p=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _=!1,I=null,w=-1,P=5,R=-1;function A(){return!(t.unstable_now()-R<P)}function M(){if(null!==I){var e=t.unstable_now();R=e;var i=!0;try{i=I(!0,e)}finally{i?a():(_=!1,I=null)}}else _=!1}if("function"==typeof C)a=function(){C(M)};else if("undefined"!=typeof MessageChannel){var D=new MessageChannel,O=D.port2;D.port1.onmessage=M,a=function(){O.postMessage(null)}}else a=function(){S(M,0)};function k(e){I=e,_||(_=!0,a())}function N(e,i){w=S(function(){e(t.unstable_now())},i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,k(E))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(d)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var i=p;p=t;try{return e()}finally{p=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=p;p=e;try{return t()}finally{p=i}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=0x3fffffff;break;case 4:o=1e4;break;default:o=5e3}return o=s+o,e={id:h++,callback:r,priorityLevel:e,startTime:s,expirationTime:o,sortIndex:-1},s>a?(e.sortIndex=s,i(u,e),null===n(d)&&e===n(u)&&(v?(y(w),w=-1):v=!0,N(T,s-a))):(e.sortIndex=o,i(d,e),m||f||(m=!0,k(E))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var i=p;p=t;try{return e.apply(this,arguments)}finally{p=i}}}},909146:function(e,t,i){"use strict";e.exports=i(539666)},354867:function(e){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];let i=e.indexOf(t);return -1===i?[e]:[e.slice(0,i),e.slice(i+t.length)]}},434111:function(e){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)},917387:function(e,t,i){"use strict";var n;function r(e){var t,i=e.Symbol;if("function"==typeof i)if(i.observable)t=i.observable;else{t="function"==typeof i.for?i.for("https://github.com/benlesh/symbol-observable"):i("https://github.com/benlesh/symbol-observable");try{i.observable=t}catch(e){}}else t="@@observable";return t}i.d(t,{Z:()=>s}),e=i.hmd(e);let s=r(n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:e)},578521:function(e,t){"use strict";function i(e){return null!=e&&"function"==typeof e.then}function n(e){return null!=e&&"function"==typeof e.cancel}function r(e,i){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return i(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=d();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var s,a=[],o="undefined"!=typeof setImmediate;function l(e){a.push(e),1===a.length&&(o?setImmediate(c):setTimeout(c,0))}function c(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function d(){return new s.SyncTask}function u(e){return new s.SyncTask().resolve(e).promise()}function h(e){var t=d(),r=!1;return t.onCancel(function(t){e.forEach(function(e){n(e)&&s.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){i(e)?e.then(function(e){r||(r=!0,t.resolve(e))},function(e){r||(r=!0,t.reject(e))}):r||(r=!0,t.resolve(e))}),t.promise()}t.asyncCallback=l,function(e){e.SyncTask=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,i){var n=this,r=new e;return r.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,n._cancelInternal(e)}),t.task=r,this._storedCallbackSets.push(t),i?this._mustHandleError=!1:r._mustHandleError=!1,!this._resolving&&(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),r.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail)throw this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack),Error("Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected"));(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=Error("resolve"))},e._enforceErrorHandled=function(i){i._mustHandleError&&(e._rejectedTasks.push(i),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var i=e._rejectedTasks;e._rejectedTasks=[],i.forEach(function(e,i){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var i=this._cancelCallbacks;this._cancelCallbacks=[],i.length>0&&i.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var i=e;i._storedCallbackSets&&i._cancelInternal?i._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?l(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var s=this;t.successFunc?r(function(){var r=t.successFunc(s._storedResolution);n(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),i(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){s._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?l(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var s=this;t.failFunc?r(function(){var r=t.failFunc(s._storedErrResolution);n(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),i(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){s._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,i){t.config.exceptionsToConsole&&console.error(i),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,i){return e.then(t,i)})},e._rejectedTasks=[],e}()}(s||(s={})),t.all=function(e){if(0===e.length)return u([]);var t,r=d(),a=e.length,o=Array(e.length);r.onCancel(function(t){e.forEach(function(e){n(e)&&s.SyncTask.cancelOtherInternal(e,t)})});var l=function(){0==--a&&(void 0!==t?r.reject(t):r.resolve(o))};return e.forEach(function(e,n){i(e)?e.then(function(e){o[n]=e,l()},function(e){void 0===t&&(t=void 0===e||e),l()}):(o[n]=e,l())}),r.promise()},t.Defer=d,t.Resolved=u,t.Rejected=function(e){return new s.SyncTask().reject(e).promise()},t.race=h,t.raceTimer=function(e,t){var i=d(),n=setTimeout(function(){i.resolve({timedOut:!0})},t);return h([e.then(function(e){return clearTimeout(n),{timedOut:!1,result:e}}),i.promise()])}},21439:function(e,t,i){"use strict";let n;i.d(t,{AG:()=>p,BI:()=>iI,CQ:()=>E,Cc:()=>Z,EL:()=>T,GL:()=>iM,GX:()=>iE,Mf:()=>q,Mh:()=>P,SG:()=>i_,V0:()=>iw,V9:()=>j,Zb:()=>Y,Zs:()=>R,_R:()=>s,bM:()=>_,cg:()=>k,dx:()=>eX,h2:()=>iT,jF:()=>I,mZ:()=>iO,ox:()=>ib,pM:()=>iR,s8:()=>O,ti:()=>w,w9:()=>iA,yS:()=>eY,yw:()=>iP});var r=i(848331);let s="data-tabster",a="data-tabster-dummy",o="a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), *[tabindex], *[contenteditable], details > summary, audio[controls], video[controls]",l=1,c=2,d=3,u=0,h=1,g=2,p={Waiting:0,Succeeded:1,Canceled:2,TimedOut:3},f=0,m=1,v=2,S=3,y=4,C=0,b=1,T={Invisible:0,PartiallyVisible:1,Visible:2},E={Source:0,Target:1},_={Both:0,Vertical:1,Horizontal:2,Grid:3,GridLinear:4},I={ArrowUp:1,ArrowDown:2,ArrowLeft:3,ArrowRight:4,PageUp:5,PageDown:6,Home:7,End:8},w={Unlimited:0,Limited:1,LimitedTrapFocus:2},P={Enter:1,Escape:2},R={Auto:0,Inside:1,Outside:2};function A(e,t){var i;return null==(i=e.storageEntry(t))?void 0:i.tabster}function M(e,t,i){var n,r;let a,o=i||e._noop?void 0:t.getAttribute(s),l=e.storageEntry(t);if(o)if(o===(null==(n=null==l?void 0:l.attr)?void 0:n.string))return;else try{let e=JSON.parse(o);if("object"!=typeof e)throw Error(`Value is not a JSON object, got '${o}'.`);a={string:o,object:e}}catch(e){}else if(!l)return;l||(l=e.storageEntry(t,!0)),l.tabster||(l.tabster={});let c=l.tabster||{},d=(null==(r=l.attr)?void 0:r.object)||{},u=(null==a?void 0:a.object)||{};for(let i of Object.keys(d))if(!u[i]){if("root"===i){let t=c[i];t&&e.root.onRoot(t,!0)}switch(i){case"deloser":case"root":case"groupper":case"modalizer":case"restorer":case"mover":let n=c[i];n&&(n.dispose(),delete c[i]);break;case"observed":delete c[i],e.observedElement&&e.observedElement.onObservedElementUpdate(t);break;case"focusable":case"outline":case"uncontrolled":case"sys":delete c[i]}}for(let i of Object.keys(u)){let n=u.sys;switch(i){case"deloser":c.deloser?c.deloser.setProps(u.deloser):e.deloser&&(c.deloser=e.deloser.createDeloser(t,u.deloser));break;case"root":c.root?c.root.setProps(u.root):c.root=e.root.createRoot(t,u.root,n),e.root.onRoot(c.root);break;case"modalizer":c.modalizer?c.modalizer.setProps(u.modalizer):e.modalizer&&(c.modalizer=e.modalizer.createModalizer(t,u.modalizer,n));break;case"restorer":c.restorer?c.restorer.setProps(u.restorer):e.restorer&&u.restorer&&(c.restorer=e.restorer.createRestorer(t,u.restorer));break;case"focusable":c.focusable=u.focusable;break;case"groupper":c.groupper?c.groupper.setProps(u.groupper):e.groupper&&(c.groupper=e.groupper.createGroupper(t,u.groupper,n));break;case"mover":c.mover?c.mover.setProps(u.mover):e.mover&&(c.mover=e.mover.createMover(t,u.mover,n));break;case"observed":e.observedElement&&(c.observed=u.observed,e.observedElement.onObservedElementUpdate(t));break;case"uncontrolled":c.uncontrolled=u.uncontrolled;break;case"outline":e.outline&&(c.outline=u.outline);break;case"sys":c.sys=u.sys;break;default:console.error(`Unknown key '${i}' in data-tabster attribute value.`)}}a?l.attr=a:(0===Object.keys(c).length&&(delete l.tabster,delete l.attr),e.storageEntry(t,!1))}let D="tabster:focusin",O="tabster:focusout",k="tabster:movefocus",N="tabster:deloser:focus-lost",x="tabster:deloser:restore-focus",L="tabster:modalizer:active",F="tabster:modalizer:inactive",U="tabster:mover:state",$="tabster:mover:movefocus",V="tabster:mover:memorized-element",B="tabster:groupper:movefocus",H="tabster:restorer:restore-focus",j="tabster:root:focus",q="tabster:root:blur",W="undefined"!=typeof CustomEvent?CustomEvent:function(){};class G extends W{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0,detail:t}),this.details=t}}class z extends G{constructor(e){super(D,e)}}class J extends G{constructor(e){super(O,e)}}class K extends G{constructor(e){super(k,e)}}class Q extends G{constructor(e){super(U,e)}}class Y extends G{constructor(e){super($,e)}}class Z extends G{constructor(e){super(B,e)}}class X extends G{constructor(e){super(L,e)}}class ee extends G{constructor(e){super(F,e)}}class et extends G{constructor(e){super(N,e)}}class ei extends G{constructor(){super(H)}}class en extends G{constructor(e){super(j,e)}}class er extends G{constructor(e){super(q,e)}}let es={createMutationObserver:e=>new MutationObserver(e),createTreeWalker:(e,t,i,n)=>e.createTreeWalker(t,i,n),getParentNode:e=>e?e.parentNode:null,getParentElement:e=>e?e.parentElement:null,nodeContains:(e,t)=>!!(t&&(null==e?void 0:e.contains(t))),getActiveElement:e=>e.activeElement,querySelector:(e,t)=>e.querySelector(t),querySelectorAll:(e,t)=>Array.prototype.slice.call(e.querySelectorAll(t),0),getElementById:(e,t)=>e.getElementById(t),getFirstChild:e=>(null==e?void 0:e.firstChild)||null,getLastChild:e=>(null==e?void 0:e.lastChild)||null,getNextSibling:e=>(null==e?void 0:e.nextSibling)||null,getPreviousSibling:e=>(null==e?void 0:e.previousSibling)||null,getFirstElementChild:e=>(null==e?void 0:e.firstElementChild)||null,getLastElementChild:e=>(null==e?void 0:e.lastElementChild)||null,getNextElementSibling:e=>(null==e?void 0:e.nextElementSibling)||null,getPreviousElementSibling:e=>(null==e?void 0:e.previousElementSibling)||null,appendChild:(e,t)=>e.appendChild(t),insertBefore:(e,t,i)=>e.insertBefore(t,i),getSelection:e=>{var t;return(null==(t=e.ownerDocument)?void 0:t.getSelection())||null},getElementsByName:(e,t)=>e.ownerDocument.getElementsByName(t)};function ea(e){for(let t of Object.keys(e))es[t]=e[t]}let eo="undefined"!=typeof DOMRect?DOMRect:class{constructor(e,t,i,n){this.left=e||0,this.top=t||0,this.right=(e||0)+(i||0),this.bottom=(t||0)+(n||0)}},el=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),n=!1}catch(e){n=!0}let ec=100;function ed(e){let t=e(),i=t.__tabsterInstanceContext;return i||(i={elementByUId:{},basics:{Promise:t.Promise||void 0,WeakRef:t.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,fakeWeakRefs:[],fakeWeakRefsStarted:!1},t.__tabsterInstanceContext=i),i}function eu(e){let t=e.__tabsterInstanceContext;t&&(t.elementByUId={},delete t.WeakRef,t.containerBoundingRectCache={},t.containerBoundingRectCacheTimer&&e.clearTimeout(t.containerBoundingRectCacheTimer),t.fakeWeakRefsTimer&&e.clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefs=[],delete e.__tabsterInstanceContext)}function eh(e){let t=e.__tabsterInstanceContext;return new((null==t?void 0:t.basics.WeakMap)||WeakMap)}function eg(e){return!!e.querySelector(o)}class ep{constructor(e){this._target=e}deref(){return this._target}static cleanup(e,t){return!e._target||!(!t&&eM(e._target.ownerDocument,e._target))&&(delete e._target,!0)}}class ef{constructor(e,t,i){let n,r=ed(e);r.WeakRef?n=new r.WeakRef(t):(n=new ep(t),r.fakeWeakRefs.push(n)),this._ref=n,this._data=i}get(){let e,t=this._ref;return t&&((e=t.deref())||delete this._ref),e}getData(){return this._data}}function em(e,t){let i=ed(e);i.fakeWeakRefs=i.fakeWeakRefs.filter(e=>!ep.cleanup(e,t))}function ev(e){let t=ed(e);t.fakeWeakRefsStarted||(t.fakeWeakRefsStarted=!0,t.WeakRef=ek(t)),t.fakeWeakRefsTimer||(t.fakeWeakRefsTimer=e().setTimeout(()=>{t.fakeWeakRefsTimer=void 0,em(e),ev(e)},12e4))}function eS(e){let t=ed(e);t.fakeWeakRefsStarted=!1,t.fakeWeakRefsTimer&&(e().clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefsTimer=void 0,t.fakeWeakRefs=[])}function ey(e,t,i){if(t.nodeType!==Node.ELEMENT_NODE)return;let r=n?i:{acceptNode:i};return es.createTreeWalker(e,t,NodeFilter.SHOW_ELEMENT,r,!1)}function eC(e,t){let i=t.__tabsterCacheId,n=ed(e),r=i?n.containerBoundingRectCache[i]:void 0;if(r)return r.rect;let s=t.ownerDocument&&t.ownerDocument.documentElement;if(!s)return new eo;let a=0,o=0,l=s.clientWidth,c=s.clientHeight;if(t!==s){let e=t.getBoundingClientRect();a=Math.max(a,e.left),o=Math.max(o,e.top),l=Math.min(l,e.right),c=Math.min(c,e.bottom)}let d=new eo(a<l?a:-1,o<c?o:-1,a<l?l-a:0,o<c?c-o:0);return i||(t.__tabsterCacheId=i="r-"+ ++n.lastContainerBoundingRectCacheId),n.containerBoundingRectCache[i]={rect:d,element:t},n.containerBoundingRectCacheTimer||(n.containerBoundingRectCacheTimer=window.setTimeout(()=>{for(let e of(n.containerBoundingRectCacheTimer=void 0,Object.keys(n.containerBoundingRectCache)))delete n.containerBoundingRectCache[e].element.__tabsterCacheId;n.containerBoundingRectCache={}},50)),d}function eb(e,t,i){let n=eE(t);if(!n)return!1;let r=eC(e,n),s=t.getBoundingClientRect(),a=s.height*(1-i),o=Math.max(0,r.top-s.top)+Math.max(0,s.bottom-r.bottom);return 0===o||o<=a}function eT(e,t,i){let n=eE(t);if(n){let r=eC(e,n),s=t.getBoundingClientRect();i?n.scrollTop+=s.top-r.top:n.scrollTop+=s.bottom-r.bottom}}function eE(e){let t=e.ownerDocument;if(t){for(let t=es.getParentElement(e);t;t=es.getParentElement(t))if(t.scrollWidth>t.clientWidth||t.scrollHeight>t.clientHeight)return t;return t.documentElement}return null}function e_(e){e.__shouldIgnoreFocus=!0}function eI(e){return!!e.__shouldIgnoreFocus}function ew(e){let t=new Uint32Array(4);if(e.crypto&&e.crypto.getRandomValues)e.crypto.getRandomValues(t);else if(e.msCrypto&&e.msCrypto.getRandomValues)e.msCrypto.getRandomValues(t);else for(let e=0;e<t.length;e++)t[e]=0xffffffff*Math.random();let i=[];for(let e=0;e<t.length;e++)i.push(t[e].toString(36));return i.push("|"),i.push((++el).toString(36)),i.push("|"),i.push(Date.now().toString(36)),i.join("")}function eP(e,t){let i=ed(e),n=t.__tabsterElementUID;return n||(n=t.__tabsterElementUID=ew(e())),!i.elementByUId[n]&&eM(t.ownerDocument,t)&&(i.elementByUId[n]=new ef(e,t)),n}function eR(e){let t=e.__tabsterCrossOriginWindowUID;return t||(t=e.__tabsterCrossOriginWindowUID=ew(e)),t}function eA(e,t){let i=ed(e);for(let e of Object.keys(i.elementByUId)){let n=i.elementByUId[e],r=n&&n.get();(!r||!t||es.nodeContains(t,r))&&delete i.elementByUId[e]}}function eM(e,t){return es.nodeContains(null==e?void 0:e.body,t)}function eD(e,t){let i=e.matches||e.matchesSelector||e.msMatchesSelector||e.webkitMatchesSelector;return i&&i.call(e,t)}function eO(e){let t=ed(e);if(t.basics.Promise)return t.basics.Promise;throw Error("No Promise defined.")}function ek(e){return e.basics.WeakRef}let eN=0;class ex{constructor(e,t,i){let n=e.getWindow;this._tabster=e,this._element=new ef(n,t),this._props={...i},this.id="i"+ ++eN}getElement(){return this._element.get()}getProps(){return this._props}setProps(e){this._props={...e}}}class eL{constructor(e,t,i,n,s){var o;this._focusIn=e=>{if(this._fixedTarget){let e=this._fixedTarget.get();e&&(0,r.ev)(e);return}let t=this.input;if(this.onFocusIn&&t){let i=e.relatedTarget;this.onFocusIn(this,this._isBackward(!0,t,i),i)}},this._focusOut=e=>{if(this._fixedTarget)return;this.useDefaultAction=!1;let t=this.input;if(this.onFocusOut&&t){let i=e.relatedTarget;this.onFocusOut(this,this._isBackward(!1,t,i),i)}};let l=e(),c=l.document.createElement("i");c.tabIndex=0,c.setAttribute("role","none"),c.setAttribute(a,""),c.setAttribute("aria-hidden","true");let d=c.style;d.position="fixed",d.width=d.height="1px",d.opacity="0.001",d.zIndex="-1",d.setProperty("content-visibility","hidden"),e_(c),this.input=c,this.isFirst=i.isFirst,this.isOutside=t,this._isPhantom=null!=(o=i.isPhantom)&&o,this._fixedTarget=s,c.addEventListener("focusin",this._focusIn),c.addEventListener("focusout",this._focusOut),c.__tabsterDummyContainer=n,this._isPhantom&&(this._disposeTimer=l.setTimeout(()=>{delete this._disposeTimer,this.dispose()},0),this._clearDisposeTimeout=()=>{this._disposeTimer&&(l.clearTimeout(this._disposeTimer),delete this._disposeTimer),delete this._clearDisposeTimeout})}dispose(){var e;this._clearDisposeTimeout&&this._clearDisposeTimeout();let t=this.input;t&&(delete this._fixedTarget,delete this.onFocusIn,delete this.onFocusOut,delete this.input,t.removeEventListener("focusin",this._focusIn),t.removeEventListener("focusout",this._focusOut),delete t.__tabsterDummyContainer,null==(e=es.getParentNode(t))||e.removeChild(t))}setTopLeft(e,t){var i;let n=null==(i=this.input)?void 0:i.style;n&&(n.top=`${e}px`,n.left=`${t}px`)}_isBackward(e,t,i){return e&&!i?!this.isFirst:!!(i&&t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING)}}let eF=1,eU=2,e$=3,eV=4;class eB{constructor(e,t,i,n,r,s){this._element=t,this._instance=new ej(e,t,this,i,n,r,s)}_setHandlers(e,t){this._onFocusIn=e,this._onFocusOut=t}moveOut(e){var t;null==(t=this._instance)||t.moveOut(e)}moveOutWithDefaultAction(e,t){var i;null==(i=this._instance)||i.moveOutWithDefaultAction(e,t)}getHandler(e){return e?this._onFocusIn:this._onFocusOut}setTabbable(e){var t;null==(t=this._instance)||t.setTabbable(this,e)}dispose(){this._instance&&(this._instance.dispose(this),delete this._instance),delete this._onFocusIn,delete this._onFocusOut}static moveWithPhantomDummy(e,t,i,n,s){let a=new eL(e.getWindow,!0,{isPhantom:!0,isFirst:!0}).input;if(a){let o,l;if("BODY"===t.tagName)o=t,l=i&&n||!i&&!n?es.getFirstElementChild(t):null;else{let r,s;i&&(!n||n&&!e.focusable.isFocusable(t,!1,!0,!0))?(o=t,l=n?t.firstElementChild:null):(o=es.getParentElement(t),l=i&&n||!i&&!n?t:es.getNextElementSibling(t));do(s=eQ(r=i&&n||!i&&!n?es.getPreviousElementSibling(l):l))===t?l=i&&n||!i&&!n?r:es.getNextElementSibling(r):s=null;while(s)}(null==o?void 0:o.dispatchEvent(new K({by:"root",owner:o,next:null,relatedEvent:s})))&&(es.insertBefore(o,a,l),(0,r.ev)(a))}}static addPhantomDummyWithTarget(e,t,i,n){let r=new eL(e.getWindow,!0,{isPhantom:!0,isFirst:!0},void 0,new ef(e.getWindow,n)).input;if(r){let e,n;eg(t)&&!i?(e=t,n=es.getFirstElementChild(t)):(e=es.getParentElement(t),n=i?t:es.getNextElementSibling(t)),e&&es.insertBefore(e,r,n)}}}class eH{constructor(e){this._updateQueue=new Set,this._lastUpdateQueueTime=0,this._changedParents=new WeakSet,this._dummyElements=[],this._dummyCallbacks=new WeakMap,this._domChanged=e=>{var t;!this._changedParents.has(e)&&(this._changedParents.add(e),this._updateDummyInputsTimer||(this._updateDummyInputsTimer=null==(t=this._win)?void 0:t.call(this).setTimeout(()=>{for(let e of(delete this._updateDummyInputsTimer,this._dummyElements)){let t=e.get();if(t){let e=this._dummyCallbacks.get(t);if(e){let i=es.getParentNode(t);(!i||this._changedParents.has(i))&&e()}}}this._changedParents=new WeakSet},ec)))},this._win=e}add(e,t){!this._dummyCallbacks.has(e)&&this._win&&(this._dummyElements.push(new ef(this._win,e)),this._dummyCallbacks.set(e,t),this.domChanged=this._domChanged)}remove(e){this._dummyElements=this._dummyElements.filter(t=>{let i=t.get();return i&&i!==e}),this._dummyCallbacks.delete(e),0===this._dummyElements.length&&delete this.domChanged}dispose(){var e;let t=null==(e=this._win)?void 0:e.call(this);this._updateTimer&&(null==t||t.clearTimeout(this._updateTimer),delete this._updateTimer),this._updateDummyInputsTimer&&(null==t||t.clearTimeout(this._updateDummyInputsTimer),delete this._updateDummyInputsTimer),this._changedParents=new WeakSet,this._dummyCallbacks=new WeakMap,this._dummyElements=[],this._updateQueue.clear(),delete this.domChanged,delete this._win}updatePositions(e){this._win&&(this._updateQueue.add(e),this._lastUpdateQueueTime=Date.now(),this._scheduledUpdatePositions())}_scheduledUpdatePositions(){var e;this._updateTimer||(this._updateTimer=null==(e=this._win)?void 0:e.call(this).setTimeout(()=>{if(delete this._updateTimer,this._lastUpdateQueueTime+ec<=Date.now()){let e=new Map,t=[];for(let i of this._updateQueue)t.push(i(e));for(let e of(this._updateQueue.clear(),t))e();e.clear()}else this._scheduledUpdatePositions()},ec))}}class ej{constructor(e,t,i,n,s,a,o){this._wrappers=[],this._isOutside=!1,this._transformElements=new Set,this._onFocusIn=(e,t,i)=>{this._onFocus(!0,e,t,i)},this._onFocusOut=(e,t,i)=>{this._onFocus(!1,e,t,i)},this.moveOut=e=>{var t;let i=this._firstDummy,n=this._lastDummy;if(i&&n){this._ensurePosition();let s=i.input,a=n.input,o=null==(t=this._element)?void 0:t.get();if(s&&a&&o){let t;e?(s.tabIndex=0,t=s):(a.tabIndex=0,t=a),t&&(0,r.ev)(t)}}},this.moveOutWithDefaultAction=(e,t)=>{var i;let n=this._firstDummy,s=this._lastDummy;if(n&&s){this._ensurePosition();let a=n.input,o=s.input,l=null==(i=this._element)?void 0:i.get();if(a&&o&&l){let i;e?!n.isOutside&&this._tabster.focusable.isFocusable(l,!0,!0,!0)?i=l:(n.useDefaultAction=!0,a.tabIndex=0,i=a):(s.useDefaultAction=!0,o.tabIndex=0,i=o),i&&l.dispatchEvent(new K({by:"root",owner:l,next:null,relatedEvent:t}))&&(0,r.ev)(i)}}},this.setTabbable=(e,t)=>{var i,n;for(let i of this._wrappers)if(i.manager===e){i.tabbable=t;break}let r=this._getCurrent();if(r){let e=r.tabbable?0:-1,t=null==(i=this._firstDummy)?void 0:i.input;t&&(t.tabIndex=e),(t=null==(n=this._lastDummy)?void 0:n.input)&&(t.tabIndex=e)}},this._addDummyInputs=()=>{this._addTimer||(this._addTimer=this._getWindow().setTimeout(()=>{delete this._addTimer,this._ensurePosition(),this._addTransformOffsets()},0))},this._addTransformOffsets=()=>{this._tabster._dummyObserver.updatePositions(this._computeTransformOffsets)},this._computeTransformOffsets=e=>{var t,i;let n=(null==(t=this._firstDummy)?void 0:t.input)||(null==(i=this._lastDummy)?void 0:i.input),r=this._transformElements,s=new Set,a=0,o=0,l=this._getWindow();for(let t=n;t&&t.nodeType===Node.ELEMENT_NODE;t=es.getParentElement(t)){let i=e.get(t);if(void 0===i){let n=l.getComputedStyle(t).transform;n&&"none"!==n&&(i={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),e.set(t,i||null)}i&&(s.add(t),r.has(t)||t.addEventListener("scroll",this._addTransformOffsets),a+=i.scrollTop,o+=i.scrollLeft)}for(let e of r)s.has(e)||e.removeEventListener("scroll",this._addTransformOffsets);return this._transformElements=s,()=>{var e,t;null==(e=this._firstDummy)||e.setTopLeft(a,o),null==(t=this._lastDummy)||t.setTopLeft(a,o)}};let l=t.get();if(!l)throw Error("No element");this._tabster=e,this._getWindow=e.getWindow,this._callForDefaultAction=o;let c=l.__tabsterDummy;if((c||this)._wrappers.push({manager:i,priority:n,tabbable:!0}),c)return c;l.__tabsterDummy=this;let d=null==s?void 0:s.dummyInputsPosition,u=l.tagName;this._isOutside=d?d===R.Outside:(a||"UL"===u||"OL"===u||"TABLE"===u)&&"LI"!==u&&"TD"!==u&&"TH"!==u,this._firstDummy=new eL(this._getWindow,this._isOutside,{isFirst:!0},t),this._lastDummy=new eL(this._getWindow,this._isOutside,{isFirst:!1},t);let h=this._firstDummy.input;h&&e._dummyObserver.add(h,this._addDummyInputs),this._firstDummy.onFocusIn=this._onFocusIn,this._firstDummy.onFocusOut=this._onFocusOut,this._lastDummy.onFocusIn=this._onFocusIn,this._lastDummy.onFocusOut=this._onFocusOut,this._element=t,this._addDummyInputs()}dispose(e,t){var i,n,r,s;if(0===(this._wrappers=this._wrappers.filter(i=>i.manager!==e&&!t)).length){for(let e of(delete(null==(i=this._element)?void 0:i.get()).__tabsterDummy,this._transformElements))e.removeEventListener("scroll",this._addTransformOffsets);this._transformElements.clear();let e=this._getWindow();this._addTimer&&(e.clearTimeout(this._addTimer),delete this._addTimer);let t=null==(n=this._firstDummy)?void 0:n.input;t&&this._tabster._dummyObserver.remove(t),null==(r=this._firstDummy)||r.dispose(),null==(s=this._lastDummy)||s.dispose()}}_onFocus(e,t,i,n){var r;let s=this._getCurrent();s&&(!t.useDefaultAction||this._callForDefaultAction)&&(null==(r=s.manager.getHandler(e))||r(t,i,n))}_getCurrent(){return this._wrappers.sort((e,t)=>e.tabbable!==t.tabbable?e.tabbable?-1:1:e.priority-t.priority),this._wrappers[0]}_ensurePosition(){var e,t,i;let n=null==(e=this._element)?void 0:e.get(),r=null==(t=this._firstDummy)?void 0:t.input,s=null==(i=this._lastDummy)?void 0:i.input;if(n&&r&&s)if(this._isOutside){let e=es.getParentNode(n);if(e){let t=es.getNextSibling(n);t!==s&&es.insertBefore(e,s,t),es.getPreviousElementSibling(n)!==r&&es.insertBefore(e,r,n)}}else{es.getLastElementChild(n)!==s&&es.appendChild(n,s);let e=es.getFirstElementChild(n);e&&e!==r&&e.parentNode&&es.insertBefore(e.parentNode,r,e)}}}function eq(e){let t=null;for(let i=es.getLastElementChild(e);i;i=es.getLastElementChild(i))t=i;return t||void 0}function eW(e,t){let i=e,n=null;for(;i&&!n;)n=t?es.getPreviousElementSibling(i):es.getNextElementSibling(i),i=es.getParentElement(i);return n||void 0}function eG(e,t,i,n){let r=e.storageEntry(t,!0),s=!1;if(!r.aug){if(void 0===n)return s;r.aug={}}if(void 0===n){if(i in r.aug){let e=r.aug[i];delete r.aug[i],null===e?t.removeAttribute(i):t.setAttribute(i,e),s=!0}}else{let e;i in r.aug||(e=t.getAttribute(i)),void 0!==e&&e!==n&&(r.aug[i]=e,null===n?t.removeAttribute(i):t.setAttribute(i,n),s=!0)}return void 0===n&&0===Object.keys(r.aug).length&&(delete r.aug,e.storageEntry(t,!1)),s}function ez(e){var t,i;let n=e.ownerDocument,r=null==(t=n.defaultView)?void 0:t.getComputedStyle(e);return null===e.offsetParent&&n.body!==e&&(null==r?void 0:r.position)!=="fixed"||(null==r?void 0:r.visibility)==="hidden"||(null==r?void 0:r.position)==="fixed"&&("none"===r.display||(null==(i=e.parentElement)?void 0:i.offsetParent)===null&&n.body!==e.parentElement)||!1}function eJ(e){return"INPUT"===e.tagName&&!!e.name&&"radio"===e.type}function eK(e){let t;if(!eJ(e))return;let i=e.name,n=Array.from(es.getElementsByName(e,i));return{name:i,buttons:new Set(n=n.filter(e=>!!eJ(e)&&(e.checked&&(t=e),!0))),checked:t}}function eQ(e){var t;return(null==(t=null==e?void 0:e.__tabsterDummyContainer)?void 0:t.get())||null}function eY(e,t){let i=JSON.stringify(e);return!0===t?i:{[s]:i}}function eZ(e,t){for(let i of Object.keys(t)){let n=t[i];n?e[i]=n:delete e[i]}}function eX(e,t,i){let n;if(i){let t=e.getAttribute(s);if(t)try{n=JSON.parse(t)}catch(e){}}n||(n={}),eZ(n,t),Object.keys(n).length>0?e.setAttribute(s,eY(n,!0)):e.removeAttribute(s)}class e0 extends eB{constructor(e,t,i,n){super(e,t,eF,n,void 0,!0),this._onDummyInputFocus=e=>{var t;if(e.useDefaultAction)this._setFocused(!1);else{this._tabster.keyboardNavigation.setNavigatingWithKeyboard(!0);let i=this._element.get();if(i){this._setFocused(!0);let t=this._tabster.focusedElement.getFirstOrLastTabbable(e.isFirst,{container:i,ignoreAccessibility:!0});if(t)return void(0,r.ev)(t)}null==(t=e.input)||t.blur()}},this._setHandlers(this._onDummyInputFocus),this._tabster=e,this._setFocused=i}}class e1 extends ex{constructor(e,t,i,n,s){super(e,t,n),this._isFocused=!1,this._setFocused=e=>{var t;if(this._setFocusedTimer&&(this._tabster.getWindow().clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._isFocused===e)return;let i=this._element.get();i&&(e?(this._isFocused=!0,null==(t=this._dummyManager)||t.setTabbable(!1),i.dispatchEvent(new en({element:i}))):this._setFocusedTimer=this._tabster.getWindow().setTimeout(()=>{var e;delete this._setFocusedTimer,this._isFocused=!1,null==(e=this._dummyManager)||e.setTabbable(!0),i.dispatchEvent(new er({element:i}))},0))},this._onFocusIn=e=>{let t=this._tabster.getParent,i=this._element.get(),n=e.composedPath()[0];do{if(n===i)return void this._setFocused(!0);n=n&&t(n)}while(n)},this._onFocusOut=()=>{this._setFocused(!1)},this._onDispose=i;let a=e.getWindow;this.uid=eP(a,t),this._sys=s,(e.controlTab||e.rootDummyInputs)&&this.addDummyInputs();let o=a().document;o.addEventListener(r.PW,this._onFocusIn),o.addEventListener(r.r$,this._onFocusOut),this._add()}addDummyInputs(){this._dummyManager||(this._dummyManager=new e0(this._tabster,this._element,this._setFocused,this._sys))}dispose(){var e;this._onDispose(this);let t=this._tabster.getWindow(),i=t.document;i.removeEventListener(r.PW,this._onFocusIn),i.removeEventListener(r.r$,this._onFocusOut),this._setFocusedTimer&&(t.clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),null==(e=this._dummyManager)||e.dispose(),this._remove()}moveOutWithDefaultAction(e,t){let i=this._dummyManager;if(i)i.moveOutWithDefaultAction(e,t);else{let i=this.getElement();i&&e0.moveWithPhantomDummy(this._tabster,i,!0,e,t)}}_add(){}_remove(){}}class e2{constructor(e,t){this._autoRootWaiting=!1,this._roots={},this._forceDummy=!1,this.rootById={},this._autoRootCreate=()=>{var e;let t=this._win().document,i=t.body;if(i){this._autoRootUnwait(t);let n=this._autoRoot;if(n)return eX(i,{root:n},!0),M(this._tabster,i),null==(e=A(this._tabster,i))?void 0:e.root}else this._autoRootWaiting||(this._autoRootWaiting=!0,t.addEventListener("readystatechange",this._autoRootCreate))},this._onRootDispose=e=>{delete this._roots[e.id]},this._tabster=e,this._win=e.getWindow,this._autoRoot=t,e.queueInit(()=>{this._autoRoot&&this._autoRootCreate()})}_autoRootUnwait(e){e.removeEventListener("readystatechange",this._autoRootCreate),this._autoRootWaiting=!1}dispose(){let e=this._win();this._autoRootUnwait(e.document),delete this._autoRoot,Object.keys(this._roots).forEach(e=>{this._roots[e]&&(this._roots[e].dispose(),delete this._roots[e])}),this.rootById={}}createRoot(e,t,i){let n=new e1(this._tabster,e,this._onRootDispose,t,i);return this._roots[n.id]=n,this._forceDummy&&n.addDummyInputs(),n}addDummyInputs(){this._forceDummy=!0;let e=this._roots;for(let t of Object.keys(e))e[t].addDummyInputs()}static getRootByUId(e,t){let i=e().__tabsterInstance;return i&&i.root.rootById[t]}static getTabsterContext(e,t,i){var n,r,s,a;let o,l,c,d,u,h,g,p;if(void 0===i&&(i={}),!t.ownerDocument)return;let{checkRtl:f,referenceElement:m}=i,v=e.getParent;e.drainInitQueue();let S=!1,y=m||t,C={};for(;y&&(!o||f);){let i=A(e,y);if(f&&void 0===g){let e=y.dir;e&&(g="rtl"===e.toLowerCase())}if(!i){y=v(y);continue}let a=y.tagName;(i.uncontrolled||"IFRAME"===a||"WEBVIEW"===a)&&e.focusable.isVisible(y)&&(p=y),!d&&(null==(n=i.focusable)?void 0:n.excludeFromMover)&&!c&&(S=!0);let m=i.modalizer,b=i.groupper,T=i.mover;!l&&m&&(l=m),!c&&b&&(!l||m)&&(l?(!b.isActive()&&b.getProps().tabbability&&l.userId!==(null==(r=e.modalizer)?void 0:r.activeId)&&(l=void 0,c=b),h=b):c=b),!d&&T&&(!l||m)&&(!b||y!==t)&&y.contains(t)&&(d=T,u=!!c&&c!==b),i.root&&(o=i.root),(null==(s=i.focusable)?void 0:s.ignoreKeydown)&&Object.assign(C,i.focusable.ignoreKeydown),y=v(y)}if(!o){let i=e.root;i._autoRoot&&(null==(a=t.ownerDocument)?void 0:a.body)&&(o=i._autoRootCreate())}c&&!d&&(u=!0);let b=e=>!!C[e.key];return o?{root:o,modalizer:l,groupper:c,mover:d,groupperBeforeMover:u,modalizerInGroupper:h,rtl:f?!!g:void 0,uncontrolled:p,excludedFromMover:S,ignoreKeydown:b}:void 0}static getRoot(e,t){var i;let n=e.getParent;for(let r=t;r;r=n(r)){let t=null==(i=A(e,r))?void 0:i.root;if(t)return t}}onRoot(e,t){t?delete this.rootById[e.uid]:this.rootById[e.uid]=e}}let e3=10;class e4{}class e5 extends e4{constructor(e,t){super(),this.uid=t.uid,this._tabster=e,this._deloser=t}belongsTo(e){return e===this._deloser}unshift(e){this._deloser.unshift(e)}async focusAvailable(){let e=this._deloser.findAvailable(),t=this._deloser.getElement();return!!e&&!!t&&(t.dispatchEvent(new K({by:"deloser",owner:t,next:e}))?this._tabster.focusedElement.focus(e):null)}async resetFocus(){return eO(this._tabster.getWindow).resolve(this._deloser.resetFocus())}}class e6{constructor(e,t){this._history=[],this._tabster=e,this.rootUId=t}getLength(){return this._history.length}removeDeloser(e){this._history=this._history.filter(t=>!t.belongsTo(e))}hasDeloser(e){return this._history.some(t=>t.belongsTo(e))}}class e8 extends e6{unshiftToDeloser(e,t){let i;for(let t=0;t<this._history.length;t++)if(this._history[t].belongsTo(e)){i=this._history[t],this._history.splice(t,1);break}i||(i=new e5(this._tabster,e)),i.unshift(t),this._history.unshift(i),this._history.splice(e3,this._history.length-e3)}async focusAvailable(e){let t=!!e;for(let i of this._history)if(e&&i.belongsTo(e)&&(t=!1),!t){let e=await i.focusAvailable();if(e||null===e)return e}return!1}async resetFocus(e){let t=!!e,i={};for(let n of this._history)e&&n.belongsTo(e)&&(t=!1),t||i[n.uid]||(i[n.uid]=n);for(let e of Object.keys(i))if(await i[e].resetFocus())return!0;return!1}}class e9{constructor(e){this._history=[],this._tabster=e}dispose(){this._history=[]}process(e){var t;let i=e2.getTabsterContext(this._tabster,e),n=i&&i.root.uid,r=ti.getDeloser(this._tabster,e);if(!n||!r)return;let s=this.make(n,()=>new e8(this._tabster,n));return(!i||!i.modalizer||(null==(t=i.modalizer)?void 0:t.isActive()))&&s.unshiftToDeloser(r,e),r}make(e,t){let i;for(let t=0;t<this._history.length;t++){let n=this._history[t];if(n.rootUId===e){i=n,this._history.splice(t,1);break}}return i||(i=t()),this._history.unshift(i),this._history.splice(e3,this._history.length-e3),i}removeDeloser(e){this._history.forEach(t=>{t.removeDeloser(e)}),this._history=this._history.filter(e=>e.getLength()>0)}async focusAvailable(e){let t=!!e;for(let i of this._history)if(e&&i.hasDeloser(e)&&(t=!1),!t){let t=await i.focusAvailable(e);if(t||null===t)return t}return!1}async resetFocus(e){let t=!!e;for(let i of this._history)if(e&&i.hasDeloser(e)&&(t=!1),!t&&await i.resetFocus(e))return!0;return!1}}function e7(e,t,i){let n,r=[],s=/(:|\.|\[|\]|,|=|@)/g,a="\\$1",o=e.getAttribute("id");o&&r.push("#"+o.replace(s,a)),!1!==t&&e.className&&e.className.split(" ").forEach(e=>{(e=e.trim())&&r.push("."+e.replace(s,a))});let l=0;if(!1!==i&&0===r.length){for(n=e;n;)l++,n=n.previousElementSibling;r.unshift(":nth-child("+l+")")}return r.unshift(e.tagName.toLowerCase()),r.join("")}function te(e){if(!eM(e.ownerDocument,e))return;let t=[e7(e)],i=es.getParentNode(e);for(;i&&i.nodeType!==Node.DOCUMENT_FRAGMENT_NODE;){if(i.nodeType===Node.ELEMENT_NODE){let e="BODY"===i.tagName;if(t.unshift(e7(i,!1,!e)),e)break}i=es.getParentNode(i)}return t.join(" ")}class tt extends ex{constructor(e,t,i,n){super(e,t,n),this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this.isActive=()=>this._isActive,this.setSnapshot=e=>{this._snapshotIndex=e,this._history.length>e+1&&this._history.splice(e+1,this._history.length-e-1),this._history[e]||(this._history[e]=[])},this.focusFirst=()=>{let e=this._element.get();return!!e&&this._tabster.focusedElement.focusFirst({container:e})},this.focusDefault=()=>{let e=this._element.get();return!!e&&this._tabster.focusedElement.focusDefault(e)},this.resetFocus=()=>{let e=this._element.get();return!!e&&this._tabster.focusedElement.resetFocus(e)},this.clearHistory=e=>{let t=this._element.get();if(!t){this._history[this._snapshotIndex]=[];return}this._history[this._snapshotIndex]=this._history[this._snapshotIndex].filter(i=>{let n=i.get();return!!n&&!!e&&es.nodeContains(t,n)})},this.uid=eP(e.getWindow,t),this.strategy=n.strategy||C,this._onDispose=i}dispose(){this._remove(),this._onDispose(this),this._isActive=!1,this._snapshotIndex=0,this._props={},this._history=[]}setActive(e){this._isActive=e}getActions(){return{focusDefault:this.focusDefault,focusFirst:this.focusFirst,resetFocus:this.resetFocus,clearHistory:this.clearHistory,setSnapshot:this.setSnapshot,isActive:this.isActive}}unshift(e){let t=this._history[this._snapshotIndex];for((t=this._history[this._snapshotIndex]=t.filter(t=>{let i=t.get();return i&&i!==e})).unshift(new ef(this._tabster.getWindow,e,te(e)));t.length>e3;)t.pop()}findAvailable(){let e=this._element.get();if(!e||!this._tabster.focusable.isVisible(e))return null;let t=this._props.restoreFocusOrder,i=null,n=e2.getTabsterContext(this._tabster,e);if(!n)return null;let r=n.root,s=r.getElement();if(!s)return null;if(void 0===t&&(t=r.getProps().restoreFocusOrder),t===v&&(i=this._tabster.focusable.findDefault({container:s})),i||t!==y||(i=this._findFirst(s)),i)return i;let a=this._findInHistory();if(a&&t===f)return a;let o=this._tabster.focusable.findDefault({container:e});if(o&&t===m)return o;let l=this._findFirst(e);return l&&t===S?l:o||a||l||null}customFocusLostHandler(e){return e.dispatchEvent(new et(this.getActions()))}_findInHistory(){let e=this._history[this._snapshotIndex].slice(0);this.clearHistory(!0);for(let t=0;t<e.length;t++){let i=e[t],n=i.get(),r=this._element.get();if(n&&r&&es.nodeContains(r,n)){if(this._tabster.focusable.isFocusable(n))return n}else if(!this._props.noSelectorCheck){let e=i.getData();if(e&&r){let t;try{t=es.querySelectorAll(r.ownerDocument,e)}catch(e){continue}for(let e=0;e<t.length;e++){let i=t[e];if(i&&this._tabster.focusable.isFocusable(i))return i}}}}return null}_findFirst(e){if(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()){let t=this._tabster.focusable.findFirst({container:e,useActiveModalizer:!0});if(t)return t}return null}_remove(){}}class ti{constructor(e,t){this._inDeloser=!1,this._isRestoringFocus=!1,this._isPaused=!1,this._onRestoreFocus=e=>{var t;let i=e.composedPath()[0];if(i){let n=null==(t=ti.getDeloser(this._tabster,i))?void 0:t.findAvailable();n&&this._tabster.focusedElement.focus(n),e.stopImmediatePropagation()}},this._onFocus=e=>{if(this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),!e)return void this._scheduleRestoreFocus();let t=this._history.process(e);t?this._activate(t):this._deactivate()},this._onDeloserDispose=e=>{this._history.removeDeloser(e),e.isActive()&&this._scheduleRestoreFocus()},this._tabster=e,this._win=e.getWindow,this._history=new e9(e),e.queueInit(()=>{this._tabster.focusedElement.subscribe(this._onFocus);let e=this._win().document;e.addEventListener(x,this._onRestoreFocus);let t=es.getActiveElement(e);t&&t!==e.body&&this._onFocus(t)});let i=null==t?void 0:t.autoDeloser;i&&(this._autoDeloser=i)}dispose(){let e=this._win();this._restoreFocusTimer&&(e.clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),this._autoDeloserInstance&&(this._autoDeloserInstance.dispose(),delete this._autoDeloserInstance,delete this._autoDeloser),this._tabster.focusedElement.unsubscribe(this._onFocus),e.document.removeEventListener(x,this._onRestoreFocus),this._history.dispose(),delete this._curDeloser}createDeloser(e,t){var i;let n=new tt(this._tabster,e,this._onDeloserDispose,t);return es.nodeContains(e,null!=(i=this._tabster.focusedElement.getFocusedElement())?i:null)&&this._activate(n),n}getActions(e){for(let t=e;t;t=es.getParentElement(t)){let e=A(this._tabster,t);if(e&&e.deloser)return e.deloser.getActions()}}pause(){this._isPaused=!0,this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0)}resume(e){this._isPaused=!1,e&&this._scheduleRestoreFocus()}_activate(e){let t=this._curDeloser;t!==e&&(this._inDeloser=!0,null==t||t.setActive(!1),e.setActive(!0),this._curDeloser=e)}_deactivate(){var e;this._inDeloser=!1,null==(e=this._curDeloser)||e.setActive(!1),this._curDeloser=void 0}_scheduleRestoreFocus(e){if(this._isPaused||this._isRestoringFocus)return;let t=async()=>{this._restoreFocusTimer=void 0;let t=this._tabster.focusedElement.getLastFocusedElement();if(!e&&(this._isRestoringFocus||!this._inDeloser||t&&!ez(t)))return;let i=this._curDeloser,n=!1;if(i){if(t&&i.customFocusLostHandler(t))return;if(i.strategy===b)n=!0;else{let e=i.getElement(),t=i.findAvailable();if(t&&(!(null==e?void 0:e.dispatchEvent(new K({by:"deloser",owner:e,next:t})))||this._tabster.focusedElement.focus(t)))return}}this._deactivate(),n||(this._isRestoringFocus=!0,await this._history.focusAvailable(null)===!1&&await this._history.resetFocus(null),this._isRestoringFocus=!1)};e?t():this._restoreFocusTimer=this._win().setTimeout(t,100)}static getDeloser(e,t){var i;let n;for(let i=t;i;i=es.getParentElement(i)){let t=A(e,i);if(t){n||(n=t.root);let e=t.deloser;if(e)return e}}let r=e.deloser&&e.deloser;if(r){if(r._autoDeloserInstance)return r._autoDeloserInstance;let s=r._autoDeloser;if(n&&!r._autoDeloserInstance&&s){let n=null==(i=t.ownerDocument)?void 0:i.body;n&&(r._autoDeloserInstance=new tt(e,n,e.deloser._onDeloserDispose,s))}return r._autoDeloserInstance}}static getHistory(e){return e._history}static forceRestoreFocus(e){e._scheduleRestoreFocus(!0)}}class tn{constructor(){this._callbacks=[]}dispose(){this._callbacks=[],delete this._val}subscribe(e){let t=this._callbacks;0>t.indexOf(e)&&t.push(e)}subscribeFirst(e){let t=this._callbacks,i=t.indexOf(e);i>=0&&t.splice(i,1),t.unshift(e)}unsubscribe(e){let t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}setVal(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))}getVal(){return this._val}trigger(e,t){this._callCallbacks(e,t)}_callCallbacks(e,t){this._callbacks.forEach(i=>i(e,t))}}let tr=1500,ts=3e3,ta="up",to=1,tl=2,tc=3,td=4,tu=5,th=6;class tg extends e4{constructor(e,t,i){super(),this._deloser=t,this._transactions=i}belongsTo(e){return e.deloserUId===this._deloser.deloserUId}async focusAvailable(){let e={...this._deloser,reset:!1};return this._transactions.beginTransaction(tw,e).then(e=>!!e)}async resetFocus(){let e={...this._deloser,reset:!0};return this._transactions.beginTransaction(tw,e).then(e=>!!e)}}class tp extends e6{constructor(e,t,i){super(e,t),this._transactions=i}unshift(e){let t;for(let i=0;i<this._history.length;i++)if(this._history[i].belongsTo(e)){t=this._history[i],this._history.splice(i,1);break}t||(t=new tg(this._tabster,e,this._transactions)),this._history.unshift(t),this._history.splice(10,this._history.length-10)}async focusAvailable(){for(let e of this._history)if(await e.focusAvailable())return!0;return!1}async resetFocus(){for(let e of this._history)if(await e.resetFocus())return!0;return!1}}class tf{constructor(e,t,i,n,r,s,a,o){this._inProgress={},this._isDone=!1,this._isSelfResponding=!1,this._sentCount=0,this.tabster=e,this.owner=t,this.ownerId=eR(t()),this.id=ew(t()),this.beginData=n,this._knownTargets=i,this._sentTo=s||{[this.ownerId]:!0},this.targetId=a,this.sendUp=o,this.timeout=r,this._promise=new(eO(t))((e,t)=>{this._resolve=e,this._reject=t})}getTargets(e){return this.targetId===ta?this.sendUp?{[ta]:{send:this.sendUp}}:null:this.targetId?e[this.targetId]?{[this.targetId]:{send:e[this.targetId].send}}:null:0===Object.keys(e).length&&this.sendUp?{[ta]:{send:this.sendUp}}:Object.keys(e).length>0?e:null}begin(e){let t=this.getTargets(this._knownTargets),i={...this._sentTo};if(t)for(let e of Object.keys(t))i[e]=!0;let n={transaction:this.id,type:this.type,isResponse:!1,timestamp:Date.now(),owner:this.ownerId,sentto:i,timeout:this.timeout,beginData:this.beginData};if(this.targetId&&(n.target=this.targetId),e&&(this._isSelfResponding=!0,e(n).then(e=>{this._isSelfResponding=!1,void 0===e||this.endData||(this.endData=e),(this.endData||0===this._sentCount)&&this.end()})),t)for(let e of Object.keys(t))e in this._sentTo||this._send(t[e].send,e,n);return 0!==this._sentCount||this._isSelfResponding||this.end(),this._promise}_send(e,t,i){void 0===this._inProgress[t]&&(this._inProgress[t]=!0,this._sentCount++,e(i))}end(e){!this._isDone&&(this._isDone=!0,void 0===this.endData&&e?this._reject&&this._reject(e):this._resolve&&this._resolve(this.endData))}onResponse(e){let t=e.endData;void 0===t||this.endData||(this.endData=t);let i=e.target===ta?ta:e.owner;this._inProgress[i]&&(this._inProgress[i]=!1,this._sentCount--,(this.endData||0===this._sentCount&&!this._isSelfResponding)&&this.end())}}class tm extends tf{constructor(){super(...arguments),this.type=to}static shouldForward(){return!1}static async makeResponse(e){return{isNavigatingWithKeyboard:e.keyboardNavigation.isNavigatingWithKeyboard()}}}class tv extends tf{constructor(){super(...arguments),this.type=tl}static shouldSelfRespond(){return!0}static shouldForward(e,t,i){let n=tI.findElement(e,i,t.beginData);return!n||!e.focusable.isFocusable(n)}static async makeResponse(e,t,i,n,r,s){let a=tI.findElement(e,i,t.beginData);return!!a&&e.focusedElement.focus(a,!0)||!!await s}}let tS=1,ty=2,tC=3,tb=4,tT=5,tE=6;class t_ extends tf{constructor(){super(...arguments),this.type=tc}static shouldSelfRespond(e,t){return t.state!==tb&&t.state!==tT}static async makeResponse(e,t,i,n,r,s,a){let o=t.timestamp,l=t.beginData;if(o&&l)switch(l.state){case tS:return t_._makeFocusedResponse(e,o,l,r,a);case ty:return t_._makeBlurredResponse(e,o,l,r.ctx);case tC:return t_._makeObservedResponse(e,l);case tb:return t_._makeDeadWindowResponse(e,l,r,s);case tT:return t_._makeKeyboardNavigationResponse(e,r.ctx,l.isNavigatingWithKeyboard);case tE:return t_._makeOutlineResponse(e,r.ctx,l.outline)}return!0}static createElement(e,t){return t.uid?new tA(e,t.uid,t.ownerUId,t.id,t.rootUId,t.observedName,t.observedDetails):null}static async _makeFocusedResponse(e,t,i,n,r){let s=t_.createElement(e,i);if(i&&i.ownerUId&&s){if(n.ctx.focusOwner=i.ownerUId,n.ctx.focusOwnerTimestamp=t,!r&&i.rootUId&&i.deloserUId){let t=e.deloser;if(t){let r=ti.getHistory(t),s={ownerUId:i.ownerUId,deloserUId:i.deloserUId,rootUId:i.rootUId};r.make(i.rootUId,()=>new tp(e,s.rootUId,n)).unshift(s)}}tM.setVal(e.crossOrigin.focusedElement,s,{isFocusedProgrammatically:i.isFocusedProgrammatically})}return!0}static async _makeBlurredResponse(e,t,i,n){return i&&(i.ownerUId===n.focusOwner||i.force)&&(!n.focusOwnerTimestamp||n.focusOwnerTimestamp<t)&&tM.setVal(e.crossOrigin.focusedElement,void 0,{}),!0}static async _makeObservedResponse(e,t){let i=t.observedName,n=t_.createElement(e,t);return i&&n&&tD.trigger(e.crossOrigin.observedElement,n,{names:[i],details:t.observedDetails}),!0}static async _makeDeadWindowResponse(e,t,i,n){let r=t&&t.ownerUId;return r&&i.removeTarget(r),n.then(()=>{if(r===i.ctx.focusOwner){let t=e.deloser;t&&ti.forceRestoreFocus(t)}return!0})}static async _makeKeyboardNavigationResponse(e,t,i){return void 0!==i&&e.keyboardNavigation.isNavigatingWithKeyboard()!==i&&(t.ignoreKeyboardNavigationStateUpdate=!0,e.keyboardNavigation.setNavigatingWithKeyboard(i),t.ignoreKeyboardNavigationStateUpdate=!1),!0}static async _makeOutlineResponse(e,t,i){return t.origOutlineSetup&&t.origOutlineSetup.call(e.outline,i),!0}}class tI extends tf{constructor(){super(...arguments),this.type=td}static shouldSelfRespond(){return!0}static findElement(e,t,i){let n;if(i&&(!i.ownerId||i.ownerId===eR(t())))if(i.id){if((n=es.getElementById(t().document,i.id))&&i.rootId){let t=e2.getTabsterContext(e,n);if(!t||t.root.uid!==i.rootId)return null}}else if(i.uid){let e=ed(t).elementByUId[i.uid];n=e&&e.get()}else i.observedName&&(n=e.observedElement.getElement(i.observedName,i.accessibility));return n||null}static getElementData(e,t,i,n,r){let s=ti.getDeloser(e,t),a=e2.getTabsterContext(e,t),o=A(e,t),l=o&&o.observed;return{uid:eP(i,t),ownerUId:r,id:t.id||void 0,rootUId:a?a.root.uid:void 0,deloserUId:s?tk(i,n,s):void 0,observedName:l&&l.names&&l.names[0],observedDetails:l&&l.details}}static async makeResponse(e,t,i,n,r,s){let a,o,l=t.beginData;if(void 0===l?a=e.focusedElement.getFocusedElement():l&&(a=tI.findElement(e,i,l)||void 0),!a&&l){let n=l.observedName,r=t.timeout,c=l.accessibility;if(n&&r){let t=await new(eO(i))(t=>{let i=!1,a=!1,o=!1;e.observedElement.waitElement(n,r,c).result.then(e=>{i=!0,!o&&(e||a)&&(o=!0,t({element:e}))}),s.then(e=>{a=!0,!o&&(e||i)&&(o=!0,t({crossOrigin:e}))})});t.element?a=t.element:t.crossOrigin&&(o=t.crossOrigin)}}return a?tI.getElementData(e,a,i,r.ctx,n):o}}class tw extends tf{constructor(){super(...arguments),this.type=tu}static async makeResponse(e,t,i,n,r,s){let a=await s,o=!a&&t.beginData,l=o&&o.deloserUId,c=l&&r.ctx.deloserByUId[l],d=e.deloser;if(o&&c&&d){let e=ti.getHistory(d);return o.reset?e.resetFocus(c):e.focusAvailable(c)}return!!a}}class tP extends tf{constructor(){super(...arguments),this.type=th}static shouldForward(){return!1}static async makeResponse(){return!0}}class tR{constructor(e,t,i){this._knownTargets={},this._transactions={},this._isDefaultSendUp=!1,this.isSetUp=!1,this._onMessage=e=>{let t;if(e.data.owner===this._ownerUId||!this._tabster)return;let i=e.data;if(!i||!(t=i.transaction)||!i.type||!i.timestamp||!i.owner||!i.sentto)return;let n=this._knownTargets[i.owner];if(!n&&e.send&&i.owner!==this._ownerUId&&(n=this._knownTargets[i.owner]={send:e.send}),n&&(n.last=Date.now()),i.isResponse){let e=this._transactions[t];e&&e.transaction&&e.transaction.type===i.type&&e.transaction.onResponse(i)}else{let t=this._getTransactionClass(i.type),n=this.forwardTransaction(i);t&&e.send&&t.makeResponse(this._tabster,i,this._owner,this._ownerUId,this,n,!1).then(t=>{let n={transaction:i.transaction,type:i.type,isResponse:!0,timestamp:Date.now(),owner:this._ownerUId,timeout:i.timeout,sentto:{},target:i.target===ta?ta:i.owner,endData:t};e.send(n)})}},this._onPageHide=()=>{this._dead()},this._onBrowserMessage=e=>{if(e.source===this._owner())return;let t=t=>{e.source&&e.source.postMessage&&e.source.postMessage(JSON.stringify(t),"*")};try{this._onMessage({data:JSON.parse(e.data),send:t})}catch(e){}},this._tabster=e,this._owner=t,this._ownerUId=eR(t()),this.ctx=i}setup(e){return this.isSetUp||(this.isSetUp=!0,this.setSendUp(e),this._owner().addEventListener("pagehide",this._onPageHide),this._ping()),this._onMessage}setSendUp(e){if(!this.isSetUp)throw Error("CrossOrigin is not set up.");this.sendUp=e||void 0;let t=this._owner();return void 0===e?!this._isDefaultSendUp&&t.document&&(this._isDefaultSendUp=!0,t.parent&&t.parent!==t&&t.parent.postMessage&&(this.sendUp=e=>{t.parent.postMessage(JSON.stringify(e),"*")}),t.addEventListener("message",this._onBrowserMessage)):this._isDefaultSendUp&&(t.removeEventListener("message",this._onBrowserMessage),this._isDefaultSendUp=!1),this._onMessage}async dispose(){let e=this._owner();for(let t of(this._pingTimer&&(e.clearTimeout(this._pingTimer),this._pingTimer=void 0),e.removeEventListener("message",this._onBrowserMessage),e.removeEventListener("pagehide",this._onPageHide),await this._dead(),delete this._deadPromise,Object.keys(this._transactions))){let i=this._transactions[t];i.timer&&(e.clearTimeout(i.timer),delete i.timer),i.transaction.end()}this._knownTargets={},delete this.sendUp}beginTransaction(e,t,i,n,r,s){let a;if(!this._owner)return eO(this._owner).reject();let o=new e(this._tabster,this._owner,this._knownTargets,t,i,n,r,this.sendUp);return e.shouldSelfRespond&&e.shouldSelfRespond(this._tabster,t,this._owner,this._ownerUId)&&(a=t=>e.makeResponse(this._tabster,t,this._owner,this._ownerUId,this,eO(this._owner).resolve(void 0),!0)),this._beginTransaction(o,i,a,s)}removeTarget(e){delete this._knownTargets[e]}_beginTransaction(e,t,i,n){let r=this._owner(),s={transaction:e,timer:r.setTimeout(()=>{delete s.timer,e.end("Cross origin transaction timed out.")},tr+(t||0))};this._transactions[e.id]=s;let a=e.begin(i);return a.catch(()=>{}).finally(()=>{s.timer&&r.clearTimeout(s.timer),delete this._transactions[e.id]}),a.then(e=>e,n?void 0:()=>void 0)}forwardTransaction(e){let t=this._owner,i=e.target;if(i===this._ownerUId)return eO(t).resolve();let n=this._getTransactionClass(e.type);if(n)if(!(void 0===n.shouldForward||n.shouldForward(this._tabster,e,t,this._ownerUId)))return eO(t).resolve();else{let r=e.sentto;return i===ta&&(i=void 0,r[this._ownerUId]=!0),delete r[ta],this._beginTransaction(new n(this._tabster,t,this._knownTargets,e.beginData,e.timeout,r,i,this.sendUp),e.timeout)}return eO(t).reject(`Unknown transaction type ${e.type}`)}_getTransactionClass(e){switch(e){case to:return tm;case tl:return tv;case tc:return t_;case td:return tI;case tu:return tw;case th:return tP;default:return null}}async _dead(){this._deadPromise||this.ctx.focusOwner!==this._ownerUId||(this._deadPromise=this.beginTransaction(t_,{ownerUId:this._ownerUId,state:tb})),this._deadPromise&&await this._deadPromise}async _ping(){let e;if(this._pingTimer)return;let t=Date.now(),i=Object.keys(this._knownTargets).filter(e=>t-(this._knownTargets[e].last||0)>ts);if(this.sendUp&&i.push(ta),i.length&&await eO(this._owner).all(i.map(t=>this.beginTransaction(tP,void 0,void 0,void 0,t,!0).then(()=>!0,()=>(t!==ta&&(e||(e={}),e[t]=!0,delete this._knownTargets[t]),!1)))),e&&!await this.beginTransaction(tI,void 0)&&this.ctx.focusOwner&&this.ctx.focusOwner in e){await this.beginTransaction(t_,{ownerUId:this._ownerUId,state:ty,force:!0});let e=this._tabster.deloser;e&&ti.forceRestoreFocus(e)}this._pingTimer=this._owner().setTimeout(()=>{this._pingTimer=void 0,this._ping()},ts)}}class tA{constructor(e,t,i,n,r,s,a){this._tabster=e,this.uid=t,this.ownerId=i,this.id=n,this.rootId=r,this.observedName=s,this.observedDetails=a}focus(e,t){return this._tabster.crossOrigin.focusedElement.focus(this,e,t)}}class tM extends tn{constructor(e){super(),this._transactions=e}async focus(e,t,i){return this._focus({uid:e.uid,id:e.id,rootId:e.rootId,ownerId:e.ownerId,observedName:e.observedName},t,i)}async focusById(e,t,i,n){return this._focus({id:e,rootId:t},i,n)}async focusByObservedName(e,t,i,n,r){return this._focus({observedName:e,rootId:i},n,r,t)}async _focus(e,t,i,n){return this._transactions.beginTransaction(tv,{...e,noFocusedProgrammaticallyFlag:t,noAccessibleCheck:i},n).then(e=>!!e)}static setVal(e,t,i){e.setVal(t,i)}}class tD extends tn{constructor(e,t){super(),this._lastRequestFocusId=0,this._tabster=e,this._transactions=t}async getElement(e,t){return this.waitElement(e,0,t)}async waitElement(e,t,i){return this._transactions.beginTransaction(tI,{observedName:e,accessibility:i},t).then(e=>e?t_.createElement(this._tabster,e):null)}async requestFocus(e,t){let i=++this._lastRequestFocusId;return this.waitElement(e,t,g).then(e=>this._lastRequestFocusId===i&&!!e&&this._tabster.crossOrigin.focusedElement.focus(e,!0))}static trigger(e,t,i){e.trigger(t,i)}}class tO{constructor(e){this._init=()=>{let e=this._tabster;e.keyboardNavigation.subscribe(this._onKeyboardNavigationStateChanged),e.focusedElement.subscribe(this._onFocus),e.observedElement.subscribe(this._onObserved),this._ctx.origOutlineSetup||(this._ctx.origOutlineSetup=e.outline.setup,e.outline.setup=this._outlineSetup),this._transactions.beginTransaction(tm,void 0,void 0,void 0,ta).then(e=>{e&&this._tabster.keyboardNavigation.isNavigatingWithKeyboard()!==e.isNavigatingWithKeyboard&&(this._ctx.ignoreKeyboardNavigationStateUpdate=!0,this._tabster.keyboardNavigation.setNavigatingWithKeyboard(e.isNavigatingWithKeyboard),this._ctx.ignoreKeyboardNavigationStateUpdate=!1)})},this._onKeyboardNavigationStateChanged=e=>{this._ctx.ignoreKeyboardNavigationStateUpdate||this._transactions.beginTransaction(t_,{state:tT,ownerUId:eR(this._win()),isNavigatingWithKeyboard:e})},this._onFocus=e=>{let t=this._win(),i=eR(t);this._blurTimer&&(t.clearTimeout(this._blurTimer),this._blurTimer=void 0),e?this._transactions.beginTransaction(t_,{...tI.getElementData(this._tabster,e,this._win,this._ctx,i),state:tS}):this._blurTimer=t.setTimeout(()=>{this._blurTimer=void 0,this._ctx.focusOwner&&this._ctx.focusOwner===i&&this._transactions.beginTransaction(tI,void 0).then(e=>{e||this._ctx.focusOwner!==i||this._transactions.beginTransaction(t_,{ownerUId:i,state:ty,force:!1})})},0)},this._onObserved=(e,t)=>{var i;let n=tI.getElementData(this._tabster,e,this._win,this._ctx,eR(this._win()));n.state=tC,n.observedName=null==(i=t.names)?void 0:i[0],n.observedDetails=t.details,this._transactions.beginTransaction(t_,n)},this._outlineSetup=e=>{this._transactions.beginTransaction(t_,{state:tE,ownerUId:eR(this._win()),outline:e})},this._tabster=e,this._win=e.getWindow,this._ctx={ignoreKeyboardNavigationStateUpdate:!1,deloserByUId:{}},this._transactions=new tR(e,this._win,this._ctx),this.focusedElement=new tM(this._transactions),this.observedElement=new tD(e,this._transactions)}setup(e){return this.isSetUp()?this._transactions.setSendUp(e):(this._tabster.queueInit(this._init),this._transactions.setup(e))}isSetUp(){return this._transactions.isSetUp}dispose(){var e;let t=this._tabster;t.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),t.focusedElement.unsubscribe(this._onFocus),null==(e=t.observedElement)||e.unsubscribe(this._onObserved),this._transactions.dispose(),this.focusedElement.dispose(),this.observedElement.dispose(),this._ctx.deloserByUId={}}}function tk(e,t,i){let n=i.getElement();if(n){let r=eP(e,n);return t.deloserByUId[r]||(t.deloserByUId[r]=i),r}}class tN{constructor(e){this._tabster=e}dispose(){}getProps(e){let t=A(this._tabster,e);return t&&t.focusable||{}}isFocusable(e,t,i,n){return!!eD(e,o)&&(!!t||-1!==e.tabIndex)&&(i||this.isVisible(e))&&(n||this.isAccessible(e))}isVisible(e){if(!e.ownerDocument||e.nodeType!==Node.ELEMENT_NODE||ez(e))return!1;let t=e.ownerDocument.body.getBoundingClientRect();return 0!==t.width||0!==t.height}isAccessible(e){var t;for(let i=e;i;i=es.getParentElement(i)){let e=A(this._tabster,i);if(this._isHidden(i)||!(null==(t=null==e?void 0:e.focusable)?void 0:t.ignoreAriaDisabled)&&this._isDisabled(i))return!1}return!0}_isDisabled(e){return e.hasAttribute("disabled")}_isHidden(e){var t;let i=e.getAttribute("aria-hidden");return!(!i||"true"!==i.toLowerCase()||(null==(t=this._tabster.modalizer)?void 0:t.isAugmented(e)))}findFirst(e,t){return this.findElement({...e},t)}findLast(e,t){return this.findElement({isBackward:!0,...e},t)}findNext(e,t){return this.findElement({...e},t)}findPrev(e,t){return this.findElement({...e,isBackward:!0},t)}findDefault(e,t){return this.findElement({...e,acceptCondition:t=>this.isFocusable(t,e.includeProgrammaticallyFocusable)&&!!this.getProps(t).isDefault},t)||null}findAll(e){return this._findElements(!0,e)||[]}findElement(e,t){let i=this._findElements(!1,e,t);return i?i[0]:i}_findElements(e,t,i){var n,r,s;let{container:a,currentElement:o=null,includeProgrammaticallyFocusable:l,useActiveModalizer:c,ignoreAccessibility:d,modalizerId:u,isBackward:h,onElement:g}=t;i||(i={});let p=[],{acceptCondition:f}=t,m=!!f;if(!a)return null;f||(f=e=>this.isFocusable(e,l,!1,d));let v={container:a,modalizerUserId:void 0===u&&c?null==(n=this._tabster.modalizer)?void 0:n.activeId:u||(null==(s=null==(r=e2.getTabsterContext(this._tabster,a))?void 0:r.modalizer)?void 0:s.userId),from:o||a,isBackward:h,isFindAll:e,acceptCondition:f,hasCustomCondition:m,includeProgrammaticallyFocusable:l,ignoreAccessibility:d,cachedGrouppers:{},cachedRadioGroups:{}},S=ey(a.ownerDocument,a,e=>this._acceptElement(e,v));if(!S)return null;let y=t=>{var n,r;let s=null!=(n=v.foundElement)?n:v.foundBackward;return(s&&p.push(s),e)?(!s||(v.found=!1,delete v.foundElement,delete v.foundBackward,delete v.fromCtx,v.from=s,!g||!!g(s)))&&!!(s||t):(s&&i&&(i.uncontrolled=null==(r=e2.getTabsterContext(this._tabster,s))?void 0:r.uncontrolled),!!(t&&!s))};if(o||(i.outOfDOMOrder=!0),o&&es.nodeContains(a,o))S.currentNode=o;else if(h){let e=eq(a);if(!e)return null;if(this._acceptElement(e,v)===NodeFilter.FILTER_ACCEPT&&!y(!0))return v.skippedFocusable&&(i.outOfDOMOrder=!0),p;S.currentNode=e}do h?S.previousNode():S.nextNode();while(y());return v.skippedFocusable&&(i.outOfDOMOrder=!0),p.length?p:null}_acceptElement(e,t){var i,n,r;let s;if(t.found)return NodeFilter.FILTER_ACCEPT;let a=t.foundBackward;if(a&&(e===a||!es.nodeContains(a,e)))return t.found=!0,t.foundElement=a,NodeFilter.FILTER_ACCEPT;let o=t.container;if(e===o)return NodeFilter.FILTER_SKIP;if(!es.nodeContains(o,e)||eQ(e)||es.nodeContains(t.rejectElementsFrom,e))return NodeFilter.FILTER_REJECT;let l=t.currentCtx=e2.getTabsterContext(this._tabster,e);if(!l)return NodeFilter.FILTER_SKIP;if(eI(e))return this.isFocusable(e,void 0,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_SKIP;if(!t.hasCustomCondition&&("IFRAME"===e.tagName||"WEBVIEW"===e.tagName))if(this.isVisible(e)&&(null==(i=l.modalizer)?void 0:i.userId)===(null==(n=this._tabster.modalizer)?void 0:n.activeId))return t.found=!0,t.rejectElementsFrom=t.foundElement=e,NodeFilter.FILTER_ACCEPT;else return NodeFilter.FILTER_REJECT;if(!t.ignoreAccessibility&&!this.isAccessible(e))return this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_REJECT;let c=t.fromCtx;c||(c=t.fromCtx=e2.getTabsterContext(this._tabster,t.from));let d=null==c?void 0:c.mover,u=l.groupper,h=l.mover;if(void 0!==(s=null==(r=this._tabster.modalizer)?void 0:r.acceptElement(e,t))&&(t.skippedFocusable=!0),void 0===s&&(u||h||d)){let i=null==u?void 0:u.getElement(),n=null==d?void 0:d.getElement(),r=null==h?void 0:h.getElement();if(r&&es.nodeContains(n,r)&&es.nodeContains(o,n)&&(!i||!h||es.nodeContains(n,i))&&(h=d,r=n),i)if(i!==o&&es.nodeContains(o,i)){if(!es.nodeContains(i,e))return NodeFilter.FILTER_REJECT}else u=void 0;if(r)if(es.nodeContains(o,r)){if(!es.nodeContains(r,e))return NodeFilter.FILTER_REJECT}else h=void 0;u&&h&&(r&&i&&!es.nodeContains(i,r)?h=void 0:u=void 0),u&&(s=u.acceptElement(e,t)),h&&(s=h.acceptElement(e,t))}if(void 0===s&&(s=t.acceptCondition(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP)===NodeFilter.FILTER_SKIP&&this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),s===NodeFilter.FILTER_ACCEPT&&!t.found){if(!t.isFindAll&&eJ(e)&&!e.checked){let i=e.name,n=t.cachedRadioGroups[i];if(!n&&(n=eK(e))&&(t.cachedRadioGroups[i]=n),(null==n?void 0:n.checked)&&n.checked!==e)return NodeFilter.FILTER_SKIP}t.isBackward?(t.foundBackward=e,s=NodeFilter.FILTER_SKIP):(t.found=!0,t.foundElement=e)}return s}}let tx="Tab",tL="Enter",tF="Escape",tU="PageUp",t$="PageDown",tV="End",tB="Home",tH="ArrowLeft",tj="ArrowUp",tq="ArrowRight",tW="ArrowDown";function tG(e,t){var i;let n=e.getParent,r=t;do{let t=null==(i=A(e,r))?void 0:i.uncontrolled;if(t&&e.uncontrolled.isUncontrolledCompletely(r,!!t.completely))return r;r=n(r)}while(r)}let tz={[c]:0,[d]:1,[l]:2};class tJ extends tn{constructor(e,t){super(),this._init=()=>{let e=this._win(),t=e.document;t.addEventListener(r.PW,this._onFocusIn,!0),t.addEventListener(r.r$,this._onFocusOut,!0),e.addEventListener("keydown",this._onKeyDown,!0);let i=es.getActiveElement(t);i&&i!==t.body&&this._setFocusedElement(i),this.subscribe(this._onChanged)},this._onFocusIn=e=>{let t=e.composedPath()[0];t&&this._setFocusedElement(t,e.detail.relatedTarget,e.detail.isFocusedProgrammatically)},this._onFocusOut=e=>{var t;this._setFocusedElement(void 0,null==(t=e.detail)?void 0:t.originalEvent.relatedTarget)},this._validateFocusedElement=e=>{},this._onKeyDown=e=>{if(e.key!==tx||e.ctrlKey)return;let t=this.getVal();if(!t||!t.ownerDocument||"true"===t.contentEditable)return;let i=this._tabster,n=i.controlTab,s=e2.getTabsterContext(i,t);if(!s||s.ignoreKeydown(e))return;let a=e.shiftKey,o=tJ.findNextTabbable(i,s,void 0,t,void 0,a,!0),l=s.root.getElement();if(!l)return;let c=null==o?void 0:o.element,d=tG(i,t);if(c){let u=o.uncontrolled;if(s.uncontrolled||es.nodeContains(u,t)){if(!o.outOfDOMOrder&&u===s.uncontrolled||d&&!es.nodeContains(d,c))return;eB.addPhantomDummyWithTarget(i,t,a,c);return}if(u&&i.focusable.isVisible(u)||"IFRAME"===c.tagName&&i.focusable.isVisible(c)){l.dispatchEvent(new K({by:"root",owner:l,next:c,relatedEvent:e}))&&eB.moveWithPhantomDummy(i,null!=u?u:c,!1,a,e);return}(n||(null==o?void 0:o.outOfDOMOrder))&&l.dispatchEvent(new K({by:"root",owner:l,next:c,relatedEvent:e}))&&(e.preventDefault(),e.stopImmediatePropagation(),(0,r.ev)(c))}else!d&&l.dispatchEvent(new K({by:"root",owner:l,next:null,relatedEvent:e}))&&s.root.moveOutWithDefaultAction(a,e)},this._onChanged=(e,t)=>{var i,n;if(e)e.dispatchEvent(new z(t));else{let e=null==(i=this._lastVal)?void 0:i.get();if(e){let i={...t},r=e2.getTabsterContext(this._tabster,e),s=null==(n=null==r?void 0:r.modalizer)?void 0:n.userId;s&&(i.modalizerId=s),e.dispatchEvent(new J(i))}}},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){super.dispose();let e=this._win(),t=e.document;t.removeEventListener(r.PW,this._onFocusIn,!0),t.removeEventListener(r.r$,this._onFocusOut,!0),e.removeEventListener("keydown",this._onKeyDown,!0),this.unsubscribe(this._onChanged);let i=this._asyncFocus;i&&(e.clearTimeout(i.timeout),delete this._asyncFocus),delete tJ._lastResetElement,delete this._nextVal,delete this._lastVal}static forgetMemorized(e,t){var i,n;let r=tJ._lastResetElement,s=r&&r.get();s&&es.nodeContains(t,s)&&delete tJ._lastResetElement,(s=null==(n=null==(i=e._nextVal)?void 0:i.element)?void 0:n.get())&&es.nodeContains(t,s)&&delete e._nextVal,(s=(r=e._lastVal)&&r.get())&&es.nodeContains(t,s)&&delete e._lastVal}getFocusedElement(){return this.getVal()}getLastFocusedElement(){var e;let t=null==(e=this._lastVal)?void 0:e.get();return t&&(!t||eM(t.ownerDocument,t))||(this._lastVal=t=void 0),t}focus(e,t,i,n){return!!this._tabster.focusable.isFocusable(e,t,!1,i)&&(e.focus({preventScroll:n}),!0)}focusDefault(e){let t=this._tabster.focusable.findDefault({container:e});return!!t&&(this._tabster.focusedElement.focus(t),!0)}getFirstOrLastTabbable(e,t){var i;let n,{container:r,ignoreAccessibility:s}=t;if(r){let t=e2.getTabsterContext(this._tabster,r);t&&(n=null==(i=tJ.findNextTabbable(this._tabster,t,r,void 0,void 0,!e,s))?void 0:i.element)}return n&&!es.nodeContains(r,n)&&(n=void 0),n||void 0}_focusFirstOrLast(e,t){let i=this.getFirstOrLastTabbable(e,t);return!!i&&(this.focus(i,!1,!0),!0)}focusFirst(e){return this._focusFirstOrLast(!0,e)}focusLast(e){return this._focusFirstOrLast(!1,e)}resetFocus(e){if(!this._tabster.focusable.isVisible(e))return!1;if(this._tabster.focusable.isFocusable(e,!0,!0,!0))this.focus(e);else{let t=e.getAttribute("tabindex"),i=e.getAttribute("aria-hidden");e.tabIndex=-1,e.setAttribute("aria-hidden","true"),tJ._lastResetElement=new ef(this._win,e),this.focus(e,!0,!0),this._setOrRemoveAttribute(e,"tabindex",t),this._setOrRemoveAttribute(e,"aria-hidden",i)}return!0}requestAsyncFocus(e,t,i){let n=this._tabster.getWindow(),r=this._asyncFocus;if(r){if(tz[e]>tz[r.source])return;n.clearTimeout(r.timeout)}this._asyncFocus={source:e,callback:t,timeout:n.setTimeout(()=>{this._asyncFocus=void 0,t()},i)}}cancelAsyncFocus(e){let t=this._asyncFocus;(null==t?void 0:t.source)===e&&(this._tabster.getWindow().clearTimeout(t.timeout),this._asyncFocus=void 0)}_setOrRemoveAttribute(e,t,i){null===i?e.removeAttribute(t):e.setAttribute(t,i)}_setFocusedElement(e,t,i){var n,r;if(this._tabster._noop)return;let s={relatedTarget:t};if(e){let t=null==(n=tJ._lastResetElement)?void 0:n.get();if(tJ._lastResetElement=void 0,t===e||eI(e))return;s.isFocusedProgrammatically=i;let a=e2.getTabsterContext(this._tabster,e),o=null==(r=null==a?void 0:a.modalizer)?void 0:r.userId;o&&(s.modalizerId=o)}let a=this._nextVal={element:e?new ef(this._win,e):void 0,detail:s};e&&e!==this._val&&this._validateFocusedElement(e),this._nextVal===a&&this.setVal(e,s),this._nextVal=void 0}setVal(e,t){super.setVal(e,t),e&&(this._lastVal=new ef(this._win,e))}static findNextTabbable(e,t,i,n,r,s,a){let o=i||t.root.getElement();if(!o)return null;let l=null,c=tJ._isTabbingTimer,d=e.getWindow();c&&d.clearTimeout(c),tJ.isTabbing=!0,tJ._isTabbingTimer=d.setTimeout(()=>{delete tJ._isTabbingTimer,tJ.isTabbing=!1},0);let u=t.modalizer,h=t.groupper,g=t.mover,p=t=>{if(l=t.findNextTabbable(n,r,s,a),n&&!(null==l?void 0:l.element)){let r=t!==u&&es.getParentElement(t.getElement());if(r){let o=e2.getTabsterContext(e,n,{referenceElement:r});if(o){let n=t.getElement(),c=s?n:n&&eq(n)||n;c&&(l=tJ.findNextTabbable(e,o,i,c,r,s,a))&&(l.outOfDOMOrder=!0)}}}};if(h&&g)p(t.groupperBeforeMover?h:g);else if(h)p(h);else if(g)p(g);else if(u)p(u);else{let t={container:o,currentElement:n,referenceElement:r,ignoreAccessibility:a,useActiveModalizer:!0},i={};l={element:e.focusable[s?"findPrev":"findNext"](t,i),outOfDOMOrder:i.outOfDOMOrder,uncontrolled:i.uncontrolled}}return l}}tJ.isTabbing=!1;class tK extends eB{constructor(e,t,i,n){super(i,e,eV,n,!0),this._setHandlers((n,s,a)=>{var o,l;let c=e.get(),d=n.input;if(c&&d){let e=e2.getTabsterContext(i,d);if(e){let u;(u=null==(o=t.findNextTabbable(a||void 0,void 0,s,!0))?void 0:o.element)||(u=null==(l=tJ.findNextTabbable(i,e,void 0,n.isOutside?d:eW(c,!s),void 0,s,!0))?void 0:l.element),u&&(0,r.ev)(u)}}})}}class tQ extends ex{constructor(e,t,i,n,r){super(e,t,n),this._shouldTabInside=!1,this.makeTabbable(!1),this._onDispose=i,e.controlTab||(this.dummyManager=new tK(this._element,this,e,r))}dispose(){var e;this._onDispose(this),this._element.get(),null==(e=this.dummyManager)||e.dispose(),delete this.dummyManager,delete this._first}findNextTabbable(e,t,i,n){let r,s=this.getElement();if(!s)return null;let a=eQ(e)===s;if(!this._shouldTabInside&&e&&es.nodeContains(s,e)&&!a)return{element:void 0,outOfDOMOrder:!0};let o=this.getFirst(!0);if(!e||!es.nodeContains(s,e)||a)return{element:o,outOfDOMOrder:!0};let l=this._tabster,c=null,d=!1;if(this._shouldTabInside&&o){let a={container:s,currentElement:e,referenceElement:t,ignoreAccessibility:n,useActiveModalizer:!0},o={};c=l.focusable[i?"findPrev":"findNext"](a,o),d=!!o.outOfDOMOrder,c||this._props.tabbability!==w.LimitedTrapFocus||(c=l.focusable[i?"findLast":"findFirst"]({container:s,ignoreAccessibility:n,useActiveModalizer:!0},o),d=!0),r=o.uncontrolled}return{element:c,uncontrolled:r,outOfDOMOrder:d}}makeTabbable(e){this._shouldTabInside=e||!this._props.tabbability}isActive(e){var t;let i=this.getElement()||null,n=!0;for(let e=es.getParentElement(i);e;e=es.getParentElement(e)){let i=null==(t=A(this._tabster,e))?void 0:t.groupper;i&&!i._shouldTabInside&&(n=!1)}let r=n?!!this._props.tabbability&&this._shouldTabInside:void 0;if(r&&e){let e=this._tabster.focusedElement.getFocusedElement();e&&(r=e!==this.getFirst(!0))}return r}getFirst(e){var t;let i,n=this.getElement();if(n){if(e&&this._tabster.focusable.isFocusable(n))return n;!(i=null==(t=this._first)?void 0:t.get())&&(i=this._tabster.focusable.findFirst({container:n,useActiveModalizer:!0})||void 0)&&this.setFirst(i)}return i}setFirst(e){e?this._first=new ef(this._tabster.getWindow,e):delete this._first}acceptElement(e,t){let i,n=t.cachedGrouppers,r=es.getParentElement(this.getElement()),s=r&&e2.getTabsterContext(this._tabster,r),a=null==s?void 0:s.groupper,o=(null==s?void 0:s.groupperBeforeMover)?a:void 0,l=e=>{let t,i=n[e.id];return i?t=i.isActive:(t=this.isActive(!0),i=n[e.id]={isActive:t}),t};if(o&&(i=o.getElement(),!l(o)&&i&&t.container!==i&&es.nodeContains(t.container,i)))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;let c=l(this),d=this.getElement();if(d&&!0!==c){let r;if(d===e&&a&&(i||(i=a.getElement()),i&&!l(a)&&es.nodeContains(t.container,i)&&i!==t.container)||d!==e&&es.nodeContains(d,e))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;let s=n[this.id];if((r="first"in s?s.first:s.first=this.getFirst(!0))&&t.acceptCondition(r))return(t.rejectElementsFrom=d,t.skippedFocusable=!0,r!==t.from)?(t.found=!0,t.foundElement=r,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT}}}class tY{constructor(e,t){this._current={},this._grouppers={},this._init=()=>{let e=this._win();this._tabster.focusedElement.subscribeFirst(this._onFocus);let t=e.document,i=es.getActiveElement(t);i&&this._onFocus(i),t.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),e.addEventListener(B,this._onMoveFocus)},this._onGroupperDispose=e=>{delete this._grouppers[e.id]},this._onFocus=e=>{e&&this._updateCurrent(e)},this._onMouseDown=e=>{let t=e.target;for(;t&&!this._tabster.focusable.isFocusable(t);)t=this._tabster.getParent(t);t&&this._updateCurrent(t)},this._onKeyDown=e=>{if(e.key!==tL&&e.key!==tF||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;let t=this._tabster.focusedElement.getFocusedElement();t&&this.handleKeyPress(t,e)},this._onMoveFocus=e=>{var t;let i=e.composedPath()[0],n=null==(t=e.detail)?void 0:t.action;i&&void 0!==n&&!e.defaultPrevented&&(n===P.Enter?this._enterGroupper(i):this._escapeGroupper(i),e.stopImmediatePropagation())},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){let e=this._win();this._tabster.focusedElement.cancelAsyncFocus(l),this._current={},this._updateTimer&&(e.clearTimeout(this._updateTimer),delete this._updateTimer),this._tabster.focusedElement.unsubscribe(this._onFocus),e.document.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),e.removeEventListener(B,this._onMoveFocus),Object.keys(this._grouppers).forEach(e=>{this._grouppers[e]&&(this._grouppers[e].dispose(),delete this._grouppers[e])})}createGroupper(e,t,i){let n=this._tabster,r=new tQ(n,e,this._onGroupperDispose,t,i);this._grouppers[r.id]=r;let s=n.focusedElement.getFocusedElement();return s&&es.nodeContains(e,s)&&!this._updateTimer&&(this._updateTimer=this._win().setTimeout(()=>{delete this._updateTimer,s===n.focusedElement.getFocusedElement()&&this._updateCurrent(s)},0)),r}forgetCurrentGrouppers(){this._current={}}_updateCurrent(e){var t;this._updateTimer&&(this._win().clearTimeout(this._updateTimer),delete this._updateTimer);let i=this._tabster,n={};for(let r=i.getParent(e);r;r=i.getParent(r)){let s=null==(t=A(i,r))?void 0:t.groupper;if(s){n[s.id]=!0,this._current[s.id]=s;let t=s.isActive()||e!==r&&(!s.getProps().delegated||s.getFirst(!1)!==e);s.makeTabbable(t)}}for(let e of Object.keys(this._current)){let t=this._current[e];t.id in n||(t.makeTabbable(!1),t.setFirst(void 0),delete this._current[e])}}_enterGroupper(e,t){let i=this._tabster,n=e2.getTabsterContext(i,e),r=(null==n?void 0:n.groupper)||(null==n?void 0:n.modalizerInGroupper),s=null==r?void 0:r.getElement();if(r&&s&&(e===s||r.getProps().delegated&&e===r.getFirst(!1))){let n=i.focusable.findNext({container:s,currentElement:e,useActiveModalizer:!0});if(n&&(!t||t&&s.dispatchEvent(new K({by:"groupper",owner:s,next:n,relatedEvent:t}))))return t&&(t.preventDefault(),t.stopImmediatePropagation()),n.focus(),n}return null}_escapeGroupper(e,t,i){let n=this._tabster,r=e2.getTabsterContext(n,e),s=(null==r?void 0:r.groupper)||(null==r?void 0:r.modalizerInGroupper),a=null==s?void 0:s.getElement();if(s&&a&&es.nodeContains(a,e)){let r;if(e!==a||i)r=s.getFirst(!0);else{let e=es.getParentElement(a),t=e?e2.getTabsterContext(n,e):void 0;r=null==(s=null==t?void 0:t.groupper)?void 0:s.getFirst(!0)}if(r&&(!t||t&&a.dispatchEvent(new K({by:"groupper",owner:a,next:r,relatedEvent:t}))))return s&&s.makeTabbable(!1),r.focus(),r}return null}moveFocus(e,t){return t===P.Enter?this._enterGroupper(e):this._escapeGroupper(e)}handleKeyPress(e,t,i){let n=this._tabster,r=e2.getTabsterContext(n,e);if(r&&((null==r?void 0:r.groupper)||(null==r?void 0:r.modalizerInGroupper))){if(n.focusedElement.cancelAsyncFocus(l),r.ignoreKeydown(t))return;if(t.key===tL)this._enterGroupper(e,t);else if(t.key===tF){let r=n.focusedElement.getFocusedElement();n.focusedElement.requestAsyncFocus(l,()=>{(r===n.focusedElement.getFocusedElement()||(!i||r)&&i)&&this._escapeGroupper(e,t,i)},0)}}}}class tZ extends tn{constructor(e){super(),this._onChange=e=>{this.setVal(e,void 0)},this._keyborg=(0,r.Vm)(e()),this._keyborg.subscribe(this._onChange)}dispose(){super.dispose(),this._keyborg&&(this._keyborg.unsubscribe(this._onChange),(0,r.ub)(this._keyborg),delete this._keyborg)}setNavigatingWithKeyboard(e){var t;null==(t=this._keyborg)||t.setVal(e)}isNavigatingWithKeyboard(){var e;return!!(null==(e=this._keyborg)?void 0:e.isNavigatingWithKeyboard())}}let tX=0,t0="aria-hidden";class t1 extends eB{constructor(e,t,i){super(t,e,eU,i),this._setHandlers((i,n)=>{var s,a;let o,l=e.get(),c=l&&(null==(s=e2.getRoot(t,l))?void 0:s.getElement()),d=i.input;if(c&&d){let e=eQ(d),i=e2.getTabsterContext(t,e||d);i&&(o=null==(a=tJ.findNextTabbable(t,i,c,d,void 0,n,!0))?void 0:a.element),o&&(0,r.ev)(o)}})}}class t2 extends ex{constructor(e,t,i,n,r,s){super(e,t,n),this._wasFocused=0,this.userId=n.id,this._onDispose=i,this._activeElements=s,e.controlTab||(this.dummyManager=new t1(this._element,e,r))}makeActive(e){if(this._isActive!==e){this._isActive=e;let t=this.getElement();if(t){let i=this._activeElements,n=i.map(e=>e.get()).indexOf(t);e?n<0&&i.push(new ef(this._tabster.getWindow,t)):n>=0&&i.splice(n,1)}this._dispatchEvent(e)}}focused(e){return e||(this._wasFocused=++tX),this._wasFocused}setProps(e){e.id&&(this.userId=e.id),this._props={...e}}dispose(){var e;this.makeActive(!1),this._onDispose(this),null==(e=this.dummyManager)||e.dispose(),delete this.dummyManager,this._activeElements=[],this._remove()}isActive(){return!!this._isActive}contains(e){return es.nodeContains(this.getElement(),e)}findNextTabbable(e,t,i,n){var r,s;let a;if(!this.getElement())return null;let o=this._tabster,l=null,c=!1,d=e&&(null==(r=e2.getRoot(o,e))?void 0:r.getElement());if(d){let r={container:d,currentElement:e,referenceElement:t,ignoreAccessibility:n,useActiveModalizer:!0},u={};!(l=o.focusable[i?"findPrev":"findNext"](r,u))&&this._props.isTrapped&&(null==(s=o.modalizer)?void 0:s.activeId)?(null===(l=o.focusable[i?"findLast":"findFirst"]({container:d,ignoreAccessibility:n,useActiveModalizer:!0},u))&&(l=e),c=!0):c=!!u.outOfDOMOrder,a=u.uncontrolled}return{element:l,uncontrolled:a,outOfDOMOrder:c}}_dispatchEvent(e,t){let i=this.getElement(),n=!1;if(i){for(let r of t?this._activeElements.map(e=>e.get()):[i])if(r){let t={id:this.userId,element:i},s=e?new X(t):new ee(t);r.dispatchEvent(s),s.defaultPrevented&&(n=!0)}}return n}_remove(){}}class t3{constructor(e,t,i){this._onModalizerDispose=e=>{let t=e.id,i=e.userId,n=this._parts[i];if(delete this._modalizers[t],n&&(delete n[t],0===Object.keys(n).length)){let e;delete this._parts[i];let t=this._activationHistory,n=[];for(let r=t.length;r--;){let s=t[r];s!==i&&s!==e&&(e=s,(s||n.length>0)&&n.unshift(s))}if(this._activationHistory=n,this.activeId===i){let e=n[0],t=e?Object.values(this._parts[e])[0]:void 0;this.setActive(t)}}},this._onKeyDown=e=>{var t;if(e.key!==tF)return;let i=this._tabster,n=i.focusedElement.getFocusedElement();if(n){let r=e2.getTabsterContext(i,n),s=null==r?void 0:r.modalizer;if(r&&!r.groupper&&(null==s?void 0:s.isActive())&&!r.ignoreKeydown(e)){let n=s.userId;if(n){let r=this._parts[n];if(r){let n=Object.keys(r).map(e=>{var t;let n,s=r[e],a=s.getElement();return a&&(n=null==(t=A(i,a))?void 0:t.groupper),s&&a&&n?{el:a,focusedSince:s.focused(!0)}:{focusedSince:0}}).filter(e=>e.focusedSince>0).sort((e,t)=>e.focusedSince>t.focusedSince?-1:+(e.focusedSince<t.focusedSince));if(n.length){let r=n[0].el;r&&(null==(t=i.groupper)||t.handleKeyPress(r,e,!0))}}}}}},this._onFocus=(e,t)=>{var i;let n=this._tabster,r=e&&e2.getTabsterContext(n,e);if(!r||!e)return;let s=this._augMap;for(let t=e;t;t=es.getParentElement(t))s.has(t)&&(s.delete(t),eG(n,t,t0));let a=r.modalizer,o=A(n,e),l=null==o?void 0:o.modalizer;if(l&&(l.focused(),l.userId===this.activeId&&o.groupper)){let t=n.getParent(e),r=t&&(null==(i=e2.getTabsterContext(n,t))?void 0:i.modalizer);if(!r)return void this.setActive(void 0);a=r}if(null==a||a.focused(),(null==a?void 0:a.userId)===this.activeId){this.currentIsOthersAccessible=null==a?void 0:a.getProps().isOthersAccessible;return}if(t.isFocusedProgrammatically||this.currentIsOthersAccessible||(null==a?void 0:a.getProps().isAlwaysAccessible))this.setActive(a);else{let t=this._win();t.clearTimeout(this._restoreModalizerFocusTimer),this._restoreModalizerFocusTimer=t.setTimeout(()=>this._restoreModalizerFocus(e),100)}},this._tabster=e,this._win=e.getWindow,this._modalizers={},this._parts={},this._augMap=new WeakMap,this._aug=[],this._alwaysAccessibleSelector=t,this._accessibleCheck=i,this._activationHistory=[],this.activeElements=[],e.controlTab||e.root.addDummyInputs(),this._win().addEventListener("keydown",this._onKeyDown,!0),e.queueInit(()=>{this._tabster.focusedElement.subscribe(this._onFocus)})}dispose(){let e=this._win();e.removeEventListener("keydown",this._onKeyDown,!0),Object.keys(this._modalizers).forEach(e=>{this._modalizers[e]&&(this._modalizers[e].dispose(),delete this._modalizers[e])}),e.clearTimeout(this._restoreModalizerFocusTimer),e.clearTimeout(this._hiddenUpdateTimer),this._parts={},delete this.activeId,this.activeElements=[],this._augMap=new WeakMap,this._aug=[],this._tabster.focusedElement.unsubscribe(this._onFocus)}createModalizer(e,t,i){var n;let r=new t2(this._tabster,e,this._onModalizerDispose,t,i,this.activeElements),s=r.id,a=t.id;this._modalizers[s]=r;let o=this._parts[a];o||(o=this._parts[a]={}),o[s]=r;let l=null!=(n=this._tabster.focusedElement.getFocusedElement())?n:null;return e!==l&&es.nodeContains(e,l)&&(a!==this.activeId?this.setActive(r):r.makeActive(!0)),r}isAugmented(e){return this._augMap.has(e)}hiddenUpdate(){this._hiddenUpdateTimer||(this._hiddenUpdateTimer=this._win().setTimeout(()=>{delete this._hiddenUpdateTimer,this._hiddenUpdate()},250))}setActive(e){let t=null==e?void 0:e.userId,i=this.activeId;if(i===t)return;if(this.activeId=t,i){let e=this._parts[i];if(e)for(let t of Object.keys(e))e[t].makeActive(!1)}if(t){let e=this._parts[t];if(e)for(let t of Object.keys(e))e[t].makeActive(!0)}this.currentIsOthersAccessible=null==e?void 0:e.getProps().isOthersAccessible,this.hiddenUpdate();let n=this._activationHistory;n[0]!==t&&(void 0!==t||n.length>0)&&n.unshift(t)}focus(e,t,i){let n=this._tabster,r=e2.getTabsterContext(n,e),s=null==r?void 0:r.modalizer;if(s){this.setActive(s);let e=s.getProps(),r=s.getElement();if(r){if(void 0===t&&(t=e.isNoFocusFirst),!t&&n.keyboardNavigation.isNavigatingWithKeyboard()&&n.focusedElement.focusFirst({container:r})||(void 0===i&&(i=e.isNoFocusDefault),!i&&n.focusedElement.focusDefault(r)))return!0;n.focusedElement.resetFocus(r)}}return!1}activate(e){var t;let i=e?null==(t=e2.getTabsterContext(this._tabster,e))?void 0:t.modalizer:void 0;return(!e||!!i)&&(this.setActive(i),!0)}acceptElement(e,t){var i;let n=t.modalizerUserId,r=null==(i=t.currentCtx)?void 0:i.modalizer;if(n)for(let t of this.activeElements){let i=t.get();if(i&&(es.nodeContains(e,i)||i===e))return NodeFilter.FILTER_SKIP}let s=n===(null==r?void 0:r.userId)||!n&&(null==r?void 0:r.getProps().isAlwaysAccessible)?void 0:NodeFilter.FILTER_SKIP;return void 0!==s&&(t.skippedFocusable=!0),s}_hiddenUpdate(){var e;let t=this._tabster,i=t.getWindow().document.body,n=this.activeId,r=this._parts,s=[],a=[],o=this._alwaysAccessibleSelector,l=o?Array.from(es.querySelectorAll(i,o)):[],c=[];for(let e of Object.keys(r)){let t=r[e];for(let i of Object.keys(t)){let r=t[i],o=r.getElement(),d=r.getProps().isAlwaysAccessible;o&&(e===n?(c.push(o),this.currentIsOthersAccessible||s.push(o)):d?l.push(o):a.push(o))}}let d=this._augMap,u=s.length>0?[...s,...l]:void 0,h=[],g=new WeakMap,p=(e,i)=>{var n;let r=e.tagName;if("SCRIPT"===r||"STYLE"===r)return;let s=!1;d.has(e)?i?s=!0:(d.delete(e),eG(t,e,t0)):i&&!(null==(n=this._accessibleCheck)?void 0:n.call(this,e,c))&&eG(t,e,t0,"true")&&(d.set(e,!0),s=!0),s&&(h.push(new ef(t.getWindow,e)),g.set(e,!0))},f=e=>{var i;for(let n=es.getFirstElementChild(e);n;n=es.getNextElementSibling(n)){let e=!1,r=!1,s=!1;if(u){let a=t.getParent(n);for(let t of u){if(n===t){e=!0;break}if(es.nodeContains(n,t)){r=!0;break}es.nodeContains(t,a)&&(s=!0)}r||(null==(i=n.__tabsterElementFlags)?void 0:i.noDirectAriaHidden)?f(n):e||s||p(n,!0)}else p(n,!1)}};u||l.forEach(e=>p(e,!1)),a.forEach(e=>p(e,!0)),i&&f(i),null==(e=this._aug)||e.map(e=>e.get()).forEach(e=>{e&&!g.get(e)&&p(e,!1)}),this._aug=h,this._augMap=g}_restoreModalizerFocus(e){var t;let i=null==e?void 0:e.ownerDocument;if(!e||!i)return;let n=this._tabster.focusedElement.getFocusedElement(),r=n&&(null==(t=e2.getTabsterContext(this._tabster,n))?void 0:t.modalizer);if(!n||n&&(null==r?void 0:r.userId)===this.activeId)return;let s=this._tabster,a=e2.getTabsterContext(s,e),o=null==a?void 0:a.modalizer,l=this.activeId;if(!o&&!l||o&&l===o.userId)return;let c=null==a?void 0:a.root.getElement();if(c){let t=s.focusable.findFirst({container:c,useActiveModalizer:!0});if(t){if(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_PRECEDING&&!(t=s.focusable.findLast({container:c,useActiveModalizer:!0})))throw Error("Something went wrong.");s.focusedElement.focus(t);return}}e.blur()}}let t4="input, textarea, *[contenteditable]";class t5 extends eB{constructor(e,t,i,n){super(t,e,e$,n),this._onFocusDummyInput=e=>{var t,i;let n=this._element.get(),s=e.input;if(n&&s){let a,o=e2.getTabsterContext(this._tabster,n);o&&(a=null==(t=tJ.findNextTabbable(this._tabster,o,void 0,s,void 0,!e.isFirst,!0))?void 0:t.element);let l=null==(i=this._getMemorized())?void 0:i.get();l&&this._tabster.focusable.isFocusable(l)&&(a=l),a&&(0,r.ev)(a)}},this._tabster=t,this._getMemorized=i,this._setHandlers(this._onFocusDummyInput)}}let t6=1,t8=2,t9=3;class t7 extends ex{constructor(e,t,i,n,r){var s;super(e,t,n),this._visible={},this._onIntersection=e=>{for(let t of e){let e,i=t.target,n=eP(this._win,i),r=this._fullyVisible;if(t.intersectionRatio>=.25?(e=t.intersectionRatio>=.75?T.Visible:T.PartiallyVisible)===T.Visible&&(r=n):e=T.Invisible,this._visible[n]!==e){void 0===e?(delete this._visible[n],r===n&&delete this._fullyVisible):(this._visible[n]=e,this._fullyVisible=r);let t=this.getState(i);t&&i.dispatchEvent(new Q(t))}}},this._win=e.getWindow,this.visibilityTolerance=null!=(s=n.visibilityTolerance)?s:.8,(this._props.trackState||this._props.visibilityAware)&&(this._intersectionObserver=new IntersectionObserver(this._onIntersection,{threshold:[0,.25,.5,.75,1]}),this._observeState()),this._onDispose=i;let a=()=>n.memorizeCurrent?this._current:void 0;e.controlTab||(this.dummyManager=new t5(this._element,e,a,r))}dispose(){var e;this._onDispose(this),this._intersectionObserver&&(this._intersectionObserver.disconnect(),delete this._intersectionObserver),delete this._current,delete this._fullyVisible,delete this._allElements,delete this._updateQueue,this._unobserve&&(this._unobserve(),delete this._unobserve);let t=this._win();this._setCurrentTimer&&(t.clearTimeout(this._setCurrentTimer),delete this._setCurrentTimer),this._updateTimer&&(t.clearTimeout(this._updateTimer),delete this._updateTimer),null==(e=this.dummyManager)||e.dispose(),delete this.dummyManager}setCurrent(e){e?this._current=new ef(this._win,e):this._current=void 0,(this._props.trackState||this._props.visibilityAware)&&!this._setCurrentTimer&&(this._setCurrentTimer=this._win().setTimeout(()=>{var e;delete this._setCurrentTimer;let t=[];for(let i of(this._current!==this._prevCurrent&&(t.push(this._current),t.push(this._prevCurrent),this._prevCurrent=this._current),t)){let t=null==i?void 0:i.get();if(t&&(null==(e=this._allElements)?void 0:e.get(t))===this){let e=this._props;if(t&&(void 0!==e.visibilityAware||e.trackState)){let e=this.getState(t);e&&t.dispatchEvent(new Q(e))}}}}))}getCurrent(){var e;return(null==(e=this._current)?void 0:e.get())||null}findNextTabbable(e,t,i,n){let r,s=this.getElement(),a=s&&eQ(e)===s;if(!s)return null;let o=null,l=!1;if(this._props.tabbable||a||e&&!es.nodeContains(s,e)){let a={currentElement:e,referenceElement:t,container:s,ignoreAccessibility:n,useActiveModalizer:!0},c={};o=this._tabster.focusable[i?"findPrev":"findNext"](a,c),l=!!c.outOfDOMOrder,r=c.uncontrolled}return{element:o,uncontrolled:r,outOfDOMOrder:l}}acceptElement(e,t){var i,n;if(!tJ.isTabbing)return(null==(i=t.currentCtx)?void 0:i.excludedFromMover)?NodeFilter.FILTER_REJECT:void 0;let{memorizeCurrent:r,visibilityAware:s,hasDefault:a=!0}=this._props,o=this.getElement();if(o&&(r||s||a)&&(!es.nodeContains(o,t.from)||eQ(t.from)===o)){let e;if(r){let i=null==(n=this._current)?void 0:n.get();i&&t.acceptCondition(i)&&(e=i)}if(!e&&a&&(e=this._tabster.focusable.findDefault({container:o,useActiveModalizer:!0})),!e&&s&&(e=this._tabster.focusable.findElement({container:o,useActiveModalizer:!0,isBackward:t.isBackward,acceptCondition:e=>{var i;let n=eP(this._win,e),r=this._visible[n];return o!==e&&!!(null==(i=this._allElements)?void 0:i.get(e))&&t.acceptCondition(e)&&(r===T.Visible||r===T.PartiallyVisible&&(s===T.PartiallyVisible||!this._fullyVisible))}})),e)return t.found=!0,t.foundElement=e,t.rejectElementsFrom=o,t.skippedFocusable=!0,NodeFilter.FILTER_ACCEPT}}_observeState(){let e=this.getElement();if(this._unobserve||!e||"undefined"==typeof MutationObserver)return;let t=this._win(),i=this._allElements=new WeakMap,n=this._tabster.focusable,r=this._updateQueue=[],s=es.createMutationObserver(e=>{for(let t of e){let e=t.target,i=t.removedNodes,n=t.addedNodes;if("attributes"===t.type)"tabindex"===t.attributeName&&r.push({element:e,type:t8});else{for(let e=0;e<i.length;e++)r.push({element:i[e],type:t9});for(let e=0;e<n.length;e++)r.push({element:n[e],type:t6})}}d()}),a=(e,t)=>{var n,r;let s=i.get(e);s&&t&&(null==(n=this._intersectionObserver)||n.unobserve(e),i.delete(e)),s||t||(i.set(e,this),null==(r=this._intersectionObserver)||r.observe(e))},o=e=>{let t=n.isFocusable(e);i.get(e)?t||a(e,!0):t&&a(e)},l=e=>{let{mover:i}=u(e);if(i&&i!==this)if(!(i.getElement()===e&&n.isFocusable(e)))return;else a(e);let r=ey(t.document,e,e=>{let{mover:t,groupper:i}=u(e);if(t&&t!==this)return NodeFilter.FILTER_REJECT;let r=null==i?void 0:i.getFirst(!0);return i&&i.getElement()!==e&&r&&r!==e?NodeFilter.FILTER_REJECT:(n.isFocusable(e)&&a(e),NodeFilter.FILTER_SKIP)});if(r)for(r.currentNode=e;r.nextNode(););},c=e=>{i.get(e)&&a(e,!0);for(let t=es.getFirstElementChild(e);t;t=es.getNextElementSibling(t))c(t)},d=()=>{!this._updateTimer&&r.length&&(this._updateTimer=t.setTimeout(()=>{for(let{element:e,type:t}of(delete this._updateTimer,r))switch(t){case t8:o(e);break;case t6:l(e);break;case t9:c(e)}r=this._updateQueue=[]},0))},u=e=>{let t={};for(let i=e;i;i=es.getParentElement(i)){let e=A(this._tabster,i);if(e&&(e.groupper&&!t.groupper&&(t.groupper=e.groupper),e.mover)){t.mover=e.mover;break}}return t};r.push({element:e,type:t6}),d(),s.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["tabindex"]}),this._unobserve=()=>{s.disconnect()}}getState(e){let t=eP(this._win,e);if(t in this._visible){let i=this._visible[t]||T.Invisible;return{isCurrent:this._current?this._current.get()===e:void 0,visibility:i}}}}function ie(e,t,i,n,r,s,a,o){let l=i<r?r-i:a<e?e-a:0,c=n<s?s-n:o<t?t-o:0;return 0===l?c:0===c?l:Math.sqrt(l*l+c*c)}class it{constructor(e,t){this._init=()=>{let e=this._win();e.addEventListener("keydown",this._onKeyDown,!0),e.addEventListener($,this._onMoveFocus),e.addEventListener(V,this._onMemorizedElement),this._tabster.focusedElement.subscribe(this._onFocus)},this._onMoverDispose=e=>{delete this._movers[e.id]},this._onFocus=e=>{var t;let i=e,n=e;for(let r=es.getParentElement(e);r;r=es.getParentElement(r)){let e=null==(t=A(this._tabster,r))?void 0:t.mover;e&&(e.setCurrent(n),i=void 0),!i&&this._tabster.focusable.isFocusable(r)&&(i=n=r)}},this._onKeyDown=async e=>{var t;let i;if(this._ignoredInputTimer&&(this._win().clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),null==(t=this._ignoredInputResolve)||t.call(this,!1),e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;let n=e.key;if(n===tW?i=I.ArrowDown:n===tq?i=I.ArrowRight:n===tj?i=I.ArrowUp:n===tH?i=I.ArrowLeft:n===t$?i=I.PageDown:n===tU?i=I.PageUp:n===tB?i=I.Home:n===tV&&(i=I.End),!i)return;let r=this._tabster.focusedElement.getFocusedElement();!r||await this._isIgnoredInput(r,n)||this._moveFocus(r,i,e)},this._onMoveFocus=e=>{var t;let i=e.composedPath()[0],n=null==(t=e.detail)?void 0:t.key;i&&void 0!==n&&!e.defaultPrevented&&(this._moveFocus(i,n),e.stopImmediatePropagation())},this._onMemorizedElement=e=>{var t;let i=e.composedPath()[0],n=null==(t=e.detail)?void 0:t.memorizedElement;if(i){let t=e2.getTabsterContext(this._tabster,i),r=null==t?void 0:t.mover;r&&(n&&!es.nodeContains(r.getElement(),n)&&(n=void 0),r.setCurrent(n),e.stopImmediatePropagation())}},this._tabster=e,this._win=t,this._movers={},e.queueInit(this._init)}dispose(){var e;let t=this._win();this._tabster.focusedElement.unsubscribe(this._onFocus),null==(e=this._ignoredInputResolve)||e.call(this,!1),this._ignoredInputTimer&&(t.clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),t.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener($,this._onMoveFocus),t.removeEventListener(V,this._onMemorizedElement),Object.keys(this._movers).forEach(e=>{this._movers[e]&&(this._movers[e].dispose(),delete this._movers[e])})}createMover(e,t,i){let n=new t7(this._tabster,e,this._onMoverDispose,t,i);return this._movers[n.id]=n,n}moveFocus(e,t){return this._moveFocus(e,t)}_moveFocus(e,t,i){var n,s;let a,o,l,c=this._tabster,d=e2.getTabsterContext(c,e,{checkRtl:!0});if(!d||!d.mover||d.excludedFromMover||i&&d.ignoreKeydown(i))return null;let u=d.mover,h=u.getElement();if(d.groupperBeforeMover){let e=d.groupper;if(!e||e.isActive(!0))return null;for(let t=es.getParentElement(e.getElement());t&&t!==h;t=es.getParentElement(t))if(null==(s=null==(n=A(c,t))?void 0:n.groupper)?void 0:s.isActive(!0))return null}if(!h)return null;let g=c.focusable,p=u.getProps(),f=p.direction||_.Both,m=f===_.Both,v=m||f===_.Vertical,S=m||f===_.Horizontal,y=f===_.GridLinear,C=y||f===_.Grid,b=p.cyclic,T=0,E=0;if(C&&(T=Math.ceil((l=e.getBoundingClientRect()).left),E=Math.floor(l.right)),d.rtl&&(t===I.ArrowRight?t=I.ArrowLeft:t===I.ArrowLeft&&(t=I.ArrowRight)),t===I.ArrowDown&&v||t===I.ArrowRight&&(S||C))if((a=g.findNext({currentElement:e,container:h,useActiveModalizer:!0}))&&C){let e=Math.ceil(a.getBoundingClientRect().left);!y&&E>e&&(a=void 0)}else!a&&b&&(a=g.findFirst({container:h,useActiveModalizer:!0}));else if(t===I.ArrowUp&&v||t===I.ArrowLeft&&(S||C))if((a=g.findPrev({currentElement:e,container:h,useActiveModalizer:!0}))&&C){let e=Math.floor(a.getBoundingClientRect().right);!y&&e>T&&(a=void 0)}else!a&&b&&(a=g.findLast({container:h,useActiveModalizer:!0}));else if(t===I.Home)C?g.findElement({container:h,currentElement:e,useActiveModalizer:!0,isBackward:!0,acceptCondition:t=>{var i;if(!g.isFocusable(t))return!1;let n=Math.ceil(null!=(i=t.getBoundingClientRect().left)?i:0);return t!==e&&T<=n||(a=t,!1)}}):a=g.findFirst({container:h,useActiveModalizer:!0});else if(t===I.End)C?g.findElement({container:h,currentElement:e,useActiveModalizer:!0,acceptCondition:t=>{var i;if(!g.isFocusable(t))return!1;let n=Math.ceil(null!=(i=t.getBoundingClientRect().left)?i:0);return t!==e&&T>=n||(a=t,!1)}}):a=g.findLast({container:h,useActiveModalizer:!0});else if(t===I.PageUp){if(g.findElement({currentElement:e,container:h,useActiveModalizer:!0,isBackward:!0,acceptCondition:e=>!!g.isFocusable(e)&&(!eb(this._win,e,u.visibilityTolerance)||(a=e,!1))}),C&&a){let e=Math.ceil(a.getBoundingClientRect().left);g.findElement({currentElement:a,container:h,useActiveModalizer:!0,acceptCondition:t=>{if(!g.isFocusable(t))return!1;let i=Math.ceil(t.getBoundingClientRect().left);return T<i||e>=i||(a=t,!1)}})}o=!1}else if(t===I.PageDown){if(g.findElement({currentElement:e,container:h,useActiveModalizer:!0,acceptCondition:e=>!!g.isFocusable(e)&&(!eb(this._win,e,u.visibilityTolerance)||(a=e,!1))}),C&&a){let e=Math.ceil(a.getBoundingClientRect().left);g.findElement({currentElement:a,container:h,useActiveModalizer:!0,isBackward:!0,acceptCondition:t=>{if(!g.isFocusable(t))return!1;let i=Math.ceil(t.getBoundingClientRect().left);return T>i||e<=i||(a=t,!1)}})}o=!0}else if(C){let i,n,r=t===I.ArrowUp,s=T,o=Math.ceil(l.top),c=E,d=Math.floor(l.bottom),u=0;g.findAll({container:h,currentElement:e,isBackward:r,onElement:e=>{let t=e.getBoundingClientRect(),a=Math.ceil(t.left),l=Math.ceil(t.top),h=Math.floor(t.right),g=Math.floor(t.bottom);if(r&&o<g||!r&&d>l)return!0;let p=Math.ceil(Math.min(c,h))-Math.floor(Math.max(s,a)),f=Math.ceil(Math.min(c-s,h-a));if(p>0&&f>=p){let t=p/f;t>u&&(i=e,u=t)}else if(0===u){let t=ie(s,o,c,d,a,l,h,g);(void 0===n||t<n)&&(n=t,i=e)}else if(u>0)return!1;return!0}}),a=i}return a&&(!i||i&&h.dispatchEvent(new K({by:"mover",owner:h,next:a,relatedEvent:i})))?(void 0!==o&&eT(this._win,a,o),i&&(i.preventDefault(),i.stopImmediatePropagation()),(0,r.ev)(a),a):null}async _isIgnoredInput(e,t){if("true"===e.getAttribute("aria-expanded")&&e.hasAttribute("aria-activedescendant"))return!0;if(eD(e,t4)){let i,n=0,r=0,s=0;if("INPUT"===e.tagName||"TEXTAREA"===e.tagName){let i=e.type;if(s=(e.value||"").length,"email"===i||"number"===i){if(s){let i=es.getSelection(e);if(i){let e=i.toString().length,n=t===tH||t===tj;if(i.modify("extend",n?"backward":"forward","character"),e!==i.toString().length)return i.modify("extend",n?"forward":"backward","character"),!0;s=0}}}else{let t=e.selectionStart;if(null===t)return"hidden"===i;n=t||0,r=e.selectionEnd||0}}else"true"===e.contentEditable&&(i=new(eO(this._win))(t=>{this._ignoredInputResolve=e=>{delete this._ignoredInputResolve,t(e)};let i=this._win();this._ignoredInputTimer&&i.clearTimeout(this._ignoredInputTimer);let{anchorNode:a,focusNode:o,anchorOffset:l,focusOffset:c}=es.getSelection(e)||{};this._ignoredInputTimer=i.setTimeout(()=>{var t,i,d;delete this._ignoredInputTimer;let{anchorNode:u,focusNode:h,anchorOffset:g,focusOffset:p}=es.getSelection(e)||{};if(u!==a||h!==o||g!==l||p!==c){null==(t=this._ignoredInputResolve)||t.call(this,!1);return}if(n=g||0,r=p||0,s=(null==(i=e.textContent)?void 0:i.length)||0,u&&h&&es.nodeContains(e,u)&&es.nodeContains(e,h)&&u!==e){let t=!1,i=e=>{if(e===u)t=!0;else if(e===h)return!0;let s=e.textContent;if(s&&!es.getFirstChild(e)){let e=s.length;t?h!==u&&(r+=e):(n+=e,r+=e)}let a=!1;for(let t=es.getFirstChild(e);t&&!a;t=t.nextSibling)a=i(t);return a};i(e)}null==(d=this._ignoredInputResolve)||d.call(this,!0)},0)}));if(i&&!await i||n!==r||n>0&&(t===tH||t===tj||t===tB)||n<s&&(t===tq||t===tW||t===tV))return!0}return!1}}function ii(e,t,i,n){let r;if("undefined"==typeof MutationObserver)return()=>{};let a=t.getWindow,o=e=>{var n,r,a,o,c;let d=new Set;for(let c of e){let e=c.target,u=c.removedNodes,h=c.addedNodes;if("attributes"===c.type)c.attributeName!==s||d.has(e)||i(t,e);else{for(let i=0;i<u.length;i++){let s=u[i];d.add(s),l(s,!0),null==(r=(n=t._dummyObserver).domChanged)||r.call(n,e)}for(let i=0;i<h.length;i++)l(h[i]),null==(o=(a=t._dummyObserver).domChanged)||o.call(a,e)}}d.clear(),null==(c=t.modalizer)||c.hiddenUpdate()};function l(t,i){r||(r=ed(a).elementByUId),c(t,i);let n=ey(e,t,e=>c(e,i));if(n)for(;n.nextNode(););}function c(e,n){var o;if(!e.getAttribute)return NodeFilter.FILTER_SKIP;let l=e.__tabsterElementUID;return l&&r&&(n?delete r[l]:null!=(o=r[l])||(r[l]=new ef(a,e))),(A(t,e)||e.hasAttribute(s))&&i(t,e,n),NodeFilter.FILTER_SKIP}let d=es.createMutationObserver(o);return n&&l(a().document.body),d.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[s]}),()=>{d.disconnect()}}let ir=100;class is extends tn{constructor(e){super(),this._waiting={},this._lastRequestFocusId=0,this._observedById={},this._observedByName={},this._currentRequestTimestamp=0,this._onFocus=e=>{if(e){let e=this._currentRequest;e&&Date.now()-this._currentRequestTimestamp>=300&&(delete this._currentRequest,e.cancel())}},this.onObservedElementUpdate=e=>{var t;let i=null==(t=A(this._tabster,e))?void 0:t.observed,n=eP(this._win,e),r=this._observedById[n];if(i&&eM(e.ownerDocument,e)){r||(r=this._observedById[n]={element:new ef(this._win,e)}),i.names.sort();let t=i.names,s=r.prevNames;this._isObservedNamesUpdated(t,s)&&(s&&s.forEach(e=>{let t=this._observedByName[e];t&&t[n]&&(Object.keys(t).length>1?delete t[n]:delete this._observedByName[e])}),r.prevNames=t),t.forEach(e=>{let t=this._observedByName[e];t||(t=this._observedByName[e]={}),t[n]=r,this._waitConditional(e)})}else if(r){let e=r.prevNames;e&&e.forEach(e=>{let t=this._observedByName[e];t&&t[n]&&(Object.keys(t).length>1?delete t[n]:delete this._observedByName[e])}),delete this._observedById[n]}},this._tabster=e,this._win=e.getWindow,e.queueInit(()=>{this._tabster.focusedElement.subscribe(this._onFocus)})}dispose(){for(let e of(this._tabster.focusedElement.unsubscribe(this._onFocus),Object.keys(this._waiting)))this._rejectWaiting(e);this._observedById={},this._observedByName={}}_rejectWaiting(e,t){let i=this._waiting[e];if(i){let n=this._win();i.timer&&n.clearTimeout(i.timer),i.conditionTimer&&n.clearTimeout(i.conditionTimer),!t&&i.reject?i.reject():t&&i.resolve&&i.resolve(null),delete this._waiting[e]}}_isObservedNamesUpdated(e,t){if(!t||e.length!==t.length)return!0;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!0;return!1}getElement(e,t){let i=this._observedByName[e];if(i)for(let e of Object.keys(i)){let n=i[e].element.get()||null;return n?(t!==h||this._tabster.focusable.isAccessible(n))&&(t!==g||this._tabster.focusable.isFocusable(n,!0))||(n=null):(delete i[e],delete this._observedById[e]),n}return null}waitElement(e,t,i){let n,r=this.getElement(e,i);if(r)return{result:eO(this._win).resolve(r),cancel:()=>{},status:p.Succeeded};let s=(n=i===h?"a":i===g?"f":"_")+e,a=this._waiting[s];if(a&&a.request)return a.request;a=this._waiting[s]={timer:this._win().setTimeout(()=>{a.conditionTimer&&this._win().clearTimeout(a.conditionTimer),delete this._waiting[s],a.request&&(a.request.status=p.TimedOut),a.resolve&&a.resolve(null)},t)};let o={result:new(eO(this._win))((e,t)=>{a.resolve=e,a.reject=t}).catch(()=>null),cancel:()=>{o.status===p.Waiting&&(o.status=p.Canceled),this._rejectWaiting(s,!0)},status:p.Waiting};return a.request=o,i&&this.getElement(e)&&this._waitConditional(e),o}requestFocus(e,t,i){void 0===i&&(i={});let n=++this._lastRequestFocusId,r=this._currentRequest;r&&r.cancel();let s=this.waitElement(e,t,g);this._currentRequest=s,this._currentRequestTimestamp=Date.now();let a={result:s.result.then(e=>this._lastRequestFocusId===n&&!!e&&this._tabster.focusedElement.focus(e,!0,void 0,i.preventScroll)),cancel:()=>{s.cancel()},status:s.status};return s.result.finally(()=>{this._currentRequest===s&&delete this._currentRequest,a.status=s.status}),a}_waitConditional(e){let t="_"+e,i="a"+e,n="f"+e,r=this._waiting[t],s=this._waiting[i],a=this._waiting[n],o=this._win(),l=(t,i,n,r)=>{var s;let a=null==(s=A(this._tabster,t))?void 0:s.observed;a&&a.names.includes(e)&&(n.timer&&o.clearTimeout(n.timer),delete this._waiting[i],n.request&&(n.request.status=p.Succeeded),n.resolve&&n.resolve(t),this.trigger(t,{names:[e],details:a.details,accessibility:r}))};if(r){let i=this.getElement(e);i&&eM(i.ownerDocument,i)&&l(i,t,r,u)}if(s&&!s.conditionTimer){let t=()=>{let n=this.getElement(e);n&&eM(n.ownerDocument,n)&&this._tabster.focusable.isAccessible(n)?l(n,i,s,h):s.conditionTimer=o.setTimeout(t,ir)};t()}if(a&&!a.conditionTimer){let t=()=>{let i=this.getElement(e);i&&eM(i.ownerDocument,i)&&this._tabster.focusable.isFocusable(i,!0)?l(i,n,a,g):a.conditionTimer=o.setTimeout(t,ir)};t()}}}let ia={areaClass:"tabster-focus-outline-area",outlineClass:"tabster-focus-outline",outlineColor:"#ff4500",outlineWidth:2,zIndex:0x7fffffff},io=ia;class il{constructor(e,t,i,n){this.left=e,this.top=t,this.right=i,this.bottom=n}equalsTo(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom}clone(){return new il(this.left,this.top,this.right,this.bottom)}}class ic{constructor(e){this._isVisible=!1,this._allOutlineElements=[],this._init=()=>{this._tabster.keyboardNavigation.subscribe(this._onKeyboardNavigationStateChanged),this._tabster.focusedElement.subscribe(this._onFocus);let e=this._win();e.addEventListener("scroll",this._onScroll,!0),this._fullScreenEventName&&e.document.addEventListener(this._fullScreenEventName,this._onFullScreenChanged)},this._onFullScreenChanged=e=>{if(!this._fullScreenElementName||!e.target)return;let t=e.target.body||e.target,i=this._getDOM(t);if(t.ownerDocument&&i){let e=t.ownerDocument[this._fullScreenElementName];e?(e.appendChild(i.container),this._fullScreenElement=e):(t.ownerDocument.body.appendChild(i.container),this._fullScreenElement=void 0)}},this._onKeyboardNavigationStateChanged=()=>{this._onFocus(this._tabster.focusedElement.getFocusedElement())},this._onFocus=e=>{!this._updateElement(e)&&this._isVisible&&this._setVisibility(!1)},this._onScroll=e=>{this._outlinedElement&&ic._isParentChild(e.target,this._outlinedElement)&&(this._curPos=void 0,this._setOutlinePosition())},this._tabster=e,this._win=e.getWindow,e.queueInit(this._init),"undefined"!=typeof document&&("onfullscreenchange"in document?(this._fullScreenEventName="fullscreenchange",this._fullScreenElementName="fullscreenElement"):"onwebkitfullscreenchange"in document?(this._fullScreenEventName="webkitfullscreenchange",this._fullScreenElementName="webkitFullscreenElement"):"onmozfullscreenchange"in document?(this._fullScreenEventName="mozfullscreenchange",this._fullScreenElementName="mozFullScreenElement"):"onmsfullscreenchange"in document&&(this._fullScreenEventName="msfullscreenchange",this._fullScreenElementName="msFullscreenElement"))}setup(e){io={...io,...e};let t=this._win();t.__tabsterOutline||(t.__tabsterOutline={}),t.__tabsterOutline.style||(t.__tabsterOutline.style=id(t.document,io)),e&&e.areaClass?t.document.body.classList.remove(ia.areaClass):t.document.body.classList.add(ia.areaClass)}dispose(){let e=this._win();this._updateTimer&&(e.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._tabster.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),this._tabster.focusedElement.unsubscribe(this._onFocus),e.removeEventListener("scroll",this._onScroll,!0),this._fullScreenEventName&&e.document.removeEventListener(this._fullScreenEventName,this._onFullScreenChanged),this._allOutlineElements.forEach(e=>this._removeDOM(e.container)),this._allOutlineElements=[],delete this._outlinedElement,delete this._curPos,delete this._curOutlineElements,delete this._fullScreenElement}_shouldShowCustomOutline(e){let t=A(this._tabster,e);if(t&&t.outline&&t.outline.isIgnored)return!1;for(let t=e;t;t=t.parentElement)if(t.classList&&t.classList.contains(io.areaClass))return!0;return!1}_updateElement(e){if(this._outlinedElement=void 0,this._updateTimer&&(this._win().clearTimeout(this._updateTimer),this._updateTimer=void 0),this._curPos=void 0,!this._tabster.keyboardNavigation.isNavigatingWithKeyboard())return!1;if(e){if("INPUT"===e.tagName){if(!(e.type in{button:!0,checkbox:!0,file:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}))return!1}else if("TEXTAREA"===e.tagName||"true"===e.contentEditable||"IFRAME"===e.tagName)return!1;return!!this._shouldShowCustomOutline(e)&&(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()&&(this._outlinedElement=e,this._updateOutline()),!0)}return!1}_updateOutline(){this._setOutlinePosition(),this._updateTimer&&(this._win().clearTimeout(this._updateTimer),this._updateTimer=void 0),this._outlinedElement&&(this._updateTimer=this._win().setTimeout(()=>{this._updateTimer=void 0,this._updateOutline()},30))}_setVisibility(e){this._isVisible=e,this._curOutlineElements&&(e?this._curOutlineElements.container.classList.add(`${io.outlineClass}_visible`):(this._curOutlineElements.container.classList.remove(`${io.outlineClass}_visible`),this._curPos=void 0))}_setOutlinePosition(){if(!this._outlinedElement)return;let e=eC(this._win,this._outlinedElement),t=new il(e.left,e.top,e.right,e.bottom);if(this._curPos&&t.equalsTo(this._curPos))return;let i=this._getDOM(this._outlinedElement),n=this._outlinedElement.ownerDocument&&this._outlinedElement.ownerDocument.defaultView;if(!i||!n)return;this._curOutlineElements!==i&&(this._setVisibility(!1),this._curOutlineElements=i),this._curPos=t;let r=t.clone(),s=!1,a=!1,o=i.container,l=o&&o.ownerDocument&&o.ownerDocument.scrollingElement;if(!l)return;for(let t=this._outlinedElement.parentElement;t&&t.nodeType===Node.ELEMENT_NODE&&t!==this._fullScreenElement;t=t.parentElement){e=eC(this._win,t);let i=t.ownerDocument&&t.ownerDocument.defaultView;if(!i)return;let n=i.getComputedStyle(t),o=n.position;"absolute"===o?s=!0:("fixed"===o||"sticky"===o)&&(a=!0),"visible"!==n.overflow&&((s||a)&&"hidden"!==n.overflow||(e.left>r.left&&(r.left=e.left),e.top>r.top&&(r.top=e.top),e.right<r.right&&(r.right=e.right),e.bottom<r.bottom&&(r.bottom=e.bottom)))}let c=eC(this._win,l),d=c.left+c.right,u=c.top+c.bottom,h=io.outlineWidth;r.left=r.left>h?r.left-h:0,r.top=r.top>h?r.top-h:0,r.right=r.right<d-h?r.right+h:d,r.bottom=r.bottom<u-h?r.bottom+h:u;let g=r.right-r.left,p=r.bottom-r.top;if(g>2*h&&p>2*h){let e=i.left,t=i.top,s=i.right,l=i.bottom,c=this._fullScreenElement||a?0:n.pageXOffset,d=this._fullScreenElement||a?0:n.pageYOffset;o.style.position=a?"fixed":"absolute",o.style.background=io.outlineColor,e.style.width=s.style.width=t.style.height=l.style.height=io.outlineWidth+"px",e.style.left=t.style.left=l.style.left=r.left+c+"px",s.style.left=r.left+c+g-h+"px",e.style.top=s.style.top=t.style.top=r.top+d+"px",l.style.top=r.top+d+p-h+"px",e.style.height=s.style.height=p+"px",t.style.width=l.style.width=g+"px",this._setVisibility(!0)}else this._setVisibility(!1)}_getDOM(e){let t=e.ownerDocument,i=t&&t.defaultView;if(t&&i&&i.__tabsterOutline){if(i.__tabsterOutline.style||(i.__tabsterOutline.style=id(t,io)),!i.__tabsterOutline.elements){let e={container:t.createElement("div"),left:t.createElement("div"),top:t.createElement("div"),right:t.createElement("div"),bottom:t.createElement("div")};e.container.className=io.outlineClass,e.left.className=`${io.outlineClass}__left`,e.top.className=`${io.outlineClass}__top`,e.right.className=`${io.outlineClass}__right`,e.bottom.className=`${io.outlineClass}__bottom`,e.container.appendChild(e.left),e.container.appendChild(e.top),e.container.appendChild(e.right),e.container.appendChild(e.bottom),t.body.appendChild(e.container),i.__tabsterOutline.elements=e,this._allOutlineElements.push(e)}return i.__tabsterOutline.elements}}_removeDOM(e){let t=e.ownerDocument&&e.ownerDocument.defaultView,i=t&&t.__tabsterOutline;if(!i)return;i.style&&i.style.parentNode&&(i.style.parentNode.removeChild(i.style),delete i.style);let n=i&&i.elements;n&&(n.container.parentNode&&n.container.parentNode.removeChild(n.container),delete i.elements)}static _isParentChild(e,t){return t===e||!!(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_CONTAINED_BY)}}function id(e,t){let i=e.createElement("style");return i.type="text/css",i.appendChild(e.createTextNode(iu(t))),e.head.appendChild(i),i}function iu(e){return`
.${e.areaClass} *, .${e.areaClass} *:focus {
outline: none !important;
}

.${e.outlineClass} {
display: none;
position: absolute;
width: 0;
height: 0;
left: 0;
top: 0;
z-index: ${e.zIndex};
}

.${e.outlineClass}.${e.outlineClass}_visible {
display: block;
}

.${e.outlineClass}__left,
.${e.outlineClass}__top,
.${e.outlineClass}__right,
.${e.outlineClass}__bottom {
position: absolute;
background: inherit;
}`}class ih{constructor(e){this._isUncontrolledCompletely=e}isUncontrolledCompletely(e,t){var i;let n=null==(i=this._isUncontrolledCompletely)?void 0:i.call(this,e,t);return void 0===n?t:n}}class ig extends ex{constructor(e,t,i){var n;if(super(e,t,i),this._hasFocus=!1,this._onFocusOut=e=>{var t;let i=null==(t=this._element)?void 0:t.get();i&&null===e.relatedTarget&&i.dispatchEvent(new ei),i&&!es.nodeContains(i,e.relatedTarget)&&(this._hasFocus=!1)},this._onFocusIn=()=>{this._hasFocus=!0},this._props.type===E.Source){let e=null==(n=this._element)?void 0:n.get();null==e||e.addEventListener("focusout",this._onFocusOut),null==e||e.addEventListener("focusin",this._onFocusIn),this._hasFocus=es.nodeContains(e,e&&es.getActiveElement(e.ownerDocument))}}dispose(){var e;if(this._props.type===E.Source){let t=null==(e=this._element)?void 0:e.get();null==t||t.removeEventListener("focusout",this._onFocusOut),null==t||t.removeEventListener("focusin",this._onFocusIn),this._hasFocus&&this._tabster.getWindow().document.body.dispatchEvent(new ei)}}}class ip{constructor(e){this._stack=[],this._getWindow=e}push(e){var t;(null==(t=this._stack[this._stack.length-1])?void 0:t.get())!==e&&(this._stack.length>ip.DEPTH&&this._stack.shift(),this._stack.push(new ef(this._getWindow,e)))}pop(e){var t;void 0===e&&(e=()=>!0);let i=this._getWindow().document;for(let n=this._stack.length-1;n>=0;n--){let n=null==(t=this._stack.pop())?void 0:t.get();if(n&&es.nodeContains(i.body,es.getParentElement(n))&&e(n))return n}}}ip.DEPTH=10;class im{constructor(e){this._onRestoreFocus=e=>{var t,i;this._focusedElementState.cancelAsyncFocus(c);let n=e.composedPath()[0];if(n){let e=null==(i=null==(t=A(this._tabster,n))?void 0:t.restorer)?void 0:i.getProps().id;this._focusedElementState.requestAsyncFocus(c,()=>this._restoreFocus(n,e),0)}},this._onFocusIn=e=>{var t;if(!e)return;let i=A(this._tabster,e);(null==(t=null==i?void 0:i.restorer)?void 0:t.getProps().type)===E.Target&&this._history.push(e)},this._restoreFocus=(e,t)=>{var i;let n=this._getWindow().document;if(es.getActiveElement(n)!==n.body||!this._keyboardNavState.isNavigatingWithKeyboard()&&es.nodeContains(n.body,e))return;let r=e=>{var t,i;let n=null==(i=null==(t=A(this._tabster,e))?void 0:t.restorer)?void 0:i.getProps();return n?n.id:null};null==(i=this._history.pop(e=>t===r(e)))||i.focus()},this._tabster=e,this._getWindow=e.getWindow,this._getWindow().addEventListener(H,this._onRestoreFocus),this._history=new ip(this._getWindow),this._keyboardNavState=e.keyboardNavigation,this._focusedElementState=e.focusedElement,this._focusedElementState.subscribe(this._onFocusIn)}dispose(){let e=this._getWindow();this._focusedElementState.unsubscribe(this._onFocusIn),this._focusedElementState.cancelAsyncFocus(c),e.removeEventListener(H,this._onRestoreFocus)}createRestorer(e,t){let i=new ig(this._tabster,e,t);return t.type===E.Target&&es.getActiveElement(e.ownerDocument)===e&&this._history.push(e),i}}function iv(e,t){var i,n;if(!e||!t)return!1;let r=t;for(;r;){if(r===e)return!0;r="function"!=typeof r.assignedElements&&(null==(i=r.assignedSlot)?void 0:i.parentNode)?null==(n=r.assignedSlot)?void 0:n.parentNode:r.nodeType===document.DOCUMENT_FRAGMENT_NODE?r.host:r.parentNode}return!1}class iS{static _overrideAttachShadow(e){let t=e.Element.prototype.attachShadow;t.__origAttachShadow||(Element.prototype.attachShadow=function(e){let i=t.call(this,e);for(let e of iS._shadowObservers)e._addSubObserver(i);return i},Element.prototype.attachShadow.__origAttachShadow=t)}constructor(e){this._isObserving=!1,this._callbackWrapper=(e,t)=>{for(let t of e)if("childList"===t.type){let e=t.removedNodes,i=t.addedNodes;for(let t=0;t<e.length;t++)this._walkShadows(e[t],!0);for(let e=0;e<i.length;e++)this._walkShadows(i[e])}this._callback(e,t)},this._callback=e,this._observer=new MutationObserver(this._callbackWrapper),this._subObservers=new Map}_addSubObserver(e){if(!(!this._options||!this._callback||this._subObservers.has(e))&&this._options.subtree&&iv(this._root,e)){let t=new MutationObserver(this._callbackWrapper);this._subObservers.set(e,t),this._isObserving&&t.observe(e,this._options),this._walkShadows(e)}}disconnect(){for(let e of(this._isObserving=!1,delete this._options,iS._shadowObservers.delete(this),this._subObservers.values()))e.disconnect();this._subObservers.clear(),this._observer.disconnect()}observe(e,t){let i=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument,n=null==i?void 0:i.defaultView;i&&n&&(iS._overrideAttachShadow(n),iS._shadowObservers.add(this),this._root=e,this._options=t,this._isObserving=!0,this._observer.observe(e,t),this._walkShadows(e))}_walkShadows(e,t){let i=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument;if(i){if(e===i)e=i.body;else{let t=e.shadowRoot;if(t)return void this._addSubObserver(t)}i.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{if(e.nodeType===Node.ELEMENT_NODE)if(t){let t=this._subObservers.get(e);t&&(t.disconnect(),this._subObservers.delete(e))}else{let t=e.shadowRoot;t&&this._addSubObserver(t)}return NodeFilter.FILTER_SKIP}}).nextNode()}}takeRecords(){let e=this._observer.takeRecords();for(let t of this._subObservers.values())e.push(...t.takeRecords());return e}}iS._shadowObservers=new Set;class iy{constructor(e){this.keyboardNavigation=e.keyboardNavigation,this.focusedElement=e.focusedElement,this.focusable=e.focusable,this.root=e.root,this.uncontrolled=e.uncontrolled,this.core=e}}class iC{constructor(e,t){var i,n;this._forgetMemorizedElements=[],this._wrappers=new Set,this._initQueue=[],this._version="8.5.6",this._noop=!1,this.getWindow=()=>{if(!this._win)throw Error("Using disposed Tabster.");return this._win},this._storage=eh(e),this._win=e;let r=this.getWindow;(null==t?void 0:t.DOMAPI)&&ea({...t.DOMAPI}),this.keyboardNavigation=new tZ(r),this.focusedElement=new tJ(this,r),this.focusable=new tN(this),this.root=new e2(this,null==t?void 0:t.autoRoot),this.uncontrolled=new ih((null==t?void 0:t.checkUncontrolledCompletely)||(null==t?void 0:t.checkUncontrolledTrappingFocus)),this.controlTab=null==(i=null==t?void 0:t.controlTab)||i,this.rootDummyInputs=!!(null==t?void 0:t.rootDummyInputs),this._dummyObserver=new eH(r),this.getParent=null!=(n=null==t?void 0:t.getParent)?n:es.getParentNode,this.internal={stopObserver:()=>{this._unobserve&&(this._unobserve(),delete this._unobserve)},resumeObserver:e=>{if(!this._unobserve){let t=r().document;this._unobserve=ii(t,this,M,e)}}},ev(r),this.queueInit(()=>{this.internal.resumeObserver(!0)})}_mergeProps(e){var t;e&&(this.getParent=null!=(t=e.getParent)?t:this.getParent)}createTabster(e,t){let i=new iy(this);return e||this._wrappers.add(i),this._mergeProps(t),i}disposeTabster(e,t){t?this._wrappers.clear():this._wrappers.delete(e),0===this._wrappers.size&&this.dispose()}dispose(){var e,t,i,n,r,s,a,o;this.internal.stopObserver();let l=this._win;null==l||l.clearTimeout(this._initTimer),delete this._initTimer,this._initQueue=[],this._forgetMemorizedElements=[],l&&this._forgetMemorizedTimer&&(l.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),null==(e=this.outline)||e.dispose(),null==(t=this.crossOrigin)||t.dispose(),null==(i=this.deloser)||i.dispose(),null==(n=this.groupper)||n.dispose(),null==(r=this.mover)||r.dispose(),null==(s=this.modalizer)||s.dispose(),null==(a=this.observedElement)||a.dispose(),null==(o=this.restorer)||o.dispose(),this.keyboardNavigation.dispose(),this.focusable.dispose(),this.focusedElement.dispose(),this.root.dispose(),this._dummyObserver.dispose(),eS(this.getWindow),eA(this.getWindow),this._storage=new WeakMap,this._wrappers.clear(),l&&(eu(l),delete l.__tabsterInstance,delete this._win)}storageEntry(e,t){let i=this._storage,n=i.get(e);return n?!1===t&&0===Object.keys(n).length&&i.delete(e):!0===t&&(n={},i.set(e,n)),n}forceCleanup(){this._win&&(this._forgetMemorizedElements.push(this._win.document.body),this._forgetMemorizedTimer||(this._forgetMemorizedTimer=this._win.setTimeout(()=>{delete this._forgetMemorizedTimer;for(let e=this._forgetMemorizedElements.shift();e;e=this._forgetMemorizedElements.shift())eA(this.getWindow,e),tJ.forgetMemorized(this.focusedElement,e)},0),em(this.getWindow,!0)))}queueInit(e){var t;this._win&&(this._initQueue.push(e),this._initTimer||(this._initTimer=null==(t=this._win)?void 0:t.setTimeout(()=>{delete this._initTimer,this.drainInitQueue()},0)))}drainInitQueue(){if(!this._win)return;let e=this._initQueue;this._initQueue=[],e.forEach(e=>e())}}function ib(e,t){let i=iD(e);return i?i.createTabster(!1,t):(i=new iC(e,t),e.__tabsterInstance=i,i.createTabster())}function iT(e){let t=e.core;return t.groupper||(t.groupper=new tY(t,t.getWindow)),t.groupper}function iE(e){let t=e.core;return t.mover||(t.mover=new it(t,t.getWindow)),t.mover}function i_(e){let t=e.core;return t.outline||(t.outline=new ic(t)),t.outline}function iI(e,t){let i=e.core;return i.deloser||(i.deloser=new ti(i,t)),i.deloser}function iw(e,t,i){let n=e.core;return n.modalizer||(n.modalizer=new t3(n,t,i)),n.modalizer}function iP(e){let t=e.core;return t.observedElement||(t.observedElement=new is(t)),t.observedElement}function iR(e){let t=e.core;return t.crossOrigin||(iI(e),iw(e),iE(e),iT(e),i_(e),iP(e),t.crossOrigin=new tO(t)),t.crossOrigin}function iA(e){let t=e.core;return t.restorer||(t.restorer=new im(t)),t.restorer}function iM(e,t){e.core.disposeTabster(e,t)}function iD(e){return e.__tabsterInstance}function iO(e,t){let i=e.core;if(i._noop!==t){i._noop=t;let e=e=>(e.getAttribute&&(A(i,e)||e.hasAttribute(s))&&M(i,e),NodeFilter.FILTER_SKIP),n=i.getWindow().document,r=n.body;e(r);let a=ey(n,r,e);if(a)for(;a.nextNode(););}}},192163:function(e,t,i){"use strict";i.d(t,{Z:()=>s});var n=!0,r="Invariant failed";function s(e,t){if(!e){if(n)throw Error(r);var i="function"==typeof t?t():t,s=i?"".concat(r,": ").concat(i):r;throw Error(s)}}},231191:function(e,t,i){"use strict";i.r(t),i.d(t,{__addDisposableResource:()=>N,__assign:()=>s,__asyncDelegator:()=>I,__asyncGenerator:()=>_,__asyncValues:()=>w,__await:()=>E,__awaiter:()=>p,__classPrivateFieldGet:()=>D,__classPrivateFieldIn:()=>k,__classPrivateFieldSet:()=>O,__createBinding:()=>m,__decorate:()=>o,__disposeResources:()=>L,__esDecorate:()=>c,__exportStar:()=>v,__extends:()=>r,__generator:()=>f,__importDefault:()=>M,__importStar:()=>A,__makeTemplateObject:()=>P,__metadata:()=>g,__param:()=>l,__propKey:()=>u,__read:()=>y,__rest:()=>a,__runInitializers:()=>d,__setFunctionName:()=>h,__spread:()=>C,__spreadArray:()=>T,__spreadArrays:()=>b,__values:()=>S,default:()=>F});var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var s=function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function a(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]]);return i}function o(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a}function l(e,t){return function(i,n){t(i,n,e)}}function c(e,t,i,n,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,l=n.kind,c="getter"===l?"get":"setter"===l?"set":"value",d=!t&&e?n.static?e:e.prototype:null,u=t||(d?Object.getOwnPropertyDescriptor(d,n.name):{}),h=!1,g=i.length-1;g>=0;g--){var p={};for(var f in n)p[f]="access"===f?{}:n[f];for(var f in n.access)p.access[f]=n.access[f];p.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var m=(0,i[g])("accessor"===l?{get:u.get,set:u.set}:u[c],p);if("accessor"===l){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw TypeError("Object expected");(o=a(m.get))&&(u.get=o),(o=a(m.set))&&(u.set=o),(o=a(m.init))&&r.unshift(o)}else(o=a(m))&&("field"===l?r.unshift(o):u[c]=o)}d&&Object.defineProperty(d,n.name,u),h=!0}function d(e,t,i){for(var n=arguments.length>2,r=0;r<t.length;r++)i=n?t[r].call(e,i):t[r].call(e);return n?i:void 0}function u(e){return"symbol"==typeof e?e:"".concat(e)}function h(e,t,i){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}function g(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function p(e,t,i,n){function r(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):r(e.value).then(a,o)}l((n=n.apply(e,t||[])).next())})}function f(e,t){var i,n,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(e){return function(t){return l([e,t])}}function l(o){if(i)throw TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}var m=Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]};function v(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||m(t,e,i)}function S(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,s=i.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return a}function C(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function b(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var s=arguments[t],a=0,o=s.length;a<o;a++,r++)n[r]=s[a];return n}function T(e,t,i){if(i||2==arguments.length)for(var n,r=0,s=t.length;r<s;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}function E(e){return this instanceof E?(this.v=e,this):new E(e)}function _(e,t,i){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(e,t||[]),s=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",a),n[Symbol.asyncIterator]=function(){return this},n;function a(e){return function(t){return Promise.resolve(t).then(e,u)}}function o(e,t){r[e]&&(n[e]=function(t){return new Promise(function(i,n){s.push([e,t,i,n])>1||l(e,t)})},t&&(n[e]=t(n[e])))}function l(e,t){try{c(r[e](t))}catch(e){h(s[0][3],e)}}function c(e){e.value instanceof E?Promise.resolve(e.value.v).then(d,u):h(s[0][2],e)}function d(e){l("next",e)}function u(e){l("throw",e)}function h(e,t){e(t),s.shift(),s.length&&l(s[0][0],s[0][1])}}function I(e){var t,i;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,r){t[n]=e[n]?function(t){return(i=!i)?{value:E(e[n](t)),done:!1}:r?r(t):t}:r}}function w(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=S(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=e[i]&&function(t){return new Promise(function(n,s){r(n,s,(t=e[i](t)).done,t.value)})}}function r(e,t,i,n){Promise.resolve(n).then(function(t){e({value:t,done:i})},t)}}function P(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var R=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&m(t,e,i);return R(t,e),t}function M(e){return e&&e.__esModule?e:{default:e}}function D(e,t,i,n){if("a"===i&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function O(e,t,i,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}function k(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function N(e,t,i){if(null!=t){var n,r;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(i){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],i&&(r=n)}if("function"!=typeof n)throw TypeError("Object not disposable.");r&&(n=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:n,async:i})}else i&&e.stack.push({async:!0});return t}var x="function"==typeof SuppressedError?SuppressedError:function(e,t,i){var n=Error(i);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function L(e){function t(t){e.error=e.hasError?new x(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var i,n=0;function r(){for(;i=e.stack.pop();)try{if(!i.async&&1===n)return n=0,e.stack.push(i),Promise.resolve().then(r);if(i.dispose){var s=i.dispose.call(i.value);if(i.async)return n|=2,Promise.resolve(s).then(r,function(e){return t(e),r()})}else n|=1}catch(e){t(e)}if(1===n)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return r()}let F={__extends:r,__assign:s,__rest:a,__decorate:o,__param:l,__metadata:g,__awaiter:p,__generator:f,__createBinding:m,__exportStar:v,__values:S,__read:y,__spread:C,__spreadArrays:b,__spreadArray:T,__await:E,__asyncGenerator:_,__asyncDelegator:I,__asyncValues:w,__makeTemplateObject:P,__importStar:A,__importDefault:M,__classPrivateFieldGet:D,__classPrivateFieldSet:O,__classPrivateFieldIn:k,__addDisposableResource:N,__disposeResources:L}},608375:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(912168),r=i(304379);t.default=function(){function e(e){this.data=[],this.compare=e||n.defaultCompare}return e.prototype.leftChildIndex=function(e){return 2*e+1},e.prototype.rightChildIndex=function(e){return 2*e+2},e.prototype.parentIndex=function(e){return Math.floor((e-1)/2)},e.prototype.minIndex=function(e,t){if(t>=this.data.length)if(e>=this.data.length)return -1;else return e;return 0>=this.compare(this.data[e],this.data[t])?e:t},e.prototype.siftUp=function(e){for(var t=this.parentIndex(e);e>0&&this.compare(this.data[t],this.data[e])>0;)r.swap(this.data,t,e),e=t,t=this.parentIndex(e)},e.prototype.siftDown=function(e){for(var t=this.minIndex(this.leftChildIndex(e),this.rightChildIndex(e));t>=0&&this.compare(this.data[e],this.data[t])>0;)r.swap(this.data,t,e),e=t,t=this.minIndex(this.leftChildIndex(e),this.rightChildIndex(e))},e.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},e.prototype.add=function(e){return!n.isUndefined(e)&&(this.data.push(e),this.siftUp(this.data.length-1),!0)},e.prototype.removeRoot=function(){if(this.data.length>0){var e=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),e}},e.prototype.contains=function(e){var t=n.compareToEquals(this.compare);return r.contains(this.data,e,t)},e.prototype.size=function(){return this.data.length},e.prototype.isEmpty=function(){return this.data.length<=0},e.prototype.clear=function(){this.data.length=0},e.prototype.forEach=function(e){r.forEach(this.data,e)},e}()},744448:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(912168),r=i(608375);t.default=function(){function e(e){this.heap=new r.default(n.reverseCompareFunction(e))}return e.prototype.enqueue=function(e){return this.heap.add(e)},e.prototype.add=function(e){return this.heap.add(e)},e.prototype.dequeue=function(){if(0!==this.heap.size()){var e=this.heap.peek();return this.heap.removeRoot(),e}},e.prototype.peek=function(){return this.heap.peek()},e.prototype.contains=function(e){return this.heap.contains(e)},e.prototype.isEmpty=function(){return this.heap.isEmpty()},e.prototype.size=function(){return this.heap.size()},e.prototype.clear=function(){this.heap.clear()},e.prototype.forEach=function(e){this.heap.forEach(e)},e}()},304379:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(912168);function r(e,t,i){for(var r=i||n.defaultEquals,s=e.length,a=0;a<s;a++)if(r(e[a],t))return a;return -1}t.indexOf=r,t.lastIndexOf=function(e,t,i){for(var r=i||n.defaultEquals,s=e.length,a=s-1;a>=0;a--)if(r(e[a],t))return a;return -1},t.contains=function(e,t,i){return r(e,t,i)>=0},t.remove=function(e,t,i){var n=r(e,t,i);return!(n<0)&&(e.splice(n,1),!0)},t.frequency=function(e,t,i){for(var r=i||n.defaultEquals,s=e.length,a=0,o=0;o<s;o++)r(e[o],t)&&a++;return a},t.equals=function(e,t,i){var r=i||n.defaultEquals;if(e.length!==t.length)return!1;for(var s=e.length,a=0;a<s;a++)if(!r(e[a],t[a]))return!1;return!0},t.copy=function(e){return e.concat()},t.swap=function(e,t,i){if(t<0||t>=e.length||i<0||i>=e.length)return!1;var n=e[t];return e[t]=e[i],e[i]=n,!0},t.toString=function(e){return"["+e.toString()+"]"},t.forEach=function(e,t){for(var i=0,n=e;i<n.length;i++)if(!1===t(n[i]))return}},912168:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.prototype.hasOwnProperty;function n(e,i){if(void 0===i&&(i=","),null===e)return"COLLECTION_NULL";if(s(e))return"COLLECTION_UNDEFINED";if(a(e))return e.toString();var n="{",r=!0;for(var o in e)t.has(e,o)&&(r?r=!1:n+=i,n=n+o+":"+e[o]);return n+"}"}function r(e){return"function"==typeof e}function s(e){return void 0===e}function a(e){return"[object String]"===Object.prototype.toString.call(e)}t.has=function(e,t){return i.call(e,t)},t.defaultCompare=function(e,t){return e<t?-1:+(e!==t)},t.defaultEquals=function(e,t){return e===t},t.defaultToString=function(e){return null===e?"COLLECTION_NULL":s(e)?"COLLECTION_UNDEFINED":a(e)?"$s"+e:"$o"+e.toString()},t.makeString=n,t.isFunction=r,t.isUndefined=s,t.isString=a,t.reverseCompareFunction=function(e){return s(e)||!r(e)?function(e,t){return e<t?1:e===t?0:-1}:function(t,i){return -1*e(t,i)}},t.compareToEquals=function(e){return function(t,i){return 0===e(t,i)}}},336196:function(e,t,i){"use strict";i.d(t,{M:()=>d});var n=i(632735),r=()=>n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner.current,s=()=>!1,a=new WeakSet;function o(e,t){let i=r();n.useEffect(()=>{if(!a.has(i)){a.add(i),e();return}return e()},t)}var l=new WeakSet;function c(e,t){return n.useMemo(()=>{let t=r();return l.has(t)?e():(l.add(t),null)},t)}function d(e,t){var i;let r=s()&&!1,a=r?c:n.useMemo,l=r?o:n.useEffect,[d,u]=null!=(i=a(()=>e(),t))?i:[null,()=>null];return l(()=>u,t),d}},394753:function(e,t,i){"use strict";var n=i(632735);function r(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var s="function"==typeof Object.is?Object.is:r,a=n.useState,o=n.useEffect,l=n.useLayoutEffect,c=n.useDebugValue;function d(e,t){var i=t(),n=a({inst:{value:i,getSnapshot:t}}),r=n[0].inst,s=n[1];return l(function(){r.value=i,r.getSnapshot=t,u(r)&&s({inst:r})},[e,i,t]),o(function(){return u(r)&&s({inst:r}),e(function(){u(r)&&s({inst:r})})},[e]),c(i),i}function u(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!s(e,i)}catch(e){return!0}}function h(e,t){return t()}var g="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?h:d;t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:g},385292:function(e,t,i){"use strict";var n=i(632735),r=i(221374);function s(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var a="function"==typeof Object.is?Object.is:s,o=r.useSyncExternalStore,l=n.useRef,c=n.useEffect,d=n.useMemo,u=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,i,n,r){var s=l(null);if(null===s.current){var h={hasValue:!1,value:null};s.current=h}else h=s.current;var g=o(e,(s=d(function(){function e(e){if(!l){if(l=!0,s=e,e=n(e),void 0!==r&&h.hasValue){var t=h.value;if(r(t,e))return o=t}return o=e}if(t=o,a(s,e))return t;var i=n(e);return void 0!==r&&r(t,i)?(s=e,t):(s=e,o=i)}var s,o,l=!1,c=void 0===i?null:i;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,i,n,r]))[0],s[1]);return c(function(){h.hasValue=!0,h.value=g},[g]),u(g),g}},221374:function(e,t,i){"use strict";e.exports=i(394753)},355668:function(e,t,i){"use strict";e.exports=i(385292)},521432:function(e){e.exports={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}},690395:function(e){"use strict";e.exports=function(){}},79390:function(e,t,i){"use strict";i.r(t),i.d(t,{DOMException:()=>w,Headers:()=>u,Request:()=>b,Response:()=>_,fetch:()=>P});var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==i.g&&i.g||{},r={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};function s(e){return e&&DataView.prototype.isPrototypeOf(e)}if(r.arrayBuffer)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r.iterable&&(t[Symbol.iterator]=function(){return t}),t}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function h(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(TypeError("Already read"));e.bodyUsed=!0}}function g(e){return new Promise(function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}})}function p(e){var t=new FileReader,i=g(t);return t.readAsArrayBuffer(e),i}function f(e){var t=new FileReader,i=g(t),n=/charset=([A-Za-z0-9_-]+)/.exec(e.type),r=n?n[1]:"utf-8";return t.readAsText(e,r),i}function m(e){for(var t=new Uint8Array(e),i=Array(t.length),n=0;n<t.length;n++)i[n]=String.fromCharCode(t[n]);return i.join("")}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function S(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:r.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():r.arrayBuffer&&r.blob&&s(e)?(this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||o(e))?this._bodyArrayBuffer=v(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),!this.headers.get("content-type")&&("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(!this._bodyFormData)return Promise.resolve(new Blob([this._bodyText]));throw Error("could not read FormData body as blob")}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=h(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(r.blob)return this.blob().then(p);throw Error("could not read as ArrayBuffer")},this.text=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return f(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(m(this._bodyArrayBuffer));if(!this._bodyFormData)return Promise.resolve(this._bodyText);throw Error("could not read FormData body as text")},r.formData&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}u.prototype.append=function(e,t){e=l(e),t=c(t);var i=this.map[e];this.map[e]=i?i+", "+t:t},u.prototype.delete=function(e){delete this.map[l(e)]},u.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},u.prototype.set=function(e,t){this.map[l(e)]=c(t)},u.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,i){e.push(i)}),d(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),d(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,i){e.push([i,t])}),d(e)},r.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var y=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function C(e){var t=e.toUpperCase();return y.indexOf(t)>-1?t:e}function b(e,t){if(!(this instanceof b))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var i=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new u(t.headers)),this.method=C(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in n)return new AbortController().signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),("GET"===this.method||"HEAD"===this.method)&&("no-store"===t.cache||"no-cache"===t.cache)){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}function T(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var i=e.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(r))}}),t}function E(e){var t=new u;return e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var i=e.split(":"),n=i.shift().trim();if(n){var r=i.join(":").trim();try{t.append(n,r)}catch(e){console.warn("Response "+e.message)}}}),t}function _(e,t){if(!(this instanceof _))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},S.call(b.prototype),S.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},_.error=function(){var e=new _(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var I=[301,302,303,307,308];_.redirect=function(e,t){if(-1===I.indexOf(t))throw RangeError("Invalid status code");return new _(null,{status:t,headers:{location:e}})};var w=n.DOMException;try{new w}catch(e){(w=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack}).prototype=Object.create(Error.prototype),w.prototype.constructor=w}function P(e,t){return new Promise(function(i,s){var a=new b(e,t);if(a.signal&&a.signal.aborted)return s(new w("Aborted","AbortError"));var o=new XMLHttpRequest;function d(){o.abort()}function h(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}if(o.onload=function(){var e={statusText:o.statusText,headers:E(o.getAllResponseHeaders()||"")};0===a.url.indexOf("file://")&&(o.status<200||o.status>599)?e.status=200:e.status=o.status,e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;setTimeout(function(){i(new _(t,e))},0)},o.onerror=function(){setTimeout(function(){s(TypeError("Network request failed"))},0)},o.ontimeout=function(){setTimeout(function(){s(TypeError("Network request timed out"))},0)},o.onabort=function(){setTimeout(function(){s(new w("Aborted","AbortError"))},0)},o.open(a.method,h(a.url),!0),"include"===a.credentials?o.withCredentials=!0:"omit"===a.credentials&&(o.withCredentials=!1),"responseType"in o&&(r.blob?o.responseType="blob":r.arrayBuffer&&(o.responseType="arraybuffer")),t&&"object"==typeof t.headers&&!(t.headers instanceof u||n.Headers&&t.headers instanceof n.Headers)){var g=[];Object.getOwnPropertyNames(t.headers).forEach(function(e){g.push(l(e)),o.setRequestHeader(e,c(t.headers[e]))}),a.headers.forEach(function(e,t){-1===g.indexOf(t)&&o.setRequestHeader(t,e)})}else a.headers.forEach(function(e,t){o.setRequestHeader(t,e)});a.signal&&(a.signal.addEventListener("abort",d),o.onreadystatechange=function(){4===o.readyState&&a.signal.removeEventListener("abort",d)}),o.send(void 0===a._bodyInit?null:a._bodyInit)})}P.polyfill=!0,n.fetch||(n.fetch=P,n.Headers=u,n.Request=b,n.Response=_)},695185:function(e,t,i){let n=i(153354).Observable;e.exports=n,e.exports.default=n,Object.defineProperty(e.exports,"__esModule",{value:!0})},248787:function(e,t,i){"use strict";i.d(t,{oR:()=>c});var n=i(632735),r=i(355668);let{useDebugValue:s}=n,{useSyncExternalStoreWithSelector:a}=r,o=!1,l=e=>e;function c(e,t=l,i){i&&!o&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),o=!0);let n=a(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,i);return s(n),n}},619992:function(e,t,i){"use strict";i.d(t,{M:()=>r});let n=e=>{let t,i=new Set,n=(e,n)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=n?n:"object"!=typeof r||null===r)?r:Object.assign({},t,r),i.forEach(i=>i(t,e))}},r=()=>t,s={setState:n,getState:r,getInitialState:()=>a,subscribe:e=>(i.add(e),()=>i.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},a=t=e(n,r,s);return s},r=e=>e?n(e):n},900657:function(e){"use strict";e.exports="https://statics.teams.cdn.office.net/teams-modular-packages/hashed-assets/stream-transform-decoder.worklet-9311a9ed1a1e20ad.js"},814948:function(e){"use strict";e.exports="https://statics.teams.cdn.office.net/teams-modular-packages/hashed-assets/stream-transform-renderer.worklet-7843f6791f35afe2.js"},362740:function(e){"use strict";e.exports="https://statics.teams.cdn.office.net/teams-modular-packages/hashed-assets/stream-transform-timer.worklet-81a52591a452b835.js"},614845:function(e){"use strict";e.exports="https://statics.teams.cdn.office.net/teams-modular-packages/hashed-assets/wasmvqe.worklet-04090c65078c9660.js"},621386:function(e,t,i){"use strict";i.d(t,{Z:()=>u});var n,r=new Uint8Array(16);function s(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}let a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,o=function(e){return"string"==typeof e&&a.test(e)};for(var l=[],c=0;c<256;++c)l.push((c+256).toString(16).substr(1));let d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!o(i))throw TypeError("Stringified UUID is invalid");return i},u=function(e,t,i){var n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return d(n)}},416001:function(e,t,i){"use strict";i.d(t,{Z:()=>u});var n,r=new Uint8Array(16);function s(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}let a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,o=function(e){return"string"==typeof e&&a.test(e)};for(var l=[],c=0;c<256;++c)l.push((c+256).toString(16).substr(1));let d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!o(i))throw TypeError("Stringified UUID is invalid");return i},u=function(e,t,i){var n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return d(n)}},547387:function(e,t,i){"use strict";i.d(t,{Z:()=>u});var n,r=new Uint8Array(16);function s(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}let a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,o=function(e){return"string"==typeof e&&a.test(e)};for(var l=[],c=0;c<256;++c)l.push((c+256).toString(16).substr(1));let d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!o(i))throw TypeError("Stringified UUID is invalid");return i},u=function(e,t,i){var n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return d(n)}},106230:function(e,t,i){"use strict";let n,r,s;function a(e,t){return function(){return e.apply(t,arguments)}}let{toString:o}=Object.prototype,{getPrototypeOf:l}=Object,c=(n=Object.create(null),e=>{let t=o.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())}),d=e=>(e=e.toLowerCase(),t=>c(t)===e),u=e=>t=>typeof t===e,{isArray:h}=Array,g=u("undefined");function p(e){return null!==e&&!g(e)&&null!==e.constructor&&!g(e.constructor)&&S(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let f=d("ArrayBuffer");function m(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&f(e.buffer)}let v=u("string"),S=u("function"),y=u("number"),C=e=>null!==e&&"object"==typeof e,b=e=>!0===e||!1===e,T=e=>{if("object"!==c(e))return!1;let t=l(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},E=d("Date"),_=d("File"),I=d("Blob"),w=d("FileList"),P=e=>C(e)&&S(e.pipe),R=e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||S(e.append)&&("formdata"===(t=c(e))||"object"===t&&S(e.toString)&&"[object FormData]"===e.toString()))},A=d("URLSearchParams"),[M,D,O,k]=["ReadableStream","Request","Response","Headers"].map(d),N=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function x(e,t,{allOwnKeys:i=!1}={}){let n,r;if(null!=e)if("object"!=typeof e&&(e=[e]),h(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{let r,s=i?Object.getOwnPropertyNames(e):Object.keys(e),a=s.length;for(n=0;n<a;n++)r=s[n],t.call(null,e[r],r,e)}}function L(e,t){let i;t=t.toLowerCase();let n=Object.keys(e),r=n.length;for(;r-- >0;)if(t===(i=n[r]).toLowerCase())return i;return null}let F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:i.g,U=e=>!g(e)&&e!==F;function $(){let{caseless:e}=U(this)&&this||{},t={},i=(i,n)=>{let r=e&&L(t,n)||n;T(t[r])&&T(i)?t[r]=$(t[r],i):T(i)?t[r]=$({},i):h(i)?t[r]=i.slice():t[r]=i};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&x(arguments[e],i);return t}let V=(e,t,i,{allOwnKeys:n}={})=>(x(t,(t,n)=>{i&&S(t)?e[n]=a(t,i):e[n]=t},{allOwnKeys:n}),e),B=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),H=(e,t,i,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},j=(e,t,i,n)=>{let r,s,a,o={};if(t=t||{},null==e)return t;do{for(s=(r=Object.getOwnPropertyNames(e)).length;s-- >0;)a=r[s],(!n||n(a,e,t))&&!o[a]&&(t[a]=e[a],o[a]=!0);e=!1!==i&&l(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},q=(e,t,i)=>{e=String(e),(void 0===i||i>e.length)&&(i=e.length),i-=t.length;let n=e.indexOf(t,i);return -1!==n&&n===i},W=e=>{if(!e)return null;if(h(e))return e;let t=e.length;if(!y(t))return null;let i=Array(t);for(;t-- >0;)i[t]=e[t];return i},G=(r="undefined"!=typeof Uint8Array&&l(Uint8Array),e=>r&&e instanceof r),z=(e,t)=>{let i,n=(e&&e[Symbol.iterator]).call(e);for(;(i=n.next())&&!i.done;){let n=i.value;t.call(e,n[0],n[1])}},J=(e,t)=>{let i,n=[];for(;null!==(i=e.exec(t));)n.push(i);return n},K=d("HTMLFormElement"),Q=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,i){return t.toUpperCase()+i}),Y=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),Z=d("RegExp"),X=(e,t)=>{let i=Object.getOwnPropertyDescriptors(e),n={};x(i,(i,r)=>{let s;!1!==(s=t(i,r,e))&&(n[r]=s||i)}),Object.defineProperties(e,n)},ee=e=>{X(e,(t,i)=>{if(S(e)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;if(S(e[i])){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},et=(e,t)=>{let i={};return(e=>{e.forEach(e=>{i[e]=!0})})(h(e)?e:String(e).split(t)),i},ei=()=>{},en=(e,t)=>null!=e&&Number.isFinite(e*=1)?e:t,er="abcdefghijklmnopqrstuvwxyz",es="0123456789",ea={DIGIT:es,ALPHA:er,ALPHA_DIGIT:er+er.toUpperCase()+es},eo=(e=16,t=ea.ALPHA_DIGIT)=>{let i="",{length:n}=t;for(;e--;)i+=t[Math.random()*n|0];return i};function el(e){return!!(e&&S(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])}let ec=e=>{let t=Array(10),i=(e,n)=>{if(C(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;let r=h(e)?[]:{};return x(e,(e,t)=>{let s=i(e,n+1);g(s)||(r[t]=s)}),t[n]=void 0,r}}return e};return i(e,0)},ed=d("AsyncFunction"),eu=e=>e&&(C(e)||S(e))&&S(e.then)&&S(e.catch),eh=((e,t)=>{let i,n;return e?setImmediate:t?(i=`axios@${Math.random()}`,n=[],F.addEventListener("message",({source:e,data:t})=>{e===F&&t===i&&n.length&&n.shift()()},!1),e=>{n.push(e),F.postMessage(i,"*")}):e=>setTimeout(e)})("function"==typeof setImmediate,S(F.postMessage)),eg="undefined"!=typeof queueMicrotask?queueMicrotask.bind(F):eh;var ep={isArray:h,isArrayBuffer:f,isBuffer:p,isFormData:R,isArrayBufferView:m,isString:v,isNumber:y,isBoolean:b,isObject:C,isPlainObject:T,isReadableStream:M,isRequest:D,isResponse:O,isHeaders:k,isUndefined:g,isDate:E,isFile:_,isBlob:I,isRegExp:Z,isFunction:S,isStream:P,isURLSearchParams:A,isTypedArray:G,isFileList:w,forEach:x,merge:$,extend:V,trim:N,stripBOM:B,inherits:H,toFlatObject:j,kindOf:c,kindOfTest:d,endsWith:q,toArray:W,forEachEntry:z,matchAll:J,isHTMLForm:K,hasOwnProperty:Y,hasOwnProp:Y,reduceDescriptors:X,freezeMethods:ee,toObjectSet:et,toCamelCase:Q,noop:ei,toFiniteNumber:en,findKey:L,global:F,isContextDefined:U,ALPHABET:ea,generateString:eo,isSpecCompliantForm:el,toJSONObject:ec,isAsyncFn:ed,isThenable:eu,setImmediate:eh,asap:eg};function ef(e,t,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}ep.inherits(ef,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ep.toJSONObject(this.config),code:this.code,status:this.status}}});let em=ef.prototype,ev={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{ev[e]={value:e}}),Object.defineProperties(ef,ev),Object.defineProperty(em,"isAxiosError",{value:!0}),ef.from=(e,t,i,n,r,s)=>{let a=Object.create(em);return ep.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),ef.call(a,e.message,t,i,n,r),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};var eS=null;function ey(e){return ep.isPlainObject(e)||ep.isArray(e)}function eC(e){return ep.endsWith(e,"[]")?e.slice(0,-2):e}function eb(e,t,i){return e?e.concat(t).map(function(e,t){return e=eC(e),!i&&t?"["+e+"]":e}).join(i?".":""):t}function eT(e){return ep.isArray(e)&&!e.some(ey)}let eE=ep.toFlatObject(ep,{},null,function(e){return/^is[A-Z]/.test(e)});function e_(e,t,i){if(!ep.isObject(e))throw TypeError("target must be an object");t=t||new FormData;let n=(i=ep.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!ep.isUndefined(t[e])})).metaTokens,r=i.visitor||c,s=i.dots,a=i.indexes,o=(i.Blob||"undefined"!=typeof Blob&&Blob)&&ep.isSpecCompliantForm(t);if(!ep.isFunction(r))throw TypeError("visitor must be a function");function l(e){if(null===e)return"";if(ep.isDate(e))return e.toISOString();if(!o&&ep.isBlob(e))throw new ef("Blob is not supported. Use a Buffer instead.");return ep.isArrayBuffer(e)||ep.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,i,r){let o=e;if(e&&!r&&"object"==typeof e){if(ep.endsWith(i,"{}"))i=n?i:i.slice(0,-2),e=JSON.stringify(e);else if(ep.isArray(e)&&eT(e)||(ep.isFileList(e)||ep.endsWith(i,"[]"))&&(o=ep.toArray(e)))return i=eC(i),o.forEach(function(e,n){ep.isUndefined(e)||null===e||t.append(!0===a?eb([i],n,s):null===a?i:i+"[]",l(e))}),!1}return!!ey(e)||(t.append(eb(r,i,s),l(e)),!1)}let d=[],u=Object.assign(eE,{defaultVisitor:c,convertValue:l,isVisitable:ey});function h(e,i){if(!ep.isUndefined(e)){if(-1!==d.indexOf(e))throw Error("Circular reference detected in "+i.join("."));d.push(e),ep.forEach(e,function(e,n){!0===(!(ep.isUndefined(e)||null===e)&&r.call(t,e,ep.isString(n)?n.trim():n,i,u))&&h(e,i?i.concat(n):[n])}),d.pop()}}if(!ep.isObject(e))throw TypeError("data must be an object");return h(e),t}function eI(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function ew(e,t){this._pairs=[],e&&e_(e,this,t)}let eP=ew.prototype;function eR(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eA(e,t,i){let n;if(!t)return e;let r=i&&i.encode||eR,s=i&&i.serialize;if(n=s?s(t,i):ep.isURLSearchParams(t)?t.toString():new ew(t,i).toString(r)){let t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}eP.append=function(e,t){this._pairs.push([e,t])},eP.toString=function(e){let t=e?function(t){return e.call(this,t,eI)}:eI;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class eM{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ep.forEach(this.handlers,function(t){null!==t&&e(t)})}}var eD=eM,eO={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ek={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:ew,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};let eN="undefined"!=typeof window&&"undefined"!=typeof document,ex="object"==typeof navigator&&navigator||void 0,eL=eN&&(!ex||0>["ReactNative","NativeScript","NS"].indexOf(ex.product)),eF="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,eU=eN&&window.location.href||"http://localhost";var e$={...Object.freeze({__proto__:null,hasBrowserEnv:eN,hasStandardBrowserWebWorkerEnv:eF,hasStandardBrowserEnv:eL,navigator:ex,origin:eU}),...ek};function eV(e,t){return e_(e,new e$.classes.URLSearchParams,Object.assign({visitor:function(e,t,i,n){return e$.isNode&&ep.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function eB(e){return ep.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}function eH(e){let t,i,n={},r=Object.keys(e),s=r.length;for(t=0;t<s;t++)n[i=r[t]]=e[i];return n}function ej(e){function t(e,i,n,r){let s=e[r++];if("__proto__"===s)return!0;let a=Number.isFinite(+s),o=r>=e.length;return(s=!s&&ep.isArray(n)?n.length:s,o)?ep.hasOwnProp(n,s)?n[s]=[n[s],i]:n[s]=i:(n[s]&&ep.isObject(n[s])||(n[s]=[]),t(e,i,n[s],r)&&ep.isArray(n[s])&&(n[s]=eH(n[s]))),!a}if(ep.isFormData(e)&&ep.isFunction(e.entries)){let i={};return ep.forEachEntry(e,(e,n)=>{t(eB(e),n,i,0)}),i}return null}function eq(e,t,i){if(ep.isString(e))try{return(t||JSON.parse)(e),ep.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(i||JSON.stringify)(e)}let eW={transitional:eO,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let i,n=t.getContentType()||"",r=n.indexOf("application/json")>-1,s=ep.isObject(e);if(s&&ep.isHTMLForm(e)&&(e=new FormData(e)),ep.isFormData(e))return r?JSON.stringify(ej(e)):e;if(ep.isArrayBuffer(e)||ep.isBuffer(e)||ep.isStream(e)||ep.isFile(e)||ep.isBlob(e)||ep.isReadableStream(e))return e;if(ep.isArrayBufferView(e))return e.buffer;if(ep.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return eV(e,this.formSerializer).toString();if((i=ep.isFileList(e))||n.indexOf("multipart/form-data")>-1){let t=this.env&&this.env.FormData;return e_(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),eq(e)):e}],transformResponse:[function(e){let t=this.transitional||eW.transitional,i=t&&t.forcedJSONParsing,n="json"===this.responseType;if(ep.isResponse(e)||ep.isReadableStream(e))return e;if(e&&ep.isString(e)&&(i&&!this.responseType||n)){let i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw ef.from(e,ef.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:e$.classes.FormData,Blob:e$.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ep.forEach(["delete","get","head","post","put","patch"],e=>{eW.headers[e]={}});var eG=eW;let ez=ep.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var eJ=e=>{let t,i,n,r={};return e&&e.split("\n").forEach(function(e){n=e.indexOf(":"),t=e.substring(0,n).trim().toLowerCase(),i=e.substring(n+1).trim(),!t||r[t]&&ez[t]||("set-cookie"===t?r[t]?r[t].push(i):r[t]=[i]:r[t]=r[t]?r[t]+", "+i:i)}),r};let eK=Symbol("internals");function eQ(e){return e&&String(e).trim().toLowerCase()}function eY(e){return!1===e||null==e?e:ep.isArray(e)?e.map(eY):String(e)}function eZ(e){let t,i=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;t=n.exec(e);)i[t[1]]=t[2];return i}let eX=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function e0(e,t,i,n,r){if(ep.isFunction(n))return n.call(this,t,i);if(r&&(t=i),ep.isString(t)){if(ep.isString(n))return -1!==t.indexOf(n);if(ep.isRegExp(n))return n.test(t)}}function e1(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function e2(e,t){let i=ep.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+i,{value:function(e,i,r){return this[n].call(this,t,e,i,r)},configurable:!0})})}class e3{constructor(e){e&&this.set(e)}set(e,t,i){let n=this;function r(e,t,i){let r=eQ(t);if(!r)throw Error("header name must be a non-empty string");let s=ep.findKey(n,r);s&&void 0!==n[s]&&!0!==i&&(void 0!==i||!1===n[s])||(n[s||t]=eY(e))}let s=(e,t)=>ep.forEach(e,(e,i)=>r(e,i,t));if(ep.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(ep.isString(e)&&(e=e.trim())&&!eX(e))s(eJ(e),t);else if(ep.isHeaders(e))for(let[t,n]of e.entries())r(n,t,i);else null!=e&&r(t,e,i);return this}get(e,t){if(e=eQ(e)){let i=ep.findKey(this,e);if(i){let e=this[i];if(!t)return e;if(!0===t)return eZ(e);if(ep.isFunction(t))return t.call(this,e,i);if(ep.isRegExp(t))return t.exec(e);throw TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=eQ(e)){let i=ep.findKey(this,e);return!!(i&&void 0!==this[i]&&(!t||e0(this,this[i],i,t)))}return!1}delete(e,t){let i=this,n=!1;function r(e){if(e=eQ(e)){let r=ep.findKey(i,e);r&&(!t||e0(i,i[r],r,t))&&(delete i[r],n=!0)}}return ep.isArray(e)?e.forEach(r):r(e),n}clear(e){let t=Object.keys(this),i=t.length,n=!1;for(;i--;){let r=t[i];(!e||e0(this,this[r],r,e,!0))&&(delete this[r],n=!0)}return n}normalize(e){let t=this,i={};return ep.forEach(this,(n,r)=>{let s=ep.findKey(i,r);if(s){t[s]=eY(n),delete t[r];return}let a=e?e1(r):String(r).trim();a!==r&&delete t[r],t[a]=eY(n),i[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return ep.forEach(this,(i,n)=>{null!=i&&!1!==i&&(t[n]=e&&ep.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let i=new this(e);return t.forEach(e=>i.set(e)),i}static accessor(e){let t=(this[eK]=this[eK]={accessors:{}}).accessors,i=this.prototype;function n(e){let n=eQ(e);t[n]||(e2(i,e),t[n]=!0)}return ep.isArray(e)?e.forEach(n):n(e),this}}e3.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ep.reduceDescriptors(e3.prototype,({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[i]=e}}}),ep.freezeMethods(e3);var e4=e3;function e5(e,t){let i=this||eG,n=t||i,r=e4.from(n.headers),s=n.data;return ep.forEach(e,function(e){s=e.call(i,s,r.normalize(),t?t.status:void 0)}),r.normalize(),s}function e6(e){return!!(e&&e.__CANCEL__)}function e8(e,t,i){ef.call(this,null==e?"canceled":e,ef.ERR_CANCELED,t,i),this.name="CanceledError"}function e9(e,t,i){let n=i.config.validateStatus;!i.status||!n||n(i.status)?e(i):t(new ef("Request failed with status code "+i.status,[ef.ERR_BAD_REQUEST,ef.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function e7(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function te(e,t){let i,n=Array(e=e||10),r=Array(e),s=0,a=0;return t=void 0!==t?t:1e3,function(o){let l=Date.now(),c=r[a];i||(i=l),n[s]=o,r[s]=l;let d=a,u=0;for(;d!==s;)u+=n[d++],d%=e;if((s=(s+1)%e)===a&&(a=(a+1)%e),l-i<t)return;let h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}function tt(e,t){let i,n,r=0,s=1e3/t,a=(t,s=Date.now())=>{r=s,i=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{let t=Date.now(),o=t-r;o>=s?a(e,t):(i=e,n||(n=setTimeout(()=>{n=null,a(i)},s-o)))},()=>i&&a(i)]}ep.inherits(e8,ef,{__CANCEL__:!0});let ti=(e,t,i=3)=>{let n=0,r=te(50,250);return tt(i=>{let s=i.loaded,a=i.lengthComputable?i.total:void 0,o=s-n,l=r(o),c=s<=a;n=s,e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&c?(a-s)/l:void 0,event:i,lengthComputable:null!=a,[t?"download":"upload"]:!0})},i)},tn=(e,t)=>{let i=null!=e;return[n=>t[0]({lengthComputable:i,total:e,loaded:n}),t[1]]},tr=e=>(...t)=>ep.asap(()=>e(...t));var ts=e$.hasStandardBrowserEnv?function(){let e,t=e$.navigator&&/(msie|trident)/i.test(e$.navigator.userAgent),i=document.createElement("a");function n(e){let n=e;return t&&(i.setAttribute("href",n),n=i.href),i.setAttribute("href",n),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return e=n(window.location.href),function(t){let i=ep.isString(t)?n(t):t;return i.protocol===e.protocol&&i.host===e.host}}():function(){return function(){return!0}}(),ta=e$.hasStandardBrowserEnv?{write(e,t,i,n,r,s){let a=[e+"="+encodeURIComponent(t)];ep.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),ep.isString(n)&&a.push("path="+n),ep.isString(r)&&a.push("domain="+r),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read(e){let t=document.cookie.match(RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function to(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function tl(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function tc(e,t){return e&&!to(t)?tl(e,t):t}let td=e=>e instanceof e4?{...e}:e;function tu(e,t){t=t||{};let i={};function n(e,t,i){return ep.isPlainObject(e)&&ep.isPlainObject(t)?ep.merge.call({caseless:i},e,t):ep.isPlainObject(t)?ep.merge({},t):ep.isArray(t)?t.slice():t}function r(e,t,i){return ep.isUndefined(t)?ep.isUndefined(e)?void 0:n(void 0,e,i):n(e,t,i)}function s(e,t){if(!ep.isUndefined(t))return n(void 0,t)}function a(e,t){return ep.isUndefined(t)?ep.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(i,r,s){return s in t?n(i,r):s in e?n(void 0,i):void 0}let l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t)=>r(td(e),td(t),!0)};return ep.forEach(Object.keys(Object.assign({},e,t)),function(n){let s=l[n]||r,a=s(e[n],t[n],n);ep.isUndefined(a)&&s!==o||(i[n]=a)}),i}var th=e=>{let t,i=tu({},e),{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:o,auth:l}=i;if(i.headers=o=e4.from(o),i.url=eA(tc(i.baseURL,i.url),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),ep.isFormData(n)){if(e$.hasStandardBrowserEnv||e$.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(t=o.getContentType())){let[e,...i]=t?t.split(";").map(e=>e.trim()).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...i].join("; "))}}if(e$.hasStandardBrowserEnv&&(r&&ep.isFunction(r)&&(r=r(i)),r||!1!==r&&ts(i.url))){let e=s&&a&&ta.read(a);e&&o.set(s,e)}return i},tg="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,i){let n,r,s,a,o,l=th(e),c=l.data,d=e4.from(l.headers).normalize(),{responseType:u,onUploadProgress:h,onDownloadProgress:g}=l;function p(){a&&a(),o&&o(),l.cancelToken&&l.cancelToken.unsubscribe(n),l.signal&&l.signal.removeEventListener("abort",n)}let f=new XMLHttpRequest;function m(){if(!f)return;let n=e4.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());e9(function(e){t(e),p()},function(e){i(e),p()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(l.method.toUpperCase(),l.url,!0),f.timeout=l.timeout,"onloadend"in f?f.onloadend=m:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(m)},f.onabort=function(){f&&(i(new ef("Request aborted",ef.ECONNABORTED,e,f)),f=null)},f.onerror=function(){i(new ef("Network Error",ef.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded",n=l.transitional||eO;l.timeoutErrorMessage&&(t=l.timeoutErrorMessage),i(new ef(t,n.clarifyTimeoutError?ef.ETIMEDOUT:ef.ECONNABORTED,e,f)),f=null},void 0===c&&d.setContentType(null),"setRequestHeader"in f&&ep.forEach(d.toJSON(),function(e,t){f.setRequestHeader(t,e)}),ep.isUndefined(l.withCredentials)||(f.withCredentials=!!l.withCredentials),u&&"json"!==u&&(f.responseType=l.responseType),g&&([s,o]=ti(g,!0),f.addEventListener("progress",s)),h&&f.upload&&([r,a]=ti(h),f.upload.addEventListener("progress",r),f.upload.addEventListener("loadend",a)),(l.cancelToken||l.signal)&&(n=t=>{f&&(i(!t||t.type?new e8(null,e,f):t),f.abort(),f=null)},l.cancelToken&&l.cancelToken.subscribe(n),l.signal&&(l.signal.aborted?n():l.signal.addEventListener("abort",n)));let v=e7(l.url);if(v&&-1===e$.protocols.indexOf(v))return void i(new ef("Unsupported protocol "+v+":",ef.ERR_BAD_REQUEST,e));f.send(c||null)})},tp=(e,t)=>{let{length:i}=e=e?e.filter(Boolean):[];if(t||i){let i,n=new AbortController,r=function(e){if(!i){i=!0,a();let t=e instanceof Error?e:this.reason;n.abort(t instanceof ef?t:new e8(t instanceof Error?t.message:t))}},s=t&&setTimeout(()=>{s=null,r(new ef(`timeout ${t} of ms exceeded`,ef.ETIMEDOUT))},t),a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));let{signal:o}=n;return o.unsubscribe=()=>ep.asap(a),o}};let tf=function*(e,t){let i,n=e.byteLength;if(!t||n<t)return void(yield e);let r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},tm=async function*(e,t){for await(let i of tv(e))yield*tf(i,t)},tv=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);let t=e.getReader();try{for(;;){let{done:e,value:i}=await t.read();if(e)break;yield i}}finally{await t.cancel()}},tS=(e,t,i,n)=>{let r,s=tm(e,t),a=0,o=e=>{!r&&(r=!0,n&&n(e))};return new ReadableStream({async pull(e){try{let{done:t,value:n}=await s.next();if(t){o(),e.close();return}let r=n.byteLength;if(i){let e=a+=r;i(e)}e.enqueue(new Uint8Array(n))}catch(e){throw o(e),e}},cancel:e=>(o(e),s.return())},{highWaterMark:2})},ty="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,tC=ty&&"function"==typeof ReadableStream,tb=ty&&("function"==typeof TextEncoder?(s=new TextEncoder,e=>s.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer())),tT=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},tE=tC&&tT(()=>{let e=!1,t=new Request(e$.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),t_=65536,tI=tC&&tT(()=>ep.isReadableStream(new Response("").body)),tw={stream:tI&&(e=>e.body)};ty&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{tw[t]||(tw[t]=ep.isFunction(e[t])?e=>e[t]():(e,i)=>{throw new ef(`Response type '${t}' is not supported`,ef.ERR_NOT_SUPPORT,i)})})})(new Response);let tP=async e=>{if(null==e)return 0;if(ep.isBlob(e))return e.size;if(ep.isSpecCompliantForm(e)){let t=new Request(e$.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return ep.isArrayBufferView(e)||ep.isArrayBuffer(e)?e.byteLength:(ep.isURLSearchParams(e)&&(e+=""),ep.isString(e))?(await tb(e)).byteLength:void 0},tR=async(e,t)=>{let i=ep.toFiniteNumber(e.getContentLength());return null==i?tP(t):i},tA={http:eS,xhr:tg,fetch:ty&&(async e=>{let t,i,{url:n,method:r,data:s,signal:a,cancelToken:o,timeout:l,onDownloadProgress:c,onUploadProgress:d,responseType:u,headers:h,withCredentials:g="same-origin",fetchOptions:p}=th(e);u=u?(u+"").toLowerCase():"text";let f=tp([a,o&&o.toAbortSignal()],l),m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});try{if(d&&tE&&"get"!==r&&"head"!==r&&0!==(i=await tR(h,s))){let e,t=new Request(n,{method:"POST",body:s,duplex:"half"});if(ep.isFormData(s)&&(e=t.headers.get("content-type"))&&h.setContentType(e),t.body){let[e,n]=tn(i,ti(tr(d)));s=tS(t.body,t_,e,n)}}ep.isString(g)||(g=g?"include":"omit");let a="credentials"in Request.prototype;t=new Request(n,{...p,signal:f,method:r.toUpperCase(),headers:h.normalize().toJSON(),body:s,duplex:"half",credentials:a?g:void 0});let o=await fetch(t),l=tI&&("stream"===u||"response"===u);if(tI&&(c||l&&m)){let e={};["status","statusText","headers"].forEach(t=>{e[t]=o[t]});let t=ep.toFiniteNumber(o.headers.get("content-length")),[i,n]=c&&tn(t,ti(tr(c),!0))||[];o=new Response(tS(o.body,t_,i,()=>{n&&n(),m&&m()}),e)}u=u||"text";let v=await tw[ep.findKey(tw,u)||"text"](o,e);return!l&&m&&m(),await new Promise((i,n)=>{e9(i,n,{data:v,headers:e4.from(o.headers),status:o.status,statusText:o.statusText,config:e,request:t})})}catch(i){if(m&&m(),i&&"TypeError"===i.name&&/fetch/i.test(i.message))throw Object.assign(new ef("Network Error",ef.ERR_NETWORK,e,t),{cause:i.cause||i});throw ef.from(i,i&&i.code,e,t)}})};ep.forEach(tA,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});let tM=e=>`- ${e}`,tD=e=>ep.isFunction(e)||null===e||!1===e;var tO=e=>{let t,i,{length:n}=e=ep.isArray(e)?e:[e],r={};for(let s=0;s<n;s++){let n;if(i=t=e[s],!tD(t)&&void 0===(i=tA[(n=String(t)).toLowerCase()]))throw new ef(`Unknown adapter '${n}'`);if(i)break;r[n||"#"+s]=i}if(!i){let e=Object.entries(r).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new ef("There is no suitable adapter to dispatch the request "+(n?e.length>1?"since :\n"+e.map(tM).join("\n"):" "+tM(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function tk(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new e8(null,e)}function tN(e){return tk(e),e.headers=e4.from(e.headers),e.data=e5.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),tO(e.adapter||eG.adapter)(e).then(function(t){return tk(e),t.data=e5.call(e,e.transformResponse,t),t.headers=e4.from(t.headers),t},function(t){return!e6(t)&&(tk(e),t&&t.response&&(t.response.data=e5.call(e,e.transformResponse,t.response),t.response.headers=e4.from(t.response.headers))),Promise.reject(t)})}let tx="1.7.7",tL={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{tL[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});let tF={};tL.transitional=function(e,t,i){function n(e,t){return"[Axios v"+tx+"] Transitional option '"+e+"'"+t+(i?". "+i:"")}return(i,r,s)=>{if(!1===e)throw new ef(n(r," has been removed"+(t?" in "+t:"")),ef.ERR_DEPRECATED);return t&&!tF[r]&&(tF[r]=!0,console.warn(n(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,r,s)}};var tU=function(e,t,i){if("object"!=typeof e)throw new ef("options must be an object",ef.ERR_BAD_OPTION_VALUE);let n=Object.keys(e),r=n.length;for(;r-- >0;){let s=n[r],a=t[s];if(a){let t=e[s],i=void 0===t||a(t,s,e);if(!0!==i)throw new ef("option "+s+" must be "+i,ef.ERR_BAD_OPTION_VALUE);continue}if(!0!==i)throw new ef("Unknown option "+s,ef.ERR_BAD_OPTION)}};let t$=tL;class tV{constructor(e){this.defaults=e,this.interceptors={request:new eD,response:new eD}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=Error();let i=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?i&&!String(e.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+i):e.stack=i}catch(e){}}throw e}}_request(e,t){let i,n;"string"==typeof e?(t=t||{}).url=e:t=e||{};let{transitional:r,paramsSerializer:s,headers:a}=t=tu(this.defaults,t);void 0!==r&&tU(r,{silentJSONParsing:t$.transitional(t$.boolean),forcedJSONParsing:t$.transitional(t$.boolean),clarifyTimeoutError:t$.transitional(t$.boolean)},!1),null!=s&&(ep.isFunction(s)?t.paramsSerializer={serialize:s}:tU(s,{encode:t$.function,serialize:t$.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=a&&ep.merge(a.common,a[t.method]);a&&ep.forEach(["delete","get","head","post","put","patch","common"],e=>{delete a[e]}),t.headers=e4.concat(o,a);let l=[],c=!0;this.interceptors.request.forEach(function(e){("function"!=typeof e.runWhen||!1!==e.runWhen(t))&&(c=c&&e.synchronous,l.unshift(e.fulfilled,e.rejected))});let d=[];this.interceptors.response.forEach(function(e){d.push(e.fulfilled,e.rejected)});let u=0;if(!c){let e=[tN.bind(this),void 0];for(e.unshift.apply(e,l),e.push.apply(e,d),n=e.length,i=Promise.resolve(t);u<n;)i=i.then(e[u++],e[u++]);return i}n=l.length;let h=t;for(u=0;u<n;){let e=l[u++],t=l[u++];try{h=e(h)}catch(e){t.call(this,e);break}}try{i=tN.call(this,h)}catch(e){return Promise.reject(e)}for(u=0,n=d.length;u<n;)i=i.then(d[u++],d[u++]);return i}getUri(e){return eA(tc((e=tu(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}ep.forEach(["delete","get","head","options"],function(e){tV.prototype[e]=function(t,i){return this.request(tu(i||{},{method:e,url:t,data:(i||{}).data}))}}),ep.forEach(["post","put","patch"],function(e){function t(t){return function(i,n,r){return this.request(tu(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}tV.prototype[e]=t(),tV.prototype[e+"Form"]=t(!0)});var tB=tV;class tH{constructor(e){let t;if("function"!=typeof e)throw TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});let i=this;this.promise.then(e=>{if(!i._listeners)return;let t=i._listeners.length;for(;t-- >0;)i._listeners[t](e);i._listeners=null}),this.promise.then=e=>{let t,n=new Promise(e=>{i.subscribe(e),t=e}).then(e);return n.cancel=function(){i.unsubscribe(t)},n},e(function(e,n,r){i.reason||(i.reason=new e8(e,n,r),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason)return void e(this.reason);this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new tH(function(t){e=t}),cancel:e}}}var tj=tH;function tq(e){return function(t){return e.apply(null,t)}}function tW(e){return ep.isObject(e)&&!0===e.isAxiosError}let tG={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tG).forEach(([e,t])=>{tG[t]=e});var tz=tG;function tJ(e){let t=new tB(e),i=a(tB.prototype.request,t);return ep.extend(i,tB.prototype,t,{allOwnKeys:!0}),ep.extend(i,t,null,{allOwnKeys:!0}),i.create=function(t){return tJ(tu(e,t))},i}let tK=tJ(eG);tK.Axios=tB,tK.CanceledError=e8,tK.CancelToken=tj,tK.isCancel=e6,tK.VERSION=tx,tK.toFormData=e_,tK.AxiosError=ef,tK.Cancel=tK.CanceledError,tK.all=function(e){return Promise.all(e)},tK.spread=tq,tK.isAxiosError=tW,tK.mergeConfig=tu,tK.AxiosHeaders=e4,tK.formToJSON=e=>ej(ep.isHTMLForm(e)?new FormData(e):e),tK.getAdapter=tO,tK.HttpStatusCode=tz,tK.default=tK,e.exports=tK}}]);