"use strict";(this.webpackChunk_msteams_light_meetings=this.webpackChunk_msteams_light_meetings||[]).push([["6394"],{634504:function(e,t,i){i.d(t,{Z:()=>c});var n,a=new Uint8Array(16);let r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var o=[],s=0;s<256;++s)o.push((s+256).toString(16).substr(1));let l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!("string"==typeof i&&r.test(i)))throw TypeError("Stringified UUID is invalid");return i},c=function(e,t,i){var r=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(a)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(var o=0;o<16;++o)t[i+o]=r[o];return t}return l(r)}},675254:function(e,t,i){i.d(t,{G:()=>c});var n=i(395250),a=i(817324),r=i(892891),o=i(945761);let s={initVdiSupport:()=>null,addVdiDomOverrides:r.noop},l={get:()=>{throw Error("ERROR: IPC utility should not be used")}};n.RG.LimeCallingAgentsInit;let c=e=>new a.d(e.config,e.desktopUtilityService,e.authenticationService,e.loggingService,e.eventingService,e.meetingPolicySettingsStore,e.telemetryService,e.trouterService,e.httpRequestDispatcher,e.platformDetectService,e.retryService,e.policyAdminSettingsStore,e.teamsMeetingConfiguration,e.utilityService,e.callSupportDetector,s,l,o.Wq,e.asObservable)},466172:function(e,t,i){i.d(t,{mo:()=>S});var n=i(370574),a=i(310735),r=i(646162),o=i(167135),s=i(206898),l=i(855273),c=i(892891),d=i(826757),g=i(395250),h=i(575810),p=i(675201),u=i(642900);class m extends Error{constructor(e,t,i,n,a,r,o){super(e),this.name=t,this.terminatedReason=i,this.ccCode=n,this.ccSubCode=a,this.resultCategories=r,this.callEndDiagnosticsInfo=o}}class _ extends r.d{constructor(e){super(e),this.asObservable=e.observableFactory.createObservable(),this.utilityService=e.utilityService}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){this.asObservable.unsubscribe(e)}initMeeting(...e){return this.initCall(...e)}acceptCall(e,t,i=!1,a=!0,r=!1){if(!e)return this.promiseFactory.reject("Call object should be always provided for acceptCall");if(e.state!==n.CallState.Notified)return this.promiseFactory.reject("Call must be in Notified state for acceptCall");let o=this.sanitizeMessage(e.messageId??""),s={conversationId:e.conversationId||e.threadId||"",isChannelMeeting:!!o,messageId:o,callId:e.callId,withVideo:t,muted:i,mutedSpeakers:r,screenSharingOnly:e.isScreenshareFromChat,joinType:p.AH.normal,forceActiveCallToLocalHold:d.eU.isReplacesCall(e)},l=e.invitationData&&e.invitationData.meetingInfo,c=e.getIntent();c&&u.P.isLegacyIntent(c)&&(l=l||{tenantId:c.coordinates.tenantId,organizerId:c.coordinates.organizerId}),(l=l||e.setupArgs&&e.setupArgs.meetingInfo)&&(s.meetingInfo={},s.meetingInfo.tenantId=l.tenantId,s.meetingInfo.organizerId=l.organizerId),this.saveCallSetupArgs(e,s,{isOneToOneCall:!1});let g=this.promiseFactory.createDeferred(),h=async t=>{await this.updateCommonOptions(s,void 0,!1,e),this.logger.info(`Calling call.accept, callid=${e.callId}`),e.accept({withVideo:t,muted:i}).then(()=>{this.logger.info(`call.accept returns successfully, callid=${e.callId}`),e.initiatedTime=Date.now(),g.resolve(e)}).catch(e=>{this.logger.error(`Accepting a call failed with ${e}`),g.reject(e)})};return t?this._deviceManagerServiceBase.getCameraAvailable().then(t=>{this.logger.debug(`Camera available: ${t}. Accepting call ${e.callId} withVideo: ${t}`),h(t)}).catch(t=>{this.logger.warn(`Camera detection failed. Error: ${t}`),this.logger.info(`Camera detection failed. Accepting call ${e?.callId} withVideo: false`),h(!1)}):(this.logger.info(`Accepting incoming call ${e?.callId} without video.`),h(!1)),g.promise}async joinCallWithoutModality(e,t,i,a,r,o,l){let d=!(0,c.isEmpty)(e.meetingData)&&r===s.c.MeetingData&&e.meetingData?await this.createCallWithMeetingData(e.meetingData):await this.createCall(e.conversationId,!1,void 0,"","0",void 0,!0,void 0,!1,void 0);if(d.joinType===s.c.MeetingData){let e={mediaPeerType:n.MediaPeerType.EnterpriseMultiParty,threadId:""};await this.initCallAndDetermineUserRole(d,e,"","default",{skipDeviceInitialization:o,skipTransportCompanionInitialization:l})}else{let t={isMeeting:!0,conversationId:e.conversationId,messageId:e.messageId||"0",callId:d.callId,teamsCallId:d.teamsCallId,callUrl:e.callUrl,meetingInfo:e.meetingInfo,enableGroupCallMeetupGeneration:!1},i=await this.createCallConfiguration(d,t);await this.initCallAndSetConversationId(d,i.initOptions,e.conversationId,{skipDeviceInitialization:o,skipTransportCompanionInitialization:l})}let g={label:void 0},h={conversationUrl:e.callUrl,conversationId:d.callId};if(d.joinType===s.c.MeetingData){let e=this.utilityService.generateUUID();d.subscribeWithMeetingData(e,h,{shouldResurrect:n.ResurrectPreference.Resurrect,...g})}try{await d.joinCallWithoutCallModality(h,g)}catch(t){let e=d.callEndDiagnosticsInfo;throw new m([`terminatedReason: ${t}`,e&&`ccCode: ${e.callControllerCode}`,e&&`ccSubCode: ${e.callControllerSubCode}`,e&&`resultCategory: ${e.resultCategories}`].filter(Boolean).join(", "),d.callEndDiagnosticsInfo?.phrase||"StartObservableCallError",t,e?.callControllerCode,e?.callControllerSubCode,e?.resultCategories,d.callEndDiagnosticsInfo)}return d}async getObservableCall(e){let{coordinates:t,context:i}=e,n=this.getCallInitInfoFromCoordinates(t);if(!n)return this.promiseFactory.reject("cannot get observable call");let r=t.type===a.G.Meeting&&t.joinType||s.c.Legacy;return this.joinCallWithoutModality(n,i,void 0,void 0,r)}updateDisplayName(e){return this.callRegistry.updateDisplayName(e)}cancelRetry(e){}getCalls(e,t,i){return this.callRegistry?this.callRegistry.calls.slice(0).map(e=>this._teamsCallService.getOrCreateTeamsCall(e)).filter(i=>i.conversationId===e&&t&&i.messageId===t):[]}getActiveCalls(e=!1){let t;return t=e?o._G:[n.CallState.Connecting,n.CallState.EarlyMedia,n.CallState.Connected,n.CallState.InLobby,n.CallState.Disconnecting],this.callRegistry?this.callRegistry.calls.filter(e=>(0,c.includes)(t,e.state)).map(e=>this._teamsCallService.getOrCreateTeamsCall(e)):[]}getRetriableCall(e){return null}getPstnDialCapabilities(e){return{isDialInEnabled:!1,isDialOutEnabled:!1,isLbrEnabledUser:!1}}getCallByCoordinates(e){return null}async getCallByCoordinatesAsync(e){return null}initEvents(){}setTflAccountConfig(){}pnhTemplateOverrideForTFWDesktop(e){}setupVdiUiSupport(){}verifyCallProtocols(){}getIntentFromIntentStore(){}onDevicesChanged(){}whenCallRegistryCreatedWithOfflineSupport(){return Promise.resolve()}waitForAppOnline(){return Promise.resolve()}joinPreheatedCall(e,t){return Promise.resolve()}sendAutoBrbForCallRegistryInitAnomalies(e){}commonPostCallCreationSetup(e,t,i,n,a,r){}showB2bUnsupportedDialog(){}handleCallingNotPossible(e){return Promise.resolve()}updateSkypeIdentity(){return Promise.resolve()}subscribeTo(e,t,i){e.subscribe&&e.subscribe.bind(e)(t,i)}isResendRegistrationEnabled(){return!1}async generateEndpointMetadata(e,t){return Promise.resolve("")}isFederatedOrSfbConversation(e){return!1}getObservingCallByTeamsCallId(e){return null}setTerminationInfo(e,t){}onCallAdded(e){this.createCallSubscriptions(this._teamsCallService.getOrCreateTeamsCall(e))}onCallRemoved(e){}addCallQuestionnaire(e,t){return Promise.resolve()}verifyOnlineState(e){}restoreWindow(){}addBroadcastInformation(e,t){}onDisconnectSurfaceHub1(e,t,i){}trackMediaConnection(e){super.trackMediaConnection(e),(0,l.U)(e,()=>this.handleMediaConnectionScenarioIfPossible(e),!0)}createCallSubscriptions(e){this.callSubscriptionRegistry.push({call:e,subscription:e.on("callStateChanged",async()=>this.onCallStateChanged(e))},{call:e,subscription:e.on("mediaConnectionWhitelistingWarning",()=>this.onMediaConnectionWhitelistingWarning(e))},{call:e,subscription:e.on("mediaConnectionFailed",()=>this.onMediaConnectionFailed(e))})}onCallStateChanged(e){switch(this.logger.info(`callingService.onCallStateChanged: callId = ${e.callId} to state = ${d.eU.stringifyCallState(e.state)}, [call][callStateChanged=${d.eU.stringifyCallState(e.state)}][callId=${e.callId}][teamsCallType=${e.teamsCallType}]`),e.state){case n.CallState.Connecting:this.onConnectingCall(e);break;case n.CallState.InLobby:this.onCallInLobby(e);break;case n.CallState.Connected:this.onConnectedCall(e);break;case n.CallState.Disconnecting:this.onDisconnectingCall(e);break;case n.CallState.Disconnected:this.onDisconnectedCall(e)}}onConnectingCall(e){this._callingTelemetryServiceBase.setLoggingContext(e),e.getStartCallScenario().then(t=>{t.appendEventData({wasPreheatAttempted:e.isPreheatEnabled,wasPreheatCompleted:e.preheatCompleted}),this.markScenarioStep(t,g.ck.Connecting)})}onCallInLobby(e){this._callingTelemetryServiceBase.setLoggingContext(e);let t={reason:h.gT.scenarios.steps.calling.inLobby};e.getStartCallScenario().then(e=>{e.appendEventData({[h.gT.counters.eventNames.wasInLobby]:!0}),e.mark(g.ck.CallInLobby),e.pause(t)})}onConnectedCall(e){this._callingTelemetryServiceBase.setLoggingContext(e),e.getStartCallScenario().then(t=>{t.resume(),t.appendEventData({wasPreheatAttempted:e.isPreheatEnabled,wasPreheatCompleted:e.preheatCompleted}),this.markScenarioStep(t,g.ck.Connected,[],{isVideoOn:e.isVideoOn,isScreenshareFromChat:e.isScreenshareFromChat}),t.stop()}),e.wasInState(n.CallState.Connected,!1)||this.trackMediaConnection(e)}onDisconnectingCall(e){e.getStartCallScenario().then(e=>{this.markScenarioStep(e,g.ck.Disconnecting)})}onDisconnectedCall(e){e.getStartCallScenario().then(e=>{e&&this.markScenarioStep(e,g.ck.Disconnected)}),this.cleanupCall(e)}getCallInitInfoFromCoordinates(e){return e.type===a.G.Meeting?e.joinType===s.c.MeetingData?this.getCallInitInfoFromMeetingDataCoords(e):this.getCallInitInfoFromLegacyMeetingCoords(e):null}getCallInitInfoFromLegacyMeetingCoords(e){let{conversationId:t,rootMessageId:i,messageId:n,tenantId:a,organizerId:r,isChannel:o}=e;return{conversationId:t,messageId:i,meetingInfo:{tenantId:a,organizerId:r,replyChainMessageId:o&&n||void 0},callUrl:"",callId:"",teamsCallId:0}}getCallInitInfoFromMeetingDataCoords(e){return{meetingData:e.meetingData,conversationId:"",meetingInfo:{tenantId:"",organizerId:""},callUrl:"",callId:"",teamsCallId:0}}}let S=e=>{let t=new _({config:e.config,activeCallsService:e.activeCallsService,appStateService:e.appStateService,authenticationService:e.authenticationService,callingAgentsService:e.callingAgentsService,callingTelemetryService:e.callingTelemetryService,conversationsAsyncService:e.conversationsAsyncService,deviceManagerService:e.deviceManagerService,eventingService:e.eventingService,loggingService:e.loggingService,desktopUtilityService:e.desktopUtilityService,platformDetectService:e.platformDetectService,geoRoutingService:e.geoRoutingService,sxConfig:e.sxConfig,telemetryProvider:e.telemetryProvider,utilityService:e.utilityService,callingSupportService:e.callingSupportService,videoSupportService:e.videoSupportService,teamsCallService:e.teamsCallService,retryService:e.retryService,objectLeaksDetector:e.objectLeaksDetector,mutedCallNotificationsService:e.mutedCallNotificationsService,survivabilityService:e.survivabilityService,freemiumUtilities:e.freemiumUtilities,chatServiceUtils:e.chatServiceUtils,servicesProvider:e.servicesProvider,webApiService:e.webApiService,skypeConversationLocalUtils:e.skypeConversationLocalUtils,observableFactory:e.observableFactory,setupKeysService:e.setupKeysService,locationAccessSettingService:e.locationAccessSettingService,pstnNumberService:e.pstnNumberService});return t.initializeOnAppLaunchAndReinit(),t}},929522:function(e,t,i){i.d(t,{s:()=>r});var n=i(377957);class a{constructor(){}mixTeamsCall(e){e.wasInState=()=>!1,e.isAborted=()=>!1,e.initForTransportCompanion=()=>Promise.resolve()}}let r=e=>new n.w(e.loggingService,[...e.inputMixinsList,new a])},308113:function(e,t,i){i.d(t,{T:()=>n});function n(e,t){return 1===t.length&&"ctorProps"===t[0].__type?t[0]:{__type:"ctorProps",...e(t)}}},58741:function(e,t,i){i.d(t,{O:()=>a});var n=i(440743);let a=(e,t=!1,i="",a={warn:()=>{}},r)=>{let o=e=>a.warn(`[getAppScenarioFromScenario] ${e}`);return{fail:a=>{t?(e?.mark(`${i}app_scenario_fail`,a),o(`scenario.fail(${(0,n.BB)(a??{})}) was called on ${e?.name} but the operation is not allowed for this AppScenario`)):e?.fail(a)},mark:(t,n)=>{r?.mark(t,n),e?.mark(`${i}${t}`,n)},stop:a=>{t?(e?.mark(`${i}app_scenario_stop`,a),o(`scenario.stop(${(0,n.BB)(a??{})}) was called on ${e?.name} but the operation is not allowed for this AppScenario`)):e?.stop(a)}}}},302004:function(e,t,i){var n,a;i.d(t,{g:()=>n}),(a=n||(n={})).BreakoutRoom="breakoutRoomInviteFromMainMeeting",a.MainMeeting="breakoutRoomInviteToMainMeeting",a.BetweenRooms="breakoutRoomInviteFromAnotherRoom"},505e3:function(e,t,i){i.d(t,{P:()=>l});var n,a=i(892891),r=i(310735),o=i(206898),s=i(642900);class l{static resolveThreadIdForRequest(e){return e?.replace(/:/g,"_")}static resolveThreadIdForResponse(e){return e.replace(/(19|gcch|dod|gal)_/g,"$1:")}static restoreMriFromUpn(e,t,i,n){return{...e,mri:e.upn&&(t(e.upn)||i(e.upn)||n(e.upn))?e.upn:e.mri}}static async withTimeout(e,t){return new Promise(async(i,n)=>{let a=t.utilityService.setTimeoutMs(()=>{t.onTimeout?.(),n(Error("Timeout!"))},t.timeout);try{i(await e)}catch(e){n(e)}finally{clearTimeout(a)}})}static meetingCoordinatesToCallCoordinates({meetingCoordinates:e,meetingCloudGetter:t}){let{threadId:i,additionalMessageId:n,messageId:s,tenantId:l,organizerId:c}=e;return{type:r.G.Meeting,joinType:o.c.Legacy,conversationId:i,messageId:(0,a.isNil)(n)?s:n,rootMessageId:s,isChannel:"0"!==s,isAdhoc:!1,tenantId:l,organizerId:c,meetingCloud:t()}}static toCallMergeOptions(e){let{sourceMeetingCoordinates:t,fromRoom:i,toRoom:n,settings:a,hasReconciledPstn:r,correlationId:o}=e;return{threadId:void 0===n?t.threadId:n.coordinates.threadId,messageId:void 0===n?t.messageId:n.coordinates.messageId,additionalData:{invitationData:{breakoutRoomData:{...void 0===n?{isMainMeetingInvite:!0}:{isRoomInvite:!0,meetingName:n.roomName},relatedMeetingCoords:void 0===i?t:i.coordinates,shouldAutoAcceptInvite:a?.allowMoveParticipantsAutomatically!==!1,...r?{hasReconciledPstn:r}:{},correlationId:o},meetingInfo:{tenantId:void 0===n?t.tenantId:n.coordinates.tenantId,organizerId:void 0===n?t.organizerId:n.coordinates.organizerId}}}}}static isBreakoutRoomInviteCall(e){return e.isBreakoutRoomInvite()||e.isMainMeetingInvite()}static isBreakoutRoomCall(e){let t=e.invitationData?.breakoutRoomData;return t?.isMainMeetingInvite||t?.isRoomInvite}static isReconciledPstnCall({call:e,isPstnMri:t}){return!!n.getReconciledPstnEndpoint({call:e,isPstnMri:t})}static getReconciledPstnEndpoint({call:e,isPstnMri:t}){return e.endpoints?.endpointDetails?.find(e=>t(e.originalId||""))}static parseMTError(e){try{return JSON.parse(e.message)}catch{return e}}static areBreakoutRoomsEqual(e,t){return e.coordinates.threadId===t.coordinates.threadId}static removePIIFromReassignActions(e,t){let i=[{field:"mri",processor:t},{field:"objectId",processor:a.identity},{field:"role",processor:a.identity},{field:"tenantId",processor:a.identity}];return e.map(e=>({...e,participants:e.participants.map(e=>i.reduce((t,{field:i,processor:n})=>(t[i]=n(e[i]||""),t),{mri:""}))}))}static async waitForCallActivation({call:e,logger:t}){try{await e.getMeetingDetails()}catch{t.error(`Error during call ${e.callId} activation`)}}static deepLinkParamsToMeetingCoordinates(e){return{tenantId:e.context.Tid||"",organizerId:e.context.Oid||"",threadId:e.conversationId,messageId:e.messageId,additionalMessageId:void 0}}static async getBreakoutRoomCoordinates({teamsCallId:e,callingService:t,callingDeepLinkService:i,logger:a}){let o=t.getCallByTeamsCallId(e,!0);if(!o)throw a.error(`getRoomCoordinates: Call not found: ${e}`),Error(JSON.stringify({status:"callNotFound",teamsCallId:e}));let l=o.meetingInfo;if(!l)throw a.error(`getRoomCoordinates: Call does not contain coordinates: ${o.teamsCallId}.`),Error(JSON.stringify({status:"noMeetingInfo",teamsCallId:e}));try{let e=await o.getMeetingDetails(),t=e?.breakoutDetails?.breakoutRoomProperties?.mainMeetingJoinUrl;if(t){let e=i.getDeeplinkParamsFromUrl(t);return n.deepLinkParamsToMeetingCoordinates(e)}}catch(e){throw a.error(`getRoomCoordinates: getMeetingDetails failed: ${e}`),Error(JSON.stringify({status:"meetingDetailsPromiseError",message:e?.message}))}let c=o.messageId,d=l.replyChainMessageId;if(!c||!d){let e=o.getIntent?.();e?.type===r.G.Meeting&&s.P.isLegacyIntent(e)&&(c=c||e.coordinates.rootMessageId,d=d||e.coordinates.messageId)}if(c)return{tenantId:l.tenantId,organizerId:l.organizerId,threadId:o.threadId,messageId:c,additionalMessageId:c!==d?d:void 0};try{let e=await o.getMessageIdAsync();return e||a.error(`getRoomCoordinates: MessageId is ${e}. for call type: ${o.getIntent?.()?.type}. It should not be undefined for channel meetings.`),{tenantId:l.tenantId,organizerId:l.organizerId,threadId:o.threadId,messageId:e,additionalMessageId:d}}catch(e){throw a.error(`getRoomCoordinates: getMessageIdAsync failed: ${e}`),Error(JSON.stringify({status:"messageIdPromiseError",message:e?.message}))}}static getCallParticipantsFromMeetingParticipants(e,t){return e.filter(e=>t.some(t=>e.id.includes(t.mri)||t.upn&&e.id.includes(t.upn)||e.nonMaskedId?.includes(t.mri)||t.upn&&e.nonMaskedId?.includes(t.upn)))}static getBreakoutRoomsAndAssignmentsMaps(e){return e.reduce((e,t)=>(e.breakoutRoomsMap.set(t.coordinates.threadId,t),t.participants?.forEach(i=>{e.assignmentsMap.set(i.mri,t.coordinates.threadId)}),e),{breakoutRoomsMap:new Map,assignmentsMap:new Map})}static meetingCoordinatesAsString(e){return`${e.threadId}/${e.messageId??"0"}/${e.additionalMessageId??""}`}static getBreakoutRoomsDetailsId({threadId:e,messageId:t}){return`${e}/${t??"0"}`}static isMeetingActivated(e){return!!e.meetingDetails?.invitation}}n=l,l.allSettled=e=>Promise.all(e.map(async e=>{try{let t=await e;return{status:"fulfilled",value:t}}catch(e){return{status:"rejected",reason:e}}}))},464136:function(e,t,i){i.d(t,{j:()=>r});var n=i(113802),a=i(302004);let r=()=>{let e=[a.g.BetweenRooms,a.g.BreakoutRoom],t=t=>e.includes(t),i=[n.l.GoToAssignedBreakoutRoom,n.l.GoBackToMainMeetingFromBreakoutRoomOnDemand],r=[n.l.AutoAcceptBreakoutRoomInvite,n.l.AutoAcceptMainMeetingInvite],o=[n.l.AcceptBreakoutRoomInvite,n.l.AcceptMainMeetingInvite];return{getInviteTypeBasedOnInviteCall:(e,t)=>e.isMainMeetingInvite()?a.g.MainMeeting:t.isBreakoutRoom()&&e.isBreakoutRoomInvite()?a.g.BetweenRooms:a.g.BreakoutRoom,isInviteToBreakoutRoom:t,isInviteContextForBreakoutRoomsButtons:e=>i.includes(e),getInviteContext:(e,i)=>t(e)?i?n.l.AutoAcceptBreakoutRoomInvite:n.l.AcceptBreakoutRoomInvite:i?n.l.AutoAcceptMainMeetingInvite:n.l.AcceptMainMeetingInvite,isAutoAcceptedInviteContext:e=>r.includes(e),getAutoAcceptedInviteContext:e=>t(e)?n.l.AutoAcceptBreakoutRoomInvite:n.l.AutoAcceptMainMeetingInvite,isManualInviteContext:e=>o.includes(e),getManualInviteContext:e=>t(e)?n.l.AcceptBreakoutRoomInvite:n.l.AcceptMainMeetingInvite,getIncompleteInviteContext:e=>e===a.g.MainMeeting?n.l.MainMeetingInviteTimeOut:n.l.BreakoutRoomInviteTimeOut}}},806843:function(e,t,i){i.d(t,{Y:()=>v});var n,a,r=i(370574),o=i(642900),s=i(505e3),l=i(302004),c=i(206898);let d=e=>{let{joinUrl:t,callingDeepLinkService:i,utilityService:n,participantCachedData:a}=e,r=i.getDeeplinkParamsFromUrl(t),o=s.P.meetingCoordinatesToCallCoordinates({meetingCoordinates:s.P.deepLinkParamsToMeetingCoordinates(r),meetingCloudGetter:()=>n.getUserCloudDomain()});if(a&&o.joinType===c.c.Legacy){let e=a[o.conversationId]?.participantRegistrationId;e&&(o.registration={participantRegistrationId:e})}return{callCoordinates:o,deepLinkParams:r}},g=e=>{let t=e.callEndDiagnosticsInfo;return t?.callControllerCode!==0||t?.callControllerSubCode!==0},h=i(395250).RG.BreakoutRoomsMainMeetingCallObservation,p="breakout_rooms_self_move_call_subscription";(n=a||(a={})).MAIN_MEETING_CALL_FETCHING_IN_BREAKOUT_ROOM="main_meeting_call_fetching_in_breakout_room",n.MAIN_MEETING_CALL_DISCONNECTION="main_meeting_call_disconnection",n.MAIN_MEETING_CALL_ROOM_CHANGE="main_meeting_call_room_change";let u=e=>({info:({message:t,data:i,logToTelemetry:n})=>{n?e.infoToTelemetry?.(t,p,i,!0):e.info(t)},error:({message:t,data:i})=>e.errorToTelemetry?.(t,p,i,!0)}),{MAIN_MEETING_CALL_DISCONNECTION:m,MAIN_MEETING_CALL_FETCHING_IN_BREAKOUT_ROOM:_,MAIN_MEETING_CALL_ROOM_CHANGE:S}=a,C=(e,t)=>{e.breakoutDetails&&t(e.breakoutDetails?.mainMeetingProperties?.assignedBreakoutRooms?.[0])},v=e=>{let t=e.loggingService.newLogger("breakoutRoomParticipantCallChangeHandler"),i=[(e=>{let t=new Map,i=null,n=null,a=(()=>{let e=[],t=()=>{e.length=0};return{registerMove:()=>{let t={cancelMove:!1};return e.push(t),t},cancelPreviousMoves:()=>{e.forEach(e=>{e.cancelMove=!0}),t()},cleanup:t}})(),s=(e,t)=>{t.logger.info({message:"Start subscribing to MM call in MM"}),p({context:t,mainMeetingCall:e,resetPrevAssignedRoom:!0})},c=(i,n)=>{let a,{callingDeepLinkService:o,utilityService:s,observableCallService:l,participantCachedData:c}=e,{logger:h,getScenario:u}=n;h.info({message:`Start subscribing to MM call in BR (BR callId=${i.callId})`,logToTelemetry:!0});let S=i.breakoutRoomProperties.mainMeetingJoinUrl;if(!S){let e="no main meeting join url",t=u({type:_});h.error({message:e}),t.fail({reason:e});return}let{callCoordinates:C,deepLinkParams:v}=d({joinUrl:S,callingDeepLinkService:o,utilityService:s,participantCachedData:c}),b=!0,y=Promise.resolve({dispose:()=>{}}),T=()=>l.observe(C,e=>{h.info({message:`Got main meeting call in breakout room: callId=${e.callId}`,logToTelemetry:!0}),a=p({mainMeetingCall:e,breakoutRoomCall:i,context:n,resetPrevAssignedRoom:!1})},e=>{if(b&&(b=!1,i.state!==r.CallState.Disconnected)){y.then(e=>{e.dispose("[Breakout rooms move w/o invite]: disposing first try")}),y=T();return}let t=u({type:_}),n=e?.error;t.fail({reason:n}),h.error({message:`Error observing main meeting call from breakout room: ${n}`})},{context:"AssignedRoomChangesHandler"});y=T();let I=i.on("callStateChanged",()=>{if(i.state===r.CallState.Disconnected){((e,t)=>{let{logger:i,getScenario:n}=e,a=t.callEndDiagnosticsInfo;i.info({message:`Breakout room call is disconnected (code=${a?.callControllerCode}, subCode=${a?.callControllerSubCode}). Disposing main meeting call subscription...`,data:{callId:t.callId}}),g(t)&&n({type:m,reason:"Breakout room call disconnected",context:JSON.stringify({breakoutRoomCallState:t.state,breakoutRoomCallEndInfo:a})}).stop()})(n,i),y.then(e=>{e.dispose("[Breakout rooms move w/o invite]: breakout room call disconnected")});let e=v.conversationId;t.get(e)===a&&f(n,e),I.dispose()}})},p=e=>{let{mainMeetingCall:n,context:a,breakoutRoomCall:o,resetPrevAssignedRoom:s}=e,{logger:l}=a,{threadId:c,callId:d}=n,h=t.has(c);l.info({message:`Subscribing to main meeting call: mainMeetingCallId=${d}, hasAlreadyActiveSubscription=${h}`}),h&&f(a,c),s&&C(n,e=>{i=e});let p=n.changed(()=>{let e=n.state,t=o?.state||r.CallState.None;if([e,t].some(e=>[r.CallState.LocalHold,r.CallState.Disconnecting].includes(e)))return void l.info({message:`Breakout room call (callId=${o?.callId}) or main meeting call (callId=${n.callId}) is not in observing state. Main meeting call state=${e}, breakout room call state=${t}`});if(e===r.CallState.Disconnected){((e,t)=>{let{logger:i,getScenario:n}=e,a=t.callEndDiagnosticsInfo;i.info({message:`Main meeting call is disconnected (code=${a?.callControllerCode}, subCode=${a?.callControllerSubCode}). Disposing main meeting call subscription...`,data:{callId:t.callId}}),g(t)&&n({type:m,reason:"Main meeting call disconnected",context:JSON.stringify({mainMeetingCallId:t.callId,mainMeetingCallState:t.state,mainMeetingCallEndInfo:a})}).stop()})(a,n),f(a,c);return}C(n,e=>{v(a,n,e)})});return t.set(c,p),p},v=async(t,r,s)=>{let{callingDeepLinkService:c,callingService:g,utilityService:h,helpers:p}=e,{logger:u,getScenario:m}=t,_=(({mainMeetingCall:e,callingDeepLinkService:t,utilityService:i,callingService:n})=>{let a=n.getActiveCall();if(a.isBreakoutRoom()){let r=e.breakoutDetails?.mainMeetingProperties?.allBreakoutRooms||[],s=a.getIntent()?.coordinates;return s?r.find(e=>{let{callCoordinates:a}=d({joinUrl:e.meetingJoinUrl||"",utilityService:i,callingDeepLinkService:t});return o.P.areCoordinatesEquivalent(s,a,n)}):null}return null})({mainMeetingCall:r,callingDeepLinkService:c,utilityService:h,callingService:g}),C=((e,t,i,n)=>{let a=i?.meetingJoinUrl&&i.meetingJoinUrl===n?.meetingJoinUrl;if(t&&t.meetingJoinUrl!==i?.meetingJoinUrl){if(e?.isOpen===!0&&t?.isOpen===!1)return l.g.MainMeeting;if(a)return null}return i?.isOpen===!1&&n?.isOpen===!0?l.g.BreakoutRoom:(i?.isOpen!==!0||n?.isOpen!==!1)&&(i?.isOpen!==!0||n)?i||n?.isOpen!==!0?a||i?.isOpen!==!0||n?.isOpen!==!0?null:l.g.BetweenRooms:l.g.BreakoutRoom:l.g.MainMeeting})(n,_,i,s);if(i=s,n=_,C){u.info({message:`Room change detected: ${C} on MM call ${r.callId}`,logToTelemetry:!0}),a.cancelPreviousMoves();let e=m({type:S,context:C});try{let t=g.getActiveCall(),i=a.registerMove();await p.handleMoveWithoutInvite({activeCall:t,mainMeetingCall:r,inviteType:C,moveCancellationToken:i}),e.stop()}catch(i){let t=i?.message||i;u.error({message:`Error handling move: ${t}`}),e.fail({reason:t})}a.cleanup()}},f=(e,i)=>{t.has(i)&&(t.get(i)?.dispose(),t.delete(i),e.logger.info({message:`Previous mainMeetingCall subscription (threadId=${i}) was disposed`}))};return{subscribe:async t=>{let{config:i,logger:n,callingSupportService:a,loggingService:r}=e,o=u(n),l=i.enableParticipantsMoveWithoutSendingInvites(),d=a?.isBreakoutRoomsFeatureSupported?.();if(!l||!d)return void o.error({message:`Not listening for room changes: isSelfMoveEnabled=${l}, isBreakoutRoomsFeatureSupported=${d}`});let g={getScenario:e=>{let i=r.findScenario(h)||r.newScenario(h);return i.appendEventData({participantId:t.participantId,callId:t.callId,...e}),i},logger:o};t.isBreakoutRoom()?c(t,g):s(t,g)},unsubscribe:()=>{let{logger:r}=e;u(r).info({message:`Disposing mainMeetingCall subscriptions on cleanup - subscriptions count: ${t.size}`}),t.forEach(e=>e.dispose()),t.clear(),a.cleanup(),i=null,n=null}}})({...e,logger:t})];return{subscribe:e=>{i.forEach(t=>{t.subscribe(e)})},unsubscribe:()=>{i.forEach(e=>{e.unsubscribe()})}}}},28414:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u,m,_;i.d(t,{IR:()=>l,N2:()=>a,PT:()=>o,TP:()=>n,Vo:()=>c,gC:()=>s,tf:()=>r}),(d=n||(n={})).NotStarted="notStarted",d.Starting="starting",d.Started="started",d.Stopping="stopping",d.Stopped="stopped",(g=a||(a={})).none="none",g.setLayout="setLayout",g.start="start",g.stop="stop",g.switchPrimary="switchPrimary",g.failoverInstance="instanceFailover",g.updateMediaState="updateMediaState",g.restart="restart",(h=r||(r={}))[h.Producer=0]="Producer",h[h.Contributor=1]="Contributor",h[h.Attendee=2]="Attendee",h[h.None=3]="None",(p=o||(o={})).None="None",p.AppMinimized="AppMinimized",p.AppRestored="AppRestored",(u=s||(s={})).Sending="Sending",u.Stalled="Stalled",u.Stopped="Stopped",(m=l||(l={}))[m.init=0]="init",m[m.live=1]="live",m[m.userLive=2]="userLive",m[m.ended=3]="ended",(_=c||(c={})).None="none",_.PPTDown="pptDown",_.VideoDown="videoDown",_.VbssDown="vbssDown",_.CompDown="compDown",_.InitFail="initFail"},782507:function(e,t,i){i.d(t,{E:()=>o});var n=i(273213),a=i(229283),r=i(510750);class o{constructor(e,t,i,s,l,c,d,g){this.handler=s,this.onDataReceived=(e,t)=>{if(e!==n.xp.TextTrack)return;let i=this.call.getClosedCaptionsTextTrack(),r=this.call.getClosedCaptionsUsingTrack(),s=this.call.getClosedCaptionsUsingSource(),l=this.call.getClosedCaptionsLanguage(),c=this.getCurrentLanguage(r,l),d=this.call.getClosedCaptionsBotParticipantId(),g=this.call.getHasBeenSelectedManually();if(o.getParticipantIdFromBotData(t.id)!==d&&!this.call.isBroadcast&&!(this.enableMCRBotRTMPSource&&t.source===a.f6.Cea708))return;let h=this.isTranslationSettingUnified||this.call.isMultilingualMeeting;if(h?t.source!==a.f6.Cart||i.source!==a.f6.Mt||"transcript_user_subtitle_language_off"!==i.language||g||this.hasFirstCart||s===a.f6.Cea708||(this.processCartTrack(t),this.hasFirstCart=!0):t.source!==a.f6.Cart||i||this.hasFirstCart||(this.processCartTrack(t),this.hasFirstCart=!0),h){let e=(0,a.DZ)(s);if(t.source!==e)return void this.logger.warn(`DynamicTrackSelector: caption source ${t.source} does not match using source ${e}, skipping`);if(this.isSpeechServiceSource(e))return void this.processAiTrack(t);this.logger.warn(`DynamicTrackSelector: caption source ${t.source} is not supported, skipping`)}else{let e=(0,a.DZ)(r.source);if(t.source!==e||t.trackLanguage?.toLowerCase()!==c)return;if(this.isSpeechServiceSource(e))return void this.processAiTrack(t)}t.source===a.f6.Cea708?(t.userId=this.mcrBotMri,this.handler(t)):this.processCartTrack(t)},this.captionHandler=e=>this.handler(e),this.call=i,this.hasFirstCart=!1,this.isTranslationSettingUnified=l,this.enableMCRBotRTMPSource=c,this.mcrBotMri=d,this.logger=t,this.unmixedToMixedAdapter=new r.U(e,t,this.captionHandler,g)}dispose(){this.unmixedToMixedAdapter?.dispose()}getCurrentLanguage(e,t){return e.source&&this.isSpeechServiceSource(e.source)&&(!t||e.language===t)?n.fS.toLowerCase():e.language?.toLowerCase()}isSpeechServiceSource(e){return e===a.f6.Ai||e===a.f6.Mt}processAiTrack(e){this.unmixedToMixedAdapter.onDataReceived(n.xp.TextTrack,e)}processCartTrack(e){this.handler({...e,isFinal:!0})}static getParticipantIdFromBotData(e){let t=e.split("/");return t.length>1?t[0]:""}}},510750:function(e,t,i){i.d(t,{U:()=>a});var n=i(273213);class a{constructor(e,t,i,a){this.logger=t,this.handler=i,this.type=n.xp.TextTrack,this.finalCaptionTimeoutMs=5e3,this.onDataReceived=this.onDataReceived.bind(this),this.finalCaptionTimeoutMs=e.finalCaptionTimeoutMs(),this.enabledMultiCaptionsPresentation=a}dispose(){}onDataReceived(e,t){if(this.type!==e)return;if(!t.text)return void this.logger.warn("[UnmixedToMixedAdapter] Received caption without text, ignoring");let i=this.getId(t);if(this.logger.log(`[UnmixedToMixedAdapter] Received caption ${i?"with":"without"} speaker info`),!i){this.logger.warn("[UnmixedToMixedAdapter] Received caption without speaker id"),this.handler(t);return}if(this.currentSpeakerId||(this.currentSpeakerId=i),!this.enabledMultiCaptionsPresentation&&this.currentSpeakerId!==i)if(!(this.lastHandlerCallTime&&Date.now()-this.lastHandlerCallTime>this.finalCaptionTimeoutMs))return void this.logger.log("[UnmixedToMixedAdapter] Interjection, ignoring");else this.logger.log("[UnmixedToMixedAdapter] timeout : setting currentSpeaker to new id"),this.currentSpeakerId=i,this.lastSentCaption&&this.handler({...this.lastSentCaption,isFinal:!0});this.logger.log("[UnmixedToMixedAdapter] Sending caption to handler."),this.lastHandlerCallTime=Date.now(),this.lastSentCaption=t,this.handler(t),t.isFinal&&(this.logger.log("[UnmixedToMixedAdapter] Clearing out current speaker id and last sent caption after getting final"),this.currentSpeakerId=void 0,this.lastSentCaption=void 0)}getId(e){return e.roomId||e.userId||""}}},206898:function(e,t,i){var n,a;i.d(t,{c:()=>n}),(a=n||(n={}))[a.Legacy=0]="Legacy",a[a.MeetingData=1]="MeetingData"},505782:function(e,t,i){i.d(t,{f:()=>a,r:()=>r});var n=i(377957);let a=e=>({syncedWith:()=>e});class r{constructor(e){this.args=e}mixTeamsCall(e,t){return this.mixin=this.args.createMixin(e),n.w.bindMethods(e,this.mixin,this.args.methods,t,!!this.args.forceBind),n.w.bindProps(e,this.mixin,this.args.props,t,!!this.args.forceBind),this.args.postInit?()=>{try{return this.args.postInit(this.mixin)}catch(e){t?.error(`postInit failed: ${e.message}`)}}:void 0}}},63230:function(e,t,i){var n,a;i.d(t,{CH:()=>r,Qz:()=>o,hz:()=>n});class r{}r.CallParkStateChanged="CallParkStateChanged",(a=n||(n={}))[a.None=0]="None",a[a.Parking=1]="Parking",a[a.Succeeded=2]="Succeeded",a[a.Failed=3]="Failed",a[a.MusicOnHold=4]="MusicOnHold";let o={Hold:"multi_window_hold",Resume:"multi_window_resume",Transfer:"multi_window_transfer",ConsultativeTransfer:"multi_window_consultative_transfer",MultiWindow:"multi_window"}},276881:function(e,t,i){i.d(t,{T:()=>h,s:()=>c});var n=i(370574),a=i(892891),r=i(19745),o=i(377957),s=i(575810),l=i(373649);class c{}c.Type_FreemiumCallDurationGatesReached="freemium-call-duration-gates-reached",c.Type_FreemiumCallCapacityGatesReached="freemium-call-capacity-gates-reached",c.Type_PaywallTimerStarts="paywall-timer-starts",c.Type_CallSponsorChanged="call-limits-sponsor-changed";let d={remainingDurationInMinutes:void 0,maxAllowedParticipants:void 0,sponsor:void 0,enforcePaywallLimits:!1},g={callPaywallLimits:d,callParticipantCounts:{totalParticipants:0,totalConnectedTflParticipants:0,lobbyParticipants:0,totalPresenters:0,totalAttendees:0,requestingAttentionPresenters:0,requestingAttentionAttendees:0,overflowAttendees:0}};class h{constructor(e,t,i,n,a,r,o,s,l,c=!0){this.config=e,this.callingService=t,this.mtmaSubscriptionUtility=i,this.participantCountsService=n,this.asObservable=r,this.analyticsService=o,this.dialogService=s,this.sxConfig=l,c&&this.initializeOnAppLaunchAndReinit(),this.logger=a.newLogger("CallPaywallService")}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}initializeOnAppLaunchAndReinit(){this.callStates=new Map,(this.config.enableCapacityEvents()||this.config.enableDurationEvents())&&(this.callingServiceSubscription=this.mtmaSubscriptionUtility.subscribe(this.callingService,()=>this.onCallsChanged()))}cleanupOnAppTeardown(e){this.callStates=void 0,this.callingServiceSubscription&&this.mtmaSubscriptionUtility.unsubscribe(this.callingService,this.callingServiceSubscription),this.callingServiceSubscription=void 0}getCallPaywallState(e){let t=this.callingService.getCallByTeamsCallId(e,!0,!1);return t?(this.ensureSubscribeTo(t),this.getPaywallStateFromDetail(this.callStates.get(t))):g}trigger(e,t,i){return this.asObservable.trigger(e,t,i)}onCallsChanged(){let e=this.callingService.getAllCalls(!0,!0);for(let t of e)this.ensureSubscribeTo(t);this.callStates.forEach((t,i)=>{e.includes(i)||this.unsubscribeFrom(i)})}ensureSubscribeTo(e){if(this.callStates.has(e)||e.state===n.CallState.Disconnected)return;let t=e.on("callStateChanged",()=>this.onCallStateChanged(e)),i=e.changed(()=>this.onCallChanged(e)),a=this.mtmaSubscriptionUtility.subscribe(this.participantCountsService,(t,i)=>this.onParticipantCountsChanged(e,i),r.j.Type_CallParticipantCountsChanged,o.w.getTeamsCallIdAsString(e.teamsCallId)),s=e.callLimits??{...d},l=this.participantCountsService.getCallParticipantCounts(e.teamsCallId);this.callStates.set(e,{callSubscription:i,callStateSubscription:t,callParticipantCountsSubscription:a,callPaywallLimits:{...s},callParticipantCounts:{...l},eventsFired:new Set}),this.onCallChanged(e),this.onParticipantCountsChanged(e,l)}unsubscribeFrom(e){let t=this.callStates.get(e);t&&(t.callSubscription.dispose(),t.callStateSubscription.dispose(),this.mtmaSubscriptionUtility.unsubscribe(this.participantCountsService,t.callParticipantCountsSubscription),this.callStates.delete(e))}onCallStateChanged(e){e.state===n.CallState.Disconnected&&this.unsubscribeFrom(e)}onCallChanged(e){if(!e.callLimits)return void this.logger.warn("callLimits not defined in call, skipping processing this call update");let t=this.callStates.get(e),i=t.callPaywallLimits&&{...t.callPaywallLimits};if(t.callPaywallLimits={...e.callLimits},!e?.callLimits?.enforcePaywallLimits)return void this.logger.info("paywall not enforced, skipping process this call update");t.callPaywallLimits?.remainingDurationInMinutes!==i.remainingDurationInMinutes&&(this.logger.info(`call limits remainingDuration changed from  ${i?.remainingDurationInMinutes} to ${e?.callLimits?.remainingDurationInMinutes} for call ${e.teamsCallId}`),this.onCallRemainingDurationChanged(e,t)),t.callPaywallLimits.enforcePaywallLimits&&this.onEnforcePaywallLimits(e,t)}onCallRemainingDurationChanged(e,t){let i=this.getPaywallMeetingRole(t.callPaywallLimits.sponsor);this.config.enableDurationEvents()&&this.config.durationWarningGates().includes(t.callPaywallLimits.remainingDurationInMinutes)&&(this.logger.info("firing duration warning event"),this.triggerOnce(c.Type_FreemiumCallDurationGatesReached,e,t,i))}onEnforcePaywallLimits(e,t){let i=this.getPaywallMeetingRole(t.callPaywallLimits.sponsor);"organizer"===i&&this.config.enableDurationEvents()&&e.state===n.CallState.Connected&&(this.logger.info("firing timer starts event"),this.triggerOnce(c.Type_PaywallTimerStarts,e,t,i))}onParticipantCountsChanged(e,t){let i=this.callStates.get(e),n=i.callParticipantCounts.totalParticipants,a=t.totalParticipants;if(this.logger.log(`participant ounts object updated from ${JSON.stringify(i.callParticipantCounts)} to ${JSON.stringify(t)} for for call ${e.teamsCallId}`),this.logger.log(`call ${e.teamsCallId} type: ${e.callType}, state: ${e.state}`),i.callParticipantCounts={...t},!e?.callLimits?.enforcePaywallLimits||n===a)return;let r=i.callPaywallLimits.maxAllowedParticipants-a,o=this.getPaywallMeetingRole(i.callPaywallLimits.sponsor);"organizer"===o&&this.config.enableCapacityEvents()&&this.config.capacityWarningGates().includes(r)&&(this.logger.info("firing capacity warning event"),this.triggerOnce(c.Type_FreemiumCallCapacityGatesReached,e,i,o))}triggerOnce(e,t,i,n){if(!i.eventsFired.has(e)){i.eventsFired.add(e);let a=()=>this.onUpgrade(),r={...this.getPaywallStateFromDetail(i),paywallRole:n,upgrade:a};this.trigger(e,t.teamsCallId.toString(),r),this.recordEventView(e,n)}}getPaywallStateFromDetail(e){let{callPaywallLimits:t,callParticipantCounts:i}=e;return{callPaywallLimits:t,callParticipantCounts:i}}async onUpgrade(){try{await this.dialogService.open(s.gT.dialogs.optionsSettingsDialog,{tabItemId:"PremiumBenefits"})}catch(e){this.logger.error(`paywall services fails to open settings pane. message: ${e.message}`)}}recordEventView(e,t){let i;switch(e){case c.Type_FreemiumCallDurationGatesReached:i="organizer"===t?l.wh.callPaywallDurationAlertForSponsor:l.wh.callPaywallDurationAlertForParticipant;break;case c.Type_FreemiumCallCapacityGatesReached:i="organizer"===t?l.wh.callPaywallCapacityAlert:void 0;break;case c.Type_PaywallTimerStarts:i="organizer"===t?l.wh.callPaywallTimerStartAlert:void 0;break;default:i=void 0}i&&(0,a.defer)(()=>this.analyticsService.sendPseudoPanelView({panelType:i}))}getPaywallMeetingRole(e){return this.sxConfig.getCurrentSkypeMri()===e?"organizer":""}}},453842:function(e,t,i){i.d(t,{l:()=>n});let n={CallMeBack:0,RosterOpened:1,RecordingUfdDismissed:2,RecordingSpotlightUfdDismissed:3,RecordingStoppedUfdDismissed:4,RecordingPPTUfdDismissed:5,RecordingWhiteboardUfdDismissed:6,ScreensharingUfdDismissed:7,VoiceCollectionStartedUfdDismissed:8,VoiceCollectionStoppedUfdDismissed:9,PstnDialogDismissed:10,UfdNoPstnDismissed:11,CallingRosterAccordion:12,PinningProperties:13,ParticipantVideoScalingModes:14,VDINotOptimizedUfdDismissed:15,WasPstnCoachmarkDisplayed:16,WasShareInviteDialogShown:17,MaxVideosOnStage:18,XlMeetingJoinedWithOldClientDismissed:19}},154252:function(e,t,i){i.d(t,{V:()=>d});var n=i(370574),a=i(892891),r=i(575810),o=i(945761),s=i(826757);let l=async(e,t)=>{if(!e.getMeetingDetailsWithChatProperties)throw Error("getMeetingDetailsWithChatProperties is not implemented");let i=new Promise((e,i)=>t.setTimeoutMs(()=>i(Error("Timeout waiting for meeting details")),5e3)),n=await Promise.race([e.getMeetingDetailsWithChatProperties(),i]);if(n?.meetingChatProperties)try{let e=JSON.parse(n.meetingChatProperties),t=e?.meetingtitle||e?.subject;if(t)return{titleText:t,titleHoverText:t}}catch(e){throw Error("Failed to parse meetingChatProperties")}throw Error("Meeting title not found")};class c{constructor(e,t=""){this.teamsCallId=e,this.title=t,this.subscriptions=[]}count(){return this.subscriptions.length}subscribeForTitle(e){this.subscriptions.push(e)}unsubscribe(e){let t=this.subscriptions.indexOf(e);-1!==t&&this.subscriptions.splice(t,1)}setTitle(e){e!==this.title&&(this.title=e,this.subscriptions.forEach(t=>t(e)))}}class d{constructor(e,t,i,n,a,r,s,l,c,d,g,h,p=!0,u,m=o.Wq){this.chatServiceUtils=t,this.sxConfig=i,this.eventingService=n,this.peopleService=a,this.callConsultationStore=r,this.callStartedMessageProviderService=s,this.messageService=l,this.channelService=c,this.servicesProvider=d,this.localized=g,this.config=h,this.utilityService=u,this.promiseFactory=m,this.subscribedCalls={},this.titleCacheMap={},this.logger=e.newLogger("CallTitleService"),p&&this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.eventingService.registerHandlerForExternalEvent(r.gT.events.pushEvents.messageStore.createOrUpdateMessage,e=>e.messages.forEach(e=>this.onCreateOrUpdateMessage(e)))}cleanupOnAppTeardown(e){this.subscribedCalls={},this.titleCacheMap={}}subscribeForMeetupTitle(e,t){this.subscribedCalls[e]=this.subscribedCalls[e]||new c(e);let i=this.subscribedCalls[e];return i.subscribeForTitle(t),{dispose:()=>{i.unsubscribe(t),0===i.count()&&delete this.subscribedCalls[e]}}}getMeetupTitleForCall(e){return e&&e.conversationId?this.getMeetupTitle(e.callId,e.teamsCallId,e.conversationId,e.messageId):null}getMeetupTitle(e,t,i,n){let a=this.subscribedCalls[t],r=this.titleCacheMap[t]||a&&a.title;return r||(n&&!this.chatServiceUtils.isValidId(n)?this.logger.warn(`Cannot get meeting title for invalid rootMessageId - ${n}`):this.callStartedMessageProviderService.getMessage(e,i,n).then(e=>this.onCreateOrUpdateMessage(e,t)).catch(t=>{this.logger.warn(`Cannot get meeting title for callId: ${e}, message: ${t.message}`)}),"")}getMeetupTitleFromMessage(e,t){return this.messageService.getMeetupTitle(e.conversationId,t)}setMeetupTitleFromMessage(e,t){return this.messageService.getMeetupTitle(e.conversationId,t).then(t=>this.setMeetupTitle(e,t))}async setMeetupTitle(e,t){if((0,a.isNil)(t))return this.promiseFactory.reject("Invalid titleText passed to setMeetupTitle");t!==this.defaultMeetingTitle&&(this.titleCacheMap[e.teamsCallId]=t);try{let i=await this.callStartedMessageProviderService.getMessageForCall(e);this.messageService.setMeetupTitle(i.conversationId,i.id,t)}catch(t){this.logger.warn(`Cannot get meeting title for callId: ${e.callId}, message: ${t.message}`)}}getDefaultCallTitleForConversation(e,t){let i=e=>({titleText:e,titleHoverText:e});return e.whenInitialized().then(()=>e.getTitle()).then(n=>{if(n){if(e.isChannel())return i(this.defaultChannelMeetingTitle(n));if(e.isGroup())return i(this.localized.getGroupMeetingTitle(t.isScreenshareFromChat,t?.conversationType==="huddleGroupCall",n));if(e.isPrivateMeeting())return i(n)}return t?.isBreakoutRoom()?e.getTopicName().then(e=>i(e||this.defaultMeetingTitle)):e.isChannel()?e.getId().then(e=>this.getChannelDisplayName(e).then(t=>(0,a.isEmpty)(t)?(this.logger.error(`Could not get channel displayName for threadId ${e}`),i(this.defaultMeetingTitle)):i(this.localized.getChannelTitle(t)))):e.isPrivateMeeting()?i(this.defaultMeetingTitle):void 0})}get defaultMeetingTitle(){return this.localized.defaultMeetingTitle()}defaultChannelMeetingTitle(e){return this.localized.defaultChannelMeetingTitle(e)}async getDefaultCallTitle(e,t,i){try{let a={};if(this.setTitleText(a,this.defaultMeetingTitle),t&&s.eU.isVoicemailGreetingCall(t))return this.setTitleText(a,this.getMeetupTitleForCall(t)),this.promiseFactory.resolve(a);if(t&&t.isUnparkCall&&t.unparkContext!==n.ParkContext.ServerHold){if(0===t.participants.length)return this.setTitleText(a,this.localized.callParticipantConnectingState()),this.promiseFactory.resolve(a);return this.getUnparkCallTitle(t,e)}if(t&&t.isServerHold)return this.logger.info(`[call][callId:${t.callId}][callTitle][serverHold] getting call title from participant list`),this.peopleService.getPeopleProfile(t.heldUserMri,e).then(e=>this.createCallTitle(e.displayName));if(t.isMwbtCall&&t.callerMri&&(t.mwbtCallState===n.MonitorActionType.Monitor||t.mwbtCallState===n.MonitorActionType.Whisper))return this.logger.info(`[call][callId:${t.callId}][callTitle][mwbtCallState:${t.mwbtCallState}] getting call title`),this.peopleService.getPeopleProfile(t.callerMri,e).then(e=>this.createCallTitle(this.localized.getMwbtTitle(t.mwbtCallState===n.MonitorActionType.Monitor,e.displayName||""),void 0));if(this.config.enableAnonymousCallerDisplayFix()&&t.participants?.length===1&&this.chatServiceUtils.isAnonymousPstnMri(t.participants[0].id)){let e=t.participants[0].displayName||this.localized.unknownUserDisplayName();return this.createCallTitle(this.localized.checkAndAddExternalTag(e))}if(!this.config.enableRetrieveMeetingTitleFromChatProperties?.())return this.getTitleFromConversationAsync({call:t,context:e,maxNamesInTitle:i,callTitle:a});{let n,r=this.getTitleFromConversationAsync({call:t,context:e,maxNamesInTitle:i,callTitle:a}),o=l(t,this.utilityService),s=await (n=[r,o],new Promise((e,t)=>{let i=0;n.forEach(a=>{a.then(e).catch(()=>{++i===n.length&&t(Error("All promises were rejected"))})})}));if(s?.isChannelMeeting){let e=await o.catch(()=>void 0);if(e)return e}return s||this.createCallTitle("")}}catch(e){throw this.logger.error("callTitleService: getDefaultCallTitle failed"),e}}async getTitleFromConversationAsync({call:e,context:t,maxNamesInTitle:i,callTitle:n}){let a=await e.getCallingConversationAsync(),r=a.isChannel();return this.getDefaultCallTitleForConversation(a,e).then(o=>o?{...o,isChannelMeeting:r}:this.isConsultCall(e)?this.getConsultingTitle(e,t):s.eU.isIncomingConsultCall(e)?this.getIncomingConsultingTitle(e,t):e.isCallQueue?a.isGroup()?this.getCallQueueGroupCallTitle(e,t):this.getCallQueueConferenceTitle(e,t):this.isForwardedCall(e)?this.getForwardingTitle(e,t):this.getDefaultTitleForOneOneAndAdHocGroup(a,t,i,n,e))}getDefaultTitleForOneOneAndAdHocGroup(e,t,i,n,o){let s=this.getAllButMeMris(e);return 0===(s=s.filter(e=>!this.chatServiceUtils.isAnonymousUserMri(e))).length?Promise.resolve(n):this.peopleService.getAllPeopleProfile(s,t).then(e=>{let{recording:s,callScreen:l}=r.gT.scenarios.calling.context,c=(0,a.map)(e,e=>this.getDisplayName(e)).sort();if(c.length>i){let r=c.slice(0,i-1).join(", "),d=c.join(", ");if(t===l)n.titleText=this.localized.getLargeGroupTitle(o.isScreenshareFromChat,r);else{let i=(0,a.find)(e,e=>e.displayName===c[0]),r=i&&"pstn"===i.type?c[0]:c[0].split(" ")[0];n.titleText=this.localized.getMultiCallListTitle(e.length,r),t===s&&this.setTitleText(n,this.localized.getCalling1to1Title(n.titleText))}this.setTitleText(n,n.titleText,this.localized.getLargeGroupTitleHover(o.isScreenshareFromChat,d))}else{let e=c.slice(0,i).join(", ");if(this.isDelegatorForwardedCall(o))return this.getCallForDelegatorTitle(e,o.transferorMri,t);if(this.isCallOnBehalfOf(o))return this.getCallForDelegatorTitle(e,o.onBehalfOfMri,t);if(o.isCallQueue){let i=o.callQueueInfo&&o.callQueueInfo.details&&o.callQueueInfo.details.displayName;return this.getCallQueueTitle(t,e,i)}else t===s||t===l?this.setTitleText(n,this.localized.get1to1Title(o.isScreenshareFromChat,e)):this.setTitleText(n,e)}return n})}isConsultCall(e){return this.callConsultationStore.isConsultCall(e.teamsCallId)}getDisplayName(e){return this.config.enableDecorateCallWindowTitle()&&e.decoratedDisplayName||e.displayName}getConsultingTitle(e,t){let i=this.callConsultationStore.getConsulteeForConsult(e.teamsCallId);return this.getUserDisplayName(i.mri,t).then(i=>{if(this.isForwardedCall(e)&&!s.eU.isCallConnecting(e))return this.getConsultingForwardedTitle(e,i,t);let n=this.localized.get1to1ConsultingTitle(i);return this.createCallTitle(n)})}getIncomingConsultingTitle(e,t){let i=e.participants[0].id;return this.getUserDisplayName(i,t).then(e=>{let t=this.localized.get1to1ConsultingTitle(e);return this.createCallTitle(t)})}getConsultingForwardedTitle(e,t,i){let n=e.participants[0].acceptedBy||e.participants[0].id;return this.getUserDisplayName(n,i).then(i=>{let n;return n=e.forwardingDestinationType===r.gT.forwardingDestinationType.voicemail?this.localized.get1to1ConsultingForwardedToVoicemailTitle(i):this.localized.get1to1ConsultingForwardedTitle(t,i),this.createCallTitle(n)})}isForwardedCall(e){return!!e&&(!!e.forwardingDestinationType&&!!(e.participants.length>0)&&e.originalCalleeMri!==(e.participants[0].acceptedBy||e.participants[0].id)||e.incomingCallType===r.gT.incomingCallType.forward)}isDelegatorForwardedCall(e){return!!e.transferorMri&&e.transferorType===r.gT.transferorType.delegator}isCallOnBehalfOf(e){return e&&!!e.onBehalfOfMri}getForwardingTitle(e,t){let i=e.participants[0].acceptedBy||e.participants[0].id;return this.getUserDisplayName(i,t).then(i=>{let n;if(e.forwardingDestinationType===r.gT.forwardingDestinationType.voicemail)n=this.localized.get1to1ForwardingToVoiceMailTitle(i);else{if(e.onBehalfOfMri)return e.incomingCallType===r.gT.incomingCallType.forward&&e.transferorMri?this.getCallForDelegatorTitle(i,e.transferorMri,t):this.getCallForDelegatorTitle(i,e.onBehalfOfMri,t);if(e.incomingCallType===r.gT.incomingCallType.forward)return this.getCallForForwardingTitleCallee(i,e.transferorMri,t);if(e.forwardingDestinationType===r.gT.forwardingDestinationType.user)return this.getCallForForwardingTitleCaller(i,e.originalCalleeMri,t);n=this.localized.get1to1ForwardingWithoutCalleeTitle(i)}return this.createCallTitle(n)})}getCallQueueConferenceTitle(e,t){let i=e.callQueueInfo&&e.callQueueInfo.onBehalfOf&&e.callQueueInfo.onBehalfOf.id||e.participants&&e.participants[0]&&e.participants[0].id,n=e.callQueueInfo&&e.callQueueInfo.details&&e.callQueueInfo.details.id;return this.promiseFactory.all([this.getUserDisplayName(i,t),this.getUserDisplayName(n,t)]).then(([e,i])=>this.getCallQueueTitle(t,e,i))}getCallQueueGroupCallTitle(e,t){return this.getCallParticipantsUserDisplayName(e,t).then(e=>{let t=this.localized.getCallQueueGroupCallTitle(e);return this.createCallTitle(t)})}getUnparkCallTitle(e,t){let i=e.participants[0].acceptedBy||e.participants[0].id;return this.getUserDisplayName(i,t).then(e=>this.createCallTitle(e))}getUserDisplayName(e,t){return this.peopleService.getPeopleProfile(e,t).then(e=>e&&e.displayName)}getCallParticipantsUserDisplayName(e,t){return this.peopleService.getAllPeopleProfile(s.eU.getCallParticipantMrisExcludingBots(e,void 0,void 0,{excludingAllBots:!0}),t).then(e=>(0,a.map)(e,e=>e.displayName).sort().join(", "))}getCallForForwardingTitleCallee(e,t,i){return this.getUserDisplayName(t,i).then(t=>{let i=this.localized.get1to1ForwardingWithCalleeTitle(e,t);return this.createCallTitle(i)})}getCallForForwardingTitleCaller(e,t,i){return this.getUserDisplayName(t,i).then(t=>{let i=this.localized.get1to1ForwardingCallerTitle(e,t);return this.createCallTitle(i)})}getCallForDelegatorTitle(e,t,i){return this.getUserDisplayName(t,i).then(t=>{let i=this.localized.get1to1ForDelegatorTitle(e,t);return this.createCallTitle(i)})}getCallQueueTitle(e,t,i){let n=this.localized.getCallQueueTitle(e===r.gT.scenarios.calling.context.callScreen,t,i);return{titleText:n,titleHoverText:n}}createCallTitle(e,t){return{titleText:e,titleHoverText:t||e}}setTitleText(e,t,i){e.titleText=t,e.titleHoverText=i||t}getMessageTitle(e){let t=e.getMeetingProperties?.();return t&&t[r.gT.skypeMessagePropertyName.meeting.title]}onCreateOrUpdateMessage(e,t){if(!t){let i=this.servicesProvider.callingService().getCallByCallId(e.skypeguid,null,!0);t=i?i.teamsCallId:void 0}let i=t&&this.subscribedCalls[t];if(i){let n=this.getMessageTitle(e);n&&(i.setTitle(n),delete this.titleCacheMap[t])}}getAllButMeMris(e){if(e&&e.members){let t=this.sxConfig.getCurrentSkypeMri();return e.members.filter(e=>e.id!==t).map(e=>e.id)}return this.logger.debug("conversation is null"),[]}getChannelDisplayName(e){if(this.config.enableT2AsyncChannelService?.())return Promise.resolve(this.channelService.getChannelByObjectIdAsync?.(e).then(e=>e?e.displayName:null,()=>null));{let t=this.channelService.getChannelByObjectId?.(e);return Promise.resolve(t?t.displayName:null)}}}},924975:function(e,t,i){var n,a,r,o;i.d(t,{JI:()=>g,Jn:()=>s,Nn:()=>n,RU:()=>d,WR:()=>p,Yy:()=>u,_S:()=>a,c3:()=>l,dP:()=>c,nt:()=>h});let s={Mute:1,Unmute:2},l={App:1,OS:2,MW:3},c={code:499,subCode:0,phrase:"Error: SlimCorePIE.CallHandlerCallMute:Error timed out"},d=["403","400","499"],g=["5496","5492","5491","3551","5105","3122"],h={Hold:1,Unhold:2},p={Whiteboard:0,HdmiIngest:1,Generic:2};(r=n||(n={})).Success="Success",r.Timeout="Timeout",r.Error="Error",r.Incomplete="Incomplete",r.Cancelled="Cancelled",(o=a||(a={})).Success="Success",o.Timeout="Timeout",o.Error="Error",o.Incomplete="Incomplete",o.Cancelled="Cancelled";class u extends Error{constructor(e,t=u.Severity.Incomplete){super(e),this.severity=t,this.severity=t}}u.Prefix="Could not toggle video because",u.Message={NoCall:"call is undefined",AlreadyRunning:"toggleVideo already running",SameValue:"value of video on call is the same as passed value",IpVideoMode:"!isIPVideoModeEnabled for user",BlockAVOverIP:"blockAVOverIPInMeetings for user",FollowMode:"call in follow mode",UserMediaService:"userMediaService failed with",ToggleVideoInternal:"toggleVideoInternal has thrown"},u.Severity={Incomplete:"Incomplete",Failure:"Failure"}},856199:function(e,t,i){i.d(t,{h:()=>k});var n,a,r=i(634504),o=i(370574),s=i(892891),l=i(945761),c=i(575810),d=i(377957),g=i(826757),h=i(167135),p=i(352320),u=i(924975),m=i(766913),_=i(654807),S=i(453842),C=i(4512),v=i(801755),f=i(395250);(n=a||(a={})).Set_InitialState="set_initial_state",n.ServerMute_Changed="server_muted_changed",n.Mute_Changed="mute_changed",n.Call_Reconnected="call_reconnected",n.Attendee_IsRestricted="attendee_restricted",n.Screensharing_Escalated_ToAudio="screensharing_escalated_audio";class b{computeMuteStateWithDetails(e){let t=e.isMuted||e.isServerMuted;e.isScreenshareFromChat&&(t=!e.isScreenshareFromChatCallEscalated||e.isMuted);let i="attendee"===e.meetingRole&&e.isAttendeeRestricted(null,!0);return{isMuted:t=t||i,isAttendeeAudioRestricted:i}}callIsOnHoldOrDisconnected(e){return e===o.CallState.LocalHold||e===o.CallState.RemoteHold||e===o.CallState.Disconnected}callIsNotOnHoldAndNotConnected(e){return e!==o.CallState.Connected&&e!==o.CallState.LocalHold&&e!==o.CallState.RemoteHold}}class y extends b{constructor(e,t,i,n,r,o){super(),this.callingService=e,this.callingSupportService=t,this.callTogglingService=i,this.utilityService=n,this.callingTelemetryService=r,this.callInitializedSet=new Set,this.peripheralsMuteServiceUnsubscribeMap=new Map,this.muteStatusUpdateNotificationsCallback=(e,t,i,n,r)=>{let o=this.callingService.getCallByCallId(t);if(!o||this.callIsNotOnHoldAndNotConnected(o.state)){this.logger.warn(`[cid=${i}][MuteOnAirV3] muteStatusUpdateNotificationsCallback: there is no active call to process the incoming notification [callId:${t}, isMuted:${e}, source:${r}]`),n?.incomplete({reasonCMD:"no_active_call"});return}let s=this.peripheralsMuteServiceUsageEnabled(),l=this.isMuteOnAirV3Enabled();if(!this.isAudioEnabled(o)||!s&&!l){this.logger.info(`[cid=${i}][MuteOnAirV3] muteStatusUpdateNotificationsCallback: ignoring the incoming notification, feature is disabled [callId:${o.callId}, isMuted:${e}, source:${r}, peripheralsMuteServiceUsageIsEnabled:${s}, isMuteOnAirV3Enabled:${l}]`),n?.incomplete({reasonCMD:"feature_disabled"}),this.setMuteStatusInternal(o,a.Set_InitialState,s,i);return}if(n&&this.setTelemetryData(n,o,e,"incoming_notification","subscription_notification",i),"attendee"===o.meetingRole&&o.isAttendeeRestricted(null,!0)){this.logger.info(`[cid=${i}][MuteOnAirV3] muteStatusUpdateNotificationsCallback: ignoring the incoming notification, attendee is restricted, sending back the mute status, to be in sync [callId:${o.callId}, isMuted:${e}, source:${r}]`),n?.incomplete({reasonCMD:"attendee_restricted"}),this.setMuteStatus(o,a.Attendee_IsRestricted,i);return}this.logger.info(`[cid=${i}][MuteOnAirV3] Received notification, now calling toggleMuteAudio [callId:${o.callId}, isMuted:${e}, source:${r}]`);let d=r?`peripherals-source-${r}`:"windows-taskbar",g={[c.gT.counters.eventNames.context]:d},h=e?u.Jn.Mute:u.Jn.Unmute;n?.mark(f.ck.TogglingMute),this.callTogglingService.toggleMuteAudio(o,u.c3.App,h,g,i,!1).then(t=>{t?.type===u.Nn.Success?(this.logger.info(`[cid=${i}][MuteOnAirV3] toggleMuteAudio called, notification was processed [callId:${o.callId}, source:${r}]`),n?.stop()):t?.type===u.Nn.Cancelled||t?.type===u.Nn.Incomplete?(this.logger.info(`[cid=${i}][MuteOnAirV3] muteStatusUpdateNotificationsCallback: CANCELLED  [callId:${o.callId}, isMuted:${e}, source:${r}]`),n?.incomplete({reasonCMD:`is_cancelled: ${t?.message}`})):t?.type===u.Nn.Error&&(this.logger.error(`[cid=${i}][MuteOnAirV3] muteStatusUpdateNotificationsCallback: toggleMuteAudio failed [callId:${o.callId}, isMuted:${e}, source:${r}]`),n?.fail({reasonCMD:`mute_on_air_helper_toggleMuteAudio_failed: ${t?.message}`}))})},this.logger=o.newLogger("MuteOnAirHelper")}init(e,t,i){this.logger.info(`[MuteOnAirV3] Initializing Mute On-Air V3 for call id=${e.callId}`);let n=this.startScenario(e,f.RG.InitializeMuteOnAir);this.muteOnAirService=t,this.peripheralsMuteService=i;let a=(0,r.Z)();try{let t=this.initializeCall(e,n,a);return n.stop({reasonCMD:t.reason,[c.gT.counters.eventNames.causeId]:a}),this.logger.info(`[MuteOnAirV3] Initialized OK for call id=${e.callId}`),t.isInitialized}catch(i){let t=i.message;t||"string"!=typeof i||(t=i),!t&&i.reason&&(t=i.reason),!t&&i.reasonCMD&&(t=i.reasonCMD),n.fail({reasonCMD:this.utilityService.scrubEuii(t),[c.gT.counters.eventNames.causeId]:a}),this.logger.error(`[cid=${a}][MuteOnAirV3] failed to initalize call [callId:${e.callId}, error:${t}]`)}return!1}registerAndWatchCall(e){if(this.logger.info(`registerAndWatchCall: callId=${e.callId}`),this.callInitializedSet.has(e.callId))return this.logger.info(`registerAndWatchCall: already initialized, skipping initialization, callId=${e.callId}`),{isInitialized:!0,reason:"already_initialized"};this.callInitializedSet.add(e.callId);let t=this.peripheralsMuteServiceUsageEnabled(),i=t?this.registerPeripheralsService(e):this.registerOnAirService(e);if(!i.isInitialized)return i;let n=e.on("serverMutedChanged",()=>{let i=(0,r.Z)();this.logger.info(`[cid=${i}] serverMuteChanged: new isServerMuted=${e.isServerMuted}, setting new mute status [callId=${e.callId}]`),this.setMuteStatusInternal(e,a.ServerMute_Changed,t,i)}),o={isSubscribed:!t,callChangedSubscription:n};return o.callStateChangedSubscription=e.on("callStateChanged",()=>this.onCallStateChanged(e,o)),{isInitialized:!0,reason:"call_initialized"}}setMuteStatus(e,t,i){this.setMuteStatusInternal(e,t,this.peripheralsMuteServiceUsageEnabled(),i)}setMuteStatusInternal(e,t,i,n){n||(n=(0,r.Z)());let a=this.startScenario(e,f.RG.MuteOnAirReportState,n),o=this.computeMuteState(e),s="attendee"===e.meetingRole&&e.isAttendeeRestricted(null,!0);this.setTelemetryData(a,e,o,t,"set_mute_status",n);try{this.logger.info(`[cid=${n}][MuteOnAirV3] setMuteStatus: sending mute=${o} [callId:${e.callId}, isMuted:${e.isMuted}, isServerMuted:${e.isServerMuted}, isScreenshareFromChat:${e.isScreenshareFromChat}, isScreenshareFromChatCallEscalated:${e.isScreenshareFromChatCallEscalated}, isAttendeeAudioRestricted:${s} usePeripheralsMuteService:${i}]`),i?this.peripheralsMuteService?.reportMuteStateChange(e.callId,o,e.isServerMuted,n):this.muteOnAirService?.reportMuteState(e.callId,o,e.isServerMuted,n)}catch(i){this.handleSetOnAirMuteException(a,e,o,i,t,"set_mute_status",n)}a.stop()}registerPeripheralsService(e){if(!this.peripheralsMuteService)return this.logger.info("[MuteOnAirV3] registerOnAirService: peripheralsMuteService is not available"),{isInitialized:!1,reason:"peripheralsMuteService_not_available"};if(!this.peripheralsMuteServiceUnsubscribeMap.has(e.callId)){let t=this.peripheralsMuteService?.subscribeToMuteEvents(e.callId,(e,t,i,n,a)=>this.muteStatusUpdateNotificationsCallback(e,n,t,a,i));this.peripheralsMuteServiceUnsubscribeMap.set(e.callId,t)}return{isInitialized:!0,reason:""}}registerOnAirService(e){return this.muteOnAirService?(this.muteOnAirService.subscribeToMuteStateUpdates(e.callId,this.muteStatusUpdateNotificationsCallback),{isInitialized:!0,reason:""}):(this.logger.info("[MuteOnAirV3] registerOnAirService: muteOnAirService is not available"),{isInitialized:!1,reason:"muteOnAirService_not_available"})}onCallStateChanged(e,t){if(this.callIsOnHoldOrDisconnected(e.state)){if(t.isSubscribed&&(this.muteOnAirService?.unsubscribeFromMuteStateUpdates(e.callId),t.isSubscribed=!1),e.state===o.CallState.Disconnected){this.logger.info(`[MuteOnAirV3] Call disconnected, unsubscribing, call id=${e.callId}`),t.callStateChangedSubscription?.dispose(),t.callChangedSubscription.dispose(),this.callInitializedSet.delete(e.callId);let i=this.peripheralsMuteServiceUnsubscribeMap.get(e.callId);i&&(i(),this.peripheralsMuteServiceUnsubscribeMap.delete(e.callId))}}else e.state===o.CallState.Connected&&(this.logger.info(`[MuteOnAirV3] Call becomes connected again, subscribing for notifications and reporting mute state, call id=${e.callId}`),this.peripheralsMuteServiceUsageEnabled()||(this.muteOnAirService?.subscribeToMuteStateUpdates(e.callId,this.muteStatusUpdateNotificationsCallback),t.isSubscribed=!0),this.setMuteStatus(e,a.Call_Reconnected,(0,r.Z)()))}isAudioEnabled(e){let t=this.callingSupportService.isIPAudioModeEnabledForCall(e),i=this.callingSupportService.isPrivateCallingEnabled,n=e.isScreenshareFromChat?i:t;return n||this.logger.info("[MuteOnAirV3] Feature disabled: IPAudioModeEnabled policy disabled for meetings or private calling disabled"),n}isMuteOnAirV3Enabled(){return!!this.callingSupportService.isMuteOnAirV3Enabled()&&(this.muteOnAirService?!!this.muteOnAirService.isServiceInitialized()||(this.logger.warn("[MuteOnAirV3] muteOnAirService is not initialized"),!1):(this.logger.warn("[MuteOnAirV3] muteOnAirService is not available"),!1))}peripheralsMuteServiceUsageEnabled(){return!!(this.peripheralsMuteService&&this.callingSupportService.isPeripheralsMuteServiceUsageEnabled())}initializeCall(e,t,i){let n=this.registerAndWatchCall(e);return t.mark(f.ck.RegisteredCall),this.setMuteStatus(e,a.Set_InitialState,i),t.mark(f.ck.SetInitialStatus),n}computeMuteState(e){let{isMuted:t}=this.computeMuteStateWithDetails(e);return t}handleSetOnAirMuteException(e,t,i,n,a,r,o){this.setTelemetryData(e,t,i,a,r,o,n),e.fail()}startScenario(e,t,i){let n={[c.gT.counters.eventNames.callId]:e.callId,[c.gT.scenarios.calling.muteOnAir.data.muteOnAirVersion]:"V3",[c.gT.counters.eventNames.causeId]:i};return this.callingTelemetryService.newCallingScenario(e.teamsCallId,t,n)}setTelemetryData(e,t,i,n,a,r,o){let s=o?this.utilityService.getErrorLoggingString(o):"",l="attendee"===t.meetingRole&&t.isAttendeeRestricted(null,!0);o?this.logger.error(`[cid=${r}][MuteOnAirV3] setTelemetryData ERROR: setMuteStatus failed due ${s} [isMuted=${i}, operation:${a}, callId:${t.callId}, isMuted:${t.isMuted}, isServerMuted:${t.isServerMuted}, isScreenshareFromChat:${t.isScreenshareFromChat}, isScreenshareFromChatCallEscalated:${t.isScreenshareFromChatCallEscalated}, isAttendeeAudioRestricted:${l}, context:${n}]`):this.logger.info(`[cid=${r}][MuteOnAirV3] setTelemetryData: setMuteStatus [mute:${i}, operation:${a}, callId:${t.callId}, isMuted:${t.isMuted}, isServerMuted:${t.isServerMuted}, isScreenshareFromChat:${t.isScreenshareFromChat}, isScreenshareFromChatCallEscalated:${t.isScreenshareFromChatCallEscalated}, isAttendeeAudioRestricted:${l}, context:${n}]`);let d={[c.gT.counters.eventNames.context]:n,[c.gT.counters.eventNames.operation]:a,[c.gT.counters.eventNames.callId]:t.callId,isMuted:i,"call.isMuted":t.isMuted,"call.isServerMuted":t.isServerMuted,"call.isScreenshareFromChat":t.isScreenshareFromChat,"call.isScreenshareFromChatCallEscalated":t.isScreenshareFromChatCallEscalated,[c.gT.counters.eventNames.causeId]:r,isAttendeeAudioRestricted:l,reasonCMD:s};e.appendEventData(d)}}class T extends b{constructor(e,t,i,n,a){super(),this.togglingService=t,this.callingService=i,this.eventingService=n,this.airpodsControlHelper=a,this.registeredCalls=new Set,this.logger=e.newLogger("AirpodsHelper")}setMuteStatus(e,t,i){if(this.airpodsControlHelper){i||(i=(0,r.Z)());let n=this.callingService.getCallByCallId(e.callId);if(!n||this.callIsOnHoldOrDisconnected(e.state))return void this.logger.info(`[cid=${i}] not setting mute status as call is on hold or disconnected [callId:${e.callId}]`);let a=this.computeMuteStateWithDetails(n);this.logger.log(`[cid=${i}] Setting mute state isMuted: ${a.isMuted} isAttendeeAudioRestricted: ${a.isAttendeeAudioRestricted} [callId: ${n.callId}, context: ${t}]`),this.airpodsControlHelper.reportMuteState(n.callId,a.isMuted,a.isAttendeeAudioRestricted,i)}}registerAndWatchCall(e){let t;if(!this.airpodsControlHelper)return void this.logger.warn(`registerAndWatchCall: airpodsControlHelper is not available for callId=${e.callId}`);if(this.registeredCalls.has(e.teamsCallId))return void this.logger.info(`registerAndWatchCall: call already watched callId=${e.callId} teamsCallId=${e.teamsCallId}`);this.logger.info(`registerAndWatchCall: callId=${e.callId}`);let i=this.airpodsControlHelper.subscribe((t,i)=>{let n=this.callingService.getCallByCallId(e.callId);if(!n||this.callIsOnHoldOrDisconnected(n.state))return void this.logger.info(`[cid=${i}] muteStatusUpdateNotificationsCallback: there is no active call to process the incoming notification, to be muted=${t} [callId=${e.callId}]`);this.togglingService.toggleMuteAudio(n,u.c3.App,t?u.Jn.Mute:u.Jn.Unmute,{[c.gT.counters.eventNames.context]:"airpods-helper"},i,!1).then(r=>{r.type===u.Nn.Error&&(this.logger.error(`[cid=${i}] muteStatusUpdateNotificationsCallback: failed to toggle mute, to be muted=${t}, error=${r.message} [callId:${e.callId}]`),this.setMuteStatus(n,a.Attendee_IsRestricted,i))})}),n=this.eventingService.registerHandlerForExternalEvent("callParticipantModalityRestrictionsChanged",()=>{let{isAttendeeAudioRestricted:i}=this.computeMuteStateWithDetails(e);if(t===i)return;t=i;let n=(0,r.Z)();this.logger.info(`[cid=${n}] callParticipantModalityRestrictionsChanged: setting new mute status [callId:${e.callId}]`),this.setMuteStatus(e,a.Attendee_IsRestricted,n)}),s=e.on("serverMutedChanged",()=>{let t=(0,r.Z)();this.logger.info(`[cid=${t}] serverMuteChanged: isServerMuted=${e.isServerMuted}, setting new mute status [callId:${e.callId}]`),this.setMuteStatus(e,a.ServerMute_Changed,t)}),l=e.on("callStateChanged",()=>{e.state===o.CallState.Disconnected?(this.registeredCalls.delete(e.teamsCallId),l.dispose(),s.dispose(),n(),i()):e.state===o.CallState.Connected&&this.setMuteStatus(e,a.Call_Reconnected,(0,r.Z)())});this.registeredCalls.add(e.teamsCallId),this.setMuteStatus(e,a.Set_InitialState,(0,r.Z)())}}var I=i(200669);class A extends b{constructor(e,t,i){super(),this.togglingService=t,this.callingService=i,this.registeredCalls=new Set,this.logger=e.newLogger("MinorRecordingMuteHelper")}registerAndWatchCall(e){if(this.registeredCalls.has(e.teamsCallId))return void this.logger.info(`registerAndWatchCall: call aready watched callId=${e.callId} teamsCallId=${e.teamsCallId}`);this.logger.info(`registerAndWatchCall: callId=${e.callId}`);let t=e.on(c.fL.RECORDING_STATUS_CHANGED,()=>{let t=(0,r.Z)();if(e.getRecordingStatus()===I.MN.recording){if(!this.togglingService.isMinorRecordingRestrictedWhenRecording())return;let i=this.callingService.getCallByCallId(e.callId);this.logger.info(`[cid=${t}] Recording Status changed: recording started, muting client [callId:${e.callId}]`),this.togglingService.toggleMuteAudio(i,u.c3.App,u.Jn.Mute,{[c.gT.counters.eventNames.context]:"minor-recording-mute-helper"},t,!0).then(i=>{i.type===u.Nn.Error&&this.logger.error(`[cid=${t}] Failed to mute client during recording start, error=${i.message} [callId:${e.callId}]`)})}}),i=e.on("callStateChanged",()=>{e.state===o.CallState.Disconnected&&(this.registeredCalls.delete(e.teamsCallId),i.dispose(),t.dispose())});this.registeredCalls.add(e.teamsCallId)}}class E extends b{constructor(e,t,i,n,a){super(),this.callingService=t,this.callingSupportService=i,this.dialingService=n,this.supportedThirdPartyMeetingDTMFCodesForSipJoin=a,this.logger=e.newLogger("SipDTMFHelper"),this.logger.log(`Sip Join for DGJ flag value = ${this.callingSupportService.isSipOverDGJEnabled()} `)}sendDTMFtoToggleMuteUnmute(e,t){let i=this.callingService.getCallByCallId(e.callId);if(this.logger.log(`Mute Button pressed, Feature enabled = ${this.callingSupportService.isSipOverDGJEnabled()} and ${this.callingSupportService.isSipDirectDTMFEnabled()},Sip Meeting URL= ${i.sipMeetingUrl}, Meeting CorrelationId = ${i.sipMeetingCorrelationId},Meeting Type = ${i.sipMeetingType}`),i.callType===o.CallType.P2P&&this.callingSupportService.isSipOverDGJEnabled()&&this.callingSupportService.isSipDirectDTMFEnabled()){if(!i||this.callIsOnHoldOrDisconnected(i.state))return void this.logger.info(`[causeId=${t}] not setting DTMF as call is on hold or disconnected, callId=${i.callId}`);for(let e of this.supportedThirdPartyMeetingDTMFCodesForSipJoin)if(e.meetingType===i.sipMeetingType){this.dialingService.sendDtmf(i,e.muteUnmuteToggle||""),this.logger.log(`[${t}] Setting DTMF callId: ${i.callId} with dtmf value = ${e.muteUnmuteToggle}`);break}let e=this.computeMuteStateWithDetails(i);this.logger.log(`[${t}] Setting mute state callId: ${i.callId} isMuted: ${e.isMuted}`)}else this.logger.log(`[${t}] Not sending DTMF for callId: ${i.callId} because Call Type ${i.callType}  `)}}var M=i(488444);let P="media device is already used by another process";class k{constructor(e,t,i,n,a,s,c,d,g,h,p,m,_,S,v,b,I,P,k,D=!0,R=l.Wq){this.config=e,this.callingTelemetryService=t,this.callingAgentsService=i,this.callingService=n,this.timeout=a,this.getUserMediaService=s,this.eventingService=c,this.deviceManagerService=d,this.utilityService=p,this.desktopUtilityService=m,this.callPropsStoreService=_,this.callingSupportService=S,this.serviceProvider=v,this.mtmaSubscriptionUtility=b,this.asObservable=I,this.helpers=P,this.slimcoreEcsConfigService=k,this.promiseFactory=R,this.dismissedUnmutingLongerAlerts=["MicMutedRemotely","SpeakerAndMicUnmuted","ContentOnlyAlert","ContentOnlyFromNudgeAlert"],this.changingAudioForCall=new Set,this.changingVideo=!1,this.holdPromiseMap={},this.callsWithIncomingVideo={},this.callListenerMap={},this.muteChangedListeners={},this.serverMutedChangedListeners={},this.serverUnmuteSelfRunningScenarioMap={},this.muteSelfRunningScenarioMap={},this.unmuteSelfRunningScenarioMap={},this.muteSpeakerScenarioMap={},this.unmuteSpeakerScenarioMap={},this.promotionScenarioMap={},this.previousLocalMuteState={},this.callMicMuteCache={},this.persistUnmuteStateOnDevicesChanged=!1,this.enableCameraSharing=!1,this.enableContentCameraBasedIngest=!1,this.enableAudioEscalationUX=!1,this.persistentVideoBackgroundEnabled=!1,this.localVideoFailureSubscriptions=new Map,this.delayedMutePendingHandlers=new Map,this.lastMuteStateChangeForCall=new Map,this.inLobbyVideoToggleMetaForCallId=new Map,this.lastMuteAudioCauseIdForCall=new Map,this.checkCanEnableVideo=async e=>{let t=await this.deviceManagerService.getCameraAvailable(),i=!!this.deviceManagerService.getSelectedDevices().camera;if(!t||!i)throw Error(`No camera available hasCamera:${t} hasSelectedCamera:${i}`);if(!this.callingSupportService.isIpVideoAllowedByCapability(e))throw Error("Video is not allowed by capability");if(e.isEmergencyCall)throw Error("Video is not allowed for emergency call");let n=await this.callingSupportService.isPstnCallingAllowedAsync();if(e.isScreenshareFromChat&&!n)throw Error("Screen share from chat and PSTN is disabled");if("attendee"===e.meetingRole&&e.isAttendeeRestricted("",!0,M.p.Video))throw Error("Attendee with video restricted");if(e.isWatermarkEnabled&&!this.callingSupportService.isWatermarkAllowed(e))throw Error("Video is disabled for audio only");if(e.state===o.CallState.RemoteHold||e.state===o.CallState.LocalHold)throw Error("Video is disabled for hold state")},this.getToggleMutePromise=async(e,t,i,n,a)=>{let r=u.Nn.Success,o=`[cid=${a}] ${t} [callId: ${e?.callId}]`;return i&&(r=u.Nn.Error,this.logger.error(o)),n&&(r=u.Nn.Incomplete,this.logger.warn(o)),{id:a,message:t,type:r}},this.updateHigherFrameRateVideoConfiguration=async(e,t,i,n)=>{if(e&&t&&i?.setVideoMidcallConfigJson)try{await i.setVideoMidcallConfigJson({signer:!0}),this.logger.log(`(slm) setVideoMidcallConfigJson marked as signer callId: ${i.callId}, causeId: ${(0,r.Z)()}`)}catch(e){n?.mark(f.ck.UpdateHigherFrameRateConfigFailed),this.logger.error(`(slm) setVideoMidcallConfigJson unable to mark me as signer. Error: ${e.message}, callId: ${i.callId}, causeId: ${(0,r.Z)()}`)}},this.handleSignLanguageDetection=async(e,t,i)=>{if(e.isDHHSigner)try{await this.deviceManagerService.enableSignLanguageDetectionAsync({shouldStartSignLanguageDetection:t}),t||e.sendStopSignLanguageSignal()}catch(t){i?.mark(f.ck.MarkSignerFailure),this.logger.error(`(slm) handleSignLanguageDetection(${e.isDHHSigner}) failed with an error: ${t.message||t}, callId: ${e.callId}, causeId: ${(0,r.Z)()}`)}},this.logger=h.newLogger("CallTogglingService"),this.loggingService=h,this.muteOnAirHelper=new y(this.callingService,this.callingSupportService,this,this.utilityService,this.callingTelemetryService,this.loggingService),this.airpodsHelper=new T(h,this,this.callingService,this.eventingService,this.callingSupportService.isAirPodsControlEnabled?.()?this.serviceProvider.airpodsService?.():void 0),this.sipDTMFHelper=new E(h,this.callingService,this.callingSupportService,g,this.config.supportedThirdPartyMeetingDTMFCodesForSipJoin()),D&&this.initializeOnAppLaunchAndReinit(),this.minorRecordingMuteHelper=new A(h,this,this.callingService);let w=this.config.localizedAlerts.micUnmuteThrottled();this.micUnmuteThrottledAlert={dismissable:!0,type:C.NK.Warning,name:"MicUnmuteThrottled",title:w.title,text:w.content,ariaText:w.content};let F=this.config.localizedAlerts.defaultLocalVideoError();this.defaultLocalVideoErrorAlert={dismissable:!0,type:C.NK.Info,name:"DefaultLocalVideoErrorAlert",title:F.title,text:F.content,ariaText:F.content}}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}setIsAudiolessModeEnabled(e,t){return(t?e.stopAudio():e.startAudio()).then(e=>{if(e?.code!==0){let i=`setIsAudiolessModeEnabled isAudiolessModeEnabled: ${t} failed with status code ${e?.code}`;throw this.logger.errorToTelemetry?.(i,"callTogglingServiceSetIsAudiolessModeEnabled"),Error(i)}return t})}initializeOnAppLaunchAndReinit(e){this.isPluginless=this.desktopUtilityService.isPluginless(),this.serverUnmutingTimeout=this.config.serverUnmutingTimeout()||5e3,this.isWindowsOSPlatform=this.config.isWindowsOSPlatform(),this.enableConfirmAudioEscalation=this.config.isConfirmAudioEscalationEnabled(),this.enableAudioEscalationUX=this.config.isAudioEscalationUXEnabled(),this.persistentVideoBackgroundEnabled=this.config.isPersistentVideoBackgroundEnabled(),this.enableMuteXLMeetingLatencyUX=this.config.isMuteXLMeetingLatencyUXEnabled(),this.isOSUnmuteEnabled=this.config.isOSUnmuteEnabled&&this.config.isOSUnmuteEnabled(),this.isUnmuteOSNotAllowedUFDDisabled=this.config.isUnmuteOSNotAllowedUFDDisabled&&this.config.isUnmuteOSNotAllowedUFDDisabled(),this.isWindowsOSPlatform&&!this.isPluginless&&(this.devicesChangedSubscription=this.mtmaSubscriptionUtility.subscribe(this.deviceManagerService,this.onDevicesChanged.bind(this),c.gT.events.calling.devicesChanged)),this.isPluginless||(this.enableCameraSharing=this.config.isCameraSharingEnabled()||this.config.isMagicWhiteboardForLaptopEnabled()),this.eventingService.registerHandlerForExternalEvent(c.gT.events.calling.callEscalatedFromContentOnly,e=>{this.callPropsStoreService.set(e.teamsCallId,S.l.PstnDialogDismissed,!0)}),this.enableContentCameraBasedIngest=this.config.isRigelContentCameraBasedIngestEnabled(),this.micUnmuteTakesLongerTime={dismissable:!0,type:C.NK.Info,name:"MicUnmuteTakesLongerTime",text:this.config.localizedAlerts.micUnmuteTakesLongerTime(),isAffirmational:!0},this.disableIncomingMeetingAudio={name:"DisableIncomingMeetingAudio",text:this.config.localizedAlerts.disableIncomingMeetingAudio(),type:C.NK.Info,dismissable:!0,timeout:v.L3,windowType:C.MA.CallingFooter},this.enableIncomingMeetingAudio={name:"EnableIncomingMeetingAudio",text:this.config.localizedAlerts.enableIncomingMeetingAudio(),type:C.NK.Info,dismissable:!0,timeout:v.L3,windowType:C.MA.CallingFooter},this.cameraUnmuteTakesLongerTime={dismissable:!0,type:C.NK.Info,name:"CameraUnmuteTakesLongerTime",text:this.config.localizedAlerts.cameraUnmuteTakesLongerTime(),isAffirmational:!0},this.localVideoFailureSubscriptions=new Map}cleanupOnAppTeardown(e){this.isPluginless=void 0,this.changingAudioForCall.clear(),this.changingSpeakerAudio=void 0,this.changingVideo=!1,this.holdPromiseMap={},this.callsWithIncomingVideo={},this.callListenerMap={},this.muteChangedListeners={},this.serverMutedChangedListeners={},this.serverUnmuteSelfRunningScenarioMap={},this.muteSelfRunningScenarioMap={},this.unmuteSelfRunningScenarioMap={},this.muteSpeakerScenarioMap={},this.unmuteSpeakerScenarioMap={},this.promotionScenarioMap={},this.previousLocalMuteState={},this.unmutingTimeoutId=void 0,this.isWindowsOSPlatform=void 0,this.unholdCallDefer=void 0,this.serverUnmutingTimeout=void 0,this.isOSUnmuteEnabled=void 0,this.isUnmuteOSNotAllowedUFDDisabled=void 0,this.callMicMuteCache={},this.persistUnmuteStateOnDevicesChanged=!1,this.devicesChangedSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.devicesChangedSubscription),this.devicesChangedSubscription=void 0),this.enableCameraSharing=!1,this.enableContentCameraBasedIngest=!1,this.enableConfirmAudioEscalation=!1,this.enableAudioEscalationUX=!1,this.persistentVideoBackgroundEnabled=!1,this.enableMuteXLMeetingLatencyUX=!1,this.disableIncomingMeetingAudio=void 0,this.enableIncomingMeetingAudio=void 0,this.micUnmuteTakesLongerTime=void 0,this.localVideoFailureSubscriptions.forEach(e=>e.subscription.dispose()),this.localVideoFailureSubscriptions.clear()}isMuted(e){return this.isInLobby(e)?e.isMuted:e.isMuted||e.isServerMuted}resetIsMutePending(e){e.isMutePending&&this.setIsMutePending(e,!1)}toggleMuteAudio(e,t=u.c3.App,i,n,a,o,s=!1){let l=n?.context||"no context provided";if(this.logger.info(`[cid=${a}][ctx=${l}][opid=${i===u.Jn.Mute?"MuteAudio":"UnmuteAudio"}] ${i===u.Jn.Mute?"Mute":"Unmute"} attempt`),!e)return this.getToggleMutePromise(e,"Call is undefined.",!0,!1,a);let c=this.getDisconnectedCallReason(e);if(c)return this.getToggleMutePromise(e,c,!1,!0,a);if(e.isMutePending)return this.getToggleMutePromise(e,`${k.ScenarioReasons.already_running} mutePending`,!1,!0,a);let d=a||(0,r.Z)();n={...n,causeId:d,callId:e.callId};let g=this.shouldMuteCall(e,i),h=this.newMuteUnmuteScenario(e,g,n),p=this.executeInitialAudioTogglingChecks(e,g,i,s,a,h);if(p)return p;if(e.isScreenshareFromChat){let t=this.loggingService.findScenario(e.isServerMuted&&i===u.Jn.Unmute?f.RG.ToggleServerUnmuteLatency:f.RG.ToggleMuteLatency)||void 0;return this.escalateScreenshareOnCall(e,h,n,a,t)}if(!o&&!g&&this.enableConfirmAudioEscalation&&e.isContentOnlyMode&&t===u.c3.OS&&"ufd-devices"===n.context){let t="ignore OS unmute in content-only mode";return this.logger.info(`[cid=${a}] ${t} [callId: ${e.callId}]`),h.incomplete({reason:t}),this.getToggleMutePromise(e,t,!1,!0,a)}return this.toggleMuteAudioCommon(e,t,d,g,i,n)}async toggleSpeaker(e,t,i,n){if(!e){let e=`[cid=${i}] Call is undefined!`;throw this.logger.error(e),Error(e)}let a=i||(0,r.Z)();n={...n,causeId:i};let o=this.newMuteUnmuteSpeakerScenario(e,t,n);if(this.changingSpeakerAudio){let t=`${k.ScenarioReasons.already_running} toggleSpeaker`;o.incomplete({reason:t}),this.logger.warn(`[cid=${i}] toggleSpeaker ${t} [callId: ${e.callId}]`);return}try{this.changingSpeakerAudio=this.toggleSpeakerInternal(e,t,o,a),await this.changingSpeakerAudio}finally{this.changingSpeakerAudio=void 0}}async toggleVideo(e,t,i,n,a,r=!1,s){if(this.logger.info(`[cid=${i}][ctx=${t}] Toggle video called with videoOn:${n} [callId: ${e.callId}, shouldSendHigherFrameRateVideo: ${s}]`),!e)return void a?.incomplete({reason:u.Yy.Message.NoCall});if(this.changingVideo)return;e.isVideoPreviewOn=void 0===n?!e.isVideoOn:n;let l=this.config.enableParallelVideoPreview();if(e.isVideoPreviewOn&&l&&this.trigger(c.gT.events.calling.mutePending,d.w.getTeamsCallIdAsString(e.teamsCallId)),this.handleVideoToggleInLobby(e,t,i,n,a,r,s))return;let g=e.getTagForMediaStartOperation(o.MediaType.Video);this.logger.info(`[cid=${i}][ctx=${t}] Toggling video to ${n} [callId: ${e.callId}, negotiationTag: ${g}]`);let h=this.utilityService.generateUUID();a?.appendEventData({correlationId:h,negotiationTag:g,enableParallelVideoPreview:l,callId:e.callId,participantId:e.participantId,callType:e.callType});let p=this.newCallDevicePermissionsScenario(e,c.gT.scenarios.calling.video,void 0,void 0,{correlationId:h});try{await this.toggleVideoWithInternalChecks(e,t,r,g,h,p,i,n,a,s)}catch(r){this.logger.log(`[cid=${i}] resetting isVideoPreviewOn from ${e.isVideoPreviewOn} to ${e.isVideoOn}`),e.isVideoPreviewOn=e.isVideoOn;let t=`${u.Yy.Prefix} ${r.message}`,n=`[cid=${i}] ${t}`;switch(r.severity){case u.Yy.Severity.Incomplete:this.logger.warn(n),p.incomplete({reason:t}),a?.incomplete({reason:r.message});break;case u.Yy.Severity.Failure:this.logger.error(n),p.fail({reason:t}),a?.fail({reason:r.message});break;default:this.logger.info(n)}throw Error(t)}}isCameraSharingEnabled(){return this.enableCameraSharing}toggleVideoSharing(e,t,i,n=u.WR.Whiteboard,a,r){if(this.logger.info(`[cid=${i}][ctx=${t}] Toggle video sharing called [cameraType: ${n}, cameraId: ${a}]`),n===u.WR.Whiteboard&&!this.enableCameraSharing||n===u.WR.HdmiIngest&&!this.enableContentCameraBasedIngest)return this.promiseFactory.resolve();let o=this.promiseFactory.createDeferred(),s=this.newCallDevicePermissionsScenario(e,c.gT.scenarios.calling.video),l=!e.isVideoOn;return(l?this.getUserMediaService.showGetUserMediaDialogIfNeeded("video",i):this.promiseFactory.resolve(this.getUserMediaService.hideGetUserMediaDialog("video",i))).then(()=>{s.stop(),this.toggleVideoSharingInternal(e,t,n,a).then(e=>o.resolve()).catch(e=>(r?.fail({reason:e.message}),o.reject(e)))},e=>{r?.fail({reason:e.message}),s.incomplete({reason:"canceled"}),this.logger.error(`Turn video ${l?"on":"off"} failed with error ${e}`),o.reject(e)}),o.promise}toggleHold(e,t,i,n,a){if(this.holdPromiseMap[e.teamsCallId]&&!i)return this.holdPromiseMap[e.teamsCallId];let r=i?i===u.nt.Hold:e.state!==o.CallState.LocalHold,s=this.callingTelemetryService.newHoldResumeCallScenario(e,t,r,i?"forced":"");if(r)if(e.isScreenshareFromChat||e.isImmersiveEvent){let t=e.isScreenshareFromChat?"End ScreenshareOnly Call":e.isImmersiveEvent?c.gT.leaveCallContexts.immersiveEventOnHold:"End Call",i={clientSubCode:e.isImmersiveEvent?h.VM.ImmersiveEventOnHold:void 0,clientPhrase:t};this.holdPromiseMap[e.teamsCallId]=this.endCall(e,t,i)}else this.holdPromiseMap[e.teamsCallId]=this.holdCall(e,a);else this.holdPromiseMap[e.teamsCallId]=this.unholdCall(e);let l=this.callingService.getAllCalls();return this.isWindowsOSPlatform&&l&&this.enforceMuteSourceAsApp(),this.promiseFactory.finalized(this.holdPromiseMap[e.teamsCallId].then(()=>{s.stop(),n&&n.stop(),this.config.hooks.onCallHoldToggled(r,e.isScreenshareFromChat)}).catch(i=>(i===c.gT.promiseState.aborted?(n&&n.stop(),s.cancel()):(this.logger.error(`Could not hold or resume call in state=${e.state} error=${i} callId=${e.callId}, context=${t}`),this.callingTelemetryService.isCallAbandoned(i)||this.callingTelemetryService.isActionNotAllowed(i)?s.cancel():s.fail({errorInfo:this.utilityService.getErrorLoggingString(i)})),this.promiseFactory.reject(i))),()=>{delete this.holdPromiseMap[e.teamsCallId]})}isHoldStateChangingForCall(e){return!!this.holdPromiseMap[e]}isHoldStateChanging(){return!(0,s.isEmpty)(this.holdPromiseMap)}isIncomingVideoOn(e){return!(!this.callingSupportService.isIPVideoModeEnabledForCall(e)||e.isFollowMode())&&(!(0,s.has)(this.callsWithIncomingVideo,e.teamsCallId)||this.callsWithIncomingVideo[e.teamsCallId])}toggleIncomingVideo(e,t){e.isFollowMode()||((0,s.has)(this.callsWithIncomingVideo,e.teamsCallId)?this.callingSupportService.isIPVideoModeEnabledForCall(e)||this.callsWithIncomingVideo[e.teamsCallId]?this.callsWithIncomingVideo[e.teamsCallId]=!this.callsWithIncomingVideo[e.teamsCallId]:this.logger.info("not turning on incoming video for call callId=${call.callId} because IPVideoMode is disabled"):(this.callsWithIncomingVideo[e.teamsCallId]=!!t,this.ensureCallListenerExists(e)),this.trigger(k.isIncomingVideoChanged,d.w.getTeamsCallIdAsString(e.teamsCallId)))}turnOffSpeakerAndMicAudio(e,t,i){return this.logger.info(`[cid=${i}] turnOffSpeakerAndMicAudio called [callId: ${e.callId}]`),Promise.all([this.isMuted(e)?this.promiseFactory.resolve():this.toggleMuteAudio(e,u.c3.App,u.Jn.Mute,{[c.gT.counters.eventNames.context]:t},i),this.toggleSpeaker(e,!0,i,{[c.gT.counters.eventNames.context]:t})]).then(()=>{e.isSpeakerMuted&&e.isMuted&&(e.isContentOnlyMode=!0,this.trigger(k.Type_ContentOnlyModeChanged,d.w.getTeamsCallIdAsString(e.teamsCallId))),this.enableAudioEscalationUX&&!this.helpers.isReconciledPstnParticipant(e)&&this.config.hooks.onRaiseContentOnlyAlert(e)})}toggleNoiseSuppressionMode(e,t,i){if(this.deviceManagerService.getNoiseSuppressionSupport()==m.tH.None)return this.promiseFactory.reject("Noise Suppression support is not available.");let n={valueToBeSet:t,[c.gT.counters.eventNames.context]:i},a=this.callingTelemetryService.newCallingScenario(e,f.RG.CallNSMidCallSetSetting,n),r=this.promiseFactory.createDeferred(),o=e=>{let t=`[toggleNoiseSuppression] failed [error=${this.utilityService.getErrorLoggingString(e)}]`;a.fail({errorCMD:t}),r.reject(e)};return e.setAudioMidcallConfigJson({noiseSuppressionMode:t}).then(()=>{a.stop(),r.resolve()}).catch(o),r.promise}monitorMuteOnAir(e){this.airpodsHelper.registerAndWatchCall(e),this.minorRecordingMuteHelper.registerAndWatchCall(e),this.trackMuteChangesMetaData(e),this.muteOnAirHelper.init(e,this.serviceProvider.muteOnAirService?.(),this.serviceProvider.peripheralsMuteService?.())}monitorLocalVideo(e){this.updateLocalVideoFailuresSubscriptions(e)}cleanupCall(e){this.unsubscribeFromLocalVideoFailures(e)}toggleOptimizedPerfMode(e,t,i){let n={valueToBeSet:t,[c.gT.counters.eventNames.context]:i},a=this.callingTelemetryService.newCallingScenario(e,f.RG.CallOPMMidCallSetSetting,n);this.logger.info(`toggleOptimizedPerfMode: ${t} for call ${e.callId} context ${i}`);let r=g.eU.getOpmMode(t),o=this.promiseFactory.createDeferred(),s=()=>{a.stop(),this.logger.info(`[toggleOptimizedPerfMode]: ${t} set for call ${e.callId} context ${i}`),o.resolve()},l=e=>{let t=`[toggleOptimizedPerfMode] failed [error=${this.utilityService.getErrorLoggingString(e)}]`;a.fail({errorCMD:t}),o.reject(e)};return e.setAudioMidcallConfigJson({opmMode:r}).then(()=>{e?.setVideoMidcallConfigJson&&e.setVideoMidcallConfigJson({opmMode:r}).then(s)}).catch(l),o.promise}isMinorRecordingRestrictedWhenRecording(){return this.config.isMinorRestrictedWhenRecording()}trigger(e,t,i){return this.asObservable.trigger(e,t,i)}showXLMeetingMuteUXLatency(e){return!this.desktopUtilityService.isPluginless()&&this.enableMuteXLMeetingLatencyUX&&"nonInteractive"===this.callingSupportService.getAppliedInteractivityLevel(e)}isCallInDesiredMuteState(e,t,i){return!!t&&!e.isScreenshareFromChat&&(t===u.Jn.Mute&&this.isMuted(e)||t===u.Jn.Unmute&&!this.isMuted(e))&&!i}shouldMuteCall(e,t){return t?t===u.Jn.Mute:!this.isMuted(e)}getToggleAudioErrorMsgAndReason(e,t,i,n){if(!t&&this.shouldRestrictUnmuteIfMinorRecorded(e))return{errMsg:"Cannot unmute because the call is being recorded and user is a minor",reason:k.ScenarioReasons.minor_recording_no_consent};if(this.isMuted(e)&&!t&&e.checkExplicitRecordingConsent("Mic"))return{errMsg:"Cannot unmute because recording consent is required but not given",reason:k.ScenarioReasons.recording_consent_required_but_not_given};if(this.callingSupportService.blockAVOverIPInMeetings())return{errMsg:"Cannot mute/unmute since AVOverIP is blocked",reason:k.ScenarioReasons.block_av_over_ip};if(!this.callingSupportService.isIPAudioModeEnabledForCall(e))return{errMsg:"Cannot mute/unmute because of IPAudioMode policy",reason:k.ScenarioReasons.ip_audio_mode};if("attendee"===e.meetingRole&&e.isAttendeeRestricted(null,!0))return{errMsg:"Ignored mute/unmute action since user is hard-muted",reason:k.ScenarioReasons.attendee_audio_restricted};if(e.isScreenshareFromChat&&!this.callingSupportService.isPrivateCallingEnabled)return{errMsg:"Ignored mute/unmute action since user is in SSFC call with Private Calling policy disabled",reason:k.ScenarioReasons.allow_private_calling_in_SSFC};if(e.isFollowMode())return{errMsg:"Cannot unmute while in follow mode",reason:k.ScenarioReasons.follow_mode};if(this.changingAudioForCall.has(e.teamsCallId)){let e=this.muteToString(t),i=`${k.ScenarioReasons.already_running} ${e}`;return{errMsg:i,reason:i}}if(this.isCallInDesiredMuteState(e,i,n)){let e=this.muteToString(t);return{errMsg:`Ignored ${e} action since the call is already ${e}d`,reason:k.ScenarioReasons.call_already_in_state+e}}}executeInitialAudioTogglingChecks(e,t,i,n,a,r){if(this.persistUnmuteStateOnDevicesChanged){this.logger.info(`[cid=${a}] Devices changed. Persisting mute state. [callId: ${e.callId}]`);let t=k.ScenarioReasons.devices_changed;return r.incomplete({reason:t}),this.getToggleMutePromise(e,t,!1,!0,a)}let o=this.getToggleAudioErrorMsgAndReason(e,t,i,n);if(o){let{errMsg:t,reason:i}=o;return r.incomplete({reason:i}),this.getToggleMutePromise(e,t,!1,!0,a)}}async toggleSpeakerInternal(e,t,i,n){try{let a=this.serviceProvider.callingAlertsService();if(this.isPluginless||t||!a.isSpeakerHWMuted||(this.logger.info(`[toggleSpeaker] executing HW speaker unmute for call ${e.callId} causeId: ${n}`),await this.callingAgentsService.unmuteSpeaker(n)),t===e.isSpeakerMuted){let a=`already ${this.muteToString(t)}d`;i.incomplete({reason:a}),this.logger.warn(`[toggleSpeaker] ${a} - causeId: ${n}, callId: ${e.callId}`);return}this.logger.info(`[toggleSpeaker] toggling speaker shouldMute:${t} for call ${e.callId} causeId: ${n}`),await (t?e.muteSpeaker(n):e.unmuteSpeaker(n));let r=d.w.getTeamsCallIdAsString(e.teamsCallId);e.isContentOnlyMode&&(e.isContentOnlyMode=!1,this.trigger(k.Type_ContentOnlyModeChanged,r)),e.isSpeakerMuted?(a.dismiss(this.enableIncomingMeetingAudio),a.handleOnDemandAlert(this.disableIncomingMeetingAudio)):(a.dismiss(this.disableIncomingMeetingAudio),a.handleOnDemandAlert(this.enableIncomingMeetingAudio)),i.stop(),this.trigger(k.Type_CallTogglingCallMuteChanged,r),this.logger.info(`[toggleSpeaker] speaker toggled to shouldMute:${t} for call ${e.callId} causeId: ${n}`)}catch(l){let{toggleMuteResult:a,eventData:o}=this.parseToggleMuteError(l,t,(0,r.Z)()),s=`[toggleSpeaker] finished with ${a.type} message: ${a.message} callId: ${e.callId} causeId: ${n}`;if(a.type===u.Nn.Incomplete){this.logger.warn(s),i?.incomplete(o);return}throw a.type===u.Nn.Timeout?(this.logger.warn(s),i?.stop(o,void 0,"timeout")):(this.logger.error(s),i?.fail(o)),delete this.muteSpeakerScenarioMap[e.teamsCallId],delete this.unmuteSpeakerScenarioMap[e.teamsCallId],l}}trackMuteChangesMetaData(e){e.state===o.CallState.Connected&&this.lastMuteStateChangeForCall.set(e.callId,{timestamp:Date.now(),sequenceCounter:0});let t=e.on("callStateChanged",()=>{e.state===o.CallState.Connected?this.lastMuteStateChangeForCall.set(e.callId,{timestamp:Date.now(),sequenceCounter:0}):(this.lastMuteStateChangeForCall.delete(e.callId),t.dispose())})}callInValidStateForVideoToggling(e){return e.state!==o.CallState.InLobby&&e.state!==o.CallState.Preheating&&e.state!==o.CallState.Connecting}handleVideoToggleInLobby(e,t,i,n,a,r=!1,o){if(this.callInValidStateForVideoToggling(e))return!1;a&&(a.mark(f.ck.ToggleVideoPausedInLobby),a.pause({reason:"Pausing video toggle in lobby"}));let s=()=>{this.logger.info(`[cid=${e.callId}][ctx=${t}] handleVideoToggleInLobby executing video toggle after lobby exit [callId: ${e.callId}]`),a?.resume(),this.toggleVideo(e,t,i,n,a,r,o)},l=this.inLobbyVideoToggleMetaForCallId.get(e.callId);if(!l){let i=e.on("callStateChanged",()=>{if(this.callInValidStateForVideoToggling(e)){let t=this.inLobbyVideoToggleMetaForCallId.get(e.callId);t?.disposeStateSubscription.dispose(),t?.executeLastToggleVideoAction(),this.inLobbyVideoToggleMetaForCallId.delete(e.callId)}});return this.inLobbyVideoToggleMetaForCallId.set(e.callId,{executeLastToggleVideoAction:s,disposeStateSubscription:i}),this.logger.info(`[cid=${e.callId}][ctx=${t}] handleVideoToggleInLobby posponed video toggle while in lobby [callId: ${e.callId}, videoOn: ${n}, fromPrejoin: ${r}, shouldSendHigherFrameRateVideo: ${o}]`),!0}return l.executeLastToggleVideoAction=s,this.logger.info(`[cid=${e.callId}][ctx=${t}] handleVideoToggleInLobby updated video toggle params while in lobby [callId: ${e.callId}, videoOn: ${n}, fromPrejoin: ${r}, shouldSendHigherFrameRateVideo: ${o}]`),!0}async toggleVideoWithInternalChecks(e,t,i,n,a,r,o,s,l,c){if(e.isVideoPreviewOn!==s&&(void 0===s?e.isVideoPreviewOn=!e.isVideoOn:e.isVideoPreviewOn=s),void 0!==s&&s===e.isVideoOn)throw new u.Yy(`${u.Yy.Message.SameValue} ${s}`,u.Yy.Severity.Incomplete);if(!this.callingSupportService.isIPVideoModeEnabledForCall(e))throw new u.Yy(u.Yy.Message.IpVideoMode,u.Yy.Severity.Incomplete);if(this.callingSupportService.blockAVOverIPInMeetings())throw new u.Yy(u.Yy.Message.BlockAVOverIP,u.Yy.Severity.Incomplete);if(e.isFollowMode())throw new u.Yy(u.Yy.Message.FollowMode,u.Yy.Severity.Incomplete);if(!e.isVideoOn&&this.config.enableVideoRestrictionsChecksInTogglingService())try{await this.checkCanEnableVideo(e),l?.mark(f.ck.CheckCanEnableVideo)}catch(e){throw new u.Yy(`${e.message||e}`,u.Yy.Severity.Incomplete)}if(!e.isVideoOn&&!i&&e.checkExplicitRecordingConsent("Video"))throw new u.Yy(k.ScenarioReasons.recording_consent_required_but_not_given,u.Yy.Severity.Incomplete);if(!e.isVideoOn&&this.shouldRestrictUnmuteIfMinorRecorded(e))throw new u.Yy(k.ScenarioReasons.minor_recording_no_consent,u.Yy.Severity.Incomplete);let d=!e.isVideoOn;try{d?await this.getUserMediaService.showGetUserMediaDialogIfNeeded("video",o):this.getUserMediaService.hideGetUserMediaDialog("video",o),r.stop(),l?.mark(f.ck.GetUserMedia)}catch(e){throw new u.Yy(`${u.Yy.Message.UserMediaService} ${e}`,u.Yy.Severity.Incomplete)}this.changingVideo=!0;try{await this.toggleVideoInternal(e,t,n,s,a,l),s||this.callingService.releaseAllPendingPreviews(),l?.mark(f.ck.ToggleVideoInternal),await this.updateHigherFrameRateVideoConfiguration(!!c,!!s,e,l),l?.mark(f.ck.UpdateHigherFrameRateConfigFinished),await this.handleSignLanguageDetection(e,!!s,l),l?.mark(f.ck.MarkSignerFinished)}catch(e){throw new u.Yy(`${u.Yy.Message.ToggleVideoInternal} ${e.message||e} negotiationTag: ${n}`,u.Yy.Severity.Failure)}finally{this.changingVideo=!1}}toggleVideoSharingInternal(e,t,i,n){let a=this.promiseFactory.createDeferred();return e.isScreenSharingOn?e.stopScreenSharingOnCall(t).then(e=>a.resolve(e)).catch(e=>a.reject(e)):(i===u.WR.HdmiIngest?this.deviceManagerService.getHdmiIngestCameraAsync():this.deviceManagerService.getWhiteboardCameraAsync(n)).then(i=>{if(!i)return void a.reject("No camera sharing source detected");e.startScreenSharingOnCall(i,t).then(e=>a.resolve(e)).catch(e=>a.reject(e))}).catch(e=>{this.logger.error("Failed to start Camera Sharing"),a.reject(e)}),a.promise}async escalateScreenshareOnCall(e,t,i,n,o){n||(n=(0,r.Z)());let s=i?.context||"";this.logger.info(`[cid=${n}][ctx=${s}] ScreenshareOnly: escalate call since it's a screensharing call`);try{this.changingAudioForCall.add(e.teamsCallId),await e.escalateScreensharingCallToAudio(s,n),this.muteOnAirHelper.setMuteStatus(e,a.Screensharing_Escalated_ToAudio,n),this.airpodsHelper.setMuteStatus(e,a.Screensharing_Escalated_ToAudio,n),this.sipDTMFHelper.sendDTMFtoToggleMuteUnmute(e,n);let i="ScreenshareOnly: escalated call to audio";return this.logger.info(`[cid=${n}][ctx=${s}] ${i}`),o?.mark(f.ck.EscalateScreensharingFinalized),t.stop({reason:i,reasonCMD:i}),this.getToggleMutePromise(e,i,!1,!1,n)}catch(a){let i=`[cid=${n}][ctx=${s}] escalateScreensharingCallToAudio failed due: ${a?.message||a}`;return this.logger.error(i),t.fail({reason:i,reasonCMD:i}),this.getToggleMutePromise(e,i,!0,!1,n)}finally{this.changingAudioForCall.delete(e.teamsCallId)}}getCheckPermissionsPromise(e,t,i){return t===u.c3.MW?(this.logger.info(`[cid=${i}] shouldCheckPermissions: source is MW, resolve promise`),this.promiseFactory.resolve()):e?this.getUserMediaService.showGetUserMediaDialogIfNeeded("audio",i):this.promiseFactory.resolve(this.getUserMediaService.hideGetUserMediaDialog("audio",i))}isCallConnected(e){return e.state===o.CallState.Connecting||e.state===o.CallState.Connected||e.state===o.CallState.Staging||e.state===o.CallState.EarlyMedia||e.state===o.CallState.InLobby}isCallDisconnected(e){return e.state===o.CallState.Disconnecting||e.state===o.CallState.Disconnected}getDisconnectedCallReason(e){return this.isCallDisconnected(e)?k.ScenarioReasons.call_ended:this.isCallConnected(e)?null:`${k.ScenarioReasons.call_not_connected}, callState: ${e.state}`}updateMuteScenarioOperationDelta(e,t){if(!t)return;let i=this.lastMuteStateChangeForCall.get(e.callId);if(!i)return void t.appendEventData({operationDelta:-1,sequenceCounter:-1});let n=Date.now()-i.timestamp,a=i.sequenceCounter++;t.appendEventData({operationDelta:n,sequenceCounter:a})}isServerUnmute(e,t){return e.isServerMuted&&t===u.Jn.Unmute}toggleMuteAudioCommon(e,t=u.c3.App,i,n,a,r){let o=this.isMuted(e),s=e.isSpeakerMuted,l=r&&r.context||"no context provided",g=this.isServerUnmute(e,a),h=e.isMuted&&!n;this.logger.info(`[cid=${i}][ctx=${l}] toggleMuteAudioCommon [shouldCheckPermissions: ${h}, call.isMuted: ${e.isMuted}, call.isServerMuted: ${e.isServerMuted}, appliedInteractivityLevel: ${this.callingSupportService.getAppliedInteractivityLevel(e)}, muteAction: ${a}]`);let p=this.newCallDevicePermissionsScenario(e,"audio",h,t),m=this.getOngoingMuteUnmuteScenario(e,n);this.updateMuteScenarioOperationDelta(e,m);let _=this.getCheckPermissionsPromise(h,t,i).catch(e=>{let n=`${h?"Unmute":"Mute"} failed with error ${e}. Source was ${t}`;return p.incomplete({reason:"canceled"}),this.logger.info(`[cid=${i}][ctx=${l}] ${n}`),m?.incomplete({reason:`Device permission check failed: ${n}`}),{id:i,message:n,type:u.Nn.Incomplete}}).then(async()=>{p.stop();let n=this.loggingService.findScenario(g?f.RG.ToggleServerUnmuteLatency:f.RG.ToggleMuteLatency);n?.mark(f.ck.CheckPermissionsFinalized),m?.mark(f.ck.CheckPermissionsFinalized);let h=await this.toggleMuteAudioInternal(e,t,a,r,i);if(h.type===u.Nn.Success){(e.isContentOnlyMode&&e.isSpeakerMuted||!e.isContentOnlyMode&&"audio-escalation-dialog-multiwindow"===l)&&(await this.toggleSpeaker(e,!1,i,r),n?.mark(f.ck.UnmuteSpeakerFinalized),m?.mark(f.ck.UnmuteSpeakerFinalized));let t=s&&!e.isSpeakerMuted,a=o&&!e.isMuted;t&&a&&(this.trigger(k.Type_CallTogglingSpeakersAndMicCalled,d.w.getTeamsCallIdAsString(e.teamsCallId)),this.trigger(k.Type_ContentOnlyModeChanged,d.w.getTeamsCallIdAsString(e.teamsCallId)),this.eventingService.emit(c.gT.events.calling.callEscalatedFromContentOnly,e))}return h}).finally(()=>{this.changingAudioForCall.delete(e.teamsCallId);let t=this.lastMuteStateChangeForCall.get(e.callId);t&&(t.timestamp=Date.now())});return this.changingAudioForCall.add(e.teamsCallId),_}setIsMutePendingInternal(e,t,i){this.logger.info(`Set isMutePending: ${t} causeId ${i} callId ${e.callId}`),e.isMutePending=t,this.trigger(c.gT.events.calling.mutePending,d.w.getTeamsCallIdAsString(e.teamsCallId))}setIsMutePending(e,t,i){if(t){if(this.delayedMutePendingHandlers.has(e.teamsCallId))return;let n=()=>{this.delayedMutePendingHandlers.delete(e.teamsCallId),this.setIsMutePendingInternal(e,t,i)},a=this.utilityService.setTimeoutMs(n,500);this.delayedMutePendingHandlers.set(e.teamsCallId,a)}else{let n=this.delayedMutePendingHandlers.get(e.teamsCallId);n?(this.utilityService.clearTimeout(n),this.delayedMutePendingHandlers.delete(e.teamsCallId)):this.setIsMutePendingInternal(e,t,i)}}toggleMuteAudioInternal(e,t=u.c3.App,i,n,a){let r,l,g=i?i===u.Jn.Mute:!this.isMuted(e);this.stopUnmuting(e,!1),this.lastMuteAudioCauseIdForCall.set(e.teamsCallId,a);let h=this.isServerUnmute(e,i);n={...n,mutedSpeaker:e.isSpeakerMuted,appliedInteractivityLevel:this.callingSupportService.getAppliedInteractivityLevel(e),message:`source=${t}`,action:this.muteToString(g),isMuted:e.isMuted,participantId:e.participantId,teamsCallId:e.teamsCallId};let p=this.getOngoingMuteUnmuteScenario(e,g),m=this.loggingService.findScenario(h?f.RG.ToggleServerUnmuteLatency:f.RG.ToggleMuteLatency);if(p?.appendEventData(n),m?.appendEventData(n),g){m?.mark(f.ck.ScRequestSent),p?.mark(f.ck.ScRequestSent),l=e.mute(a),r=c.gT.events.calling.muteSelf;let i=this.callMicMuteCache[e.teamsCallId];this.callMicMuteCache[e.teamsCallId]=t,this.logger.info(`[cid=${a}] App microphone muted. Previous source was ${i}. New Source is ${t} [callId: ${e.callId}]`)}else{let{scenarioMessage:i,cannotUnmute:n}=this.evaluateUnmuteResult(e,t,a);if(this.logger.info(i),n){this.stopUnmuting(e,!1);let t={id:a,message:`UnmuteEvaluationFailed errorMessage: ${i}`,type:u.Nn.Incomplete};this.trigger(k.Type_CallTogglingMuteAudioCalled,d.w.getTeamsCallIdAsString(e.teamsCallId),g),l=Promise.resolve(t)}else this.isWindowsOSPlatform&&!this.isPluginless&&this.callingAgentsService.unmuteMicrophone().catch(e=>{this.logger.error(`[cid=${a}] Failed to unmuteMicrophone: ${e.message}`),m?.mark(f.ck.UnmuteSpeakerFailed),p?.mark(f.ck.UnmuteSpeakerFailed)}),this.showXLMeetingMuteUXLatency(e)&&(this.logger.info(`[cid=${a}] Call is in 'nonInteractive' state while unmuting`),this.serviceProvider.callingAlertsService().dismissAlerts(...this.dismissedUnmutingLongerAlerts),this.serviceProvider.callingAlertsService().handleOnDemandAlert(this.micUnmuteTakesLongerTime)),m?.mark(f.ck.ScRequestSent),p?.mark(f.ck.ScRequestSent),l=e.unmute(a),this.isWindowsOSPlatform&&this.sanitizeCallMicMuteCache(e),r=c.gT.events.calling.unmuteSelf,e.isServerMuted&&!this.isInLobby(e)&&(this.unmutingTimeoutId=this.timeout.set(()=>this.stopUnmuting(e,!0),this.serverUnmutingTimeout,!1))}return this.setIsMutePending(e,!0,a),this.promiseFactory.create((e,t)=>l.then(e,t)).then(t=>{if(m?.mark(f.ck.ScRequestResponse),p?.mark(f.ck.ScRequestResponse),p&&this.fallbackStopMuteUnmuteScenarios(e,p,g),this.config.hooks.onAudioToggled(!g),(0,s.defer)(()=>{this.eventingService.emit(r,e)}),this.trigger(k.Type_CallTogglingAudioCompleted,d.w.getTeamsCallIdAsString(e.teamsCallId)),this.setIsMutePending(e,!1,a),t?.type)return this.promiseFactory.resolve(t);let i={id:a,type:u.Nn.Success};return this.promiseFactory.resolve(i)}).catch(t=>{let i,n,r=`code: ${t?.code}, subCode: ${t?.subCode}, phrase: ${t?.phrase}`;this.logger.errorToTelemetry?.(`toggleMuteAudioInternal failed with error: ${r}`,"toggleMuteAudio"),this.logger.error(`[cid=${a}] toggleMuteAudioInternal failed with error: ${r}`);let{toggleMuteResult:l,eventData:c}=this.parseToggleMuteError(t,g,a),h=e.isMuted===g,m=[o.CallState.Connecting,o.CallState.InLobby],_=(0,s.includes)(m,e.state);"429"===l.errorCode&&(this.logger.warn(`[cid=${a}] Mute throttling. Ignoring the error.
            callControllerCode: ${l.errorCode},
            callControllerSubCode: ${l.errorSubcode}, responsible team: ${"5029"===l.errorSubcode?"Conversation Service":"6331"===l.errorSubcode?"Media Controller":"Unknown"}`),l.type=u.Nn.Incomplete,i=new Promise(e=>{n=this.utilityService.setTimeoutMs(e,3e3)}));let S=`[cid=${a}] toggleMute finished with ${l.type} message: ${l.message} [callId: ${e.callId}]`;l.type===u.Nn.Timeout?(this.logger.info(S),p?.stop(c,void 0,"timeout")):l.type===u.Nn.Incomplete||h&&_?(l.type=u.Nn.Incomplete,this.logger.info(S),p?.incomplete(c)):(this.logger.error(S),p?.fail(c));let C=()=>(clearTimeout(n),this.setIsMutePending(e,!1,a),delete this.serverUnmuteSelfRunningScenarioMap[e.teamsCallId],delete this.unmuteSelfRunningScenarioMap[e.teamsCallId],delete this.muteSelfRunningScenarioMap[e.teamsCallId],delete this.promotionScenarioMap[e.teamsCallId],this.trigger(k.Type_CallTogglingAudioCompleted,d.w.getTeamsCallIdAsString(e.teamsCallId)),this.promiseFactory.resolve(l));return i?i.then(()=>(this.serviceProvider.callingAlertsService().handleOnDemandAlert(this.micUnmuteThrottledAlert),C())):C()})}getMuteUnmuteMap(e,t){return t?this.muteSelfRunningScenarioMap:e.callMode===o.CallMode.Streaming?this.promotionScenarioMap:e.isServerMuted&&!this.isInLobby(e)?this.serverUnmuteSelfRunningScenarioMap:this.unmuteSelfRunningScenarioMap}fallbackStopMuteUnmuteScenarios(e,t,i){let n={reason:k.ScenarioReasons.fallback_mute_finished,reasonCMD:k.ScenarioReasons.fallback_mute_finished};t.stop(n);let a=this.getMuteUnmuteMap(e,i);delete a[e.teamsCallId]}parseToggleMuteError(e,t,i){let n={},a={id:i,type:u.Nn.Error,message:e?.message||"Unknown error"};if((0,s.isNumber)(e)){let i=[...h.gv];(0,s.includes)(i,e)&&(a.type=u.Nn.Incomplete),a.message=`Could not ${this.muteToString(t)} self: reason="${e}"`,a.errorCode=e.toString()}else if(this.utilityService.isInstanceOfTransactionEnd&&this.utilityService.isInstanceOfTransactionEnd(e)){if(a.errorCode=e?.code?.toString(),a.errorSubcode=e?.subCode?.toString(),a.message=e?.phrase,e?.code===u.dP.code&&e?.subCode===u.dP.subCode&&e?.phrase===u.dP.phrase&&(a.type=u.Nn.Timeout),(0,s.includes)(u.RU,a.errorCode)&&(0,s.includes)(u.JI,a.errorSubcode)&&(a.type=u.Nn.Incomplete),e.resultCategories){let t=e.resultCategories.map(e=>e.toLowerCase());a.resultCategories=t.join(","),t.filter(e=>p.rh.includes(e)).length>0&&(a.type=u.Nn.Incomplete)}}else{let i=this.utilityService.getErrorLoggingString(e);a.message=`Could not ${this.muteToString(t)} self: error="${i}"]`}return n.errorMessage=a.message,n[c.gT.counters.eventNames.terminatedReason]=a.errorCode,n[c.gT.counters.eventNames.callControllerCode]=a.errorCode,n[c.gT.counters.eventNames.callControllerSubCode]=a.errorSubcode,n[c.gT.counters.eventNames.reason]=a.message,n.reasonCMD=a.message,n[c.gT.counters.eventNames.resultcategory]=a.resultCategories,{toggleMuteResult:a,eventData:n}}evaluateUnmuteResult(e,t,i){let n="All unmute rules passed. Attempting to unmute...",a=!1,r=this.config.muteIfMicNotAvailable();return e.isInTransportCompanionMode()?(n="Allowing state to change to unmute since the device is running in companion mode",this.logger.info(`[cid=${i}] Evaluated unmute result to successful for companion mode scenarios`)):r&&!this.deviceManagerService.areDevicesInitialized()?(a=!0,n="Cannot unmute microphone. Devices are not initialized."):r&&!this.deviceManagerService.getSelectedDevices().microphone?(a=!0,n="Cannot unmute microphone. No microphone device available."):this.isWindowsOSPlatform&&(this.desktopUtilityService.isWeb()&&this.sourceCanUnmuteOnWeb(e.teamsCallId,t)?(this.trigger(k.Type_CallTogglingBrowserOSUnmute,d.w.getTeamsCallIdAsString(e.teamsCallId)),n=`Cannot unmute microphone in Teams and OS. In browser. Unmute source was ${t} and mute source was ${this.callMicMuteCache[e.teamsCallId]}`,a=!0):this.canUnmuteAppMicForSource(e,t)||(n=`Cannot unmute microphone. Mute/Unmute source mismatch. Unmute source was ${t} and mute source was ${this.callMicMuteCache[e.teamsCallId]}`,a=!0)),{scenarioMessage:n,cannotUnmute:a}}sourceCanUnmuteOnWeb(e,t){let i=this.isUnmuteOSNotAllowedUFDDisabled?t===u.c3.App:t!==u.c3.OS;return this.callMicMuteCache[e]===u.c3.OS&&i}enforceMuteSourceAsApp(){this.callMicMuteCache&&0===Object.keys(this.callMicMuteCache).length||(Object.keys(this.callMicMuteCache).forEach(e=>{this.callMicMuteCache[e]=u.c3.App}),this.logger.info("Changed all MuteSources to App. All active calls will need to be unmuted from App now"))}onDevicesChanged(e){let t=this.callingService.getActiveCall();t&&(this.isMuted(t)?this.enforceMuteSourceAsApp():(this.callingAgentsService.unmuteMicrophone().catch(e=>this.logger.error(`Failed to unmuteMicrophone: ${e.message}`)),this.persistUnmuteStateOnDevicesChanged=!0,this.timeout.set(()=>this.persistUnmuteStateOnDevicesChanged=!1,500,!1)))}canUnmuteAppMicForSource(e,t){let i=this.callMicMuteCache&&this.callMicMuteCache[e.teamsCallId]?this.callMicMuteCache[e.teamsCallId]:u.c3.App;switch(t){case u.c3.App:case u.c3.MW:return!0;case u.c3.OS:if(this.slimcoreEcsConfigService.getStringAsBoolean("SkypeAudioLibrary","AudioDisableCaptureUnMuteAtStart")&&this.isOSUnmuteEnabled)return!0;return i===u.c3.OS;default:return!1}}sanitizeCallMicMuteCache(e){if(this.callMicMuteCache&&0===Object.keys(this.callMicMuteCache).length)return;this.logger.info("Sanitizing call mute cache..."),this.callMicMuteCache[e.teamsCallId]&&delete this.callMicMuteCache[e.teamsCallId];let t=this.callingService.getAllCalls();t||(this.callMicMuteCache={}),Object.keys(this.callMicMuteCache).forEach(e=>{let i=+e;t.filter(e=>e.teamsCallId===i)||delete this.callMicMuteCache[e]})}stopUnmuting(e,t){t&&(this.trigger(k.Type_CallTogglingUnmuteFailed,d.w.getTeamsCallIdAsString(e.teamsCallId)),this.serverUnmuteSelfRunningScenarioMap[e.teamsCallId]&&this.serverUnmuteSelfRunningScenarioMap[e.teamsCallId].mark(f.ck.FailShown)),null!=this.unmutingTimeoutId&&this.timeout.cancel(this.unmutingTimeoutId),this.unmutingTimeoutId=null}unsubscribeFromLocalVideoFailures(e){let t=this.localVideoFailureSubscriptions.get(e.callId);t&&(this.logger.info(`Unsubscribing from local video error teamsCallId: ${e.teamsCallId}`),t.subscription.dispose(),this.localVideoFailureSubscriptions.delete(e.callId))}updateLocalVideoFailuresSubscriptions(e){let t=e.localMediaStreams;if(!t){this.logger.info(`No local media streams found for call teamsCallId: ${e.teamsCallId}`),this.unsubscribeFromLocalVideoFailures(e);return}let i=t.find(e=>e.mediaType===o.MediaType.Video);if(!i)return void this.unsubscribeFromLocalVideoFailures(e);let n=this.localVideoFailureSubscriptions.get(e.callId),a=i._id;n?.videoStreamId!==a&&(n&&this.unsubscribeFromLocalVideoFailures(e),this.localVideoFailureSubscriptions.set(e.callId,{videoStreamId:a,teamsCallId:e.teamsCallId,subscription:i.on("videoError",t=>{let n=i._negotiationTag||"",a=this.utilityService.generateUUID();this.logger.error(`[cid=${a}] Received local video error: ${t} [teamsCallId:${e.teamsCallId},negotiationTag:${n}]`),this.maybeShowToggleVideoUFD(t);let r={[c.gT.counters.eventNames.context]:"LocalVideoRuntimeError",reasonCMD:t.toString(),slimcoreVersion:this.callingAgentsService.getVersions().slimCore,negotiationTag:n};if(this.callingTelemetryService.newCallingScenario(e,f.RG.LocalVideoRuntimeError,r).stop(),e?.intentId){let i=this.loggingService.findScenarioByNameAndId(f.RG.MyselfVideoOn,e.intentId),n={reason:`LocalVideoRuntimeError: ${t}`};"7"===t?(i?.mark(f.ck.ToggleVideoMissingDevicePermissions),i?.incomplete(n)):i?.fail(n)}"3"!==t&&this.toggleVideo(e,"localVideoFailure",a,!1).catch(t=>{this.callingTelemetryService.newCallingScenario(e,f.RG.LocalVideoRuntimeError,{...r,reasonCMD:t.toString()}).fail()})})}))}shouldStartTogglingVideo(e,t,i,n){if(e.state===o.CallState.Disconnecting||e.state===o.CallState.Disconnected)return!1;if(void 0!==i&&i===e.isVideoOn){let e=`Not toggling video because value of video on call is the same as passed value ${i} correlationId: ${n} context: ${t}`;return this.logger.log(e),!1}return!0}createLocalVideoScenario(e,t,i,n){return e.isVideoOn?this.callingTelemetryService.newStopVideoScenario(e.teamsCallId,t,{negotiationTag:i,correlationId:n,appliedInteractivityLevel:this.callingSupportService.getAppliedInteractivityLevel(e)}):this.callingTelemetryService.newStartVideoScenario(e.teamsCallId,t,{negotiationTag:i,correlationId:n,appliedInteractivityLevel:this.callingSupportService.getAppliedInteractivityLevel(e)})}async toggleLocalVideoOnCall(e,t,i,n){if(e.isVideoOn)return void await e.stopVideo(e.getTagForMedia(o.MediaType.Video));this.eventingService.emit(c.gT.events.calling.verifyExistingCamera,e),this.showXLMeetingMuteUXLatency(e)&&(this.logger.info(`Call is in 'nonInteractive' state while turning on video callId=${e.callId} context=${t} correlationId=${n} negotiationTag=${i}`),this.serviceProvider.callingAlertsService().handleOnDemandAlert(this.cameraUnmuteTakesLongerTime)),await e.startVideo(i)}async toggleVideoInternal(e,t,i,n,a,r){if(!this.shouldStartTogglingVideo(e,t,n,a))return;let s=this.createLocalVideoScenario(e,t,i,a),l=e.isVideoOn;try{await this.toggleLocalVideoOnCall(e,t,i,a),this.config.hooks.onVideoToggled(!l),s.stop(),r?.mark(f.ck.ToggleLocalVideoFinished),this.eventingService.emit(l?c.gT.events.calling.videoOff:c.gT.events.calling.videoOn,e)}catch(n){throw r?.mark(f.ck.ToggleLocalVideoFailed),this.logger.error(`Could not ${e.isVideoOn?"stop":"start"} video: error=${n.message||n} callId=${e.callId} context=${t} correlationId=${a} negotiationTag=${i}`),n&&n.reason&&n.reason===skype.calling.pluginless.ToggleVideoFailureReason.ToggleInProgress?s.incomplete({errorInfo:n.errorType,error:n.message||"",reason:n.reason||"",reasonCMD:n.reason||""}):(n&&n.errorType&&n.errorType===o.RendererErrorType.RendererFailedGpuContext&&this.callingAgentsService.getCallSupportDetector().onVideoRenderingFailure(),n&&n.message&&n.message.includes(P)&&s.incomplete({error:P}),s.fail({errorInfo:n.errorType||"",error:n.message||"",reason:n.reason||n.message||"",reasonCMD:n.reason||n.message||""})),n}this.trigger(k.Type_CallTogglingOutgoingVideoCompleted,d.w.getTeamsCallIdAsString(e.teamsCallId))}maybeShowToggleVideoUFD(e){try{"6"===e&&this.serviceProvider.callingAlertsService().handleOnDemandAlert(this.defaultLocalVideoErrorAlert)}catch(t){let e=this.utilityService.getErrorLoggingString(t);this.logger.info(`maybeShowToggleVideoUDF error: ${e}`)}}endCall(e,t,i){this.logger.info(`end call callId=${e.callId}`);let n=this.promiseFactory.createDeferred();return e.stopScreenSharingOnCall(t).then(()=>{this.logger.info(`[End call] Starting end callId=${e.callId}`),this.callingService.leaveCall(e,t,void 0,void 0,i).then(()=>{this.logger.info(`[End call] Successfully ended callId=${e.callId}`),n.resolve()}).catch(t=>{this.logger.error(`[End call] Failed to end call with callId=${e.callId}`),n.reject(t)})}).catch(t=>{this.logger.error(`[End call] Failed to end call with call callId=${e.callId}`),n.reject(t)}),n.promise}holdCall(e,t){this.logger.info(`holdCall callId=${e.callId}`);let i=this.promiseFactory.createDeferred();return this.eventingService.emit(c.gT.events.calling.pptSharingOnHold,{callId:e.callId}),e.stopScreenSharingOnCall("Hold Call").then(()=>{this.logger.info(`[holdCall] Starting hold callId=${e.callId}`),e.hold(e.getTag(),this.utilityService.generateUUID(),t).then(()=>{this.persistentVideoBackgroundEnabled||e.resetBackgroundBlurringOnCallLeave(c.gT.scenarios.calling.holdCall).catch(e=>this.logger.warn(`[holdCall] Failed to reset background blur: ${e}`))}).then(()=>{if(this.config.isAppStateIpcToSfBEnabled()){let e=this.helpers.ipcUtility.get();e&&e.send(c.gT.events.desktopApp.calling.teamsIpcActionAppStateChange,_.iYh.InCall,_.iYh.Interactive,"callingTogglingService::holdCall")}this.logger.info("[holdCall] Successfully held call (callId = {0})",e.callId),i.resolve()}).then(()=>{e.isImmersiveViewActive&&e.changeImmersiveViewStatus(!1)}).catch(t=>{this.logger.errorToTelemetry?.("[holdCall][call.hold] Failed","cmd_hold_call",{callId:e.callId,reasonCMD:this.utilityService.getErrorLoggingString(t)},!0),i.reject(t)})}).catch(t=>{this.logger.errorToTelemetry?.("[holdCall][call.stopScreenSharingOnCall] Failed","cmd_hold_call",{callId:e.callId,reasonCMD:this.utilityService.getErrorLoggingString(t)},!0),i.reject(t)}),i.promise}unholdCall(e){if(this.unholdCallDefer)return this.logger.info(`cannot unhold callId=${e.callId}, because another unhold operation is in progress`),this.promiseFactory.reject(c.gT.promiseState.aborted);if(g.eU.isParkCall(e)){let t=`cannot unhold callId=${e.callId}, because it is a parked call`;return this.logger.info(t),this.promiseFactory.reject(t)}return this.unholdCallDefer=this.promiseFactory.createDeferred(),this.callingService.handleOngoingCallOnMultiCallsAllowed(e.teamsCallId,!1,!0).then(()=>{this.logger.info("[unholdCall] Resetting background blurring (callId = {0})",e.callId),this.persistentVideoBackgroundEnabled||e.resetBackgroundBlurringOnCallResume(c.gT.scenarios.calling.resumeCall)}).then(()=>{this.logger.info("[unholdCall] Resuming call (callId = {0})...",e.callId),e.unhold(e.getTag(),this.utilityService.generateUUID()).then(()=>{if(this.config.isAppStateIpcToSfBEnabled()){let e=this.helpers.ipcUtility.get();e&&e.send(c.gT.events.desktopApp.calling.teamsIpcActionAppStateChange,_.iYh.Interactive,_.iYh.InCall,"callingTogglingService::unholdCall")}this.logger.info("[unholdCall] Successfully resumed call (callId = {0})",e.callId),this.unholdCallDefer.resolve(),this.unholdCallDefer=null}).catch(t=>{this.logger.error("[unholdCall] Failed to resume call (callId = {0})",e.callId),this.unholdCallDefer.reject(t),this.unholdCallDefer=null})}).catch(t=>{this.logger.error("[unholdCall] Failed to resume call (callId = {0})",e.callId),this.unholdCallDefer.reject(t),this.unholdCallDefer=null}),this.unholdCallDefer.promise}isInLobby(e){return e.state===o.CallState.InLobby}isConnecting(e){return e.state===o.CallState.Connecting}newCallDevicePermissionsScenario(e,t,i,n,a){let r=f.RG.CallDevicePermissions,o=c.gT.timeInMiliseconds.day,s={...a,[c.gT.counters.eventNames.context]:t,source:n,shouldCheckPermissions:i};return this.callingTelemetryService.newCallingScenario(e.teamsCallId,r,s,o)}newMuteUnmuteSpeakerScenario(e,t,i){return t?this.newMuteSpeakerScenarion(e,i):this.newUnmuteSpeakerScenario(e,i)}newMuteSpeakerScenarion(e,t){let i=this.callingTelemetryService.newCallingScenario(e.teamsCallId,f.RG.MuteSpeaker,t);return this.muteSpeakerScenarioMap[e.teamsCallId]=i,i}newUnmuteSpeakerScenario(e,t){let i=this.callingTelemetryService.newCallingScenario(e.teamsCallId,f.RG.UnmuteSpeaker,t);return this.unmuteSpeakerScenarioMap[e.teamsCallId]=i,i}newPromotionScenario(e,t){let i=this.callingTelemetryService.newCallingScenario(e.teamsCallId,f.RG.StreamingAttendeeManualPromotionEvent,t);return this.promotionScenarioMap[e.teamsCallId]=i,i}markPromotionScenarioAsCompleted(e){let t=this.promotionScenarioMap[e.teamsCallId];t&&(t.stop(),delete this.promotionScenarioMap[e.teamsCallId])}newMuteUnmuteScenario(e,t,i){let n=this.callingSupportService.getOngoingCallType?.(e);return i={...i,callType:n},this.ensureCallListenerExists(e),this.ensureMuteListenerExists(e),this.previousLocalMuteState[e.teamsCallId]=e.isMuted,this.createMuteScenario(e,t,i)}createMuteScenario(e,t,i){return t?this.newLocalMuteSelfScenario(e,i):e.callMode===o.CallMode.Streaming?this.newPromotionScenario(e,i):e.isServerMuted&&!this.isInLobby(e)?this.newServerUnmuteSelfScenario(e,i):this.newLocalUnmuteSelfScenario(e,i)}newLocalMuteSelfScenario(e,t){let i=this.callingTelemetryService.newCallingScenario(e.teamsCallId,f.RG.MuteSelf,t);return this.cancelMuteUnmuteSelfScenario(e,k.ScenarioReasons.mute_called,this.unmuteSelfRunningScenarioMap),this.cancelMuteUnmuteSelfScenario(e,k.ScenarioReasons.mute_called,this.serverUnmuteSelfRunningScenarioMap),this.muteSelfRunningScenarioMap[e.teamsCallId]=i,i}newLocalUnmuteSelfScenario(e,t){let i=this.callingTelemetryService.newCallingScenario(e.teamsCallId,f.RG.UnmuteSelf,t);return this.cancelMuteUnmuteSelfScenario(e,k.ScenarioReasons.unmute_called,this.muteSelfRunningScenarioMap),this.unmuteSelfRunningScenarioMap[e.teamsCallId]=i,i}newServerUnmuteSelfScenario(e,t){this.ensureCallListenerExists(e),this.ensureServerMutedListenerExists(e);let i=this.callingTelemetryService.newCallingScenario(e.teamsCallId,f.RG.ServerUnmuteSelf,t);return this.cancelMuteUnmuteSelfScenario(e,"called again",this.serverUnmuteSelfRunningScenarioMap),this.serverUnmuteSelfRunningScenarioMap[e.teamsCallId]=i,i}getOngoingMuteUnmuteScenario(e,t){return this.getMuteUnmuteMap(e,t)[e.teamsCallId]||void 0}ensureCallListenerExists(e){if(!(0,s.has)(this.callListenerMap,e.teamsCallId)){let t=e.on("callStateChanged",()=>{let i=this.getDisconnectedCallReason(e);if(i){this.incompleteMuteUnmuteSelfScenario(e,i,this.serverUnmuteSelfRunningScenarioMap),this.incompleteMuteUnmuteSelfScenario(e,i,this.muteSelfRunningScenarioMap),this.incompleteMuteUnmuteSelfScenario(e,i,this.unmuteSelfRunningScenarioMap),this.incompleteMuteUnmuteSelfScenario(e,i,this.unmuteSpeakerScenarioMap),this.incompleteMuteUnmuteSelfScenario(e,i,this.promotionScenarioMap),this.incompleteMuteUnmuteSelfScenario(e,i,this.muteSpeakerScenarioMap);let n=this.callListenerMap[e.teamsCallId];this.isCallDisconnected(e)&&n&&(t.dispose(),delete this.callListenerMap[e.teamsCallId]);let a=this.muteChangedListeners[e.teamsCallId];a&&(a.dispose(),delete this.muteChangedListeners[e.teamsCallId],delete this.previousLocalMuteState[e.teamsCallId]);let r=this.serverMutedChangedListeners[e.teamsCallId];r&&(r.dispose(),delete this.serverMutedChangedListeners[e.teamsCallId]),this.changingAudioForCall.delete(e.teamsCallId)}e.state===o.CallState.Connected&&e.callMode===o.CallMode.RealTime&&this.markPromotionScenarioAsCompleted(e)});this.callListenerMap[e.teamsCallId]=t}}ensureMuteListenerExists(e){if((0,s.has)(this.callListenerMap,e.teamsCallId)&&!(0,s.has)(this.muteChangedListeners,e.teamsCallId)){let t=e.on("muteStateChanged",()=>{let t=this.getOngoingMuteUnmuteScenario(e,!this.isMuted(e));if(t?.mark(f.ck.MicrophoneStatusChanged),e.isMuted!==this.previousLocalMuteState[e.teamsCallId]){this.previousLocalMuteState[e.teamsCallId]=e.isMuted,this.isMuted(e)?this.stopMuteUnmuteSelfScenario(e,k.ScenarioReasons.local_mute_changed,this.muteSelfRunningScenarioMap):(this.stopUnmuting(e,!1),this.stopMuteUnmuteSelfScenario(e,k.ScenarioReasons.local_mute_changed,this.serverUnmuteSelfRunningScenarioMap),this.stopMuteUnmuteSelfScenario(e,k.ScenarioReasons.local_mute_changed,this.unmuteSelfRunningScenarioMap));let t=this.lastMuteAudioCauseIdForCall.get(e.teamsCallId)||(0,r.Z)();this.lastMuteAudioCauseIdForCall.delete(e.teamsCallId),this.muteOnAirHelper.setMuteStatus(e,a.Mute_Changed,t),this.airpodsHelper.setMuteStatus(e,a.Mute_Changed,t),this.sipDTMFHelper.sendDTMFtoToggleMuteUnmute(e,t)}this.trigger(k.Type_CallTogglingMicMuteChanged,d.w.getTeamsCallIdAsString(e.teamsCallId))});this.muteChangedListeners[e.teamsCallId]=t}}ensureServerMutedListenerExists(e){if((0,s.has)(this.callListenerMap,e.teamsCallId)&&!(0,s.has)(this.serverMutedChangedListeners,e.teamsCallId)){let t=e.on("serverMutedChanged",()=>{this.isMuted(e)||(this.stopUnmuting(e,!1),this.stopMuteUnmuteSelfScenario(e,k.ScenarioReasons.server_mute_changed,this.serverUnmuteSelfRunningScenarioMap),this.stopMuteUnmuteSelfScenario(e,k.ScenarioReasons.server_mute_changed,this.unmuteSelfRunningScenarioMap))});this.serverMutedChangedListeners[e.teamsCallId]=t}}muteToString(e){return e?"mute":"unmute"}cancelMuteUnmuteSelfScenario(e,t,i){i[e.teamsCallId]&&(i[e.teamsCallId].cancel({reason:t,reasonCMD:t}),delete i[e.teamsCallId])}incompleteMuteUnmuteSelfScenario(e,t,i){i[e.teamsCallId]&&(i[e.teamsCallId].incomplete({reason:t,reasonCMD:t}),delete i[e.teamsCallId])}stopMuteUnmuteSelfScenario(e,t,i){i[e.teamsCallId]&&(i[e.teamsCallId].stop({reason:t,reasonCMD:t}),delete i[e.teamsCallId])}shouldRestrictUnmuteIfMinorRecorded(e){return this.config.isMinorRestrictedWhenRecording()&&e.isCloudRecording()}}k.ScenarioReasons={call_ended:"call ended",call_not_connected:"call is not connected",call_already_in_state:"call already in state: ",already_running:"ignored action since another action is already running. Action: ",local_mute_changed:"localMutedChanged",server_mute_changed:"serverMutedChanged",mute_called:"mute called",unmute_called:"unmute called",fallback_mute_finished:"fallback mute finished",lightweight_mode:"call is in lightweight mode",block_av_over_ip:"av over ip is blocked for user",ip_audio_mode:"IP audio mode is on",attendee_audio_restricted:"attendee audio is restricted",allow_private_calling_in_SSFC:"user in SSFC call with private calling disabled",follow_mode:"call in follow mode",recording_consent_required_but_not_given:"recording consent is required but not given",devices_changed:"devices changed",minor_recording_no_consent:"recording is ongoing and user is a minor"},k.Type_CallTogglingMuteAudioCalled="call-toggling-mute-audio-called",k.Type_CallTogglingUnmuteFailed="call-toggling-unmute-fail",k.isIncomingVideoChanged="call-toggling-incoming-video-changed",k.Type_CallTogglingSpeakersAndMicCalled="call-toggling-speakers-mic-called",k.Type_CallTogglingBrowserOSUnmute="call-toggling-browser-os-unmute",k.Type_ContentOnlyModeChanged="call-content-only-mode-changed",k.Type_CallTogglingOutgoingVideoCompleted="call-toggling-video-completed",k.Type_CallTogglingAudioCompleted="call-toggling-audio-completed",k.Type_CallTogglingCallMuteChanged="call-toggling-call-mute-changed",k.Type_CallTogglingMicMuteChanged="call-toggling-mic-mute-changed"},223708:function(e,t,i){var n,a,r,o;i.d(t,{$x:()=>a,pF:()=>n,q5:()=>s}),(r=n||(n={}))[r.None=0]="None",r[r.Transferring=1]="Transferring",r[r.Succeeded=2]="Succeeded",r[r.Failed=3]="Failed";class s{}s.CallTransferStateChanged="CallTransferStateChanged",(o=a||(a={}))[o.Pstn=0]="Pstn",o[o.Voicemail=1]="Voicemail",o[o.People=2]="People"},503018:function(e,t,i){var n,a,r,o,s,l,c,d;i.d(t,{R8:()=>r,TC:()=>g,Vw:()=>o,Wv:()=>a,yn:()=>n}),(s=n||(n={}))[s.None=0]="None",s[s.ModalityLinksNotReceived=1]="ModalityLinksNotReceived",s[s.BmcUpdatesNotReceived=2]="BmcUpdatesNotReceived";let g={links:{PRODUCER:"producer",CONTRIBUTOR:"contributor",PARTICIPANTSESSION:"participantSession"},errorCode:{Invalid_Command:"Invalid_Command",Unknown:"Unknown",NotConnected:"bmc_notconnected",Invalid_Role:"Invalid_Role",CallState_Invalid:"CallState_Invalid"},headers:{CORRELATION_ID:"X-Microsoft-Skype-Chain-ID",PARTICIPANT_ID:"X-Microsoft-Skype-Participant-ID",MESSAGE_ID:"X-Microsoft-Skype-Message-ID",X_MS_CLIENT_VERSION:"X-Ms-Client-Version"},role:{producer:"producer",contributor:"contributor"},commands:{setLayout:"setLayout",start:"start",stop:"stop",switchPrimary:"switchPrimary",failoverInstance:"failoverInstance",updateMediaState:"updateMediaState",restart:"restart"},subcode:{Timeout:"timeout",VideoSubscriptionFailed:"videoSubscriptionFailed",VideoStalled:"videoStalled",InvalidOperation:"invalidOperation",Superceded:"superceded"}};(l=a||(a={}))[l.AMS=1]="AMS",l[l.Stream=2]="Stream",l[l.Overflow=3]="Overflow",(c=r||(r={})).Everyone="Everyone",c.EveryoneInCompany="EveryoneInCompany",c.EveryoneInCompanyAndExternal="EveryoneInCompanyAndExternal",c.InvitedUsersInCompany="InvitedUsersInCompany",c.InvitedUsersInCompanyAndExternal="InvitedUsersInCompanyAndExternal",(d=o||(o={}))[d.Anonymous=0]="Anonymous",d[d.AllCompany=1]="AllCompany",d[d.InvitationOnly=2]="InvitationOnly"},184497:function(e,t,i){i.d(t,{q:()=>y});var n=i(370574),a=i(892891),r=i(395250);class o{}o.none="none",o.setLayout="setLayout",o.start="start",o.stop="stop",o.switchPrimary="switchPrimary",o.failoverInstance="instanceFailover",o.updateMediaState="updateMediaState",o.restart="restart";class s{constructor(e){this.id=e.generateUUID()}}class l extends s{constructor(e,t){super(e),this.name=o.failoverInstance,this.instanceFailoverTarget=t?"Primary":"Secondary"}}class c extends s{constructor(e){super(e),this.name=o.restart}}class d extends s{constructor(e){super(e),this.name=o.setLayout}}class g extends s{constructor(e){super(e),this.name=o.start}}class h extends s{constructor(e){super(e),this.name=o.stop}}class p extends s{constructor(e){super(e),this.name=o.switchPrimary}}class u extends s{constructor(e,t,i,n){super(e),this.name=o.updateMediaState,this.sources=t,this.mediaState=i,this.reason=n}}var m=i(526260),_=i(28414);class S{constructor(e,t,i){this.broadcastMeeting=e,this.logger=t,this.utilityService=i,this.success_status="success",this.currentCommandsResponseWatcherByCommandId={}}waitForCommandResponse(e,t,i){return new Promise((n,a)=>{let r=this.getCommandStatus(e,t);if(r){this.logger.log("Command status found for commandId in the state object. Returning status {0}",t),"success"===r.result?n(r):a({commandId:r.id,errorCode:r.result,subcode:r.detail&&r.detail.subcode,sourceIds:r.detail&&r.detail.sourceIds&&r.detail.sourceIds.toString()});return}this.waitForCommandResponseOrTimeout(e,t,i).then(e=>n(e)).catch(e=>a(e))})}dispose(){for(let[e,t]of Object.entries(this.currentCommandsResponseWatcherByCommandId))this.disposeWatcherForCommandId(e,!1);this.currentCommandsResponseWatcherByCommandId={}}waitForCommandResponseOrTimeout(e,t,i){return new Promise((n,a)=>{let r=JSON.stringify(this.broadcastMeeting.broadcastState),o=this.utilityService.setTimeoutMs(()=>{this.logger.error("Timeout happened while waiting response of command {0}",t),this.disposeWatcherForCommandId(t),a({commandId:t,errorCode:"timeout"})},1e3*i),s=this.broadcastMeeting.changed(()=>{let i=JSON.stringify(this.broadcastMeeting.broadcastState);if(r===i)return void this.logger.info("same metadata update. skipping");let o=this.getCommandStatus(e,t);if(!o)return void this.logger.info(`Watching for command Id ${t}. But no status found in current metadata update. ${i}`);this.logger.info("Command status found in the state object for commandId {0}",t),this.disposeWatcherForCommandId(t),o.result===this.success_status?n(o):a({commandId:o.id,errorCode:o.result,subcode:o.detail&&o.detail.subcode,sourceIds:o.detail&&o.detail.sourceIds&&o.detail.sourceIds.toString()})});this.currentCommandsResponseWatcherByCommandId[t]={unsubscribeTimeoutId:o,callChangedDisposable:s}})}getCommandStatus(e,t){let i=this.broadcastMeeting.broadcastState;if(!i)return this.logger.info("Broadcast state is not yet available"),null;switch(e){case _.N2.stop:if(i.status===_.TP.Stopping||i.status===_.TP.Stopped){this.logger.info("Broadcast status is stopping/stopped. So broadcast has stopped.");let i={};return i.id=t,i.name=e,i.result=this.success_status,i}return null;case _.N2.start:let n=this.getDefaultBroadcastCommandStatus(i,t);return(i.status===_.TP.Starting||i.status===_.TP.Started)&&(n||((n={}).id=t,n.name=e),n.result=this.success_status),n;default:return this.getDefaultBroadcastCommandStatus(i,t)}}getDefaultBroadcastCommandStatus(e,t){if(!e.commandStatus||!e.commandStatus.length)return this.logger.info("Broadcast state or command status is null while watching command {0}",t),null;let i=e.commandStatus.filter(e=>e&&e.id===t);return i&&i.length>0?i[0]:null}disposeWatcherForCommandId(e,t=!0){let i=this.currentCommandsResponseWatcherByCommandId[e];i&&(t&&delete this.currentCommandsResponseWatcherByCommandId[e],i.callChangedDisposable&&i.callChangedDisposable.dispose(),i.unsubscribeTimeoutId&&clearTimeout(i.unsubscribeTimeoutId))}}var C=i(503018),v=i(575810);class f{constructor(e,t,i,n,a,r){this.loggingService=e,this.interval=t,this.broadcastMeeting=i,this.modalityStateManager=n,this.call=a,this.config=r,this.clientCheckHealthInterval=3e4,this.moveToConnectedStateOnMetadataChange=!1,this.currentMissedStateCount=0,this.logger=e.newLogger(`BroadcastModalityHealth ${a.callId}`),this.intervalPromise=this.interval.set(this.checkForBroadcastConnection.bind(this),this.clientCheckHealthInterval),this.lastMetadataUpdateTimestamp=Date.now().valueOf()}metadataChanged(){this.logger.info("metadata change triggered for broadcast"),this.lastMetadataUpdateTimestamp=Date.now().valueOf(),this.currentMissedStateCount=0,this.moveToConnectedStateOnMetadataChange&&this.broadcastMeeting.modalityState===n.BroadcastModalityState.Disconnected&&(this.modalityStateManager.setModalityState(n.BroadcastModalityState.Connected),this.moveToConnectedStateOnMetadataChange=!1)}dispose(){this.stopConnectionHealthCheckTimer()}stopConnectionHealthCheckTimer(){this.intervalPromise&&(this.interval.cancel(this.intervalPromise),this.intervalPromise=null)}checkForBroadcastConnection(){if(this.broadcastMeeting.broadcastState&&(this.broadcastMeeting.broadcastState.status===_.TP.Stopped||this.broadcastMeeting.broadcastState.status===_.TP.Stopping)){this.logger.info("Broadcast meeting ended, stopping BMC health check timer"),this.stopConnectionHealthCheckTimer();return}let e=Date.now().valueOf();switch(this.broadcastMeeting.modalityState){case n.BroadcastModalityState.None:this.handleMissedNotificationOnNoneState(e);break;case n.BroadcastModalityState.Ringing:case n.BroadcastModalityState.Connecting:this.logger.warn("Broadcast modality is still ringing/connecting. no client has yet joined. {0}",this.broadcastMeeting.modalityState);break;case n.BroadcastModalityState.Connected:this.handleMissedNotificationOnConnectedState(e)}}handleMissedNotificationOnNoneState(e){e-this.lastMetadataUpdateTimestamp>=3e4&&(this.logger.error("Didn't received any bmc metadata update from bmc. Moving to disconnect state"),this.setModalityStateToDisconnected(C.yn.ModalityLinksNotReceived))}handleMissedNotificationOnConnectedState(e){let t=this.config.bmcStateUpdatePingInterval()+v.gT.scenarios.broadcast.bmcStateUpdateNetworkLatencyWait;if(e-this.lastMetadataUpdateTimestamp<=t)return void this.logger.info("We got an update within the expected ping interval. Health is good");if(this.currentMissedStateCount++,this.logger.warn("Missed broadcast state update. No. of updates missed {0}. Health might be bad. Max timeout {1}",this.currentMissedStateCount,t),1===this.currentMissedStateCount){this.logger.info("trying to join the broadast modality again");let e=this.loggingService.newScenario(r.RG.BroadcastAutojoinModality);return e.cancelIfOffline=!0,this.broadcastMeeting.joinModalityInternal().then(()=>{this.logger.info("Modality join is successful"),e.stop(),this.metadataChanged()}).catch(t=>{let i={};i[v.gT.counters.eventNames.callId]=this.call.callId,i[v.gT.scenarioDataPropNames.broadcastError]=JSON.stringify({error:t}),i[v.gT.counters.eventNames.wasPoppedOut]=this.call.wasPoppedOut,i[v.gT.categories.callWasPoppedOut]=this.call.wasPoppedOut,t&&t.code===C.TC.errorCode.CallState_Invalid?e.cancel(i):e.fail(i),this.logger.error("Cannot join modality again. We will move to disconnect state {0}",t),this.setModalityStateToDisconnected(C.yn.BmcUpdatesNotReceived)})}this.currentMissedStateCount>=2&&(this.logger.error("More than 2 missing states. Health is bad. Current count {0}",this.currentMissedStateCount),this.setModalityStateToDisconnected(C.yn.BmcUpdatesNotReceived))}setModalityStateToDisconnected(e){e===C.yn.BmcUpdatesNotReceived&&(this.moveToConnectedStateOnMetadataChange=!0),this.broadcastMeeting.disconnectReason=e,this.modalityStateManager.setModalityState(n.BroadcastModalityState.Disconnected)}}class b{constructor(e,t){this.broadcastMeeting=t,this.logger=e.newLogger("BroadcastModalityStateManager")}setModalityState(e,t=!0){switch(e){case n.BroadcastModalityState.Connected:return this.setModalityStateToConnected(t);case n.BroadcastModalityState.Connecting:return this.setModalityStateToConnecting(t);case n.BroadcastModalityState.Ringing:return this.setModalityStateToRinging(t);case n.BroadcastModalityState.Disconnected:return this.broadcastMeeting.setModalityState(e,t);default:this.logger.error("Invalid state for modality {0}",e)}}setModalityStateToRinging(e){this.broadcastMeeting.setModalityState(n.BroadcastModalityState.Ringing,e)}setModalityStateToConnecting(e){let t=this.broadcastMeeting.modalityState;if(t!==n.BroadcastModalityState.Ringing)return void this.logger.error("Invalid state transition. Expected new state {0}. Current state {1}",n.BroadcastModalityState.Connecting,t);this.broadcastMeeting.setModalityState(n.BroadcastModalityState.Connecting,e)}setModalityStateToConnected(e){let t=this.broadcastMeeting.modalityState;if(t!==n.BroadcastModalityState.Disconnected&&t!==n.BroadcastModalityState.Connecting)return void this.logger.error("Invalid state transition. Expected new state {0}. Current state {1}",n.BroadcastModalityState.Connected,t);this.broadcastMeeting.setModalityState(n.BroadcastModalityState.Connected,e)}}class y extends m.s{constructor(e,t,i,a,r,o,s,l,c){super(),this.loggingService=e,this.sxConfig=t,this.authenticationService=i,this.httpClient=a,this.utilityService=r,this.interval=o,this.call=s,this.appConfig=l,this.isDisposed=!1,this.logger=e.newLogger("Broadcast Call"),this.callbackFunctions={},this.modalityState=n.BroadcastModalityState.None,this.commandResponseWatcher=new S(this,this.logger,this.utilityService),this.modalityStateManager=new b(e,this),this.clientVersion=c?.getClientVersion()??"",l.disableBroadcastModalityHealthCheck()||this.registerCallbackOnCallConnected("initializeHealthWatcher",()=>{this.modalityHealthWatcher=new f(e,o,this,this.modalityStateManager,s,{bmcStateUpdatePingInterval:l.bmcStateUpdatePingInterval})}),this.links={}}setLayout(e){return this.validateProducerCommand(y.constants.commands.setLayout).then(()=>{if(!this.broadcastState.commands.setLayout)return this.logger.error("Set layout command not available. Available commands are {0}. CallId {1}",this.broadcastState.commands,this.call.callId),Promise.reject(this.createNewError(y.constants.commands.setLayout,y.constants.errorCode.Invalid_Command,"Set layout command not available"));let t={};return t.ver=1,t.command=new d(this.utilityService),t.command.sources=e.sources,this.executeProducerRequest(t,o.setLayout)})}start(){return this.validateProducerCommand(y.constants.commands.start).then(()=>{if(!this.broadcastState.commands.start)return this.logger.error("Start command not available. Available commands are {0}. CallId {1}",this.broadcastState.commands,this.call.callId),Promise.reject(this.createNewError(y.constants.commands.start,y.constants.errorCode.Invalid_Command,"Start command not available"));let e={};return e.command=new g(this.utilityService),e.ver=1,this.executeProducerRequest(e,o.start)})}stop(){return this.validateProducerCommand(y.constants.commands.stop).then(()=>{if(!this.broadcastState.commands.stop)return this.logger.error("Stop command not available. Available commands are {0}",this.broadcastState.commands),Promise.reject(this.createNewError(y.constants.commands.stop,y.constants.errorCode.Invalid_Command,"Stop command not available"));let e={};return e.ver=1,e.command=new h(this.utilityService),this.executeProducerRequest(e,o.stop)})}switchPrimary(){return this.validateProducerCommand(y.constants.commands.switchPrimary).then(()=>{if(!this.broadcastState.commands.switchPrimary)return this.logger.error("switchPrimary command not available. Available commands are {0}",this.broadcastState.commands),Promise.reject(this.createNewError(y.constants.commands.switchPrimary,y.constants.errorCode.Invalid_Command,"switchPrimary command not available"));let e={};return e.ver=1,e.command=new p(this.utilityService),this.executeProducerRequest(e,o.switchPrimary)})}failoverInstance(e){return this.validateProducerCommand(y.constants.commands.failoverInstance).then(()=>{if(!this.broadcastState.commands.instanceFailover)return this.logger.error("instanceFailover command not available. Available commands are {0}",this.broadcastState.commands),Promise.reject(this.createNewError(y.constants.commands.failoverInstance,y.constants.errorCode.Invalid_Command,"instanceFailover command not available"));let t={};return t.ver=1,t.command=new l(this.utilityService,e),this.executeProducerRequest(t,o.failoverInstance)})}updateMediaState(e,t,i){return this.validateCommand(y.constants.commands.updateMediaState).then(()=>{if(!this.broadcastState.commands.updateMediaState)return this.logger.error("updateMediaState command not available. Available commands are {0}",this.broadcastState.commands),Promise.reject(this.createNewError(y.constants.commands.updateMediaState,y.constants.errorCode.Invalid_Command,"updateMediaState command not available"));let n={};return n.ver=1,n.command=new u(this.utilityService,e,t,i),this.executeProducerRequest(n,o.updateMediaState)})}restart(){return this.validateProducerCommand(y.constants.commands.restart).then(()=>{if(!this.broadcastState.commands.restart)return this.logger.error("Restart command not available. Available commands are {0}. CallId {1}",this.broadcastState.commands,this.call.callId),Promise.reject(this.createNewError(y.constants.commands.restart,y.constants.errorCode.Invalid_Command,"Restart command not available"));let e={};return e.command=new c(this.utilityService),e.ver=1,this.executeProducerRequest(e,o.restart)})}joinModality(e){return this.modalityState!==n.BroadcastModalityState.Ringing&&this.modalityState!==n.BroadcastModalityState.Disconnected?(this.logger.error("Cannot join. current state {0}-{1}",this.modalityState,this.disconnectReason),Promise.reject("Cannot join as current state is not ringing or disconnected")):(this.modalityStateManager.setModalityState(n.BroadcastModalityState.Connecting),this.joinModalityInternal(2,e).then(()=>{this.modalityStateManager.setModalityState(n.BroadcastModalityState.Connected)},e=>(this.modalityStateManager.setModalityState(n.BroadcastModalityState.Disconnected),this.logger.error("Error while connecting to the BMC link {0}",e),Promise.reject(e))))}metadataChanged(e){let t;if(e&&this.serializedMetadata!==e)try{if(!(t=!e||(0,a.isEmpty)(e)?null:JSON.parse(e)))return void this.logger.error("Metadata from BMC is null");let i=t.broadcastState;this.logBroadcastState(i,void 0===this.metadata),this.onValidCallState(e,e=>{this.serializedMetadata=e;let n=this.metadata;this.metadata=t,this.handleBroadcastControllerUrlChange(n,t),this.handleBroadcastStateCallbackUrlChange(n,t),this.broadcastState=i,this.raiseChanged(),this.modalityHealthWatcher&&this.modalityHealthWatcher.metadataChanged()})}catch(t){this.logger.error(`Failed to parse the raw broadcast metadata blob. Error: ${t}, Broadcast metadata: ${e}`)}}joinModalityInternal(e,t){if(!this.metadata.broadcastControllerUrl)return this.logger.error("No broadcast controller url"),Promise.reject("No broadcast controller url");if(this.call.state===n.CallState.Disconnected||this.call.state===n.CallState.Disconnecting)return this.logger.error("Call is in disconnect or disconnecting state {0}",this.call.state),Promise.reject({code:y.constants.errorCode.CallState_Invalid,message:"Call is in disconnect or disconnecting state"});this.logger.info("Attempting to join BMC modality");let i=this.buildRequestHeaders(),a=new Promise(e=>{this.authenticationService.getAuthTokens([this.appConfig.bmcAuthResource()]).then(t=>{e(t)}).catch(t=>{this.logger.error(`Error while getting auth token for BMC: ${t}`),e(null)})}),r=new Promise(e=>{this.authenticationService.getUserInformation().then(t=>{e(t.userName)}).catch(t=>{this.logger.error(`Error while getting userInfo: ${t}`),e("")})});return a.then(e=>r.then(i=>{let n={participants:{from:{id:this.sxConfig.getCurrentSkypeMri(),displayName:i,endpointId:this.call.endpointId,participantId:this.call.participantId,languageId:"en-US"}},observationLinks:{sessionUpdate:this.metadata.broadcastStateCallbackUrl,sessionEnd:this.metadata.broadcastStateCallbackUrl}};return t&&(n.broadcast={roleHint:t}),e&&!this.appConfig.disableUserTokenToCSForBroadcast()&&(n.broadcast||(n.broadcast={}),n.broadcast.userToken=e),n})).then(t=>this.httpClient.post(this.metadata.broadcastControllerUrl,i,t,"join-bmc",e)).then(e=>{if(!e.broadcast||!e.broadcast.role)throw Error(this.utilityService.format("Invalid response format for the join response. MessageId {0}",i[y.constants.headers.MESSAGE_ID]));this.role=e.broadcast.role,this.links[y.constants.links.PRODUCER]=e.links.producer,this.links[y.constants.links.CONTRIBUTOR]=e.links.contributor,this.links[y.constants.links.PARTICIPANTSESSION]=e.links.participantSession,this.logger.log("New state from join"),this.role===y.constants.role.producer?this.broadcastState=e.broadcast.producerState:this.broadcastState=e.broadcast.contributorState,this.logBroadcastState(this.broadcastState)}).catch(e=>(this.logger.error("Failed to join BMC modality"),Promise.reject(e)))}setModalityState(e,t=!0){e!==this.modalityState&&(this.logger.info("Setting modality state from {0} to {1}",this.modalityState,e),this.modalityState=e,t&&this.raiseChanged())}dispose(){!this.isDisposed&&(this.isDisposed=!0,this.logger.info("Disposing the broadcast meeting"),this.commandResponseWatcher.dispose(),this.modalityHealthWatcher&&this.modalityHealthWatcher.dispose(),this.callDisposable&&(this.callDisposable.dispose(),this.callDisposable=void 0))}executeProducerRequest(e,t,i=75){let n=this.buildRequestHeaders();return Promise.resolve().then(()=>this.httpClient.post(this.links[y.constants.links.PRODUCER],n,e,`broadcast-${t}`)).then(()=>t===o.restart?(this.logger.info("Broadcast {0} command {1} with messageId {2} has been executed successfully",t,e.command.id,n[y.constants.headers.MESSAGE_ID]),Promise.resolve({id:e.command.id,name:e.command.name,result:"success",detail:null})):(this.logger.info("Broadcast {0} command {1} with messageid {2} has been accepted",t,e.command.id,n[y.constants.headers.MESSAGE_ID]),this.commandResponseWatcher.waitForCommandResponse(t,e.command.id,i))).then(()=>{this.logger.info("Broadcast {0} command {1} with messageId {2} has been executed successfully",t,e.command.id,n[y.constants.headers.MESSAGE_ID])}).catch(i=>(this.logger.error("Error occurred while executing {0}. Command Id {1}. MessageId {2}. Error {3}",t,e.command.id,n[y.constants.headers.MESSAGE_ID],i),Promise.reject(i)))}validateProducerCommand(e){return this.role!==y.constants.role.producer?(this.logger.error('Current role is not producer, so exiting command. Expected role "producer". Actual {0}',this.role),Promise.reject(this.createNewError(e,y.constants.errorCode.Invalid_Role,"Invalid role for the caller"))):this.validateCommand(e)}validateCommand(e){return this.modalityState!==n.BroadcastModalityState.Connected?(this.logger.error("Broadcast modality is not connected"),Promise.reject(this.createNewError(e,y.constants.errorCode.NotConnected,"Broadcast modality is not connected"))):this.broadcastState&&this.broadcastState.commands?Promise.resolve():(this.logger.error("Invalid producer state"),Promise.reject(this.createNewError(e,y.constants.errorCode.Unknown,"Invalid producer state")))}handleBroadcastControllerUrlChange(e,t){if(this.modalityState!==n.BroadcastModalityState.None)return this.logger.info("Skipping modality join as it is either connected or connecting {0}",this.modalityState),Promise.resolve();let i=t.broadcastControllerUrl;if(!i)return this.logger.warn("Join link not yet available. Waiting for BMC join link"),Promise.resolve();e&&e.broadcastControllerUrl!==i&&this.logger.warn("Broadcast controller url changed from the previous url. State {0}",this.getNonPIIState(t)),this.modalityStateManager.setModalityState(n.BroadcastModalityState.Ringing)}handleBroadcastStateCallbackUrlChange(e,t){if(!e||!e.broadcastStateCallbackUrl)return void this.logger.info("No old metadata present. This might be the first metadata event");if(this.modalityState!==n.BroadcastModalityState.Connected)return void this.logger.info("Skipping callback url registration change as state is not connected {0}",this.modalityState);if(e.broadcastStateCallbackUrl===t.broadcastStateCallbackUrl)return void this.logger.info("Skipping callback url registration change as callback url has not changed");this.logger.warn("Broadcast callback url changed. trying to join again");let i=this.loggingService.newScenario(r.RG.BroadcastUpdateCallbackurl);i.cancelIfOffline=!0,this.joinModalityInternal().then(()=>{i.stop({callId:this.call.callId,participantId:this.call.participantId})},e=>{this.logger.error("Cannot update the callback url. {0}",e),i.fail({callId:this.call.callId,participantId:this.call.participantId}),this.modalityStateManager.setModalityState(n.BroadcastModalityState.Disconnected)})}registerCallbackOnCallConnected(e,t){if(t&&this.call){if(this.call.state===n.CallState.Connected)return void t();!this.callbackFunctions[e]&&(this.callbackFunctions[e]=t,this.callDisposable||(this.callDisposable=this.call.on("callStateChanged",()=>{if(this.call.state!==n.CallState.Connected)return void this.logger.info("User not in connected state.");this.logger.info("User seems to be admitted to the meeting now."),(0,a.each)(this.callbackFunctions,e=>e()),this.callbackFunctions={},this.callDisposable&&(this.callDisposable.dispose(),this.callDisposable=void 0)})))}}onValidCallState(e,t){return this.call?this.call.state!==n.CallState.InLobby?void t(e):void(this.logger.warn("User is in lobby state. Wait for user call to be connected"),this.registerCallbackOnCallConnected("onValidCallState",()=>{t(e)})):void this.logger.error("Invalid call object. Ignoring metadata change")}logBroadcastState(e,t=!1){t||this.logger.info("Broadcast state: {0}",JSON.stringify(this.getNonPIIState(e)))}getNonPIIState(e){return e?(0,a.pick)(e,["commands","error","sequenceNumber","status","commandStatus","sources","layout","previewSourceId"]):(this.logger.error("empty broadcast state logged"),{})}buildRequestHeaders(){return{[y.constants.headers.CORRELATION_ID]:this.call.callId,[y.constants.headers.PARTICIPANT_ID]:this.call.participantId,[y.constants.headers.PARTICIPANT_ID]:this.call.participantId,[y.constants.headers.MESSAGE_ID]:this.utilityService.generateUUID(),[y.constants.headers.X_MS_CLIENT_VERSION]:this.clientVersion}}createNewError(e,t,i){return{command:e,errorCode:t,message:i}}}y.constants=C.TC},32558:function(e,t,i){i.d(t,{W:()=>h});var n=i(370574),a=i(892891),r=i(575810),o=i(654807),s=i(945761),l=i(265466),c=i(395250),d=i(58741);let g="unknown";class h{constructor(e,t,i,n,a,r,o=s.Wq,c){this.config=e,this.callSupportDetector=t,this.loggingService=i,this.platformDetectService=n,this.eventingService=a,this.utilityService=r,this.promiseFactory=o,this.asObservable=c,this.callingStackSubscriptions=[],this.callConstraintEventQueue=[],this.apiCapabilities={},this.callingStackState=l.v.Uninitialized,this.logger=i.newLogger("callingAgents"),this.versions={tsCalling:e.getTsCallingVersion(),slimCore:g,builtInSlimCore:g},this.environmentSupport=this.setEnvironmentSupport(),this.convServiceOverrideUrl=e.convServiceOverrideUrl(),c&&(c.registerStartTrackingForType(this.startTrackingForType.bind(this)),c.registerStopTrackingForType(this.stopTrackingForType.bind(this))),this._nativeMeetingStageCapability={enabled:!1,level:0}}disposeService(e){return this.disposeCallingStackSubscriptions(),this.initPromise=void 0,Promise.resolve()}init(e,t){if(this.initPromise)return this.initPromise;if(this.callingStackState=l.v.Initializing,e.appendEventData({initCallingStack:!0}),this.environmentSupport===o.Ln2.NotSupported){let e={name:"BrowserNotSupported",message:"Browser not supported",callSupport:n.CallSupport.BrowserNotSupported};return this.callSupportDetector.setCallSupport(n.CallSupport.BrowserNotSupported),this.logger.error("Failed to initialize callingAgentsService. Environment not supported"),this.initPromise=this.promiseFactory.reject(e)}return this.initPromise=this.initCallingStack(e,t).then(e=>{this.callingInitCallback(e)}).then(()=>{this.config.enableVDICallConstraints?.()&&this.handleVDICallConstraintEventQueue(e=>this.setCallConstraints(e))}).catch(e=>{let t=(0,a.isNil)(e?.callSupport)?void 0:e.callSupport,i=this.config.enableCallingStackInitErrorMessageLogging?.()?`callSupport:${t}:${e?.message||JSON.stringify(e)}`:`callSupport:${t}:loggingTurnedOff:length=${e?.message?.length}`,n=this.config.enableCallingStackInitErrorMessageLogging?.()?e?.stack:`stackLength=${e?.stack?.length}:stackLine=${e?.stack?.split?.("\n").length}`,r=Error(i);return r.stack=n,this.logger.error(`Failed to initialize ${this.getName()}. Error: ${JSON.stringify({name:r.name,message:r.message,stack:r.stack})}`),this.callSupportDetector.setCallSupport(t),this.promiseFactory.reject(r)})}setCallConstraints(e){this.callingStack?(this.logger.info(`setCallConstraints: ${JSON.stringify(e)} call constraint set`),this.callingStack.setPlatformCallConstraints(e)):(this.callConstraintEventQueue.push(e),this.logger.info(`setCallConstraints: ${JSON.stringify(e)} call constraint pushed into queue`))}createNdi(e,t,i){this.logger.info("Could not initialize NDI: Unsupported platform")}getSlimCoreInstance(){this.logger.info("Could not get slimcore instance: Unsupported platform")}checkConnection(){this.logger.info("Check connection request")}extendedCallingStackTelemetryEnabled(){return this.config.enableExtendedCallingStackTelemetry?.()??!1}getApiCapabilities(){return this.apiCapabilities}getInitPromise(){return this.initPromise}getCallSupportDetector(){return this.callSupportDetector}getEnvironmentSupport(){return this.environmentSupport}getDeviceManager(){return this.getDeviceManagerInternal()}getCallingStack(){return this.callingStack}getCallFeedback(){return this.callingStack?this.callingStack.getCallFeedback():void 0}getAiMdp(){return this.callingStack?this.callingStack.getAiMdp():void 0}getE911Info(){if(!this.config.enableDynamicEmergencyCalling())return this.promiseFactory.reject("[e911] Feature flag is disabled");if(!this.initPromise)return this.promiseFactory.reject("[e911] Init not yet called");if(!this.callingStack||!this.callingStack.getE911Info){let e=this.callingStack?"[e911] callingStack.getE911Info does not exist":"[e911] callingStack does not exist";return this.logger.info(e),this.promiseFactory.reject(e)}return this.logger.info("[e911] invoked callingStack.getE911Info"),this.callingStack.getE911Info()}getGeolocationCapabilityState(){if(!this.callingStack||!this.callingStack.getGeolocationCapabilityState){let e=this.callingStack?"[e911] callingStack.getGeolocationCapabilityState does not exist":"[e911] callingStack does not exist";return this.logger.info(e),this.promiseFactory.reject(e)}return this.logger.info("[e911] invoked callingStack.getGeolocationCapabilityState"),this.callingStack.getGeolocationCapabilityState()}isVMSSMode(){return!1}setAllowPrivacySensitiveApis(e){if(!this.callingStack||!this.callingStack.setAllowPrivacySensitiveApis){let e=this.callingStack?"callingStack.setAllowPrivacySensitiveApis does not exist":"callingStack does not exist";this.logger.info(e);return}return this.logger.info(`invoked callingStack.setAllowPrivacySensitiveApis with [${e}]`),this.callingStack.setAllowPrivacySensitiveApis(e)}getGeoLocationInfo(){if(!this.config.enableDynamicEmergencyCalling())return this.promiseFactory.reject("[e911] Feature flag is disabled");if(!this.initPromise)return this.promiseFactory.reject("[e911] Init not yet called");if(!this.callingStack||!this.callingStack.getLocationInfo){let e=this.callingStack?"[e911] callingStack.getLocationInfo does not exist":"[getGeoLocationInfo] callingStack does not exist";return this.logger.info(e),this.promiseFactory.reject(e)}return this.logger.info("[e911] invoked callingStack.getLocationInfo"),this.callingStack.getLocationInfo()}getScreenSharingManager(){return this.callingStack.getScreenSharingManager()}whenMediaLoaded(){return Promise.resolve()}getPlatformType(){if(this.config.isDesktopApp())return"electron";switch(this.platformDetectService.getBrowser()){case r.gT.browser.edge:return"edge";case r.gT.browser.edgeChromium:case r.gT.browser.chrome:return"chrome";case r.gT.browser.firefox:return"firefox";case r.gT.browser.ie:return"ie";case r.gT.browser.safari:return"safari";default:return"unknown"}}getVersions(){return this.versions}duckSpeakerVolume(e){this.logger.info("Duck speaker volume: not implemented")}unduckSpeakerVolume(){this.logger.info("Unduck speaker volume: not implemented")}processProbeDevicesStatusChanged(e){return!1}createVoipCallCoordinator(){return null}createCallRegistry(e,t,i=!1){if(!this.callingStack||!this.callingStack.createCallRegistry){let e=this.callingStack?"[createCallRegistry] callingStack.createCallRegistry does not exist":"[createCallRegistry] callingStack does not exist";return this.logger.info(e),this.promiseFactory.reject(e)}return this.logger.info("[createCallRegistry] invoked callingStack.createCallRegistry"),this.callingStack.createCallRegistry(e,void 0,this.extendedCallingStackTelemetryEnabled()?{main:(0,d.O)(t,!0,"tscalling_",this.logger),companion:this.isVMSSMode()&&i?(0,d.O)(this.loggingService.newScenario(c.RG.SlimcoreVdiCreateVMSSCompanionCallRegistry),!1,"tscalling_",this.logger):void 0}:void 0)}getVideoCapabilityLimits(){if(!this.config.isLedApiEnabled())return this.logger.info("[videoCapabilityLimits] Feature flag is disabled"),null;if(!this.initPromise)return this.logger.info("[videoCapabilityLimits] Init not yet called"),null;if(!this.callingStack||!this.callingStack.getVideoCapabilityLimits){let e=this.callingStack?"[videoCapabilityLimits] callingStack.videoCapabilityLimits does not exist":"[videoCapabilityLimits] callingStack does not exist";return this.logger.info(e),null}return this.logger.info("[videoCapabilityLimits] invoked callingStack.getVideoCapabilityLimits"),this.callingStack.getVideoCapabilityLimits()}shouldSuppressCallActiveSpeakerEvents(){return this.config.suppressCallActiveSpeakerEvents?.()}getState(){return this.callingStackState}subscribe(e,t,i){return this.asObservable.subscribe((t,i)=>e(i),t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}setMediaConfiguration(e){if(!this.callingStack)throw Error("Cannot set media config. Calling stack is not available.");return this.setMediaConfigEntry(e,this.callingStack)}on(e,t){if(!this.callingStack)throw Error("Cannot subscribe to agents service. Calling stack is not available.");return this.callingStack.on(e,t)}getDeviceManagerInternal(){if(!this.callingStack)return void this.logger.warn("Calling stack is null");let e=this.callingStack.getDeviceManager();return e||this.logger.warn("Device manager is null"),e}trigger(e,t,i){this.asObservable.trigger(e,t,i)}startTrackingForType(e,t){"nrgLevelsChanged"===e&&this.startNrgLevelsSubscription(t)}stopTrackingForType(e,t){"nrgLevelsChanged"===e&&this.stopNrgLevelsSubscription(t)}initSubscriptions(){if(!this.callingStack)return void this.logger.warn("Couldn't init subscription. callingStack is undefined");this.config.enableDynamicEmergencyCalling()&&this.callingStackSubscriptions.push(this.callingStack.on("e911InfoChanged",(e,t)=>{let i={...e,geoCoordinates:t.geoCoordinates};this.trigger("e911InfoChanged",void 0,i)})),this.config.isLedApiEnabled()&&this.callingStackSubscriptions.push(this.callingStack.on("videoCapabilityLimitsChanged",e=>{this.trigger("videoCapabilityLimitsChanged",void 0,e)})),this.config.isNetworkInfoChangeEnabled()&&this.callingStackSubscriptions.push(this.callingStack.on("networkInfoChanged",e=>{let t=this.utilityService.generateUUID(),i=Date.now();this.trigger("networkInfoChanged",void 0,{netInterfaces:e,correlationId:t,detectedTime:i})}))}callingInitCallback(e){this.callingStack=e,this.callSupportDetector.setCallSupport(n.CallSupport.Supported),this.initSubscriptions(),this.getE911InfoOnInit(),this.logger.log("Retrieved calling stack and set callSupport")}getE911InfoOnInit(){this.getE911Info().then(e=>{this.trigger("e911InfoChanged",void 0,e)}).catch(e=>{this.logger.warn(`[getE911InfoOnInit] Failed with error: ${e?.message||e}`)})}getConversationServiceUrl(e){return this.convServiceOverrideUrl||e}disposeCallingStackSubscriptions(){(0,a.remove)(this.callingStackSubscriptions,e=>()=>(e.dispose(),!0))}setEnvironmentSupport(){let e=o.Ln2.NotSupported,t=this.getPlatformType();if("electron"===t)e=o.Ln2.FullySupported,this.platformDetectService.getOS()!==r.gT.os.linux||this.config.callingEnabledLinux()||(e=o.Ln2.NotSupported);else if(this.config.isSupportedBrowser(t)){let i=this.config.getMinimumSupportedBrowserVersion(t);(!i||this.utilityService.compareVersions(this.platformDetectService.getBrowserVersion(),i)>=0)&&(e=o.Ln2.FullySupported)}return e}handleVDICallConstraintEventQueue(e){if(this.callingStack)for(;this.callConstraintEventQueue.length;){let t=this.callConstraintEventQueue.shift();e(t),this.logger.info(`handleVDICallConstraintEventQueue: Queued ${JSON.stringify(t)} handled, events left: ${this.callConstraintEventQueue.length}`)}else this.logger.warn("handleVDICallConstraintEventQueue: callling stack not initialized"),this.callConstraintEventQueue.splice(0,this.callConstraintEventQueue.length)}}},265466:function(e,t,i){var n,a;i.d(t,{v:()=>n}),(a=n||(n={}))[a.Failed=0]="Failed",a[a.Uninitialized=1]="Uninitialized",a[a.Initializing=2]="Initializing",a[a.Initialized=3]="Initialized",a[a.Reinitializing=4]="Reinitializing",a[a.Disposing=5]="Disposing",a[a.Disposed=6]="Disposed"},817324:function(e,t,i){i.d(t,{d:()=>C});var n=i(370574),a=i(892891),r=i(352320),o=i(575810),s=i(665405),l=i(945761);class c{constructor(e,t,i){this.logger=e,this.config=t,this.isNoiseSuppressionEnabled=i}async getAudioEffectProvider(){if(!this.isNoiseSuppressionEnabled)return null;try{let{AudioEffectProvider:e}=await this.config.ensureWasmVqeLoaded();return new e(this.logger)}catch(e){throw this.logger.error(`Failed to load wasmVqe bundle with error: ${e?.message}`),e}}}class d{constructor(e,t,i){this.logger=e,this.config=t,this.isNoiseSuppressionEnabled=i}async getAudioEffectProvider(){return this.isNoiseSuppressionEnabled?new Promise((e,t)=>{this.config.ensureWasmAecLoaded().then(t=>{let i=this.config.isTeams2?t.AudioEffectProvider:this.config.getWasmAecProvider();this.logger.info(`WasmAec bundle loaded successfully WasmAecProvider:${!!i}`),e(new i(this.logger))}).catch(e=>{this.logger.error(`Failed to load WasmAec bundle with error: ${e}`),t(e)})}):(this.logger.info("Noise suppression is disabled"),null)}}class g{constructor(e,t,i){this.logger=e,this.config=t,this.isNoiseSuppressionEnabled=i}async getAudioEffectProvider(){return this.isNoiseSuppressionEnabled?new Promise((e,t)=>{this.config.ensureWasmDnsLoaded().then(t=>{let i=this.config.isTeams2?t.AudioEffectProvider:this.config.getWasmDnsProvider();this.logger.info(`WasmDns bundle loaded successfully WasmDnsProvider:${!!i}`),e(new i(this.logger))}).catch(e=>{this.logger.error(`Failed to load WasmDns bundle with error: ${e}`),t(e)})}):(this.logger.info("Noise suppression is disabled"),null)}}class h{constructor(e,t,i){this.logger=e,this.config=t,this.isbackGroundEffectEnabled=i}async getVideoEffectProvider(){return this.isbackGroundEffectEnabled?new Promise((e,t)=>{this.config.ensureWebCvLoaded().then(({VideoEffectProvider:t})=>{e(new(t??this.config.getWebCvVideoEffectProvider())(this.logger))}).catch(e=>{this.logger.error(`Failed to load Webcv bundle with error: ${e}`),t(e)})}):null}async getModelConfig(){return{modelUrl:"",weightPathPrefix:""}}}var p=i(395250),u=i(32558),m=i(654807);class _{constructor(e,t){this.context=e,this.parentService=t}debug(e,...t){return this.parentService.logMessage(this.context,e,t,m.ini.Info)}error(e,...t){return this.parentService.logMessage(this.context,e,t,m.ini.Error,this.parentService.captureStackTrace(null,1))}info(e,...t){return this.parentService.logMessage(this.context,e,t,m.ini.Info)}log(e,...t){return this.parentService.logMessage(this.context,e,t,m.ini.Info)}get service(){return this.parentService}warn(e,...t){return this.parentService.logMessage(this.context,e,t,m.ini.Warn)}}var S=i(265466);class C extends u.W{constructor(e,t,n,a,r,o,s,c,d,g,h,p,u,m,_,S,C,v=l.Wq,f){super(e,_,a,g,r,m,v,f),this.desktopUtilityService=t,this.authenticationService=n,this.meetingPolicySettingsStore=o,this.telemetryService=s,this.trouterService=c,this.httpRequestDispatcher=d,this.retryService=h,this.teamsMeetingConfiguration=u,this.vdiService=S,this.settings={enableCCWM:!0,enablePreheat:!0,enableStructuredMeetings:!0,enableRaiseHands:!0,enableSendMediaModalities:!1,enableSpotlight:!0,enableMappedParticipants:!1,enableCallMergeParticipants:!0,enableCallMergeWithPickupCode:!0,enableMusicOnHoldV2:!0,enableSafeTransfer:!1,enableAttendeeRestrictions:!0,enableBreakoutRooms:!0,enableUnrestrictingAttendees:!0,enableSLAv2:!0,enableInteractivityForStreamingUsers:!0,supportsNudgeFromStreamingIntoRealTime:!0,enableSignerSelfIdentification:!0,enableSignerInterpreterTethering:!0,enableUnifiedStack:!0,enableLiveInterpretation:!0,enableE2EEncryption:!0,enableTokenAPI:!1},this.getAudioWorklets=()=>{let e=`${this.platformDetectService.getStaticsPath()}${this.config.teamsSettings.dnsWorkletURL?.()}`,t=`${this.platformDetectService.getStaticsPath()}${this.config.teamsSettings.aecWorkletURL?.()}`,n=new URL(i(614845),i.b),a=new URL(i(362740),i.b),r=new URL(i(900657),i.b),o=new URL(i(814948),i.b);return{getWasmDnsWorklet:()=>Promise.resolve(e),getWasmAecWorklet:()=>Promise.resolve(t),getWasmVqeWorklet:()=>Promise.resolve(n),getEncodedStreamsTimerWorklet:()=>Promise.resolve(a),getEncodedStreamsDecoderWorklet:()=>Promise.resolve(r),getEncodedStreamsRendererWorklet:()=>Promise.resolve(o)}},this.versions.slimCore=void 0,this.versions.builtInSlimCore=void 0,this.adminSettingsStore=p,this.tokenProvider=()=>n.getSkypeToken(),this.telemetryContextProvider=()=>({...this.loggingService.getContext(),"AppInfo.UserRole":{value:this.authenticationService.getTelemetryUserRole()},"AppInfo.UserType":{value:this.authenticationService.getLoggedInUser().type},"DeviceInfo.Id":{value:this.loggingService.deviceId()},platformId:{value:this.platformDetectService.getPlatformId?.()},isTeams2:{value:!!this.config.isTeams2}})}async getSpeakerVolumeAsync(){return this.logger.warn("getSpeakerVolumeAsync is not implemented in pluginless calling stack"),Promise.resolve(this.speakerVolume)}async setSpeakerVolumeAsync(e){return this.logger.warn("setSpeakerVolumeAsync is not implemented in pluginless calling stack"),this.speakerVolume=e,Promise.resolve()}getNodeId(){return this.config.getNodeId()}getRegistrarUrl(){return this.trouterService.registrarUrl}createFrameSink(){return null}createMediaAssembler(e){}getDefaultSetting(e){return this.settings[e]}getSlimcoreEcsConfig(){return null}disposeCallingStack(){return this.callingStack?this.callingStack.dispose():(this.logger.warn("[disposeCallingStack] Calling stack is not initialized yet"),Promise.resolve())}setupCompanionSlimCoreInstance(e,t){throw Error("Method not implemented.")}teardownCompanionSlimCoreInstance(e){throw Error("Method not implemented.")}reinitCallingStack(e,t){return this.config.enablePluginlessCallingStackReinit?.()?this.initCallingStack(e).then(e=>{this.callingInitCallback(e)}).catch(e=>this.promiseFactory.reject(e)):Promise.reject(Error("Method not implemented."))}checkConnection(){this.logger.info("Check connection request"),this.trouterService.checkConnection("callingStack")}initiateWebBackgroundBlurServiceLoad(){this.config.ensureWebCvLoaded()}initiateVqeAudioEffectServiceLoad(){return this.logger.info("loading wasmVqe calling initiateVqeAudioEffectServiceLoad"),this.config.ensureWasmVqeLoaded().then(()=>{this.logger.info("loading wasmVqe completed ")})}initiateAudioEffectServiceLoad(){return this.logger.info("loading wasmDns & wasmAec calling initiateAudioEffectServiceLoad"),Promise.all([this.config.ensureWasmAecLoaded(),this.config.ensureWasmDnsLoaded()]).then(()=>{this.logger.info("loading wasmDns & wasmAec completed ")})}getCallRegistry(){return this.callingStack.getCallRegistry()}unmuteSpeaker(){return Promise.reject(Error("unmuteSpeaker is not implemented"))}unmuteMicrophone(){return Promise.reject(Error("unmuteMicrophone is not implemented"))}async supportsLatestLoopbackDriver(){let e=this.getDeviceManager();if(!e)throw this.logger.error("supportsLatestLoopbackDriver(): Cannot find Slimcore Instance"),Error("Cannot find Slimcore Instance");if(!n.AudioFeatureType.LatestLoopbackDriver)throw this.logger.error("supportsLatestLoopbackDriver(): TsCalling package version is too old"),Error("TsCalling package version is too old");try{let t=await e.getAudioFeatureCapability(n.AudioFeatureType.LatestLoopbackDriver);return this.logger.info(`[supportsLatestLoopbackDriver]: feature capability returned ${t}`),!!t}catch(e){throw this.logger.warn(`[supportsLatestLoopbackDriver]: feature capability failed ${e}`),Error(`feature capability failed ${e}`)}}supportsDeepNoiseSuppression(){let e=this.getDeviceManager();return e?e.getAudioFeatureCapability(n.AudioFeatureType.HighNoiseSuppression).then(e=>(this.logger.info(`[supportsDeepNoiseSuppression]: feature capability returned ${e}`),Promise.resolve(0!==e))).catch(e=>(this.logger.error(`[supportsDeepNoiseSuppression]: feature capability failed ${e}`),Promise.resolve(!1))):(this.logger.error("supportsDeepsNoiseSuppression(): Cannot find calling stack Instance"),Promise.resolve(!1))}supportsPersonalNoiseSuppression(){let e=this.getDeviceManager();return e?Promise.all([e.getAudioFeatureCapability(n.AudioFeatureType.HighNoiseSuppression),e.getAudioFeatureCapability(n.AudioFeatureType.PersonalizedNoiseSuppression)]).then(([e,t])=>(this.logger.info(`[supportsPersonalNoiseSuppression]: High noise suppression capability returned ${e}, Personalized noise suppression capability returned ${t}`),Promise.resolve(0!==e&&0!==t))).catch(e=>(this.logger.error(`[supportsPersonalNoiseSuppression]: feature capability failed ${e}`),Promise.resolve(!1))):(this.logger.error("supportsPersonalNoiseSuppression(): Cannot find calling stack Instance"),Promise.resolve(!1))}toggleHWMuteSync(e){return Promise.resolve()}enableAGC(e){return Promise.resolve()}generateCauseId(){return this.config.generateCauseId()}getName(){return"callingStackAgentsService"}toggleMediaStackLoggingValues(e){}mediaStackLoggingEnabled(){return!1}adminEnabledMediaLogging(){return!1}isDynamicMediaLoggingEnabled(){return!1}isMediaLoggingDisabled(){return!0}createCompositor(e,t){this.logger.info("createCompositor - compositor host not supported")}getPreferredRendererConfig(){this.logger.info("getPreferredRendererConfig - compositor host not supported")}async initNativeMeetingStageCapability(e=!0){if(!this.callingStack)return this.logger.warn("[getNativeMeetingStageCapability] Calling stack is not initialized yet"),this._nativeMeetingStageCapability;let t=await this.callingStack.getStageCapability();return e&&(this._nativeMeetingStageCapability=t),t}getNativeMeetingStageCapability(){return this._nativeMeetingStageCapability}isCompositorAvailable(){return!1}isCompositorGpuPipelineEnabled(){return!0}resendRegistration(e){return Promise.resolve().then(()=>this.trouterService.resendRegistration(e))}getNrgLevelsForDeviceTuner(e){return Promise.reject(Error("Method not implemented."))}isSlimCoreInstanceRunning(){throw Error("Method not implemented.")}getBTTransportStack(){throw Error("Method not implemented.")}initializeBetterTogether(e){throw Error("Method not implemented.")}checkSlimcoreVersionForBetterTogether(){return!1}startNrgLevelsSubscription(e){throw Error("Method not implemented.")}stopNrgLevelsSubscription(e){throw Error("Method not implemented.")}getRegistrationId(){throw Error("Method not implemented.")}aggregateDiagnosticLogs(){throw Error("Method not implemented.")}extendBrbFeedback(){throw Error("Method not implemented.")}addOcclusion(){return Promise.reject(Error("Method not implemented."))}removeOcclusion(){return Promise.reject(Error("Method not implemented."))}handleLoggingEvent(e,t){throw Error("Method not implemented.")}hasTokenApiMinPluginlessVersion(){return this.config.teamsSettings.shouldReadTokenApiMinPluginlessVersion?.()&&this.utilityService.compareVersions(this.config.getTsCallingVersion(),this.config.teamsSettings.tokenApiMinPluginlessVersion?.())>=0}setMediaConfigEntry(e,t){return t?t.setMediaConfig(e):Promise.reject(Error("Calling stack is not available"))}initCallingStack(e,t){return this.setTelemetryContextProviderWithUserRegionMetadata().then(()=>{this.logger.info("[setTelemetryContextProviderWithUserRegionMetadata]: Successfully set telemetry context provider with userRegion metadata.")}).catch(e=>{this.logger.error(`[setTelemetryContextProviderWithUserRegionMetadata]: Failed to set telemetry context provider with userRegion metadata. [ErrorName: ${e.name}, ErrorMessage: ${e.message}]`)}).then(()=>this.config.enableCallingStackInitRetry?.()?this.initCallingStackWithRetry(e):this.initCallingStackWithoutRetry(e))}setMediaConfig(e){return Promise.all([Promise.resolve(),this.setAdminSettings(e),this.setMediaBitRateKb(e)]).then(()=>{})}setAdminSettings(e){let t=this.config.teamsSettings.adminSettingsEnabled();return(this.logger.info("adminSettingsEnabled = {0}",t),t)?this.adminSettingsStore.whenInitialized().then(()=>{let t=(0,a.cloneDeep)(this.adminSettingsStore.getSettings()),i=t.conferencingConfigurationSetting,n={audioMin:i.clientAudioPort,audioMax:i.clientAudioPort+i.clientAudioPortRange-1,videoMin:i.clientVideoPort,videoMax:i.clientVideoPort+i.clientVideoPortRange-1,dataMin:i.clientAppSharingPort,dataMax:i.clientAppSharingPort+i.clientAppSharingPortRange-1,vbssMin:i.clientAppSharingPort,vbssMax:i.clientAppSharingPort+i.clientAppSharingPortRange-1};this.logger.info("adminSettings: mediaPortRanges = {0}",n);let r=t.mediaConfigurationSetting.enableInCallQoS;return this.logger.info("adminSettings: enableQoS = {0}",r),e.setMediaConfig({mediaPortRanges:n,enableMediaQoS:r}).then(()=>this.logger.info("adminSettings completed"))}).then(()=>this.setTeamsMeetingConfigurationToPluginless(e)).then(()=>{}).catch(e=>{new s.H("pluginless-calling",this.logger).error(e)}):Promise.resolve()}setTeamsMeetingConfigurationToPluginless(e){let t=this.loggingService.newScenario(p.RG.CallingAgentQosSetting,null,null,null,!0),i=this.config.teamsSettings.enableQos();return this.logger.info("Start setTeamsMeetingConfigurationToPluginless, enableQos = {0}",i),(i?this.teamsMeetingConfiguration.getTeamsMeetingConfiguration():this.promiseFactory.resolve()).then(n=>{if(i){this.logger.info("setTeamsMeetingConfigurationToPluginless, teamsMeetingConfiguration = {0}",n);let t=this.teamsMeetingConfiguration.convertTeamsMeetingConfigurationToPluginless(n),i=t.mediaPortRanges,a=t.enableMediaQoS;return this.logger.info("setTeamsMeetingConfigurationToPluginless: mediaPortRanges = {0}",i),this.logger.info("setTeamsMeetingConfigurationToPluginless: enableMediaQos = {0}",a),e.setMediaConfig({mediaPortRanges:i,enableMediaQoS:a}).then(()=>this.logger.info("setTeamsMeetingConfigurationToPluginless completed"))}t.cancel({message:"enableQos_set_to_false"})}).catch(e=>{t.fail({errorInfo:e}),new s.H("pluginless-calling",this.logger).error(e)})}initCallingStackWithoutRetry(e){let t={startModalityMediaTimeoutInMs:this.config.callSettings.startModalityMediaTimeoutInMs,useLwjForAllCalls:this.config.callSettings.useLwjForAllCalls},i=this.getPluginlessCallingLogger();return this.desktopUtilityService.isWebRTCVdiMode()&&this.vdiService.initVdiSupport(i),e.mark(p.ck.GsLoadingCallingStack),this.loadCallingStack(e).catch(e=>(this.callingStackState=S.v.Failed,this.logger.error("calling stack creation failed on lazyloading"),e={message:e},this.promiseFactory.reject(e))).then(()=>this.trouterService.legacyApiAvailable).then(()=>{e.mark(p.ck.GsCallingStackLoaded);let a={start:()=>{},stop:()=>{},registerMessageHandler:e=>{this.trouterService.registerMessageHandler({handleMessage(t){let i=e.handleMessage(t);if(i)return{isHandled:i.isHandled,resultCode:i.resultCode,responseHeaders:i.responseHeaders,responseBody:i.responseBody}}})},clearMessageHandlers:()=>{this.trouterService.clearMessageHandlers()},checkConnection:()=>{},state:()=>skype.calling.TrouterState.Unknown,clientState:()=>"Unknown",trouterUrl:null};return this.promiseFactory.create(async(o,l)=>{let c,d=this.getPlatformType();this.desktopUtilityService.isDesktopPluginless()&&(i.info("Desktop with Pluginless, setting platform to chrome"),d="chrome");let g={signalingAgentConfig:this.getSignalingAgentConfig(),mediaAgentFactoryConfig:await this.getMediaAgentFactoryConfig(),trouterService:a,logger:new s.A("calling-stack",i),telemetryService:this.telemetryService,platformType:d,callSettings:t,telemetryContextProvider:this.telemetryContextProvider};this.getPluginlessFactory().build(g).then(async e=>(await e.init({stackType:n.StackType.PluginlessStack}),c=e,this.callingStackState=S.v.Initialized,this.config.configProvider.getSkypeConfig(e.getEcsProvider().getEcsQueryParameters()))).then(t=>(t&&(t.SkypeCalling&&this.convServiceOverrideUrl&&(t.SkypeCalling.conversationServiceUrl=this.convServiceOverrideUrl),c.getEcsProvider().setEcsConfig({ecsBlob:JSON.stringify(t),userIdentity:"",etag:t.ETag.ETag})),this.setMediaConfig(c).then(()=>this.logger.log("Initial media config applied")).catch(t=>{let i=`setMediaConfig failed with: ${r.cf.getErrorMessage(t)}`;this.logger.error(i),e.mark(p.ck.GsSetMediaConfigFailed)}),e.mark(p.ck.GsPluginlessStackBuilt),c)).then(o,l)})})}initCallingStackWithRetry(e){return this.retryService.retry("pluginlessInitCallingStackRetry",()=>this.initCallingStackWithoutRetry(e),{forever:!1,retryIntervals:this.getPluginlessRetryIntervals(),retryScenarioName:p.RG.CallingStackInitWithRetry}).promise}getPluginlessRetryIntervals(){let e=this.config.teamsSettings.pluginlessCallingStackInitRetryIntervalsInMs();return e&&0!==e.length?e:[o.gT.timeInMiliseconds.thirtySeconds,o.gT.timeInMiliseconds.minute,o.gT.timeInMiliseconds.twoMinutes,o.gT.timeInMiliseconds.threeMinutes,o.gT.timeInMiliseconds.fiveMinutes]}setMediaBitRateKb(e){let t=this.config.enableMediaBitRateInBps(),i=this.config.teamsSettings.enableNetworkRoamingPolicy();return(this.logger.info("enableMediaBitRateInBps = {0}, enableNetworkRoamingPolicy = {1}",t,i),!t||i)?Promise.resolve():this.meetingPolicySettingsStore.whenInitialized().then(()=>{let t=1e3*this.meetingPolicySettingsStore.getSettingValue("mediaBitRateKb");return e.setMediaConfig({maxBandwidthInBps:t}).then(()=>this.logger.info("setMediaBitRateKb {0} completed",t))}).then(()=>{}).catch(e=>{new s.H("pluginless-calling",this.logger).error(e)})}isWebRtcOneOnOneCallingEnabled(){let e=this.platformDetectService.getBrowser()===o.gT.browser.edgeChromium?o.gT.browser.chrome:this.platformDetectService.getBrowser();return this.config.teamsSettings.isWebRtcOneOnOneCallingEnabled(e)}isWebRtcScreenSharingEnabled(){let e=this.platformDetectService.getBrowser(),t=e;return(e===o.gT.browser.edgeChromium||this.desktopUtilityService.isWebRTCVdiMode())&&(t=o.gT.browser.chrome),this.config.teamsSettings.isWebRtcScreenSharingEnabled(t)}isEdgeScreenSharingEnabled(){return this.platformDetectService.getBrowser()===o.gT.browser.edge&&this.config.teamsSettings.isEdgeScreenSharingEnabled()}isWebRtcMeetingSingleVideoEnabled(){let e=this.platformDetectService.getBrowser()===o.gT.browser.edgeChromium?o.gT.browser.chrome:this.platformDetectService.getBrowser();return this.config.teamsSettings.isWebRtcMeetingSingleVideoEnabled(e)}loadCallingStack(e){return this.retryService.retry("loadCallingStack",()=>this.promiseFactory.create((t,i)=>this.config.ensureCallingStackIsLoaded().catch(t=>(e.mark(p.ck.GsLazyloadingRetry),e.appendEventData({reasonCMD:r.cf.getErrorMessage(t,this.logger,[...r.cf.DEFAULT_PROPS_GET_ERROR_MSG])}),this.promiseFactory.reject(t))).then(t,i))).promise}getPluginlessCallingLogger(){return(this.desktopUtilityService.isWebRTCVdiMode()||!this.config.isDesktopApp())&&this.config.teamsSettings.enableVerbosePluginlessStackLogging()?new _("callingAgents",this.loggingService):this.logger}getPluginlessFactory(){return this.config.getPluginlessStackFactory()}async getMediaAgentFactoryConfig(){let e=this.getPluginlessCallingLogger(),t=this.config.teamsSettings.isVideoBackgroundForWebEnabled()&&this.desktopUtilityService.isWeb(),i=this.config.teamsSettings.isWebRtcWorkerForWebEnabled()&&this.desktopUtilityService.isWeb(),n=this.config.teamsSettings.isAudioEffectForWebEnabled()&&this.desktopUtilityService.isWeb(),a={logger:new s.A("media",e),tokenProvider:this.tokenProvider,telemetryAdapter:this.getTelemetryAdapter(),configProvider:this.config.configProvider,settings:this.getMediaAgentSettings(),httpRequestDispatcher:this.httpRequestDispatcher,detectH264Support:this.config.isH264SupportDetectionEnabled(),appStateProvider:this.config.appStateProvider,webcvProvider:null,wasmdnsProvider:void 0,wasmaecProvider:void 0,wasmVqeProvider:void 0,createWasmWorkerCbs:void 0};if(i){let e=await this.config.getWebRtcWorkerLoader?.();e&&(a.createWasmWorkerCbs={...a.createWasmWorkerCbs,createGenericWebRTCWorker:()=>e()})}if(t){a.webcvProvider=new h(new s.A("webcv",e),this.config,t);let i=await this.config.getWasmWorkerLoader?.();i&&(a.createWasmWorkerCbs={...a.createWasmWorkerCbs,createWasmCVWorker:()=>i()})}if(this.desktopUtilityService.isWeb()){let e=await this.config.getEncodedStreamsWorkerLoader?.();e&&(a.createWasmWorkerCbs={...a.createWasmWorkerCbs,createEncodedStreamsWorker:()=>e()})}if(n&&(a.wasmVqeProvider=new c(new s.A("wasmvqe",e),this.config,n),a.wasmdnsProvider=new g(new s.A("wasmdns",e),this.config,n),a.wasmaecProvider=new d(new s.A("wasmaec",e),this.config,n),this.config.isTeams2)){let e=this.getAudioWorklets();a.createWasmWorkerCbs={...a.createWasmWorkerCbs,audioWorklet:e}}return this.desktopUtilityService.isWebRTCVdiMode()&&this.vdiService.addVdiDomOverrides(a),a}getTelemetryAdapter(){let e={};return{sendEvent:(t,i={})=>{if(!i.id)return void this.loggingService.event(t,i);let{id:n,...r}=i;if((0,a.startsWith)(t,"start_")){let i=this.loggingService.newScenario(`calling_relay_manager_${t.substring(6)}`,null,null,null,!0);i.appendEventData(r),e[n]=i;return}let o=e[n];o&&((0,a.startsWith)(t,"stop_")?((0,a.has)(r,"error")?o.fail(r):o.stop(r),delete e[n]):o.mark(t,r))}}}getMediaAgentSettings(){let e={debug:this.config.mediaAgentSettings.debug,numVideoChannelsGvc:this.config.mediaAgentSettings.numVideoChannelsGvc,requestTimeoutMs:this.config.mediaAgentSettings.requestTimeoutMs};return this.isWebRtcOneOnOneCallingEnabled()&&(e.webrtcAllowedMediaContentType=this.config.teamsSettings.isTeamsForLife()?["application/sdp-ngc-1.0","application/sdp-ngc-0.5","application/sdp"]:["application/sdp-ngc-1.0","application/sdp-ngc-0.5"],e.webrtcMediaContentType="application/sdp-ngc-1.0"),this.isWebRtcScreenSharingEnabled()&&(e.webrtcOutgoingScreenSharingEnabled=!0,e.webrtcGetDisplayMediaEnabled=this.config.teamsSettings.enableChromeGetDisplayMedia()||this.platformDetectService.getBrowser()===o.gT.browser.safari||this.platformDetectService.getBrowser()===o.gT.browser.firefox),e.chromeExtensionId=this.config.mediaAgentSettings.chromeScreenSharingExtensionId(),this.isEdgeScreenSharingEnabled()&&(e.ortcOutgoingScreensharingEnabled=!0),this.isWebRtcMeetingSingleVideoEnabled()||(e.webrtcEnabledTransportCC=!0),e}getSignalingAgentConfig(){let e=this.getConversationServiceUrl(this.config.signalingAgentConfig.defaultConversationServiceUrl()),t=this.getPluginlessCallingLogger();return{conversationServiceUrl:e,trouterUrlGetter:this.trouterService.trouterUrlGetter,logger:new s.A("signaling",t),skypeToken:this.tokenProvider,languageCode:this.config.signalingAgentConfig.languageCode(),clientInformation:this.config.signalingAgentConfig.clientInformation(),emergencyCallCountry:"",doHostlessCalling:!0,shouldServiceSendCallEventMessages:!0,shouldServiceSendNGCUpgradeMessages:!1,supportsHostlessGroupCalls:!0,isGVCOutgoingEnabled:!0,isGVCJoiningEnabled:!0,isWebRtcEnabled:this.config.signalingAgentConfig.isWebRtcEnabled(),httpRequestDispatcher:this.httpRequestDispatcher,telemetryManager:this.telemetryService.getCallingAdapter(),serverMuteUnmute:this.config.signalingAgentConfig.serverMuteUnmute(),cloudScreenSharingFlag:"enabled",autoJoinOnConflict:!0,supportsCompressedServicePayload:this.config.signalingAgentConfig.enableCompressedServicePayload(),supportsSynchronousTrouterResponse:this.config.signalingAgentConfig.supportsSynchronousTrouterResponse(),brokerEnabledOutgoing:this.config.signalingAgentConfig.enableBrokerOutgoing(),brokerEnabledIncoming:this.config.signalingAgentConfig.enableBrokerIncoming(),brokerRequestBatching:this.config.signalingAgentConfig.enableBrokerRequestBatching(),brokerExclusively:this.config.signalingAgentConfig.brokerExclusively(),handleNewOfferRequest:this.isWebRtcOneOnOneCallingEnabled()}}async setTelemetryContextProviderWithUserRegionMetadata(){let e="";try{e=await this.authenticationService.getUserDetails().then(e=>e.region),this.logger.info("[setTelemetryContextProviderWithUserRegionMetadata]: Successfully fetched userRegion metadata.")}catch(e){this.logger.error(`[setTelemetryContextProviderWithUserRegionMetadata]: Failed to fetch userRegion metadata. [ErrorName: ${e.name}, ErrorMessage: ${e.message}]`)}finally{this.loggingService.setContext("AppInfo.UserRegion",e)}}}},4512:function(e,t,i){var n,a,r,o,s,l,c,d,g,h;i.d(t,{C1:()=>o,Iq:()=>m,LT:()=>u,MA:()=>a,NK:()=>n,QN:()=>s,V6:()=>r,fn:()=>p}),(l=n||(n={}))[l.Info=0]="Info",l[l.Warning=1]="Warning",l[l.Error=2]="Error",l[l.Standalone=3]="Standalone",(c=a||(a={}))[c.CallScreen=0]="CallScreen",c[c.CallMonitor=1]="CallMonitor",c[c.ExternalCallMonitor=2]="ExternalCallMonitor",c[c.CallingHeader=3]="CallingHeader",c[c.CallingFooter=4]="CallingFooter",c[c.Custom=5]="Custom",c[c.CallScreensharingPanel=6]="CallScreensharingPanel",(d=r||(r={}))[d.Top=0]="Top",d[d.Bottom=1]="Bottom",(g=o||(o={}))[g.CallingAlertBanner=1]="CallingAlertBanner",g[g.CallingActionButtons=2]="CallingActionButtons",g[g.CallingCenterScreen=3]="CallingCenterScreen",(h=s||(s={}))[h.None=0]="None",h[h.Roster=1]="Roster",h[h.CallingChat=2]="CallingChat",h[h.DeviceSettings=3]="DeviceSettings",h[h.MeetingInfo=4]="MeetingInfo",h[h.MeetingNotes=5]="MeetingNotes",h[h.BroadcastQna=6]="BroadcastQna",h[h.BroadcastYammer=7]="BroadcastYammer",h[h.BroadcastAnalytics=8]="BroadcastAnalytics",h[h.CallTranscript=9]="CallTranscript",h[h.CallHealth=10]="CallHealth",h[h.VideoBackgroundSettings=11]="VideoBackgroundSettings";let p=-1,u=1e4,m=2e4},801755:function(e,t,i){i.d(t,{s0:()=>F,nn:()=>w,Ag:()=>D,L3:()=>R});var n,a,r=i(370574),o=i(892891),s=i(575810),l=i(200669),c=i(373649),d=i(117952),g=i(924975),h=i(453842),p=i(650784),u=i(488444),m=i(890351),_=i(4512),S=i(377957),C=i(826757),v=i(856199),f=i(184497),b=i(19745),y=i(276881),T=i(679027),I=i(395250);class A{constructor(e,t,i=(0,o.debounce)((e,t)=>this.reportToRemote(e,t),1e4,{leading:!0,trailing:!0}),n=(0,o.throttle)((e,t,i)=>this.onQualityChangeInternal(e,t,i),1e4,{leading:!1,trailing:!0}),a=(0,o.throttle)((e,t,i)=>this.onQualityChangeInternal(e,t,i),3e4,{leading:!1,trailing:!0})){this.logger=e,this.eventingService=t,this.debouncedReportToRemote=i,this.throttleOnQualityChange=n,this.throttleGoodQualityChange=a,this.handledParticipantNsiEvents=new Map,this.qualityForReporting=r.QualityLevel.Unknown,this.networkEthernetInterfaceUsed=!1,this.wifiStrengthLevel=r.QualityLevel.Unknown}reset(){this.throttleOnQualityChange.cancel(),this.throttleGoodQualityChange.cancel(),this.debouncedReportToRemote.cancel(),this.handledParticipantNsiEvents.clear(),this.qualityForReporting=r.QualityLevel.Unknown}onCallConnected(e){e.publishedStates&&this.onPublishedStatesChanged(e,e.publishedStates)}onPublishedStatesChanged(e,t){for(let i of t.typeStates)if(i.type===r.PublishStateType.ClientMediaUFD)for(let t of i.participantStates){if(!t?.endpoints)continue;let i=r.QualityLevel.Unknown;for(let e of t.endpoints){let t=e.publishedState.content;if(t.type!==r.QualityEventType.NetworkStatusIndicator)break;t.value>i&&(i=t.value)}i!==r.QualityLevel.Unknown&&this.handledParticipantNsiEvents.get(t.id)!==i&&(this.handledParticipantNsiEvents.set(t.id,i),this.onQualityChangeInternal(e,{id:t.id,type:r.QualityEventType.NetworkStatusIndicator,value:i,mediaType:r.MediaType.Audio,isLocalSource:!1},!1))}}onQualityChange(e,t,i){switch(t.type){case r.QualityEventType.NetworkStatusIndicator:if(!e.teamsCallId)return;t.value===r.QualityLevel.Good?(this.throttleGoodQualityChange(e,t,i),this.throttleOnQualityChange.cancel()):(this.throttleOnQualityChange(e,t,i),this.throttleGoodQualityChange.cancel());break;case r.QualityEventType.NetworkEthernetInterfaceUsed:this.networkEthernetInterfaceUsed=t.value===r.QualityLevel.Good;break;case r.QualityEventType.NetworkStatusIndicatorWifiQuality:this.wifiStrengthLevel=t.value}}onQualityChangeInternal(e,t,i){this.logger.info(`[networkStrengthIndicatorChanged] teamsCallId: ${e.teamsCallId}, qualityLevel: ${t.value}, participantId: ${t.id}, isLocalSource: ${t.isLocalSource}`),this.eventingService.emit(s.gT.events.calling.networkStrengthIndicatorChanged,{teamsCallId:e.teamsCallId.toString(),qualityLevel:t.value,participantId:t.id,networkEthernetInterfaceUsed:this.networkEthernetInterfaceUsed,wifiStrengthLevel:this.wifiStrengthLevel}),i&&this.debouncedReportToRemote(e,t)}reportToRemote(e,t){if(this.qualityForReporting===t.value||this.qualityForReporting===r.QualityLevel.Unknown&&t.value===r.QualityLevel.Good)return;let i=e.participantCounts?.totalParticipants;void 0===i&&(i=20),(this.handledParticipantNsiEvents.size>=20||i>=20)&&this.qualityForReporting===r.QualityLevel.Unknown||(this.qualityForReporting=t.value,e.publishState({type:r.PublishStateType.ClientMediaUFD,level:r.PublishStateLevel.Endpoint,content:JSON.stringify(t)},"nsi-publish").then(()=>{this.logger.info(`[networkStrengthIndicatorChanged] stage published teamsCallId: ${e.teamsCallId}, qualityLevel: ${t.value}, participantId: ${t.id}, isLocalSource: ${t.isLocalSource}`)}).catch(i=>{this.logger.error(`[networkStrengthIndicatorChanged] failed to publish teamsCallId: ${e.teamsCallId}, qualityLevel: ${t.value}, participantId: ${t.id}, isLocalSource: ${t.isLocalSource}, error: ${i}`)}))}}var E=i(634504);let M={[s.gT.counters.eventNames.context]:"ufd-devices"};class P{constructor(e,t){this.logger=e,this.callTogglingService=t}async onQualityChanged(e,t){if(e.type!==r.QualityEventType.DeviceCaptureMute||t.state===r.CallState.Observing||t.state===r.CallState.Preheating||t.state===r.CallState.Preheated)return;let i=this.callTogglingService.isMuted(t);this.logger.info(`MuteReconciliation: QualityLevel: ${e.value} callState: ${t.state} isMuted: ${i}`);try{let n;if(e.value!==r.QualityLevel.Bad||i?e.value===r.QualityLevel.Good&&i&&(n=g.Jn.Unmute):n=g.Jn.Mute,void 0!==n){let e=(0,E.Z)();this.logger.info(`MuteReconciliation: togglingAudio callState: ${t.state} isMuted: ${i} muteAction: ${n} causeId: ${e}`),await this.callTogglingService.toggleMuteAudio(t,g.c3.OS,n,M,e)}}catch(e){this.logger.error(`MuteReconciliation: Error while toggling mute due ${e.message||e}`)}}}function k(e,t){return void 0===e||e===t}let D=3e4,R=5e3,w=8e3;(n=a||(a={}))[n.OpenSettings=0]="OpenSettings",n[n.OpenSettingsVDI=1]="OpenSettingsVDI",n[n.LearnMore=2]="LearnMore";class F{constructor(e,t,i,n,a,o,s,l,c,d,g,h,p,u,m,_,S,C,v,f,b,y,T,I,M,k,D,R,w=!0){this.config=e,this.loggingService=t,this.callingAgentsService=i,this.deviceManagerService=n,this.callTogglingService=a,this.eventingService=o,this.tenantScopeEventingService=s,this.callPropsStoreService=l,this.callingSupportService=c,this.callingService=d,this.utilityService=g,this.peopleService=h,this.platformDetectService=p,this.desktopUtilityService=u,this.participantCountsService=m,this.callPaywallservice=_,this.callPreJoinService=S,this.callingMultiWindowService=C,this.callingTelemetryService=v,this.analyticsService=f,this.audioVideoDiagnosticsService=b,this.chatServiceUtils=y,this.mtmaSubscriptionUtility=T,this.timeout=I,this.localized=M,this.howlingSuppressionService=k,this.getSlimCoreVdiSupportService=D,this.activeAlerts=[],this.qualityAlerts={},this.alerts={},this.unmutingWithUfdTimeout=1e3,this.unmutingWithoutUfdTimeout=500,this.listeners=[],this.callingHeaderAlerts=["NetworkQuality","NetworkQualityWithDisableVideoSuggestion","NetworkReconnect","ImageRenderingQualityAlert"],this.callingFooterAlerts=["CallTransferPstnFallbackFailedAlert","ContentOnlyAlert","DeviceCaptureMute","DeviceSpeakWhileMuted","DisableIncomingMeetingAudio","EnableIncomingMeetingAudio","Meeting_attendees_audio_failed","Meeting_attendees_video_failed","MicUnmuteTakesLongerTime","PptUnsupportedUpload","SpeakerAndMicUnmuted","DeviceAtCallStart","NoAvailablePSTN","RaiseHandsOperationFailure","SystemAudioStarted","SystemAudioNoDeviceInCallingScreen","SystemAudioDevicesMismatchInCallingScreen","SystemAudioDevicesStoppedWithError","ScreenSharingChromeExtensionRequired","ScreensharingCallEscalatedToAudio","InteropScreenshare","MergeFailedAlert","UserRaisedHand","UserHandLoweredByPresenter","MeetingLockedError","CoachNotification","StreamingAttendeeRaiseHand"],this.contentOnlySuppressedAlerts=["DeviceCaptureMute","DeviceSpeakWhileMuted","NoAvailableSpeakers","NoAvailableMicrophone","DeviceAtCallStart","DeviceRenderMute","DeviceRenderZeroVolume"],this.preheatSuppressedAlerts=["DeviceSpeakWhileMuted"],this.blockAVoverIPSuppressedAlerts=["ContentOnlyAlert","ContentOnlyFromNudgeAlert","DeviceAtCallStart","ScreensharingCallEscalatedToAudio"],this.ipAudioModeDisabledSuppressedAlerts=["DeviceSpeakWhileMuted","ContentOnlyAlert","ContentOnlyFromNudgeAlert","ScreensharingCallEscalatedToAudio"],this.screenshareOnlySuppressedAlerts=["AudioCaptureUltrasoundDetected","DeviceCaptureMute","DeviceCaptureNotFunctioning","DeviceCaptureNotFunctioningBluetoothMidCallFail","DeviceCaptureNotFunctioningWebcamMicMidCallFail","DeviceCaptureNotFunctioningAudioSrvNotRunning","DeviceClipping","DeviceHowling","DeviceRenderHowling","DeviceLowSNR","DeviceMultipleEndpoints","DeviceRenderMute","DeviceRenderNotFunctioning","DeviceRenderNotFunctioningBluetoothMidCallFail","DeviceRenderNotFunctioningAudioSrvNotRunning","DeviceRenderZeroVolume","DeviceSpeakWhileMuted","HidCallControlsUnavailable","HolographicAnnotationsError","LocalDeviceEcho","MicMutedRemotely","MicUnmuteFail","MicUnmuteTakesLongerTime","NetworkRecvCatastrophicPstnAvailable","NetworkSendCatastrophicPstnAvailable","NoAvailableCamera","NoAvailableMicrophone","NoAvailableSpeakers","RemoteDeviceEcho","DeviceNearEndToEchoRatio","SpeakerAndMicUnmuted","SystemAudioDevicesMismatchInCallingScreen","SystemAudioDevicesNotMatch","SystemAudioDriverInstallationFailed","SystemAudioDriverInstallationSucceeded","SYSTEM_AUDIO_DRIVER_NOT_INSTALLED","SystemAudioNoDeviceInCallingScreen","SystemAudioNoDevice","SystemAudioDevicesStoppedWithError","SystemAudioStarted","ScreenshareRecordingDisabled","VideoCaptureDeviceFreeze","VideoCaptureFreezeRecovered","VideoCapturerDeviceStartFailed","VideoCapturerDeviceStartFailureLackSystemRes","VideoCapturerDeviceStartFailureMFResConflict","VideoCapturerDeviceStartTimedOut","VideoEffectsFailure","VideoExtensibilityDisabledInStandoutMode","VideoExtensibilityFreeze","VideoExtensibilitySlow","DeviceAtCallStart","NoAvailablePSTN","HidCallControlsUnavailableDueToOtherOpenedApps"],this.pstnActionAlerts=["DeviceCaptureNotFunctioning","DeviceCaptureNotFunctioningBluetoothMidCallFail","DeviceCaptureNotFunctioningWebcamMicMidCallFail","DeviceRenderNotFunctioning","DeviceRenderNotFunctioningBluetoothMidCallFail","DeviceCaptureNotMuteButSilent","DeviceCaptureNotFunctioningAudioSrvNotRunning","DeviceRenderNotFunctioningAudioSrvNotRunning","NoAvailableMicrophone","NoAvailableSpeakers","NetworkRecvCatastrophicPstnAvailable","NetworkSendCatastrophicPstnAvailable"],this.sharingPanelAlerts=["ScreenSharingNotSupported","SystemAudioDevicesNotMatch","SystemAudioDriverInstallationFailed","SystemAudioDriverInstallationSucceeded","SYSTEM_AUDIO_DRIVER_NOT_INSTALLED","SystemAudioNoDevice","SystemAudioUnsupportedSharing"],this.callPreheatStates=[r.CallState.Preheating,r.CallState.Preheated],this.call=null,this.videoDevicePluggedInAlertCount=0,this.audioDeviceSelectionChangedCount=0,this.activeVideoDevicePluggedOutCount=0,this.lastIsHostViewModeActiveState=!1,this.disabledUFDs=[],this.alertsInBlockTimeframe=[],this.isPstnAvailable=!1,this.speakerHWMuted=!1,this.alertsWithPermanentDismiss={},this.isDeviceAtCallStartUFDEnabled=!1,this.isUnsupportedHidDeviceSelected=!1,this.qualityEvents=[],this.rigelDisplayDisconnected={unsubscribe:void 0},this.rigelParticipantsInLobby={unsubscribe:void 0},this.wasPoorNetworkAlertActive=!1,this.isDesktopEnabled=!1,this.LOGGER_IDENTIFIER="callingAlerts",this.unmuteHardMutedSpeaker=async()=>{let e=(0,E.Z)();try{this.logger.info(`[cid=${e}] unmuting hard muted speaker`),await this.callTogglingService.toggleSpeaker(this.call,!1,e);let t=this.activeAlerts.filter(e=>e.qualityAlertType===r.QualityEventType.DeviceRenderMute);t.length>0?(this.dismissLocal(t),this.logger.info(`trying to dismiss alert when unmuting speaker, causeId: ${e}`)):this.logger.info(`unmuting speaker when no active alert exists, causeId: ${e}`)}catch(t){this.logger.error(`unmuting hard muted speaker failed, causeId: ${e}, due: ${t.message||t}`)}},this.logger=t.newLogger(this.LOGGER_IDENTIFIER),this.asObservable=R.createObservable(),this.nsiHelper=new A(this.logger,this.eventingService),this.muteHelper=new P(this.logger,this.callTogglingService),w&&this.initializeOnAppLaunchAndReinit()}showE2EEMeetingCapacityAlert(){let e={name:"EndToEndEncryptedMeetingMaxCapacity",title:this.localized.alerts.endToEndEncryptedMeetingMaxCapacity.title()??"Meeting is at capacity",text:this.localized.alerts.endToEndEncryptedMeetingMaxCapacity.text()??"End-to-end encrypted meetings limit attendance capacity.",type:_.NK.Warning,windowType:_.MA.CallScreen,dismissable:!0};this.handleOnDemandAlert(e)}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.suppressDeviceSpeakWhileMutedUFD=!1,this.isNewCriticalAlertDesignEnabled=!this.platformDetectService.isSurfaceHub1()&&this.config.enableCallingCriticalAlertsNewDesign(),this.isScreensharingCallEscalationEnabled=this.config.enableScreenSharingOnlyCallEscalation(),this.getDisabledUFDs(),this.isNewCriticalAlertDesignEnabled&&this.callingFooterAlerts.push("CallTransferPstnFallbackFailedAlert","Bmc_setLayout_command_failure","Bmc_start_command_failure","Bmc_stop_command_failure","Bmc_restart_command_failure","CannotUnmuteOSMicrophone","DeviceCaptureNotFunctioning","DeviceCaptureNotFunctioningBluetoothMidCallFail","DeviceCaptureNotFunctioningWebcamMicMidCallFail","DeviceCaptureNotFunctioningAudioSrvNotRunning","DeviceMultipleEndpoints","DeviceRenderMute","DeviceRenderNotFunctioning","DeviceRenderNotFunctioningBluetoothMidCallFail","DeviceRenderNotFunctioningAudioSrvNotRunning","DeviceRenderZeroVolume","HolographicAnnotationsError","NetworkRecvCatastrophicPstnAvailable","NetworkRecvCatastrophicPstnNotAvailable","NetworkSendCatastrophicPstnAvailable","NetworkSendCatastrophicPstnNotAvailable","NoAvailableCamera","HidCallControlsUnavailable","NoAvailableMicrophone","InteropScreenshare","MergeFailedAlert","NoAvailableSpeakers","SystemAudioStarted","SystemAudioNoDeviceInCallingScreen","SystemAudioDevicesMismatchInCallingScreen","SystemAudioDevicesStoppedWithError","RenderingFailuresAlert","SharingDropped","ScreensharingCallEscalatedToAudio","ContentSharingFailed"),this.isDesktopEnabled=this.config.isDesktopEnabled(),this.unmutingWithoutUfdTimeout=this.config.unmutingWithoutUfdTimeout()||500,this.unmutingWithUfdTimeout=this.config.unmutingWithUfdTimeout()||1e3,this.initAlertsWithPermanentDismiss(),this.isWindowsOSPlatform=this.config.getOsPlatform()===l.NR.Windows,this.enablePSTNFallbackForUFDs=this.config.enablePSTNFallbackForUFDs(),this.mtmaSubscriptionUtility.subscribe(this.callingService,()=>this.onCallChanged()),this.eventingService.registerHandlerForExternalEvent(s.gT.events.settings.updated,this.getDisabledUFDs.bind(this)),this.config.enableStructuredMeetingsSettingsConsumption()&&this.eventingService.registerHandlerForExternalEvent(s.gT.events.calling.meetingRoleChanged,e=>this.onMeetingRoleChanged(e)),this.isDeviceAtCallStartUFDEnabled=this.config.enableDeviceAtCallStartUFD()&&this.isDesktopEnabled,this.shouldSuggestToDisableVideoOnPoorNetworks=this.config.suggestToDisableVideoOnPoorNetworks(),this.enableTurnOffVideoUFDOnPoorNetworks=this.config.enableTurnOffVideoUFDOnPoorNetworks(),this.enableAudioCaptureUltrasoundUFD=this.config.enableAudioCaptureUltrasoundUFD(),this.xlMeetingRosterParticipantsCountForUfd=this.config.xlMeetingRosterParticipantsCountForUfd()||0,this.enableSomeoneWaitingInLobbyUFD=this.config.enableSomeoneWaitingInLobbyUFD(),this.enableHostViewMode=this.config.enableHostViewMode(),this.enableMusicModeUFD=this.config.enableMusicModeUFD(),this.isLearnMoreLinkEnabledInNetworkUFD=this.config.isLearnMoreLinkEnabledInNetworkUFD(),this.enableUfdV2=this.config.enableUfdV2();let t=this.config.shareSystemAudioOnPoorSignalAlertGracePeriod();this.shouldSuppressSystemAudioPoorQualityAlert=t&&0!==t}cleanupOnAppTeardown(e){this.resetAlerts(),this.activeAlerts=[],this.unmutingWithoutUFDPromise=void 0,this.unmutingWithUFDPromise=void 0,this.addAlertToBlockTimeframeListPromise=void 0,this.isWindowsOSPlatform=void 0,this.enablePSTNFallbackForUFDs=void 0,this.listeners=[],this.call=null,this.isDesktopEnabled=!1,this.verifyExistingCameraUnsubscribe&&this.verifyExistingCameraUnsubscribe(),this.verifyExistingCameraUnsubscribe=null,this.showMeetingRolesDialogUnsubscribe&&this.showMeetingRolesDialogUnsubscribe(),this.showMeetingRolesDialogUnsubscribe=void 0,this.isNewCriticalAlertDesignEnabled=void 0,this.isScreensharingCallEscalationEnabled=void 0,this.disabledUFDs=[],this.alertsInBlockTimeframe=[],this.isPstnAvailable=!1,this.alertsWithPermanentDismiss={},this.suppressDeviceSpeakWhileMutedUFD=void 0,this.isDeviceAtCallStartUFDEnabled=!1,this.isUnsupportedHidDeviceSelected=!1,this.shouldSuggestToDisableVideoOnPoorNetworks=!1,this.enableTurnOffVideoUFDOnPoorNetworks=!1,this.enableAudioCaptureUltrasoundUFD=!1,this.enableHostViewMode=!1,this.enableMusicModeUFD=!1,this.isLearnMoreLinkEnabledInNetworkUFD=!1,this.enableUfdV2=!1,this.rigelDisplayDisconnected.unsubscribe&&this.rigelDisplayDisconnected.unsubscribe(),this.rigelDisplayDisconnected={unsubscribe:void 0},this.rigelParticipantsInLobby.unsubscribe&&this.rigelParticipantsInLobby.unsubscribe(),this.qualityEvents=[],this.unmutingWithoutUfdTimeout=500,this.unmutingWithUfdTimeout=1e3,this.callTogglingMuteAudioCalledSubscription=void 0,this.callTogglingBrowserOSUnmuteSubscription=void 0,this.callTogglingUnmuteFailSubscription=void 0,this.unmuteSpeakersAndMicSubscription=void 0,this.participantCountsChangedSubscription=void 0,this.callPaywallRemainingDurationSubscription=void 0,this.callPaywallTimerStartsSubscription=void 0,this.callPaywallRemainingParticipantCapacitySubscription=void 0,this.deviceManagerServiceSpeakerChangedSubscription&&this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.deviceManagerServiceSpeakerChangedSubscription),this.deviceManagerServiceSpeakerChangedSubscription=void 0,this.deviceManagerServicevideoEffectsQualityDegradedSubscription&&this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.deviceManagerServicevideoEffectsQualityDegradedSubscription),this.deviceManagerServicevideoEffectsQualityDegradedSubscription=void 0,this.deviceManagerAudioDeviceSelectionChangedSubscription=void 0,this.deviceManagerActiveVideoDevicePluggedOutSubscription=void 0,this.deviceManagerNewVideoDevicePluggedInSubscription=void 0,this.videoDevicePluggedInAlertCount=0,this.audioDeviceSelectionChangedCount=0,this.activeVideoDevicePluggedOutCount=0,this.xlMeetingRosterParticipantsCountForUfd=void 0,this.enableSomeoneWaitingInLobbyUFD=void 0,this.callingFooterAlerts=["CallTransferPstnFallbackFailedAlert","ContentOnlyAlert","DisableIncomingMeetingAudio","EnableIncomingMeetingAudio","DeviceCaptureMute","DeviceSpeakWhileMuted","Meeting_attendees_audio_failed","Meeting_attendees_video_failed","MicUnmuteTakesLongerTime","PptUnsupportedUpload","SpeakerAndMicUnmuted","DeviceAtCallStart","NoAvailablePSTN","RaiseHandsOperationFailure","SystemAudioStarted","SystemAudioNoDeviceInCallingScreen","SystemAudioDevicesMismatchInCallingScreen","SystemAudioDevicesStoppedWithError","ScreenSharingChromeExtensionRequired","ScreensharingCallEscalatedToAudio","InteropScreenshare","MergeFailedAlert","UserRaisedHand","UserHandLoweredByPresenter","MeetingLockedError","CoachNotification","StreamingAttendeeRaiseHand"],this.speakerHWMuted=!1,this.shouldSuppressSystemAudioPoorQualityAlert=!1,this.wasPoorNetworkAlertActive=!1}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}createAlertForId(e){return this.qualityAlert(e)}onRigelDisplayDisconnectedChanged(e){e?this.onAlert(this.alert("rigelDisplayDisconnectedAlert")):this.remove(this.alert("rigelDisplayDisconnectedAlert"),!0)}onRigelParticipantsInLobbyChanged(e){e?this.onAlert(this.alert("rigelParticipantsInLobbyAlert")):this.remove(this.alert("rigelParticipantsInLobbyAlert"),!0)}resetAlerts(){this.nsiHelper.reset(),this.qualityAlerts={},this.alerts={}}alert(e){if(!this.alerts[e]){let t=null;switch(e){case"LargeGalleryViewFailed":t={dismissable:!0,type:_.NK.Warning,name:"LargeGalleryViewFailed",title:this.localized.alerts.botView.largeGalleryViewFailed.title(),text:this.localized.alerts.botView.largeGalleryViewFailed.text()};break;case"AudienceViewFailed":t={dismissable:!0,type:_.NK.Warning,name:"AudienceViewFailed",title:this.localized.alerts.botView.audienceViewFailed.title(),text:this.localized.alerts.botView.audienceViewFailed.text()};break;case"VoiceCollectionStarted":t={dismissable:!0,windowType:_.MA.CallScreen,type:_.NK.Warning,name:"VoiceCollectionStarted",title:this.localized.alerts.voiceCollection.started.title(),text:this.localized.alerts.voiceCollection.started.text(),ariaText:this.localized.alerts.voiceCollection.started.ariaText(),timeout:_.fn};break;case"VoiceCollectionStopped":t={dismissable:!0,windowType:_.MA.CallScreen,type:_.NK.Warning,name:"VoiceCollectionStopped",title:this.localized.alerts.voiceCollection.stopped.title(),text:this.localized.alerts.voiceCollection.stopped.text(),ariaText:this.localized.alerts.voiceCollection.stopped.ariaText()};break;case"NoAvailableCamera":t={dismissable:!0,type:_.NK.Error,name:"NoAvailableCamera",title:this.localized.alerts.noAvailableCamera.title(),text:this.localized.alerts.noAvailableCamera.text()};break;case"currentMeetingIsXlAlert":t={dismissable:!0,type:_.NK.Info,name:"CurrentMeetingIsXL",text:this.localized.alerts.currentMeetingIsXl.text()};break;case"videoEffectsFailureAlert":t={dismissable:!0,type:_.NK.Error,name:"VideoEffectsFailure",text:this.localized.alerts.videoEffectsFailure.text(),title:this.localized.alerts.videoEffectsFailure.title()};break;case"deviceAtCallStartAlert":t={dismissable:!0,type:_.NK.Info,name:"DeviceAtCallStart",text:"",isAffirmational:!0};break;case"screenSharingCallEscalatedAlert":t={dismissable:!0,type:_.NK.Error,name:"ScreensharingCallEscalatedToAudio",title:this.localized.alerts.screenSharingCallEscalatedToAudio.title(),text:this.localized.alerts.screenSharingCallEscalatedToAudio.text(),ariaText:this.localized.alerts.screenSharingCallEscalatedToAudio.ariaText(),windowType:_.MA.CallingFooter,position:_.V6.Top,isMicRelated:!0,isScreensharingCallRelated:!0};break;case"screenSharingCallFailedToEscalatedAlert":t={dismissable:!0,type:_.NK.Warning,name:"ScreensharingCallEscalatedToAudioFailed",text:this.localized.alerts.screenSharingCallEscalatedToAudioFailed.text(),title:this.localized.alerts.screenSharingCallEscalatedToAudioFailed.title()};break;case"videoDisabledWhileScreensharingAlert":t={dismissable:!0,type:_.NK.Info,name:"VideoDisabledWhileScreensharing",text:this.localized.alerts.videoDisabledWhileScreenSharing.text()};break;case"sharingDroppedAlert":t={dismissable:!0,type:_.NK.Error,name:"SharingDropped",text:this.localized.alerts.sharingDropped.text(),title:this.localized.alerts.sharingDropped.title(),actions:[{alertActionType:"StartScreenSharingOnCall",buttonText:this.localized.alerts.sharingDropped.actionText(),command:()=>{this.call.startScreenSharingOnCall(null,s.gT.scenarios.calling.context.callingAlert)},buttonTrackName:c.vR.shareDesktop}]};break;case"sharingControlRequestDeniedAlert":t={dismissable:!0,type:this.isNewCriticalAlertDesignEnabled?_.NK.Warning:_.NK.Info,name:"SharingControlRequestDenied",title:this.localized.alerts.sharingControlRequestDenied.title(),text:this.localized.alerts.sharingControlRequestDenied.text()};break;case"sharingControlRequestRevokedAlert":t={dismissable:!0,type:_.NK.Info,name:"SharingControlRequestRevoked",text:this.localized.alerts.sharingControlRequestRevoked.text()};break;case"sharedWindowMinimizedAlert":t={dismissable:!0,type:_.NK.Warning,name:"SharedWindowMinimized",title:this.localized.alerts.sharedWindowMinimized.title(),text:this.localized.alerts.sharedWindowMinimized.text()};break;case"micMutedRemotelyAlert":t={dismissable:!0,type:this.platformDetectService.isRigel()?_.NK.Info:_.NK.Warning,name:"MicMutedRemotely",text:this.localized.alerts.micMutedRemotely.text(),title:this.localized.alerts.micMutedRemotely.title(),actions:[{alertActionType:"UnmuteMicAudio",buttonText:this.localized.alerts.micMutedRemotely.actionText(),command:()=>{let e=(0,E.Z)();this.logger.info(`[cid: ${e}] Unmuting from MicMutedRemotelyAlert`),this.callTogglingService.toggleMuteAudio(this.call,g.c3.App,g.Jn.Unmute,{[s.gT.counters.eventNames.context]:"ufd-servermuted"},e),this.changeToUnmutingPhaseMicMutedAlerts()},buttonTrackName:c.vR.unmute}]};break;case"micMutedRemotelyAlertWithoutUnmuteButton":t={dismissable:!0,type:this.platformDetectService.isRigel()?_.NK.Info:_.NK.Warning,name:"MicMutedRemotely",text:this.localized.alerts.micMutedRemotely.text(),title:this.localized.alerts.micMutedRemotely.title()};break;case"micUnmuteFailAlert":t={dismissable:!0,type:this.isNewCriticalAlertDesignEnabled?_.NK.Warning:_.NK.Info,name:"MicUnmuteFail",text:this.localized.alerts.micUnmuteFail.text(),title:this.localized.alerts.micUnmuteFail.title(),actions:[{alertActionType:"UnmuteMicAudio",buttonText:this.localized.alerts.micUnmuteFail.actionText(),command:()=>{let e=(0,E.Z)();this.logger.info(`[cid: ${e}] Unmuting from MicUnmuteFailAlert`),this.callTogglingService.toggleMuteAudio(this.call,g.c3.App,g.Jn.Unmute,{[s.gT.counters.eventNames.context]:"ufd-unmute-fail"},e),this.changeToUnmutingPhaseMicMutedAlerts()},buttonTrackName:c.vR.unmute}]};break;case"browserOSUnmuteFailAlert":t={dismissable:!0,type:_.NK.Error,name:"CannotUnmuteOSMicrophone",text:this.localized.alerts.cannotUnmuteOSMicrophone.text(),title:this.localized.alerts.cannotUnmuteOSMicrophone.title(),isAffirmational:!0};break;case"unmuteSpeakerAndMicAlert":t={dismissable:!0,type:_.NK.Info,name:"SpeakerAndMicUnmuted",text:this.localized.alerts.speakerAndMicUnmuted.text(),isAffirmational:!0};break;case"micUnmuteTakesLongerTime":t={dismissable:!0,type:_.NK.Info,name:"MicUnmuteTakesLongerTime",text:this.localized.alerts.micUnmuteTakesLongerTime.text(),isAffirmational:!!this.isNewCriticalAlertDesignEnabled};break;case"disableIncomingMeetingAudio":t={name:"DisableIncomingMeetingAudio",text:this.localized.alerts.disableIncomingMeetingAudio.text(),type:_.NK.Info,dismissable:!0,timeout:R,windowType:_.MA.CallingFooter};break;case"enableIncomingMeetingAudio":t={name:"EnableIncomingMeetingAudio",text:this.localized.alerts.enableIncomingMeetingAudio.text(),type:_.NK.Info,dismissable:!0,timeout:R,windowType:_.MA.CallingFooter};break;case"systemAudioStartedAlert":t={dismissable:!0,type:_.NK.Info,name:"SystemAudioStarted",text:this.localized.alerts.systemAudioStarted.text(),isAffirmational:!0};break;case"systemAudioNoDeviceInCallingScreenAlert":t={type:_.NK.Error,dismissable:!0,name:"SystemAudioNoDeviceInCallingScreen",title:this.localized.alerts.systemAudioNoDevice.title(),text:this.localized.alerts.systemAudioNoDevice.text()};break;case"systemAudioDevicesMismatchInCallingScreenAlert":t={type:_.NK.Error,dismissable:!0,name:"SystemAudioDevicesMismatchInCallingScreen",title:this.localized.alerts.systemAudioDevicesMismatch.title(),text:this.localized.alerts.systemAudioDevicesMismatch.text()};break;case"systemAudioStoppedWithErrorAlert":t={type:_.NK.Error,dismissable:!0,name:"SystemAudioDevicesStoppedWithError",title:this.localized.alerts.systemAudioDevicesStoppedWithError.title(),text:this.localized.alerts.systemAudioDevicesStoppedWithError.text()};break;case"renderingFailuresAlert":t={dismissable:!0,type:_.NK.Error,name:"RenderingFailuresAlert",title:this.localized.alerts.renderingFailures.title(),text:this.localized.alerts.renderingFailures.text()};break;case"videoEffectsQualityDegradedAlert":t={dismissable:!0,type:_.NK.Warning,name:"VideoEffectsQualityDegraded",text:this.localized.alerts.videoEffectsQualityDegraded.text(),windowType:_.MA.CallScreen};break;case"rigelDisplayDisconnectedAlert":t={dismissable:!0,type:_.NK.Warning,name:"RigelDisplayDisconnected",text:this.localized.alerts.rigelDisplayDisconnected.text(),windowType:_.MA.CallScreen};break;case"rigelParticipantsInLobbyAlert":t={dismissable:!0,type:_.NK.Warning,name:"RigelParticipantsInLobby",text:this.localized.alerts.rigelParticipantsInLobby.text(),windowType:_.MA.CallScreen};break;case"someoneWaitingInLobbyAlert":t={dismissable:!0,type:_.NK.Info,name:"SomeoneWaitingInLobby",text:this.localized.alerts.someoneWaitingInLobby.text(),title:this.localized.alerts.someoneWaitingInLobby.title(),timeout:_.fn};break;case"hostViewModeActivatedAlert":t={name:"HostViewModeActivated",text:this.localized.alerts.hostViewModeActivated.text(),title:this.localized.alerts.hostViewModeActivated.title?.(),type:_.NK.Warning,windowType:_.MA.CallScreen,dismissable:!0};break;case"attendeeHostViewModeAlert":t={name:"AttendeeHostViewModeActivated",text:this.localized.alerts.attendeeHostViewModeActivated.text(),title:this.localized.alerts.attendeeHostViewModeActivated.title?.(),type:_.NK.Info,windowType:_.MA.CallScreen,dismissable:!0};break;case"attendeeHostViewModeRaiseHandAlert":t={name:"AttendeeHostViewModeActivatedRaiseHand",text:this.localized.alerts.attendeeHostViewModeActivatedRaiseHand.text(),title:this.localized.alerts.attendeeHostViewModeActivatedRaiseHand.title?.(),type:_.NK.Warning,windowType:_.MA.CallScreen,dismissable:!0};break;case"hostViewModeDeactivatedAlert":t={name:"HostViewModeDeactivated",text:this.localized.alerts.hostViewModeDeactivated.text(),type:_.NK.Info,windowType:_.MA.CallScreen,dismissable:!0};break;case"attendeeHostViewDeactivatedAlert":t={name:"AttendeeHostViewModeDeactivated",text:this.localized.alerts.attendeeHostViewModeDeactivated.text(),title:this.localized.alerts.attendeeHostViewModeDeactivated.title?.(),type:_.NK.Info,windowType:_.MA.CallScreen,dismissable:!0};break;case"DeviceRenderMute":t={dismissable:!0,type:_.NK.Error,name:"DeviceRenderMute",qualityAlertType:r.QualityEventType.DeviceRenderMute,title:this.localized.alerts.quality.deviceRenderMute.title(),text:this.localized.alerts.quality.deviceRenderMute.text(),actions:this.getActionsFor("DeviceRenderMute")}}this.alerts[e]=t}return this.alerts[e]}qualityAlert(e,t,i){let n=this.qualityAlertInternal(e,t,i);return n&&this.logger.info(`Created quality alert UFD for name: ${e}, type: ${t}, isLocalSource: ${i}`),n}getDevicePermissionWarningMode(){let e=a.OpenSettings;return this.config.enableVDIDevicePermissionDialog()&&this.desktopUtilityService.isVDI()&&this.getSlimCoreVdiSupportService().isConnected()&&(e=this.config.enableSlimCoreOpenPrivacySettings()?a.OpenSettingsVDI:a.LearnMore),e}qualityAlertInternal(e,t,i){let n=(n,a,r)=>k(e,n)&&k(t,a)&&k(i,r),o=this.config.enableAVFramework?.(),l=this.getDevicePermissionWarningMode(),d=this.config.enableAdvancedMsixDeployment();if(t&&this.audioVideoDiagnosticsService.shouldHandleAudioEvent(t))return this.audioVideoDiagnosticsService.getAudioAlert(t);let g=this.config.enableAudioDiagnostics?.(),h=this.config.enableVideoDiagnostics?.();if(n("LocalDeviceEcho",r.QualityEventType.DeviceEcho,!0))return this.qualityAlerts.LocalDeviceEcho||(this.qualityAlerts.LocalDeviceEcho={dismissable:!0,type:_.NK.Warning,name:"LocalDeviceEcho",qualityAlertType:r.QualityEventType.DeviceEcho,isLocalSource:!0,title:this.localized.alerts.quality.localDeviceEcho.title(),text:this.localized.alerts.quality.localDeviceEcho.text(),actions:[{alertActionType:o?"openAudioSettingsPanel":"OpenDeviceSettings",buttonText:this.localized.alerts.quality.localDeviceEcho.actionText(o),command:()=>this.config.hooks.alerts.onDeviceEcho(),buttonTrackName:c.vR.openDeviceSettings}]});if(n("ScreenshareRecordingDisabled",r.QualityEventType.ScreenshareRecordingDisabled,!0))return this.qualityAlerts.ScreenshareRecordingDisabled||(this.qualityAlerts.ScreenshareRecordingDisabled={dismissable:!0,type:_.NK.Error,name:"ScreenshareRecordingDisabled",qualityAlertType:r.QualityEventType.ScreenshareRecordingDisabled,title:this.localized.alerts.quality.screenshareRecordingDisabled.title(),text:this.localized.alerts.quality.screenshareRecordingDisabled.text(),isLocalSource:!0});if(n("RemoteDeviceEcho",r.QualityEventType.DeviceEcho,!1))return this.qualityAlerts.RemoteDeviceEcho||(this.qualityAlerts.RemoteDeviceEcho={dismissable:!0,type:_.NK.Warning,name:"RemoteDeviceEcho",qualityAlertType:r.QualityEventType.DeviceEcho,isLocalSource:!1,title:this.localized.alerts.quality.remoteDeviceEcho.title(),text:this.localized.alerts.quality.remoteDeviceEcho.text()});if(n("DeviceNearEndToEchoRatio",r.QualityEventType.DeviceNearEndToEchoRatio,!0))return this.qualityAlerts.DeviceNearEndToEchoRatio||(this.qualityAlerts.DeviceNearEndToEchoRatio={dismissable:!0,type:_.NK.Warning,name:"DeviceNearEndToEchoRatio",qualityAlertType:r.QualityEventType.DeviceNearEndToEchoRatio,isLocalSource:!0,title:this.localized.alerts.quality.deviceNearEndToEchoRatio.title(),text:this.localized.alerts.quality.deviceNearEndToEchoRatio.text()});if(n("DeviceHowling",r.QualityEventType.DeviceHowling,!0))return this.qualityAlerts.DeviceHowling||(this.qualityAlerts.DeviceHowling={dismissable:!0,type:_.NK.Warning,name:"DeviceHowling",qualityAlertType:r.QualityEventType.DeviceHowling,isLocalSource:!0,title:this.localized.alerts.quality.deviceHowling.title(),text:this.localized.alerts.quality.deviceHowling.text(),actions:[{alertActionType:"MuteSpeakerAndMicAudio",buttonText:this.localized.alerts.quality.deviceHowling.actionText(),command:()=>{let e=(0,E.Z)();return this.logger.info(`[cid: ${e}] Muting audio from DeviceHowlingAlert`),this.callTogglingService.turnOffSpeakerAndMicAudio(this.call,"ufd-button-turn-off-audio",e)},buttonTrackName:c.vR.ufdTurnOffAudio}]});if(n("CpuInsufficient",r.QualityEventType.CpuInsufficient,!0))return this.qualityAlerts.CpuInsufficient||(this.qualityAlerts.CpuInsufficient={dismissable:!0,type:_.NK.Warning,name:"CpuInsufficient",qualityAlertType:r.QualityEventType.CpuInsufficient,isLocalSource:!0,title:this.localized.alerts.quality.cpuInsufficient.title(),text:this.localized.alerts.quality.cpuInsufficient.text(),timeout:15e3});if(n("DeviceRenderHowling",r.QualityEventType.DeviceRenderHowling,!0))return this.qualityAlerts.DeviceRenderHowling||(this.qualityAlerts.DeviceRenderHowling={dismissable:!0,type:_.NK.Warning,name:"DeviceRenderHowling",qualityAlertType:r.QualityEventType.DeviceRenderHowling,isLocalSource:!0,title:this.localized.alerts.quality.deviceRenderHowling.title(),text:this.localized.alerts.quality.deviceRenderHowling.text(),actions:[{alertActionType:"MuteSpeakerAndMicAudio",buttonText:this.localized.alerts.quality.deviceRenderHowling.actionText(),command:()=>{let e=(0,E.Z)();return this.logger.info(`[cid: ${e}] Muting audio from DeviceRenderHowling`),this.callTogglingService.turnOffSpeakerAndMicAudio(this.call,"ufd-button-turn-off-audio",e)},buttonTrackName:c.vR.ufdTurnOffAudio}]});if(n("DeviceLowSNR",r.QualityEventType.DeviceLowSNR,!0))return this.qualityAlerts.DeviceLowSNR||(this.qualityAlerts.DeviceLowSNR={dismissable:!0,type:_.NK.Warning,name:"DeviceLowSNR",qualityAlertType:r.QualityEventType.DeviceLowSNR,isLocalSource:!0,title:this.localized.alerts.quality.deviceLowSignalToNoiseRatio.title(),text:this.localized.alerts.quality.deviceLowSignalToNoiseRatio.text()});if(n("DeviceCaptureNotFunctioning",r.QualityEventType.DeviceCaptureNotFunctioning,!0))return this.qualityAlerts.DeviceCaptureNotFunctioning||(this.qualityAlerts.DeviceCaptureNotFunctioning={dismissable:!0,type:_.NK.Error,name:"DeviceCaptureNotFunctioning",qualityAlertType:r.QualityEventType.DeviceCaptureNotFunctioning,isLocalSource:!0,title:this.localized.alerts.quality.deviceCaptureNotFunctioning.title(),text:this.localized.alerts.quality.deviceCaptureNotFunctioning.text(g),actions:this.getActionsFor("DeviceCaptureNotFunctioning")});if(n("DeviceCaptureNotMuteButSilent",r.QualityEventType.DeviceCaptureNotMuteButSilent,!0))return this.qualityAlerts.DeviceCaptureNotMuteButSilent||(this.qualityAlerts.DeviceCaptureNotMuteButSilent={dismissable:!0,type:_.NK.Warning,name:"DeviceCaptureNotMuteButSilent",qualityAlertType:r.QualityEventType.DeviceCaptureNotMuteButSilent,isLocalSource:!0,title:this.localized.alerts.quality.deviceCaptureNotMuteButSilent.title(),text:this.localized.alerts.quality.deviceCaptureNotMuteButSilent.text(),actions:this.getActionsFor("DeviceCaptureNotMuteButSilent"),timeout:_.Iq});if(n("DeviceRenderNotFunctioning",r.QualityEventType.DeviceRenderNotFunctioning,!0))return this.qualityAlerts.DeviceRenderNotFunctioning||(this.qualityAlerts.DeviceRenderNotFunctioning={dismissable:!0,type:_.NK.Error,name:"DeviceRenderNotFunctioning",qualityAlertType:r.QualityEventType.DeviceRenderNotFunctioning,isLocalSource:!0,title:this.localized.alerts.quality.deviceRenderNotFunctioning.title(),text:this.localized.alerts.quality.deviceRenderNotFunctioning.text(g),actions:this.getActionsFor("DeviceRenderNotFunctioning")});if(n("DeviceClipping",r.QualityEventType.DeviceClipping,!0))return this.qualityAlerts.DeviceClipping||(this.qualityAlerts.DeviceClipping={dismissable:!0,type:_.NK.Warning,name:"DeviceClipping",qualityAlertType:r.QualityEventType.DeviceClipping,isLocalSource:!0,text:this.localized.alerts.quality.deviceClipping.text()});if(n("DeviceRenderMute",r.QualityEventType.DeviceRenderMute,!0))return this.qualityAlerts.DeviceRenderMute||(this.qualityAlerts.DeviceRenderMute={dismissable:!0,type:_.NK.Error,name:"DeviceRenderMute",qualityAlertType:r.QualityEventType.DeviceRenderMute,isLocalSource:!0,title:this.localized.alerts.quality.deviceRenderMute.title(),text:this.localized.alerts.quality.deviceRenderMute.text(),actions:this.getActionsFor("DeviceRenderMute")});if(n("DeviceRenderZeroVolume",r.QualityEventType.DeviceRenderZeroVolume,!0))return this.qualityAlerts[""]||(this.qualityAlerts[""]={dismissable:!0,type:_.NK.Error,name:"DeviceRenderZeroVolume",qualityAlertType:r.QualityEventType.DeviceRenderZeroVolume,isLocalSource:!0,title:this.localized.alerts.quality.deviceRenderZeroVolume.title(),text:this.localized.alerts.quality.deviceRenderZeroVolume.text()});if(n("NetworkQuality",void 0,!0))return this.qualityAlerts.NetworkQuality||(this.qualityAlerts.NetworkQuality={dismissable:!0,type:_.NK.Warning,name:"NetworkQuality",isLocalSource:!0,title:this.localized.alerts.quality.networkQuality.title(),text:this.localized.alerts.quality.networkQuality.text()});if(n("NetworkReconnect",r.QualityEventType.NetworkReconnect,!0))return this.qualityAlerts.NetworkReconnect||(this.qualityAlerts.NetworkReconnect={dismissable:!1,type:_.NK.Info,name:"NetworkReconnect",qualityAlertType:r.QualityEventType.NetworkReconnect,isLocalSource:!0,text:"",isAffirmational:!0});if(n("NetworkRecvCatastrophicPstnAvailable",r.QualityEventType.NetworkRecvCatastrophic,!0))return this.qualityAlerts.NetworkRecvCatastrophicPstnAvailable||(this.qualityAlerts.NetworkRecvCatastrophicPstnAvailable={dismissable:!0,type:_.NK.Error,name:"NetworkRecvCatastrophicPstnAvailable",qualityAlertType:r.QualityEventType.NetworkRecvCatastrophic,isLocalSource:!0,title:this.localized.alerts.quality.networkRecvCatastrophicPstnAvailable.title(),text:this.localized.alerts.quality.networkRecvCatastrophicPstnAvailable.text(),actions:this.getActionsFor("NetworkRecvCatastrophicPstnAvailable"),pointUpArrowTo:_.QN.MeetingInfo});if(n("NetworkSendCatastrophicPstnAvailable",r.QualityEventType.NetworkSendCatastrophic,!0))return this.qualityAlerts.NetworkSendCatastrophicPstnAvailable||(this.qualityAlerts.NetworkSendCatastrophicPstnAvailable={dismissable:!0,type:_.NK.Error,name:"NetworkSendCatastrophicPstnAvailable",qualityAlertType:r.QualityEventType.NetworkSendCatastrophic,isLocalSource:!0,title:this.localized.alerts.quality.networkSendCatastrophicPstnAvailable.title(),text:this.localized.alerts.quality.networkSendCatastrophicPstnAvailable.text(),actions:this.getActionsFor("NetworkSendCatastrophicPstnAvailable"),pointUpArrowTo:_.QN.MeetingInfo});if(n("NetworkRecvCatastrophicPstnNotAvailable",r.QualityEventType.NetworkRecvCatastrophic,!0))return this.qualityAlerts.NetworkRecvCatastrophicPstnNotAvailable||(this.qualityAlerts.NetworkRecvCatastrophicPstnNotAvailable={dismissable:!0,type:_.NK.Error,name:"NetworkRecvCatastrophicPstnNotAvailable",qualityAlertType:r.QualityEventType.NetworkRecvCatastrophic,isLocalSource:!0,title:this.localized.alerts.quality.networkRecvCatastrophicPstnNotAvailable.title(),text:this.localized.alerts.quality.networkRecvCatastrophicPstnNotAvailable.text()});if(n("NetworkSendCatastrophicPstnNotAvailable",r.QualityEventType.NetworkSendCatastrophic,!0))return this.qualityAlerts.NetworkSendCatastrophicPstnNotAvailable||(this.qualityAlerts.NetworkSendCatastrophicPstnNotAvailable={dismissable:!0,type:_.NK.Error,name:"NetworkSendCatastrophicPstnNotAvailable",qualityAlertType:r.QualityEventType.NetworkSendCatastrophic,isLocalSource:!0,title:this.localized.alerts.quality.networkSendCatastrophicPstnNotAvailable.title(),text:this.localized.alerts.quality.networkSendCatastrophicPstnNotAvailable.text()});if(n("NetworkRecvCatastrophicPoorTurnOffVideo",r.QualityEventType.NetworkRecvCatastrophic,!0))return this.qualityAlerts.NetworkRecvCatastrophicPoorTurnOffVideo||(this.qualityAlerts.NetworkRecvCatastrophicPoorTurnOffVideo={dismissable:!0,type:_.NK.Warning,name:"NetworkRecvCatastrophicPoorTurnOffVideo",qualityAlertType:r.QualityEventType.NetworkRecvCatastrophic,isLocalSource:!0,title:this.localized.alerts.quality.networkRecvCatastrophicPoorTurnOffVideo.title(),text:this.localized.alerts.quality.networkRecvCatastrophicPoorTurnOffVideo.text(),actions:this.getActionsFor("NetworkRecvCatastrophicPoorTurnOffVideo"),timeout:_.fn});if(n("NetworkSendCatastrophicPoorTurnOffVideo",r.QualityEventType.NetworkSendCatastrophic,!0))return this.qualityAlerts.NetworkSendCatastrophicPoorTurnOffVideo||(this.qualityAlerts.NetworkSendCatastrophicPoorTurnOffVideo={dismissable:!0,type:_.NK.Warning,name:"NetworkSendCatastrophicPoorTurnOffVideo",qualityAlertType:r.QualityEventType.NetworkSendCatastrophic,isLocalSource:!0,title:this.localized.alerts.quality.networkSendCatastrophicPoorTurnOffVideo.title(),text:this.localized.alerts.quality.networkSendCatastrophicPoorTurnOffVideo.text(),actions:this.getActionsFor("NetworkSendCatastrophicPoorTurnOffVideo"),timeout:_.fn});if(n("DeviceSpeakWhileMuted",r.QualityEventType.DeviceSpeakWhileMuted,!0))return this.qualityAlerts.DeviceSpeakWhileMuted||(this.qualityAlerts.DeviceSpeakWhileMuted={dismissable:!0,type:_.NK.Standalone,name:"DeviceSpeakWhileMuted",qualityAlertType:r.QualityEventType.DeviceSpeakWhileMuted,isLocalSource:!0,title:this.localized.alerts.quality.deviceSpeakWhileMuted.title(),text:this.localized.alerts.quality.deviceSpeakWhileMuted.text(!1),isAffirmational:!0});if(n("AudioCaptureMusicDetectedWithHighNS",r.QualityEventType.AudioCaptureMusicDetectedWithHighNS,!0)){let e=this.deviceManagerService.isHighFidelityMusicModeAvailable(),t=this.config.enableAVFramework?.();return this.qualityAlerts.AudioCaptureMusicDetectedWithHighNS||(this.qualityAlerts.AudioCaptureMusicDetectedWithHighNS={dismissable:!0,type:_.NK.Warning,name:"AudioCaptureMusicDetectedWithHighNS",qualityAlertType:r.QualityEventType.AudioCaptureMusicDetectedWithHighNS,isLocalSource:!0,title:this.localized.alerts.quality.audioCaptureMusicDetectedWithHighNS.title(t),text:this.localized.alerts.quality.audioCaptureMusicDetectedWithHighNS.text(e,t),timeout:_.Iq,isAffirmational:!0,windowType:_.MA.CallScreen,actions:[{alertActionType:e?"ToggleHighFidelityMusicMode":t?"openAudioSettingsPanel":"OpenDeviceSettings",buttonText:this.localized.alerts.quality.audioCaptureMusicDetectedWithHighNS.actionText(e,t),command:()=>e?(this.deviceManagerService.enableHighFidelityMusicMode(!0),this.call.toggleMusicMode().then(e=>this.logger.info(`AudioCaptureMusicDetectedWithHighNS toggleMusicMode success cur value ${e}`)).catch(e=>this.logger.error(`AudioCaptureMusicDetectedWithLowNS toggleMusicMode success cur value ${e}`))):this.config.hooks.alerts.onOpenDeviceSettings(),buttonTrackName:e?c.vR.highFidelityMusicModeToggleFromUFD:c.vR.openDeviceSettings}]})}if(n("AudioCaptureMusicDetectedWithLowNS",r.QualityEventType.AudioCaptureMusicDetectedWithLowNS,!0))return this.qualityAlerts.AudioCaptureMusicDetectedWithLowNS||(this.qualityAlerts.AudioCaptureMusicDetectedWithLowNS={dismissable:!0,type:_.NK.Warning,name:"AudioCaptureMusicDetectedWithLowNS",qualityAlertType:r.QualityEventType.AudioCaptureMusicDetectedWithLowNS,isLocalSource:!0,title:this.localized.alerts.quality.audioCaptureMusicDetectedWithLowNS.title(),text:this.localized.alerts.quality.audioCaptureMusicDetectedWithLowNS.text(),timeout:_.Iq,windowType:_.MA.CallScreen,isAffirmational:!0,actions:[{alertActionType:"ToggleHighFidelityMusicMode",buttonText:this.localized.alerts.quality.audioCaptureMusicDetectedWithLowNS.actionText(),command:()=>(this.deviceManagerService.enableHighFidelityMusicMode(!0),this.call.toggleMusicMode().then(e=>this.logger.info(`AudioCaptureMusicDetectedWithLowNS toggleMusicMode success cur value ${e}`)).catch(e=>this.logger.error(`AudioCaptureMusicDetectedWithLowNS toggleMusicMode success cur value ${e}`))),buttonTrackName:c.vR.highFidelityMusicModeToggleFromUFD}]});if(n("DeviceMultipleEndpoints",r.QualityEventType.DeviceMultipleEndpoints,!0))return this.qualityAlerts.DeviceMultipleEndpoints||(this.qualityAlerts.DeviceMultipleEndpoints={dismissable:!0,type:_.NK.Error,name:"DeviceMultipleEndpoints",qualityAlertType:r.QualityEventType.DeviceMultipleEndpoints,isLocalSource:!0,title:this.localized.alerts.quality.deviceMultipleEndpoints.title(),text:this.localized.alerts.quality.deviceMultipleEndpoints.text(),isMicRelated:!0});if(n("AudioCaptureUltrasoundDetected",r.QualityEventType.AudioCaptureUltrasoundDetected,!0))return this.qualityAlerts.AudioCaptureUltrasoundDetected||(this.qualityAlerts.AudioCaptureUltrasoundDetected={dismissable:!0,type:_.NK.Warning,name:"AudioCaptureUltrasoundDetected",qualityAlertType:r.QualityEventType.AudioCaptureUltrasoundDetected,isLocalSource:!0,text:this.localized.alerts.quality.audioCaptureUltrasoundDetected.text(),isMicRelated:!0});if(n("DeviceCaptureMute",r.QualityEventType.DeviceCaptureMute,!0))return this.qualityAlerts.DeviceCaptureMute||(this.qualityAlerts.DeviceCaptureMute={dismissable:!0,type:_.NK.Error,name:"DeviceCaptureMute",qualityAlertType:r.QualityEventType.DeviceCaptureMute,isLocalSource:!0,title:this.localized.alerts.quality.deviceCaptureMute.title(),text:this.localized.alerts.quality.deviceCaptureMute.text(),isMicRelated:!0});if(n("DeviceCaptureNotFunctioningAudioSrvNotRunning",r.QualityEventType.DeviceCaptureNotFunctioningAudioSrvNotRunning,!0))return this.qualityAlerts.DeviceCaptureNotFunctioningAudioSrvNotRunning||(this.qualityAlerts.DeviceCaptureNotFunctioningAudioSrvNotRunning={dismissable:!0,type:_.NK.Error,name:"DeviceCaptureNotFunctioningAudioSrvNotRunning",qualityAlertType:r.QualityEventType.DeviceCaptureNotFunctioningAudioSrvNotRunning,isLocalSource:!0,title:this.localized.alerts.quality.deviceCaptureNotFunctioningAudioSrvNotRunning.title(),text:this.localized.alerts.quality.deviceCaptureNotFunctioningAudioSrvNotRunning.text(),actions:this.getActionsFor("DeviceCaptureNotFunctioningAudioSrvNotRunning")});if(n("DeviceRenderNotFunctioningAudioSrvNotRunning",r.QualityEventType.DeviceRenderNotFunctioningAudioSrvNotRunning,!0))return this.qualityAlerts.DeviceRenderNotFunctioningAudioSrvNotRunning||(this.qualityAlerts.DeviceRenderNotFunctioningAudioSrvNotRunning={dismissable:!0,type:_.NK.Error,name:"DeviceRenderNotFunctioningAudioSrvNotRunning",qualityAlertType:r.QualityEventType.DeviceRenderNotFunctioningAudioSrvNotRunning,isLocalSource:!0,title:this.localized.alerts.quality.deviceRenderNotFunctioningAudioSrvNotRunning.title(),text:this.localized.alerts.quality.deviceRenderNotFunctioningAudioSrvNotRunning.text(),actions:this.getActionsFor("DeviceRenderNotFunctioningAudioSrvNotRunning")});if(n("NoAvailableMicrophone",r.QualityEventType.ZeroCaptureDevicesEnumerated,!0))return this.qualityAlerts.NoAvailableMicrophone||(this.qualityAlerts.NoAvailableMicrophone={dismissable:!0,type:_.NK.Error,name:"NoAvailableMicrophone",qualityAlertType:r.QualityEventType.ZeroCaptureDevicesEnumerated,title:this.localized.alerts.quality.noAvailableMicrophone.title(),text:this.localized.alerts.quality.noAvailableMicrophone.text(),isLocalSource:!0});if(n("NoAvailableSpeakers",r.QualityEventType.ZeroRenderDevicesEnumerated,!0))return this.qualityAlerts.NoAvailableSpeakers||(this.qualityAlerts.NoAvailableSpeakers={dismissable:!0,type:_.NK.Error,name:"NoAvailableSpeakers",qualityAlertType:r.QualityEventType.ZeroRenderDevicesEnumerated,title:this.localized.alerts.quality.noAvailableSpeakers.title(),text:this.localized.alerts.quality.noAvailableSpeakers.text(),isLocalSource:!0});if(n("VideoCaptureDeviceFreeze",r.QualityEventType.VideoCaptureDeviceFreeze,!0)){let e=this.deviceManagerService.selectedCameraIsInternal();return this.qualityAlerts.VideoCaptureDeviceFreeze={dismissable:!0,type:_.NK.Warning,name:"VideoCaptureDeviceFreeze",qualityAlertType:r.QualityEventType.VideoCaptureDeviceFreeze,title:h?this.localized.alerts.quality.cameraIsNotWorking.title():this.localized.alerts.quality.videoCaptureDeviceFreeze.title(),text:h?this.localized.alerts.quality.cameraIsNotWorking.text(e):this.localized.alerts.quality.videoCaptureDeviceFreeze.text(),timeout:15e3,actions:this.getActionsFor("VideoCaptureDeviceFreeze"),isLocalSource:!0}}if(n("VideoCaptureFreezeRecovered",r.QualityEventType.VideoCaptureFreezeRecovered,!0))return this.qualityAlerts.VideoCaptureFreezeRecovered||(this.qualityAlerts.VideoCaptureFreezeRecovered={dismissable:!0,type:_.NK.Warning,name:"VideoCaptureFreezeRecovered",qualityAlertType:r.QualityEventType.VideoCaptureFreezeRecovered,title:this.localized.alerts.quality.videoCaptureFreezeRecovered.title(),text:this.localized.alerts.quality.videoCaptureFreezeRecovered.text(),timeout:15e3,isLocalSource:!0,actions:[{alertActionType:"BroadcastLearnMore",buttonText:this.localized.alerts.quality.videoCaptureFreezeRecovered.actionText(),command:()=>window&&window.open("https://aka.ms/producertroubleshooting","_blank"),buttonTrackName:c.vR.broadcastLearnMoreAlertButton}]});if(n("VideoCapturerDeviceStartFailed",r.QualityEventType.VideoCapturerDeviceStartFailed,!0)){let e=this.deviceManagerService.selectedCameraIsInternal();return this.qualityAlerts.VideoCapturerDeviceStartFailed={dismissable:!0,type:_.NK.Warning,name:"VideoCapturerDeviceStartFailed",qualityAlertType:r.QualityEventType.VideoCapturerDeviceStartFailed,title:h?this.localized.alerts.quality.cameraIsNotWorking.title():this.localized.alerts.quality.videoCapturerDeviceStartFailed.title(),text:h?this.localized.alerts.quality.cameraIsNotWorking.text(e):this.localized.alerts.quality.videoCapturerDeviceStartFailed.text(),timeout:15e3,actions:this.getActionsFor("VideoCapturerDeviceStartFailed"),isLocalSource:!0}}if(n("AudioCapturePermissionDenied",r.QualityEventType.AudioCapturePermissionDenied,!0))return this.qualityAlerts.AudioCapturePermissionDenied||(this.qualityAlerts.AudioCapturePermissionDenied={dismissable:!0,type:_.NK.Warning,name:"AudioCapturePermissionDenied",qualityAlertType:r.QualityEventType.AudioCapturePermissionDenied,title:this.localized.alerts.quality.audioCapturePermissionDenied?.title(g)??"",text:this.localized.alerts.quality.audioCapturePermissionDenied?.text(l===a.LearnMore,d,g)??"",timeout:_.fn,actions:this.getActionsFor("AudioCapturePermissionDenied"),isLocalSource:!0});if(n("VideoCapturePermissionDenied",r.QualityEventType.VideoCapturePermissionDenied,!0))return this.qualityAlerts.VideoCapturePermissionDenied||(this.qualityAlerts.VideoCapturePermissionDenied={dismissable:!0,type:_.NK.Warning,name:"VideoCapturePermissionDenied",qualityAlertType:r.QualityEventType.VideoCapturePermissionDenied,title:this.localized.alerts.quality.videoCapturePermissionDenied.title(h),text:this.localized.alerts.quality.videoCapturePermissionDenied.text(l===a.LearnMore,d,h),timeout:15e3,actions:this.getActionsFor("VideoCapturePermissionDenied"),isLocalSource:!0});if(n("VideoCapturerDeviceStartFailureLackSystemRes",r.QualityEventType.VideoCapturerDeviceStartFailureLackSystemRes,!0))return this.qualityAlerts.VideoCapturerDeviceStartFailureLackSystemRes||(this.qualityAlerts.VideoCapturerDeviceStartFailureLackSystemRes={dismissable:!0,type:_.NK.Warning,name:"VideoCapturerDeviceStartFailureLackSystemRes",qualityAlertType:r.QualityEventType.VideoCapturerDeviceStartFailureLackSystemRes,title:this.localized.alerts.quality.videoCapturerDeviceStartFailureLackSystemRes.title(h),text:this.localized.alerts.quality.videoCapturerDeviceStartFailureLackSystemRes.text(),timeout:15e3,isLocalSource:!0});if(n("VideoCapturerDeviceStartFailureMFResConflict",r.QualityEventType.VideoCapturerDeviceStartFailureMFResConflict,!0)){let e=this.deviceManagerService.selectedCameraIsInternal();return this.qualityAlerts.VideoCapturerDeviceStartFailureMFResConflict={dismissable:!0,type:_.NK.Warning,name:"VideoCapturerDeviceStartFailureMFResConflict",qualityAlertType:r.QualityEventType.VideoCapturerDeviceStartFailureMFResConflict,title:h?this.localized.alerts.quality.cameraIsNotWorking.title():this.localized.alerts.quality.videoCapturerDeviceStartFailureMFResConflict.title(),text:h?this.localized.alerts.quality.cameraIsNotWorking.text(e):this.localized.alerts.quality.videoCapturerDeviceStartFailureMFResConflict.text(),timeout:15e3,actions:this.getActionsFor("VideoCapturerDeviceStartFailureMFResConflict"),isLocalSource:!0}}if(n("VideoCapturerDeviceStartTimedOut",r.QualityEventType.VideoCapturerDeviceStartTimedOut,!0)){let e=this.deviceManagerService.selectedCameraIsInternal();return this.qualityAlerts.VideoCapturerDeviceStartTimedOut={dismissable:!0,type:_.NK.Warning,name:"VideoCapturerDeviceStartTimedOut",qualityAlertType:r.QualityEventType.VideoCapturerDeviceStartTimedOut,title:h?this.localized.alerts.quality.cameraIsNotWorking.title():this.localized.alerts.quality.videoCapturerDeviceStartTimedOut.title(),text:h?this.localized.alerts.quality.cameraIsNotWorking.text(e):this.localized.alerts.quality.videoCapturerDeviceStartTimedOut.text(),timeout:15e3,actions:this.getActionsFor("VideoCapturerDeviceStartTimedOut"),isLocalSource:!0}}return n("ImageRenderingQualityAlert",r.QualityEventType.ImageRenderingQuality,!1)?this.qualityAlerts.ImageRenderingQualityAlert||(this.qualityAlerts.ImageRenderingQualityAlert={dismissable:!1,type:_.NK.Warning,name:"ImageRenderingQualityAlert",qualityAlertType:r.QualityEventType.ImageRenderingQuality,showQualityIndicator:!0,text:this.localized.alerts.quality.imageRenderingQualityAlert.text(),isLocalSource:!1}):n("AudioCaptureUltrasoundDetectedWithUnmuteButton",r.QualityEventType.AudioCaptureUltrasoundDetected,!0)?this.qualityAlerts.AudioCaptureUltrasoundDetectedWithUnmuteButton||(this.qualityAlerts.AudioCaptureUltrasoundDetectedWithUnmuteButton={dismissable:!0,type:_.NK.Warning,name:"AudioCaptureUltrasoundDetectedWithUnmuteButton",qualityAlertType:r.QualityEventType.AudioCaptureUltrasoundDetected,isLocalSource:!0,title:this.localized.alerts.quality.audioCaptureUltrasoundDetectedWithCallToActionToUnmute.title?.()||void 0,text:this.localized.alerts.quality.audioCaptureUltrasoundDetectedWithCallToActionToUnmute.text(),isMicRelated:!0,actions:[{alertActionType:"UnmuteMicAndSpeakers",buttonText:this.localized.alerts.quality.audioCaptureUltrasoundDetectedWithCallToActionToUnmute.actionText(),command:()=>{this.howlingSuppressionService.handleUFDAction(this.call,!1)},buttonTrackName:c.vR.unmuteMicAndSpeakers}]}):n("AudioCaptureUltrasoundDetectedWithMuteButton",r.QualityEventType.AudioCaptureUltrasoundDetected,!0)?this.qualityAlerts.AudioCaptureUltrasoundDetectedWithMuteButton||(this.qualityAlerts.AudioCaptureUltrasoundDetectedWithMuteButton={dismissable:!0,type:_.NK.Warning,name:"AudioCaptureUltrasoundDetectedWithMuteButton",qualityAlertType:r.QualityEventType.AudioCaptureUltrasoundDetected,isLocalSource:!0,title:this.localized.alerts.quality.audioCaptureUltrasoundDetectedWithCallToActionToMute.title?.(),text:this.localized.alerts.quality.audioCaptureUltrasoundDetectedWithCallToActionToMute.text(),isMicRelated:!0,actions:[{alertActionType:"MuteSpeakerAndMicAudio",buttonText:this.localized.alerts.quality.audioCaptureUltrasoundDetectedWithCallToActionToMute.actionText(),command:()=>{this.howlingSuppressionService.handleUFDAction(this.call,!0)},buttonTrackName:c.vR.muteMicAndSpeakers}]}):n("NoRequiredVideoCodecs",r.QualityEventType.NoRequiredVideoCodecs,!0)?this.qualityAlerts.NoRequiredVideoCodecs||(this.qualityAlerts.NoRequiredVideoCodecs={dismissable:!0,type:_.NK.Warning,name:"NoRequiredVideoCodecs",qualityAlertType:r.QualityEventType.NoRequiredVideoCodecs,isLocalSource:!0,title:this.localized.alerts.quality.noRequiredVideoCodecs?.title()??"",text:this.localized.alerts.quality.noRequiredVideoCodecs?.text()??"",actions:[{alertActionType:"OpenLearnMoreLink",buttonText:this.localized.alerts.quality.noRequiredVideoCodecs?.actionText()??"",command:()=>window?.open(s.gT.docs.browserLimitsAndSpecificationsUrl,"_blank"),buttonTrackName:c.vR.learnMore}]}):void 0}initAlertsWithPermanentDismiss(){this.alertsWithPermanentDismiss={ScreenSharingNotSupported:h.l.ScreensharingUfdDismissed,VoiceCollectionStarted:h.l.VoiceCollectionStartedUfdDismissed,VoiceCollectionStopped:h.l.VoiceCollectionStoppedUfdDismissed,VDINotOptimized:h.l.VDINotOptimizedUfdDismissed,CurrentMeetingIsXL:h.l.XlMeetingJoinedWithOldClientDismissed}}dismiss(e){let t="string"==typeof e?e:e.name,i=this.activeAlerts.filter(e=>e.name===t);this.isAlertChangeEventHandlerEnabled&&i.forEach(e=>{e.onAlertDismiss&&e.onAlertDismiss()}),this.dismissLocal(i)}getAllActiveAlerts(){return this.activeAlerts}getAlerts(e,t){let i=this.activeAlerts.filter(t=>t.windowType===e&&t.teamsCallId===this.call.teamsCallId);if(!t)return i;switch(t){case _.C1.CallingAlertBanner:return this.isNewCriticalAlertDesignEnabled?i.filter(e=>e.type!==_.NK.Error):i;case _.C1.CallingActionButtons:case _.C1.CallingCenterScreen:return this.isNewCriticalAlertDesignEnabled?i.filter(e=>e.type===_.NK.Error):[]}}isAlertSuppressed(e,t){return e==c.iF.callMonitor&&"DeviceAtCallStart"==t}getAlertsOfTypes(e){return e&&e.length&&this.call?this.activeAlerts.filter(t=>t&&e.indexOf(t.name)>=0&&t.teamsCallId===this.call.teamsCallId):[]}setCurrentCall(e){this.call||e?.state!==r.CallState.Disconnecting&&e?.state!==r.CallState.Disconnected&&(this.resetAlerts(),this.call=e,this.speakerHWMuted=!1,this.initAndRegisterListeners(),this.initPstnState(),this.onParticipantCountsChanged(),this.isDeviceAtCallStartUFDEnabled&&!(this.callPreJoinService.isCallStartedThroughPreJoin(this.call)||this.call.isScreenshareFromChat)&&this.triggerDeviceAtCallStart(this.call),this.wasPoorNetworkAlertActive=!1)}initPstnState(){this.isPstnAvailable=!1,this.call.getPstnAvailabilityAsync().then(e=>{this.isPstnAvailable=e})}isHostViewModeActiveInMeeting(e){return this.callingSupportService.isHostViewModeActive(e.meetingDetails?.meetingCapability)}handleOnDemandAlert(e){let t=this.loggingService.newScenario(I.RG.CallRegisterNewAlertService,null,null,null,!0),i=this.activeAlerts.filter(t=>t.name===e.name);if(e.qualityLevel===r.QualityLevel.Good)this.dismissLocal(i);else{if(i.length>0){this.updateTimerForAlerts(i),t.stop({message:"existing alert to register; updating timer",reason:e.name}),this.logger.info(`updating existing alert to register: ${JSON.stringify(e)}`);return}this.add(e),t.stop({message:"register new alert",reason:e.name}),this.logger.info(`register new alert: ${JSON.stringify(e)}`)}}showMutedBroadcastEtmUfdIfNeeded(e){if(!e||!e.isMuted)return!1;if(T._.isMySourcesInLivePreview(e)){this.logger.info("Creating muted producers UFD alert");let t={name:"BroadcastMutedProducerWarning",type:_.NK.Warning,title:this.localized.alerts.broadcastMutedProducer.title(),text:this.localized.alerts.broadcastMutedProducer.text(),isScreensharingCallRelated:e.isScreenSharingOn,dismissable:!0,actions:[{alertActionType:"UnmuteSpeakers",buttonText:this.localized.alerts.broadcastMutedProducer.actionText(),command:()=>{let t=(0,E.Z)();this.logger.info(`[cid: ${t}] Unmuting from BroadcastMutedProducerWarning UFD`),this.callTogglingService.toggleMuteAudio(e,g.c3.App,g.Jn.Unmute,{[s.gT.counters.eventNames.context]:"ufd-muted-producers"},t)},buttonTrackName:c.vR.unmute}]};return this.handleOnDemandAlert(t),!0}return!1}videoEffectsFailure(e){this.call&&this.call.callId===e&&this.onAlert(this.alert("videoEffectsFailureAlert"))}dismissAlerts(...e){this.activeAlerts.filter(t=>(0,o.includes)(e,t.name)).forEach(e=>this.dismiss(e))}updateSystemAudioDevice(e,t){switch(this.dismissAlerts("SystemAudioStarted","SystemAudioDevicesStoppedWithError","SystemAudioDevicesMismatchInCallingScreen","SystemAudioNoDeviceInCallingScreen","DeviceNearEndToEchoRatio"),t){case p.S.noMicrophone:case p.S.noSpeakers:this.call&&this.call.callId===e&&this.onAlert(this.alert("systemAudioNoDeviceInCallingScreenAlert"));return;case p.S.speakersMismatch:this.alert("systemAudioDevicesMismatchInCallingScreenAlert").text=this.localized.alerts.systemAudioSpeakersMismatch.text(this.getSpeakerLabel()),this.call&&this.call.callId===e&&this.onAlert(this.alert("systemAudioDevicesMismatchInCallingScreenAlert"));return;case p.S.started:this.alert("systemAudioStartedAlert").text=this.localized.alerts.systemAudioStarted.text(this.getSpeakerLabel()),this.call&&this.call.callId===e&&!this.platformDetectService.isRigel()&&this.onAlert(this.alert("systemAudioStartedAlert"));return;case p.S.stoppedWithError:this.call&&this.call.callId===e&&this.onAlert(this.alert("systemAudioStoppedWithErrorAlert"));return;case p.S.stopped:return}}trigger(e,t,i){this.asObservable.trigger(e,t,i)}getSpeakerLabel(){let e=this.deviceManagerService.getSelectedDevices(),t=this.deviceManagerService.getSpeakers().find(t=>t.id===e.speaker);return t?t.label:""}triggerSystemAudioLowQualityAlert(e){if(this.call&&this.call.teamsCallId===e){let e=this.qualityAlert(void 0,r.QualityEventType.DeviceNearEndToEchoRatio,void 0);this.onAlert(e)}}triggerDeviceAtCallStart(e){let t=this.deviceManagerService.getSelectedCompositeDeviceLabel(e);this.alert("deviceAtCallStartAlert").text=this.localized.alerts.deviceAtCallStart.text(t);let i=t!==this.localized.customDeviceLabel()||this.deviceManagerService.getSelectedSpeakerLabel()&&this.deviceManagerService.getSelectedMicrophoneLabel();this.call&&this.call.callId===e.callId&&i&&(this.addTimerForAlert(this.alert("deviceAtCallStartAlert"),w),this.onAlert(this.alert("deviceAtCallStartAlert")))}showNewCriticalUFDDesign(){return this.isNewCriticalAlertDesignEnabled}cleanUp(){this.call=null,this.suppressDeviceSpeakWhileMutedUFD=!1,this.isPstnAvailable=!1,this.lastIsHostViewModeActiveState=!1,this.unsubscribeListeners()}initAndRegisterListeners(){let e=S.w.getTeamsCallIdAsString(this.call.teamsCallId),t=(0,o.debounce)(()=>this.updateRemoteMute());this.listeners.push(this.call.on("sharedWindowStateChanged",()=>this.sharedWindowStateChanged())),this.listeners.push(this.call.on("screensharingCallEscalated",()=>this.onScreensharingCallEscalated())),this.listeners.push(this.call.on("videoDisabledWhileScreensharing",()=>this.onVideoDisabledWhileScreensharing())),this.listeners.push(this.call.on("sharingDropped",()=>this.onAlert(this.alert("sharingDroppedAlert")))),this.listeners.push(this.call.on("callQualityChanged",e=>this.onQualityChanged(e))),this.listeners.push(this.call.on("publishedStatesChanged",e=>this.nsiHelper.onPublishedStatesChanged(this.call,e))),this.enableHostViewMode&&this.listeners.push(this.call.changed(()=>{this.removeAttendeeHostViewAlertsIfStreaming(),this.onHostViewModeChanged()})),this.listeners.push(this.call.on("callStateChanged",()=>{let e=`Call state changed to ${C.eU.stringifyCallState(this.call.state)}`;this.logQualityChangedEventScenario(e);let i=[r.CallState.Disconnected,r.CallState.LocalHold];if((0,o.includes)(i,this.call.state))return void this.cleanUp();t(),this.call.state===r.CallState.Connected&&(this.nsiHelper.onCallConnected(this.call),this.lastIsHostViewModeActiveState=this.isHostViewModeActiveInMeeting(this.call),this.onParticipantCountsChanged(),this.allowSpeakerMuteUfdToShowFor15Sec())})),this.isWindowsOSPlatform&&(this.callTogglingBrowserOSUnmuteSubscription=this.mtmaSubscriptionUtility.subscribe(this.callTogglingService,()=>{this.add(this.alert("browserOSUnmuteFailAlert"))},v.h.Type_CallTogglingBrowserOSUnmute,e)),this.callTogglingMuteAudioCalledSubscription=this.mtmaSubscriptionUtility.subscribe(this.callTogglingService,(e,t)=>{this.stopTrackingUnmuting(),this.dismissAudioVideoContentRelatedAlerts("MicUnmuteTakesLongerTime","MicUnmuteFail","SpeakerAndMicUnmuted","ContentOnlyAlert","ContentOnlyFromNudgeAlert"),!t&&(this.dismissNotUnmutingMutedRemotelyAlerts(),this.call.isServerMuted&&this.call.state!==r.CallState.InLobby&&(this.unmutingWithoutUFDPromise=this.timeout.set(()=>this.startUnmutingWithUFD(),this.unmutingWithoutUfdTimeout,!1)))},v.h.Type_CallTogglingMuteAudioCalled,e),this.callTogglingUnmuteFailSubscription=this.mtmaSubscriptionUtility.subscribe(this.callTogglingService,()=>{this.stopTrackingUnmuting(),this.dismissAudioVideoContentRelatedAlerts("MicUnmuteTakesLongerTime","MicMutedRemotely","SpeakerAndMicUnmuted","ContentOnlyAlert","ContentOnlyFromNudgeAlert"),this.onAlert(this.alert("micUnmuteFailAlert"))},v.h.Type_CallTogglingUnmuteFailed,e),this.config.enableExplicitRecordingConsent?.()?this.call.subscribeToServerMutedChangedEvent(t):this.listeners.push(this.call.on("serverMutedChanged",t)),this.registerUnmuteSpeakerAndMicAlert(),this.registerRenderingFailuresBanner(),this.showMeetingRolesDialogUnsubscribe=this.tenantScopeEventingService.registerHandlerForExternalEvent(s.gT.events.calling.actionFailedWithInsufficientMeetingRole,({titleAction:e,textAction:t})=>this.showInsufficientMeetingRoleUfd(e,t)),this.verifyExistingCameraUnsubscribe=this.tenantScopeEventingService.registerHandlerForExternalEvent(s.gT.events.calling.verifyExistingCamera,this.verifyExistingCamera.bind(this)),this.registerDeviceHotSwapAlerts(),this.deviceManagerServicevideoEffectsQualityDegradedSubscription=this.mtmaSubscriptionUtility.subscribe(this.deviceManagerService,()=>this.add(this.alert("videoEffectsQualityDegradedAlert")),s.gT.events.calling.videoEffectsQualityDegraded),this.deviceManagerServiceSpeakerChangedSubscription=this.mtmaSubscriptionUtility.subscribe(this.deviceManagerService,()=>{this.allowSpeakerMuteUfdToShowFor15Sec()},s.gT.events.calling.callSpeakerChanged),this.participantCountsChangedSubscription=this.mtmaSubscriptionUtility.subscribe(this.participantCountsService,(e,t)=>this.onParticipantCountsChanged(t),b.j.Type_CallParticipantCountsChanged,e),this.callPaywallRemainingDurationSubscription=this.mtmaSubscriptionUtility.subscribe(this.callPaywallservice,(e,t)=>this.onPaywallStateChanged(t,y.s.Type_FreemiumCallDurationGatesReached),y.s.Type_FreemiumCallDurationGatesReached,e),this.callPaywallRemainingParticipantCapacitySubscription=this.mtmaSubscriptionUtility.subscribe(this.callPaywallservice,(e,t)=>this.onPaywallStateChanged(t,y.s.Type_FreemiumCallCapacityGatesReached),y.s.Type_FreemiumCallCapacityGatesReached,e),this.callPaywallTimerStartsSubscription=this.mtmaSubscriptionUtility.subscribe(this.callPaywallservice,(e,t)=>this.onPaywallStateChanged(t,y.s.Type_PaywallTimerStarts),y.s.Type_PaywallTimerStarts,e)}updateRemoteMute(){this.call&&this.call.isServerMuted&&this.call.state!==r.CallState.InLobby?(this.logger.info("Mute: You got serverMuted."),this.stopTrackingUnmuting(),this.call.callMode===r.CallMode.Streaming&&this.dismissAudioVideoContentRelatedAlerts("DeviceCaptureNotMuteButSilent","VideoCapturePermissionDenied","DeviceCaptureNotFunctioning","DeviceCaptureNotFunctioningBluetoothMidCallFail","DeviceCaptureNotFunctioningWebcamMicMidCallFail"),this.dismissAudioVideoContentRelatedAlerts("MicUnmuteTakesLongerTime"),this.micMutedRemotely()):(null===this.unmutingWithUFDPromise&&this.dismissAudioVideoContentRelatedAlerts("MicUnmuteTakesLongerTime"),this.timeout.cancel(this.unmutingWithoutUFDPromise),this.unmutingWithoutUFDPromise=null,this.dismissAudioVideoContentRelatedAlerts("MicMutedRemotely","MicUnmuteFail"))}unsubscribeListeners(){this.activeAlerts.forEach(e=>this.timeout.cancel(e.timer)),this.activeAlerts=[],this.listeners.forEach(e=>e&&e.dispose()),this.listeners=[],this.alertsInBlockTimeframe=[],this.addAlertToBlockTimeframeListPromise&&(this.timeout.cancel(this.addAlertToBlockTimeframeListPromise),this.addAlertToBlockTimeframeListPromise=void 0),this.callTogglingMuteAudioCalledSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.callTogglingService,this.callTogglingMuteAudioCalledSubscription),delete this.callTogglingMuteAudioCalledSubscription),this.callTogglingBrowserOSUnmuteSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.callTogglingService,this.callTogglingBrowserOSUnmuteSubscription),delete this.callTogglingBrowserOSUnmuteSubscription),this.callTogglingUnmuteFailSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.callTogglingService,this.callTogglingUnmuteFailSubscription),delete this.callTogglingUnmuteFailSubscription),this.participantCountsChangedSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.participantCountsService,this.participantCountsChangedSubscription),delete this.participantCountsChangedSubscription),this.callPaywallRemainingDurationSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.callPaywallservice,this.callPaywallRemainingDurationSubscription),delete this.callPaywallRemainingDurationSubscription),this.callPaywallRemainingParticipantCapacitySubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.callPaywallservice,this.callPaywallRemainingParticipantCapacitySubscription),delete this.callPaywallRemainingParticipantCapacitySubscription),this.callPaywallTimerStartsSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.callPaywallservice,this.callPaywallTimerStartsSubscription),delete this.callPaywallTimerStartsSubscription),this.unmuteSpeakersAndMicSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.callTogglingService,this.unmuteSpeakersAndMicSubscription),delete this.unmuteSpeakersAndMicSubscription),this.verifyExistingCameraUnsubscribe&&this.verifyExistingCameraUnsubscribe(),this.deviceManagerServiceSpeakerChangedSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.deviceManagerServiceSpeakerChangedSubscription),delete this.deviceManagerServiceSpeakerChangedSubscription),this.deviceManagerServicevideoEffectsQualityDegradedSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.deviceManagerServicevideoEffectsQualityDegradedSubscription),delete this.deviceManagerServicevideoEffectsQualityDegradedSubscription),this.deviceManagerAudioDeviceSelectionChangedSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.deviceManagerAudioDeviceSelectionChangedSubscription),delete this.deviceManagerAudioDeviceSelectionChangedSubscription),this.deviceManagerActiveVideoDevicePluggedOutSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.deviceManagerActiveVideoDevicePluggedOutSubscription),delete this.deviceManagerActiveVideoDevicePluggedOutSubscription),this.deviceManagerNewVideoDevicePluggedInSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.deviceManagerService,this.deviceManagerNewVideoDevicePluggedInSubscription),delete this.deviceManagerNewVideoDevicePluggedInSubscription),this.rigelDisplayDisconnected.unsubscribe&&(this.rigelDisplayDisconnected.unsubscribe(),this.rigelDisplayDisconnected.unsubscribe=void 0),this.showMeetingRolesDialogUnsubscribe&&(this.showMeetingRolesDialogUnsubscribe(),this.showMeetingRolesDialogUnsubscribe=void 0),this.trigger()}dismissLocal(e){e.forEach(e=>{e.dismissable&&this.timeout.cancel(e.timer),this.remove(e)})}remove(e,t=!1){let i;-1!==(i=this.isDeviceAtCallStartUFDEnabled||t?this.activeAlerts.findIndex(t=>t.teamsCallId==e.teamsCallId&&t.name==e.name):this.activeAlerts.indexOf(e))&&(this.alertsWithPermanentDismiss.hasOwnProperty(e.name)&&this.callPropsStoreService.set(this.call.teamsCallId,this.alertsWithPermanentDismiss[e.name],!0),this.activeAlerts.splice(i,1)),this.trigger()}isAlertBlockedToBeShown(e){let t=(0,o.includes)(this.disabledUFDs,e),i=(0,o.includes)(this.alertsInBlockTimeframe,e);if(t){let e=`${alert.name}UFD is being blacklisted from ECS list: ${JSON.stringify(this.disabledUFDs)}`;this.qualityEvents.push(`${e}
`),this.logger.info(e)}else if(i){let e=`${alert.name}UFD is being blacklisted from BlockingShowingWindow list: ${JSON.stringify(this.alertsInBlockTimeframe)}`;this.qualityEvents.push(`${e}
`),this.logger.info(e)}return t||i}add(e,t){let i=this.loggingService.newScenario(I.RG.CallNewAlertService,null,null,null,!0);if(e.qualityLevel&&e.qualityLevel===r.QualityLevel.Bad&&(e.showQualityIndicator=!0),!e.teamsCallId){if(!this.call){let t={message:"update alerts failed because there was no active call",reason:e.name.toString()};e.qualityAlertType&&(t.qualityAlertType=e.qualityAlertType),i.fail(t);return}e.teamsCallId=this.call.teamsCallId}if(this.alertsWithPermanentDismiss.hasOwnProperty(e.name)&&!0===this.callPropsStoreService.get(e.teamsCallId,this.alertsWithPermanentDismiss[e.name]))return void i.cancel();if(this.isAlertBlockedToBeShown(e.name))return void i.cancel({context:"Alert blacklisted"});if(this.callingSupportService.blockAVOverIPInMeetings()&&this.blockAVoverIPSuppressedAlerts.includes(e.name)||!this.callingSupportService.isIPAudioModeEnabled&&this.ipAudioModeDisabledSuppressedAlerts.includes(e.name))return void i.cancel();if(this.call&&(this.callingSupportService.isCallInContentOnlyMode(this.call)&&this.contentOnlySuppressedAlerts.includes(e.name)||this.call.isScreenshareFromChat&&this.screenshareOnlySuppressedAlerts.includes(e.name))||this.call&&this.callPreheatStates.includes(this.call.state)&&this.preheatSuppressedAlerts.includes(e.name))return void i.incomplete();if((0,o.includes)(this.callingHeaderAlerts,e.name)||(0,o.includes)(this.callingFooterAlerts,e.name)||(0,o.includes)(this.sharingPanelAlerts,e.name)||t){if("MicMutedRemotely"===e.name&&!this.isNewCriticalAlertDesignEnabled){let t=this.createNewAlert(e,_.MA.CallingFooter,_.V6.Top,D);this.activeAlerts.push(t)}}else{let t=this.createNewAlert(e,_.MA.CallScreen,_.V6.Top);this.activeAlerts.push(t)}if("SomeoneWaitingInLobby"===e.name){let t=this.createNewAlert(e,_.MA.ExternalCallMonitor,_.V6.Top);this.activeAlerts.push(t)}let n=this.qualityAlert(e.name),a="NoAvailableCamera"===e.name?this.alert("NoAvailableCamera"):void 0,s=this.isNewCriticalAlertDesignEnabled||!(0,o.includes)(this.callingFooterAlerts,e.name),l=this.isNewCriticalAlertDesignEnabled&&"MicMutedRemotely"===e.name,c=this.isNewCriticalAlertDesignEnabled&&"NoAvailablePSTN"===e.name,d=this.isNewCriticalAlertDesignEnabled&&"SharedWindowMinimized"===e.name,g=this.isNewCriticalAlertDesignEnabled&&("SystemAudioDevicesMismatchInCallingScreen"===e.name||"SystemAudioNoDeviceInCallingScreen"===e.name||"SystemAudioDevicesStoppedWithError"===e.name),h=this.isNewCriticalAlertDesignEnabled&&"BetterTogetherOutOfProximityWarning"===e.name;if(s&&(n||a||l||c||d||e.isScreensharingCallRelated||g||h)){let t=this.createNewAlert(e,_.MA.CallMonitor,_.V6.Bottom);this.activeAlerts.push(t);let i=this.createNewAlert(e,_.MA.ExternalCallMonitor,_.V6.Top);this.activeAlerts.push(i)}if(this.callingHeaderAlerts.indexOf(e.name)>-1&&!this.tryAddNetworkQualityAlertWithDisableVideoSuggestion(e)){let t=this.createNewAlert(e,_.MA.CallingHeader,_.V6.Top);this.activeAlerts.push(t)}if(this.callingFooterAlerts.indexOf(e.name)>-1){let t=this.createNewAlert(e,_.MA.CallingFooter,_.V6.Top);"InteropScreenshare"===e.name||"MergeFailedAlert"===e.name||"CallTransferPstnFallbackFailedAlert"===e.name?this.activeAlerts.unshift(t):this.activeAlerts.push(t)}if(this.sharingPanelAlerts.indexOf(e.name)>-1){let t=this.createNewAlert(e,_.MA.CallScreensharingPanel,_.V6.Bottom);this.activeAlerts.push(t)}(e.qualityAlertType===r.QualityEventType.AudioCaptureMusicDetectedWithHighNS||e.qualityAlertType===r.QualityEventType.AudioCaptureMusicDetectedWithLowNS)&&(this.call.isMusicDetectionUFDTriggered=!0);let p={message:"update alerts successful",reason:e.name.toString()};e.qualityAlertType&&(p.qualityAlertType=e.qualityAlertType),i.stop(p),this.logger.info(`adding new alert: ${JSON.stringify(e)}`),this.trigger()}createNewAlert(e,t,i,n){let a=(0,o.cloneDeep)(e),r=this.config.enableAudioDiagnostics?.();switch(a.windowType=t,a.position=i,a.timestamp=Date.now(),a.name){case"DeviceRenderNotFunctioning":a.text=this.localized.alerts.quality.deviceRenderNotFunctioning.text(r);break;case"DeviceCaptureNotFunctioning":a.text=this.localized.alerts.quality.deviceCaptureNotFunctioning.text(r)}return this.addTimerForAlert(a,n||a.timeout),a}isReceivingIncomingVideo(){return this.call.participants.some(e=>e.streams[r.StreamType.Video].some(e=>e.isStreaming))}tryAddNetworkQualityAlertWithDisableVideoSuggestion(e){if(!this.shouldSuggestToDisableVideoOnPoorNetworks||"NetworkQuality"!==e.name||!this.isReceivingIncomingVideo())return!1;let t=this.createNewAlert({...e,type:_.NK.Error,name:"NetworkQualityWithDisableVideoSuggestion",actions:this.getActionsFor("NetworkQualityWithDisableVideoSuggestion")},_.MA.CallingFooter,_.V6.Top);return this.activeAlerts.push(t),!0}getAlertTimeout(e){if("MicMutedRemotely"===e.name)return D;if("NetworkQuality"===e.name)return this.config.networkQualityUFDTimeoutTime()||D;switch(e.type){case _.NK.Info:return 12e3;case _.NK.Warning:return D;default:return 0}}addTimerForAlert(e,t){if(this.enableUfdV2)return;let i=null==t?this.getAlertTimeout(e):t;if(e.dismissable&&i&&i!==_.fn){if(this.isAlertChangeEventHandlerEnabled){e.timer=this.timeout.set(()=>{e.onAlertExpire&&e.onAlertExpire(),this.remove(e)},i);return}e.timer=this.timeout.set(()=>this.remove(e),i)}}get isAlertChangeEventHandlerEnabled(){return!!this.config.enableAlertChangeEventHandler()}updateTimerForAlerts(e){(0,o.forEach)(e,e=>{let t=this.getAlertTimeout(e);e.dismissable&&e.timer&&t&&(this.timeout.cancel(e.timer),e.timer=this.timeout.set(()=>this.remove(e),t))})}shouldCreateAlert(e,t){return!!this.shouldCreateAlertForDeviceSpeakWhileMuted(e)&&(e.type===r.QualityEventType.VideoCaptureFreezeRecovered?this.call.isBroadcast:!(e.type===r.QualityEventType.CpuInsufficient&&this.platformDetectService.isRigel())&&!!this.shouldCreateAlertForUltrasoundDetection(e)&&(e.type!==r.QualityEventType.AudioCaptureMusicDetectedWithLowNS&&e.type!==r.QualityEventType.AudioCaptureMusicDetectedWithHighNS||!!this.shouldCreateMusicModeUFD(e))&&(e.type!==r.QualityEventType.NoRequiredVideoCodecs||this.platformDetectService.getBrowser()===s.gT.browser.firefox&&!!this.localized.alerts.quality.noRequiredVideoCodecs)&&!!this.shouldCreateSpeakerMutedAlert(e)&&(t?e.value===r.QualityLevel.Bad:(!this.isWindowsOSPlatform||e.type!==r.QualityEventType.DeviceCaptureMute)&&this.isLowQuality(e.value)))}shouldCreateSpeakerMutedAlert(e){return e.type!==r.QualityEventType.DeviceRenderMute||this.call.state===r.CallState.Connected}shouldCreateMusicModeUFD(e){let t=this.config.enableAVFramework?.(),i=this.deviceManagerService.isHighFidelityMusicModeAvailable();return!!this.enableMusicModeUFD&&!this.call.isMusicModeEnabled&&!this.call.isMusicDetectionUFDTriggered&&(e.type!==r.QualityEventType.AudioCaptureMusicDetectedWithLowNS&&!t||!!i)}shouldCreateAlertForUltrasoundDetection(e){if(e.type===r.QualityEventType.AudioCaptureUltrasoundDetected){if(!this.enableAudioCaptureUltrasoundUFD||!this.isDesktopEnabled||this.call.state!==r.CallState.Connected)return!1;let t=this.desktopUtilityService.getSlimCoreVersion();if(0>this.utilityService.compareVersions(t,"2020.04.01.3")||!this.isLowQuality(e.value)||this.call.isSpeakerMuted&&this.call.isMuted)return!1}return!0}isLowQuality(e){let t=[r.QualityLevel.Bad,r.QualityLevel.Poor];return(0,o.includes)(t,e)}showInsufficientMeetingRoleUfd(e,t){let i={name:"InsufficientMeetingRole",type:_.NK.Warning,title:this.localized.alerts.insufficientMeetingRole.title(e),text:this.localized.alerts.insufficientMeetingRole.text(t),dismissable:!0};this.onAlert(i)}onMeetingRoleChanged(e){if(this.logger.info(`Alert: meeting role in call ${e.teamsCallId} changed to ${e.meetingRole} (initial assignment: ${e.isInitialAssignment})`),"attendee"===e.meetingRole||!e.isInitialAssignment){let t=this.platformDetectService.isRigel(),i=this.localized.alerts.meetingParticipantRoleChanged.title(e.meetingRole,e.isAttendeeAudioRestricted,this.callingService.getActiveCall().isBroadcast,e.isInitialAssignment,e.isAttendeeVideoRestricted),n=this.localized.alerts.meetingParticipantRoleChanged.text(e.meetingRole,e.isAttendeeAudioRestricted,t,e.isAttendeeVideoRestricted);this.logger.info("Displaying meeting role changed alert"),t||e.isInitialAssignment||this.showMeetingRoleChangedAlert(i,n)}}showMeetingRoleChangedAlert(e,t){this.dismissAlerts("MeetingRoleChanged","Meeting_attendees_audio_restricted");let i={dismissable:!0,type:_.NK.Warning,name:"MeetingRoleChanged",title:e,text:t,isAffirmational:!0};this.onAlert(i)}onScreensharingCallEscalated(){if(this.isScreensharingCallEscalationEnabled){if(this.call.isScreensharingCallRemotelyEscalated())return void this.call.getAudioEscalationInitiator().then(e=>{this.peopleService.getPeopleProfile(e,"calling-screensharing-call-escalated-alert").then(e=>{this.logger.info(`ScreenshareOnly: call escalation initiator name fetched for call: ${this.call.callId}`);let t=e&&(e.givenName||e.displayName);t?(this.alert("screenSharingCallEscalatedAlert").title=this.localized.alerts.screenSharingCallEscalated.title(t),this.alert("screenSharingCallEscalatedAlert").ariaText=this.localized.alerts.screenSharingCallEscalated.ariaText(t)):this.logger.error(`ScreenshareOnly: call escalation initiator was fetched for call ${this.call.callId} but name is empty`),this.onAlert(this.alert("screenSharingCallEscalatedAlert"))}).catch(e=>{this.logger.error(`ScreenshareOnly: call escalation initiator failed to fetch user profile from mri for call ${this.call.callId} with error ${e}`),this.onAlert(this.alert("screenSharingCallEscalatedAlert"))})}).catch(e=>{this.logger.error(`ScreenshareOnly: call escalation initiator mri failed to fetch for ${this.call.callId} with error ${e}`),this.onAlert(this.alert("screenSharingCallEscalatedAlert"))});if(this.call.isScreenshareFromChat)return void this.onAlert(this.alert("screenSharingCallFailedToEscalatedAlert"));this.dismiss(this.alert("screenSharingCallEscalatedAlert")),this.dismiss(this.alert("screenSharingCallFailedToEscalatedAlert"))}}onVideoDisabledWhileScreensharing(){this.call&&this.callingSupportService.isSingleOutgoingVideoEnabled()&&this.onAlert(this.alert("videoDisabledWhileScreensharingAlert"))}logQualityChangedEventScenario(e){if(this.qualityEvents.length>0){let t=`Current accumlated Quality Events collection. Reason : ${e} 
`;this.loggingService.newScenario(I.RG.CallQualityEvent).stop({message:t+this.qualityEvents.toString()}),this.logger.info(t);let i="",n=0;for(let e in this.qualityEvents)i+=this.qualityEvents[e],2==++n&&(this.logger.info(i),n=0,i="");i.length>0&&this.logger.info(i),this.qualityEvents=[]}}getNetworkCatastrophicAlert(e){let t;if(this.enableTurnOffVideoUFDOnPoorNetworks&&e.value===r.QualityLevel.Poor){if(!this.isReceivingIncomingVideo()&&!this.call.isVideoOn)return;let i=this.activeAlerts.filter(e=>"NetworkQuality"===e.name);0===i.length||this.wasPoorNetworkAlertActive||this.dismissLocal(i),0!==this.activeAlerts.filter(e=>"NetworkSendCatastrophicPstnAvailable"===e.name||"NetworkRecvCatastrophicPstnAvailable"===e.name||"NetworkSendCatastrophicPstnNotAvailable"===e.name||"NetworkRecvCatastrophicPstnNotAvailable"===e.name).length||this.wasPoorNetworkAlertActive||(t=e.type===r.QualityEventType.NetworkSendCatastrophic?"NetworkSendCatastrophicPoorTurnOffVideo":"NetworkRecvCatastrophicPoorTurnOffVideo",this.wasPoorNetworkAlertActive=!0)}else{if(e.value===r.QualityLevel.Bad){let e=this.activeAlerts.filter(e=>"NetworkSendCatastrophicPoorTurnOffVideo"===e.name||"NetworkRecvCatastrophicPoorTurnOffVideo"===e.name||"NetworkQuality"===e.name);this.dismissLocal(e)}t=this.isPstnAvailable?e.type===r.QualityEventType.NetworkSendCatastrophic?"NetworkSendCatastrophicPstnAvailable":"NetworkRecvCatastrophicPstnAvailable":e.type===r.QualityEventType.NetworkSendCatastrophic?"NetworkSendCatastrophicPstnNotAvailable":"NetworkRecvCatastrophicPstnNotAvailable"}return this.qualityAlert(t)}onQualityChanged(e){let t,i,n,a;this.nsiHelper.onQualityChange(this.call,e,this.config.enableNetworkStrengthIndicators()),e&&e.id&&(e.id=this.chatServiceUtils.scrubMri(e.id));try{a=JSON.stringify(e)}catch(t){a=String(e.type)}if(this.call&&this.call.isInTransportCompanionMode()){let e=`Received quality alert in transport companion mode. Ignoring alert and not showing UFD ${t.name.toString()}`;(i=this.loggingService.newScenario(I.RG.CallNewAlertService,null,null,null,!0)).stop({message:e,reason:t.name}),n=e,this.qualityEvents.push(`${n}
`);return}if(this.config.enableMicrophonePermissionUFD?.()&&e.type===r.QualityEventType.AudioCapturePermissionDenied)return void this.logger.info("Blocked AudioCapturePermissionDenied event due to enableMicrophonePermissionUFD being true.");let l=`onQualityChanged alert received : ${a}`,d=[r.QualityEventType.NetworkSendQuality,r.QualityEventType.NetworkRecvQuality],g=(0,o.includes)(d,e.type);if(g){let i=this.platformDetectService.isRigel();0!==this.activeAlerts.filter(e=>"NetworkSendCatastrophicPoorTurnOffVideo"===e.name||"NetworkRecvCatastrophicPoorTurnOffVideo"===e.name).length||i||(t=this.qualityAlert("NetworkQuality",void 0,e.isLocalSource))}else if(e.type===r.QualityEventType.DeviceCaptureNotMuteButSilent&&this.isUnsupportedHidDeviceSelected)n="DeviceCaptureNotMuteButSilent suppressed since unsupported HidDevice is selected.";else if(e.type===r.QualityEventType.NetworkSendCatastrophic||e.type===r.QualityEventType.NetworkRecvCatastrophic)t=this.getNetworkCatastrophicAlert(e);else if(this.shouldSuppressSystemAudioPoorQualityAlert&&e.type===r.QualityEventType.DeviceNearEndToEchoRatio)this.isLowQuality(e.value)||(t=this.qualityAlert(void 0,e.type,e.isLocalSource));else if(e.type===r.QualityEventType.AudioCaptureUltrasoundDetected&&this.shouldCreateAlertForUltrasoundDetection(e)){let i=this.howlingSuppressionService.handleUltrasoundEvent(this.call);i.shouldShow&&(t=this.qualityAlert(i.alert.name,e.type,e.isLocalSource))}else t=this.qualityAlert(void 0,e.type,e.isLocalSource);if(e.type===r.QualityEventType.DeviceSpeakWhileMuted&&t&&(t.text=this.localized.alerts.quality.deviceSpeakWhileMuted.text(this.call.consentRequiredAndNotGiven())),this.platformDetectService.isSurfaceHub()&&e.type===r.QualityEventType.DeviceRenderZeroVolume&&(0,o.find)(this.activeAlerts,e=>e.qualityAlertType===r.QualityEventType.DeviceRenderMute)&&this.speakerHWMuted)return void this.logger.info("Ignoring DeviceRenderZeroVolume alert, as DeviceRenderMute alert is already added to activeAlerts");if(e.type===r.QualityEventType.DeviceRenderMute){e.value===r.QualityLevel.Bad?(this.suppressDeviceSpeakWhileMutedUFD=!0,n="Ignored DeviceSpeakWhileMuted because speakers were muted",this.speakerHWMuted=!0):e.value===r.QualityLevel.Good&&(this.suppressDeviceSpeakWhileMutedUFD=!1,this.speakerHWMuted=!1);let t=(0,E.Z)();this.logger.info(`[cid=${t}] speaker hardware muted changed, speakerHWMuted: ${this.speakerHWMuted}`),this.call&&this.callTogglingService.toggleSpeaker(this.call,this.speakerHWMuted,t)}if(!t){n=n||"Ignored unknown quality event";let e=`QualityChangedEventSummary: ${l} ${n}`;this.logger.info(e),this.qualityEvents.push(`${e}
`);return}let h=this.activeAlerts.filter(e=>e.name===t.name),p=e.value===r.QualityLevel.Good||g&&!this.call.isBroadcast&&e.value===r.QualityLevel.Poor;if(h.length>0)i=this.loggingService.newScenario(I.RG.CallNewAlertService,null,null,null,!0),p?(this.dismissLocal(h),i.stop({message:"quality level good update",reason:t.name}),n=`Good event - Existing alert - Dismissing ${t.name.toString()}`):(this.updateTimerForAlerts(h),i.stop({message:"existing alert; updating timer",reason:t.name}),n=`Good event received - Updating existing alert - Updating ${t.name.toString()}`);else{if(this.platformDetectService.getBrowser()===s.gT.browser.safari&&e.type===r.QualityEventType.ScreenshareRecordingDisabled)return void this.eventingService.emit(s.gT.events.calling.toggleGetUserMediaDialog,{dialogType:"screensharing",show:!0});this.isWindowsOSPlatform&&this.muteHelper.onQualityChanged(e,this.call),this.shouldCreateAlert(e,g)&&("DeviceLowSNR"===t.name?this.deviceManagerService.getMicrophones().length>1&&(t.text=this.localized.alerts.deviceLowSignalToNoiseRatio.text(),t.title=this.localized.alerts.deviceLowSignalToNoiseRatio.title(),t.actions=[{alertActionType:"SwitchMicrophone",buttonText:this.localized.alerts.deviceLowSignalToNoiseRatio.actionText(),command:this.switchMicrophone.bind(this),buttonTrackName:c.vR.switchAudioDevice}]):n="No alert handling found. shouldCreateAlert returns false.",(g||e.type===r.QualityEventType.NetworkReconnect)&&(t.qualityAlertType=e.type),t.qualityLevel=e.value,this.enablePSTNFallbackForUFDs&&this.updatePSTNActionButtonForAlert(t,this.callingService.getActiveCall()),this.add(t),n=`UI UFD alert triggered for ${t.name.toString()}`)}n||(n="No action taken. Event ignored.");let u=`QualityChangedEventSummary: ${l} --- ${n}`;this.logger.info(u),this.qualityEvents.push(`${u}
`)}shouldCreateAlertForDeviceSpeakWhileMuted(e){if(e.type===r.QualityEventType.DeviceSpeakWhileMuted){let t;if(this.call.isSelfAttendeeRestrictedForModality(u.p.Audio)?t="the attendee is hard muted":e.value===r.QualityLevel.Bad&&this.suppressDeviceSpeakWhileMutedUFD?t="quality level bad - most likely speakers are muted":this.call.isMuted&&this.call.isSpeakerMuted?t="the user has mic and speakers muted":this.call.isImmersiveEvent&&(t="the attendee is in an Immersive Event"),t){let e=`Ignoring DeviceSpeakWhileMuted alert, reason: ${t}`;return this.qualityEvents.push(`${e}
`),this.logger.info(e),!1}}return!0}removeAttendeeHostViewAlertsIfStreaming(){this.call.callMode===r.CallMode.Streaming&&this.dismissAlerts("AttendeeHostViewModeActivatedRaiseHand","AttendeeHostViewModeActivated")}isAttendeeInParticipationPreferences(e){let t=e?.callOptions,i=t?.callStartOptions?.participationPreferences;if(i){let e=i?.requestedEndpointMeetingRoles;return!!e&&1===e.length&&"attendee"===e[0]}return!1}onHostViewModeChanged(){let e=this.isHostViewModeActiveInMeeting(this.call);if(this.lastIsHostViewModeActiveState!==e){this.logger.info(`Alert: host view mode in call ${this.call.teamsCallId} changed to isHostViewModeActive: ${e}`);let t=this.call.isRaiseHandsEnabled&&this.call.isRaiseHandAllowedInMeeting,i=this.isAttendeeInParticipationPreferences(this.call),n="attendee"===this.call.meetingRole||i;e?(this.logger.info("Displaying HostViewModeActivated alert"),this.dismissAlerts("HostViewModeDeactivated","AttendeeHostViewModeDeactivated"),n?t?this.onAlert(this.alert("attendeeHostViewModeRaiseHandAlert")):this.onAlert(this.alert("attendeeHostViewModeAlert")):this.call.meetingRole&&this.onAlert(this.alert("hostViewModeActivatedAlert"))):(this.logger.info("Displaying HostViewModeDeactivated alert"),this.dismissAlerts("HostViewModeActivated","AttendeeHostViewModeActivated","AttendeeHostViewModeActivatedRaiseHand"),n?this.onAlert(this.alert("attendeeHostViewDeactivatedAlert")):this.onAlert(this.alert("hostViewModeDeactivatedAlert"))),this.lastIsHostViewModeActiveState=e}}onAlert(e,t){let i=this.activeAlerts.filter(t=>t.name===e.name);i.length>0?this.updateTimerForAlerts(i):this.add(e,t)}switchMicrophone(){let e=this.deviceManagerService.getSelectedDevices().microphone,t=this.deviceManagerService.getMicrophones().filter(t=>t.id!=e);this.deviceManagerService.selectDevices({microphone:t[0].id},"CallingAlertsService: switchMicrophone");let i=this.activeAlerts.filter(e=>"DeviceLowSNR"===e.name);this.dismissLocal(i)}isRunningOnMac(){return this.platformDetectService.getOS()==s.gT.os.mac}getActionsFor(e){let t=this.config.enableAVFramework?.(),i=this.config.enableAudioDiagnostics?.(),n=this.config.enableVideoDiagnostics?.(),r=this.getDevicePermissionWarningMode();switch(e){case"DeviceRenderNotFunctioning":case"DeviceRenderNotFunctioningAudioSrvNotRunning":if(this.isDesktopEnabled&&this.deviceManagerService.getSpeakers().length>1)return[{alertActionType:t?"openAudioSettingsPanel":"OpenDeviceSettings",buttonText:this.localized.alerts.quality.deviceRenderNotFunctioning.actionText(t,i),command:()=>this.config.hooks.alerts.onDeviceRenderNotFunctioning(),buttonTrackName:c.vR.openDeviceSettings}];break;case"DeviceCaptureNotFunctioning":case"DeviceCaptureNotMuteButSilent":case"DeviceCaptureNotFunctioningAudioSrvNotRunning":if(this.deviceManagerService.getMicrophones().length>1)return[{alertActionType:t?"openAudioSettingsPanel":"OpenDeviceSettings",buttonText:this.localized.alerts.quality.deviceCaptureNotFunctioning.actionText(t,i),command:()=>this.config.hooks.alerts.onDeviceCaptureNotFunctioning(),buttonTrackName:c.vR.openDeviceSettings}];break;case"VideoCapturerDeviceStartFailed":case"VideoCapturerDeviceStartTimedOut":case"VideoCapturerDeviceStartFailureMFResConflict":case"VideoCaptureDeviceFreeze":let o=this.deviceManagerService.getCameras();if(n&&o.length>1)return[{alertActionType:t?"openVideoEffectsAndSettingsPanel":"OpenDeviceSettings",buttonText:this.localized.alerts.quality.cameraIsNotWorking.actionText(),command:()=>{},buttonTrackName:c.vR.openDeviceSettings}];break;case"DeviceRenderMute":return this.platformDetectService.isSurfaceHub()?void 0:[{alertActionType:"UnmuteSpeakers",buttonText:this.localized.alerts.quality.deviceRenderMute.actionText(),command:this.unmuteHardMutedSpeaker.bind(this),buttonTrackName:c.vR.unmuteSpeakers}];case"NetworkSendCatastrophicPstnAvailable":case"NetworkRecvCatastrophicPstnAvailable":return this.enablePSTNFallbackForUFDs?[{alertActionType:"OpenMeetingInfo",buttonText:this.localized.alerts.quality.networkSendCatastrophicPstnAvailable.actionText(),command:()=>this.config.hooks.alerts.onNetworkFailure(!0),sendBiTelemetry:e=>this.sendBiTelemetryForPSTNFallback(),buttonTrackName:c.vR.openMeetingDetails}]:void 0;case"NetworkRecvCatastrophicPoorTurnOffVideo":case"NetworkSendCatastrophicPoorTurnOffVideo":case"NetworkQualityWithDisableVideoSuggestion":return[{alertActionType:"DisableIncomingAndOutgoingVideo",buttonText:this.localized.alerts.quality.networkSendCatastrophicPoorTurnOffVideo.actionText(),command:()=>{if(this.callTogglingService.isIncomingVideoOn(this.call)&&this.callTogglingService.toggleIncomingVideo(this.call),this.call.isVideoOn){let e=(0,E.Z)();this.logger.info(`[cid: ${e}] Disabling video from DisableIncomingAndOutgoingVideo`),this.callTogglingService.toggleVideo(this.call,"ufdTurnOffVideo",e,!1)}},buttonTrackName:c.vR.ufdTurnOffVideo}];case"VideoCapturePermissionDenied":if(!this.isRunningOnMac()&&!this.isWindowsOSPlatform||this.desktopUtilityService.isWeb())return;{let e=r===a.LearnMore?this.config.vdiDevicePermissionDialogLink():this.isWindowsOSPlatform?"ms-settings:privacy-webcam":"x-apple.systempreferences:com.apple.preference.security?Privacy_Camera";return[{alertActionType:"OpenVideoDevicePermission",buttonText:this.localized.alerts.quality.videoCapturePermissionDenied.actionText(r===a.LearnMore),command:()=>r===a.OpenSettingsVDI?this.callingAgentsService.openPrivacySettings?.():window&&window.open(e),buttonTrackName:c.vR.broadcastLearnMoreAlertButton}]}case"AudioCapturePermissionDenied":if(!this.isRunningOnMac()&&!this.isWindowsOSPlatform)return;{let e=r===a.LearnMore?this.config.vdiDevicePermissionDialogLink():this.isWindowsOSPlatform?"ms-settings:privacy-microphone":"x-apple.systempreferences:com.apple.preference.security?Privacy_Microphone";return[{alertActionType:"OpenAudioDevicePermission",buttonText:this.localized.alerts.quality.audioCapturePermissionDenied?.actionText(r===a.LearnMore)??"",command:()=>r===a.OpenSettingsVDI?this.callingAgentsService.openPrivacySettings?.():window&&window.open(e),buttonTrackName:c.vR.broadcastLearnMoreAlertButton}]}default:return}}getPSTNFallbackActionForAlert(e,t){return{buttonText:this.localized.alerts.actions.pstnFallback(t.isDialOutEnabled),command:()=>this.config.hooks.alerts.onPstnFallbackDialog(),buttonTrackName:c.vR.pstnFallbackUFDButton,sendBiTelemetry:()=>this.sendBiTelemetryForPSTNFallback(e),alertActionType:"ShowPstnDialog"}}updatePSTNActionButtonForAlert(e,t){if((0,o.includes)(this.pstnActionAlerts,e.name)){let i=e.actions?e.actions.filter(e=>"ShowPstnDialog"===e.alertActionType):[],n=this.callingService.getPstnDialCapabilities(t),a=n.isDialInEnabled||n.isDialOutEnabled;if(this.isPstnAvailable&&a){if(0===i.length){let t=this.getPSTNFallbackActionForAlert(e,n);e.actions?e.actions.push(t):e.actions=[t]}}else e.actions=e.actions?e.actions.filter(e=>"ShowPstnDialog"!==e.alertActionType):e.actions}return e}registerUnmuteSpeakerAndMicAlert(){this.callingSupportService.isPreJoinContentOnlyEnabled()&&(this.unmuteSpeakersAndMicSubscription=this.mtmaSubscriptionUtility.subscribe(this.callTogglingService,e=>{this.stopTrackingUnmuting(),this.dismissAudioVideoContentRelatedAlerts("DisableIncomingMeetingAudio","EnableIncomingMeetingAudio","MicUnmuteTakesLongerTime","MicUnmuteTakesLongerTime","MicMutedRemotely","MicUnmuteFail","SpeakerAndMicUnmuted","ContentOnlyAlert","ContentOnlyFromNudgeAlert","CannotUnmuteOSMicrophone"),this.onAlert(this.alert("unmuteSpeakerAndMicAlert"))},v.h.Type_CallTogglingSpeakersAndMicCalled,S.w.getTeamsCallIdAsString(this.call.teamsCallId)))}registerRenderingFailuresBanner(){if(this.isDesktopEnabled)if(this.callingAgentsService.getCallSupportDetector().videoRenderingFailuresDetected){let e=this.call.changed(()=>{this.call.state===r.CallState.Connected&&(this.onAlert(this.alert("renderingFailuresAlert")),e.dispose())});this.listeners.push(e)}else{let e=this.callingAgentsService.getCallSupportDetector().changed(()=>{this.callingAgentsService.getCallSupportDetector().videoRenderingFailuresDetected&&this.onAlert(this.alert("renderingFailuresAlert"))});this.listeners.push(e)}}registerDeviceHotSwapAlerts(){this.deviceManagerService.enableDeviceHotSwap()&&(this.deviceManagerAudioDeviceSelectionChangedSubscription=this.mtmaSubscriptionUtility.subscribe(this.deviceManagerService,()=>this.onAudioDeviceSelectionChanged(),s.gT.events.calling.audioDeviceSelectionChanged),this.deviceManagerActiveVideoDevicePluggedOutSubscription=this.mtmaSubscriptionUtility.subscribe(this.deviceManagerService,(e,t)=>this.onActiveVideoDevicePluggedOut(t),s.gT.events.calling.activeVideoDevicePluggedOut),this.deviceManagerNewVideoDevicePluggedInSubscription=this.mtmaSubscriptionUtility.subscribe(this.deviceManagerService,(e,t)=>this.onNewVideoDevicePluggedIn(t),s.gT.events.calling.newVideoDevicePluggedIn),this.videoDevicePluggedInAlertCount=0,this.audioDeviceSelectionChangedCount=0,this.activeVideoDevicePluggedOutCount=0)}dismissHotSwapRelatedAlerts(...e){this.activeAlerts.filter(t=>(0,o.includes)(e,t.name)).forEach(e=>this.dismiss(e))}verifyExistingCamera(e){this.call&&this.call.teamsCallId===e.teamsCallId&&this.deviceManagerService.getCameraAvailable().then(e=>{let t=this.activeAlerts.filter(e=>"NoAvailableCamera"===e.name);if(e)this.dismissLocal(t);else{let e=this.alert("NoAvailableCamera");this.onAlert(e)}}).catch(e=>{try{this.logger.error(`deviceManager failed to get available camera: ${JSON.stringify(e)}`)}catch(e){this.logger.error("deviceManager failed to get available camera with error while stringifying the payload")}})}onNewVideoDevicePluggedIn(e){if(this.videoDevicePluggedInAlertCount+=1,this.videoDevicePluggedInAlertCount>this.config.maximumTimesHotSwapUFDTriggered()){this.dismissHotSwapRelatedAlerts("NewVideoDevicePluggedInAlert","ActiveVideoDevicePluggedOutAlert"),this.logger.info(`NewVideoDevicePluggedInAlert has been triggered ${this.videoDevicePluggedInAlertCount} times`);return}this.alerts.NewVideoDevicePluggedInAlert={name:"NewVideoDevicePluggedInAlert",type:_.NK.Warning,title:this.localized.alerts.newVideoDevicePluggedIn.title(),text:this.localized.alerts.newVideoDevicePluggedIn.text(e.label),dismissable:!0,actions:[{alertActionType:"SwitchDevice",buttonText:this.localized.alerts.newVideoDevicePluggedIn.actionText(),command:()=>this.deviceManagerService.selectDevices({camera:e.id},"CallingAlertsService: ufdNewVideoDevicePluggedIn"),buttonTrackName:c.vR.switchToNewPluggedInVideoDevice}]},this.dismissHotSwapRelatedAlerts("NewVideoDevicePluggedInAlert","ActiveVideoDevicePluggedOutAlert"),this.handleOnDemandAlert(this.alert("NewVideoDevicePluggedInAlert"))}onAudioDeviceSelectionChanged(){if(this.audioDeviceSelectionChangedCount+=1,this.audioDeviceSelectionChangedCount>this.config.maximumTimesHotSwapUFDTriggered()){this.dismissHotSwapRelatedAlerts("AudioDeviceSelectionChangedAlert"),this.logger.info(`AudioDeviceSelectionChangedAlert has been triggered ${this.audioDeviceSelectionChangedCount} times`);return}let e=this.deviceManagerService.getSelectedCompositeDeviceLabel(this.call),t=this.localized.alerts.audioDeviceSelectionChanged.text(e),i=this.config.enableAVFramework?.();this.alerts.AudioDeviceSelectionChangedAlert={name:"AudioDeviceSelectionChangedAlert",type:_.NK.Warning,title:this.localized.alerts.audioDeviceSelectionChanged.title(),text:t,dismissable:!0,actions:[{alertActionType:i?"openAudioSettingsPanel":"OpenDeviceSettings",buttonText:this.localized.alerts.audioDeviceSelectionChanged.actionText(i),command:()=>this.config.hooks.alerts.onAudioDeviceSelectionChanged(),buttonTrackName:c.vR.openDeviceSettings}]},this.dismissHotSwapRelatedAlerts("AudioDeviceSelectionChangedAlert"),t&&this.handleOnDemandAlert(this.alerts.AudioDeviceSelectionChangedAlert)}onActiveVideoDevicePluggedOut(e){if(this.activeVideoDevicePluggedOutCount+=1,this.activeVideoDevicePluggedOutCount>this.config.maximumTimesHotSwapUFDTriggered()){this.dismissHotSwapRelatedAlerts("ActiveVideoDevicePluggedOutAlert","NewVideoDevicePluggedInAlert"),this.logger.info(`ActiveVideoDevicePluggedOutAlert has been triggered ${this.activeVideoDevicePluggedOutCount} times`);return}let t=this.config.enableAVFramework?.();this.alerts.ActiveVideoDevicePluggedOutAlert={name:"ActiveVideoDevicePluggedOutAlert",type:_.NK.Warning,title:this.localized.alerts.activeVideoDevicePluggedOut.title(),text:this.localized.alerts.activeVideoDevicePluggedOut.text(e.label),dismissable:!0,actions:[{alertActionType:t?"openVideoEffectsAndSettingsPanel":"OpenDeviceSettings",buttonText:this.localized.alerts.activeVideoDevicePluggedOut.actionText(t),command:()=>this.config.hooks.alerts.onActiveVideoDevicePluggedOut(),buttonTrackName:c.vR.switchToCurrentBestCamera}]},this.dismissHotSwapRelatedAlerts("ActiveVideoDevicePluggedOutAlert"),this.handleOnDemandAlert(this.alerts.ActiveVideoDevicePluggedOutAlert)}showVoiceCollectionAlerts(e,t){let i=null;switch(e){case d.y.started:(i=this.alert("VoiceCollectionStarted")).actions=[{alertActionType:"OptOutFromVoiceCollection",buttonText:this.localized.alerts.actions.voiceCollectionOptOut(),command:()=>this.call.optOutFromVoiceCollection(),buttonTrackName:c.vR.optOutVoiceCollection,isSecondary:!0,sendBiTelemetry:()=>this.sendBiTelemetry(c.Lc.mdpDataCollection,"OptOutFromVoiceCollection")},{alertActionType:"CloseVoiceCollection",buttonText:this.localized.alerts.actions.voiceCollectionClose(),command:()=>{this.dismiss(i),this.remove(i)},buttonTrackName:c.vR.closeVoiceCollection,sendBiTelemetry:()=>this.sendBiTelemetry(c.Lc.mdpDataCollection,"CloseVoiceCollection")}];break;case d.y.none:let n=this.call?this.call.teamsCallId:"";(0,o.filter)(this.activeAlerts,e=>"VoiceCollectionStarted"===e.name&&e.teamsCallId==n).forEach(e=>this.remove(e)),i=this.alert("VoiceCollectionStopped")}i.teamsCallId=t,this.onAlert(i)}showBotViewAlerts(e){switch(e){case"AudienceButton":let t=this.alert("AudienceViewFailed");this.onAlert(t);break;case"LargeGridButton":let i=this.alert("LargeGalleryViewFailed");this.onAlert(i)}}showAudienceViewSceneAckAlert(){this.dismissAlerts("AudienceViewSceneAck","AudienceViewSceneChanged");let e={name:"AudienceViewSceneAck",text:this.localized.alerts.audienceViewSceneAck.text(),dismissable:!0,type:_.NK.Info};this.handleOnDemandAlert(e)}showAudienceViewSceneChangedAlert(e,t){this.dismissAlerts("AudienceViewSceneAck","AudienceViewSceneChanged"),this.sendBiTelemetryForSceneChange(t,"AudienceViewSceneChanged");let i={name:"AudienceViewSceneChanged",text:this.localized.alerts.audienceViewSceneChanged.text(),dismissable:!0,type:_.NK.Info};this.peopleService.getPeopleProfile(e,"calling-audience-view-scene-changed-alert").then(e=>{let t=e&&(e.displayName||e.givenName);t&&(i.text=this.localized.alerts.audienceViewSceneChanged.text(t)),this.handleOnDemandAlert(i)}).catch(e=>{this.logger.warn(`[showAudienceViewSceneChangedAlert] error fetching user's profile: ${e}`),this.handleOnDemandAlert(i)})}showAudienceViewSceneChangeFailedAlert(){let e={name:"AudienceViewSceneChangeFailed",text:this.localized.alerts.audienceViewSceneChangeFailed.text(),dismissable:!0,type:_.NK.Warning};this.handleOnDemandAlert(e)}micMutedRemotely(){!this.call.isImmersiveEvent&&(this.call.isMuted||this.call.callMode===r.CallMode.Streaming||this.call.isSelfAttendeeRestrictedForModality(u.p.Audio)||this.onAlert(this.call.isEmergencyCall&&!this.call.capabilities?.canUnmuteSelf||this.platformDetectService.isRigel()?this.alert("micMutedRemotelyAlertWithoutUnmuteButton"):this.alert("micMutedRemotelyAlert")))}sharedWindowStateChanged(){let e=!1;this.call.isBroadcast&&this.call.broadcastMeeting&&this.call.broadcastMeeting.role===f.q.constants.role.producer&&!this.callingMultiWindowService.isCallSupportedInModernCalling(this.call)&&(e=!0),this.call.sharedWindowState===m.T.WindowMinimized?this.onAlert(this.alert("sharedWindowMinimizedAlert"),e):this.dismiss(this.alert("sharedWindowMinimizedAlert"))}startUnmutingWithUFD(){this.onAlert(this.alert("micUnmuteTakesLongerTime")),this.stopTrackingUnmuting(),this.unmutingWithUFDPromise=this.timeout.set(()=>this.stopUnmutingWithUFD(),this.unmutingWithUfdTimeout,!1)}stopUnmutingWithUFD(){this.callTogglingService.isMuted(this.call)||this.dismissAudioVideoContentRelatedAlerts("MicUnmuteTakesLongerTime"),this.unmutingWithUFDPromise=null}stopTrackingUnmuting(){this.timeout.cancel(this.unmutingWithoutUFDPromise),this.unmutingWithoutUFDPromise=null,this.timeout.cancel(this.unmutingWithUFDPromise),this.unmutingWithUFDPromise=null}dismissAudioVideoContentRelatedAlerts(...e){this.activeAlerts.filter(t=>(0,o.includes)(e,t.name)).forEach(e=>this.dismiss(e))}dismissNotUnmutingMutedRemotelyAlerts(){this.activeAlerts.filter(e=>"MicMutedRemotely"===e.name).forEach(e=>{e.actions&&0!==e.actions.length&&e.actions[0].buttonDisabled||this.dismiss(e)})}changeToUnmutingPhaseMicMutedAlerts(){this.activeAlerts.filter(e=>"MicMutedRemotely"===e.name).forEach(e=>{e.actions[0].buttonText=this.localized.alerts.actions.callingUnmuting(),e.actions[0].buttonDisabled=!0})}onParticipantCountsChanged(e){this.call&&this.call.state===r.CallState.Connected&&(e||(e=this.participantCountsService.getCallParticipantCounts(this.call.teamsCallId)),e&&(this.showXlMeetingsUFDsIfNeeded(e),this.toggleSomeoneWaitingInLobbyUFD(e)))}onPaywallStateChanged(e,t){this.call&&this.call.state===r.CallState.Connected&&this.showPaywallStateChangedAlert(t,e)}showPaywallStateChangedAlert(e,t){let i={buttonText:this.localized.alerts.paywallRemainingParticipantCapacity.actionText(),command:t.upgrade,buttonTrackName:c.vR.paywallUpgradeButton,alertActionType:"PaywallUpgrade"};if(e===y.s.Type_FreemiumCallDurationGatesReached){let e="organizer"===t.paywallRole?[{...i,buttonTrackScenario:c.Lc.paywallUpgrade,buttonTrackScenarioType:c.JM.meetingWillTimeoutNotification,buttonTrackType:c.iF.callPaywallDurationAlertLearnMore}]:void 0;this.onAlert({name:"PaywallRemainingDuration",title:this.localized.alerts.paywallRemainingDuration.title(),text:this.localized.alerts.paywallRemainingDuration.text(t.paywallRole),type:_.NK.Warning,windowType:_.MA.CallScreen,dismissable:!0,actions:e})}else e===y.s.Type_FreemiumCallCapacityGatesReached?this.onAlert({name:"PaywallRemainingParticipantCapacity",title:this.localized.alerts.paywallRemainingParticipantCapacity.title(),text:this.localized.alerts.paywallRemainingParticipantCapacity.text(),type:_.NK.Warning,windowType:_.MA.CallScreen,dismissable:!0,actions:[{...i,buttonTrackScenario:c.Lc.paywallUpgrade,buttonTrackScenarioType:c.JM.meetingIsFullNotification,buttonTrackType:c.iF.callPaywallCapacityAlert}]}):e===y.s.Type_PaywallTimerStarts&&this.onAlert({name:"PaywallTimerStart",title:this.localized.alerts.paywallTimerStart.title(),text:this.localized.alerts.paywallTimerStart.text(),type:_.NK.Warning,windowType:_.MA.CallScreen,dismissable:!0,actions:[{...i,buttonTrackScenario:c.Lc.paywallUpgrade,buttonTrackScenarioType:c.JM.enforcementStatusChangeNotification,buttonTrackType:c.iF.callPaywallTimerStartAlert}]})}showXlMeetingsUFDsIfNeeded(e){this.xlMeetingRosterParticipantsCountForUfd&&!this.call.wasPoppedOut&&e.totalAttendees+e.totalPresenters>this.xlMeetingRosterParticipantsCountForUfd&&(this.desktopUtilityService.isWeb()?this.onAlert(this.alert("currentMeetingIsXlAlert")):this.desktopUtilityService.isVDI()&&this.onAlert({...this.alert("currentMeetingIsXlAlert"),text:this.localized.xlMeetingJoinedWithVdiClient()}))}toggleSomeoneWaitingInLobbyUFD(e){if(this.enableSomeoneWaitingInLobbyUFD&&this.desktopUtilityService.isDesktop()&&"attendee"!==this.call.meetingRole)e.lobbyParticipants>0?this.onAlert(this.alert("someoneWaitingInLobbyAlert"),!0):this.remove(this.alert("someoneWaitingInLobbyAlert"))}onCallChanged(){this.setCurrentCall(this.callingService.getActiveCall())}getDisabledUFDs(){this.disabledUFDs=this.config.disabledUfds()}blockAlertToShowAfterTimeout(e,t){this.removeAlertFromBlockTimeframeList(e),this.addAlertToBlockTimeframeListPromise=this.timeout.set(()=>this.addAlertToBlockTimeframeList(e),t)}removeAlertFromBlockTimeframeList(e){this.addAlertToBlockTimeframeListPromise&&(this.timeout.cancel(this.addAlertToBlockTimeframeListPromise),this.addAlertToBlockTimeframeListPromise=void 0),(0,o.includes)(this.alertsInBlockTimeframe,e)&&(this.alertsInBlockTimeframe=this.alertsInBlockTimeframe.filter(t=>t!=e))}addAlertToBlockTimeframeList(e){(0,o.includes)(this.alertsInBlockTimeframe,e)||this.alertsInBlockTimeframe.push(e)}allowSpeakerMuteUfdToShowFor15Sec(){this.blockAlertToShowAfterTimeout("DeviceRenderMute",15e3)}sendBiTelemetryForPSTNFallback(e){let t={action:{gesture:c.Yk.click,scenario:c.Lc.pstnFallbackPstnComponent},module:{type:c.iF.button,name:c.vR[c.vR.pstnComponentInPstnFallback]},dataBag:{context:e?e.name:"network-catastrophic"}};this.callingTelemetryService.enrichEventDataWithDialInOutInfo(this.call,t.dataBag).finally(()=>{this.analyticsService.sendPanelAction(t)})}sendBiTelemetry(e,t,i,n){let a={action:{gesture:c.Yk.click,scenario:e},module:{type:c.iF.button,name:t,summary:i},dataBag:n};this.analyticsService.getAnalyticsPanelActionEventData(a).then(e=>this.analyticsService.sendPanelAction(e))}sendBiTelemetryForSceneChange(e,t){let i={action:{gesture:c.Yk.asyncStateChange,outcome:c.E8.show},module:{name:t,type:c.iF.other},dataBag:{selectedAudienceScene:e}},n=this.analyticsService.getAnalyticsPanelActionEventData(i);n instanceof Promise&&n.then(e=>this.analyticsService.sendPanelAction(e))}setIsUnsupportedHidDeviceSelected(e){this.isUnsupportedHidDeviceSelected=e}get isSpeakerHWMuted(){return this.speakerHWMuted}get isUfdV2Enabled(){return this.enableUfdV2}}},273213:function(e,t,i){var n,a,r,o;i.d(t,{a_:()=>n,fS:()=>l,px:()=>s,xp:()=>a});let s=["zh-cn"];(r=n||(n={}))[r.AiInterpretationUI=0]="AiInterpretationUI",r[r.AiInterpretationService=1]="AiInterpretationService",r[r.ClosedCaptions=2]="ClosedCaptions",r[r.ClosedCaptionsMW=3]="ClosedCaptionsMW",r[r.Transcript=4]="Transcript",r[r.TranscriptMW=5]="TranscriptMW",r[r.Coach=6]="Coach",r[r.CoachMW=7]="CoachMW",r[r.Facestream=8]="Facestream",r[r.CloudPeopleFeed=9]="CloudPeopleFeed",r[r.CombinedRecordingAndTranscription=10]="CombinedRecordingAndTranscription",r[r.LanguageMismatch=11]="LanguageMismatch",r[r.CopilotMW=12]="CopilotMW",r[r.SkySafe=13]="SkySafe",(o=a||(a={}))[o.AiInterpretation=0]="AiInterpretation",o[o.Event=1]="Event",o[o.Coach=2]="Coach",o[o.TextTrack=3]="TextTrack",o[o.CopilotBot=4]="CopilotBot",o[o.SkySafe=5]="SkySafe";let l="<spokenLanguage>"},71682:function(e,t,i){i.d(t,{z:()=>_});var n=i(370574),a=i(229283),r=i(273213),o=i(575810),s=i(377957);class l{constructor(e,t,i){this.call=e,this.meetingIntelligenceLogService=t,this.logger=i,this.initializeTelemetryData(),this.initializeTranscriptEntryStatisticData(),this.telemetryIntervalId=setInterval(()=>this.logDataChannelTelemetry(),o.gT.timeInMiliseconds.minute)}dispose(){clearInterval(this.telemetryIntervalId),this.meetingIntelligenceLogService.info(null,"CallingBotDataChannelLogger",`Cleared interval with id = ${this.telemetryIntervalId}`),this.telemetryIntervalId=void 0}info(e){this.logger.info(e)}error(e){this.logger.error(e)}warn(e){this.logger.warn(e)}logDataChannelTelemetry(){0===this.telemetryData.events.receivedEventsSinceLastTick&&0===this.telemetryData.captions.receivedFinalEntriesSinceLastTick&&0===this.telemetryData.captions.receivedPartialEntriesSinceLastTick&&0===this.telemetryData.captions.lastFinalTextLength&&0===this.telemetryData.captions.lastPartialTextLength&&0===this.telemetryData.textTracks.receivedTextTracksSinceLastTick&&0===this.telemetryData.coachResults.receivedCoachResultsSinceLastTick&&++this.telemetryData.numberOfTicksWithNoData>=5||(this.meetingIntelligenceLogService.info(this.telemetryData,"CallingBotDataChannelLogger"),this.resetTelemetryDataCounters(),this.telemetryData.numberOfTicksWithNoData=0)}initializeTelemetryData(){this.telemetryData={callId:this.call.callId,totalDataReceivedCount:0,receivedNullDataCount:0,receivedUnknownDataCount:0,lastDataReceivedTimestamp:"",lastDataType:"",currentActiveDataChannelRegistrations:"",parserErrorCount:0,numberOfTicksWithNoData:0,events:{lastTimestamp:"",lastEventType:"",lastId:"",lastEditId:"",totalEventCount:0,receivedEventsSinceLastTick:0,botParticipantId:""},captions:{lastFinalEntryTimestamp:"",lastPartialEntryTimestamp:"",lastFinalEntryId:"",lastPartialEntryId:"",totalFinalEntryCount:0,receivedFinalEntriesSinceLastTick:0,totalPartialEntryCount:0,receivedPartialEntriesSinceLastTick:0,emptyFinalTextCount:0,emptyPartialTextCount:0,botParticipantId:"",lastFinalTextLength:0,lastPartialTextLength:0},textTracks:{lastFinalEntryTimestamp:"",lastPartialEntryTimestamp:"",lastFinalEntryId:"",lastPartialEntryId:"",totalFinalEntryCount:0,receivedFinalEntriesSinceLastTick:0,totalPartialEntryCount:0,receivedPartialEntriesSinceLastTick:0,emptyFinalTextCount:0,emptyPartialTextCount:0,botParticipantId:"",lastFinalTextLength:0,lastPartialTextLength:0,totalTextTrackCount:0,receivedTextTracksSinceLastTick:0},coachResults:{lastTimestamp:"",lastType:"",lastId:"",totalCoachResultCount:0,receivedCoachResultsSinceLastTick:0}}}initializeTranscriptEntryStatisticData(){this.transcriptEntryStatisticData={totalCaptionDataCount:0,totalCaptionFinalDataCount:0,totalTextTracks:{[a.cl.Mt]:0,[a.cl.Cart]:0,[a.cl.Cea708]:0},totalFinalTextTracks:0},this.meetingIntelligenceLogService.updateStatisticData(s.w.getTeamsCallIdAsString(this.call.teamsCallId),this.transcriptEntryStatisticData)}getLastDataType(e){return e.events?r.xp[r.xp.Event]:e.textTracks||e.recognitionResults?r.xp[r.xp.TextTrack]:e.coachResults?r.xp[r.xp.Coach]:null}updateLastDataReceivedTimestamp(){let e=new Date().toISOString();this.telemetryData.lastDataReceivedTimestamp=e,this.telemetryData.totalDataReceivedCount++}incrementParseErrorCount(){this.telemetryData.parserErrorCount++}incrementNullDataRecieveCount(){this.telemetryData.receivedNullDataCount++}updateCaptionTelemetryData(e){let t=new Date().toUTCString();e.id&&(this.transcriptEntryStatisticData.totalCaptionDataCount++,e.isFinal?(this.telemetryData.captions.lastFinalEntryTimestamp=t,this.telemetryData.captions.lastFinalEntryId=e.id,this.telemetryData.captions.totalFinalEntryCount++,this.transcriptEntryStatisticData.totalCaptionFinalDataCount++,this.telemetryData.captions.receivedFinalEntriesSinceLastTick++,e.text&&0!==e.text.length?this.telemetryData.captions.lastFinalTextLength=e.text.length:this.telemetryData.captions.emptyFinalTextCount++):(this.telemetryData.captions.lastPartialEntryTimestamp=t,this.telemetryData.captions.lastPartialEntryId=e.id,this.telemetryData.captions.totalPartialEntryCount++,this.telemetryData.captions.receivedPartialEntriesSinceLastTick++,e.text&&0!==e.text.length?this.telemetryData.captions.lastPartialTextLength=e.text.length:this.telemetryData.captions.emptyPartialTextCount++)),this.telemetryData.captions.botParticipantId=this.call.getTranscriptBotParticipantId()}updateEventTelemetryData(e){this.telemetryData.events.lastTimestamp=e.timestamp,this.telemetryData.events.lastEventType=e.type,this.telemetryData.events.lastId=e.id,this.telemetryData.events.lastEditId=this.call.getTranscriptEditId()||"",this.telemetryData.events.totalEventCount++,this.telemetryData.events.receivedEventsSinceLastTick++,this.telemetryData.events.botParticipantId=this.call.getTranscriptBotParticipantId()}updateTextTrackCaptionData(e){let t=new Date().toUTCString();e.id&&e.source&&(this.transcriptEntryStatisticData.totalTextTracks[e.source]=(this.transcriptEntryStatisticData.totalTextTracks[e.source]||0)+1,e.isFinal?(this.telemetryData.textTracks.lastFinalEntryTimestamp=t,this.telemetryData.textTracks.lastFinalEntryId=e.id,this.telemetryData.textTracks.totalFinalEntryCount++,this.transcriptEntryStatisticData.totalFinalTextTracks++,this.telemetryData.textTracks.receivedFinalEntriesSinceLastTick++,e.text&&0!==e.text.length?this.telemetryData.textTracks.lastFinalTextLength=e.text.length:this.telemetryData.textTracks.emptyFinalTextCount++):(this.telemetryData.textTracks.lastPartialEntryTimestamp=t,this.telemetryData.textTracks.lastPartialEntryId=e.id,this.telemetryData.textTracks.totalPartialEntryCount++,this.telemetryData.textTracks.receivedPartialEntriesSinceLastTick++,e.text&&0!==e.text.length?this.telemetryData.textTracks.lastPartialTextLength=e.text.length:this.telemetryData.textTracks.emptyPartialTextCount++)),this.telemetryData.textTracks.botParticipantId=this.call.getTranscriptBotParticipantId()}updateTrackTelemetryData(e){this.updateTextTrackCaptionData(e),this.telemetryData.textTracks.totalTextTrackCount++,this.telemetryData.textTracks.receivedTextTracksSinceLastTick++}updateCoachTelemetryData(e){let t=new Date().toUTCString();this.telemetryData.coachResults.lastTimestamp=t,this.telemetryData.coachResults.lastType=e.type,this.telemetryData.coachResults.lastId=e.id,this.telemetryData.coachResults.totalCoachResultCount++,this.telemetryData.coachResults.receivedCoachResultsSinceLastTick++}updateGeneralTelemetryData(e){e&&(e.events||e.recognitionResults||e.textTracks||e.coachResults||this.telemetryData.receivedUnknownDataCount++,this.telemetryData.callId=this.call.callId,this.telemetryData.lastDataType=this.getLastDataType(e))}updateCurrentActiveDataChannelRegistrations(e){this.telemetryData.currentActiveDataChannelRegistrations=e}getTelemetryData(){return this.telemetryData}resetTelemetryDataCounters(){this.telemetryData.events.receivedEventsSinceLastTick=0,this.telemetryData.textTracks.receivedTextTracksSinceLastTick=0,this.telemetryData.captions.receivedFinalEntriesSinceLastTick=0,this.telemetryData.captions.receivedPartialEntriesSinceLastTick=0,this.telemetryData.coachResults.receivedCoachResultsSinceLastTick=0}}var c=i(634504);class d{constructor(){this.enrichUtteranceData=e=>{let t;if(void 0!==e.isFinal&&e.source&&this.utteranceIdMap){let i=e.source,n=e.roomId??e.userId??"emptyUserId";this.utteranceIdMap.get(i)||this.utteranceIdMap.set(i,new Map);let a=this.utteranceIdMap.get(i);a&&(a.get(n)?(t=a.get(n),e.isFinal&&a.delete(n)):(t=(0,c.Z)(),!1===e.isFinal&&a.set(n,t)))}return t=t??(0,c.Z)(),{...e,utteranceId:t,timestampAudioSent:e.timestampAudioSent||0,duration:e.duration||0}},this.utteranceIdMap=new Map}dispose(){this.utteranceIdMap=null}}let g=new Date(Date.UTC(1970,1,1)).getTime()-new Date(Date.UTC(1900,1,1)).getTime(),h=e=>e/1e4-g;class p{constructor(e,t,i,n,a){this.call=e,this.channelId=t,this.logger=i,this.meetingIntelligenceLogService=n,this.dataChannelLogger=new l(this.call,this.meetingIntelligenceLogService,this.logger),this.callingBotDataChannelRegistrations=[],e.dataChannelAdapter.addHandler(t,this,void 0,void 0,a).catch(i=>this.dataChannelLogger.error(`[${e.callId}] data channel addHandler is failed for channel ${t} with error ${i}`)),this.utteranceAdapter=new d}addHandler(e,t){-1===this.callingBotDataChannelRegistrations.findIndex(t=>t.ownerId===e)&&this.callingBotDataChannelRegistrations.push({ownerId:e,handler:t}),this.dataChannelLogger.updateCurrentActiveDataChannelRegistrations(this.getCurrentActiveDataChannelRegistrations())}removeHandler(e){return this.callingBotDataChannelRegistrations=this.callingBotDataChannelRegistrations.filter(t=>t.ownerId!==e),this.dataChannelLogger.updateCurrentActiveDataChannelRegistrations(this.getCurrentActiveDataChannelRegistrations()),this.callingBotDataChannelRegistrations.length}dispose(){this.dataChannelLogger.info(`[${this.call.callId}][${this.channelId}] cleaning up data channel handler`),this.call.dataChannelAdapter&&this.call.dataChannelAdapter.removeHandler(this.channelId).catch(e=>this.dataChannelLogger.error(`[${this.call.callId}][${this.channelId}] data channel removeHandler is failed with error ${e}`)),this.callingBotDataChannelRegistrations=null,this.dataChannelLogger.dispose(),this.utteranceAdapter.dispose()}onStarted(e,t){return Promise.resolve()}onStopped(e){return Promise.resolve()}onDataReceived(e,t,i){let n;this.dataChannelLogger.updateLastDataReceivedTimestamp();try{n=JSON.parse(t.toString())}catch(e){try{let e=new TextDecoder().decode(t);n=JSON.parse(e)}catch(e){return this.logger.error(`[${this.call.callId}][${this.channelId}] failed to parse data channel response, error ${e}`),this.dataChannelLogger.incrementParseErrorCount(),n||this.dataChannelLogger.incrementNullDataRecieveCount(),Promise.reject(e)}}if(this.dataChannelLogger.updateGeneralTelemetryData(n),n.aiInterpretation){let e=n.aiInterpretation;this.sendData(r.xp.AiInterpretation,{...e})}if(n.events)for(let e of n.events)this.sendData(r.xp.Event,e),this.dataChannelLogger.updateEventTelemetryData(e);if(n.recognitionResults)for(let e of n.recognitionResults){let t=this.utteranceAdapter.enrichUtteranceData(e);this.sendData(r.xp.TextTrack,{...t,source:a.f6.Ai,trackLanguage:r.fS,timestampAudioSent:t.timestampAudioSent?h(t.timestampAudioSent):Date.now(),timestampAudioSentLatencyMetric:Math.floor(h(t.timestampAudioSent+t.duration)),timestampDataReceived:Date.now(),duration:t.duration}),this.dataChannelLogger.updateCaptionTelemetryData(t)}if(n.textTracks)for(let e of n.textTracks){let t=this.utteranceAdapter.enrichUtteranceData(e);this.sendData(r.xp.TextTrack,{...t,source:"Rtt"===t.source?a.cl.Rtt:t.source,timestampAudioSent:t.timestampAudioSent?h(t.timestampAudioSent):Date.now(),timestampAudioSentLatencyMetric:Math.floor(h(t.timestampAudioSent+t.duration)),timestampDataReceived:Date.now(),duration:t.duration}),this.dataChannelLogger.updateTrackTelemetryData(t)}if(n.coachResults)for(let e of n.coachResults)this.sendData(r.xp.Coach,e),this.dataChannelLogger.updateCoachTelemetryData(e);return n.copilot&&(this.logger.log("CopilotBot: received notification from copilot bot service"),this.sendData(r.xp.CopilotBot,n.copilot)),n.SkySafeData&&(this.logger.log("SkySafeBot: received notification from SkySafe bot service"),this.sendData(r.xp.SkySafe,n.SkySafeData)),Promise.resolve()}sendData(e,t){for(let i of this.callingBotDataChannelRegistrations)this.logger.debug(`[${this.call.callId}][${this.channelId}] data channel callback for ${r.a_[i.ownerId]}`),i.handler(e,t)}getCurrentActiveDataChannelRegistrations(){return this.callingBotDataChannelRegistrations?this.callingBotDataChannelRegistrations.map(e=>e.ownerId).toString():""}}var u=i(892891),m=i(395250);class _{constructor(e,t,i,n,a,r,o=!0){this.loggingService=e,this.config=t,this.chatServiceUtils=i,this.channelService=n,this.callTitleService=a,this.meetingIntelligenceLogService=r,this.logger=e.newLogger("CallingBotService"),o&&this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.logger.info("initializing calling bot service"),this.botInstances=new Map,this.callInitializedPromises=new Map}mtmaTelemetryIdentifier(){return"CallingBotService"}cleanupOnAppTeardown(e){this.botInstances=void 0,this.callInitializedPromises=void 0}async getCachedBotInstance(e,t,i){this.logger.info(`get cached bot instance for call ${e.callId}, teamsCallId ${e.teamsCallId}, ownerId ${t}, botMri ${i}`),await this.waitForCallRegion(e,"getCachedBotInstance");let n=this.getCachedBotData(e,t,i);if(n)return n.callingBot;throw Error(`No cached bot found for ownerId ${t}, botMri ${i}`)}async getBotInstance(e,t,i,n,o){return this.logger.info(`get bot instance for call ${e.callId}, teamsCallId ${e.teamsCallId}, mode ${t}, owner ${r.a_[i]}`),(n?Promise.resolve(n):this.getCurrentRegionBotMri(e,i)).then(r=>{let s=this.getCachedBotData(e,i,n);return s||(this.logger.info(`initializing new bot for call ${e.callId}, teamsCallId ${e.teamsCallId}, botMri ${n}`),s={callingBot:new a.Qk(e,this.config,t,r,this.chatServiceUtils,this.callTitleService,this.channelService,this.loggingService,o),ownerId:i},this.botInstances.get(e.teamsCallId).bots.push(s)),s.callingBot})}async registerDataCallback(e,t,i,a,o=n.DataChannelAdapterDirection.Sink){let s=`call ${e.callId}, teamsCallId ${e.teamsCallId}, channel ${t}, owner ${r.a_[i]}`;this.logger.info(`register data channel callback for ${s}`);let l=this.botInstances.get(e.teamsCallId);if(!l){let e=`bot instance does not exist for ${s}`;throw this.logger.error(e),Error(e)}return l.dataChannelHandlers.get(t)||(this.logger.info(`creating new data channel handler for ${s}`),l.dataChannelHandlers.set(t,new p(e,t,this.logger,this.meetingIntelligenceLogService,o))),l.dataChannelHandlers.get(t).addHandler(i,a),Promise.resolve(!0)}unregisterDataCallback(e,t,i){this.logger.info(`unregister data channel callback for call ${e}, teamsCallId ${t}, owner ${r.a_[i]}`);let n=this.botInstances.get(t);if(!n)return void this.logger.warn(`bot instance does not exist for call ${e}, teamsCallId ${t}`);n.dataChannelHandlers.forEach((a,r)=>{0===a.removeHandler(i)&&(this.logger.info(`no more data channel registrations, call ${e}, teamsCallId ${t}`),a.dispose(),n.dataChannelHandlers.delete(r))})}getTranscriptBotDiagnosticResult(e,t){return this.meetingIntelligenceLogService.getTranscriptBotDiagnosticResult(e,t)}clearTranscriptDiagnosticDataMap(e){this.meetingIntelligenceLogService.clearTranscriptDiagnosticDataMap(e)}initTranscriptBotDiagnosticData(e){this.meetingIntelligenceLogService.initTranscriptBotDiagnosticData(e)}updateParticipantsVoiceLevels(e,t){this.meetingIntelligenceLogService.updateParticipantsVoiceLevels(e,t)}getCachedBotData(e,t,i){let n=this.botInstances.get(e.teamsCallId);return(n||(this.logger.info(`creating new bot instance for call ${e.callId}, teamsCallId ${e.teamsCallId}`),n={bots:[],callStateSubscription:e.on("callStateChanged",()=>this.onCallStateChanged(e)),dataChannelHandlers:new Map},this.botInstances.set(e.teamsCallId,n)),i)?(0,u.find)(n.bots,e=>e.callingBot.getMri()===i):(0,u.find)(n.bots,e=>e.ownerId===t)}async waitForCallRegion(e,t){if(this.logger.info(`awaiting call init for call ${e.callId}, teamsCallId ${e.teamsCallId}, call region: ${e.region}`),this.callHasRegion(e)){this.callInitializedPromises?.get(e.teamsCallId)&&this.callInitializedPromises.delete(e.teamsCallId),this.logger.info("call already has region, no need to wait");return}if(!this.callInitializedPromises?.get(e.teamsCallId)){this.logger.info("creating promise to wait for call region");let i=this.loggingService.newScenario(m.RG.WaitForCallRegionPromise);i.appendEventData({context:t,teamsCallId:e.teamsCallId,call:e.callId}),this.callInitializedPromises.set(e.teamsCallId,new Promise((t,a)=>{if(this.callHasRegion(e)){this.callInitializedPromises.delete(e.teamsCallId),i.stop(),t();return}i.mark(m.ck.CreateCallChangedSubscription);let r=e.changed(()=>{if(this.logger.info("call changed, checking for region"),this.callHasRegion(e)){r.dispose(),this.callInitializedPromises.delete(e.teamsCallId),i.stop(),t();return}if(e.state===n.CallState.Disconnected||e.state===n.CallState.Disconnecting){r.dispose(),this.callInitializedPromises.delete(e.teamsCallId);let t="Call disconnected";i.cancel({reason:t}),a(t);return}if(e.state===n.CallState.Connected){r.dispose(),this.callInitializedPromises.delete(e.teamsCallId);let t="Call is connected but missing region information.";i.fail({reason:t}),a(t)}})}))}return this.callInitializedPromises.get(e.teamsCallId)}callHasRegion(e){return this.config.isTflUser()||e.region}onCallStateChanged(e){if(e.state===n.CallState.Disconnected){this.logger.info(`call ${e.callId}, teamsCallId ${e.teamsCallId} is disconnected, cleaning up bot instances and data channel registrations`);let t=this.botInstances.get(e.teamsCallId);t&&(t.dataChannelHandlers.forEach((e,t)=>{e.dispose()}),t.dataChannelHandlers.clear(),t.bots.forEach((e,t)=>{e.callingBot.dispose()}),t.bots=[],t.callStateSubscription.dispose(),t.callStateSubscription=void 0,t.callIdSubscription?.dispose(),t.callIdSubscription=void 0,this.botInstances.delete(e.teamsCallId))}}async getCurrentRegionBotMri(e,t){this.logger.info(`get current region botMri for call ${e.callId}, teamsCallId ${e.teamsCallId}, owner ${r.a_[t]}`);let i=this.getBotRegionMapping(t),n=this.getBotMriForClientRegion(t);if(!i||i.length<1)return n;try{await this.waitForCallRegion(e,r.a_[t])}catch(e){this.logger.error(`waitForCallRegion failed with error: ${e}`)}return i.find(t=>t.regions.includes(e.region))?.mri||n}getBotRegionMapping(e){switch(e){case r.a_.ClosedCaptions:case r.a_.ClosedCaptionsMW:case r.a_.Transcript:case r.a_.TranscriptMW:case r.a_.CopilotMW:case r.a_.Coach:case r.a_.CoachMW:case r.a_.Facestream:case r.a_.LanguageMismatch:return this.config.getClosedCaptionsBotMrisForCallRegions?.()??[];case r.a_.CloudPeopleFeed:return[];case r.a_.CombinedRecordingAndTranscription:return this.config.getRecordingBotMrisForCallRegions()??[];case r.a_.AiInterpretationUI:case r.a_.AiInterpretationService:case r.a_.SkySafe:return[];default:throw Error(`OwnerId must be registered in getBotRegionMapping. OwnerId: ${e}`)}}getBotMriForClientRegion(e){switch(e){case r.a_.ClosedCaptions:case r.a_.ClosedCaptionsMW:case r.a_.Transcript:case r.a_.TranscriptMW:case r.a_.CopilotMW:case r.a_.Coach:case r.a_.CoachMW:case r.a_.Facestream:case r.a_.LanguageMismatch:return this.config.getClosedCaptionsBotMriForClientRegion?.()??"";case r.a_.CloudPeopleFeed:return"";case r.a_.CombinedRecordingAndTranscription:return this.config.getRecordingBotMriForClientRegion()??"";case r.a_.AiInterpretationUI:case r.a_.AiInterpretationService:return"";case r.a_.SkySafe:return this.config.getSkySafeBotMri?.()??"";default:throw Error(`OwnerId must be registered in getBotMriForClientRegion. OwnerId: ${e}`)}}}},291518:function(e,t,i){var n,a,r,o;i.d(t,{T_:()=>a,_n:()=>n,lX:()=>s}),(r=n||(n={}))[r.Unknown=0]="Unknown",r[r.ScheduledMeeting=1]="ScheduledMeeting",r[r.PrivateMeeting=2]="PrivateMeeting",r[r.AdhocMeeting=3]="AdhocMeeting",r[r.Call=4]="Call",(o=a||(a={})).Legacy="legacy",o.MeetingData="meetingData";let s={TypeParamName:"btype",RoleParamName:"role",StreamTypeValue:"s",AMSTypeValue:"a",AttendeeRoleValue:"a",StreamVideoIdParamName:"vid"}},132342:function(e,t,i){i.d(t,{H:()=>m});var n=i(370574),a=i(892891),r=i(352320),o=i(575810),s=i(945761),l=i(826757),c=i(291518),d=i(310735),g=i(206898);function h(e,t=!0){let i=decodeURIComponent(e);return t?null!=i&&(i.indexOf("/meetup-join/")>-1||i.indexOf("/meet/")>-1)&&(i.indexOf("&anon=true")>-1||i.indexOf("?anon=true")>-1):null!=i&&(i.indexOf("/meetup-join/")>-1||i.indexOf("/meet/")>-1)}var p=i(395250);class u{constructor(e){this.deeplinkId=e,this.call=null,this.timeout=null}}class m{constructor(e,t,i,n,a,r,o,l,c,d=!0,g=s.Wq){this.config=e,this.timeout=t,this.location=i,this.callingTelemetryService=n,this.utilityService=a,this.loggingService=r,this.eventingService=o,this.storageService=l,this.chatServiceUtils=c,this.promiseFactory=g,this.logger=r.newLogger("callingDeepLinkService"),d&&this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(){this.eventingService.registerHandlerForExternalEvent(o.gT.events.calling.callDisposed,e=>{this.deeplinkTrace&&this.deeplinkTrace.call===e&&this.stopTracingCurrentDeeplink()}),this.stopTracingCurrentDeeplink()}cleanupOnAppTeardown(e){this.stopTracingCurrentDeeplink(),this.deeplinkTrace=void 0,this.pendingMeetupLink=void 0,this.deepLinkParams=void 0}mtmaTelemetryIdentifier(){return"CallingDeepLinkService"}startOrMarkScenario(e,t,i){let n=this.getDeeplinkContext(e,i);if(!n||![o.gT.deepLinkTypes.meetupJoin,o.gT.deepLinkTypes.meetingWithCode].includes(n.linkType))return;let r=(0,a.isString)(e)?e:void 0,s=this.getMeetingData(n,i,r),l=this.reportTelemetry(n.context,s,i);return l.mark(t),l}getDeeplinkScenario(e,t){return this.callingTelemetryService.getStartCallScenario({type:d.G.Meeting,joinType:g.c.Legacy,conversationId:e,rootMessageId:t,messageId:"",tenantId:"",organizerId:"",meetingCloud:"",isChannel:!1,isAdhoc:!1},"")}getDeeplinkParamsFromUrl(e){try{let t=this.utilityService.parseUrl(e);return this.getDeeplinkContext(t.pathname+t.search)}catch(e){return this.logger.warn(`Failed parsing deeplink params from url: ${r.cf.getErrorMessage(e)}`),null}}getDeepLinkHash(){if(this.deepLinkParams)return this.buildEUIIfreeLinkFromParams(this.deepLinkParams)}getSavedDeeplinkParams(){return this.deepLinkParams}cleanSavedDeeplinkParams(){this.deepLinkParams=void 0}decodeString(e){this.logger.info(`Starting to decode input: ${e}`);let t=e;try{if(t=decodeURIComponent(e),this.config.enableDecodingDeepLinkMultipleTimes())for(;t!==decodeURIComponent(t);)t=decodeURIComponent(t)}catch(t){this.logger.error(`Got error: ${t} when decoding input: ${e}`)}return this.logger.info(`Decoding finished. Result: ${t}`),t}getDeeplinkContext(e,t,i=!0){let n,r,o;if(!(0,a.isString)(e))return n=this.buildDeeplinkParamsFromContextObject(e,t),this.deepLinkParams=n,n;try{let t=this.decodeString(e);o=t.match(/\/(.*)\?/)[1],r=e.indexOf("meetup-join")>=0?t.match(/{(.*)}/)[0]:""}catch(t){e&&e.indexOf("meet")>=0?this.logger.error(`failed to decode URI component: ${t}`):this.logger.warn(`failed to decode URI component: ${t}`);return}if(!o)return;let s=e.match(/[&?]deeplinkId=(.*?)($|&)/i),l=s?s[1]:"",d=e.match(/[&?]homeCloud=(.*?)($|&)/i),g=d?d[1]:"",h=o.split("/"),u=4===h.length,m=2===h.length;if(!u&&!m){let t="Deeplink URL has wrong type or format";i&&this.reportIncompleteDeeplinkScenario({DeeplinkId:l,correlationId:l,deeplinkURL:e},t),this.logger.error(t);return}if(u){let e=h[3].split("?")[0];n={context:{...this.parseDeepLinkContext(r),DeeplinkId:l,correlationId:l||this.utilityService.generateUUID(),homeCloud:g},linkType:h[1],conversationId:h[2],messageId:e,type:c.T_.Legacy},i&&!this.isConversationIdValid(n.conversationId)&&(this.getAndMarkScenario(n.conversationId,n.messageId,p.ck.MalformedConversationId),this.logger.warn(`Got malformed conversationId in getDeeplinkContext, conversationId: ${n.conversationId}`))}else{let t=e.match(/[&?]p=(.*?)($|&)/i),i=t?t[1]:"";n={context:{...r&&this.parseDeepLinkContext(r),DeeplinkId:l,correlationId:l||this.utilityService.generateUUID(),homeCloud:g},linkType:h[0],code:h[1],passcode:i,url:e,type:c.T_.MeetingData}}return this.deepLinkParams=n,n}buildDeeplinkParamsFromContextObject(e,t){this.updateContextForBroadcast(e),e.isUniquePresenterLink=!!t.participantPin;let i={context:e,linkType:t.type===c.T_.MeetingData?o.gT.deepLinkTypes.meetingWithCode:o.gT.deepLinkTypes.meetupJoin,...t};return i.context.correlationId||(i.context.correlationId=e.DeeplinkId||this.utilityService.generateUUID()),i}getAndMarkScenario(e,t,i){let n=this.getDeeplinkScenario(e,t);n&&n.mark(i)}getOrCreateDeeplinkScenario(e,t,i){let n=this.getDeeplinkScenario(t,i);if(!n){let a={[o.gT.categories.deepLinkSource]:e.Origin||"unknown",[o.gT.categories.meetingType]:"Unknown",[o.gT.categories.deeplinkId]:e.DeeplinkId||"unknown",[o.gT.counters.eventNames.correlationId]:e.correlationId};n=this.reportTelemetry(e,a,{conversationId:t,messageId:i,type:c.T_.Legacy})}return n}reportIncompleteDeeplinkScenario(e,t){let i=this.utilityService.scrubEuii(t),n=this.getOrCreateDeeplinkScenario(e,"",""),a={errorMessage:i,terminatedReason:i};this.config.logUrlOnParseFailure()&&(a.deeplinkURL=this.utilityService.scrubEuii(e.deeplinkURL)),this.logger.error(t),n.incomplete(a)}parseDeepLinkContext(e){let t;try{t=JSON.parse(this.decodeString(e))}catch(i){try{this.logger.error(`Error while parsing the url: ${i}`);let n=e.replace(/(?:['"])?([\w-]+)(?:['"])?\s*:\s*(?:['"])?([\w-]+)(?:['"])?/g,(e,t,i)=>`"${t}":"${i}"`);t=JSON.parse(n)}catch(i){this.logger.error(`Couldn't get context for calling deep link: ${i}`),t=this.tryParseAsBroadcastDeepLink(e)}}return this.updateContextForBroadcast(t),t}updateContextForBroadcast(e){e&&1===e.b&&(e.IsBroadcastMeeting=!0)}shouldTraceDeeplink(e){return!!e&&this.config.enableDeeplinkTracing()}stopTracingCurrentDeeplink(){this.deeplinkTrace&&this.stopTracingDeeplink(this.deeplinkTrace.deeplinkId)}traceDeeplink(e){if(!this.shouldTraceDeeplink(e))return;this.deeplinkTrace?this.deeplinkTrace.deeplinkId!==e?(this.stopTracingCurrentDeeplink(),this.deeplinkTrace=new u(e)):this.timeout.cancel(this.deeplinkTrace.timeout):this.deeplinkTrace=new u(e);let t=this.deeplinkTrace;t.timeout=this.timeout.set(()=>{t.call||(this.logger.error(`Deeplink tracing timed out: ${e}`),this.stopTracingDeeplink(e))},this.config.deeplinkTracingTimeout(),!1),this.loggingService.setContext(o.gT.categories.deeplinkId,e)}traceDeeplinkPromise(e,t){this.shouldTraceDeeplink(e)&&(this.traceDeeplink(e),t.catch(()=>this.stopTracingDeeplink(e)))}traceDeeplinkCall(e,t){if(!this.shouldTraceDeeplink(e))return;this.traceDeeplink(e);let i=this.deeplinkTrace;if(i.call){i.call!==t&&this.logger.error(`Unexpected tracing of same deeplink with different calls: ${e}`);return}i.call=t,l.eU.waitForCallConnection(t,this.promiseFactory).then(()=>{this.stopTracingDeeplink(e)})}stopTracingDeeplink(e){if(!this.shouldTraceDeeplink(e))return;let t=this.deeplinkTrace;this.deeplinkTrace=null,t&&t.deeplinkId===e&&(t.timeout&&this.timeout.cancel(t.timeout),this.loggingService.setContext(o.gT.categories.deeplinkId,""))}stopTracingIfNoCall(e){this.deeplinkTrace&&!this.deeplinkTrace.call&&this.stopTracingDeeplink(e)}processPendingLinkIfAvailable(){if(this.enablePendingDeeplinkReload){let e=this.storageService.get(o.gT.storageNames.pendingMeetupDeeplink),t=this.storageService.get(o.gT.storageNames.pendingMeetupDeeplinkUsed),i=e&&h(e,!1);if(t||!i)this.cleanupPendingMeetupLink();else if(i){let t=this.loggingService.newScenario(p.RG.PendingMeetupDeeplinkUsed);this.storageService.set(o.gT.storageNames.pendingMeetupDeeplinkUsed,"true"),this.location.hash.set(e),t.stop()}}}setPendingMeetupLink(e){this.enablePendingDeeplinkReload&&(this.pendingMeetupLink=e)}storePendingMeetupLink(){this.enablePendingDeeplinkReload&&this.pendingMeetupLink&&h(this.pendingMeetupLink,!1)&&this.storageService.set(o.gT.storageNames.pendingMeetupDeeplink,this.pendingMeetupLink)}cleanupPendingMeetupLink(){this.enablePendingDeeplinkReload&&(this.pendingMeetupLink=void 0,this.storageService.remove(o.gT.storageNames.pendingMeetupDeeplink),this.storageService.remove(o.gT.storageNames.pendingMeetupDeeplinkUsed))}get enablePendingDeeplinkReload(){return!this.config.disablePendingDeeplinkReload()}tryParseAsBroadcastDeepLink(e){let t=e.match(/\{\"Tid\":\"([\w\-]{36})\",\"Oid\":\"([\w\-]{36})\",\"IsBr/);if(!t||3!=t.length)return null;let i={};return i.Tid=t[1],i.Oid=t[2],i.IsBroadcastMeeting=!0,this.config.forceAttendeeJoinBroadcastTruncatedUrl()&&(i[c.lX.RoleParamName]=c.lX.AttendeeRoleValue),i}static isSpecialCallMessageId(e){return!e||"0"===e}isConversationIdValid(e){return!this.config.enableConversationIdValidationWhenJoiningFromDeepLink()||/^[0-9]+\:[a-z]*[\_,\-\:]{0,1}[A-Za-z0-9\-\_]+\@{0,1}[\w\.]*$/g.test(e)}static getMeetingInfo(e,t,i){if(!e.Oid)return null;let a=m.getDeepLinkType(e,t,i)===c._n.PrivateMeeting?n.CallMeetingType.Private:n.CallMeetingType.Channel,r={tenantId:e.Tid,organizerId:e.Oid,meetingType:a,replyChainMessageId:e.MessageId?e.MessageId:t,isBroadcast:e.IsBroadcastMeeting};return r.isBroadcast&&e.BroadcastRole&&(r.broadcastRole=e.BroadcastRole),r}static hasMeetingContext(e){return!!(e&&e.Tid&&e.Oid)&&!e.IsCall}static getDeepLinkType(e,t,i){let n=m.hasMeetingContext(e);return m.isSpecialCallMessageId(t)?n?c._n.PrivateMeeting:c._n.Call:i(t)?n?c._n.ScheduledMeeting:c._n.AdhocMeeting:c._n.Unknown}getScenarioName(e){return e?e.prid?p.RG.JoinScheduledWebinarFromLink:"true"===e.IsCall?p.RG.JoinOrCreateCallFromLink:e.isUniquePresenterLink?p.RG.JoinScheduledMeetupFromUniqueLink:!0===e.IsBroadcastMeeting?p.RG.JoinOrCreateMeetupFromLinkBroadcast:p.RG.JoinOrCreateMeetupFromLink:p.RG.JoinOrCreateMeetupFromLink}deeplinkCoordinatesToMeetingCoordinates(e,t){return e.type===c.T_.MeetingData?{type:d.G.Meeting,joinType:g.c.MeetingData,isAdhoc:!1,meetingData:{meetingCode:e.code,passcode:e.passcode,url:e.url}}:{type:d.G.Meeting,joinType:g.c.Legacy,conversationId:e.conversationId,rootMessageId:e.messageId,isChannel:!1,isAdhoc:!1,messageId:"",tenantId:t.Tid,organizerId:t.Oid,meetingCloud:t.homeCloud}}reportTelemetry(e,t,i){let n={...this.stopCallingIntentScenario(t),...t},a=this.deeplinkCoordinatesToMeetingCoordinates(i,e);return this.callingTelemetryService.createStartCallScenario(a,{scenarioName:this.getScenarioName(e),teamsCall:null,eventData:n,correlationId:e.correlationId,joinAttemptId:this.utilityService.generateUUID()})}getMeetingData(e,t,i){let n=e.context,a=t.type===c.T_.MeetingData?c._n.ScheduledMeeting:m.getDeepLinkType(n,t.messageId,this.chatServiceUtils.isValidId),r={joinOrCreate:n.isMeetingCreation?"create":"join",meetingType:a,[o.gT.categories.deepLinkSource]:n.Origin||"unknown",[o.gT.categories.deeplinkId]:n.DeeplinkId||"unknown",correlationId:n.correlationId,isBroadcast:n.IsBroadcastMeeting,[o.gT.counters.eventNames.broadcastRole]:n.BroadcastRole,[o.gT.categories.broadcastRole]:n.BroadcastRole,[o.gT.counters.eventNames.meetingTenantId]:n.Tid,launchAgent:n.launchAgent,[o.gT.counters.eventNames.webinar.participantRegistrationId]:n.prid,[o.gT.counters.eventNames.webinar.isPublicEvent]:n.isPublic,laEntry:n.laEntry,laExpId:n.laExpId,meetupJoinAfterTenantSwitch:n.meetupJoinAfterTenantSwitch,isUsingAttendeeLink:n.isUsingAttendeeLink,isUsingContextRoleLink:"a"===n.role,participantPin:encodeURIComponent(t.participantPin),broadcastData:JSON.stringify({isUsingAttendeeLink:n.isUsingAttendeeLink,isUsingContextRoleLink:"a"===n.role})};return t.type===c.T_.MeetingData?(r.meetingCode=t.code,r.deeplinkUrl=this.buildEUIIfreeLinkFromParams(e)):(r.threadId=t.conversationId,r.messageId=t.messageId),"true"===n.FromAnonymous&&(r[o.gT.scenarios.calling.context.isRejoin]="true"===n.Rejoin),i&&(r.launchAgent=r.launchAgent||this.utilityService.getLaunchAgent(i),r.missingDeeplinkIdReceived=this.utilityService.getMissingDeeplinkId(i),!0===n.IsBroadcastMeeting&&(r.deeplinkUrl=this.buildEUIIfreeLinkFromParams(e)),r.homeCloud=n.homeCloud),r}stopCallingIntentScenario(e){let t=this.callingTelemetryService.getCallingIntentScenario();return this.callingTelemetryService.completeCallingIntentScenario(t,e)}buildEUIIfreeLinkFromParams(e){let t=e.type===c.T_.Legacy?`l/${e.linkType}`:e.linkType,i=e.type===c.T_.Legacy?e.conversationId:e.code,n=e.type===c.T_.MeetingData?`p=${e.passcode}`:"",a=e.context.laExpId?`laExpId=${encodeURIComponent(e.context.laExpId)}`:"",r=e.context.laEntry?`laEntry=${encodeURIComponent(e.context.laEntry)}`:"",o=e.context.DeeplinkId?`deeplinkId=${encodeURIComponent(e.context.DeeplinkId)}`:"",s=e.context.launchAgent?`launchAgent=${encodeURIComponent(e.context.launchAgent)}`:"",l=[e.context.Tid?`"Tid": ${e.context.Tid}`:"",e.context.Oid?`"Oid": ${e.context.Oid}`:""].filter(e=>""!==e).join(","),d=l?`context=%7B${encodeURIComponent(l)}%7D`:"",g=e.type===c.T_.Legacy?`/${e.messageId}`:"",h=[d,o,s,n,a,r].filter(e=>""!==e).join("&");return`${t}/${i}${g}?${h}`}}},692120:function(e,t,i){i.d(t,{z:()=>n});let n="cmd_calling_call_disconnected_scenario"},881005:function(e,t,i){i.d(t,{f:()=>a,t:()=>n});class n{constructor(e){this.quota=e}isEventAllowed(e,t){let i=this.getQuotaForEvent(t);e[t]??(e[t]={totalCount:0,truncatedCount:0});let n=e[t],a=!1;return i<0?a=!0:n.totalCount<i&&(a=!0),n.totalCount++,!a&&n.truncatedCount++,a}getQuotaForEvent(e){return this.quota[e]??-1}}let a=e=>{let t=[];return Object.keys(e).forEach(i=>{let n=e[i];n.truncatedCount>0&&t.push(`${i}:${n.truncatedCount}`)}),0===t.length?void 0:t.join(";")}},160946:function(e,t,i){var n,a,r,o,s,l;i.d(t,{C8:()=>r,bW:()=>a,ie:()=>n}),(o=n||(n={})).AnonJoinDisabledPrejoin="AnonJoinDisabledPrejoin",o.EndCallingIntent="end-calling-intent",o.CleanupApp="cleanup-app",o.ChildWindowClosed="child-window-closed",o.ChildWindowCrashed="child-window-crashed",o.RejoinCall="rejoin-call",o.ExperienceRendererCrashed="experience-renderer-crashed",o.PluginHostCrashed="plugin-host-crash",o.WindowCloseRunningApp="WindowCloseRunningApp",o.WindowCloseRunningCore="WindowCloseRunningCore",o.Abandoned="Abandoned",o.PluginHostCrashVdiDisconnectedGeneric="plugin-host-crash-vdiDisconnected-generic",o.PluginHostCrashVdiDisconnectedClientWatchdog="plugin-host-crash-vdiDisconnected-clientWatchdog",o.PluginHostCrashVdiDisconnectedBrokenSlimCore="plugin-host-crash-vdiDisconnected-brokenSlimcore",o.PluginHostCrashVdiDisconnectedVmWatchdog="plugin-host-crash-vdiDisconnected-vmWatchdog",o.PluginHostCrashVdiDisconnectedUnknown="plugin-host-crash-vdiDisconnected-unknown",o.PluginHostCrashVdiBridgeOnConnected="plugin-host-crash-vdiBridge-onConnected",o.PluginHostCrashVdiBridgeOnDisconnected="plugin-host-crash-vdiBridge-onDisconnected",o.PluginHostCrashVdiConsoleSession="plugin-host-crash-vdiConsoleSession",o.PluginHostCrashFallbackToLocalOnRemoteFailure="plugin-host-crash-fallbackToLocalOnRemoteFailure",o.PluginHostCrashEndpointShutdown="plugin-host-crash-endpointShutdown",(s=a||(a={})).ExperienceContainer="Experience container",s.PluginHost="PluginHost",(l=r||(r={})).ContentAlreadyVisible="content-already-visible",l.IntentIdAlreadyAssociatedToCall="intent-id-already-associated-to-call",l.IntentIdDoesNotExist="intent-id-does-not-exist",l.IntentIdExistsForCall="intent-id-exists-for-call",l.InvalidCall="invalid-call",l.InvalidIntentId="invalid-intent-id"},310735:function(e,t,i){i.d(t,{G:()=>n});let n={0:"OngoingCall",OngoingCall:0,1:"Meeting",Meeting:1,2:"OneToOneCall",OneToOneCall:2,3:"GroupCall",GroupCall:3,4:"AgentMonitorSession",AgentMonitorSession:4}},816435:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u,m,_;i.d(t,{Hn:()=>o,MP:()=>a,ZL:()=>s,bU:()=>c,q_:()=>r,w9:()=>l,wm:()=>n}),(d=n||(n={})).SingleWindowExperience="single-window-experience",d.MultiWindowExperience="multi-window-experience",(g=a||(a={})).NavigatePromiseBiMError="navigate-promise-bim-error",g.DuplicateScenarioCreation="duplicate-scenario-creation",g.IntentIdUndefined="intent-id-undefined",(h=r||(r={})).ScenarioNotFound="scenario-not-found",h.IntentNotFoundForCallingWindowingIntentId="intent-not-found-for-calling-windowing-intent-id",h.ContainerNotFoundForCallingWindowingIntentId="container-not-found-for-calling-windowing-intent-id",h.InvalidUpdateType="invalid-update-type",h.ContainerRenderFailed="container-render-failed",(p=o||(o={})).CloseContainerFailed="close-container-failed",p.CloseContainerTimeout="close-container-timeout",p.CallingStageNotFoundOnSingleWindowExperience="calling-stage-not-found-on-single-window-experience",p.IntentMapFailedToBeUpdated="intent-map-failed-to-be-updated",p.TargetContentFetchFailure="target-content-fetch-error",p.TargetIntentNotFound="target-intent-not-found",p.TargetContentNotFound="target-content-not-found",p.TargetWindowingActionLost="target-windowing-action-lost",p.RerenderActionDuplicated="rerender-action-duplicated",p.NewContentAlreadyRendering="new-content-already-rendering",p.NewContentAlreadyRenderingElsewhere="new-content-already-rendering-elsewhere",p.NewContentAlreadyShown="new-content-already-shown",p.NewContentReplaceFailedIntentMismatch="new-content-replace-failed-intent-mismatch",p.NewContentFailedToBeFocused="new-content-failed-to-be-focused",p.NewContentFailedToBeFocusedAndUpdated="new-content-failed-to-be-focused-and-updated",p.NewContentFailedToBeUpdatedUnexpectedError="new-content-failed-to-be-updated-unexpected-error",p.UnexpectedErroForGetExistingIntent="unexpected-error-for-get-existing-intent",p.ContentUpdateTimeout="content-update-timeout",p.CallingIntentEventNotFulfilled="calling-intent-event-not-fulfilled",p.ErrorBoundary="error-boundary",p.ConflictWithOtherWindowingAction="conflict-with-other-windowing-action",p.GetFocusViewTypeFailed="get-focus-view-type-failed",(u=s||(s={})).Fulfilled="fulfilled",u.FailedToSend="failed-to-send",u.NotSentBecauseContainerNotExist="not-sent-because-container-not-exist",u.NotSentBecauseOriginalJoinOptionsNull="not-sent-because-original-join-options-null",u.NotSentBecauseCallStillActive="not-sent-because-call-still-active",u.PendingEventAlreadyExecuting="pending-event-already-executing",u.IntentIdNotFound="intent-id-not-found",(m=l||(l={})).ExperienceContainerNotLoaded="exp-not-loaded",m.ExperienceContainerNotEnabled="exp-not-enabled",m.CommandSentSuccessfully="success",m.TabWindowWithoutCommand="tab-no-cmd",m.ChildWindowWithoutCommand="window-no-cmd",m.ExperienceRendererCrashed="exp-rend-crash",m.PluginHostCrashed="plugin-host-crash",(_=c||(c={})).AgentMonitorSession="AgentMonitorSession",_.BreakoutRooms="BreakoutRooms",_.CallEscalation="CallEscalation",_.CallTransfer="CallTransfer",_.CallTransferIncomingReplaceCall="CallTransferIncomingReplaceCall",_.InstantMeetingDeferredConvID="InstantMeetingDeferredConvID",_.UpdateMeetingTitle="UpdateMeetingTitle"},167135:function(e,t,i){i.d(t,{Eg:()=>f,TY:()=>g,VM:()=>s,_G:()=>_,c1:()=>d,cq:()=>h,eV:()=>b,gv:()=>u,h6:()=>l,hi:()=>o,hy:()=>S,kP:()=>C,kq:()=>m,qG:()=>v,uO:()=>p});var n,a,r,o,s,l,c=i(370574);let d="0",g=[c.TerminatedReason.Success,c.TerminatedReason.Cancelled],h=[c.ParticipantStateReason.NoResponse,c.ParticipantStateReason.Abandoned,c.ParticipantStateReason.Declined,c.ParticipantStateReason.NotReachable,c.ParticipantStateReason.PstnInsufficientFunds,c.ParticipantStateReason.PstnInvalidNumber,c.ParticipantStateReason.PstnCreditExpired,c.ParticipantStateReason.PstnCreditExpiredButEnough,c.ParticipantStateReason.PstnNoSubscriptionCover,c.ParticipantStateReason.PstnBlockedByUs,c.ParticipantStateReason.PstnBlockedRegulatoryIndia,c.ParticipantStateReason.PstnNumberForbidden,c.ParticipantStateReason.Kicked,c.ParticipantStateReason.ParticipantDoesNotExist,c.ParticipantStateReason.DeniedInLobby,c.ParticipantStateReason.TimedOutInLobby,c.ParticipantStateReason.Cancelled,c.ParticipantStateReason.Busy,c.ParticipantStateReason.TemporarilyUnavailable,c.ParticipantStateReason.EnterprisePstnUnavailable,c.ParticipantStateReason.EnterprisePstnInvalidNumber,c.ParticipantStateReason.EnterprisePstnForbidden,c.ParticipantStateReason.ConfParticipantCountLimitReached,c.ParticipantStateReason.ActionNotAllowed,c.ParticipantStateReason.ForbiddenDueToPolicy,c.ParticipantStateReason.InsufficientCapabilitiesForCallee,c.ParticipantStateReason.AccessDenied,c.ParticipantStateReason.NoPermission,c.ParticipantStateReason.ConfLobbyParticipantCountLimitReached,c.ParticipantStateReason.AnonymousJoinDisabledByPolicy,c.ParticipantStateReason.NoLobbyForBroadcastJoin,c.ParticipantStateReason.NotAllowedDueToInformationBarrier,c.ParticipantStateReason.BroadcastLimitReached,c.ParticipantStateReason.B2bJoinDisabledByPolicy,c.ParticipantStateReason.NoSignalingFromPeer],p=[c.TerminatedReason.Declined,c.TerminatedReason.NoNgcEndpoint,c.TerminatedReason.CallAccepted,c.TerminatedReason.CallForwarded,c.TerminatedReason.CallForwardedToVoicemail,c.TerminatedReason.LocalHttpStackError,c.TerminatedReason.Missed,c.TerminatedReason.TemporarilyUnavailable,c.TerminatedReason.NoSignalingFromPeer,c.TerminatedReason.Kicked,c.TerminatedReason.DeniedInLobby,c.TerminatedReason.TimedOutInLobby,c.TerminatedReason.ConfParticipantCountLimitReached,c.TerminatedReason.InsufficientCapabilitiesForCallee,c.TerminatedReason.BroadcastLimitReached,c.TerminatedReason.NoLobbyForBroadcastJoin,c.TerminatedReason.NotAllowedDueToInformationBarrier,c.TerminatedReason.AnonymousJoinDisabledByPolicy,c.TerminatedReason.TeamParkPolicyDisabled,c.TerminatedReason.B2bJoinDisabledByPolicy,c.TerminatedReason.ConfLobbyParticipantCountLimitReached,c.TerminatedReason.ActionNotAllowed,c.TerminatedReason.Abandoned,c.TerminatedReason.DowngradeToStreamingClient],u=[...g,...p],m=[c.CallState.Observing,c.CallState.Preheating,c.CallState.Preheated],_=[c.CallState.Connecting,c.CallState.EarlyMedia,c.CallState.InLobby,c.CallState.Connected,c.CallState.LocalHold,c.CallState.RemoteHold,c.CallState.Staging];(n=o||(o={}))[n.NotSupported=1]="NotSupported",n[n.NotSupportedButDeeplinkedIntoDesktop=2]="NotSupportedButDeeplinkedIntoDesktop",n[n.CallingStackVersionMismatch=3]="CallingStackVersionMismatch",n[n.FailedCallingServiceInit=4]="FailedCallingServiceInit",n[n.FailedHandlingOngoingCalls=5]="FailedHandlingOngoingCalls",n[n.FailedCallingServiceNotInitialized=6]="FailedCallingServiceNotInitialized",n[n.UserCancelledAttemptDueToOngoingCall=7]="UserCancelledAttemptDueToOngoingCall",n[n.B2bCallJoinDisabled=8]="B2bCallJoinDisabled",n[n.MultiCallLimitReached=9]="MultiCallLimitReached",n[n.ReceivedEmptyCallObject=10]="ReceivedEmptyCallObject",n[n.PstnCallingNotAllowed=11]="PstnCallingNotAllowed",n[n.CrossCloudMultiCallHandlingAlreadyInProgress=12]="CrossCloudMultiCallHandlingAlreadyInProgress",n[n.FailedHandlingOngoingCallsDisconnectingCall=13]="FailedHandlingOngoingCallsDisconnectingCall",n[n.FailedHandlingOngoingCallsHoldingCall=14]="FailedHandlingOngoingCallsHoldingCall",(a=s||(s={}))[a.MultiWindowCrashed=100]="MultiWindowCrashed",a[a.ImmersiveEventOnHold=101]="ImmersiveEventOnHold",(r=l||(l={}))[r.Failed=0]="Failed",r[r.Uninitialized=1]="Uninitialized",r[r.Initializing=2]="Initializing",r[r.Initialized=3]="Initialized",r[r.NotSupported=4]="NotSupported",r[r.IncompatibleVersions=5]="IncompatibleVersions",r[r.Disabled=6]="Disabled";let S=[l.Failed,l.IncompatibleVersions,l.NotSupported],C=0xffffffff,v=0xfffffffe,f=0;class b{}b.Type_CallWithoutModalityAdded="call-without-modality-added"},646162:function(e,t,i){i.d(t,{d:()=>D});var n=i(370574),a=i(32416),r=i(892891),o=i(167135),s=i(310735),l=i(206898),c=i(200669),d=i(654807),g=i(945761),h=i(352320),p=i(575810),u=i(836835),m=i(675201),_=i(826757),S=i(590742),C=i(642900),v=i(855273),f=i(586624),b=i(377957),y=i(395250),T=i(817218),I=i(265466),A=i(899192),E=i(58741),M=i(324204);let P="calling_pluginlessAriaCollectorUri",k="calling_slimCoreAriaCollectorUri";class D{constructor(e){this.accountMediaConfiguration={},this.lastGoodServiceUrls={},this.shouldSetHomeCloud=!1,this.haveSetHomeCloud=!1,this.state=o.h6.Uninitialized,this.retriableCalls={},this.callSubscriptionRegistry=[],this.callIncomingNotifications={},this.callDeferred=new WeakMap,this.recentP2PDisconnectedCallsNotInRegistry=[],this.recentP2PDisconnectedCallsNotInRegistryTimeoutTokens=[],this.initStarted=!1,this.forwardingJoinEventTrackerForCall=[],this.enableGeoRoutingForSlimcoreTelemetry=!1,this.enableGeoRoutingForPluginlessTelemetry=!1,this.enableIndiaPhoneSystemSupport=!1,this.enableSlimCoreAccountConfiguration=!1,this.enableTrouterServiceInCallingService=!1,this.callRegistrySubscriptions=[],this.reuseObjectForAdhocChannelMeetings=!1,this.disableEmergencyGroupCall=!1,this.enableMediaOptimization=!1,this.enableCountryEnforcedLbr=!1,this.enabledUnsanitizedLocalLocationLogging=!1,this.unsupportedAppVersion=!1,this.enableGetAuthTokens=!1,this.skypeTokenFetchWithTimeoutRemainingCount=1,this.enableStmDebugUseAadTokenOnly=!1,this.enableStmDebugUseCaeTokenOnly=!1,this.enableTokenRefreshForcedRetry=!1,this.enableTokenForcedRefresh=!1,this.enableInitCallingWithAadToken=!1,this.enableInitCallingWithCaeToken=!1,this.e911InfoChangedEventSubscriptionToken=null,this.emergencyCallFailedEventSubscriptionTokens=[],this.config=e.config,this._activeCallsServiceBase=e.activeCallsService,this._appStateService=e.appStateService,this._authenticationServiceBase=e.authenticationService,this._callingAgentsServiceBase=e.callingAgentsService,this._callingTelemetryServiceBase=e.callingTelemetryService,this._conversationsAsyncServiceBase=e.conversationsAsyncService,this._deviceManagerServiceBase=e.deviceManagerService,this._eventingService=e.eventingService,this._loggingServiceBase=e.loggingService,this._desktopUtilityServiceBase=e.desktopUtilityService,this._platformDetectServiceBase=e.platformDetectService,this._geoRoutingService=e.geoRoutingService,this._sxConfigBase=e.sxConfig,this._telemetryProviderBase=e.telemetryProvider,this._utilityServiceBase=e.utilityService,this._callingSupportServiceBase=e.callingSupportService,this._videoSupportServiceBase=e.videoSupportService,this._teamsCallService=e.teamsCallService,this._pstnNumberService=e.pstnNumberService,this._retryService=e.retryService,this._objectLeaksDetector=e.objectLeaksDetector,this._mutedCallNotificationsServiceBase=e.mutedCallNotificationsService,this._survivabilityService=e.survivabilityService,this._freemiumUtilities=e.freemiumUtilities,this._chatServiceUtils=e.chatServiceUtils,this._servicesProviderBase=e.servicesProvider,this.webApiService=e.webApiService,this.skypeConversationLocalUtils=e.skypeConversationLocalUtils,this.promiseFactory=e.promiseFactory||g.Wq,this._trouterService=e.trouterService,this._setupKeysService=e.setupKeysService,this._slimcoreEcsConfigServiceBase=e.slimcoreEcsConfigService,this._giveTakeControlServiceBase=e.giveTakeControlService,this.logger=e.loggingService.newLogger("callingService"),this.callingServiceHelpers=e.callingServiceHelpers,this.locationAccessSettingService=e.locationAccessSettingService}checkSLAv2Available(){let e=this._slimcoreEcsConfigServiceBase?.getSetting("enableSLAv2")??!1,t=e&&(this._callingSupportServiceBase.isSLAv2DesktopEnabled()||this._callingSupportServiceBase.isSLAv2WebEnabled());return t||this.logger.info(`checked found Slav2 Unavailable, related may cause by: setting: ${e},
        support by desktop: ${this._callingSupportServiceBase.isSLAv2DesktopEnabled()},
        or support by web browser: ${this._callingSupportServiceBase.isSLAv2WebEnabled()}`),t}skipCallStateCheckForSLA(){return this._callingSupportServiceBase.enableCallStateCheckHotfix()}getEnableCallIdForSLAObservingCalls(){return this.config.enableCallIdForSLAObservingCalls?.()}async disposeService(e){return new Promise(async(t,i)=>{try{this.config.enableStopOngoingCallsOnAppTeardown?.()&&(e.scenario.mark(y.ck.stopOngoingCalls),await this.stopOngoingCalls().catch(e=>this.logger.errorToTelemetry?.(`[stopOngoingCalls] Failed with ${this._utilityServiceBase.getErrorLoggingString(e)}`,"cmd_stop_call",void 0,!0))),e.scenario.mark(y.ck.UnloadCallingStarted),await this.unloadCalling(e.scenario),this._authenticationServiceBase.dispose?.()}catch(e){i(e)}e.scenario.mark(y.ck.CleanupOnAppTeardown),this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.initDefer=this.promiseFactory.createDeferred(),this.updateSettings(),this.initializeStaticSettings(),this.debounceVerifyCallProtocols=(0,r.debounce)(this.verifyCallProtocols,1e3)}cleanupOnAppTeardown(e){this.recentP2PDisconnectedCallsNotInRegistryTimeoutTokens?.forEach(e=>this.webApiService.timeout.cancel(e)),null!==this.e911InfoChangedEventSubscriptionToken&&(this._callingAgentsServiceBase.unsubscribe(this.e911InfoChangedEventSubscriptionToken),this.e911InfoChangedEventSubscriptionToken=null),this.emergencyCallFailedEventSubscriptionTokens.length>0&&this.emergencyCallFailedEventSubscriptionTokens.forEach(e=>{this._callingTelemetryServiceBase.unsubscribe(e)})}areMovableStreamsEnabled(){return!!this.config.enableMovableStreams?.()}isFastStartOfStreamsEnabled(){return!!this.config.enableFastStartOfStreams?.()}getUpdateStreamsFastDebounceTime(){return this.config.updateStreamsFastDebounceTime?.()}isVideoLayoutAPIEnabled(){return void 0===this.enableVideoLayoutAPI&&this.checkVideoLayoutAPI(),this.enableVideoLayoutAPI}getCallBySlaCorrelationId(e){if(!this.callRegistry)return null;let t=this.getAllCallsFromRegistry();return(0,r.find)(t,t=>t.slaCorrelationId===e)}getCallByTeamsCallId(e,t,i,n){if(!this.callRegistry)return null;let a=(0,r.isString)(e)?b.w.parseTeamsCallId(e):e;if(i){let e=this.getRetriableCall(a);if(e)return e}let s=(0,r.find)(this.callRegistry.calls,e=>{let i=this._teamsCallService.getOrCreateTeamsCall(e);return(!o.kq.includes(i.state)||!!t)&&i.teamsCallId===a});return n&&!s&&(s=this.recentP2PDisconnectedCallsNotInRegistry.find(e=>e.teamsCallId===a))&&this.logger.info("Found disconnected call from disconnected calls array"),!s&&this.config.enableGetCallByTeamsCallIdLogs?.()&&this.logger.log(`getCallByTeamsCallId teamsCallId=${e} with type=${typeof e}, calls in call registry:`,this.getAllCallsFromRegistry().map(e=>e.teamsCallId)),this._teamsCallService.getOrCreateTeamsCall(s)}getRecentP2PDisconnectedCallsNotInRegistry(){return this.recentP2PDisconnectedCallsNotInRegistry}getVideoLayoutAPI(e,t){if(!this.isVideoLayoutAPIEnabled())return this.logger.info(`${t} [getVideoLayoutAPI] feature flag enableVideoLayoutAPI is disabled, callId=${e}`),null;let i="string"==typeof e?this.getCallByTeamsCallId(e):e;return i?i.isBroadcast?(this.logger.info(`${t} [getVideoLayoutAPI] call is broadcast. VLAPI is not applied, callId=${e}`),null):(i.videoLayout||this.logger.error(`${t} [getVideoLayoutAPI] VLAPI is not set, callId=${e}`),i.videoLayout):(this.logger.info(`${t} [getVideoLayoutAPI] call does not exist, callId=${e}`),null)}handleLoggingEvent(e,t){return this._callingAgentsServiceBase.handleLoggingEvent(e,t)}async reloadCallingStack(e="",t){let i=this._loggingServiceBase.newScenario(y.RG.CallingStackReinit);return this._eventingService.emit(p.gT.events.calling.pluginHostCrash),this.stopOngoingCalls(!0,!0,e||p.gT.scenarios.calling.context.pluginHostCrash).catch(),this.callRegistry=null,this._callingAgentsServiceBase.reinitCallingStack(i).then(()=>this.updateSkypeIdentity()).then(()=>{this._eventingService.emit(p.gT.events.calling.reinitDevices,t),this.setState(o.h6.Initialized),i.stop()}).catch(t=>{this.setState(o.h6.Failed);let n=t?t.errorCode:void 0,a=this._utilityServiceBase.getErrorLoggingString(t);i.fail({errorCode:n,message:a,reason:e}),this.logger.error(`Error re-loading calling stack: code=${n}, message=${a}`),this.promiseFactory.reject(t)})}getTransportAgentService(){return this?._servicesProviderBase?.transportAgentService()}setAccountMediaConfig(e){return this.callRegistry?this.accountConfiguration?(this.accountMediaConfiguration={...this.accountMediaConfiguration,...e},this.accountConfiguration.mediaConfiguration=this.accountMediaConfiguration,this.callRegistry.setConfiguration(this.accountConfiguration).then(()=>(this.logger.info("[setAccountMediaConfig] updated account mediaConfig"),Promise.resolve(!0))).catch(e=>{throw this.logger.error(`[setAccountMediaConfig] failed to update mediaConfig [error=${e&&e.message||e}]`),e})):(this.logger.warn("[setAccountMediaConfig] accountConfiguration not ready yet"),Promise.resolve(!1)):(this.logger.warn("[setAccountMediaConfig] callRegistry not initialized yet"),Promise.resolve(!1))}isApplianceMode(){return this._survivabilityService.isApplianceMode()}isCallForwardingSupportedInApplianceMode(){return this._survivabilityService.isCallForwardingSupported()}isCallTransferSupportedInApplianceMode(){return this._survivabilityService.isCallTransferSupported()}isAppOnlineForSurvivability(){return this._survivabilityService.isAppOnlineForSurvivability?.()}handlePstnNotAllowed(){return this.logger.error("Not allowed to make PSTN call"),Promise.reject({reason:o.hi.PstnCallingNotAllowed,message:"Not allowed to make PSTN call"})}updateCallStartOptions(e,t,i){this._callingSupportServiceBase.blockAVOverIPInMeetings()&&(e.audioDirection=n.MediaDirection.Inactive,e.videoDirection=n.MediaDirection.Disabled);let a=t.getPrejoinExplicitConsentPublishedState();(0,r.isEmpty)(a)||(e.publishedStates={publishedStates:[...e?.publishedStates?.publishedStates||[],...a]}),i.ipAudioModeEnabled||(e.audioDirection=n.MediaDirection.Inactive),i.ipVideoModeEnabled||(e.videoDirection=n.MediaDirection.Disabled),i.screenSharingOnly&&(e.audioDirection=n.MediaDirection.Inactive,e.videoDirection=n.MediaDirection.Disabled,e.screenshareDirection=i.setScreenSharingSendOnly?n.MediaDirection.SendOnly:n.MediaDirection.ReceiveOnly,e.datachannelDirection=n.MediaDirection.Bidirectional,e.negotiationTag=t.initTagForCallStartOptions(e)),this.enableBidirectionalDataChannel&&t.callType!==n.CallType.P2P&&!(this.config?.excludeDataModalityForOneToOneCalls?.()&&t.getIntent()?.type===s.G.OneToOneCall)&&(e.datachannelDirection=this.dataChannelDirection),this._slimcoreEcsConfigServiceBase?.getSetting("enableSendMediaModalities")&&(e.sendMediaModalities={mediaStates:this.convertLegacyCallMediaConfig(e)}),e.withVideo&&i.ipVideoModeEnabled&&this._eventingService.emit(p.gT.events.calling.verifyExistingCamera,t),this.setMaxVideoChannelsOnCallStartOptions(t,e),this.addParticipantPropertyBag(e),this.logger.infoToTelemetry?.(`updateCallStartOptions [audioDirection= ${e?.audioDirection}],[videoDirection= ${e?.videoDirection}], [dataChannelDirection= ${e?.datachannelDirection}], [screenShareDirection= ${e?.screenshareDirection}], [participantPropertyBag= ${JSON.stringify(e?.participantPropertyBag)}]`,"cmd_join_call",void 0,!0);let o=t.getIntent()?.joinOptions?.joinEventAsAttendee;return t.getStartCallScenario().then(e=>{e.appendEventData({previewAsAttendee:o})}),this.updateCommonOptions(e,i.meetingInfo,!1,t,o)}getOngoingCalls(e=!1,t=!0){let i=e?[...o._G,n.CallState.Notified,...o.kq]:[...o._G,n.CallState.Notified],a=this.callRegistry.calls.filter(e=>(0,r.includes)(i,e.state)).map(e=>this._teamsCallService.getOrCreateTeamsCall(e));return t?a:a.filter(e=>!this._servicesProviderBase.callingMultiWindowService().isCallSupportedInModernCalling(e))}async getSkypeIdentityForAuthenticatedUser(){let e=await this._authenticationServiceBase.getUserInformation(),t=await this._authenticationServiceBase.getSkypeId();return await this.getSkypeIdentity(e.profile.name,t)}getAllCallsFromRegistry(){return this.callRegistry?this.callRegistry.calls.map(e=>this._teamsCallService.getOrCreateTeamsCall(e)):[]}getAllCallsForDeviceTransfer(){return this.callRegistry?this.callRegistry.calls.map(e=>this._teamsCallService.getOrCreateTeamsCall(e)):[]}init(e={initSfbIPC:()=>{},initBrb:()=>{},initCallEscalationSubscription:()=>{},preInit:()=>{}}){return(this.uninitDefer?this.uninitDefer:this.promiseFactory.resolve()).then(()=>{if(this.config.enablePreventMultiInitInCallingService?.()&&this.initStarted)return this.logger.info("[init] callingService initialized already"),this.initDefer.promise;this.initStarted=!0,this.cleanupCallRegistry(),this.reportInit(),this.setState(o.h6.Initializing),e.initSfbIPC(),e.initBrb(),this.debounceVerifyCallProtocols(),this._eventingService.registerHandlerForExternalEvent(p.gT.events.settings.updated,()=>{let e=this._loggingServiceBase.newScenario(y.RG.SettingsUpdate);try{this.debounceVerifyCallProtocols(),this.updateSettings(),e.stop()}catch(i){let t=this._utilityServiceBase.getErrorLoggingString(i);e.fail({error:i?.name,message:t,reason:"Settings update event received, but settings update failed."})}}),e.initCallEscalationSubscription(),e.preInit(),this._eventingService.registerHandlerForExternalEvent(p.gT.events.calling.locationResponse,e=>{this.logger.info(`[mediaOptimization] Got location info correlationId=[${e?.debugInfo?.mtDebugInfo?.correlationId}] timeStamp=[${e?.debugInfo?.mtDebugInfo.timeStamp}]`);let t={endpointNetwork:e.endpointNetwork||"unknown",networkSiteId:e.networkSiteId||null,enableLocationBasedRouting:!!e.enableLocationBasedRouting&&e.enableLocationBasedRouting,siteAddress:e.siteAddress||null,subnetId:e.subnetId||null};if(this.setLocationInfo(n.LocationInfoType.LocationContent,JSON.stringify(t),"locationResponse"),e.locationInfo&&e.locationInfo.address){this.logger.info("[mediaOptimization] Detected valid address. Setting areaContent");let t={postalCode:e.locationInfo.address.postalOrZipCode,countryCode:e.locationInfo.address.country,...this.enableCountryEnforcedLbr&&{...e.locationInfo.method&&{locationType:e.locationInfo.method},...e.locationInfo.coordinates&&{geocoordinates:e.locationInfo.coordinates}}},i=this.enabledUnsanitizedLocalLocationLogging?void 0:S._.sanitizeAreaContentForLogging(t);this.setLocationInfo(n.LocationInfoType.AreaContent,JSON.stringify(t),"locationResponse",void 0,JSON.stringify(i))}});let t=()=>{this.logger.info("[e911] Received emergencyCallFailed event. Clearing location info"),this.setLocationInfo(n.LocationInfoType.NetworkContent,void 0,"emergencyCallFailed"),this.setLocationInfo(n.LocationInfoType.LocationContent,void 0,"emergencyCallFailed"),this.setLocationInfo(n.LocationInfoType.AreaContent,void 0,"emergencyCallFailed")};if(0===this.emergencyCallFailedEventSubscriptionTokens.length){let e=this._callingTelemetryServiceBase.subscribe(t,p.gT.events.calling.emergencyCallFailed);this.emergencyCallFailedEventSubscriptionTokens.push(e)}let i=e=>{let{geoCoordinates:t,...i}=e;this.setLocationInfo(n.LocationInfoType.NetworkContent,JSON.stringify(i),"e911InfoChanged")};return this._eventingService.registerHandlerForExternalEvent(p.gT.events.calling.e911InfoChanged,i),null===this.e911InfoChangedEventSubscriptionToken&&(this.e911InfoChangedEventSubscriptionToken=this._callingAgentsServiceBase.subscribe(i,"e911InfoChanged")),this.setupVdiUiSupport(),this.promiseFactory.resolve().then(()=>{this.callingSupport=this.getCallingSupport();let e=(e,t)=>(this.setState(e),this.promiseFactory.reject(t));return this.callingSupport===n.CallSupport.IncompatibleVersions?e(o.h6.IncompatibleVersions):this.callingSupport===n.CallSupport.BrowserNotSupported?e(o.h6.NotSupported):this.callingSupport!==n.CallSupport.Supported?e(o.h6.Failed):this._platformDetectServiceBase.isElectronAppSurfaceHub()&&this._appStateService.isDeviceLicenseInvalid?(this.logger.warn(`Found invalid device license on Surfacehub, skip initializing callingService, isOnline: ${this._appStateService.isOnline}`),this.initScenario.mark(y.ck.StopInitOnInvalidDeviceLicenseSurfaceHub),e(o.h6.Disabled)):(this.initEvents(),this.initScenario.mark(y.ck.InitEvents),this.whenCallRegistryCreated().then(()=>{this.initScenario.mark(y.ck.CreateCallRegistry),this.setState(o.h6.Initialized),this.initDefer.resolve()}).catch(t=>{let i=this.stringifyCallingServiceInitError(t);return this.logErrorAndMarkStep(this.initScenario,t,y.ck.CreateCallRegistry),this.logger.error(`${i}`),e(o.h6.Failed,t)}))}).catch(e=>{(e=this.config.disableAddStepNameToErrorInCallingService()?(0,r.isError)(e)?e:Error(JSON.stringify(e)):(0,r.isError)(e)?e:Error(e)).callingServiceState=o.h6[this.state],e.callingAgentsService=this._callingAgentsServiceBase.getName(),this.initDefer.reject(e)}),this.initDefer.promise})}getCallByCallId(e,t,i){if(!this.callRegistry)return null;let n=t?this.callRegistry.getCall(e,t):(0,r.find)(this.callRegistry.calls,t=>t.callId===e);return n&&o.kq.includes(n.state)&&!i?null:this._teamsCallService.getOrCreateTeamsCall(n)}getAllCalls(e,t){if(!this.callRegistry)return[];let i=(e||t?this.callRegistry.calls.slice(0):this.callRegistry.calls.filter(e=>!o.kq.includes(e.state))).map(e=>this._teamsCallService.getOrCreateTeamsCall(e));return t&&(i=i.filter(e=>!o.kq.includes(e.state)||e.isServerHold)),i}getActiveCall(){let e=[n.CallState.Connecting,n.CallState.EarlyMedia,n.CallState.Connected,n.CallState.InLobby,n.CallState.Disconnecting,n.CallState.Preheating,n.CallState.Preheated],t=this.callRegistry?this.callRegistry.calls.filter(t=>(0,r.includes)(e,t.state)):[];return t.length>0?this._teamsCallService.getOrCreateTeamsCall(t[0]):null}async createCallWithMeetingData(e,t,i,n,a=!0){let r=async(t,i)=>{let n=this._utilityServiceBase.generateUUID(),a=_.eU.scrubMeetingData(e);return(this.logger.info(`Creating call with meetingData: ${this._utilityServiceBase.asString(a)}, causeId: ${n}`),this.config.enableCreateCallAsync())?this.callRegistry.createCallAsync({type:"MeetingData",meetingData:e,callId:t,localParticipantId:i,causeId:n}):this.callRegistry.createCallWithMeetingData(e,t,i)},o=await this._createCall(r,t,i,n,a);return o.joinType=l.c.MeetingData,o}createCall(e,t,i,n,a,r,o=!0,s,l,c,d,g){this.markScenarioStep(d,y.ck.CreatingCall,[c,...this.secondaryScenariosToBeMarked(d?.name,g)]);let h=async(i,n,r)=>{let o;if(r)o=this.config.enableCreateCallAsync()?await this.callRegistry.createCallAsync({type:"GroupId",groupId:r,callId:i,localParticipantId:n,causeId:this._utilityServiceBase.generateUUID()},this._callingAgentsServiceBase.extendedCallingStackTelemetryEnabled()?(0,E.O)(d,!0,"tscalling_",this.logger):void 0):this.callRegistry.createCallWithGroupId(r,i,n,a),this.markScenarioStep(d,y.ck.CreateCallWithGroupid,[c,...this.secondaryScenariosToBeMarked(d?.name,g)],{createCallWithGroupId_CallObjectExists:!!o,createCallWithGroupId_GroupId:r,createCallWithGroupId_NewCallId:i,createCallWithGroupId_NewParticipantId:n,createCallWithGroupId_messageId:a});else{let r=e;t&&this.config.enableNullCallThreadId()&&(r=null),this.config.enableDecouplingGroupCallFromChat()&&this.skypeConversationLocalUtils.isLie(e)&&(r=""),o=this.config.enableCreateCallAsync()?await this.callRegistry.createCallAsync({type:"ThreadId",threadId:r,messageId:a,callId:i,localParticipantId:n,causeId:this._utilityServiceBase.generateUUID()},this._callingAgentsServiceBase.extendedCallingStackTelemetryEnabled()?(0,E.O)(d,!0,"tscalling_",this.logger):void 0):this.callRegistry.createCall(r,i,n,a),this.markScenarioStep(d,y.ck.CreateCall,[c,...this.secondaryScenariosToBeMarked(d?.name,g)],{createCallWithGroupId_CallObjectExists:!!o,createCallWithGroupId_threadId:r,createCallWithGroupId_NewCallId:i,createCallWithGroupId_NewParticipantId:n,createCallWithGroupId_messageId:a,createCallWithGroupId_conversationId:e}),e&&(o.conversationId=e)}return o};return this._createCall(h,i,n,r,o,s,l,c,d,g)}deleteCall(e,t,i){return this.callRegistry?this.callRegistry.deleteCall(e,t,i):(this.logger.errorToTelemetry?.(`Cannot delete call. Call registry not defined [callId=${e.callId}][final=${t}][causeId=${i}]`,"cmd_join_call",void 0,!0),!1)}startCall(e,t={onPstnNotAllowed:()=>this.handlePstnNotAllowed()}){let i=e.secondaryScenarios?.find(e=>e.name===p.gT.scenarios.calling.decoupledCall);return this._conversationsAsyncServiceBase.getCallingConversation(e.conversationId).then(n=>{let a=this._loggingServiceBase.findScenario(e?.scenarioName);if(this.markScenarioStep(a,y.ck.CallConversationFetchedStartCall,[i,...this.secondaryScenariosToBeMarked(a?.name,e.secondaryScenarios)]),!e.transferContext&&this.isModalDialogForNonEVUsersEnabled&&this.isAnyCallParticipantPSTN(n.members)&&!this._callingSupportServiceBase.isPSTNCallingAllowed())return t.onPstnNotAllowed().then(()=>this.promiseFactory.resolve(void 0));this.logger.info(`[call][startCall][conversationId=${e.conversationId}][isAudioDropInCall=${e.isAudioDropInCall}][isEchoBotCall=${!!e.isEchoBotCall}][alternateId=${e.alternateId}]`);let r=!0;e.isAudioDropInCall&&(r=!1),this.isEchoBotCallEnabled&&e.isEchoBotCall&&(r=!1),n&&n.isPrivateMeeting()&&(this.logger.error(`Missing meetingInfo for private meeting ${e.conversationId}`),r=!1);let o=this._callingSupportServiceBase.isIPAudioModeEnabledByType(n.isOneToOne()),s=this._callingSupportServiceBase.isIPVideoModeEnabledByType(n.isOneToOne()),l=this._activeCallsServiceBase.getCallsByConversationId(e.conversationId);if(l&&l.length>0){let t=l[0];return this.logger.log(`startCall - joining ongoing call instead${e.conversationId}[call]`),this.markScenarioStep(a,y.ck.JoiningOngoingCall,this.secondaryScenariosToBeMarked(a?.name,e.secondaryScenarios)),this.joinCall({conversationId:e.conversationId,messageId:t.messageId,meetingInfo:t.meetingInfo,callId:t.callId,teamsCallId:t.teamsCallId,callUrl:t.callUrl,audioOnly:!e.withVideo&&o,muted:e.muted||!o,startCallScenarioPromise:e.startCallScenarioPromise,secondaryScenarios:e.secondaryScenarios,screenSharingOnly:e.screenSharingOnly,joinType:m.AH.normal,scenario:a})}let c=this.processAlternateId(e.alternateId,n.members);return this.checkCallAndGetEmergencyContent(e.conversationId,e.emergencyContent,e.alternateId).then(t=>(this.logger.log(`startCall for ${e.conversationId} ${e.withVideo?"withVideo":""} and EmergencyContent: ${t}`),this.markScenarioStep(a,y.ck.PreparingCall,[i,...this.secondaryScenariosToBeMarked(a?.name,e.secondaryScenarios)]),this.prepareCall({conversationId:e.conversationId,withVideo:e.withVideo&&s,ringOthers:r,isAudioDropInCall:e.isAudioDropInCall,transferContext:e.transferContext,muted:e.muted||!o,emergencyPayload:t,onBehalfOf:e.onBehalfOf,onBehalfOfUserDisplayName:e.onBehalfOfUserDisplayName,targetApplicationType:e.targetApplicationType,consultationContext:e.consultationContext,startCallScenarioPromise:e.startCallScenarioPromise,secondaryScenarios:e.secondaryScenarios,screenSharingOnly:e.screenSharingOnly,joinType:m.AH.normal,isFromRejoin:e.isFromRejoin,isChannelMeeting:!1,isEchoBotCall:!!e.isEchoBotCall,callId:e.callId,groupId:e.groupId,invitationData:e.invitationData,callQueueContext:e.callQueueContext,alternateId:c,scenario:a,originalCall:this.config.enableTransferCallQueueEarlierCopy?.()?e.originalCall:void 0})))})}joinCall(e){let t,i=this._callingTelemetryServiceBase.newCallingScenario(null,y.RG.JoinCall);this.logger.debug(`Join call with call id = ${e.callId} and conversation id = ${e.conversationId}`),e?.scenario||e.startCallScenarioPromise?.then(t=>{e.scenario=t});let n=this.callOptionsFromJoinCallParams(e),a=this.verifyCallState(n,!0).then(async()=>{i.mark(y.ck.CallStateVerified),this.logger.log(`joinCall${e.conversationId} ${e.messageId} ${e.callId} ${e.callUrl}`),e?.scenario&&this.markScenarioStep(e.scenario,y.ck.JoinCallVerifiedCallState,this.secondaryScenariosToBeMarked(e.scenario?.name,e.secondaryScenarios));let a=!1;if(!e.messageId){let t=await this._conversationsAsyncServiceBase.getCallingConversation(e.conversationId);a=t.isOneToOne(),t&&t.isGroup()&&(i.mark(y.ck.ClearMeetingInfo),n.meetingInfo=void 0,e.meetingInfo=void 0,this.logger.log(`joinCall group call clear meeting info callId = ${e.callId}`))}let r=this.getObservingCallByTeamsCallId(e.teamsCallId),o=e.secondaryScenarios?.find(e=>e.name===p.gT.scenarios.calling.decoupledCall);return r?(e?.scenario&&this.markScenarioStep(e.scenario,y.ck.ObservingCallFetchedForJoin,[o,...this.secondaryScenariosToBeMarked(e.scenario?.name,e.secondaryScenarios)]),t=r):t=await this.createCall(e.conversationId,a,e.callId,void 0,e.messageId,e.teamsCallId,void 0,void 0,e.screenSharingOnly,o,e?.scenario,e?.secondaryScenarios),this.commonPostCallCreationSetup(t,i,n.startCallScenarioPromise,n.secondaryScenarios,n.title,n.screenSharingOnly),this._videoSupportServiceBase.isVideoAvailableForConversation(t.conversationId)||e.screenSharingOnly||(e.audioOnly=!0,this.logger.log("joinCall audioOnly = ",e.audioOnly)),e.screenSharingOnly&&this.logger.log("joinCall screenshareOnly = ",e.screenSharingOnly),this.initAndJoin(t,e,i)});return this.postJoinCall(a,i,e,void 0),a}leaveCall(e,t,i,n,a,r={leaveBroadcastCall:e=>e()}){return e?(this.logger.info(`leaving call: [callId=${e.callId}][leaveCallContext=${t}][leaveCallState:${e.state}][isCallOnServerHold=${_.eU.isCallOnServerHold(e)}]`),this._servicesProviderBase.coordinatedMeetingsService().handleCoordinatedMeetingsDisconnectingCall(e).then(o=>(!0===o&&(i||(i={}),i.isCoMeCall=o),_.eU.isCallOnServerHold(e))?this._servicesProviderBase.callParkService().unholdCall(e,t).then(t=>{e=t}).catch().then(()=>this.leaveCallInternal(e,t,i,n,a)):e.isBroadcast&&(t===p.gT.scenarios.calling.context.producerScreen||t===p.gT.scenarios.calling.context.inAppCallMonitor||t===p.gT.scenarios.calling.context.floatingCallMonitor)?r.leaveBroadcastCall(()=>this.leaveCallInternal(e,t,i,n,a)):this.leaveCallInternal(e,t,i,n,a))):this.promiseFactory.reject("Call object should be always provided for leaveCall")}dismissIncomingCallNotification(e,t){let i=this.callIncomingNotifications[e];i&&(i.cancel(t?.isPreJoin),delete this.callIncomingNotifications[e])}dismissAllIncomingCallNotification(e){e.forEach(e=>{this.dismissIncomingCallNotification(e.teamsCallId)})}getThreadId(e,t){return this.config.enableNullCallThreadId()&&t?null:e}getState(){return this.config.enableCallingAgentsServiceStateInGetState()?this.isGlobalCallingStackInitialized()?o.h6.Initialized:o.h6.Initializing:this.state}isTokenForcedRefreshedEnabled(){return this.enableTokenForcedRefresh||this.enableTokenRefreshForcedRetry}isCCAMediaProxied(){return this._authenticationServiceBase.getHomeCloudFromWindow?.()===this.homeCloud&&this.haveSetHomeCloud}applyAccountConfig(){return this.promiseFactory.create((e,t)=>{let i;if(this._survivabilityService.isApplianceMode()){let e=this._survivabilityService.getApplianceAccountConfigServiceUrls();if(!e)return;i=this.createAccountConfiguration(!0).then(t=>(t.serviceUrls=e,t.enforceUrls=!0,t.clientSupportsGenericTokenAPI=!1,t))}else i=this.createAccountConfiguration();i.then(i=>{this.logger.info(`[applyAccountConfig] applying account [regionOverride=${i.regionOverride}] [serviceUrls=${this._utilityServiceBase.asString(i.serviceUrls)}] [enforceUrls=${i.enforceUrls}]`),this.callRegistry&&this.setSlimCoreAriaCollector(i),this.callRegistry?.setConfiguration(i).then(e,t)},t)})}getParsedMediaSourceId(e,t){let i=t===o.qG||t===o.kP;return i&&e.callType!==n.CallType.P2P&&this.logger.warn(`MSI is P2P (${t}) but callType is not P2P (${e.callType})`),i?o.Eg:t}setLocationInfo(e,t,i,n,r){let o=n??this._callingSupportServiceBase.isCountryEnforcedLbrUser()?A.t.INDIA_PHONE_SYSTEM:A.t.E911;return(this.logger.info(`[setLocationInfo] request received (not yet invoked) with [feature=${o}][locationInfoType=${e}][content=${r||t}][context=${i}][mediaOptimization]`),this.enableMediaOptimization)?this.callRegistry?void this.initDefer.promise.then(()=>{(0,a.C)(this.config.enableLocationAccessSettings,this._platformDetectServiceBase,this._utilityServiceBase,this.logger)?this.locationAccessSettingService.getLocationAccessSetting(o).then(n=>{n?this.callRegistry.setLocationInfo(e,t).then(()=>{this.logger.info(`[setLocationInfo] set location info successfully [locationInfoType=${e}][content=${r||t}][context=${i}][mediaOptimization]`)}).catch(n=>{this.logger.error(`[setLocationInfo] failed to set location info [locationInfoType=${e}] [error=${n.message}][content=${r||t}][context=${i}][mediaOptimization]`)}):this.logger.error(`[setLocationInfo] did not set location info. Location access setting is disabled for feature ${o}`)}).catch(e=>{this.logger.error(`[setLocationInfo] did not set location info. Failed to get location access setting for feature ${o}`)}):this.callRegistry.setLocationInfo(e,t).then(()=>{this.logger.info(`[setLocationInfo] set location info successfully [locationInfoType=${e}][content=${r||t}][context=${i}][mediaOptimization]`)}).catch(n=>{this.logger.error(`[setLocationInfo] failed to set location info [locationInfoType=${e}] [error=${n.message}] [content=${r||t}][context=${i}][mediaOptimization]`)})}):void this.logger.warn("[setLocationInfo] did not set location info. Call registry does not exist yet [mediaOptimization]"):void this.logger.info("[setLocationInfo] did not set location info. media optimization is disabled [mediaOptimization]")}async _createCall(e,t,i,n,a=!0,r,o,s,l,c){let d=t||this._utilityServiceBase.generateUUID(),g=i||this._utilityServiceBase.generateUUID();if(a){let e=this.getRetriableCall(n);e&&this.cancelRetry(e)}this.createCallHook=e=>{e.callId===d&&this._teamsCallService.getOrCreateTeamsCall(e,n),this.createCallHook=null};let h=await e(d,g,r);this.createCallHook=null,this.markScenarioStep(l,y.ck.OutgoingCallCallCreated,[s,...this.secondaryScenariosToBeMarked(l?.name,c)],{callId:h?.callId}),l?.appendEventData({callId:h?.callId});let p=this._teamsCallService.getOrCreateTeamsCall(h,n);return void 0!==o&&(p.isScreenshareFromChat=o),this.logger.info(`[call][createCall][callId=${p.callId}][threadId=${p.threadId}][messageId=${p.messageId}][participantId=${p.participantId}][teamsCallId=${n}][isScreenshareOnly=${o}]`),p}getSkypeId(){let e=this.enableOfflineCallingAuth;return this._authenticationServiceBase.getSkypeId(void 0,e).catch(t=>{if(!e)return this.promiseFactory.reject(t);let i=this._sxConfigBase.getCurrentSkypeId();return i?this.promiseFactory.resolve(i):this.promiseFactory.reject("Cannot get cached skypeId")})}applyMultiVbssOptions(e,t){let i={multiVbssSupportedForCall:!1,biDirectionalVbssSupportedForCall:!1},a=t&&this.isMultiVbssSupportedForCallType(t);a&&this.config.maxIncomingVbssChannels()>1&&(e.maxVbssChannels=this.config.maxIncomingVbssChannels()-1,i.multiVbssSupportedForCall=!0,this.isDesktop&&(this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsBidirectionalVBSS),i.biDirectionalVbssSupportedForCall=!0)),t?.setVbssDetails(i),this.logger.info(`[MultiVBSS state] multiVbssSupportedForCall: ${t?.vbssDetails.multiVbssSupportedForCall}, biDirectionalVbssSupportedForCall: ${t?.vbssDetails.biDirectionalVbssSupportedForCall}, multiVbssSupportedForCallType: ${a}, maxIncomingVbssChannels: ${this.config.maxIncomingVbssChannels()}, isDesktop: ${this.isDesktop}`)}getSkypeIdentity(e,t,i=!1){let n={id:t,tokenProvider:this.skypeTokenProvider.bind(this,i),displayName:e};return this.promiseFactory.resolve(n)}markScenarioStep(e,t,i,n){[e,...i||[]].forEach(e=>{e?.mark(t,n)})}secondaryScenariosToBeMarked(e,t){if(!this.config.enableEVUnifiedFlowExtendedTelemetry?.()&&e){let i=t?.find(t=>t?.name===`${e}_v2`)||this._loggingServiceBase.findScenario(`${e}_v2`);return i?[i]:[]}return[]}checkVideoLayoutAPI(){let e=this.config.enableVideoLayoutAPI();if(e===this.enableVideoLayoutAPI)return;let t=this.config.videoLayoutAPIMinWebClientVersion();this.enableVideoLayoutAPI=e&&this._callingSupportServiceBase.isMinWebClientVersion(t),this.logger.info(`VLAPI enabled is ${this.enableVideoLayoutAPI}. ECS: ${e} Min Web Client Version: ${t}`)}setMaxVideoChannelsOnCallStartOptions(e,t){if(!e)return void this.logger.log("[setMaxVideoChannelsOnCallStartOptions] Call does not exist");this.enableMaxNumberOfVideos&&!this.getVideoLayoutAPI(e,"[setMaxVideoChannelsOnCallStartOptions]")&&(t.maxVideoChannels=e.isBroadcast?this.largeMeetingSettings.maxNumberOfBroadcastVideo:this._callingSupportServiceBase.getMaxNrOfStageItems())}saveCallSetupArgs(e,t,i,a,o){let s,l;this.enableCallMutedStateFromConversation&&e.callType===n.CallType.Unknown?(s=this._callingSupportServiceBase.isIPAudioModeEnabledByType(i.isOneToOneCall),l=this._callingSupportServiceBase.isIPVideoModeEnabledByType(i.isOneToOneCall)):(s=this._callingSupportServiceBase.isIPAudioModeEnabledForCall(e),l=this._callingSupportServiceBase.isIPVideoModeEnabledForCall(e)),e.setupArgs={conversationId:t.conversationId,isChannelMeeting:t.isChannelMeeting,messageId:t.messageId,meetingInfo:(0,r.isEmpty)(t.meetingInfo)?e.meetingInfo:t.meetingInfo,title:t.title,transferContext:t.transferContext,muted:t.muted||!s,withVideo:t.withVideo&&l,convoCallUrl:o,networkReconnect:n.QualityLevel.Good,mutedSpeakers:t.mutedSpeakers||!s,screenSharingOnly:t.screenSharingOnly,joinType:t.joinType,isEchoBotCall:!!t.isEchoBotCall,audioUsageMode:t.audioUsageMode,targetApplicationType:t.targetApplicationType},e.getStartCallScenario().then(t=>e.setupArgs.scenarioName=t.name).catch(()=>{})}initSlimCoreTrouter(e){if(this.enableTrouterServiceInCallingService){let t=t=>{this.logger.info("[CallingService] initSlimCoreTrouter callback"),this._trouterService.initSlimCoreTrouter(t,e)};this._callingAgentsServiceBase.onUserLoggedIn(e,t)}else this._callingAgentsServiceBase.onUserLoggedIn(e)}stopSlimCoreTrouter(e){if(!this._callingAgentsServiceBase.onUserLoggingOut)return void this.logger.info("[CallingService] onUserLoggingOut is not available");if(this.enableTrouterServiceInCallingService){e.mark(y.ck.StopTrouterFromCallingService);let t=()=>{this.logger.info("[CallingService] trouterService stop"),this._trouterService.stop("logout")};this._callingAgentsServiceBase.onUserLoggingOut(t)}else e.mark(y.ck.StopTrouterFromCallingAgentsService),this._callingAgentsServiceBase.onUserLoggingOut()}updateSettings(){this.anonymousEnabled=this.config.anonymousJoinEnabled(),this.isEchoBotCallEnabled=this.config.enableEchoBotCall(),this.disableCallingStopOnAlreadyDisconnectedCall=!!this.config.disableCallingStopOnAlreadyDisconnectedCall?.(),this.largeMeetingSettings=this.config.largeMeetingSettings(),this.enableGeoRoutingForSlimcoreTelemetry=this.config.enableGeoRoutingForSlimcoreTelemetry?.()??!1,this.enableGeoRoutingForPluginlessTelemetry=this.config.enableGeoRoutingForPluginlessTelemetry?.()??!1,this.enableIndiaPhoneSystemSupport=this.config.enableIndiaPhoneSystemSupport?.()??!1,this.enableSlimCoreAccountConfiguration=this.config.enableSlimCoreAccountConfiguration(),this.enableTrouterServiceInCallingService=this.config.enableTrouterServiceInCallingService(),this.enableEmergencyCallingTesting=this.config.enableEmergencyCallingTesting(),this.enableEmergencyCallingTestingWithPayload=this.config.enableEmergencyCallingTestingWithPayload(),this.enableMaxNumberOfVideos=this.config.enableMaxNumberOfVideos(),this.enableBidirectionalDataChannel=this.config.enableBidirectionalDataChannel(),this.dataChannelDirection=this.largeMeetingSettings.dataChannelDirection,this.isDesktop=this._desktopUtilityServiceBase.isDesktop(),this.avoidSendingTitleAsSubject=this.config.avoidSendingTitleAsSubject(),this.enableOfflineCallingAuth=this.config.enableOfflineCallingAuth(),this.disableEmergencyGroupCall=this.config.disableEmergencyGroupCall(),this.enableMediaOptimization=this.config.enableMediaOptimization(),this.enableCountryEnforcedLbr=this.config.enableCountryEnforcedLbr(),this.enabledUnsanitizedLocalLocationLogging=this.config.enabledUnsanitizedLocalLocationLogging(),this.reuseObjectForAdhocChannelMeetings=this.config.reuseObjectForAdhocChannelMeetings(),this.enableIpsForCallingContext=this.config.enableIpsForCallingContext()&&this.webApiService.getWindow().desktopSettings?.enableIpsForCallingContext,this.enableWaitForIpsCallState=this.config.enableWaitForIpsCallState(),this.enableSetMediaConfigOnRegistry=this.config.enableSetMediaConfigOnRegistry(),this.enableUserHexCID=this.config.enableUserHexCID(),this.enableCallMutedStateFromConversation=this.config.enableCallMutedStateFromConversation(),this.enableStmDebugUseAadTokenOnly=this.config.enableStmDebugUseAadTokenOnly?.(),this.enableStmDebugUseCaeTokenOnly=this.config.enableStmDebugUseCaeTokenOnly?.(),this.enableTokenRefreshForcedRetry=this.config.enableTokenRefreshForcedRetry(),this.enableTokenForcedRefresh=this.config.enableTokenForcedRefresh(),this.enableInitCallingWithAadToken=this.config.enableInitCallingWithAadToken?.()||!1,this.enableInitCallingWithCaeToken=this.config.enableInitCallingWithCaeToken?.()||!1,this.csaEndpointAddress=this.config.csaEndpointAddress?.()||"",this.audioDropInMaxUnmuteParticipantsExceptCurrentUser=this.config.audioDropInMaxUnmuteParticipantsExceptCurrentUser?.()||0,this.config.enableUpdateCallingSTMFlagOnECSUpdates()&&(this.enableGetAuthTokens=this.config.enableGetAuthTokens())}async getCameraAvailablePromise(e,t){if(!t||this._callingSupportServiceBase.isIPVideoModeEnabledByType(t.isOneToOneCall)){let t=this._deviceManagerServiceBase.getCameraAvailable();try{return await this._utilityServiceBase.getPromiseWithTimeout(t,this.config.getCameraTimeoutMs()??p.fB.thirtySeconds,"getCameraPromise timed out")}catch(i){let t=this._utilityServiceBase.getErrorLoggingString(i);this.markCallJoinPartialFailure(t,e)}}return!1}async createAccountConfiguration(e){this.logger.info("createAccountConfiguration: Create Account Configuration");let t=this.config.enableCallingInTfl()?this.getMsaAccountConfig():await this.getAadAccountConfig(e);(this._platformDetectServiceBase.isRigel()||this._platformDetectServiceBase.isElectronAppSurfaceHub())&&(t={...t,deviceType:"room"}),t.mediaConfiguration=this.accountMediaConfiguration,this.enableGetAuthTokens&&this.hasMinVersionForSTM()&&(t.clientSupportsGenericTokenAPI=!0),this.config.enableCallingInTfl()&&this.enableUserHexCID&&this.currentUserCid&&(t.userHexCID=this.currentUserCid),this.config.enableE2EEWaitForAccountConfig()&&await this._callingSupportServiceBase.waitForE2EEEnabled(),this._callingSupportServiceBase.isE2EEEnabled()&&(this.logger.infoToTelemetry?.("[E2EE_CALLING_DEBUG] set preferE2EEncryption to true","e2ee_calling_debug",void 0,!0),t.preferE2EEncryption=!0),this._callingSupportServiceBase.isWatermarkAudioOnlySupported()&&(t.clientSupportsAudioOnlyWatermark=!0,this._callingSupportServiceBase.isWatermarkSupported()&&(t.clientSupportsWatermark=!0)),t.clientSupportsPreventScreenCapture=this._callingSupportServiceBase.isPreventScreenCaptureSupported(),this._callingSupportServiceBase.isThirdPartyMeetingRoom()&&(t.deviceType="3proom"),this.shouldSetPluginlessAriaCollector(t)&&(t.serviceUrls.OneDsCollectorUrl=t.serviceUrls[P]);let i=!!this.config.enableRelayConfigInAccountConfiguration?.(),n=this.config.relayConfig?.();return i&&n&&(t.relayConfig=n),this.accountConfiguration=t,this.enableCallingServiceInitExtendedTelemetry&&this.initScenario?.appendEventData({accountConfigurationCreated:!0}),t}createCallRegistry(e){return this.authenticate().then(([t,i])=>{this.homeCloud=this._authenticationServiceBase.getHomeCloudFromWindow?.(),this.shouldSetHomeCloud=!!this.homeCloud&&this.config.crossCloudMediaProxyAllowedClouds?.()?.includes(this.homeCloud)&&this.config.enableCrossCloudMediaProxy?.()&&this._authenticationServiceBase.isCrossCloudAnonymous?.()||!1,e.appendEventData({isCCA:this._authenticationServiceBase.isCrossCloudAnonymous?.(),isCCAMediaProxied:this.shouldSetHomeCloud,enableCrossCloudMediaProxy:this.config.enableCrossCloudMediaProxy?.()}),this.logger.log(`[createCallRegistry] call registry created with skypeId: ${i}`),e.mark(y.ck.Authenticate),this.currentTenantId=t.profile.tid,this.currentUserCid=_.eU.convertOidToCid(t.profile.oid);let n=t.profile.name;return this.getSkypeIdentity(n,i,!0).then(t=>(e.mark(y.ck.GetSkypeIdentity),this.obtainCallRegistry(t).then(n=>{e.mark(y.ck.ObtainCallRegistry),this.callRegistry=n,this.enableCallingServiceInitExtendedTelemetry&&e?.appendEventData({assignedCallRegistry:!0});let a=this._loggingServiceBase.newScenario(y.RG.GetEcsConfigScenario);this.shouldMigrateCallRegistryEcsConfig()?this.callRegistry.getEcsConfig().then(t=>{e.mark(y.ck.GetEcsConfig),a.mark(y.ck.BeginEcsConfig),this._slimcoreEcsConfigServiceBase?.setEcsConfig(t),a.stop()}).catch(t=>{let i=`[createCallRegistry] Error getting ECS config ${this.stringifyCallingServiceInitError(t)}`;this.logger.error(i),e.fail({error:i}),a.fail({error:i})}):a.cancel({reason:"ECS config migration not needed"}),this.addCallRegistrySubscriptions(),this._callingSupportServiceBase.isSupportedEnvironment()&&this.subscribeTo(this._deviceManagerServiceBase,this.onDevicesChanged,p.gT.events.calling.devicesChanged),this.config.enableResendRegistrationAfterTokenRevocation?.()&&this._authenticationServiceBase.registerCallback("auth-state-update-event",e=>this.onSkypeTokenRefreshedAfterRevocation(e)),this._eventingService.registerHandlerForExternalEvent(p.gT.events.skypeAuth.tokenRefreshedAfterRevocation,()=>this.onSkypeTokenRefreshedAfterRevocation()),this._eventingService.registerHandlerForExternalEvent(p.gT.events.skypeAuth.tokenRefreshed,()=>this.pushTokenToCallRegistry(p.gT.events.skypeAuth.tokenRefreshed)),this._authenticationServiceBase.registerCallback&&this._authenticationServiceBase.registerCallback("token-refresh-event",async(e,t)=>{this.pushTokenToCallRegistry(p.gT.events.skypeAuth.tokenRefreshed,void 0,void 0,void 0,{causeId:t},{refreshedSkypeToken:e})}),this.enableCallingServiceInitExtendedTelemetry&&e?.appendEventData({registeredAuthCallbacks:!0});let r=this.createAccountConfiguration().then(i=>this.promiseFactory.create((n,a)=>{if(this.enableSlimCoreAccountConfiguration){this.logger.info("call registry initialization"),e.mark(y.ck.CallRegistryInitializeStart),this.setTrapUrl();let t=this._utilityServiceBase.generateUUID();this.logger.info(`set account configuration: ${this._utilityServiceBase.asString(i)}`);let r=this.promiseFactory.create((t,i)=>{let n=this.callRegistry.getSetup();if(this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.SetupKeyGetSetup),!this._setupKeysService)return void t();this._setupKeysService.setTenantId(n).then(()=>(this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.SetupKeySetTenantId),this._setupKeysService?.setCallingConfigs(n))).then(()=>{this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.SetupKeySetCallingConfigs),t()},()=>{this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.SetupKeySetCallingConfigsFail),i()})});this.config.enableCallingInTfl()&&this.isDesktop&&this.setTflAccountConfig(),this.isDesktop&&!this._desktopUtilityServiceBase.isPluginless()&&!this.config.enableCallingInTfl()&&this.config.enableOverridePnhTemplateForDesktop?.()&&this.pnhTemplateOverrideForTFWDesktop(!!this.config.enableTokenRevocationHandlingForCMDTrouter()&&!!this.config.enableOverridePnhTemplateForDesktop?.()),e.appendEventData({[p.gT.counters.eventNames.causeId]:t}),this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.SetupKeyInitStart),r.then(()=>{this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.SetupKeyInitPromiseResolved),this.logger.infoToTelemetry?.(`[createCallRegistry] shouldSetHomeCloud ${this.shouldSetHomeCloud}`,"cmd_join_call",{},!0);let n=this.convertToHomeCloud(this.homeCloud);return this.shouldSetHomeCloud&&n&&(i.homeCloud=n,this.haveSetHomeCloud=!0,e.mark(y.ck.AccountConfigurationHomeCloudSet),e.appendEventData({homeCloud:n}),this.logger.infoToTelemetry?.(`[createCallRegistry] homeCloud set to ${i.homeCloud}`,"cmd_join_call",{},!0)),this.callRegistry.initialize(t,i,this._callingAgentsServiceBase.extendedCallingStackTelemetryEnabled()?{main:(0,E.O)(e,!0,"tscalling_",this.logger),companion:this._callingAgentsServiceBase.isVMSSMode()?(0,E.O)(this._loggingServiceBase.newScenario(y.RG.SlimcoreVdiInitializeVMSSCompanionCallRegistry),!1,"tscalling_",this.logger):void 0}:void 0)}).then(()=>{this.initCallingWithToken(),this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.CallRegistryInitializePromiseResolved),this.setSlimCoreAriaCollector(i),this.config.enableCallingServiceInitDetailedLogs?.()&&e.mark(y.ck.SetSlimCoreAriaCollectorDone),n()},a)}else this.logger.info("logging in to call registry"),e.mark(y.ck.CallRegistryInitStart),this._platformDetectServiceBase.isSurfaceHub()&&!this._platformDetectServiceBase.isElectronAppSurfaceHub()?this.callRegistry.init(t).then(()=>{this.initCallingWithToken(),n()},a):this.callRegistry.login(t).then(()=>{this.initCallingWithToken(),n()},a),(this._platformDetectServiceBase.isRigel()||this._platformDetectServiceBase.isElectronAppSurfaceHub())&&this.config.enableAllowRoomRemote()&&(this.logger.info(`set account configuration for rigel: ${this._utilityServiceBase.asString(i)}`),this.callRegistry.setConfiguration(i))}));return(this.config.sendAutoBrbForCallRegistryInitAnomalies()&&this.sendAutoBrbForCallRegistryInitAnomalies(r),this._callingAgentsServiceBase.onUserLoggedIn)?r.then(()=>{e.mark(y.ck.InitSlimCoreTrouter),this.initSlimCoreTrouter(i)}).catch(t=>{if(this.config.enableCallingServiceInitDetailedLogs?.()){let i=`[errorName=${t.name}][errorMessage=${t.message}][errorStack=${t.stack}][errorKeys=${JSON.stringify(Object.keys(t))}]`;if(this.config.callingServiceErrorKeys?.().length>0){let e=this.config.callingServiceErrorKeys?.().map(e=>`${e}=${t?.[e]}`);this.logger?.errorToTelemetry(`[ErrorValues=${e}]`,"calling_service_init_fail_at_trouter",void 0,!0)}throw this.logger?.errorToTelemetry(`${i}`,"calling_service_init_fail_at_trouter",void 0,!0),e.fail({[p.gT.counters.eventNames.reason]:`Failed to InitSlimCoreTrouter ${i}`,[p.gT.counters.eventNames.error]:"object"!=typeof t||t.name&&"Error"!==t.name?"":"InitSlimCoreTrouter failure"}),t}{let i=this.stringifyCallingServiceInitError(t);throw e.fail({[p.gT.counters.eventNames.reason]:`Failed to InitSlimCoreTrouter ${i}`}),t}}):r}).catch(t=>{throw this.logErrorAndMarkStep(e,t,y.ck.ObtainCallRegistry),t}))).catch(t=>{throw this.logErrorAndMarkStep(e,t,y.ck.GetSkypeIdentity),t})}).catch(t=>{throw this.logErrorAndMarkStep(e,t,y.ck.Authenticate),t})}setTrapUrl(){if(!(!this._desktopUtilityServiceBase.isDesktop()||this._desktopUtilityServiceBase.isDesktopPluginless()))try{let e=this._authenticationServiceBase.getHomeCloudFromWindow?.();if(this.logger.infoToTelemetry?.(`[setTrapUrl] homeCloud: ${e}`,"cmd_join_call",{},!0),this.config.enableSettingTrapServiceTokenUrlCallRegistry?.()&&this.config.slimcoreTrapServiceTokenUrl){let t=!!e&&this.config.crossCloudTrapServiceTokenUrl?.()[e],i=this.shouldSetHomeCloud&&t?t:this.config.slimcoreTrapServiceTokenUrl();if(i){let e=this.callRegistry.getSetup();if(this.config.enableOmitProtocolTrapService?.()){let e=new URL(i);i=`${e.host}${e.pathname}`}e.setString("Lib/TRAP/Service/tokenUrl",i),this.logger.info(`call registry TRAP URL set to:  ${i}`)}}if(this.config.enableSettingTrapRelayFqdnCallRegistry?.()){let t=this.callRegistry.getSetup(),i=!!e&&this.config.crossCloudTrapRelayLyncFqdn?.()[e],n=this.shouldSetHomeCloud&&i?i:this.config.slimcoreTrapRelayLyncFqdns?.();n&&(t.setString("Lib/TRAP/Relay/Lync/fqdns",n),this.logger.info(`call registry TRAP Relay Lync FQDN set to:  ${n}`));let a=!!e&&this.config.crossCloudTrapRelaySkypeFqdn?.()[e],r=this.shouldSetHomeCloud&&a?a:this.config.slimcoreTrapRelaySkypeFqdns?.();r&&(t.setString("Lib/TRAP/Relay/Skype/fqdns",r),this.logger.info(`call registry TRAP Relay Skype FQDN set to:  ${r}`))}(this.config.enableSettingTrapRelayFqdnCallRegistry?.()||this.config.enableSettingTrapServiceTokenUrlCallRegistry?.())&&this.callRegistry.getSetup().setNumber("Lib/TRAP/OverwriteDefaultOnly",1)}catch(e){this.logger.error("call registry TRAP URLs weren't set, URL parsing failed or setup object weren't returned.")}}obtainCallRegistry(e){let t=this.enableSlimCoreAccountConfiguration?this._callingAgentsServiceBase.createCallRegistry(e,this.initScenario,!0):this._callingAgentsServiceBase.getCallRegistry();return this.promiseFactory.resolve(t)}addCallRegistrySubscriptions(){this.callRegistrySubscriptions.push(this.callRegistry.on("callAdded",e=>{this.createCallHook&&(this.createCallHook(e),this.config.disableHideActiveCallBanner?.()||this._eventingService.emit(p.gT.events.calling.hideActiveCallBanner,[e])),this.onCallAdded(e)})),this.callRegistrySubscriptions.push(this.callRegistry.on("callRemoved",e=>{this.onCallRemoved(e);let t=e.teamsCallId;t&&this.markLeaveCallScenarioStep(t,y.ck.CallHangupLatency_CallRemovedFromRegistry)})),this.enableGetAuthTokens&&this.callRegistrySubscriptions.push(this.callRegistry.on(T.Sz.TokenRequired,(e,t,i,n)=>this.pushTokenToCallRegistry(T.Sz.TokenRequired,n,e,this.getSupportedTokenTypes(t),i))),this.callRegistrySubscriptions.push(this.callRegistry.on(T.Sz.SkypeTokenRequired,e=>this.pushTokenToCallRegistry(T.Sz.SkypeTokenRequired,e))),this.callRegistrySubscriptions.push(this.callRegistry.on("proxiedPushNotification",e=>{this._eventingService.emit(p.gT.events.calling.proxiedPushNotification,e)})),this.enableCallingServiceInitExtendedTelemetry&&this.initScenario?.appendEventData({addedCallRegistrySubscriptions:!0})}authenticate(){let e=[this._authenticationServiceBase.getUserInformation(!0).catch(e=>{let t=this.stringifyCallingServiceInitError(e);return this.logger.error(`[authenticate] getUserInformation failed: [reason=${t}]`),this.initScenario.mark(y.ck.GetUserInformation,{reason:t},p.gT.scenarioStepStatus.failure),this.promiseFactory.reject(`getUserInformation failed [reason=${t}]`)}),this.getSkypeId().catch(e=>{let t=this.stringifyCallingServiceInitError(e);return this.logger.error(`[authenticate] getSkypeId failed [reason=${t}]`),this.initScenario.mark(y.ck.GetSkypeId,{reason:t},p.gT.scenarioStepStatus.failure),this.promiseFactory.reject(`getSkypeId failed [reason=${t}]`)})];return this.promiseFactory.all(e)}prepareCall(e){let t=this._callingTelemetryServiceBase.newCallingScenario(null,y.RG.PrepareCall),i=e.secondaryScenarios?.find(e=>e.name===p.gT.scenarios.calling.decoupledCall);return this.verifyCallState(e).then(()=>this._conversationsAsyncServiceBase.getCallingConversation(e.conversationId).then(async n=>{this.markScenarioStep(e.scenario,y.ck.CallConversationFetchedPrepareCall,[i,t,...this.secondaryScenariosToBeMarked(e.scenario?.name,e.secondaryScenarios)]);let a=await this.createCall(e.conversationId,n.isOneToOne(),e.callId,e.participantId,e.messageId,void 0,void 0,e.groupId,e.screenSharingOnly,i,e.scenario,e.secondaryScenarios);return this.config.enableTransferCallQueueEarlierCopy?.()&&e.originalCall&&e.originalCall.callQueueInfo&&a.copyCallQueueInfo&&(this.logger.info("Copying call queue info from original call to new call"),a.copyCallQueueInfo(e.originalCall)),t.eventData[p.gT.categories.isScreenshareFromChat]=e.screenSharingOnly,t.eventData[p.gT.categories.isHuddleGroupCall]=e.isAudioDropInCall,t.mark(y.ck.CallCreated),this.commonPostCallCreationSetup(a,t,e.startCallScenarioPromise,e.secondaryScenarios,e.title,e.screenSharingOnly),e.consultationContext&&this._eventingService.emit(p.gT.events.calling.consultCallCreated,{subjectTeamsCallId:e.consultationContext.subjectTeamsCallId,consultCall:a}),e.emergencyPayload&&this.enableEmergencyCallingTesting&&!this.enableEmergencyCallingTestingWithPayload&&(this.logger.debug("Removing emergency payload from call since enableEmergencyCallingTestingWithPayload is not enabled"),e.emergencyPayload=null),this._videoSupportServiceBase.isVideoAvailableForConversation(e.conversationId)&&this._callingSupportServiceBase.isIPVideoModeEnabledByType(n.isOneToOne())||(e.withVideo=!1),e.transferContext&&(a.transferorMri=e.transferContext.transferorMri),this.config.enableDecouplingGroupCallFromChat()&&this.skypeConversationLocalUtils.isLie(e.conversationId)&&n.isGroup()&&this.config.enableDecouplingConvIdFix()&&(e.conversationId=""),e.screenSharingOnly?await this.initCall(a,e,n):this.initCall(a,e,n),a.isApplianceMode=this._survivabilityService.isApplianceMode(),a}))}convertLegacyCallMediaConfig(e){let t=[];return(e.audioDirection===n.MediaDirection.Bidirectional||void 0===e.audioDirection)&&t.push({mediaType:n.MediaType.Audio}),e.audioDirection===n.MediaDirection.Disabled&&t.push({mediaType:n.MediaType.Audio,isDisabled:!0}),(e.videoDirection===n.MediaDirection.Bidirectional||void 0===e.videoDirection&&e.withVideo)&&t.push({mediaType:n.MediaType.Video}),e.videoDirection===n.MediaDirection.Disabled&&t.push({mediaType:n.MediaType.Video,isDisabled:!0}),e.screenshareDirection===n.MediaDirection.SendOnly&&t.push({mediaType:n.MediaType.ScreenShare}),e.screenshareDirection===n.MediaDirection.Disabled&&t.push({mediaType:n.MediaType.ScreenShare,isDisabled:!0}),e.datachannelDirection===n.MediaDirection.Bidirectional&&t.push({mediaType:n.MediaType.Data}),e.datachannelDirection===n.MediaDirection.Disabled&&t.push({mediaType:n.MediaType.Data,isDisabled:!0}),t}initCall(e,t,i,n={configureBroadcastCallInitOptions:()=>{}}){let a={isOneToOneCall:i?.isOneToOne(),isOneToOnePSTNCall:i?.isOneToOnePstn(),isGroupCall:i?.isGroup()};return this.callOptionsFromCoordinatedMeetingsSetting(e,t,a),this.config.enableSurvivabilityV2()&&this._survivabilityService.isApplianceMode()&&i.isOneToOne()&&!i.isOneToOnePstn()&&this._survivabilityService.incrementOfflineAttemptTelemetryCounter(f.B.FallbackFailed),this._survivabilityService.incrementOfflineAttemptTelemetryCounter(f.B.OutgoingCall),this.initCallByType(e,t,i,a,n).catch(i=>{let n=this._callingTelemetryServiceBase.getPrepareCallScenario(),a=this._utilityServiceBase.getErrorLoggingString(i);if(n?.mark(y.ck.InitCall,{callId:e.callId,reason:h.cf.getErrorMessage(i),reasonCMD:a},p.gT.scenarioStepStatus.failure),this._survivabilityService.incrementOfflineAttemptTelemetryCounter(f.B.FailedOutgoingCall),this.config.enableDecouplingGroupCallFromChat()){let i=t.secondaryScenarios?.find(e=>e.name===p.gT.scenarios.calling.decoupledCall);i?.fail({callId:e.callId,reason:"initCall: Outgoing call failed",abortReason:c.Vo.InitFailed})}if(n?.fail(),this.config.handleCallInitErrors()){let t=e?.getIntent();this.failMeetingJoinScenario(t,`join failed: ${a}`)}this.logger.error(`Error initializing call with callId: ${e.callId}: ${a}`),e.abortReason=c.Vo.InitFailed;let r=t.screenSharingOnly?p.gT.scenarios.calling.context.initScreenshareCallFailed:p.gT.scenarios.calling.context.initCallFailed;return this.leaveCall(e,r).then(()=>this.cleanupCall(e))})}updateCommonOptions(e,t,i,n,a){this.logger.info("Updating common call start options");let r=this.updateCommonOptionsInternal(e,t,i,n,a);return this._utilityServiceBase.getPromiseWithTimeout(r,p.fB.thirtySeconds,"updateCommonOptions timed out")}callOptionsFromJoinCallParams(e){let t=this.sanitizeMessage(e.messageId);return{conversationId:e.conversationId,messageId:t,isChannelMeeting:!!t,meetingInfo:e.meetingInfo,callId:e.callId,screenSharingOnly:e.screenSharingOnly,joinType:e.joinType,audioUsageMode:e.audioUsageMode,startCallScenarioPromise:e.startCallScenarioPromise,secondaryScenarios:e.secondaryScenarios,scenario:e?.scenario,captchaContentJson:e?.captchaContentJson}}callOptionsFromCoordinatedMeetingsSetting(e,t,i){if(this._servicesProviderBase.coordinatedMeetingsService().isCoMeAvailable(e)&&!i.isOneToOnePSTNCall){let e=this._servicesProviderBase.coordinatedMeetingsService().getCoMeSettings(),i=!e.audio.value;t.withVideo=e.video.value,t.muted=i,t.mutedSpeakers=i,i&&(t.joinType=m.AH.contentOnly),this.logger.info(`call options settings updated for coordinated meetings mutedmic: ${t.muted} mutedspeaker: ${t.mutedSpeakers} withVideo: ${t.withVideo}`)}return t}async joinCallParamsFromCoordinatedMeetingsSetting(e,t){let i=await this.isOneToOneCall(e,t.conversationId,!0);if(this._servicesProviderBase.coordinatedMeetingsService().isCoMeAvailable(e)&&!i){let e=this._servicesProviderBase.coordinatedMeetingsService().getCoMeSettings(),i=!e.audio.value;t.audioOnly=!e.video.value,t.muted=i,t.mutedSpeakers=i,i&&(t.joinType=m.AH.contentOnly),this.logger.info(`join call param updated for coordinated meetings mutedmic: ${t.muted} mutedspeaker: ${t.mutedSpeakers} withVideo: ${!t.audioOnly}`)}return Promise.resolve(t)}async initAndJoin(e,t,i){t=await this.joinCallParamsFromCoordinatedMeetingsSetting(e,t);let a=this.callOptionsFromJoinCallParams(t),r=this.sanitizeMessage(t.messageId),o=await this.createCallConfiguration(e,t);t?.scenario&&this.markScenarioStep(t.scenario,y.ck.CallConfigCreated,this.secondaryScenariosToBeMarked(t.scenario?.name,t.secondaryScenarios)),await this.initCallAndDetermineUserRole(e,o.initOptions,t.conversationId),i.mark(y.ck.InitCallCompleted),t?.scenario&&this.markScenarioStep(t.scenario,y.ck.OutgoingCallInitCall,this.secondaryScenariosToBeMarked(t.scenario?.name,t.secondaryScenarios));let l=this._callingSupportServiceBase.isIPAudioModeEnabledForCall(e),c=this._callingSupportServiceBase.isIPVideoModeEnabledForCall(e),d={isOneToOneCall:!1,isOneToOnePSTNCall:!1,isGroupCall:!1},g=e.getIntent();if(g?.type!==s.G.Meeting){let e=await this._conversationsAsyncServiceBase.getCallingConversation(a.conversationId);d.isOneToOneCall=e.isOneToOne(),d.isOneToOnePSTNCall=e.isOneToOnePstn(),d.isGroupCall=e.isGroup(),t?.scenario&&this.markScenarioStep(t.scenario,y.ck.CallConversationFetchedCallingServiceInit,this.secondaryScenariosToBeMarked(t.scenario?.name,t.secondaryScenarios))}return this.saveCallSetupArgs(e,{conversationId:t.conversationId,isChannelMeeting:!!r,messageId:r,meetingInfo:t.meetingInfo,withVideo:!t.audioOnly&&c,muted:!!t.muted||!l,mutedSpeakers:!!t.mutedSpeakers||!l,screenSharingOnly:!!t.screenSharingOnly,joinType:t.joinType,audioUsageMode:t.audioUsageMode},d,o.lightweight,t.callUrl),this.addBroadcastInformation(e,a),this.verifyOnlineState(e),(t.audioOnly?this.promiseFactory.resolve(!1):this.getCameraAvailablePromise(e.getIntent())).then(async r=>{i.mark(y.ck.VideoAvailable);let o={withVideo:r&&c,muteFlags:l?(t.muted?n.MuteFlags.MuteMicrophone:0)|(t.mutedSpeakers?n.MuteFlags.MuteSpeaker:0):n.MuteFlags.MuteMicrophone|n.MuteFlags.MuteSpeaker,callQueueContext:a.callQueueContext,captchaContentJson:a.captchaContentJson};if(await this.updateCallStartOptions(o,e,{ipAudioModeEnabled:l,ipVideoModeEnabled:c,screenSharingOnly:t.screenSharingOnly,setScreenSharingSendOnly:!1,meetingInfo:t.meetingInfo}),t?.scenario&&this.markScenarioStep(t.scenario,y.ck.CallStartOptionsUpdated,this.secondaryScenariosToBeMarked(t.scenario?.name,t.secondaryScenarios)),a.withVideo=!t.audioOnly&&c,a.muted=!!t.muted||!l,a.mutedSpeakers=!!t.mutedSpeakers||!l,this.config.enableMeetingJoinForWebinars()&&t&&t.participantRegistrationId&&(o.meetingRegistrationId=t.participantRegistrationId),this.config.enablePresenterJoinUsingUniqueLinks()&&t?.participantPin&&(o.participantPin=t?.participantPin),t.sharedLineCallInvitationContent){"barge"===t.sharedLineCallInvitationContent.sharedLineJoinIntent&&(o.invitationDataJson=JSON.stringify({shouldAddToChatThread:t.shouldAddToChatThread}));let e=JSON.stringify(t.sharedLineCallInvitationContent);o.sharedLineCallInvitationContentJson=e,this.logger.log(`initAndJoin [sharedLineCallInvitationContent = ${e}], [shouldAddToChatThread=${t.shouldAddToChatThread}]`)}return a.shouldSendHigherFrameRateVideo=!!(o?.withVideo&&g?.joinOptions?.shouldSendHigherFrameRateVideo),e.isBeingPreheated()?this.joinPreheatedCall(e,a):e.join({conversationUrl:t.callUrl,conversationId:t.callId},o).then(()=>{t.scenario&&this.markScenarioStep(t.scenario,y.ck.SlimcoreApiJoinSuccess,this.secondaryScenariosToBeMarked(t.scenario?.name,t.secondaryScenarios)),this.logger.infoToTelemetry?.(`join attempt is successful for callId ${t.callId}`,"cmd_join_call_success",void 0,!0)}).catch(e=>{let i=this._utilityServiceBase.getErrorLoggingString(e),n=`join attempt failed with exception ${i}`;this.logger.errorToTelemetry?.(n,"cmd_join_call_failure",{[p.gT.counters.eventNames.callId]:t.callId,[p.gT.counters.eventNames.convUrl]:t.callUrl},!0),t.scenario&&this.markScenarioStep(t.scenario,y.ck.SlimcoreApiJoinFailed,this.secondaryScenariosToBeMarked(t.scenario?.name,t.secondaryScenarios),{context:n})}),this.markMeetingJoinScenario(g,y.ck.SlimcoreApiJoinInvoked),t.scenario&&this.markScenarioStep(t.scenario,y.ck.SlimcoreApiJoinInvoked,this.secondaryScenariosToBeMarked(t.scenario?.name,t.secondaryScenarios),{context:`Call is being Preheated: ${e.isBeingPreheated()}`}),e})}markMeetingJoinScenario(e,t){if(e?.type!==s.G.Meeting||!t)return;this.logger.info(`meeting join => ${t} step `);let i=C.P.resolveCallingScenarios(e,this._loggingServiceBase).mainScenario;i?.mark(t)}failMeetingJoinScenario(e,t){if(e?.type!==s.G.Meeting)return;this.logger.info(`failing meeting join => reason: ${t}`);let i=C.P.resolveCallingScenarios(e,this._loggingServiceBase).mainScenario;i?.fail({reasonCMD:t})}postJoinCall(e,t,i,n){e.then(()=>{t.stop(),i?.scenario&&this.markScenarioStep(i.scenario,y.ck.PostJoinCallInvoked,this.secondaryScenariosToBeMarked(i.scenario?.name))}).catch(e=>{n=n||this.getCallByCallId(i.callId),this._callingTelemetryServiceBase.handleCallFailure(this.promiseFactory.resolve(i?.scenario||t),i?.scenario?[t]:[],e,n);let a=this._utilityServiceBase.getErrorLoggingString(e),r=p.gT.scenarios.calling.context.joinCallFailed;if(!n)return i?.scenario&&this.markScenarioStep(i.scenario,y.ck.NoCallFoundToJoin,this.secondaryScenariosToBeMarked(i.scenario?.name)),this._callingTelemetryServiceBase.newCallingLeaveScenario(i.callId,r).fail({data:"call not found in registry",reasonCMD:a}),this.promiseFactory.reject("Could not leave call, call not found.");if(this.config.handleCallInitErrors()){let e=n?.getIntent();this.failMeetingJoinScenario(e,`join failed: ${a}`)}n?.getStartCallScenario()?.then(e=>{this.markScenarioStep(e,y.ck.PostJoinCallErrored,this.secondaryScenariosToBeMarked(e?.name))}),n.abortReason=c.Vo.JoinFailed,this.leaveCall(n,r,{reasonCMD:a})})}async createCallConfiguration(e,t,i={isMeeting:()=>!1,isBroadcast:()=>!1,configureBroadcastCallInitOptions:()=>{}}){let a=i.isBroadcast(t),r=!i.isMeeting(t)&&await this.isOneToOneCall(e,t.conversationId),o=r?n.MediaPeerType.EnterpriseTwoPartyOnlineOnly:a?n.MediaPeerType.EnterpriseMultiPartyBroadcasting:n.MediaPeerType.EnterpriseMultiParty;this._servicesProviderBase.activeCallsOnEndpointsService?.().activeCallOnDifferentEndpointExists({callId:e.callId,conversationId:t.conversationId,messageId:t.messageId})&&(o=n.MediaPeerType.EnterpriseMultiParty);let s={mediaPeerType:o,threadId:this.getThreadId(t.conversationId,r),messageId:t.messageId,enableGroupCallMeetupGeneration:!!t.enableGroupCallMeetupGeneration,meetingInfo:t.meetingInfo,transferContext:void 0,emergencyContent:void 0};return i.isBroadcast(t)&&i.configureBroadcastCallInitOptions(s),this.logger.infoToTelemetry?.(`createCallConfiguration callParams [mediaPeerType=${s.mediaPeerType}],[messageId=${s?.messageId}],[threadId=${s.threadId}],[meetingInfo organizerId=${t?.meetingInfo?.organizerId}],[meetingInfo meetingType=${t?.meetingInfo?.meetingType}],[intent type=${e.getIntent()?.type}],[intent meetingcode=${e.meetingData?.meetingCode}]`,"cmd_join_call",void 0,!0),{initOptions:s,lightweight:t.lightweight}}async leaveCallInternal(e,t,i,a,r){e.leaveCallContext=t,e.leaveCallReasonCMD=i?.reasonCMD;let{forEveryone:o=!1,forAllUserEndpoints:s=!1}=a??{};o&&(i||(i={}),i.endMeetingForAllParticipants=!0);let l=this._callingTelemetryServiceBase.newCallingLeaveScenario(e,t,i);this.logger.info(`leaving call internal: ${e.teamsCallId}  with call state: ${e.state}`);try{let a=e.state===n.CallState.Connected,c=0===e.participants.length;a&&(c||o)&&this._callingTelemetryServiceBase.newCallingStopScenario(e,t,i);let d=i?.[p.gT.counters.eventNames.reason]||"Hangup";this.getCallDeferred(e).mediaConnectionEstablishedDeferred.reject(d),l.mark(y.ck.ProcessedConnectedCallsHandlingOnLeave),this.finishAllCallScenarios(e,d,"cancel").then(()=>{l?.mark(y.ck.FinishCallEndScenariosMarkingComplete)});let g=e.isEmergencyCall&&e.myRoleInEmergencyCall===u.D.Caller;g&&(l.eventData.isEmergencyCall=!0);let h=(g||o)??!1;e.wasInState(n.CallState.Disconnecting)||!this.disableCallingStopOnAlreadyDisconnectedCall&&e.wasInState(n.CallState.Disconnected)?(e.getStartCallScenario().then(e=>{e.mark(y.ck.ResolveLeaveCallOnDisconnectingDisconnected)}),this.logger.info(`[call][callId=${e.callId}] call.stop NOT being invoked as call is already in disconnecting.`),l.mark(y.ck.CallIsAlreadyInDisconnectingState)):(this.logger.info(`[call][callId=${e.callId}] cleaning up device manager service dependencies`),this._deviceManagerServiceBase.cleanupOnCallDisconnect(),this.logger.infoToTelemetry?.(`[call][callId=${e.callId}][endCallForEveryone=${h}, forAllUserEndpoints=${s}] call.stop is being invoked`,"cmd_stop_call",void 0,!0),this.markLeaveCallScenarioStep(e.teamsCallId,y.ck.CallHangupLatency_CallLeaveTriggered),l.mark(y.ck.SlimcoreApiStopCallInvoked),await e.stop(h,void 0,s?{scope:n.EndpointScope.All}:void 0,r)),this.logger.info(`before stopping call: ${e.teamsCallId} with call state: ${e.state}`),l.appendEventData(this.getTerminationInfo(e,"Success")),l.stop()}catch(r){let t=e?.state===n.CallState.Disconnected,i=e?this.getTerminationInfo(e,t?"Zombie":"Fail"):{[p.gT.counters.eventNames.callLeaveStatus]:"Fail"},a=this._utilityServiceBase.getErrorLoggingString(r);throw this.logger.warn(`[leaveCallInternal] Unexpected exception while disconnecting the call. [call][callId=${e?.callId}][error=${a}]`),l.appendEventData(i),e&&t&&(this.logger.errorToTelemetry?.(`[leaveCallInternal] Failed to leave a disconnected call. [call][callId={${e.callId}}]`,"cmd_stop_call",void 0,!0),this.cleanupCall(e)),l.fail({errorMessage:a}),{error:r,...i}}}async initCallAndDetermineUserRole(e,t,i,a="default",r){await this.initCallAndSetConversationId(e,t,i,r),this._authenticationServiceBase.getUserInformation().then(i=>{let r=a;this._authenticationServiceBase.isAnonymous()?r="anonymous":t.meetingInfo&&t.meetingInfo.tenantId!==i.profile.tid&&(r="b2b"),("unknown"===r||"b2b"===r)&&(0,v.U)(e,e=>{if(e.role)return r="guest"===e.role?"b2b_nonfederated":"b2b_federated",e.state!==n.CallState.Disconnected&&this._callingTelemetryServiceBase.setUserRoleForCall(e,r),!0},!0),e.state!==n.CallState.Disconnected&&(this._callingTelemetryServiceBase.setUserRoleForCall(e,r),this.logger.infoToTelemetry?.(`callingService:initcallAndDetermineUserRole callId: ${e.callId} userRole:${r}`,"cmd_join_call",void 0,!0))})}async initCallAndSetConversationId(e,t,i,n){if(e.isInitialized)this.logger.info("[call][initCall] Call is already initialized, skipping.");else{if(this.sanitizeInitOptions(t,e.getIntent()),this.logger.info(`[call][initCall] meetingInfo=${this._utilityServiceBase.asString(t.meetingInfo)}`),!n?.skipDeviceInitialization&&e.mcaMicDeviceId&&!e.mcaGeometry)try{let t=await this._deviceManagerServiceBase.getMicrophoneArrayGeometryInfo(e.mcaMicDeviceId);e.mcaGeometry=t,this.logger.info(`mcaGeometry with gInfo: ${JSON.stringify(t)} for device ${e.mcaMicDeviceId}`)}catch(t){let e=t.toString();this.logger.warn(`Rejected when getting Microphone Geometry Array Info with: ${e}`)}let i=await this.generateEndpointMetadata(e,n?.consultationContext);i&&(t.endpointMetadata=i),e.init(t),e.isInitialized=!0,this.logger.info(`[call][initCall] Call initialized with skipDeviceInitialization=${n?.skipDeviceInitialization}.`)}e.conversationId=i,n?.skipTransportCompanionInitialization||(this.logger.info("[call][initCall] Starting initForTransportCompanion."),await e.initForTransportCompanion())}verifyCallState(e,t,i={handleOngoingCall:()=>Promise.resolve()}){let a=e.secondaryScenarios?.find(e=>e.name===p.gT.scenarios.calling.decoupledCall);e.scenario?this.markScenarioStep(e.scenario,y.ck.VerifyingCallState,[a,...this.secondaryScenariosToBeMarked(e.scenario?.name,e.secondaryScenarios)]):e.startCallScenarioPromise?.then(t=>{this.markScenarioStep(t,y.ck.VerifyingCallState,[a,...this.secondaryScenariosToBeMarked(t?.name,e.secondaryScenarios)])}),this.state===o.h6.Uninitialized&&this._eventingService.emit(p.gT.events.calling.initializeCalling);let r=this._callingAgentsServiceBase.getCallSupportDetector().getCallSupport(),s=void 0!==r,l=r!==n.CallSupport.Supported;return s&&l?(this.logger.info("VerifyCallState in not supported state {0}",r),this.handleCallingNotPossible(e)):C.P.intentTypeFromConversationIdAsync(e.conversationId,this._conversationsAsyncServiceBase).then(n=>this._callingSupportServiceBase.shouldAllowCalling(n)?this.initDefer.promise.then(()=>{let n=e&&e.meetingInfo?e.meetingInfo.tenantId:void 0;return n&&this.currentTenantId&&this.currentTenantId!==n&&!this.anonymousEnabled?(this._platformDetectServiceBase.isRigel()||this.showB2bUnsupportedDialog(),this.logger.error(`Did not start a meeting in tenant ${n}, current tenant id: ${this.currentTenantId}`),this.promiseFactory.reject({reason:o.hi.B2bCallJoinDisabled})):(this.logger.info("VerifyCallState calling supported state"),i.handleOngoingCall(t,e))},()=>this.handleCallingNotPossible(e)):(this.logger.info("VerifyCallState in calling not allowed state"),this.handleCallingNotPossible(e)))}wasAnsweredElsewhere(e){let t=this.config.disableCQOnly(),i=this.config.enableCQUpdatableToast(),a=t||i&&e.isCallQueue;return this.logger.info(`[wasAnsweredElsewhere] Checking for . [hasData=${e.acceptedElsewhereBy&&e.acceptedElsewhereBy.id?"yes":"no"}]${e.acceptedElsewhereBy?.id?`[answeredBy=${e.acceptedElsewhereBy.id}]`:""}[isToastEnabled=${a}][isEnabledForAllSimRings=${t}][isEnabledForCQ=${i}][callState=${e.state}]`),a&&e.acceptedElsewhereBy&&(e.acceptedElsewhereBy.id||e.acceptedElsewhereBy.displayName)&&e.state===n.CallState.Disconnected}wasMissed(e){let t=this.config.callingEnableMissedCallNotification(),i=_.eU.isMissedCall(e);return this.logger.info(`[wasMissed] [callId=${e.callId}][value=${i?"yes":"no"}][callingEnableMissedCallNotification=${t}][callState=${e.state}]`),t&&i}cleanupCall(e,t={cleanupLocalBroadcastState:e=>null,disposeBroadcastMeeting:e=>{},finalizeCleanup:e=>{}}){try{this.cleanupCallInternal(e,t)}catch(t){e.callDisposedDefer.reject(t),this.raiseCallDisposedEvent(e)}this.callRegistry&&(this.tryAddDisconnectedCall(e),this.callRegistry.deleteCall(e))}unloadCalling(e){return this.callRegistry?!this.enableSlimCoreAccountConfiguration&&this._platformDetectServiceBase.isSurfaceHub()&&!this._platformDetectServiceBase.isElectronAppSurfaceHub()?new Promise(t=>{e.mark(y.ck.CallRegistryUninit),this.callRegistry.uninit().then(t,t)}).catch().then(()=>{this.callRegistry=null}):new Promise(async t=>{e.mark(y.ck.StopSlimcoreTrouter),this.stopSlimCoreTrouter(e),e.mark(y.ck.DisposeCallRegistry);let i=this.callRegistry.dispose(),n=this.config.callRegistryDisposeTimeoutInMs();try{await (0,M.O)(i,`Call registry dispose timed out exceeded ${n}`,n),this._desktopUtilityServiceBase.isSlimCore()?(this.callRegistry=null,t()):(e.mark(y.ck.DisposeCallingStack),this._callingAgentsServiceBase.disposeCallingStack().then(()=>{this.callRegistry=null,t()}))}catch(e){this.callRegistry=null,this.logger.info(`logout of registry failed: ${e}`),t()}}):this.promiseFactory.resolve()}stopOngoingCalls(e=!1,t=!0,i,n){if(!this.callRegistry)return this.promiseFactory.resolve();let a=!this._desktopUtilityServiceBase.isDesktop(),o=this.getOngoingCalls(e,t),s=[];if((0,r.isEmpty)(o))return this.promiseFactory.resolve();let l=i??p.gT.scenarios.calling.context.applicationQuit;o.forEach(e=>{s.push(this.leaveCall(e,l,void 0,void 0,n)),a&&s.push(this.promiseFactory.create(t=>{e.once("statsReported",t)}))});let c=0;return this.promiseFactory.all(s.map(e=>e.then(()=>c++).catch(e=>e))).then(()=>(this._telemetryProviderBase.flush(),c))}trackMediaConnection(e,t){if(e?.callMode===n.CallMode.Streaming)return;let i=y.RG.MediaConnected,a={};e.getIntent()?.type===s.G.Meeting?(i=y.RG.MediaConnectedMeeting,a.isMeetingAcrossTFLTFW=e.isTfwTflInterop):e.isBroadcast&&(i=y.RG.MediaConnectedBroadcast);let r=this._callingTelemetryServiceBase.newCallingScenario(e,i,a);e.setMediaConnectedScenario(r),this.getCallDeferred(e).mediaConnectionEstablishedDeferred.promise.finally(()=>{t?.()})}handleMediaConnectionScenarioIfPossible(e){if(e.isAudioStreamConnected||e.isScreenshareFromChat){this.getCallDeferred(e).mediaConnectionEstablishedDeferred.resolve();let t=e.getMediaConnectedScenario();if(t)return e.isScreenshareFromChat?t.incomplete({reason:"ScreenshareFromChat"}):t.stop(),!0}return!1}onMediaConnectionWhitelistingWarning(e){this.logger.warnToTelemetry?.(`onMediaConnectionWhitelistingWarning: callId = ${e.callId}`,"cmd_media_connection",void 0,!0),this.getCallDeferred(e).mediaWhitelistingIssueRaised=!0}onMediaConnectionFailed(e){let t=this.getCallDeferred(e);if(t.mediaConnected)return;let i=e.getMediaConnectedScenario(),n="Unknown Error",a="fail";i&&(t.mediaWhitelistingIssueRaised&&(n="FailedRelayWhitelisting",a="incomplete"),this._callingTelemetryServiceBase.finishCallScenarios(e,[i],n,a)),this.getCallDeferred(e).mediaConnectionEstablishedDeferred.reject(n)}async saveCallSetupArgsWithConversation(e,t,i,n){let a=await this._conversationsAsyncServiceBase.getCallingConversation(t.conversationId);return this.saveCallSetupArgs(e,t,{isOneToOneCall:a.isOneToOne()},i,n),Promise.resolve()}getCallDeferred(e){let t=this.callDeferred.get(e);if(!t){let i=this.promiseFactory.createDeferred();t={mediaConnected:!1,mediaWhitelistingIssueRaised:!1,mediaConnectionEstablishedDeferred:i},this.callDeferred.set(e,t),i.promise.then(()=>{if(!t)return void this.logger.error("[getCallDeferred] callDeferred is null");t.mediaConnected=!0},()=>{if(!t)return void this.logger.error("[getCallDeferred] callDeferred is null");t.mediaConnected=!1,t.mediaWhitelistingIssueRaised&&e.getMediaConnectedScenario()?.appendEventData({reason:"FailedRelayWhitelisting"})})}return t}setState(e){this.logger.info(`[setState] CallingService - Current state: ${this.state}, New state: ${e}`),this.state=e}checkCallAndGetEmergencyContent(e,t,i){return Promise.resolve(null)}addSlowlaneOverridesToStartOptions(e,t,i){this.config.enableOverflowForMeeting()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.CanSupportOverflow);let a=this.config.meetingOverflowThresholdsOverride();return!t||!t.organizerId||!a||(!a.Threshold||isNaN(a.Threshold))&&(!a.SetupThreshold||isNaN(a.SetupThreshold))||this.isCallAcceptOptions(e,i)?this.promiseFactory.resolve():this._authenticationServiceBase.getUserInformation().then(i=>{if(i.profile.oid===t.organizerId){let t={SlowlaneContent:{}};a.SetupThreshold&&!isNaN(a.SetupThreshold)&&(t.SlowlaneContent.SetupThreshold=a.SetupThreshold),a.Threshold&&!isNaN(a.Threshold)&&(t.SlowlaneContent.Threshold=a.Threshold),e.clientEndpointDebugContent=JSON.stringify(t)}}).catch(e=>{this.logger.error(`[addSlowlaneOverridesToStartOptions] Unable to retrieve userId for slowlane overrides: ${e}`)})}sanitizeMessage(e){return this._chatServiceUtils.isValidId(e)?e:void 0}markLeaveCallScenarioStep(e,t){let i=this._loggingServiceBase.findScenarioByNameAndId(y.RG.CallHangupLatency,e.toString());i?.mark(t)}finishAllCallScenarios(e,t,i){return e.getScenarios().then(n=>{let a=[];n.forEach(e=>a.push(...this.secondaryScenariosToBeMarked(e?.name)));let o=[...(0,r.compact)(n),...(0,r.compact)(a)].filter((e,t,i)=>t===i.findIndex(t=>t.name===e.name));this._callingTelemetryServiceBase.finishCallScenarios(e,o,t,i)})}isMultiVbssSupportedForCallType(e){if(e.isBroadcast||e.callType===n.CallType.P2P)return!1;let t=e.meetingDetails,i=t?.templateDetails?.id;return!(t?.meetingCapability&&this._callingSupportServiceBase.isHostViewModeActive(t.meetingCapability))&&i!==d.CEb.Webinar&&i!==d.CEb.Townhall}initializeStaticSettings(){this.skypeTokenFetchWithTimeoutRemainingCount=this.config.skypeTokenFetchWithTimeoutCount(),this.config.enableUpdateCallingSTMFlagOnECSUpdates()||(this.enableGetAuthTokens=this.config.enableGetAuthTokens())}addClientEndpointCapability(e,t){return e.clientEndpointCapabilities=e.clientEndpointCapabilities?e.clientEndpointCapabilities|t:t}applyBlockPresenterJoinInEventsJoinOption(e,t){let i=t?.getIntent()?.joinOptions,a=i?.context,r=i?.joinEventAsAttendee;"observableCallService"===a||r||this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.blockPresenterJoinInEvents||16384)}addAttendeeToParticipationPreferences(e){return e.participationPreferences={requestedEndpointMeetingRoles:["attendee"]}}addPresentSlideControlJoinOptions(e){this._callingSupportServiceBase.isPresenterSlideControlEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsPresenterSlideControl)}applyImmersiveEventJoinOptions(e){this._callingSupportServiceBase.isImmersiveEventJoinAllowed()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsImmersiveModeV2)}sanitizeInitOptions(e,t){this._chatServiceUtils.isValidId(e.messageId||"")||!t||t.type!==s.G.Meeting||t.coordinates.joinType!==l.c.Legacy||t.coordinates.isChannel||(e.messageId=o.c1);let i=e.meetingInfo?.replyChainMessageId||"";i&&!this._chatServiceUtils.isValidId(i)&&t&&t.type===s.G.Meeting&&t.coordinates.joinType===l.c.Legacy&&delete e.meetingInfo?.replyChainMessageId}getTerminationInfo(e,t){let i=e.terminatedReason,n=e.callEndDiagnosticsInfo||e.participants[0]&&e.participants[0].callEndDiagnosticsInfo,a=n&&n.callControllerCode,r=n&&n.callControllerSubCode;return{[p.gT.counters.eventNames.terminatedReason]:i,[p.gT.counters.eventNames.callControllerCode]:a,[p.gT.counters.eventNames.callControllerSubCode]:r,[p.gT.counters.eventNames.callLeaveStatus]:t}}isGlobalCallingStackInitialized(){return this._callingAgentsServiceBase.getState()===I.v.Initialized&&this.state===o.h6.Initialized}whenCallRegistryCreated(){return this.enableOfflineCallingAuth?this.whenCallRegistryCreatedWithOfflineSupport():this.whenCallRegistryCreatedOnlineOnly()}whenCallRegistryCreatedOnlineOnly(){return this._retryService.retry("createCallRegistry",()=>{if(this._appStateService.isOnline)return this.createCallRegistry(this.initScenario);this.initScenario.pause({reason:p.gT.scenarios.calling.context.applicationOffline});let e=this.waitForAppOnline();return e.catch().then(()=>this.initScenario.resume()),e.then(()=>this.createCallRegistry(this.initScenario))},{retryIntervals:this.config.callingInitRetryIntervals()}).promise}addSyncCientEndpointCapabilities(e,t){let i=this._callingSupportServiceBase.isBreakoutRoomsFeatureSupported();i&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.CanSupportBreakOutRoom),i&&this._callingSupportServiceBase.isBreakoutRoomMoveWithoutInviteEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsBreakoutRoomMoveWithoutInvite),this._callingSupportServiceBase.isBreakoutRoomsSelfSelectEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsBreakoutRoomDistributions),this._callingSupportServiceBase.isE2EEMeetingEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.e2eEncryptionEnabled),this._callingSupportServiceBase.isLiveEventsUnificationEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsStreaming),this._callingSupportServiceBase.isPresenterJoinsForEventsBlocked()&&this.applyBlockPresenterJoinInEventsJoinOption(e,t)}async updateCommonOptionsInternal(e,t,i,a,r){r&&this.addAttendeeToParticipationPreferences(e),this.addSyncCientEndpointCapabilities(e,a),this._callingSupportServiceBase.isTrackingInReportAllowed()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.allowTrackingInReport),this._callingSupportServiceBase.isPlazaParticipantsEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsParticipantMapping),this.checkSLAv2Available()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.SupportsSharedLineAppearanceV2),this._callingSupportServiceBase.isMdpAudioRecordingSupported()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsMdpAudioRecording),this._callingSupportServiceBase.isPresenterCapabilitiesReductionSupported()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsPresenterCapabilitiesReduction),this._callingSupportServiceBase.isRaiseHandForStreamingSupported()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsStreamingPromotion),this._callingSupportServiceBase.isTownhallNudgeSupported()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsNudgeFromStreamingIntoRealTime),this._callingSupportServiceBase.isLobbyChatAttendeeJoinEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsLobbyChat),this._callingSupportServiceBase.isSupportReactionsEnabled()&&this.addClientEndpointCapability(e,n.ClientEndpointCapabilities.supportsReactions),this.applyMultiVbssOptions(e,a),this.applyImmersiveEventJoinOptions(e),this.addPresentSlideControlJoinOptions(e),this.addAdditionalEndpointPropertiesToPayload(e),await this.addSlowlaneOverridesToStartOptions(e,t,i)}markCallJoinPartialFailure(e,t){if(!t)return;this.logger.error(`Partial failure while joining call: ${e}`);let i=C.P.resolveCallingScenarios(t,this._loggingServiceBase).mainScenario;i&&(i.mark(y.ck.PartialJoinFailure),i.appendEventData({errorCMD:e}))}getCallingSupport(){return this._callingAgentsServiceBase.getCallSupportDetector().getCallSupport()}get enableHandleAuthErrorsInCSI(){return this.config.enableHandleAuthErrorsInCSI?.()}get authErrorMessagesInCSI(){return this.config.authErrorMessagesInCSI?.()}get disableHandleAuthErrorCodesInCSI(){return this.config.disableHandleAuthErrorCodesInCSI()}get authErrorCodesInCSI(){return this.config.authErrorCodesInCSI()}get enableHandleAuthInnerErrorCodesInCSI(){return this.config.enableHandleAuthInnerErrorCodesInCSI()}get authInnerErrorCodesInCSI(){return this.config.authInnerErrorCodesInCSI()}get enableCallingServiceInitExtendedTelemetry(){return this.config.enableCallingServiceInitExtendedTelemetry()}async skypeTokenProvider(e=!1){let t=this.enableOfflineCallingAuth,i="",n=`Token fetch exceeded ${this.config.skypeTokenFetchTimeoutInMs()} milliseconds`;try{let e=this.enableGetAuthTokens?Promise.resolve(""):this._authenticationServiceBase.getSkypeToken(void 0,t);this.skypeTokenFetchWithTimeoutRemainingCount>0&&this.config.enableSkypeTokenFetchWithTimeout()?(this.skypeTokenFetchWithTimeoutRemainingCount=this.skypeTokenFetchWithTimeoutRemainingCount-1,i=await (0,M.O)(e,n,this.config.skypeTokenFetchTimeoutInMs())):i=await e}catch(r){this.logger.error(`tokenProvider for CallRegistry failed ${r}`);let i=this.config.enableSkypeTokenFetchWithTimeout()&&"string"==typeof r&&r.includes(n),a=!!e&&(i||this.errorHasKnownAuthError(r));if(t||a)return"";return Promise.reject(r)}return i}errorHasKnownAuthError(e){let t=!1;if(this.enableHandleAuthErrorsInCSI){let i=this.authErrorMessagesInCSI.some(t=>e.message?.includes(t));t=t||i}if(!this.disableHandleAuthErrorCodesInCSI){let i=this.authErrorCodesInCSI.some(t=>e.errorCode?.includes(t));t=t||i}if(this.enableHandleAuthInnerErrorCodesInCSI){let i=this.authInnerErrorCodesInCSI.some(t=>e.innerError?.code?.includes(t));t=t||i}return t}reportInit(){if(this.initScenario)return void this.logger.error("Init called multiple times in the same session");this.initScenario=this._callingTelemetryServiceBase.newCallingInitScenario(),this.enableOfflineCallingAuth&&(this.initScenario.eventData.enableOfflineCallingAuth=!0),this.initDefer.promise.then(()=>this.initScenario.stop()).catch(e=>{this.logger.error("calling_service_init scenario canceled/failed");let t=h.cf.getErrorMessage(e,this.logger,[...h.cf.DEFAULT_PROPS_GET_ERROR_MSG,"callingServiceState","callingAgentsService"]);this.callingSupport!==n.CallSupport.BrowserNotSupported||this.isDesktop?this.initScenario.fail({[p.gT.counters.eventNames.reason]:t}):this.initScenario.cancel({[p.gT.counters.eventNames.reason]:t})})}addMembersToCall(e,t){let i=this._sxConfigBase.getCurrentSkypeMri(),n=t.length<3?t.filter(e=>e.id!==i):[];e.originalCalleeMri=1===n.length?n[0].id:null,t.forEach(t=>{t.id!==i&&e.addParticipant(t.id)})}pushTokenToCallRegistry(e,t,i,n,a,r){let o=this._loggingServiceBase.newScenario(y.RG.CallingUpdateToken),s=this.config.tierZeroCallingAndMeetingScenarios(),l=[];s.forEach(e=>{let t=this._loggingServiceBase.findScenario(e);t&&l.push(t)});let c=this._sxConfigBase.getCurrentSkypeMri(),d=this._utilityServiceBase.stripMriPrefix(c),g=a?.causeId||this._utilityServiceBase.generateUUID();o.appendEventData({reason:e,correlationId:g,reasonCMD:n?n.join(","):[]}),l.forEach(e=>e.appendEventData({causeId:`calling_update_token:${g}`}));let h=n?.map(e=>T.Zw[e]).join(",");this.logger.info(`pushAuthTokenToCallRegistry: Received token request with preferred token types ${h} for factorsJson ${this.extractFactorsPath(i)}, causeId: ${g}, causeId provided by requestor: ${a?.causeId!==void 0}.`);let p=this.enableGetAuthTokens&&e===T.Sz.TokenRequired,u=e===T.Sz.TokenRequired||e===T.Sz.SkypeTokenRequired;if(u&&o.mark(y.ck.RequestingTokenFromAuth,{reason:e}),!p)return this.pushSkypeTokenToCallRegistry(e,d,g,u,o,t,r);if(!i)throw Error("factorsJson is required for new token flow");return this.pushAuthTokenToCallRegistry(e,d,g,u,o,n||[],i,t,a,r)}pushAuthTokenToCallRegistry(e,t,i,a,r,o,s,l,c,d){if(!this.callingServiceHelpers||!this.callingServiceHelpers.getSupportedToken)throw Error("callingServiceHelpers is not initialized");let g=c?.authenticationHeaders?.[0]||void 0;return this.callingServiceHelpers.getSupportedToken(o,i,this._desktopUtilityServiceBase?.isPluginless()?T.io.Pluginless:T.io.Slimcore,g,this.isTokenForcedRefreshedEnabled()?d?.forceRefresh:void 0,this.isTokenForcedRefreshedEnabled()&&d?.forceRefresh?l:void 0).then(h=>{this.markScenarios(a,e,r);let{passedValidation:u,transactionEnd:m,errorMessage:_}=this.validateToken(h,o,l);if(!u){if(this.isTokenForcedRefreshedEnabled()&&m?.subCode===p.Od.NEW_TOKEN_MATCHES_INVALID_TOKEN&&!d?.forceRefresh)return this.logger.info("pushAuthTokenToCallRegistry: refreshed skype token matches invalid token. Retrying with forceRefresh."),this.pushAuthTokenToCallRegistry(e,t,i,a,r,o,s,l,c,{refreshedSkypeToken:d?.refreshedSkypeToken,forceRefresh:!0});throw this.callRegistry.updateToken(s,{error:m},"",i),Error(_)}return this.initDefer.promise.then(()=>{this.callRegistry.updateToken(s,{tokenType:h.type},h.token,i,h.expires);let a=g&&g.includes("insufficient_claims")?"contains claims challenge":"doesn't contain claims challenge",l=o?.map(e=>T.Zw[e]).join(",");this.logger.info(`pushAuthTokenToCallRegistry: successfully updated ${n.TokenType[h.type]} token for user ${t} in tenant ${this.currentTenantId}, preferredTokenTypes: ${l}, causeId: ${i}, force refresh: ${d?.forceRefresh}.`),r.mark(y.ck.PushedTokenToRegistry),r.appendEventData({reason:e,type:h.type.toString(),context:a,reasonCMD:o.join(","),correlationId:i,contextId:this.extractFactorsPath(s),isRetry:d?.forceRefresh??!1})}).then(()=>this.setAccountConfiguration(i,r))}).catch(t=>this.handleTokenFailure(t,e,o??[],i,s,r,d?.forceRefresh??!1))}pushSkypeTokenToCallRegistry(e,t,i,a,r,o,s){let l=s?.forceRefresh??!1;return(s?.refreshedSkypeToken&&!l?Promise.resolve(s?.refreshedSkypeToken):this._authenticationServiceBase.getSkypeToken(this.isTokenForcedRefreshedEnabled()?s?.forceRefresh:void 0,this.enableOfflineCallingAuth)).then(l=>{if(this.markScenarios(a,e,r),""===l)throw Error(`Received empty skype token from auth for user ${t} in tenant ${this.currentTenantId}. Force refresh: ${s?.forceRefresh}.`);if(o&&(o===l||o===`Bearer ${l}`))if(this.isTokenForcedRefreshedEnabled()&&!s?.forceRefresh)return this.logger.info("pushSkypeTokenToCallRegistry: refreshed skype token matches invalid token. Retrying with forceRefresh."),this.pushSkypeTokenToCallRegistry(e,t,i,a,r,o,{refreshedSkypeToken:s?.refreshedSkypeToken,forceRefresh:!0});else throw Error(`Received invalid skype token for user ${t} in tenant ${this.currentTenantId}. Force refresh: ${s?.forceRefresh}.`);return this.initDefer.promise.then(()=>{let a=n.TokenType.Skype;if(!l)throw Error("Token is unexpectedly undefined or null");this.callRegistry.updateSkypeToken(l),this.logger.info(`pushTokenToCallRegistry: successfully updated ${n.TokenType[n.TokenType.Skype]} token for user ${t} in tenant ${this.currentTenantId}, causeId: ${i}, force refresh: ${s?.forceRefresh}.`),r.mark(y.ck.PushedTokenToRegistry),r.appendEventData({reason:e,type:a.toString(),context:"claims challenge not applicable",reasonCMD:"skype",correlationId:i,isRetry:s?.forceRefresh??!1})}).then(()=>this.setAccountConfiguration(i,r))}).catch(t=>this.handleTokenFailure(t,e,[],i,"factors json not applicable",r,s?.forceRefresh??!1))}markScenarios(e,t,i){e&&i.mark(y.ck.TokenReceivedFromAuth),t===p.gT.events.skypeAuth.tokenRefreshed&&i.mark(y.ck.SkypeAuthTokenRefreshed)}setAccountConfiguration(e,t){this.enableSlimCoreAccountConfiguration?this.applyAccountConfig().then(()=>{this.logger.info(`pushTokenToCallRegistry: set account configuration to callRegistry succeeded, causeId: ${e}`),t.stop()}).catch(i=>{let n=this._utilityServiceBase.getErrorLoggingString(i);this.logger.error(`pushTokenToCallRegistry: set account configuration to callRegistry failed with error ${n}, causeId: ${e}`),t.fail({errorMessage:n})}):t.stop()}handleTokenFailure(e,t,i,n,a,o,s){let l=`${this._utilityServiceBase.getErrorLoggingString(e)},
    isReloginRequired: ${this._appStateService.isReloginRequired}`,c=this.enableGetAuthTokens&&t===T.Sz.TokenRequired,d={reason:t,reasonCMD:t===T.Sz.TokenRequired?i.join(","):"skype",errorMessage:l,correlationId:n,contextId:this.extractFactorsPath(a),isRetry:s};if(this.config.enableSTMAuthErrorHandlingInCalling()&&c){let t,i=(0,r.get)(e,"isExpected"),s=(0,r.get)(e,"errorCode")??"";i?(t=s.includes("InteractionRequired")?{code:p.Sg.CLIENT_ERROR,subCode:p.Od.INTERACTION_REQUIRED,phrase:p.re.INTERACTION_REQUIRED}:{code:p.Sg.CLIENT_ERROR,subCode:p.Od.AUTH_FAILURE,phrase:p.re.AUTH_FAILURE},this.callRegistry.updateToken(a,{error:t},"",n),o.incomplete({...d,isExpected:!0,isInteractionRequired:!!s.includes("InteractionRequired")})):o.fail({...d,isExpected:!1}),l=`${l}, is expected failure: ${i}`}else{let t=(0,r.get)(e,"errorCode");"NetworkOffline"===t||"NoNetwork"===t?o.incomplete(d):o.fail(d)}this.logger.error(`pushTokenToCallRegistry: failed with error ${l}`),this.getAllCallsFromRegistry().forEach(e=>{let t=e.getIntent()?.mainScenario;if(t){let e=this._loggingServiceBase.findScenarioByNameAndId(t.name,t.clientId);e?.mark(y.ck.TokenFailed,{reasonCMD:l,causeId:n})}})}extractFactorsPath(e){if(e)try{let t=JSON.parse(e);if((0,r.has)(t,"path"))return t.path}catch(e){this.logger.error("extractFactorsPath: failed to parse factorsJson.")}return"factors json not applicable"}validateToken(e,t,i){let a=this._sxConfigBase.getCurrentSkypeMri(),r=this._utilityServiceBase.stripMriPrefix(a);if(1===t.length){let i=this.getSupportedTokenTypes(e.type)[0];if(!t.includes(i))return{passedValidation:!1,transactionEnd:{code:p.Sg.CLIENT_ERROR,subCode:p.Od.CLIENT_DOES_NOT_SUPPORT_TOKEN_TYPE,phrase:p.re.CLIENT_DOES_NOT_SUPPORT_TOKEN_TYPE},errorMessage:`Client does not support preferred token type(s) ${T.Zw[t[0]]} for user ${r} in tenant ${this.currentTenantId}.`}}if(""===e.token)return{passedValidation:!1,transactionEnd:{code:p.Sg.CLIENT_ERROR,subCode:p.Od.EMPTY_TOKEN,phrase:p.re.EMPTY_TOKEN},errorMessage:`Received empty ${e.type} token from auth for user ${r} in tenant ${this.currentTenantId}`};if(this.isTokenForcedRefreshedEnabled()&&e.type===n.TokenType.Cae);else if(i&&(i===e.token||i===`Bearer ${e.token}`)){let t=`Current time: ${Date.now()}. Token expiration: ${e.expires}`;return{passedValidation:!1,transactionEnd:{code:p.Sg.CLIENT_ERROR,subCode:p.Od.NEW_TOKEN_MATCHES_INVALID_TOKEN,phrase:p.re.NEW_TOKEN_MATCHES_INVALID_TOKEN},errorMessage:`Received invalid ${e.type} token for user ${r} in tenant ${this.currentTenantId}. ${t}`}}return{passedValidation:!0}}getMsaAccountConfig(){return{clientType:"none",applicationType:"TFL",ring:this.config.ringId()}}getCurrentRoutingTable(){return this._geoRoutingService.getCurrentRoutingTableAsync?this._geoRoutingService.getCurrentRoutingTableAsync():this.promiseFactory.resolve(this._geoRoutingService.getCurrentRoutingTable())}async getAadAccountConfig(e){let t,i={},n=this.config.ringId(),a=await this.getCurrentRoutingTable();if(this.enableCallingServiceInitExtendedTelemetry&&this.initScenario?.appendEventData({gotCurrentRoutingTable:!0}),a&&this.config.convServiceOverrideUrl()&&(a.calling_conversationServiceUrl=this.config.convServiceOverrideUrl(),a.calling_callControllerServiceUrl=this.config.convServiceOverrideUrl()),!e){for(let e in a)Object.prototype.hasOwnProperty.call(a,e)&&e.startsWith("calling_")&&(i[e]=a[e]);this.lastGoodServiceUrls=0===Object.keys(i).length?this.lastGoodServiceUrls:i}return this.enableIndiaPhoneSystemSupport&&a?.regionOverride&&(t=a?.regionOverride,this.logger.info(`[getAadAccountConfig] regionOverride=${t}`)),this.enableCallingServiceInitExtendedTelemetry&&this.initScenario?.appendEventData({gotAadAccountConfig:!0}),{clientType:"enterprise",...void 0!==n&&{ring:n},tenantId:this.currentTenantId,region:a&&a.regionName||"",partition:a&&a.partition||"",serviceUrls:this.lastGoodServiceUrls,...t&&{regionOverride:t}}}setSlimCoreAriaCollector(e){if(!e.serviceUrls?.hasOwnProperty(k))return void this.logger.warn(`[setSlimCoreAriaCollector] SETUPKEY_ARIA_COLLECTOR_URI could not be set since ${k} is missing from serviceUrls`);this.shouldSetSlimCoreAriaCollector()&&this.callRegistry.getSetup().setString(p.Ui,e.serviceUrls[k])}shouldSetSlimCoreAriaCollector(){return this.enableGeoRoutingForSlimcoreTelemetry&&!this.config.enableCallingInTfl()&&!this._desktopUtilityServiceBase.isPluginless()&&this._desktopUtilityServiceBase.isDesktop()}shouldSetPluginlessAriaCollector(e){return e.serviceUrls?.hasOwnProperty(P)&&this.enableGeoRoutingForPluginlessTelemetry&&!this.config.enableCallingInTfl()&&this._desktopUtilityServiceBase.isPluginless()}shouldMigrateCallRegistryEcsConfig(){return this._desktopUtilityServiceBase.isSlimCore()}initCallingWithToken(){let e=this.hasMinVersionForSTM();this.enableGetAuthTokens&&this.hasMinVersionForSTM&&this.enableInitCallingWithAadToken&&!this.enableStmDebugUseCaeTokenOnly&&this.pushTokenToCallRegistry(T.Sz.TokenRequired,"",`{"path":"${this.csaEndpointAddress}","verb":"POST"}`,[T.Zw.AAD],{authenticationHeaders:[""]}),this.enableGetAuthTokens&&e&&this.enableInitCallingWithCaeToken&&!this.enableStmDebugUseAadTokenOnly&&this.pushTokenToCallRegistry(T.Sz.TokenRequired,"",`{"path":"${this.csaEndpointAddress}","verb":"POST"}`,[T.Zw.CAE],{authenticationHeaders:[""]})}async onSkypeTokenRefreshedAfterRevocation(e){this.logger.info(`SkypeToken refreshed after revocation. State=${e}`);let t=this._loggingServiceBase.findScenario(y.RG.SkypeTokenRevocation)||this._loggingServiceBase.newScenario(y.RG.SkypeTokenRevocation);e&&t.appendEventData({context:""===e?"onTokenRefresh":"AuthStateChanged",message:`State is ${e}`}),this.isResendRegistrationEnabled()&&this.pushTokenToCallRegistry(p.gT.events.skypeAuth.tokenRefreshedAfterRevocation),this.isResendRegistrationEnabled()||this.config.enableResendRegistrationAfterTokenRevocation?.()?(this.logger.info("Invoking resendRegistration API"),await this._callingAgentsServiceBase.resendRegistration(t,this._utilityServiceBase.generateUUID())):t.incomplete({reasonCMD:p.gT.scenarios.calling.skypeTokenRevocationSteps.resendRegistrationNotEnabled})}hasMinVersionForSTM(){return this._desktopUtilityServiceBase.isPluginless()?this._callingAgentsServiceBase.hasTokenApiMinPluginlessVersion?.():this._callingAgentsServiceBase.hasTokenApiMinSlimcoreVersion?.()}getSupportedTokenTypes(e){let t=[];return this.enableStmDebugUseCaeTokenOnly?[T.Zw.CAE]:this.enableStmDebugUseAadTokenOnly?[T.Zw.AAD]:((e&n.TokenType.Cae)>0&&t.push(T.Zw.CAE),(e&n.TokenType.Aad)>0&&t.push(T.Zw.AAD),(e&n.TokenType.Skype)>0&&t.push(T.Zw.Skype),t)}stringifyCallingServiceInitError(e){let t=e;(0,r.has)(t,"prevError")&&(t=t.prevError);let i=typeof t,n=`[errorType=${i}]`;switch(i){case"object":n+=`[errorMessage=${t.message}][errorStack=${t.stack}]`;break;case"function":n+=`[error=${t.toString()}]`;break;case"undefined":n+="[error=UndefinedCallingServiceInitError]";break;default:n+=`[error=${t}]`}return this._utilityServiceBase.getErrorLoggingString(n,void 0,!1)}convertToHomeCloud(e){if(e&&this.config.crossCloudMediaProxyAllowedClouds?.()?.includes(e))switch(e){case T.G7.prod:return n.HomeCloud.PROD;case T.G7.gcch:return n.HomeCloud.GCCHIGH;case T.G7.dod:return n.HomeCloud.DOD}}async initCallByType(e,t,i,n,a={configureBroadcastCallInitOptions:()=>{}}){if(this.config.enableDecouplingGroupCallFromChat()){let i=t.secondaryScenarios?.find(e=>e.name===p.gT.scenarios.calling.decoupledCall);i?.stop({callId:e.callId,context:"initCallByType"})}return e.getIntent()?.type===s.G.Meeting?this.initCallFromCallOptions(e,t,n,a.configureBroadcastCallInitOptions):(this.isEchoBotCallEnabled&&t.isEchoBotCall||i.alive(),t.isAudioDropInCall&&(t.participantsToNudge=[],await this.addParticipantsToNudge(i,t.participantsToNudge)),this.logger.info(`[call][initCallByType]: populate members for call, ringOthers=${t.ringOthers}`),await this.populateMembers(i,e,t.ringOthers),t.startCallScenarioPromise?.then(i=>{let n={callerMriPresence:e.hasOwnProperty("currentUserSkypeIdentity")&&e.currentUserSkypeIdentity?.id?.length>0,calleeMriPresence:e.originalCalleeMri?.length>0};this.markScenarioStep(i,y.ck.ValidateMri,this.secondaryScenariosToBeMarked(i?.name,t.secondaryScenarios),n)}),(this.isDirectCallInitEnabled(n)?this.initCall_WithoutWaitingForRealConversation(e,t,n,i,a.configureBroadcastCallInitOptions):this.initCall_WaitForRealConversation(e,t,n,i,a.configureBroadcastCallInitOptions)).catch().then(()=>{i.dispose()}))}enrichPrepareCallScenario(e,t){let i=this._callingTelemetryServiceBase.getCommonEventData(t);e.appendEventData(i),e.mark(y.ck.InitCallGetConversation)}async copyVTCOutCallDetails(e,t){e.isVideoTeleConferencingCall=!0;let i=JSON.parse(t.invitationData||"");await e.updateVtcUserDisplayName?.(i?.vtcOutCallDetails?.url),e.sipMeetingUrl=i?.vtcOutCallDetails?.url,e.sipMeetingPasscode=i?.vtcOutCallDetails?.passcode,e.sipMeetingDeviceMetadata=i?.vtcOutCallDetails?.deviceMetadata,e.sipMeetingCorrelationId=i?.vtcOutCallDetails?.correlationId,e.sipMeetingType=i?.vtcOutCallDetails?.meetingType,this.logger.info(`InvitationData found in callOptions - invitationData vtcOutCallDetails url isPresent=${!!i?.vtcOutCallDetails?.url} , invitationData vtcOutCallDetails passcode isPresent=${!!i?.vtcOutCallDetails?.passcode},
        invitationData vtcOutCallDetails deviceMetadata isPresent=${!!i?.vtcOutCallDetails?.deviceMetadata} , invitationData vtcOutCallDetails meetingType=${i?.vtcOutCallDetails?.meetingType} , invitationData vtcOutCallDetails correlationId=${i?.vtcOutCallDetails?.correlationId} `)}initCallFromCallOptions(e,t,i,a){let r=t.conversationId;this.config.enableMultilineCalling?.()&&(e.outgoingAlternateId=t.alternateId||null);let o=this._callingTelemetryServiceBase.getPrepareCallScenario();return o&&this.enrichPrepareCallScenario(o,e),this.logger.info("[call] real conversation is = {0}",r),this.saveCallSetupArgs(e,t,i),this.addBroadcastInformation(e,t),(t.withVideo?this.getCameraAvailablePromise(e.getIntent(),i):Promise.resolve(!1)).then(async l=>{o?.mark(y.ck.InitCallDetails);let c=await this.getMediaPeerType(e,t,i);this.logger.info(`Setting media peer type to = ${c}`);let d=this.sanitizeMessage(t.messageId),g=e.getIntent(),h=g?.type===s.G.Meeting&&g?.coordinates.isAdhoc,u=!!(t.isChannelMeeting&&h),m={mediaPeerType:c,threadId:this.getThreadId(r,i.isOneToOneCall),messageId:d,enableGroupCallMeetupGeneration:u&&!d,meetingInfo:!u||this.config.alwaysPassMeetingInfo?.()?t.meetingInfo:null,emergencyContent:t.emergencyPayload,transferContext:t.transferContext,onBehalfOf:t.onBehalfOf,onBehalfOfUserDisplayName:t.onBehalfOfUserDisplayName,isEmergency:!this.disableEmergencyGroupCall&&!!t.emergencyPayload&&this._servicesProviderBase.emergencyService().isGroupEmergencyCallNeeded()};t.emergencyPayload&&(this.logger.info(`Populating mixin for emergency call [call][callId=${e.callId}]`),this._servicesProviderBase.emergencyService().populateEmergencyCallForCaller(e,t.alternateId)),e.isBroadcast&&a(m),this.isEchoBotCallEnabled&&t.isEchoBotCall&&(m.enableGroupCallMeetupGeneration=!1),await this.initCallAndDetermineUserRole(e,m,r,void 0,{consultationContext:i.isOneToOneCall&&t.consultationContext}),o?.mark(y.ck.InitCallInitialization,{onBehalfOf:m.onBehalfOf}),this.verifyOnlineState(e),t.audioUsageMode&&e.setAudioUsageMode(t.audioUsageMode);let _=this._callingSupportServiceBase.isIPAudioModeEnabledByType(i.isOneToOneCall),S=this._callingSupportServiceBase.isIPVideoModeEnabledByType(i.isOneToOneCall),C={ringOthers:!!t.ringOthers&&!t.isAudioDropInCall,withVideo:l&&S&&t.withVideo,muteFlags:_?(t.muted?n.MuteFlags.MuteMicrophone:0)|(t.mutedSpeakers?n.MuteFlags.MuteSpeaker:0):n.MuteFlags.MuteMicrophone|n.MuteFlags.MuteSpeaker,isHuddleGroupCall:t.isAudioDropInCall??void 0,callQueueContext:t.callQueueContext,alternateId:t.alternateId};o?.appendEventData({[p.gT.categories.isHuddleGroupCall]:t.isAudioDropInCall,[p.gT.counters.eventNames.ringOthers]:C.ringOthers}),!this.config.enableCallingInTfl()&&this.config.enableTfwTflCallingFederation?.()&&t.targetApplicationType&&t.targetApplicationType!==n.TargetApplicationType.NONE&&(C.targetApplicationType=t.targetApplicationType,this.logger.info(`targetApplicationType set to ${t.targetApplicationType}`)),this.avoidSendingTitleAsSubject||(C.label=t.title),this.config.enableEndpointHint()&&this.isFederatedOrSfbConversation(t.conversationId)&&(C.routingFlags=["preferSfB"],this.logger.info("prefer SFB flag set")),await this.updateCallStartOptions(C,e,{ipAudioModeEnabled:_,ipVideoModeEnabled:S,screenSharingOnly:t.screenSharingOnly,setScreenSharingSendOnly:!t.isFromRejoin,meetingInfo:t.meetingInfo}),o?.mark(y.ck.UpdatedCallStartOptions),t.isEchoBotCall&&(C.scenario="UserInitiatedTestCall"),this.config.enableMeetingJoinForWebinars()&&t&&t.participantRegistrationId&&(C.meetingRegistrationId=t.participantRegistrationId),this.config.enablePresenterJoinUsingUniqueLinks()&&t?.participantPin&&(C.participantPin=t?.participantPin);let{withVideo:v,muted:f}=C;this.logger.info(`Initializing call - outgoingAudio: ${!f}, outgoingVideo: ${v}`),t.invitationData&&(C.invitationDataJson=t.invitationData,C.withVideo=!0,this.copyVTCOutCallDetails(e,t)),t.meetingGroups&&(C.meetingGroups=t.meetingGroups),this.config.enableMeetingJoinCaptchaVerification?.()&&t.captchaContentJson&&(C.captchaContentJson=t.captchaContentJson),t.shouldSendHigherFrameRateVideo=C?.withVideo&&g?.joinOptions?.shouldSendHigherFrameRateVideo;let b=e.isBeingPreheated()?this.joinPreheatedCall(e,t):t.isAudioDropInCall?e.startCallWithNudge(t.participantsToNudge,C):e.start(C);if(this.markMeetingJoinScenario(g,y.ck.SlimcoreApiJoinInvoked),o?.mark(y.ck.InitCallStarted,{callId:e.callId,conversationId:r}),u){let a=e.changed(()=>{e.messageId?(t.messageId=e.messageId,this.saveCallSetupArgs(e,t,i),a.dispose()):e.state===n.CallState.Disconnected&&a.dispose()})}if(this.completePrepareCallScenario(b,o),!this.config.handleCallInitErrors()||e.getIntent()?.type!==s.G.Meeting)return b})}async completePrepareCallScenario(e,t){try{await e,t?.stop()}catch(i){let e=this._utilityServiceBase.getErrorLoggingString(i);return this.logger.error(`Prepare call failed with: ${e}`),t?.fail({reasonCMD:e}),Promise.reject(i)}}initCall_WaitForRealConversation(e,t,i,n,a){return n.getId().then(n=>(this.logger.info("[call] real conversation is = {0}",n),t.conversationId=n,this.initCallFromCallOptions(e,t,i,a)))}initCall_WithoutWaitingForRealConversation(e,t,i,n,a){return this.initCallFromCallOptions(e,t,i,a).then(()=>{let t=this._callingTelemetryServiceBase.newCallingScenario(e,y.RG.UpdateRealConversationId,{callId:e.callId,teamsCallId:e.teamsCallId,conversationId:e.conversationId});return n.getId().then(i=>{e.getIntent()?.type!==s.G.Meeting&&(this.logger.info(`[RetryThreadCreation]  Received real conversation id: ${i}, updating call: ${e.callId}`),e.conversationId=i,t.stop({realConversationId:i}))}).catch(e=>{this.logger.error(`[RetryThreadCreation]  Failed to get real conversation id, could not update call: ${e?.message}, statusCode: ${e?.statusCode}`),t.fail({reasonCMD:e?.message,statusCode:e?.statusCode})})})}isDirectCallInitEnabled(e){return this.config.enableDelayedConversationInit()&&(e.isOneToOneCall||e.isGroupCall&&this.config.enableDecouplingGroupCallFromChat())}populateMembers(e,t,i){return i?e.whenMembersArePopulated().then(e=>this.addMembersToCall(t,e)):this.promiseFactory.resolve()}addParticipantsToNudge(e,t){return e.whenMembersArePopulated().then(e=>{e.forEach(e=>{let i=this._sxConfigBase.getCurrentSkypeMri();e.id!==i&&t.push(e.id)})})}isAnyCallParticipantPSTN(e){if((0,r.isNull)(e)||(0,r.isEmpty)(e))return!1;let t=this._sxConfigBase.getCurrentSkypeMri(),i=!1;return e.forEach(e=>{e.id!==t&&this._chatServiceUtils.isPstnMri(e.id)&&(i=!0)}),i}tryAddDisconnectedCall(e){let t=e.wasInState(n.CallState.Notified,!1),i=e.wasInState(n.CallState.Connected,!1),a=this.config.delayRemoveRecentP2PDisconnectedCallsNotInRegistryInMs();if(a&&t&&!i&&!this.recentP2PDisconnectedCallsNotInRegistry.includes(e)&&e.teamsCallType===n.CallType.P2P){this.logger.info(`[tryAddDisconnectedCall] incoming call notified but never connected, add to disconnected calls array. callId=${e.callId}`),this.recentP2PDisconnectedCallsNotInRegistry.push(e);let t=this.webApiService.timeout.set(()=>{this.recentP2PDisconnectedCallsNotInRegistry=this.recentP2PDisconnectedCallsNotInRegistry?.filter(t=>t!==e),this.logger.info(`[tryAddDisconnectedCall] call deleted from disconnected calls array callId=${e.callId}`),this.recentP2PDisconnectedCallsNotInRegistryTimeoutTokens=this.recentP2PDisconnectedCallsNotInRegistryTimeoutTokens?.filter(e=>e!==t)},a);this.recentP2PDisconnectedCallsNotInRegistryTimeoutTokens.push(t)}}cleanupCallInternal(e,t={cleanupLocalBroadcastState:e=>null,disposeBroadcastMeeting:e=>{},finalizeCleanup:e=>{}}){let i,a=this.getCallDeferred(e),o=!(0,r.isUndefined)(e.failureType)&&e.failureType!==n.FailureType.Undefined,s=e.isAborted();this.finishAllCallScenarios(e,`call.failureType: ${String(e.failureType)}`);let l=e.getIntent();if(this.markCallIntentAsFulfilled(e),this.getActiveCall()||this._callingTelemetryServiceBase.setLoggingContext(null),this.onDisconnectSurfaceHub1(e,o,s),a.mediaConnectionEstablishedDeferred.reject("disconnected"),e.canBeRetried()||this._freemiumUtilities.shouldShowUpsellScreen()){if(e.setupArgs.failureType=e.failureType,e.wasInState(n.CallState.Connected)){let t=e.isMuted||!this._callingSupportServiceBase.isIPAudioModeEnabledForCall(e),i=e.isVideoOn&&this._callingSupportServiceBase.isIPVideoModeEnabledForCall(e),n=e.isSpeakerMuted||!this._callingSupportServiceBase.isIPAudioModeEnabledForCall(e);e.setupArgs.muted=t,e.setupArgs.withVideo=i,e.setupArgs.mutedSpeakers=n,l&&(l.joinOptions.incomingAudio=!n,l.joinOptions.outgoingAudio=!t,l.joinOptions.outgoingVideo=i)}this.setTerminationInfo(e,a),e.isScreenSharingOn&&this.restoreWindow()}else i=t.cleanupLocalBroadcastState(e);this._activeCallsServiceBase.markCallAsEndedLocally(e),(e.terminatedReason===n.TerminatedReason.CallNotFound||e.terminatedReason===n.TerminatedReason.CallDoesNotExist)&&this._activeCallsServiceBase.markCallAsEnded(e.conversationId,e.callId);let c=this.addCallQuestionnaire(e,i);this._mutedCallNotificationsServiceBase.removeCall(e),this.wasAnsweredElsewhere(e)?(this.logger.info("Incoming Call Cleanup: delaying dismissal of notification to allow for answered elsewhere toast to be visible."),this.webApiService.timeout.set(()=>this.dismissIncomingCallNotification(e.teamsCallId),4e3)):this.dismissIncomingCallNotification(e.teamsCallId),this.deleteCallSubscriptions(e),e.isScreenSharingOn&&e.stopScreenSharingOnCall(p.gT.scenarios.calling.context.callDisconnected),this._giveTakeControlServiceBase?.hasSubscription(e)&&this._giveTakeControlServiceBase.stopSubscription(e),this.callDeferred.delete(e),delete this.forwardingJoinEventTrackerForCall[e.teamsCallId],e.broadcastMeeting&&t.disposeBroadcastMeeting(e);let d=this._servicesProviderBase.transportAgentService();if(d){let t=d.getTransportCallKeeper();t&&t.removeRingingCallFromNotification(e)}this._callingSupportServiceBase.cleanupSlimcoreEcsFlags(),t.finalizeCleanup(e),this._platformDetectServiceBase.isRigel()&&c?c.finally(()=>{this.raiseCallDisposedEvent(e)}):this.raiseCallDisposedEvent(e)}markCallIntentAsFulfilled(e){let t=e.getIntent();if(!(!t||this.config.handleCallInitErrors()&&!e.wasJoinAttempted)&&(this.config.handleCallInitErrors()||e.wasInState(n.CallState.Connecting))&&(t.isFulfilled=!0,t.id)){let e=this.getIntentFromIntentStore?.(t.id);e&&e!==t&&(e.isFulfilled=!0,this.logger.warnToTelemetry?.(`Intents stored on multiWindow and call have diverged, updating both, id: ${t.id}, context: ${t.joinOptions?.context}`,"cmd_join_call",void 0,!0))}}raiseCallDisposedEvent(e){e.callDisposedDefer.resolve(),this._eventingService.emit(p.gT.events.calling.callDisposed,e),this._objectLeaksDetector.track("call",e),this.logger.info(`Call disposed callId: ${e.callId}, teamsCallId: ${e.teamsCallId}`)}cleanupCallRegistry(){this.callRegistry=void 0,this.uninitDefer=void 0}deleteCallSubscriptions(e){this.logger.info(`delete call subscriptions for ${e.callId}`),(0,r.remove)(this.callSubscriptionRegistry,t=>t.call===e).forEach(e=>e.subscription?.dispose())}async getMediaPeerType(e,t,i){if(!this.disableEmergencyGroupCall&&t.emergencyPayload&&this._servicesProviderBase.emergencyService().isGroupEmergencyCallNeeded()||t.screenSharingOnly)return n.MediaPeerType.EnterpriseMultiParty;if(t&&t.meetingInfo&&t.meetingInfo.isBroadcast)return n.MediaPeerType.EnterpriseMultiPartyBroadcasting;if(this.isEchoBotCallEnabled&&t.isEchoBotCall||!i.isOneToOneCall)return n.MediaPeerType.EnterpriseMultiParty;let a=this._servicesProviderBase.transportAgentService(),r={conversationId:e.conversationId};return i.isOneToOnePSTNCall&&a&&await a.isConnectedToTransportEndpointForConversation(r)?n.MediaPeerType.EnterprisePstnHybrid:this.config.callingEnableLegacyMediaPeerType()?i.isOneToOnePSTNCall?n.MediaPeerType.EnterprisePstnHybrid:n.MediaPeerType.EnterpriseUnknown:i.isOneToOnePSTNCall?n.MediaPeerType.EnterprisePstnOnlineOnly:n.MediaPeerType.EnterpriseTwoPartyOnlineOnly}async isOneToOneCall(e,t,i){if(e.getIntent()?.type===s.G.Meeting)return!1;let n=await this._conversationsAsyncServiceBase.getCallingConversation(t);return i?n.isOneToOnePstn():n.isOneToOne()}isCallAcceptOptions(e,t){return!!t}async addParticipantPropertyBag(e){this.config.enableAiInterpretedVoiceInitOnCallStart?.()&&(e.participantPropertyBag={aiVoiceConsent:{value:{aiVoiceConsentValue:this._callingSupportServiceBase.getAiInterpreterVoiceConsentValue()},sequenceNumber:0}})}processAlternateId(e,t){let i=this._callingSupportServiceBase.getUserPrimaryPhoneNumber();if(!e&&this.isAnyCallParticipantPSTN(t)&&i){let e=this._pstnNumberService.generateMriForPstn(i);return this.logger.log(`processAlternateId - alternateId is undefined for PSTN call. Setting alternateId as ${e}`),e}return e}addAdditionalEndpointPropertiesToPayload(e){if(this._callingSupportServiceBase.isInfoShownInReportModeSupported()){e.additionalEndpointProperties={};let t=this._callingSupportServiceBase.getAdditionalEndpointProperties();t&&(e.additionalEndpointProperties=t)}}logErrorAndMarkStep(e,t,i){this.config.disableAddStepNameToErrorInCallingService()||"object"!=typeof t||t.name&&"Error"!==t.name||(t.name=`${i} failure`);let n=this.stringifyCallingServiceInitError(t);e.mark(i,{reason:n},p.gT.scenarioStepStatus.failure)}}},181837:function(e,t,i){i.d(t,{U:()=>p});var n=i(370574),a=i(892891),r=i(310735),o=i(167135),s=i(575810),l=i(63230),c=i(200669),d=i(223708),g=i(777016),h=i(377957);class p{constructor(e,t,i,n,a,r,o,s,c){this.config=e,this.ariaLiveService=t,this.callTransferService=i,this.call=n,this.callParkService=a,this.appStateService=r,this.identityService=o,this.localizationService=s,this.localized=c,this.props={None:{icon:"",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-none"},Connecting:{icon:"icons-call-participant-connecting",getDescriptionTitle:()=>this.localized.callingConnectingString(),getDescriptionText:()=>"",className:"call-connecting"},LongConnecting:{icon:"icons-call-participant-connecting",getDescriptionTitle:()=>this.localized.callingLongConnectingString(),getDescriptionText:()=>"",className:"call-connecting"},Connected:{icon:"",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-connected"},Ringing:{icon:"",getDescriptionTitle:()=>this.localized.callingRingingString(),getDescriptionText:()=>"",className:"call-none"},"2pLocalHold":{icon:"icons-call-participant-onhold",getDescriptionTitle:()=>this.localized.callingHoldLocalUiMessage1To1Call(),getDescriptionText:()=>this.localized.ariaAnnounceCallOnHold(),className:"call-onhold"},npLocalHold:{icon:"icons-call-participant-onhold",getDescriptionTitle:()=>this.localized.callingHoldLocalUiMessageNpCall(),getDescriptionText:()=>this.localized.callingHoldLocalUiMessageNpCall(),className:"call-onhold"},"2pRemoteHold":{icon:"icons-call-participant-onhold",getDescriptionTitle:()=>this.localized.callingHoldRemoteUiMessage(),getDescriptionText:()=>this.localized.callingHoldRemoteUiMessage(),className:"call-onhold"},Disconnected:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingScreenEndedString(),getDescriptionText:()=>"",className:"call-ended"},DisconnectedCall:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingScreenCallEnded(),getDescriptionText:()=>"",className:"call-ended"},DisconnectedCallFromHidDevice:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingScreenCallEndedFromHidDevice(),getDescriptionText:()=>"",className:"call-ended"},DisconnectedMeetingFromHidDevice:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingScreenMeetingEndedFromHidDevice(),getDescriptionText:()=>"",className:"call-ended"},DisconnectedScreenshareCall:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingScreenShareEnded(),getDescriptionText:()=>"",className:"call-ended"},NotRegisteredParticipant:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingUnregisteredUserMessage(),hyperLinkInTitle:"",getDescriptionText:()=>"",className:"call-ended"},UnAuthorizedWebinarParticipant:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingUnauthorizedUserMessage(),getDescriptionText:()=>"",className:"call-ended"},Failed:{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.isMeeting()?this.localized.callingCallFailed():this.isIncomingCall?this.localized.callingEndScreenIncomingCallRetryTitle():this.localized.callingEndScreenOutgoingCallRetryTitle(),getDescriptionText:()=>this.isMeeting()?"":this.isIncomingCall?this.localized.callingEndScreenRetryDescriptionGenericErrorIncomingCall():this.localized.callingEndScreenRetryDescriptionGenericErrorOutgoingCall(),className:"call-ended"},FailedMeeting:{icon:"",iconStardust:"",getDescriptionTitle:()=>this.localized.callingMeetingConnectionError(),getDescriptionText:()=>this.localized.callingMeetingConnectionErrorDescription(),className:"call-ended"},FailedScreenshareCall:{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingShareFailed(),getDescriptionText:()=>"",className:"call-ended"},FailedDueToPstnRoutingPolicy:{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingCallFailed(),getDescriptionText:()=>this.localized.callingCallFailedDueToPstnRoutingPolicyDescription?.()||"",className:"call-ended"},FailedDueToInteractionNotAllowed:{icon:"",getDescriptionTitle:()=>this.localized.callingCallFailed(),getDescriptionText:()=>this.localized.callingCallFailedDueToInteractionNotAllowedDescription?.()||"",className:"call-ended"},FailedDueToPstnNotPermitted:{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingCallFailed(),getDescriptionText:()=>this.localized.callingCallFailedDueToPstnNotPermittedDescription?.()||"",className:"call-ended"},Reconnecting:{icon:"icons-call-missed-line-filled",iconStardust:"call-missed-line",getDescriptionTitle:()=>this.localized.callingHoldOnMessageCallingScreen(),getDescriptionText:()=>this.localized.callingHoldOnDescriptionCallingScreen(),className:"call-reconnecting"},"2pReconnecting":{icon:"icons-call-missed-line-filled",iconStardust:"call-missed-line",getDescriptionTitle:()=>this.localized.callingHoldOnMessageCallingScreen(),getDescriptionText:()=>this.localized.callingHoldOnDescription2PCallingScreen(),className:"call-reconnecting"},"2pReconnectingScreenshareCall":{icon:"icons-call-missed-line-filled",iconStardust:"call-missed-line",getDescriptionTitle:()=>this.localized.callingHoldOnMessageCallingScreen(),getDescriptionText:()=>this.localized.screenshareCallingHoldOnDescription2PCallingScreen(),className:"call-reconnecting"},UnresolvedConversation:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingCallDoesntExistAnymore(),getDescriptionText:()=>"",className:"call-ended"},UnresolvedConversationScreenshareCall:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingScreenshareCallDoesntExistAnymore(),getDescriptionText:()=>"",className:"call-ended"},Leaving:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callParticipantLeavingState(),getDescriptionText:()=>"",className:"call-ended"},LBRError:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingStateLbrError(),getDescriptionText:()=>"",className:"call-ended"},CallHasNoActiveNetworkInterface:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingCallHasNoActiveNetworkInterface(),getDescriptionText:()=>"",className:"call-ended"},CallConnectionError:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingCallHasNoActiveNetworkInterface(),getDescriptionText:()=>"",className:"call-ended"},CallConnectionErrorMeeting:{icon:"",iconStardust:"",getDescriptionTitle:()=>this.localized.callingMeetingConnectionError(),getDescriptionText:()=>this.localized.callingMeetingConnectionErrorDescription(),className:"call-ended"},CallingPolicyError:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingStateCallFailedError(),getDescriptionText:()=>this.localized.callingStateCallingPolicyError(),className:"call-ended"},"2pNetworkReconnectError":{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingCallDroppedTitleCallingScreen(),getDescriptionText:()=>this.localized.callingCallDroppedDescription2PCallingScreen(),className:"call-ended-network-reconnect"},"2pNetworkReconnectScreenshareCallError":{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingCallDroppedTitleCallingScreen(),getDescriptionText:()=>this.localized.callingScreenshareCallDroppedDescription2PCallingScreen(),className:"call-ended-network-reconnect"},NetworkReconnectError:{icon:"icons-call-missed-line-filled",iconStardust:"call-missed-line",getDescriptionTitle:()=>this.localized.callingCallDroppedTitleCallingScreen(),getDescriptionText:()=>this.localized.callingCallDroppedDescriptionCallingScreen(),className:"call-ended-network-reconnect"},Declined:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callParticipantDeclinedState(),getDescriptionText:()=>"",className:"call-ended"},NotReachable:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callParticipantNotReachableState(),getDescriptionText:()=>this.localized.callParticipantNotReachableExplanation(),className:"call-ended"},Forwarding:{icon:"icons-call-participant-connecting",getDescriptionTitle:()=>this.localized.callingForwardingString(),getDescriptionText:()=>"",className:"call-connecting"},Parking:{icon:"icons-call-park",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-transferring"},ParkFailed:{icon:"icons-call-participant-failed",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-transfer-failed"},ParkSucceeded:{icon:"icons-call-participant-connected",getDescriptionTitle:()=>this.localized.callingCallParkSucceeded(),getDescriptionText:()=>"",className:"call-transfer-succeeded"},Holding:{icon:"icons-call-participant-onhold",getDescriptionTitle:()=>this.localized.callingCallHoldingSucceeded(),getDescriptionText:()=>"",className:"call-onhold"},HoldingFailed:{icon:"icons-call-participant-onhold",getDescriptionTitle:()=>this.localized.callingCallHoldingSucceeded(),getDescriptionText:()=>"",className:"call-onhold"},HoldingSucceeded:{icon:"icons-call-participant-onhold",getDescriptionTitle:()=>this.localized.callingCallHoldingSucceeded(),getDescriptionText:()=>"",className:"call-onhold"},Transferring:{icon:"icons-call-transfer-notification",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-transferring"},TransferFailed:{icon:"icons-call-participant-failed",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-transfer-failed"},TransferSucceeded:{icon:"icons-call-participant-connected",getDescriptionTitle:()=>this.localized.callingTransferSucceeded(),getDescriptionText:()=>"",className:"call-transfer-succeeded"},Escalating:{icon:"icons-call-participant-connecting",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-escalating"},EscalatingScreenshareCall:{icon:"icons-call-participant-connecting",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-escalating"},EscalationFailed:{icon:"icons-call-participant-failed",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-escalation-failed"},EscalationSucceeded:{icon:"icons-call-participant-connected",getDescriptionTitle:()=>this.localized.callingEscalationSucceeded(),getDescriptionText:()=>"",className:"call-escalation-succeeded"},ScreenshareCallEscalationSucceeded:{icon:"icons-call-participant-connected",getDescriptionTitle:()=>this.localized.screenshareCallingEscalationSucceeded(),getDescriptionText:()=>"",className:"call-escalation-succeeded"},KickedFromCall:{icon:"icons-call-blocked",iconStardust:"call-blocked",getDescriptionTitle:()=>this.localized.callingYouWereRemoved(),getDescriptionText:()=>this.localized.callingYouWereRemovedDescription(),className:"call-ended"},KickedFromScreenshareCall:{icon:"icons-call-blocked",iconStardust:"call-blocked",getDescriptionTitle:()=>this.localized.screenshareCallingYouWereRemoved(),getDescriptionText:()=>this.localized.screenshareCallingYouWereRemovedDescription(),className:"call-ended"},KickedFromMeeting:{icon:"",getDescriptionTitle:()=>this.localized.callingYouWereRemovedFromMeeting(),getDescriptionText:()=>this.localized.callingYouWereRemovedFromMeetingDescription(),className:"call-ended"},KickedFromExternalMeeting:{icon:"",getDescriptionTitle:()=>this.localized.callingYouWereRemovedFromExternalMeeting(),getDescriptionText:()=>"",className:"call-ended"},KickedFromBreakoutRoom:{icon:"icons-call-blocked",iconStardust:"call-blocked",getDescriptionTitle:()=>this.localized.callingYouWereRemovedFromBreakoutRoom(),getDescriptionText:()=>this.localized.callingYouWereRemovedFromBreakoutRoomDescription(),className:"call-ended"},KickedFromBreakoutRoomByTimer:{icon:"icons-call-blocked",iconStardust:"call-blocked",getDescriptionTitle:()=>this.localized.callingYouWereRemovedFromBreakoutRoomByTimer(),getDescriptionText:()=>this.localized.callingYouWereRemovedFromBreakoutRoomByTimerDescription(),className:"call-ended"},InLobbyWithPresenterConnected:{icon:"",getDescriptionTitle:()=>"",getDescriptionText:()=>this.localized.callingInLobbyWithPresenterConnected(),className:"call-inlobby"},InLobbyWithNoPresenterConnected:{icon:"",getDescriptionTitle:()=>"",getDescriptionText:()=>this.localized.callingInLobbyWithNoPresenterConnected(),className:"call-inlobby"},DeniedFromLobby:{icon:"icons-dnd",iconStardust:"ban",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingScreenDeniedFromLobby(),getDescriptionText:()=>"",className:"call-denied-from-lobby"},NotAllowedToJoinBreakoutRoom:{icon:"",iconStardust:"",getDescriptionTitle:()=>this.localized.callingBreakoutRoomsRetryScreenNotAllowedToJoinTitle(),getDescriptionText:()=>this.localized.callingBreakoutRoomsRetryScreenNotAllowedToJoinDescription(),className:"call-ended"},MeetingIsInvalidOrExpired:{icon:"",iconStardust:"",getDescriptionTitle:()=>this.localized.callingMeetingInvalidOrExpiredRetryScreenTitle(),getDescriptionText:()=>this.localized.callingMeetingInvalidOrExpiredRetryScreenDescription(),className:"call-ended"},MeetingLifetimeExceededFailure:{icon:"",iconStardust:"",getDescriptionTitle:()=>this.localized.callingMeetingLifetimeExceededFailureScreenTitle(),getDescriptionText:()=>this.localized.callingMeetingLifetimeExceededFailureScreenDescription(),className:"call-ended"},OverflowStreamingSetupError:{icon:"icons-call-end",iconStardust:"call-end",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageOverflowStreamingCreationError(),getDescriptionText:()=>this.localized.errorMessageOverflowStreamingCreationErrorDescription(),className:"call-ended"},OverflowStreamingIncompatibleClient:{icon:"icons-call-blocked",iconStardust:"call-blocked",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageOverflowStreamingIncompatibleClient(),getDescriptionText:()=>this.localized.errorMessageOverflowStreamingIncompatibleClientDescription(),className:"call-ended"},BlockPresenterJoinsForEventsError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageBlockPresenterJoinsForEventsTitle(),getDescriptionText:()=>this.localized.errorMessageBlockPresenterJoinsForEventsDescription(),className:"call-ended"},ImmersiveEventUnsupportedClientJoinError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageUnsupportedClientImmersiveEventJoinTitle(),getDescriptionText:()=>this.localized.errorMessageUnsupportedClientImmersiveEventJoinDescription(),className:"call-ended"},TooEarlyImmersiveEventJoinError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageTooEarlyImmersiveEventJoinTitle(),getDescriptionText:()=>this.localized.errorMessageTooEarlyImmersiveEventJoinDescription(),className:"call-ended"},OverflowStreamingNoAllowedForLobbyMeetingError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageOverflowStreamingLobbyNotAllowed(),getDescriptionText:()=>"",className:"call-ended"},DisabledLobbyEventError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageDisabledLobby(),getDescriptionText:()=>"",className:"call-ended"},UniquePresenterLinkUsageExhaustedError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageUniquePresenterLinkUsageExhausted(),getDescriptionText:()=>"",className:"call-ended"},UniquePresenterLinkMaxUsersAlreadyInMeetingError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageUniquePresenterLinkMaxUsersAlreadyInMeeting(),getDescriptionText:()=>"",className:"call-ended"},UniquePresenterLinkFailedDueToLobbyPolicyError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageUniquePresenterLinkFailedDueToLobbyPolicy(),getDescriptionText:()=>"",className:"call-ended"},UniquePresenterLinkPinMismatchError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageUniquePresenterLinkPinMismatch(),getDescriptionText:()=>"",className:"call-ended"},WebinarAttendeeJoinLinkUsageExhaustedError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageWebinarAttendeeJoinLinkUsageExhausted(),hyperLinkInTitle:"",getDescriptionText:()=>"",className:"call-ended"},TownhallAnonJoinBeforeEventStartedError:{icon:"",getDescriptionTitle:()=>this.localized.errorMessageTownhallAnonJoinBeforeEventStarted(),getDescriptionText:()=>"",className:"call-ended"},MeetingIsFull:{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.errorMessageMeetingFullJoinFailure(),getDescriptionText:()=>this.localized.errorMessageMeetingFullJoinFailureDescription(),className:"call-ended"},MeetingJoinBlockedByPolicy:{icon:"",getDescriptionTitle:()=>this.localized.callingMeetingJoinBlockedByPolicyRetryScreen(),getDescriptionText:()=>"",className:"call-ended"},MeetingBlockForXlByBreakoutRooms:{icon:"icons-call-blocked",iconStardust:"call-blocked",getDescriptionTitle:()=>this.localized.callingBreakoutRoomsXlMeetingsFull(),getDescriptionText:()=>"",className:"call-ended"},NotAdmittedForLongTime:{icon:"",getDescriptionTitle:()=>this.localized.callingScreenNotAdmittedForLongTime(),getDescriptionText:()=>"",className:"call-not-admitted-for-long"},Aborted:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-ended"},AnonymousJoinDisabledByPolicy:{icon:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingAnonymousJoinDisabledByPolicyTitle(),getDescriptionText:()=>this.localized.callingAnonymousJoinDisabledByPolicyMessage(),className:"call-ended",descriptionTextContainsHtml:!0},LobbyIsFull:{icon:"icons-call-missed-line",iconStardust:"call-missed-line",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingLobbyIsFull(),getDescriptionText:()=>"",className:"call-ended"},BroadcastLimitReached:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.errorMessageBroadcastLimitReached(),getDescriptionText:()=>this.localized.errorMessageBroadcastLimitReachedDesc(),className:"call-ended"},Busy:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callParticipantBusyState(),getDescriptionText:()=>this.localized.callParticipantBusyExplanation(),className:"call-ended"},NoLobbyForBroadcastJoin:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.errorMessageNoLobbyForBroadcast(),getDescriptionText:()=>this.localized.errorMessageNoLobbyForBroadcastDesc(),className:"call-ended"},InformationBarrierPresent:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingJoinFailureDueToInformationBarrier(),getDescriptionText:()=>"",className:"call-ended"},MeetingTransferred:{icon:"icons-call-transferred",getDescriptionTitle:()=>this.localized.callingMeetingTransferred(),getDescriptionText:()=>"",className:"call-transferred"},MeetingTransferredRTL:{icon:"icons-call-transferred-rtl",getDescriptionTitle:()=>this.localized.callingMeetingTransferred(),getDescriptionText:()=>"",className:"call-transferred"},CallTransferred:{icon:"icons-call-transferred",getDescriptionTitle:()=>this.localized.callingCallTransferred(),getDescriptionText:()=>"",className:"call-transferred"},CallTransferredRTL:{icon:"icons-call-transferred-rtl",getDescriptionTitle:()=>this.localized.callingCallTransferred(),getDescriptionText:()=>"",className:"call-transferred"},Retry:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>"",getDescriptionText:()=>this.localized.callParticipantRetryExplanation(),className:"call-ended"},ComplianceRecordingDisconnectedError:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingCallFailedComplianceRecordingDisconnected(),getDescriptionText:()=>this.localized.callingCallFailedComplianceRecordingDisconnectedDescription(),className:"call-ended"},ComplianceRecordingJoinError:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingCallFailedComplianceRecordingJoin(),getDescriptionText:()=>this.localized.callingCallFailedComplianceRecordingJoinDescription(),className:"call-ended"},ComplianceRecordingE2EEJoinError:{icon:"",iconStardust:"",useOutlineIcon:!0,getDescriptionTitle:()=>this.localized.callingCallFailedComplianceRecordingE2EEJoin&&this.localized.callingCallFailedComplianceRecordingE2EEJoin()||"Your organizational policy does not allow you to join this meeting",getDescriptionText:()=>this.localized.callingCallFailedComplianceRecordingE2EEJoinDescription&&this.localized.callingCallFailedComplianceRecordingE2EEJoinDescription()||"This meeting is end-to-end encrypted, please contact your meeting organizer to participate in the meeting.",className:"call-ended"},MeetingLocked:{icon:"icons-lock",iconStardust:"lock",getDescriptionTitle:()=>this.localized.callingAlertMeetingLockedTitle(),getDescriptionText:()=>this.localized.callingAlertMeetingLockedDescription(),className:"call-ended"},InvalidMeetingCode:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>"",getDescriptionText:()=>this.localized.callingInvalidMeetingCodeDescription(),className:"call-ended"},JoinExternalMeetingDisabledByPolicy:{icon:"",iconStardust:"",getDescriptionTitle:()=>this.localized.callingJoinExternalMeetingDisabledByPolicy(),getDescriptionText:()=>"",className:"call-ended"},TownhallLimitReached:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.errorMessageTownhallLimitReached(),getDescriptionText:()=>this.localized.errorMessageTownhallLimitReachedDesc(),className:"call-ended"},DeniedExternalMeetingJoin:{icon:"",iconStardust:"",getDescriptionTitle:()=>this.localized.callingScreenDeniedExternalMeetingJoinTitle(),getDescriptionText:()=>this.localized.callingScreenDeniedExternalMeetingJoinDescription(),className:"call-ended"},DeniedExternalMeetingJoinExternalCommOff:{icon:"",iconStardust:"",getDescriptionTitle:()=>"",getDescriptionText:()=>"",className:"call-ended"},DeniedMeetingJoinCaptchaVerificationFailed:{icon:"",getDescriptionTitle:()=>this.localized.callingScreenDeniedMeetingJoinCaptchaVerificationFailedTitle(),getDescriptionText:()=>this.localized.callingScreenDeniedMeetingJoinCaptchaVerificationFailedDescription(),className:"call-ended"},DeniedMeetingJoinCaptchaVerificationFailedSolutionEmpty:{icon:"",getDescriptionTitle:()=>this.localized.callingScreenDeniedMeetingJoinCaptchaVerificationFailedSolutionEmptyTitle(),getDescriptionText:()=>this.localized.callingScreenDeniedMeetingJoinCaptchaVerificationFailedSolutionEmptyDescription(),className:"call-ended"},CallDrop:{icon:"icons-call-end",iconStardust:"call-end",getDescriptionTitle:()=>this.localized.callingEndScreenRetryTitleCallDrop(),getDescriptionText:()=>this.localized.callingEndScreenRetryDescriptionCallDrop(),className:"call-ended"}},this.setDescriptionTitle=(e,t)=>this.props[e].getDescriptionTitle=()=>t,this.setHyperLinkInTitle=(e,t)=>this.props[e].hyperLinkInTitle=t,this.isDialInOnCallFailuresEnabled=e.enableDialInOnCallFailures(),this.enableCallTransferredScreen=e.enableCallTransferredScreen(),this.useConfigToShowCustomizedTenantErrorMessageForJoins=e.useConfigToShowCustomizedTenantErrorMessageForJoins(),this.customizedErrorMessageTenantExceptionListForJoins=e.customizedErrorMessageTenantExceptionListForJoins()||[],this.enableMeetingJoinCaptchaVerification=this.config.enableMeetingJoinCaptchaVerification(),this.enableV2RetryScreenForMeetings=e.enableV2RetryScreenForMeetings(),this.initTelemetryContexts(),this.callTransferServiceSubscription=i.subscribe(()=>this.onCallTransferStateChanged(),d.q5.CallTransferStateChanged,h.w.getTeamsCallIdAsString(n.teamsCallId)),this.callParkServiceSubscription=a.subscribe(()=>this.onCallParkStateChanged(),l.CH.CallParkStateChanged,h.w.getTeamsCallIdAsString(n.teamsCallId)),this.extendedCallStateChangedSubscription=n.on("extendedCallStateChanged",()=>this.onExtendedCallStateChanged()),this.onExtendedCallStateChanged(),this.isIncomingCall=!!this.call.extendedIncomingCallType,this.enableHandleInteractionNotAllowedInCalls=this.config.enableHandleInteractionNotAllowedInCalls()}dispose(){this.extendedCallStateChangedSubscription.dispose(),this.callTransferService.unsubscribe(this.callTransferServiceSubscription),this.callParkService.unsubscribe(this.callParkServiceSubscription)}getCallingStateProps(){switch(this.call.extendedCallState){case g.T.Aborted:return this.getProp("Aborted");case n.CallState.None:break;case n.CallState.Notified:return this.getProp("Ringing");case n.CallState.Connecting:case n.CallState.EarlyMedia:return this.call.forwardingDestinationType?this.getProp("Forwarding"):this.getProp("Connecting");case n.CallState.Connected:return this.call.teamsCallType===n.CallType.P2P&&this.call.origin&&this.call.origin===n.CallOrigin.Park?this.getProp("2pRemoteHold"):this.getProp("Connected");case n.CallState.InLobby:return this.getInLobbyProps();case n.CallState.LocalHold:return this.call.teamsCallType===n.CallType.P2P?this.getProp("2pLocalHold"):this.getProp("npLocalHold");case n.CallState.Observing:if(this.call.isServerHold)return this.getProp("2pLocalHold");break;case n.CallState.RemoteHold:return this.call.teamsCallType===n.CallType.P2P?this.getProp("2pRemoteHold"):this.getProp("None");case n.CallState.Disconnecting:return this.getDisconnectingProps();case n.CallState.Disconnected:return this.getDisconnectedProps();case g.T.Reconnecting:if(this.call.isScreenshareFromChat)return this.getProp("2pReconnectingScreenshareCall");if(this.call.teamsCallType===n.CallType.P2P)return this.getProp("2pReconnecting");return this.getProp("Reconnecting");case g.T.Transferring:return this.getProp("Transferring");case g.T.TransferFailed:return this.getProp("TransferFailed");case g.T.TransferSucceeded:return this.getProp("TransferSucceeded");case g.T.Parking:if(this.call.parkContext===n.ParkContext.Team)return this.getProp("Parking");return this.getProp("Holding");case g.T.ParkFailed:if(this.call.parkContext===n.ParkContext.Team)return this.getProp("ParkFailed");return this.getProp("HoldingFailed");case g.T.ParkSucceeded:if(this.call.parkContext===n.ParkContext.Team)return this.getProp("ParkSucceeded");return this.getProp("HoldingSucceeded");case g.T.MusicOnHold:return this.getProp("2pLocalHold");case g.T.Escalating:return this.call.isScreenshareFromChat?this.getProp("EscalatingScreenshareCall"):this.getProp("Escalating");case g.T.EscalationFailed:return this.getProp("EscalationFailed");case g.T.EscalationSucceeded:return this.call.isScreenshareFromChat?this.getProp("ScreenshareCallEscalationSucceeded"):this.getProp("EscalationSucceeded")}return this.getProp("None")}getMeetingPlanningType(e){if(!(void 0===e||e.isOneToOne()))return this.call.setupArgs.meetingInfo&&(this.call.setupArgs.meetingInfo.meetingType==n.CallMeetingType.Channel&&this.call.setupArgs.meetingInfo.replyChainMessageId||this.call.setupArgs.meetingInfo.meetingType==n.CallMeetingType.Private&&e.meetingInfo&&(e.meetingInfo.meetingType==c.I6[c.I6.Scheduled]||e.meetingInfo.meetingType==c.I6[c.I6.Recurring]))?c.I6[c.I6.Scheduled]:c.I6[c.I6.MeetNow]}getSoloUserMessage(e){if(this.call.extendedCallState===n.CallState.Staging)return this.localized.callingMonitorClickHereToGoBackToGreenRoom();if(this.identityService.isFreemiumTenant())return this.localized.callingScreenOnlyOneHereScheduled();switch(this.getMeetingPlanningType(e)){case c.I6[c.I6.MeetNow]:return this.localized.callingScreenOnlyOneHereAdhoc();case c.I6[c.I6.Recurring]:case c.I6[c.I6.Scheduled]:return this.localized.callingScreenOnlyOneHereScheduled()}return""}getCallStatusMessageTitle(){return this.call.isRelayWhitelistingIssue()?this.localized.callingRelayWhitelistingIssueMessageCallingScreen():!this.call.isFailed()||this.call.isRemovedFromCall()||this.call.wasDeniedFromLobby||this.call.isDeniedExternalMeetingJoin()||this.call.isDeniedExternalMeetingJoinExternalCommOff()||this.call.isDeniedMeetingJoinCaptchaVerificationFailed()||this.call.isDeniedMeetingJoinCaptchaVerificationFailedSolutionEmpty()||this.call.isNotAdmittedForLongTime||this.call.isMeetingFull()||this.call.isInformationBarrierPresent||this.call.isAnonymousJoinDisabled||this.call.isLobbyFull||this.call.isAllowPrivateCallingPolicyError||this.call.isLBRError||this.call.isBusy()||this.call.isTemporarilyUnavailable()||this.call.isMeetingInvalidOrExpired()||this.call.isMeetingLifetimeExceededFailure()||this.call.isOverflowStreamingBlockedDueToLobbyError()||this.call.isPresenterJoinsForEventsBlocked()||this.call.isEventJoinBlockedDueToDisabledLobby()||this.call.isUniquePresenterLinkUsageExhausted()||this.call.isUniquePresenterLinkMaxUsersAlreadyInMeeting()||this.call.isUniquePresenterLinkFailedDueToLobbyPolicy()||this.call.isUniquePresenterLinkPinMismatch()||this.call.isMeetingJoinBlockedByPolicy()||this.call.isRoomEndedByOrganizer||this.call.isRoomEndedByTimerExpiration||this.call.isComplianceRecordingDisconnectedError||this.call.isComplianceRecordingJoinError||this.call.isComplianceRecordingE2EEJoinError||this.call.isNotAllowedToJoinBreakoutRoom()||this.call.isMeetingLocked()||this.call.isNotRegisteredParticipant()||this.call.isUnAuthorizedWebinarParticipant()||this.call.isJoinExternalMeetingDisabledByPolicy()||this.call.isInvalidMeetingCode()||this.call.isConnectionError()||this.call.isMeetingXlBlockedByBreakoutRooms()||this.call.isBroadcastLimitReached()||this.call.isWebinarAttendeeJoinLinkUsageExhausted()||this.call.isTownhallAnonJoinBeforeEventStartedError()||this.call.isImmersiveEventJoinUnsupportedOnClient()||this.call.isImmersiveEventJoinTooEarly()?this.getCallingStateProps().descriptionTitle:this.meetingTerminatedDueToE2EEUnsupportedClient()?this.localized.callingE2EEErrorUnsupportedClientTitle&&this.localized.callingE2EEErrorUnsupportedClientTitle()||"Unable to join":this.call.hasFailedDueToInvalidSkypeToken()?this.localized.callingInvalidSkypeTokenRetryScreen():!this.appStateService.isOnline&&this.call.isFailed()?this.localized.callingCallOfflineMessageCallingScreen():this.call.abortReason===c.Vo.InitFailed||this.call.abortReason===c.Vo.JoinFailed||this.call.abortReason===c.Vo.AcceptFailed?this.isMeeting()&&this.enableV2RetryScreenForMeetings?this.localized.callingMeetingConnectionError():this.localized.callingCallSetupFailedMessage():this.call.hasDropped()?this.call.isScreenshareFromChat?this.localized.callingScreensharingCallDroppedMessageCallingScreen():this.isMeeting()?this.localized.callingCallDroppedMessageCallingScreen():this.localized.callingEndScreenRetryTitleCallDrop():this.call.terminatedReason===n.TerminatedReason.CallNotFound&&this.isChannelMeeting()?this.localized.callingCallDoesNotExistMessageCallingScreen():this.call.hasNoActiveNetworkInterface()?this.localized.callingCallHasNoActiveNetworkInterface():this.isMeeting()&&this.enableV2RetryScreenForMeetings?this.localized.callingMeetingConnectionError():this.localized.callingCallSetupFailedMessage()}getE2EEUnsupportedClientDescription(){return this.localized.callingE2EEErrorUnsupportedClientDescription&&this.localized.callingE2EEErrorUnsupportedClientDescription()||"Unable to join because you're joining from an unsupported device. Join from a supported device."}getE2EEUnsupportedClientLearnMore(){return this.localized.callingE2EEErrorUnsupportedClientLearnMore&&this.localized.callingE2EEErrorUnsupportedClientLearnMore()||'<a href="https://go.microsoft.com/fwlink/?linkid=2210535" target="_blank">Learn more</a>'}meetingTerminatedDueToE2EEUnsupportedClient(){let{callControllerCode:e,callControllerSubCode:t}=this.call.callEndDiagnosticsInfo||{};return e===c.WE.Forbidden&&t===c.Ck.E2EE_UNSUPPORTED_CLIENT_FAILURE}shouldShowDialInInfoWhenCallEnds(){return this.isDialInOnCallFailuresEnabled&&(this.call.hasDropped()||this.call.isAborted()||!this.appStateService.isOnline)&&!this.call.isMeetingFull()}getDisconnectedProps(){if(this.enableCallTransferredScreen&&this.call.isMeetingTransferred()){let e=this.isMeeting();return this.localizationService.langDirection===s.gT.languageDirectionStrings.rtl?e?this.getProp("MeetingTransferredRTL"):this.getProp("CallTransferredRTL"):e?this.getProp("MeetingTransferred"):this.getProp("CallTransferred")}if(this.call.isUnAuthorizedWebinarParticipant())return this.getProp("UnAuthorizedWebinarParticipant");if(this.call.isNotRegisteredParticipant())return this.getNotRegisteredUserProps();if(this.call.isComplianceRecordingJoinError)return this.getProp("ComplianceRecordingJoinError");if(this.call.isComplianceRecordingE2EEJoinError)return this.getProp("ComplianceRecordingE2EEJoinError");if(this.call.isComplianceRecordingDisconnectedError)return this.getProp("ComplianceRecordingDisconnectedError");if(this.call.isNotAdmittedForLongTime)return this.getInLobbyProps();if(this.call.wasDeniedFromLobby)return this.getDeniedFromLobbyProps();if(this.call.isDeniedExternalMeetingJoin())return this.getDeniedExternalMeetingJoin();if(this.call.isDeniedExternalMeetingJoinExternalCommOff())return this.getProp("DeniedExternalMeetingJoinExternalCommOff");if(this.call.isDeniedMeetingJoinCaptchaVerificationFailed())return this.getProp("DeniedMeetingJoinCaptchaVerificationFailed");if(this.call.isDeniedMeetingJoinCaptchaVerificationFailedSolutionEmpty())return this.enableMeetingJoinCaptchaVerification?this.getProp("DeniedMeetingJoinCaptchaVerificationFailed"):this.getProp("DeniedMeetingJoinCaptchaVerificationFailedSolutionEmpty");if(this.call.isNotAllowedToJoinBreakoutRoom())return this.getProp("NotAllowedToJoinBreakoutRoom");if(this.call.isMeetingInvalidOrExpired())return this.getProp("MeetingIsInvalidOrExpired");if(this.call.isOverflowStreamingSetupError()||this.call.isOverflowStreamingBootstrapError())return this.getProp("OverflowStreamingSetupError");if(this.call.isMeetingFull())return this.getProp("MeetingIsFull");if(this.call.isPresenterJoinsForEventsBlocked())return this.getProp("BlockPresenterJoinsForEventsError");if(this.call.isImmersiveEventJoinUnsupportedOnClient())return this.getProp("ImmersiveEventUnsupportedClientJoinError");if(this.call.isImmersiveEventJoinTooEarly())return this.getProp("TooEarlyImmersiveEventJoinError");if(this.call.isOverflowStreamingBlockedDueToLobbyError())return this.getProp("OverflowStreamingNoAllowedForLobbyMeetingError");if(this.call.isEventJoinBlockedDueToDisabledLobby())return this.getProp("DisabledLobbyEventError");if(this.call.isUniquePresenterLinkUsageExhausted())return this.getProp("UniquePresenterLinkUsageExhaustedError");if(this.call.isUniquePresenterLinkMaxUsersAlreadyInMeeting())return this.getProp("UniquePresenterLinkMaxUsersAlreadyInMeetingError");if(this.call.isUniquePresenterLinkFailedDueToLobbyPolicy())return this.getProp("UniquePresenterLinkFailedDueToLobbyPolicyError");if(this.call.isUniquePresenterLinkPinMismatch())return this.getProp("UniquePresenterLinkPinMismatchError");if(this.call.isWebinarAttendeeJoinLinkUsageExhausted())return this.getWebinarAttendeeJoinLinkUsageExhaustedProps();if(this.call.isTownhallAnonJoinBeforeEventStartedError())return this.getProp("TownhallAnonJoinBeforeEventStartedError");if(this.call.isOverflowStreamingIncompatibleClient())return this.getProp("OverflowStreamingIncompatibleClient");if(this.call.isMeetingJoinBlockedByPolicy())return this.getProp("MeetingJoinBlockedByPolicy");if(this.call.isMeetingLifetimeExceededFailure())return this.getProp("MeetingLifetimeExceededFailure");if(this.call.isMeetingXlBlockedByBreakoutRooms())return this.getProp("MeetingBlockForXlByBreakoutRooms");if(this.call.isAnonymousJoinDisabled){let e=this.call.setupArgs?.meetingInfo?.tenantId,t=this.customizedErrorMessageTenantExceptionListForJoins.find(t=>t.tenantId===e);if(this.useConfigToShowCustomizedTenantErrorMessageForJoins&&t){let e=t.tenantName,i=t.getHelpUrl;return{...this.getProp("AnonymousJoinDisabledByPolicy"),descriptionTitle:this.localized.callingAnonymousJoinDisabledByPolicyCustomTitle(e),descriptionText:this.localized.callingAnonymousJoinDisabledByPolicyCustomMessage(e,i)}}return this.getProp("AnonymousJoinDisabledByPolicy")}return this.call.isLobbyFull?this.getProp("LobbyIsFull"):this.call.isInvalidMeetingCode()?this.getProp("InvalidMeetingCode"):this.call.terminatedReason===n.TerminatedReason.CallNotFound?this.call.isScreenshareFromChat?this.getProp("UnresolvedConversationScreenshareCall"):this.getProp("UnresolvedConversation"):this.call.isLBRError?this.getProp("LBRError"):this.call.hasNoActiveNetworkInterface()?this.getProp("CallHasNoActiveNetworkInterface"):this.call.isAllowPrivateCallingPolicyError?this.getProp("CallingPolicyError"):this.call.isInformationBarrierPresent?this.getProp("InformationBarrierPresent"):this.call.isRoomEndedByOrganizer?this.getProp("KickedFromBreakoutRoom"):this.call.isRoomEndedByTimerExpiration?this.getProp("KickedFromBreakoutRoomByTimer"):this.call.terminatedReason===n.TerminatedReason.Kicked?this.call.isScreenshareFromChat?this.getProp("KickedFromScreenshareCall"):this.isMeeting()?this.getProp(this.call.isExternalTenant()&&!this.call.isBroadcast?"KickedFromExternalMeeting":"KickedFromMeeting"):this.getProp("KickedFromCall"):this.call.terminatedReason===n.TerminatedReason.MediaDroppedError&&this.call.wasReconnectingIssue?this.call.isScreenshareFromChat?this.getProp("2pNetworkReconnectScreenshareCallError"):this.call.teamsCallType===n.CallType.P2P?this.getProp("2pNetworkReconnectError"):this.getProp("NetworkReconnectError"):this.call.isBroadcastLimitReached()?this.call?.isBroadcast?this.getProp("BroadcastLimitReached"):this.getProp("TownhallLimitReached"):this.call.terminatedReason===n.TerminatedReason.NoLobbyForBroadcastJoin?this.getProp("NoLobbyForBroadcastJoin"):this.call.isMeetingLocked()?this.getProp("MeetingLocked"):this.call.isJoinExternalMeetingDisabledByPolicy()?this.getProp("JoinExternalMeetingDisabledByPolicy"):this.getDisconnectingProps()}getDisconnectingProps(){if(this.call.isLBRError)return this.getProp("LBRError");if(this.call.hasNoActiveNetworkInterface())return this.getProp("CallHasNoActiveNetworkInterface");if(this.call.isConnectionError())return this.getCallConnectionErrorProps();if(this.call.isAllowPrivateCallingPolicyError)return this.getProp("CallingPolicyError");if(this.call.isRejoiningLobby)return this.getInLobbyProps();if(this.call.isBusy())return this.getProp("Busy");if(this.call.isTemporarilyUnavailable())return this.getProp("NotReachable");let e=this.parseCallControllerCode(),t=this.parseCallControllerSubCode();switch(e){case 500:case 501:case 502:case 503:case 504:return this.getProp("Retry");case s.Sg.FORBIDDEN:if(t===s.Od.FORBIDDEN_BY_PSTN_ROUTING_POLICY)return this.getProp("FailedDueToPstnRoutingPolicy");if(t===s.Od.DIALOUT_CPC_AND_PSTN_DISABLED)return this.getProp("FailedDueToPstnNotPermitted");if(t===s.Od.INTERACTION_NOT_ALLOWED&&this.enableHandleInteractionNotAllowedInCalls)return this.getProp("FailedDueToInteractionNotAllowed")}if(!this.isMeeting()&&this.call.hasDropped())return this.call.isScreenshareFromChat?this.getProp("FailedScreenshareCall"):this.getProp("CallDrop");if(this.call.failureType===n.FailureType.CallDropped||this.call.failureType===n.FailureType.CallSetupFailed)return this.call.isScreenshareFromChat?this.getProp("FailedScreenshareCall"):this.getFailedProps();switch(this.call.terminatedReason){case n.TerminatedReason.Declined:return this.getProp("Declined");case n.TerminatedReason.NoNgcEndpoint:return this.getProp("NotReachable");case n.TerminatedReason.CallNotFound:return this.call.isScreenshareFromChat?this.getProp("UnresolvedConversationScreenshareCall"):this.getProp("UnresolvedConversation");case n.TerminatedReason.Cancelled:return this.getProp("Leaving");case n.TerminatedReason.ConfParticipantCountLimitReached:return this.getProp("MeetingIsFull");default:if(this.call.isScreenshareFromChat)return this.getProp("DisconnectedScreenshareCall");if(this.isMeeting()){if(this.call.isDisconnectedFromHidDevice())return this.getProp("DisconnectedMeetingFromHidDevice");return this.getProp("Disconnected")}if(this.call.isDisconnectedFromHidDevice())return this.getProp("DisconnectedCallFromHidDevice");return this.getProp("DisconnectedCall")}}parseCallControllerCode(){let e=this.call.teamsCallType===n.CallType.P2P?this.call.callEndDiagnosticsInfo&&this.call.callEndDiagnosticsInfo.callControllerCode||this.call.participants[0]&&this.call.participants[0].callEndDiagnosticsInfo&&this.call.participants[0].callEndDiagnosticsInfo.callControllerCode:null;return(0,a.isString)(e)?Number(e):e}parseCallControllerSubCode(){let e=this.call.teamsCallType===n.CallType.P2P?this.call.callEndDiagnosticsInfo&&this.call.callEndDiagnosticsInfo.callControllerSubCode||this.call.participants[0]&&this.call.participants[0].callEndDiagnosticsInfo&&this.call.participants[0].callEndDiagnosticsInfo.callControllerSubCode:null;return(0,a.isString)(e)?Number(e):e}getCallConnectionErrorProps(){return this.enableV2RetryScreenForMeetings&&this.isMeeting()?this.getProp("CallConnectionErrorMeeting"):this.getProp("CallConnectionError")}getFailedProps(){return this.enableV2RetryScreenForMeetings&&this.isMeeting()?this.getProp("FailedMeeting"):this.getProp("Failed")}getInLobbyProps(){return this.call.isNotAdmittedForLongTime?this.getProp("NotAdmittedForLongTime"):this.call.isPresenterConnected?this.getProp("InLobbyWithPresenterConnected"):this.getProp("InLobbyWithNoPresenterConnected")}getDeniedFromLobbyProps(){return this.getProp("DeniedFromLobby")}getDeniedExternalMeetingJoin(){return this.getProp("DeniedExternalMeetingJoin")}getRegistrationUrl(){return this.call.callEndDiagnosticsInfo?.additionalDiagnostics?.registrationInformation?.registrationUrl}getNotRegisteredUserProps(){let e=this.getRegistrationUrl();return e&&(this.call.wasPoppedOut?(this.setDescriptionTitle("NotRegisteredParticipant","calling_unregistered_user_message_with_link_multi_window"),this.setHyperLinkInTitle("NotRegisteredParticipant",e)):this.setDescriptionTitle("NotRegisteredParticipant",this.localized.callingUnregisteredUserMessageWithLink(e))),this.getProp("NotRegisteredParticipant")}getWebinarAttendeeJoinLinkUsageExhaustedProps(){let e=this.getRegistrationUrl();return e&&(this.setDescriptionTitle("WebinarAttendeeJoinLinkUsageExhaustedError","error_message_webinar_attendee_join_link_usage_exhausted_with_link"),this.setHyperLinkInTitle("WebinarAttendeeJoinLinkUsageExhaustedError",e)),this.getProp("WebinarAttendeeJoinLinkUsageExhaustedError")}onCallParkStateChanged(){let e=this.callParkService.getCallParkInfo(this.call.teamsCallId);e&&e.parkState===l.hz.Parking&&(this.setDescriptionTitle("Parking",this.localized.callingParkingCall()),this.setDescriptionTitle("ParkFailed",this.localized.callingParkFailed()))}onCallTransferStateChanged(){let e=this.callTransferService.getCallTransferInfo(this.call.teamsCallId);e&&e.transferState===d.pF.Transferring&&e.transferTarget&&e.transferTarget.displayName&&(this.setDescriptionTitle("Transferring",this.localized.callingTransferringCallTo(e.transferTarget.displayName)),this.setDescriptionTitle("TransferFailed",this.localized.callingTransferFailed(e.transferTarget.displayName)))}onExtendedCallStateChanged(){(0,a.includes)([g.T.Reconnecting,n.CallState.LocalHold,n.CallState.RemoteHold],this.call.extendedCallState)&&this.ariaLiveService.update(this.getCallingStateProps().descriptionText,!0)}initTelemetryContexts(){Object.entries(this.props).forEach(([e,t])=>{t.telemetryContext||(t.telemetryContext=e)})}isMeeting(){return this.call.getIntent()?.type===r.G.Meeting}isChannelMeeting(){return this.isMeeting()&&this.call.messageId!==o.c1}getProp(e){let t=this.props[e],{getDescriptionTitle:i,getDescriptionText:n,...a}={...t,descriptionTitle:t.getDescriptionTitle(),descriptionText:t.getDescriptionText()};return a}}},314401:function(e,t,i){i.d(t,{BN:()=>l,U7:()=>d,O_:()=>E,ej:()=>M,_8:()=>c});var n,a,r,o,s,l,c,d,g=i(370574),h=i(892891),p=i(575810),u=i(684663),m=i(654807),_=i(668505),S=i(969340),C=i(200669),v=i(310735),f=i(206898),b=i(826757),y=i(945761);(n=s||(s={})).Tiled="Tiled",n.Single="Single";var T=i(395250),I=i(397867);class A{}A.STAGE_3x3=9,A.ORIGINAL=4;class E{}E.Type_isPstnCallingAllowedChanged="pstn-calling-allowed-changed",E.Type_isMultilineUserChanged="is-multiline-user-changed",E.Type_isCountryEnforcedLbrUserChanged="country-enforced-lbr-user-changed",E.Type_isCountryEnforcedMobileLbrUserChanged="country-enforced-mobile-lbr-user-changed",E.Type_isCallingAllowedChanged="calling-allowed-changed",E.Type_isEvEnabledChanged="ev-enabled-changed",E.Type_isVoicemailAllowedChanged="voicemail-allowed-changed",E.Type_isForwardingToUserAllowedChanged="forwarding-to-user-allowed-changed",E.Type_isForwardingToPhoneAllowedChanged="forwarding-to-phone-allowed-changed",E.Type_isCallGroupsAllowedChanged="is-call-groups-allowed-changed",E.Type_isDelegationAllowedChanged="is-delegation-allowed-changed",E.Type_isDelegationAllowedIgnoringPstnChanged="is-delegation-allowed-ignoring-pstn-changed",E.Type_isCallParkEnabledChanged="is-call-park-allowed-changed",E.Type_isMusicOnHoldAdminEnabledChanged="moh-admin-enabled-changed",E.Type_isForwardingAllowedChanged="is-forwarding-allowed-changed",E.Type_allowPrivateMeetNowChanged="allow-private-meet-now-changed",E.Type_isTeacherPresentInPrivateMeetingRestrictionChanged="is-teacher-present-in-private-meeting-restriction-changed",E.Type_isTeacherPresentInChannelMeetingRestrictionChanged="is-teacher-present-in-channel-meeting-restriction-changed",E.Type_isPopoutForIncomingPSTNCallsAllowedChanged="popout-for-incoming-pstn-calls-enabled-changed",E.Type_popoutAppPathForIncomingPSTNCallsChanged="popout-app-path-for-incoming-pstn-calls-changed",(a=l||(l={}))[a.UnsupportedEnvironment=0]="UnsupportedEnvironment",a[a.NoDeviceAvailable=1]="NoDeviceAvailable",a[a.DisabledByAdmin=2]="DisabledByAdmin",a[a.Available=3]="Available",(r=c||(c={}))[r.NotSupported=0]="NotSupported",r[r.WithDriver=1]="WithDriver",r[r.Builtin=2]="Builtin",(o=d||(d={})).RaiseHands="RaiseHands",o.AttendeeRestrictionsUpdate="AttendeeRestrictionsUpdate",o.RequestToSpeak="RequestToSpeak";class M{get isVoicemailAllowed(){return this._isVoicemailAllowed}get isForwardingAllowed(){return this._isForwardingAllowed}get isForwardingToUserAllowed(){return this._isForwardingToUserAllowed}get isForwardingToPhoneAllowed(){return this._isForwardingToPhoneAllowed}get isCallGroupsAllowed(){return this._isCallGroupsAllowed}get isDelegationAllowed(){return this._isDelegationAllowed}get isEvEnabled(){return this._isEvEnabled}get isDelegationAllowedIgnoringPstn(){return this._isDelegationAllowedIgnoringPstn}get isPopoutForIncomingPSTNCallsAllowed(){return!!this._isPopoutForIncomingPSTNCallsAllowed}get popoutAppPathForIncomingPSTNCalls(){return this._popoutAppPathForIncomingPSTNCalls}get isPopoutForIncomingPSTNCallsUserEnabled(){return!!this._isPopoutForIncomingPSTNCallsUserEnabled}get maxNumberOfItemsOnStage(){return this.maxItemsOnStage}get pinnedCountLimit(){return this.maxPinnedItems}get isMusicOnHoldAdminEnabled(){return this._isMusicOnHoldAdminEnabled}get isCloudRecordingForCallsEnabled(){return this._isCloudRecordingForCallsEnabled}get e2eePolicyEnabled(){return this._isE2EECallingAdminEnabled}get e2eeCallingPolicyEnabled(){return this._isE2EECallingAdminEnabled}get e2eeMeetingPolicyEnabled(){return this._isE2EEMeetingAdminEnabled}get isE2EEEnabledByUser(){return this._isE2EEEnabledByUser}set isE2EEEnabledByUser(e){this._isE2EEEnabledByUser="boolean"==typeof e&&e,this.config.enableE2EECallingApplyAccountConfig()?this._isE2EEEnabledByUserDeferredPromise.deferredPromise.resolve():(this._isE2EEEnabledByUserResolve?.(),this._isE2EEEnabledByUserResolve=void 0)}get isIPAudioModeEnabled(){return!this.blockAVOverIPInMeetings()&&this._isIPAudioModeEnabled}get isPrivateCallingEnabled(){return!this.useMeetingPolicyInScreenSharingFromChat||!!this._isPrivateCallingAllowed}get weatherpersonCapable(){return this._weatherpersonCapable}get teamsCameraFarEndPTZMode(){return this._teamsCameraFarEndPTZMode}get isBusyOnBusyAllowUserOverride(){return this._isBusyOnBusyAllowUserOverride}get isPstnCallRedirectionAllowUserOverride(){return this._isPstnCallRedirectionAllowUserOverride}constructor(e){this._isMultilineUser=!1,this._isCountryEnforcedLbrUser=!1,this._isCountryEnforcedMobileLbrUser=!1,this._userCurrentCountryLocation="None",this._bannerObject=null,this._isE2EEEnabledByUser=!1,this._isE2EEEnabledByUserPromise=new Promise(e=>this._isE2EEEnabledByUserResolve=e),this._screenSharingMode="EntireScreen",this.isMacOsBigSur=!1,this.e2eeSettingDBKey="priv_ee2e_setting_enabled",this.isSpotlightEnabledMemo=(0,h.memoize)(this.isSpotlightEnabledInternal.bind(this),(...e)=>`
      ${e[0].callId}-
      ${e[0].isBroadcast}-
      ${!!e[0].broadcastMeeting}-
      ${e[0].teamsCallType}
    `),this.config=e.config,this.conversationsAsyncService=e.conversationsAsyncService,this.eventingService=e.eventingService,this.desktopUtilityService=e.desktopUtilityService,this.loggingService=e.loggingService,this.platformDetectService=e.platformDetectService,this.aggregatedSettingsStore=e.aggregatedSettingsStore,this.callingPolicyStore=e.callingPolicyStore,this.userResourcesSettingsStore=e.userResourcesSettingsStore,this.voiceSettingsStore=e.voiceSettingsStore,this.policySettingsStore=e.policySettingsStore,this.tenantVoiceSettingsStore=e.tenantVoiceSettingsStore,this.messagingPolicySettingsStore=e.messagingPolicySettingsStore,this.peopleService=e.peopleService,this.sxConfig=e.sxConfig,this.meetingPolicySettingsStore=e.meetingPolicySettingsStore,this.callingMultiWindowService=e.callingMultiWindowService,this.sfbTeamsUpgradeService=e.sfbTeamsUpgradeService,this.hybridContentVisibilityManager=e.hybridContentVisibilityManager,this.myUserPreferencesStore=e.myUserPreferencesStore,this.identityService=e.identityService,this.utilityService=e.utilityService,this.mtmaSubscriptionUtility=e.mtmaSubscriptionUtility,this.serviceProvider=e.serviceProvider,this.clientDatabase=e.clientDatabase,this.asObservable=e.asObservable,this.helpers=e.helpers,this.promiseFactory=e.promiseFactory??y.Wq,this.webApiService=e.webApiService,this.vdi1ClientConnectedObservable=e.vdiPluginlessMediaSupportService?.clientConnectedObservable;let t=e.authenticationService,i=e.initializeInCtor??!0;this.logger=this.loggingService.newLogger("callingSupportService"),this.isDesktopApp=this.desktopUtilityService.isDesktop(),this.browser=this.platformDetectService.getBrowser(),this.osVersion=Number(this.platformDetectService.getOSVersion()),this.isWebRtc=!this.isDesktopApp&&(0,h.includes)([p.gT.browser.chrome,p.gT.browser.edgeChromium,p.gT.browser.safari,p.gT.browser.firefox],this.browser),this.isEdge=!this.isDesktopApp&&this.browser===p.gT.browser.edge,this.isChromiumBased=!this.isDesktopApp&&(0,h.includes)([p.gT.browser.chrome,p.gT.browser.edgeChromium,p.gT.browser.chromium],this.browser),this.browser=this.browser===p.gT.browser.edgeChromium?p.gT.browser.chrome:this.browser,this.isWeb=this.desktopUtilityService.isWeb(),this.isPluginless=this.desktopUtilityService.isPluginless(),this.isAnonymous=t.isAnonymous(),t.getUserDetails().then(e=>{this.isTPProtection=e?.licenseDetails?.isTPProtection}).catch(()=>{this.isTPProtection=!1,this.logger.error("getUserDetails failed.")}),this.isSurfaceHub1=this.platformDetectService.isSurfaceHub1(),this.isElectronAppSurfaceHub=this.platformDetectService.isElectronAppSurfaceHub(),this.isRigel=this.platformDetectService.isRigel(),this._isE2EEEnabledByUserDeferredPromise=(0,b.Hg)(this.config.e2eeDeferredPromiseTimeoutInMs?.(),this.utilityService),this._isE2EEEnabledByUserDeferredPromise.deferredPromise.promise.catch(()=>{this.logger.errorToTelemetry?.(`[E2EE_CALLING_DEBUG] _isE2EEEnabledByUserDeferredPromise failed to resolve, current timeout: ${this.config.e2eeDeferredPromiseTimeoutInMs?.()} ms.`,"e2ee_calling_debug",void 0,!0)}),this.isPPTWPMinElectronVersionAvailable=!1,this.isVideoExtensibilityMinElectronVersionAvailable=!1,this.isEventDrivenCompositorMinElectronVersionAvailable=!1,this.isWeb||this.isPluginless||this.isSurfaceHub1||(this.setIsPPTWPMinElectronVersionAvailable(),this.setIsEventDrivenCompositorMinElectronVersionAvailable(),this.setIsVideoExtensibilityMinElectronVersionAvailable()),this.callingPolicyStore.whenInitialized().then(()=>{let e=this.callingPolicyStore.getSettingValue("preventTollBypass");this._isLbrEnabledUser=e&&this.config.honorLbrPolicy(),this.logger.info(`isLbrEnabledUser:${this._isLbrEnabledUser}`)}).catch(()=>{this._isLbrEnabledUser=!1,this.logger.error(`getInitLoadPromise failed. isLbrEnabledUser:${this._isLbrEnabledUser}`)}),i&&this.initializeOnAppLaunchAndReinit()}allowMeetingReactions(e,t){return t?this.config.enableMeetingReactions():!!e.allowTeamsMeetingReactions}allowPrivateMeetNowEnabled(){return this._allowPrivateMeetNow}allowRequestToSpeak(e){return this.isRequestToSpeakEnabled()&&e!==g.CallType.P2P}blockAVOverIPInMeetings(){return this.useAPCToBlockAVOverIPInMeetings&&!this._isPrivateCallingAllowed}checkWatermarkSlimcoreVersion(){let e={[p.gT.os.windows]:this.config.watermarkMinSlimcoreVersion,[p.gT.os.mac]:this.config.watermarkMinSlimcoreVersionMac},t=this.platformDetectService.getOS().toLowerCase(),i=e[t]?.();return!!i&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),i)>=0}cleanupOnAppTeardown(e){this.isSpotlightEnabledMemo.cache?.clear(),this.isMultiWindowEnabled=void 0,this.oneOnOneCallingEnabled=void 0,this.isWebRtcVideoOneOnOneEnabled=void 0,this.callingEnableSafariBigSMultipartyVideo=void 0,this.isWebRtcVideoMultipartyEnabled=void 0,this.isWebRtcMeetingSingleVideoEnabled=void 0,this.isWebRtcMultipleOutgoingVideoEnabled=void 0,this.enableRequestedConstraintsForGetUserMedia=void 0,this.enableMeetingPreJoinExperience=void 0,this.enableSfBDeeplinking=void 0,this.enablePreJoinContentOnly=void 0,this.enablePreJoinContentOnlyWeb=void 0,this.enablePowerPointSharing=void 0,this.enableBackgroundBlurringAPIV2=void 0,this.enableVideoBackgroundForWeb=void 0,this.enableQuickJoinWithoutModality=void 0,this.enableQuickJoinWithoutModalityAnon=void 0,this.enableQuickJoinWithoutModalityWeb=void 0,this.enableCallPreHeatDesktop=void 0,this.enableCallPreHeatWeb=void 0,this.enableTransferAndCompanion=void 0,this.enableCallTransferAndCompanion=void 0,this.enableBreakoutRoomsDesktop=void 0,this.enableBreakoutRoomsWeb=void 0,this.enableBreakoutRoomsAnon=void 0,this.enableBreakoutRoomsSlimcore=void 0,this.breakoutRoomsSlimcoreVersion=void 0,this.enableParticipantsMoveWithoutSendingInvites=void 0,this.enableBreakoutRoomsSelfSelect=void 0,this.enablePlazaParticipants=void 0,this.enablePlazaParticipantsSlimcore=void 0,this.enableSafeTransferSlimcore=void 0,this.enableEnforceAllowUserChatPolicy=void 0,this.pptWeatherpersonMinElectronVersion=void 0,this.isPPTWPMinElectronVersionAvailable=void 0,this.pptCameoMinSlimcoreVersion=void 0,this.eventDrivenCompositorMinSlimcoreVersion=void 0,this.eventDrivenCompositorMinElectronVersion=void 0,this.videoExtensibilityMinElectronVersion=void 0,this.videoExtensibilityMinSlimcoreVersion=void 0,this.videoExtensibilityMinSlimcoreVersionForMac=void 0,this.isVideoExtensibilityMinElectronVersionAvailable=void 0,this.isWebGLForVideoExtensibilityEnabled=void 0,this.videoExtensibilityMinDeviceMemory=void 0,this.videoExtensibilityMinHardwareConcurrency=void 0,this.avatarMinSlimcoreVersion=void 0,this.avatarMinDeviceMemory=void 0,this._lastAvatarEnabledMessageToTelemetry=void 0,this.avatarMinHardwareConcurrency=void 0,this.maxItemsOnStage=void 0,this.maxPinnedItems=void 0,this.largeMeetingSettings=void 0,this._allowPrivateMeetNow=void 0,this._allowWatermarkScreenShareCustomization=void 0,this._allowWatermarkVideoCustomization=void 0,this._watermarkScreenShareCustomizationSettings=void 0,this._watermarkVideoCustomizationSettings=void 0,this._isIPAudioModeEnabled=void 0,this._isIPVideoModeEnabled=void 0,this._isPSTNCallingAllowed=void 0,this._isMultilineUser=!1,this._isCountryEnforcedLbrUser=!1,this._isCountryEnforcedMobileLbrUser=!1,this._userCurrentCountryLocation="None",this._bannerObject=null,this._isEvEnabled=void 0,this._isCallingAllowed=void 0,this._isPrivateCallingAllowed=void 0,this._isCallParkEnabled=void 0,this._isComposerRendererEnabledCache=void 0,this._isVoicemailAllowed=void 0,this._isForwardingAllowed=void 0,this._isForwardingToPhoneAllowed=void 0,this._isForwardingToUserAllowed=void 0,this._isCallGroupsAllowed=void 0,this._isDelegationAllowed=void 0,this._isDelegationAllowedIgnoringPstn=void 0,this._isPopoutForIncomingPSTNCallsAllowed=void 0,this._isPopoutForIncomingPSTNCallsUserEnabled=void 0,this._popoutAppPathForIncomingPSTNCalls=void 0,this._isMusicOnHoldAdminEnabled=void 0,this._isCloudRecordingForCallsEnabled=void 0,this._isE2EECallingAdminEnabled=void 0,this._isE2EEMeetingAdminEnabled=void 0,this.getPhoneNumberDeferred=void 0,this.isInitialized=void 0,this._isLbrEnabledUser=void 0,this.phoneNumber=void 0,this.phoneUtil=void 0,this.useAPCToBlockAVOverIPInMeetings=void 0,this.enableIPAudioVideoModes=void 0,this.deeplinkBaseUrl=void 0,this.isTflUser=void 0,this.enableShareMeetCode=void 0,this.allowMeetCodeOnly=void 0,this._lastNotifiedRaiseHandsSetting=void 0,this._lastNotifiedAttendeeRestrictionsUpdatesSetting=void 0,this._lastNotifiedRequestToSpeakSetting=void 0,this.useMeetingPolicyInScreenSharingFromChat=void 0,this._isRequestToSpeakFeatureEnabled=void 0,this._allowUnrestrictWithoutRaisedHand=void 0,this._enableGroupRaiseHandsStateNotifications=void 0,this._enableAttendeeVideoRestriction=void 0,this._enableRestrictingAnAttendeeAudio=void 0,this._enablePtzCameraController=void 0,this._enableRestrictingAnAttendeeVideo=void 0,this._enableRaiseHandReceivedScenario=void 0,this._enableStandardizingCallingConversationMixin=!1,this._areAllModalitiesDisabledInVdi=void 0,this._areAudioVideoDisabledInVdi=void 0,this._screenSharingMode="EntireScreen",this._isTFLRenderer=void 0,this.isMacOsBigSur=!1,this.e2eeSettingDBKey=void 0,this._isE2EEEnabledByUser=!1,this._allowUserChat=void 0,this._isImmersiveViewEnabled=void 0,this._teamsCameraFarEndPTZMode=void 0,this._isBusyOnBusyAllowUserOverride=void 0,this._isPstnCallRedirectionAllowUserOverride=void 0,this.vdi1ClientConnectedObservable=void 0,this.clientConnectedSubscriptionVDI1?.unsubscribe()}cleanupSlimcoreEcsFlags(){this.enableBreakoutRoomsSlimcore=void 0,this.enableSafeTransferSlimcore=void 0,this.enablePlazaParticipantsSlimcore=void 0}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}enableCallStateCheckHotfix(){return this.config.enableCallStateCheckHotfix&&this.config.enableCallStateCheckHotfix()}getAdditionalEndpointProperties(){let e=this.meetingPolicySettingsStore.getSettings();return e?.infoShownInReportMode?{infoShownInReportMode:e.infoShownInReportMode}:null}getAppliedInteractivityLevel(e){if(!e||!e.endpoints)return"";for(let t in e.endpoints.endpointDetails)if(e.endpoints.endpointDetails[t].endpointId===e.endpointId)return e.endpoints.endpointDetails[t].appliedInteractivityLevel||"";return""}getAutoAdmittedUsersMeetingOption(e){return e?.autoAdmittedUsers??"Everyone"}getUsersCanAdmitFromLobbyMeetingOption(e){return e?.usersCanAdmitFromLobby??"OrganizersAndPresentersOnly"}async getCallType(e){return await this.isOneOnOne(e)?g.CallType.P2P:g.CallType.Conference}getDisplayNameOrValue(e){return this.config.enableDetailedIncomingCallToastLogs()?e:void 0===e?"(undefined)":null===e?"(null)":e?"(truthy)":"(falsy)"}getMaxNrOfStageItems(){return this.config.enable7x7VideoLayoutAndInfra()?this.largeMeetingSettings.maxNumberOfMeetingVideo7x7:this.is3x3VideoStreamingEnabled()?this.largeMeetingSettings.maxNumberOfMeetingVideo3x3:this.largeMeetingSettings.maxNumberOfMeetingVideo}getSelfEnterpriseUserId(){return this.utilityService.getServiceEnterpriseUserId(this.getCurrentSkypeMri())}async getOngoingCallMeetingType(e){let t=this._enableStandardizingCallingConversationMixin?await e.getCallingConversationAsync():await this.conversationsAsyncService.getCallingConversation(e.conversationId?e.conversationId:"");return t.isOneToOnePstn()?"oneToOnePstnCall":t.isOneToOne()?"oneToOneCall":t.isInstantMeeting()?"adhocPrivateMeeting":t.isPrivateMeeting()?"scheduledPrivateMeeting":t.isGroup()?"groupCall":"adhocOrScheduledChannelMeeting"}getOngoingCallType(e){let t=e?.getIntent();if(t)switch(t.type){case v.G.GroupCall:let i=t.joinOptions;if(i?.isAudioDropInCall)return"huddleGroupCall";return"groupCall";case v.G.Meeting:let n=t.coordinates;if(!this.isLegacyMeeting(n))return"scheduledPrivateMeeting";return n.isAdhoc?"adhocPrivateMeeting":n.isChannel?"adhocOrScheduledChannelMeeting":n.broadcast?"broadcastMeeting":"scheduledPrivateMeeting";case v.G.OneToOneCall:return"oneToOneCall";case v.G.OngoingCall:let a=t.coordinates;return a?.callType}}getPhoneNumberAsync(e){return this.getPhoneNumberDeferred?this.getPhoneNumberDeferred.promise:(this.getPhoneNumberDeferred=this.promiseFactory.createDeferred(),this.getPhoneNumberFromVoiceSettingsStore(e))}getPresenterMeetingOption(e){return e?.presenterOption??"Everyone"}getRecorderOptionMeetingOption(e){let t=e.getCapabilities();return t&&void 0!==t.recorderOption&&null!==t.recorderOption?t.recorderOption:"OrganizersAndPresentersOnly"}getMeetingLegalUrl(e){return e?e.meetingDetails?.meetingCapability?.legalUrl:void this.logger.error("[callingSupportService][getMeetingLegalUrl] call object was undefined")}getCurrentSkypeMri(){return this.sxConfig.getCurrentSkypeMri()}getUsersFromCall(e){if(!e)return this.logger.error("[callingSupportService][getUsersFromCall] call object was null"),null;if(!e.participants)return this.logger.error(`[callingSupportService][getUsersFromCall] Participant for call with [callId=${e.callId}] was null`),null;let t=this.sxConfig.getCurrentSkypeMri(),i=[];return(0,h.forEach)(e.participants,e=>{e&&e.id!==t&&i.push(e.id)}),this.peopleService.getAllPeopleProfile(i,p.gT.scenarios.calling.context.callMerge)}getVdiCapabilities(){return this.desktopUtilityService.isOptimizedVDI()?this.config.vdi.getVdiCapabilities():null}getWatermarkMeetingOptions(e){if(this.isWatermarkMeetingOptionOverridden()&&this.isMeetingSecurityWatermarkEnabled())return{screenshare:!0,video:!0,...this.getWatermarkCustomizationSettings()};let t={screenshare:!1,video:!1,...this.getWatermarkCustomizationSettings(e)},{waterMarkCapability:i}=e;return i&&(t.screenshare=!!i.enabledForVbss,t.video=!!i.enabledForVideo),t}granularContentCameraEffectsSupported(){let e=this.config.minSlimcoreVersionForGranularContentCameraEffects();return e&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),e)>=0}init(){this.logger.info("callingSupportService init");let e=this.loggingService.newScenario(T.RG.CallingSupportServiceInit);if(this.isInitialized){let t="Already initialized!";this.logger.warn(t),e.stop({reason:t});return}let t=this.aggregatedSettingsStore.getSettings();this.recalculateIsCallingAllowed(t),this.recalculateIsPstnCallingAllowed(t),this.recalculateCallParkEnabled(t),this.recalculateIsVoicemailAllowed(t),this.recalculateIsForwardingToUserAllowed(t),this.recalculateIsForwardingToPhoneAllowed(t),this.recalculateIsCallGroupsAllowed(t),this.recalculateIsEvEnabled(t),this.recalculateIsDelegationAllowed(t),this.recalculateIsPopoutForIncomingPSTNCallsAllowed(t),this.recalculatePopoutAppPathForIncomingPSTNCalls(t),this.recalculateMusicOnHoldEnabledType(t),this.recalculateAllowCloudRecordingForCalls(t),this.recalculateCallingEndtoEndEncryptionEnabledType(t),this.recalculateMeetingEndToEndEncryption(t),this.recalculateIsForwardingAllowed(),this.recalculateCallingBusyOnBusyPolicy(t),this.recalculateCallingPstnCallRedirectionPolicy(t),this.recalculateCountryEnforcedLbrUser(t),this.recalculateIsMultilineUser(t),this.recalculateUserPrimaryPhoneNumber(t);let i=this.meetingPolicySettingsStore.getSettings();this.recalculateAllowPrivateMeetNow(i),this.recalculateIPAudioVideoModes(i),this.useMeetingPolicyInScreenSharingFromChat&&this.recalculateScreenSharingModes(i);let n=this.messagingPolicySettingsStore.getSettings();this.recalculateAllowUserChat(n),this.recalculateTeamsCameraFarEndPTZMode(i),this.recalculateAllowWatermarkCustomization(i),this.enableBreakoutRoomsSlimcore=void 0,this.enablePlazaParticipantsSlimcore=void 0,this.enableSafeTransferSlimcore=void 0,this.isInitialized=!0,e.stop()}initializeOnAppLaunchAndReinit(e){this.useAPCToBlockAVOverIPInMeetings=this.config.isUseAPCToBlockAVOverIPInMeetingsEnabled(),this.enableIPAudioVideoModes=this.config.isIPAudioVideoModesEnabled(),this.deeplinkBaseUrl=this.config.deeplinkBaseUrl(),this.isTflUser=this.config.isTflUser(),this.enableShareMeetCode=this.config.enableShareMeetCode(),this.allowMeetCodeOnly=this.config.allowMeetCodeOnly(),this.eventingService.registerHandlerForExternalEvent(p.gT.events.settings.updated,()=>this.updateSettings()),this.eventingService.registerHandlerForExternalEvent(p.gT.events.calling.locationResponse,e=>this.handleLocationResponse(e)),this.updateSettings(),this.subscribeToAggregatedSettingsStore(),this.subscribeToMeetingPolicySettingsStore(),this.subscribeToMessagingPolicySettingsStore(),this.logger.info(`One to one calls are ${this.oneOnOneCallingEnabled?"enabled":"disabled"}`),this.phoneUtil=this.serviceProvider.phoneNumberUtil(),this.retrieveSSFCMeetingPolicyFlagValue(),this.checkIfMacOsBigSur(),this._isComposerRendererEnabledCache=new Map,this._isIPAudioModeEnabled=!0,this._isIPVideoModeEnabled=!0,this._isPrivateCallingAllowed=!0,this.config.enableE2EE()&&(this.config.e2eeReadSettingFromBVD()?this.helpers.getE2EESettingFromServer().then(e=>{this.logger.infoToTelemetry?.(`[E2EE_CALLING_DEBUG] [e2eeReadSettingFromBVD] isE2EEEnabledByUser set to: ${e}`,"e2ee_calling_debug",void 0,!0),this.isE2EEEnabledByUser=e}).catch(e=>{this.logger.warnToTelemetry?.(`[E2EE_CALLING_DEBUG] [getE2EESettingFromServer] Error: ${e&&e.message||"unknown"}`,"e2ee_calling_debug",void 0,!0),this._isE2EEEnabledByUserDeferredPromise.deferredPromise.reject(e)}):this.eventingService.registerHandlerForExternalEvent(p.gT.events.db.providerReady,e=>{e===p.gT.dbNames.teamsDb&&this.clientDatabase.provider.get(u.v.Stores.internaldata.name,this.e2eeSettingDBKey).then(e=>this.isE2EEEnabledByUser=e?e.value:this.config.e2eeOptOut())})),this.recalculateIsPopoutForIncomingPSTNCallsUserEnabled(!0),this.isVideoExtensibilityMinElectronVersionAvailable=!1,this.isWeb||this.isPluginless||this.isSurfaceHub1||this.setIsVideoExtensibilityMinElectronVersionAvailable(),this._subscribeToVdi1Connection()}is3x3VideoStreamingEnabled(){let e=this.config.enable3x3VideoStream(),t=this.config.enable3x3VideoLayout(),i=this.config.enableVideoStage();return this.callingMultiWindowService.isModernCallingEnabled()?e:i||t}async isAddingParticipantAllowedAsync(e){if(!e)return this.addParticipantNotAllowedWithLog("no call"),Promise.resolve(!1);if(!this.isGroupCallingEnabled())return this.addParticipantNotAllowedWithLog("group calling not enabled",e),Promise.resolve(!1);try{let t=await e.getCallingConversationAsync();return Promise.resolve(this.isAddingParticipantAllowedInternal(e,t))}catch{return this.addParticipantNotAllowedWithLog("fetching conv failed",e),Promise.resolve(!1)}}isAddingParticipantAllowedFromCache(e){if(!e||!this.isGroupCallingEnabled())return!1;let t=e.maybeCachedCallingConv();return!!t&&this.isAddingParticipantAllowedInternal(e,t)}isAllowRoomRemoteControlForSurfaceHub(){let e=this.config.isAllowRoomRemoteControlForSurfaceHub();return this.logger.info(`Room Remote Control setting isAllowRoomRemoteControlForSurfaceHub value = ${e}`),this.isElectronAppSurfaceHub&&e}isAllowStartWhiteboardEnabled(){let e=this.config.isAllowStartWhiteboardEnabled();return this.logger.info(`Whiteboard setting isAllowStartWhiteboardEnabled value = ${e}`),!this.isElectronAppSurfaceHub||e}isAplCustomBackgroundEnabled(){let e=this.config.aplCustomBackgroundMinSlimcoreVersion();return this.isWeatherpersonPresenterEnabled()&&e&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),e)>=0}isAttendeeRestrictionsEnabled(){return this.config.enableStructuredMeetingsAttendeeRestrictions()}isAttendeeRestrictionsUpdatesEnabled(){return!!(this.isAttendeeRestrictionsEnabled()&&this.config.enableStructuredMeetingsAttendeeRestrictionsUpdates()&&this.serviceProvider.slimcoreEcsConfigService().getSetting("enableAttendeeRestrictions"))}isAttendeeVideoRestrictionsEnabled(){return!!(this._enableAttendeeVideoRestriction&&this.isAttendeeRestrictionsUpdatesEnabled())}isAvatarEnabled(){if(this.desktopUtilityService.isMagLev()&&!this.doesEdgeSupportVideoExtensibility())return this.logger.info("[isAvatarEnabled] return false for VE is not supported in this Edge version."),!1;if(!this.config.enableAvatar())return this.loggingAvatarEnabledInfo("[isAvatarEnabled] enableAvatar feature flag is not open or device does not support hardware acceleration.",{isAvatarEnabled:!1},!0),!1;if(this.desktopUtilityService.isWebRTCVdiMode())return this.loggingAvatarEnabledInfo("[isAvatarEnabled] A/V is remoted.",{isAvatarEnabled:!1},!0),!1;if(this.desktopUtilityService.isElectron()){if(!this.isVideoExtensibilityMinElectronVersionAvailable)return this.loggingAvatarEnabledInfo(`[isAvatarEnabled] Electron version is not match: ${this.isVideoExtensibilityMinElectronVersionAvailable}`,{isAvatarEnabled:!1},!0),!1}else if(!this.desktopUtilityService.isMagLev())return!1;else if(!this.isWebview2TextureStreamAvailable())return this.loggingAvatarEnabledInfo("[isAvatarEnabled] Webview2 textureStream APIs are not available.",{isAvatarEnabled:!1},!0),!1;let e=this.getNavigator();if(e&&(e.hardwareConcurrency<this.avatarMinHardwareConcurrency||!this.isMemoryQualifiedForAvatar()))return this.loggingAvatarEnabledInfo("[isAvatarEnabled] returns false on low-end device",{isAvatarEnabled:!1},!0),!1;let t=this.desktopUtilityService.getSlimCoreVersion(),i=this.utilityService.compareVersions(t,this.avatarMinSlimcoreVersion)>=0;return this.loggingAvatarEnabledInfo(`[isAvatarEnabled] returns ${i}, current slimcore version is ${t}`,{slimCoreVersion:t,isAvatarEnabled:i},!0),i}isBackgroundBlurringAPIV2Enabled(){let e=this.enableVideoBackgroundForWeb&&this.desktopUtilityService.isWeb(),t=this.desktopUtilityService.isOptimizedVDI()&&this.config.vdi.areBackgroundEffectsSupported();return(e||t||!this.desktopUtilityService.isOptimizedVDI()&&this.desktopUtilityService.isMagLev())&&this.enableBackgroundBlurringAPIV2}isBackgroundEffectRequired(){let{teamsMeetingBrandingPolicy:e}=this.aggregatedSettingsStore.getSettings();return!!e?.value?.requireBackgroundEffect}isBreakoutRoomMoveWithoutInviteEnabled(){return!!(this.isBreakoutRoomsFeatureSupported()&&this.enableParticipantsMoveWithoutSendingInvites)}isBreakoutRoomsFeatureSupported(){let e=!this.isAnonymous||!!this.enableBreakoutRoomsAnon,t=this.isDesktopApp&&this.isMultiWindowEnabled?!!this.enableBreakoutRoomsDesktop:!!this.enableBreakoutRoomsWeb;return this.enableBreakoutRoomsSlimcoreFeatureFlag&&t&&e}isBreakoutRoomsSelfSelectEnabled(){return!!(this.isBreakoutRoomsFeatureSupported()&&this.enableBreakoutRoomsSelfSelect)}isCallInContentOnlyMode(e){return!!e&&this.isPreJoinContentOnlyEnabled()&&!!e.isContentOnlyMode}isCallParkAvailable(e){return!b.eU.isVoicemailGreetingCall(e)&&e.teamsCallType===g.CallType.P2P&&this._isCallParkEnabled&&e.state!==g.CallState.RemoteHold&&e.state!==g.CallState.LocalHold&&!b.eU.isSfcCall(e)&&(this.config.enableTfwTflCallingFederation?.()||!b.eU.isTflConsumerCall(e))&&!b.eU.isParkCall(e)&&!e.isServerHold&&this.isTeamsOnlyUser()&&!e.encryptionDetails?.e2eeEnabled&&this._isEvEnabled}isCallParkEnabled(){return this._isCallParkEnabled}isCallTransferAndCompanionEnabled(){return this.isDesktopApp&&this.callingMultiWindowService.isModernCallingEnabled()&&this.enableCallTransferAndCompanion}isCallWithSharedLineAppearance(e){let t=this.isTeamsOnlyUser(),i=b.eU.isSkypeConsumerCall(e);if(!this.config.enableSharedLineAppearance()||e.teamsCallType!==g.CallType.P2P||e.isScreenshareFromChatCallEscalated||!t||i)return this.logger.info(`[isCallWithSharedLineAppearance=false][call=${e.callId}][callType=${e.teamsCallType}][isScreenshareFromChatCallEscalated=${e.isScreenshareFromChatCallEscalated}][isTeamsOnlyUser=${t}][isSkypeConsumerCall=${i}]`),!1;if(e.isSLAv2ResumedCall)return this.logger.info(`[isCallWithSharedLineAppearance=true][call=${e.callId}][isSLAv2ResumedCall=true]`),!0;if(e.isUnparkCall&&e.unparkContext===g.ParkContext.SharedLine)return this.logger.info(`[isCallWithSharedLineAppearance=true][call=${e.callId}][isUnparkCall=true]`),!0;let n=this.serviceProvider.delegationSettingsService().getUserDelegates();if(n.length>0&&"delegator"!==e.transferorType&&!e.onBehalfOfMri&&(0,h.find)(n,e=>{let t=e&&e.delegationDetails&&e.delegationDetails.allowedActions;return t&&t.receiveCalls}))return this.logger.info(`[isCallWithSharedLineAppearance=true][call=${e.callId}][hasDelegate=true]`),!0;let a=this.serviceProvider.delegationSettingsService().getUserDelegators();if(a.length>0){let t=e.onBehalfOfMri;if(!t&&"delegator"===e.transferorType&&e.transferorMri&&(t=e.transferorMri),t&&(0,h.find)(a,e=>e&&e.delegationDetails&&e.delegationDetails.userMri===t))return this.logger.info(`[isCallWithSharedLineAppearance=true][call=${e.callId}][hasDelegator=true]`),!0}return this.logger.info(`[isCallWithSharedLineAppearance=false][call=${e.callId}][transfererType=${e.transferorType}][transfererMri=${e.transferorMri}][onBehalfOf=${e.onBehalfOfMri}][delegates=${n.length}][delegators=${a.length}]`),!1}isCallingAllowed(){return this._isCallingAllowed}isClosedCaptionsEnabled(){let e=this.config.enableClosedCaptions()&&(this.desktopUtilityService.isElectron()||this.config.enableClosedCaptionsOnWeb());return this.desktopUtilityService.isWebRTCVdiMode()&&(e=e&&this.config.vdi.isDataChannelSupported()),e}isCloudRecordingAllowedByCapability(e){let t=e.getCapabilities();return!t||void 0===t.allowCloudRecording||null===t.allowCloudRecording||t.allowCloudRecording}isComposerRendererEnabled(e){if(e&&this._isComposerRendererEnabledCache.has(e.teamsCallId))return this._isComposerRendererEnabledCache.get(e.teamsCallId);let t=this.isComposerRendererEnabledInternal(e);return e&&this._isComposerRendererEnabledCache.set(e.teamsCallId,t),t}isContentCameraSnapshotEnabled(){let e=this.config.minSlimcoreVersionForContentCameraSnapshot();return!!e&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),e)>=0}isMultilineUser(){return this._isMultilineUser}getUserPrimaryPhoneNumber(){return this._userPrimaryPhoneNumber}isCountryEnforcedLbrUser(){return this._isCountryEnforcedLbrUser}isCountryEnforcedMobileLbrUser(){return this._isCountryEnforcedMobileLbrUser}waitForE2EEEnabled(){return this.config.enableE2EECallingApplyAccountConfig()?this._isE2EEEnabledByUserDeferredPromise.deferredPromise.promise:this._isE2EEEnabledByUserPromise}isE2EEEnabled(){return this.config.enableE2EE()&&this.isMultiWindowEnabled&&this._isE2EECallingAdminEnabled&&this._isE2EEEnabledByUser}isE2EEMeetingEnabled(){return this.config.enableE2EEAnonUserJoin?.()?this.config.enableE2EEMeetings()&&this.isMultiWindowEnabled:this.serviceProvider.slimcoreEcsConfigService().getSetting("enableE2EEncryption")&&this.config.enableE2EEMeetings()&&this.isMultiWindowEnabled}isEduLicense(){let e=this.userResourcesSettingsStore.getSettingValue("licenseType");return e===p.gT.licenseType.teacher||e===p.gT.licenseType.student}isEnforceAllowUserChatPolicyEnabled(){return this.enableEnforceAllowUserChatPolicy}isEventDrivenCompositorEnabled(){if(!this.config.enableEventDrivenCompositor())return this.logger.info("[isEventDrivenCompositorEnabled] enableEventDrivenCompositor feature flag is not open."),!1;if(!this.isEventDrivenCompositorMinElectronVersionAvailable)return this.logger.info(`[isEventDrivenCompositorEnabled] Electron version doesn't meet minimum requirement ${this.eventDrivenCompositorMinElectronVersion}`),!1;let e=this.desktopUtilityService.getSlimCoreVersion(),t=this.utilityService.compareVersions(e,this.eventDrivenCompositorMinSlimcoreVersion)>=0;return t||this.logger.info(`[isEventDrivenCompositorEnabled] Slimcore version ${e} doesn't meet minimum requirement ${this.eventDrivenCompositorMinSlimcoreVersion}`),t}isEyeContactVersionAvailable(){let e=this.config.eyeContactMinSlimcoreVersion(),t=this.desktopUtilityService.getSlimCoreVersion();return this.logger.info(`[isEyeContactVersionAvailable] currentSlimCoreVersion: ${t}, min version: ${e}`),e&&this.utilityService.compareVersions(t,e)>=0}async isFederated(e){let t=this._enableStandardizingCallingConversationMixin?await e.getCallingConversationAsync():await this.conversationsAsyncService.getCallingConversation(e.conversationId);return!!(t&&t.isFederated())}isHoldResumeAllowed(e){return!!e&&e.teamsCallType===g.CallType.P2P&&this.config.isHoldResumeEnabled()&&!b.eU.isVoicemailGreetingCall(e)&&!this.isRigel}isHostViewModeActive(e){return e?.attendeeViewModes===m.L$A.HostMode&&!e?.enableProductionStudio&&this.config.enableHostViewMode()}isIPAudioModeEnabledByType(e){return e||this.isIPAudioModeEnabled}isIPAudioModeEnabledForCall(e){return e.callType===g.CallType.P2P||this.isIPAudioModeEnabled}isIPVideoModeEnabledByType(e){return this.isVideoPolicyEnabled&&(e||this.isIPVideoModeEnabled)}isIPVideoModeEnabledForCall(e){let t=e.callType===g.CallType.P2P;return this.isVideoPolicyEnabled&&(t||this.isIPVideoModeEnabled)}isIPVideoModeEnabledForIntent(e){let t=e===v.G.OneToOneCall;return this.isVideoPolicyEnabled&&(t||this.isIPVideoModeEnabled)}async isIncomingVideoSupported(e){if(this.desktopUtilityService.isOptimizedVDI()&&!this.config.vdi.isVideoSupported())return!1;let t=await this.getCallTypeForCallAsync(e);return this.isVideoSupported(t)||this.isSingleIncomingVideoSupported(e)}isInfoShownInReportModeSupported(){if(!this.isDesktopApp||this.desktopUtilityService.isWebRTCOptimizedVDI())return!0;let e=this.config.minSlimcoreVersionForInfoShownInReportMode();return e&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),e)>=0}isIpVideoAllowedByCapability(e){let t=e.getCapabilities();return!t||void 0===t.allowIPVideo||null===t.allowIPVideo||t.allowIPVideo}isLbrEnabledUser(){return!!this._isLbrEnabledUser}isLiveEventsUnificationEnabled(){if(!this.callingMultiWindowService.isModernCallingEnabled())return!1;let e=this._shouldEnableLiveEventsUnification();if(this.isPluginless)return e||!1;let t=this.config.liveEventsUnificationMinSlimcoreVersion();return e&&t&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),t)>=0}isLocalRecordingAllowedByCapability(e){let t=e.getCapabilities();return t?.allowLocalRecording??!0}isMdpAudioRecordingSupported(){return!!this.config.enableMdpAudioRecording()&&(this.isDesktopApp||this.isWeb)}isMeetingBrandingCapabilityEnabled(e){let t=e.getCapabilities();return!t?.disableMeetingBranding}isMeetingSecurityWatermarkEnabled(){return this.config.enableMeetingSecurityWatermark()}get getScreenSharingModeByMeetingPolicy(){return!this.desktopUtilityService.isOptimizedVDI()||this.config.vdi.isScreenshareSupported()&&this.config.vdi.isVideoSupported()?this._screenSharingMode:"Disabled"}isMeetingStartedNotificationSupported(){return this.isSupportedEnvironment()&&!this.isElectronAppSurfaceHub&&!this.isSurfaceHub1&&!this.isRigel}isMicrophoneToggleDisabledForCoMe(){let e=this.serviceProvider.callingService().getActiveCall();return!!e&&this.serviceProvider.coordinatedMeetingsService().isMicToggleDisabled(e)}isMinWebClientVersion(e){let t=this.config.getTeamsWebClientVersion(),i=t?t.split("/"):void 0,n=i?i[1]:void 0;return!!("1.0.0.0"===n||n.includes("local")||n.includes("oncdn"))||e&&this.utilityService.compareVersions(n,e)>=0}isModernSetttingsTabEnabledForWeb(){return this.config.chromiumEnableModernSettingsTab()&&this.isChromiumBased||this.config.safariEnableModernSettingsTab()&&this.browser===p.gT.browser.safari||this.config.firefoxEnableModernSettingsTab()&&this.browser===p.gT.browser.firefox}isMultipleNativeCompositorsSupported(){if(this.desktopUtilityService.isMagLev())return this.logger.info("isMultipleNativeCompositorsSupported: true - is maglev"),!0;let e=this.serviceProvider.callingAgentsService().getPreferredRendererConfig();if(!(e&&e.canNativeRenderMultipleCompositors))return this.logger.info("isMultipleNativeCompositorsSupported: false - slimcore is unable to render multiple compositors"),!1;if(this.platformDetectService.getOS()===p.gT.os.mac){let e=this.config.nativeRenderer.minDesktopVersionForOsxNrMultipleCompositors(),t=this.platformDetectService.getDesktopAppVersion(),i=!!e&&this.utilityService.compareVersions(t,e)>=0;return this.logger.info(`isMultipleNativeCompositorsSupported: ${i} - on OS X, minDesktopVersionRequired: ${e}, currentDesktopVersion: ${t}`),i}return this.logger.info("isMultipleNativeCompositorsSupported: true"),!0}isNativeRendererEnabled(e,t){if(this.isMultipleNativeCompositorsSupported())return!0;let i=this.config.nativeRenderer.minTeamsWebClientVersion(),n=this.desktopUtilityService.getSystemProductName(),a=this.config.nativeRenderer.productNamesToDisableNativeRendererRegExps(),r=this.config.nativeRenderer.productNamesToEnableNativeRendererRegExps(),o=(0,h.some)(a,e=>new RegExp(e).test(n)),s=(0,h.some)(r,e=>new RegExp(e).test(n)),l=this.platformDetectService.getOS(),c=this.config.enableNativeRendering(l),d=this._isNativeRenderingAvailableOnOs(l),g=this.isMinWebClientVersion(i),p=this._areNativeRenderingConfigsSupported(t),u=this.isComposerRendererEnabled(e),m=!o&&(c||s)&&d&&u&&g&&p;return this.logger.info(`isNativeRendererEnabled: isNativeRendererEnabled=${m}; enableNativeRendering=${c}; forceDisableNativeRenderer=${o}; forceEnableNativeRenderer=${s}; isNativeRenderingAvailableOnOs=${d}; isMinWebClientVersion=${g}; areNativeRenderingConfigsSupported=${p}; isComposerRendererEnabled=${u}`),m}isMuteOnAirV3Enabled(){if(!this.config.enableOnAirMuteV3()||!this.config.enableCallControlServiceV2?.())return!1;let e=this.config.onAirV3MinDesktopVersion?.();if(!e)return!1;let t=this.desktopUtilityService?.getDesktopVersion();return this.utilityService.compareVersions(null!=t?t:"0",e)>=0}isPeripheralsMuteServiceUsageEnabled(){return this.config.enablePeripheralsMuteServiceUsage()}isAirPodsControlEnabled(){return!!this.config.enableAirPodsControl?.()}isSipOverDGJEnabled(){return!!this.config.enableSIPOverDGJ?.()}isGoogleMeetOnDGJEnabled(){return!!this.config.enableGoogleMeetDGJ?.()}isSipDirectDTMFEnabled(){return!!this.config.enableSIPDirectDTMF?.()}isOnAirShareWindowEnabled(){if(!this.isOnAirSupportedPlatform())return!1;let e=this.config.onAirMinSlimcoreVersion();return this.config.enableOnAirShareWindow()&&e&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),e)>=0}isOneOnOneCallingEnabled(){return!!this.isCallingEnabledInVdi()&&(this.isWebRtc?this.oneOnOneCallingEnabled:this.isSupportedEnvironment())}isPPTCameoEnabled(){if(this.desktopUtilityService.isMagLev()&&this.desktopUtilityService.isWebRTCVdiMode())return this.logger.info("isPPTCameoEnabled: false. Cameo T21 is not supported on VDI."),!1;let e=this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),this.pptCameoMinSlimcoreVersion)>=0,t=this.isWeatherpersonCompositionEnabled()&&this.config.enablePPTCameo()&&e;return this.logger.info(`isPPTCameoEnabled: ${t}, isWeatherPersonCompositionEnabled: ${this.isWeatherpersonCompositionEnabled()}, enablePPTCameo: ${this.config.enablePPTCameo()}, isPPTCameoMinSlimCoreVersionAvailable: ${e}, current version: ${this.desktopUtilityService.getSlimCoreVersion()}, target version: ${this.pptCameoMinSlimcoreVersion}`),t}isPPTWPMinElectronVersion(){return this.isPPTWPMinElectronVersionAvailable}isPPTWeatherpersonEnabled(){return this.isWeatherpersonCompositionEnabled()&&this.config.enablePPTWeatherperson()&&this.isPPTWPMinElectronVersion()}isPSTNCallbackOptionDisabled(e){return!!e.isInTransportCompanionMode()}isPSTNCallingAllowed(){return this._isPSTNCallingAllowed}isPlazaParticipantsEnabled(){let e=this.isDesktopApp&&this.enablePlazaParticipants;return this.enablePlazaSlimcoreFeatureFlag&&e}isPptSharingEnabled(){return!this.isAnonymous&&this.enablePowerPointSharing}isPreJoinContentOnlyEnabled(){return!!this.enablePreJoinContentOnly&&(!!this.isDesktopApp&&!this.isPluginless||!!this.isPluginless&&this.enablePreJoinContentOnlyWeb)}isPreJoinEnabled(){return this.enableMeetingPreJoinExperience&&!this.isElectronAppSurfaceHub&&!this.isSurfaceHub1&&!this.isRigel&&this.isSupportedEnvironment()}isPreheatEnabled(){let e=this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),this.config.callPreHeatDesktopMinSlimcoreVersion?.()||"")>=0;return(this.enableCallPreHeatDesktop&&this.isDesktopApp&&e&&this.serviceProvider.slimcoreEcsConfigService().getSetting("enablePreheat")&&!this.isPluginless||this.enableCallPreHeatWeb&&this.isPluginless)&&!this.isAnonymous}isPresenterCapabilitiesReductionSupported(){return this.config.enablePresenterCapabilitiesReduction?.()}isPresenterJoinsForEventsBlocked(){return!this.config.enablePresenterJoinAsAttendeeInTownhallEmbed()&&!!(this.desktopUtilityService.isWeb()&&this.isPluginless||this.desktopUtilityService.isVDI())&&!this.config.allowPresenterJoinForEventsInPluginlessStack()}isImmersiveEventJoinAllowed(){return this.config.isImmersiveEventJoinAllowed()}isPresenterSlideControlEnabled(){return this.config.isPresenterSlideControlEnabled()}isPstnCallingAllowedAsync(){let e=this.promiseFactory.createDeferred();this.logger.info("isPstnCallingAllowedAsync called");let t=[this.callingPolicyStore.ensureInitAndGetSettingValue("allowPrivateCalling"),this.voiceSettingsStore.ensureInitAndGetSettingValue("isEvEnabled")];return this.enableSimplifiedPSTNCheck()?t.push(this.voiceSettingsStore.ensureInitAndGetSettingValue("accountType")):(t.push(this.config.readIsSfbCloudFromVoiceSettings()?this.voiceSettingsStore.ensureInitAndGetSettingValue("isSfbCloud"):this.userResourcesSettingsStore.ensureInitAndGetSettingValue("isSfbCloud")),t.push(this.policySettingsStore.ensureInitAndGetSettingValue("byot")),t.push(this.tenantVoiceSettingsStore.ensureInitAndGetSettingValue("pstnType"))),this.promiseFactory.finalized(this.promiseFactory.all(t),()=>{this.logger.info("isPstnCallingAllowedAsync: reached finally");let t=this.aggregatedSettingsStore.getSettings();t&&(this.recalculateIsPstnCallingAllowed(t),this.recalculateIsDelegationAllowed(t),this.recalculateIsCallGroupsAllowed(t),this.recalculateIsForwardingToUserAllowed(t),this.recalculateIsForwardingToPhoneAllowed(t),this.recalculateIsVoicemailAllowed(t),this.recalculateIsForwardingAllowed(),this.recalculateCountryEnforcedLbrUser(t),this.recalculateIsMultilineUser(t),this.recalculateUserPrimaryPhoneNumber(t));let i=this.isPSTNCallingAllowed();this.logger.info(`isPstnCallingAllowedAsync: pstnEnabled: ${i}`),e.resolve(i)}),e.promise}isPtzCameraControllerEnabled(){return!!this._enablePtzCameraController}isQuickJoinWithoutModalityEnabled(){return(this.enableQuickJoinWithoutModality&&this.isDesktopApp&&this.serviceProvider.slimcoreEcsConfigService().getSetting("enableCCWM")&&!this.isPluginless||this.enableQuickJoinWithoutModalityWeb&&this.isPluginless)&&(!this.isAnonymous||this.enableQuickJoinWithoutModalityAnon)}isRaiseHandForStreamingSupported(){return this.config.enableRaiseHandForStreaming?.()&&this.isRaiseHandsEnabledForStreaming?.()||!1}isLobbyChatAttendeeJoinEnabled(){return this.config.enableLobbyChatForAttendee?.()??!1}isSupportReactionsEnabled(){return this.config.enableMeetingReactionsThroughNGC()??!1}syncAiInterpretationStatus(e){this.trigger(p.gT.events.calling.aiInterpretationTurnedOn,void 0,e)}getAiInterpreterVoiceConsentValue(){let e=this.myUserPreferencesStore.getUserPreferences().aiInterpretationSettings,t=e?.interpretedVoice;return this.isRigel?"0":t||("Enabled"===this.config.voiceSimulationInInterpreterPolicy()?"0":"Disabled"===this.config.voiceSimulationInInterpreterPolicy()?"1":"0")}isTownhallNudgeSupported(){let e=this.serviceProvider.slimcoreEcsConfigService().getSetting("supportsNudgeFromStreamingIntoRealTime");return this.logger.info("supportsNudgeFromStreamingIntoRealTime ECS config From Slimcore: enableTownhallNudge: ",e),e}isRaiseHandReceivedScenarioEnabled(){return!!this._enableRaiseHandReceivedScenario&&this.isRaiseHandsEnabledForMultiWindow()}isRaiseHandsEnabledForMainApp(){return this.config.enableRaiseHandInMainApp()&&this.serviceProvider.slimcoreEcsConfigService().getSetting("enableRaiseHands")}isRaiseHandsEnabledForMultiWindow(){return this.serviceProvider.slimcoreEcsConfigService().getSetting("enableRaiseHands")&&this.config.enableRaiseHand()}isRequestToSpeakEnabled(){return this._isRequestToSpeakFeatureEnabled&&this.serviceProvider.slimcoreEcsConfigService().getSetting("enableUnrestrictingAttendees")}isRestrictingAnAttendeeAudioEnabled(){return!!(this._enableRestrictingAnAttendeeAudio&&this.isAttendeeRestrictionsUpdatesEnabled())}isRestrictingAnAttendeeVideoEnabled(){return!!(this._enableRestrictingAnAttendeeVideo&&this.isAttendeeRestrictionsUpdatesEnabled())}isSLAv2DesktopEnabled(){return this.desktopUtilityService.isDesktop()&&this.config.enableSLAv2Desktop&&this.config.enableSLAv2Desktop()}isSLAv2WebEnabled(){return this.desktopUtilityService.isPluginless()&&this.config.enableSLAv2Web&&this.config.enableSLAv2Web()}isSafeTransferAllowed(){return void 0!==this.enableSafeTransferSlimcore||(this.enableSafeTransferSlimcore=this.serviceProvider.slimcoreEcsConfigService().getSetting("enableSafeTransfer")),this.enableSafeTransferSlimcore}isScreenSharingFromChromeWithExtension(){let e=this.isWeb&&(this.browser===p.gT.browser.chrome||this.browser===p.gT.browser.edgeChromium);if(e&&this.config.enableChromeGetDisplayMedia()){let e=this.getNavigator();return!(e&&e.mediaDevices&&e.mediaDevices.getDisplayMedia)}return e}isScreenSharingSupported(){return this.desktopUtilityService.isWebRTCVdiMode()||this.desktopUtilityService.isSlimcoreOptimizedVDI()?this.config.vdi.isScreenshareSupported()&&this.config.vdi.isVideoSupported():(!this.desktopUtilityService.isUnoptimizedVDI()||!this._areAllModalitiesDisabledInVdi)&&(this.isDesktopApp||this.isSurfaceHub1||this.config.enableBrowserScreenSharing(this.browser))}isSfBDeeplinkingEnabled(){return this.promiseFactory.resolve(this.enableSfBDeeplinking)}isSfBVideoSupported(){return!this.isPluginless||this.isEdge||this.config.enableBrowserInteropVideo(this.browser)}isSingleIncomingVideoSupported(e){return(this.isWebRtc||this.desktopUtilityService.isDesktopPluginless())&&this.isWebRtcMeetingSingleVideoEnabled&&!this.serviceProvider.thirdPartyRoomService().is2x2ThirdPartyMeetingRoom()}isSingleOutgoingVideoEnabled(e){return this.desktopUtilityService.isDesktopPluginless()?this.isVDISingleOutgoingVideo():this.isWebRtcSingleOutgoingVideo()}isSpotlightEnabled(e){return this.isSpotlightEnabledMemo(e)}isSpotlightEnabledForPluginless(){return this.config.enableSpotlightForPluginless()}isSpotlightEnabledInternal(e){return this.logger.info(`isSpotlightEnabledInternal: Setting re-fetch for call ${e.callId}, isBroadcast=${e.isBroadcast}, P2P=${e.teamsCallType===g.CallType.P2P}`),(!this.isPluginless||this.isSpotlightEnabledForPluginless())&&this.serviceProvider.slimcoreEcsConfigService().getSetting("enableSpotlight")&&!e.isBroadcast&&!e.broadcastMeeting&&e.teamsCallType!==g.CallType.P2P&&this.config.enableSpotlightFeature()}isSupportedEnvironment(){return this.serviceProvider.callingAgentsService().getEnvironmentSupport()===m.Ln2.FullySupported}isSystemAudioSupportedForCall(e){if(!(e&&!e.isScreenshareFromChat&&(this._isTFLRenderer||!b.eU.isSkypeConsumerCall(e))))return!1;let t=this.systemAudioPlatformSupport;return t===c.Builtin||t===c.WithDriver&&this.callingMultiWindowService.isCallSupportedInModernCalling(e)}isTFLRenderer(){return this._isTFLRenderer}isTeamsOnlyUser(){let e=this.sfbTeamsUpgradeService.getUpgradePolicyV2Cached();return e&&e.mode&&e.mode===_.b.TeamsOnly}isTflMeetingSupported(){if(this.isPluginless)return!0;let e=this.config.minSlimcoreVersionForTflMeetings();return this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),e)>=0}isThirdPartyMeetingRoom(){return this.serviceProvider.thirdPartyRoomService().isThirdPartyMeetingRoom()}isTogetherModePinningEnabled(){return this.config.enableTogetherModePinning()}isTouchUpandAutoAdjustVersionAvailable(){if(this.desktopUtilityService.isWeb())return this.logger.info("[isTouchUpandAutoAdjustVersionAvailable] Running in web, returning true"),!0;let e=this.config.touchUpandAutoAdjustMinSlimcoreVersion(),t=this.desktopUtilityService.getSlimCoreVersion();return this.logger.info(`[isTouchUpandAutoAdjustVersionAvailable] currentSlimCoreVersion: ${t}, min version: ${e}`),e&&this.utilityService.compareVersions(t,e)>=0}isTrackingInReportAllowed(){this.myUserPreferencesStore.updatePreferenceStoreCache?.();let e=this.myUserPreferencesStore.getUserPreferences(),t=this.meetingPolicySettingsStore.getSettings(),i=!!e&&("true"===e.showInMeetingReport||"false"===e.showInMeetingReport);if(this.logger.info(`[isTrackingInReportAllowed] isAnonymous:${this.isAnonymous}, showInMeetingReport:${e?.showInMeetingReport}, allowTrackingInReport:${t?.allowTrackingInReport}, infoShownInReportMode:${t?.infoShownInReportMode}`),!e||!t)return!0;switch(t.allowTrackingInReport){case"Disabled":return!1;case"Enabled":default:return!0;case"EnabledUserOverride":return!i||"false"!==e.showInMeetingReport;case"DisabledUserOverride":return!!i&&"false"!==e.showInMeetingReport}}isTranscriptionAllowedByCapability(e){let t=e.getCapabilities();return!t||void 0===t.allowTranscription||null===t.allowTranscription||t.allowTranscription}isBreakoutRoomsAllowedByCapability(e){let t=e.getCapabilities();return!this.config.enableAllowCollabFeaturesByMeetingCapability()||!t||void 0===t.allowBreakoutRooms||null===t.allowBreakoutRooms||"boolean"!=typeof t.allowBreakoutRooms||t.allowBreakoutRooms}isDocumentCollaborationAllowedByCapability(e){let t=e.getCapabilities();return!this.config.enableAllowCollabFeaturesByMeetingCapability()||!t||void 0===t.allowDocumentCollaboration||null===t.allowDocumentCollaboration||"string"!=typeof t.allowDocumentCollaboration||t.allowDocumentCollaboration===m.M9D.Enabled}isPowerPointSharingAllowedByCapability(e){let t=e.getCapabilities();return!this.config.enableAllowCollabFeaturesByMeetingCapability()||!t||void 0===t.allowPowerPointSharing||null===t.allowPowerPointSharing||"boolean"!=typeof t.allowPowerPointSharing||t.allowPowerPointSharing}isWhiteboardAllowedByCapability(e){let t=e.getCapabilities();return!this.config.enableAllowCollabFeaturesByMeetingCapability()||!t||void 0===t.allowWhiteboard||null===t.allowWhiteboard||"boolean"!=typeof t.allowWhiteboard||t.allowWhiteboard}isTransferAllowed(e){return!!e&&!b.eU.isVoicemailGreetingCall(e)&&e.teamsCallType===g.CallType.P2P&&!!this.config.isCallTransferEnabled()&&e.state!==g.CallState.RemoteHold&&!this.isTflUser&&!b.eU.isSfcCall(e)&&(this.config.enableTfwTflCallingFederation?.()||!b.eU.isTflConsumerCall(e))&&!b.eU.isParkCall(e)&&!this.isRigel&&!e.isServerHold&&!e.encryptionDetails?.e2eeEnabled}isTransferAndCompanionEnabled(){return this.isDesktopApp&&this.callingMultiWindowService.isModernCallingEnabled()&&this.enableTransferAndCompanion}isVdiScreenShareOnly(){return this._areAudioVideoDisabledInVdi&&!this._areAllModalitiesDisabledInVdi}isVideoBackgroundEffectsSupported(){let e=this.enableVideoBackgroundForWeb&&this.desktopUtilityService.isWeb(),t=this.desktopUtilityService.isOptimizedVDI()&&this.config.vdi.areBackgroundEffectsSupported();return(e||t||!this.desktopUtilityService.isOptimizedVDI()&&this.desktopUtilityService.isMagLev())&&this.config.enableVideoBackground()}isVideoBackgroundSettingsDisabled(e){return!!e.isInTransportCompanionMode()}isVideoExtensibilityEnabled(){if(this.desktopUtilityService.isMagLev()&&!this.doesEdgeSupportVideoExtensibility())return this.logger.info("[isVideoExtensibilityEnabled] return false for VE is not supported in this Edge version."),!1;if(this.config.enableDebugVideoExtensibility())return this.logger.info("[isVideoExtensibilityEnabled] return true when enableDebugVideoExtensibility feature flag is open."),!0;if(this.desktopUtilityService.isWebRTCVdiMode())return this.logger.info("[isVideoExtensibilityEnabled] A/V is remoted."),!1;if(this.config.enableVideoExtensibilityWebGLCheck?.()&&!this.getCachedIsWebGLForVideoExtensibilityEnabled())return this.logger.info("[isVideoExtensibilityEnabled] WebGL is not enabled."),!1;if(!this.config.enableVideoExtensibility())return this.logger.info("[isVideoExtensibilityEnabled] enableVideoExtensibility feature flag is not open or device does not support hardware acceleration."),!1;if(this.desktopUtilityService.isElectron()){if(!this.isVideoExtensibilityMinElectronVersionAvailable)return this.logger.info(`[isVideoExtensibilityEnabled] Electron version is not match: ${this.isVideoExtensibilityMinElectronVersionAvailable}`),!1}else if(!this.desktopUtilityService.isMagLev())return!1;else if(!this.isWebview2TextureStreamAvailable())return this.logger.info("[isVideoExtensibilityEnabled] Webview2 textureStream APIs are not available."),!1;let e=this.desktopUtilityService.getSlimCoreVersion(),t=this.platformDetectService.getOS()===p.gT.os.mac,i=this.utilityService.compareVersions(e,t?this.videoExtensibilityMinSlimcoreVersionForMac:this.videoExtensibilityMinSlimcoreVersion)>=0;if(!i)return this.logger.info(`[isVideoExtensibilityEnabled] Slimcore version is not match: ${e}`),!1;let n=this.getNavigator();return n&&(n.hardwareConcurrency<=this.videoExtensibilityMinHardwareConcurrency||n.deviceMemory<=this.videoExtensibilityMinDeviceMemory)?(this.logger.info("[isVideoExtensibilityEnabled] returns false on low-end device"),!1):(this.logger.info(`[isVideoExtensibilityEnabled] returns ${i}`),i)}isVideoPreviewDisabled(e){return!!e.isInTransportCompanionMode()}isVideoSupported(e){let t=this.isWebRtcVideoEnabled(e);return this.desktopUtilityService.isWebRTCVdiMode()?t&&this.config.vdi.isVideoSupported():this.desktopUtilityService.isSlimcoreOptimizedVDI()?this.config.vdi.isVideoSupported():this.isWebRtc||this.desktopUtilityService.isDesktopPluginless()?t:this.isSupportedEnvironment()}isWatermarkAudioOnlySupported(){if(!this.config.enableWatermarkAudioOnly?.())return!1;let e=this.config.watermarkRequireSlimcoreVersionAudioOnly?.()??!0;if(this.isWeb||!e)return!0;let t=this.config.watermarkMinSlimcoreVersionAudioOnly?.();return!!t&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),t)>=0}isWatermarkMeetingOptionOverridden(){return this.config.overrideWatermarkMeetingOption()}isPreventScreenCaptureSupported(){let e=this.config.enablePreventScreenCapture(),t=this.config.preventScreenCaptureSupportedPlatform();if(!e||!t)return!1;let i=this.config.preventScreenCaptureMinSlimcoreVersion();return!!i&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),i)>=0}isWatermarkSupported(){return!(this.desktopUtilityService.isOptimizedVDI()||this.desktopUtilityService.isWebRTCVdiMode())&&(this.config.enableMeetingWatermarkWeb?.()?(!this.isAnonymous||!!this.config.enableWatermarkForAnonymousAttendees?.())&&this.callingMultiWindowService.isModernCallingAvailable():!this.isAnonymous&&!this.isWeb&&this.checkWatermarkSlimcoreVersion())}isWatermarkAllowed(e){if(!this.isWatermarkAudioOnlySupported())return!0;let t=this.isWatermarkSupported();return t&&this.isAnonymous?e.meetingDetails?.meetingCapability?.waterMarkCapability?.anonymousUsers==="WatermarkWithDisplayName":t}isWeatherpersonCompositionEnabled(){let e=this.config.weatherpersonMinSlimcoreVersion();return!this.isPluginless&&this.serviceProvider.callingAgentsService().isCompositorAvailable()&&e&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),e)>=0}isWeatherpersonPresenterEnabled(){let e=!0;return this.platformDetectService.getOS()===p.gT.os.windows&&(e="8"!==this.platformDetectService.getOSVersion()),this.isWeatherpersonCompositionEnabled()&&e}isWhiteboardVideoEffectsSupported(){return!this.desktopUtilityService.isDesktopPluginless()&&this.config.enableMagicWhiteboardForLaptop()}notifyUpdatedHostSettings(e){let t={},i=[];if(e.forEach(e=>{switch(e.hostSettingType){case d.RaiseHands:e.currentSettingValue!==this._lastNotifiedRaiseHandsSetting&&(Object.assign(t,{isRaiseHandsEnabled:e.currentSettingValue}),i.push(()=>this._lastNotifiedRaiseHandsSetting=e.currentSettingValue));break;case d.AttendeeRestrictionsUpdate:e.currentSettingValue!==this._lastNotifiedAttendeeRestrictionsUpdatesSetting&&(Object.assign(t,{isAttendeeRestrictionsUpdatesEnabled:e.currentSettingValue}),i.push(()=>this._lastNotifiedAttendeeRestrictionsUpdatesSetting=e.currentSettingValue));break;case d.RequestToSpeak:e.currentSettingValue!==this._lastNotifiedRequestToSpeakSetting&&(Object.assign(t,{isRequestToSpeakEnabled:e.currentSettingValue}),i.push(()=>this._lastNotifiedRequestToSpeakSetting=e.currentSettingValue))}}),!(!t||(0,h.isEmpty)(t)))try{this.hybridContentVisibilityManager.setSettings({hostSettings:t}),i.forEach(e=>{e()}),e.forEach(e=>{this.logger.info(`notifyUpdatedHostSettings: setting change broadcasted to child windows for: ${e.hostSettingType} value: ${e.currentSettingValue}`)})}catch(e){this.logger.error(`notifyUpdatedHostSettings: Broadcast to child windows failed with error: ${e}`)}}numberOfAllowedSpotlights(){return this.config.numberOfAllowedSpotlights()}populateMeetingData(e,t){if(e&&!(0,h.isEmpty)(e)){if(e.meetingUrl){if(e.meetingCode){let i=new URL((0,I.D)(this.config.meetingIdCloudRegex(),this.config.meetingIdPrefixToCloud(),this.config.cloudToDomain(),this.deeplinkBaseUrl,e.meetingCode)).hostname,n=new URL(e.meetingUrl).hostname;if(i!==n&&t){let e=`original: ${n}, new: ${i}`;this.logger.info(e),t.mark(T.ck.CorrectedMeetingCloud,{reasonCMD:e})}}else{let t=new RegExp(this.config.meetingIdFromLinkRegex()).exec(e.meetingUrl),i=t?.groups?.meetingId;i?e.meetingCode=i:this.logger.warn(`Failed to extract meetingId from meetingUrl ${e.meetingUrl}`)}if(!e.passcode){let t=new RegExp(this.config.passcodeFromLinkRegex()).exec(e.meetingUrl),i=t?.groups?.passcode;i?e.passcode=i:this.logger.warn(`Failed to extract passcode from meetingUrl ${e.meetingUrl}`)}}(e.meetingUrl||e.meetingCode)&&(e.meetingUrl=(0,I.n)(this.config.meetingIdCloudRegex(),this.config.meetingIdPrefixToCloud(),this.config.cloudToDomain(),this.deeplinkBaseUrl,e.meetingCode,e.passcode))}}recalculateIsPopoutForIncomingPSTNCallsUserEnabled(e){let t=()=>{let e=this.myUserPreferencesStore.getUserPreferences(),t=e?.applicationIntegrationEnabled;this._isPopoutForIncomingPSTNCallsUserEnabled=!0===t};e?this.myUserPreferencesStore.waitForPreferenceStoreToInitialize().then(()=>{t()}).catch(e=>{this.logger.error(`Failed to initialize user preference store: ${e}`),t()}):t()}setE2EEEnabled(e){this.isE2EEEnabledByUser=e,this.logger.infoToTelemetry?.(`[E2EE_CALLING_DEBUG] [setE2EEEnabled] _isE2EEEnabledByUser set to: ${e}`,"e2ee_calling_debug",void 0,!0),this.clientDatabase.provider.put(u.v.Stores.internaldata.name,[{id:this.e2eeSettingDBKey,value:e}]).catch(e=>{this.logger.error(`updating e2ee setting failed ${e}`)}),this.eventingService.emit(p.gT.events.calling.accountConfigE2EEUpdated),this.config.e2eeReadSettingFromBVD()&&this.helpers.setE2EESettingToServer(e).catch(e=>{this.logger.warn(`[setE2EESettingFromServer] Error: ${e&&e.message||"unknown"}`)})}setIsPPTWPMinElectronVersionAvailable(){if(this.isPPTWPMinElectronVersionAvailable=void 0,this.platformDetectService.getOS()===p.gT.os.mac){this.logger.info("No MinElectronVersion required for Mac"),this.isPPTWPMinElectronVersionAvailable=!0;return}this.desktopUtilityService.getElectronAppVersionInfo().then(e=>{if(this.pptWeatherpersonMinElectronVersion&&e?.hostInfo?.version){let t=e.hostInfo.version;this.isPPTWPMinElectronVersionAvailable=this.utilityService.compareVersions(t,this.pptWeatherpersonMinElectronVersion)>=0,this.logger.info(`fetched electron version: ${t}. isPPTWPMinElectronVersionAvailable=${this.isPPTWPMinElectronVersionAvailable}`)}else this.logger.warn(`MinElectronVersion Setting or AppVersionInfo Not Valid: ${e}`),this.isPPTWPMinElectronVersionAvailable=!1}).catch(e=>{this.logger.error(`AppVersion Could Not be fetched. err: ${e}`),this.isPPTWPMinElectronVersionAvailable=!1})}setIsPopoutForIncomingPSTNCallsUserEnabled(e){let t=S.z.ApplicationIntegrationEnabled;return this.myUserPreferencesStore.setUserPreference(t,e.toString()).then(()=>{this._isPopoutForIncomingPSTNCallsUserEnabled=e}).catch(e=>(this.logger.error(`Failed to set browser popout setting ${e}`),Promise.reject(e)))}setWeatherpersonCapable(e){this._weatherpersonCapable=e}shouldAllowCalling(e){return!!this.isCallingEnabledInVdi()&&(e===v.G.OneToOneCall?this.isOneOnOneCallingEnabled():e===v.G.GroupCall?this.isSupportedEnvironment()&&this.isGroupCallingEnabled():this.isSupportedEnvironment())}shouldAllowCallingFromIntent(e){if(!this.isCallingEnabledInVdi())return!1;switch(e){case v.G.OneToOneCall:return this.isOneOnOneCallingEnabled();case v.G.GroupCall:return this.isSupportedEnvironment()&&this.isGroupCallingEnabled();case v.G.Meeting:return this.isSupportedEnvironment();case v.G.OngoingCall:return!0;default:return!e}}shouldAllowCallingInVdiAsync(e,t=5e3){if(!this.desktopUtilityService.isWebRTCVdiMode())return Promise.resolve(!1);if(!1===this.config.vdi.isCallingDisabled())return Promise.resolve(this.shouldAllowCalling(e));let i=Math.ceil(t/300),n=1,a=r=>{this.utilityService.setTimeoutMs(()=>!1===this.config.vdi.isCallingDisabled()?r(this.shouldAllowCalling(e)):n<i?void(n++,a(r)):(this.logger.error(`[shouldAllowCallingInVdiAsync] Max wait time of ${t}ms exceeded, calling in VDI is not available.`),r(!1)),300)};return new Promise(e=>a(e))}shouldCleanupNativeRenderingResources(e){let t=this.platformDetectService.getOS();return this.logger.info(`shouldCleanupNativeRenderingResources: osName=${t}, haveRemainingNativeCompositors=${e}`),t===p.gT.os.mac||!e}shouldShowCallingApp(){let e=this.aggregatedSettingsStore.getSettings();return e&&(this.recalculateIsPstnCallingAllowed(e),this.recalculateIsEvEnabled(e),this.recalculateIsDelegationAllowed(e),this.recalculateIsCallGroupsAllowed(e),this.recalculateIsForwardingToUserAllowed(e),this.recalculateIsForwardingToPhoneAllowed(e),this.recalculateIsVoicemailAllowed(e),this.recalculateCountryEnforcedLbrUser(e),this.recalculateIsMultilineUser(e),this.recalculateUserPrimaryPhoneNumber(e)),this.isCallingAllowed()&&(this.isPSTNCallingAllowed()||this.config.enableVoipCallTab())&&this.config.enableAppBarCalling()}isRaiseHandsEnabledForStreaming(){return void 0!==this.enableRaiseHandsForStreaming||(this.enableRaiseHandsForStreaming=this.serviceProvider.slimcoreEcsConfigService().getSetting("enableInteractivityForStreamingUsers"),this.logger.info("enableInteractivityForStreamingUsers From Slimcore: enableRaiseHandsForStreaming ",this.enableRaiseHandsForStreaming)),this.enableRaiseHandsForStreaming}shouldShowRoster(e){return!b.eU.isEchoBotCall(e)&&(this._isTFLRenderer||!b.eU.isSkypeConsumerCall(e))}shouldShowShareInviteOnLanding(){return!this.platformDetectService.isConferenceRoomDevice()&&this.config.enableMeetNowShareInviteOnLanding()}shouldShowShareInviteOnRoster(){return!this.platformDetectService.isConferenceRoomDevice()&&(this.identityService.isFreemiumTenant()?this.config.enableFreemiumFastTrack()&&!this.myUserPreferencesStore.getUserPreferences().suggestedContacts:this.config.enableMeetNowShareInvite())}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}useRequestedConstraintsForGetUserMedia(){return this.isWebRtc&&this.enableRequestedConstraintsForGetUserMedia}isExternalTenantContentSharingDisabled(e){if(!this.config.disableContentSharingExternalTenant?.())return!1;let t=e?.participantType,i=e?.meetingDetails?.meetingType,n=i&&(i===C.I6[C.I6.Scheduled]||i===C.I6[C.I6.Recurring]),a=this.meetingPolicySettingsStore.getSettings(),r=a?.contentSharingInExternalMeetings;return!!this.isTPProtection&&!!r&&!!t&&!!n&&this.getContentSharingStatus(t,r)}async supportedMulticamFeedsAsync(){if("number"!=typeof this._multicamSupportedFeeds){await this.serviceProvider.callingAgentsService().whenMediaLoaded();let e=this.config.multicam.enable(),t=this.desktopUtilityService.getSlimCoreVersion(),i=this.utilityService.compareVersions(t,this.config.multicam.minSlimcoreVersion())>=0;this._multicamSupportedFeeds=e&&i?4:0,this.logger.info(`Multicam: enabled=${e}, mediaSupported=${i} (v${t}) => supportedFeeds=${this._multicamSupportedFeeds}`)}return this._multicamSupportedFeeds}recalculateIsPstnCallingAllowed(e){if(!e)return;let t=this._isPSTNCallingAllowed;this.recalculateIsCallingAllowed(e);let i=this.isCallingAllowed(),{isPstnCallingAllowed:n,pstnLogData:a}=this.enableSimplifiedPSTNCheck()?this.calculateIsPstnCallingAllowedV2(e):this.calculateIsPstnCallingAllowed(e),r=this.getAggregatedSettingValue(e,"callingPolicy","allowWebPSTNCalling"),o=this.config.enableAllowWebPSTNCalling(),s=this.isDisablePstnCallingForCountryEnforcedMobileLbrUser();this._isPSTNCallingAllowed=i&&n&&(r||!o||!this.isWeb)&&!s;let l={isCallingAllowed:i,...a,allowWebPSTNCalling:r,enableAllowWebPSTNCalling:o,isWeb:this.isWeb,result:this._isPSTNCallingAllowed};this.triggerForAllowedFlagUpdated("isPSTNCallingAllowed",l,t,this._isPSTNCallingAllowed,E.Type_isPstnCallingAllowedChanged)}recalculateIsMultilineUser(e){if(!e)return void this.logger.warn("recalculateIsMultilineUser: aggregatedSettings is null");if(!this.config.enableMultilineCalling())return void this.logger.info("recalculateIsMultilineUser: enableMultilineUser FF is disabled");let t=this.isMultilineUser(),i=this.getAggregatedSettingValue(e,"teamsUserPhoneNumbers","phoneNumbers",[]);this._isMultilineUser=b.eU.isMultilineUser(i),this.logger.info(`recalculateIsMultilineUser: oldIsMultilineUser=${t}, isMultilineUser=${this.isMultilineUser()}`),this.triggerForAllowedFlagUpdated("isMultilineUser",{result:this._isMultilineUser},t,this._isMultilineUser,E.Type_isMultilineUserChanged)}recalculateUserPrimaryPhoneNumber(e){if(!e)return void this.logger.warn("recalculateUserPrimaryPhoneNumber: aggregatedSettings is null");if(!this.config.enableMultilineCalling())return void this.logger.info("recalculateUserPrimaryPhoneNumber: enableMultilineCalling FF is disabled");let t=this._userPrimaryPhoneNumber,i=this.getAggregatedSettingValue(e,"teamsUserPhoneNumbers","phoneNumbers",[]);this._userPrimaryPhoneNumber=b.eU.getPrimaryPhoneNumber(i),this.logger.info(`recalculateUserPrimaryPhoneNumber: oldUserPrimaryPhoneNumber=${t}, userPrimaryPhoneNumber=${this.getUserPrimaryPhoneNumber()}`)}recalculateCountryEnforcedLbrUser(e){if(!e)return void this.logger.warn("recalculateCountryEnforcedLbrUser: aggregatedSettings is null");if(!this.config.enableCountryEnforcedLbr())return void this.logger.info("recalculateCountryEnforcedLbrUser: enableCountryEnforcedLbr FF is disabled");let t=this.isCountryEnforcedLbrUser(),i=this.isCountryEnforcedMobileLbrUser(),n=this.config.supportedEnforcedLbrCountries(),a=this.getAggregatedSettingValue(e,"teamsUserPhoneNumbers","phoneNumbers",[]);this._isCountryEnforcedLbrUser=b.eU.isCountryEnforcedLbrUser(a,n),this._isCountryEnforcedMobileLbrUser=b.eU.isCountryEnforcedMobileLbrUser(a,n),this.logger.info(`isCountryEnforcedLbrUser: ${this.isCountryEnforcedLbrUser()} isCountryEnforcedMobileLbrUser: ${this.isCountryEnforcedMobileLbrUser()}`);let r={result:this.isCountryEnforcedLbrUser()},o={result:this.isCountryEnforcedMobileLbrUser()};this.triggerForAllowedFlagUpdated("isCountryEnforcedLbrUser",r,t,this._isCountryEnforcedLbrUser,E.Type_isCountryEnforcedLbrUserChanged),this.triggerForAllowedFlagUpdated("isCountryEnforcedMobileLbrUser",o,i,this._isCountryEnforcedMobileLbrUser,E.Type_isCountryEnforcedMobileLbrUserChanged)}trigger(e,t,i){return this.asObservable.trigger(e,t,i)}updateSettings(){this.isMultiWindowEnabled=this.callingMultiWindowService.isModernCallingEnabled(),this.oneOnOneCallingEnabled=this.config.isOneOnOneCallingEnabled(this.browser),this.callingEnableSafariBigSMultipartyVideo=this.config.enableCallingSafariBigSMultipartyVideo(),this.isWebRtcVideoOneOnOneEnabled=this.config.isWebRtcVideoOneOnOneEnabled(this.browser),this.isWebRtcVideoMultipartyEnabled=this.config.isWebRtcVideoMultipartyEnabled(this.browser),this.isWebRtcMeetingSingleVideoEnabled=this.config.isWebRtcMeetingSingleVideoEnabled(this.browser),this.isWebRtcMultipleOutgoingVideoEnabled=this.config.isWebRtcMultipleOutgoingVideoEnabled(this.browser),this.enableRequestedConstraintsForGetUserMedia=this.config.enableRequestedConstraintsForGetUserMedia(),this.enableSfBDeeplinking=this.config.enableSfBDeeplinking(),this.enablePreJoinContentOnly=this.config.enablePreJoinContentOnly(),this.enablePreJoinContentOnlyWeb=this.config.enablePreJoinContentOnlyWeb(),this.enableMeetingPreJoinExperience=this.config.enableMeetingPreJoinExperience(),this.enablePowerPointSharing=this.config.enablePowerPointSharing(),this.enableBackgroundBlurringAPIV2=this.config.enableBackgroundBlurringAPIV2(),this.enableVideoBackgroundForWeb=this.config.enableVideoBackgroundForWeb(),this.enableQuickJoinWithoutModality=this.config.enableQuickJoinWithoutModality(),this.enableQuickJoinWithoutModalityAnon=this.config.enableQuickJoinWithoutModalityAnon(),this.enableQuickJoinWithoutModalityWeb=this.config.enableQuickJoinWithoutModalityWeb(),this.enableCallPreHeatDesktop=this.config.enableCallPreHeatDesktop(),this.enableCallPreHeatWeb=this.config.enableCallPreHeatWeb(),this.enableBreakoutRoomsDesktop=this.config.enableBreakoutRoomsDesktop(),this.enableBreakoutRoomsWeb=this.config.enableBreakoutRoomsWeb(),this.enableBreakoutRoomsAnon=this.config.enableBreakoutRoomsAnon(),this.breakoutRoomsSlimcoreVersion=this.config.breakoutRoomsSlimcoreVersion(),this.enableParticipantsMoveWithoutSendingInvites=this.config.enableParticipantsMoveWithoutSendingInvites(),this.enableBreakoutRoomsSelfSelect=this.config.enableBreakoutRoomsSelfSelect(),this.enablePlazaParticipants=this.config.enableCallingRosterPlaza(),this.enableEnforceAllowUserChatPolicy=this.config.enableEnforceAllowUserChatPolicy(),this.pptWeatherpersonMinElectronVersion=this.config.pptWeatherpersonMinElectronVersion(),this.pptCameoMinSlimcoreVersion=this.config.pptCameoMinSlimcoreVersion(),this.eventDrivenCompositorMinSlimcoreVersion=this.config.eventDrivenCompositorMinSlimcoreVersion(),this.eventDrivenCompositorMinElectronVersion=this.config.eventDrivenCompositorMinElectronVersion(),this.videoExtensibilityMinElectronVersion=this.config.videoExtensibilityMinElectronVersion(),this.videoExtensibilityMinSlimcoreVersion=this.config.videoExtensibilityMinSlimcoreVersion(),this.videoExtensibilityMinSlimcoreVersionForMac=this.config.videoExtensibilityMinSlimcoreVersionForMac(),this.videoExtensibilityMinDeviceMemory=this.config.videoExtensibilityMinDeviceMemory(),this.videoExtensibilityMinHardwareConcurrency=this.config.videoExtensibilityMinHardwareConcurrency(),this.avatarMinSlimcoreVersion=this.config.avatarMinSlimcoreVersion(),this.avatarMinDeviceMemory=this.config.avatarMinDeviceMemory(),this.avatarMinHardwareConcurrency=this.config.avatarMinHardwareConcurrency(),this.largeMeetingSettings=this.config.largeMeetingSettings(),this._isTFLRenderer=this.config.isTFLRenderer(),this._isRequestToSpeakFeatureEnabled=this.config.isRequestToSpeakFeatureEnabled(),this._allowUnrestrictWithoutRaisedHand=this.config.allowUnrestrictWithoutRaisedHand(),this._enableGroupRaiseHandsStateNotifications=this.config.enableGroupRaiseHandsStateNotifications(),this._enableAttendeeVideoRestriction=this.config.enableAttendeeVideoRestriction(),this._enableRestrictingAnAttendeeAudio=this.config.enableRestrictingAnAttendeeAudio(),this._enablePtzCameraController=this.config.enablePtzCameraController(),this._enableRestrictingAnAttendeeVideo=this.config.enableRestrictingAnAttendeeVideo(),this._enableRaiseHandReceivedScenario=this.config.enableRaiseHandReceivedScenario(),this._enableStandardizingCallingConversationMixin=this.config.enableStandardizingCallingConversationMixin(),this._isImmersiveViewEnabled=this.config.isImmersiveViewEnabled(),this.enableAplT2=this.config.enableAplT2?.(),this.maxItemsOnStage=this.getMaxNrOfStageItems(),this.maxPinnedItems=this.config.enableVideoStage()||this.config.enable3x3VideoLayout()?A.STAGE_3x3:A.ORIGINAL,this.enableTransferAndCompanion=this.config.enableTransferAndCompanion(),this.enableCallTransferAndCompanion=this.config.enableCallTransferAndCompanion(),this.useAPCToBlockAVOverIPInMeetings=this.config.isUseAPCToBlockAVOverIPInMeetingsEnabled(),this.enableIPAudioVideoModes=this.config.isIPAudioVideoModesEnabled(),this.deeplinkBaseUrl=this.config.deeplinkBaseUrl(),this.isTflUser=this.config.isTflUser(),this.retrieveSSFCMeetingPolicyFlagValue()}_areNativeRenderingConfigsSupported(e){let{backgroundColor:t}=e,i=this.config.nativeRenderer.minSlimcoreVersionForBackgroundColor(),n=this.desktopUtilityService.getSlimCoreVersion();return!(t&&0>this.utilityService.compareVersions(n,i))}_shouldEnableLiveEventsUnification(){let e=this.browser===p.gT.browser.firefox,t=this.browser===p.gT.browser.safari;return(!e||!!this.config.enableLiveEventsUnificationForFirefox())&&(!t||!!this.config.enableLiveEventsUnificationForSafari())&&!!(this.config.enableLiveEventsUnification()&&this.serviceProvider.slimcoreEcsConfigService().getSetting("enableUnifiedStack"))}getContentSharingStatus(e,t){let i={default:!1,[m.xXJ.Disabled]:[m.AVy.Federated,m.AVy.NonFederated,m.AVy.CrossCloudAuthenticated].includes(e),[m.xXJ.EnabledForTrustedOrgs]:[m.AVy.NonFederated,m.AVy.CrossCloudAuthenticated].includes(e)};return i[t]||i.default}_isComposerFor1ViewEnabled(e){if(e?.teamsCallType!==g.CallType.P2P)return!0;let t=this.config.nativeRenderer.minSlimcoreVersionFor1View();return this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),t)>=0}_isNativeRenderingAvailableOnOs(e){let t=this.config.nativeRenderer.minSlimcoreVersion(e);if(!(t&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),t)>=0))return this.logger.info("isNativeRendererEnabled: isMinSlimcoreVersion=false"),!1;switch(e){case p.gT.os.windows:let i=this.desktopUtilityService.isGpuCompositingEnabled(),n=this.config.nativeRenderer.minWindowsVersion(),a=Number(this.platformDetectService.getOSVersion())>=n;return this.logger.info(`isNativeRendererEnabled: isGpuCompositingEnabled=${i}; isMinOsVersion=${a}`),i&&a;case p.gT.os.mac:return!0;default:return!1}}_subscribeToVdi1Connection(){if(!this.vdi1ClientConnectedObservable)return void this.logger.info("[_subscribeToVdi1Connection] VDI 1.0 Connected State observable not available - will not recalculate isPstnCallingAllowed on VDI 1.0 connection");this.clientConnectedSubscriptionVDI1=this.vdi1ClientConnectedObservable.subscribe(e=>{this.logger.info("[_subscribeToVdi1Connection] Received VDI 1.0 Connected State event - recalculating isPstnCallingAllowed"),this.recalculateIsPstnCallingAllowed(this.aggregatedSettingsStore.getSettings()),this.clientConnectedSubscriptionVDI1?.unsubscribe()},e=>{this.logger.error(`[_subscribeToVdi1Connection] error waiting for VDI 1.0 connection to recalculate isPstnCallingAllowed ${e}`)})}addParticipantNotAllowedWithLog(e,t){return this.logger.info(`Adding participant not allowed: ${e}. ${t?`Call id: ${t.callId}`:""}`),!1}allowAddingParticipants(e,t){return!e.isOneToOne()||(e.isOneToOnePstn()&&!this.allowOneToPSTNCallEscalation()?this.addParticipantNotAllowedWithLog("PSTN esc.",t):!e.isOneToOnePstn()&&b.eU.isDownlevelCall(t)?this.addParticipantNotAllowedWithLog("down level call esc.",t):e.isOneToOneFederated()&&!this.config.enableAddParticipantForOneToOneExternal()?this.addParticipantNotAllowedWithLog("federated call esc. ",t):this.config.enableCallEscalation()?t.state!==g.CallState.Connected?this.addParticipantNotAllowedWithLog("not connected",t):!t.threadId||this.addParticipantNotAllowedWithLog("thread id",t):this.addParticipantNotAllowedWithLog("esc. disabled",t))}doesEdgeSupportVideoExtensibility(){let e=this.desktopUtilityService?.getDesktopVersion!=null?this.desktopUtilityService.getDesktopVersion():"0";this.logger.info(`[doesEdgeSupportVideoExtensibility] desktopVersion: ${e}`);let t=this.utilityService.compareVersions(null!=e?e:"0","24151.2105.2943.2101")>=0;return!(parseInt(this.platformDetectService.getBrowserVersion().split(".")[0],10)>=this.config.videoExtensibilityEdgeMajorVersionRequiringJuneAFix()&&!t)}allowOneToPSTNCallEscalation(){return this.config.enableOneToPSTNCallEscalation()&&!this.isLbrEnabledUser()}calculateIsPstnCallingAllowed(e){let t=this.config.readIsSfbCloudFromVoiceSettings()?this.getAggregatedSettingValue(e,"voiceAdminSettings","isSfbCloud"):this.getAggregatedSettingValue(e,"userResourcesSettings","isSfbCloud"),i=this.getAggregatedSettingValue(e,"voiceAdminSettings","isEvEnabled"),n=this.config.disableCallingForHybridVoice(),a=this.getAggregatedSettingValue(e,"tenantVoiceSettings","pstnType","Unknown"),r="Online"===a,o=this.getAggregatedSettingValue(e,"policySettings","byot"),s=!!o&&o.isByotEnabled;return{isPstnCallingAllowed:t&&i&&(r||!n||s),pstnLogData:{isSfbCloud:t,isEvEnabled:i,disableCallingForHybridVoice:n,pstnType:a,isBusinessVoicePath:r,isByotEnabled:s}}}calculateIsPstnCallingAllowedV2(e){let t=this.getAggregatedSettingValue(e,"voiceAdminSettings","accountType","Unknown");if("Unknown"===t){let t=this.calculateIsPstnCallingAllowed(e);return this.logger.warnToTelemetry?.("accountType is unknown. Falling back to using isSfbCloud and isByotEnabled to evaluate isPstnCallingAllowed.","calling_unknown_account_type",{...t.pstnLogData},!0),t}let i=this.getAggregatedSettingValue(e,"voiceAdminSettings","isEvEnabled");return{isPstnCallingAllowed:i&&"User"===t,pstnLogData:{isEvEnabled:i,accountType:t}}}isLegacyMeeting(e){return!e||e.joinType!==f.c.MeetingData}checkIfMacOsBigSur(){if(this.browser===p.gT.browser.safari&&this.platformDetectService.getOS()===p.gT.os.mac){if(this.osVersion>=11){this.isMacOsBigSur=!0;return}let e=new Image;e.onload=()=>{this.isMacOsBigSur=!0},e.src="data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAACyAgCdASoBAAEALmk0mk0iIiIiIgBoSygABc6zbAAA/v56QAAAAA=="}}enableSimplifiedPSTNCheck(){return this.config.enableSimplifiedPSTNCheck&&this.config.enableSimplifiedPSTNCheck()}getAggregatedSettingValue(e,t,i,n=null){let a=`${t}.value.${String(i)}`;return(0,h.get)(e,a,n)}getCachedIsWebGLForVideoExtensibilityEnabled(){return void 0===this.isWebGLForVideoExtensibilityEnabled&&(this.isWebGLForVideoExtensibilityEnabled=this.getIsWebGLForVideoExtensibilityEnabled()),this.isWebGLForVideoExtensibilityEnabled}async getCallTypeForCallAsync(e){if(e.teamsCallType===g.CallType.Unknown){let t=await this.getConversationAsync(e.conversationId);if(t)return t.isOneOnOne()?g.CallType.P2P:g.CallType.Conference}return e.teamsCallType}async getConversationAsync(e){return e&&await this.conversationsAsyncService.getConversation(e)}getFormattedPhoneNumber(e){let t="";if(this.logger.info("Found user number [phonenumber]"),e&&-1===e.indexOf("+")){this.logger.info("Found user number. Formatting to current locale [phonenumber]");try{let i=this.config.getLocale().split("-"),n=i.length>1?i[1]:"US",a=this.phoneUtil.parse(e,n);t=this.phoneUtil.format(a,m.M9W.NATIONAL)}catch(e){this.logger.warn("failed to parse current user's phone number [phonenumber]")}}else this.logger.info("Phone number was already when it was retrieved [phonenumber]"),t=e;return t}getIsWebGLForVideoExtensibilityEnabled(){let e=this.loggingService.newScenario(T.RG.GetIsWebglForVideoExtensibilityEnabled),t=document.createElement("canvas"),i=document.createElement("canvas"),n=t.getContext("webgl"),a=i.getContext("webgl2"),r=!!n&&!!a;return e.stop({message:`isWebGLForVideoExtensibilityEnabled = ${r}`}),this.logger.info(`[VideoExt] WebGL capability for video extensibility is ${r}`),!!r||(this.logger.warn("[VideoExt] WebGL is not supported because context is not existed."),!1)}getNavigator(){return this.webApiService.getWindow().navigator}getPhoneNumberFromPeopleProfile(e,t){let i=this.promiseFactory.createDeferred(),n=this.sxConfig.getCurrentSkypeMri();return this.promiseFactory.finalized(this.peopleService.getPeopleProfile(n,e,!1).then(e=>{this.phoneNumber=this.getFormattedPhoneNumber(e.telephoneNumber)}),()=>{(0,h.isEmpty)(this.phoneNumber)?(this.logger.info("Empty phone number fetched from PeopleProfile [phonenumber]"),t.mark(T.ck.EmptyInAad),t.stop()):(this.logger.error("Found phone number in AAD but not in BVD [phonenumber]"),t.fail({[p.gT.counters.eventNames.terminatedReason]:`Found phone number in AAD but not in BVD for user.mri ${n} [phonenumber]`})),i.resolve()}),i.promise}getPhoneNumberFromVoiceSettingsStore(e){let t=this.loggingService.newScenario(T.RG.FetchPhoneNumber);return this.promiseFactory.finalized(this.voiceSettingsStore.ensureInitAndGetSettingValue("phoneNumber").then(e=>{this.phoneNumber=this.getFormattedPhoneNumber(e)}),()=>{(0,h.isEmpty)(this.phoneNumber)?(this.logger.info("Empty phone number fetched from voiceSettingsStore [phonenumber]"),t.mark(T.ck.EmptyInBvd),this.promiseFactory.finalized(this.getPhoneNumberFromPeopleProfile(e,t),()=>this.getPhoneNumberDeferred.resolve(this.phoneNumber))):(this.logger.info("Phone number successfully fetched from voiceSettingsStore [phonenumber]"),this.getPhoneNumberDeferred.resolve(this.phoneNumber),t.stop())}),this.getPhoneNumberDeferred.promise}getWatermarkCustomizationSettings(e){let t=s.Tiled,i={opacity:this._watermarkScreenShareCustomizationSettings?.opacity??30,pattern:this._watermarkScreenShareCustomizationSettings?.pattern??t},n={opacity:this._watermarkVideoCustomizationSettings?.opacity??30,pattern:this._watermarkVideoCustomizationSettings?.pattern??t};if(e?.waterMarkCapability){let{waterMarkCapability:t}=e;if(this._allowWatermarkScreenShareCustomization){let e=t.vbssSettings??{};i.opacity=e.opacity??i.opacity,i.pattern=e.pattern??i.pattern}if(this._allowWatermarkVideoCustomization){let e=t.videoSettings??{};n.opacity=e.opacity??n.opacity,n.pattern=e.pattern??n.pattern}}return{screenshareSettings:i,videoSettings:n}}async handleLocationResponse(e){if(this.config.enableCountryEnforcedLbr()&&this.isCountryEnforcedMobileLbrUser()){let t=this.config.supportedEnforcedLbrCountries();if(this.updateUserCurrentLocation(e,t),this.config.enableCountryEnforcedLbrPstnCallingCheck()){this.logger.info(`[LBR] location response detected. Recalculate isPstnCallingAllowed. [userCurrentCountryLocation=${this._userCurrentCountryLocation}]  [supportedEnforcedLbrCountries=${t}].]`);let e=this.aggregatedSettingsStore.getSettings();this.recalculateIsPstnCallingAllowed(e)}this.config.enableCountryEnforcedLbrLocationBanner()&&("HomeCountry"!==this._userCurrentCountryLocation?(this.helpers.notifyOnLocationChange?.(this._userCurrentCountryLocation,this.logger).then(e=>this._bannerObject=e),this.logger.info("[LBR] No home country location found in location response. Display location banner.]")):this._bannerObject&&(this._bannerObject.hide(),this._bannerObject=null,this.logger.info("[lbr] Home location found in location response. Automatically dismiss location banner if not already dismised by user.]")))}}isAddingParticipantAllowedInternal(e,t){return!t.isFederated()||t.isMeeting()||this.config.enableAddParticipantForOneToOneExternal()?b.eU.isVoicemailGreetingCall(e)||b.eU.isParkCall(e)||b.eU.isIncomingConsultCall(e)?this.addParticipantNotAllowedWithLog("type not supported",e):e.isEmergencyCall?this.addParticipantNotAllowedWithLog("emergency call",e):e.state===g.CallState.InLobby?this.addParticipantNotAllowedWithLog("call in lobby",e):this.allowAddingParticipants(t,e):this.addParticipantNotAllowedWithLog("can't add federated",e)}isCallingEnabledInVdi(){return!(this.config.vdi.isCallingDisabled()||this.desktopUtilityService.isUnoptimizedVDI()&&this._areAllModalitiesDisabledInVdi)}isComposerRendererEnabledInternal(e){if(this.isMultipleNativeCompositorsSupported())return!0;let t=this.desktopUtilityService.getSystemProductName(),i=this.config.productNamesToDisableSingleComposerRegExps(),n=this.config.productNamesToEnableSingleComposerRegExps(),a=(0,h.some)(i,e=>new RegExp(e).test(t)),r=(0,h.some)(n,e=>new RegExp(e).test(t)),o=this.config.singleComposerMinSlimcoreVersion(),s=!!o&&this.utilityService.compareVersions(this.desktopUtilityService.getSlimCoreVersion(),o)>=0,l=this.serviceProvider.callingAgentsService().isCompositorAvailable(),c=this._isComposerFor1ViewEnabled(e),d=this.config.enableSingleComposerFeature(),g=!a&&!this.isPluginless&&l&&(!e||!e.isBroadcast&&!e.broadcastMeeting)&&c&&(d||r)&&s;return this.logger.info(`isComposerRendererEnabled: isComposerRendererEnabled=${g}; enableSingleComposerFeature=${d}; forceEnableSingleComposer=${r}; forceDisableSingleComposer=${a}; isCompositorAvailable=${l}isComposerFor1ViewEnabled=${c}; isMinSlimcoreVersion=${s};isNotPluginless=${!this.isPluginless}; isNotBroadCast=${!e||!e.isBroadcast&&!e.broadcastMeeting}`),g}isDisablePstnCallingForCountryEnforcedMobileLbrUser(){return!!this.config.enableCountryEnforcedLbr()&&!!this.config.enableCountryEnforcedLbrPstnCallingCheck()&&!!this.isCountryEnforcedMobileLbrUser()&&"HomeCountry"!==this._userCurrentCountryLocation}isGroupCallingEnabled(){return!(!this.config.enableDecouplingGroupCallFromChat()&&this.isEnforceAllowUserChatPolicyEnabled())||!!this._allowUserChat}isMemoryQualifiedForAvatar(){let e=this.config.totalMemoryInBytes?.()||this.getNavigator()?.deviceMemory*0x40000000;return this.logger.info(`device total memory in bytes: ${e}`),e>=0x40000000*this.avatarMinDeviceMemory}isOnAirSupportedPlatform(){return this.logger.info(`enableOnAirOnWinOS is ${this.config.enableOnAirOnWinOS()}`),this.platformDetectService.getOS()===p.gT.os.windows&&!!this.config.enableOnAirOnWinOS()&&!(this.isPluginless||this.isRigel||this.isSurfaceHub1)}async isOneOnOne(e){let t=await this.getConversationAsync(e);return t&&t.isOneOnOne()}isVDISingleOutgoingVideo(){return!(this.config.vdi.isWebRTC1Dot0Supported()&&this.isWebRtcMultipleOutgoingVideoEnabled)}isWebRtcSingleOutgoingVideo(){return this.isWebRtc&&!this.isWebRtcMultipleOutgoingVideoEnabled}isWebRtcVideoEnabled(e){switch(e){case g.CallType.P2P:return this.isWebRtcVideoOneOnOneEnabled;case g.CallType.Conference:if(this.isMacOsBigSur)return this.callingEnableSafariBigSMultipartyVideo;return this.isWebRtcVideoMultipartyEnabled;default:return!1}}isWebview2TextureStreamAvailable(){let e=this.webApiService.getWindow().chrome?.webview;return!!e&&"function"==typeof e.registerTextureStream&&"function"==typeof e.getTextureStream}loggingAvatarEnabledInfo(e,t,i){this.logger.infoToTelemetry?this._lastAvatarEnabledMessageToTelemetry===e?this.logger.info(e):(this.logger.infoToTelemetry(e,"is_avatar_enabled",t,i),this._lastAvatarEnabledMessageToTelemetry=e):this.logger.info(e)}recalculateAllowCloudRecordingForCalls(e){this._isCloudRecordingForCallsEnabled=this.getAggregatedSettingValue(e,"callingPolicy","allowCloudRecordingForCalls",!1)}recalculateAllowPrivateMeetNow(e){if(!e)return;let t=this._allowPrivateMeetNow;this._allowPrivateMeetNow=e.allowPrivateMeetNow;let i={result:this._allowPrivateMeetNow};this.triggerForAllowedFlagUpdated("allowPrivateMeetNowEnabled",i,t,this._allowPrivateMeetNow,E.Type_allowPrivateMeetNowChanged)}recalculateAllowUserChat(e){this._allowUserChat=e.allowUserChat,this.logger.info(`Allow user chat policy recalculated: allowUserChat=${this._allowUserChat}`)}recalculateAllowWatermarkCustomization({allowWatermarkCustomizationForScreenSharing:e,allowWatermarkCustomizationForCameraVideo:t,watermarkForScreenSharingOpacity:i,watermarkForScreenSharingPattern:n,watermarkForCameraVideoOpacity:a,watermarkForCameraVideoPattern:r}){let o=e=>{switch(e){case"Single":return s.Single;case"Repeated":return s.Tiled;default:return}};this._allowWatermarkScreenShareCustomization=e,this._allowWatermarkVideoCustomization=t,this._watermarkScreenShareCustomizationSettings={opacity:i,pattern:o(n)},this._watermarkVideoCustomizationSettings={opacity:a,pattern:o(r)},this.logger.info(`Watermark customization policy recalculated: allowWatermarkScreenShareCustomization=${this._allowWatermarkScreenShareCustomization}, allowWatermarkVideoCustomization=${this._allowWatermarkVideoCustomization}, watermarkScreenShareCustomizationSettings=${JSON.stringify(this._watermarkScreenShareCustomizationSettings)}, watermarkVideoCustomizationSettings=${JSON.stringify(this._watermarkVideoCustomizationSettings)}`)}recalculateCallParkEnabled(e){let t=this.config.forceEnableCallPark();if(t){this._isCallParkEnabled=!0;return}if(!this.config.honorCallParkPolicy()||this.isElectronAppSurfaceHub){this._isCallParkEnabled=!1;return}let i=this._isCallParkEnabled;this._isCallParkEnabled=this.getAggregatedSettingValue(e,"callParkPolicy","allowCallPark");let n={forceEnableCallPark:t,isPSTNCallingAllowed:this.isPSTNCallingAllowed(),isCallingAllowed:this.isCallingAllowed(),result:this._isCallParkEnabled};this.triggerForAllowedFlagUpdated("isCallParkEnabled",n,i,this._isCallParkEnabled,E.Type_isCallParkEnabledChanged)}recalculateCallingBusyOnBusyPolicy(e){this._isBusyOnBusyAllowUserOverride="UserOverride"===this.getAggregatedSettingValue(e,"callingPolicy","busyOnBusyEnabledType","Disabled")}recalculateCallingEndtoEndEncryptionEnabledType(e){let t=this.getAggregatedSettingValue(e,"teamsEnhancedEncryptionPolicy","callingEndtoEndEncryptionEnabledType","Disabled");this._isE2EECallingAdminEnabled=this.config.enableIgnoreE2EEAdminSetting()||"Disabled"!==t,this.eventingService.emit(p.gT.events.calling.accountConfigE2EEUpdated)}recalculateCallingPstnCallRedirectionPolicy(e){this._isPstnCallRedirectionAllowUserOverride="UserOverride"===this.getAggregatedSettingValue(e,"callingPolicy","inboundPstnCallRoutingTreatment","RegularIncoming")}recalculateIPAudioVideoModes(e){if(this.logger.info("Recalculating IP audio/video modes policies with enableIPAudioVideoModes: {0}, meetingPolicySettings.ipAudioMode: {1}, meetingPolicySettings.ipVideoMode {2}",this.enableIPAudioVideoModes,e.ipAudioMode,e.ipVideoMode),this.enableIPAudioVideoModes){let t=e.ipAudioMode,i=e.ipVideoMode,n=!this.desktopUtilityService.isUnoptimizedVDI()||!(this._areAllModalitiesDisabledInVdi||this._areAudioVideoDisabledInVdi);this._isIPAudioModeEnabled="Disabled"!==t&&n,this._isIPVideoModeEnabled=this._isIPAudioModeEnabled&&"Disabled"!==i}else this._isIPAudioModeEnabled=!0,this._isIPVideoModeEnabled=!0;this.logger.info(`IP audio/video modes policies recalculated: isIPAudioModeEnabled=${this._isIPAudioModeEnabled}, isIPVideoModeEnabled=${this._isIPVideoModeEnabled}`)}get isVideoPolicyEnabled(){return!this.desktopUtilityService.isOptimizedVDI()||!!this.config.vdi.isVideoSupported()}get isIPVideoModeEnabled(){return this.isVideoPolicyEnabled&&!this.blockAVOverIPInMeetings()&&this._isIPVideoModeEnabled}recalculateIsCallGroupsAllowed(e){let t=this._isCallGroupsAllowed,i=this.config.honorAllowCallGroupsPolicy(),n=this.getAggregatedSettingValue(e,"callingPolicy","allowCallGroups",!1);this._isCallGroupsAllowed=(!i||n)&&this.isPSTNCallingAllowed();let a={isPSTNCallingAllowed:this.isPSTNCallingAllowed(),isAllowCallGroupsPolicyHonored:i,isCallGroupsAllowed:n,result:this.isCallGroupsAllowed};this.triggerForAllowedFlagUpdated("isCallGroupsAllowed",a,t,this.isCallGroupsAllowed,E.Type_isCallGroupsAllowedChanged)}recalculateIsCallingAllowed(e){if(!e)return;this.recalculateVdiCallingSettings(e);let t=this._isCallingAllowed,i=this.isSupportedEnvironment(),n=this.isOneOnOneCallingEnabled(),a=this.getAggregatedSettingValue(e,"callingPolicy","allowPrivateCalling"),r=!this.desktopUtilityService.isUnoptimizedVDI()||!(this._areAllModalitiesDisabledInVdi||this._areAudioVideoDisabledInVdi);this._isPrivateCallingAllowed=a&&r,this._isCallingAllowed=i&&n&&a&&r;let o={isCallingEnabledByTenant:a,isOneToOneCallingEnabled:n,isCallingSupportedEnvironment:i,isCallingAllowedInVdi:r,result:this._isCallingAllowed};this.triggerForAllowedFlagUpdated("IsCallingAllowedChanged",o,t,this._isCallingAllowed,E.Type_isCallingAllowedChanged)}recalculateIsDelegationAllowed(e){let t=this._isDelegationAllowed,i=this._isDelegationAllowedIgnoringPstn,n=this.config.honorAllowDelegationPolicy(),a=this.getAggregatedSettingValue(e,"callingPolicy","allowDelegation",!1);this._isDelegationAllowedIgnoringPstn=!n||a,this._isDelegationAllowed=this._isDelegationAllowedIgnoringPstn&&this.isPSTNCallingAllowed();let r={isPSTNCallingAllowed:this.isPSTNCallingAllowed(),isAllowDelegationPolicyHonored:n,isDelegationAllowed:a,result:this.isDelegationAllowed};this.triggerForAllowedFlagUpdated("isDelegationAllowed",r,t,this.isDelegationAllowed,E.Type_isDelegationAllowedChanged),this.triggerForAllowedFlagUpdated("isDelegationAllowedIgnoringPstn",r,i,this._isDelegationAllowedIgnoringPstn,E.Type_isDelegationAllowedIgnoringPstnChanged)}get allowUnrestrictWithoutRaisedHand(){return this._allowUnrestrictWithoutRaisedHand}get enableGroupRaiseHandsStateNotifications(){return this._enableGroupRaiseHandsStateNotifications}get isImmersiveViewEnabled(){return this._isImmersiveViewEnabled}get isAudioVideoDisabledInVdiByPolicy(){return this._areAllModalitiesDisabledInVdi||this._areAudioVideoDisabledInVdi}get isScreenshareDisabledInVdiByPolicy(){return this._areAllModalitiesDisabledInVdi}get systemAudioPlatformSupport(){if(this.desktopUtilityService.isOptimizedVDI())return this.config.enableShareSystemAudio()&&this.config.vdi.isShareSystemAudioSupported()?c.Builtin:c.NotSupported;if(!this.config.enableShareSystemAudio()||!this.isDesktopApp||this.blockAVOverIPInMeetings())return c.NotSupported;let e=this.config.getOsPlatform();if(e===C.NR.Windows)return c.Builtin;let t=this.config.minSlimcoreVersionForMacSsaDriver(),i=this.serviceProvider.callingAgentsService().getVersions(),n="unknown"===i.builtInSlimCore?i.slimCore:i.builtInSlimCore;return e===C.NR.Mac&&this.config.enableShareSystemAudioForMac()&&t&&this.utilityService.compareVersions(n,t)>=0?c.WithDriver:c.NotSupported}recalculateIsEvEnabled(e){let t=this._isEvEnabled,i=this.getAggregatedSettingValue(e,"voiceAdminSettings","isEvEnabled",!1);this._isEvEnabled=i;let n={isEvEnabled:i,result:this._isEvEnabled};this.triggerForAllowedFlagUpdated("isEvEnabled",n,t,this._isEvEnabled,E.Type_isEvEnabledChanged)}get enablePlazaSlimcoreFeatureFlag(){return void 0!==this.enablePlazaParticipantsSlimcore||(this.enablePlazaParticipantsSlimcore=this.serviceProvider.slimcoreEcsConfigService().getSetting("enableMappedParticipants",!1),this.logger.info(`enablePlazaParticipantsSlimcore set to ${this.enablePlazaParticipantsSlimcore}, defaultValueOverride: false`)),this.enablePlazaParticipantsSlimcore}get enableBreakoutRoomsSlimcoreFeatureFlag(){if(void 0!==this.enableBreakoutRoomsSlimcore)return this.enableBreakoutRoomsSlimcore;let e=this.serviceProvider.callingAgentsService().getVersions().slimCore,t=e&&this.breakoutRoomsSlimcoreVersion?e.substring(0,this.breakoutRoomsSlimcoreVersion.length)>=this.breakoutRoomsSlimcoreVersion:void 0;return this.enableBreakoutRoomsSlimcore=this.serviceProvider.slimcoreEcsConfigService().getSetting("enableBreakoutRooms",t),this.logger.info(`enableBreakoutRoomsSlimCore set to ${this.enableBreakoutRoomsSlimcore}, defaultValueOverride: ${t}`),this.enableBreakoutRoomsSlimcore}recalculateIsForwardingAllowed(){let e=this._isForwardingAllowed;this._isForwardingAllowed=this.isVoicemailAllowed||this.isForwardingToUserAllowed||this.isForwardingToPhoneAllowed||this.isCallGroupsAllowed||this.isDelegationAllowed;let t={isVoicemailAllowed:this.isVoicemailAllowed,isForwardingToUserAllowed:this.isForwardingToUserAllowed,isForwardingToPhoneAllowed:this.isForwardingToPhoneAllowed,isCallGroupsAllowed:this.isCallGroupsAllowed,isDelegationAllowed:this.isDelegationAllowed,result:this.isForwardingAllowed};this.triggerForAllowedFlagUpdated("isForwardingAllowed",t,e,this.isForwardingAllowed,E.Type_isForwardingAllowedChanged)}recalculateIsForwardingToPhoneAllowed(e){let t=this._isForwardingToPhoneAllowed,i=this.config.honorCallForwardPolicies(),n=this.getAggregatedSettingValue(e,"callingPolicy","allowCallForwardingToPhone",!1);this._isForwardingToPhoneAllowed=(!i||n)&&this.isPSTNCallingAllowed();let a={isPSTNCallingAllowed:this.isPSTNCallingAllowed(),isForwardingToPhonePolicyHonored:i,isForwardingToPhoneAllowed:n,result:this.isForwardingToPhoneAllowed};this.triggerForAllowedFlagUpdated("isForwardingToPhoneAllowed",a,t,this.isForwardingToPhoneAllowed,E.Type_isForwardingToPhoneAllowedChanged)}recalculateIsForwardingToUserAllowed(e){let t=this._isForwardingToUserAllowed,i=this.config.honorCallForwardPolicies(),n=this.getAggregatedSettingValue(e,"callingPolicy","allowCallForwardingToUser",!1);this._isForwardingToUserAllowed=(!i||n)&&this.isPSTNCallingAllowed();let a={isPSTNCallingAllowed:this.isPSTNCallingAllowed(),isForwardingToUserPolicyHonored:i,isForwardingToUserAllowed:n,result:this.isForwardingToUserAllowed};this.triggerForAllowedFlagUpdated("isForwardingToUserAllowed",a,t,this.isForwardingToUserAllowed,E.Type_isForwardingToUserAllowedChanged)}recalculateIsPopoutForIncomingPSTNCallsAllowed(e){if(this.config.enableBrowserPopoutForIncomingPSTNCalls()){let t=this._isPopoutForIncomingPSTNCallsAllowed,i="Enabled"===this.getAggregatedSettingValue(e,"callingPolicy","popoutForIncomingPstnCalls","Disabled"),n=this.getAggregatedSettingValue(e,"voiceAdminSettings","isEvEnabled");this._isPopoutForIncomingPSTNCallsAllowed=i&&n;let a={isEvEnabled:n,isPopoutForIncomingPSTNCallsPolicyEnabled:i,result:this._isPopoutForIncomingPSTNCallsAllowed};this.triggerForAllowedFlagUpdated("isPopoutForIncomingPSTNCallsAllowed",a,t,this._isPopoutForIncomingPSTNCallsAllowed,E.Type_isPopoutForIncomingPSTNCallsAllowedChanged)}}recalculateIsVoicemailAllowed(e){let t=this._isVoicemailAllowed,i=this.config.enableNoneEVVoicemail(),n="AlwaysDisabled"!==this.getAggregatedSettingValue(e,"callingPolicy","allowVoicemail","UserOverride");this._isVoicemailAllowed=n&&(this.isPSTNCallingAllowed()||this.isCallingAllowed()&&i);let a={isTenantVoicemailAllowed:n,isPSTNCallingAllowed:this.isPSTNCallingAllowed(),isCallingAllowed:this.isCallingAllowed(),isNoneEVVoicemailEnabled:i,result:this.isVoicemailAllowed};this.triggerForAllowedFlagUpdated("isVoicemailAllowed",a,t,this.isVoicemailAllowed,E.Type_isVoicemailAllowedChanged)}recalculateMeetingEndToEndEncryption(e){let t=this.getAggregatedSettingValue(e,"teamsEnhancedEncryptionPolicy","meetingEndToEndEncryption","Disabled");this._isE2EEMeetingAdminEnabled=this.config.enableIgnoreE2EEAdminSetting()||"Disabled"!==t}recalculateMusicOnHoldEnabledType(e){let t=this.getAggregatedSettingValue(e,"callingPolicy","musicOnHoldEnabledType","Enabled"),i=this.config.isMusicOnHoldAdminEnabled(),n=this._isMusicOnHoldAdminEnabled;this._isMusicOnHoldAdminEnabled=!i||"Disabled"!==t;let a={honorIsMusicOnHoldAdminEnabled:i,mohAdminSetting:t,result:this._isMusicOnHoldAdminEnabled};this.triggerForAllowedFlagUpdated("isMusicOnHoldAdminEnabled",a,n,this._isMusicOnHoldAdminEnabled,E.Type_isMusicOnHoldAdminEnabledChanged)}recalculatePopoutAppPathForIncomingPSTNCalls(e){let t=this.config.enableBrowserPopoutForIncomingPSTNCalls();if(this._isPopoutForIncomingPSTNCallsAllowed&&t){let i=this._popoutAppPathForIncomingPSTNCalls;this._popoutAppPathForIncomingPSTNCalls=this.getAggregatedSettingValue(e,"callingPolicy","popoutAppPathForIncomingPstnCalls","");let n={isPopoutForIncomingPstnCallsFeatureEnabled:t,isPopoutForIncomingPSTNCallsAllowed:this._isPopoutForIncomingPSTNCallsAllowed,result:this._popoutAppPathForIncomingPSTNCalls};this.triggerForAllowedFlagUpdated("popoutAppPathForIncomingPSTNCalls",n,i,this._popoutAppPathForIncomingPSTNCalls,E.Type_popoutAppPathForIncomingPSTNCallsChanged)}}recalculateScreenSharingModes(e){this._screenSharingMode=e.screenSharingMode,this.logger.info(`ScreenSharingModes policy recalculated: ScreenSharingMode=${this._screenSharingMode}`)}recalculateTeamsCameraFarEndPTZMode(e){this._teamsCameraFarEndPTZMode=e.teamsCameraFarEndPTZMode,this.logger.info(`Teams camera far-end PTZ mode policy recalculated: teamsCameraFarEndPTZMode=${this._teamsCameraFarEndPTZMode}`)}recalculateVdiCallingSettings(e){if(!e){this._areAllModalitiesDisabledInVdi=!1,this._areAudioVideoDisabledInVdi=!1;return}this._areAllModalitiesDisabledInVdi=this.getAggregatedSettingValue(e,"vdiPolicy","disableCallsAndMeetings"),this._areAudioVideoDisabledInVdi=this.getAggregatedSettingValue(e,"vdiPolicy","disableAudioVideoInCallsAndMeetings")}retrieveSSFCMeetingPolicyFlagValue(){this.useMeetingPolicyInScreenSharingFromChat=this.config.useMeetingPolicyInScreenSharingFromChat()}setIsEventDrivenCompositorMinElectronVersionAvailable(){this.isEventDrivenCompositorMinElectronVersionAvailable=!1,this.desktopUtilityService.getElectronAppVersionInfo().then(e=>{if(this.eventDrivenCompositorMinElectronVersion&&e?.hostInfo?.version){let t=e.hostInfo.version,i=e.hostInfo.build;this.isEventDrivenCompositorMinElectronVersionAvailable=this.utilityService.compareVersions(`${t}.${i}`,this.eventDrivenCompositorMinElectronVersion)>=0,this.logger.info(`fetched electron version: ${t}.${i}. isEventDrivenCompositorMinElectronVersionAvailable=${this.isEventDrivenCompositorMinElectronVersionAvailable}`)}else this.logger.warn(`MinElectronVersion Setting or AppVersionInfo Not Valid: ${e}`),this.isEventDrivenCompositorMinElectronVersionAvailable=!1}).catch(e=>{this.logger.error(`AppVersion Could Not be fetched. err: ${e}`),this.isEventDrivenCompositorMinElectronVersionAvailable=!1})}setIsVideoExtensibilityMinElectronVersionAvailable(){this.isVideoExtensibilityMinElectronVersionAvailable=void 0,this.desktopUtilityService.getElectronAppVersionInfo().then(e=>{if(this.videoExtensibilityMinElectronVersion&&e?.hostInfo?.version){let t=e.hostInfo.version,i=e.hostInfo.build;this.isVideoExtensibilityMinElectronVersionAvailable=this.utilityService.compareVersions(`${t}.${i}`,this.videoExtensibilityMinElectronVersion)>=0,this.logger.info(`fetched electron version: ${t}.${i}. isVideoExtensibilityMinElectronVersionAvailable=${this.isVideoExtensibilityMinElectronVersionAvailable}`)}else this.logger.warn(`MinElectronVersion Setting or AppVersionInfo Not Valid: ${e}`),this.isVideoExtensibilityMinElectronVersionAvailable=!1}).catch(e=>{this.logger.error(`AppVersion Could Not be fetched. err: ${e}`),this.isVideoExtensibilityMinElectronVersionAvailable=!1})}subscribeToAggregatedSettingsStore(){this.mtmaSubscriptionUtility.subscribe(this.aggregatedSettingsStore.asObservable(),()=>{let e=this.aggregatedSettingsStore.getSettings();e&&(this.logger.info("recalculating subscribeToAggregatedSettingsStore on aggregate settings change"),this.recalculateIsPstnCallingAllowed(e),this.recalculateCallParkEnabled(e),this.recalculateIsVoicemailAllowed(e),this.recalculateIsForwardingToUserAllowed(e),this.recalculateIsForwardingToPhoneAllowed(e),this.recalculateIsCallGroupsAllowed(e),this.recalculateIsEvEnabled(e),this.recalculateIsDelegationAllowed(e),this.recalculateMusicOnHoldEnabledType(e),this.recalculateAllowCloudRecordingForCalls(e),this.recalculateCallingEndtoEndEncryptionEnabledType(e),this.recalculateIsForwardingAllowed(),this.recalculateIsPopoutForIncomingPSTNCallsAllowed(e),this.recalculatePopoutAppPathForIncomingPSTNCalls(e),this.recalculateCallingBusyOnBusyPolicy(e),this.recalculateCallingPstnCallRedirectionPolicy(e),this.recalculateCountryEnforcedLbrUser(e),this.recalculateIsMultilineUser(e),this.recalculateUserPrimaryPhoneNumber(e))})}subscribeToMeetingPolicySettingsStore(){this.mtmaSubscriptionUtility.subscribe(this.meetingPolicySettingsStore.asObservable(),()=>{let e=this.meetingPolicySettingsStore.getSettings();e&&(this.logger.info("recalculating meetingPolicySettings change with following new settings: {0}",JSON.stringify(e)),this.recalculateAllowPrivateMeetNow(e),this.recalculateIPAudioVideoModes(e),this.recalculateTeamsCameraFarEndPTZMode(e),this.recalculateAllowWatermarkCustomization(e))})}subscribeToMessagingPolicySettingsStore(){this.mtmaSubscriptionUtility.subscribe(this.messagingPolicySettingsStore.asObservable(),()=>{let e=this.messagingPolicySettingsStore.getSettings();e&&(this.logger.info("recalculating messagingPolicySettings change with following new settings: {0}",JSON.stringify(e)),this.recalculateAllowUserChat(e))})}triggerForAllowedFlagUpdated(e,t,i,n,a){this.logger.info("Calculated {0} with the following flags: {1}. Old state: {2}, Current state {3}",e,JSON.stringify(t),i,n),n!==i&&this.trigger(a)}updateUserCurrentLocation(e,t){e?.locationInfo?.address?.country&&t?t.includes(e.locationInfo.address.country)?this._userCurrentCountryLocation="HomeCountry":this._userCurrentCountryLocation="ForeignCountry":this._userCurrentCountryLocation="None"}}},113802:function(e,t,i){var n,a;i.d(t,{l:()=>n}),(a=n||(n={})).ReplyChain="ReplyChain",a.CallHistory="CallHistory",a.CallHistoryDoubleClick="CallHistoryDoubleClick",a.ContactsTab="ContactsTab",a.Dialpad="Dialpad",a.DialpadWithPeoplePicker="DialpadWithPeoplePicker",a.ExchangeContactsTab="ExchangeContactsTab",a.EchoBotCall="EchoBotCall",a.Voicemail="Voicemail",a.RetryCall="RetryCall",a.RejoinCall="RejoinCall",a.RetryCallFromChildWindow="RetryCallFromChildWindow",a.GetRetriableCallIntent="GetRetriableCallIntent",a.RejoinCallMutation="RejoinCallMutation",a.CallingRetryScreenContainer="CallingRetryScreenContainer",a.RejoinCallFromChildWindow="RejoinCallFromChildWindow",a.CallingAnonMeetingEndScreen="CallingAnonMeetingEndScreen",a.HIDTriggered="HIDTriggered",a.HIDTriggeredAccept="hidtriggered_accept",a.HIDTriggeredVoipAccept="hidtriggered_accept_voip",a.HIDTriggeredPstnAccept="hidtriggered_accept_pstn",a.HIDTriggeredGroupAccept="hidtriggered_group_accept",a.ScreensharingPanelDialog="ScreensharingPanelDialog",a.SlashCommand="SlashCommand",a.VoicemailList="VoicemailList",a.VoiceSkillsCall="VoiceSkillsCall",a.VoiceSkillsPstnCall="VoiceSkillsPstnCall",a.Unpark="Unpark",a.RigelConsoleNewMeeting="RigelConsoleNewMeeting",a.AcceptCall="AcceptCall",a.NotifiedCallReceived="NotifiedCallReceived",a.JoinOngoingCallIfExists="joinOngoingCallIfExists",a.AcceptCallFromChat="AcceptCallFromChat",a.OneToOneAcceptCall="OneToOneAcceptCall",a.OneToOneVoipAcceptCall="OneToOneVoipAcceptCall",a.OneToOnePstnAcceptCall="OneToOnePstnAcceptCall",a.TransportCompanion="TransportCompanion",a.TransportCompanionAcceptCall="TransportCompanionAcceptCall",a.GroupAcceptCall="GroupAcceptCall",a.CallQueueAcceptCall="CallQueueAcceptCall",a.AutoAcceptCall="AutoAcceptCall",a.AcceptCallFromHid="AcceptCallFromHid",a.RejectCallFromHid="RejectCallFromHid",a.AcceptCallFromShortcut="AcceptCallFromShortcut",a.RejectCallFromShortcut="RejectCallFromShortcut",a.AnswerMutedCall="AnswerMutedCall",a.AutoAcceptBreakoutRoomInvite="AutoAcceptBreakoutRoomInvite",a.AutoAcceptMainMeetingInvite="AutoAcceptMainMeetingInvite",a.AcceptBreakoutRoomInvite="AcceptBreakoutRoomInvite",a.AcceptMainMeetingInvite="AcceptMainMeetingInvite",a.GoToAssignedBreakoutRoom="GoToAssignedBreakoutRoom",a.GoBackToMainMeetingFromBreakoutRoomReassignDeclined="GoBackToMainMeetingFromBreakoutRoomReassignDeclined",a.GoBackToMainMeetingFromBreakoutRoomTimerExpireDialog="GoBackToMainMeetingFromBreakoutRoomTimerExpireDialog",a.GoBackToMainMeetingFromBreakoutRoomTimerExpire="GoBackToMainMeetingFromBreakoutRoomTimerExpire",a.GoBackToMainMeetingFromClosedBreakoutRoom="GoBackToMainMeetingFromClosedBreakoutRoom",a.GoBackToMainMeetingFromBreakoutRoomOnDemand="GoBackToMainMeetingFromBreakoutRoomOnDemand",a.DeclineBreakoutRoomInvite="DeclineBreakoutRoomInvite",a.DeclineMainMeetingInvite="DeclineMainMeetingInvite",a.BreakoutRoomInviteTimeOut="BreakoutRoomInviteTimeOut",a.MainMeetingInviteTimeOut="MainMeetingInviteTimeOut",a.CloseBreakoutRoom="CloseBreakoutRoom",a.MainMeetingNotAllowedForParticipantInBreakoutRoom="MainMeetingNotAllowedForParticipantInBreakoutRoom",a.BreakoutRoomJoinByOwnChoice="BreakoutRoomJoinByOwnChoice",a.MultipleBreakoutRoomWindowsNotAllowed="MultipleBreakoutRoomWindowsNotAllowed",a.GetUserMediaReload="GetUserMediaReload",a.AcceptFromJoinCall="AcceptFromJoinCall",a.StartConsultation="StartConsultation",a.CallingDeeplinkDialog="CallingDeeplinkDialog",a.CallingStartButton="CallingStartButton",a.CallingStartButtonWithDropdown="CallingStartButtonWithDropdown",a.CentralDataLayer="CentralDataLayer",a.LivePersonCard="LivePersonCard",a.CallingPowerBar="CallingFromPowerbar",a.PromptToTalk="PromptToTalk",a.CallingProtocolDialog="CallingProtocolDialog",a.MultiWindowScreensharingPanelDialog="MultiWindowScreensharingPanelDialog",a.PlaceCallViaDeepLink="PlaceCallViaDeepLink",a.StartMeetup="StartMeetup",a.StartMeetupFromCode="StartMeetupFromCode",a.MultiWindow="MultiWindow",a.MeetingJoinButton="meeting_join_button",a.GroupCallJoinButton="group_call_join_button",a.DeepLink="DeepLink",a.DeepLinkJoinContainer="calling-deeplink-join-container",a.ChildWindowChatCallButton="ChildWindowChatCallButton",a.ChildWindowChatJoinButton="ChildWindowChatJoinButton",a.CallsAppV2Dialpad="callsapp_v2_dialpad",a.NovaCommandStartAudioCall="NovaCommandStartAudioCall",a.MeetingChatHeader="meeting_chat_header",a.MeetingDetailFullPage="meeting_detail_full_page",a.MeetingAttendeeDetails="meeting_attendee_details",a.MeetingStartedNotification="meeting_started_notification",a.MeetingQuickCalendar="meeting_quick_calendar",a.CalendarPrivateAdhoc="calendar_private_adhoc",a.JoinMeetingFromNotificationToDevice="join_meeting_notification_device",a.JoinCallFromIntentMutation="JoinCallFromIntentMutation",a.JoinCallFromIdMutation="JoinCallFromIdMutation",a.JoinAudioDropInFromToastNotification="JoinAudioDropInFromToastNotification",a.Channel="channel",a.ChannelPersistent="channel-persistent",a.ChatHeader="chat-header",a.ChatHeaderCallTransfer="chat-header-call-transfer",a.ChatHeaderStartAudioDropIn="chat_header_start_audio_drop_in",a.ChatHeaderJoinAudioDropIn="chat_header_join_audio_drop_in",a.CollabStageHeaderStartAudioDropIn="collab_stage_header_start_audio_drop_in",a.CollabStageHeaderJoinAudioDropIn="collab_stage_header_join_audio_drop_in",a.NavigateToCall="navigate-to-call",a.VoiceSkillsJoinMeeting="voice_skills_join_meeting",a.MeetingSurfaceHubCalendar="meeting_surface_hub_calendar",a.ScreenshareFromchat="screenshare_from_call",a.ScreenshareFromMwCall="screenshare-from-mw-call",a.HIDDialpad="HIDDialpad",a.Banner="Banner",a.JoinCallFromIdBridgeMutation="join_with_id_flyout_bridge",a.JoinCallByInvitationContent="join_call_by_invitation_content",a.JoinCallWithoutModality="join_call_without_modality",a.CallingResolvers="calling-resolvers",a.ObservableCallService="observableCallService",a.BreakoutRoomWithAssignment="breakout-room-with-assignment-distribution-service",a.JoinNotificationService="joinNotificationService",a.CallingEventsPublisher="calling-events-publisher",a.CallingThreadHeader="calling-thread-header",a.CalendarMeetings="calendar-meetings",a.CallingPreJoinScreen="calling-pre-join-screen",a.GenerateIntent="generate-intent",a.SpeedDial="speed-dial",a.CallEscalation="call_escalation",a.CallTransfer="call-transfer",a.CallTransferIncomingReplaceCall="call-transfer-incoming-replace-call",a.PstnCallButtonChatHeader="PstnCallButtonChatHeader",a.SlashCommandStartMeetNow="SlashCommandStartMeetNow",a.SlashCommandJoinMeetNow="SlashCommandJoinMeetNow",a.OfficeIntegration="OfficeIntegration",a.InvalidContext="InvalidContext",a.RigelNavigationService="RigelNavigationService",a.ToJoinOptionsFromInput="ToJoinOptionsFromInput",a.NavigateToDifferentMeeting="NavigateToDifferentMeeting",a.AgentMonitorSession="AgentMonitorSession",a.PickUpPaCallButton="PickUpPaCallButton",a.RejoinCallAfterAuth="RejoinCallAfterAuth"},352320:function(e,t,i){i.d(t,{cf:()=>W,rh:()=>H});var n,a,r,o,s,l,c,d,g=i(370574),h=i(892891),p=i(575810);(n=s||(s={})).Success="success",n.ExpectedError="expectederror",n.ExpectedNoNetworkError="expectednonetworkerror",n.UnexpectedNetworkError="unexpectednetworkerror",n.UnexpectedClientError="unexpectedclienterror",n.UnexpectedServerError="unexpectedservererror",(a=l||(l={})).AnonymousJoinDisabledDueToPolicy="AnonymousJoinDisabledDueToPolicy",a.B2BJoinDisabledDueToPolicy="B2BJoinDisabledDueToPolicy",a.JoinFailureDueToIBPolicy="JoinFailureDueToIBPolicy";var u=i(160946),m=i(512304),_=i(816435),S=i(167135),C=i(291518),v=i(113802),f=i(698664),b=i(310735),y=i(945761),T=i(377957),I=i(826757),A=i(679027),E=i(642900);let M=[p.gT.scenarios.calling.callAccept,p.gT.scenarios.calling.callingServiceInit,p.gT.scenarios.calling.createMeetup,p.gT.scenarios.calling.mediaConnected,p.gT.events.rigel.service.scenarios.joinMeetingStart,"cal_join_online_meeting",p.gT.scenarios.calling.joinOrCreateMeetupFromLink,p.gT.scenarios.calling.joinScheduledMeetup,p.gT.scenarios.calling.joinScheduledMeetupFromUniqueLink,p.gT.scenarios.webinars.joinScheduledWebinarFromLink],P=(e,t,i)=>{if(!M.includes(e.name)||!t)return;let n=k(t,i),a=R(t);e.appendEventData({...n,...a})},k=(e,t)=>{let i;if(!t)return;let n=e.meetingDetails?.meetingCapability;if(n&&t){let{video:e,screenshare:a}=t.getWatermarkMeetingOptions(n);i=D(e||!1,a||!1)}return i},D=(e,t)=>({[p.gT.scenarios.premiumCapability.watermark.videoEnabled]:e,[p.gT.scenarios.premiumCapability.watermark.screenShareEnabled]:t}),R=e=>{let t,i=e.meetingDetails?.meetingCapability;if(i){let{meetingEndToEndEncryptionEnabled:e=!1}=i;t=w(e)}return t},w=e=>({[p.gT.scenarios.premiumCapability.e2ee.meetingEndToEndEncryptionEnabled]:e}),F=(e,t,i,n,a,r,o,s,l)=>{let c=1;if(e.scenarios){if(0>e.scenarios.indexOf(t))return 0;c|=2}if(e.terminatedReasons){if(0>e.terminatedReasons.indexOf(i))return 0;c|=4}if(e.participantStateReasons){if(0>e.participantStateReasons.indexOf(n))return 0;c|=8}if(e.ccCodes){if(0>e.ccCodes.indexOf(a))return 0;c|=16}if(e.ccSubCodes){let t=!1;for(let i of e.ccSubCodes)if(Array.isArray(i)){if(2===i.length&&!(0,h.isNil)(r)&&r>=i[0]&&r<=i[1]){t=!0;break}}else if(i===r){t=!0;break}if(!t)return 0;c|=32}if(e.slimCoreVersionPrefix){if(!s||!s.startsWith(e.slimCoreVersionPrefix))return 0;c|=64}if(e.tsCallingVersionPrefix){if(!l||!l.startsWith(e.tsCallingVersionPrefix))return 0;c|=128}return c};var N=i(395250),O=i(692120),L=i(881005);function U(e){if((e??void 0)===void 0)return"Unknown: undefined";switch(e){case g.TerminatedReason.Undefined:return"Undefined";case g.TerminatedReason.Success:return"Success";case g.TerminatedReason.NoNgcEndpoint:return"NoNgcEndpoint";case g.TerminatedReason.NetworkError:return"NetworkError";case g.TerminatedReason.MediaDroppedError:return"MediaDroppedError";case g.TerminatedReason.BadRequest:return"BadRequest";case g.TerminatedReason.CallEstablishmentTimeout:return"CallEstablishmentTimeout";case g.TerminatedReason.CallSetupError:return"CallSetupError";case g.TerminatedReason.NoPermission:return"NoPermission";case g.TerminatedReason.Missed:return"Missed";case g.TerminatedReason.Declined:return"Declined";case g.TerminatedReason.Busy:return"Busy";case g.TerminatedReason.Cancelled:return"Cancelled";case g.TerminatedReason.Dropped:return"Dropped";case g.TerminatedReason.PstnInsufficientFunds:return"PstnInsufficientFunds";case g.TerminatedReason.PstnSkypeoutAccountBlocked:return"PstnSkypeoutAccountBlocked";case g.TerminatedReason.PstnCouldNotConnectToSkypeProxy:return"PstnCouldNotConnectToSkypeProxy";case g.TerminatedReason.PstnBlockedByUs:return"PstnBlockedByUs";case g.TerminatedReason.PstnBlockedRegulatoryIndia:return"PstnBlockedRegulatoryIndia";case g.TerminatedReason.PstnInvalidNumber:return"PstnInvalidNumber";case g.TerminatedReason.PstnNumberForbidden:return"PstnNumberForbidden";case g.TerminatedReason.PstnCallTerminated:return"PstnCallTerminated";case g.TerminatedReason.PstnNumberUnavailable:return"PstnNumberUnavailable";case g.TerminatedReason.PstnEmergencyCallDenied:return"PstnEmergencyCallDenied";case g.TerminatedReason.CallNotFound:return"CallNotFound";case g.TerminatedReason.LocalError:return"LocalError";case g.TerminatedReason.NotAcceptableHere:return"NotAcceptableHere";case g.TerminatedReason.CallForwarded:return"CallForwarded";case g.TerminatedReason.CallForwardedToVoicemail:return"CallForwardedToVoicemail";case g.TerminatedReason.SkypeTokenError:return"SkypeTokenError";case g.TerminatedReason.CallAccepted:return"CallAccepted";case g.TerminatedReason.LocalHttpStackError:return"LocalHttpStackError";case g.TerminatedReason.UnknownError:return"UnknownError";case g.TerminatedReason.PstnNoSubscriptionCover:return"PstnNoSubscriptionCover";case g.TerminatedReason.SessionNotFound:return"SessionNotFound";case g.TerminatedReason.SessionTimedOut:return"SessionTimedOut";case g.TerminatedReason.PstnCreditExpired:return"PstnCreditExpired";case g.TerminatedReason.PstnCreditExpiredButEnough:return"PstnCreditExpiredButEnough";case g.TerminatedReason.RetargetNotSupported:return"RetargetNotSupported";case g.TerminatedReason.EnterprisePstnInternalError:return"EnterprisePstnInternalError";case g.TerminatedReason.EnterprisePstnUnavailable:return"EnterprisePstnUnavailable";case g.TerminatedReason.EnterprisePstnForbidden:return"EnterprisePstnForbidden";case g.TerminatedReason.EnterprisePstnInvalidNumber:return"EnterprisePstnInvalidNumber";case g.TerminatedReason.EnterprisePstnMiscError:return"EnterprisePstnMiscError";case g.TerminatedReason.Kicked:return"Kicked";case g.TerminatedReason.NetworkRequestTimeoutError:return"NetworkRequestTimeoutError";case g.TerminatedReason.CallDoesNotExist:return"CallDoesNotExist";case g.TerminatedReason.MediaSetupFailure:return"MediaSetupFailure";case g.TerminatedReason.ServiceUnavailable:return"ServiceUnavailable";case g.TerminatedReason.SignalingError:return"SignalingError";case g.TerminatedReason.ConversationEstablishmentFailed:return"ConversationEstablishmentFailed";case g.TerminatedReason.TemporarilyUnavailable:return"TemporarilyUnavailable";case g.TerminatedReason.CannotConnectToNetworkError:return"CannotConnectToNetworkError";case g.TerminatedReason.MediaRelayWhiteListingIssue:return"MediaRelayWhiteListingIssue";case g.TerminatedReason.NoSignalingFromPeer:return"NoSignalingFromPeer";case g.TerminatedReason.DeniedInLobby:return"DeniedInLobby";case g.TerminatedReason.TimedOutInLobby:return"TimedOutInLobby";case g.TerminatedReason.CallFailedConflict:return"CallFailedConflict";case g.TerminatedReason.DevicePermissionDenied:return"DevicePermissionDenied";case g.TerminatedReason.ConfParticipantCountLimitReached:return"ConfParticipantCountLimitReached";case g.TerminatedReason.ActionNotAllowed:return"ActionNotAllowed";case g.TerminatedReason.Abandoned:return"Abandoned";case g.TerminatedReason.ForbiddenDueToPolicy:return"ForbiddenDueToPolicy";case g.TerminatedReason.InsufficientCapabilitiesForCallee:return"InsufficientCapabilitiesForCallee";case g.TerminatedReason.UserBlocked:return"UserBlocked";case g.TerminatedReason.AccessDenied:return"AccessDenied";case g.TerminatedReason.AnonymousJoinDisabledByPolicy:return"AnonymousJoinDisabledByPolicy";case g.TerminatedReason.NoLobbyForBroadcastJoin:return"NoLobbyForBroadcastJoin";case g.TerminatedReason.NotAllowedDueToInformationBarrier:return"NotAllowedDueToInformationBarrier";case g.TerminatedReason.BroadcastLimitReached:return"BroadcastLimitReached";case g.TerminatedReason.TeamParkPolicyDisabled:return"TeamParkPolicyDisabled";case g.TerminatedReason.B2bJoinDisabledByPolicy:return"B2bJoinDisabledByPolicy";case g.TerminatedReason.LocationBasedRoutingError:return"LocationBasedRoutingError";case g.TerminatedReason.ConfLobbyParticipantCountLimitReached:return"ConfLobbyParticipantCountLimitReached";case g.TerminatedReason.Suspended:return"Suspended";default:return`Unknown: ${e}`}}(r=c||(c={})).Other="Other",r.CleanStart="CleanStart",r.Error="Error",r.ShellUpdate="ShellUpdate",r.WebRelaunchEvent="WebRelaunchEvent",r.WebUpdate="WebUpdate",r.CleanStartSystemInitiated="CleanStartSystemInitiated",(o=d||(d={})).Other="Other",o.EndSessionCloseApp="EndSessionCloseApp",o.EndSessionCloseAppForUpdate="EndSessionCloseAppForUpdate",o.EndSessionCritical="EndSessionCritical",o.EndSessionLogOff="EndSessionLogOff",o.NoCoreWindowSignal="NoCoreWindowSignal",o.SystemTray="SystemTray",o.AppSwitcherInitiated="AppSwitcherInitiated",o.QuitOnCloseConfigured="QuitOnCloseConfigured",o.DeeplinkQuit="DeeplinkQuit",o.ShutdownOrRestart="ShutdownOrRestart",o.TestEnvCmdLineQuit="TestEnvCmdLineQuit",o.JumpListQuit="JumpListQuit",o.SilentLaunchCompleted="SilentLaunchCompleted",o.PreventFirstLaunchGroupPolicy="PreventFirstLaunchGroupPolicy",o.TflAppSwitcherInitiated="TflAppSwitcherInitiated",o.RoomsIpcConnectionClosed="RoomsIpcConnectionClosed",o.RoomsIpcConnectionReceivedQuit="RoomsIpcConnectionReceivedQuit";class B{constructor(e,t,i,n,a,r,o){this.owner=e,this.config=t,this.loggingService=i,this.utilityService=n,this.deviceManagerService=a,this.servicesProvider=r,this.chatServiceUtils=o,this.enableCallingDisconnectedAutoBrb=!1,this.enableUnconfirmedCrashAutoBrb=!1,this.callingCallDisconnectedCrashReported=!1,this.callDisconnectTelemetrySubmissionTimeoutMins=0,this.logger=i.newLogger("CallingDropsTelemetryService")}initializeOnAppLaunchAndReinit(e){this.enableCallingDisconnectedAutoBrb=this.config.enableCallingDisconnectedAutoBrb(),this.enableUnconfirmedCrashAutoBrb=this.config.enableUnconfirmedCrashAutoBrb(),this.callDisconnectTelemetrySubmissionTimeoutMins=this.config.callDisconnectTelemetrySubmissionTimeoutMins()||0}cleanupOnAppTeardown(e){this.enableCallingDisconnectedAutoBrb=!1,this.enableUnconfirmedCrashAutoBrb=!1,this.callingCallDisconnectedCrashReported=!1,this.callDisconnectTelemetrySubmissionTimeoutMins=0}async reportCallDisconnected(e,t,i){let n=I.eU.stringifyCallState(g.CallState.Connecting);if(!e.stateChanges.some(e=>e.startsWith(n)))return;let a=this.loggingService.newScenario(N.RG.CallingCallDisconnected,void 0,void 0,void 0,!0),r={},o={};try{r=this.createCallDisconnectedDatabag(e,i),o=this.createCallDisconnectedEvent(r,e,t,i)}catch(t){let e=this.utilityService.getErrorLoggingString(t);this.logger.errorToTelemetry?.(`createCallDisconnectedEvent error: ${e}`,O.z,void 0,!0),a?.appendEventData({[p.gT.counters.eventNames.errorReason]:e})}try{a.appendEventData(o),this.logCallDisconnectedTelemetryDetails(e,o),await this.completeCallDisconnectedScenario(a,e,t,i),this.processAndReportCrashBrbs(r,e,i,t)}catch(t){let e=this.utilityService.getErrorLoggingString(t);this.logger.errorToTelemetry?.(`Unexpected error while reporting call disconnect: ${e}`,O.z,void 0,!0),a?.appendEventData({[p.gT.counters.eventNames.errorReason]:e}),a?.fail()}finally{this.loggingService.setContext(p.gT.categories.callWasPoppedOut,""),t&&this.owner.deleteUserRole(e.ids.teamsCallId)}}createCallDisconnectedDatabag(e,t){let i=this.deviceManagerService.getDeviceCacheUsed(),n=this.deviceManagerService.getNoiseSuppressionMode(),a=e.aggregate??{},r={entryId:e.ids.id,sessionId:e.ids.sessionId,stateChanges:e.stateChanges?.join(";"),stateChangesTruncated:e.stateChangesMeta&&(0,L.f)(e.stateChangesMeta),stagingRoomStateChanges:e.stagingRoomStateChanges?.join(";"),events:e.events?.join(";"),eventsTruncated:e.eventsMeta&&(0,L.f)(e.eventsMeta),hadOffline:a.hadOfflineState,hadSuspendEvent:a.hadSuspendEvent,hadCriticalBattery:a.hadCriticalBattery,hadScreenSharing:a.hadScreenSharing,hadDialInShown:a.hadDialInShown,hadDialOutShown:a.hadDialOutShown,hadNetworkReconnect:a.hadNetworkReconnect,heartbeatTimestamp:a.heartbeatTimestamp,isObsoleteCrash:t?.isObsolete,didAppQuit:a.didAppQuit,didAppRestart:a.didAppRestart,appQuitReason:a.appQuitReason,appRestartReason:a.appRestartReason,deviceCacheUsed:i,meetingTransferred:a.meetingTransferred,wasChildWindowShown:a.wasChildWindowShown,stageSize:this.owner.getMaxVideosToRender(),nsMode:n};return e.reactionEvents?.length&&(r.reactionsEvents=e.reactionEvents.join(";")),e.features?.length&&(r.features=e.features.join(";")),r}createCallDisconnectedEvent(e,t,i,n){let a=this.chatServiceUtils.scrubMri(t.ids.participantId),r=p.gT.counters.eventNames,o={...t.commonCallData,[r.id]:t.ids.callId,[r.callId]:t.ids.callId,[r.endpointId]:t.ids.endpointId,[r.participantId]:a,[r.correlationId]:t.ids.correlationId,[p.gT.categories.deeplinkId]:t.ids.deeplinkId,[r.meetingCode]:t.ids.meetingCode,[p.gT.categories.ndiEnabled]:t.ndiEnabled,[p.gT.categories.ndiWasCaptured]:t.ndiWasCaptured,[r.isCCAMediaProxied]:t.isCCAMediaProxied,[r.wasPoppedOut]:t.aggregate.wasChildWindowShown,[r.callDataBag]:e};t.homeCloud&&(o[r.homeCloud]=t.homeCloud),t.isCrossCloudCall&&(o[r.isCrossCloudCall]=t.isCrossCloudCall),t.participantUserRole&&(o[r.callParticipantUserRole]=t.participantUserRole);let s=!!t.isBroadcast;if(o[r.isBroadcast]=s,s&&(o[r.broadcastRole]=t.broadcastRole,o[p.gT.categories.broadcastRole]=t.broadcastRole),t.callType&&(o[r.callType]=t.callType),t.signalingScenarioName&&(o[r.signalingScenarioName]=t.signalingScenarioName),t.ids.callIdOverride&&(o[r.callIdOverride]=t.ids.callIdOverride),t.termination)t.termination.leaveCallContext&&(o[r.leaveCallContext]=t.termination.leaveCallContext),t.termination.leaveCallReasonCMD&&(o[r.reason]=t.termination.leaveCallReasonCMD),t.termination.isExperienceContainerError&&(e.isExperienceContainerError=!0),this.logCallDisconnectedEntry(t,`leaveCallContext=${t.termination.leaveCallContext}, leaveCallReasonCMD=${t.termination.leaveCallReasonCMD}`);else{i||(e.callInterrupted=!0);let a=n?.crashInfo;a&&(e.appReportedCrash=a.appReportedCrash,e.bucketId=a.bucketId,e.errorCode=a.errorCode,e.osReportedCrash=a.osReportedCrash,e.processFailedKind=a.processFailedKind,e.processFailedReason=a.processFailedReason,e.reportId=a.reportId,"RenderProcessUnresponsive"===a.processFailedKind&&(e.isExperienceContainerError=!0,o[r.reason]=a.processFailedReason),this.logCallDisconnectedEntry(t,`osReportedCrash: ${a.osReportedCrash}, appReportedCrash: ${a.appReportedCrash}, reason: ${a.processFailedReason}, kind: ${a.processFailedKind}, bucketId: ${a.bucketId}, errorCode: ${a.errorCode}, reportId: ${a.reportId}`,!0))}o[r.terminatedReason]=U(t.termination?.reason),o[r.abortReason]=t.termination?.abortReason;let l=t.termination?.callEndDiagnosticsInfo||t.termination?.transferDiagnosticsInfo||{};return o[r.callControllerCode]=l.callControllerCode,o[r.callControllerSubCode]=l.callControllerSubCode,o[r.additionalTransactionEnd]=JSON.stringify(l.additionalTransactionEnd),o}async completeCallDisconnectedScenario(e,t,i,n){try{if(i){await i.callDisposedDefer.promise;let e=this.loggingService.findScenarioByNameAndId(N.RG.CallHangupLatency,t.ids.teamsCallId.toString());e?.mark(N.ck.CallHangupLatency_CallDisposed)}}catch(i){let t=this.utilityService.getErrorLoggingString(i);this.logger.errorToTelemetry?.(`completeCallDisconnectedScenario error: ${t}`,O.z,void 0,!0),e.fail({[p.gT.counters.eventNames.errorReason]:t});return}this.setCallDisconnectedStatus(t,n?.isObsolete??!1,e,i)}logCallDisconnectedTelemetryDetails(e,t){try{let i=p.gT.counters.eventNames;this.logCallDisconnectedEntry(e,`participantId=${this.chatServiceUtils.scrubMri(e.ids.participantId)}, endpointId=${e.ids.endpointId}, sessionId=${e.ids.sessionId}, terminatedReason=${t[i.terminatedReason]}`),this.logCallDisconnectedEntry(e,`offlineState=${e.aggregate.hadOfflineState}, suspendEvent=${e.aggregate.hadSuspendEvent}, criticalBattery=${e.aggregate.hadCriticalBattery}, screenSharing=${e.aggregate.hadScreenSharing}, didAppQuit=${e.aggregate.didAppQuit}, didAppRestart=${e.aggregate.didAppRestart}, appQuitReason=${e.aggregate.appQuitReason}, appRestartReason=${e.aggregate.appRestartReason}, hadNetworkReconnect=${e.aggregate.hadNetworkReconnect}`)}catch(t){let e=this.utilityService.getErrorLoggingString(t);this.logger.errorToTelemetry?.(`logCallDisconnectedTelemetryDetails error: ${e}`,O.z,void 0,!0)}}processAndReportCrashBrbs(e,t,i,n){try{let a=i?.isObsolete??!1,r="fail"===this.callDisconnectedStatusFor(t,a,n);if(this.logCallDisconnectedEntry(t,`isFailScenario: ${r}, enableUnconfirmedCrashAutoBrb: ${this.enableUnconfirmedCrashAutoBrb}, enableCallingDisconnectedAutoBrb: ${this.enableCallingDisconnectedAutoBrb}, callInterrupted: ${e.callInterrupted}, isExperienceContainerError: ${e.isExperienceContainerError}`),this.logCallDisconnectedEntry(t,`crashInfo: ${JSON.stringify(i?.crashInfo,null,2)}`),!r)return;this.processUaeBrb(t.ids.callId,t.ids.participantId,e,i?.crashInfo)||this.processExperienceErrorBrb(t.ids.callId,t.ids.participantId,e,i?.crashInfo)||this.processCallCrashBrb(t.ids.callId,t.ids.participantId,i?.crashInfo)}catch(t){let e=this.utilityService.getErrorLoggingString(t);this.logger.errorToTelemetry?.(`processAndReportCrashBrbs: Error processing and reporting crash BRBs: ${e}`,O.z,void 0,!0)}}processUaeBrb(e,t,i,n){return!(!this.enableUnconfirmedCrashAutoBrb||!i.callInterrupted||i.isExperienceContainerError||n?.osReportedCrash||n?.appReportedCrash)&&n?.processFailedReason!=="Crashed"&&(this.sendBrb(e,t,"UAE",!0,n),!0)}processExperienceErrorBrb(e,t,i,n){return!!this.enableUnconfirmedCrashAutoBrb&&!!i.isExperienceContainerError&&(this.sendBrb(e,t,"ExperienceError",!0,n),!0)}processCallCrashBrb(e,t,i){return!!i&&!!i.osReportedCrash&&!!(this.enableCallingDisconnectedAutoBrb&&!this.callingCallDisconnectedCrashReported&&this.owner.shouldReportCrash(i))&&(this.callingCallDisconnectedCrashReported=!0,this.sendBrb(e,t,"Crash",!0,i),!0)}sendBrb(e,t,i,n,a){this.servicesProvider.brbV2FeedbackService().sendFeedbackToBrbV2(!0,{category:p.gT.feedback.categories.other,title:`[Call ${i}][AutoBrb] - Detected ${i} during a call - [CallId: ${e}] (processFailedReason: ${a?.processFailedReason??"Unavailable"}, processFailedKind: ${a?.processFailedKind??"Unavailable"})`,description:`[Call ${i} AutoBrb] - CallId: ${e}
 ParticipantId: ${t}
 bucketId: ${a?.bucketId??"Unavailable"}
 errorCode: ${a?.errorCode??"Unavailable"}`,allowScreenshots:!1,includeBackgroundBlurImages:!1,includeHeapSnapshot:!1,correlationId:`Call ${i} AutoBrb`},void 0,n)}setCallDisconnectedStatus(e,t,i,n){let a=this.callDisconnectedStatusFor(e,t,n);switch(a){case"success":i.stop();break;case"cancel":i.cancel();break;case"incomplete":i.incomplete();break;default:this.isTelemetryLateSubmission(e)?i.cancel():i.fail()}this.logCallDisconnectedEntry(e,`Scenario stopped with ${a}`,"success"!==a)}logCallDisconnectedEntry(e,t,i=!1){let n=`${p.gT.scenarios.calling.callDisconnected}(${e.ids.callId}): ${t}`;i?this.loggingService.error(n):this.loggingService.log(n)}callDisconnectedStatusFor(e,t,i){if(!e.termination&&(t||e.aggregate.didAppQuit)||e.stateChanges&&!e.stateChanges.some(e=>e.includes("Connected")))return"incomplete";if(e.aggregate.didAppRestart){let t=e.aggregate.appRestartReason;if(t===c.WebRelaunchEvent)return"incomplete";if(t===c.ShellUpdate)return"cancel"}let n=e.termination?this.owner.findCallEndAction(N.RG.CallingCallDisconnected,e.termination,i,!1):"fail";return"fail"===n&&e.aggregate.hadOfflineState?(this.logCallDisconnectedEntry(e,"call dropped (failed) due network offline, marking as incomplete"),"incomplete"):n}isTelemetryLateSubmission(e){let t=this.config.callDisconnectTelemetrySubmissionTimeoutMins?.()??this.callDisconnectTelemetrySubmissionTimeoutMins;if(!t||!e.aggregate||!e.aggregate.heartbeatTimestamp)return!1;let i=Date.now();return i-e.aggregate.heartbeatTimestamp>60*t*1e3}}let x=[N.RG.CallingIntent,N.RG.CreateMeetup,N.RG.CallingJoinMeetupBroadcast,N.RG.JoinOrCreateMeetupFromLinkBroadcast,N.RG.CallingStackInit,N.RG.CallingJoinMeetup,N.RG.CallingPerformance,N.RG.JoinMeetingFromToast,N.RG.JoinOrCreateMeetupFromLink,N.RG.JoinScheduledMeetup,N.RG.JoinMeetupReplyChain],V=[l.AnonymousJoinDisabledDueToPolicy.toLowerCase(),l.B2BJoinDisabledDueToPolicy.toLowerCase(),l.JoinFailureDueToIBPolicy.toLowerCase(),s.Success.toLowerCase()],H=[s.ExpectedError.toLowerCase(),s.ExpectedNoNetworkError.toLowerCase()],G=[{scenarios:["create_one_to_one_pstn_call"],ccSubCodes:[500001,[560400,560404],[560406,560410],[560480,560488],[560500,560504],560513,560600,560603,560604,560606,560607,569002,569003,[569006,569009],569013],action:"incomplete"}];class W{constructor(e,t,i,n,a,r,o,s,l,c,d,g,h,m=!0,_=y.Wq,S,C,v){this.config=e,this.conversationsAsyncService=t,this.callingAgentsService=i,this.loggingService=n,this.trouterService=a,this.utilityService=r,this.deviceManagerService=o,this.eventingService=s,this.callingSupportService=l,this.messagingTelemetryService=c,this.servicesProvider=d,this.helpers=g,this.chatServiceUtils=h,this.promiseFactory=_,this.asObservable=S,this.survivabilityService=C,this.authenticationService=v,this.callPromiseRejectionIncompleteReasons=[u.ie.ChildWindowClosed,u.ie.CleanupApp,u.ie.EndCallingIntent,u.ie.RejoinCall,"CommandReplacedBeforeCommandEnqueue",p.gT.scenarios.calling.reasons.crossCloudMeetingJoinAttempt,p.gT.scenarios.calling.reasons.navigatedAwayFromGum,u.ie.AnonJoinDisabledPrejoin],this.callPromiseRejectionAbandonReasons=["AccountSelectionDialog","DismissPrejoinScreen"],this.userRoles={},this.isSendingLogs=!1,this.callsWithExistingSubcriptions=new WeakSet,this.maxVideosToRender=0,this.ongoingJoinAttempts=[],this.streamingEndRules=[],this.lobbyScenarioEndRules=[],this.callEndRules=[],this.sendAutoBrbForTimeoutCallingScenarios=[],this.sendAutoBrbForFailedCallingScenarios=[],this.isFirstLoad=!1,this.logger=n.newLogger("CallingTelemetryService"),this.callingScenarios=[N.RG.CreateMeetup,N.RG.JoinMeetupReplyChain,N.RG.JoinOrCreateMeetupFromLink,N.RG.JoinScheduledMeetup,N.RG.CallAccept,N.RG.CreateOneToOneCall,N.RG.CreateOneToOneInteropCall,N.RG.CreateOneToOneInteropSfcCall,N.RG.CreateOneToOnePstnCall,N.RG.CreateOneToOneInteropTfwTflCall,N.RG.CreateGroupCall,N.RG.CreateGroupInteropTfwTflCall,N.RG.JoinGroupCall,N.RG.CreateHuddleGroupCall,N.RG.JoinHuddleGroupCall,N.RG.CreateCollabStageHuddleGroupCall,N.RG.JoinCollabStageHuddleGroupCall,N.RG.ScreenshareAccept,N.RG.CreateGroupScreenshareCall,N.RG.CreateOneToOneScreenshareCall,N.RG.JoinScreenshareCall,N.RG.IncomingScreenshareCall,N.RG.ScreenshareCallEscalate,N.RG.LbrEnabledCall,N.RG.IncomingCallQueueCall,N.RG.AcceptCallQueueCall,N.RG.IncomingCallQueueTransferRequest,N.RG.TransferAcceptedCallQueueCall,N.RG.CallAcceptBroadcast,N.RG.CallAcceptRequestToJoinByRole,N.RG.CallingJoinMeetupBroadcast,N.RG.JoinOrCreateMeetupFromLinkBroadcast,N.RG.JoinScheduledMeetupBroadcast,N.RG.JoinOrCreateCallFromLink],this.callingDropsTelemetryService=new B(this,e,n,r,o,d,h),m&&this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.getUserLicense(),this.isAttachCallingLogsEnabled=this.config.enableAttachCallingLogs(),this.shouldCancelScenarioIfOffline=this.config.abandonCallingMeetingScenario(),this.maxVideosToRender=0,this.isFirstLoad=!0,this.callEndRules=[...G,...this.config.extraCallEndRules()],this.streamingEndRules=[...this.config.extraStreamingEndRules()],this.lobbyScenarioEndRules=[...this.config.lobbyScenarioEndRules()],this.sendAutoBrbForTimeoutCallingScenarios=this.config.timeoutScenarioNamesToSendAutoBrb()||[],this.sendAutoBrbForFailedCallingScenarios=this.config.failedScenarioNamesToSendAutoBrb()||[],this.callingDropsTelemetryService.initializeOnAppLaunchAndReinit(e)}cleanupOnAppTeardown(e){this.callingDropsTelemetryService.cleanupOnAppTeardown(e),this.callInLoggingContext=void 0,this.noopScenario=void 0,this.userRoles={},this.isSendingLogs=!1,this.isAttachCallingLogsEnabled=void 0,this.callsWithExistingSubcriptions=new WeakSet,this.shouldCancelScenarioIfOffline=void 0,this.ongoingJoinAttempts.forEach(e=>{let t={reasonCMD:"calling_telemetry_disposed"};e.scenario.incomplete(t);let i=this.findDeeplinkScenario(e.scenario.clientId);i?.incomplete(t)}),this.ongoingJoinAttempts=[],this.isFirstLoad=!1,this.callEndRules=[],this.streamingEndRules=[],this.lobbyScenarioEndRules=[],this.sendAutoBrbForTimeoutCallingScenarios=[],this.sendAutoBrbForFailedCallingScenarios=[]}createStartCallScenario(e,t,i){let n=this.processStartCallTelemetry(e,t);if(n)return n;let a=n=>{i&&i(!!this.config.enableGroupCallTimeoutAutoBrb,t.scenarioName,n),this.updateOngoingJoinAttempts(e,t)},r=e.type===b.G.Meeting||e.type===b.G.OneToOneCall||e.type===b.G.GroupCall,o=this.newCallingScenario(t.teamsCall||null,t.scenarioName,t.eventData,t.timeout,void 0,a,r);return this.reportParallelJoinAttempts(o),this.ongoingJoinAttempts.push({scenario:o,coordinates:e,correlationIds:t.correlationId?[t.correlationId]:[],mainAttemptCorrelationId:t.correlationId,mainJoinAttemptId:t.joinAttemptId,joinAttemptIds:t.joinAttemptId?[t.joinAttemptId]:[]}),this.incompleteConnectingDuplicates(o,e),o}getStartCallScenario(e,t){let i=this.getOngoingJoinAttemptByCorrelationId(e,t);return i?.scenario}getTotalNumberOfOngoingJoinAttempts(){return this.ongoingJoinAttempts?.length||0}wasScenarioAttemptedMultipleTimes(e,t){let i=this.getOngoingJoinAttemptByCorrelationId(e,t);return!!i?.wasAttemptedMultipleTimes}isScenarioAlreadyStartedByCorrelationId(e,t){let i=this.getOngoingJoinAttemptByCorrelationId(e,t);return!!i&&i.correlationIds.some(e=>e!==t)}isScenarioAlreadyStartedByJoinAttemptId(e,t){let i=this.getOngoingJoinAttemptByJoinAttemptId(e,t);return!!i&&i.joinAttemptIds.some(e=>e!==t)}getAcceptCallScenarioName(e,t){if(e.isCallQueue)return N.RG.AcceptCallQueueCall;if(e.isScreenshareFromChat)return N.RG.ScreenshareAccept;let i=e?.meetingDetails?.meetingCapability?.presenterOption;return"SpecifiedPeople"===i||"OrganizerOnly"===i?N.RG.CallAcceptRequestToJoinByRole:t?N.RG.CallAcceptBroadcast:["scheduledMeeting","adHocMeeting"].includes(e.conversationType)?N.RG.CallAcceptMeeting:N.RG.CallAccept}static getSubscriptionStateAsString(e){switch(e){case g.TrouterStateFromSkypeTsTrouter.Connected:return N.ck.ConnectedStep;case g.TrouterStateFromSkypeTsTrouter.Disconnected:return N.ck.DisconnectedStep;case g.TrouterStateFromSkypeTsTrouter.Switching:return N.ck.SwitchingStep}return N.ck.UnknownStep}static getFrameTypeAsString(e){switch(e){case g.FrameType.None:return"none";case g.FrameType.Software:return"software";case g.FrameType.Hardware:return"hardware";default:return"unknown"}}static getErrorMessage(e,t,i=W.DEFAULT_PROPS_GET_ERROR_MSG){let n;if(null==e)return"";if("string"==typeof e)return e;if("object"==typeof e&&e instanceof Error)return JSON.stringify(e,i);try{n=JSON.stringify(e)}catch(e){n=`passing bad object to JSON.stringify. ${e.message}`,t&&t.error(`passing bad object to JSON.stringify. ${e}`)}return n}incompleteCallingScenarios(e,t,i){let n=this.utilityService.scrubEuii(e),a=this.utilityService.scrubEuii(i);x.forEach(e=>this.loggingService.findAllScenariosByName(e).forEach(e=>e.incomplete({reason:n,errorCode:t,errorMessage:a})))}deleteUserRole(e){delete this.userRoles[e]}setUserRoleForCall(e,t){this.userRoles[e.teamsCallId]=t,e.getStartCallScenario().then(e=>{e.eventData[p.gT.counters.eventNames.callParticipantUserRole]=t}).catch(e=>{this.logger.warn(this.utilityService.getErrorLoggingString(e))});let i={teamsCallId:e.teamsCallId,userRole:t};this.eventingService.emit(p.gT.events.calling.callParticipantUserRoleChanged,i)}setCrossCloudCall(e,t){let i=e.getIntent()?.joinOptions?.homeCloud,n=t||!!i;e.getStartCallScenario().then(e=>{e.eventData[p.gT.counters.eventNames.homeCloud]=i,e.eventData[p.gT.counters.eventNames.isCrossCloudCall]=n}).catch(e=>{this.logger.warn(this.utilityService.getErrorLoggingString(e))})}newCallingInitScenario(){let e=this.loggingService.newScenario(N.RG.CallingServiceInit,null,null,null,!0);return e.eventData.isWindowsN=this.isWindowsN(),e.eventData[p.gT.counters.eventNames.environmentSupport]=this.callingAgentsService.getEnvironmentSupport(),e}newMeetingScenario(e,t,i,n,a){return this.newCallingScenario(e,t,this.getEventData(i),n,void 0,a)}newCallingIntentScenario(e,t,i,n){let a=N.RG.CallingIntent;(i={[p.gT.counters.eventNames.method]:f.LW[e],...this.getCommonEventData(t),...i})[p.gT.counters.eventNames.correlationId]=i[p.gT.counters.eventNames.correlationId]||this.utilityService.generateUUID();let r=this.messagingTelemetryService.previousSwitchScenario;r&&(i[p.gT.counters.eventNames.previousStep]=JSON.stringify({scenarioName:r.name,feedsType:r.eventData.feedsType,[p.gT.counters.eventNames.feedsSubtype]:r.eventData[p.gT.counters.eventNames.feedsSubtype],[p.gT.counters.eventNames.messageId]:r.eventData[p.gT.counters.eventNames.messageId]}));let o=this.loggingService.newScenario(a,null,null,null,!0);return o.clientId=t?T.w.getTeamsCallIdAsString(t.teamsCallId):n||this.utilityService.generateUUID(),o.appendEventData(i),o}getCallingWindowPopoutScenario(e){return this.loggingService.findScenarioByNameAndId(N.RG.CallingWindowPopoutIntent,e.id)}getCallingWindowingCreateContainerScenario(e){return this.loggingService.findScenarioByNameAndId(N.RG.CallingWindowingCreateContainer,e)}getCallingWindowingShowContainerInit(e){return this.loggingService.findScenarioByNameAndId(N.RG.CallingWindowingShowContainerInit,e)}newCallingWindowPopoutScenario(e,t){let i=N.RG.CallingWindowPopoutIntent,n=this.getCallingWindowPopoutScenario(e);if(n)return n;let a=E.P.intentToTelemetryData(e);a.fromChildWindow=t,a[p.gT.counters.eventNames.correlationId]=e.joinOptions?.correlationId||e.id;let r=this.loggingService.newScenario(i,null,null,null,!0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return r.clientId=e.id,r.appendEventData(a),r}newCallingWindowingCreateContainerScenario(e,t,i,n,a,r,o,s){let l=N.RG.CallingWindowingCreateContainer,c=this.getCallingWindowingCreateContainerScenario(o);if(c){let t=`The scenario is already existed. [intentId=${e}, windowingActionId=${a}]`;this.logger.error(t);let i=m.q.DuplicateScenarioCreation;c.fail({reasonCMD:i,reason:i})}let d={windowing_mode:t,calling_intent_type:i,context:r,window_type:s,windowing_action_id:a,calling_intent_id_input:n,calling_intent_id_generated:e,[p.gT.counters.eventNames.correlationId]:e},g=this.loggingService.newScenario(l,null,null,null,!0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return g.clientId=o,this.config.callingScenarioExtendedTimeout?.()>0&&g.timeoutInMs(+this.config.callingScenarioExtendedTimeout()),g.appendEventData(d),g}newCallingWindowingCloseContainerScenario(){let e=this.loggingService.newScenario(N.RG.CallingWindowingCloseContainer),t=this.config.callingScenarioExtendedTimeout?.();return t&&t>0&&e.timeoutInMs(+t),e}newCallingWindowingUpdateContainerScenario(e,t,i,n){let a=N.RG.CallingWindowingUpdateContainer,r=this.loggingService.findScenarioByNameAndId(N.RG.CallingWindowingUpdateContainer,t);if(r){let e=`The scenario is already existed. [windowingActionId=${t}]`;this.logger.error(e);let i=_.MP.DuplicateScenarioCreation;r.fail({reasonCMD:i,reason:i})}let o=this.loggingService.newScenario(a,null,null,n,!0);return o.clientId=t,o.appendEventData({windowingMode:e,context:i,windowing_action_id:t}),o}newCallingWindowingShowContainerInitScenario(e,t,i,n,a,r){let o=N.RG.CallingWindowingShowContainerInit,s=this.getCallingWindowingShowContainerInit(n);if(s){let t=`The scenario is already existed. [intentId=${e}, windowingActionId=${n}]`;this.logger.error(t);let i=m.q.DuplicateScenarioCreation;s.fail({reasonCMD:i,reason:i})}let l=this.loggingService.newScenario(o,null,null,null,!0);return l.clientId=n,l.appendEventData({windowing_mode:t,calling_intent_type:i,context:a,window_type:r,windowing_action_id:n,calling_intent_id_input:e}),l}newCallingWindowingRerenderContainerScenario(e,t,i,n,a,r){let o=N.RG.CallingWindowingRerenderContainer;if(this.loggingService.findScenarioByNameAndId(N.RG.CallingWindowingRerenderContainer,n)){let t=`${m.q.DuplicateScenarioCreation} The scenario is already existed. [intentId=${e}, windowingActionId=${n}]`;return this.logger.error(t),null}let s=this.loggingService.newScenario(o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,n,void 0);return s.clientId=n,s.appendEventData({windowing_mode:t,calling_intent_type:i,context:a,window_type:r,windowing_action_id:n,calling_intent_id_input:e}),s}newContentSharingScenario(e,t,i,n,a={},r){return this.newCallingScenario(e,t,{...a,correlationId:i,type:n},r)}getOrCreateCallingIntentScenario(e,t,i,n){let a=e&&this.getCallingIntentScenario(e);return a||this.newCallingIntentScenario(t,i,n)}getCallingIntentScenario(e){return e?this.loggingService.findScenarioByNameAndId(N.RG.CallingIntent,e)||void 0:this.loggingService.findScenario(N.RG.CallingIntent)||void 0}completeCallingIntentScenario(e,t){if(e)return this.logger.info(`complete calling intent scenario ${(0,h.cloneDeep)(t)}`),this.getDeficiencyDataFromIntentScenario(e)}getDeficiencyDataFromIntentScenario(e){return{[p.gT.counters.eventNames.deficiency]:e.eventData[p.gT.counters.eventNames.deficiency],[p.gT.counters.eventNames.limitedDeviceAccess]:e.eventData[p.gT.counters.eventNames.limitedDeviceAccess],[p.gT.counters.eventNames.permissions]:e.eventData[p.gT.counters.eventNames.permissions],[p.gT.counters.eventNames.constraints]:e.eventData[p.gT.counters.eventNames.constraints],[p.gT.counters.eventNames.correlationId]:e.eventData[p.gT.counters.eventNames.correlationId]}}newCallingScenario(e,t,i,n,a,r,o){let s,l={},c=e?W.isTeamsCall(e)?e:this.servicesProvider.callingService().getCallByTeamsCallId(e):null;W.isTeamsCall(c)?(s=c.teamsCallId,l=this.getCommonEventData(c)):s=e;let d=p.gT.feedback.categories.meetingsSchedule,g=i&&i.overrideTimestamp||null,h="string"==typeof i?.[p.gT.counters.eventNames.correlationId]?i?.[p.gT.counters.eventNames.correlationId]:"";n=this.overrideScenarioTimeoutForOneToOneCalls(t,n);let u=g?this.newScenarioWithAutoBrb(t,d,r,n,!0,g,o,h):this.newScenarioWithAutoBrb(t,d,r,n,!0,void 0,o,h);return u.clientId=a||(s?T.w.getTeamsCallIdAsString(s):this.utilityService.generateUUID()),u.appendEventData({...l,...i,clientId:u.clientId}),this.shouldCancelScenarioIfOffline&&(u.cancelIfOffline=!0),this.config.enableAutoBrbViaScenarioCallback?.()||this.sendAutoBrbOnScenarioWhenStopped(u,d),P(u,W.isTeamsCall(e)?e:void 0,this.callingSupportService),c&&this.getCallTypeAsync(c).then(e=>{e&&u.appendEventData({Call_Type:e})}),u}newCallsAppScenario(e){let t=this.loggingService.findScenario(N.RG.CallsMainAppLoad);if(t){let e="trying to navigate to screen again before previous attempt completed";this.logger.error(e),t.eventData.reason=e,t.fail()}let i=this.loggingService.newScenario(N.RG.CallsMainAppLoad,null,null,null,!0);return i.clientId=p.gT.callsMainApp.clientId,i.eventData.context=e,i}newCallableChannelAppScenario(e,t){let i=this.loggingService.findScenario(N.RG.CallableChannelAppLoad);if(i){let e="trying to navigate to screen again before previous attempt completed";this.logger.error(e),i.eventData.reason=e,i.fail()}let n=this.loggingService.newScenario(N.RG.CallableChannelAppLoad,null,null,null,!0);return n.clientId=t,n.eventData.context=e,n}generateRendererId(){return this.utilityService.generateUUID()}handleCallSuccess(e,t,i){e.then(e=>{[e,...t].forEach(e=>{e?((0,h.forIn)(this.getCommonEventData(i),(t,i)=>{e.eventData[i]=t}),e.name===p.gT.scenarios.calling.callingIntent&&e.stop()):this.logger.error(`Received null scenario in handleCallSuccess for TeamsCall-callId: ${i.callId}`)})})}handleCallFailure(e,t,i,n){let a,r,o=this.utilityService.getErrorLoggingString(i);if((0,h.includes)(this.callPromiseRejectionIncompleteReasons,i)?a="incomplete":(0,h.includes)(this.callPromiseRejectionAbandonReasons,i)&&(a="cancel"),this.isCallAttemptFailureType(i))switch(r=S.hi[i.reason],i.reason){case S.hi.NotSupported:case S.hi.NotSupportedButDeeplinkedIntoDesktop:case S.hi.CallingStackVersionMismatch:case S.hi.B2bCallJoinDisabled:case S.hi.MultiCallLimitReached:case S.hi.PstnCallingNotAllowed:case S.hi.CrossCloudMultiCallHandlingAlreadyInProgress:a="incomplete";break;case S.hi.UserCancelledAttemptDueToOngoingCall:a="cancel";break;case S.hi.FailedCallingServiceInit:case S.hi.FailedHandlingOngoingCalls:case S.hi.FailedCallingServiceNotInitialized:case S.hi.ReceivedEmptyCallObject:a="fail"}r=r||o,e.then(e=>{[e,...t].forEach(e=>{e.appendEventData({error:o,reason:r,reasonCMD:r}),n?this.finishCallScenarios(n,[e],r,a):this.endCallScenarios([e],e.name,a,r)})})}newCallingStopScenario(e,t,i){let n={[p.gT.counters.eventNames.context]:t,...i};return this.newCallingScenario(e,N.RG.EndMeetup,n)}searchForAnyCallStartScenario(){for(let e of this.callingScenarios){let t=this.loggingService.findScenario(e);if(t)return t}}newCallingLeaveScenario(e,t,i){let n=p.gT.scenarios.calling.leaveScenarioMaxWaitTime,a={[p.gT.counters.eventNames.context]:t,...i};if("string"==typeof e){let e=this.loggingService.newScenario(N.RG.LeaveMeetup,void 0,void 0,n,!0);return e.appendEventData(a),e}let r=e.isScreenshareFromChat?N.RG.LeaveScreenshare:N.RG.LeaveMeetup;return this.newCallingScenario(e,r,a,n)}getPrepareCallScenario(){return this.loggingService.findScenario(N.RG.PrepareCall)}getCoMeAutoJoinCallScenario(){return this.loggingService.findScenario(N.RG.CoordinatedJoinCall)}newStartVideoScenario(e,t,i){let n={...i,[p.gT.counters.eventNames.context]:t};return this.newCallingScenario(e,N.RG.StartVideo,n)}newStopVideoScenario(e,t,i){let n={...i,[p.gT.counters.eventNames.context]:t};return this.newCallingScenario(e,N.RG.StopVideo,n)}newDeviceBlurringCapabilityScenario(e){let t={[p.gT.counters.eventNames.context]:e};return this.newCallingScenario(null,N.RG.BlurGetEffectsCapability,t)}newWhiteboardSetVideoEffectsScenario(e,t){let i={[p.gT.counters.eventNames.context]:e,[p.gT.counters.eventNames.effectType]:t};return this.newCallingScenario(null,N.RG.WhiteboardSetEffects,i)}newSetVideoCaptureConfigScenario(e){let t={[p.gT.counters.eventNames.context]:e};return this.newCallingScenario(null,N.RG.SetVideoCaptureConfig,t)}newBackgroundEffectLoaderDuration(e,t){let i={[p.gT.counters.eventNames.context]:t};return this.newCallingScenario(e,N.RG.BlurWebLoaderDuration,i)}newBlurringSetVideoEffectsScenario(e,t,i){let n={[p.gT.counters.eventNames.context]:t,[p.gT.counters.eventNames.effectType]:i};return this.newCallingScenario(e,N.RG.BlurSetEffects,n)}newSetBackgroundImagesScenario(e,t,i,n,a){let r={[p.gT.counters.eventNames.context]:t,[p.gT.counters.eventNames.effectType]:i,[p.gT.counters.eventNames.imageOrigin]:n,[p.gT.counters.eventNames.isDefaultImage]:a};return this.newCallingScenario(e,N.RG.SetVideoBackgroundImage,r)}newVideoStreamStartedRenderingScenario(e,t){let i=p.gT.timeInMiliseconds.minute;return this.newCallingScenario(e,N.RG.VideoStreamRendering,t,i,void 0,void 0,!0)}newCreateCompositorScenario(e,t){let i=p.gT.timeInMiliseconds.minute;return this.newCallingScenario(e,N.RG.CreateCompositor,t,i)}newVideoStreamStoppedRenderingScenario(e,t){let i=p.gT.timeInMiliseconds.minute;return this.newCallingScenario(e,N.RG.VideoStreamStopped,t,i)}newHoldResumeCallScenario(e,t,i,n){let a=i?N.RG.HoldCall:N.RG.ResumeCall,r={[p.gT.counters.eventNames.context]:t,[p.gT.counters.eventNames.reason]:n};return this.newCallingScenario(e,a,r)}newCallSwitchingScenario(e,t,i){let n={[p.gT.counters.eventNames.context]:t,[p.gT.counters.eventNames.holdDurationInMillis]:i};return this.newCallingScenario(e,N.RG.CallResumeMultiCallList,n)}getOrCreatePreJoinScenario(e,t,i=!0,n=!1){if((!this.callingSupportService.isPreJoinEnabled()||!i)&&!n)return this.noopScenario||(this.noopScenario=new $),this.noopScenario;let a=n?N.RG.CallingJoinMeetupBroadcast:N.RG.CallingJoinMeetup;e||(e=this.utilityService.generateUUID());let r=this.loggingService.findScenarioByNameAndId(a,e);return r||(t||(t={}),(r=this.loggingService.newScenario(a,null,null,null,!0)).clientId=e,r.appendEventData(t)),r}getOrCreateCallCompanionTransferScenario(e,t){let i=N.RG.JoinCallFromCompanionTransfer;e||(e=this.utilityService.generateUUID());let n=this.loggingService.findScenarioByNameAndId(i,e);return n||(t||(t={}),(n=this.loggingService.newScenario(i,null,null,null,!0)).clientId=e,n.appendEventData(t)),n}trackCallProgress(e,t){if(!e){let e="no call object received";return t&&t.fail({reason:e}),this.promiseFactory.reject(e)}if(!t||this.callsWithExistingSubcriptions.has(e))return this.promiseFactory.resolve(e);if(this.callsWithExistingSubcriptions.add(e),t.appendEventData(this.getCommonEventData(e)),P(t,e,this.callingSupportService),!this.config.skipTrackCallProgressCallingTelemetryService?.()){let i=e.state,n=this.findDeeplinkScenario(t.clientId),a=e.on("callStateChanged",()=>{switch(t.mark(N.ck.CallStateChanged,{oldState:I.eU.stringifyCallState(i),newState:I.eU.stringifyCallState(e.state)}),i=e.state,e.state){case g.CallState.InLobby:t.appendEventData({[p.gT.counters.eventNames.endpointId]:e.endpointId,[p.gT.counters.eventNames.wasInLobby]:!0}),t.pause({reason:p.gT.scenarios.steps.calling.inLobby}),n?.pause({reason:p.gT.scenarios.steps.calling.inLobby});break;case g.CallState.Staging:t.eventData[p.gT.counters.eventNames.endpointId]=e.endpointId,t.resume(),t.stop({reason:p.gT.scenarios.steps.calling.inStaging}),n?.resume(),n?.stop({reason:p.gT.scenarios.steps.calling.inStaging});break;case g.CallState.Connected:t.eventData[p.gT.counters.eventNames.endpointId]=e.endpointId,t.appendEventData({wasPreheatAttempted:e.isPreheatEnabled,wasPreheatCompleted:e.preheatCompleted}),t.resume(),t.mark(N.ck.Connected),t.stop({reason:p.gT.scenarios.steps.calling.connected}),n?.resume(),n?.stop({reason:p.gT.scenarios.steps.calling.connected});break;case g.CallState.Disconnected:t.stop({reason:p.gT.scenarios.steps.calling.disconnected,terminatedReason:e.terminatedReason}),n?.stop({reason:p.gT.scenarios.steps.calling.disconnected,terminatedReason:e.terminatedReason})}}),r=this.eventingService.registerHandlerForExternalEvent(p.gT.events.calling.callDisposed,t=>{t===e&&(r(),a.dispose())})}return this.promiseFactory.resolve(e)}appendUnifiedFlowEventData(e,t){return t===v.l.CallEscalation?e.appendEventData({[p.gT.counters.eventNames.unifiedFlow]:!!this.config.enableEVUnifiedFlowForCallEscalation?.()}):t===v.l.CallTransfer&&e.appendEventData({[p.gT.counters.eventNames.unifiedFlow]:!!this.config.enableEVUnifiedFlowForOutgoingReplaceCalls?.()}),e}markCallStateScenario(e,t,i,n){if(e){let a=T.w.getTeamsCallIdAsString(e.teamsCallId),r=this.loggingService.findScenarioByNameAndId(N.RG.CallState,a);if(!r&&(r=this.newCallingScenario(e,N.RG.CallState,{},p.gT.timeInMiliseconds.day,a),this.servicesProvider.coordinatedMeetingsService().isCoMeAvailable(e)&&r.appendEventData({isCoMeCall:!0})),t){let a=I.eU.stringifyCallState(t)+(i?`_${i}`:"");n?r.mark(a,this.getCommonEventData(e),n):r.mark(a,this.getCommonEventData(e))}return P(r,e,this.callingSupportService),r}return null}getSubscriptionState(){return W.getSubscriptionStateAsString(this.trouterState)}getTrouterClientState(){return this.trouterService.clientState()}getCommonEventData(e){if(!e)return{};let t=this.getBaseEventData(e);this.callingSupportService.isAvatarEnabled()&&(t[p.gT.counters.eventNames.isAvatarOn]=this.deviceManagerService.isAvatarOn),e.meetingData&&(t[p.gT.counters.eventNames.meetingCode]=Number(e.meetingData.meetingCode)),e.messageId&&(t[p.gT.counters.eventNames.messageId]=e.messageId),e.broadcastMeeting&&(t[p.gT.categories.isBroadcast]="true",e.broadcastMeeting.role&&(t[p.gT.categories.broadcastRole]=e.broadcastMeeting.role)),e.isScreenshareFromChat&&(t[p.gT.categories.isScreenshareFromChat]="true"),e.isCrossCloudCall&&(t[p.gT.counters.eventNames.isCrossCloudCall]=e.isCrossCloudCall),e.homeCloud&&(t[p.gT.counters.eventNames.homeCloud]=e.homeCloud),e.participantId&&(t[p.gT.counters.eventNames.participantId]=e.participantId),this.userRoles[e.teamsCallId]&&(t[p.gT.counters.eventNames.callParticipantUserRole]=this.userRoles[e.teamsCallId]),e.isEmergencyCall&&(t[p.gT.counters.eventNames.emergencyCall]=!0);let i=this.getEndpointTypeForCommonEventData(e);i&&(t[p.gT.counters.eventNames.endpointType]=i),e.transferorMri&&(t[p.gT.counters.eventNames.transferorMri]=this.chatServiceUtils.scrubMri(e.transferorMri)),e.transferorType&&(t[p.gT.counters.eventNames.transferorType]=e.transferorType),e.onBehalfOfMri&&(t[p.gT.counters.eventNames.onBehalfOfMri]=this.chatServiceUtils.scrubMri(e.onBehalfOfMri)),e.forwardingDestinationType&&(t[p.gT.counters.eventNames.forwardingDestinationType]=e.forwardingDestinationType),this.setMeetingCapabilityDependentData(e,t),t[p.gT.counters.eventNames.meetingRole]=e?.meetingRole,t[p.gT.counters.eventNames.meetingRoles]=e?.meetingRoles,t[p.gT.counters.eventNames.conversationType]=e.conversationType;let n=e?.meetingDetails?.meetingCapability?.allowRegisteredUsersToBypassLobby,a=e?.meetingDetails?.meetingCapability?.disableLobby;t[p.gT.scenarioDataPropNames.allowRegisteredUsersToBypassLobby]=n,t[p.gT.scenarioDataPropNames.disableLobby]=a;let r=e?.meetingDetails?.templateDetails?.id;t[p.gT.counters.eventNames.templateId]=r;let o=e?.meetingDetails?.startTime,s=e?.meetingDetails?.meetingType;if(o&&s){let i={meetingType:s.toLowerCase(),startTime:o,endTime:e?.meetingDetails?.endTime};t[p.gT.counters.eventNames.callSchedulingDetails]=i}if(this.config.enableSkypeInteropReporting()&&e){let i=!!e.participants&&e.participants.length>0&&(e=>{let t=/.*\(14(18|19|20|31|32|33|34|45)\/.*\)/,i=!1;return e.participants.some(e=>e.endpoints?.endpointDetails.some(e=>!!(e?.clientVersion&&e.clientVersion.match(t))&&(i=!0,!0))||i),i})(e);t[p.gT.counters.eventNames.hasSkypeParticipant]=i}return t[p.gT.counters.eventNames.isMeetingAcrossTFLTFW]=e?.isTfwTflInterop,t}enrichEventDataWithDialInOutInfo(e,t,i){return this.helpers.getPromiseWithTimeout(e.getMeetingInfoAsync(),i||2e3,"Not able to get meeting info from TeamsCall").then(e=>{t[p.gT.counters.eventNames.dialIn]=!!(e&&e.pstnDetails),t[p.gT.counters.eventNames.dialOut]=!1})}static getCallDiagnosticsData(e,t,i,n,a,r,o){let s=`Diagnostics information for all ${e?.participants?.length} participants in the call:
`;return e?.participants?.length===0?s=`Diagnostic information for empty call:[callId=${e?.callId}][abortReason=${n}][callControllerCode=${r}][callControllerSubCode=${o}][reason=${i}][message=${a}]`:((0,h.forEach)(e?.participants,e=>{let i=e?.callEndDiagnosticsInfo||{};s+=`scrubbedParticipantId=${t(e?.id)}, callControllerCode=${i.callControllerCode}, callControllerSubCode=${i.callControllerSubCode}
`}),s)}static findCallingScenarioEndRule(e,t,i,n,a,r,o,s,l,c){let{bestRule:d,bestRank:g}=((e,t,i,n,a,r,o,s,l)=>{let c=0,d=null;for(let g of e){let e=F(g,t,i,n,a,r,o,s,l);e>0&&e>=c&&(c=e,d=g)}return{bestRule:d,bestRank:c}})(e,t,i,n,a,r,o,s,l);return c&&c.info(`CallingScenarioEnd rule match [call][scenarioName=${t}][terminatedReason=${i}][participantStateReason=${n}][ccCode=${a}][ccSubCode=${r}][slimCore=${s}][tsCalling=${l}][resultCategories=${(o||[]).join(",")}][bestRank=${g}][bestRule=${d}]`),d}static endScenario(e,t,i){switch(t){case"success":e.stop(i);break;case"incomplete":e.incomplete(i);break;case"cancel":e.cancel(i);break;default:e.fail(i)}}reportCallDisconnected(e,t,i){return this.callingDropsTelemetryService.reportCallDisconnected(e,t,i)}finishCallScenarios(e,t,i,n){try{let a=e.abortReason,r=e.terminatedReason,o=t.length>0?t[0].name:void 0,s=this.getDiagnosticsInfo(e,o,i)||void 0,l=s?.callControllerCode,c=s?.callControllerSubCode,d=s?.phrase,g=s?.resultCategories||[],h=W.getCallTerminationInfo(e);h.isCaptchaModalShown="boolean"==typeof t[0].eventData.captchaModalShown&&t[0].eventData.captchaModalShown,n=n||this.findCallEndAction(o,h,e);let p=t.map(e=>e.name).join(", ");this.logger.info(`Finish start call scenarios [call][callId=${e.callId}][action=${n}][abortReason=${a}][terminatedReason=${r}][callControllerCode=${l}][callControllerSubCode=${c}][reason=${i}][primaryScenario=${o}][scenarios=${p}][resultCategories=${g?.join(",")}][message=${d}]`),t.forEach(e=>{this.addCallErrorCodesToEventData(e.eventData,a,r,l,c,i,g,d)}),this.handleEmergencyCallFailure(p,c),this.endCallScenarios(t,p,n,i,e,s)}catch(e){this.logger.errorToTelemetry?.(`Error in finishCallScenarios: ${this.utilityService.getErrorLoggingString(e.message)}, ${e.errorCode}`,"finish_call_scenarios",void 0,!0)}}findCallEndAction(e,t,i,n=!0){let a,r,o;if(t.isExperienceContainerError||this.isUnexpectedCaptchaError(t))return"fail";if(this.shouldCancelScenarios(t))if(!n&&t.reason===g.TerminatedReason.Success)return"success";else return"cancel";if(this.isExpectedVdiCallDrop(t.leaveCallContext||""))return"success";if(this.config.enableResultCategoryUsage()&&i){let t=this.getDiagnosticsInfo(i,e);o=this.getActionBasedOnResultCategory(t?.resultCategories)}if(this.shouldIncompleteScenarios(t)){if("success"===o)return"success";a="incomplete"}let{callControllerCode:s,callControllerSubCode:l}=t.callEndDiagnosticsInfo||t.transferDiagnosticsInfo||{};if(200===s)return"success";if(!a){let i=this.callingAgentsService.getVersions(),n=W.findCallingScenarioEndRule([...this.callEndRules,...this.streamingEndRules],e,t.reason,void 0,s,l,t.resultCategories,i?.slimCore,i?.tsCalling,this.logger);n&&(a=n.action,r=!0)}return this.config.enableResultCategoryUsage()&&(a?this.sendMismatchTelemetry(a,o,i,e,r):a=o),a??"fail"}findCallEndActionForLobbyScenarios(e,t,i,n){let a,r=!1,o=this.config.enableResultCategoryUsage()?this.getActionBasedOnResultCategory(t.resultCategories):void 0;if(this.shouldIncompleteScenariosForLobby(t)){if("success"===o)return"success";a="incomplete"}if(!a){let i=this.callingAgentsService.getVersions(),o=W.findCallingScenarioEndRule([...this.lobbyScenarioEndRules],e,n,t.reason,t.code,t.subCode,t.resultCategories,i?.slimCore,i?.tsCalling,this.logger);o&&(a=o.action,r=!0)}return this.config.enableResultCategoryUsage()&&(a?this.sendMismatchTelemetry(a,o,i,e,r):a=o),a??"fail"}async setCallIdOverride(e,t){e.getStartCallScenario().then(i=>{i.appendEventData({[p.gT.counters.eventNames.callId]:t}),i.mark(N.ck.CallIdChanged,this.getCommonEventData(e))}).catch(e=>{this.logger.warn(this.utilityService.getErrorLoggingString(e))}),await this.setLoggingContext(e)}async updateParticipantId(e,t){e.getStartCallScenario().then(e=>{e.eventData[p.gT.counters.eventNames.participantId]=t}).catch(e=>{this.logger.warn(this.utilityService.getErrorLoggingString(e))}),await this.setLoggingContext(e)}setCallMode(e){e.callType==g.CallType.Conference&&this.loggingService.setContext(p.gT.categories.callMode,e.callMode)}setMaxVideosToRender(e){this.maxVideosToRender=Math.max(e,this.maxVideosToRender)}getMaxVideosToRender(){return this.maxVideosToRender}getCallingDropsTelemetryService(){return this.callingDropsTelemetryService}async setLoggingContext(e){let[t,i,n]=["","",""];e&&(t=e.callId,i=e.participantId,n=`${e.wasPoppedOut}`),await this.updateLoggingContextCallType(e),this.loggingService.setContext(p.gT.categories.callId,t),this.loggingService.setContext(p.gT.categories.participantId,i),this.loggingService.setContext(p.gT.categories.callWasPoppedOut,n),this.setBroadcastLoggingContext(e),this.callInLoggingContext=e}setBroadcastLoggingContext(e){let[t,i,n,a,r]=["","","","",""];if(e&&e.broadcastMeeting){let o=e.broadcastMeeting.broadcastState;[t,i,n,a,r]=["true",e.broadcastMeeting.role,A._.stringifyBroadcastState(e.broadcastMeeting.modalityState),this.utilityService.asString(o?.sources?.length),e.threadId],r&&(this.config.enableMeetingThreadIdValidation?.()&&(r=I.eU.isValidMeetingThreadId(r)?r:I.eU.getInvalidThreadIdString(r)),this.loggingService.setContext(p.gT.categories.threadId,r)),this.loggingService.setContext(p.gT.categories.broadcastRole,i),this.loggingService.setContext(p.gT.categories.broadcastModalityState,n),this.loggingService.setContext(p.gT.categories.broadcastMediaCount,a)}this.loggingService.setContext(p.gT.categories.isBroadcast,t)}submitIssueWithLogs(e,t){let i;if(!this.isAttachCallingLogsEnabled)return this.promiseFactory.reject("Feature flag not enabled");if(this.isSendingLogs)return this.promiseFactory.reject("Currently sending logs");this.isSendingLogs=!0;let n=`${t} call failure (callId: ${e.callId}, teamsCallId: ${e.teamsCallId})`;try{i=JSON.stringify({failureType:e.failureType,abortReason:e.abortReason,mediaConnected:e.mediaConnected,mediaWhitelistingIssueRaised:e.mediaWhitelistingIssueRaised,terminatedReason:e.terminatedReason})}catch(e){i=n}let a=String(p.gT.feedback.categories.other);return this.promiseFactory.finalized(this.servicesProvider.brbV2FeedbackService().sendFeedbackToBrbV2(!0,{category:a,title:n,description:i,allowScreenshots:!1}).catch(e=>{this.loggingService.error(e)}),()=>{this.isSendingLogs=!1})}static convertTerminatedReasonToString(e){return U(e)}markMultiWindowCallingTelemetry(e){return(e=e||{}).fromMultiWindow="true",e}static getCallTerminationInfo(e){return{leaveCallContext:e.leaveCallContext,leaveCallReasonCMD:e.leaveCallReasonCMD,reason:e.terminatedReason,abortReason:e.abortReason,resultCategories:e.getDiagnosticsResultCategories(),isExperienceContainerError:e.isExperienceContainerError,callEndDiagnosticsInfo:e.callEndDiagnosticsInfo,transferDiagnosticsInfo:e.transferDiagnosticsInfo,hasNoActiveNetworkInterface:e.hasNoActiveNetworkInterface(),isNotAllowedToJoinBreakoutRoom:e.isNotAllowedToJoinBreakoutRoom(),isMeetingJoinBlockedByPolicy:e.isMeetingJoinBlockedByPolicy(),isMeetingInvalidOrExpired:e.isMeetingInvalidOrExpired(),isInvalidMeetingCode:e.isInvalidMeetingCode(),isConnectionError:e.isConnectionError(),isMeetingLifetimeExceededFailure:e.isMeetingLifetimeExceededFailure(),isInformationBarrierError:e.isInformationBarrierPresent,isMeetingXlBlockedByBreakoutRooms:e.isMeetingXlBlockedByBreakoutRooms(),hasFailedDueToInvalidSkypeToken:e.hasFailedDueToInvalidSkypeToken(),isAuthFailedWithInteractionRequired:e.isAuthFailedWithInteractionRequired()}}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}getDiagnosticsInfo(e,t,i){if(!e)return null;let{callEndDiagnosticsInfo:n,transferDiagnosticsInfo:a,teamsCallType:r,participants:o}=e;if(n)return n;if(t&&t===N.RG.TransferCall&&a)return a;if(o){let e=o.length>0&&o[0]?.callEndDiagnosticsInfo;if(r===g.CallType.P2P&&e)return o[0].callEndDiagnosticsInfo}if(i){let{code:e,subCode:t,phrase:n}=I.eU.safeJsonParse(i);if(e||t||n)return{callControllerCode:e,callControllerSubCode:t,phrase:n}}return null}newScenarioWithAutoBrb(e,t,i,n,a,r,o,s,l){let c=i,d=s||this.utilityService.generateUUID(),g=this.config.enableAutoBrbViaScenarioCallback?.();this.config.enableAutoBrbViaScenarioCallback?.()&&(c=this.tryGetWrappedAutoBrbCallback(e,t,d,i,l));let h=this.loggingService.newScenario(e,null,c,n,a,null,r,void 0,void 0,void 0,void 0,o);return g&&h.appendEventData({correlationId:d}),h}isCallAbandoned(e){return!!e&&"number"==typeof e&&e===g.TerminatedReason.Abandoned}isActionNotAllowed(e){return!!e&&"number"==typeof e&&e===g.TerminatedReason.ActionNotAllowed}findDeeplinkScenario(e){return e?this.loggingService.findScenarioByNameAndId(N.RG.DeeplinkIntoMeeting,e):null}handleDeeplinkScenario(e,t,i){let n=e.getIntent();if(n){let a=n.activeScenarios?.find(e=>e.name===N.RG.DeeplinkIntoMeeting)?.clientId,r=this.findDeeplinkScenario(a);if(r)switch(t){case"cancel":r.cancel(i||void 0);break;case"incomplete":r.incomplete(i||void 0);break;case"pause":r.pause(i);break;case"resume":let o=this.getBaseEventData(e);i&&(o={baseEventData:o,eventData:i}),r.resume(o);break;case"fail":r.fail(i||void 0);break;default:r.stop(i||void 0)}}}shouldReportCrash(e){let t=this.config.callingDisconnectedAutoBrbInclude();return t&&t instanceof Array?t.some(t=>t instanceof Object&&!(t instanceof Array)&&Object.keys(t).every(i=>{let n=e[i]||"unknown";return"*"===t[i]||t[i]===n})):(this.loggingService.warn("reportCrash: crash filter missing or not an array and not an object"),!0)}getUserLicense(){this.authenticationService?.getUserDetails().then(e=>{this.isCopilot=e?.licenseDetails?.isCopilot??!1,this.isTPManagement=e?.licenseDetails?.isTPManagement??!1}).catch(e=>{this.logger.error("getUserLicense failed")})}reportParallelJoinAttempts(e){0!==this.ongoingJoinAttempts.length&&(e.mark(N.ck.ParallelJoinAttempt),this.ongoingJoinAttempts.forEach(e=>{e.scenario.mark(N.ck.ParallelJoinAttempt)}))}async incompleteConnectingDuplicates(e,t){if(t.type===b.G.Meeting)try{let i=await this.servicesProvider.callingService().getCallByCoordinatesAsync(t);i?.wasJoinAttempted&&e.incomplete({reason:"waiting_for_connecting"})}catch(e){this.logger.error(`Failed to get call registry calls in telemetry service: ${this.utilityService.getErrorLoggingString(e)}`)}}getBaseEventData(e){let t=this.deviceManagerService.getSelectedDevices(),i=this.chatServiceUtils.isPstnMri(e.callerMri)?p.gT.pstn.userType:e.conversationId;return i!==p.gT.pstn.userType&&this.config.enableMeetingThreadIdValidation?.()&&(i=I.eU.isValidMeetingThreadId(i)?i:I.eU.getInvalidThreadIdString(i)),{[p.gT.counters.eventNames.id]:e.callId,[p.gT.counters.eventNames.callId]:e.callId,[p.gT.counters.eventNames.callMode]:e?.callMode,[p.gT.counters.eventNames.callType]:e.callType,[p.gT.counters.eventNames.intentType]:e.getIntent()?.coordinates?.type,[p.gT.counters.eventNames.teamsCallId]:e.teamsCallId,[p.gT.counters.eventNames.endpointId]:e.endpointId,[p.gT.counters.eventNames.wasPoppedOut]:e.wasPoppedOut,[p.gT.counters.eventNames.isVideoOn]:e.isVideoOn,[p.gT.categories.threadId]:i,[p.gT.counters.eventNames.stagingRoomEnabled]:e.stagingRoomProperties?.stagingRoomEnabled,[p.gT.counters.eventNames.stagingRoomEventActive]:e.stagingRoomProperties?.eventActive,[p.gT.counters.eventNames.stagingRoomEventEnded]:e.stagingRoomProperties?.eventEnded,[p.gT.categories.trouterState]:this.getSubscriptionState(),[p.gT.categories.trouterClientState]:this.getTrouterClientState(),[p.gT.categories.trouterUrls]:this.trouterService.trouterUrl(),[p.gT.counters.eventNames.isManagedModeEnabled]:this.callingSupportService.isHostViewModeActive(e?.meetingDetails?.meetingCapability),[p.gT.counters.eventNames.selectedCameraId]:t.camera,[p.gT.counters.eventNames.selectedMicrophoneId]:t.microphone,[p.gT.counters.eventNames.selectedSpeakerId]:t.speaker,[p.gT.counters.eventNames.isCopilot]:this.isCopilot,[p.gT.counters.eventNames.isTPManagement]:this.isTPManagement,[p.gT.counters.eventNames.isMultilingualMeeting]:e.isMultilingualMeeting,[p.gT.counters.eventNames.isMultilingualMeetingOptionEnabled]:e.meetingDetails?.meetingCapability?.enableMultiLingualMeeting,[p.gT.counters.eventNames.isAiInterpreterEnabled]:e.meetingDetails?.meetingCapability?.aiInterpretationEnabled}}getEndpointTypeForCommonEventData(e){let t=null,i=(e.participants&&e.participants.length)>0?e.participants[0].id:null;return(this.chatServiceUtils.isPstnMri(e.callerMri)||this.chatServiceUtils.isPstnMri(i))&&(t="pstn"),this.isSfbCall(e)&&(t="sfbInterop"),this.config.enableTfwTflCallingFederation?.()?I.eU.isSfcCall(e)?t="sfcInterop":!this.config.isTflUser?.()&&I.eU.isTflConsumerCall(e)&&(t="tflInterop"):I.eU.isSkypeConsumerCall(e)&&(t="sfcInterop"),I.eU.isImmersiveMeetingCall(e)&&(t="immersiveMeeting"),t}isCallAttemptFailureType(e){return e?.reason!==void 0}isMatchingJoinAttemptByCorrelationId(e,t,i){return!!e.correlationIds.some(e=>e===i)||E.P.areCoordinatesEquivalent(e.coordinates,t,this.servicesProvider.callingService())}isMatchingJoinAttemptByJoinAttemptId(e,t,i){return!!e.joinAttemptIds.some(e=>e===i)||E.P.areCoordinatesEquivalent(e.coordinates,t,this.servicesProvider.callingService())}updateOngoingJoinAttempts(e,t){this.ongoingJoinAttempts=this.ongoingJoinAttempts.filter(i=>this.config.enableJoinAttemptId()?!this.isMatchingJoinAttemptByJoinAttemptId(i,e,t.joinAttemptId):!this.isMatchingJoinAttemptByCorrelationId(i,e,t.correlationId)),this.maxVideosToRender=0}addCallErrorCodesToEventData(e,t,i,n,a,r,o,s){let l=p.gT.counters.eventNames;e[l.abortReason]=t,i&&(e[l.terminatedReason]=i),(0,h.isNil)(n)||(e[l.callControllerCode]=n),(0,h.isNil)(a)||(e[l.callControllerSubCode]=a),r&&(e[l.reason]=r),o&&o.length&&(e[l.resultcategory]=o.join(",")),e[l.message]=s}endCallScenarios(e,t,i,n,a,r){let o="No call object available";a&&(o=W.getCallDiagnosticsData(a,e=>this.chatServiceUtils.scrubMri(e),n,a?.abortReason,r?.phrase,r?.callControllerCode,r?.callControllerSubCode));let s=a?.terminatedReason;s||(s=g.TerminatedReason.Undefined);let l=` [${t}] because call
      was terminated with terminatedReason: ${s}
      with following diagnostics data: ${o}
      [call][callId=${a?.callId}][reason=${n}][callType=${a?.teamsCallType}][scenarioName=${t}]`;switch(i){case"cancel":this.logger.info(`Abandoning ${l}`),e.forEach(e=>e.cancel());break;case"incomplete":this.logger.info(`Incompleting ${l}`),e.forEach(e=>e.incomplete());break;case"success":this.logger.info(`Successfully stopping ${l}`),e.forEach(e=>e.stop());break;default:this.logger.error(`Failing ${l}`),e.forEach(e=>{a?.teamsCallType!==g.CallType.P2P&&(e.eventData[p.gT.counters.eventNames.diagnosticsData]=o),e.fail()})}this.survivabilityService?.isApplianceMode()&&e.forEach(e=>this.survivabilityService?.addScenarioToOfflineTelemetry(e))}sendMismatchTelemetry(e,t,i,n,a){if(t===e)return;let r=this.logger.service.newScenario(N.RG.InconsistentResultCategory),o=p.gT.counters.eventNames,s=i?this.getDiagnosticsInfo(i,n):void 0,l=s?.callControllerCode,c=s?.callControllerSubCode,d=s?.resultCategories,g=s?.additionalTransactionEnd,h=i?.terminatedReason;this.logger.info(`sendMismatchTelemetry: [mismatchedScenario=${n}][terminatedReason=${h}][ccCode=${l}][ccSubCode=${c}][resultCategories=${(d||[]).join(",")}][Action=${e}][ActionBasedonResultCategory=${t}][isActionFromConfig=${a}]`);let u={[o.callId]:i?.callId,[o.callMode]:i?.callMode,[o.callControllerCode]:l,[o.callControllerSubCode]:c,[o.message]:`Action: ${e}, result category action: ${t} for scenario: ${n}`,[o.resultcategory]:d?.join(","),[o.terminatedReason]:h,[o.additionalTransactionEnd]:JSON.stringify(g),action:e,actionFromResultCategory:t,mismatchedScenario:n,isActionFromConfig:a};r.appendEventData(u),r.fail()}getActionBasedOnResultCategory(e){if(e=e?.map(e=>e.toLowerCase())){if(e.filter(e=>V.includes(e)).length>0)return"success";if(e.filter(e=>H.includes(e)).length>0)return"incomplete"}}getOngoingJoinAttemptByCorrelationId(e,t){return this.ongoingJoinAttempts.find(i=>this.isMatchingJoinAttemptByCorrelationId(i,e,t))}getOngoingJoinAttemptByJoinAttemptId(e,t){return this.ongoingJoinAttempts.find(i=>this.isMatchingJoinAttemptByJoinAttemptId(i,e,t))}startAndIncompleteScenario(e,t){let i=t===b.G.OneToOneCall||t===b.G.GroupCall?p.gT.scenarios.steps.calling.callScreenDoubleNavigation:p.gT.scenarios.steps.calling.joinMeetup.preJoinDoubleNavigation;this.newCallingScenario(e.teamsCall||null,e.scenarioName,e.eventData).incomplete({reason:i})}getEventData(e){let{callId:t,messageId:i,context:n,meetingType:a,joinOrCreate:r,...o}=e,s=e.threadId,l={...o,[p.gT.categories.meetingType]:C._n[a],[p.gT.categories.joinType]:r};return t&&(l[p.gT.counters.eventNames.id]=t,l[p.gT.counters.eventNames.callId]=t),i&&(l[p.gT.counters.eventNames.messageId]=i),s&&(this.chatServiceUtils.isPstnMri(s)?l[p.gT.categories.threadId]=p.gT.pstn.userType:(this.config.enableMeetingThreadIdValidation?.()&&(s=I.eU.isValidMeetingThreadId(s)?s:I.eU.getInvalidThreadIdString(s)),l[p.gT.categories.threadId]=s)),n&&(l[p.gT.categories.context]=n),e&&e.isBroadcast&&(l[p.gT.categories.isBroadcast]="true"),l}async getCallTypeAsync(e){let t={logging:{logger:this.logger,context:"getCallTypeAsync"}},i=this.config.enableNewCallTypeLogic?.()?await E.P.getCallingIntentTypeFromCall(e,t,this.conversationsAsyncService):await E.P.coordinatesTypeFromCallAsync(this.conversationsAsyncService,e,t);switch(i){case b.G.Meeting:case b.G.OngoingCall:return await this.callingSupportService.getOngoingCallMeetingType(e);case b.G.OneToOneCall:if(e.isMwbtCall)return"mwbtCall";return I.eU.isOneToOnePstnCall(e)||e.isEmergencyCall?"oneToOnePstnCall":"oneToOneCall";case b.G.GroupCall:return"groupCall";default:this.logger.error(`Unhandled intent type: ${i}`)}}get trouterState(){return this.callingAgentsService.getCallSupportDetector().isSlimCoreEnabled()?g.TrouterStateFromSkypeTsTrouter.Unknown:this.trouterService.state()}isWindowsN(){try{return this.helpers.isWindowsN()}catch(e){return!1}}isSfbCall(e){return e.teamsCallType===g.CallType.P2P&&1===e.participants.length&&!!e.participants[0].endpoints&&-1!==(0,h.findIndex)(e.participants[0].endpoints.endpointDetails,e=>e.endpointType===p.gT.endpointType.lync)}processStartCallTelemetry(e,t){let i=t.correlationId,n=t.joinAttemptId,a=this.config.enableJoinAttemptId()?this.getOngoingJoinAttemptByJoinAttemptId(e,n):this.getOngoingJoinAttemptByCorrelationId(e,i);if(a){if(a.wasAttemptedMultipleTimes=!0,!(this.config.enableJoinAttemptId()?a.joinAttemptIds.some(e=>e===n):a.correlationIds.some(e=>e===i))){this.startAndIncompleteScenario(t,e.type);let r=this.findDeeplinkScenario(i);r?.incomplete({reason:e.type===b.G.OneToOneCall||e.type===b.G.GroupCall?p.gT.scenarios.steps.calling.callScreenDoubleNavigation:p.gT.scenarios.steps.calling.joinMeetup.preJoinDoubleNavigation}),a.joinAttemptIds.push(n),a.correlationIds.push(i)}let r=a.scenario;if(this.config.enableJoinAttemptId()){if(a.mainJoinAttemptId===n){let e=t.eventData;e&&r.appendEventData(e)}}else if(a.mainAttemptCorrelationId===i){let e=t.eventData;e&&r.appendEventData(e)}return r}}propagateCallType(e,t){e.getStartCallScenario().then(e=>{e.eventData[p.gT.counters.eventNames.callType]=t}).catch(e=>{this.logger.warn(this.utilityService.getErrorLoggingString(e))}),this.eventingService.emit(p.gT.events.calling.callTypeChanged,{teamsCallId:e.teamsCallId,callType:t})}shouldCancelScenarios(e){return(0,h.includes)(S.TY,e.reason)}isUnexpectedCaptchaError(e){return e.callEndDiagnosticsInfo?.callControllerCode===400&&e.callEndDiagnosticsInfo?.callControllerSubCode===6500&&e.isCaptchaModalShown}shouldIncompleteScenarios(e){return(0,h.includes)(S.uO,e.reason)||!!e.abortReason||e.hasFailedDueToInvalidSkypeToken||e.isMeetingInvalidOrExpired||e.isInvalidMeetingCode||e.isConnectionError||e.isMeetingLifetimeExceededFailure||e.isMeetingJoinBlockedByPolicy||e.isNotAllowedToJoinBreakoutRoom||e.isInformationBarrierError||e.isMeetingXlBlockedByBreakoutRooms||e.hasNoActiveNetworkInterface||e.isAuthFailedWithInteractionRequired}shouldIncompleteScenariosForLobby(e){return this.hasFailedDueToInvalidSkypeToken(e)||this.isConnectionError(e)||this.isInformationBarrierError(e)||this.hasNoActiveNetworkInterface(e)}hasNoActiveNetworkInterface(e){return e&&e.code&&p.gT.meetingCodes.noActiveNetworkInterfaceCodes.includes(e.code)&&e.subCode&&p.gT.meetingCodes.noActiveNetworkInterfaceSubcodes.includes(e.subCode)}hasFailedDueToInvalidSkypeToken(e){return!!(e&&e.code&&p.gT.meetingCodes.invalidSkypeTokenCode.includes(e.code))}isConnectionError(e){return!!this.config.enableHandlingConnectionError?.()&&!!(e&&(e.code&&p.gT.meetingCodes.connectionErrorCodes.includes(e.code)||e.code&&p.gT.meetingCodes.mediaErrorCodes.includes(e.code)&&e.subCode&&p.gT.meetingCodes.mediaConnectivityFailureSubCodes.includes(e.subCode)))}isInformationBarrierError(e){return!!(e&&e.code&&p.gT.meetingCodes.informationBarrierCodes.includes(e.code)&&e.subCode&&p.gT.meetingCodes.informationBarrierSubCodes.includes(e.subCode))}async updateLoggingContextCallType(e){if(!e){this.loggingService.setContext(p.gT.categories.callType,""),this.loggingService.setContext(p.gT.categories.callIsChatVersion2,"");return}if(this.callInLoggingContext===e)return;this.loggingService.setContext(p.gT.categories.callType,await this.getCallTypeAsync(e)),this.loggingService.setContext(p.gT.categories.callIsChatVersion2,"");let t=await e.getCallingConversationAsync();t.alive(),this.promiseFactory.finalized(t.whenInitialized(e).then(async()=>{if(this.callInLoggingContext!==e)return;let i=await this.callingSupportService.getOngoingCallMeetingType(e);this.propagateCallType(e,i),this.loggingService.setContext(p.gT.categories.callType,i),this.loggingService.setContext(p.gT.categories.callIsChatVersion2,t.isChatV2())}),()=>{t.dispose()})}tryGetWrappedAutoBrbCallback(e,t,i,n,a){let r=this.shouldSendAutoBrbForTimeout(e),o=this.shouldSendAutoBrbForFailed(e);return this.shouldSendAutoBrbOnScenarioStop(r,o)?s=>{n?.(s),this.sendAutoBrbOnScenarioStop(e,t,s,r,o,i,a)}:n}shouldSendAutoBrbForTimeout(e){return this.sendAutoBrbForTimeoutCallingScenarios.includes(e)}shouldSendAutoBrbForFailed(e){return this.sendAutoBrbForFailedCallingScenarios.includes(e)}shouldSendAutoBrbOnScenarioStop(e,t){return e||t}sendAutoBrbOnScenarioStop(e,t,i,n,a,r,o=""){if(!(n&&"timeout"===i||a&&"failure"===i))return;let s=this.config.enableAutoBrbViaScenarioCallback?.()?`${e} ${i} ${o}`:`[AutoBrb]: ${e} ${i}`;this.servicesProvider.brbV2FeedbackService().sendFeedbackToBrbV2(!0,{category:t,title:s,description:n?"[AutoBrb] - Scenario stopped with timeout, reporting auto brb":"[AutoBrb] - Scenario stopped due to failure, reporting auto brb",allowScreenshots:!1,includeBackgroundBlurImages:!1,includeHeapSnapshot:!1,correlationId:r},void 0,!0)}sendAutoBrbOnScenarioWhenStopped(e,t){let i=e.name,n=this.shouldSendAutoBrbForTimeout(i),a=this.shouldSendAutoBrbForFailed(i);this.shouldSendAutoBrbOnScenarioStop(n,a)&&e.whenStopped.then(e=>{this.sendAutoBrbOnScenarioStop(i,t,e,n,a,void 0)})}static isTeamsCall(e){return e&&void 0!==e.teamsCallId}setMeetingCapabilityDependentData(e,t){let i=e?.meetingDetails?.meetingCapability?.forceAttendeeStreaming,n=e?.meetingDetails?.meetingCapability?.streamingModeActive;t[p.gT.scenarioDataPropNames.streamingData]={forceAttendeeStreaming:i,streamingModeActive:n},i||e?.conversationType?.toLowerCase()==="scheduledtownhall"?t[p.gT.counters.eventNames.streamingType]=p.gT.scenarios.calling.streamingType.townhall:(n||e?.callEndDiagnosticsInfo?.additionalDiagnostics?.overflowInformation?.isConverged)&&(t[p.gT.counters.eventNames.streamingType]=p.gT.scenarios.calling.streamingType.overflowV2),e?.meetingDetails?.meetingCapability?.maskIdentitiesForRole&&(t[p.gT.counters.eventNames.maskedMeeting]=!0),t[p.gT.counters.eventNames.eventId]=e?.meetingDetails?.eventDetails?.id,t[p.gT.counters.eventNames.templateId]=e?.meetingDetails?.templateDetails?.id,t[p.gT.counters.eventNames.hasCommentStream]=e?.meetingDetails?.meetingCapability?.liveChatEnabled,e?.meetingDetails?.meetingCapability?.liveChatEnabled&&(t[p.gT.counters.eventNames.commentStreamThreadId]=e?.streamThreadId)}isExpectedVdiCallDrop(e){return"vdiDisconnected_Generic"===e||"vdiDisconnected_VmWatchdog"===e}overrideScenarioTimeoutForOneToOneCalls(e,t){return[p.gT.scenarios.calling.createOneToOnePstnCall,p.gT.scenarios.calling.emergencyCall,p.gT.scenarios.calling.testEmergencyCall,p.gT.scenarios.calling.prepareCall,p.gT.scenarios.calling.createOneToOneCall,`${p.gT.scenarios.calling.createOneToOneCall}_v2`,p.gT.scenarios.calling.createGroupCall,p.gT.scenarios.calling.joinGroupCall,`${p.gT.scenarios.calling.createOneToOnePstnCall}_v2`].includes(e)?this.config.scenarioTimeoutInMinutes()*p.gT.timeInMiliseconds.minute:t}handleEmergencyCallFailure(e,t){(e.includes(p.gT.scenarios.calling.emergencyCall)||e.includes(p.gT.scenarios.calling.testEmergencyCall))&&t&&p.gT.emergencyCallFailureErrorcodes.includes(t)&&this.asObservable.trigger(p.gT.events.calling.emergencyCallFailed)}}W.DEFAULT_PROPS_GET_ERROR_MSG=["stack","message","name"];class ${constructor(){this.eventData={},this.whenStopped=new Promise(e=>{this._resolveWhenStopped=e})}appendEventData(e){}pause(e){}resume(e){}cancel(e,t){this._resolveWhenStopped("cancelled")}cancelAfterDigest(e){this._resolveWhenStopped("cancelled")}stop(e,t,i){this._resolveWhenStopped("stopped")}incomplete(e,t){this._resolveWhenStopped("incomplete")}incompleteAfterDigest(e){this._resolveWhenStopped("incomplete")}addCounter(e){}timeoutInMs(e){}markAggregateStart(e){}markAggregateStop(e){}mark(e,t,i){}stopAfterDigest(e){this._resolveWhenStopped("stopped")}fail(e,t){this._resolveWhenStopped("failed")}failAfterDigest(e){this._resolveWhenStopped("failed")}}},698664:function(e,t,i){i.d(t,{LW:()=>o,Y6:()=>g,s0:()=>c});var n,a,r,o,s,l,c,d=i(370574);(n=o||(o={}))[n.StartCall=1]="StartCall",n[n.StartScreenshareCall=2]="StartScreenshareCall",n[n.JoinCall=3]="JoinCall",n[n.JoinScreenshareCall=4]="JoinScreenshareCall",n[n.AcceptCall=5]="AcceptCall",n[n.AcceptScreenshareCall=6]="AcceptScreenshareCall",n[n.StartPstnCall=7]="StartPstnCall",n[n.UnifiedStart=8]="UnifiedStart",(a=s||(s={}))[a.JoinScheduledMeeting=1]="JoinScheduledMeeting",(r=l||(l={}))[r.MultiWindow=0]="MultiWindow",(c||(c={})).CallingWindowingContainerRenderDoneEventNotTriggered="calling-windowing-container-render-done-event-not-triggered";let g=[d.CallState.Connecting,d.CallState.InLobby]},996471:function(e,t,i){i.d(t,{n:()=>n});class n{constructor(e,t){this.loggingService=e,this.helpers=t,this.logger=this.loggingService.newLogger("CaptchaService"),this.logger.info("CaptchaService initialized")}async getCaptchaChallengeService(e){return this.helpers.getCaptchaChallengeService(e)}}},200669:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C,v,f,b,y;i.d(t,{Ck:()=>l,I6:()=>a,Jm:()=>T,MN:()=>g,NR:()=>h,Vo:()=>s,WE:()=>c,Y_:()=>n,bW:()=>I,st:()=>r,wJ:()=>d,zJ:()=>o}),(p=n||(n={})).GalleryAndContent="GalleryAndContent",p.Gallery="Gallery",p.Content="Content",p.Main="RigelMain",p.UniversalConsole="UniversalConsole",p.MeetingRoomCallMonitor="MeetingRoomCallMonitor",(u=a||(a={}))[u.Scheduled=0]="Scheduled",u[u.Broadcast=1]="Broadcast",u[u.Adhoc=2]="Adhoc",u[u.Recurring=3]="Recurring",u[u.MeetNow=4]="MeetNow",(m=r||(r={})).Stage="Stage",m.CallMonitor="CallMonitor",m.StageContent="StageContent";let T=[n.Main,r.Stage],I={...n,...r};(_=o||(o={}))[_.None=0]="None",_[_.FreshNavigation=1]="FreshNavigation",_[_.InplaceNavigation=2]="InplaceNavigation",(S=s||(s={}))[S.InitFailed=0]="InitFailed",S[S.JoinFailed=1]="JoinFailed",S[S.AcceptFailed=2]="AcceptFailed",S[S.ObservingCallTimeout=3]="ObservingCallTimeout",(C=l||(l={}))[C.E2EE_UNSUPPORTED_CLIENT_FAILURE=6150]="E2EE_UNSUPPORTED_CLIENT_FAILURE",(v=c||(c={}))[v.Continue=100]="Continue",v[v.SwitchingProtocols=101]="SwitchingProtocols",v[v.OK=200]="OK",v[v.Created=201]="Created",v[v.Accepted=202]="Accepted",v[v.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",v[v.NoContent=204]="NoContent",v[v.ResetContent=205]="ResetContent",v[v.PartialContent=206]="PartialContent",v[v.MultipleChoices=300]="MultipleChoices",v[v.Ambiguous=300]="Ambiguous",v[v.MovedPermanently=301]="MovedPermanently",v[v.Moved=301]="Moved",v[v.Found=302]="Found",v[v.Redirect=302]="Redirect",v[v.SeeOther=303]="SeeOther",v[v.RedirectMethod=303]="RedirectMethod",v[v.NotModified=304]="NotModified",v[v.UseProxy=305]="UseProxy",v[v.Unused=306]="Unused",v[v.TemporaryRedirect=307]="TemporaryRedirect",v[v.RedirectKeepVerb=307]="RedirectKeepVerb",v[v.BadRequest=400]="BadRequest",v[v.Unauthorized=401]="Unauthorized",v[v.PaymentRequired=402]="PaymentRequired",v[v.Forbidden=403]="Forbidden",v[v.NotFound=404]="NotFound",v[v.MethodNotAllowed=405]="MethodNotAllowed",v[v.NotAcceptable=406]="NotAcceptable",v[v.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",v[v.RequestTimeout=408]="RequestTimeout",v[v.Conflict=409]="Conflict",v[v.Gone=410]="Gone",v[v.LengthRequired=411]="LengthRequired",v[v.PreconditionFailed=412]="PreconditionFailed",v[v.RequestEntityTooLarge=413]="RequestEntityTooLarge",v[v.RequestUriTooLong=414]="RequestUriTooLong",v[v.UnsupportedMediaType=415]="UnsupportedMediaType",v[v.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",v[v.ExpectationFailed=417]="ExpectationFailed",v[v.UpgradeRequired=426]="UpgradeRequired",v[v.Throttle=429]="Throttle",v[v.InternalServerError=500]="InternalServerError",v[v.NotImplemented=501]="NotImplemented",v[v.BadGateway=502]="BadGateway",v[v.ServiceUnavailable=503]="ServiceUnavailable",v[v.GatewayTimeout=504]="GatewayTimeout",v[v.HttpVersionNotSupported=505]="HttpVersionNotSupported",(f=d||(d={}))[f.None=0]="None",f[f.Team=1]="Team",f[f.Chat=2]="Chat",(b=g||(g={}))[b.none=0]="none",b[b.pending=1]="pending",b[b.recording=2]="recording",b[b.paused=3]="paused",b[b.stopping=4]="stopping",b[b.failed=5]="failed",b[b.disabled=6]="disabled",b[b.waitingformeetinglive=7]="waitingformeetinglive",b[b.waiting=8]="waiting",(y=h||(h={}))[y.Unknown=0]="Unknown",y[y.Windows=1]="Windows",y[y.Mac=2]="Mac",y[y.Linux=3]="Linux"},575810:function(e,t,i){i.d(t,{$e:()=>b,Af:()=>ei,B1:()=>es,CT:()=>eo,Fp:()=>d,GX:()=>p,IN:()=>N,JE:()=>D,L7:()=>T,N0:()=>W,Nx:()=>M,OB:()=>E,OD:()=>U,Od:()=>m,Og:()=>ee,Ol:()=>X,Pd:()=>F,RN:()=>J,Rt:()=>L,SJ:()=>Y,Sg:()=>u,T:()=>w,TJ:()=>x,Ui:()=>G,ZR:()=>z,ZY:()=>el,aX:()=>er,dM:()=>V,fB:()=>v,fL:()=>S,gT:()=>y,hj:()=>ea,i7:()=>ec,iO:()=>Z,iy:()=>Q,lI:()=>k,mH:()=>q,mg:()=>P,oP:()=>H,pE:()=>en,pH:()=>R,pR:()=>O,pk:()=>g,qt:()=>$,rJ:()=>K,re:()=>_,sD:()=>et,sd:()=>B,tI:()=>j,u4:()=>A,uY:()=>I,ym:()=>h});var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C=i(178402);(n=d||(d={})).PREJOIN="prejoin",n.PLUGIN="plugin",(a=g||(g={})).none="None",a.citrix="Citrix",a.vmware="VMware",a.avd="AVD",a.windows365="Windows365",a.aws="AWS",a.citrixSlimCore="CitrixSlimCore",a.vmwareSlimCore="VMwareSlimCore",a.avdSlimCore="AVDSlimCore",a.windows365SlimCore="Windows365SlimCore",a.awsSlimCore="AWSSlimCore",(r=h||(h={})).none="",r[r.wvd=43]="wvd",r[r.citrixXenDesktop=44]="citrixXenDesktop",r[r.citrixXenApp=44]="citrixXenApp",r[r.vmware=45]="vmware",(o=p||(p={}))[o.MsftTeamsRoom=0]="MsftTeamsRoom",o[o.PersonalClient=1]="PersonalClient",o[o.CompanionDevice=2]="CompanionDevice",(s=u||(u={}))[s.SUCCESS=0]="SUCCESS",s[s.FORBIDDEN=403]="FORBIDDEN",s[s.INVALID_PARTICIPANT=406]="INVALID_PARTICIPANT",s[s.MEDIA_ERROR=410]="MEDIA_ERROR",s[s.CLIENT_ERROR=499]="CLIENT_ERROR",s[s.SIGNALING_ERROR=599]="SIGNALING_ERROR",(l=m||(m={}))[l.LOCAL_REJECT=0]="LOCAL_REJECT",l[l.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",l[l.UNMUTE_ERROR=3124]="UNMUTE_ERROR",l[l.CLIENT_DOES_NOT_SUPPORT_TOKEN_TYPE=3126]="CLIENT_DOES_NOT_SUPPORT_TOKEN_TYPE",l[l.TRANSACTION_NOT_ALLOWED=3548]="TRANSACTION_NOT_ALLOWED",l[l.INVALID_ARGUMENT=3549]="INVALID_ARGUMENT",l[l.CANNOT_PARSE_RESULT=3550]="CANNOT_PARSE_RESULT",l[l.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE=3551]="TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE",l[l.INVITE_FAILURE=5201]="INVITE_FAILURE",l[l.NOT_IN_LOBBY=3552]="NOT_IN_LOBBY",l[l.LEFT_LOBBY=3553]="LEFT_LOBBY",l[l.DENIED_IN_LOBBY=3554]="DENIED_IN_LOBBY",l[l.TIMED_OUT_IN_LOBBY=3555]="TIMED_OUT_IN_LOBBY",l[l.TRANSACTION_NOT_ALLOWED_FOR_E2EE=3556]="TRANSACTION_NOT_ALLOWED_FOR_E2EE",l[l.GENERIC_MEDIA_NEGOTIATION_FAILURE=3900]="GENERIC_MEDIA_NEGOTIATION_FAILURE",l[l.INTERACTION_NOT_ALLOWED=10124]="INTERACTION_NOT_ALLOWED",l[l.CALLEE_ALLOW_PRIVATE_CALLING_DISABLED=10199]="CALLEE_ALLOW_PRIVATE_CALLING_DISABLED",l[l.INTERACTION_REQUIRED=2e4]="INTERACTION_REQUIRED",l[l.AUTH_FAILURE=20500]="AUTH_FAILURE",l[l.NEW_TOKEN_MATCHES_INVALID_TOKEN=20501]="NEW_TOKEN_MATCHES_INVALID_TOKEN",l[l.EMPTY_TOKEN=20502]="EMPTY_TOKEN",l[l.FORBIDDEN_BY_PSTN_ROUTING_POLICY=510559]="FORBIDDEN_BY_PSTN_ROUTING_POLICY",l[l.DIALOUT_CPC_AND_PSTN_DISABLED=510562]="DIALOUT_CPC_AND_PSTN_DISABLED",(c=_||(_={})).TRANSACTION_COMPLETE="TransactionComplete",c.TRANSACTION_ALLOWED="TransactionAllowed",c.TRANSACTION_DISALLOWED="TransactionDisallowed",c.UNKNOWN="Unknown",c.STACK_NOT_INTIALIZED="Stack not intialized yet",c.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE="TransactionNotAllowedForStreamMode",c.TRANSACTION_NOT_ALLOWED_FOR_E2EE="TransactionNotAllowedForE2EE",c.NOT_IN_LOBBY="Participant is not in lobby state",c.NOT_IMPLEMENTED="Not implemented",c.MEDIA_FAILURE="Media failure",c.CLIENT_DOES_NOT_SUPPORT_TOKEN_TYPE="Client does not support token type",c.EMPTY_TOKEN="Received empty token",c.NEW_TOKEN_MATCHES_INVALID_TOKEN="Received token that matches invalid token",c.INTERACTION_REQUIRED="Interaction is required to get a token",c.AUTH_FAILURE="Encountered an expected auth failure while trying to fetch a token",(S||(S={})).RECORDING_STATUS_CHANGED="recordingStatusChanged";let v={second:1e3,threeSeconds:3e3,tenSeconds:1e4,thirtySeconds:3e4,minute:6e4,hour:36e5,day:864e5,week:6048e5,year:31536e6},f=2*v.hour,b="Unknown User",y={activeProtection:{scenarioType:"ActiveProtection"},flags:{enableBrokerIncoming:"enableBrokerIncoming",enableBrokerOutgoing:"enableBrokerOutgoing",enableBrowserScreenSharing:{chrome:"enableChromeScreenSharing",safari:"enableSafariScreenSharing",firefox:"enableFirefoxScreenSharing"},enableChromeGetDisplayMedia:"enableChromeGetDisplayMedia",enablePresentDeepLinkForMTMA:"enablePresentDeepLinkForMTMA",enableDeepLinkShareExtensibleApp:"enableDeepLinkShareExtensibleApp",enablePluginlessVDIReactWebClient:"enablePluginlessVDIReactWebClient",enableHostCommsForTransientStorage:"enableHostCommsForTransientStorage",callHoldInitiatorTimeoutInMs:"callHoldInitiatorTimeoutInMs",enableSlimCorePieVdiService:"enableSlimCorePieVdiService"},firstLoginDeviceKeys:{promptCards:"PromptCards"},routingInformationalDialogKeys:{web:"web"},userPresence:{interestedResourcePrefix:"/v1/users/ME/contacts/"},AllowPSTNConferencingDialOutType:{disabled:"Disabled",internationalAndDomestic:"InternationalAndDomestic"},anonymousMeeting:{anonymousUserNameCookieKey:"teamsAnonymousUserName",anonymousUserNameCookieExpirationInDays:365},audio:{notification:{ring:"ring"}},authentication:{anonymousMeetingCookieName:"anonymous_meetinginfo",skypeAuthRegionGcc:"gcc"},breakoutRooms:{autoMoveAnnouncementAlertName:"BreakoutRoomAnnouncement",breakoutRoom:"breakoutroom",breakoutRoomsMergeApiIncompletionCodes:"breakoutRoomsMergeApiIncompletionCodes",defaultTimerExpireDialogThresholdInSec:10,defaultTimerExpireUfdThresholdInSec:30,limitParticipantsForShowingLockXLMeetingsUFD:300,roomCreationFailedAlertName:"BreakoutRoomCreationFailed",breakoutRoomsUserTypes:{federated:"Federated",person:"person"},conversationType:{channel:"Channel"},telemetry:{activeCallEndedByOrganizer:"active_call_ended_by_organizer",activeCallEndedByUser:"active_call_ended_by_user",activeCallEndedDuringAutoMoveTimeout:"active_call_ended_during_auto_move_timeout",activeCallJoinedDuringAutoMove:"active_call_joined_during_auto_move",breakoutRoomInvite:"breakout_room_invite",breakoutRoomInviteFromAnotherRoom:"breakoutRoomInviteFromAnotherRoom",breakoutRoomInviteFromMainMeeting:"breakoutRoomInviteFromMainMeeting",breakoutRoomInviteToMainMeeting:"breakoutRoomInviteToMainMeeting",eventDataProps:{breakoutRoomAskToJoin:"breakoutRoomAskToJoin",breakoutRoomInviteType:"breakoutRoomInvite",endCallFailedRooms:"endCallFailedRooms",invitationData:"invitationData",mergeApiCauseId:"mergeApiCauseId",mergeApiSourceCallCoordinates:"mergeApiSourceCallCoordinates",mergeApiTargetCallCoordinates:"mergeApiTargetCallCoordinates",moveActions:"moveActions",moveParticipantAdditionalData:"moveParticipantAdditionalData",moveParticipantPromiseResults:"moveParticipantPromiseResults",participantsToMove:"participantsToMove",reassignActions:"reassignActions",relatedMeetingCallId:"relatedMeetingCallId",shouldAutoAcceptInvite:"shouldAutoAcceptInvite",sourceBreakoutRoomCoords:"sourceBreakoutRoomCoords",targetBreakoutRoomCoords:"targetBreakoutRoomCoords",isExtendedPstnInviteSent:"isExtendedPstnInviteSent",moveParticipantSourceCallId:"moveParticipantSourceCallId",moveParticipantDestinationCallId:"moveParticipantDestinationCallId",moveParticipantInviteInitiatedBy:"moveParticipantInviteInitiatedBy",moveParticipantDestinationMeetingCoordinates:"moveParticipantDestinationMeetingCoordinates",isMoveParticipantAutoAcceptEnabled:"isMoveParticipantAutoAcceptEnabled"},invalidRoomInvite:"invalid_room_invite",mainMeetingInvite:"main_meeting_invite",scenarios:{breakoutRoomsApplyMoveActions:"breakout_rooms_apply_move_actions",breakoutRoomsApplyReassignActions:"breakout_rooms_apply_reassign_actions",breakoutRoomsBulkMoveAction:"breakout_rooms_bulk_move_action",deleteAllOperation:"breakout_rooms_delete_all_operation",getBreakoutRoom:"breakout_room_info",goBackToMainMeeting:"breakout_rooms_go_back_to_main_meeting",goToAssignedBreakoutRoomAction:"breakout_rooms_go_to_assigned_breakout_room_action",listBreakoutRoomsWithDetails:"breakout_rooms_with_details",lockXlMeetings:"breakout_rooms_lock_xl_meetings",participantMergeOperation:"breakout_rooms_participant_merge_operation",setTimerExpireDialogTimeout:"breakout_rooms_set_timer_expire_dialog_timeout",setTimerExpireUfdTimeout:"breakout_rooms_set_timer_ufd_timeout",showTimerExpireDialog:"breakout_rooms_show_timer_expire_dialog",showTimerExpireUfd:"breakout_rooms_show_timer_expire_ufd",unlockXlMeetings:"breakout_rooms_unlock_xl_meetings",updateBreakoutRoomsInBulk:"breakout_rooms_bulk_update",bulkOpenBreakoutRooms:"breakout_rooms_bulk_open",bulkCloseBreakoutRooms:"breakout_rooms_bulk_close",breakoutRoomsFetchingParticipantsForAssignment:"breakout_rooms_fetching_participants_for_assignment",breakoutRoomsMoveParticipant:"breakout_rooms_move_participant",breakoutRoomsMainMeetingCallObservation:"breakout_rooms_main_meeting_call_observation",breakoutRoomsMoveWithinSameWindowBetweenMeetings:"breakout_rooms_move_within_same_window_between_meetings"},sourceBreakoutRoom:"source_breakout_room",steps:{calculateAlertDelay:"calculate_alert_delay",callMerge:"call_merge",disposeCall:"dispose_call",endRoomCallForAll:"end_room_call_for_all",getBreakoutRoomFromMT:"get_breakout_room_from_mt",getBreakoutRoomObservableCall:"get_breakout_room_observable_call",getBreakoutRoomSettings:"get_breakout_room_settings",goBackToMainMeetingLeaveCall:"go_back_to_main_meeting_leave_call",moveParticipantsPromise:"move_participants_promise",getCalls:"get_calls",moveParticipantsPromiseCauseId:"moveParticipantsPromiseCauseId",showMoveAnnouncementAlert:"show_move_announcement_alert",showMoveAnnouncementUFD:"show_move_announcement_UFD",updateBreakoutRoom:"update_breakout_room",updateBreakoutRoomSettings:"update_breakout_room_settings",updateChatAccess:"update_chat_access",getBreakoutRoomsForBulkOpeningClosing:"get_breakout_rooms_for_bulk_opening_closing",endBreakoutRoomCallForAll:"end_breakout_room_call_for_all",bulkActionMoveParticipants:"bulk_action_move_participants",listOfUsersInTabFetched:"breakout_rooms_list_of_users_in_tab_fetched",listOfBreakoutRoomsAssignedParticipantsFetched:"breakout_rooms_list_of_assigned_participants_fetched",listOfRoomsLoaded:"breakout_rooms_list_of_rooms_loaded",callActivation:"call_activation",autoMoveTimeoutNotDefined:"breakout_rooms_auto_move_participants_timeout_not_defined",moveParticipantSourceCallLeft:"breakout_rooms_move_participant_source_call_left",moveParticipantDestinationCallJoined:"breakout_rooms_move_participant_destination_call_joined",ensureAllPreviousMovesCompleted:"breakout_rooms_ensure_all_previous_moves_completed",breakoutRoomTargetCallJoined:"breakout_rooms_target_call_joined",breakoutRoomEmitUiChanges:"breakout_rooms_emit_ui_change",breakoutRoomsActiveCallLeaveTriggered:"breakout_rooms_active_call_leave_triggered",applyReassignActions:"apply_reassign_actions",applyMoveActions:"apply_move_actions"},targetBreakoutRoom:"target_breakout_room",dataSource:{assignmentDistribution:"assignmentDistribution"}}},stagingRooms:{publishStateUFDParamValue:"stage-curtain",publishEndCurtainStateUFDParamValue:"stage-end-curtain",meetingIsLiveAlertName:"StageCurtainMeetingIsLiveAnnouncement",telemetry:{meetingGoLive:"meeting_go_live",meetingShowEndCurtain:"meeting_end_curtain",steps:{meetingGoLiveComplete:"meeting_go_live_complete",meetingShowEndCurtainComplete:"meeting_end_curtain_complete",updateAttendeeRestrictionsComplete:"update_attendee_restrictions_complete",meetingGoLiveFailed:"meeting_go_live_failed",meetingGoLivePublishStateSucceeded:"meeting_go_live_publish_state_succeeded",meetingGoLiveTimeoutCompleted:"meeting_go_live_timeout_completed",meetingGoLiveTimeoutStarted:"meeting_go_live_timeout_started",meetingGoLivePublishStateFailed:"meeting_go_live_publish_state_failed",meetingShowEndCurtainPublishStateFailed:"meeting_end_meeting_curtain_publish_state_failed",meetingGoLiveExpectedFailureDueToRaceCondition:"meeting_go_live_expected_failure_due_to_race_condition",meetingGoLiveExpectedFailureDueToOldSlimcoreVersion:"meeting_go_live_expected_failure_due_to_old_slimcore_version",meetingGoLiveExpectedFailureDueToSslError:"meeting_go_live_expected_failure_due_to_ssl_error",meetingShowEndCurtainCExpectedFailureDueToRaceCondition:"meeting_end_curtain_expected_failure_due_to_race_condition",meetingShowEndCurtainExpectedFailureDueToOldSlimcoreVersion:"meeting_end_curtain_expected_failure_due_to_old_slimcore_version",meetingShowEndCurtainCallStateDisconnecting:"meeting_end_curtain_call_state_disconnecting",meetingGoLiveAlertCompleted:"meeting_go_live_alert_completed"},eventDataProps:{causeId:"causeId",targetTeamsCallId:"targetTeamsCallId",targetCallId:"targetCallId"}}},browser:{chrome:"chrome",chromium:"chromium",edge:"edge",edgeChromium:"edgeChromium",firefox:"firefox",ie:"ie",safari:"safari"},categories:{broadcastMediaCount:"Call.BroadcastMediaCount",broadcastModalityState:"Call.BroadcastModalityState",broadcastRole:"Call.BroadcastRole",callId:"Call.Id",callingDisabledForVdi:"callingDisabledForVdi",callIsChatVersion2:"Call.IsChatVersion2",callMode:"callMode",callType:"Call.Type",callWasPoppedOut:"Call.WasPoppedOut",channel:"channel",context:"context",conversationId:"conversationId",deeplinkId:"deeplinkId",deepLinkSource:"deepLinkSource",isolatedAudioEnabled:"isolatedAudioEnabled",isAppHandlingAudio:"isAppHandlingAudio",isBroadcast:"Call.IsBroadcast",isScreenshareFromChat:"isScreenshareFromChat",isHuddleGroupCall:"isHuddleGroupCall",isSlimCoreHotSwapped:"isSlimCoreHotSwapped",joinType:"joinType",meetingType:"meetingType",ndiEnabled:"ndiEnabled",ndiPreviouslyEnabled:"ndiPreviouslyEnabled",ndiDisabledByUserAction:"ndiDisabledByUserAction",ndiWasCaptured:"ndiWasCaptured",homeCloud:"homeCloud",participantId:"Call.ParticipantId",requestId:"requestId",scdEnabled:"scdEnabled",slimcoreBuiltInVersion:"slimcoreBuiltInVersion",slimcoreVersion:"slimcoreVersion",status:"status",threadId:"threadId",trouterClientState:"trouterClientState",trouterState:"trouterState",trouterUrls:"trouterUrls",tsCallingVersion:"tsCallingVersion",tsTrouterVersion:"tsTrouterVersion",vdiProvider:"vdiProvider",vdiVersion:"vdiVersion",vdiFeatureSupported:"vdiFeatureSupported",vdiConnectedState:"vdiConnectedState",vdiModeDynamic:"vdiModeDynamic",vdiMode:"vdiMode",vdiStackSwitch:"vdiStackSwitch",vdaVersion:"vdaVersion",slimcoreVdiInfo:"slimcoreVdiInfo",slimcoreVersionAndStack:"slimcoreVersionAndStack"},callableChannels:{id:"callableChannels"},callerIds:{CallStartedMessageProviderGetMessage:"CallStartedMessageProviderService_getMessageInternal"},calling:{roles:{guest:"guest",admin:"admin"},voicemail:{resourcePath:{greeting:"greeting"}},streamItemProperties:{screenShareSuffix:"_s"},callStates:{end:"ended"},participantVideo:{metadataKey:"participantVideoType",typeMulticam:"multicam",typeIntelliframe:"intelliframe",multicamDeviceId:"composite_multicam"},oboDelegator:"onBehalfOfDelegator",callViewMode:{minimized:"minimized",immersive:"immersive"},userLevelPoliciesKey:"user"},globalAppState:{init:{name:"app_state_init"},get:{name:"app_state_get"},set:{name:"app_state_set"},subscribe:{name:"app_state_subscribe"}},globalState:{scenarioSteps:{coordinateStart:"coordinate-start",coordinateSucceeded:"coordinate-succeeded",coordinateFailed:"coordinate-failed",coordinateCallbackStart:"coordinate-callback-start",coordinateCallbackSuccess:"coordinate-callback-success",coordinateCallbackFailure:"coordinate-callback-failure"}},multiCallsManager:{init:{name:"multi_calls_manager_init"},callHoldStateChange:{name:"call_hold_state_change"}},serviceDispose:{errors:{timeoutDisposingCallingStack:"timeout_disposing_calling_stack"},names:{callingServiceDispose:"calling_service_dispose",perServiceDispose:"per_service_dispose"},steps:{disposeCalledWithinApi:"dispose_called_within_api",disposePerAccountServices:"dispose_per_acount_services",disposeGlobalServicesOnPerAccountTeardown:"dispose_global_services_on_per_account_teardown",disposeGlobalServicesOnGlobalTeardown:"dispose_global_services_on_global_teardown"},perServiceSteps:{callingService:{unloadCallingStarted:"unload_calling_started",cleanupOnAppTeardown:"cleanup_on_app_teardown",callRegistryUninit:"call_registry_uninit",stopSlimcoreTrouter:"stop_slimcore_trouter",stopTrouterFromCallingService:"stop_trouter_from_calling_service",stopTrouterFromCallingAgentsService:"stop_trouter_from_calling_agents_service",disposeCallRegistry:"dispose_call_registry",disposeCallingStack:"dispose_calling_stack"},globalSlimCoreLoaderService:{startSlimCoreUnload:"start_slimcore_unload",getModuleloader:"get_moduleloader",slimcoreUnloadThrowsInProcErr:"slimcore_unload_throws_in_proc_err",slimcoreUnloaded:"slimcore_unloaded"}}},callListTab:{panes:{all:"all-calls",contactList:"contact-list-calls",saved:"saved-calls",speedDial:"speed-dial",voicemail:"voicemail"}},callsMainApp:{clientId:"calls_main_app_client_id"},contact:{contactType:{Group:"Group",ADUser:"ADUser",DistributionList:"DistributionList"}},counters:{eventNames:{abortReason:"abortReason",acceptCallInCallMonitor:"acceptCallInCallMonitor",activeCallId:"activeCallId",additionalData:"additionalData",additionalTransactionEnd:"additionalTransactionEnd",alternateId:"alternateId",autoBrbDesc:"autoBrbDesc",autoBrbTitle:"autoBrbTitle",isWebRTCVdiMode:"isWebRTCVdiMode",avIsRemoted:"avIsRemoted",batteryCharging:"batteryCharging",backgroundBlur:{isBlurOnAtEndOfCall:"backgroundBlur.isBlurOnAtEndOfCall",wasBlurOnFromPreJoin:"backgroundBlur.wasBlurOnFromPreJoin",totalBlurringMinutes:"backgroundBlur.totalBlurringMinutes"},batteryLevel:"batteryLevel",beaconAvailabilityTime:"beaconAvailabilityTime",beaconStartSuccessCount:"beaconStartSuccessCount",breakoutRoom:{timerAlertDelay:"breakoutRoom.timerAlertDelay",currentRemainingDuration:"breakoutRoom.currentRemainingDuration",alertThreshold:"breakoutRoom.alertThreshold"},broadcastRole:"broadcastRole",callCancelledOnTransportCompanionDevice:"callCancelledOnTransportCompanionDevice",callControllerCode:"callControllerCode",callControllerSubCode:"callControllerSubCode",callDataBag:"call_dataBag",callId:"callId",callIdOverride:"callIdOverride",callIPCStats:"callIPCStats",callLeaveStatus:"callLeaveStatus",callMergeInfo:"callMergeInfo",callMode:"callMode",callNotJoinedOnTransportCompanionDevice:"callNotJoinedOnTransportCompanionDevice",callParticipantUserRole:"callParticipantUserRole",callQueueInfo:"callQueueInfo",callSchedulingDetails:"callSchedulingDetails",callStartedOffline:"callStartedOffline",callToMergeId:"callToMergeId",callToReplace:"callToReplace",callTransferContextSize:"callTransferContextSize",callTransferTopicSize:"callTransferTopicSize",callType:"callType",causeId:"causeId",clientRequestId:"clientRequestId",clientRole:"clientRole",coldDeepLinkJoin:"coldDeepLinkJoin",commandId:"commandId",commentStreamThreadId:"commentStreamThreadId",constraints:"constraints",consultationType:"consultationType",context:"context",convUrl:"convUrl",conversationType:"conversationType",correlationId:"correlationId",deficiency:"deficiency",deviceLabel:"deviceLabel",diagnosticsData:"diagnosticsData",dialIn:"DialIn",dialOut:"DialOut",e2eeEnabled:"e2eeEnabled",effectType:"effectType",emergencyCall:"emergencyCall",testEmergencyCall:"testEmergencyCall",enableTextureSharing:"enableTextureSharing",endpointId:"endpointId",endpointType:"endpointType",environmentSupport:"environmentSupport",error:"error",errorInfo:"errorInfo",errorReason:"errorReason",eventId:"eventId",title:"title",feedsSubtype:"feedsSubtype",forwardingDestinationType:"forwardingDestinationType",holdDurationInMillis:"holdDurationInMillis",homeCloud:"homeCloud",hasCommentStream:"hasCommentStream",isCrossCloudCall:"isCrossCloudCall",isCCAMediaProxied:"isCCAMediaProxied",id:"id",imageOrigin:"imageOrigin",imageType:"imageType",incomingCallType:"incomingCallType",instantMeetingScenarioId:"instantMeetingScenarioId",interopScreenshareInfo:"interopScreenshareInfo",intentType:"intentType",inSurvivabilityMode:"inSurvivabilityMode",isAvatarOn:"isAvatarOn",isBroadcast:"isBroadcast",isScreenShare:"isScreenShare",isPptShareInManagedMode:"isPptShareInManagedMode",isCompanionSelectionFlow:"isCompanionSelectionFlow",isCopilot:"isCopilot",isCustomNotification:"isCustomNotification",isDefaultImage:"isDefaultImage",isGpuCompositingEnabled:"isGpuCompositingEnabled",isManagedModeEnabled:"isManagedModeEnabled",isMeetingMerge:"isMeetingMerge",isOrganizer:"isOrganizer",isOrganizerInCall:"isOrganizerInCall",hasSkypeParticipant:"hasSkypeParticipant",isRemoteParticipantPstn:"isRemoteParticipantPstn",isSlimCoreDirectConnectionActive:"isSlimCoreDirectConnectionActive",isSlimCoreRunningOutproc:"isSlimCoreRunningOutproc",isVideoOn:"isVideoOn",isPrivateLine:"isPrivateLine",hasCallTopic:"hasCallTopic",isAiInterpreterEnabled:"isAiInterpreterEnabled",callEscalatedByPA:"callEscalatedByPA",isMeetingAcrossTFLTFW:"isMeetingAcrossTFLTFW",isMultilingualMeeting:"isMultilingualMeeting",isMultilingualMeetingOptionEnabled:"isMultilingualMeetingOptionEnabled",isTPManagement:"isTPManagement",joinWithCode:"joinWithCode",leaveCallContext:"leaveCallContext",leaveCallReasonCMD:"leaveCallReasonCMD",limitedDeviceAccess:"limitedDeviceAccess",maskedMeeting:"maskedMeeting",meetingCode:"meetingCode",meetingPasscode:"meetingPasscode",meetingRole:"meetingRole",meetingRoles:"meetingRoles",meetingTenantId:"meetingTenantId",meetingUrl:"meetingUrl",mergeType:"mergeType",message:"message",messageId:"messageId",method:"method",negotiationTag:"negotiationTag",networkDownlink:"networkDownlink",networkEffectiveType:"networkEffectiveType",networkRtt:"networkRtt",networkSaveData:"networkSaveData",networkType:"networkType",nodeId:"nodeId",onBehalfOfMri:"onBehalfOfMri",operation:"operation",participantId:"participantId",permissions:"permissions",previousStep:"previousStep",pstnFallbackSuccess:"pstnFallbackSuccess",reason:"reason",recordingBotMri:"recordingBotMri",recordingCorrelationId:"recordingCorrelationId",remoteParticipantId:"remoteParticipantId",requestCreatedTime:"requestCreatedTime",requestedMeetingRole:"requestedMeetingRole",resultcategory:"resultcategory",retryCount:"retry_count",ringOthers:"ringOthers",rootMessageId:"rootMessageId",scope:"scope",selectedCameraId:"selectedCameraId",selectedMicrophoneId:"selectedMicrophoneId",selectedSpeakerId:"selectedSpeakerId",sharerParticipantId:"sharerParticipantId",sharerPlatform:"sharerPlatform",signalingScenarioName:"signalingScenarioName",signalingScenarioStatus:"signalingScenarioStatus",spotlightedUserInfoIds:"spotlightedUserInfoIds",spotlightedVBSSUserInfoIds:"spotlightedVBSSUserInfoIds",stagingRoomEnabled:"stagingRoomEnabled",stagingRoomEventActive:"stagingRoomEventActive",stagingRoomEventEnded:"stagingRoomEventEnded",startSystemAudio:"startSystemAudio",stateIds:"stateIds",streamingType:"streamingType",systemAudioBadSignalTracking:{avgIntervalLength:"badSignalAvgIntervalLengthMs",intervalCount:"badSignalIntervalCount",intervalLengths:"badSignalIntervalLengthsMs",intervalsUnder2Sec:"badSignalIntervalsUnder2Sec",intervals2To5Sec:"badSignalIntervals2To5Sec",intervals5To10Sec:"badSignalIntervals5To10Sec",intervalsOver10Sec:"badSignalIntervalsOver10Sec",maxIntervalLength:"badSignalMaxIntervalLengthMs",sessionFinishedWithBadSignal:"sessionFinishedWithBadSignal"},systemAudioDuration:"duration",targetUserInfoId:"targetUserInfoId",targetType:"targetType",teamsCallId:"teamsCallId",templateId:"templateId",terminatedReason:"terminatedReason",thirdPartyRoomCorrelationId:"thirdPartyRoomCorrelationId",thirdPartyRoomHostSpeakerDeviceLabelSupported:"thirdPartyRoomHostSpeakerDeviceLabelSupported",thirdPartyRoomHostMicrophoneDeviceLabelSupported:"thirdPartyRoomHostMicrophoneDeviceLabelSupported",thirdPartyRoomHostCameraDeviceLabelSupported:"thirdPartyRoomHostCameraDeviceLabelSupported",thirdPartyRoomHostVendorId:"thirdPartyRoomHostVendorId",thirdPartyRoomHostAPIVersion:"thirdPartyRoomHostAPIVersion",thirdPartyRoomHostCameraDeviceIDExist:"thirdPartyRoomHostCameraDeviceIDExist",thirdPartyRoomHostCameraDeviceLabelExist:"thirdPartyRoomHostCameraDeviceLabelExist",thirdPartyRoomHostMicrophoneDeviceIDExist:"thirdPartyRoomHostMicrophoneDeviceIDExist",thirdPartyRoomHostMicrophoneDeviceLabelExist:"thirdPartyRoomHostMicrophoneDeviceLabelExist",thirdPartyRoomHostSpeakerDeviceIDExist:"thirdPartyRoomHostSpeakerDeviceIDExist",thirdPartyRoomHostSpeakerDeviceLabelExist:"thirdPartyRoomHostSpeakerDeviceLabelExist",threadId:"threadId",transactionEndData:{code:"code",failureReason:"failureReason",phrase:"phrase",subCode:"subCode"},transferorMri:"transferorMri",transferorType:"transferorType",transferCallId:"transferCallId",transferType:"transferType",unifiedFlow:"unifiedFlow",usesSlimcore:"uses_slimcore",vdiVersionInfo:"vdiVersionInfo",viewerPlatform:"viewerPlatform",voiceIsolationBannerInfo:{displayState:"display_state",numberOfActivations:"number_of_activations"},wasInLobby:"wasInLobby",wasInStaging:"wasInStaging",wasPoppedOut:"wasPoppedOut",webinar:{isPublicEvent:"isPublicEvent",participantRegistrationId:"participantRegistrationId"},renderStatus:"renderStatus",renderStatusMessage:"renderStatusMessage"},eventValues:{calling:{chromiumRenderer:"chromium_renderer",nativeRenderer:"native_renderer",rendererInCompositor:"renderer_in_compositor",rendererMainCompositor:"renderer_main_compositor"},windowState:{minimized:"minimized",restored:"restored"}}},dialogs:{addBuddyToGroup:"AddBuddyToGroup",addMembersSpeedDial:"AddMembersSpeedDial",routingSettingsInformationalDialog:"routingSettingsInformationalDialog",alert:"Alert",settings:{numberOfNamesInTitle:3},confirmDialog:"ConfirmDialog",callingConfirm:"CallingConfirm",optionsSettingsDialog:"optionsSettingsDialog",customerFeedbackDialogAdhoc:"customerFeedbackDialogAdhoc",callingUnparkCall:"CallingUnparkCall",officeContactCardDialog:"officeContactCardDialog"},deepLinkTypes:{meetingWithCode:"meet",meetupJoin:"meetup-join"},icons:{notification:{callTransferFailed:"callTransferFailed",chat:"chat",jumpin:"jumpin",meetingAudio:"meeting-audio",meetingVideo:"meeting-video",phone:"phone",transfer:"call-transfer"}},desktopApp:{callManagerEvents:{muteCallActionEvent:"MuteCallActionEvent",reportMuteStateChange:"reportMuteStateChange",completeAction:"completeAction"},desktopTelemetryConstants:"desktopTelemetryConstants",desktopSettings:"desktopSettings",lockState:{unknown:0,locked:1,unlocked:2},registry:{apps:{teams:"Teams",lync:"Lync"},protocols:{callto:"callto",im:"im",msteams:"msteams",sip:"sip",sips:"sips",tel:"tel",sfbCalling:"callto,sip,sips,tel"}},powerMonitor:{suspend:"suspend",resume:"resume"}},deviceType:{mobile:"mobile",tablet:"tablet",computer:"computer",surfaceHub1:"surfaceHub1",smartDevice:"smartDevice",rigel:"rigel",teamsDevice:"teamsDevice",samsungTV:"samsungTV",cherryDevice:"cherryDevice",tesla:"tesla"},responseCode:{conflict:409,tooManyRequests:429},timeConversion:{numMsInSecond:1e3,numSecondInMinute:60,numMinuteInHour:60,numHourInDay:24,numMsInDay:864e5},maxBroadcastConcurrentVideosCount:9,mrisWithSensitiveData:["8:live:","4:"],endpointType:{lync:"lync",voicemail:"voicemail",default:"default"},dbNames:{teamsDb:"teams"},events:{preferredClientDialogs:{done:"preferredClientDialogs_done"},appState:{changed:"appState:changed",optimizedPerfModeChanged:"optimizedPerfModeChanged"},anonymousMeeting:{nameChangeEvent:"nameChange"},betterTogether:{callingScreenStatusChanged:"betterTogether:callingScreenStatusChanged",devicesChanged:"devicesChanged"},greenScreen:{colorPickerToggled:"colorPickerToggled",colorPickingActionCompleted:"colorPickingActionCompleted",colorDetectionCompleted:"colorDetectionCompleted",enableColorPickingAction:"enableColorPickingAction",greenScreenEffectToggleClick:"greenScreenEffectToggleClick"},bluetoothLE:{radioNotReady:"ble:radio-not-ready",radioReady:"ble:radio-ready",publisherStatusChanged:"ble:publisher-status-changed",publisherAvailable:"ble:publisher-available",publisherNotAvailable:"ble:publisher-not-available",burstScanStopped:"ble:burst-scan-stopped",discover:"ble:discover",getPublisherState:"ble:get-publisher-state",getRadioState:"ble:get-radio-state",advertisementStart:"ble:advertisement-start",advertisementStop:"ble:advertisement-stop",burstScan:"ble:burst-scan",scan:"ble:scan",scanStart:"ble:scan-start",scanStop:"ble:scan-stop",mtrDiscovery:"mtr-discovery",personalClientDiscovery:"client-discovery",companionDiscovery:"companion-discovery",adjacent:"adjacent",proximal:"proximal",personalClient:{loudSpeakerInMeeting:"loud-speaker-in-meeting"},bleAdminSettingsUpdated:"ble-admin-settings-updated"},pmpHelper:{byodRoomsUpdated:"byodRoomsUpdated",byodStateChanged:"byodStateChanged"},byodParticipantJoinMeetingSpaceEvent:"byodParticipantJoinMeetingSpaceEvent",gattDevices:{deviceListChange:"gdd:DeviceListChange",watchCharacteristic:"gdd:WatchCharacteristic",watchedCharacteristicChanged:"gdd:WatchedCharacteristicChanged",getConnectedDevices:"gdd:GetConnectedDevices",getDeviceServices:"gdd:GetDeviceServices",getCharacteristicValue:"gdd:GetCharacteristicValue",setCharacteristicValue:"gdd:SetCharacteristicValue",sessionStatusChange:"gdd:SessionStatusChange"},broadcast:{attendeeCountUpdate:"attendeeCountUpdate",transcriptionUpdate:"broadcast_transcriptionUpdate",localMediaVideoStreamUpdate:"localMediaVideoStreamUpdate",overflowRoomFound:"overflowRoomFound",composerRemoved:"broadcast_removed_composer",bmcRemoved:"broadcast_removed_bmc",signalRConnectionFailure:"signalRConnectionFailure",signalRConnectionSuccess:"signalRConnectionSuccess",qnaFeedUpdatedNotification:"qnaFeedUpdatedNotification",broadcastStreamUpdate:"broadcastStreamUpdate",validateBroadcastPlayback:"validateBroadcastPlayback",attendeeMeetingInfoReceived:"attendeeMeetingInfoReceived",broadcastStreamUpdateTimeout:"broadcastStreamUpdateTimeout",roleChanged:"broadcast_changed_role",playbackStarted:"playbackStarted",modalityRinging:"broadcast_ringing_state",receivedInvalidBroadcastStreamUpdate:"receivedInvalidBroadcastStreamUpdate"},buddyListService:{buddyGroupUpdated:"buddy_group_updated",buddyGroupsChanged:"buddy_groups_changed"},chats:{composeBoxStateUpdated:"composeBoxStateUpdated",sfCChatStatusUpdate:"sfCChatStatusUpdate"},contacts:{addContactPeoplePickerKey:"add-contact-people-picker-key",blockUnblockContact:"block-unblock-contact"},callableChannel:{callableChannelUpdated:"callable_channel_updated"},calling:{aiInterpretationTurnedOn:"aiInterpretationTurnedOn",audioStoppedEvent:"audio_stopped_event",accountConfigDataUpdated:"account_config_data_updated",accountConfigE2EEUpdated:"accountConfigE2EEUpdated",actionFailedWithInsufficientMeetingRole:"actionFailedWithInsufficientMeetingRole",activeVideoDevicePluggedOut:"activeVideoDevicePluggedOut",addParticipant:"add_participant",addedParticipant:"added_participant",startStream:"start_stream",adminSettingsChanged:"admin-settings-changed",annotationSharingStatusChanged:"annotation_sharing_status_changed",appDeviceIdChanged:"appDeviceIdChanged",appSoundSyncTriggered:"app_sound_sync_triggered",attemptAutoAccept:"attempt_auto_accept",attemptAutoAcceptFailed:"attempt_auto_accept_failed",attendeeParticipantRestrictionsChanged:"attendee_participant_restrictions_changed",attendeeRestrictionsChanged:"attendeeRestrictionsChanged",audienceSceneChanged:"audienceSceneChanged",audienceSceneSeatingChanged:"audienceSceneSeatingChanged",audienceSelectSceneAck:"audienceSelectSceneAck",audioDeviceSelectionChanged:"audioDeviceSelectionChanged",autoHandRaiseCoachmarkStateChanged:"autoHandRaiseCoachmarkStateChanged",betterTogether:{startCall:"betterTogether_startCall",transportComapanionCallStateChange:"betterTogether_transportComapanionCallStateChange"},blurringCapabilityChanged:"device-manager-blurring-capability-changed",blurStateChanged:"blur-state-changed",buttonContextSwitchEvent:"buttonContextSwitchEvent",callAccessibilitySettingsChanged:"callAccessibilitySettingsChanged",callAdded:"callAdded",callRemoved:"callRemoved",callCameraChanged:"callCameraChanged",callConnecting:"call_connecting",callConnected:"call_connected",callForwardingSettingsChanged:"call_forwarding_settings_changed",callShareToStageAvailable:"call_share_to_stage_available",callCreated:"call_created",callDisconnecting:"call_disconnecting",callDisplayed:"call_displayed",conversationUpdated:"conversation_updated",callDisposed:"call_disposed",callDowngradeFromHolographic:"callDowngradeFromHolographic",callEscalated:"callEscalated",callEscalatedFromContentOnly:"callEscalatedFromContentOnly",callEscalationFailed:"call_escalation_failed",callGroupMembershipSettingsChanged:"call_group_membership_settings_changed",callHeld:"call_held",callHealthTab:{getTechnicalInfoFailure:"call_health_get_technical_info_failure"},callHealthValuesUpdated:"call_health_values_updated",callingAttemptFailure:"calling_attempt_failure",callingIntentEvent:"calling_intent_event",callingScreenGalleryTypeChanged:"callingScreenGalleryTypeChanged",callLogUpdated:"callLogUpdated",callMerged:"call_merged",callMergeabilityChanged:"call_mergeability_changed",callMicrophoneChanged:"callMicrophoneChanged",canNotifyForCallingNotification:"canNotifyForCallingNotification",callParticipantModalityRestrictionsChanged:"callParticipantModalityRestrictionsChanged",deeplinkSharingStarted:"deeplinkSharingStarted",callParked:"call_parked",callParticipantUserRoleChanged:"callParticipantUserRoleChanged",callQualityFeedback:"call_quality_feedback",callQualityFeedbackComplete:"call_quality_feedback_complete",callQueueAgentJoined:"callQueueAgentJoined",callQueueIntentIdTeamsCallIdChanged:"callQueueIntentIdTeamsCallIdChanged",callRetriedOrCancelled:"call_retried_or_cancelled",callRingtoneSettingsChanged:"call_ringtone_settings_changed",callSecondaryRingerChanged:"callSecondaryRingerChanged",callSpeakerChanged:"callSpeakerChanged",videoEffectsQualityDegraded:"videoEffectsQualityDegraded",callingReinit:"callingReinit",callingUpdateToken:"calling_update_token",callingUpdateTokenSteps:{requestingTokenFromAuth:"requesting_token_from_auth",tokenReceivedFromAuth:"token_received_from_auth",pushedTokenToRegistry:"pushed_token_to_registry"},callStarted:"callStarted",callTechnicalInfo:"callTechnicalInfo",callUpgradedToHolographic:"callUpgradedToHolographic",callTransferred:"call_transferred",callTransferredFailed:"call_transferred_failed",CallTransferredSucceeded:"call_transferred_succeeded",callTypeChanged:"callTypeChanged",callWasPoppedOutChanged:"callWasPoppedOutChanged",chatBubbleToggle:"chatBubbleToggle",changeSurvivabilityModeScenario:"changeSurvivabilityModeScenario",changeImmersiveViewStatusEvent:"change_immersive_view_status_event",changeImmersiveEventStatusEvent:"change_immersive_event_status_event",checkSurvivabilityAppliancesScenario:"checkSurvivabilityAppliancesScenario",compositorFailure:"compositorFailure",compositorAddedView:"compositorAddedView",compositorRemovedView:"compositorRemovedView",compositorRemoveViewCancelled:"compositorRemoveViewCancelled",compositorWillBeDisposed:"compositorWillBeDisposed",consultCallCreated:"consult_call_created",contentOnlyEscalationDismissed:"contentOnlyEscalationDismissed",contentSharingServiceInitialized:"content_sharing_service_initialized",controlCapabilityChanged:"controlCapabilityChanged",controlCapableViewersChanged:"controlCapableViewersChanged",capableViewersAvailableChangedEvent:"capableViewersAvailableChangedEvent",highMotionStateControl:"highMotionStateControl",controlRequestStateChanged:"controlRequestStateChanged",controlStateChanged:"controlStateChanged",crossCloudCall:"crossCloudCall",explicitRecordingConsentStateChanged:"explicitRecordingConsentStateChanged",defaultSpeakerChanged:"defaultSpeakerChanged",deprecated_callWindowOpened:"deprecated_callWindowOpened",devicesChanged:"devicesChanged",deviceSettingsChangedFromAppPrefs:"deviceSettingsChangedFromAppPrefs",preferredDevicesSelectionChanged:"preferredDevicesSelectionChanged",deviceShortcutEvent:"deviceShortcutEvent",devicesRestoredFromCache:"devices_restored_from_cache",dialOutConnected:"dial_out_connected",dialOutFailed:"dial_out_failed",dialOutIncompleted:"dial_out_incompleted",downloadLogs:"download_logs",dtmfPlayAudioFail:"calling_dtmf_play_audio_fail",e911InfoChanged:"e911InfoChanged",networkInfoChanged:"networkInfoChanged",emergencyCallFailed:"emergencyCallFailed",videoCapabilityLimitsChanged:"videoCapabilityLimitsChanged",videoLayoutCapabilitiesChanged:"videoLayoutCapabilitiesChanged",framesinkEventsChangedV2:"framesinkEventsChangedV2",previewRendererVideoErrorChanged:"previewRendererVideoErrorChanged",networkStrengthIndicatorChanged:"networkStrengthIndicatorChanged",nativeMeetingStageEventsChanged:"nativeMeetingStageEventsChanged",callConstraintsChanged:"callConstraintsChanged",emergencyAddressUpdated:"emergency_address_updated",callForwardingSettingsUpdated:"call_forwarding_settings_updated",e2eestatusChangedEvent:"e2eeStatusChangedEvent",emergencyCustomDisclaimerUpdated:"emergency_custom_disclaimer_updated",emergencyNumbersUpdated:"emergency_numbers_updated",endpointTransferScreenShown:"endpointTransferScreenShown",escalateCall:"escalate_call",fakeHoldCallEvent:"fake_hold_call_event",forceSuppressImmersiveMode:"forceSuppressImmersiveMode",forwardingTargetJoined:"forwardingTargetJoined",frameSizeChanged:"frameSizeChanged",compositorFrameSizeChanged:"compositorFrameSizeChanged",fullFrameRequired:"fullFrameRequired",hidControllerAttached:"hidControllerAttached",hidDeviceTelemetryReceived:"hid_device_telemetry_received",hidDeviceManagerCreated:"hid_device_manager_created",hidDeviceManagerEvent:"hid_device_manager_event",hidDeviceBaseDriverEvent:"hid_device_base_driver_event",peripheralsEventProviderData:"peripherals_event_provider_data",hideActiveCallBanner:"calling_hide_active_call_banner",hidPeopleCountChangeFromDevice:"hid_people_count_change_from_device",hidToggleMuteFromDevice:"hid_toggle_mute_from_device",hidCameraChanged:"hid_camera_changed",hidCameraSelected:"hid_camera_selected",cloudPeopleFeedLayoutReceived:"cloud_people_feed_layout_received",cloudRecognitionAvailabilityChanged:"cloud_recognition_availability_changed",incomingReplaceCall:"incoming_replace_call",initializeCalling:"callingInitialize",isSomeoneInImmersiveViewChanged:"isSomeoneInImmersiveViewChanged",isSomeoneInImmersiveSpaceChanged:"isSomeoneInImmersiveSpaceChanged",isCurrentUserInImmersiveSpaceChanged:"isCurrentUserInImmersiveSpaceChanged",joinedCallWithoutModality:"joinedCallWithoutModality",joinLinkSent:"join_link_sent",liveStreamChanged:"liveStreamChanged",locationRefreshRequest:"most_recently_used_location_refresh_request",locationResponse:"new_location_response",locationResponseFailed:"location_response_failed",locationUpdated:"location_updated",lockMeetingStatusChanged:"lockMeetingStatusChanged",mediaDeviceLabel:"media_device_label",ngcMeetingReactionsReceived:"ngc_meeting_reactions_received",meetingRoleChanged:"meetingRoleChanged",meetingRoomLocalSelectedLayoutChanged:"meetingRoomLocalSelectedLayoutChanged",meetingRoomRemoteSelectedLayoutChanged:"meetingRoomRemoteSelectedLayoutChanged",meetingReactionsStateUpdated:"meeting_reactions_state_updated",meetingReactionsLiveStateUpdated:"meeting_reactions_live_state_updated",mouseEnteringContent:"mouseEnteringContent",mouseLeavingContent:"mouseLeavingContent",muteSelf:"muteSelf",mutePending:"mutePending",ndiStateChanged:"ndiStateChanged",hardwareOutDeviceChanged:"hardwareOutDeviceChanged",networkReconnect:"networkReconnect",networkRoamingPolicyChanged:"networkRoamingPolicyChanged",newVideoDevicePluggedIn:"newVideoDevicePluggedIn",noiseSuppressionChanged:"noiseSuppressionChanged",optimizedPerfModeChanged:"optimizedPerfModeChanged",participantDisplayNameUpdated:"participantDisplayNameUpdated",phoneNumberPoliciesChanged:"phoneNumberPoliciesChanged",biometricEnrollmentUserEnrollmentStatusChanged:"biometricEnrollmentUserEnrollmentStatusChanged",passiveVoiceEnrollmentConsentChanged:"passiveVoiceEnrollmentConsentChanged",biometricFaceEnrollmentStatusChanged:"biometricFaceEnrollmentStatusChanged",biometricEnrollmentDevicesUpdated:"biometricEnrollmentDevicesUpdated",voiceIsolationBannerVisibilityChanged:"voiceIsolationBannerVisibilityChanged",autoGainControlChanged:"autoGainControlChanged",syncDeviceButtonsChanged:"syncDeviceButtonsChanged",groupCopilotSettingChanged:"groupCopilotSettingChanged",ignoreMirroringVideoPreferenceSettingChanged:"ignoreMirroringVideoPreferenceSettingChanged",musicModeSettingsChanged:"musicModeSettingsChanged",touchUpToggleChanged:"touchUpToggleChanged",touchUpStrengthChanged:"touchUpStrengthChanged",autoAdjustToggleChanged:"autoAdjustToggleChanged",spatialAudioConfigsChanged:"spatialAudioConfigsChanged",spatialAudioToggleChanged:"spatialAudioToggleChanged",eyeContactToggleChanged:"eyeContactToggleChanged",videoEffectsStateChanged:"videoEffectsStateChanged",eyeContactCapabilityChanged:"eyeContactCapabilityChanged",nrgLevelsChanged:"nrgLevelsChanged",openRightPanel:"openRightPanel",openSharingPanel:"openSharingPanel",parkedCallsChanged:"parked_calls_changed",peripheralsCallControl:{callNotified:"peripherals_call_control_call_notified",callConnecting:"peripherals_call_control_call_connecting",callConnected:"peripherals_call_control_call_connected",callDisconnecting:"peripherals_call_control_call_disconnecting",callDisconnected:"peripherals_call_control_call_disconnected",callHeld:"peripherals_call_control_call_held",activeCallChanged:"peripherals_call_control_active_call_changed",callRemoved:"peripherals_call_control_call_removed"},participantHandStateChanged:"participant_hand_state_changed",participantSpotlightStateChanged:"participant_spotlight_state_changed",participantSignerStateChanged:"participant_signer_state_changed",overflowStreamingInfoChanged:"overflow_streaming_info_changed",participantWeatherpersonStateChanged:"participant_weatherperson_state_changed",weatherpersonStateChanged:"weatherperson_state_changed",possibleBrowserPopoutForPSTNCall:"possibleBrowserPopoutForPSTNCall",pptSharingOnHold:"pptSharingOnHold",pptSharingNext:"pptSharingNext",pptSharingPrev:"pptSharingPrev",pptSharingGoTo:"pptSharingGoTo",pptSharingSessionChanged:"pptSharingSessionChanged",preJoinScreenExited:"prejoin_screen_exited",preJoinScreenLaunched:"prejoin_screen_launched",proxiedPushNotification:"calling_proxied_push_notification",pushToTalk:{pushToTalkSettingChanged:"push_to_talk_setting_changed"},replaceCallInChildWindow:"replace_call_in_child_window",pinnedParticipantChanged:"pinnedParticipantChanged",pluginHostCrash:"pluginhost_crash",pstnComponentShown:"pstnComponentShown",ptzRemoteParticipantsChanged:"ptzRemoteParticipantsChanged",ptzRemoteControlDeviceStateChanged:"ptzRemoteControlDeviceStateChanged",ptzSessionStatusChanged:"ptzSessionStatusChanged",ptzHandlerFailed:"ptzHandlerFailed",raiseHandStateChanged:"raise_hand_state_changed",reinitDevices:"reinit_devices",roomRemoteStateUpdate:"roomRemoteStateUpdate",roomRemoteCapabilitiesUpdate:"roomRemoteCapabilitiesUpdate",roomRemoteProximityBanner:"roomRemoteProximityBanner",scdStatusUpdate:"scd_status_update",screensChanged:"screensChanged",screenshareControlStateChanged:"screenshareControlStateChanged",meetingInterpretationStatusEvent:"meetingInterpretationStatusEvent",serverHoldEnd:"server_hold_end",serverMutedChanged:"serverMutedChanged",shareSystemAudioStateChanged:"shareSystemAudioStateChanged",showActiveCallBanner:"calling_show_active_call_banner",skypeTokenRevocation:"skypeTokenRevocation",speakerHWMutedChanged:"speakerHWMutedChanged",speakerVolumeChanged:"speakerVolumeChanged",applicationMediaDevicesChanged:"applicationMediaDevicesChanged",streamRenderingTimeout:"streamRenderingTimeout",toggleHighFidelityAudioSwitch:"toggleHighFidelityAudioSwitch",meetingJoinFromTeamsDeviceEvent:"meetingJoinFromTeamsDeviceEvent",proximityJoinEvent:"proximityJoinEevnt",rosterGroupUpdateEvent:"rosterGroupUpdateEvent",updateMeetingRoomMetaData:"updateMeetingRoomMetaData",startedViewingAnnotatable:"startedViewingAnnotatable",startMeetupFlowLoaded:"calling_start_meetup_flow_loaded",stoppedViewingAnnotatable:"stoppedViewingAnnotatable",systemAudioAlertShown:"systemAudioAlertShown",surfaceHub:{sessionCleanupRequested:"surface_hub_session_cleanup_request_received",sharingScreenBoundsChanged:"surface_hub_sharing_screen_bounds_changed"},surfaceHubFullScreenStateChanged:"surface_hub_full_screen_state_changed",survivabilityAppStateChanged:"survivability_app_state_changed",systemAudioDriverStateChanged:"systemAudioDriverStateChanged",togetherModePinStateChanged:"together_mode_pin_state_changed",toggleGetUserMediaDialog:"calling_toggle_get_user_media_dialog",toggleMuteFromPrejoinScreen:"toggle_mute_from_prejoin_screen",triggerCallIdChangedForCallingIntent:"trigger_call_id_changed_for_calling_intent",triggerAgentMonitorEndedEventForCallingIntent:"trigger_agent_monitor_ended_event_for_calling_intent",triggerMohScreenTransition:"trigger_moh_screen_transition",triggerEscalatedCallConversationChanged:"triggerEscalatedCallConversationChanged",unmuteSelf:"unmuteSelf",updateChatHeaderCallButtonStates:"update_chat_header_call_button_states",uxComponentDisabledStateChanged:"uxComponentDisabledStateChanged",verifyExistingCamera:"verifyExistingCamera",startPreview:"startPreview",videoOff:"videoOff",videoOn:"videoOn",whiteboardVideoEffectCapabilityChanged:"device-manager-whiteboard-video-effect-capability-changed",wrsViewerApiError:"wrs_viewer_api_error",vdi:{vdiClientDisconnected:"clientDisconnected",vdiShowUfd:"vdiShowUfd",vdiClientConnected:"vdiClientConnected",vdiMultiWindowFeatureNotSupported:"vdiMultiWindowFeatureNotSupported",vdiScreenTopologyChanged:"vdiScreenTopologyChanged",vdiSwitchedToLocalStack:"vdiSwitchedToLocalStack",vdiShowMultiWindowUpgradeBanner:"vdiShowMultiWindowUpgradeBanner",vdiStatusIndicatorEvent:"vdiStatusIndicatorEvent",vdiStackSwitchStateEvent:"vdiStackSwitchStateEvent"},slimCoreVdi:{clientConnectionState:"slimCoreVdiClientConnectionState"},videoEffectReadinessChanged:"videoEffectReadinessChanged",videoEffectTextureStreamStarted:"videoEffectTextureStreamStarted",windowsEffectsCapabilityChanged:"windowsEffectsCapabilityChanged",windowsAICapabilityChanged:"windowsAICapabilityChanged",autoCameraSettingsChanged:"autoCameraSettingsChanged",videoEffectCapabilitiesChanged:"videoEffectCapabilitiesChanged",currentSeatMappingChangedEvent:"currentSeatMappingChangedEvent",liveStreamChangedEvent:"liveStreamChangedEvent",thirdPartyDevicePairingRequest:"thirdPartyDevicePairingRequest",thirdPartyDeviceMeetingReactionRequest:"thirdPartyDeviceMeetingReactionRequest",thirdPartyDeviceToggleRequest:"thirdPartyDeviceToggleRequest",videoExtensibilityStreamInfoEvent:"videoExtensibilityStreamInfoEvent",videoExtensibilityLifecycleEvent:"videoExtensibilityLifecycleEvent",videoExtensibilityPerformanceEvent:"videoExtensibilityPerformanceEvent",triggerMonitoringSessionDataChanged:"triggerMonitoringSessionDataChanged"},callMeBack:{numberUpdated:"numberUpdated"},db:{providerReady:"providerReady"},desktopApp:{appVersionUnsupported:"appVersionUnsupported",calling:{IpcServerUp:"calling:sfb:ipc:serverUp",IpcWebClientReady:"calling:sfb:ipc:webClientReady",ongoing:"calling:ongoing",ongoingMetadata:"calling:ongoingMetadata",presenting:"calling:presenting",stateChange:"calling:stateChange",sfbIpcActionNotifyCallStatus:"calling:sfb:ipc:action:NotifyCallStatus",sfbIpcActionIpcReestablished:"calling:sfb:ipc:action:IpcReestablished",sfbIpcActionHold:"calling:sfb:ipc:action:hold",sfbIpcResponseHold:"calling:sfb:ipc:response:hold",teamsIpcActionAppStateChange:"calling:sfb:ipc:action:AppStateChange",teamsIpcActionHold:"calling:teams:ipc:action:hold",teamsIpcActionNotifyCallStatus:"calling:teams:ipc:action:NotifyCallStatus",teamsIpcActionQueryCallStatus:"calling:teams:ipc:action:QueryCallStatus",teamsIpcMessageCallStatus:{NoCall:"TeamsNoCall",PendingCall:"TeamsPendingCall",ActiveCall:"TeamsActiveCall",HeldCall:"TeamsHeldCall"},teamsIpcResponseHold:"calling:teams:ipc:response:hold"},defaultDeviceTracker:{defaultSpeakerChangedFromDesktop:"deviceTracker:default-speaker-changed",getSystemDefaultSpeakerIdToDesktop:"deviceTracker:system-default-speaker-Id",initialize:"deviceTracker:initialize",systemDefaultSpeakerReceivedFromDesktop:"deviceTracker:system-default-speaker-received"},displayAdded:"display-added",displayMetricsChanged:"display-metrics-changed",displayRemoved:"display-removed",getCrashInfo:"getCrashInfo",getLockState:"getLockState",globalHotkeyPressed:"globalHotkeyPressed",globalHotkeys:{answerCallWithAudio:"CommandOrControl+Shift+S",answerCallWithVideo:"CommandOrControl+Shift+A",rejectCall:"CommandOrControl+Shift+D",joinMeetingFromToast:"CommandOrControl+Shift+J",openMeetingChatFromToast:"CommandOrControl+Shift+R"},initializeNdiLibraries:"initializeNdiLibraries",isRegisteredInstantMessagingProviderRequest:"isRegisteredInstantMessagingProviderRequest",isRegisteredInstantMessagingProvider:"isRegisteredInstantMessagingProvider",isOnMinVersionOrLess:"minimum_version_or_less",machineInactiveResponse:"machineInactiveResponse",machineLock:"machineLock",machineUnlock:"machineUnlock",ndiLibrariesDownloadState:"ndiLibrariesDownloadState",updateVdiMultiWindowOverride:"updateVdiMultiWindowOverride",registerInstantMessagingProvider:"registerInstantMessagingProvider",registerInstantMessagingProviderResult:"registerInstantMessagingProviderResult",registerProtocols:"registerProtocols",registerProtocolsResult:"registerProtocolsResult",remoteConnect:"remote-connect",remoteDisconnect:"remote-disconnect",selectedSpeakerChanged:"selectedSpeakerChanged",thirdPartyDeviceRequest:"thirdPartyDeviceRequest",thirdPartyDeviceResponse:"thirdPartyDeviceResponse",thirdPartyDeviceResponseV2:"thirdPartyDeviceResponseV2",thirdPartyDeviceMeetingUpdate:"thirdPartyDeviceMeetingUpdate",thirdPartyDevicesServiceAppPrefUpdateRequest:"thirdPartyDevicesServiceAppPrefUpdateRequest",thirdPartyDevicePairingStatusQuery:"thirdPartyDevicePairingStatusQuery",thirdPartyDevicePairingStatusUpdate:"thirdPartyDevicePairingStatusUpdate",thirdPartyDevicePairingRequest:"thirdPartyDevicePairingRequest",unregisterProtocols:"unregisterProtocols",unregisterProtocolsResult:"unregisterProtocolsResult",slimCoreVdi:{connectionStateChange:"slimcoreVdiConnectionStateChange"}},delegationSettingsService:{delegationSettingsChanged:"delegation_settings_changed"},desktopUpdateNotification:{idleNoRestart:"idleNoRestart"},dialpad:{clearDialpadDisplay:"clear_dialpad_display",myPhoneNumberChanged:"my_phone_number_changed"},downloadManager:{openDownloadsFolder:"openDownloadsFolder",downloadCompleteToastClick:"downloadCompleteToastClick"},holographic:{debounceInterval:50,holographicCallStateChanged:"holographicCallStateChanged",holographicInteractionRequested:"holographicInteractionRequested",holographicSceneInitErrorBroadcast:"holographicSceneInitError_Broadcast",holographicSceneInitErrorEmit:"holographicSceneInitError_Emit",holographicSceneInitSuccessBroadcast:"holographicSceneInitSuccess_Broadcast",holographicSceneInitSuccessEmit:"holographicSceneInitSuccess_Emit",holographicSceneRemovedBroadcast:"holographicSceneRemoved_Broadcast",holographicSceneRemovedEmit:"holographicSceneRemoved_Emit",interactionReady:"interactionReady",interactionTerminated:"interactionTerminated",type:{callNotHolographic:"holographic-callNotHolographic",callUpgraded:"holographic-callUpgraded",callDowngraded:"holographic-callDowngraded"},fields:{count:"count"},reason:{wrongNumberOfParticipants:"wrongNumberOfParticipants",participantAdded:"participantAdded",participantRemoved:"participantRemoved"}},lobby:{showToastForParticipant:"show_toast_for_participant",inLobbyCountChanged:"in_lobby_count_changed"},multiWindow:{close:"multiWindow_close",entryPoints:{callConsultation:"call-consultation",rigelConsole:"rigel-console"},loaded:"multiWindow_loaded"},notifications:{store:{Type_NewActivitiesHydrated:"new-activities-hydrated"},muteNotificationsDuringMeetingUpdate:"muteNotificationsDuringMeetingUpdate"},participants:{participantAdded:"call-participant-added",participantRemoved:"call-participant-removed",participantStateChanged:"call-participant-state-changed",participantMeetingRoleChanged:"call-participant-meeting-role-changed",participantSpotlightChanged:"call-participant-spotlight-changed"},pushEvents:{messageStore:{createOrUpdateMessage:"messageStoreCreateOrUpdateMessage"}},experienceContainers:{crashed:"ec:crashed",hybridCommandPromiseComplete:"hybrid_command_promise_complete"},remoteController:{wholeStateUpdate:"room-remote-whole-state-update",userEnabled:"room-remote-user-enabled",subscribeHandlersStateUpdate:"room-remote-subscribe-handlers-state-update",unsubscribeHandlersStateUpdate:"room-remote-unsubscribe-handlers-state-update",getUserEnabledState:"get-room-remote-user-enabled"},rigel:{call:{eventTypes:{callReadyToNavigate:"rigel-call-ready-to-navigate",callTransitioning:"rigel-call-transitioning"}},desktopSettings:{enableAllowRoomRemote:"enableAllowRoomRemote",enableRigelAutoExitMeeting:"enableRigelAutoExitMeeting",enableRigelDualFrontOfRoomSupport:"enableRigelDualFrontOfRoomSupport",enableRigelIngestCameraId:"enableRigelIngestCameraId",enableRigelTeamsAudioSharing:"enableRigelTeamsAudioSharing",enableRigelByomAutoAccept:"enableRigelByomAutoAccept",enableRigelInitialSettingsCheck:"enableRigelInitialSettingsCheck"},service:{callback:"rigelService:callback",event:"rigelService:event",eventTypes:{pmpDeviceHealth:"pmp-device-health",autoExitMeetingEnabled:"auto-exit-meeting-enabled",autoExitMeetingUserActionEvent:"auto-exit-meeting-user-action-event",autoScreenSharing:"auto-screen-sharing",connectedDisplayCount:"connected-display-count",contentCameraEnhancementEnabled:"content-camera-enhancement-enabled",contentCameraInverted:"content-camera-inverted",disableTeamsAudioSharing:"disable-teams-audio-sharing",defaultSelectedCamera:"default-selected-camera",e2eePolicyFromTac:"e2ee-policy-from-tac",enableDeviceEndToEndEncryption:"enable-device-end-to-end-encryption",cloudAwareTelemetryEnabled:"cloud-aware-telemetry-enabled",telemetryRegion:"telemetry-region",disableTeams21:"disable-teams21",enableUwpAudioIngestPlayback:"enable-uwp-audio-ingest-playback",externalWindowCount:"external-window-count",frontOfRoomPptSlidesCount:"front-of-room-ppt-slides-count",galleryViewToggleFailed:"gallery-view-toggle-failed",hdmiIngestActiveState:"hdmi-ingest-active-state",hdmiPluggedIn:"hdmi-plugged-in",sfbState:"sfb-state",toggleRemotePtzCamera:"toggle-remote-ptz-camera",meetingRoomInMeetingRemotePtzState:"meeting-room-in-meeting-remote-ptz-state",userSelectedLayout:"user-selected-layout",noiseSuppressionDefault:"noise-suppression-default",cortanaToggleFromHybridConsole:"cortana-toggle-from-hybrid-console",hybridConsoleCortanaStateChanged:"hybrid-console-cortana-state-changed",joinMeetup:"join-meeting",openPreCall:"open-pre-call",toggleCortana:"toggle-cortana",openRigelCortana:"open-rigel-cortana",postFeedbackSubmit:"post-feedback-submit",submitFeedbackV2:"submit-feedback-v2",showTeams:"show-teams",displayOemPlugin:"display-oem-plugin",updateCalendarHealth:"update-calendar-health",openUwpSettings:"open-uwp-settings",restartDevice:"restart-device",appReady:"app-ready",requestRigelServiceState:"request-rigel-service-state",isEvEnabled:"is-ev-enabled",updateDeviceLocation:"update-device-location",currentUserInformation:"current-user-information",teamsCallState:"teams-call-state",windowsBoundsOverrides:"windows-bounds-overrides",displayTeams:"display-teams",teamsTenantId:"teams-tenant-id",bluetoothBeaconEnabled:"bluetooth-beacon-enabled",byomAutoAcceptEnabled:"byom-auto-accept-enabled",byomAutoAcceptSetting:"auto-accept-proximity-join",enableCloudPeopleFeed:"enable-cloud-intelliframe",enableCPFOnByDefault:"enable-cif-on-by-default",enableCPFOnSupportedCamerasOnly:"enable-cif-on-supported-cameras-only",supportedCPFCameras:"supported-cloud-intelliframe-cameras",blockedCPFCameras:"blocked-cloud-intelliframe-cameras",enableRoomPeopleCount:"enable-room-people-count",localPtzControlsEnabled:"local-ptz-controls-enabled",oemCameraControlsEnabled:"oem-camera-controls-enabled",appVersion:"host-app-version",deviceManufacturerModel:"meeting-room-manufacturer-model",cortanaWakewordSettingEnabled:"cortana-wakeword-setting-enabled",getAudioVolume:"get-audio-volume",hdmiActive:"hdmi-active",autoExitMeetingAppliesUpdated:"auto-exit-meeting-applies-updated",coordinatedMeetingsSettings:"coordinated-meetings-settings",frontOfRoomWindowsSwapDone:"front-of-room-windows-swap-done",disableFeedbackButton:"disable-feedback-button",showVMRButton:"show-vmr-button",enablePublicPreview:"enable-public-preview",hdmiCaptureDevice:"hdmi-capture-device",ingestCameraId:"ingest-camera-id",contentCameraId:"content-camera-id",oemPluginConnected:"oem-plugin-connected",oemPluginShown:"oem-plugin-shown",frontOfRoomLoadFailed:"front-of-room-load-failed",allowRoomRemoteEnabled:"allow-room-remote-enabled",joinByCode:"join-by-code",enableRoomCapacityNotification:"enable-room-capacity-notification",toggleWhiteboardCamera:"toggle-whiteboard-camera",joinMeetupFailure:"join-meeting-failed",showVmrView:"show-vmr-view",showVmrState:"show-vmr-state",callNavigationEnabled:"call-navigation-enabled",meetNowButtonEnabled:"meet-now-button-enabled",e2eeSettingEnabled:"e2ee-setting-enabled",sipOverDGJEnabled:"sip-over-dgj-enabled",googleMeetDGJEnabled:"google-meet-dgj-enabled",joinByCodeEnabled:"join-with-an-id-enabled",requirePasscodeForMeetingsEnabled:"require-passcode-for-meetings-enabled",meetNow:"meet-now",zoomMeetingsEnabled:"zoom-meetings-enabled",webexMeetingsEnabled:"webex-meetings-enabled",goToMeetingMeetingsEnabled:"gotomeeting-meetings-enabled",amazonChimeMeetingsEnabled:"amazonchime-meetings-enabled",ringCentralMeetingsEnabled:"ringcentral-meetings-enabled",otherProvidersMeetingsEnabled:"otherproviders-meetings-enabled",googleMeetMeetingsEnabled:"googlemeet-meetings-enabled",sfbMeetingsEnabled:"sfb-meetings-enabled",teamsFirstEnabled:"teams-first-enabled",meetingRoomExperience:"meeting-room-experience",initialSettingsLoaded:"initial-settings-loaded",defaultLayoutType:"default-for-experience",frontRowEnabled:"front-row-enabled",publicPreviewFeedbackStarted:"public-preview-feedback-started",urlBrowserLaunchBlocked:"url-browser-launched-blocked",splitVideoLayoutsDisabled:"split-video-layouts-disabled",frontRowVideoSize:"front-row-video-size",isSpatialAudioEnabled:"is-spatial-audio-enabled",roomPeopleCountPMPData:"room-people-count-data",peopleCount:"people-count",isInactive:"is-inactive",isChatEnabled:"is-chat-enabled",singleFoRDefaultContentLayout:"single-for-default-content-layout",meetingRoom3PJoinByCodeValues:"meeting-room-3p-join-by-code-values",joinMeetingLink:"join-meeting-link",enableHighContrast:"enable-high-contrast",requirePasscodeForAllMeetings:"require-passcode-for-all-teams-meetings",requirePasscodeForPrivateMeetings:"require-passcode-for-all-private-teams-meetings",joinMeetupV2:"join-meeting-v2",sendFeedbackToBrb:"send-feedback-to-brb",updateTeamsTheme:"update-teams-theme",isLeftPanelShownByDefault:"is-left-panel-shown-by-default",leftPanelDefaultComponent:"left-panel-default-component",isRightPanelShownByDefault:"is-right-panel-shown-by-default",rightPanelDefaultComponent:"right-panel-default-component",frontRowDefaultLeftPanel:"front-row-default-left-panel",frontRowDefaultRightPanel:"front-row-default-right-panel",duplicateIngestDefault:"duplicate-ingest-default",segmentationBackgroundImagePaths:"segmentation-background-image-paths",bluetoothAdvertisementStateUpdated:"bluetooth-advertisement-state-updated",universalTouchConsoleStatus:"universal-touch-console-status",hideMeetingNames:"hide-meeting-names",removeFoRCalendar:"remove-for-calendar",whiteboardEnabled:"is-whiteboard-enabled",reportAProblemDisabled:"report-a-problem-disabled",openMeetingChatByDefault:"open-meeting-chat-by-default",dualFrontOfRoomLayout:"dual-front-of-room-layout",isFrontRowUnifiedBackgroundEnabled:"is-front-row-unified-background-enabled",ultrasoundAdvertisementEnabled:"ultrasound-advertisement-enabled",ultrasoundAutoAcceptProximateMeetingInvitations:"ultrasound-auto-accept-proximate-meeting-invitations",ultrasoundSpeaker:"ultrasound-speaker",ultrasoundSpeakerVolume:"ultrasound-speaker-volume",roomQRcodeEnabled:"room-qr-code-enabled",copilotQRCodeEnabled:"room-copilot-qr-code-enabled",qrCodeAutoAcceptProximateMeetingInvitations:"qr-code-auto-accept-proximate-meeting-invitations",roomLanguageSwitchEnabled:"room-language-switch-enabled",meetingRoomAppEvent:"meeting-room-app-event",toggleDiagnosticsPanel:"toggle-diagnostics-panel",multiCameraEnabled:"multicamera-max-feeds",configureMultiCamera:"configure-multicamera",updateMeetingRoomAutoExitDialog:"update-meeting-room-auto-exit-dialog",whiteboardWalkUpSessionStateUpdateEvent:"whiteboard-walk-up-session-state-update-event",meetingRoomFacestreamAvailabilityUpdatedEvent:"meeting-room-facestream-availability-updated-event",wakeUpDisplay:"wake-up-display",digitalSignageSettings:"digital-signage-settings",digitalSignageHealth:"digital-signage-health",meetingRoomCameraFramingAvailabilityUpdatedEvent:"meeting-room-camera-framing-availability-updated-event",downloadWebLogs:"download-web-logs",prioritizeVideoParticipantsGallery:"prioritize-video-participants-gallery",hideMeForAllLayouts:"hide-me-for-all-layouts",isMipiSupported:"is-mipi-supported",captionsDefault:"captions-default",filterProfaneWords:"filter-profane-words",edgeBrowserEnabled:"edge-browser-enabled",edgeBrowserWindowId:"edge-browser-window-id",edgeBrowserUserIdle:"edge-browser-user-idle",edgeBrowserCrashed:"edge-browser-crashed",edgeBrowserClosed:"edge-browser-closed",edgeBrowserLongActive:"edge-browser-long-active",startEdgeBrowserSession:"start-edge-browser-session",endEdgeBrowserSession:"end-edge-browser-session",existingEdgeBrowserWindowId:"existing-edge-browser-window-id",recognitionPolicyInfo:"recognition-policy-info",recognitionSettings:"recognition-settings",updateTeamsConfiguration:"update-teams-configuration",teamsConfiguration:"teams-configuration",motionSensorWakeupTime:"motion-sensor-wakeup-time",isMotionSensorAttached:"is-motion-sensor-attached",enableRoomHost:"enable-room-host"},scenarios:{callDisposed:"call_disposed",callEscalated:"call_escalated",connectedDisplayCount:"connected_display_count",ptzRemoteControlInit:"ptz_remote_control_init",ptzRemoteControlRequest:"ptz_remote_control_request",ptzRemoteControlTerminated:"ptz_remote_control_terminated",joinMeetingIncoming:"join_meeting_incoming",updateTeamsCallState:"update_teams_call_state",joinMeetingStart:"join_meeting_start",vmrLink:"vmr_link",callingQualityFeedbackShortDuration:"calling_quality_feedback_short_duration",getQuestionnaireForCqf:"get_questionnaire_for_cqf",defaultCameraChange:"default_camera_change",preCallFoRWindow:"pre_call_for_window",defaultNoiseSuppressionChange:"default_noise_suppression_change",navigateToBroadcast:"navigate_to_broadcast",byomAutoAccept:"byom_auto_accept",proximityIncomingCallScenario:"proximity_incoming_call_scenario",configureMultiCamera:"configure_multicamera"}},callScreen:{frameSink:{methods:{log:"log",setIgnoreMirroring:"setIgnoreMirroring",setTextureSharingSupported:"setTextureSharingSupported",setVideoPreference:"setVideoPreference"}},videoRenderer:{methods:{setScallingMode:"setScalingMode"},events:{videoSizeChanged:"video-size-changed"}},ingestRegionChanged:"ingest-region-changed",monitorChanged:"monitor-changed"}},rooms:{adjacentRoomFound:"adjacent_rooms_found",nearbyRoomsChanged:"nearby_rooms_changed",suggestedRoomsRetrieved:"suggested_rooms_retrieved",ultrasoundRoomsFound:"ultrasound_rooms_found"},screenSharing:{ipcEvent:"screenSharing",isScreenRecordingAllowed:"isScreenRecordingAllowed",openScreenRecordingPrivacyPane:"openScreenRecordingPrivacyPane",requestSystemAudioDriverInstallation:"requestSystemAudioDriverInstallation",systemAudioDriverInstallationResult:"systemAudioDriverInstallationResult",systemAudioDriverVersions:"systemAudioDriverVersions"},settings:{updated:"settings:updated",thirdPartyMeetingSettingsUpdate:"thirdPartyMeetingSettingsUpdate",adminEnabledMediaStackLogging:"adminEnabledMediaStackLogging"},skypeAuth:{tokenRefreshed:"skypeAuth:tokenRefreshed",tokenRefreshedAfterRevocation:"skypeAuth:tokenRefreshedAfterRevocation"},surfaceHubApp:{getShubSystemState:"getShubSystemState",shubSystemState:"shubSystemState",shubUnlocked:"shubUnlocked",unlockShub:"unlockShub"},syncService:{resolveConversationLie:"resolveConversationLie"},tab:{instance:{created:"tabInstanceCreated"}},telemetry:{sent:"telemetry:sent"},ultrasound:{proximal:"ultrasound:proximal",mtrDiscovery:"ultrasound:mtr-discovery"},biometricEnrollment:{devicesUpdated:"biometricEnrollment:devicesUpdated"},byodRoomSpeakerAttributionChangedEvent:"byodRoomSpeakerAttributionChangedEvent"},errorCodes:{calendarEventNotFound:"CalendarEventNotFound",errorNonExistentMailbox:"ErrorNonExistentMailbox",networkOffline:"ClientNetworkOffline",scenarioAbandoned:"scenarioAbandoned",userNotLoggedIn:"userNotLoggedIn"},uploadImageEndpointSuffix:{uploadImageV1:"/maglev/custom-video-background/upload",uploadImageV2:"/maglev/custom-video-background/upload/v2"},uploadTenantImageEndpointSuffix:{uploadImageV1:"/maglev/custom-video-background/tenant-image",uploadImageV2:"/maglev/custom-video-background/tenant-image/v2"},feedback:{categories:{audio:"1",videoScreenSharing:"2",droppedCalls:"3",meetingsSchedule:"19",other:"11",scd:"37",callingaudio:"49",callingvideoscreensharing:"50",devices:"76",meetingsInterpretation:"124"}},files:{attachments:{amsDomain:"asm.skype.com",gccAmsDomain:"api.ams.gcc.teams.microsoft.com",gccHighAmsDomain:"api.ams.gov.teams.microsoft.us",dodAmsDomain:"api.ams.dod.teams.microsoft.us",goLocalAmsDomainSuffix:"asyncgw.teams.microsoft.com",amsAfdDomain:"teams.microsoft.com",amsAfdDomainSuffixRegex:/^\/asm\/[a-z]+/i,amsAfdImageSuffixRegex:/^\/asm\/[a-z]+\/v1\/objects/i,amsImageSuffix:"/v1/objects",glassJarDomain:"local.teams.office.com",glassjarAmsImageSuffix:"/ams/v1/objects"},regexPatterns:{pstnRegex:/(\s4:\+?(\d+\s){2}\d+)|(\s4:\+?(\d){4,})|^((4:\+?(\d+\s){2}\d+)|(4:\+?(\d){4,}))/g},templates:{rigelPreCallScreenExternal:"html/mw-ext-pre-callscr.html"},timers:{observingCallTimeoutDuration:v.minute},defaultBackgroundImages:[{name:"None",id:"microsoft_none",src:null,thumb_src:"svg/icons-block.html"},{name:"Blur",id:"microsoft_blur",src:null,thumb_src:"png/blurbg.png"}],customVideoBackground:{download:"cvb:download",status:"cvb:status",getUserUploadedImages:"cvb:getUserUploadedImages",generateImageThumbnails:"cvb:generateImageThumbnails",saveUserUploadedImage:"cvb:saveUserUploadedImage",deleteUserUploadedImage:"cvb:deleteUserUploadedImage",loadFiles:"cvb:loadFiles",downloadFile:"cvb:downloadFile",saveGeneratedImage:"cvb:saveGeneratedImage",userCustomVideoBackgroundAMSFullSize:"imgpsh_fullsize_anim"}},docs:{browserLimitsAndSpecificationsUrl:"https://go.microsoft.com/fwlink/?linkid=2204516",anonymousJoinDisabledByPolicyLearnMoreUrl:"https://go.microsoft.com/fwlink/?linkid=2214512",deniedExternalMeetingJoinLearnMoreUrl:"https://go.microsoft.com/fwlink/?linkid=2245684",gracePeriodMeetingJoinLearnMoreUrl:"https://go.microsoft.com/fwlink/?linkid=2316073"},forwardingDestinationType:{user:"user",voicemail:"voicemail"},getUserMedia:{storageDataKey:"get-user-media-data-bag"},headers:{accept:"Accept",afdResponseRef:"X-MSEdge-Ref",clientRequestId:"Client-Request-Id",contentType:"Content-Type",contentDisposition:"Content-Disposition",contentLength:"Content-Length",expectedResponseType:"ExpectedResponseType",joinId:"x-ms-join-id",groupId:"groupId",jsonContent:"application/json",lastKnownTimestmpUtc:"LastKnownTimestampUtc",userLocale:"X-Client-UI-Language",xMsUserId:"X-Ms-User-id",xTenantId:"X-Tenant-id",skypeChainId:"X-Microsoft-Skype-Chain-ID",skypeMessageId:"X-Microsoft-Skype-Message-ID",skypeParticipantId:"X-Microsoft-Skype-Participant-ID",formUrlEncoded:"application/x-www-form-urlencoded",multiPart:"multipart/form-data;boundary=",retryAfter:"retry-after",requestType:"request-type",tokens:{authorization:"Authorization",correlationId:"x-ms-correlation-id",xSkypeToken:"X-Skypetoken"},xBackendEnvironment:"x-backend-environment",xBackendLatencyMs:"x-backend-latency-ms",xBackendNodename:"x-backend-nodename",xBackendServerlocation:"x-backend-serverlocation",xBackendVersion:"x-backend-version",xMicrosoftSkypeClient:"X-Microsoft-Skype-Client",xServerRequestId:"X-ServerRequestId",skypeTokenMigrationRequestHeader:"X-MS-Migration"},http:{responseType:{arraybuffer:"arraybuffer",json:"json"},statusCodes:{Throttle:429}},hwaApp:{platformId:{surfaceHubPlatformId:"35"}},interopConversationStatus:{acceptPending:"AcceptPending",accepted:"Accepted",blocked:"Blocked",quarantined:"Quarantined"},incomingCallType:{forward:"forward",transfer:"transfer"},languageDirectionStrings:{rtl:"rtl"},legal:{legalUrl:"https://go.microsoft.com/fwlink/?linkid=2129043",privacyAndCookiesUrl:"https://aka.ms/teamsprivacy",privacyAndCookiesEnterpriseUrl:"https://go.microsoft.com/fwlink/p/?linkid=857875",recordingLearnMoreUrl:"https://aka.ms/recordmeeting",devPreviewTermsAndConditionsUrl:"https://aka.ms/mn9yh6",publicPreviewTermsAndConditionsUrl:"https://aka.ms/TeamsPreviewTOU",legalUrlFreemium:{admin:"https://go.microsoft.com/fwlink/?linkid=2129043",user:"https://go.microsoft.com/fwlink/?linkid=2129043"},privacyAndCookiesUrlFreemium:{admin:"https://go.microsoft.com/fwlink/?linkid=871667",user:"https://go.microsoft.com/fwlink/?linkid=871562"},privacyPolicyUrlTFL:"https://aka.ms/privacy"},licenseType:{student:"Student",teacher:"Teacher"},messages:{panes:{conversations:"conversations"}},meetingType:{adhocPrivate:"ad hoc private",adhocChannel:"ad hoc channel",scheduledChannel:"scheduled channel",scheduledPrivate:"scheduled private",genericAdhoc:"Adhoc",unknown:"unknown"},testMeetingConstants:{testTenantId:"tenantId",testOrganizerId:"6763e6ac-1bfd-48ec-8352-a3e3a066c81c"},organizerIdTenantIdPattern:/^(.{8})-(.{4})-(.{4})-(.{4})-(.{12})$/,navigation:{context:{chat:"chat",channel:"channel",channelScrollToMessage:"channelScrollToMessage",meeting:"meeting"}},notificationUserProfileTypes:{pstnRnl:"pstn-rnl",pstn:"pstn"},os:{mac:"macos",linux:"linux",windows:"windows"},minWindowsOsVersion:{windows11:{Germanium:"10.0.26070"}},lazyLoadedVendorFiles:{pako:"pako",signalr:"signalr",vdiCitrixPeerConnection:"vdiCitrixPeerConnection",vdiCitrixPeerConnection2:"vdiCitrixPeerConnection2",vdiCitrixPeerConnection3:"vdiCitrixPeerConnection3",vdiCitrixPeerConnection4:"vdiCitrixPeerConnection4",vdiCitrixPeerConnectionTest:"vdiCitrixPeerConnectionTest",vdiCitrixPeerConnectionMin:"vdiCitrixPeerConnectionMin",vdiVMwarePeerConnection:"vdiVMwarePeerConnection",vdiVMwarePeerConnection2:"vdiVMwarePeerConnection2",vdiVMwarePeerConnection3:"vdiVMwarePeerConnection3",vdiVMwarePeerConnection4:"vdiVMwarePeerConnection4",vdiVMwarePeerConnectionTest:"vdiVMwarePeerConnectionTest",vdiWVDPeerConnection:"vdiWVDPeerConnection",vdiWVDPeerConnection2:"vdiWVDPeerConnection2",vdiWVDPeerConnection3:"vdiWVDPeerConnection3",vdiWVDPeerConnection4:"vdiWVDPeerConnection4",vdiWVDPeerConnectionTest:"vdiWVDPeerConnectionTest"},lazyDialogs:{tabInstanceConfiguration:"TabInstanceConfiguration"},lazyModules:{interprocessStore:"interprocess-store",transportAgentService:"transport-agent-services",broadcast:"broadcast",extensibilityTabs:"extensibility-tabs"},lobby:{admitEntryPoint:{lobbyDrillInRosterPanel:"LobbyDrillInRosterPanel"},admittingAll:"admitting_all",bulkAdmittingAll:"bulk_admitting_all"},navContext:{deepLink:"deep-link",goToMainMeetingFromBreakoutRoomDeepLink:"go-to-main-meeting-from-breakout-room-deep-link"},pptSharing:{defaultWrsBootstrapperUrl:"https://contentstorage.osi.office.net/boot/powerpoint.boot.js"},preJoin:{navigateToPreJoin:"navigateToPreJoin"},promise:{defaultTimeout:3e4,timedOutMessage:"promise timed out"},callingBot:{commandRetryInterval:1500,commandRetryCount:3},promiseState:{aborted:"aborted",cancelled:"cancelled"},validationRegEx:{url:RegExp("^(http(s)?://)(www\\.)?[-a-z0-9@:%._\\+~#=]{2,256}(\\.)?[a-z0-9]{1,6}\\b([-a-z0-9'@:%_\\+.~#?&\\(\\)//= ,;$!*]*)$","i")},pstn:{anonymousUserPrefix:"4:anonymous",extSeparator:",",keyPrefix:"4:",userType:"pstn",specialCharRegExpWithParen:/^\+?\d*[ ]*(\([ ]*\d+[ ]*\))?[0-9 -]+((?:;ext=([0-9]{1,7})|[ \t,]*(?:e?xt(?:ensi(?:o?|))?n?|??|[,x#~]|int|anexo|)[:\.]?[ \t,-]*([0-9]{1,7})#?|[- ]+([0-9]{1,5})#))?$/i},PlatformDetectService:{VERSION_MAPPINGS:{"5.1":"XP","6.0":"Vista","6.1":"7","6.2":"8","6.3":"8.1","10.0":"10"},responseCode:{clientFailure:-1}},loggingEventIdentifiers:{VDI2dot0:{globalSlimCorePieVdiStateSet:"global_slimcore_pie_vdi_state_set",slimCorePieVdiGetBridgeFailed:"slimcore_pie_vdi_get_bridge_failed",slimCoreVdiGlobalStateSlimcorepievdistate:"slimcore_vdi_global_state_slimcorepievdistate",slimCoreVdiPolicy:"slimcore_vdi_policy",vdiConnectionInfoService:"vdi_connection_info_service",slimCoreVdiHidCreatorIdEmpty:"slimcore_vdi_hid_creator_id_empty",globalVdiModeStateSubscription:"global_vdi_mode_state_subscription",slimCorePieVdiStateObservableAlreadySet:"slimcore_pie_vdi_state_observable_already_set",slimCorePieVdiStateObservableUndefined:"slimcore_pie_vdi_state_observable_undefined",slimCoreLoaderServiceUndefined:"slimcore_loader_service_undefined"},autoBrbServiceObservableUndefined:"autobrb_service_observable_undefined",autoBrbServiceObservableNotObserved:"autobrb_service_observable_not_observed"},scenarios:{globalSetupKeysService:{applySetupKeysAsync:"apply_setup_keys_async"},rooms:{nearbyRoomEventDataPopulation:"nearby_room_event_data_population",ultrasoundRoomEventDataPopulation:"ultrasound_room_event_data_population"},premiumCapability:{watermark:{videoEnabled:"watermarkVideoEnabled",screenShareEnabled:"watermarkScreenShareEnabled"},e2ee:{meetingEndToEndEncryptionEnabled:"meetingEndToEndEncryptionEnabled"}},getIsWebGLForVideoExtensibilityEnabled:"get_is_webgl_for_video_extensibility_enabled",callingApiDispose:{name:"calling_service_dispose",steps:{disposeApiAsync:"disposeApiAsync"}},delegation:{settings:{fetchDelegationSettings:"delegation_service_fetch_delegation_settings",fetchCallForwardingSettings:"delegation_service_fetch_call_forwarding_settings",addDelegate:"delegation_service_add_delegate",editDelegate:"delegation_service_edit_delegate",deleteDelegate:"delegation_service_delete_delegate",setCallForwardingToDelegates:"set_call_forwarding_to_delegates",setCallForwardingToVoicemail:"set_call_forwarding_to_voicemail",fetchUserVoiceSettings:"fetch_user_voice_settings"}},fetchCallMetricsTimeoutDeadline:5e3,addMembersSpeedDial:{addContact:"add_contact",editContact:"edit_contact"},updateAvatarModeAvailability:"update_avatar_mode_availability",setAvatarModeState:"set_avatar_mode_state",updateSelectedDevices:"update_selected_devices",automaticGainControl:{loadAGC:"call_agc_load_setting",setAGC:"call_agc_set_setting"},autoUnmuteMeetingChat:"auto_unmute_meeting_chat",deprecatedFnCallInCallingAgentsService:"deprecated_fn_call_in_calling_agents_service",highFidelityMusicMode:{loadHFMM:"call_high_fidelity_music mode_load_setting",setHFMM:"call_high_fidelity_music mode_set_setting",setHFMMMidCall:"call_high_fidelity_mid_call_set_setting"},echoCancellation:{loadEC:"call_echo_cancellation_load_setting",setEC:"call_echo_cancellation_set_setting"},stereoMode:{loadStereoMode:"call_stereo_mode_load_setting",setStereoMode:"call_stereo_mode_set_setting"},addContactsBlockList:{addBlockListContact:"add_BlockList_contact",removeBlockListContact:"remove_BlockList_contact"},callingIntentE2E:"calling_intent_e2e",settings:{settingsUpdate:"settings_update"},people:{userDelegation:"user_delegation"},networkRoamingPolicyUpdated:"network_roaming_policy_updated",notifications:{updatable:{updatableNotificationRequested:"updatable_notification_requested",markers:{existingNotificationUpdated:"updatable_notification_existing_updated",newNotification:"updatable_notification_new_shown",notificationHasTimeout:"updatable_notification_has_timeout"},reasons:{newNotificationShown:"updatable_notif_rsn_new_shown",noLongerNotified:"updatable_notif_rsn_not_notified",noUpdatableNotificationShown:"updatable_rsn_none_shown",updated:"updatable_notif_rsn_updated"}}},broadcast:{attendeeCountSetup:"broadcast_setup_attendeecount",attendeeCountUpdate:"broadcast_attendeecount_update",verifyThirdPartyCookies:"verify_third_party_cookies",autoBrbForBroadcast:"broadcast_auto_brb",addBroadcastInformation:"broadcast_add_information",updateCallbackUrl:"broadcast_update_callbackurl",bmcAvailabilityInMeeting:"broadcast_availability_bmc",bmcConnected:"broadcast_connect_bmc",broadcastState:"broadcast_state_modality",autoJoinModality:"broadcast_autojoin_modality",joinModality:"broadcast_join_modality",callAcceptBroadcast:"call_accept_broadcast",composerAddedPostCall:"broadcast_composeradded_postcall",composerAvailabilityInMeeting:"broadcast_availability_composer",composerAdded:"broadcast_added_composer",filterOutParticipantsInLobby:"filter_out_participants_in_lobby",joinMeetupBroadcast:"calling_join_meetup_broadcast",joinOrCreateBroadcastFromLink:"join_or_create_meetup_from_link_broadcast",joinScheduledMeetupBroadcast:"join_scheduled_meetup_broadcast",mediaStalls:"broadcast_media_stall",modalityLinksReceived:"modality_links_received",lazyLoad:"broadcast_lazy_load",loadSignalRScript:"broadcast_load_signalr_script",removeBroadcastInformation:"broadcast_remove_information",rtmpInBotAdded:"broadcast_rtmp_in_bot_added",rtmpInBotRemoved:"broadcast_rtmp_in_bot_removed",rtmpInBotTextTrackAdded:"broadcast_rtmp_bot_text_track_added",rtmpInBotTextTrackRemoved:"broadcast_rtmp_bot_text_track_removed",setLayout:"broadcast_setlayout",setLayoutAvailable:"broadcast_available_setlayout",startAvailable:"broadcast_available_start",startBroadcast:"broadcast_start",stopBroadcast:"broadcast_stop",stopAvailable:"broadcast_available_stop",bmcStateUpdateNetworkLatencyWait:1e4,initializeSignalRConnection:"broadcast_initialize_signalr_connection",signalRConnectionTracking:"broadcast_tracking_signalrconnection",attendeeBroadcastStateUpdate:"attendee_broadcaststate_update",setAudioUsageMode:"broadcast_set_audiousage",qnaHubConnectionSetup:"broadcast_setup_qnaHubConnection",captions:{diagnostic:"broadcast_captions_diagnostic",suppressTranscriptionSent:"broadcast_captions_suppress_transcription_sent",retrieveCaptions:"broadcast_captions_retrieve_captions"},step:{modalityLinksReceived:"broadcast_received_modalitylinks",getAttendeeServiceMeetingDetailsEnd:"get_attendee_service_meeting_details_end",getAttendeeServiceMeetingDetailsStart:"get_attendee_service_meeting_details_start",getSchedulingServiceBroadcastMeetingEnd:"get_scheduling_service_broadcast_meeting_end",getSchedulingServiceBroadcastMeetingStart:"get_scheduling_service_broadcast_meeting_start",getQnaExtensionUrlStart:"get_qna_extension_url_start",getQnaExtensionUrlEnd:"get_qna_extension_url_end",subscribeToAttendanceResponseReceived:"subscribe_to_attendance_response_received",attendanceUpdateReceived:"attendance_update_received"},failoverInstance:"broadcast_failoverinstance",switchPrimary:"broadcast_switchPrimary",updateMediaState:"broadcast_update_media_state",restartBroadcast:"broadcast_restart",signalr:{startConnectionSuccess:"start_connection_success",startConnectionFailure:"start_connection_failure",connectionSlow:"connection_slow",reconnecting:"reconnecting",reconnected:"reconnected",disconnected:"disconnected",connectionError:"connection_error"},attendee:{getOverflowSessionId:"broadcast_get_overflow_session_id",getAttendeeMeeting:"broadcast_get_attendee_meeting",streamInfoAvailability:"broadcast_attendee_stream_info_availability",notifyStreamingUrlSwitch:"broadcast_attendee_notify_stream_switch"},retryModalityJoin:"broadcast_retry_modalityjoin"},calling:{authorizedConfigurations:{getAuthorizedConfigurations:"get_authorized_configurations"},authorizedSettings:{callQueue:{getCallQueueSummary:"get_call_queue_summary",updateCallQueueWelcomeGreeting:"update_call_queue_welcome_greeting",updateCallQueueMusicOnHold:"update_call_queue_music_on_hold",updateCallQueueSharedOverflowVoicemail:"update_call_queue_shared_overflow_voicemail",updateCallQueueSharedTimeoutVoicemail:"update_call_queue_shared_timeout_voicemail",updateAuthorizedCallQueueSettings:"update_authorized_call_queue_settings",uploadCallQueueAutoAttendantAudioFile:"upload_call_queue_auto_attendant_audio_file"},autoAttendant:{getCallFlowGreetingSummary:"get_call_flow_greeting_summary",updateCallFlowGreeting:"update_call_flow_greeting",updateAutoAttendantSettings:"update_auto_attendant_settings"}},activeCallsOnEndpointsServiceInit:"active_calls_on_endpoints_service_init",addSecurityDeskUsersToEmergencyCall:"add_security_desk_users_to_emergency_call",addWeatherpersonPresenter:"add_weatherperson_presenter",allowAttendeesToUnmute:"allow_attendees_to_unmute",allowAttendeesToShareVideo:"allow_attendees_to_share_video",addParticipant:"add_participant",addParticipantMeeting:"add_participant_meeting",replaceCallWindowCallEscalation:"replace_call_window_call_escalation",replaceCallWindowCallTransfer:"replace_call_window_call_transfer",replaceCallWindowIncomingReplaceCall:"replace_call_window_incoming_replace_call",addParticipantBroadcast:"add_participant_broadcast",addPstnParticipant:"add_pstn_participant",addRoomParticipant:"add_room_participant",addRoomParticipantProximal:"add_room_participant_proximal",addRoomParticipantNotProximal:"add_room_participant_not_proximal",addSfbParticipant:"add_sfb_participant",addToMediaConfig:"add_to_media_config",attendanceReport:{attendanceDownloadFromRoster:"attendance_download_from_roster"},blurringDeviceCapabilityQueryFailed:"blur_device_capability_query_failed",blurringSetEffects:"blur_set_effects",blurringInfoOnCallDisconnect:"blur_info_on_call_disconnect",blurringDeviceCapable:"blur_device_capable",blurringDeviceNotCapable:"blur_device_not_capable",blurringGetEffectsCapability:"blur_get_effects_capability",blurringWebLoaderDuration:"blur_web_loader_duration",branchSurvivability:{offlineData:"branch_survivability_offline_data",offlineScenarioPrefix:"branch_survivability"},brbRecording:"brb_recording",busyOnBusySettingShown:"busy_on_busy_setting_shown",busyOnBusySettingUpdated:"busy_on_busy_setting_updated",callableChannelAppLoad:"callable_channel_app_load",callableChannels:{getCallQueueConfig:"get_call_queue_config",getAgentOptStatus:"get_agent_opt_status"},callAccept:"call_accept",callAcceptV2:"call_accept_v2",callAcceptMeeting:"call_accept_meeting",callAcceptRequestToJoinByRole:"call_accept_request_to_join_by_role",callAcceptUserAction:"call_accept_user_action",callAccessibilitySettingsUpdate:"call_accessibility_settings_update",callAdded:"call_added",callConsultation:{openDialog:"open_consult_picker_dialog"},callContactServiceCallerInfo:"call_contact_service",callDevicePermissions:"call_device_permissions",callDisconnected:"calling_call_disconnected",callHangup:"call_hangup",callHealthTab:{getTechnicalInfoScenario:"call_health_get_technical_info"},callMonitor:"call_monitor",callRemoved:"call_removed",callingAgentQosSetting:"calling_agent_qos_setting",callingApiFailure:"calling_api_failure",callingConversationServiceChatFlipped:"calling_conversation_service_chat_flipped",callingConversationServiceSubscribe:"calling_conversation_service_subscribe",callingConversationServiceUnsubscribe:"calling_conversation_service_unsubscribe",callingIntent:"calling_intent",callingPerformance:"calling_performance",callingPopoutMissingIntentId:"calling_popout_missing_intentd_id",callingProbeFetchACMSPolicy:"calling_probe_fetch_acms_policy",callingProbeInterrupted:"calling_probe_interrupted",callingProbeLoadVirtualDevices:"calling_probe_load_virtual_devices",callRingingServiceInit:"call_ringing_service_init",callingServiceInit:"calling_service_init",callingStackGetSetup:"calling_stack_get_setup",callingStackInit:"calling_stack_init",callingStackInitWithRetry:"calling_stack_init_with_retry",callingStackReInit:"calling_stack_reinit",callingSupportServiceInit:"calling_support_service_init",videoSupportServiceInit:"video_support_service_init",callingDependentSubSteps:{deviceManagerService:"device_manager_service",callRingingService:"call_ringing_service",videoSupportService:"video_support_service",sharingArbiterService:"sharing_arbiter_service",callingSupportService:"calling_support_service",activeCallsOnEndpointsService:"active_calls_on_endpoints_service",mediaConfigurationService:"mediaConfigurationService",nativeMeetingStageService:"native_meeting_stage_service"},callingStackInitSteps:{callingDependentServicesInitialized:"calling_dependent_services_initialized",loadingPluginless:"loading_pluginless",loadingTsTrouter:"loading_ts_trouter",trouterServiceStarted:"trouter_service_started",callingAgentsServiceInitialized:"calling_agents_service_initialized",callingServiceInitialized:"calling_service_initialized",startingTrouterService:"starting_trouter_service",gsSlimCoreLoaderInitialized:"gs_slimcore_loader_initialized",gsLoadSlimCoreWebView2:"gs_load_slimcore_webview2",gsLoadCallingElectronBundle:"gs_load_calling_electron_bundle",gsSetupKeyComplete:"gs_setup_key_complete",gsCallingStackCreated:"gs_calling_stack_created",gsCallingStackInitialized:"gs_calling_stack_initialized",gsCallingStackLoaded:"gs_calling_stack_loaded",gsCreateSlimCoreInstance:"gs_create_slimcore_instance",gsLazyloadingRetry:"gs_lazyloading_retry",gsLoadingCallingStack:"gs_loading_calling_stack",gsSlimCoreAgentsServiceInitialized:"gs_slimcore_agents_service_initialized",gsPluginlessStackBuilt:"gs_pluginless_stack_built",gsSetMediaConfigFailed:"gs_set_media_config_failed",gsSetUpCreateSlimCoreInstance:"gs_set_up_create_slimcore_instance",gsStartCallingStackInit:"gs_start_calling_stack_init",gsVideoRendererNotAvailable:"gs_video_renderer_not_available"},callWindowClosure:"call_window_closure",...C.T,callingApiInit:{steps:{initApiContext:"init_api_context",initApi:"init_api",initGlobalOperations:"init_global_operations",getOrCreateInternalGlobalServices:"get_or_create_internal_global_services",createGlobalOperationsWithUsercontext:"create_global_operations_with_usercontext",createContextServices:"create_context_services",registerAccountInGlobalContext:"register_account_in_global_context",createInternalGlobalServices:"create_internal_global_services",appStateInitialized:"app_state_initialized",multiCallsManagerInitialized:"multi_calls_manager_initialized",endCreateInternalGlobalServices:"end_create_internal_global_services",endGetInternalGlobalServices:"end_get_internal_global_services",endCreateContextServices:"end_create_context_services",createApiOperations:"create_api_operations",endCreateApiOperations:"end_create_api_operations"}},callingWindowPopoutIntent:"calling_window_popout_intent",callIPCStats:"call_ipc_stats",callqueue:{accept:"accept_call_queue_call",incoming:"incoming_call_queue_call",markers:{startTransferring:"start_transferring_call_queue_call",answeredElsewhere:"call_queue_call_answered_elsewhere"},transferAcceptedCall:"transfer_accepted_call_queue_call",transferRequest:"incoming_call_queue_transfer_request"},callerID:{updateBlockOutgoingCallerID:"update_block_outgoing_caller_id"},callsMainAppLoad:"calls_main_app_load",callState:"call_state",callMode:"callMode",callTransfer:{openDialog:"open_transfer_dialog",transferor:"call_transferor",transferee:"call_transferee",transferTarget:"call_transfer_target"},callBlocking:{fetchCallBlocking:"call_blocking_get",updateCallBlocking:"call_blocking_upate"},callQueueSettings:{getAssignedCallQueues:"get_call_queue_settings",updateCallQueueOptInStatus:"update_call_queue_settings",toggleCallableQueueOptInStatus:"toggle_callable_queue_settings",getCallQueueAgentOboAccounts:"get_call_queue_agent_obo_accounts",markers:{storeOboAccounts:"store"}},changeMeetingRole:"change_participant_meeting_role",checkVivaEmfSettings1ECall:"check_viva_emf_settings_1e_call",chromiumCompositorFailed:"chromium_compositor_failed",closedCaptions:{bootLatency:"closed_captions_boot_latency",bootLatencyBotAdded:"closed_captions_boot_latency_bot_added",botFailover:"closed_captions_bot_failover",diagnostic:"closed_captions_diagnostic",setLanguage:"closed_captions_set_language",setUserLanguage:"closed_captions_set_user_language",setSubtitle:"closed_captions_set_subtitle",start:"start_closed_captions",statusUpdated:"closed_captions_status_updated",stop:"stop_closed_captions",mismatchedLanguage:"closed_captions_mismatched_language"},combinedRecordingBot:{command:"combined_recording_bot_command",recording:{start:"recording_start_v2",stop:"recording_stop_v2"},transcript:{start:"transcript_start_v2",stop:"transcript_stop_v2"},combinedRT:{start:"recording_transcript_start_v2",stop:"recording_transcript_stop_v2"},commandSteps:{getTokenFailed:"get_token_failed",retryFailed:"retry_failed",commandSent:"command_sent"}},copilot:{start:"start_copilot_transcript"},plaza:{misrecognize:"plaza_misrecognize"},coach:{diagnostic:"coach_diagnostic",start:"coach_start",statusUpdated:"coach_status_updated",stop:"coach_stop"},conferenceCallQueue:{accept:"conference_accepted_call_queue_call",conferenceRequest:"incoming_call_queue_conference_request",incoming:"conference_incoming_call_queue_call",markers:{startConference:"start_conference_call_queue_call",answeredElsewhere:"conference_call_queue_call_answered_elsewhere"}},mwbt:{incomingAgentMonitoredCall:"incoming_agent_monitored_call"},compositor:{scenarios:{createCompositor:"create_compositor",e2eVideoTelemetryScenario:"video_stage_reliability"},steps:{preparedForNativeRendering:"prepared_for_native_rendering",serviceCreatedCompositor:"service_created_compositor",addedListeners:"added_listeners",compositorFailed:"compositor_failed",compositorCreateStarted:"compositor_create_started",compositorCreateEnded:"compositor_create_ended"},props:{compositorId:"compositorId",creationContext:"creationContext",rendererType:"rendererType",sharingLayoutMode:"sharingLayoutMode",skipNrReason:"skipNrReason",skipNrMessage:"skipNrMessage",isMultipleNativeCompositorsSupported:"isMultipleNativeCompositorsSupported",slimcoreRendererType:"slimcoreRendererType"}},context:{acceptCall:"accept_call",acceptCallFailed:"accept_call_failed",acceptFromJoinCall:"accept_from_join_call",acceptScreenshareCallFailed:"accept_screenshare_call_failed",activeCameraPluggedOut:"active_camera_plugged_out",applicationOffline:"application_offline",applicationQuit:"application_quit",attendeeScreen:"attendee_screen",blurringCapabilityChanged:"blurring_capability_changed",callConsultationDialog:"call_consultation_dialog",callConsultationScreen:"call_consultation_screen",callConsultationService:"call_consultation_service",callDisconnected:"call_disconnect",callHistory:"call_history",callMeBackDialog:"call_me_back_dialog",callMerge:"call_merge",callParkService:"call_park_service",callParkType:"call_park_type",callScreen:"call_screen",callTransferDialog:"call_transfer_dialog",callTransferService:"call_transfer_service",callTransferServiceFromMW:"call_transfer_service_from_mw",callTransferUnsupported:"call_transfer_unsupported",callingAlert:"calling_alert",callingMultiWindowTitle:"calling_multi_window_title",observableCallSubscriptionTitle:"observable_call_subscription_title",callingParticipantStream:"calling_participant_stream",callingProbe:"calling_probe",callingProtocolDialog:"calling_protocol_dialog",callingResolvers:"calling-resolvers",callingStartButton:"calling_start_button",callingJoinButton:"calling_join_button",callingAudioDropInStartButton:"calling_audio_drop_in_start_button",callingAudioDropInJoinButton:"calling_audio_drop_in_join_button",callingDeeplinkDialog:"calling_deeplink_dialog",callingStartButtonWithDropdown:"calling_start_button_with_dropdown",centralDataLayer:"central_data_layer",changeVideoCaptureConfig:"change_video_capture_config",chatHeader:"chat-header",collabStageAudioDropInStartButton:"collab_stage_audio_drop_in_start_button",collabStageAudioDropInJoinButton:"collab_stage_audio_drop_in_join_button",connectingCallDropMultiCall:"connecting_call_drop_multi_call",consentActivelyRequired:"consent-actively-required",contactList:"contact-list",controlToolbar:"control_toolbar",combinedBotFallback:"fallback-from-combined-bot",coreStartCall:"core_start_call",createNewChatHeader:"create-new-chat-header",deviceManagerServiceInit:"device_manager_service_init",devicesChanged:"devices_changed",dialpad:"dialpad",dialpadWithPeoplePicker:"dialpad_with_people_picker",echoBotCallOnHold:"echo_bot_call_on_hold",endCallForEveryoneButton:"end_call_for_everyone_button",endSessionSurfaceHub:"surface_hub_end_session",externalCallMonitor:"external_call_monitor",floatingCallMonitor:"floating_call_monitor",freemiumUpsellScreen:"freemium_upsell_screen",getUserMedia:"get_user_media",getUserMediaReload:"get_user_media_reload",hidDialpad:"hidDialpad",inAppCallMonitor:"in_app_call_monitor",inLobbyCallDropMultiCall:"in_lobby_call_drop_multi_call",initCallFailed:"init_call_failed",initScreenshareCallFailed:"init_screenshare_call_failed",isRejoin:"is_rejoin",joinCallByInvitationContentFailed:"join_call_by_invitation_content_failed",joinCallFailed:"join_call_failed",joinScreenshareCallFailed:"join_screenshare_call_failed",livePersonCard:"live_person_card",localRecording:"local_recording",machineSuspending:"machine_suspend",mediaConnectionFailed:"media_connection_failed",meetUpScreen:"meetup_screen",meetingInfo:"meeting_info",meetingNotes:"meeting_notes",meetingRoomResetCurrentIntent:"meeting_room_reset_current_intent",meetingRoomEdgeBrowserSession:"meeting_room_edge_browser_session",meetingStartedNotification:"meeting_started_notification",meetingSurfaceHubCalendar:"meeting_surface_hub_calendar",meetingType:{channelMeeting:"adhoc_or_scheduled",privateMeeting:"private_meeting",scheduledTownhall:"scheduledTownhall"},meetupReplyChain:"meetup_reply_chain",messagesHeaderApps:"messages_header_apps",multiCallList:"multi_call_list",multiWindow:"multi_window",networkReconnect:"network_reconnect",none:"default",novaCommandStartAudioCall:"nova_command_start_audio_call",ongoingCallDialog:"ongoing_call_dialog",oneToOneAcceptCall:"one_to_one_accept_call",groupAcceptCall:"group_accept_call",oneToOneVoipAcceptCall:"one_to_one_voip_accept_call",oneToOnePstnAcceptCall:"one_to_one_pstn_accept_call",hidTriggeredAcceptCall:"hid_triggered_accept_call",hidTriggeredPstnAcceptCall:"hid_triggered_pstn_accept_call",hidTriggeredVoipAcceptCall:"hid_triggered_voip_accept_call",hidTriggeredGroupAcceptCall:"hid_triggered_group_accept_call",peopleCard:"people-card",pluginHostCrash:"pluginhost_crash",preJoinScreen:"pre_join_screen",producerScreen:"producer_screen",profileCardPersonInfo:"profile_card_person_info",promptToTalk:"prompt_to_talk",pushToTalkTriggered:"push_to_talk_triggered",recording:"recording",remoteControllerEndCallCommand:"remote_controller_end_call_command",retry:"retry",rigelAutoExitMeeting:"rigel_auto_exit_meeting",rigelAutoHdmiIngestSharingPrefix:"rigel_auto_hdmi_ingest",rigelAutoScreenSharing:"rigel_auto_screen_sharing",rigelAutoScreenSharingTakeover:"rigel_auto_screen_sharing_takeover",rigelConfigureWhiteboardCamera:"rigel_configure_whiteboard_camera",rigelConfigureWhiteboardCameraStickyNote:"rigel_configure_whiteboard_camera_sticky_note",rigelConsoleNewMeeting:"rigel_console_new_meeting",rigelConsoleScreen:"rigel_console_screen",rigelFrontOfRoomLoadFailed:"rigel_front_of_room_load_failed",rigelHdmiIngestSharingPrefix:"rigel_hdmi_ingest",rigelHdmiUnplugged:"rigel_hdmi_unplugged",rigelOpenFrontOfRoomWindow:"rigel_open_front_of_room_window",rigelUpdatePublicPreviewState:"rigel_update_public_preview_state",rigelTeamsFirstHomeLoaded:"rigel_teams_first_home_loaded",rigelAllInOneHomeLoaded:"rigel_all_in_one_home_loaded",rigelAppReadyChanged:"rigel_app_ready_changed",rigelWhiteboardCameraSharingPrefix:"rigel_whiteboard",roster:"roster",screenSharingControl:"screen_sharing_control",screenSharingDeviceDisconnected:"screen_sharing_device_disconnected",screenSharingDropped:"screen_sharing_dropped",screenshareFromChat:"screenshare_from_chat",screenshareRoleChange:"screenshare_role_change",screenshareStart:"screenshare_start",screenshareStopped:"screenshare_stopped",screensharingStolen:"screen_sharing_stolen",screensharingStolenCompanion:"screen_sharing_stolen_companion",shareSystemAudioCancelled:"share_system_audio_cancelled",sharer:"sharer",sharingArbiter:"sharing_arbiter",sharingStreamStopped:"sharing_stream_stopped",shortcut:"shortcut",slashCommand:"slash_command",smartDeviceTriggered:"smart_device_triggered",speedDial:"speed-dial",startConsultation:"start_consultation",systemAudioDriverService:"system_audio_driver_service",thirdPartyDeviceMeeting:"third_party_device_meeting",thirdPartyDeviceTriggered:"third_party_device_triggered",transferTargetType:"transferTargetType",transferType:"transfer_type",unparkCall:"unpark_call",viewer:"viewer",voiceSkills:{addToCall:"voice_skills_add_to_call",contactCall:"voice_skills_contact_call",endCall:"voice_skills_end_call",holdResume:"voice_skills_toggle_hold",joinMeeting:"voice_skills_join_meeting",muteUnmute:"voice_skills_toggle_mute",pstnCall:"voice_skills_pstn_call"},voicemailCall:"voicemail_call",voicemailList:"voicemail_list"},cqfRenderedScenario:"cqfRenderedScenario",crashInfoTimeout:1e4,createCallingProbe:"create_calling_probe",createCompositor:"create_compositor",createCompositorWatermark:"create_compositor_watermark",createGroupCall:"create_group_call",createHuddleGroupCall:"create_huddle_group_call",createGroupInteropTfwTflCall:"create_group_interop_tfw_tfl_call",createGroupScreenshareCall:"create_group_screenshare_call",noConversationCreatedForDecoupledCall:"no_conversation_created_for_decoupled_call",createMeetup:"create_meetup",createMeetupFeedbackForShortDuration:"create_meetup_feedback_for_short_duration",createOneToOneCall:"create_one_to_one_call",createOneToOneInteropCall:"create_one_to_one_interop_call",createOneToOneInteropSfcCall:"create_one_to_one_interop_sfc_call",createOneToOneInteropTfwTflCall:"create_one_to_one_interop_tfw_tfl_call",createOneToOnePstnCall:"create_one_to_one_pstn_call",createOneToOneScreenshareCall:"create_one_to_one_screenshare_call",obfuscatedPhoneNumber:"obfuscated_phone_number",obfuscatedNormalizedPhoneNumber:"obfuscated_normalized_phone_number",createTestCall:"create_test_call",createUnparkCall:"create_unpark_call",createUserInitiatedTestCall:"create_user_initiated_test_call",createVoicemailCall:"create_voicemail_call",customVideoBackgroundDeleteImagesByCategory:"customVideoBackground_delete_images_by_category",customVideoBackgroundDeleteImagesV2:"customVideoBackground_delete_images_v2",customVideoBackgroundDeleteUserUploadedImage:"customVideoBackground_delete_user_uploaded_image",customVideoBackgroundDeviceNotCapable:"customVideoBackground_device_not_capable",customVideoBackgroundDownloadImage:"customVideoBackground_download_image",customVideoBackgroundEffectsDeviceCapable:"customVideoBackground_device_capable",customVideoBackgroundGetTenantProvidedImage:"customVideoBackground_get_tenant_provided_image",customVideoBackgroundGetUserImagesV2:"customVideoBackground_get_user_images_v2",customVideoBackgroundGetUserUploadedImage:"customVideoBackground_get_user_uploaded_image",customVideoBackgroundPersistGeneratedImages:"customVideoBackground_persist_generated_images",customVideoBackgroundSaveUserImages:"customVideoBackground_save_user_images",customVideoBackgroundSaveUserUploadedImage:"customVideoBackground_save_user_uploaded_image",dataChannelAudienceHandlerAttached:"data_channel_audience_handler_attached",dataChannelAudienceReceive:"data_channel_audience_receive",dataChannelAudienceReceiveSceneAck:"data_channel_audience_receive_scene_changed_ack",dataChannelAudienceReceiveSceneBroadcast:"data_channel_audience_receive_scene_changed_broadcast",dataChannelAudienceReceiveUnkown:"data_channel_audience_receive_unkown",dataChannelAudienceSend:"data_channel_audience_send",dataChannelAudienceStarted:"data_channel_audience_started",dataChannelAudienceStopped:"data_channel_audience_stopped",dataChannelReceived:"data_channel_received",dataChannelSend:"data_channel_send",dataChannelStarted:"data_channel_started",dataChannelStopped:"data_channel_stopped",decoupledCall:"decoupled_call",decoupledCallWithIBUser:"decoupled_call_with_ib_user",deepLinkCallToSfB:"deep_link_call_to_sfb",deprecatedWindowPopoutPath:"deprecated_window_popout_path",detectCallEscalationOnReceiver:"detect_call_escalation_on_receiver",deviceSettings:{initIps:"initIpsForDeviceSettings",checkFrequencyForIps:"checkFrequencyForIps",volumeSliderDrag:"volumeSliderDrag",volumeSliderSpeakerMute:"volumeSliderSpeakerMute",volumeSliderSpeakerUnmute:"volumeSliderSpeakerUnmute"},dialInManually:"dial_in_manually",normalizationRuleWithPlus:"normalization_rule_with_plus",disallowAttendeesToShareVideo:"disallow_attendees_to_share_video",disallowAttendeesToUnmute:"disallow_attendees_to_unmute",dismissHand:"dismiss_hand",dismissHandForEveryone:"dismiss_hand_for_everyone",displayInlineCQF:"display_inline_cqf",displayModalCQF:"display_modal_cqf",distinctiveRingtones:{get:"get_distinctive_ringtones",update:"update_distinctive_ringtones"},dmsCallingAgentsInit:"dms_calling_agents_init",ecsConfigRequest:"ecs_config_request",emergencyCall:"emergency_call",testEmergencyCall:"test_emergency_call",incomingEmergencyCall:"incoming_emergency_call",emfRenderedScenario:"emfRenderedScenario",endCallByAppClose:"end_call_by_app_close",endMeetup:"end_meetup",ensureCallingStackIsLoaded:"ensure_calling_stack_is_loaded",CallingServiceLoadCheck:"calling_service_load_check",ensureConversationCreated:"ensure_conversation_created",conversationCreationTimer:"conversation_creation_timer",escalateOneToOneCall:"escalate_one_to_one_call",escalateOneToOneCallToPstn:"escalate_one_to_one_call_to_pstn",escalateOneToOnePstnCallToPstn:"escalate_one_to_one_pstn_call_to_pstn",escalateOneToOnePstnCallToVoip:"escalate_one_to_one_pstn_call_to_voip",fetchPhoneNumber:"fetch_phone_number",fetchPhoneNumberForDialpad:"fetch_phone_number_for_dialpad",fetchTsCallingBundleWithRetry:"fetch_ts_calling_bundle_with_retry",gatt:{gattDeviceManagerDevicesChanged:"gatt_device_manager_devices_changed"},getEchoBotReport:"get_echo_bot_report",getExchangeMeetingInfo:"get_exchange_meeting_info",getHdmiIngestCamera:"get_hdmi_ingest_camera",getMeetingInfo:"get_meeting_info",pnsUFDNotification:"pns_ufd_notification",pnsBackgroundLoudSpeechSuppressedUFD:"pns_background_loud_speech_suppressed_ufd",pnsBackgroundLoudSpeechSuppressedUFDTurnPnsOff:"pns_background_loud_speech_suppressed_ufd_turn_pns_off",updatingVoiceIsolationBannerDisplayState:"nupdating_voice_isolation_banner_display_state",getInternalParticipantCountFromCache:"getInternalParticipantCountFromCache",giveTakeControlPresenterCore:"give_take_control_presenter_core",giveTakeControlPresenterCoreSteps:{policySet:"policy_set",controlEnabled:"control_enabled",capableInfoSharerEnabled:"capable_info_sharer_enabled",capableInfoSharerDisabled:"capable_info_sharer_disabled",setInjectRect:"set_inject_rect",setInjectorConfig:"set_injector_config"},giveTakeControlPresenterStart:"give_take_control_presenter_start",giveTakeControlPresenterStartSteps:{avatarSet:"avatar_set",avatarNotSet:"avatar_not_set",incomingRequestAlertShown:"incoming_request_alert_shown",inControlState:"in_control_state",acceptRequest:"accept_request",terminateAlertShown:"terminate_alert_shown",controlInjectorAvatarSet:"control_injector_avatar_set",setInjectorConfigControl:"set_injector_config_control",allowSingleController:"allow_single_controller",giveControl:"give_control"},giveTakeControlViewerCore:"give_take_control_viewer_core",giveTakeControlViewerCoreSteps:{registerControlEvents:"register_control_events",disabledBySharer:"disabled_by_sharer",notInControl:"not_in_control"},giveTakeControlViewerStart:"give_take_control_viewer_start",giveTakeControlViewerStartSteps:{requestControlCalled:"request_control_called",requestControlSucceeded:"request_control_succeeded",inControlViewerState:"in_control_viewer_state",capturerEnabled:"capturer_enabled"},callControls:{answerCall:"answerCall",rejectCall:"rejectCall",endCall:"endCall",holdCall:"holdCall",resumeCall:"resumeCall",updateDeviceInCall:"updateDeviceInCall"},holdCall:"hold_call",incomingCall:"incoming_call",incomingCallMissed:"incoming_call_missed",incomingCallPushNotification:"incoming_call_push_notification",incomingInteropCall:"incoming_interop_call",incomingPstnCall:"incoming_pstn_call",incomingScreenshareCall:"incoming_screenshare_call",incomingTfwTflInteropCall:"incoming_tfw_tfl_interop_call",incomingTransferRequest:"incoming_transfer_request",incomingVtcCall:"incoming_vtc_call",inconsistentResultCategory:"inconsistent_result_category",interop:{receivedInteropHoldRequest:"received_interop_hold_request",sendInteropHoldRequest:"send_interop_hold_request"},invalidScenarioStart:"invalid_scenario_start",ipsUpdateActiveCallState:"ips_update_active_call_state",joinCall:"joinCall",joinCallFromCompanionTransfer:"join_call_from_companion_transfer",joinCallFromIntent:"join_call_from_intent",joinCallByInvitationContent:"join_call_by_invitation_content",bargeCall:"barge_call",joinGroupCall:"join_group_call",joinHuddleGroupCall:"join_huddle_group_call",joinMeetingWithRecordingConsent:"join_meeting_with_recording_consent",joinMeetingWithDenyingRecordingConsent:"join_meeting_with_denying_recording_consent",joinMeetup:"calling_join_meetup",joinMeetupFromReplyChain:"join_meetup_reply_chain",joinOrCreateCallFromLink:"join_or_create_call_from_link",joinOrCreateMeetupFromLink:"join_or_create_meetup_from_link",joinScheduledMeetup:"join_scheduled_meetup",joinScheduledMeetupFromUniqueLink:"join_scheduled_meetup_from_unique_link",joinScreenshareCall:"join_screenshare_call",notifyStageAboutCall:"notify_stage_about_call",joinWarningDialog:"join_warning_dialog",lazyLoad:"calling_lazy_load",lbrEnabledCall:"lbr_enabled_call",leaveMeetup:"leave_meetup",leaveScenarioMaxWaitTime:30*v.second,leaveScreenshare:"leave_screenshare",lobby:{admitParticipant:"calling_lobby_admit",denyParticipant:"calling_lobby_deny",admitAllParticipants:"calling_lobby_admit_all"},localRecording:{start:"start_local_recording",stop:"stop_local_recording",startAssembly:"start_local_recording_assembly",pauseAssembly:"pause_local_recording_assembly",finishAssembly:"finish_local_recording_assembly"},location:{fetchLocation:"fetch_location",fetchLocationFromLocationCache:"fetch_location_from_location_Cache",fetchLocationSteps:{missedFetchLocation:"missed_fetch_location",locationDataRequestStart:"location_data_request_start",locationDataRequestSuccess:"location_data_request_success",locationDataRequestFailed:"location_data_request_failed"},cache:{hit:"location_cache_hit",miss:"location_cache_miss",cleanup:"location_cache_cleanup"}},lockedMeeting:"lockedMeeting",maxDialpadHeight:500,maximumSimultaneousCalls:4,mediaConfigurationServiceInit:"media_configuration_service_init",mediaConnected:"media_connected",audioDropInStartedNotification:"audio_drop_in_started_notification",meetingStartedNotification:"meeting_started_notification",mergeCall:"merge_call",mohV2Hold:"moh_v2_hold",mohV2Unhold:"moh_v2_unhold",slaV2Hold:"sla_v2_hold",slaV2Unhold:"sla_v2_unhold",slaV2Call:"sla_v2_call",mandatoryBlurEffectBackground:"mandatory_blur_effect_background",multiCall:{putOtherCallsOnHold:"put_other_calls_on_hold",handleOngoingMultiCalls:"handle_ongoing_multi_call",hasMultipleActiveCalls:"has_multiple_active_calls",steps:{getActiveCalls:"get_active_call",disconnectConnectingCall:"disconnect_connecting_call",disconnectCompleted:"disconnect_completed",callsOnHoldViaCallParkService:"calls_on_hold_via_call_park_service",callHoldStateInitiatedStart:"set-call-hold-state-initiated-start",callHoldStateInitiatedEnd:"call-hold-state-initiated-end"}},multiCallList:{callResumeClicked:"call_resume_multi_call_list",incomingCall:"incoming_call_multi_call",outgoingCall:"outgoing_call_multi_call"},multichannelAudio:{start:"multichannel_audio_start",stop:"multichannel_audio_stop",toggle:"multichannel_audio_toggle"},transcriptAttribution:{start:{multichannel:"transcript_attribution_multichannel_start",singlechannel:"transcript_attribution_singlechannel_start"},stop:{multichannel:"transcript_attribution_multichannel_stop",singlechannel:"transcript_attribution_singlechannel_stop"},toggle:{multichannel:"transcript_attribution_multichannel_toggle",singlechannel:"transcript_attribution_singlechannel_toggle"}},faceStream:{start:"facestream_start",stop:"facestream_stop",toggle:"facestream_toggle",steps:{botAdded:"bot_added",botCommandSent:"bot_command_sent",botExisted:"bot_existed",botModeNotFound:"bot_mode_not_found",dataChannelStarted:"data_channel_started",slimcoreStartApiTriggered:"slimcore_start_triggered",slimcoreStopApiTriggered:"slimcore_stop_triggered"},startReason:{joinCallOrCameraOn:"join_call_or_camera_on",toggleOn:"toggle_on",botStateChange:"bot_state_change",policyOn:"policy_on",sourceAvailable:"source_available",attributionEnabled:"attribution_enabled"},stopReason:{toggleOff:"toggle_off",turnOffCamera:"turn_off_camera",leaveCall:"leave_call",deviceNotCompatible:"device_not_facestream_compatible",policyOff:"policy_off",sourceUnavailable:"source_unavailable",attributionDisabled:"attribution_disabled"},failReason:{botCommand:"bot_command_failure",botInvite:"bot_invite_failure",slimcoreStart:"slimcore_start_failure",slimcoreStop:"slimcore_stop_failure",policyDisabled:"policy_disabled",deviceNotAvailable:"device_not_available",unneeded:"unneeded",noBotMsi:"no_bot_msi"}},peopleFeed:{start:"peopleFeed_start",stop:"peopleFeed_stop"},cameraFraming:{speakerFramingStart:"speakerframing_start",speakerFramingStop:"speakerframing_stop",groupFramingStart:"groupframing_start",groupFramingStop:"groupframing_stop"},dataChannelProxy:{send:"send_command_data_channel_proxy",onDataReceived:"onDataReceived_data_channel_proxy"},managedModeStartSpotlight:"managed_mode_spotlight_state_start",managedModeStopSpotlight:"managed_mode_spotlight_state_stop",streamingParticipantSpotlight:"streaming_participant_spotlight",streamingParticipantBringOnStage:"streaming_participant_bring_on_stage",managedModeAllowAttendeesToUnmute:"managed_mode_allow_attendees_to_unmute",managedModeAllowAttendeesToShareVideo:"managed_mode_allow_attendees_to_share_video",managedModeDisallowAttendeesToUnmute:"managed_mode_disallow_attendees_to_unmute",managedModeDisallowAttendeesToShareVideo:"managed_mode_disallow_attendees_to_share_video",muteSelf:"mute_self",muteOnAirFailed:"mute_on_air_failed",muteOnAir:{initScenario:{name:"initialize_mute_on_air",steps:{registeredCall:"registered_call",setInitialStatus:"set_initial_status"}},reportStateScenario:{name:"mute_on_air_report_state",steps:{reportingMuteStateToCallCoordinator:"sending_to_call_coordinator",reportedMuteStateToCallCoordinator:"sent_to_call_coordinator"}},receiveNotificationScenario:{name:"mute_on_air_notification_received",steps:{muting:"toggling_mute"}},data:{muteOnAirVersion:"mute_on_air_version"}},muteSpeaker:"mute_speaker",localVideoRuntimeError:"local_video_runtime_error",nativeRendererFailed:"native_renderer_failed",compositorStatusEvent:"compositor_status_event",navigateBackFromTestCall:"navigate_back_from_test_call",networkReconnect:"network_reconnect",newAlert:"call_new_alert_service",newHoldCall:"new_hold_call",nudgeEchoBotInCall:"nudge_echo_bot_in_call",nudgeEchoBotInCallAndEscalate:"nudge_ectho_bot_in_call_and_escalate",openShareInviteDialog:"openshareinvitedialog",parkCall:"park_call",participantsCount:"participantsCount",pendingMeetupDeeplinkUsed:"pending_meetup_deeplink_used",peer5NPMPackageSilentTester:"peer5_npm_package_silent_tester",peer5NPMPackageSilentTesterTestCall:"peer5_npm_package_silent_tester_test_call",pinTogetherMode:"pin_together_mode",placeCallFromVoipDialpad:"placeCallFromVoipDialpad",policies:"policies",prepareCall:"prepareCall",previousSimulateTestCallTimeStamp:"previousSimulateTestCallTimeStamp",previousTestCallTimeStamp:"previous_test_call_timestamp",protocol:{registerTelProtocol:"call_protocol_register_tel_protocol",unregisterSfBProtocols:"call_protocol_unregister_sfb_protocols"},pstnAvailability:"pstn_availability",possibleBrowserPopoutForPSTNCalls:"browser_popout_pstn_call",shareWindowOnAir:"share_window_on_air",qualityChangedEvent:"call_quality_event",raiseHand:"raise_hand",raiseHandReceived:"raise_hand_received",optimisticRaiseHand:{scenario:"raise_hand_optimistic_response_latency"},raiseHandReceivedE2e:{scenario:"raise_hand_received_e2e_latency"},renameParticipant:"rename_participant",reasons:{acceptFromScreenshare:"accept_from_screenshare",acceptThroughPrejoin:"accept_through_prejoin",acceptWithAudio:"accept_with_audio",acceptCallFromHid:"accept_from_hid_device",acceptWithoutAudio:"accept_without_audio",acceptWithVideo:"accept_with_video",alreadyOpenInChildWindow:"already_open_in_child_window",anonymousPSTNCall:"anonymous_pstn_call",autoAccept:"auto_accepted",autoRejectInACallDisposing:"auto_reject_in_a_call_disposing",autoRejectInAnSfbMeeting:"auto_reject_in_an_sfb_meeting",autoRejectIncomingVtcCallNotAllowed:"auto_reject_incoming_vtc_call_not_allowed",autoRejectInAPostCall:"auto_reject_in_a_post_call",autoRejectInABroadcast:"auto_reject_in_a_broadcast",autoRejectInATeamsMeeting:"auto_reject_in_a_teams_meeting",autoRejectTransitionCall:"auto_reject_transition_call",crossCloudMeetingJoinAttempt:"cross_cloud_meeting_join_attempt",navigatedAwayFromGum:"navigated_away_from_gum",disconnected:"disconnected",duplicateScenario:"duplicate_scenario",emptyUrlTemplate:"empty_url_template",invalidCRMUrl:"invalid_crm_url",noSkypeId:"no_skype_id",numberFormattingFailed:"number_formatting_failed",reject:"reject",reply:"reply",timeout:"timeout",urlLaunched:"url_launched",rejectFromHfpBTDevice:"reject_from_hfp_bt_device",sharingAlreadyStoppedByTsCalling:"sharing_already_stopped_by_ts_calling",isScreenSharingOnSetToFalse:"is_screen_sharing_on_set_to_false",getUserDetailsError:"get_user_details_error"},recording:{acceptStreamPolicy:"acceptStreamPolicy",complianceRecording:"compliance_recording",complianceRecordingBotAdded:"compliance_recording_bot_added",updateComplianceRecordingUsers:"update_compliance_recording_users",AsyncRecordingTranscriptAlert:"async_recording_transcript_alert",customBanner:"custom_banner",initializeCallingConversation:"initialize_calling_conversation",channelTeamNotFetched:"channel_team_not_fetched",getStreamPermissions:"getStreamPermissions",getStreamPermissionsAndPolicy:"getStreamPermissionsAndPolicy",meetingOrganizerFetched:"meetingOrganizerFetched",meetingOrganizerFetchFailed:"meetingOrganizerFetchFailed",meetingOrganizerFetching:"meetingOrganizerFetching",recordingBotPreAdd:"recording_bot_before_add",recordingBotAdded:"recording_bot_added",recordingBotAdding:"recording_bot_adding",recordingBotRetryAdding:"recording_bot_retry_adding",recordingBotTokenFailed:"recording_bot_failed_get_token",recordingBotTokenFetching:"recording_bot_getting_token",recordingBotTokenRetry:"recording_bot_retry_getting_token",recordingDebugScenario:"recording_debug_issue",recordingFailedPending:"recording_failed_pending",recordingMessageReceived:"recording_message",sendBotToken:"recording_send_token",start:"start_recording",startWithConsent:"start_recording_with_consent",statusUpdated:"status_updated",stop:"stop_recording",streamPermissions:{step:{beforeAcceptingStreamPolicy:"stream-policy-to-be-accepted",beforeGettingExtendedStreamPerms:"stream-permissions-and-policy-to-be-requested",beforeGettingStreamPerms:"stream-permissions-to-be-requested",beforeGettingTenantInfo:"tenant-info-to-be-requested",permissionsReceived:"stream-permissions-received",tenantInfoReceived:"tenant-response-received"}},titleAndTokenResolved:"title_and_token_resolved",titleFetchFailure:"title_fetch_failure",tokenResolved:"token_resolved",waitForConsentSignalFromServer:"wait_for_consent_signal_from_server"},registerNewAlert:"call_register_new_alert_service",remoteMute:{muteAll:"calling_mute_all",muteAllStructured:"calling_mute_all_structured",muteParticipant:"calling_mute_participant"},removePstnUserFromMeetup:"remove_pstn_user_from_meetup",removeGroupCopilotFromMeeting:"remove_group_copilot_from_meeting",addGroupCopilotToMeeting:"add_group_copilot_to_meeting",removeUserFromMeetup:"remove_user_from_meetup",removeWeatherpersonPresenter:"remove_weatherperson_presenter",resumeCall:"resume_call",retrieveRegistrationReport:"retrieveregistrationreport",retrieveSlimCoreFeedbacInfoScenario:"retrieveSlimCoreFeedbacInfoScenario",getQuestionnaireScenario:"get_questionnaire_scenario",getCallQuestionnaireScenario:"get_call_questionnaire_scenario",rigelAutoScreenSharing:"rigel_auto_screen_sharing",rigelCurrentTeamsState:"rigel_current_teams_state",rigelKeypadClose:"rigel_dtmf_keypad_close",rigelKeypadOpen:"rigel_dtmf_keypad_open",rigelPinRemoteVideo:"rigel_pin_remote_video",rigelStartContentCameraPreview:"rigel_start_content_camera_preview",rigelStartRenderingLocalPreview:"rigel_start_rendering_local_preview",rigelStartSharing:"rigel_start_sharing",rigelStopRenderingLocalPreview:"rigel_stop_rendering_local_preview",rigelStopSharing:"rigel_stop_sharing",rigelUnpinRemoteVideo:"rigel_unpin_remote_video",rnl:{callLog:"rnl_call_log",incomingCall:"rnl_incoming_call",missedCallFeed:"rnl_missed_call_feed",reason:{failedFederatedProfile:"rnl_rsn_failed_fed_profile",failedToPopulate:"rnl_rsn_failed_populate"},timing:{aadAndFederatedHashes:"rnl_aadAndFederatedHashes",lookupPstnContacts:"rnl_lookupPstnContacts"},voicemail:"rnl_voicemail",voicemailFeed:"rnl_voicemail_feed"},routing:{getUserEvEnabled:"user_ev_enabled",showInformationalDialog:"call_routing_informational_dialog",showOfficeContactCardDialog:"call_routing_office_contact_card_dialog",showSettingsCallingTab:"call_show_settings_calling_tab",updateClientPreference:"call_routing_update_client_preference"},screenSharingControlSharerAcceptControl:"screen_sharing_control_sharer_accept_control",screenSharingControlSharerCancelControl:"screen_sharing_control_sharer_cancel_control",screenSharingControlSharerDenyControl:"screen_sharing_control_sharer_deny_control",screenSharingControlSharerGiveControl:"screen_sharing_control_sharer_give_control",screenSharingControlViewerRequestControl:"screen_sharing_control_viewer_request_control",screenSharingControlViewerStopControl:"screen_sharing_control_viewer_stop_control",screenSharingMode:"screen_sharing_mode",screenSharingMonitorCount:"screensharing_monitor_count",screenSharingPermission:"screen_sharing_permission",screenSharingRendererStatus:"screen_sharing_renderer_status",screenSharingPresenterEnd:"screen_sharing_presenter_end",screenSharingPresenterEndSteps:{stopSharingButtonClicked:"stop_sharing_button_clicked",presenterToolbarClosed:"presenter_toolbar_closed",showCallWindow:"show_call_window",initiateStopSharingMutation:"initiate_stop_sharing_mutation",callFetched:"call_fetched",initiateStopSharingOnCall:"initiate_stop_sharing_on_call",initiateTsCallingStopSharing:"initiate_ts_calling_stop_sharing",resolvedTsCallingStoppedSharing:"resolved_ts_calling_stop_sharing",hideSharingIndicator:"hide_sharing_indicator",callDisconnecting:"call_disconnecting",callDisconnected:"call_disconnected",streamStopped:"stream_stopped",screenSharingOff:"screen_sharing_off"},screenSharingSenderNeedsRetry:"screen_sharing_sender_needs_retry",screenSharingPresenterStart:"screen_sharing_presenter_start",screenSharingPresenterStartSteps:{startScenario:"start_scenario",screenRecordingEnabled:"screen_recording_enabled",permissionCheckScreen:"permission_check_screen",permissionCheckApp:"permission_check_app",returnPreviewsScreen:"return_previews_screen",returnPreviewsApp:"return_previews_app",startSharing:"start_sharing",pickerCaptureRegionEvent:"picker_capture_region_event",scStartSharing:"sc_start_sharing",scSharingStarted:"sc_sharing_started",openToolbar:"open_toolbar",startSharingOnCallFinished:"start_sharing_on_call_finished",onAirPreviewLoading:"on_air_preview_loading",onAirPreviewLoaded:"on_air_preview_loaded",onAirSsStoppingByContentSwap:"on_air_ss_stopping_by_content_swap",onAirSsStoppedByContentSwap:"on_air_ss_stopped_by_content_swap",onAirStartSharingOnCallFinished:"on_air_start_sharing_on_call_finished",ssfcStartSharing:"ssfc_start_sharing",ssfcStartSharingOnCallFinished:"ssfc_start_sharing_on_call_finished"},screenSharingViewerStart:"screen_sharing_viewer_start",screenSharingViewerStartSteps:{startScenario:"start_scenario",isAvailable:"is_available",createCompositor:"create_compositor",compositorCreated:"compositor_created",compositorReused:"compositor_reused",startStream:"start_stream",startStreamError:"start_stream_error",startStreamFailedMsCalling:"start_stream_failed_ms_calling",scStartStream:"sc_start_stream",scStreamStarted:"sc_stream_started",isStreaming:"is_streaming"},screenSharingViewerStartFailure:{createCompositorFailed:"create_compositor_failed",compositorFailed:"compositor_failed",startStreamFailed:"start_stream_failed"},screenSharingPreviewCallMonitor:"screen_sharing_preview_call_monitor",screenSharingPreviewCallMonitorSteps:{startStream:"start_stream",startedStream:"started_stream",addSharingCompositor:"add_sharing_compositor"},screenSharingPreviewByodWindow:"screen_sharing_preview_byod_window",screenSharingPreviewByodWindowSteps:{byodStartStream:"byod_start_stream",byodStartedStream:"byod_started_stream",byodAddSharingCompositor:"byod_add_sharing_compositor"},screenSharingViewerRoleUnknown:"screen_sharing_viewer_role_unknown",screenSharingSourceType:"screen_sharing_source_type",screenSharingToolbarClose:"screen_sharing_toolbar_close",screenshareAccept:"screenshare_accept",screenshareCallEscalate:"screenshare_call_escalate",screenshareCallEscalatePending:"screenshare_call_escalate_pending",searchUsersByIdsOrQueryScenario:"searchUsersByIdsOrQueryScenario",securityDeskEmergencyCall:"security_desk_emergency_call",selfScreenSharing:"calling_self_screen_sharing",sendMessageToSecurityDeskUsers:"send_message_to_security_desk_users",sendQuestionnaireWithNEWSlimcoreAPIScenario:"sendQuestionnaireWithNEWSlimcoreAPIScenario",sendQuestionnaireWithVivaEmfResponseScneario:"sendQuestionnaireWithVivaEmfResponseScneario",checkShouldShowAttendeeVivaEmfScenario:"checkShouldShowAttendeeVivaEmfScenario",checkVivaEmfArtifacts:"checkVivaEmfArtifacts",checkIsSampledForVivaEmf:"checkIsSampledForVivaEmf",serverHold:"server_hold",serverUnmuteSelf:"server_unmute_self",setMediaConfig:"set_media_config",setMediaConfigOnRegistry:"set_media_config_on_call_registry",setVideoBackgroundImage:"set_video_background_image",setVideoCaptureConfig:"set_video_capture_config",sharing:{displaySharingSources:"display_sharing_sources",layoutSharingPanel:"layout_sharing_panel",pptViewerInit:"ppt_viewer_init",shareCamera:"share_camera",shareScreen:"share_screen",shareWindow:"share_window"},simulateCallingProbe:"simulate_calling_probe",skypeTokenRevocationSteps:{resendRegistrationFailed:"resend_registration_failed",resendRegistrationNotAvailable:"resend_registration_not_available",resendRegistrationNotEnabled:"resend_registration_not_enabled",resendRegistrationNotImplemented:"resend_registration_not_implemented"},slimcoreLazyMediaLoad:"slimcore_lazy_media_load",slimcoreOperationWithRetry:"slimcore_operation_with_retry",startCallingProbe:"start_calling_probe",startConsultation:"call_consultation",startScd:"start_scd",startSpotlight:"spotlight_state_start",startVideo:"start_video",streaming:{streamingUrlAvailability:"streaming_url_available",streamingUrlUpdated:"streaming_url_updated",streamingBotAvailability:"streaming_bot_available",streamingAttendeeMicEnabled:"streaming_attendee_mic_enabled",streamingAttendeeRaiseHand:"streaming_attendee_raise_hand",townhallETMRaiseHandReceived:"townhall_etm_raise_hand_received",streamingAttendeeManualPromotionEvent:"streaming_attendee_manual_promotion_event",streamingAttendeePromotionEvent:"streaming_attendee_promotion_event"},streamingType:{townhall:"townhall",overflowV2:"overflowV2"},startWeatherperson:"start_weatherperson",startWeatherpersonEffect:"start_weatherperson_effect",startWeatherPersonChromaKeyEffect:"start_weather_person_chroma_key_effect",stopCallingConversationRetries:"stop_calling_conversation_retries",stopSpotlight:"spotlight_state_stop",stopVideo:"stop_video",stopWeatherperson:"stop_weatherperson",stopWeatherpersonEffect:"stop_weatherperson_effect",stopWeatherpersonChromaKeyEffect:"stop_weatherperson_chroma_key_effect",switchNdiInSettings:"switch_ndi_in_settings",initNDIV2:"init_ndi_v2",startHardwareOutDevice:"start_hardware_out_device",stopHardwareOutDevice:"stop_hardware_out_device",toggleIsolatedAudio:"toggleIsolatedAudio",systemAudioSharing:"system_audio_sharing",tabSharingStop:"tab_sharing_stop",teamsDevice:{callNotificationTimeout:3e5,meetingJoinNotificationTimeout:3e4,initSteps:{aspService:"asp_service",hidService:"hid_service",peripheralsMuteService:"peripherals_mute_service",peripheralsCallControlService:"peripherals_call_control_service",peripheralsEventProvider:"peripherals_event_provider",waitDeviceManagerInit:"wait_device_manager_init"}},toggleNdi:"toggleNdi",toggleScd:"toggle_scd",transcript:{bot:{start:"transcript_start",stop:"transcript_stop",makeTranscriptEdit:"transcript_bot_make_transcript_edit",sendTokenToBot:"transcript_bot_send_token",diagnostic:"transcript_bot_diagnostic",diagnosticDelay:12e4},diagnostic:"transcript_diagnostic",navigate:"transcript_navigate",settings:{get:"transcript_settings_get",update:"transcript_settings_update"},substrate:{get:"transcript_smis_get",getLive:"transcript_smis_get_live",getAll:"transcript_smis_get_all",download:"transcript_smis_download",delete:"transcript_smis_delete",edit:"transcript_smis_edit",getAcl:"transcript_smis_get_acl"},artifacts:{getAll:"transcript_artifacts_get_all",getLive:"transcript_artifacts_get_live",get:"transcript_artifacts_get",download:"transcript_artifacts_download",delete:"transcript_artifacts_delete",getAcl:"transcript_artifacts_get_acl",edit:"transcript_artifacts_edit"},transcriptContentAppLoad:"transcript_content_app_load"},transferCall:"transfer_call",trouterService:{checkConnection:"trouter_service_check_connection",doubleConnect:"double_connect",init:"trouter_service_init",reconnect:"trouter_client_reconnect",start:"trouter_service_start",stateChange:"trouter_service_state_change",stop:"trouter_service_stop",trouterUrlRequest:"trouter_service_url_request",urlAvailable:"trouter_service_url_available",endpointId:"trouter_service_endpoint_id"},tryAddCalling:"calling_try_add",howlingSuppressionUfdScenario:"howling_suppression_ufd",unmuteSelf:"unmute_self",unmuteSpeaker:"unmute_speaker",e2eMute:{toggleServerUnmuteLatency:"toggle_server_unmute_latency",toggleMuteLatency:"toggle_mute_latency",steps:{escalateScreensharingFinalized:"escalate_screensharing_finalized",checkPermissionsFinalized:"check_permissions_finalized",microphoneStatusChanged:"microphone_status_changed",scRequestSent:"sc_request_sent",scRequestResponse:"sc_request_response",unmuteSpeakerFinalized:"unmute_speaker_finalized",unmuteSpeakerFailed:"unmute_speaker_failed"}},unparkCall:"unpark_call",unpinTogetherMode:"unpin_together_mode",updateAttendeeRestrictions:"update_attendee_restrictions",updateAplPresenterCustomBackground:"update_apl_presenter_custom_background",updateAppPref:"update_app_pref",updateCallGroupDetails:"update_call_group_details",updateConversationId:"update_conversation_id",updateRaiseHandSetting:"update_raise_hand_setting",updateRaiseHandStateFailed:"update_raise_hand_state_failed",updateRealConversationId:"update_real_conversation_id",updateCallRefreshSettings:"update_call_refresh_settings",video:"video",videoFilter:{setTouchUpStrength:"set_touch_up_strength",setTouchUpState:"set_touch_up_state",setLightCorrectionState:"set_light_correction_state",setEyeContactState:"set_eye_contact_state",getEffectState:"get_effect_state"},videoStreamRendering:"video_stream_rendering",videoStreamStopped:"video_stream_stopped",videoToggleOffLatency:"toggle_video_off_latency",videoToggleOnLatency:"toggle_video_on_latency",voiceCollection:{start:"start_voice_collection"},voiceCollectionDisableScenario:"voice_collection_disable",voiceCollectionEnableScenario:"voice_collection_enable",voiceCollectionOptoutScenario:"voice_collection_optout",voiceSettings:{killSwitch:"call_voice_settings_kill_switch",registerIMProvider:"call_voice_settings_registerasimprovider",startup:"call_voice_settings_startup",updateVoicemailSetting:"update_voicemail_settings"},watermarkCompositorFailed:"watermark_compositor_failed",whiteboardSetEffects:"whiteboard_set_effects",waitUntilAudienceBotIsReady:"wait_until_audience_bot_is_ready"},callingAutoCameraSettings:"calling_auto_camera_settings",callForwardingSettings:{getSettings:"calling_get_forwardingSettings",updateSettings:"calling_addorupdate_forwardingSettings",resetSettings:"calling_reset_forwardingSettings",getDelegatorSettings:"calling_get_delegator_forwarding_settings"},companion:{context:{appStart:"onAppStart",inSession:"inSession"},showBanner:"calling_show_companion_banner"},contactsTab:{loadCallLogs:"contact_tab_load_logs",contactActions:"contact_tab_open_action_menu",orgChart:"contact_tab_org_chart",orgChartResolved:"org_chart_resolved",favorites:"contact_tab_favorites",call:"contact_tab_call"},contentSharing:{annotationStartedBySharer:"annotation_started_by_sharer",annotationStoppedByInitiator:"annotation_stopped_by_initiator",annotationStoppedByNonInitiator:"annotation_stopped_by_nonInitiator",annotationNonInitiatorEncodedShareLinkUrlWbSessionCreated:"annotation_non_initiator_encoded_share_link_url_wb_session_created",annotationNonInitiatorSharedScreenSizeUrlWbSessionCreated:"annotation_non_initiator_shared_screen_size_url_wb_session_created",annotationNonInitiatorOpenDetachedUrlWbSessionCreated:"annotation_non_initiator_open_detached_url_wb_session_created",annotationNonInitiatorInitiatorErrorUrlWbSessionCreated:"annotation_non_initiator_initiator_error_url_wb_session_created",annotationNonInitiatorProofTokenErrorUrlWbSessionCreated:"annotation_non_initiator_proof_token_error_url_wb_session_created",annotationNonInitiatorUnknownUrlWbSessionCreated:"annotation_non_initiator_unknown_url_wb_session_created",annotationNonInitiatorUndefinedOrEmptyUrlWbSessionCreated:"annotation_non_initiator_undefined_or_empty_url_wb_session_created",annotationNonInitiatorInvalidUrlWbSessionCreated:"annotation_non_initiator_invalid_url_wb_session_created",contentSharingScreenSharingTerminate:"content_sharing_screen_sharing_terminate",cortanaPptSharingStop:"cortana_ppt_sharing_stop",getMeetingAttachmentList:"get_meeting_attachment_list",getRecentFileList:"get_recent_file_list",pptHandleFileAttachment:"ppt_handle_file_attachment",pptHandleReferenceAttachment:"ppt_handle_reference_attachment",pptSharingBackToPresenter:"ppt_sharing_back_to_presenter",pptSharingDisplayedReloadErrorScreen:"ppt_sharing_displayed_reload_error_screen",pptSharingPresenterChangedEnablePrivateView:"ppt_sharing_presenter_changed_enable_private_view",pptSharingPresenterSessionUpdate:"ppt_sharing_presenter_session_update",pptSharingStartedPrivateView:"ppt_sharing_started_private_view",pptSharingStop:"ppt_sharing_stop",pptSharingTakeControl:"ppt_sharing_take_control",pptSharingViewerChangedEnablePrivateView:"ppt_sharing_viewer_changed_enable_private_view",pptSharingViewerConfirmation:"ppt_sharing_viewer_confirmation",pptSharingWrsInit:"ppt_sharing_wrs_init",presenterJoin:"content_sharing_presenter_join",rejoin:"content_sharing_rejoin",sessionStarted:"content_sharing_session_started",start:"content_sharing_start",stateUpdated:"content_sharing_state_updated",appSharingAngularWebUser:"app_sharing_angular_web_user",steps:{bootstrapperLoaded:"bootstrapper_loaded",contentShareToDto:"content_share_to_dto",dtoCreated:"dto_created",dtoParsed:"dto_parsed",fileDetailedInfoFetched:"file_detailed_info_fetched",joinedSession:"joined_session",layoutItemCreated:"layout_item_created",layoutItemInitialized:"layout_item_initialized",meetingAttachmentRetrieved:"meeting_attachment_retrieved",pptBootstrapperUrlFetched:"ppt_bootstrapper_url_fetched",pptFileRedeemCallFinished:"redeem_call_finished",pptSharingTokensFetched:"ppt_sharing_tokens_fetched",sessionCreated:"session_created",sessionStarted:"session_started",sessionAdded:"session_added",setSharingLayoutWeatherperson:"set_sharing_layout_weatherperson",spoFetchStart:"spo_fetch_start",spoSiteUrlFetched:"spo_site_url_fetched",scenarioStarted:"begin",whiteboardUrlRetrieved:"whiteboard_url_retrieved"},stop:"content_sharing_stop",viewerJoin:"content_sharing_viewer_join",sessionStopped:"content_sharing_session_stopped",whiteboardSharingPresenterSessionUpdate:"whiteboard_sharing_presenter_session_update"},coordinatedMeetings:{joinCall:"coordinated_join_call",removeTrustedAccounts:"coordinated_remove_trusted_accounts",steps:{autoAcceptSuccessful:"auto_accept_successful",autoAcceptFailed:"auto_accept_failed"}},devices:{deviceManagerServiceInit:"device_manager_service_init",logDevices:"device_manager_log_devices",selectDevices:"device_manager_select_devices",devicesChangeOverload:"devices_change_overload",devicesInit:{name:"devices_init",steps:{devicesInitStart:"devices_init_start",devicesInitComplete:"devices_init_complete"}},deviceAddedorRemoved:"device_added_removed",step:{deviceAdded:"device_added",deviceRemoved:"device_removed",selectDevices:"device_manager_select_devices"},devicesUpdate:{name:"devices_update",steps:{updateStart:"update_start",audioSelectionUFD:"audio_selection_ufd",deviceRemoved:"device_removed",deviceAdded:"device_added",switchToRealCam:"switch_to_real_cam",micChangedEvent:"mic_changed_event",speakerChangedEvent:"speaker_changed_event",camChangedEvent:"cam_changed_event",popApplicationDeviceChanged:"pop_application_device_changed",deviceChangedEvent:"device_changed_event",devicePlugin:"device_plugin",audioDevicePlugin:"audio_device_plugin",videoDevicePluginUFD:"video_device_plugin_ufd",devicePlugout:"device_plugout",speakerOrderChange:"speaker_order_change",micOrderChange:"microphone_order_change",videoDevicePlugoutUFD:"video_device_plugout_ufd",selectBestDevice:"select_best_device",resolveBrowserId:"resolve_browser_id",getBrowserId:"get_browser_id",getBrowserIdTimeout:"get_browser_id_timeout"}}},emergencyService:{getPolicySettings:"calling_emergency_service_get_policy_settings",getUpdatedAggregateSettings:"calling_emergency_service_get_updated_aggregate_settings",openDatabase:"calling_emergency_open_database",saveLocationToCache:"calling_emergency_save_location_to_cache",startCall:"calling_emergency_service_start_call",loadLocationFromCache:"calling_emergency_load_location_from_cache",locationFoundInCache:"location_found",removeCustomLocationFromCache:"remove_custom_location_from_cache",customLocationRemovedFromCache:"custom_location_removed_from_cache",getEmergencyCustomDisclaimer:"emergency_custom_disclaimer",setUserAgreementForEmergencyCustomDisclaimer:"set_user_agreement_for_emergency_custom_disclaimer"},callGroupMembershipSettings:{get:"get_call_group_membership_settings",update:"update_call_group_membership_settings"},loadAutoCameraSettings:"load_auto_camera_settings",meetingBranding:{showLogo:{name:"meeting_branding_show_logo",marks:{startFetchFromMiddletier:"start_fetch_from_middletier",logoUrlSanitized:"logo_url_sanitized",logoUrlFetched:"logo_url_fetched"}}},noiseSuppression:{loadNS:"call_ns_load_setting",setNS:"call_ns_set_setting",setNSMidCall:"call_ns_mid_call_set_setting"},preJoin:{preJoinAutoMute:"pre_join_automute",preJoinPstnCapabilities:"pre_join_pstn_capabilities",preheat:"pre_join_preheat",preheatStart:"start preheating",preheatPreheating:"in preheating state",preheatPreheated:"in preheated state",preheatCanceled:"user joins before preheating finished",preheatLeavePrejoin:"user closed prejoin before preheating finished",ccwm:"pre_join_ccwm",ccwmExecute:"execute ccwm",ccwmObservingCall:"observing call for ccwm",ccwmCreateCallInfo:"ccwm create call info",ccwmGetCallInfo:"ccwm get call info",ccwmWhenConversationInitialized:"ccwm when conversation initialized"},proximityJoinSurfaceHub:"proximity_join_surfacehub",pushToTalk:{storageSettingUpdate:"push_to_talk_storage_update"},togetherModeNameLabel:{getCurrentSeatMapping:"get_current_seat_mapping"},getAutoFramingVideoSettings:"get_auto_framing_video_settings",selectAutoCameraSettings:"select_auto_camera_settings",selectManualCameraSettings:"select_manual_camera_settings",selectAutoFramingVideoSettings:"select_auto_framing_video_settings",selectIgnoreMirrorMyVideoSettings:"select_ignore_mirror_my_video_settings",selectGreenScreenVideoEffectPreferenceSettings:"select_green_screen_video_effect_preference_settings",sharing:{systemAudioDriverInstallation:"system_audio_driver_installation"},spatialAudio:{setSpatialAudioConfig:"set_spatial_audio_config",setParticipantSpatialAudioPositions:"set_participant_spatial_audio_positions"},setWindowsEffectsState:"set_windows_effects_state",getWindowsAICapability:"get_windows_ai_capability",startMeetingForInteropScreenshare:"start_meeting_for_interop_screenshare",steps:{start:"start",stop:"stop",calling:{answeredElsewhere:"answered_elsewhere",answeredElsewhereToast:{hasDisplayName:"has_display_name",lookingupDisplayName:"lookingup_display_name"},branchSurvivabilitySteps:{appliancesPingFailed:"appliances_ping_failed",fetchSkypeTokenFailed:"fetch_skype_token_failed",findApplianceCandidateFailed:"find_appliance_candidate_failed"},callEscalation:{addParticipantPromiseRejected:"add_participant_promise_rejected",addParticipantPromiseResolved:"add_participant_promise_resolved",getChatConversation:"get_chat_conversation",getNewThreadId:"get_new_thread_id",escalateDecoupledCall:"escalate_decoupled_call"},callIdChanged:"call_id_changed",callerProfileObtained:"caller_profile_obtained",callPark:{callHeld:"call_held",callParked:"call_parked",subjectCallEnded:"subject_call_ended"},callScreenDoubleNavigation:"callScreenDoubleNavigation",callToHoldEnded:"call_to_hold_ended",createUserInitiatedTestCall:{getConversationWithV2:"get_conversation_with_v2",getConversationWithV2Complete:"get_conversation_with_v2_complete",waitForFireCallingIntent:"wait_for_fire_calling_intent",waitForStartOrJoinCallFromIntent:"wait_for_start_or_join_call_from_intent",getCallingIntentComplete:"get_calling_intent_complete",getCallingPromiseComplete:"get_calling_promise_complete"},v2Hold:{callLocalHeld:"call_local_held",callParked:"call_parked"},v2Unhold:{callUnparked:"call_unparked",callLocalResumed:"call_local_resumed"},checkAndUpdateConversationId:{callingConversationInitialized:"calling_conversation_initialized",callingConversationMembersPopulated:"calling_conversation_members_populated"},connected:"connected",connecting:"connecting",createAndJoinInstantMeeting:{conversationIdReceivingFailed:"failedToReceiveConversationId",schedulerPromiseResolved:"scheduler_promise_resolved",meetingThreadUpdateFailed:"failedToUpdateMeetingThreadInfo"},resolveLeaveCall:"resolve_leave_call_on_disconnecting_disconnected",disconnected:"disconnected",disconnecting:"disconnecting",delegatorProfileObtained:"delegator_profile_obtained",earlyMedia:"early_media",emergency:{setEmergencyContent:"set_emergency_content"},fetchPhoneNumber:{emptyInAAD:"empty_in_aad",emptyInBVD:"empty_in_bvd"},formatPhoneNumber:{appliedDialplanNormalization:"applied_dialplan_normalization",cleanedFormatting:"cleaned_formatting",formattedForDisplay:"formatted_for_display",standardizedToE164:"standardized_to_e164"},gumSkipped:"gum_skipped",invalidIntentType:"invalid_intent_type",joinOrCreateMeetupFromLink:{handleChatCallDeepLink:"handleChatCallDeepLink",handleMeetingDeepLink:"handleMeetingDeepLink",identityChanged:"identityChanged",vdiWaitForCallingAllowed:"vdiWaitForCallingAllowed",malformedConversationId:"malformedConversationId",nullDeepLinkScenarioRecreated:"nullDeepLinkScenarioRecreated",reLogingFailed:"reLogingFailed"},holdCall:{serverHold:"server_hold",toggleHold:"toggle_hold",slaHold:"sla_hold",alreadyHeld:"already_held",serverHoldV2:"server_hold_v2",sharedLineHoldV2:"shared_line_hold_v2"},inLobby:"in_lobby",inStaging:"in_staging",v2JoinCallByInvitationContent:{callConnectedSuccess:"callConnectedSuccess",showIntentSuccess:"showIntentSuccess"},joinMeetup:{callObjectCreated:"callObjectCreated",callStateChanged:"callStateChanged",navigatingToPreJoinScreen:"navigatingToPreJoinScreen",preJoinDoubleNavigation:"preJoinDoubleNavigation",scenarioAlreadyStarted:"scenarioAlreadyStarted",updateDisplayNameFailed:"updateDisplayNameFailed"},meetingStartedNotification:{meetingStartedToastCreated:"meeting_started_toast_created",meetingStartedToastShown:"meeting_started_toast_shown",meetingStartedToastDismissed:"meeting_started_toast_dismissed",meetingStartedToastNotDismissed:"meeting_started_toast_not_dismissed",meetingStartedToastAccepted:"meeting_started_toast_accepted",timeout:"meeting_started_toast_timedout",reply:"reply"},meetingStartedNotificationV2:{pushNotificationReceived:"push_notification_received",calendarGetEventsError:"calendar_get_events_error",createTriggered:"create_meeting_started_notification_triggered",fetchPeople:{profileSucceeded:"fetch_people_profile_succeeded",profileIsEmpty:"fetch_people_profile_is_empty",profileFailed:"fetch_people_profile_failed",profileUnknown:"fetch_people_unknown_profile"}},missed:"missed",multiCallLimitReached:"limit_for_maximum_number_of_simultaneous_calls_reached",notificationShown:"notification_shown",notificationToast:{alreadyActiveCallForOtherAccount:"already_active_call_for_other_account",cannotAcceptCall:"incoming_call_cannot_be_accepted",cgNotificationMuted:"incoming_call_notification_is_muted",cgNotificationRingtoneMuted:"incoming_call_notification_ringtone_muted_for_cg",cgNotificationWithRingtone:"incoming_call_notification_with_ringtone_for_cg",conversationIdSet:"conversationId_set_on_incoming_call",extendedIncomingCallTypeSet:"extended_incoming_call_type_set",conversationIdNotSet:"conversationId_not_set_on_incoming_call",createWithDefaultProfiles:"incoming_call_notification_create_with_default_profiles",createWithPeopleProfiles:"incoming_call_notification_create_with_people_profiles",dismissedByUser:"incoming_call_dismissed_by_user",extendedIncomingCallTypeSettingError:"extended_incoming_call_type_setting_error",navigateCalls:"navigate_calls",notificationProcessFail:"incoming_call_notification_process_fail",notificationUpdated:"incoming_call_notification_updated",notificationNotDropped:"notification_not_dropped",receivedCallInNotifiedState:"incoming_call_received_in_notified_state",replaceCall:"replace_call_no_toast_created",SHUBAutoAccept:"auto_accpeted_on_shub",shubSessionNotReady:"shub_session_not_ready",updateWithPeopleProfiles:"incoming_call_notification_update_with_people_profiles"},notCallingStopOnAlreadyDisconnectingCall:"call_is_already_in_disconnecting_state",processedConnectedCallsHandlingOnLeave:"processed_connected_calls_handling_on_leave",finishCallEndScenariosMarkingComplete:"finish_call_end_scenarios_marking_complete",slimcoreApiStopCallInvoked:"slimcore_api_stop_call_invoked",outgoingCall:{callConfigCreated:"call_config_created",callConversationFetchedInPrepareCall:"call_conversation_fetched_prepareCall",callConversationFetchedStartCall:"call_conversation_fetched_startCall",callConversationFetchedInCallingServiceInit:"call_conversation_fetched_callingService_init",callCreated:"call_created",createCallWithGroupId:"create_call_with_groupid",createCall:"create_call",callStartOptionsUpdated:"call_start_options_updated",creatingCall:"creating_call",initCall:"init_call",joinCallVerifiedCallState:"join_call_verified_call_state",joiningOngoingCall:"joining_ongoing_call",navigateToCallScreenInvoked:"navigate_to_call_screen_invoked",noCallFoundToJoin:"no_call_found_to_join",observingCallFetchedForJoin:"observing_call_fetched_for_join",postJoinCallErrored:"post_join_call_errored",postJoinCallInvoked:"post_join_call_invoked",preparingCall:"preparing_call",scenarioSetOnCall:"scenario_set_on_call",slimcoreApiJoinInvoked:"slimcore_api_join_invoked",slimcoreApiJoinSuccess:"slimcore_api_join_success",slimcoreApiJoinFailed:"slimcore_api_join_failed",validateMri:"validate_mri",verifyingCallState:"verifying_call_state"},peer5NPMPackageSilentTester:{peer5RunnerInitStart:"peer5_runner_init_start",peer5RunnerInitComplete:"peer5_runner_init_complete"},peer5NPMPackageSilentTesterTestCall:"peer5_npm_package_silent_tester_test_call",proximity:{attemptAutoAccept:"attempt_proximity_auto_accept",byomAutoAcceptDisabled:"byom_auto_accept_disabled",byomAutoAcceptProximitySource:"byom_auto_accept_proximity_source",proximityAuthFailed:"proximity_auth_failed",proximityAutoAcceptFailed:"proximity_auto_accept_failed",proximityJoinSource:"proximity_join_source",ultrasoundAutoAcceptDisabled:"ultrasound_auto_accept_disabled",roomQrCodeAutoAcceptDisabled:"room_qr_code_auto_accept_disabled",roomQrCodeSaltInvalid:"room_qr_code_salt_invalid",autoAcceptExternalDisabled:"auto_accept_external_disabled",autoAcceptAllDisabled:"auto_accept_all_disabled"},steps:"steps",stop:"stop",thirdPartyRoomService:"third_party_room_service",unholdCall:{serverHold:"server_hold",toggleHold:"toggle_hold"},unifiedFlowSteps:{startOrJoinCallFromIntent:"start_or_join_call_from_intent",intentPrepared:"intent_prepared",acceptCallFromChat:"accept_call_from_chat",acceptCall:"accept_call",initiateCall:"initiate_call",angularNavigation:"uf_angular_navigation",joinFromIntentInternal:"uf_join_from_intent_internal",joinCallingFromIntentInternal:"uf_join_calling_from_intent_internal",preCallChecksPassed:"pre_call_checks_passed",setupConversationMembers:"setup_conversation_members",waitForMWCallToStart:"wait_for_mw_call_to_start"},unfiedFlow:{replace:{intentUpdated:"replace_call_window_intents_updated",intentReset:"replace_call_window_intents_reset",failed:"replace_call_window_failed",success:"replace_call_window_success"}}}},teamAndChannel:{getTeamsMeetingConfguration:"admin_get_meeting_configuration"},tryGetAnonymousMeetingInfo:"try_get_anonymous_meeting_info",TTY:{loadTTY:"call_tty_load_setting",setTTY:"call_tty_set_setting"},VDI:{clientConnected:"clientConnected",multiWindow:"vdi_multiWindow",unableToRemote:"unableToRemote",unsupportedEndpoint:"unsupportedEndpoint",unsupportedSingleWindowEnvironment:"unsupportedSingleWindowEnvironment",connectedState:"vdi_connected_state",context:"vdi_context",sessionResumed:"vdi-session-resumed",localStackLock:"vdi-local-stack-lock",disconnectedUnlock:"vdi-disconnected-unlock",vdiShimOperationalLatency:{scenarioName:"vdi-shim-operational-latency",startStep:"vdi-shim-operational-latency-start"},getWindowHandleAsHex:"get_window_handle_as_hex",getWindowHandleAsHexSteps:{validWindowHandleRetrieved:"valid_main_window_handle_retrieved",gotInvalidNativeWindowHandleRetry:"invalid_main_valid_window_handle_retry",gotInvalidNativeWindowHandleRetryRecovered:"invalid_main_valid_window_handle_retry_recovered",validWindowHandleRetrieveFailed:"main_window_handle_retrieve_failed"}},VDI2dot0:{slimcoreVDIInit:"slimcore_vdi_init",slimcoreVDIInitSteps:{slimcoreVDIModuleLoadSuccess:"slimcore_vdi_module_load_success",slimcoreVDIModuleLoadFailed:"slimcore_vdi_module_load_failed",vdiBridgeStarted:"vdi_bridge_started"},vdiBridgeStopped:"vdi_bridge_stopped",vdiBridgeEvents:{connected:"vdi_bridge_connected",downloadSlimcore:"vdi_bridge_download_slimcore",disconnected:"vdi_bridge_disconnected",connectedNoPlugin:"vdi_bridge_connected_no_plugin"},tsCallingCustomVideoBackgroundDownloadImage:"tsCalling_customVideoBackground_download_image"},webinars:{joinScheduledWebinarFromLink:"join_scheduled_webinar_from_link"},whiteboard:{getWhiteboardPolicy:"get_whiteboard_policy",initiatorLoadFluidWhiteboard:"initiator_load_fluid_whiteboard",nonInitiatorReadyForFluidWhiteboard:"non_initiator_ready_for_fluid_whiteboard",nonInitiatorLoadFluidWhiteboard:"non_initiator_load_fluid_whiteboard",loadWhiteboard:"load_whiteboard",removeTabProperty:"remove_whiteboard_tab_property",getFluidEnabledForTenant:"get_fluid_enabled_for_tenant",steps:{foundPolicyInStore:"found_whiteboard_policy_in_store",getFluidEnabledFromSharepoint:"get_fluid_enabled_spo",getUserDetails:"get_user_details",loadingPolicyFromStore:"loading_whiteboard_policy_from_store",retrievingPolicyFromServer:"retrieving_whiteboard_policy_from_server",storePolicy:"store_whiteboard_policy",urlChangeReceived:"whiteboard_url_change_received",urlChangeSent:"whiteboard_url_change_sent",urlRetrieved:"whiteboard_url_retrieved",whiteboardRendererDestroyed:"whiteboard_renderer_component_destroyed",meetingWhiteboardQueryStart:"start_meeting_whiteboard_query",meetingWhiteboardUrlResult:"meeting_whiteboard_query_result",contextTenantDoesNotMatch:"context_tenant_id_not_matching",fluidAndLegacyWbDisabled:"fluid_and_legacy_whiteboard_disabled",share_content_success:"share_content_success",tenant_id_auth_service:"tenant_id_search",ical_from_meeting:"ical_from_meeting"}},bluetoothLE:{bluetoothLEStatus:"bluetoothLE_status",burstScanStart:"burst_scan_start",scanStart:"scan_start",beaconAdvertisement:"beacon_advertisement",context:{init:"init",publisherStatusChanged:"publisher_status_changed",radioReady:"radio_ready",radioNotReady:"radio_not_ready",saltUpdate:"salt_update",settingsUpdated:"settings_updated",unexpectedFailure:"unexpected_failure"},devicesWaitForBluetoothInitialized:"devices_wait_for_bluetooth_initialized"},ultrasound:{enableBeaconDetector:"ultrasound_enableBeaconDetector",disableBeaconDetector:"ultrasound_disableBeaconDetector",enableBeaconProducer:"ultrasound_enableBeaconProducer",init:"ultrasound_init",payloadProcessing:"ultrasound_payload_processing",setAudioConfig:"ultrasound_setAudioConfig",detectMultipleUltrasoundMTRs:"ultrasound_detect_multiple_mtrs"},roomJoin:{suggestedRoomsEndpoint:"suggested_rooms_endpoint",searchRoomsEndpoint:"search_rooms_endpoint"},biometricEnrollment:{createVoiceProfileCoach:"create_profile_coach_voice",removeEnrollment:"remove_enrollment",deleteEnrollment:"delete_enrollment_voice",refreshEnrollmentStatus:"fetch_user_enrollment_status_voice",shouldShowRecognitionTab:"should_show_recognition_tab_voice",fetchUserVoiceSignature:"fetch_user_signature_voice",refreshEnrollmentStatusVoice:"refresh_enrollment_status_voice",cacheEnrollmentStatus:"cache_enrollment_status_voice",getCachedEnrollmentStatus:"get_cached_enrollment_status_voice",cacheVoiceSignature:"cache_signature_voice",getCachedVoiceSignature:"get_cached_signature_voice",informSlimcoreToDownloadModel:"inform_slimcore_to_download_model_voice"},betterTogether:{transportAgentLazyLoad:"transportAgentLazyLoad",commandRouter:{incomingCommandReceived:"b2g:incoming_command_received_scenario",ackIncomingCommand:{failure:"b2g:ack_incoming_command_failure",success:"b2g:ack_incoming_command_success"},sendOutgoingCommand:"b2g:send_outgoing_command"},connectionHandler:{userPreferenceStoreInitialized:"userPreferenceStoreInitialized",machineSuspend:"machineSuspend",endpointMatched:"b2g:endpointMatched"},incomingCommand:{incomingCommand:"b2g:incoming_command",response:"b2g:incoming_response",autoPair:"b2g:auto_pair",broadcast:"b2g:broadcast",incomingLock:"b2g:incoming_lock",openFile:"b2g:open_file",pair:"b2g:pair",replyFromDesktop:"b2g:reply_from_desktop",incomingUnlock:"b2g:incoming_unlock",unpair:"b2g:unpair",updateEndpoint:"b2g:update_endpoint",openShare:"b2g:open_share",startcall:"b2g:incoming_start_call",endcall:"b2g:incoming_endcall",mute:"b2g:incoming_mute",unmute:"b2g:incoming_unmute",startvideo:"b2g:incoming_start_video",stopvideo:"b2g:incoming_stop_video",startaudio:"b2g:incoming_start_audio",stopaudio:"b2g:incoming_stop_audio",holdcall:"b2g:incoming_hold",unholdcall:"b2g:incoming_unhold",invalidCommand:"b2g:invalid_incoming_command",reportProblem:"b2g:incoming_report_problem",cameraOn:"b2g:incoming_camera_on",cameraOff:"b2g:incoming_camera_off",volumeUp:"b2g:incoming_volume_up",volumeDown:"b2g:incoming_volume_down",captionsOn:"b2g:incoming_captions_on",captionsOff:"b2g:incoming_captions_off",showVideoGallery:"b2g:incoming_show_video_gallery",showContent:"b2g:incoming_show_content",showVideoGalleryAndContent:"b2g:incoming_show_video_gallery_and_content",showLargeGallery:"b2g:incoming_show_large_gallery",showTogether:"b2g:incoming_show_together",leaveMeeting:"b2g:incoming_leave_meeting"},outgoingCommand:{outgoingCommand:"b2g:outgoing_command",response:"b2g:outgoing_response",keepAlive:"b2g:keep_alive",outgoingLock:"b2g:outgoing_lock",outgoingUnlock:"b2g:outgoing_unlock",joincall:"b2g:outgoing_join_call",startcall:"b2g:outgoing_start_call",createandstartcall:"b2g:outgoing_create_and_start_call",dialNumber:"b2g:dial_number",endcall:"b2g:outgoing_endcall",mute:"b2g:outgoing_mute",unmute:"b2g:outgoing_unmute",unpair:"b2g:outgoing_unpair",startvideo:"b2g:outgoing_start_video",stopvideo:"b2g:outgoing_stop_video",startaudio:"b2g:outgoing_start_audio",stopaudio:"b2g:outgoing_stop_audio",holdcall:"b2g:outgoing_hold",unholdcall:"b2g:outgoing_unhold",invalidCommand:"b2g:invalid_outgoing_command",reportProblem:"b2g:outgoing_report_problem",updateState:"b2g:outgoing_update_state",updateCapabilities:"b2g:outgoing_update_capabilities",pair:"b2g:pair",cameraOn:"b2g:outgoing_camera_on",cameraOff:"b2g:outgoing_camera_off",volumeUp:"b2g:outgoing_volume_up",volumeDown:"b2g:outgoing_volume_down",captionsOn:"b2g:outgoing_captions_on",captionsOff:"b2g:outgoing_captions_off",showVideoGallery:"b2g:outgoing_show_video_gallery",showContent:"b2g:outgoing_show_content",showVideoGalleryAndContent:"b2g:outgoing_show_video_gallery_and_content",showLargeGallery:"b2g:outgoing_show_large_gallery",showTogether:"b2g:outgoing_show_together",leaveMeeting:"b2g:outgoing_leave_meeting"},remoteController:{incomingSession:"b2g:rc:incomingSession",incomingSessionSteps:{endpointReceived:"b2g:rc:endpointReceived",endpointAlreadyPaired:"b2g:rc:endpointAlreadyPaired",invalidEndpoint:"b2g:rc:invalidEndpoint",pairingRequested:"b2g:rc:pairingRequested",pairingSucceeded:"b2g:rc:pairingSucceeded",pairingFailed:"b2g:rc:pairingFailed",removingAlreadyPairedEndpoint:"b2g:rc:removingAlreadyPairedEndpoint",sessionAlreadyAccepted:"b2g:rc:sessionAlreadyAccepted"},sessionIdNotFound:"b2g:rc:sessionIdNotFound",sessionScenarioNotFound:"b2g:rc:sessionScenarioNotFound",pairedDevicesCount:"b2g:rc:paired-devices_count",onPair:"b2g:rc:on-pair",onUnpair:"b2g:rc:on-unpair",createSession:"b2g:rc:createSession",removeSession:"b2g:rc:removeSession",desktop:{createSession:"b2g:desktop:createSession",proximityScan:"b2g:desktop:proximityScan"},errorCodes:{NotInProximity:"notInProximity",SaltNotPresent:"saltNotPresent",NoEndpointId:"noEndpointId",UnknownException:"unknownException",SessionTimeoutOnMTR:"sessionTimeoutOnMTR",SessionCreationFailed:"SessionCreationFailed",PairingFailed:"pairingFailed"},roomRemoteProximityBanner:"b2g:roomRemoteProximityBanner"}},extensibility:{remoteCamera:{ptzInitialize:"remote_camera_ptz_initialization",ptzCapableParticipants:"remote_camera_ptz_capable_participants",terminateRemotePtzSession:"remote_camera_terminate_remote_ptz_Session",sendRemotePtzCustomCommand:"remote_camera_send_remote_ptz_custom_command",requestRemotePtzCameraControl:"remote_camera_request_remote_ptz_camera_control",requestPTZControlFromMixin:"remote_camera_request_ptz_control_mixin",getPtzCapableParticipantsFromMixin:"remote_camera_get_ptz_capable_participants_mixin",terminatePtzSessionFromMixin:"remote_camera_terminate_ptz_session_from_mixin",ptzSessionChanged:"remote_camera_ptz_session_changed",ptzDeviceStateChanged:"remote_camera_device_state_changed",ptzHandlerError:"remote_camera_ptz_handler_error",ptzParticipantAdded:"remote_camera_ptz_participant_added",ptzParticipantRemoved:"remote_camera_ptz_participant_removed",ptzParticipantOnMetadataUpdate:"remote_camera_ptz_participant_on_metadata_update"}},videoExtensibility:{enable:{name:"enableVideoExtensibility",steps:{streamInfo:"streamInfo",videoReady:"videoReady"}},disable:{name:"disableVideoExtensibility"}}},scenarioDataPropNames:{allowRegisteredUsersToBypassLobby:"allowRegisteredUsersToBypassLobby",disableLobby:"disableLobby",captionData:"captionData",captionError:"captionError",coachData:"coachData",coachError:"coachError",broadcastData:"broadcastData",broadcastError:"broadcastError",streamingData:"streamingData",streamingError:"streamingError",deliveryPipelineType:"deliveryPipelineType",productionData:"productionData",attendeeViewModes:"attendeeViewModes",productionStudioMode:"productionStudioMode",productionStudioEnabled:"productionStudioEnabled",productionError:"productionError",errorCode:"errorCode",transcriptData:"transcriptData",transcriptError:"transcriptError",combinedBotData:"combinedBotData",broadcastReason:"broadcastReason",statusCode:"statusCode",copilotData:"copilotData",copilotError:"copilotError",interpretationData:"interpretationData",isNetworkOnline:"isNetworkOnline",isAppOnline:"isAppOnline",isReloginRequired:"isReloginRequired",roundTripTime:"roundTripTime",receivePacketLoss:"receivePacketLoss"},scenarioEventData:{type:"type",size:"size",entryPoint:"entryPoint",scenarioEntryPoint:{fileConflictDialog:"file-conflict-dialog",single:"single"}},scenarioStepStatus:{abandoned:"abandoned",failure:"failure",incomplete:"incomplete",success:"success",timeout:"timeout"},seeMyScreenShareEndpointMetadataKey:"screenshareRendered",settings:{names:{enableCallingInTfl:"enableCallingInTfl",enableTfwTflCallingFederation:"enableTfwTflCallingFederation",enableSkypeConsumerCallNotification:"enableSkypeConsumerCallNotification",enableSpamCallNotification:"enableSpamCallNotification",enableGetFederatedUsers:"enableGetFederatedUsers",callingEnableRoutingNudgeThroughPrejoin:"callingEnableRoutingNudgeThroughPrejoin",callingEnableContentOnlyJoinFromMeetingNudge:"callingEnableContentOnlyJoinFromMeetingNudge",cancelScenarioIfReloginRequired:"cancelScenarioIfReloginRequired",enableMeetingPreJoinExperience:"enableMeetingPreJoinExperience",allowAdvCommsValidationForHardwareOut:"allowAdvCommsValidationForHardwareOut",allowTeamsModernCallingForAnonNDIUsage:"allowTeamsModernCallingForAnonNDIUsage",allowTeamsNDIPolicyValidation:"allowTeamsNDIPolicyValidation",allowTeamsNDIUsage:"allowTeamsNDIUsage",callingCdlCallUpdateEventThrottleRate:"callingCdlCallUpdateEventThrottleRateV2",subscribedCallChangedThrottleRate:"subscribedCallChangedThrottleRate",enableParticipantsSchemaCheck:"enableParticipantsSchemaCheck",e2eeStatusChangedEventThrottleRate:"e2eeStatusChangedEventThrottleRate",callingCdlParticipantsChangedEventThrottleRate:"callingCdlParticipantsChangedEventThrottleRate",callingCdlParticipantsChangedLogDebounceTime:"callingCdlParticipantsChangedLogDebounceTime",callingCdlStartStreamsBatchRate:"callingCdlStartStreamsBatchRate",callingCdlVoiceLevelThrottleRate:"callingCdlVoiceLevelThrottleRate",callingConstants:"callingConstants",callingEnableRejoinWithSameIntentId:"callingEnableRejoinWithSameIntentId",callingMultiWindowServiceConfig:"callingMultiWindowServiceConfig",callingRouteEventsPublisherThroughCallingService:"callingRouteEventsPublisherThroughCallingService",callingEnableMeetingJoinFromDevice:"callingEnableMeetingJoinFromDevice",callingEnableSkipParticipantsUpdatesOnCall:"callingEnableSkipParticipantsUpdatesOnCall",callingEnableSkipDominantSpeakerUpdatesOnCall:"callingEnableSkipDominantSpeakerUpdatesOnCall",callingApiDisposeTimeoutInMs:"callingApiDisposeTimeoutInMs",callingDisposeGetGlobalServicesTimeoutInMs:"callingDisposeGetGlobalServicesTimeoutInMs",callingDisposeJailedServices:"callingDisposeJailedServices",cfsDefaultWaitTimeInSeconds:"cfsDefaultWaitTimeInSeconds",desktopCallingProbeFrequencyInDays:"desktopCallingProbeFrequencyInDays",disableCallConsultationMixin:"disableCallConsultationMixin",disablePstnMriNormalization:"disablePstnMriNormalization",enableFixForDtmfTone:"enableFixForDtmfTone",enableTrackingNormalizationRuleWithPlus:"enableTrackingNormalizationRuleWithPlus",disableIgnoreEmergencyNumberPrefix:"disableIgnoreEmergencyNumberPrefix",enableDynamicEmergencyCalling:"enableDynamicEmergencyCalling",enableAnnotation:"enableAnnotation",enableAnnotationButtonInSharingToolbar:"enableAnnotationButtonInSharingToolbar",enableAnnotationInOneToOneCall:"enableAnnotationInOneToOneCall",enableQnaFeedUpdatedNotificationsUsingSignalr:"enableQnaFeedUpdatedNotificationsUsingSignalr",enableAttendanceReportInCallEndMessage:"enableAttendanceReportInCallEndMessage",enableAttendanceReportInCallEndMessageV3:"enableAttendanceReportInCallEndMessageV3",enableDeepLinkShareExtensibleApp:"enableDeepLinkShareExtensibleApp",enableSATSignalConsumptionForStagingRooms:"enableSATSignalConsumptionForStagingRooms",enableHideSameRoomParticipants:"enableHideSameRoomParticipants",enableUnhideOtherRoomParticipants:"enableUnhideOtherRoomParticipants",enableAttendanceReportUsingControlMessages:"enableAttendanceReportUsingControlMessages",enableBypassingTenantPolicyForProbecall:"enableBypassingTenantPolicyForProbecall",enableCallingMultiWindowV2:"enableCallingMultiWindowV2",enableCallingProbe:"enableCallingProbe",enableCallingProbeDailyTimer:"enableCallingProbeDailyTimer",enableCallingScreenPreRender:"enableCallingScreenPreRender",enableLegacyEndCallOnUserEndpoints:"enableLegacyEndCallOnUserEndpoints",enableCalllingProbeBasedOnLastCall:"enableCalllingProbeBasedOnLastCall",enableCallStateHid:"enableCallStateHid",enableCallTranscriptDuplicateBotFiltering:"enableCallTranscriptDuplicateBotFiltering",disableCallTranscriptPartials:"disableCallTranscriptPartials",enableControlForAnon:"enableControlForAnon",enableDialPlans:"enableDialPlans",enableDoNothingForwardingSetting:"enableDoNothingForwardingSetting",enableDynamicQueryingBlurringCapability:"enableDynamicQueryingBlurringCapability",enableEchoBotCall:"enableEchoBotCall",enableEmfViva:"enableEmfViva",enableEmfVivaAttendeeOverride:"enableEmfVivaAttendeeOverride",enableEmfVivaOrganizerSettingsRequestTo1E:"enableEmfVivaOrganizerSettingsRequestTo1E",enableEmfVivaT2Fetching:"enableEmfVivaT2Fetching",enableGiveControlPolicy:"enableGiveControlPolicy",enableGiveTakeControlV2:"enableGiveTakeControlV2",disableVbssStreamShownMandatoryStep:"disableVbssStreamShownMandatoryStep",disableNewCallingScenarioHoistToCore:"disableNewCallingScenarioHoistToCore",disableOutgoingVbssScenarioLatencyFix:"disableOutgoingVbssScenarioLatencyFix",enableHardwareOut:"enableHardwareOut",enableIsolatedAudioSetting:"enableIsolatedAudioSetting",enableHardwareOutPermissionPreviewTag:"enableHardwareOutPermissionPreviewTag",enableIsolatedAudioPreviewTag:"enableIsolatedAudioPreviewTag",enableHardwareOutVirtualDebugDevices:"enableHardwareOutVirtualDebugDevices",hardwareOutDebugDevice:"hardwareOutDebugDevice",enableLobbyAdmitAllScopeAll:"enableLobbyAdmitAllScopeAll",admitAllScopeAllMinSupportedSlimcoreVersion:"admitAllScopeAllMinSupportedSlimcoreVersion",enableMeetingReactions:"enableMeetingReactions",enableMutePending:"enableMutePending",enableMergeGetCallByCoordinates:"enableMergeGetCallByCoordinates",enableModernCallingForAnonUsersOnDesktop:"enableModernCallingForAnonUsersOnDesktop",enableModernCallingForAnonUsersOnWeb:"enableModernCallingForAnonUsersOnWeb",modernCallingSupportedBrowsers:"modernCallingSupportedBrowsers",enableEVUnifiedFlowForOutgoingReplaceCalls:"enableEVUnifiedFlowForOutgoingReplaceCalls",enableEVUnifiedFlowForIncomingReplaceCalls:"enableEVUnifiedFlowForIncomingReplaceCalls",enableSharingPreviewTypeCheck:"enableSharingPreviewTypeCheck",enableMohInMultiWindow:"enableMohInMultiWindow",enableNoiseSuppressionInCallUI:"enableNoiseSuppressionInCallUI",enablePluginlessTestCall:"enablePluginlessTestCall",enableRandomizeCallingProbe:"enableRandomizeCallingProbe",enableRecordPPTSharing:"enableRecordPPTSharing",enableRemoveMeetingChatAcceptBlockAfterCallJoin:"enableRemoveMeetingChatAcceptBlockAfterCallJoin",enableSceneAppsInStore:"enableSceneAppsInStore",enableSharePreviewQueryDiagnostics:"enableSharePreviewQueryDiagnostics",enableCheckAllowedSharingType:"enableCheckAllowedSharingType",enableCheckCallSharingOnCallConnected:"enableCheckCallSharingOnCallConnected",bypassParticipantsChangedEventThrottle:"bypassParticipantsChangedEventThrottle",displayChangedEventDebounceTime:"displayChangedEventDebounceTime",slideControlDestroyInjectorWhenNoActiveCalls:"slideControlDestroyInjectorWhenNoActiveCalls",bypassStartSharingPromiseTimeout:"bypassStartSharingPromiseTimeout",enableSimulateProbeCall:"enableSimulateProbeCall",enableSLABossTabs:"enableSLABossTabs",enableSLABossTabsForMW:"enableSLABossTabsForMW",enableSurvivability:"enableSurvivability",enableSurvivabilityV2:"enableSurvivabilityV2",enableTestCallForAll:"enableTestCallForAll",enableUserMeetingPolicy:"enableUserMeetingPolicy",enableVDIOcclusions:"enableVDIOcclusions",enableVDIShim2:"enableVDIShim2",enableVerboseLoggingForCallingServiceEvent:"enableVerboseLoggingForCallingServiceEvent",enableVoiceApps:"enableVoiceApps",filterCallingCDLEventsByDiffing:"filterCallingCDLEventsByDiffing",forceAVCallConsultation:"forceAVCallConsultation",forceCallingProbeToPhysicalDevices:"forceCallingProbeToPhysicalDevices",includeExchangeFilesInMru:"includeExchangeFilesInMru",isDesktopApp:"isDesktopApp",isLedApiEnabled:"isLedApiEnabled",enableVideoBackgroundForWeb:"enableVideoBackgroundForWeb",enableWebRtcWorkerForWeb:"enableWebRtcWorkerForWeb",isAudioEffectForWebEnabled:"isAudioEffectForWebEnabled",dnsWorkletURL:"dnsWorkletURL",aecWorkletURL:"aecWorkletURL",isRatingLoggingEnabledForVivaEmf:"isRatingLoggingEnabledForVivaEmf",isTflUser:"isTflUser",logCallingCDLEventDiff:"logCallingCDLEventDiff",maxPageSizeForCallingServiceEvent:"maxPageSizeForCallingServiceEvent",meetingLocationsEndpoint:"meetingLocationsEndpoint",ndiWatermarkStateOverride:"ndiWatermarkStateOverride",preJoinAutoMuteParticipantThreshold:"preJoinAutoMuteParticipantThreshold",rigelCallingProbeFrequencyInDays:"rigelCallingProbeFrequencyInDays",routeToPrejoinWhenRejoiningCall:"routeToPrejoinWhenRejoiningCall",enableCQFWithReceiveSurveysMode:"enableCQFWithReceiveSurveysMode",samplingRatesForCQF:"samplingRatesForCQF",shouldShowCQFFromSSFC:"shouldShowCQFFromSSFC",callQualityFeedbackUxStyle:"callQualityFeedbackUxStyle",testCallEnabledLCIDs:"testCallEnabledLCIDs",useNearestRecurringInstanceForMeetingInfo:"useNearestRecurringInstanceForMeetingInfo",rejoinCallWithoutPrejoinScreen:"rejoinCallWithoutPrejoinScreen",remoteVDINotifications:"remoteVDINotifications",enablePendingPresentationUrlEvents:"enablePendingPresentationUrlEvents",enableBetterTogetherDisposalAfterReload:"enableBetterTogetherDisposalAfterReload",vivaEmfSettings:"vivaEmfSettings",resolverTimeouts:"resolverTimeouts",broadcastSettings:"broadcastSettings",resumeParticipantUpdatesThrottleTime:"resumeParticipantUpdatesThrottleTime",rigel:"rigel",enableCameraSharing:"enableCameraSharing",enableMeetingRoomInfoToParticipants:"enableMeetingRoomInfoToParticipants",enableChangeRoleForParticipantNotInRoster:"enableChangeRoleForParticipantNotInRoster",enableNudgeForTownhall:"enableNudgeForTownhall",framesinkEventsThrottleInterval:"framesinkEventsThrottleInterval",nsiEventsThrottleInterval:"nsiEventsThrottleInterval",enableIsScreenSharingInCallingClientStateEvent:"enableIsScreenSharingInCallingClientStateEvent",enableContentCameraSecondStream:"enableContentCameraSecondStream",enableReactiveRendering:"enableReactiveRendering",maxIncomingVbssChannels:"maxIncomingVbssChannels",enableMultiVbssTelemetry:"enableMultiVbssTelemetry",beaconTelemetryMaxInterval:"beaconTelemetryMaxInterval",healthScenarioSettings:"healthScenarioSettings",proximitySaltUpdateTime:"proximitySaltUpdateTime",proximitySaltHistoryLength:"proximitySaltHistoryLength",proximitySaltLifetime:"proximitySaltLifetime",waitForBluetoothToStabalize:"waitForBluetoothToStabalize",enableDefaultLanguageForAutoTranscript:"enableDefaultLanguageForAutoTranscript",enableCallingStackInitErrorMessageLogging:"enableCallingStackInitErrorMessageLogging",enableMuteLobbyNotifications:"enableMuteLobbyNotifications",disableBroadcastSlimcoreDrilledDownLogging:"disableBroadcastSlimcoreDrilledDownLogging",enableAttendeeCountForPresenters:"enableAttendeeCountForPresenters",callingStageCurtainPublishStateUFDTimeoutSec:"callingStageCurtainPublishStateUFDTimeoutSec",immersiveAppCustomMessaging:"immersiveAppCustomMessaging",immersiveAppPostControlMessages:"immersiveAppPostControlMessages",immersiveAppDelayLoad:"immersiveAppDelayLoad",enableSbaOfflineTelemetry:"enableSbaOfflineTelemetry",cdrSizeForSbaOfflineTelemetry:"cdrSizeForSbaOfflineTelemetry",enableBetterTogetherLockonAppSuspend:"enableBetterTogetherLockonAppSuspend",enableUserPreferenceStoreForBetterTogether:"enableUserPreferenceStoreForBetterTogether",disableBetterTogetherProximityScan:"disableBetterTogetherProximityScan",roomRemoteScanTimeout:"roomRemoteScanTimeout",enableBetterTogetherEndpointSignature:"enableBetterTogetherEndpointSignature",enableSurvivabilityT2:"enableSurvivabilityT2",setTranscriptBotDiagnosticIntervalInMs:"setTranscriptBotDiagnosticIntervalInMs",transcriptBotDiagnosticMonitorCount:5,filterMultichannelAudioInputDevices:"filterMultichannelAudioInputDevices",shouldReadTokenApiMinPluginlessVersion:"shouldReadTokenApiMinPluginlessVersion",tokenApiMinPluginlessVersion:"tokenApiMinPluginlessVersion",ultrasoundDetectionTimeout:"ultrasoundDetectionTimeout",useAttributionServiceForCommandSending:"useAttributionServiceForCommandSending",enableInRoomTranscriptAttributions:"enableInRoomTranscriptAttributions",nativeMeetingStageConfig:"nativeMeetingStageConfig",enableMCRBotRTMPSource:"enableMCRBotRTMPSource",enabledMultiCaptionsPresentation:"enabledMultiCaptionsPresentation",mcrBotMri:"mcrBotMri",enableAutoDetectPlaceWifi:"enableAutoDetectPlaceWifi",conversationServiceUrl:"conversationServiceUrl",enableConversationSubscriptionForCallTitle:"enableConversationSubscriptionForCallTitle",enableSTMForTranscriptBotRestClient:"enableSTMForTranscriptBotRestClient",enableExtraTelemetryForUpdateCallingScenarioEventData:"enableExtraTelemetryForUpdateCallingScenarioEventData",enableNearbyRoomsFromExternalTenants:"enableNearbyRoomsFromExternalTenants",useLwjForAllCalls:"useLwjForAllCalls",disableShareTrayPreviewsCancelOperation:"disableShareTrayPreviewsCancelOperation",blockedSlimCoreVDIRemoteClients:"blockedSlimCoreVDIRemoteClients",enableSlimCoreVDIRemoteClientFilter:"enableSlimCoreVDIRemoteClientFilter",enableVDIOptimizationModeManager:"enableVDIOptimizationModeManager",enableLocalVDISessionHandling:"enableLocalVDISessionHandling",debounceTimeForVDIOptimizationModePublisher:"debounceTimeForVDIOptimizationModePublisher",enableCancelVDIModeDebounceOnMachineStateChange:"enableCancelVDIModeDebounceOnMachineStateChange",usePartChangedStrategySharingArbiter:"usePartChangedStrategySharingArbiter",iconPreviewFetchTimeoutMs:"iconPreviewFetchTimeoutMs",enableResolverLoggingForMeetingInfo:"enableResolverLoggingForMeetingInfo",enableRemoveImmersiveScreenShareLogic:"enableRemoveImmersiveScreenShareLogic",disableFetchingMeetingInfoForRetriableCalls:"disableFetchingMeetingInfoForRetriableCalls",enableRosterCountCheckForParticipantsChangedEvent:"enableRosterCountCheckForParticipantsChangedEvent"}},skypeMessagePropertyName:{meeting:{title:"meetingtitle"}},states:{appCalling:"app.calling",appCallList:"app.callList",appConversation:"app.conversation",appDeepLink:"app.deepLink",appGetUserMedia:"app.getUserMedia",appBroadcastPlaybackScreen:"app.broadcastPlaybackScreen",appBroadcastIntermediateScreen:"app.broadcastIntermediateScreen",appDeepLinkMeetingCode:"app.deepLinkMeetingCode",appModernCalling:"app.modernCalling",appVoiceAssistant:"app.voiceassistant",callingIntermediateScreen:"app.callingIntermediateScreen",postCalling:"app.postCalling",postEchoBotCall:"app.postEchoBotCall",preJoinCalling:"app.preJoinCalling",rigelConsole:"app.rigelConsole",rigelConsoleHomePage:"app.rigelConsoleHomePage",rigelConsolePreCall:"app.rigelConsolePreCall",rigelConsoleCortana:"app.rigelConsoleCortana",rigelConsolePostCall:"app.rigelConsolePostCall",rigelConsoleJoinbyCode:"app.rigelConsoleJoinbyCode",rigelConsoleBroadcast:"app.rigelConsoleBroadcast",smartDevicesHomeScreen:"app.smartDevicesHomeScreen",smartDevicesLoginScreen:"app.smartDevicesLoginScreen",smartDevicesGuestScreen:"app.smartDevicesGuestScreen",surfaceHubHomeScreen:"app.surfaceHubHomeScreen",upsellScreen:"app.upsellScreen"},statistics:{count:"count",max:"max",mean:"mean",min:"min",standardDeviation:"standardDeviation"},staticsCdnUrls:["https://res.cdn.office.net/","https://res-sdf.cdn.office.net/","https://res-gcc.cdn.office.net/","https://res-gcch.cdn.office.net/","https://res-dod.cdn.office.net/","https://res-1-cdn.azureedge.eaglex.ic.gov/","https://res-1-cdn.azureedge.microsoft.scloud/","https://res-cn.cdn.partner.office365.cn/","https://statics.teams.cdn.office.net/","https://statics.gov.teams.microsoft.us/","https://statics.dod.teams.microsoft.us/"],storageNames:{agcEnabled:"agcEnabled",automaticCameraSettingsSelected:"automaticCameraSettingsSelected",musicModeSettingsEnabled:"musicModesettingsEnabled",ignoreMirrorMyVideoSettingsSelected:"ignoreMirrorMyVideoSettingsSelected",greenScreenVideoEffectPreferenceSettingsSelected:"greenScreenVideoEffectPreferenceSettingsSelected",autoFramingVideoSettingsSelected:"autoFramingVideoSettingsSelected",isSfBDeeplinkingEnabled:"isSfBDeeplinkingEnabled",isTelProtocolHandlerRegistered:"isTelProtocolHandlerRegistered",ndiEnabled:"ndiEnabled",ndiPreviouslyEnabled:"ndiPreviouslyEnabled",ndiDisabledByUserAction:"ndiDisabledByUserAction",aplPositioningConfig:"aplPositioningConfig",isolatedAudioEnabled:"isolatedAudioEnabled",noiseSuppressionEnabled:"noiseSuppressionEnabled",noiseSuppressionMode:"noiseSuppressionMode",emfCooldownTimestamp:"emfCooldownTimestamp",pendingMeetupDeeplink:"ts.pendingMeetupDeeplink",pendingMeetupDeeplinkUsed:"ts.pendingMeetupDeeplinkUsed",transportCompanionSelected:"transportCompanionSelected",ttyEnabled:"ttyEnabled",hfmmEnabled:"hfmmEnabled",spatialAudioEnabled:"spatialAudioEnabled",eyeContactEnabled:"eyeContactEnabled",ecEnabled:"ecEnabled",stereoModeEnabled:"stereoModeEnabled",displayMusicModeInFlyout:"displayMusicModeInFlyout",enableMultiWindowV2OnDesktop:"enableMultiWindowV2OnDesktop",userEnabledMediaStackLogging:"userEnabledMediaStackLogging",adminEnabledMediaStackLogging:"adminEnabledMediaStackLogging",enablePushToTalk:"enablePushToTalk",desktopTrouterEpid:"desktopTrouterEpid",audioDeviceSyncEnabled:"audioDeviceSyncEnabled",enableCallingAccessibilitySettings:"enableCallingAccessibilitySettings",lastUsedPhysicalCameraId:"lastUsedPhysicalCameraId",rigelThemeSettings:"rigelThemeSettings",autoAdjustEnabled:"call.setAutoAdjust",touchUpEnabled:"call.setTouchUp",touchUpStrength:"call.setTouchUpStrength",userBiometricVoiceEnrollmentStatus:"userBiometricVoiceEnrollmentStatus",userBiometricVoiceEnrollments:"userBiometricVoiceEnrollments",userBiometricPassiveEnrollmentConsent:"userBiometricPassiveEnrollmentConsent",userVoiceSignature:"userVoiceSignature",userSelectedDevicesKey:"calling_user_selected_devices",mostRecentHotdeskEvent:"mostRecentHotdeskEvent"},tmpStorageKeys:{captionsAndTranscriptSpokenLanguage:"CAPTIONS_TRANSCRIPT_SPOKEN_LANGUAGE"},storageServiceKeys:{officeContactCardDialogStorageKey:"office_contact_card_dialog_shown"},vdiProviderName:{[g.none]:"None",[g.citrix]:"Citrix",[g.vmware]:"VMware",[g.avd]:"AVD",[g.aws]:"AWS",[g.windows365]:"Windows 365",[g.citrixSlimCore]:"Citrix SlimCore",[g.vmwareSlimCore]:"VMWare SlimCore",[g.avdSlimCore]:"AVD SlimCore",[g.windows365SlimCore]:"Windows 365 SlimCore",[g.awsSlimCore]:"AWS Slimcore"},vdiOptimizationMode:{webrtc:"webrtc",slimcore:"slimcore",none:"none"},RoleConstants:{Guest:"Guest"},userTypes:{guest:"Guest",skypeConsumer:"SkypeConsumer",tflUser:"TFLUser",federated:"Federated",tflConsumer:"TflConsumer",personalContactUser:"PersonalContactUser"},telemetry:{bluetoothLE:{burstScanStartFailedWithFalse:"burst_scan_start_failed_with_false",burstScanStartFailed:"burst_scan_start_failed_exception",scanStartFailedWithFalse:"scan_start_failed_with_false",scanStartFailed:"scan_start_failed_exception",radioUnavailable:"radio_unavailable"},calling:{streamType:{video:"Video",screenSharing:"ScreenSharing"},obsoleteCallCrashSessionGapMs:f},notification:{type:{audio:"audio",callSafeTransferRingback:"callSafeTransferRingback",callTransferFailed:"callTransferFailed",contentOnly:"contentOnly",shareFromChat:"shareFromChat",skypeConsumerCall:"skypeConsumerCall",tflConsumerCall:"tflConsumerCall",spamCall:"spamCall",video:"video",basicNative:"basicNative",meetingStartedNotification:"meetingStartedNotification",meetingReminderNotification:"meetingReminderNotification",audioDropInStartedNotification:"audioDropInStartedNotification"}},teamsMeetingConfiguration:{configurationGetFailed:"teams_meeting_configuration_get_failed"},surfaceHub:{meetings:{joinMeeting:"surface_hub_join_meeting",endMeeting:"surface_hub_end_meeting",sessionCleanup:"surface_hub_session_cleanup",meetingJoined:"surface_hub_meeting_joined",activeCallStopped:"surface_hub_active_call_stopped",endSessionFinished:"surface_hub_end_session_finished",meetNow:{meetNow:"surface_hub_meet_now",meetNowPlacingCall:"surface_hub_meet_now_placing_call"}}},whiteboard:{externalUser:"external_user"},premiumSKU:"premium_sku",thirdPartyDevices:{incomingRequest:"third_party_device_incoming_request",pairingRequest:"third_party_device_pairing_request",pairingResponse:"third_party_device_pairing_response",meetingUpdate:"third_party_device_meeting_update"}},tflConstants:{consumerTenantId:"9188040d-6c67-4c5b-b112-36a304b66dad"},timeInMiliseconds:{second:v.second,threeSeconds:v.threeSeconds,tenSeconds:v.tenSeconds,thirtySeconds:v.thirtySeconds,minute:v.minute,twoMinutes:2*v.minute,threeMinutes:3*v.minute,fiveMinutes:5*v.minute,tenMinutes:10*v.minute,hour:60*v.minute,day:v.day},transferorType:{delegator:"delegator",groupMember:"groupMember",teamMember:"teamMember",unknown:"unknown"},translation:{interpolationIds:{messageformat:"messageformat"}},transportTelemetryErrorCode:{transportAgentService:{callingServiceInitFailed:"CALLINGSERVICE_INIT_FAILED",slimcoreInitFailed:"SLIMCORE__INIT_FAILED",transportStackInitFailed:"TRANSPORT_STACK_INIT_FAILED",transportStackNull:"TRANSPORT_STACK_NULL",transportUserNull:"TRANSPORT_USER_NULL",invalidTransportInitialization:"INVALID_TRANSPORT_INITIALIZATION"},transportCompanionMixin:{joinedBeforeTimer:"JOINED_BEFORE_TIMER",joinedAfterTimer:"JOINED_AFTER_TIMER"},incomingCommand:{desktopIsLocked:"DESKTOP_IS_LOCKED",deviceNotPaired:"DEVICE_NOT_PAIRED",invalidSalt:"INVALID_SALT",pairedButNotConnected:"PAIRED_BUT_NOT_CONNECTED",featureDisabled:"FEATURE_DISABLED",invalidCommandRequest:"INVALID_COMMAND_REQUEST",incorrectEndpointId:"INCORRECT_ENDPOINT_ID",invalidCommand:"INVALID_COMMAND",lazyLoadFailed:"LAZYLOAD_FAILED",bluetoothNotSupported:"BLUETOOTH_NOT_SUPPORTED",bluetoothIsOff:"BLUETOOTH_IS_OFF",bluetoothInitFailed:"BLUETOOTH_INIT_FAILED",initializationFailed:"INITIALIZATION_FAILED",autoPair:{notInProximity:"NOT_IN_PROXIMITY",errorInCheckingProximity:"ERROR_IN_CHECKING_PROXIMITY"},broadcast:{notInProximity:"NOT_IN_PROXIMITY",errorInCheckingProximity:"ERROR_IN_CHECKING_PROXIMITY"},openFile:{urlIsEmpty:"URL_IS_EMPTY",deeplinkServiceError:"DEEPLINKSERVICE_ERROR"},pair:{notInProximity:"NOT_IN_PROXIMITY",errorInCheckingProximity:"ERROR_IN_CHECKING_PROXIMITY",rejectedByUser:"REJECTED_BY_USER"},replyFromDesktop:{conversationIdIsEmpty:"CONVERSATIONID_IS_EMPTY",multiwindowError:"MULTIWINDOW_ERROR",windowError:"WINDOW_ERROR"},calling:{conversationIdIsEmpty:"CONVERSATIONID_IS_EMPTY",callNotPresent:"CALL_NOT_PRESENT",deviceNotSelected:"DEVICE_NOT_SELECTED",operationFailed:"OPERATION_FAILED",BroadcastMeetingsDisabled:"BROADCAST_MEETINGS_DISABLED",PstnCallsDisabled:"PSTN_CALLS_DISABLED",machinestateislocked:"MACHINE_STATE_LOCKED",stateAlreadySet:"STATE_ALREADY_SET"},reportProblem:{serviceNotLoaded:"SERVICE_NOT_LOADED",operationFailed:"OPERATION_FAILED"},openShare:{callNotFound:"CALL_NOT_FOUND"},remoteController:{capabilityDisabled:"CAPABILITY_DISABLED"}},outgoingCommand:{featureDisabled:"FEATURE_DISABLED",endpointNotAvailable:"ENDPOINT_NOT_AVAILABLE",nullResponse:"NULL_RESPONSE",operationFailed:"OPERATION_FAILED",operationFailedOnRemoteEndpoint:"OPERATION_FAILED_ON_REMOTE_ENDPOINT",desktopIsLocked:"DESKTOP_IS_LOCKED",invalidCommand:"INVALID_COMMAND",timeoutWithAck:"TIMEOUT_WITH_ACK",timeoutWithoutAck:"TIMEOUT_WITHOUT_ACK",requestFailed:"REQUEST_FAILED",calling:{lieConversationFailed:"LIE_CONVERSATION_FAILED"},response:{nullRequestId:"NULL_REQUEST_ID",noOutgoingCommand:"NO_OUTGOING_COMMAND"}},transportack:{ackSuccess:"ACK_SUCCESS",ackFailure:"ACK_FAILURE"}},urls:{authorizedConfigurations:{type:"authorizedConfigurations",get:"/Teams.VoiceApps/users/me/authorized-configurations"},voiceSettings:{update:"/usersettings/clientPreference"},biometricEnrollment:{voiceInvitationUrl:"https://teams.microsoft.com/l/settings/recognition"},blockedContacts:{type:"blockedContacts",getBlockedContacts:"/userSettings/blocklist/",postBlockedContacts:"/userSettings/blocklist/manage"},breakoutRooms:{breakoutRoom:{type:"breakoutRoom",create:"/breakoutRoom/{meetingCoordinates}",update:"/breakoutRoom/{meetingCoordinates}",bulkUpdate:"/breakoutRoom/bulk/{meetingCoordinates}",list:"/breakoutRoom/{meetingCoordinates}",listWithDetails:"/breakoutRoom/bulk/{meetingCoordinates}",get:"/breakoutRoom/details/{meetingCoordinates}",add:"breakoutRoom/add/{meetingCoordinates}",delete:"breakoutRoom/{meetingCoordinates}",deleteAll:"breakoutRoom/rooms/all/{meetingCoordinates}",settings:"/breakoutRoom/settings/{meetingCoordinates}",open:"breakoutRoom/open/{meetingCoordinates}",close:"breakoutRoom/close/{meetingCoordinates}"}},callForwardingSettings:{type:"callForwarding",getApiPath:"/usersettings/{userId}/voicesettings",setApiPath:"/usersettings/{userId}/callredirectionsettings"},callQueue:{type:"callQueue",getApiPath:"/Teams.VoiceApps/cq-agents/{userId}",getApiPathV2:"/Teams.VoiceApps/cq-agents-v2/{userId}",putApiPath:"/Teams.VoiceApps/cq-agents/{userId}"},authorizedSettings:{callQueue:{type:"callQueue",getSummary:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}/summary",getSummaryV2:"/Teams.VoiceApps/authorized-settings-v2/callqueues/{callQueueId}/summary",putWelcomeGreeting:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}/welcome-greeting",putMusicOnHold:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}/music-on-hold",putOverflowVoicemail:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}/overflow/shared-voicemail-greeting",putTimeoutVoicemail:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}/timeout/shared-voicemail-greeting",patchSettings:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}",patchSettingsV2:"/Teams.VoiceApps/authorized-settings-v2/callqueues/{callQueueId}",uploadCallQueueAutoAttendantAudioFile:"/Teams.VoiceApps/authorized-settings/audio-files",supervisorAgentMapping:"/Teams.VoiceApps/authorized-settings/supervisor-agent-mappings?supervisorId={supervisorId}",createUpdateSupervisorAgentMapping:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}/supervisor-agent-mappings",deleteSupervisorAgentMapping:"/Teams.VoiceApps/authorized-settings/callqueues/{callQueueId}/supervisor-agent-mappings?supervisorId={supervisorId}&agentId={agentId}"},autoAttendant:{type:"autoAttendant",getSummary:"/Teams.VoiceApps/authorized-settings/auto-attendants/{autoAttendantId}/summary",getSummaryV2:"/Teams.VoiceApps/authorized-settings-v2/auto-attendants/{autoAttendantId}/summary",putCallFlowGreetings:"/Teams.VoiceApps/authorized-settings/auto-attendants/{autoAttendantId}/call-flows/{call-flow-id}/greetings",patchCallFlowGreetings:"/Teams.VoiceApps/authorized-settings/auto-attendants/{autoAttendantId}",patchSettingsV2:"/Teams.VoiceApps/authorized-settings-v2/auto-attendants/{autoAttendantId}"},callingMsGraph:{msGraphResourceDefault:"https://graph.microsoft.com",msGraphHostNameDefault:"https://graph.microsoft.com/v1.0",getUserByEmail:"/users?$filter=(mail eq '{email}')",getGroupByEmail:"/groups?$filter=(mail eq '{email}')",getUserById:"/users/{id}",getGroupEmailById:"/groups/{id}",searchUsers:"/users?$top={searchCount}&$filter=(startswith(Mail,+'{searchString}')+or+startswith(UserPrincipalName,+'{searchString}')+or+startswith(DisplayName,+'{searchString}')+or+startswith(Surname,+'{searchString}')+or+startswith(GivenName,+'{searchString}'))+and+(AccountEnabled+eq+true)&$count=true&$select=id,DisplayName,mail,jobTitle,userPrincipalName",searchGroups:"/groups?$top={searchCount}&$filter=(startswith(Mail,+'{searchString}')+or+startswith(DisplayName,+'{searchString}'))+and+(mailEnabled+eq+true)&$select=id,DisplayName,mail"}},callQueueAgentOboAccounts:{type:"callQueue",getApiPath:"/Teams.VoiceApps/obo-accounts/{userId}"},calendar:{privateEvent:{createSchedulingServiceEvent:"/me/calendarEvents/privateMeeting/schedulingService/create"}},callableChannels:{type:"callQueue",getApiPath:"/Teams.VoiceApps/agentcallqueues/{callQueueId}",getApiPathV2:"/Teams.VoiceApps/agentcallqueues-v2/{callQueueId}",getAgentStatusApiPath:"/Teams.DLX/optinsettings/callqueues/{callQueueId}",putAgentStatusApiPath:"/Teams.DLX/optinsettings/callqueues/{callQueueId}/agents/{userId}"},calling:{callerID:{type:"callerID",post:"/usersettings/blockcalleridpreference"}},checkInPlace:{apiName:"checkInPlace",endpoint:"/SchedulingService/api/v2/places/smtp:{placeMailboxID}/checkins/{eventGOID}"},meetingLocation:{apiName:"findMeetingLocations",endpoint:"/SchedulingB2/api/v1.0/me/findmeetinglocations",type:"meeting_location_retrieve",roomMaxCandidatesProperty:"MaxCandidates",conferenceRoomsOnly:"ConferenceRoomsOnly",locationProvider:"LocationProvider",queryConstraint:"QueryConstraint",query:"Query",directory:"Directory",directoryPlusRelevance:"80",fuzzyLevel:"FuzzyLevel",low:"low",high:"high"},getRoomAvailability:{endpoint:"/SchedulingB2/api/v1.0/me/getroomavailability",apiName:"getRoomAvailability"},messaging:{attachments:{getImageInlineSize:"v1/objects/{objectId}/views/imgo",getImageFullsize:"v1/objects/{objectId}/views/imgpsh_fullsize"}},roomPeripherals:{apiName:"roomPeripherals"},teamsMeetingConfiguration:{type:"teams_meeting_configuration",get:"/me/settings/meetingConfiguration",getT2:"/beta/me/settings/meetingConfiguration",getAnonymous:"/beta/meetings/meetingConfiguration"},teamsUpgradePolicyV2:{type:"teams_upgrade_policyV2",get:"/me/settings/teamsupgradev2"},whiteboardPolicy:{type:"whiteboard_policy",get:"/api/{version}/tenant/settings"},troubleShootingUrl:{windowsCameraFailure:"https://support.microsoft.com/en-us/windows/camera-doesn-t-work-in-windows-32adb016-b29c-a928-0073-53d31da0dad5",macCameraFailure:"https://support.microsoft.com/en-us/office/my-camera-isn-t-working-in-microsoft-teams-9581983b-c6f9-40e3-b0d8-122857972ade",changeRemoteDesktopConnectionAudioSetting:"https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/enhanced-session-mode#share-audio-devices-speakers-and-microphones"}},whiteboard:{invalidPropertyName:"tab::whiteboard",microsoftAppId:"95de633a-083e-42f5-b444-a4295d8e9314",mtGetUrl:"/meetings/whiteboard?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}&meetingTitle={meetingTitle}&initiatorId={initiatorId}&useWebboard={useWebboard}",mtFluidGetUrl:"/meetings/fluidboard?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}&meetingTitle={meetingTitle}",mtAnnotationGetUrl:"/meetings/annotation?threadId={threadId}&organizerId={organizerId}&tenantId={tenantId}&meetingTitle={meetingTitle}",mtAnnotationPostUrl:"/meetings/annotation?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}",mtPostUrl:"/meetings/whiteboard?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}&url={url}&shareUrl={shareUrl}",mtPostUrlV2:"/meetings/v2/whiteboard?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}",mtStaticAnnotationPostUrl:"/meetings/annotation?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}",mtStaticPostUrl:"/meetings/whiteboard?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}&url={url}&shareUrl={shareUrl}",mtStaticPostUrlV2:"/meetings/v2/whiteboard?threadId={threadId}&messageId={messageId}&organizerId={organizerId}&tenantId={tenantId}",landingUrl:"https://whiteboard.microsoft.com/meeting?iCalUid={iCalUid}&initiatorId={initiatorId}&meetingId={threadId}&messageId={messageId}&embed=1",tenantSettingsEndpoint:"api/v1.0/tenant/settings",whiteboardProtocolLauncherUriV2:"ms-whiteboard-preview:{guid}",openNativeWhiteboardShub:"open-native-whiteboard-shub"},tasks:{callConnection:"call-connection",callDuration:"call-duration"},unlockSurfaceHubMeetingUrl:"ms-callapp://autojoincall",maxAllowedTimeInMsToFetchAvatar:2e3,feedbackTimeoutInMs:3e5,defaultTimeoutInMs:18e4,defaultlocalStoreCleanUpChecksIntervalMs:6e4,defaultLocalStoreCacheExpirationDurationInSeconds:600,resolverFallbackTimoutMs:1e4,applyVideoBackgroundImageTimeoutMs:1e3,downloadVideoBackgroundImageTimeoutMs:1e4,pictureLoad:{mimeProgressivejpeg:"data:image/pjpeg;base64,"},actions:{logout:{cleanupCalling:"callingService_cleanupCalling"}},shareTray:{recentFilesLimit:12,thumbnailFetchTimeMs:7e3,thumbnailPrefetchTimeMs:3e4,scenarios:{convertToPptFiles:"convertToPptFiles"}},endCallOnUserEndpoints:{scenarios:{endCallOnUserAllEndpoints:"endCallOnUserAllEndpoints"}},addParticipantFailureCategories:{pstn:{entitlementFailure:"EntitlementFailure"},complianceRecording:{genericFailure:"ComplianceRecordingGenericFailure",e2eeJoinErrorSubCode:10562}},meetingCodes:{connectionErrorCodes:[490,496,498],invalidMeetingCodeCodes:[400,404],invalidMeetingCodeSubcodes:[5732,5751,5152],informationBarrierCodes:[403,429],informationBarrierSubCodes:[5810,5831,5842],mediaConnectivityFailureSubCodes:[301004],mediaErrorCodes:[410],notRejoinableAnonMeetingCodes:[403],notRejoinableAnonMeetingSubcodes:[0],noActiveNetworkInterfaceCodes:[496],noActiveNetworkInterfaceSubcodes:[4023],invalidSkypeTokenCode:[401]},voiceDatacollection:{mdpDataCollectionBannerDelay:16e3,minParticipantCounttoShowNotice:2},idPrefix:{bot:"28:",user:"8:orgid:"},ubarButtonIds:{video:"video-button",microphone:"microphone-button",closedCaptions:"closed-captions-button",layoutSwitch:"layout-switch-button",gallerySwitchLayout:"gallery-switch-layout-button",audienceSwitchLayout:"audience-switch-layout-button",gridSwitchLayout:"grid-switch-layout-button",frontRowSwitchLayout:"front-row-switch-layout-button",mixedGridSwitchLayout:"mixed-grid-switch-layout-button",prioritizeVideoSwithLayout:"prioritize-video-switch-layout"},kiloBitToBit:1e3,callForwardingSettings:{callGroup:{maxMemberCount:25,minCallMembersForInOrderRing:2,maxCallMembersForInOrderRing:5,callOrder:{simultaneous:"simultaneous",inOrder:"inOrder"}},favoriteTargetListMaxLength:3},voiceApp:{serviceTypes:{callQueue:"callQueue",autoAttendant:"autoAttendant"},hostName:"https://api.interfaces.records.teams.microsoft.com",apiName:{updateAutoAttendantCallFlowGreeting:"updateAutoAttendantCallFlowGreeting",updateAutoAttendantCallFlowGreetingAudioFile:"updateAutoAttendantCallFlowGreetingAudioFile",patchAutoAttendantSettingsV2:"patchAutoAttendantSettingsV2"},mwbt:{cacheName:"mwbtSupervisorAgentMapping",validMappingAlreadyExists:"AddMappingOperation_ValidMappingAlreadyExists",noExistingMappingCode:"100004"}},emergencyCallFailureErrorcodes:[511404],biometricEnrollment:{mtGetStatusUrl:"/me/voice/signature/status?locale={locale}",mtDeleteSignatureUrl:"/me/voice/signature",cmdGetStatusUrl:"/voice/enroll/status?locale={locale}",cmdGetStatusV2Url:"/v2/voice/enroll/status?enrollmentFilter=Enrolled",cmdDeleteSignatureUrl:"/unenroll",faceStatus:"/me/face/status",removeFaceEnrollment:"/me/face/unenroll",getUserVoiceSignature:"/voice/pns/signature?version={version}",biometricVoiceEnrollmentStatusQueryId:"biometric-voice-enrollment-status-query-id",enrollmentExportUrl:"/data/v2/export",insertUserPassiveEnrollmentConsentTextVersionUrl:"v3/passive/consent/enroll"},byod:{scenarios:{connectedDisplays:"connectedDisplays"}},raiseHand:{minParticipantsToShowAutoHandRaise:4,allowedLocale:"en"},interpretation:{minParticipantCountForAutoBrb:5,originalGroupId:"original",originalGroupLabel:"original"},leaveCallContexts:{immersiveEventOnHold:"immersiveEventOnHold"}},T=["TimedOut","AuthFailed","User_NotAuthorizedForVoiceApplicationAdministration","User_NotEnterpriseVoiceEnabled","CallQueue_OverflowActionTargetInvalid","CallQueue_TimeoutActionTargetUserNotEVEnabled","CallQueue_NoAgentActionTargetUserNotEVEnabled"],I="Lib/Call/NG/LanguageId",A="Lib/Call/NG/Ring",E="Lib/Call/NG/EnableLocationBasedRouting",M="Lib/Call/NG/TenantId",P="*Lib/Call/NG/ConversationServiceUrl",k="*Lib/SCT/Telemetry/TeamsDeviceId",D="*Lib/ECS/ClientType",R="*Lib/ECS/Servers/1",w="*Lib/Call/MaxNrOfVideosVisibleInUI",F="*Lib/Media/MediaLibraryLogFileEnabled",N="*Lib/PushNotifications/ProdEnvURL",O="*Lib/Call/NG/NGCallingServiceSupportsAADTokens",L="*Lib/Call/TestContextId",U="*Lib/Call/NG/ForceTrouterPushRegistration",B="*Lib/Trouter/TrouterUrl",x="*Lib/Call/NG/UdpEnabled",V="*Lib/RootTools/Logging/Appender/MaxRotations",H="*Lib/RootTools/Logging/Appender/MaxSize",G="*Lib/SCT/AriaCollectorUri",W="*Lib/Call/NG/KeyDistributionUrl",$="*Lib/Call/NG/UploadLogUrl",z="*Lib/TRAP/OverwriteDefaultOnly",q="*Lib/Call/NG/PotentialCallRequestUrl",j="*Lib/TRAP/Relay/Lync/fqdns",J="*Lib/TRAP/Relay/Skype/fqdns",Q="*Lib/TRAP/Service/tokenUrl",K="*Lib/Call/NG/UdpTransportUrl",Y="*Lib/GeoLocationAccessPrompt",Z="#microsoft.graph.bookingStaffMember",X="#microsoft.graph.bookingStaffRole",ee="#Collection(microsoft.graph.bookingWorkHours)",et="administrator",ei="#microsoft.graph.bookingService",en="#microsoft.graph.bookingSchedulingPolicy",ea="PT30M",er=2e3,eo="Attendant",es="Followup",el=1,ec=60},356075:function(e,t,i){i.d(t,{m:()=>o});var n=i(370574),a=i(725766),r=i(526260);class o extends r.s{constructor(e,t,i,n){super(),this.id=e,this.contentDto=t,this.contentSharingSession=i,this.helpers=n,this.contentMode=a.l.Unestablished}get contentType(){return this.contentDto.type}init(){this.contentSharingSessionChangedSubscription=this.contentSharingSession.changed(()=>this.contentSharingSessionChangedHandler()),this.contentSharingSessionChangedHandler(!1)}dispose(){this.contentSharingSessionChangedSubscription.dispose()}onContentSharingStatusChanged(e){return this.on("contentSharingStatusChanged",e)}onContentSharingStatusInitialized(e){return this.on("contentSharingStatusInitialized",e)}get mode(){return this.contentMode}stopSharing(e,t){return this.helpers.terminateContentSharingSession(e,this.contentSharingSession,t,this.logger)}contentSharingSessionChangedHandler(e=!0){this.contentMode==a.l.Unestablished?(this.contentSharingSession.contentSharingStatus===n.ContentSharingStatus.Presenting?this.contentMode=a.l.Presenting:this.contentSharingSession.contentSharingStatus===n.ContentSharingStatus.Viewing&&(this.contentMode=a.l.Viewing),this.event("contentSharingStatusInitialized").raise(!1)):this.contentSharingSession.contentSharingStatus===n.ContentSharingStatus.Presenting&&this.contentMode!==a.l.Presenting?(this.contentMode=a.l.Presenting,e&&this.event("contentSharingStatusChanged").raise(!1)):this.contentSharingSession.contentSharingStatus===n.ContentSharingStatus.Viewing&&this.contentMode===a.l.Presenting&&(this.contentMode=a.l.Viewing,e&&this.event("contentSharingStatusChanged").raise(!0))}}},29055:function(e,t,i){var n,a;i.d(t,{i:()=>n,y:()=>r}),(a=n||(n={}))[a.CallCreateContentSharingSessionFailed=1]="CallCreateContentSharingSessionFailed",a[a.SessionStartContentSharingFailed=2]="SessionStartContentSharingFailed",a[a.PresenterFailedToParseSharingContent=10]="PresenterFailedToParseSharingContent",a[a.SessionJoinContentSharingFailed=20]="SessionJoinContentSharingFailed",a[a.ViewerFailedToParseSharingContent=21]="ViewerFailedToParseSharingContent",a[a.SessionUpdateContentSharingParticipantStateToViewerFailed=22]="SessionUpdateContentSharingParticipantStateToViewerFailed",a[a.DtoCreationFailed=23]="DtoCreationFailed",a[a.ViewerSessionCreationFailed=24]="ViewerSessionCreationFailed",a[a.MidSessionContentSharingFailed=25]="MidSessionContentSharingFailed",a[a.AnnotationAdminPermissionInvalid=26]="AnnotationAdminPermissionInvalid",a[a.WhiteboardAdminPermissionInvalid=27]="WhiteboardAdminPermissionInvalid",a[a.RendererInitFailed=30]="RendererInitFailed",a[a.NoProviderFound=100]="NoProviderFound",a[a.Cancelled=101]="Cancelled",a[a.RecordingConsentRequiredButNotProvided=102]="RecordingConsentRequiredButNotProvided",a[a.CallIsNotConnected=103]="CallIsNotConnected",a[a.BinaryFilesNotSupported=104]="BinaryFilesNotSupported",a[a.ProviderSpecificBase=1e3]="ProviderSpecificBase";class r{constructor(e="ContentSharingError",t,i,n,a){this.name=e,this.code=t,this.message=i,this.title=n,this.cause=a}}},725766:function(e,t,i){var n,a;i.d(t,{l:()=>n}),(a=n||(n={}))[a.Unestablished=0]="Unestablished",a[a.Viewing=1]="Viewing",a[a.BrowsingPrivately=2]="BrowsingPrivately",a[a.Presenting=3]="Presenting"},417723:function(e,t,i){i.d(t,{f:()=>h});var n=i(370574),a=i(892891),r=i(29055),o=i(4512),s=i(575810),l=i(526260),c=i(945761),d=i(395250),g=i(373649);class h extends l.s{constructor(e,t,i,a,s,l,d,h,p,u,m,_=!0,S=c.Wq,C,v){super(),this.config=e,this.utilityService=t,this.callingTelemetryService=i,this.callingAlertsService=s,this.eventingService=l,this.analyticsService=d,this.retryService=h,this.contentSharingProvider=p,this.localized=u,this.helpers=m,this.promiseFactory=S,this.platformDetectService=C,this.callbacks={},this.isInitialized=!1;let f=a.newLogger("ContentSharingService");this.logger=f,this.audioLoopbackHelper=(e=>{let{config:t,deviceManagerService:i,logger:n}=e,a={isAudioLoopbackEnabled:!1};return{enableAudioLoopbackDevice:async()=>{t.isPptLiveMacLoopbackEnabled()&&!a.isAudioLoopbackEnabled&&await i?.startAudioLoopbackDevice()&&(a.isAudioLoopbackEnabled=!0,n.info("PPTLive [Mac] audioLoopbackDevice enabled"))},disableAudioLoopbackDevice:({isComputerAudioShared:e})=>{!1!==a.isAudioLoopbackEnabled&&(a.isAudioLoopbackEnabled=!1,e||(i?.stopAudioLoopbackDevice(),n.info("PPTLive [Mac] audioLoopbackDevice disabled")))}}})({deviceManagerService:v,config:this.config,logger:f}),this.errorHelper=(({localized:e,config:t})=>{let i=t=>{let{code:i,cause:n,provider:a}=t;return n instanceof r.y?Promise.reject(n):a?a.rethrow(i,n):Promise.reject({code:i,message:e.contentSharingViewerFailedToDisplay(),cause:n})};return{throwContentSharingError:i,throwPermissionInvalidErrorIfNeeded:e=>{let{provider:t,error:n,action:a}=e;return a.then(e=>e,e=>{if("Permission invalid"===e){let n=t?.getProvidedType();if("whiteboard"===n)return i({code:r.i.WhiteboardAdminPermissionInvalid,cause:e,provider:t});if("annotation"===n)return i({code:r.i.AnnotationAdminPermissionInvalid,cause:e,provider:t})}return i({code:n,cause:e,provider:t})})},throwErrorIfCallChanged:t=>{let{previousTeamsCallId:i,activeTeamsCallId:n,action:a}=t;try{if(i&&i!==n)return Promise.reject({title:e.contentSharingErrorTitle(),code:r.i.Cancelled,message:e.contentSharingViewerFailedToDisplay(),cause:"Content sharing session was started for another call"});{let e=a();return Promise.resolve(e)}}catch(e){return Promise.reject(e)}},validateProviderAbsenceError:({scenario:e,type:i})=>{let n=t.isTflUser(),a=t.isIncomingPowerPointSharingEnabled();n&&"ppt"===i&&!a&&e.incomplete({reason:`TFL user, absence of ${i} provider is expected`})}}})({localized:this.localized,config:this.config}),this.sharingContentHelper=(({utilityService:e,helpers:t,logger:i})=>{let a=i=>e.tryParseJSON(t.base64DecodeToUTF8(i));return{stringifySharingContent:e=>btoa(encodeURIComponent(JSON.stringify(e)).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))})),tryParseContentBasic:e=>new Promise((t,i)=>{let n=a(e);return n.type?t(n):i("No type found in sharing blob")}),decodePPTSharingURL:e=>{let n=[t.b64DecodeUnicode,t.base64DecodeToUTF8],a="",r=[];for(let t of n)try{a=t(e);break}catch(n){let e=t.name;r.push(n.name),i.error(`Error on decoding pptSharingUrl using ${e}`)}return{decodedPptUrl:a,errors:r}},getPPTDeeplinkSharingContent:(e,i)=>({type:"ppt",id:"",name:t.getFileNameFromObjectURL(e),url:e,siteUrl:"",contentBundleUrl:"",fileGetUrl:"",fileCommandsUrl:"",majorVersion:0,fileSize:0,source:"deepLink",exchangeMeta:void 0,correlationId:i}),sharingContentDtoFromJson:a,isOutgoingContentSharingSession:e=>[n.ContentSharingStatus.None,n.ContentSharingStatus.Connecting].includes(e),isRejoinedContentSharingSession:e=>[n.ContentSharingStatus.Connected,n.ContentSharingStatus.Presenting,n.ContentSharingStatus.Viewing].includes(e)}})({utilityService:this.utilityService,helpers:this.helpers,logger:this.logger}),this.uiHelper=(e=>{let{localized:t,logger:i,helpers:n}=e;return{getDefaultContentSharingErrorAlert:()=>({name:"ContentSharingFailed",title:t.contentSharingErrorTitle(),type:o.NK.Error,text:"",dismissable:!0}),getUnsupportedContentInMeshAlert:({title:e,text:t})=>({name:"ImmersiveViewUnsupportedContentAlert",title:e,type:o.NK.Warning,text:t,dismissable:!0}),getLayoutModeUnsupportedAlert:()=>({name:"WeatherpersonContentNotSupported",text:t.alertWeatherpersonContentNotSupported(),dismissable:!0,type:o.NK.Info}),getContentSharingStartedBIEvent:e=>({action:{gesture:g.Yk.auto,scenario:n.tryGetEnum(g.Lc.sharingContent.toString(),g.Lc,i)},module:{type:n.tryGetEnum(g.iF.other.toString(),g.iF,i),name:n.tryGetEnum(g.vR.sharePowerPointFileFromDeepLink.toString(),g.vR,i),summary:"Ppt Sharing from deepLink"},dataBag:{Source:"deepLink",DeepLinkId:e||""}})}})({localized:this.localized,helpers:this.helpers,logger:f}),this.providersHelper=(({config:e,contentSharingProvider:t})=>{let i={},n=(e,t)=>{i[e]=t},a=e=>i[e]?.();return{initializeProviders:()=>{n("ppt",()=>e.isPowerPointSharingEnabled()||e.isIncomingPowerPointSharingEnabled()?t.pptSharingProvider():void 0),n("whiteboard",()=>e.isWhiteboardViewingEnabled()||e.isWhiteboardSharingEnabled()?t.whiteboardProvider():void 0),n("extensible_app",()=>t.extensibleAppProvider()),n("annotation",()=>t.annotationProvider())},getProvider:a,getAnnotationProvider:()=>a("annotation"),cleanupProviders:()=>{i={}}}})({config:this.config,contentSharingProvider:this.contentSharingProvider}),this.autoBrbHelper=(e=>{let{config:t,logger:i,helpers:n}=e;return{createAutoBrb:async({scenario:e,error:a})=>{if(!a)return;let r=Math.random();if(t.contentSharingAutoBRBConfig().scenarioAutoBRBConfigs.some(t=>t.scenarioName===e&&r<=t.samplingRate&&t.errorSubstrings.some(e=>a.includes(e))))try{await n.createAutoBrb({title:`[Content sharing][${e}] ${a}`,categoryId:"43"}),i.info(`Auto BRB created for scenario ${e}`)}catch(t){i.error(`Failed to create auto BRB for scenario ${e}. Creation error: ${t.message}`)}else i.info(`Skipping auto BRB creation for scenario ${e} and userSample: ${r}`)}}})({config:this.config,helpers:this.helpers,logger:f}),this.contentSharingErrorAlert=this.uiHelper.getDefaultContentSharingErrorAlert(),_&&this.initializeOnAppLaunchAndReinit()}async disposeService(){this.cleanupOnAppTeardown()}isMovePrivateViewingToPPTEnabled(){return this.config.isMovePrivateViewingToPPTEnabled()}initializeOnAppLaunchAndReinit(){this.providersHelper.initializeProviders()}cleanupOnAppTeardown(){this.dispose(),this.call&&(this.call.activeContentSharingSessions=void 0),this.call=void 0,this.onContentChangedSubscription=void 0,this.callbacks={},this.providersHelper.cleanupProviders(),this.loggedTelemetry=void 0,this.unsubscribeWRSViewerApiError=void 0,this.onInitCallback=void 0,this.isInitialized=!1}init(e,t){this.loggedTelemetry=new Map,this.call&&this.call.teamsCallId===e.teamsCallId||(this.dispose(),this.call=e,this.call.activeContentSharingSessions=new Map,this.onContentChangedSubscription=this.call.on("contentSharingChanged",()=>{this.logger.info("Content changed"),this.handleAddedSessions(),this.handleRemovedSessions()})),null==this.unsubscribeWRSViewerApiError&&this.config.isPptFatalErrorHandlingEnabled()&&(this.unsubscribeWRSViewerApiError=this.eventingService.registerHandlerForExternalEvent(s.gT.events.calling.wrsViewerApiError,e=>{let{err:t,sessionId:i}=e;this.activeSessions.forEach(e=>{let n=e.session?.contentSharingSession;n?.contentSharingGuid===i&&this.handleFailure(t,n,!1)})})),this.handleAddedSessions();let i=this.utilityService.generateUUID();return this.callbacks[i]=t,this.call&&this.onInitCallback&&(this.onInitCallback(this.call),this.onInitCallback=void 0),this.eventingService.emit(s.gT.events.calling.contentSharingServiceInitialized),this.isInitialized=!0,i}hasBeenInitialized(){return this.isInitialized}get activeSessions(){return Array.from(this.call?.activeContentSharingSessions?.values()||[])}onSharingStarting(e){return this.on("onSharingStarting",e)}onSharingStartFailed(e){return this.on("onSharingStartFailed",e)}onSharingSessionCreated(e){return this.on("onSharingSessionCreated",e)}onSharingSessionDisposed(e){return this.on("onSharingSessionDisposed",e)}startPptSharingForCall(e,t,i,n){if(!t)return void i?.incomplete({reason:"PptUrlIsEmpty"});let{decodedPptUrl:a,errors:r}=this.sharingContentHelper.decodePPTSharingURL(t);if(!a)return void i?.fail({reason:"PptUrlDecodeFailed",errorName:r.join(", ")});let o=this.sharingContentHelper.getPPTDeeplinkSharingContent(a,n),s=async t=>{if(t.callId!==e.callId){this.logger.warn(`startSharingContent from deepLink aborted due to call mismacth. DeepLinkId: ${n}, targetCall: ${e.callId}, contentSharingServiceCall: ${t.callId}`),i?.incomplete({reason:"CallChanged"});return}try{i?.mark(d.ck.StartSharingContent),await this.startSharingContent(o),i?.stop({status:"Succeeded"});let e=this.uiHelper.getContentSharingStartedBIEvent(n);this.analyticsService.getAnalyticsPanelActionEventData(e).then(e=>{this.analyticsService.sendPanelAction(e)})}catch(e){i?.fail({reason:"StartSharingContentFailed",errorCode:e?.code}),this.logger.error(`startSharingContent from deepLink failed. Reason: ${e}, DeepLinkId: ${n}`)}};this.call&&this.call.callId===e.callId?(i?.mark(d.ck.CSSCallMatchTargetCall),this.logger.info(`ContentSharingService init call matches target call. DeepLinkId: ${n}`),s(this.call)):this.onInitCallback=s}startSharingContent(e,t){let i=this.call;if(!i){let e="No active call";return this.autoBrbHelper.createAutoBrb({scenario:d.RG.ContentSharingStart,error:e}),Promise.reject(e)}let n=e.type,a=this.providersHelper.getProvider(n),o=!!a?.isLayoutModeUnsupported({sharingLayoutMode:t,call:i});if(o){this.logger.info(`[startSharingContent] tried to start sharing content in unsupported layout mode ${t}. Showing UFD`);let e=this.uiHelper.getLayoutModeUnsupportedAlert();this.callingAlertsService.handleOnDemandAlert(e)}let s=this.callingTelemetryService.newContentSharingScenario(i.teamsCallId,d.RG.ContentSharingStart,void 0,n,{callId:i.callId,participantId:i.participantId}),l=this.utilityService.generateUUID();if(s.appendEventData({pptSharingPresentationUrlFlag:!1,correlationId:l,type:n}),i.checkExplicitRecordingConsent("Share")){let e="Recording consent not provided";return s.incomplete({reason:e,errorCode:r.i.RecordingConsentRequiredButNotProvided}),this.promiseFactory.reject({code:r.i.RecordingConsentRequiredButNotProvided,cause:e})}s.mark(d.ck.Begin);let c={docClickTime:new Date};if(this.callingAlertsService.dismiss(this.contentSharingErrorAlert),this.event("onSharingStarting").raise(e),!a)return s.fail({reason:`No provider for type '${n}' found`,errorCode:r.i.NoProviderFound}),this.errorHelper.throwContentSharingError({code:r.i.NoProviderFound,cause:`No provider for type '${n}' found`,provider:a});if(a.isSameSession(i,i.activeContentSharingSessions||new Map))return this.promiseFactory.resolve();let g=i.teamsCallId;return a.onContentShareStarting(e,s,i,i.callId,i.region).then(()=>this.errorHelper.throwErrorIfCallChanged({previousTeamsCallId:g,activeTeamsCallId:this.call?.teamsCallId,action:()=>a.contentShareToDto(e,s,c)})).then(e=>(s.mark(d.ck.DtoCreated),i=this.call)?(s.appendEventData({substrateId:e.substrateId}),this.errorHelper.throwErrorIfCallChanged({previousTeamsCallId:g,activeTeamsCallId:i.teamsCallId,action:async()=>{if(!i)return this.errorHelper.throwContentSharingError({code:r.i.Cancelled,cause:"Content sharing service disposed",provider:a});let{isCallConnected:t}=await this.waitTillCallIsConnected();if(!t){let e="Call is not connected";return s.appendEventData({callState:i.state}),this.autoBrbHelper.createAutoBrb({scenario:d.RG.ContentSharingStart,error:e}),this.errorHelper.throwContentSharingError({code:r.i.CallIsNotConnected,cause:e,provider:a})}return this.errorHelper.throwPermissionInvalidErrorIfNeeded({action:i.createContentSharingSession(l,this.sharingContentHelper.stringifySharingContent(e),a.dtoToSubject(e)),error:r.i.CallCreateContentSharingSessionFailed,provider:a})}})):(this.logger.warn("Content sharing service disposed - aborting content sharing ..."),this.errorHelper.throwContentSharingError({code:r.i.Cancelled,cause:"Content sharing service disposed",provider:a}))).then(e=>(s.appendEventData({correlationId:e.contentSharingGuid}),s.mark(d.ck.SessionCreated),this.logger.info(`content sharing session ${e.contentSharingGuid} has been created.`),this.loggedTelemetry?.set(l,c),this.startSessionSharing({previousTeamsCallId:g,session:e,provider:a}))).then(()=>{i=this.call,this.logger.info("created content sharing session has been started."),s.mark(d.ck.SessionStarted);let e=a.isLayoutModeShouldBeUpdated({sharingLayoutMode:t,call:i,isAPLModeUnsupported:o});i&&e&&t&&this.setSharingLayoutMode({call:i,sharingLayoutMode:t,scenario:s})}).then(()=>{s.stop(),i&&(i.isContentSharingPresenter=!0)}).catch(t=>{let i=this.utilityService.getErrorLoggingString(t);return this.logger.error(`An error occured while creating/starting content sharing session: ${i}`),this.autoBrbHelper.createAutoBrb({scenario:d.RG.ContentSharingStart,error:t.errorMessage}),this.handleStartError(t,s,a,e.type),this.promiseFactory.reject(t)})}setAnnotationSharingSource(e){let t=this.providersHelper.getAnnotationProvider();t?.setSharingSource?.(e)}disposeCallbacks(e){delete this.callbacks[e],0===(0,a.size)(this.callbacks)&&this.dispose()}dispose(){this.onContentChangedSubscription&&(this.onContentChangedSubscription.dispose(),this.onContentChangedSubscription=void 0),this.call?.activeContentSharingSessions&&(this.call.activeContentSharingSessions.forEach(e=>{e.session&&this.disposeSessionObject(e.session.id)}),this.call.activeContentSharingSessions=void 0),this.unsubscribeWRSViewerApiError&&this.unsubscribeWRSViewerApiError(),this.call=void 0,this.callbacks={}}async setSharingLayoutMode(e){let{call:t,sharingLayoutMode:i,scenario:n}=e;try{await t.setSharingLayoutMode(i),this.logger.info(`SharingLayoutMode set to "${i}" on newly created Content Sharing Session.`),n.mark(d.ck.SetSharingLayoutWeatherperson,{context:`${i}`})}catch(e){this.logger.error(`Error setting sharingLayoutMode to ${e}`)}}async waitTillCallIsConnected(){let e=this.config.callConnectionCheckIntervals(),t=()=>this.call?.state===n.CallState.Connected;if(0===e.length)return{isCallConnected:!0};try{if(!t()){let{promise:i}=await this.retryService.retry("contentSharingService::startSharingContent",async()=>!!t()||Promise.reject(`Call is not connected: callState=${this.call?.state}`),{retryIntervals:e,forever:!1});await i}}catch{return{isCallConnected:!1}}return{isCallConnected:!0}}async startSessionSharing(e){let{previousTeamsCallId:t,session:i,provider:n}=e,a=this.call;try{return await this.errorHelper.throwErrorIfCallChanged({previousTeamsCallId:t,activeTeamsCallId:a?.teamsCallId,action:()=>this.helpers.rejectIfDisconnected(a,i,()=>i.startContentSharing())})}catch(e){return this.stopContentSharing(i),this.errorHelper.throwContentSharingError({code:r.i.SessionStartContentSharingFailed,cause:e,provider:n})}}handleAddedSessions(){let{call:e,logger:t,sharingContentHelper:i}=this;e&&(t.info("Handling added sessions (if any)..."),(0,a.differenceWith)(e.contentSharingSessions,Array.from(e.activeContentSharingSessions?.keys()||[]),(e,t)=>e.contentSharingGuid===t).forEach(e=>{if(!this.isNewSessionDisabled(e)){let a=e.contentSharingStatus,r=e.contentSharingGuid;a===n.ContentSharingStatus.Ringing?(t.info(`Handling new incoming session ${r}`),this.handleNewIncomingSession(e)):i.isOutgoingContentSharingSession(a)?(t.info(`Handling new outgoing session ${r}, status=${a}`),this.handleNewOutgoingSession(e)):i.isRejoinedContentSharingSession(a)?(t.info(`Rejoining session ${r}, status=${a}`),this.handleRejoinedSession(e)):t.warn(`Ignoring session ${r} as it's in status ${a}`)}}))}isNewSessionDisabled(e){let t=this.sharingContentHelper.sharingContentDtoFromJson(e.contentSharingIdentity);if(t.type){let i=this.providersHelper.getProvider(t.type),n=this.platformDetectService.isRigel();if(i?.shouldNewSessionBeIgnored({call:this.call,isRigel:n}))return this.logger.info(`Incoming session is skipped for ${i.getProvidedType()} content. Guid: ${e.contentSharingGuid}`),!0}else this.logger.error("Invalid dto for incoming content sharing session");return!1}handleNewIncomingSession(e){let t,i;if(!this.call)return;let n=e.contentSharingGuid;this.loggedTelemetry?.set(n,{docClickTime:new Date});let a=this.callingTelemetryService.newContentSharingScenario(this.call.teamsCallId,d.RG.ContentSharingViewerJoin,n);a.appendEventData({correlationId:n,participantId:this.call.participantId,callId:this.call.callId,isCoMeCall:this.helpers.isCoMeAvailable(this.call)});let o=this.addActiveContentSharingSession(n);this.errorHelper.throwPermissionInvalidErrorIfNeeded({action:this.helpers.safeCall(e),error:r.i.SessionJoinContentSharingFailed,provider:i}).then(()=>(a.mark(d.ck.JoinedSession),this.loggedTelemetry?.set(n,{incomingSessionJoinedTime:new Date}),this.logger.info(`Successfully joined content sharing session ${n}`),this.errorHelper.throwPermissionInvalidErrorIfNeeded({action:this.sharingContentHelper.tryParseContentBasic(e.contentSharingIdentity),error:r.i.ViewerFailedToParseSharingContent,provider:i}))).then(o=>{a.mark(d.ck.DtoParsed);let s=o.type;return(t=o,i=this.providersHelper.getProvider(s),this.logger.info(`Content sharing information read for session ${n}`),a.appendEventData({type:s}),this.setSessionType(n,s),i)?(i.beforeViewerJoinsSession({audioLoopbackHelper:this.audioLoopbackHelper}),this.setSessionDetailedType(n,i.dtoToDetailedType(t)),this.errorHelper.throwPermissionInvalidErrorIfNeeded({action:this.helpers.rejectIfDisconnected(this.call,e,()=>i.startIncomingSession(t,e,this.call,a)),error:r.i.ViewerSessionCreationFailed,provider:i})):(this.logger.info(`No provider for type '${s}' found for content sharing session ${n}`),this.errorHelper.validateProviderAbsenceError({scenario:a,type:s}),this.errorHelper.throwContentSharingError({code:r.i.NoProviderFound,cause:`No provider for type '${s}' found`,provider:i}))}).then(t=>(a.mark(d.ck.SessionCreated),t.bootTelemetry=this.loggedTelemetry?.get(n),this.loggedTelemetry?.delete(n),this.setSessionObject(n,t),this.errorHelper.throwPermissionInvalidErrorIfNeeded({action:this.helpers.rejectIfDisconnected(this.call,e,()=>(i?.afterViewerJoinsSession({session:t,sessionGuid:n,callingTelemetryService:this.callingTelemetryService,logger:this.logger}),this.sessionAdded(t))),error:r.i.RendererInitFailed,provider:i}))).then(()=>(a.mark(d.ck.SessionAdded),this.logger.info(`Renderer for session ${n} successfully initialized`),this.errorHelper.throwPermissionInvalidErrorIfNeeded({action:this.helpers.rejectIfDisconnected(this.call,e,()=>{this.updateParticipantToViewer(e,a,t.type,o)}),error:r.i.SessionUpdateContentSharingParticipantStateToViewerFailed,provider:i}))).then(()=>i?.afterParticipantBecomesViewer({call:this.call})).catch(t=>{this.logger.error(`Failed to handle incoming session ${n}`);let r=i?i.processViewerSessionError(t):t;this.handleError(r,e,a,i),o.reject(r)})}async updateParticipantToViewer(e,t,i,n){let a=this.providersHelper.getProvider(i);try{await this.errorHelper.throwPermissionInvalidErrorIfNeeded({action:e.updateContentSharingParticipantStateToViewer(),error:r.i.SessionUpdateContentSharingParticipantStateToViewerFailed,provider:a}),this.logger.info(`Successfully updated participant state to viewer for content sharing session ${e.contentSharingGuid}`),n.resolve(),t.stop()}catch(i){this.logger.error(`Failed to update participant state to viewer for content sharing session ${e.contentSharingGuid}`),this.handleError(i,e,t,a),n.reject(i)}}handleStartError(e,t,i,n){let a=e?.code,o=e?.cause;if(a===r.i.Cancelled)this.logger.warn(`start content sharing session cancelled: ${a}`),t.incomplete({reason:this.utilityService.getErrorLoggingString(o||"Operation cancelled"),errorCode:a}),this.event("onSharingStartFailed").raise(e,n);else if(o?.terminatedReason){let i=this.helpers.getTerminatedReasonEventData(o,a);this.helpers.isReasonToIncomplete(o.terminatedReason,this.call)?t.incomplete(i):t.fail(i),this.displayStartError(e,n)}else if(a===r.i.BinaryFilesNotSupported)t.incomplete({reason:this.utilityService.getErrorLoggingString("Unsupported file type (binary file)"),errorCode:a}),this.displayStartErrorForBinaryFiles(e,n);else{if(i)i.handleStartError(e,t);else{let i=this.utilityService.getErrorLoggingString(e);t.fail({reason:i,errorCode:e?.code})}this.displayStartError(e,n)}}displayStartError(e,t){this.event("onSharingStartFailed").raise(e,t),this.displayContentSharingAlert(e)}displayStartErrorForBinaryFiles(e,t){this.event("onSharingStartFailed").raise(e,t),this.callingAlertsService.dismiss(this.contentSharingErrorAlert),this.contentSharingErrorAlert.title=e.title,this.contentSharingErrorAlert.text=e.message,this.contentSharingErrorAlert.dismissable=!0,this.contentSharingErrorAlert.type=o.NK.Warning,this.contentSharingErrorAlert.name="BinaryFileSelected",this.callingAlertsService.handleOnDemandAlert(this.contentSharingErrorAlert)}handleError(e,t,i,n){let a=!0,o=e?.code,s=e?.cause,l=s?.terminatedReason||e?.terminatedReason,d=t?.contentSharingGuid;if(o===r.i.Cancelled||s===c.y3)this.logger.error(`Content sharing session ${d} failed due to the operation being cancelled`),i.incomplete({reason:"Operation cancelled",errorCode:o});else if(l){this.logger.error(`Content sharing session ${d} failed with terminatedReason ${l}`);let a=this.helpers.getTerminatedReasonEventData(s||e,o,{correlationId:d,state:t?.contentSharingStatus});this.helpers.isReasonToIncomplete(l)?(i.incomplete(a),n?.shouldHandleSessionIncompletion()&&this.handleFailure(e,t,!0,!0)):(i.fail(a),this.handleFailure(e,t))}else if(n){this.logger.error(`Content sharing session ${d} failed with a provider-specific error`),a=n.handleError(e,t,i);let s=n.getProvidedType();o===r.i.WhiteboardAdminPermissionInvalid||o===r.i.AnnotationAdminPermissionInvalid?(this.logger.errorToTelemetry?.(`Content sharing session ${d} failed because the required meeting policy is not enabled for ${s}`,"ContentSharingService",void 0,!0),this.displayContentSharingAlert(e)):this.handleFailure(e,t,a)}else{let n=this.utilityService.getErrorLoggingString(s||e);this.logger.error(`Content sharing session ${d} failed with an unexpected error (code: ${n}, message: ${o})`),i.fail({reason:n,errorCode:o}),this.handleFailure(e,t)}a&&this.disposeSessionObject(d)}handleFailure(e,t,i=!0,n=!1){let r=this.helpers.isOutgoingSession(t),o=!this.call||this.helpers.isDisconnected(t,this.call),s=e?.cause;if(!this.config.isAnnotationEnabled()&&"string"==typeof s&&s.includes("No provider for type 'annotation' found"))return void this.logger.warn("Annotation is not enable in current ring");!n||r&&i?o||r&&i?(o||(this.logger.error(`Stopping an outgoing content sharing session ${t.contentSharingGuid} due to a failure`),this.stopContentSharing(t)),this.displayContentSharingAlert(e)):(0,a.forEach)(this.callbacks,i=>i.sessionError(t.contentSharingGuid,e)):(0,a.forEach)(this.callbacks,i=>i.sessionIncomplete?.(t.contentSharingGuid,e))}displayContentSharingAlert(e){this.callingAlertsService.dismiss(this.contentSharingErrorAlert),this.contentSharingErrorAlert.title=e.title,this.contentSharingErrorAlert.text=e.message,this.callingAlertsService.handleOnDemandAlert(this.contentSharingErrorAlert)}sessionAdded(e){e.ring=this.config.getRingId();let t=this.providersHelper.getProvider(e.contentType);if(this.call?.isImmersiveViewActive&&t&&!t.isContentSupportedInMesh()){let e=this.localized.extensibleAppShareIgnoredTitle?.(),t=this.localized.extensibleAppShareIgnoredText?.();if(e&&t){let i=this.uiHelper.getUnsupportedContentInMeshAlert({title:e,text:t});this.callingAlertsService.handleOnDemandAlert(i)}}return(0,a.size)(this.callbacks)?this.promiseFactory.all((0,a.map)(this.callbacks,t=>t.sessionAdded(e))):this.promiseFactory.reject(c.y3)}handleNewOutgoingSession(e){this.handleNewPresenterSession(e,d.RG.ContentSharingPresenterJoin)}handleRejoinedSession(e){this.loggedTelemetry?.set(e.contentSharingGuid,{docClickTime:new Date}),this.handleNewPresenterSession(e,d.RG.ContentSharingRejoin)}handleNewPresenterSession(e,t){let i,a,o,{helpers:l,errorHelper:c,logger:g}=this;if(!this.call)return;let h=e.contentSharingGuid,p=this.call.teamsCallId,u=this.addActiveContentSharingSession(h),m=this.callingTelemetryService.newContentSharingScenario(this.call.teamsCallId,t,h);m.appendEventData({correlationId:h,participantId:this.call.participantId,callId:this.call.callId,isCoMeCall:l.isCoMeAvailable(this.call)}),c.throwPermissionInvalidErrorIfNeeded({action:this.sharingContentHelper.tryParseContentBasic(e.contentSharingIdentity),error:r.i.PresenterFailedToParseSharingContent,provider:a}).then(n=>{m.mark(d.ck.DtoParsed);let o=n.type;return(i=n,a=this.providersHelper.getProvider(o),g.info(`Content sharing information read for session ${h}`),m.appendEventData({type:o}),this.setSessionType(h,o),a)?(this.setSessionDetailedType(h,a.dtoToDetailedType(i)),c.throwErrorIfCallChanged({previousTeamsCallId:p,activeTeamsCallId:this.call?.teamsCallId,action:()=>this.helpers.rejectIfDisconnected(this.call,e,()=>{if(this.call)if(t===s.gT.scenarios.contentSharing.presenterJoin)return a?.startOutgoingSession(i,e,this.call,m);else return a?.startIncomingSession(i,e,this.call,m)})})):(g.info(`No provider for type '${o}' found for content sharing session ${h}`),c.validateProviderAbsenceError({scenario:m,type:o}),c.throwContentSharingError({code:r.i.NoProviderFound,cause:`No provider for type '${o}' found`,provider:a}))}).then(e=>(m.mark(d.ck.SessionCreated),this.callingAlertsService.dismiss(this.contentSharingErrorAlert),(o=e).bootTelemetry=this.loggedTelemetry?.get(h),this.loggedTelemetry?.delete(h),this.setSessionObject(h,o),c.throwErrorIfCallChanged({previousTeamsCallId:p,activeTeamsCallId:this.call?.teamsCallId,action:()=>c.throwPermissionInvalidErrorIfNeeded({action:this.sessionAdded(o),error:r.i.RendererInitFailed,provider:a})}))).then(()=>{g.info(`Renderer successfully initialized for session ${h}`),a?.afterPresenterJoinsSession({audioLoopbackHelper:this.audioLoopbackHelper}),this.callingAlertsService.dismiss(this.contentSharingErrorAlert),m.mark(d.ck.SessionAdded),e.contentSharingStatus!==n.ContentSharingStatus.Connected?(g.info(`Content sharing session rejoin successfully completed for session ${h}`),u.resolve(),m.stop()):this.updateParticipantToViewer(e,m,i.type,u)}).catch(t=>{g.error(`Failed to join outgoing/rejoin content sharing session ${h}`),this.handleError(t,e,m,a),u.reject(t)})}handleRemovedSessions(){this.call&&(this.logger.info("Handling removed sessions (if any) ..."),(0,a.differenceWith)(Array.from(this.call.activeContentSharingSessions?.keys()||[]),this.call.contentSharingSessions,(e,t)=>t.contentSharingGuid===e).forEach(e=>{let t=this.call?.activeContentSharingSessions?.get(e);if(t?.type){let e=this.providersHelper.getProvider(t.type);e?.onSessionRemoved({call:this.call})}this.logger.info(`Removing session ${e} from active sessions ...`),this.removeActiveContentSharingSession(e),t?.readyPromise.finally(()=>{let i=this.callingTelemetryService.newContentSharingScenario(this.call?.teamsCallId||0,d.RG.ContentSharingSessionStopped,e);i.appendEventData({callId:this.call?.callId,participantId:this.call?.participantId,type:t?.type}),(0,a.forEach)(this.callbacks,t=>t.sessionRemoved(e)),this.logger.info(`Session ${e} removed from active sessions`),i.stop()})}),this.logger.info("Handling removed sessions complete"))}addActiveContentSharingSession(e){let t=this.promiseFactory.createDeferred(),i={readyPromise:t.promise};return this.call?.activeContentSharingSessions?.set(e,i),t}setSessionType(e,t){let i=this.call?.activeContentSharingSessions?.get(e);if(!i)return void this.logger.error(`Trying to set type for session ${e} that doesn't exist`);i.type=t}setSessionDetailedType(e,t){let i=this.call?.activeContentSharingSessions?.get(e);if(!i)return void this.logger.error(`Trying to set detailed type for session ${e} that doesn't exist`);i.detailedType=t}setSessionObject(e,t){let i=this.call?.activeContentSharingSessions?.get(e);if(!i)return void this.logger.error(`Trying to set object for session ${e} that doesn't exist`);i.session=t,this.event("onSharingSessionCreated").raise(t)}disposeSessionObject(e){let t=this.call?.activeContentSharingSessions?.get(e);if(!t)return void this.logger.error(`Trying to dispose object for session ${e} that doesn't exist`);let i=t.session;if(i){let n=this.providersHelper.getProvider(i.contentType);if(n){let e=this.activeSessions.filter(({session:e})=>e?.contentType===n.getProvidedType()).length;n.onSessionDisposed({audioLoopbackHelper:this.audioLoopbackHelper,numberOfActiveSessions:e,call:this.call})}i.dispose(),this.helpers.objectLeaksDetectorTrack("pptSharingSession",i,{enableAlerting:!0}),this.event("onSharingSessionDisposed").raise(e),t.session=void 0}}removeActiveContentSharingSession(e){this.disposeSessionObject(e),this.call?.activeContentSharingSessions?.delete(e)}stopContentSharing(e){if(!this.call)return;let t=this.callingTelemetryService.newContentSharingScenario(this.call.teamsCallId,d.RG.ContentSharingStop,e.contentSharingGuid);t.appendEventData({context:"termination_on_error"}),this.helpers.terminateContentSharingSession(this.call,e,t,this.logger)}}},195250:function(e,t,i){i.d(t,{i:()=>I,N:()=>A});var n,a,r,o,s,l,c,d,g=i(370574),h=i(892891),p=i(4512),u=i(356075),m=i(725766),_=i(575810),S=i(945761),C=i(807362),v=i(373649),f=i(401786);class b{constructor(e,t){this.eventingService=e,this.loggingService=t,this.logger=t.newLogger("pptSharingEventFilter"),this.eventingService=e}init(){this.subscribeToPptSharingSessionChangedEvent(),this.subscribeToHidControllerAttachedEvents()}isPresentingStatusChange(e,t){return e===g.ContentSharingStatus.Presenting&&t!==m.l.Presenting||e!==g.ContentSharingStatus.Presenting&&t===m.l.Presenting}syncPptSharingStatus(e){let t;e===g.ContentSharingStatus.Presenting?(this.logger.info("ppt is in presenting status, sync the button context to vendor defined"),t=f.n0.pptLiveActive):(this.logger.info("ppt is not in presenting status, sync the button context to default"),t=f.n0.pptLiveInactive),this.eventingService.emit(_.gT.events.calling.buttonContextSwitchEvent,t)}subscribeToPptSharingSessionChangedEvent(){this.eventingService.registerHandlerForExternalEvent(_.gT.events.calling.pptSharingSessionChanged,({contentSharingStatus:e,contentMode:t})=>{this.logger.info(`on pptSharingSessionChanged ${e} ${t}`),this.currentContentSharingStatus=e,this.isPresentingStatusChange(e,t)&&this.syncPptSharingStatus(this.currentContentSharingStatus)})}subscribeToHidControllerAttachedEvents(){this.eventingService.registerHandlerForExternalEvent(_.gT.events.calling.hidControllerAttached,()=>this.syncPptSharingStatus(this.currentContentSharingStatus))}}var y=i(866301),T=i(395250);(n=s||(s={}))[n.Audio=0]="Audio",n[n.Video=1]="Video",n[n.MsStream=2]="MsStream",n[n.Youtube=3]="Youtube",n[n.Vimeo=4]="Vimeo",n[n.Flipgrid=5]="Flipgrid",n[n.Ted=6]="Ted",n[n.MediaLink_Other=7]="MediaLink_Other",(a=l||(l={})).RGBA="RGBA",a.BGRA="BGRA",a.NV12="NV12",(r=c||(c={}))[r.Normal=0]="Normal",r[r.Removed=1]="Removed",r[r.Blur=2]="Blur",r[r.Custom=3]="Custom",(o=d||(d={}))[o.GetSlidesInShowCount=0]="GetSlidesInShowCount",o[o.GetTimeLineInfos=1]="GetTimeLineInfos",o[o.GetCurrentPosition=2]="GetCurrentPosition",o[o.GetId=3]="GetId",o[o.GetPresentationName=4]="GetPresentationName",o[o.OnPositionChanged=5]="OnPositionChanged",o[o.OnPresentationOpened=6]="OnPresentationOpened",o[o.GetCurrentSlideDimensions=7]="GetCurrentSlideDimensions",o[o.OnMediaEvent=9]="OnMediaEvent",o[o.GetCurrentMediaStates=10]="GetCurrentMediaStates",o[o.OnError=11]="OnError",o[o.OnSpecialKey=12]="OnSpecialKey",o[o.OnApiError=13]="OnApiError",o[o.OnUlsLog=14]="OnUlsLog",o[o.GetCurrentPlayModeState_Unused=15]="GetCurrentPlayModeState_Unused",o[o.GetPresentationPlaybackState=16]="GetPresentationPlaybackState",o[o.OnPresentationPlaybackStateChanged=17]="OnPresentationPlaybackStateChanged",o[o.OnBrowserEvent=18]="OnBrowserEvent",o[o.OnEnterEndOfSlideshow=19]="OnEnterEndOfSlideshow",o[o.OnLeaveEndOfSlideshow=20]="OnLeaveEndOfSlideshow",o[o.ContentRefreshBegin=21]="ContentRefreshBegin",o[o.ContentRefreshEnd=22]="ContentRefreshEnd",o[o.OnExitSlideshow=23]="OnExitSlideshow",o[o.GoToPresenter=25]="GoToPresenter",o[o.TogglePrivateViewing=47]="TogglePrivateViewing",o[o.OnSlideViewBoundsChanged=48]="OnSlideViewBoundsChanged",o[o.AadTokenRequest=49]="AadTokenRequest",o[o.StartCoach=50]="StartCoach",o[o.StopCoach=51]="StopCoach",o[o.CheckCoachStatus=52]="CheckCoachStatus",o[o.ShowWeatherperson=55]="ShowWeatherperson",o[o.PasteFileLinktoChat=60]="PasteFileLinktoChat",o[o.CopyFileLinktoClipboard=61]="CopyFileLinktoClipboard",o[o.CameoDetectedInPresentation=66]="CameoDetectedInPresentation",o[o.CameoFrameRequestForSlide=67]="CameoFrameRequestForSlide",o[o.RenderingModeChangedToSVG=68]="RenderingModeChangedToSVG",o[o.TakeControl=72]="TakeControl",o[o.GetPPTDomainURL=74]="GetPPTDomainURL";class I extends u.m{constructor(e,t,i,n,a,r=S.Wq,o,s,l,c,d,g,h,p,u,m){super(t,i,n,m),this.id=t,this.contentDto=i,this.contentSharingSession=n,this.call=a,this.promiseFactory=r,this.utilityService=s,this.callingTelemetryService=l,this.privateViewingEnabledFlag=c,this.callingAlertsService=d,this.peopleService=g,this.eventingService=h,this.localized=u,this.helper=m,this.globalSlide={slideIndex:0,timeLineMappings:[]},this.presentationUrlEvent={presentationUrl:""},this.isPresentationUrlReady=!1,this.isPresentationUrlReadyCallbackRaised=!1,this.mediaStates=[],this.disablePrivateViewingOfPptConsuming=!1,this.enableWrsMediaEventHandling=!1,this.enablePresentationUrlContentModeFix=!1,this.enablePptMediaPlaybackStateCaching=!1,this.enablePPTCameoAutoEnterEnhancement=!1,this.isTakingControl=!1,this.pendingSessionSlideChangeRequests=[],this.disablePrivateViewingUFD=!1,this.contentSharingStateIsInitialized=!1,this.cameoState={cameoDetectedInCurrentSlide:!1,cameoDetectedInPresentation:!1,hasAutoEnteredCameo:!1,shouldAutoEnterCameo:!0},this.logger=o.newLogger("pptsharingSession"),this.disablePrivateViewingOfPptConsuming=e.disablePrivateViewingOfPptConsuming(),this.enableStructuredMeetingsSettingsConsumption=e.enableStructuredMeetingsSettingsConsumption(),this.enableWrsMediaEventHandling=e.enableWrsMediaEventHandling(),this.disablePrivateViewingUFD=p.isRigel(),this.enablePresentationUrlContentModeFix=e.enablePresentationUrlContentModeFix(),this.enablePptMediaPlaybackStateCaching=e.enablePptMediaPlaybackStateCaching(),this.enablePPTCameoAutoEnterEnhancement=!!e.enablePPTCameoAutoEnterEnhancement&&e.enablePPTCameoAutoEnterEnhancement(),this.pptSharingEventFilter=new b(this.eventingService,o),this.pptSharingEventFilter.init(),this.init()}get slide(){return this.localSlide||this.globalSlide}get sessionSlide(){return this.globalSlide}get initialSlide(){return this.contentMode!==m.l.BrowsingPrivately?(this.localSlide=void 0,this.globalSlide):this.slide}get mediaPlaybackState(){return this.mediaStates}get privateViewingEnabled(){return this.privateViewingEnabledFlag}get sessionTelemetry(){return null}get presentationUrl(){return this.presentationUrlEvent.presentationUrl}set presentationUrlReadyCallbackRaised(e){this.isPresentationUrlReadyCallbackRaised=e}get presentationUrlReadyCallbackRaised(){return this.isPresentationUrlReadyCallbackRaised}takeControl(e){if(this.isTakingControl=!0,this.call.isMovePrivateViewingToPPTEnabled){let t=void 0!==e;t?this.localSlide=e:this.logger.error("isMovePrivateViewingToPPTEnabled:true but no position was passed into takeControl");let i={isMovePrivateViewingToPPTEnabled:this.call.isMovePrivateViewingToPPTEnabled,localSlide:this.localSlide,positionProvided:t};this.event("sessionTelemetryEvent").raise({statName:"takeControlWithPosition",data:i})}return this.helper.rejectIfDisconnected(this.call,this.contentSharingSession,()=>this.contentSharingSession.takeContentSharingControl()).then(()=>{this.disposeAlertsAndSubscriptions(),this.call.togglePrivateViewing(!0,this.privateViewingEnabled)&&this.showPrivateViewingChangedAfterControlTakenUFD(this.privateViewingEnabled),this.isTakingControl=!1}).catch(e=>(e&&e.terminatedReason===g.TerminatedReason.NoPermission&&this.eventingService.emit(_.gT.events.calling.actionFailedWithInsufficientMeetingRole,{titleAction:this.localized.callingErrorActionNotAllowedTitleActionTakeControl(),textAction:this.localized.callingErrorActionNotAllowedActionTakeControl()}),this.isTakingControl=!1,Promise.reject(e)))}isCreatingAsPresenter(){let e=[g.ContentSharingStatus.None,g.ContentSharingStatus.Connecting];return(0,h.includes)(e,this.contentSharingSession.contentSharingStatus)}updatePresentationUrl(e,t){this.logger.info(`PresentationUrl changed. (PresentationUrl length: ${e.presentationUrl.length})`),(this.contentMode===m.l.Presenting||this.enablePresentationUrlContentModeFix)&&(e.telemetryMetadata&&(e.telemetryMetadata.Teams_PresentationUrl_Event_Notified_IC3=Date.now()),this.logger.info(`Sending presentationUrl update to the session wrsuuid: ${t}.`),this.sendSessionUpdate({slide:this.slide,presentationUrlEvent:e,wrsuuid:t})),this.presentationUrlEvent=e}getMediaStartTimestamp(e){let t=0;return e&&void 0!==e.PPT_ModernSS_Emit_Media&&(t=parseInt(e.PPT_ModernSS_Emit_Media.toString(),10)),t}updateMediaPlaybackState(e){if(this.contentMode===m.l.Presenting){let t=this.mediaStates;if(0===t.length||-1===t.findIndex(t=>t.playerName===e.playerName))this.mediaStates.push({playerName:e.playerName,playing:e.eventType===C.Zn.MediaPlayed,position:e.position?e.position:0,volume:e.volume?e.volume:-1,timestamp:this.getMediaStartTimestamp(e.metadata)});else{let i=t.findIndex(t=>t.playerName===e.playerName);this.mediaStates[i]={playerName:e.playerName,playing:e.eventType===C.Zn.MediaPlayed||e.eventType===C.Zn.MediaSeeked&&this.mediaStates[i].playing,position:e.position?e.position:0,volume:e.volume?e.volume:-1,timestamp:this.getMediaStartTimestamp(e.metadata)}}}}resetMediaPlaybackState(){this.contentMode===m.l.Presenting&&this.mediaStates&&this.mediaStates.length>0&&(this.mediaStates=[])}wrsMediaEventUpdate(e,t){this.enableWrsMediaEventHandling&&(this.logger.info(`New MediaEvent: playerName:${e.playerName}; type:${e.eventType}; postion:${e.position}; volume:${e.volume}; contentMode:${this.contentMode}`),this.contentMode===m.l.Presenting&&(e.metadata?e.metadata.Teams_Media_Event_Notified_IC3=Date.now():this.logger.info("wrsMediaEventUpdate: metadata is null"),this.enablePptMediaPlaybackStateCaching&&this.updateMediaPlaybackState(e),this.sendSessionUpdate({slide:this.slide,mediaEvent:e,wrsuuid:t,mediaStates:this.mediaStates})))}wrsSlideChanged(e,t,i=!1){let n=this.pendingSessionSlideChangeRequests.some(t=>t.slideIndex==e.slideIndex);if(!this.call.isMovePrivateViewingToPPTEnabled&&(this.logger.info(`Viewer position changed to ${e.slideIndex}`),this.contentMode==m.l.BrowsingPrivately&&e.slideIndex==this.globalSlide.slideIndex&&i&&(this.contentMode=m.l.Viewing,this.event("contentSharingStatusChanged").raise(!1)),n?(this.logger.info(`Looks like the change to slide ${e.slideIndex} was requested based on a remote change notification`),this.pendingSessionSlideChangeRequests.splice(0,this.pendingSessionSlideChangeRequests.findIndex(({slideIndex:t})=>t==e.slideIndex)+1)):this.contentMode!=m.l.Viewing||this.areSlidesEqual(this.globalSlide,e)||i||(this.contentMode=m.l.BrowsingPrivately,this.event("contentSharingStatusChanged").raise(!1))),!n&&this.contentMode==m.l.Presenting&&(!this.localSlide||!this.areSlidesEqual(this.localSlide,e))){let i=!0;e.metadata&&(e.metadata.shouldPreventBroadcast&&(i=!1),e.metadata.Teams_Notified_IC3=Date.now()),i&&(this.enablePptMediaPlaybackStateCaching&&this.resetMediaPlaybackState(),this.sendSessionUpdate({slide:e,wrsuuid:t,mediaStates:this.mediaStates}),this.globalSlide=e)}this.localSlide=e}onSlideIndexChanged(e){return this.on("slideIndexChanged",e)}onEnablePrivateViewingToggled(e){return this.on("privateViewingToggled",e)}onWrsViewerApiChanged(e){return this.on("wrsViewerApiChanged",e)}onMediaStateChanged(e){return this.on("mediaStateChanged",e)}onSessionTelemetryEvent(e){return this.on("sessionTelemetryEvent",e)}onPresentationUrlChanged(e){return this.on("presentationUrlChanged",e)}raisePendingPresentationUrlEvent(){let e=this.pendingPresentationUrlReadyEvent;e&&(this.logger.info(`Raising pending presentationUrl event. PresentationUrl length: ${e.presentationUrlEvent.presentationUrl.length}`),this.event("presentationUrlChanged").raise(e.presentationUrlEvent,e.isPresentationUrlReadyEvent))}get pendingPresentationUrlReadyEvent(){if(!this.presentationUrlReadyCallbackRaised&&this.isPresentationUrlReady)return{presentationUrlEvent:this.presentationUrlEvent,isPresentationUrlReadyEvent:this.isPresentationUrlReady}}areSlidesEqual(e,t){return e.slideIndex===t.slideIndex&&(!!((0,h.isEmpty)(e.timeLineMappings)&&(0,h.isEmpty)(t.timeLineMappings)||this.isInitialAnimation(e.timeLineMappings)&&this.isInitialAnimation(t.timeLineMappings))||(e.timeLineMappings&&t.timeLineMappings?(0,h.isEqual)(e.timeLineMappings.map(this.getSimpleMapping),t.timeLineMappings.map(this.getSimpleMapping)):(0,h.isEqual)(e.timeLineMappings,t.timeLineMappings)))}isInitialAnimation(e){return(0,h.isEmpty)(e)||1===e.length&&!e[0].Step}getSimpleMapping({Step:e,TimeLineId:t}){return{Step:e,TimeLineId:t}}get wrsViewerApi(){return this.viewerApi}set wrsViewerApi(e){this.viewerApi=e;let t=function(e){let t={[d.OnPositionChanged]:t=>{var i;e.wrsSlideChanged({slideIndex:(i=t).SlideIndex,timeLineMappings:i.TimeLineMappings?[...i.TimeLineMappings]:void 0,metadata:i.Metadata},e.wrsuuid)}};return i=>{let n=t[i.EventType];n?n(i):e.logger.info(`Unhandled viewer event type: ${i.EventType}`)}}(this.createPPTViewerEventHandlerContext());this.viewerApi.RegisterEventHandler(t),this.event("wrsViewerApiChanged").raise(e)}createPPTViewerEventHandlerContext(){let e=this;return{get isPresenting(){return e.contentMode===m.l.Presenting},get localSlide(){return e.localSlide},get sessionSlide(){return e.globalSlide},get logger(){return e.logger},get wrsApi(){return e.viewerApi},get wrsuuid(){return e.id},wrsSlideChanged:this.wrsSlideChanged.bind(this)}}contentSharingSessionChangedHandler(e=!0){let t,i=!1;if(this.contentSharingSession.contentSharingState){let n=this.callingTelemetryService.newContentSharingScenario(this.call.teamsCallId,T.RG.ContentSharingStateUpdated,this.id,this.contentType,{status:`${this.contentSharingSession.contentSharingStatus}`,userRole:this.contentMode,participantId:this.call?.participantId||"",callId:this.call?.callId||""});try{t=this.utilityService.tryParseJSON(this.contentSharingSession.contentSharingState),n.appendEventData({context:t.stateId});let a={slideIndex:0,timeLineMappings:[],metadata:{}};t&&t.slideIndex&&(a.slideIndex=t.slideIndex),t&&t.timeLineMappings&&t.timeLineMappings.length&&(a.timeLineMappings=t.timeLineMappings),this.enablePptMediaPlaybackStateCaching&&!e&&t&&t.mediaStates&&(this.mediaStates=t.mediaStates);let r=t.metadata;if(t)if(t.requestingParticipantId===this.call.participantId&&this.localSlide)this.logger.info(`Ignoring update ${t.stateId} as it was requested locally`),r&&(r.Teams_Event_Roundtripped=Date.now(),this.event("sessionTelemetryEvent").raise({statName:"presenterRT",data:r})),n.incomplete({reason:"Ignoring state change requested locally",commandId:t.stateId});else{if(i=!0,n.appendEventData({commandId:t.stateId}),this.logger.info(`Processing update ${t.stateId}`),r){a.metadata=r;let e=this.wrsViewerApi?"Teams_Local_IC3_Optimized":"Teams_Local_IC3";a.metadata[e]=Date.now()}this.areSlidesEqual(a,this.globalSlide)?t.mediaEvent&&e?(t.mediaEvent.metadata&&(t.mediaEvent.metadata.Teams_Media_Event_Roundtripped=Date.now()),this.event("mediaStateChanged").raise(t.mediaEvent)):n.incomplete({reason:"New slide is equal to the current one"}):(this.globalSlide=a,this.call.isMovePrivateViewingToPPTEnabled||this.contentSharingSession.contentSharingStatus===g.ContentSharingStatus.Presenting&&this.contentMode!==m.l.Presenting||this.pendingSessionSlideChangeRequests.push(a),e&&this.applySlideStateUpdate(a),n.stop()),t.presentationUrlEvent&&this.presentationUrlEvent.presentationUrl!=t.presentationUrlEvent.presentationUrl?t.requestingParticipantId===this.call.participantId?(this.logger.info(`Ignoring presentationUrl update ${t.stateId} as it was requested locally`),this.presentationUrlEvent=t.presentationUrlEvent):e?(0==this.presentationUrlEvent.presentationUrl.length&&t.presentationUrlEvent.presentationUrl.length>0&&(this.logger.info("Setting isPresentationUrlReady true as presentationUrl is being set first time"),this.isPresentationUrlReady=!0),this.presentationUrlEvent=t.presentationUrlEvent,t.presentationUrlEvent.telemetryMetadata&&(t.presentationUrlEvent.telemetryMetadata.Teams_PresentationUrl_Event_Roundtripped=Date.now()),this.logger.info(`Raising presentationUrl changed event for update ${t.stateId}. PresentationUrl length: ${t.presentationUrlEvent.presentationUrl.length}`),this.event("presentationUrlChanged").raise(t.presentationUrlEvent,this.isPresentationUrlReady)):(this.logger.info(`Only setting the session's presentationUrl and not raising changed event for update ${t.stateId}. PresentationUrl length: ${t.presentationUrlEvent.presentationUrl.length}`),this.presentationUrlEvent=t.presentationUrlEvent):t.presentationUrlEvent&&this.logger.info(`Ignoring presentationUrl update ${t.stateId} as it was equal to session's presentationUrl. Session presentationUrl length: ${this.presentationUrlEvent.presentationUrl.length}`)}else{let e="Unable to parse content sharing state";this.logger.error(e),n.fail({reason:e})}}catch(e){if(e.terminatedReason)n.fail({terminatedReason:e.terminatedReason,reason:e.errorMessage&&e.errorMessage.endCode?e.errorMessage.endCode.phrase:e.errorMessage,errorCode:e.terminatedReasonCode,errorReason:e.terminatedReasonSubCode}),this.logger.error(`Handling session state update failed: ${e.errorMessage} (terminatedReason: ${e.terminatedReason}`);else{let t=this.utilityService.getErrorLoggingString(e);this.logger.error(`Handling session state update failed unexpectedly, reason=${t}`),n.fail({reason:t})}}}if(this.eventingService.emit(_.gT.events.calling.pptSharingSessionChanged,{contentSharingStatus:this.contentSharingSession.contentSharingStatus,contentMode:this.contentMode}),this.contentSharingSession.contentSharingStatus===g.ContentSharingStatus.Viewing&&this.contentMode===m.l.Presenting?this.handleControlTakenAway():this.contentSharingSession.contentSharingStatus===g.ContentSharingStatus.Presenting&&this.contentMode!==m.l.Presenting&&(this.localSlide&&!this.areSlidesEqual(this.globalSlide,this.localSlide)&&(this.sendSessionUpdate({slide:this.localSlide}),this.globalSlide=this.localSlide),this.isTakingControl||this.call.privateViewingEnabled===this.privateViewingEnabledFlag||(this.logger.info(`PPTSharingSession Updating PrivateViewing from ${this.call.privateViewingEnabled} to ${this.privateViewingEnabledFlag}`),this.call.togglePrivateViewing(!0,this.privateViewingEnabledFlag)),(this.call.isPPTWeatherpersonEnabled||this.call.isPPTCameoEnabled)&&this.call.sharingLayoutMode&&this.contentSharingStateIsInitialized&&(this.enablePPTCameoAutoEnterEnhancement&&this.call.sharingLayoutMode!==y.E.Cameo&&this.call.isPPTCameoEnabled&&this.call.isCameoPresenterEnabled&&this.cameoState.shouldAutoEnterCameo&&this.cameoState.cameoDetectedInCurrentSlide?(this.logger.info("contentSharingSessionChangedHandler - Auto-entering cameo on takeControl"),this.call.setSharingLayoutMode(y.E.Cameo),this.cameoState.hasAutoEnteredCameo=!0):this.call.setSharingLayoutMode(this.call.sharingLayoutMode))),super.contentSharingSessionChangedHandler(e),i&&this.disablePrivateViewingOfPptConsuming&&!(0,h.isNil)(t.privateViewingEnabled)&&this.privateViewingEnabledFlag!==t.privateViewingEnabled){this.privateViewingEnabledFlag=t.privateViewingEnabled;let e=[m.l.Viewing,m.l.BrowsingPrivately];this.contentSharingStateIsInitialized&&(0,h.includes)(e,this.mode)&&!this.disablePrivateViewingUFD&&this.showPrivateViewingChangedViewerUFD(this.privateViewingEnabledFlag);let{privateViewingEnabled:i}=t;this.logger.info(`PPTSharingSession Raise PrivateViewingToggled: dto:${i};
          privateViewingFlag: ${this.privateViewingEnabledFlag};`),this.event("privateViewingToggled").raise(this.privateViewingEnabledFlag,t.stateId,this.contentSharingStateIsInitialized),this.mode===m.l.Presenting&&this.call.togglePrivateViewing(!0,this.privateViewingEnabledFlag)}this.contentSharingSession.contentSharingState&&(this.contentSharingStateIsInitialized=!0)}applySlideStateUpdate(e){this.wrsViewerApi?this.wrsViewerApi.GoToSlide(e.slideIndex,e.timeLineMappings,e.metadata):this.event("slideIndexChanged").raise(e)}handleControlTakenAway(){let e=(0,h.first)(this.call.participants.filter(e=>e.contentSharingRole===g.ParticipantContentSharingRole.Presenter).map(e=>e.id));if(e)this.peopleService.getPeopleProfile(e,"pptSharingSession").then(e=>{this.showControlTakenAwayUfd(e.displayName)});else{let e=this.localized.userHasTakenControlDefaultUserName();this.showControlTakenAwayUfd(e)}}showControlTakenAwayUfd(e){this.controlTakenAwayAlert&&this.callingAlertsService.dismiss(this.controlTakenAwayAlert),this.controlTakenAwayAlert={name:"PptSharingStolen",type:this.callingAlertsService.showNewCriticalUFDDesign()?p.NK.Warning:p.NK.Info,title:this.localized.controlTakenAwayAlertTitle(),text:this.localized.controlTakenAwayAlertText(e),dismissable:!0},this.controlTakenAwayAlert.actions=this.enableStructuredMeetingsSettingsConsumption&&this.call&&"attendee"===this.call.meetingRole?[]:[{alertActionType:"TakePptSharingControl",buttonText:this.localized.controlTakenAwayButtonText(),command:this.takeControl.bind(this),buttonTrackName:v.vR.pptTakeControl}],this.callingAlertsService.handleOnDemandAlert(this.controlTakenAwayAlert),this.enableStructuredMeetingsSettingsConsumption&&this.call&&"attendee"!==this.call.meetingRole&&!this.meetingRoleChangedSubscription&&(this.meetingRoleChangedSubscription=this.call.onMeetingRoleChanged(()=>{"attendee"===this.call.meetingRole&&(this.callingAlertsService.dismiss(this.controlTakenAwayAlert),this.meetingRoleChangedSubscription&&this.meetingRoleChangedSubscription.dispose(),this.meetingRoleChangedSubscription=null)}))}showPrivateViewingChangePresenterUfd(){let e=this.privateViewingEnabled?this.localized.callingPptSharingPrivateViewingSuccessTitleEnabled():this.localized.callingPptSharingPrivateViewingSuccessTitleDisabled(),t=this.privateViewingEnabled?this.localized.callingPptSharingPrivateViewingSuccessBodyEnabled():this.localized.callingPptSharingPrivateViewingSuccessBodyDisabled();this.showPrivateViewingUfd("PptPrivateViewingSuccessful",e,t)}showPrivateViewingFailedUfd(){let e=this.localized.callingPptSharingPrivateViewingErrorTitle(),t=this.privateViewingEnabled?this.localized.callingPptSharingPrivateViewingErrorEnabled():this.localized.callingPptSharingPrivateViewingErrorDisabled();this.showPrivateViewingUfd("PptPrivateViewingFailed",e,t)}showPrivateViewingChangedViewerUFD(e){e?this.showPrivateViewingUfd("PptPrivateViewing",this.localized.callingPptSharingPrivateViewingEnabledAlertTitle(),this.localized.callingPptSharingPrivateViewingEnabledAlertBody()):this.showPrivateViewingUfd("PptPrivateViewing",this.localized.callingPptSharingPrivateViewingDisabledAlertTitle(),this.localized.callingPptSharingPrivateViewingDisabledAlertBody())}showPrivateViewingChangedAfterControlTakenUFD(e){this.showPrivateViewingUfd("PptPrivateViewing",e?this.localized.callingPptSharingPrivateViewingControlTakenAlertTitleEnabled():this.localized.callingPptSharingPrivateViewingControlTakenAlertTitleDisabled(),this.localized.callingPptSharingPrivateViewingControlTakenAlertBody())}showPrivateViewingUfd(e,t,i){this.privateViewingAlert&&this.callingAlertsService.dismiss(this.privateViewingAlert),this.privateViewingAlert={name:e,type:this.callingAlertsService.showNewCriticalUFDDesign()?p.NK.Warning:p.NK.Info,title:this.localized.privateViewingAlertTitle(t),text:this.localized.privateViewingAlertText(i),dismissable:!0},this.callingAlertsService.handleOnDemandAlert(this.privateViewingAlert)}sendSessionUpdate(e){let t=this.utilityService.generateUUID(),i={stateId:t,requestingParticipantId:this.call.participantId,slideIndex:e.slide.slideIndex,timeLineMappings:e.slide.timeLineMappings,privateViewingEnabled:this.privateViewingEnabledFlag,mediaEvent:e.mediaEvent,presentationUrlEvent:e.presentationUrlEvent||this.presentationUrlEvent,metadata:e.slide.metadata,mediaStates:e.mediaStates},n=this.callingTelemetryService.newContentSharingScenario(this.call.teamsCallId,T.RG.PptSharingPresenterSessionUpdate,this.id,this.contentType,{contextId:e.wrsuuid,commandId:t,participantId:this.call?.participantId||"",callId:this.call?.callId||""});i.metadata&&(i.metadata.PresenterId=i.requestingParticipantId,i.metadata.StateId=i.stateId);let a=[],r=this.promiseFactory.create((e,a)=>this.helper.rejectIfDisconnected(this.call,this.contentSharingSession,()=>this.contentSharingSession.updateContentSharingSessionState(t,JSON.stringify(i))).then(()=>{this.logger.info(`Slide update ${t} sent successfully`),n.stop(),e()},e=>{let i=this.utilityService.getErrorLoggingString(e);if(this.logger.error(`Sending slide change update ${t} failed due to an error: ${i}`),e&&e.terminatedReason){let t=this.helper.getTerminatedReasonEventData(e);this.helper.isReasonToIncomplete(e.terminatedReason)||412===e.terminatedReasonCode?n.incomplete(t):n.fail(t)}else n.fail({reason:i});a(e)}));return a.push(r),this.promiseFactory.all(a)}toggleEnablePrivateViewing(){let e=this.utilityService.generateUUID(),t=(0,h.join)((0,h.map)((0,h.union)((0,h.filter)(this.call.endpoints.endpointDetails,e=>e.endpointId!=this.call.endpointId),(0,h.flatten)((0,h.map)(this.call.participants,e=>e.endpoints.endpointDetails))),e=>e.endpointId),";"),i=this.callingTelemetryService.newContentSharingScenario(this.call.teamsCallId,T.RG.PptSharingPresenterChangedEnablePrivateView,this.id,this.contentType,{commandId:e,otherEndpointIds:t,participantId:this.call?.participantId||"",callId:this.call?.callId||""}),n=!this.privateViewingEnabledFlag,a={stateId:e,requestingParticipantId:this.call.participantId,slideIndex:this.slide.slideIndex,timeLineMappings:this.slide.timeLineMappings,privateViewingEnabled:n},r=[],o=this.promiseFactory.create((t,r)=>{this.helper.rejectIfDisconnected(this.call,this.contentSharingSession,()=>this.contentSharingSession.updateContentSharingSessionState(e,JSON.stringify(a))).then(()=>{this.privateViewingEnabledFlag=n,this.logger.info(`Private viewing change to ${n?'"enabled"':'"disabled"'} sent successfully`),i.stop(),this.showPrivateViewingChangePresenterUfd(),t()},e=>{let t=this.utilityService.getErrorLoggingString(e);if(this.logger.error(`Private viewing change to ${n?'"enabled"':'"disabled"'} failed due to an unexpected error: ${t}`),e&&e.terminatedReason){let t=this.helper.getTerminatedReasonEventData(e);this.helper.isReasonToIncomplete(e.terminatedReason,this.call)?i.incomplete(t):(i.fail(t),this.showPrivateViewingFailedUfd())}else i.fail({reason:t}),this.showPrivateViewingFailedUfd();r(e)})}).finally(()=>{this.call.togglePrivateViewing(!0,this.privateViewingEnabledFlag)});return r.push(o),this.promiseFactory.all(r).then(()=>{})}translateWrsCode(e){switch(e){case C.N7.InvalidInputParameters:case C.N7.RegionNotSupported:case C.N7.MissingFileGetUrlAndBundleUrl:case C.N7.CannotOpenDocument:case C.N7.CantOpenDocument:return{title:this.localized.callingContentSharing.ErrorTitleCannotPresent(),message:this.localized.callingContentSharing.ErrorMessageUnableToPresent()};case C.N7.UnsupportedFileTypeDetectedInBootstrapper:return{title:this.localized.callingContentSharing.ErrorTitleCannotPresent(),message:this.localized.callingContentSharing.ErrorMessageFileFormatNotSupported()};case C.N7.UnsupportedModernSlideShowPlatforms:return{title:this.localized.callingContentSharing.ErrorTitleCannotPresent(),message:this.localized.callingContentSharing.ErrorMessageTeamsOutOfDate()};case C.N7.UnsupportedModernSlideShowBrowsers:return{title:this.localized.callingContentSharing.ErrorTitleCannotPresent(),message:this.localized.callingContentSharing.ErrorMessageBrowserOutOfDate()};case C.N7.CantOpenDocumentFileType:case C.N7.CantComposeSlideParse:case C.N7.GenericSlideCorruption:case C.N7.EditSlideCorruption:case C.N7.CannotOpenDocumentStgDocFileCorrupt:case C.N7.CannotOpenDocumentMmcfPackagePartNotFound:case C.N7.CannotOpenDocumentArchiveError:case C.N7.ErrorCannotOpenFileMetroFileCorruption:case C.N7.ErrorCannotOpenFileXmlError:return{title:this.localized.callingContentSharing.ErrorTitleCorruptedFile(),message:this.localized.callingContentSharing.ErrorMessageCorruptedFile()};case C.N7.CantOpenDocumentPassword:case C.N7.CannotOpenODPDocumentPassword:return{title:this.localized.callingContentSharing.ErrorTitlePasswordProtected(),message:this.localized.callingContentSharing.ErrorMessagePasswordProtected()};case C.N7.CantOpenDocumentSigned:return{title:this.localized.callingContentSharing.ErrorTitleSignedDocument(),message:this.localized.callingContentSharing.ErrorMessageSignedDocument()};case C.N7.CantOpenDocumentMacro:return{title:this.localized.callingContentSharing.ErrorTitleUnsupportedMacros(),message:this.localized.callingContentSharing.ErrorMessageUnsupportedMacros()};case C.N7.CantInstallFonts:case C.N7.CantOpenEmbeddedFonts:return{title:this.localized.callingContentSharing.ErrorTitleUnsupportedFonts(),message:this.localized.callingContentSharing.ErrorMessageUnsupportedFonts()};case C.N7.CantOpenDocumentIRM:case C.N7.DownloadStatusCodeUnauthorized:case C.N7.DownloadStatusCodeForbidden:return{title:this.localized.callingContentSharing.ErrorTitleEncryptedFile(),message:this.localized.callingContentSharing.ErrorMessageEncryptedFile()};case C.N7.CannotOpenDocumentStgZeroByteFile:return{title:this.localized.callingContentSharing.ErrorTitleEmptyFile(),message:this.localized.callingContentSharing.ErrorMessageEmptyFile()};case C.N7.CannotOpenDocumentTooLarge:return{title:this.localized.callingContentSharing.ErrorTitleFileTooBig(),message:this.localized.callingContentSharing.ErrorMessageFileTooBig()};case C.N7.CannotOpenDocumentWrongExt:return{title:this.localized.callingContentSharing.ErrorTitleDocumentWrongExt(),message:this.localized.callingContentSharing.ErrorMessageDocumentWrongExt()};case C.N7.ToggledOff:return{title:"",message:""};default:return{title:this.localized.callingContentSharing.ErrorTitle(),message:this.localized.callingContentSharing.ErrorMessageViewerFailedToDisplay()}}}disposeAlertsAndSubscriptions(){this.controlTakenAwayAlert&&(this.callingAlertsService.dismiss(this.controlTakenAwayAlert),this.controlTakenAwayAlert=null),this.privateViewingAlert&&(this.callingAlertsService.dismiss(this.privateViewingAlert),this.privateViewingAlert=null),this.meetingRoleChangedSubscription&&(this.meetingRoleChangedSubscription.dispose(),this.meetingRoleChangedSubscription=null)}dispose(){this.disposeAlertsAndSubscriptions(),super.dispose()}}class A{constructor(e,t=S.Wq,i,n,a,r,o,s,l,c,d){this.config=e,this.promiseFactory=t,this.loggingService=i,this.utilityService=n,this.callingTelemetryService=a,this.callingAlertsService=r,this.peopleService=o,this.eventingService=s,this.platformDetectService=l,this.localized=c,this.helper=d}createSession(e,t,i,n){return new I(this.config,e,t,i,n,this.promiseFactory,this.loggingService,this.utilityService,this.callingTelemetryService,null!=t.disablePrivatePreview?!t.disablePrivatePreview:this.config.enablePrivateViewing(n),this.callingAlertsService,this.peopleService,this.eventingService,this.platformDetectService,this.localized,this.helper)}}},807362:function(e,t,i){var n,a,r,o,s,l;i.d(t,{N7:()=>r,Zn:()=>n}),(o=n||(n={}))[o.MediaPaused=0]="MediaPaused",o[o.MediaPlayed=1]="MediaPlayed",o[o.MediaStopped=2]="MediaStopped",o[o.MediaSeeked=3]="MediaSeeked",o[o.MediaVolumeChanged=4]="MediaVolumeChanged",(s=a||(a={}))[s.Attendee=0]="Attendee",s[s.Presenter=1]="Presenter",s[s.PrivateViewing=2]="PrivateViewing",(l=r||(r={}))[l.ToggledOff=0]="ToggledOff",l[l.InvalidInputParameters=1]="InvalidInputParameters",l[l.UnsupportedFileTypeDetectedInBootstrapper=4]="UnsupportedFileTypeDetectedInBootstrapper",l[l.RegionNotSupported=8]="RegionNotSupported",l[l.MissingFileGetUrlAndBundleUrl=10]="MissingFileGetUrlAndBundleUrl",l[l.UnsupportedModernSlideShowPlatforms=12]="UnsupportedModernSlideShowPlatforms",l[l.UnsupportedModernSlideShowBrowsers=13]="UnsupportedModernSlideShowBrowsers",l[l.BootstrapperLoadFailure=4e6]="BootstrapperLoadFailure",l[l.ComponentLoadTimeout=4000001]="ComponentLoadTimeout",l[l.CannotOpenDocument=5308422]="CannotOpenDocument",l[l.CantOpenDocumentFileType=5341186]="CantOpenDocumentFileType",l[l.CantOpenDocument=5341189]="CantOpenDocument",l[l.CantComposeSlideParse=5341192]="CantComposeSlideParse",l[l.GenericSlideCorruption=5341196]="GenericSlideCorruption",l[l.EditSlideCorruption=5341227]="EditSlideCorruption",l[l.CannotOpenDocumentWrongExt=5341260]="CannotOpenDocumentWrongExt",l[l.CannotOpenDocumentStgDocFileCorrupt=5341261]="CannotOpenDocumentStgDocFileCorrupt",l[l.CannotOpenDocumentMmcfPackagePartNotFound=5341263]="CannotOpenDocumentMmcfPackagePartNotFound",l[l.CannotOpenDocumentArchiveError=5341264]="CannotOpenDocumentArchiveError",l[l.ErrorCannotOpenFileMetroFileCorruption=5341440]="ErrorCannotOpenFileMetroFileCorruption",l[l.ErrorCannotOpenFileXmlError=5341441]="ErrorCannotOpenFileXmlError",l[l.CantOpenDocumentPassword=5341188]="CantOpenDocumentPassword",l[l.CantOpenDocumentSigned=5341219]="CantOpenDocumentSigned",l[l.CannotOpenODPDocumentPassword=5341239]="CannotOpenODPDocumentPassword",l[l.CantOpenDocumentMacro=5341217]="CantOpenDocumentMacro",l[l.CantInstallFonts=5341190]="CantInstallFonts",l[l.CantOpenEmbeddedFonts=5341220]="CantOpenEmbeddedFonts",l[l.CantOpenDocumentIRM=5341187]="CantOpenDocumentIRM",l[l.CannotOpenDocumentStgZeroByteFile=5341338]="CannotOpenDocumentStgZeroByteFile",l[l.CannotOpenDocumentTooLarge=5341301]="CannotOpenDocumentTooLarge",l[l.DownloadNotFound=5341412]="DownloadNotFound",l[l.DownloadStatusCodeUnauthorized=5341414]="DownloadStatusCodeUnauthorized",l[l.DownloadStatusCodeForbidden=5341415]="DownloadStatusCodeForbidden",l[l.DownloadStatusCodeNotFound=5341417]="DownloadStatusCodeNotFound"},672194:function(e,t,i){i.d(t,{O:()=>r});var n=i(370574),a=i(29055);class r{constructor(e){this.localized=e}translateError(e,t){let i;if(t&&t.terminatedReason===n.TerminatedReason.NoPermission)return{title:this.localized.callingErrorNotAllowedTitle(),message:this.localized.callingErrorNotAllowed()};let r=this.localized.callingContentSharingErrorTitle();switch(e){case a.i.CallCreateContentSharingSessionFailed:case a.i.SessionStartContentSharingFailed:case a.i.PresenterFailedToParseSharingContent:case a.i.DtoCreationFailed:i=this.localized.callingContentSharingPresenterGenericError();break;case a.i.SessionJoinContentSharingFailed:case a.i.RendererInitFailed:i=this.localized.callingContentSharingViewerFailedToDisplay();break;case a.i.SessionUpdateContentSharingParticipantStateToViewerFailed:i=this.localized.callingContentSharingViewerCannotUpdateStatus();break;case a.i.ViewerFailedToParseSharingContent:i=this.localized.calilngContentSharingViewerHasNoAccess();break;case a.i.AnnotationAdminPermissionInvalid:i=this.localized.callingContentSharingDisabledByAdmin?.(),r=this.localized.callingContentSharingAnnotationErrorTitle?.();break;case a.i.WhiteboardAdminPermissionInvalid:i=this.localized.callingContentSharingDisabledByAdmin?.(),r=this.localized.callingContentSharingWhiteboardErrorTitle?.();break;default:i=this.localized.callingContentSharingViewerFailedToDisplay()}return{message:i,title:r}}getErrorToLog(e){return e?.cause||e}}},275147:function(e,t,i){i.d(t,{I:()=>o,K:()=>a});var n,a,r=i(29055);class o{constructor(e,t,i,n,a){this.errorMessage=e,this.httpResponseCode=t,this.contextId=i,this.internalErrorCode=n,this.isExpected=a}}(n=a||(a={}))[n.FailedToFetchFromFileRedeemService=r.i.ProviderSpecificBase+7]="FailedToFetchFromFileRedeemService",n[n.BinaryFilesNotSupported=r.i.BinaryFilesNotSupported]="BinaryFilesNotSupported"},488965:function(e,t,i){i.d(t,{K:()=>c});var n=i(672194),a=i(575810),r=i(945761),o=i(395250),s=i(275147),l=i(866301);class c extends n.O{constructor(e,t,i,n,a=r.Wq,o,s){super(e),this.localized=e,this.helpers=t,this.loggingService=i,this.pptSharingSessionFactory=n,this.promiseFactory=a,this.pptSharingProviderConfig=o,this.utilityService=s,this.logger=i.newLogger("PPTSharingProvider")}getProvidedType(){return"ppt"}dtoToDetailedType(e){return"ppt"}getShareContent(e){return this.promiseFactory.resolve([])}isSameSession(e,t){return!1}onContentShareStarting(e,t,i){return t.appendEventData({selectedType:e.source}),this.helpers.onContentSharingStarting(e,t)}contentShareToDto(e,t,i){return this.getPptSharingContentDto(e,t).then(e=>(e.telemetry&&i&&Object.keys(e.telemetry).forEach(t=>{i[t]=e.telemetry[t]}),e.data&&i&&i.docClickTime&&(e.data.presenterStartTime=i.docClickTime.getTime(),e.data.timeFromPresenterStartToAttendee=new Date().getTime()-i.docClickTime.getTime()),e.data))}dtoToSubject(e){return e.name}startOutgoingSession(e,t,i,n){return n&&n.appendEventData({pptSharingPresentationUrlFlag:e.isPresentationUrlEnabledForPresenter}),this.startSession(e,t,i)}startIncomingSession(e,t,i,n){if(!i)throw Error("No active call when starting PPT incoming session");return n&&n.appendEventData({pptSharingPresentationUrlFlag:e.isPresentationUrlEnabledForPresenter}),this.startSession(e,t,i)}handleStartError(e,t){if(e&&e.cause instanceof s.I){let i={reason:e.cause.errorMessage,errorCode:e.code,contextId:e.cause.contextId,terminatedReason:e.cause.httpResponseCode,failureType:e.cause.internalErrorCode};e.cause.internalErrorCode===a.gT.errorCodes.networkOffline?(this.logger.error(`cannot start content sharing session: ${e.cause.internalErrorCode}`),t.incomplete(i)):e.cause.isExpected?(this.logger.error(`cannot start content sharing session: ${e.cause.internalErrorCode}, isExpected: ${e.cause.isExpected}`),t.incomplete(i)):(this.logger.error(`cannot start content sharing session: ${e&&e.code} (${e.cause.httpResponseCode})`),t.fail(i))}else this.logger.error(`cannot start content sharing session: ${e&&e.code}`),t.fail({reason:this.utilityService.getErrorLoggingString(e&&e.cause||e),errorCode:e&&e.code})}handleError(e,t,i){return i.fail({reason:this.utilityService.getErrorLoggingString(e&&e.cause||e),errorCode:e&&e.code,correlationId:t&&t.contentSharingGuid,state:t&&t.contentSharingStatus}),!0}rethrow(e,t){let{message:i,title:n}=this.translateError(e,t);return this.promiseFactory.reject({code:e,message:i,title:n,cause:t})}getPptSharingContentDto(e,t){t&&t.mark(o.ck.SpoFetchStart);let i=new Date;return this.helpers.redeemFileDetails(e,t).catch(e=>(this.logger.error(`Failed to fetch from file redeem service: ${this.utilityService.getErrorLoggingString(e)}`),this.promiseFactory.reject(this.createContentSharingError(this.helpers.getPPTFileError(e),s.K.FailedToFetchFromFileRedeemService)))).then(n=>{this.logger.log("pptSharingProvider: redeemFile call from filesRedeemService succeeded");let a=this.pptSharingProviderConfig?.unsupportedFileTypesInPptLive();if(this.pptSharingProviderConfig?.enablePptLiveErrorMessageImprovements()&&n){let e=n.webDavUrl;if(e){let t=this.getFileExtensionFromUrl(e);if(t&&a&&a.includes(t))return this.logger.error(`${t} file extension is not supported`),this.promiseFactory.reject(this.createContentSharingErrorForBinaryFiles(this.helpers.getPPTFileError(`${t} file extension is not supported`),s.K.BinaryFilesNotSupported))}}let r=new Date,l=this.checkDriveItemProps(n);if(l.length>0){let e=JSON.stringify(l);return this.logger.error(`Required params missing from redeem call response: ${e}`),this.promiseFactory.reject(this.createContentSharingError(this.helpers.getPPTFileError(`redeemFile: Required params missing in the response: ${e}`),s.K.FailedToFetchFromFileRedeemService))}t&&t.mark(o.ck.RedeemCallFinished);let c=this.pptSharingProviderConfig?.enablePPTLiveUniqueDocIdFix()??!1,d=this.pptSharingProviderConfig?.enableEnterpriseFontsForPPTLive()??!1,g=this.pptSharingProviderConfig?.pptBootstrapperUrl(),h=this.pptSharingProviderConfig?.enableHardcodedBootstrapperUrl()??!1,p=n.openWith.wac.bootstrapperUrl;return h&&g&&(p=g),{data:{type:e.type,id:c?this.createUniqueDocumentId(n,e.id):e.id,name:e.name,url:e.url,fileGetUrl:n["@content.downloadUrl"]||n.downloadUrl,customFontCatalogUrl:d?n.openWith.wac.customFontCatalogUrl:void 0,majorVersion:Math.floor(n&&n.officeBundle&&parseFloat(n.officeBundle.version)||1),fileSize:n.size,etag:n.eTag,siteId:n.sharepointIds.siteId||"",listItemUniqueId:n.sharepointIds.listItemUniqueId||"",substrateId:n.sharepointIds.substrateId||"",wacUrl:n.openWith.wac.applicationUrl,webUrl:n.webUrl,bootstrapperUrl:p,source:e.source,correlationId:e.correlationId,contentBundleUrl:"dummy-url",isPresentationUrlEnabledForPresenter:!1,disablePrivatePreview:e.disablePrivatePreview},telemetry:{driveItemRequestStartTime:i,driveItemRequestEndTime:r,spoApiCallsCount:1}}})}shouldNewSessionBeIgnored(){return!1}beforeViewerJoinsSession({audioLoopbackHelper:e}){e.enableAudioLoopbackDevice()}afterPresenterJoinsSession({audioLoopbackHelper:e}){e.enableAudioLoopbackDevice()}afterViewerJoinsSession(){}afterParticipantBecomesViewer(){}onSessionRemoved(){}onSessionDisposed({audioLoopbackHelper:e,numberOfActiveSessions:t,call:i}){1===t&&e.disableAudioLoopbackDevice({isComputerAudioShared:!!i?.getIsSystemAudioShared()})}shouldHandleSessionIncompletion(){return!0}processViewerSessionError(e){return e}isLayoutModeUnsupported({sharingLayoutMode:e,call:t}){return!!e&&(e===l.E.Weatherperson&&!t?.isPPTWeatherpersonEnabled||(e===l.E.SideBySide||e===l.E.NewsAnchor)&&!t?.isPPTSbSAndReporterEnabled)}isLayoutModeShouldBeUpdated({sharingLayoutMode:e,call:t,isAPLModeUnsupported:i}){return e===l.E.ContentOnly?!!t?.isPPTWeatherpersonEnabled:!i}isContentSupportedInMesh(){return!1}translateError(e,t){return super.translateError(e,t)}checkDriveItemProps(e){if(!e)return["driveItem"];let t={downloadUrl:!e["@content.downloadUrl"]&&!e.downloadUrl,openWith:!e.openWith,openWithWac:!(e.openWith&&e.openWith.wac),applicationUrl:!(e.openWith&&e.openWith.wac&&e.openWith.wac.applicationUrl),bootstrapperUrl:!(e.openWith&&e.openWith.wac&&e.openWith.wac.bootstrapperUrl)};return Object.keys(t).filter(e=>!!t[e])}createUniqueDocumentId(e,t){let i=e?.sharepointIds?.siteId,n=e?.sharepointIds?.listId,a=e?.sharepointIds?.listItemUniqueId;return i&&n&&a?i.concat("_",n,"_",a):(this.logger.error("Falling back to default contentId"),t)}createContentSharingError(e,t){let{message:i,title:n}=this.translateError(t);return{name:"ContentSharingError",code:t,message:i,title:n,cause:e}}createContentSharingErrorForBinaryFiles(e,t){let i=this.localized?.callingContentSharingForBinaryFilesTitle?.()??this.localized?.callingContentSharingErrorTitle();return{name:"ContentSharingError",code:t,message:this.localized?.callingContentSharingForBinaryFiles?.(this.pptSharingProviderConfig?.binaryFilesLearnMoreLink())??this.localized?.callingContentSharingPresenterGenericError(),title:i,cause:e}}startSession(e,t,i){return this.helpers.tryPrefetchForPPTSharing(e),this.pptSharingSessionFactory.createSession(t.contentSharingGuid,e,t,i)}getFileExtensionFromUrl(e){try{let{pathname:t,hostname:i}=new URL(e),n=t.split("/").pop();n&&""!==n||(n=i);let a=n.split(".");return a.length>1?a.pop()??null:null}catch(e){return null}}}},175337:function(e,t,i){i.d(t,{R:()=>n});class n{}n.Type_Conversation="conversation",n.Type_List="list",n.Type_Resolve="resolve"},319712:function(e,t,i){i.d(t,{h:()=>o});var n=i(453988),a=i(945761),r=i(370574);class o{constructor(e,t,i,n=a.Wq,r,o){this.config=e,this.deviceManagerService=t,this.stopGreenScreen=i,this.promiseFactory=n,this.logger=r,this.desktopUtilityService=o,this.hasBackgroundEffect=!1}get persistentVideoBackgroundEnabled(){return this.config.isPersistentVideoBackgroundEnabled()}async applyBackgroundEffects(e,t,i,a,o,s,l,c){if(!e)return this.logger.warn("No imageId provided for applyBackgroundEffects."),Promise.resolve();this.logger.info(`applyBackgroundEffects with imageId: ${e}, context: ${i}`);let d=this.promiseFactory.createDeferred();a||(this.cachedImage=void 0);let g=!1===o||void 0;this.deviceManagerService.setPreviewOpenInRightSidePanel(g,t),this.hasBackgroundEffect=e!==n.eF;let h=async e=>{await this.stopGreenScreen(),this.setBackgroundImage(i,e,d,a,o,g)};switch(e){case n.eF:h(r.VideoEffectType.Off);break;case n.Wm:h(r.VideoEffectType.BackgroundBlurDefault);break;case n.PG:h(r.VideoEffectType.Bokeh);break;default:let p=t||a?.previousImage?.path;this.cachedImage={path:p,imageOrigin:this.toImageOrigin(c,s),imageType:".jpg"},a&&!this.persistentVideoBackgroundEnabled?a.setBackground(r.VideoEffectType.BackgroundReplacement,i,this.cachedImage).then(()=>this.onSetBackgroundSuccess("call.setBackground",d)).catch(e=>{this.config.isVideoBackgroundUserUploadEnabled?.()&&this.desktopUtilityService?.isSlimcoreOptimizedVDI()?h(r.VideoEffectType.BackgroundBlurDefault):this.onSetBackgroundFailure("call.setBackground",d,e)}):this.deviceManagerService.setBackgroundImageOnDevice(this.cachedImage.path,r.VideoEffectType.BackgroundReplacement,i,".jpg",this.cachedImage.imageOrigin,o,g,e,l).then(()=>this.onSetBackgroundSuccess("setBackgroundImageOnDevice",d)).catch(e=>{this.config.isVideoBackgroundUserUploadEnabled?.()&&this.desktopUtilityService?.isSlimcoreOptimizedVDI()?h(r.VideoEffectType.BackgroundBlurDefault):this.onSetBackgroundFailure("setBackgroundImageOnDevice",d,e)})}return a&&(!this.persistentVideoBackgroundEnabled&&o||this.persistentVideoBackgroundEnabled&&!o?a.previousImage={id:e,path:t}:this.persistentVideoBackgroundEnabled&&o&&(a.previousImage=null)),d.promise}getCachedEffect(e){return e?e.getCacheEffect():this.hasBackgroundEffect&&this.cachedImage?r.VideoEffectType.BackgroundReplacement:r.VideoEffectType.BackgroundBlurDefault}setBackgroundImage(e,t,i,n,a,r){this.logger.info(`setBackgroundImage with context: ${e}, videoEffectType: ${t}, persistEffect: ${a}, fromPreviewButton: ${r}`),n&&!this.persistentVideoBackgroundEnabled?n.setBackground(t,e,null).then(()=>this.onSetBackgroundSuccess("call.setBackground",i)).catch(e=>this.onSetBackgroundFailure("call.setBackground",i,e)):this.deviceManagerService.setBackgroundEffectsOnDevice(t,e,a,r).then(()=>this.onSetBackgroundSuccess("setBackgroundEffectsOnDevice",i)).catch(e=>this.onSetBackgroundFailure("setBackgroundEffectsOnDevice",i,e))}onSetBackgroundSuccess(e,t){this.logger.info(`${e} was successfull`),t.resolve()}onSetBackgroundFailure(e,t,i){this.logger.error(`${e} failed with error: ${i}`),t.reject(i)}toImageOrigin(e,t){switch(e){case"user":return n.RI.CUSTOM_USER_UPLOAD;case"styleMyRoom":return n.RI.STYLE_MY_ROOM;default:return t?n.RI.CUSTOM_USER_UPLOAD:n.RI.MICROSOFT_DEFAULT}}}},453988:function(e,t,i){var n,a,r,o,s,l;i.d(t,{Al:()=>g,PG:()=>m,QY:()=>c,RI:()=>n,Wm:()=>u,eF:()=>p,l2:()=>h,sK:()=>_,wC:()=>d,ws:()=>r}),(o=n||(n={})).MICROSOFT_DEFAULT="MICROSOFT_DEFAULT",o.CUSTOM_USER_UPLOAD="CUSTOM_USER_UPLOAD",o.STYLE_MY_ROOM="STYLE_MY_ROOM";let c={UPLOAD_SUCCESS:"UPLOAD_SUCCESS",UPLOAD_FAILURE:"UPLOAD_FAILURE",UPLOAD_IMAGE_NOT_ACCEPTED:"UPLOAD_IMAGE_NOT_ACCEPTED"},d={FILE_DOWNLOAD_FAILURE:"FILE_DOWNLOAD_FAILURE",DIR_CREATION_FAILURE:"DIR_CREATION_FAILURE",DOWNLOAD_URL_FAILURE:"DOWNLOAD_URL_FAILURE",FILE_DOWNLOAD_SUCCESS:"FILE_DOWNLOAD_SUCCESS",LOCAL_IMAGES_FAILED_TO_FETCH:"LOCAL_IMAGES_FAILED_TO_FETCH",LOCAL_IMAGES_FETCHED:"LOCAL_IMAGES_FETCHED",LOCAL_IMAGE_FAILED_TO_SAVE:"LOCAL_IMAGE_FAILED_TO_SAVE",LOCAL_IMAGE_SAVED:"LOCAL_IMAGE_SAVED",LOCAL_IMAGE_NOT_SELECTED:"LOCAL_IMAGE_NOT_SELECTED",LOCAL_IMAGE_DELETED:"LOCAL_IMAGE_DELETED",LOCAL_IMAGE_FAILED_TO_DELETE:"LOCAL_IMAGE_FAILED_TO_DELETE",LOCAL_THUMBNAILS_GENERATED:"LOCAL_THUMBNAILS_GENERATED",LOCAL_FAILED_TO_GENERATE_THUMB:"LOCAL_FAILED_TO_GENERATE_THUMB",INVALID_IMAGE:"INVALID_IMAGE",IMAGE_FILE_EXTENSION_NOT_SUPPORTED:"IMAGE_FILE_EXTENSION_NOT_SUPPORTED",INVALID_PATH_TO_IMAGE:"INVALID_PATH_TO_IMAGE",GENERATED_IMAGE_SAVED:"GENERATED_IMAGE_SAVED",GENERATED_IMAGE_FAILED_TO_SAVE:"GENERATED_IMAGE_FAILED_TO_SAVE",SAVE_GENERATED_IMAGE_IS_UNDEFINED:"SAVE_GENERATED_IMAGE_IS_UNDEFINED",DELETE_USER_IMAGE_V2_SUCCEEDED:"DELETE_USER_IMAGE_V2_SUCCEEDED",DELETE_USER_IMAGE_V2_FAILED:"DELETE_USER_IMAGE_V2_FAILED",UPLOAD_USER_IMAGE_V2_SUCCEEDED:"UPLOAD_USER_IMAGE_V2_SUCCEEDED",UPLOAD_USER_IMAGE_V2_FAILED:"UPLOAD_USER_IMAGE_V2_FAILED",DELETE_USER_IMAGE_BY_CATEGORY_SUCCEEDED:"DELETE_USER_IMAGE_BY_CATEGORY_SUCCEEDED",DELETE_USER_IMAGE_BY_CATEGORY_FAILED:"DELETE_USER_IMAGE_BY_CATEGORY_FAILED",PERSIST_GENERATED_USER_IMAGE_SUCCEEDED:"PERSIST_GENERATED_USER_IMAGE_SUCCEEDED",PERSIST_GENERATED_USER_IMAGE_FAILED:"PERSIST_GENERATED_USER_IMAGE_FAILED",GET_USER_IMAGE_V2_SUCCEEDED:"GET_USER_IMAGE_V2_SUCCEEDED",GET_USER_IMAGE_V2_FAILED:"GET_USER_IMAGE_V2_FAILED",TENANT_IMAGE_UPLOAD_SUCCESS:"TENANT_IMAGE_UPLOAD_SUCCESS",TENANT_IMAGE_UPLOAD_FAILURE:"TENANT_IMAGE_UPLOAD_FAILURE"};(s=a||(a={})).UNKNOWN_ERROR="UNKNOWN_ERROR",s.IMAGE_FILE_EXTENSION_NOT_SUPPORTED="IMAGE_FILE_EXTENSION_NOT_SUPPORTED",s.INVALID_REQUEST="INVALID_REQUEST",s.IMAGE_FILE_NOT_EXISTED="IMAGE_FILE_NOT_EXISTED",s.INVALID_FILE_NAME="INVALID_FILE_NAME",(l=r||(r={}))[l.UPLOAD=0]="UPLOAD",l[l.STYLE_MY_ROOM_TEMP=1]="STYLE_MY_ROOM_TEMP",l[l.STYLE_MY_ROOM=2]="STYLE_MY_ROOM";let g={IN_PROGRESS:"IN_PROGRESS",NONE:"NONE",SUCCESS:"SUCCESS",FAIL:"FAIL"},h={BackgroundEffect:"BackgroundEffect",BackgroundProductionStage:"BackgroundProductionStage",GreenScreenBackgroundEffect:"GreenScreenBackgroundEffect",BackgroundAPL:"BackgroundAPL"},p="microsoft_none",u="microsoft_blur",m="microsoft_bokeh",_=new Set(["mp4","m4a","m4p","m4b","m4r","m4v"])},139513:function(e,t,i){i.d(t,{k:()=>s});var n=i(453988),a=i(370574),r=i(766913),o=i(575810);class s{constructor(e,t,i,n,a,r,o,s,l,c,d,g,h,p,u,m,_){this.config=e,this.callingSupportService=t,this.desktopUtilityService=i,this.utilityService=n,this.serviceProvider=a,this.logger=r,this.getDeviceManager=o,this.getVDISupportService=s,this.getLocalStorage=l,this.getDeviceBlurringCapability=c,this.getSelectedDevices=d,this.updateGreenScreenVideoEffect=g,this.stopGreenScreenVideoEffect=h,this.stopOrRestoreVideoExtensibilityIfNeeded=p,this.setBackgroundEffectsApplyingState=u,this.raiseBlurStateChangedEvent=m,this.shouldEnableEffectStatusBeMuted=_,this.appliedBGfromPreviewButton=!1,this.currentBlurType="Blur",this.shouldSendVideoEffectsEvent=!0,this.isPreviewOpenInRightSidePanel=!1}async setBackgroundEffectsOnDevice(e,t,i,s){if(!this.callingSupportService.isBackgroundBlurringAPIV2Enabled()||!this.getDeviceBlurringCapability())return Promise.resolve();s?this.appliedBGfromPreviewButton=!0:this.appliedBGfromPreviewButton=!1,this.appliedBgPathForPreviewEffect={effectType:e,path:"",origin:n.RI.MICROSOFT_DEFAULT};let l=this.serviceProvider.callingTelemetryService().newBlurringSetVideoEffectsScenario(null,t,e),c=this.getSelectedDevices();if(c){let o=c.camera;if(o){if(this.logger.info(`[VideoBKG] Attempting to set video effects on camera ${o} to ${e}, context ${t}`),this.config.isVideoEffectV2Enabled()){let s=e!==a.VideoEffectType.Off;return Promise.all([s?Promise.resolve(r.FZ.UnknownError):this.enableEffect(!1,{type:"BackgroundModification",options:{variant:"Replacement",location:""}}),this.enableEffect(s,{type:"BackgroundModification",options:{variant:s?e===a.VideoEffectType.Bokeh?"Bokeh":"Blur":this.currentBlurType}})]).then(([c,d])=>{if(d!==r.FZ.Success&&s){let e=`[VideoBKG] Failed to set background blur on camera to ${s}, context ${t}, error ${d}`;return(this.logger.error(e),this.shouldEnableEffectStatusBeMuted(d))?Promise.resolve():Promise.reject(Error(e))}return s&&(e===a.VideoEffectType.Bokeh||e===a.VideoEffectType.BackgroundBlurDefault)&&(this.currentBlurType=e===a.VideoEffectType.Bokeh?"Bokeh":"Blur"),this.logger.info(`[VideoBKG] Successfully set video effects on camera ${o} to ${e}, context ${t}`),this.config.isPersistentVideoBackgroundEnabled()&&i&&(this.cachedCustomBGEffect={effectType:e,path:"",origin:n.RI.MICROSOFT_DEFAULT},this.getLocalStorage().set("call.setBackground",this.cachedCustomBGEffect)),this.raiseBlurStateChangedEvent(),this.stopGreenScreenVideoEffect(),l.stop(),Promise.resolve()}).catch(i=>{let n=this.utilityService.getErrorLoggingString(i);return this.logger.warn(`[VideoBKG] Unable to set video effects on camera ${o} to ${e}, context ${t}. Error: ${n}`),this.filterOutNonBackgroundErrors(n)?l.incomplete({reason:n}):l.fail({errorInfo:n,reason:n}),Promise.reject(i)})}{let r=this.deviceManager.setDeviceEffectsAsync(o,e);return this.shouldSendVideoEffectsEvent=e===a.VideoEffectType.Off||this.shouldSendVideoEffectsEvent,r.then(()=>{this.logger.info(`[VideoBKG] Successfully set video effects on camera ${o} to ${e}, context ${t}`),this.setBackgroundEffectsApplyingState(e!==a.VideoEffectType.Off,e,t),this.config.isPersistentVideoBackgroundEnabled()&&i&&(this.cachedCustomBGEffect={effectType:e,path:"",origin:n.RI.MICROSOFT_DEFAULT},this.getLocalStorage().set("call.setBackground",this.cachedCustomBGEffect)),this.raiseBlurStateChangedEvent(),l.stop()}).catch(i=>{let n=this.utilityService.getErrorLoggingString(i);this.logger.warn(`[VideoBKG] Unable to set video effects on camera ${o} to ${e}, context ${t}. Error: ${n}`),this.filterOutNonBackgroundErrors(n)?l.incomplete({reason:n}):l.fail({errorInfo:n,reason:n})}),r}}}return l.incomplete({[o.gT.counters.eventNames.reason]:"No camera available"}),Promise.resolve()}setBackgroundImageOnDevice(e,t,i,s,l,c,d,g,h){if(!this.callingSupportService.isVideoBackgroundEffectsSupported()||!this.getDeviceBlurringCapability())return Promise.resolve();d?(this.appliedBGfromPreviewButton=!0,this.appliedBgPathForPreviewEffect={effectType:t,path:e,origin:l}):(this.appliedBGfromPreviewButton=!1,this.appliedBgPathForPreviewEffect=void 0);let p=this.serviceProvider.callingTelemetryService().newSetBackgroundImagesScenario(null,i,t,l,!0),u=this.getSelectedCamera(),m=this.utilityService.isAmsImage(e)?{credentials:"include"}:void 0;if(u)if(this.config.isVideoEffectV2Enabled()){let o=t!==a.VideoEffectType.Off,s=l===n.RI.STYLE_MY_ROOM;return this.enableEffect(o,{type:"BackgroundModification",options:{variant:"Replacement",location:e,isAiGeneratedImage:s,headers:this.desktopUtilityService.isWeb()?m:void 0}}).then(n=>{if(n!==r.FZ.Success){let e=`[VideoBKG] Failed to set background image on camera to ${o}, context ${i}, error ${n}`;return(this.logger.error(e),this.shouldEnableEffectStatusBeMuted(n))?Promise.resolve():Promise.reject(Error(e))}return this.logger.info(`[VideoBKG] Successfully set background image on camera ${u} to ${t}, context ${i}`),this.config.isPersistentVideoBackgroundEnabled()&&c&&(this.cachedCustomBGEffect={effectType:t,path:e,origin:l,imageId:g,imageSrc:h},this.getLocalStorage().set("call.setBackground",this.cachedCustomBGEffect)),this.updateGreenScreenVideoEffect(e),p.stop(),Promise.resolve()}).catch(e=>{let n=this.utilityService.getErrorLoggingString(e);return this.logger.warn(`[VideoBKG] Unable to set background image on camera ${u} to ${t}, context ${i}. Error: ${n}`),this.filterOutNonBackgroundErrors(n)?p.incomplete({reason:n}):p.fail({errorInfo:n,reason:n}),Promise.reject(e)})}else{this.logger.info(`[VideoBKG] fetching image "${e}" ${m?"with":"without"} auth headers`);let n=this.deviceManager.setBackgroundImageAsync(u,e,m);return n.then(()=>{this.logger.info(`[VideoBKG] Successfully set background image on camera ${u} to ${t}, context ${i}`),this.setBackgroundEffectsOnDevice(t,i,void 0,d),this.updateGreenScreenVideoEffect(e),this.config.isPersistentVideoBackgroundEnabled()&&c&&(this.cachedCustomBGEffect={effectType:t,path:e,origin:l},this.getLocalStorage().set("call.setBackground",this.cachedCustomBGEffect)),p.stop()}).catch(e=>{let n=this.utilityService.getErrorLoggingString(e);this.logger.warn(`[VideoBKG] Unable to set background image on camera ${u} to ${t}, context ${i}. Error: ${n}`),this.filterOutNonBackgroundErrors(n)?p.incomplete({reason:n}):p.fail({errorInfo:n,reason:n})}),n}return p.incomplete({[o.gT.counters.eventNames.reason]:"No camera available"}),Promise.resolve()}enableEffect(e,t,i){return new Promise((n,a)=>{let r=this.getSelectedDevices();if(r&&r.camera)return this.enableVideoEffectOnDevice(r.camera,e,t,i).then(n,a);{let e="[VideoBKG] Failed to enable effect, no camera";this.logger.warn(e),a(Error(e))}})}enableVideoEffectOnDevice(e,t,i,n){if(this.logger.info(`[VideoBKG] enableVideoEffectOnDevice: enable=${t} effect=${JSON.stringify(i)}`),e===r.nw)return Promise.resolve(r.FZ.Success);let a=this.desktopUtilityService.isWebRTCVdiMode();if(a&&!this.config.areVDIBackgroundEffectsEnabled())return n===o.gT.scenarios.calling.context.callingResolvers?Promise.reject(Error("[VideoBKG] Background effects not supported in current VDI environment.")):(this.logger.info("[VideoBKG] Old version VDI, background effects not supported."),Promise.resolve(r.FZ.OldVDINotSupported));let s=t?{type:"EnableEffects",request:{effects:[i]}}:{type:"DisableEffects",request:{effects:[i]}};return(a?this.getVDISupportService()?.sendMessageDeviceVideoEffectsAsync(e,s):this.deviceManager.sendMessageDeviceVideoEffectsAsync(e,s)).then(e=>{if(this.logger.debug(`[VideoBKG] enableVideoEffectOnDevice: sendMessageDeviceVideoEffectsAsync response ${JSON.stringify(e)}`),0!==e.code&&10!==e.code){let t=`[VideoBKG] Failed to enable effects, sendMessageDeviceVideoEffectsAsync response ${JSON.stringify(e)}`;throw this.logger.warn(t),Error(t)}let n=e.response;return(this.stopOrRestoreVideoExtensibilityIfNeeded(i,t),1===n.effects.length||10===e.code&&0===n.effects.length)?r.FZ.Success:r.FZ.EffectLengthError}).catch(e=>{throw this.logger.error(`[VideoBKG] Failed to enable effect, sendMessageDeviceVideoEffectsAsync error ${e}`),e})}setPreviewOpenInRightSidePanel(e,t=""){this.isPreviewOpenInRightSidePanel=e,this.previewBgPathOpenInRightSidePanel=t}getRightSidePreviewVideoDetails(){return{isPreviewOpenInRightSidePanel:this.isPreviewOpenInRightSidePanel,previewBgPathOpenInRightSidePanel:this.previewBgPathOpenInRightSidePanel}}filterOutNonBackgroundErrors(e){return!!e.includes("WebContents")}getSelectedCamera(){let e=this.getSelectedDevices();return e?e.camera:null}get deviceManager(){return this.getDeviceManager()}}},766913:function(e,t,i){var n,a,r,o,s,l,c,d;i.d(t,{$O:()=>r,Ch:()=>C,Df:()=>a,FZ:()=>n,K4:()=>_,UZ:()=>m,cN:()=>o,nw:()=>g,sZ:()=>p,tH:()=>h,vh:()=>u,xv:()=>S});let g="VideoExtensibilityVirtualVideoSource",h={None:"None",Normal:"Normal",Deep:"Deep",PNS:"PNS"},p={EyeContact:"EyeContact",AutoFraming:"AutoFraming"},u={On:"On",Off:"Off",Default:"Default"},m={SlimCoreVDI:"SlimCoreVDI",SlimCoreVDINonMTMA:"SlimCoreVDINonMTMA",AccountInit:"AccountInit",HIDService:"HIDService"};class _{}_.NoiseSuppression_Support="ns-support",_.NoiseSuppression_SettingChanged="ns-setting-changed",_.NoiseSuppression_Initialized="ns-init",_.OptimizedPerfMode_Initialized="opm-init",_.Devices_Initialized="devices-init",_.VoiceSignature_Requested="voicesignature-requested",_.AutomaticGainControl_SettingToggle="agc-setting-toggle",_.SyncDeviceButtons_SettingToggle="sync-device-buttons",_.AutomaticCameraSettingsSelected_SettingToggle="camera-setting-toggle",_.HighFidelityMusicMode_SettingToggle="highfidelitymusicmode-setting-toggle",_.EchoCancellation_SettingToggle="echocancellation-setting-toggle",_.StereoMode_SettingToggle="stereo-mode-setting-toggle",(s=n||(n={}))[s.Success=0]="Success",s[s.OldVDINotSupported=1]="OldVDINotSupported",s[s.EffectLengthError=2]="EffectLengthError",s[s.UnknownError=3]="UnknownError",(l=a||(a={})).Default="Default",l.Communications="Communications",(c=r||(r={})).AudioOutput="AudioOutput",c.AudioInput="AudioInput",c.VideoInput="VideoInput";class S{}S.AutoAdjust="AutoAdjust",S.TouchUp="TouchUp",S.EyeContact="EyeContact",S.BackgroundModification="BackgroundModification",S.ContentCamera="ContentCamera",S.GreenScreen="GreenScreen",S.ReplacementChromaKey="ReplacementChromaKey";class C{}C.SendMessagePortFromMainWindowPreloadToMainWorld="video.sendMessagePortFromMainWindowPreloadToMainWorld",C.EnableVideoExtensibility="video.enableVideoExtensibility",C.MessageChannelEstablished="video.messageChannelEstablished",C.VideoEffectDisabled="video.videoEffectDisabled",C.VideoEffectEnabled="video.videoEffectEnabled",C.IpcChangedEvent="video.videoExtensibilityIpcChangedEvent",C.PerformanceErrorEvent="video.videoExtensibilityPerfErrorEvent",C.PerformanceAlertEvent="video.videoExtensibilityPerfAlertEvent",(d=o||(o={})).firstDeviceEnumeration="After First Device Enumeration",d.devicesChanged="devicesChanged",d.callStateChanged="CallStateChanged"},373649:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C;i.d(t,{Ai:()=>c,E8:()=>s,JM:()=>d,Lc:()=>l,Yk:()=>o,iF:()=>r,vR:()=>a,wh:()=>n}),(g=n||(n={}))[g.callingScreen=54]="callingScreen",g[g.broadcastScreen=160]="broadcastScreen",g[g.teamsDeviceAttachedPseudo=321]="teamsDeviceAttachedPseudo",g[g.activeCallBanner=353]="activeCallBanner",g[g.ndiInSettingsTurnOn=405]="ndiInSettingsTurnOn",g[g.ndiInSettingsTurnOff=406]="ndiInSettingsTurnOff",g[g.ndiCaptureStart=407]="ndiCaptureStart",g[g.confirmAudioEscalationDialog=334]="confirmAudioEscalationDialog",g[g.callPaywallDurationAlertForSponsor=454]="callPaywallDurationAlertForSponsor",g[g.callPaywallDurationAlertForParticipant=455]="callPaywallDurationAlertForParticipant",g[g.callPaywallCapacityAlert=456]="callPaywallCapacityAlert",g[g.callPaywallTimerStartAlert=457]="callPaywallTimerStartAlert",g[g.hidDeviceASPConnectionFromApp=485]="hidDeviceASPConnectionFromApp",g[g.isolatedAudioInSettingsTurnOn=488]="isolatedAudioInSettingsTurnOn",g[g.isolatedAudioInSettingsTurnOff=489]="isolatedAudioInSettingsTurnOff",g[g.OnDidHookEventViaDevice=495]="OnDidHookEventViaDevice",g[g.OnDidOffHookEventViaDevice=496]="OnDidOffHookEventViaDevice",g[g.OnDidFlashEventViaDevice=497]="OnDidFlashEventViaDevice",g[g.OnDidMuteToggleEventViaDevice=498]="OnDidMuteToggleEventViaDevice",g[g.OnDidVideoMuteEventViaDevice=499]="OnDidVideoMuteEventViaDevice",g[g.OnDidVideoUnmuteEventViaDevice=500]="OnDidVideoUnmuteEventViaDevice",g[g.onDidContentCameraInvokeViaDevice=515]="onDidContentCameraInvokeViaDevice",g[g.onDetectMultipleUltrasoundMTRs=532]="onDetectMultipleUltrasoundMTRs",g[g.onDetectSensitiveContentSharedByPresenter=533]="onDetectSensitiveContentSharedByPresenter",g[g.onDetectSensitiveContentSharedByOrganizer=534]="onDetectSensitiveContentSharedByOrganizer",(h=a||(a={}))[h.interopScreenshareButtonAlert=2]="interopScreenshareButtonAlert",h[h.mergeFailureButtonAlert=3]="mergeFailureButtonAlert",h[h.messageFromMeetingStartToast=62]="messageFromMeetingStartToast",h[h.meetingStartedNotification=261]="meetingStartedNotification",h[h.meetingStartedFromLobbyNotification=262]="meetingStartedFromLobbyNotification",h[h.openMeetingDetails=331]="openMeetingDetails",h[h.pstnFallbackUFDButton=332]="pstnFallbackUFDButton",h[h.shareScreenButton=592]="shareScreenButton",h[h.emergencyCall=632]="emergencyCall",h[h.showCallToast=665]="showCallToast",h[h.sharePowerPointFileFromDeepLink=685]="sharePowerPointFileFromDeepLink",h[h.joinFromMeetingStartToast=801]="joinFromMeetingStartToast",h[h.activeCallBannerDismiss=803]="activeCallBannerDismiss",h[h.acceptBreakoutRoomInvite=811]="acceptBreakoutRoomInvite",h[h.declineBreakoutRoomInvite=812]="declineBreakoutRoomInvite",h[h.acceptMainMeetingInvite=813]="acceptMainMeetingInvite",h[h.declineMainMeetingInvite=814]="declineMainMeetingInvite",h[h.goToMainMeeting=815]="goToMainMeeting",h[h.downloadAppButton=849]="downloadAppButton",h[h.optOutVoiceCollection=905]="optOutVoiceCollection",h[h.closeVoiceCollection=1559]="closeVoiceCollection",h[h.pstnComponentInPstnFallback=939]="pstnComponentInPstnFallback",h[h.dismiss=940]="dismiss",h[h.unmute=941]="unmute",h[h.shareDesktop=942]="shareDesktop",h[h.switchAudioDevice=943]="switchAudioDevice",h[h.switchToNewPluggedInVideoDevice=945]="switchToNewPluggedInVideoDevice",h[h.switchToCurrentBestCamera=946]="switchToCurrentBestCamera",h[h.openDeviceSettings=947]="openDeviceSettings",h[h.unmuteSpeakers=948]="unmuteSpeakers",h[h.ufdTurnOffAudio=949]="ufdTurnOffAudio",h[h.ufdTurnOffVideo=950]="ufdTurnOffVideo",h[h.ufdTurnOnVideo=951]="ufdTurnOnVideo",h[h.openAudioEscalationDialogButton=952]="openAudioEscalationDialogButton",h[h.betterTogetherTransferCall=953]="betterTogetherTransferCall",h[h.escalateAudio=957]="escalateAudio",h[h.pptTakeControl=974]="pptTakeControl",h[h.pptStartSharing=977]="pptStartSharing",h[h.pptCancelSharing=979]="pptCancelSharing",h[h.pptUnsupportedMeeting=980]="pptUnsupportedMeeting",h[h.pptSharingUnavailable=981]="pptSharingUnavailable",h[h.dismissFromMeetingStartToast=1025]="dismissFromMeetingStartToast",h[h.openSettings=1051]="openSettings",h[h.learnMore=1097]="learnMore",h[h.joinBroadcastMeeting=1103]="joinBroadcastMeeting",h[h.retryBroadcastJoin=1116]="retryBroadcastJoin",h[h.broadcastLearnMoreAlertButton=1195]="broadcastLearnMoreAlertButton",h[h.teamsDeviceVoiceMail=1214]="teamsDeviceVoiceMail",h[h.teamsDeviceMissedCall=1215]="teamsDeviceMissedCall",h[h.teamsDeviceActivateApp=1216]="teamsDeviceActivateApp",h[h.teamsDeviceMeetingJoin=1217]="teamsDeviceMeetingJoin",h[h.teamsDeviceCortanaInvoked=1218]="teamsDeviceCortanaInvoked",h[h.ndiPrivacyPolicyButtonCapturer=1368]="ndiPrivacyPolicyButtonCapturer",h[h.ndiPrivacyPolicyButtonParticipant=1369]="ndiPrivacyPolicyButtonParticipant",h[h.lockMeetingButtonAlert=1408]="lockMeetingButtonAlert",h[h.reportScdFailureButton=1440]="reportScdFailureButton",h[h.liveStreamingPrivacyPolicyButtonParticipant=1469]="liveStreamingPrivacyPolicyButtonParticipant",h[h.paywallUpgradeButton=1504]="paywallUpgradeButton",h[h.paywallDurationAlert=1505]="paywallDurationAlert",h[h.paywallCapacityAlert=1506]="paywallCapacityAlert",h[h.paywallTimerStartAlert=1507]="paywallTimerStartAlert",h[h.highFidelityMusicModeToggleFromUFD=1511]="highFidelityMusicModeToggleFromUFD",h[h.closeVideoApp=1512]="closeVideoApp",h[h.unmuteMicAndSpeakers=1517]="unmuteMicAndSpeakers",h[h.muteMicAndSpeakers=1533]="muteMicAndSpeakers",h[h.viewBreakoutRooms=1540]="viewBreakoutRooms",h[h.liveInterpretationAvailableDialogButton=1541]="liveInterpretationAvailableDialogButton",h[h.controlRoomSystemPanelButton=1550]="controlRoomSystemPanelButton",h[h.recordingStartButton=1560]="recordingStartButton",h[h.lowerHandManualAlert=1590]="lowerHandManualAlert",h[h.keepRaisedHandManualAlert=1591]="keepRaisedHandManualAlert",h[h.keepRaisedHandAutoAlert=1593]="keepRaisedHandAutoAlert",h[h.manualAlertDismissed=1594]="manualAlertDismissed",h[h.autoAlertDismissed=1595]="autoAlertDismissed",h[h.acceptControl=1596]="acceptControl",h[h.denyControl=1597]="denyControl",h[h.terminateControl=1598]="terminateControl",h[h.turnOffVoiceIsolationForThisMeeting=1630]="turnOffVoiceIsolationForThisMeeting",h[h.autoHandRaiseAlert=1631]="autoHandRaiseAlert",h[h.changeMeetingLevelSpokenLanguageDialogButton=1632]="changeMeetingLevelSpokenLanguageDialogButton",h[h.changeUserLevelSpokenLanguageDialogButton=1633]="changeUserLevelSpokenLanguageDialogButton",h[h.aiInterpretationAvailableDialogButton=1634]="aiInterpretationAvailableDialogButton",h[h.installSystemAudioDriver=1635]="installSystemAudioDriver",h[h.stopScreenSharing=1636]="stopScreenSharing",h[h.confirmDetectedSpokenLanguageButton=1637]="confirmDetectedSpokenLanguageButton",h[h.aiInterpretationAvailableForOthersDialogButton=1638]="aiInterpretationAvailableForOthersDialogButton",h[h.aiInterpretationTurnOnConfirmationAlertButton=1639]="aiInterpretationTurnOnConfirmationAlertButton",h[h.ufdTurnOnMicAndSpeaker=1640]="ufdTurnOnMicAndSpeaker",h[h.aiInterpretationFailedAlertButton=1641]="aiInterpretationFailedAlertButton",h[h.acknowledgeGracePeriod=1642]="acknowledgeGracePeriod",h[h.cancelDetectedSpokenLanguageButton=1643]="cancelDetectedSpokenLanguageButton",h[h.annotationAcceptControl=1644]="annotationAcceptControl",h[h.annotationDenyControl=1645]="annotationDenyControl",h[h.aiInterpretationAllowSimulateMyVoiceAlertButton=1646]="aiInterpretationAllowSimulateMyVoiceAlertButton",h[h.aiInterpretationNotNowSimulateMyVoiceButton=1647]="aiInterpretationNotNowSimulateMyVoiceButton",h[h.restartClosedCaptions=1648]="restartClosedCaptions",h[h.aiInterpretationVoiceSelectorOnlyDialogAlertButton=1649]="aiInterpretationVoiceSelectorOnlyDialogAlertButton",(p=r||(r={}))[p.callMonitor=17]="callMonitor",p[p.other=45]="other",p[p.button=50]="button",p[p.toast=72]="toast",p[p.callNotification=98]="callNotification",p[p.callPaywallAlert=216]="callPaywallAlert",p[p.callPaywallDurationAlertLearnMore=217]="callPaywallDurationAlertLearnMore",p[p.callPaywallCapacityAlert=218]="callPaywallCapacityAlert",p[p.callPaywallTimerStartAlert=219]="callPaywallTimerStartAlert",(u=o||(o={}))[u.click=0]="click",u[u.asyncStateChange=6]="asyncStateChange",u[u.auto=8]="auto",(m=s||(s={}))[m.info=0]="info",m[m.nav=1]="nav",m[m.select=4]="select",m[m.dismiss=13]="dismiss",m[m.show=15]="show",m[m.hide=16]="hide",m[m.joinMeeting=22]="joinMeeting",m[m.failed=40]="failed",m[m.confirmAudioEscalation=57]="confirmAudioEscalation",(_=l||(l={}))[_.mergeFailureAlertDismiss=7]="mergeFailureAlertDismiss",_[_.emergencyCall=10]="emergencyCall",_[_.sharingContent=744]="sharingContent",_[_.showCallToast=774]="showCallToast",_[_.closeActiveCallBanner=921]="closeActiveCallBanner",_[_.escalateAudio=1130]="escalateAudio",_[_.pstnFallbackPstnComponent=1139]="pstnFallbackPstnComponent",_[_.joinBroadcast=1237]="joinBroadcast",_[_.lockMeetingRetryButtonAlert=1500]="lockMeetingRetryButtonAlert",_[_.dismissPaywallAlert=1623]="dismissPaywallAlert",_[_.paywallUpgrade=1624]="paywallUpgrade",_[_.mdpDataCollection=1716]="mdpDataCollection",_[_.lowerHandManualAlert=1733]="lowerHandManualAlert",_[_.keepRaisedHandManualAlert=1734]="keepRaisedHandManualAlert",_[_.keepRaisedHandAutoAlert=1736]="keepRaisedHandAutoAlert",_[_.manualAlertDismissed=1738]="manualAlertDismissed",_[_.autoAlertDismissed=1739]="autoAlertDismissed",_[_.autoHandRaiseAlert=1797]="autoHandRaiseAlert",_[_.complianceRecordingCustomBannerAlert=1799]="complianceRecordingCustomBannerAlert",_[_.SensitiveContentDetectedScreenSharingStoppedByPresenterAlert=1800]="SensitiveContentDetectedScreenSharingStoppedByPresenterAlert",(S=c||(c={}))[S.banner=7]="banner",(C=d||(d={}))[C.callOrMeetup=23]="callOrMeetup",C[C.emergencyCall=28]="emergencyCall",C[C.openDialog=45]="openDialog",C[C.broadcast=108]="broadcast",C[C.lockMeetingAlert=263]="lockMeetingAlert",C[C.enforcementStatusChangeNotification=292]="enforcementStatusChangeNotification",C[C.meetingIsFullNotification=293]="meetingIsFullNotification",C[C.meetingWillTimeoutNotification=294]="meetingWillTimeoutNotification"},654807:function(e,t,i){i.d(t,{$hB:()=>tn,AVy:()=>tb,AnB:()=>eA,CEb:()=>eJ,C_z:()=>tI,DYn:()=>tE,GFA:()=>ef,I3p:()=>e2,Il0:()=>e7,Io1:()=>tw,J0j:()=>ta,KNZ:()=>tC,L$A:()=>ej,LFH:()=>to,LR0:()=>tm,LWS:()=>e3,Le1:()=>eC,Ln2:()=>eE,M9D:()=>tT,M9W:()=>eB,MsV:()=>e0,MwN:()=>tk,NIU:()=>e1,OCW:()=>tv,PVX:()=>eq,PXw:()=>e8,QeU:()=>tF,Qul:()=>eL,Ryo:()=>tN,SEp:()=>tS,T8N:()=>te,UV:()=>eY,Yfn:()=>tM,aDF:()=>eI,cAd:()=>tR,clU:()=>ew,dw6:()=>ti,e2A:()=>eW,e3c:()=>e6,e4m:()=>td,fA6:()=>eN,fCN:()=>e5,fDS:()=>ex,fQ1:()=>tr,gm0:()=>eU,i9m:()=>eX,iOC:()=>eH,iYh:()=>eT,ini:()=>ek,l5h:()=>eP,lqP:()=>eQ,moz:()=>t_,mrr:()=>eG,paN:()=>ev,pkA:()=>tt,ppK:()=>tf,qct:()=>eV,re6:()=>eZ,tPe:()=>tD,tSi:()=>ez,v93:()=>th,w4O:()=>tP,wxy:()=>e9,xXJ:()=>ty,xuW:()=>eM,z_G:()=>tp});var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C,v,f,b,y,T,I,A,E,M,P,k,D,R,w,F,N,O,L,U,B,x,V,H,G,W,$,z,q,j,J,Q,K,Y,Z,X,ee,et,ei,en,ea,er,eo,es,el,ec,ed,eg,eh,ep,eu,em,e_,eS,eC,ev,ef,eb,ey,eT,eI,eA,eE,eM,eP,ek,eD,eR,ew,eF,eN,eO,eL,eU,eB,ex,eV,eH,eG,eW,e$,ez,eq,ej,eJ,eQ,eK,eY,eZ,eX,e0,e1,e2,e3,e5,e4,e6,e7,e9,e8,te,tt,ti,tn,ta,tr,to,ts,tl,tc,td,tg,th,tp,tu,tm,t_,tS,tC,tv,tf,tb,ty,tT,tI,tA=i(175337);let tE={ASK_PERMISSION_TICKET_STATE_CHANGED_EVENT:"AskPermissionTicketStateChangedEvent",CALL_ADDED:"CallAdded",CALL_REMOVED:"CallRemoved",CALL_UPDATED:"CallUpdated",CALL_MUTE_UPDATED:"CallMuteUpdated",CALL_VIDEO_UPDATED:"CallVideoUpdated",CALLING_WINDOWING_CONTAINER_CREATED_EVENT:"CallingWindowingContainerCreatedEvent",CALLING_WINDOWING_CONTAINER_RENDER_DONE_EVENT:"CallingWindowingContainerRenderDoneEvent",CALLING_WINDOWING_CONTAINER_REMOVED_EVENT:"CallingWindowingContainerRemovedEvent",DOMINANT_SPEAKER_INFO_EVENT:"DominantSpeakerInfoEvent",STREAMING_INFO_CHANGED_EVENT:"StreamingInfoChangedEvent",MEETING_CHAT_ERROR_CODE_EVENT:"MeetingChatErrorCodeEvent",MEETING_SENSITIVITY_LABEL_UPDATE_RECOMMENDATION_EVENT:"MeetingSensitivityLabelUpdateRecommendationEvent",PARTICIPANTS_CHANGED:"CallParticipantsChanged",PARTICIPANT_COUNTS_CHANGED:"CallParticipantCountsChanged",CALL_SELFPARTICIPANT_CHANGED:"CallSelfParticipantChanged",PARTICIPANTS_VOICE_LEVELS_CHANGED:"CallParticipantsVoiceLevelsChanged",PARTICIPANTS_MEETING_REACTIONS_RECEIVED:"CallParticipantsReactions",RAISE_HAND_STATE_CHANGED:"RaiseHandStateChanged",CALL_APP_CONTENT_SHARING_ADDED:"CallAppContentSharingAdded",CALL_APP_CONTENT_SHARING_REMOVED:"CallAppContentSharingRemoved",CALL_APP_CONTENT_SHARING_STARTED:"CallAppContentSharingStarted",CALL_APP_CONTENT_SHARING_START_FAILED:"CallAppContentSharingStartFailed",CALL_APP_CONTENT_SHARING_STATUS_CHANGED:"CallAppContentSharingStatusChanged",CALL_APP_URL_CHANGED:"callAppUrlChanged",CALL_PARTICIPANTS_MEETING_REACTIONS_LIVE_STATE:"CallParticipantsMeetingReactionsLiveState",CALL_CHAT_BUBBLE_TOGGLE:"CallChatBubbleToggle",CALL_ATTENDEE_RESTRICTIONS_CHANGED:"CallAttendeeRestrictionsChanged",CALL_PARTICIPANT_AUDIO_RESTRICTIONS_CHANGED:"CallParticipantAudioRestrictionsChanged",CALL_PARTICIPANT_VIDEO_RESTRICTIONS_CHANGED:"CallParticipantVideoRestrictionsChanged",ATTENDEE_PARTICIPANT_RESTRICTIONS_CHANGED:"AttendeeParticipantRestrictionsChanged",CALL_ALERTS_UPDATED:"CallAlertsUpdated",CALL_PPTSHARING_ADDED:"CallPptSharingAdded",WHITEBOARD_SHARING_ADDED:"WhiteboardSharingAdded",CALL_PPTSHARING_MEDIA_UPDATED:"CallPptSharingMediaEventUpdated",CALL_PPTSHARING_TELEMETRY_UPDATED:"CallPptSharingTelemetryUpdated",CALL_PPTSHARING_REMOVED:"CallPptSharingRemoved",CALL_PPTSHARING_SLIDE_CHANGED:"CallPptSharingSlideChanged",CALL_PPTSHARING_PRIVATE_VIEWING_CHANGED:"CallPptSharingPrivateViewingChanged",CALL_PPTSHARING_CONTENT_SHARING_STATUS_CHANGED:"CallPptSharingContentSharingStatusChanged",CALL_PPTSHARING_CHANGE_SLIDE_CORTANA_INVOCATION:"CallPptSharingChangeSlideCortanaInvocation",CALL_PPTSHARING_PRESENTATION_URL_READY:"CallPptSharingPresentationUrlReady",WHITEBOARD_SHARING_CONTENT_SHARING_STATUS_CHANGED:"WhiteboardSharingContentSharingStatusChanged",CALL_LOCAL_RECORDING_STATE_CHANGED:"CallLocalRecordingStateChanged",CALL_ACS_RECORDING_STATUS_CHANGED:"CallACSRecordingStateChanged",CLOUD_PEOPLE_FEED_RECEIVED_STATUS_CHANGED:"CloudPeopleFeedReceivedStateChanged",PEOPLE_FEED_AVAILABILITY_STATUS_CHANGED:"PeopleFeedAvailabilityChanged",EXPLICIT_RECORDING_CONSENT_STATE_CHANGED:"ExplicitRecordingConsentStateChanged",CALL_RECORDING_STATE_CHANGED:"CallRecordingStateChanged",COMPLIANCE_RECORDING_STATE_CHANGED:"ComplianceRecordingStateChanged",CALL_FULL_FRAME_REQUESTED:"FullFrameRequired",CALL_VOICE_COLLECTION_CHANGED:"CallVoiceCollectionChanged",CALL_CLOSED_CAPTIONS_CHANGED:"CallClosedCaptionsChanged",CALL_COPILOT_TRANSCRIPT_CHANGED:"CallCopilotTranscriptChanged",REAL_TIME_TEXT_STATUS_CHANGED:"RealTimeTextStatusChanged",SLIDE_CONTROL_STATUS_CHANGED:"SlideControlStatusChanged",SLIDE_CONTROLLABLE_CONTENT_CHANGED:"SlideControllableContentChanged",SLIDE_CONTROLLER_COUNT_CHANGED:"SlideControllerCountChanged",SLIDE_CONTROL_CAPABLE_VIEWERS_LIST_CHANGED:"SlideControlCapableViewersListChanged",CALL_COACH_CHANGED:"CallCoachChanged",CALL_TITLE_CHANGED:"CallTitleChanged",MWBT_CALL_STATE_CHANGED:"MwbtCallStateChanged",CALL_TRANSFERRED:"CallTransferred",CALL_TRANSFERRED_FAILED:"CallTransferredFailed",CALL_TRANSFERRED_SUCCEEDED:"CallTransferredSucceeded",CALL_DEVICELIST_UPDATED:"CallDeviceListUpdated",CALL_DEVICE_SHORTCUT_EVENT:"CallDeviceShortcutEvent",CALL_MIC_NRGLEVELS_CHANGED:"CallMicNrgLevelsChanged",CALL_SPEAKER_VOLUME_CHANGED:"CallSpeakerVolumeChanged",BLURRING_CAPABILITY_CHANGED:"blurringCapabilityChanged",HIGH_FIDELITY_AUDIO_SWITCH_CHANGED:"HighFidelityAudioSwitchChanged",CALL_SPEAKER_MUTED_CHANGED:"CallSpeakerMutedChanged",CALL_SPEAKER_HWMUTED_CHANGED:"CallSpeakerHWMutedChanged",CALL_PPT_SHARING_STARTED:"CallPptSharingStarted",NOISE_SUPPRESSION_CHANGED:"NoiseSuppressionChanged",OPTIMIZED_PERF_MODE_CHANGED:"OptimizedPerfModeChanged",BIOMETRIC_ENROLLMENT_USER_ENROLLMENT_STATUS_CHANGED:"BiometricEnrollmentUserEnrollmentStatusChanged",PASSIVE_VOICE_ENROLLMENT_CONSENT_CHANGED:"PassiveVoiceEnrollmentConsentChanged",BIOMETRIC_FACE_ENROLLMENT_STATUS_CHANGED:"BiometricFaceEnrollmentStatusChanged",BIOMETRIC_ENROLLMENT_DEVICES_UPDATED:"BiometricEnrollmentDevicesUpdated",VOICE_ISOLATION_BANNER_VISIBILITY_CHANGED:"VoiceIsolationBannerVisibilityChanged",AUTO_GAIN_CONTROL_CHANGED:"AutoGainControlChanged",SYNC_DEVICE_BUTTONS_CHANGED:"SyncDeviceButtonsChanged",MUSIC_MODE_SETTINGS_CHANGED:"MusicModeSettingsChanged",GROUP_COPILOT_SETTING_CHANGED:"GroupCopilotSettingChanged",BYOD_PARTICIPANT_JOIN_MEETING_SPACE_EVENT:"ByodParticipantJoinMeetingSpaceEvent",IGNORE_MIRRORING_VIDEO_PREFERENCE_SETTING_CHANGED:"IgnoreMirroringVideoPreferenceSettingChanged",TOUCH_UP_TOGGLE_CHANGED:"TouchUpToggleChanged",TOUCH_UP_STRENGTH_CHANGED:"TouchUpStrengthChanged",AUTO_ADJUST_TOGGLE_CHANGED:"AutoAdjustToggleChanged",EYE_CONTACT_TOGGLE_CHANGED:"EyeContactToggleChanged",EYE_CONTACT_CAPABILITY_CHANGED:"EyeContactCapabilityChanged",VIDEO_EFFECT_STATE_CHANGED:"VideoEffectStateChanged",WHITEBOARD_SHARING_STARTED:"WhiteboardSharingStarted",ANNOTATION_CHANGED:"AnnotationChanged",DEEPLINK_SHARING_STARTED:"DeeplinkSharingStarted",WHITEBOARD_URL_CHANGED:"WhiteboardUrlChanged",FILE_USERPERMISSIONS_CHANGED:"FileUserPermissionsChanged",EXTENSIBLE_APP_CONTEXT_CHANGED:"ExtensibleAppContextChanged",CALL_PPT_SHARING_START_FAILED:"CallPptSharingStartFailed",WHITEBOARD_SHARING_START_FAILED:"WhiteboardSharingStartFailed",CALL_PPT_SHARING_JOIN_FAILED:"CallPptSharingJoinFailed",CALL_CONTENT_SHARING_JOIN_INCOMPLETE:"CallContentSharingJoinIncomplete",HAS_ONGOING_CALLS_CHANGED:"HasOngoingCallsChanged",SUBSCRIBED_CALL_CHANGED:"SubscribedCallChanged",CALL_LAYOUT_CHANGED:"CallLayoutChanged",CALLING_POLICIES_CHANGED_EVENT:"CallingPoliciesChangedEvent",SYSTEM_AUDIO_STATE_CHANGED:"SystemAudioStateChanged",SCREENSHARE_CONTROL_STATE_CHANGED:"ScreenshareControlStateChanged",CALL_CONTENT_CAMERA_SHARING_CHANGED:"CallContentCameraSharingChanged",CALL_TRANSCRIPT_STATE_EVENT:"CallTranscriptStateEvent",CALL_TRANSCRIPT_ENTRY_EVENT:"CallTranscriptEntryEvent",CALL_TRANSCRIPT_EDIT_EVENT:"CallTranscriptEditEvent",CALL_AUDIENCE_SCENE_CHANGED:"CallAudienceSceneChanged",CALL_AUDIENCE_SELECT_SCENE_ACK:"CallAudienceSelectSceneAck",CALL_AUDIENCE_SCENE_SEATING_CHANGED:"AudienceSceneSeatingChanged",CLOSED_CAPTIONS_ENTRY_EVENT:"ClosedCaptionsEntryEvent",CLOSED_CAPTIONS_DYNAMIC_ENTRY_EVENT:"ClosedCaptionsDynamicEntryEvent",REAL_TIME_TEXT_ENTRY_EVENT:"RealTimeTextEntryEvent",SIGN_LANGUAGE_EVENT:"SignLanguageEvent",AI_INTERPRETATION_SIGNAL_EVENT:"AiInterpretationSignalEvent",ONGOING_CONSULTATION_EVENT:"OngoingConsultationEvent",PARKED_CALLS_OR_SLA_REGISTRY_CHANGED_EVENT:"ParkedCallsOrSLARegistryChangedEvent",CALLING_AGGREGATE_SETTINGS_CHANGED_EVENT:"CallingAggregateSettingsChangedEvent",CALL_QUEUE_INTENT_ID_TEAMS_CALL_ID_CHANGED_EVENT:"CallQueueIntentIdTeamsCallIdChangedEvent",ESCALATED_CALL_CONVERSATION_CHANGED_EVENT:"EscalatedCallConversationChangedEvent",TEAMS_CALL_ID_CHANGED:"TeamsCallIdChanged",AGENT_MONITOR_ENDED:"AgentMonitorEndedEvent",VIDEO_AVAILABLE_FOR_CONVERSATION_CHANGED:"VideoAvailableForConversationChanged",CALL_INCOMING_VIDEO_ON_CHANGED:"CallIncomingVideoOnChanged",CALLING_INTENT_EVENT:"CallingIntentEvent",COMPANION_STREAM_ADDED_EVENT:"CompanionStreamAdded",COMPANION_STREAM_REMOVED_EVENT:"CompanionStreamRemoved",CALL_HOLOGRAPHIC_ANNOTATION_EVENT:"CallHolographicAnnotationEvent",CALL_HOLOGRAPHIC_CALL_STATE_CHANGED:"CallHolographicCallStateChanged",CALL_PHONE_NUMBER_POLICY_CHANGED:"CallPhoneNumberPolicyChanged",CALLING_ALLOWED_EVENT:"IsCallingAllowedChanged",HARDWARE_OUT_DEVICE_CHANGED:"HardwareOutDeviceChanged",PSTN_CALLING_ALLOWED_EVENT:"IsPSTNCallingAllowedChanged",SCD_STATUS_UPDATE:"ScdStatusUpdate",BUDDY_GROUP_UPDATED_EVENT:"buddyGroupChanged",BUDDY_GROUPS_CHANGED_EVENT:"buddyGroupsChangedEvent",CALL_TECHNICAL_INFO_EVENT:"CallTechnicalInfoEvent",DELEGATE_SETTINGS_CHANGED:"DelegateSettingChanged",CALLABLE_CHANNEL_UPDATED_EVENT:"CallableChannelUpdated",OVERFLOW_ROOM_CALL_STATE_CHANGE:"OverflowRoomCallStateChange",OVERFLOW_ROOM_FOUND_FOR_INTENT_EVENT:"OverflowRoomFoundForIntentEvent",CALLING_SCREEN_STATUS_CHANGED:"CallingScreenStatusChanged",APP_SCREEN_SHARE_STOPPED_EVENT:"AppScreenShareStoppedEvent",MEETING_JOIN_FROM_TEAMS_DEVICE_EVENT:"MeetingJoinFromTeamsDeviceEvent",CALLING_CLIENT_STATE_EVENT:"CallingClientStateEvent",CALL_COMPOSITOR_FAILED_EVENT:"CallCompositorFailedEvent",SLA_CALLS_CHANGED:"SLACallsChanged",ONGOING_PA_CALLS_CHANGED:"OngoingPaCallsChanged",SPATIAL_AUDIO_CONFIGS_CHANGED:"SpatialAudioConfigsChanged",SPATIAL_AUDIO_TOGGLE_CHANGED:"SpatialAudioToggleChanged",START_STREAM_EVENT:"VideoStreamStarted",CALLING_LOCAL_MEDIA_STREAM_EVENT:"CallingLocalMediaStreamEvent",ACTIVE_CALLS_CHANGED_EVENT:"ActiveCallsChanged",CONNECTED_CALLS_CHANGED_EVENT:"ConnectedCallsChanged",NETWORK_ROAMING_POLICY_CHANGED_EVENT:"NetworkRoamingPolicyChangedEvent",CALL_HEALTH_CATEGORIES_UPDATED_EVENT:"callHealthCategoriesUpdatedEvent",EMERGENCY_ADDRESS_UPDATED_EVENT:"emergencyAddressUpdatedEvent",NETWORK_INFO_CHANGED:"networkInfoChanged",CALL_FORWARDING_SETTINGS_CHANGED_EVENT:"callForwardingSettingsChangedEvent",EMERGENCY_CUSTOM_DISCLAIMER_UPDATED_EVENT:"emergencyCustomDisclaimerUpdatedEvent",EMERGENCY_NUMBERS_UPDATED_EVENT:"emergencyNumbersUpdatedEvent",PTZ_REMOTE_PARTICIPANTS_CHANGED:"PtzRemoteParticipantsChanged",PTZ_HANDLER_FAILED:"PtzHandlerFailed",PTZ_REMOTE_CONTROL_DEVICE_STATE_CHANGED:"PtzRemoteControlDeviceStateChanged",PTZ_SESSION_STATUS_CHANGED:"PtzSessionStatusChanged",CALL_FRAME_SIZE_CHANGED:"FrameSizeChanged",E2EE_STATUS_CHANGED_EVENT:"E2eeStatusChangedEvent",LIVE_STREAM_CHANGED_EVENT:"LiveStreamChangedEvent",HAS_ONGOINGCALLS_CHANGED_EVENT:"hasOngoingCallsChangedEvent",CALL_MUTE_NOTIFICATIONS_CHANGED_EVENT:"callMuteNotificationsChangedEvent",VIDEO_CAPABILITY_LIMITS_CHANGED_EVENT:"VideoCapabilityLimitsChangedEvent",VIDEO_LAYOUT_API_CAPABILITIES_CHANGED_EVENT:"VideoLayoutCapabilitiesChangedEvent",ROOM_REMOTE_STATE_UPDATE_EVENT:"roomRemoteStateUpdateEvent",ROOM_REMOTE_CAPABILITIES_UPDATE_EVENT:"roomRemoteCapabilitiesUpdateEvent",ROOM_REMOTE_PROXIMITY_BANNER_EVENT:"roomRemoteProximityBannerEvent",FRAME_SINK_EVENTS_CHANGED_EVENT_V2:"framesinkEventsChangedEventV2",NETWORK_STRENGTH_INDICATOR_CHANGED:"networkStrengthIndicatorChanged",PREVIEW_RENDERER_VIDEO_ERROR_CHANGED:"previewRendererVideoErrorChanged",NATIVE_MEETING_STAGE_EVENTS_CHANGED_EVENT:"nativeMeetingStageEventsChangedEvent",VIDEO_EFFECT_READINESS_CHANGED:"videoEffectReadinessChanged",VIDEO_EFFECT_TEXTURE_STREAM_STARTED:"videoEffectTextureStreamStarted",WINDOWS_EFFECTS_CAPABILITY_CHANGED:"windowsEffectsCapabilityChanged",WINDOWS_AI_CAPABILITY_CHANGED:"windowsAICapabilityChanged",VIDEO_EFFECT_CAPABILITIES_CHANGED:"videoEffectCapabilitiesChanged",AUTO_CAMERA_SETTINGS_CHANGED:"autoCameraSettingsChanged",PARTICIPANTS_ON_CALL_CONNECTED:"participantsOnCallConnected",THIRD_PARTY_DEVICE_PAIRING_REQUEST:"thirdPartyDevicePairingRequest",THIRD_PARTY_DEVICE_MEETING_REACTION_REQUEST:"thirdPartyDeviceMeetingReactionRequest",THIRD_PARTY_DEVICE_TOGGLE_REQUEST:"thirdPartyDeviceToggleRequest",CURRENT_SEAT_MAPPING_CHANGED_EVENT:"currentSeatMappingChangedEvent",AUDIO_STOPPED_EVENT:"AudioStoppedEvent",VIDEO_EXTENSIBILITY_STREAM_INFO_EVENT:"videoExtensibilityStreamInfoEvent",VIDEO_EXTENSIBILITY_PERFORMANCE_EVENT:"videoExtensibilityPerformanceEvent",VIDEO_EXTENSIBILITY_LIFECYCLE_EVENT:"videoExtensibilityLifecycleEvent",VDI_CONNECTED_STATE_EVENT:"vdiConnectionStateEvent",VDI_SLIMCORE_OPTIMIZED_STATE_EVENT:"vdiSlimCoreOptimizedStateEvent",VDI_STATUS_INDICATOR_STATE_EVENT:"vdiStatusIndicatorStateEvent",VDI_CAPABILITIES_EVENT:"vdiCapabilitiesEvent",IMMERSIVE_VIEW_CHANGED_EVENT:"immersiveViewChangedEvent",IMMERSIVE_EVENT_CHANGED_EVENT:"immersiveEventChangedEvent",ATTENDEE_COUNT_UPDATED:"AttendeeCountUpdated",ATTENDEE_TRANSCRIPTION_UPDATED:"AttendeeTranscriptionUpdated",QNA_FEED_UPDATED:"QnaFeedUpdated",AUTO_HAND_RAISE_COACHMARK_STATE_CHANGED:"autoHandRaiseCoachmarkStateChanged",COPILOT_BOT_NOTIFICATION_EVENT:"CopilotBotNotificationEvent",MEETING_COMMAND_PANEL_EVENT:"MeetingCommandPanelEvent",MEETING_ROOM_CONTROL_VISIBILITY_CHANGED_EVENT:"meetingRoomControlVisibilityChangedEvent",MEETING_ROOM_SELECTED_LAYOUT_CHANGED_EVENT:"meetingRoomSelectedLayoutChangedEvent",MEETING_REACTIONS_EVENT:"MeetingReactionsEvent",MONITORING_SESSION_DATA_CHANGED:"MonitoringSessionDataChanged",MICROPHONE_SIGNAL_LEVEL_CHANGED_EVENT:"MicrophoneSignalLevelChangedEvent",PERIPHERALS_EVENT_PROVIDER_EVENT:"PeripheralsEventProviderEvent",BREAKOUT_ROOMS_EVENT:"BreakoutRoomsEvent",COMMAND_PANEL_EVENT:"CommandPanelEvent",BYOD_ROOM_SPEAKER_ATTRIBUTION_CHANGED_EVENT:"ByodRoomSpeakerAttributionChangedEvent",MEETING_INTERPRETATION_STATUS_CHANGED_EVENT:"MeetingInterpretationStatusChangedEvent"},tM={Default:"Default",Mto:"Mto",Ccm:"Ccm",Eotp:"Eotp",UserLicenseNotPresentTrialEligible:"UserLicenseNotPresentTrialEligible"},tP={Member:"Member",Anonymous:"Anonymous",Guest:"Guest"};(n=eC||(eC={})).like="like",n.heart="heart",n.laugh="laugh",n.surprised="surprised",n.applause="applause",(a=ev||(ev={})).OneTimePasscode="ONE_TIME_PASSCODE",a.Unknown="UNKNOWN",(r=ef||(ef={})).Grid="Grid",r.LargeGrid="LargeGrid",r.Audience="Audience",r.FrontRow="FrontRow",r.ContentOnly="ContentOnly",r.ContentAndPeople="ContentAndPeople",r.PeopleOnly="PeopleOnly",r.MixedGridView="MixedGridView",r.PrioritizeVideoView="PrioritizeVideoView",(o=eb||(eb={}))[o.GroupCreated=0]="GroupCreated",o[o.GroupRenamed=1]="GroupRenamed",o[o.GroupDeleted=2]="GroupDeleted",o[o.GroupMembersUpdated=3]="GroupMembersUpdated",(s=ey||(ey={}))[s.Unknown=0]="Unknown",s[s.Online=1]="Online",s[s.OnPrem=2]="OnPrem",(l=eT||(eT={}))[l.Presenting=0]="Presenting",l[l.InCall=1]="InCall",l[l.InBroadcast=2]="InBroadcast",l[l.Interactive=3]="Interactive",l[l.Inactive=4]="Inactive",l[l.LongInactive=5]="LongInactive",l[l.Disabled=6]="Disabled",l[l.Disconnected=7]="Disconnected",l[l.Offline=8]="Offline",l[l.Uninitialized=9]="Uninitialized",(c=eI||(eI={}))[c.MachineActive=1]="MachineActive",c[c.MachineInactive=2]="MachineInactive",c[c.MachineLongInactive=4]="MachineLongInactive",c[c.MachineLocked=8]="MachineLocked",(d=eA||(eA={})).Connecting="Connecting",d.Connected="Connected",d.Disconnected="Disconnected",(g=eE||(eE={}))[g.NotSupported=1]="NotSupported",g[g.FullySupported=2]="FullySupported",(h=eM||(eM={}))[h.Regular=0]="Regular",h[h.Private=1]="Private",h[h.Shared=2]="Shared",h[h.Standalone=9]="Standalone",(p=eP||(eP={}))[p.Exchange=0]="Exchange",p[p.BuddyList=1]="BuddyList",p[p.MiddleTier=2]="MiddleTier",p[p.SerializedData=3]="SerializedData",(u=ek||(ek={}))[u.None=0]="None",u[u.Error=1]="Error",u[u.Warn=2]="Warn",u[u.Info=3]="Info",u[u.Debug=4]="Debug",u[u.Verbose=5]="Verbose",u[u.Max=6]="Max",(m=eD||(eD={}))[m.Strict=0]="Strict",m[m.Moderate=1]="Moderate",m[m.NoRestriction=2]="NoRestriction",(_=eR||(eR={})).Rendering="Rendering",_.FirstFrameRendered="FirstFrameRendered",_.Stopped="Stopped",(S=ew||(ew={}))[S.SfC=0]="SfC",S[S.Tfl=1]="Tfl",S[S.Unknown=2]="Unknown",(C=eF||(eF={}))[C.Content=0]="Content",C[C.Cards=1]="Cards",C[C.Files=2]="Files",(v=eN||(eN={}))[v.NORMAL=0]="NORMAL",v[v.HIGH=2]="HIGH",v[v.URGENT=3]="URGENT";class tk{}tk.EventType_Batched=tA.R.Type_List,tk.EventType_TopicChanged=tA.R.Type_Conversation;class tD{}tD.Type_Conversation="%conversation",(f=eO||(eO={}))[f.MsftTeamsRoom=0]="MsftTeamsRoom",f[f.PersonalClient=1]="PersonalClient",f[f.CompanionDevice=2]="CompanionDevice",(b=eL||(eL={}))[b.None=0]="None",b[b.Network=1]="Network",b[b.Local=2]="Local",(y=eU||(eU={}))[y.RoleCheckFail=5625]="RoleCheckFail";let tR={None:0,FreezeFrame:1,GroupCall:2,IsNonARDevice:4};(T=eB||(eB={}))[T.E164=0]="E164",T[T.INTERNATIONAL=1]="INTERNATIONAL",T[T.NATIONAL=2]="NATIONAL",T[T.RFC3966=3]="RFC3966",(I=ex||(ex={}))[I.None=0]="None",I[I.Daily=1]="Daily",I[I.Weekly=2]="Weekly",I[I.Monthly=3]="Monthly",I[I.RelativeMonthly=4]="RelativeMonthly",I[I.Yearly=5]="Yearly",I[I.RelativeYearly=6]="RelativeYearly",(A=eV||(eV={}))[A.Sunday=0]="Sunday",A[A.Monday=1]="Monday",A[A.Tuesday=2]="Tuesday",A[A.Wednesday=3]="Wednesday",A[A.Thursday=4]="Thursday",A[A.Friday=5]="Friday",A[A.Saturday=6]="Saturday",(E=eH||(eH={}))[E.First=0]="First",E[E.Second=1]="Second",E[E.Third=2]="Third",E[E.Fourth=3]="Fourth",E[E.Last=4]="Last",(M=eG||(eG={}))[M.January=1]="January",M[M.February=2]="February",M[M.March=3]="March",M[M.April=4]="April",M[M.May=5]="May",M[M.June=6]="June",M[M.July=7]="July",M[M.August=8]="August",M[M.September=9]="September",M[M.October=10]="October",M[M.November=11]="November",M[M.December=12]="December",(P=eW||(eW={}))[P.userEventUsingEventId=0]="userEventUsingEventId",P[P.teamEventUsingEventId=1]="teamEventUsingEventId",P[P.userEventUsingICalUId=2]="userEventUsingICalUId",P[P.teamEventUsingICalUId=3]="teamEventUsingICalUId",P[P.userSeriesEventUsingOccurenceEventId=4]="userSeriesEventUsingOccurenceEventId",(k=e$||(e$={})).ItemAttachment="ItemAttachment",k.FileAttachment="FileAttachment",k.ReferenceAttachment="ReferenceAttachment",(D=ez||(ez={}))[D.Initializing=0]="Initializing",D[D.NotAvailable=1]="NotAvailable",(R=eq||(eq={}))[R.AcceptIncomingCallWithVideo=0]="AcceptIncomingCallWithVideo",R[R.AcceptIncomingCallWithAudio=1]="AcceptIncomingCallWithAudio",R[R.AcceptIncomingScreenshareOnlyCall=2]="AcceptIncomingScreenshareOnlyCall",R[R.RejectIncomingCall=6]="RejectIncomingCall",R[R.RejectIncomingScreenshareOnlyCall=7]="RejectIncomingScreenshareOnlyCall",R[R.OpenChatList=13]="OpenChatList",R[R.GoToCurrentCall=21]="GoToCurrentCall",R[R.ToggleMuteCurrentCall=22]="ToggleMuteCurrentCall",R[R.ToggleVideoCurrentCall=23]="ToggleVideoCurrentCall",R[R.ToggleVideoSharingCurrentCall=24]="ToggleVideoSharingCurrentCall",R[R.ToggleBackgroundBlurCurrentCall=25]="ToggleBackgroundBlurCurrentCall",R[R.ToggleSpeakerMuteCurrentCall=26]="ToggleSpeakerMuteCurrentCall",R[R.JoinMeetingFromToast=116]="JoinMeetingFromToast",R[R.PushToTalk=100]="PushToTalk",(w=ej||(ej={})).Default="Default",w.HostMode="HostMode",w.Unknown="Unknown",(F=eJ||(eJ={})).Townhall="firstparty_21f91ef7-6265-4064-b78b-41ab66889d90",F.Webinar="firstparty_d892ef44-003e-480c-9929-07349265a2e2",(N=eQ||(eQ={})).stateChanged="stateChanged",N.initialize="initialize",N.destroyed="destroyed",(O=eK||(eK={})).Ready="ready",O.Listening="listening",O.Thinking="thinking",O.Speaking="speaking",(L=eY||(eY={}))[L.Small=1]="Small",L[L.Medium=2]="Medium",L[L.Large=3]="Large",(U=eZ||(eZ={}))[U.Idle=0]="Idle",U[U.InMeeting=1]="InMeeting",U[U.Incoming=2]="Incoming",(eX||(eX={})).FailedToCreatePreviewRenderer="failed-to-create-preview-renderer",(B=e0||(e0={}))[B.Unrecognized=0]="Unrecognized",B[B.Local=1]="Local",B[B.Devspaces=2]="Devspaces",B[B.Alpha=3]="Alpha",(x=e1||(e1={}))[x.Unset=0]="Unset",x[x.Basic=1]="Basic",x[x.Full=2]="Full",x[x.Zero=3]="Zero",(V=e2||(e2={}))[V.ToastBody=0]="ToastBody",V[V.ToastButton=1]="ToastButton",V[V.ToastDismiss=2]="ToastDismiss",V[V.TimeOut=3]="TimeOut",V[V.Error=4]="Error",(H=e3||(e3={}))[H.All=0]="All",H[H.CallMentionChats=1]="CallMentionChats",H[H.Off=2]="Off",(G=e5||(e5={}))[G.Ring=0]="Ring",G[G.Mute=1]="Mute",G[G.Banner=2]="Banner";let tw={Immediate:0,0:"Immediate",Simultaneous:1,1:"Simultaneous",Unanswered:2,2:"Unanswered"},tF={Voicemail:0,SingleTarget:1,MyDelegates:2,DoNothing:3},tN={Voicemail:0,0:"Voicemail",SingleTarget:1,1:"SingleTarget",MyDelegates:2,2:"MyDelegates",DoNothing:3,3:"DoNothing",Group:4,4:"Group"};(W=e4||(e4={}))[W.EXTERNAL_CALLING_SCREEN_FRAME_SINK_EMIT=1]="EXTERNAL_CALLING_SCREEN_FRAME_SINK_EMIT",W[W.EXTERNAL_CALLING_SCREEN_FRAME_SINK_INVOKE=2]="EXTERNAL_CALLING_SCREEN_FRAME_SINK_INVOKE",W[W.EXTERNAL_CALLING_SCREEN_VIDEO_RENDERER_EMIT=3]="EXTERNAL_CALLING_SCREEN_VIDEO_RENDERER_EMIT",W[W.EXTERNAL_CALLING_SCREEN_VIDEO_RENDERER_INVOKE=4]="EXTERNAL_CALLING_SCREEN_VIDEO_RENDERER_INVOKE",($=e6||(e6={}))[$.Saving=0]="Saving",$[$.Sending=1]="Sending",$[$.Uploading=2]="Uploading",$[$.Downloading=3]="Downloading",$[$.CallingOrMeeting=4]="CallingOrMeeting",$[$.Moving=5]="Moving",$[$.Copying=6]="Copying",$[$.CallingOrchestration=7]="CallingOrchestration",(z=e7||(e7={}))[z.Wiki=0]="Wiki",z[z.Files=1]="Files",z[z.Calling=2]="Calling",(q=e9||(e9={}))[q.AutoSaving=0]="AutoSaving",q[q.Downloading=1]="Downloading",q[q.Uploading=2]="Uploading",q[q.Meeting=3]="Meeting",q[q.Broadcast=4]="Broadcast",q[q.OneOnOne=5]="OneOnOne",q[q.Moving=6]="Moving",q[q.Copying=7]="Copying",(j=e8||(e8={}))[j.Pending=0]="Pending",j[j.Executing=1]="Executing",j[j.Completed=2]="Completed",(J=te||(te={}))[J.RealTime=0]="RealTime",J[J.High=1]="High",J[J.Normal=2]="Normal",J[J.Background=3]="Background",(Q=tt||(tt={}))[Q.Uninitialized=0]="Uninitialized",Q[Q.SignedOut=1]="SignedOut",Q[Q.SigningIn=2]="SigningIn",Q[Q.SignedIn=3]="SignedIn",Q[Q.SigningOut=4]="SigningOut",Q[Q.ShuttingDown=5]="ShuttingDown",(K=ti||(ti={})).Initializing="Initializing",K.Unrecoverable="Unrecoverable",K.LongInactive="LongInactive",K.Inactive="Inactive",K.Active="Active",K.VeryActive="VeryActive",(Y=tn||(tn={}))[Y.Low=1]="Low",Y[Y.Medium=4]="Medium",Y[Y.High=16]="High",(Z=ta||(ta={}))[Z.Offline=0]="Offline",Z[Z.Online=1]="Online",Z[Z.Busy=2]="Busy",Z[Z.Away=3]="Away",Z[Z.Idle=4]="Idle",Z[Z.OnThePhone=5]="OnThePhone",Z[Z.OutToLunch=6]="OutToLunch",Z[Z.BeRightBack=7]="BeRightBack",Z[Z.Hidden=8]="Hidden",Z[Z.Disabled=9]="Disabled",Z[Z.AppearAway=10]="AppearAway",Z[Z.Reset=11]="Reset",Z[Z.OutOfOffice=12]="OutOfOffice",Z[Z.Presenting=13]="Presenting",Z[Z.InAMeeting=14]="InAMeeting",Z[Z.Unknown=15]="Unknown",Z[Z.OnShift=16]="OnShift",Z[Z.OffShift=17]="OffShift",Z[Z.Focusing=18]="Focusing",Z[Z.Blocked=19]="Blocked",Z[Z.AppearOffline=20]="AppearOffline",(X=tr||(tr={})).disabled="Disabled",X.enabledUserOverride="EnabledUserOverride",X.disabledUserOverride="DisabledUserOverride",(ee=to||(to={}))[ee.Unknown=0]="Unknown",ee[ee.UnsupportedCommandServiceMethod=98]="UnsupportedCommandServiceMethod",(et=ts||(ts={}))[et.None=0]="None",et[et.Organizer=1]="Organizer",et[et.Tentative=2]="Tentative",et[et.Accepted=3]="Accepted",et[et.Declined=4]="Declined",et[et.NotResponded=5]="NotResponded",(ei=tl||(tl={}))[ei.AdminUserLicenseNotPresentForbidden=0]="AdminUserLicenseNotPresentForbidden",ei[ei.AdminTeamsDisabledForTenantForbidden=1]="AdminTeamsDisabledForTenantForbidden",ei[ei.UserLicenseNotPresentForbidden=2]="UserLicenseNotPresentForbidden",ei[ei.TeamsDisabledForTenantForbidden=3]="TeamsDisabledForTenantForbidden",ei[ei.UserLicenseNotPresentTrialEligible=4]="UserLicenseNotPresentTrialEligible",ei[ei.TrialLicenseTenantNotReady=5]="TrialLicenseTenantNotReady",ei[ei.NewFederatedUsersNotAllowed=6]="NewFederatedUsersNotAllowed",(en=tc||(tc={})).searchSuggestions="searchSuggestions",en.searchResults="searchResults",en.addToChat="addToChat",en.addToTeam="addToTeam",en.newChat="newChat",en.escalateMessage="escalateMessage",en.transfer="transfer",en.addToCall="addToCall",en.callRouting="callRouting",en.callForwardGroupSelection="callForwardGroupSelection",en.delegationSelection="delegationSelection",en.presenceSettings="presenceSettings",en.addToMeeting="addToMeeting",en.meetingSchedule="meetingSchedule",en.addToSpeedDialOrContacts="addToSpeedDialOrContacts",en.atMention="atMention",en.atMentionSC="atMentionSharedChannels",en.orgChart="orgChart",en.priorityContactsSelection="priorityContactsSelection",en.taggedContactsSelection="taggedContactsSelection",en.statusNote="statusNote",en.voicemailTransferTarget="voicemailTransferTarget",en.searchExpoDisplays="searchExpoDisplays",en.rigelMeeting="rigelMeeting",en.addToSurfaceHubPrivateMeeting="addToSurfaceHubPrivateMeeting",en.sharedChannel="sharedChannel",en.addToMeetingForSharedChannel="addToMeetingForSharedChannel",en.aadTenant="aadTenant",en.adaptiveCard="adaptiveCard",en.selectPeoplePicker="selectPeoplePicker",en.allFalse="allFalse",en.allTrue="allTrue",en.custom="custom",en.default="default",(ea=td||(td={}))[ea.None=0]="None",ea[ea.Reserved=1]="Reserved",ea[ea.Dynamic=2]="Dynamic",(er=tg||(tg={}))[er.Principal=1]="Principal",er[er.Manager=2]="Manager",er[er.Peer=3]="Peer",er[er.InOrg=4]="InOrg",(eo=th||(th={}))[eo.callHistory=0]="callHistory",eo[eo.callVoicemail=1]="callVoicemail",eo[eo.callSpeedDial=2]="callSpeedDial",(es=tp||(tp={})).Mobile="Mobile",es.Business="Business",es.Other="Other",es.Home="Home",(el=tu||(tu={})).none="none",el.setLayout="setLayout",el.start="start",el.stop="stop",el.switchPrimary="switchPrimary",el.failoverInstance="instanceFailover",el.updateMediaState="updateMediaState",el.restart="restart",(ec=tm||(tm={}))[ec.successResponse=0]="successResponse",ec[ec.toggleEffectFailure=-1]="toggleEffectFailure",ec[ec.noCameraFailure=-2]="noCameraFailure",ec[ec.slimcoreNoBinding=-3]="slimcoreNoBinding",(ed=t_||(t_={}))[ed.AttendanceReportDisabledInERCMeeting=5238]="AttendanceReportDisabledInERCMeeting",ed[ed.TrackInReportDisabledInERCMeeting=5239]="TrackInReportDisabledInERCMeeting",(eg=tS||(tS={})).AttendanceReportDisabledInERCMeeting="AttendanceReportDisabledInERCMeeting",eg.TrackInReportDisabledInERCMeeting="TrackInReportDisabledInERCMeeting",(eh=tC||(tC={})).ConsentStateOrAVOutputStateNotCorrect="ConsentStateOrAVOutputStateNotCorrect",eh.StartRecordingFailed="StartRecordingFailed",eh.StartRecordingCancelled="StartRecordingCancelled",eh.ExpectedStartRecordingFailure="StartRecordingFailedDueToExpectedFailure",(tv||(tv={})).NoNetwork="NoNetwork",(ep=tf||(tf={}))[ep.Bluetooth=1]="Bluetooth",ep[ep.Ultrasound=2]="Ultrasound",ep[ep.QrCode=3]="QrCode",ep[ep.CopilotQR=4]="CopilotQR",(eu=tb||(tb={})).None="none",eu.InTenant="inTenant",eu.Federated="federated",eu.NonFederated="nonFederated",eu.Anonymous="anonymous",eu.CrossCloudAuthenticated="crossCloudAuthenticated",eu.EmailVerifiedAnonUser="emailVerifiedAnonUser",(em=ty||(ty={})).EnabledForAnyone="EnabledForAnyone",em.EnabledForTrustedOrgs="EnabledForTrustedOrgs",em.Disabled="Disabled",(e_=tT||(tT={})).Enabled="Enabled",e_.Disabled="Disabled",(eS=tI||(tI={}))[eS.none=0]="none",eS[eS.disabled=1]="disabled",eS[eS.pending=2]="pending",eS[eS.waiting=3]="waiting",eS[eS.started=4]="started",eS[eS.stopping=5]="stopping",eS[eS.stopped=6]="stopped",eS[eS.failed=7]="failed",eS[eS.failedToStop=8]="failedToStop",eS[eS.waitingformeetinglive=9]="waitingformeetinglive"},30387:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u;i.d(t,{Fj:()=>o,O4:()=>s,bo:()=>n,ex:()=>a,lJ:()=>l}),(c=n||(n={}))[c.disabled=0]="disabled",c[c.inControl=1]="inControl",c[c.notInControl=2]="notInControl",c[c.showDisabledRequestControl=3]="showDisabledRequestControl",(d=a||(a={})).start="start",d.stop="stop",d.collaborate="collaborate",d.readOnly="readonly",d.clear="clear",(g=r||(r={})).add="add",g.remove="remove",(h=o||(o={}))[h.sendingRequest=0]="sendingRequest",h[h.responseInControl=1]="responseInControl",h[h.responseNotInControl=2]="responseNotInControl",(p=s||(s={})).KeyboardControlEvent="keyboardControlEvent",p.MouseControlEvent="mouseControlEvent",(u=l||(l={}))[u.Request=0]="Request",u[u.Release=1]="Release"},441707:function(e,t,i){i.d(t,{g:()=>S});var n,a,r=i(370574),o=i(30387),s=i(892891),l=i(395250),c=i(945761),d=i(139062),g=i(575810),h=i(377957);class p{static getRoundImage(e,t){let i=t.createDeferred();if(!e.split("base64,")[1])return i.reject("Image is not valid base64"),i.promise;let n=new Image;return n.addEventListener("load",()=>this.renderRoundImage(n,i),!1),n.src=e,i.promise}static renderRoundImage(e,t){let i=document.createElement("canvas");try{let n=i.getContext("2d"),a=this.squarifyImage(e);i.width=a,i.height=a;let r=a/2;n.save(),n.beginPath(),n.arc(r,r,r,0,2*Math.PI,!0),n.closePath(),n.clip(),n.drawImage(e,0,0,a,a);let o=i.toDataURL();t.resolve(o)}catch(e){t.reject(`failed to drawImage ${e}`)}}static squarifyImage(e){return e.height<e.width?e.height:e.width}}p.imageHeader="data:image/png;base64,",p.roundedDoughBoy="iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAFIUlEQVRYR82Yf0xVZRjHv88FrrlSVMK0TFC2RJoVuLlBP5hpcK8x2qqB1ZI/NMEwRUTkXly7c4EIcgWGBkYrQzcxapN+XCBLWaZlU2wrUtqA1GopMqEhv+Q87Rw8BPde7j3v4a66f7Cx836/z+c87/s+z3tegs6f2VIWLNHt5QZgGZjDQBTKzAtkOyJqZ6CdgDYJOAsjjjfYMrv0hCIRUbx171yC9AYxJYCwRETLwHkwPmei/Q35W/7QqtUEKIMZWMoGKBWEqVrN3Y5j9DGhgkFFWkA9AvoUzJn2Dmi/Uco/acvqnOilJwR82GYzzh+cXgogbVIZ8y6uuGzs2fyTzTbobqhbwBWW8qAAGqgjUIx3/8mPYPDpIZ6S+OWujTec3VwAl66vDAgO6m0iQvTkQ2t3YPCp6533PH3uQOrQWJULoMlSXEFEqdqtfTeSmSvrd20dt6TGAcbn2tMMjLd9F1LcSSJsaMjLrFCVo4CrthXOkQL82gl0l7itDxWMPokoTC1Bo4CTmdrI0PuxatkjCJkTrJBe7+7BmR9/wafnWvSSlzryMzOUriT/WZmzd2EAcSsIfqKOuUkmPP7oYlz9sxMtHVcVeejcYDw0/wG0Xv4NOw99gq7ePjHbMVlUAE0W+/tESBFzAWS4qPAwvPfZCZdsyVndkLhCscx5t1YYUt0wI4BW+0UCFokArn4iCmvMsdh9+BiaWtrcSmfdPRWl6a/gYsdV5B2tF7EHA5fq8zPDKc6yJ9yPDD8LqQGUpCaht38AuQePeZSueyYG5uhIvLBzn2gIDLO0mEwWew4Rdomo5cwcsqZh/8cNXjeCyFhnBmZYyGwpPgKi5P8jIJhryGyxnwQhVgRQHvvRm+n48KszOHLqvEfpwtmzUL45xeNandCA0URma3EHQCGigP/GGpQ3ipzBfhCmiAImLI3A68/H4wNH04RZlLNXlPYSvr7QgpK6E6IhwMzdZLIU3ySiQGE1gIzE5XjysQg4zjSj6ovT4yzkF0heEYMb3T3IqDyqx/4OoI4aODaaWkZu9Q+gr39g9NG8++5Fc2sbimsbhYu0aqJOsa5NIpvIxfrZmCgEBU5TWp3cg2/1DSg9OWjGdCWO3ulVxMom0VFmZK3agxu/u4C6b39A2zXXr0o5u7GREUpm9bQ7pczoKdRqDy6rdUzY5tRpkgt1wdoXdfVkpVCLtjp193rqwc47Qm9PVlqd6GFBa/1zhlRfbGPpQbfLwaXNqYcF+YHZai8BsNlbLZCPUHmvJSP3nRo0d/zubbjL8+rsdWhqbnEpSe6NeLcjf2uOksG4HUULDJKhxdtxX130rxZWCcPJgryU5xSdtxMQg/ulQSmkcc+2a6NHfrO1uACg7Z4iy4U5InQe1pdV6wLUrh/JnhxkFHDl9oJAf0PAr3q7ii5i96IeGP0fdNg29YwDlP+Jt9pfNgCHfRhM3Eri1Y6CrTWq0OXDXctUi0fVqvhnaicEhM1mMA9OOwHQU1ptfTTO4TD2JMBmk8b6ub08issqmu0X4Pc9CPN9FNyjDYOv3B4eWnJ8d06388D//PqNwVVXjH+lC12/jX0L5b5GQrmej3ovaRuWiNIa8rd4LKqaroBNO0oWQRrOImANQMbJTDszhoi4mg1+hfVvZVzy5qUJUDUxZ5fNY/8huYCu9dZ1nAMzcy+IDtBtf7ujcNPIHYmGnxDgWD+TZW80QUpiwjICzQTzTCbMUIor4yYDN0HoAugbJtQ25GWe1cDjMuRvB5EylUlS6sAAAAAASUVORK5CYII=";var u=i(4512),m=i(373649),_=i(654807);(n=a||(a={})).Camera="Camera",n.SystemPicker="System Picker";class S{constructor(e,t,i,n,a,r,o,l,d,g,h,p=c.Wq,u,m){this.config=e,this.sxConfig=i,this.profilePictureLoaderService=n,this.meetingPolicySettingsStore=a,this.authenticationService=r,this.peopleService=o,this.chatServiceUtils=l,this.serviceProvider=d,this.localized=g,this.loggingService=h,this.promiseFactory=p,this.desktopUtilityService=u,this.callingTelemetryService=m,this.screenSharingControlSubscriptionRegistry=[],this.sharingCalls={},this.triggerThrottleMs=1e3,this.throttledCapableViewersEventData={added:[],removed:[],numberOfControlCapableViewers:0},this.throttledTriggerCapableViewersChangedInternal=(0,s.throttle)((...e)=>{this.trigger(...e),this.throttledCapableViewersEventData={removed:[],added:[],numberOfControlCapableViewers:0}},this.triggerThrottleMs),this.logger=h.newLogger("[screenSharing][giveTakeControlService]"),this.asObservable=t.createObservable(),this.initializeOnAppLaunchAndReinit()}initializeOnAppLaunchAndReinit(){this.mwRelay={call:void 0,mwLatencyStatistics:void 0},this.unregisterControlEvents(),this.firstInputSent=!1}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}registerControlEvents(e){let t=this.loggingService.findScenario(l.RG.GiveTakeControlViewerCore);t?.mark(l.ck.RegisterControlEvents),this.controlMouseEventSubscription=e.on(o.O4.MouseControlEvent,e=>this.postScreenSharingControlMessage(o.O4.MouseControlEvent,e)),this.controlKeyboardEventSubscription=e.on(o.O4.KeyboardControlEvent,e=>this.postScreenSharingControlMessage(o.O4.KeyboardControlEvent,e)),this.logger.info("controlCapturer events subscribed")}unregisterControlEvents(){this.controlMouseEventSubscription?.dispose(),this.controlKeyboardEventSubscription?.dispose()}requestControl(e){let t=this.getSharingCall(e);if(!t)return this.logger.info("requestControl fails, sharingCall is missing"),Promise.reject("Sharing call not found");let i=t.call,n=this.newScenarioHoistToCore(i,l.RG.GiveTakeControlViewerStart);if(n.appendEventData({context:"RequestControl"}),i.vbssDetails.multiVbssActive){n?.incomplete({reason:"multiVbss"});let e="requestControl fails, received call with multiple screenshare active";return this.logger.info(e),Promise.reject(e)}let a=this.promiseFactory.createDeferred();if(this._updateControlState(o.bo.disabled,i,t),this.trigger(g.gT.events.calling.controlRequestStateChanged,h.w.getTeamsCallIdAsString(i.teamsCallId),o.Fj.sendingRequest),i.screenSharingControl)n?.mark(l.ck.RequestControlCalled),i.screenSharingControl.requestControl().then(()=>{n?.mark(l.ck.RequestControlSucceeded),this._requestControlSucceeded(t,a)}).catch(e=>{let i=!1,o="requestControlFailed";try{if(e&&e.message){let t=JSON.parse(e.message);t.controlInfo&&(o=r.ControlTerminatedReason[t.controlInfo.terminatedReason],i=this.userTerminatedReason(t.controlInfo.terminatedReason))}}catch(e){n?.fail({reason:o})}i?n?.incomplete({reason:o}):n?.fail({reason:o,error:this.chatServiceUtils.scrubMri(e?.message)}),this._requestControlFailed(e,t,a)});else{this._updateControlState(o.bo.notInControl,i,t);let e="call.screenSharingControl is falsy while requesting control";this.logger.error(e),a.reject(e)}return a.promise}releaseControl(e){let t,i=this.getSharingCall(e);if(!i)return Promise.reject("Sharing call not found");let n=i.call,a=this.loggingService.findScenario(l.RG.GiveTakeControlViewerStart),s=this.promiseFactory.createDeferred();return(n.screenSharingControl?n.screenSharingControl.controlState===r.ControlState.None&&(t="call.screenSharingControl state is none in releaseControl"):t="call.screenSharingControl is null while release control",t)?(this.logger.error(t),s.reject(t)):(this._updateControlState(o.bo.disabled,n,i),n.screenSharingControl.terminateControl().then(()=>{a?.incomplete({reason:"releaseControl"}),this.logger.info("release control complete successfully"),s.resolve()}).catch(e=>{a?.fail({reason:"releaseControlFail"}),this.logger.error(`release control failed with error ${e}.`),this._updateControlState(o.bo.notInControl,n,i),s.reject(e)})),s.promise}startSubscription(e){if(!this.config.enableGiveTakeControlV2())return void this.logger.info("[startSubcription] enableGiveTakeControlV2 is false");let{isWebRTCVdiMode:t,dataChannelSupported:i}=this.config.vdi;if(t()&&!i())return void this.logger.info("[startSubcription] VDI data channel not supported.");e.teamsCallId in this.sharingCalls||null==e.screenSharingControl||(this.logger.info(`startSubscription adding call with id = ${e.callId}`),this.sharingCalls[e.teamsCallId]={call:e,capable:!1,controlState:o.bo.notInControl,sharer:"",capableViewers:[],monitorRect:void 0,windowId:null,controllerName:"",scenarios:new Map},this.createScreenSharingControlSubscriptions(e))}stopSubscription(e){if(!this.config.enableGiveTakeControlV2())return void this.logger.info("[stopSubscription] enableGiveTakeControlV2 is false");this.isCallInSharingCalls(e)?(this.logger.debug(`stopSubscription removing call with id = ${e.callId}`),this.deleteScreenSharingControlSubscriptions(e),delete this.sharingCalls[e.teamsCallId]):this.logger.warn("stopSubscription called for untracked call")}hasSubscription(e){return e.teamsCallId in this.sharingCalls&&this.config.enableGiveTakeControlV2()}cleanupOnAppTeardown(){this.sharingCalls={},this.mwRelay=void 0,this.requestControlActionsDialogAlert=void 0,this.terminateControlAlert=void 0,this.screenSharingControlSubscriptionRegistry=[],this.controllerDisplayName=void 0}acceptControl(e){let t=this.promiseFactory.createDeferred(),i=this.loggingService.findScenario(l.RG.GiveTakeControlPresenterStart),n=this.getSharingCall(e);return n?this.acceptControlForCall(n.call).then(()=>{i?.mark(l.ck.AcceptRequest)}).catch(e=>{throw i?.fail({reason:"accept request failed"}),e}):(this.logger.error("acceptControl fails, sharingCall in missing"),t.reject("Missing sharingCall"),t.promise)}giveControl(e,t){let i=this.getSharingCall(e);if(!i)return this.logger.info("giveControl fails, sharingCall is missing"),Promise.reject("Missing sharingCall");let n=this.newScenarioHoistToCore(i.call,l.RG.GiveTakeControlPresenterStart);if(i?.call.vbssDetails.multiVbssActive){n?.incomplete({reason:"multiVbss"});let e="giveControl fails, received call with multiple screenshare active";return this.logger.info(e),Promise.reject(e)}let a=this.promiseFactory.createDeferred(),r=i.capableViewers.find(e=>e.id===t),o=i.call.participants.find(e=>e.id===t);return void 0!==r&&void 0!==o?(this.controllerDisplayName=this.getControllerDisplayName(o,r),this.setPointerImages(i.call,r).then(()=>{this.logger.info("pointer images are set"),n?.mark(l.ck.AvatarSet)}).catch(e=>{this.logger.info(`setting pointer images failed with error: ${e}`),n?.mark(l.ck.AvatarNotSet)}).then(()=>(this.logger.info("granting control"),i.call.screenSharingControl.grantControl(o))).then(()=>{this.logger.info("give control complete successfully"),n?.mark(l.ck.GiveControl),a.resolve()}).catch(e=>{let t=`give control failed, ${e}`;this.logger.info(t),n?.fail({reason:t});let i={dismissable:!0,type:u.NK.Info,name:"SharingGiveTakeControlError",narrated:!0,title:this.localized.alerts.screenSharingGiveControlError.title(),text:this.localized.alerts.screenSharingGiveControlError.text(),timeout:u.Iq};this.serviceProvider.callingAlertsService().handleOnDemandAlert(i),a.reject(t)})):(this.logger.info("give control failed, capableViewer is undefined"),n?.fail({reason:"capableViewer is undefined"}),a.reject("capableViewer is undefined")),a.promise}denyControl(e){let t=this.promiseFactory.createDeferred(),i=this.loggingService.findScenario(l.RG.GiveTakeControlPresenterStart),n=this.getSharingCall(e);return n?this.denyControlForCall(n.call).then(()=>{n.call.vbssDetails.multiVbssActive?i?.incomplete({reason:"multiVbss"}):i?.incomplete({reason:"user deny request"})}).catch(e=>{throw i?.fail({reason:"deny request failed"}),e}):(this.logger.error("denyControl fails, sharingCall in missing"),t.reject("Missing sharingCall"),i?.fail({reason:"sharingCall is null"}),t.promise)}terminateControl(e){let t=this.promiseFactory.createDeferred(),i=this.loggingService.findScenario(l.RG.GiveTakeControlPresenterStart),n=this.getSharingCall(e);return n?this.terminateControlForCall(n.call).then(()=>{i?.incomplete({reason:"user terminate request"})}).catch(e=>{i?.fail({reason:"terminate request failed"});let t={dismissable:!0,type:u.NK.Info,name:"SharingGiveTakeControlError",narrated:!0,title:this.localized.alerts.screenSharingTakeControlError.title(),text:this.localized.alerts.screenSharingTakeControlError.text(),timeout:u.Iq};throw this.serviceProvider.callingAlertsService().handleOnDemandAlert(t),e}):(this.logger.error("terminateControl fails, sharingCall in missing"),t.reject("Missing sharingCall"),i?.fail({reason:"sharingCall is null"}),t.promise)}getSharedMonitorRect(e){let t=this.getSharingCall(e.teamsCallId);if(t)return t.monitorRect}setSharingSource(e,t){let i;if(!this.config.enableGiveTakeControlV2())return void this.logger.info("ignoring setSharingSource, enableGiveTakeControlV2 is false");if(this.desktopUtilityService.isWeb())return void this.logger.info("ignoring setSharingSource, platform is web");let n=this.getSharingCall(e.teamsCallId);if(!n)return void this.logger.error("setSharingSource fails, sharingCall in missing");switch(t.getType()){case r.SharingSourceType.Window:n.windowId=t.getId(),n.monitorRect=void 0;break;case r.SharingSourceType.Camera:n.windowId=void 0,n.monitorRect=void 0;break;case r.SharingSourceType.Monitor:default:{n.windowId=void 0;let e={x:0,y:0,width:0,height:0};t.getBounds&&t.getBounds()?n.monitorRect=t.getBounds()||e:(this.logger.error("source.getbounds is null/undefined"),n.monitorRect=e)}}let s=e.screenSharingControl;if(!s)return void this.logger.error("call.screenSharingControl is null/undefined");let c=!0,d=!1,g=this.shouldEnableControl(t,e);g&&(i=this.newScenarioHoistToCore(e,l.RG.GiveTakeControlPresenterCore)),this.config.enableGiveControlPolicy()&&t.getType()!==r.SharingSourceType.Camera&&!e.systemPickerSharingActive&&(c=this.meetingPolicySettingsStore.getSettingValue("allowParticipantGiveRequestControl"),d=this.meetingPolicySettingsStore.getSettingValue("allowExternalParticipantGiveRequestControl"),this.isAnonOrGuest()&&(c=!0,d=!0,this.logger.info("User is guest/anon, allowParticipantGiveRequestControl and allowExternalParticipantGiveRequestControl policies set to true")),i?.mark(l.ck.PolicySet),this.logger.info(`enableGiveControlPolicy is set. allowParticipant ${c} externalParticipant ${d}`));let h=t.getType()===r.SharingSourceType.Camera?a.Camera:e.systemPickerSharingActive?a.SystemPicker:null;if(h&&(c=!1,d=!1,this.logger.info(`${h} sharing, GTC is not allowed`)),this.config.vdi.isWebRTCVdiMode()){let e=t.getType()===r.SharingSourceType.Window&&!this.config.vdi.enableAppSharingControl?.();c=c&&this.config.vdi.isGiveControlSupported()&&!e,d=d&&this.config.vdi.isGiveControlSupported()&&!e,this.logger.info(`[setSharingSource] VDI - allowParticipantGiveRequestControl=${c} allowExternalParticipantGiveRequestControl=${d} isGiveControlSupported=${this.config.vdi.isGiveControlSupported()} disabledForAppSharing=${e}`)}e.disableGiveControl=!c,c?this.config.vdi.isWebRTCVdiMode()&&this._updateControlState(o.bo.notInControl,e,n):this._updateControlState(o.bo.showDisabledRequestControl,e,n);try{s.enableScreenSharingControl(g,null,null,e=>this.allowControlForUser(e,c,d)),i?.mark(l.ck.ControlEnabled)}catch{i?.fail({reason:"enableScreenSharingControl failed"})}}allowControlForUser(e,t,i){return new Promise((n=>{if(!t){this.logger.info("allowParticipantGiveRequestControl policy is false. not allowing control for user"),n(!1);return}if(!i){if(!e||!e.id){this.logger.error("participant or id of the participant is null"),n(!1);return}this.authenticationService.getUserInformation().then(t=>{let i=t?.profile?.tid;this.isExternalParticipant(e,i).then(e=>n(!e))}).catch(e=>{this.logger.error(`getUserInformation failed with error ${e}.`),n(!1)});return}n(!0)}).bind(this))}getControlState(e){let t=this.getSharingCall(e);if(t)return t.controlState}getCapableViewersList(e){let t=this.getSharingCall(e);if(t)return t.capableViewers}isAnonOrGuest(){return this.authenticationService.getLoggedInUser().role!==_.w4O.Member}shouldEnableControl(e,t){let i=e.getType()!==r.SharingSourceType.Camera&&!t.systemPickerSharingActive;return i&&this.config.vdi.isWebRTCVdiMode()&&e.getType()===r.SharingSourceType.Window&&(i=this.config.vdi.enableAppSharingControl?.()||!1),i}getControllerDisplayName(e,t){return(e?.propertyBag?.displayNameOverride?.value?.displayNameOverrideValue?e.propertyBag.displayNameOverride.value.displayNameOverrideValue:null)??e?.displayName??t?.displayName??""}getSharingCall(e){return(e||this.logger.error("teamsCallId is missing"),e in this.sharingCalls&&null!==this.sharingCalls[e])?this.sharingCalls[e]:null}userTerminatedReason(e){return[r.ControlTerminatedReason.SharerDenied,r.ControlTerminatedReason.SharerNoResponse,r.ControlTerminatedReason.SharerBusy,r.ControlTerminatedReason.SharerTerminated,r.ControlTerminatedReason.ViewerTerminated,r.ControlTerminatedReason.ViewerCancelled].includes(e)}isCallInSharingCalls(e){let t=!1,i=this.getSharingCall(e.teamsCallId);return null!=i&&(t=e===i.call),t}isExternalParticipant(e,t){return new Promise(i=>{this.peopleService.getPeopleProfile(e.id,"calling-screensharing-control-service-allowControlForUser").then(n=>{let a=e.tenantId===t,r=this.chatServiceUtils.isAnonymousUserMri(n.mri);n.isAnonymousUser||r||n.isFederated||!a||"inTenant"!==e.participantType||n.userType===g.gT.userTypes.guest||"guest"===e.role?(this.logger.info(`${e.id} is a anonymous user ${n.isAnonymousUser} federated ${n.isFederated} guest ${n.userType===g.gT.userTypes.guest}`),i(!0)):(this.logger.info("allowing control for user"),i(!1))}).catch(t=>{this.logger.error(`getPeopleProfile error ${t} for participant ${this.chatServiceUtils.scrubMri(e.id)}.`),(0,s.reject)(t)})})}acceptControlForCall(e){let t=this.promiseFactory.createDeferred();if(null===e)t.reject("unexpected, call is null");else{if(null!=e.screenSharingControl)return this.logger.info("accept control"),e.screenSharingControl.acceptControlRequest().then(()=>{this.logger.info("acceptControlRequest complete successfully"),this.showTerminateControlUfdDialogIfNeeded(e),t.resolve()}).catch(e=>{t.reject("acceptControlRequest failed error: {0}",[e])});t.reject("Null screenSharingControl on acceptControlRequest")}return t.promise}denyControlForCall(e){let t=this.promiseFactory.createDeferred();if(null===e)t.reject("unexpected, call is null");else{if(null!=e.screenSharingControl)return this.logger.info("reject control"),e.screenSharingControl.denyControlRequest().then(()=>{this.logger.info("denyControlRequest complete successfully"),t.resolve()}).catch(e=>{t.reject("denyControlRequest failed error: {0}",[e])});t.reject("Null screenSharingControl when trying to denyControlRequest")}return t.promise}terminateControlForCall(e){let t=this.promiseFactory.createDeferred();return e?null!=e.screenSharingControl?(this.logger.info("revoke control"),e.screenSharingControl.terminateControl().then(()=>{this.logger.info("terminateControl complete successfully"),t.resolve()}).catch(e=>{t.reject("terminateControl failed error: {0}",[e])})):t.reject("Null screenSharingControl when trying to terminateControl"):t.reject("unexpected, call is null"),t.promise}postScreenSharingControlMessage(e,t){if(!t)return void this.logger.error("Missing data for the control event");if(!this.mwRelay.call)return void this.logger.error("Missing relay call for the control event");let i=this.loggingService.findScenario(l.RG.GiveTakeControlViewerStart),n=this.getSharingCall(this.mwRelay.call.teamsCallId);if(!n){i?.cancel({reason:"sharingCall is null"}),this.logger.error("sharingCall is null for the control event");return}let a=n.call;if(!a.screenSharingControl){i?.cancel({reason:"screenSharingControl is null"}),this.logger.error("screenSharingControl is null for the control event");return}try{a.screenSharingControl.sendRemoteControlEvent(e,t),this.firstInputSent||(this.loggingService.findScenario(l.RG.GiveTakeControlViewerStart)?.stop({reason:"firstInputSent"}),this.firstInputSent=!0)}catch(e){this.logger.error(`Error sending the control event to the remote side due to ${e} for callId = ${a.teamsCallId}`),this.firstInputSent||(a.onVbssScenarioStopped(l.RG.GiveTakeControlViewerStart,"failure","firstInputSentFail"),this.loggingService.findScenario(l.RG.GiveTakeControlViewerStart)?.fail({reason:"firstInputSentFail"}),this.firstInputSent=!0);return}}createScreenSharingControlSubscriptions(e){let t=e.screenSharingControl;if(null==t)return this.logger.error("call.screenSharingControl is null in createScreenSharingControlSubscriptions"),!1;let i=this.config.enableGiveTakeControlV2(),n=e.vbssDetails.multiVbssSupportedForCall;return t.setScreenSharingControlFeatureFlag(i,{externalViewerControlInitialization:n}),!this.screenSharingControlSubscriptionRegistry.some(e=>e.control===t)&&(this.screenSharingControlSubscriptionRegistry.push({control:t,subscription:t.on("sharingControlCapable",t=>this.onSharingControlCapable(e,t))},{control:t,subscription:t.on("sharingControlChanged",t=>this.onSharingControlChanged(e,t))},{control:t,subscription:t.on("sharingIncomingControlRequest",t=>this.onSharingIncomingControlRequest(e,t))},{control:t,subscription:t.on("sharingIncomingControlRequestCancelled",t=>this.onSharingIncomingControlRequestCancelled(e,t))}),!0)}onSharingIncomingControlRequest(e,t){this.logger.info(`incoming control request from ${t}`);let i=this.getSharingCall(e.teamsCallId),n=this.newScenarioHoistToCore(e,l.RG.GiveTakeControlPresenterStart);if(!i){this.logger.error("sharingCall is null"),n?.fail({reason:"sharingCall is null"});return}if(i.call.vbssDetails.multiVbssActive){this.logger.info("viewer requesting control from call with multiple screenshare active"),this.denyControl(e.teamsCallId);return}let a=i.capableViewers.find(e=>e.id===t);if(void 0!==a){let r=i.call.participants.find(e=>e.id===t);this.controllerDisplayName=this.getControllerDisplayName(r,a),this.setPointerImages(e,a).then(()=>{this.logger.info("pointer images are set"),n?.mark(l.ck.AvatarSet)}).catch(e=>{this.logger.info(`setting pointer images failed with error: ${e}`),n?.mark(l.ck.AvatarNotSet)})}else{this.logger.error(`requesting control from non capable viewer ${t}`),n?.fail({reason:"non capable viewer"});return}let r={teamsCallId:e.teamsCallId,participant:{id:t,displayName:this.controllerDisplayName},state:o.lJ.Request};this.trigger(g.gT.events.calling.screenshareControlStateChanged,h.w.getTeamsCallIdAsString(e.teamsCallId),r),this.showIncomingControlRequestUfdDialog(e)}onSharingIncomingControlRequestCancelled(e,t){let i={teamsCallId:e.teamsCallId,participant:{id:t,displayName:""},state:o.lJ.Release};this.trigger(g.gT.events.calling.screenshareControlStateChanged,h.w.getTeamsCallIdAsString(e.teamsCallId),i),this.hideIncomingControlRequestUfdDialog(),this.loggingService.findScenario(l.RG.GiveTakeControlPresenterStart)?.cancel({reason:"viewer cancel"})}setPointerImages(e,t){let i=this.promiseFactory.createDeferred();if(!e)return i.reject("Missing call"),i.promise;let n=e.screenSharingControl;return n?t?(this.getProfileInfo(this.sxConfig.getCurrentSkypeMri()).then(e=>{e.image?p.getRoundImage(e.image,this.promiseFactory).then(e=>{this.logger.info("setting pointer image for sharer"),n.setLocalPointerImage(e.substring(p.imageHeader.length)).catch(e=>{this.logger.error(`set avatar for sharer error: ${e}`),this.setPointerImagePresenterFallback(n)})}).catch(e=>{this.logger.error(`fail to getRoundImage for sharer error: ${e}`),this.setPointerImagePresenterFallback(n)}):(this.logger.error("sharer profile image is null"),this.setPointerImagePresenterFallback(n))}).catch(()=>{this.setPointerImagePresenterFallback(n)}),e.participants.forEach(e=>{e.id===t.id&&(t.image?p.getRoundImage(t.image,this.promiseFactory).then(a=>{this.logger.info(`setting pointer image for viewer ${t.id}`),n.setRemotePointerImage(e,a.substring(p.imageHeader.length)).then(()=>{i.resolve()}).catch(t=>{let a=`viewer set avatar for error: ${t}`;this.logger.error(a),this.setPointerImageViewerFallback(n,e),i.reject(Error(a))})}).catch(t=>{let a=`fail to getRoundImage for viewer error: ${t}`;this.logger.error(a),this.setPointerImageViewerFallback(n,e),i.reject(Error(a))}):(this.logger.error("viewer profile image is null"),this.setPointerImageViewerFallback(n,e,i)))})):i.reject("Missing currentController"):i.reject("Missing call.screenSharingControl"),i.promise}setPointerImagePresenterFallback(e){e.setLocalPointerImage(p.roundedDoughBoy).then(()=>{this.logger.info("default avatar for sharer success")}).catch(e=>{this.logger.error(`default avatar for sharer error: ${e}`)})}setPointerImageViewerFallback(e,t,i){e.setRemotePointerImage(t,p.roundedDoughBoy).then(()=>{this.logger.info("default avatar for viewer success"),i?.resolve()}).catch(e=>{let t=`viewer default avatar error: ${e}`;this.logger.error(t),i?.reject(Error(t))})}deleteScreenSharingControlSubscriptions(e){let t=e.screenSharingControl;(0,s.remove)(this.screenSharingControlSubscriptionRegistry,e=>e.control===t).forEach(e=>e.subscription.dispose())}onSharingControlCapable(e,t){let i=e.screenSharingControl;if(this.logger.info("onSharingControlCapable"),!i)return void this.logger.error("screenSharingControl is falsy in control capable");let n=this.getSharingCall(e.teamsCallId);if(!n)return void this.logger.error("sharingCall is falsy in onSharingControlCapable");let o=e.sharingSourceType===r.SharingSourceType.Camera?a.Camera:e.systemPickerSharingActive?a.SystemPicker:null;if(o)return void this.logger.info(`no support of sharing control for ${o} sharing`);this.logger.info("sharing control capable from {0}, capable {1}, role {2}",[this.chatServiceUtils.scrubMri(t.id),t.capable,i.role]),i.role===r.SharingControlRole.Viewer?this.onSharingControlCapableViewer(e,t,n):i.role===r.SharingControlRole.Sharer?this.onSharingControlCapableSharer(e,t,n):this.logger.error(`unknown control role for ${t.id}`)}onSharingControlCapableSharer(e,t,i){let n=t.capable&&this.config.enableGiveTakeControlV2(),{isWebRTCVdiMode:a,isGiveControlSupported:r}=this.config.vdi;n&&a()&&(this.logger.info(`[onSharingControlCapableSharer] isGiveControlSupported=${r()}`),n=r());let o=t.id;if(""!==o)if(n){let t=this.chatServiceUtils.scrubMri(o);this.logger.info(`Getting profile info for id: ${t}`),this.getProfileInfo(o).then(t=>{let n=i.capableViewers;if(!n.find(e=>e.id===o)){i.capableViewers.push(t);let a={added:[t.user],removed:[],numberOfControlCapableViewers:n.length};1===i.capableViewers.length&&this.trigger(g.gT.events.calling.capableViewersAvailableChangedEvent,h.w.getTeamsCallIdAsString(e.teamsCallId),!0),this.throttledTriggerCapableViewersChanged(e.teamsCallId.toString(),a),this.logger.info(`Adding capable viewers: ${i.capableViewers.map(e=>this.chatServiceUtils.scrubMri(e.id))}`)}})}else{let t=i.capableViewers,n=t.find(e=>e.id===o);n&&((0,s.remove)(t,e=>e.id===o),0===t.length&&this.trigger(g.gT.events.calling.capableViewersAvailableChangedEvent,h.w.getTeamsCallIdAsString(e.teamsCallId),!1),this.throttledTriggerCapableViewersChanged(e.teamsCallId.toString(),{removed:[n.user],added:[],numberOfControlCapableViewers:t.length}),this.logger.info(`Removing capable viewers: ${i.capableViewers.map(e=>this.chatServiceUtils.scrubMri(e.id))}`))}else{let e=this.loggingService?.findScenario(l.RG.GiveTakeControlPresenterCore);n?e?.mark(l.ck.CapableInfoSharerEnabled):e?.incomplete({reason:`${l.ck.CapableInfoSharerDisabled}`})}}onSharingControlCapableViewer(e,t,i){let n=this.loggingService.findScenario(l.RG.GiveTakeControlViewerCore);i.capable=t.capable&&this.config.enableGiveTakeControlV2(),this.trigger(g.gT.events.calling.controlCapabilityChanged,h.w.getTeamsCallIdAsString(e.teamsCallId),t.capable);let a=t.capable&&!0===t.disabledBySharer?o.bo.showDisabledRequestControl:o.bo.notInControl;if(n)switch(a){case o.bo.showDisabledRequestControl:n.cancel({reason:"disabledBySharer"});case o.bo.notInControl:n.stop({reason:"notInControl",context:t.capable?"ViewerCapable":"ViewerNotCapable"})}this._updateControlState(a,e,i)}onSharingControlChanged(e,t){let i=e.screenSharingControl;if(!i)return void this.logger.error("call.screenSharingControl is falsy in onSharingControlChanged");let n=this.getSharingCall(e.teamsCallId);if(!n)return void this.logger.error("sharingCall is falsy in onSharingControlChanged");this.logger.debug("control changed, inControl={0}",t.inControl),i.role===r.SharingControlRole.Viewer?this.onSharingControlChangedViewer(e,t,n):i.role===r.SharingControlRole.Sharer?this.onSharingControlChangedSharer(e,t,n):this.logger.error("control.role is unknown")}onSharingControlChangedSharer(e,t,i){let n=t.id,a=this.loggingService.findScenario(l.RG.GiveTakeControlPresenterStart);if(t.inControl){let t=i.capableViewers;this._updateControlState(o.bo.inControl,e,i);let r=t.find(e=>e.id===n);r&&(i.controllerName=r.displayName),this.logger.info(`onSharingControlChangedSharer in call: ["${e.callId}"]`),a?.mark(l.ck.InControlState),this.showTerminateControlUfdDialogIfNeeded(e)}else this._updateControlState(o.bo.notInControl,e,i),i.controllerName="",a?.cancel({reason:"viewer cancel"}),this.hideTerminateControlUfdDialog()}onSharingControlChangedViewer(e,t,i){t.inControl?(this.loggingService.findScenario(l.RG.GiveTakeControlViewerStart)||(this.newScenarioHoistToCore(e,l.RG.GiveTakeControlViewerStart).appendEventData({context:"GiveControl"}),this.firstInputSent=!1),this._updateControlState(o.bo.inControl,e,i,t.terminatedReason),this._setupControlEventRelay(e)):this._updateControlState(o.bo.notInControl,e,i,t.terminatedReason)}_updateControlState(e,t,i,n){if(!t||!i)return void this.logger.error("_updateControlState: unexpected arguments");let a={controlState:e},s=this.loggingService.findScenario(l.RG.GiveTakeControlViewerStart);if(void 0!==n&&(a.terminatedReason=n),i.controlState=e,t.screenSharingControlStateAsViewer=this._mapToControlStateAsViewer(i.capable,e),n===r.ControlTerminatedReason.SharerTerminated&&e===o.bo.notInControl){s?.cancel({reason:"presenterTerminated"});let e={dismissable:!0,type:u.NK.Info,name:"SharingControlRequestRevoked",narrated:!0,text:this.localized.alerts.sharingControlRequestRevoked.text(),timeout:u.Iq};this.serviceProvider.callingAlertsService().handleOnDemandAlert(e)}if(n===r.ControlTerminatedReason.MultipleSharers&&e===o.bo.notInControl&&t.vbssDetails.multiVbssSupportedForCall){s?.cancel({reason:"multiVbss"}),this.logger.info("Stopping give take control session for viewer due to multiple screenshare active");let e={dismissable:!0,type:u.NK.Info,name:"MultiVbssTakeControlDisabled",narrated:!0,text:this.localized.alerts.multiVbssTakeControlDisabled.text(),timeout:u.Iq};this.serviceProvider.callingAlertsService().handleOnDemandAlert(e)}s&&e===o.bo.inControl&&s.mark(l.ck.InControlViewerState),this.trigger(g.gT.events.calling.controlStateChanged,h.w.getTeamsCallIdAsString(t.teamsCallId),a)}_mapToControlStateAsViewer(e,t){if(!e)return d.C.NotControlCapable;switch(t){case o.bo.disabled:return d.C.RequestSent;case o.bo.inControl:return d.C.InControl;case o.bo.notInControl:return d.C.NotInControl;case o.bo.showDisabledRequestControl:default:return d.C.Disabled}}_setupControlEventRelay(e){if(!e)return void this.logger.error("_setupControlEventRelay: invalid call");let t=this.mwRelay;t.call&&t.call.teamsCallId===e.teamsCallId||(t.call=e,this.logger.info("_setupControlEventRelay: Created the control relay with experience"))}trigger(...e){return this.asObservable.trigger(...e)}_requestControlSucceeded(e,t){this.logger.info("request control complete successfully");let i=e.call;this._updateControlState(o.bo.inControl,i,e),this.trigger(g.gT.events.calling.controlRequestStateChanged,h.w.getTeamsCallIdAsString(i.teamsCallId),o.Fj.responseInControl),this.firstInputSent=!1,this._setupControlEventRelay(i),t.resolve()}_requestControlFailed(e,t,i){this.logger.error(`request control failed with error ${e}.`);let n=t.call;this._updateControlState(o.bo.notInControl,n,t),this.trigger(g.gT.events.calling.controlRequestStateChanged,h.w.getTeamsCallIdAsString(n.teamsCallId),o.Fj.responseNotInControl);let a={dismissable:!0,type:u.NK.Info,name:"SharingControlRequestDenied",narrated:!0,title:this.localized.alerts.sharingControlRequestDenied.title(),text:this.localized.alerts.sharingControlRequestDenied.text(),timeout:u.Iq};this.serviceProvider.callingAlertsService().handleOnDemandAlert(a),i.reject(e)}getProfileInfo(e){let t=this.promiseFactory.createDeferred(),i=this.chatServiceUtils.scrubMri(e);return this.peopleService.getPeopleProfile(e,"calling-screensharing-control-service-getProfileInfo").then(n=>{let a={principalName:n.userPrincipalName,displayName:n.displayName,mri:n.mri,source:"screen-sharing-control-service",avatarUrl:n.avatarUrl},r={id:e,displayName:n.displayName,image:null,user:n};this.profilePictureLoaderService.loadImage(a,!1,!1,!1,"screenSharingControlService").then(e=>{e?.imgUrl&&(r.image=e.imgUrl.toString()),t.resolve(r)}).catch(e=>{this.logger.error(`Failed getting image mri=${i} error ${e}`),t.resolve(r)})}).catch(e=>{let n=`Failed getting profile mri=${i} error ${e}`;this.logger.error(n),t.reject(Error(n))}),t.promise}showIncomingControlRequestUfdDialog(e){return this.logger.info("Creating incoming control producers UFD alert"),this.requestControlActionsDialogAlert={name:"SharingIncomingControlRequest",type:u.NK.Warning,title:this.localized.alerts.screenSharingIncomingControlRequest.title(),text:this.localized.alerts.screenSharingIncomingControlRequest.text(this.controllerDisplayName),isScreensharingCallRelated:e.isScreenSharingOn,windowType:u.MA.CallScreensharingPanel,dismissable:!1,teamsCallId:e.teamsCallId,narrated:!0,actions:[{alertActionType:"DenyControl",buttonText:this.localized.alerts.screenSharingIncomingControlRequest.denyText(),command:()=>{this.denyControl(e.teamsCallId)},buttonTrackName:m.vR.denyControl,isSecondary:!0},{alertActionType:"AllowControl",buttonText:this.localized.alerts.screenSharingIncomingControlRequest.allowText(),command:()=>{this.acceptControl(e.teamsCallId)},buttonTrackName:m.vR.acceptControl}]},this.serviceProvider.callingAlertsService().handleOnDemandAlert(this.requestControlActionsDialogAlert),this.loggingService.findScenario(l.RG.GiveTakeControlPresenterStart)?.mark(l.ck.IncomingRequestAlertShown),!0}hideIncomingControlRequestUfdDialog(){this.logger.info("Hiding incoming control producers UFD alert"),this.requestControlActionsDialogAlert&&this.serviceProvider.callingAlertsService().dismiss(this.requestControlActionsDialogAlert)}showTerminateControlUfdDialogIfNeeded(e){return!this.config.enableGiveControlInPresenterToolbar()&&(this.logger.info("Creating terminate control producers UFD alert"),this.hideTerminateControlUfdDialog(),this.terminateControlAlert={name:"SharingTerminateControl",type:u.NK.Warning,title:this.localized.alerts.screenSharingTerminateControl.title(),text:this.localized.alerts.screenSharingTerminateControl.text(this.controllerDisplayName),isScreensharingCallRelated:e.isScreenSharingOn,windowType:u.MA.CallScreensharingPanel,dismissable:!1,narrated:!0,actions:[{alertActionType:"TerminateControl",buttonText:this.localized.alerts.screenSharingTerminateControl.action(),command:()=>{this.terminateControl(e.teamsCallId)},buttonTrackName:m.vR.terminateControl}]},this.serviceProvider.callingAlertsService().handleOnDemandAlert(this.terminateControlAlert),this.loggingService.findScenario(l.RG.GiveTakeControlPresenterStart)?.mark(l.ck.TerminateAlertShown),!0)}hideTerminateControlUfdDialog(){this.terminateControlAlert&&(this.logger.info("Hiding terminate control UFD alert"),this.serviceProvider.callingAlertsService().dismiss(this.terminateControlAlert))}newScenarioHoistToCore(e,t){return this.callingTelemetryService.newCallingScenario(e,t,void 0,void 0,void 0,void 0,!0)}throttledTriggerCapableViewersChanged(e,t){this.throttledCapableViewersEventData.numberOfControlCapableViewers=t.numberOfControlCapableViewers,t.added.forEach(e=>{if(!e.id)return void this.logger.error("capable viewer is missing id");0===(0,s.remove)(this.throttledCapableViewersEventData.removed,t=>t.id===e.id).length&&this.throttledCapableViewersEventData.added.push(e)}),t.removed.forEach(e=>{if(!e.id)return void this.logger.error("capable viewer is missing id");0===(0,s.remove)(this.throttledCapableViewersEventData.added,t=>t.id===e.id).length&&this.throttledCapableViewersEventData.removed.push(e)}),this.throttledTriggerCapableViewersChangedInternal(g.gT.events.calling.controlCapableViewersChanged,e,this.throttledCapableViewersEventData)}}},899192:function(e,t,i){var n,a;i.d(t,{t:()=>n}),(a=n||(n={})).E911="E911",a.INDIA_PHONE_SYSTEM="IndiaPhoneSystem",a.NETWORK_ROAMING="NetworkRoaming",a.PLACES="Places",a.ADMINS="Admins"},798674:function(e,t,i){var n,a,r,o,s,l,c,d,g,h;i.d(t,{jZ:()=>a,ps:()=>r,w7:()=>s,xm:()=>o,yn:()=>n}),(l=n||(n={})).Local="local",l.Remote="remote",(c=a||(a={}))[c.FIRST_TWO_NUMBERS=1]="FIRST_TWO_NUMBERS",c[c.EXACT_MATCH=2]="EXACT_MATCH",c[c.ALLOW_ANYTHING=3]="ALLOW_ANYTHING",(d=r||(r={})).Generic="vdiDisconnected_Generic",d.ClientWatchdog="vdiDisconnected_ClientWatchdog",d.ConsoleSession="vdiConsoleSession",d.BrokenSlimCore="vdiDisconnected_BrokenSlimCore",d.VmWatchdog="vdiDisconnected_VmWatchdog",d.Unknown="Unknown",d.VdiBridgeOnConnected="vdiBridgeOnConnected",d.VdiBridgeOnDisconnected="vdiBridgeOnDisconnected",d.FallbackToLocalOnRemoteFailure="fallbackToLocalOnRemoteFailure",d.EndpointShutdown="EndpointShutdown",(g=o||(o={})).onConnected="onConnected",g.onDownloadingSlimCoreEx="onDownloadingSlimCoreEx",g.onTelemetry="onTelemetry",g.onDisconnectedEx="onDisconnectedEx",g.onSessionChanged="onSessionChanged",(h=s||(s={}))[h.DISABLED=0]="DISABLED",h[h.ALLOW_SANDBOXED_ONLY=1]="ALLOW_SANDBOXED_ONLY",h[h.ALLOW_ALL=2]="ALLOW_ALL"},401786:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C,v,f,b,y,T,I,A,E,M,P,k,D,R,w,F,N,O,L,U,B,x,V,H,G,W,$,z,q;i.d(t,{$4:()=>o,CR:()=>f,DQ:()=>y,G7:()=>m,Kb:()=>c,LP:()=>l,Pl:()=>h,T3:()=>n,Zg:()=>_,_Y:()=>d,c_:()=>b,dl:()=>S,j6:()=>u,lF:()=>r,n0:()=>T,q$:()=>p,rE:()=>I,sS:()=>g,xD:()=>s,yG:()=>v,zx:()=>a}),(A=n||(n={}))[A.Undefined=0]="Undefined",A[A.GenericDesktop=1]="GenericDesktop",A[A.Simulation=2]="Simulation",A[A.VR=3]="VR",A[A.Sport=4]="Sport",A[A.Game=5]="Game",A[A.GenericDeviceControls=6]="GenericDeviceControls",A[A.KeyboardOrKeypad=7]="KeyboardOrKeypad",A[A.LEDs=8]="LEDs",A[A.Button=9]="Button",A[A.Ordinal=10]="Ordinal",A[A.Telephony=11]="Telephony",A[A.Consumer=12]="Consumer",A[A.Digitizer=13]="Digitizer",A[A.PID=15]="PID",A[A.Unicode=16]="Unicode",A[A.AlphanumericDisplay=20]="AlphanumericDisplay",A[A.Sensor=32]="Sensor",A[A.Monitor=128]="Monitor",A[A.MonitorEnumerated=129]="MonitorEnumerated",A[A.MonitorVirtual=130]="MonitorVirtual",A[A.MonitorReserved=131]="MonitorReserved",A[A.PowerDevice=132]="PowerDevice",A[A.BatterySystem=133]="BatterySystem",A[A.PowerReserved=134]="PowerReserved",A[A.PowerReserved2=135]="PowerReserved2",A[A.BarCodeScanner=140]="BarCodeScanner",A[A.WeighingDevice=141]="WeighingDevice",A[A.Scale=141]="Scale",A[A.MagneticStripeReader=142]="MagneticStripeReader",A[A.CameraControl=144]="CameraControl",A[A.Arcade=145]="Arcade",A[A.CustomPage=65433]="CustomPage",A[A.VendorDefinedStart=65280]="VendorDefinedStart",A[A.SoftphoneShared=65441]="SoftphoneShared",(E=a||(a={}))[E.Delete=7]="Delete",(M=r||(r={}))[M.Phone=1]="Phone",M[M.AnsweringMachine=2]="AnsweringMachine",M[M.MessageControls=3]="MessageControls",M[M.Handset=4]="Handset",M[M.Headset=5]="Headset",M[M.TelephonyKeyPad=6]="TelephonyKeyPad",M[M.ProgrammableButton=7]="ProgrammableButton",M[M.HookSwitch=32]="HookSwitch",M[M.Flash=33]="Flash",M[M.Feature=34]="Feature",M[M.Hold=35]="Hold",M[M.Redial=36]="Redial",M[M.Transfer=37]="Transfer",M[M.Drop=38]="Drop",M[M.Park=39]="Park",M[M.ForwardCalls=40]="ForwardCalls",M[M.AlternateFunction=41]="AlternateFunction",M[M.Line=42]="Line",M[M.SpeakerPhone=43]="SpeakerPhone",M[M.Conference=44]="Conference",M[M.RingEnable=45]="RingEnable",M[M.Pulse=46]="Pulse",M[M.PhoneMute=47]="PhoneMute",M[M.CallerID=48]="CallerID",M[M.SpeedDial=80]="SpeedDial",M[M.StoreNumber=81]="StoreNumber",M[M.RecallNumber=82]="RecallNumber",M[M.PhoneDirectory=83]="PhoneDirectory",M[M.VoiceMail=112]="VoiceMail",M[M.ScreenCalls=113]="ScreenCalls",M[M.DoNotDisturb=114]="DoNotDisturb",M[M.Message=115]="Message",M[M.AnswerOnOrOff=116]="AnswerOnOrOff",M[M.InsideDialTone=144]="InsideDialTone",M[M.OutsideDialTone=145]="OutsideDialTone",M[M.InsideRingTone=146]="InsideRingTone",M[M.OutsideRingTone=147]="OutsideRingTone",M[M.PriorityRingTone=148]="PriorityRingTone",M[M.InsideRingback=149]="InsideRingback",M[M.PriorityRingback=150]="PriorityRingback",M[M.LineBusyTone=151]="LineBusyTone",M[M.ReorderTone=152]="ReorderTone",M[M.CallWaitingTone=153]="CallWaitingTone",M[M.ConfirmationTone1=154]="ConfirmationTone1",M[M.ConfirmationTone2=155]="ConfirmationTone2",M[M.TonesOff=156]="TonesOff",M[M.OutsideRingback=157]="OutsideRingback",M[M.PhoneKey0=176]="PhoneKey0",M[M.PhoneKey1=177]="PhoneKey1",M[M.PhoneKey2=178]="PhoneKey2",M[M.PhoneKey3=179]="PhoneKey3",M[M.PhoneKey4=180]="PhoneKey4",M[M.PhoneKey5=181]="PhoneKey5",M[M.PhoneKey6=182]="PhoneKey6",M[M.PhoneKey7=183]="PhoneKey7",M[M.PhoneKey8=184]="PhoneKey8",M[M.PhoneKey9=185]="PhoneKey9",M[M.PhoneKeyStar=186]="PhoneKeyStar",M[M.PhoneKeyPound=187]="PhoneKeyPound",M[M.PhoneKeyA=188]="PhoneKeyA",M[M.PhoneKeyB=189]="PhoneKeyB",M[M.PhoneKeyC=190]="PhoneKeyC",M[M.PhoneKeyD=191]="PhoneKeyD",(P=o||(o={}))[P.ShortcutButton=6]="ShortcutButton",P[P.HidConfiguration=5]="HidConfiguration",P[P.TeamsButton=4]="TeamsButton",P[P.ASPFeature=3]="ASPFeature",P[P.CameraMode=199]="CameraMode",(k=s||(s={}))[k.Output=1]="Output",k[k.Input=2]="Input",(D=l||(l={}))[D.Input=3]="Input",(R=c||(c={}))[R.Mute=0]="Mute",R[R.Unmute=1]="Unmute",R[R.QueryState=2]="QueryState",(w=d||(d={}))[w.NotInCall=0]="NotInCall",w[w.Off=1]="Off",w[w.On=2]="On",w[w.Blocked=3]="Blocked",(F=g||(g={}))[F.VendorUsageId=65281]="VendorUsageId",F[F.RowsUsage=53]="RowsUsage",F[F.ScreenSelectUsage=65297]="ScreenSelectUsage",F[F.LastCharacterUsage=65316]="LastCharacterUsage",F[F.TextStringFollowed=65314]="TextStringFollowed",F[F.CustomLangId=100]="CustomLangId",F[F.CustomOcDisplayVersion=101]="CustomOcDisplayVersion",(N=h||(h={}))[N.NumLock=1]="NumLock",N[N.CapsLock=2]="CapsLock",N[N.ScrollLock=3]="ScrollLock",N[N.Compose=4]="Compose",N[N.Kana=5]="Kana",N[N.Power=6]="Power",N[N.Shift=7]="Shift",N[N.DoNotDisturb=8]="DoNotDisturb",N[N.Mute=9]="Mute",N[N.ToneEnable=10]="ToneEnable",N[N.HighCutFilter=11]="HighCutFilter",N[N.LowCutFilter=12]="LowCutFilter",N[N.EqualizerEnable=13]="EqualizerEnable",N[N.SoundFieldOn=14]="SoundFieldOn",N[N.SurroundOn=15]="SurroundOn",N[N.Repeat=16]="Repeat",N[N.Stereo=17]="Stereo",N[N.SamplingRateDetect=18]="SamplingRateDetect",N[N.Spinning=19]="Spinning",N[N.CAV=20]="CAV",N[N.CLV=21]="CLV",N[N.RecordingFormatDetect=22]="RecordingFormatDetect",N[N.OffHook=23]="OffHook",N[N.Pulse=24]="Pulse",N[N.MessageWaiting=25]="MessageWaiting",N[N.DataMode=26]="DataMode",N[N.BatteryOperation=27]="BatteryOperation",N[N.BatteryOK=28]="BatteryOK",N[N.BatteryLow=29]="BatteryLow",N[N.Speaker=30]="Speaker",N[N.HeadSet=31]="HeadSet",N[N.Hold=32]="Hold",N[N.Microphone=33]="Microphone",N[N.Coverage=34]="Coverage",N[N.NightMode=35]="NightMode",N[N.SendCalls=36]="SendCalls",N[N.CallPickup=37]="CallPickup",N[N.Conference=38]="Conference",N[N.StandBy=39]="StandBy",N[N.CameraOn=40]="CameraOn",N[N.CameraOff=41]="CameraOff",N[N.OnLine=42]="OnLine",N[N.OffLine=43]="OffLine",N[N.Busy=44]="Busy",N[N.Ready=45]="Ready",N[N.PaperOut=46]="PaperOut",N[N.PaperJam=47]="PaperJam",N[N.Remote=48]="Remote",N[N.Forward=49]="Forward",N[N.Reverse=50]="Reverse",N[N.Stop=51]="Stop",N[N.Rewind=52]="Rewind",N[N.FastForward=53]="FastForward",N[N.Play=54]="Play",N[N.Pause=55]="Pause",N[N.Record=56]="Record",N[N.Error=57]="Error",N[N.Usage=58]="Usage",N[N.UsageInUseIndicator=59]="UsageInUseIndicator",N[N.UsageMultiModeIndicator=60]="UsageMultiModeIndicator",N[N.IndicatorOn=61]="IndicatorOn",N[N.IndicatorFlash=62]="IndicatorFlash",N[N.IndicatorSlowBlink=63]="IndicatorSlowBlink",N[N.IndicatorFastBlink=64]="IndicatorFastBlink",N[N.IndicatorOff=65]="IndicatorOff",N[N.FlashOnTime=66]="FlashOnTime",N[N.SlowBlinkOnTime=67]="SlowBlinkOnTime",N[N.SlowBlinkOffTime=68]="SlowBlinkOffTime",N[N.FastBlinkOnTime=69]="FastBlinkOnTime",N[N.FastBlinkOffTime=70]="FastBlinkOffTime",N[N.UsageIndicatorColor=71]="UsageIndicatorColor",N[N.IndicatorRed=72]="IndicatorRed",N[N.IndicatorGreen=73]="IndicatorGreen",N[N.IndicatorAmber=74]="IndicatorAmber",N[N.GenericIndicator=75]="GenericIndicator",N[N.SystemSuspend=76]="SystemSuspend",N[N.ExternalPowerConnected=77]="ExternalPowerConnected",N[N.PlayerIndicator=78]="PlayerIndicator",N[N.Player1=79]="Player1",N[N.Player2=80]="Player2",N[N.Player3=81]="Player3",N[N.Player4=82]="Player4",N[N.Player5=83]="Player5",N[N.Player6=84]="Player6",N[N.Player7=85]="Player7",N[N.Player8=86]="Player8",N[N.Reserved=65535]="Reserved",(O=p||(p={}))[O.None=0]="None",O[O.LocalUserName=1]="LocalUserName",O[O.LocalUserStatus=2]="LocalUserStatus",O[O.Date=4]="Date",O[O.Time=8]="Time",O[O.CallStatus=16]="CallStatus",O[O.OtherPartyName=32]="OtherPartyName",O[O.OtherPartyTitle=64]="OtherPartyTitle",O[O.Subject=128]="Subject",O[O.Duration=256]="Duration",O[O.Number=512]="Number",O[O.OtherPartyNumber=1024]="OtherPartyNumber",O[O.ConversationId=2048]="ConversationId",(L=u||(u={}))[L.NoChange=0]="NoChange",L[L.Idle=1]="Idle",L[L.Active=2]="Active",L[L.ReadyToCall=2]="ReadyToCall",L[L.OutgoingCall=3]="OutgoingCall",L[L.IncomingCall=4]="IncomingCall",L[L.InCall=5]="InCall",L[L.HoldCall=6]="HoldCall",L[L.EndCall=7]="EndCall",(U=m||(m={}))[U.Off=0]="Off",U[U.On=1]="On",(B=_||(_={}))[B.NoClear=0]="NoClear",B[B.Clear=1]="Clear",(x=S||(S={}))[x.Disable=0]="Disable",x[x.Enable=1]="Enable",(V=C||(C={}))[V.Transparent=0]="Transparent",V[V.White=1]="White",V[V.Gray=2]="Gray",V[V.Blue=3]="Blue",V[V.Pink=4]="Pink",(H=v||(v={}))[H.Undefined=0]="Undefined",(G=f||(f={}))[G.reportId=123]="reportId",G[G.usage=65292]="usage",(W=b||(b={}))[W.reportId=92]="reportId",($=y||(y={}))[$.reportId=94]="reportId",(z=T||(T={}))[z.pptLiveInactive=65536]="pptLiveInactive",z[z.pptLiveActive=65537]="pptLiveActive",(q=I||(I={}))[q.none=0]="none",q[q.pptLaserPointReleased=65536]="pptLaserPointReleased",q[q.pptLaserPointPressed=65537]="pptLaserPointPressed",q[q.pptLaserPointLongPressed=65538]="pptLaserPointLongPressed",q[q.pptPrevSlideReleased=131072]="pptPrevSlideReleased",q[q.pptPrevSlidePressed=131073]="pptPrevSlidePressed",q[q.pptNextSlideReleased=196608]="pptNextSlideReleased",q[q.pptNextSlidePressed=196609]="pptNextSlidePressed"},771199:function(e,t,i){var n,a,r,o;i.d(t,{N:()=>a,s:()=>n}),(r=n||(n={}))[r.Unknown=0]="Unknown",r[r.Agenda=1]="Agenda",r[r.Participation=2]="Participation",r[r.Quorum=3]="Quorum",r[r.MaterialsInAdvance=4]="MaterialsInAdvance",r[r.TimeManagement=5]="TimeManagement",r[r.FocusedDiscussions=6]="FocusedDiscussions",r[r.NextSteps=7]="NextSteps",r[r.Inclusive=8]="Inclusive",r[r.Necessity=9]="Necessity",(o=a||(a={})).Disabled="Disabled",o.OptedIn="OptedIn",o.OptedOut="OptedOut"},665405:function(e,t,i){i.d(t,{A:()=>r,H:()=>o});var n=i(352320),a=i(575810);class r{constructor(e,t){this.logger=t,this.getPrefix="function"==typeof e?e:()=>e}createChild(e){let t="function"==typeof e?e:()=>e;return new r(()=>`${this.getPrefix()}/${t()}`,this.logger)}log(...e){this.apply(this.logger.log,e)}debug(...e){this.apply(this.logger.debug,e)}info(...e){this.apply(this.logger.info,e)}warn(...e){this.apply(this.logger.warn,e)}error(...e){this.apply(this.logger.error,e)}apply(e,t=[]){this.addPrefix(t);let i=t.map(e=>"object"==typeof e?JSON.stringify(e,e instanceof Error?r.ERROR_PROPS_WHITELIST:void 0):e).join(", ");e.call(this.logger,n.cf.getErrorMessage(i))}addPrefix(e){if(e&&e[0]){let t=`${this.getPrefix()} ${e[0]}`;e[0]=t}}}r.ERROR_PROPS_WHITELIST=["stack","message","name"];class o extends r{error(...e){for(let t=0;t<e.length;t++)e[t]=o.replaceAllPstnMriWithRegEx(e[t]);super.error(e)}static replaceAllPstnMriWithRegEx(e){return e.replace(a.gT.files.regexPatterns.pstnRegex,"PSTNMri")}}},462332:function(e,t,i){i.d(t,{u:()=>d});var n=i(892891),a=i(575810),r=i(945761),o=i(500536),s=i(395250),l=i(665405),c=i(826757);class d{constructor({config:e,loggingService:t,desktopUtilityService:i,promiseFactory:n,adminSettingsStore:a,teamsMeetingConfiguration:o,meetingPolicySettingsStore:s,serviceProvider:l,initializeInCtor:c,interval:d,aggregatedSettingsStore:g}){this.promiseFactory=r.Wq,this.adminSettingSyncIntervalToken=void 0,this.config=e,this.loggingService=t,this.desktopUtilityService=i,this.promiseFactory=n,this.adminSettingsStore=a,this.teamsMeetingConfiguration=o,this.meetingPolicySettingsStore=s,this.serviceProvider=l,this.interval=d,this.aggregatedSettingsStore=g,this.logger=t.newLogger("MediaConfigurationService"),c&&this.initializeOnAppLaunchAndReinit("MediaConfigurationService c'tor init")}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.mediaConfiguration={}}cleanupOnAppTeardown(e){this.adminSettingSyncIntervalToken&&(this.interval.cancel(this.adminSettingSyncIntervalToken),this.adminSettingSyncIntervalToken=void 0),this.mediaConfiguration={}}init(){this.logger.info("mediaConfigurationService init");let e=this.loggingService.newScenario(s.RG.MediaConfigurationServiceInit);if(this.config.enableCallingInTfl()){let t="TFL renderer, not setting media config";this.logger.info(t),e.stop({reason:t});return}this.setInitialMediaConfiguration(),(0,n.isEmpty)(this.mediaConfiguration)||this.setMediaConfig({}).then(()=>this.logger.info("Initial mediaConfiguration applied")).catch(t=>{let i=`Initial mediaConfiguration update failed with [error=${t?.message||t}][config=${JSON.stringify(this.mediaConfiguration)}]`;this.logger.error(i),e.fail({error:i})});let t=this.setAdminSettings().then(()=>this.logger.info("Initial AdminSettings config applied")).catch(e=>{let t=`setAdminSettings failed with: [error=${e?.message||e}]`;return this.logger.error(t),this.promiseFactory.reject(Error(t))});this.adminSettingSyncIntervalToken||(this.adminSettingSyncIntervalToken=this.startAdminSettingSync());let i=this.setMediaBitRateKb().then(()=>this.logger.info("Initial MediaBitRateKb config applied")).catch(e=>{let t=`setMediaBitRateKb failed with: [error=${e?.message||e}]`;return this.logger.error(t),this.promiseFactory.reject(Error(t))}),a=this.setMediaConnectivityPolicy().then(()=>this.logger.info("Initial media connectivity policy applied")).catch(e=>{let t=`setMediaConnectivityPolicy failed with: [error=${e?.message||e}]`;return this.logger.errorToTelemetry?.(t,"cmd_media_configuration_service_error",void 0,!0),this.promiseFactory.reject(Error(t))});this.promiseFactory.all([t,i,a]).then(()=>{e.stop()}).catch(t=>{e.fail({error:`init mediaConfiguration failed with [error=${t?.message||t}]`})})}enableNoiseSuppression(e){return this.setMediaConfig({enableNoiseSuppression:e})}enableNoiseSuppressionMode(e){return this.setMediaConfig({noiseSuppressionMode:e})}async enableOptimizedPerfMode(e){this.setMediaConfig({opmMode:c.eU.getOpmMode(e)})}enableTtySupport(e){return this.setMediaConfig({enableTtySupport:e})}toggleHWMuteSync(e){return this.setMediaConfig({hwMuteSyncEnabled:e})}setVirtualDevicesForProbeCalls(){return!!this.config.enableCallingProbe()&&(this.setMediaConfig({enableProbeCallSupport:!0}).then(()=>this.logger.info("enableProbeCallSupport config applied")).catch(e=>this.logger.error(`setVirtualDevicesForProbeCalls failed with: [error=${e?.message||e}]`)),!!(this.config.enableSlimCoreAccountConfiguration()&&this.config.enableSetMediaConfigOnRegistry()))}updateMediaBitRateKb(e){let t=this.desktopUtilityService.isDesktop?this.config.enableMediaBitRateSetting():this.config.enablePluginlessMediaBitRateSetting();if(this.logger.info("enableMediaBitRateSetting = {0}",t),!t)return Promise.resolve();let i={maxBandwidthInBps:e*a.gT.kiloBitToBit};return this.setMediaConfig(i)}startAdminSettingSync(){return this.interval.set(()=>{try{this.logger.info("setAdminSettingsTimer: sync setAdminSettings"),this.setAdminSettings().then(()=>this.logger.info("sync AdminSettings config applied")).catch(e=>{let t=`sync AdminSettings failed with: [error=${e?.message||e}]`;this.logger.error(t)})}catch(e){this.logger.error(`set setAdminSettings interval failed with: [error=${e?.message||e}]`)}},this.config.teamsUpgradePolicyV2ExpiryTimeMinutes()*a.gT.timeInMiliseconds.minute||4*a.gT.timeInMiliseconds.hour,!1)}setInitialMediaConfiguration(){this.mediaConfiguration||(this.mediaConfiguration={});let e=this.serviceProvider.callingAgentsService().shouldSuppressCallActiveSpeakerEvents();this.logger.info(`Suppressing active speaker events from calling service is ${e}`),e&&(this.mediaConfiguration.suppressCallActiveSpeakerEvents=!0)}setMediaConfig(e){let t=this.loggingService.findScenario(s.RG.SetMediaConfig);if(this.config.enableSlimCoreAccountConfiguration()&&this.config.enableSetMediaConfigOnRegistry()){let i;this.logger.info("[setMediaConfig] updating media configuration");let a=(0,n.keys)(e).join();t?.mark(s.ck.SetMediaConfigOnCallRegistry,{mediaConfigKeys:a}),this.mediaConfiguration={...this.mediaConfiguration,...e};try{i=this.serviceProvider.callingService()}catch(e){if(e instanceof ReferenceError){let e="[setMediaConfig] callingService not instantiated yet, mediaConfig saved locally";return t?.incomplete({reasonCMD:e}),this.logger.warn(e),this.logger.warn(`[setMediaConfig] added the following keys to pending config ${a}`),Promise.resolve()}{let i=`[setMediaConfig] failed to get callingService from the serviceProvider [error=${e?.message||e}]`;return t?.fail({errorCMD:i}),this.logger.error(i),Promise.reject(Error(i))}}return i.setAccountMediaConfig(this.mediaConfiguration).then(e=>{if(e)t?.stop(),this.logger.info(`[setMediaConfig] updated account mediaConfig with keys ${a}`);else{let e="[setMediaConfig] callRegistry not initialized yet, mediaConfig saved locally";t?.incomplete({reasonCMD:e}),this.logger.warn(e)}}).catch(e=>{let i=`[setMediaConfig] failed to update mediaConfig, mediaConfig saved locally [error=${e?.message||e}]`;t?.fail({errorCMD:i}),this.logger.error(i)})}{let e=`[setMediaConfig] feature flags not enabled. [enableSlimCoreAccountConfiguration=${this.config.enableSlimCoreAccountConfiguration()||!1}][enableSetMediaConfigOnRegistry=${this.config.enableSetMediaConfigOnRegistry()||!1}]`;t?.incomplete({reasonCMD:e}),this.logger.info(e)}return Promise.resolve()}setMediaConnectivityPolicy(){let e=this.config.enableMediaConnectivityPolicy();if(this.logger.info("mediaConnectivityPolicyEnabled = {0}",e),!e)return this.promiseFactory.resolve();let t=this.aggregatedSettingsStore.getSettings();if(!(t&&t.teamsMediaConnectivityPolicy&&t.teamsMediaConnectivityPolicy.value))return this.logger.info("media connectivity policy is not available yet, skipping update"),this.promiseFactory.resolve();let i=t.teamsMediaConnectivityPolicy.value.directConnection;return this.setMediaConfig("Disabled"===i?{connectionType:"NoDirectConnection"}:{connectionType:"AllSupported"}).then(()=>this.logger.info("setMediaConnectivityPolicy completed")).then(()=>{}).catch(e=>{new l.H("slimcore-calling",this.logger).error(e)})}setAdminSettings(){let e=this.config.enableAdminSettings();return this.logger.info("adminSettingsEnabled = {0}",e),(e?this.adminSettingsStore.whenInitialized():this.promiseFactory.resolve()).then(()=>{if(e){let e=(0,n.cloneDeep)(this.adminSettingsStore.getSettings()),t=e.conferencingConfigurationSetting,i={audioMin:t.clientAudioPort,audioMax:t.clientAudioPort+t.clientAudioPortRange-1,videoMin:t.clientVideoPort,videoMax:t.clientVideoPort+t.clientVideoPortRange-1,dataMin:t.clientAppSharingPort,dataMax:t.clientAppSharingPort+t.clientAppSharingPortRange-1,vbssMin:t.clientAppSharingPort,vbssMax:t.clientAppSharingPort+t.clientAppSharingPortRange-1};this.logger.info("adminSettings: mediaPortRanges = {0}",i);let a=e.mediaConfigurationSetting.enableInCallQoS;return this.logger.info("adminSettings: enableQoS = {0}",a),this.setMediaConfig({mediaPortRanges:i,enableMediaQoS:a})}}).then(()=>this.setTeamsMeetingConfigurationToSlimcore()).then(()=>{}).catch(e=>{new l.H("slimcore-calling",this.logger).error(e)})}setTeamsMeetingConfigurationToSlimcore(){let e=this.loggingService.newScenario(s.RG.CallingAgentQosSetting,null,null,null,!0),t=this.config.enableQos();return this.logger.info("Start setTeamsMeetingConfigurationToSlimcore, enableQos = {0}",t),(t?this.teamsMeetingConfiguration.getTeamsMeetingConfiguration():this.promiseFactory.resolve()).then(i=>{if(!t)return e.cancel({message:"enableQos_set_to_false"}),Promise.resolve();if(!i)return e.cancel({message:"teamsMeetingConfiguration_is_unavailable"}),Promise.resolve();this.logger.info("setTeamsMeetingConfigurationToSlimcore, teamsMeetingConfiguration = {0}",i);let n=this.teamsMeetingConfiguration.convertTeamsMeetingConfigurationToSlimcoreMediaConfiguration(i).mediaPortRanges,a=!1;i&&void 0!==i.enableQoS&&null!==i.enableQoS&&(a=i.enableQoS),this.logger.info("setTeamsMeetingConfigurationToSlimcore: mediaPortRanges = {0}",n),this.logger.info("setTeamsMeetingConfigurationToSlimcore: enableMediaQos = {0}",a);let r={mediaPortRanges:n,enableMediaQoS:a};return this.setMediaConfig(r).then(()=>{this.logger.info("setTeamsMeetingConfigurationToSlimcore completed")})}).catch(t=>{e.fail({errorInfo:t}),new l.H("slimcore-calling",this.logger).error(t)})}setMediaBitRateKb(){let e=this.config.enableMediaBitRateSetting(),t=this.config.enableNetworkRoamingPolicyV2();return(this.logger.info("enableMediaBitRateInBps = {0}, enableNetworkRoamingPolicy = {1}",e,t),t)?this.promiseFactory.resolve():(e?this.meetingPolicySettingsStore.whenInitialized():this.promiseFactory.resolve()).then(()=>{if(e){let e=this.meetingPolicySettingsStore.getSettingValue(o.y8.mediaBitRateKb)*a.gT.kiloBitToBit;return this.setMediaConfig({maxBandwidthInBps:e}).then(()=>this.logger.info("setMediaBitRateKb completed"))}}).then(()=>{}).catch(e=>{new l.H("slimcore-calling",this.logger).error(e)})}}},712381:function(e,t,i){i.d(t,{A:()=>h});let n="The log is empty!";class a{constructor(e){this.limit=e,this.logQueue=[]}setCSVHeader(e){this.csvHeader=e}appendLogEntry(e){e&&(this.logQueue.length>=this.limit&&this.logQueue.shift(),this.logQueue.push(e))}dump(){if(!this.logQueue||0===this.logQueue.length)return n;let e="";for(let t of(this.csvHeader&&(e+=this.csvHeader,e+="\n"),this.logQueue))e+=t,e+="\n";return e||n}}var r,o,s=i(945761),l=i(377957),c=i(229283),d=i(370574),g=i(892891);(r=o||(o={})).INFO="Inf",r.WARN="War",r.ERROR="Err";class h{constructor(e,t=s.Wq){this.config=e,this.promiseFactory=t,this.csvHeaderColumns=null,this.hasFlattenedColumnHeader=!1,this.transcriptEntryStatisticDataMap=new Map,this.transcriptBotDiagnosticDataMap=new Map,this.transcriptBotMonitorDataMap=new Map,this.participantsVoiceLevelsMap=new Map,this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.logQueueHelper=new a(this.config.meetingIntelligenceLogLimit()||1e3)}mtmaTelemetryIdentifier(){return"MeetingIntelligenceLogService"}cleanupOnAppTeardown(e){this.logQueueHelper=void 0}getLogs(){return this.config.enableCallTranscriptMeetingIntelligenceLogService()?this.promiseFactory.resolve(this.logQueueHelper.dump()):this.promiseFactory.resolve("Meeting intelligence log service is disabled.")}error(e,t="",i=""){let n=this.prepareLogEntry(o.ERROR,e,t,i);this.addLogToQueue(n)}info(e,t="",i=""){let n=this.prepareLogEntry(o.INFO,e,t,i);this.addLogToQueue(n)}warn(e,t="",i=""){let n=this.prepareLogEntry(o.WARN,e,t,i);this.addLogToQueue(n)}updateStatisticData(e,t){this.transcriptEntryStatisticDataMap.set(e,t)}updateParticipantsVoiceLevels(e,t){if(this.participantsVoiceLevelsMap.has(e)||this.participantsVoiceLevelsMap.set(e,!1),this.participantsVoiceLevelsMap.get(e))return;let i=t.some(({voiceLevel:e,isServerMuted:t})=>e>0&&!t);i&&this.participantsVoiceLevelsMap.set(e,i)}getTranscriptBotDiagnosticResult(e,t){let i=l.w.getTeamsCallIdAsString(e.teamsCallId),n=this.transcriptEntryStatisticDataMap.get(i),a=this.transcriptBotDiagnosticDataMap.get(i),r=this.transcriptBotMonitorDataMap.get(i);if(n&&a&&r&&(this.updateCurrentIntervalDataCount(n,a),r.transcriptBotDiagnosticCount++,0===a.currentIntervalCaptionDataCount&&this.isActiveSpeakerInCurrentInterval(e)&&r.noUtteranceReceivedCount++,this.isCorrespondingTextTrack(e,a,c.cl.Mt)&&0!==a.currentIntervalCaptionDataCount&&0===a.currentIntervalTextTracks[c.cl.Mt]&&r.noTranslationReceivedCount++,this.isCorrespondingTextTrack(e,a,c.cl.Cart)&&0!==a.currentIntervalCaptionDataCount&&0===a.currentIntervalTextTracks[c.cl.Cart]&&r.noCARTUtteranceReceivedCount++,this.isCorrespondingTextTrack(e,a,c.cl.Cea708)&&0!==a.currentIntervalCaptionDataCount&&0===a.currentIntervalTextTracks[c.cl.Cea708]&&r.noRTMPUtteranceReceivedCount++,r.finalDiagnosticResult.diagnosticResultArray.push({clientCaptionTextTrack:(0,g.cloneDeep)(e.getClosedCaptionsUsingTrack()),currentIntervalVoiceLevel:this.isActiveSpeakerInCurrentInterval(e),currentIntervalCaptionDataCount:a.currentIntervalCaptionDataCount,currentIntervalTextTracks:(0,g.cloneDeep)(a.currentIntervalTextTracks),totalCaptionDataCount:n.totalCaptionDataCount,totalCaptionFinalDataCount:n.totalCaptionFinalDataCount,totalTextTracks:(0,g.cloneDeep)(n.totalTextTracks),totalFinalTextTracks:n.totalFinalTextTracks}),this.participantsVoiceLevelsMap.set(i,!1),!(r.transcriptBotDiagnosticCount<t)))return r.noUtteranceReceivedCount===t?r.finalDiagnosticResult.errorMsg="No utterance received.":r.noTranslationReceivedCount===t?r.finalDiagnosticResult.errorMsg="Utterance received, No translation received.":r?.noCARTUtteranceReceivedCount===t?r.finalDiagnosticResult.errorMsg="Utterance received, No CART received.":r?.noRTMPUtteranceReceivedCount===t&&(r.finalDiagnosticResult.errorMsg="Utterance received, No RTMP received."),this.initTranscriptBotMonitorData(i),r.finalDiagnosticResult}clearTranscriptDiagnosticDataMap(e){this.transcriptEntryStatisticDataMap.delete(e),this.transcriptBotDiagnosticDataMap.delete(e),this.participantsVoiceLevelsMap.delete(e),this.transcriptBotMonitorDataMap.delete(e)}initTranscriptBotDiagnosticData(e){this.transcriptBotDiagnosticDataMap.set(e,{prevClientSubscriptionStatus:c.cl.Ai,prevTotalCaptionDataCount:0,prevTotalTextTracks:{[c.cl.Mt]:0,[c.cl.Cart]:0,[c.cl.Cea708]:0},currentIntervalCaptionDataCount:0,currentIntervalTextTracks:{[c.cl.Mt]:0,[c.cl.Cart]:0,[c.cl.Cea708]:0}}),this.initTranscriptBotMonitorData(e)}initTranscriptBotMonitorData(e){this.transcriptBotMonitorDataMap.set(e,{transcriptBotDiagnosticCount:0,noUtteranceReceivedCount:0,noTranslationReceivedCount:0,noCARTUtteranceReceivedCount:0,noRTMPUtteranceReceivedCount:0,finalDiagnosticResult:{errorMsg:"",diagnosticResultArray:[]}})}isActiveSpeakerInCurrentInterval(e){return this.participantsVoiceLevelsMap.get(l.w.getTeamsCallIdAsString(e.teamsCallId))||e.participants?.some(e=>e.voiceLevel>0&&!e.isServerMuted&&e.state===d.ParticipantState.Connected)}updateCurrentIntervalDataCount(e,t){t.currentIntervalCaptionDataCount=e.totalCaptionDataCount-t.prevTotalCaptionDataCount,Object.keys(e.totalTextTracks).forEach(i=>{let n=e.totalTextTracks[i],a=t.prevTotalTextTracks[i]??0;t.currentIntervalTextTracks[i]=n-a}),t.prevTotalCaptionDataCount=e.totalCaptionDataCount,Object.keys(e.totalTextTracks).forEach(i=>{t.prevTotalTextTracks[i]=e.totalTextTracks[i]})}isCorrespondingTextTrack(e,t,i){let n=t.prevClientSubscriptionStatus===i;t.prevClientSubscriptionStatus=e.getClosedCaptionsUsingSource();let a=t.prevClientSubscriptionStatus===i;return n&&a}addLogToQueue(e){this.logQueueHelper.appendLogEntry(e)}prepareLogEntry(e,t,i="",n=""){return this.hasFlattenedColumnHeader||this.createCSVHeaderColumns(t),this.createCSVLogEntryes(t,e,i,n)}createCSVHeaderColumns(e){if(this.csvHeaderColumns&&this.hasFlattenedColumnHeader)return this.csvHeaderColumns;let t=this.flattenObject(e);t&&(this.hasFlattenedColumnHeader=!0);let i=[];return i.push("timestamp"),i.push("log_type"),i.push("source_file"),i.push("log_message"),i.push(...this.getKeys(t)),this.csvHeaderColumns=i.join(","),this.logQueueHelper.setCSVHeader(this.csvHeaderColumns),this.csvHeaderColumns}createCSVLogEntryes(e,t,i,n){let a=this.flattenObject(e),r=[];return r.push(new Date().toISOString()),r.push(t),r.push(i),r.push(n),r.push(...this.getValues(a)),r.join(",")}getKeys(e){return e?Object.keys(e):[]}getValues(e){return e?Object.values(e):[]}flattenObject(e){if(!e)return null;let t={};for(let i of Object.keys(e))if(e[i]&&"object"==typeof e[i]){let n=this.flattenObject(e[i]);for(let e of Object.keys(n))t[`${i} -> ${e}`]=n[e]}else t[i]=e[i];return t}}},488444:function(e,t,i){var n,a;i.d(t,{p:()=>n}),(a=n||(n={}))[a.Audio=1]="Audio",a[a.Video=2]="Video",a[a.Chat=4]="Chat"},371171:function(e,t,i){i.d(t,{X:()=>b});var n,a,r=i(370574),o=i(892891),s=i(488444),l=i(614352),c=i(575810),d=i(314401),g=i(826757),h=i(793841),p=i(4512),u=i(526260),m=i(855273),_=i(505782),S=i(395250);let C=e=>(0,o.isArray)(e)?`[${e.join(", ")}]`:e;(n=a||(a={}))[n.UnRestricted=0]="UnRestricted",n[n.DisableAudio=1]="DisableAudio",n[n.DisableVideo=2]="DisableVideo",n[n.DisableAV=3]="DisableAV",n[n.DisableChat=4]="DisableChat";let v={UnRestricted:[],DisableAudio:[s.p.Audio],DisableVideo:[s.p.Video],DisableAv:[s.p.Audio,s.p.Video],DisableChat:[s.p.Chat]};class f extends u.s{constructor(e,t,i,n,a,l,c,d){super(),this.config=e,this.localized=t,this.call=i,this.loggingService=n,this.eventingService=a,this.utilityService=l,this.callingSupportService=c,this.callingAlertsService=d,this.unrestrictedParticipants=[],this.restrictedParticipants=[],this.isInitialized=!1,this.isAttendeeRestrictionsEnabledCached=!1,this.isAttendeeRestrictionsUpdatesEnabledCached=!1,this.debouncedSetParticipantsRestrictionStateInternal=(0,o.debounce)(e=>this.setParticipantsRestrictionStateInternal(e),500),this.prevSelfAttendeeRestrictions=[],this.hasMeetingRoleInitialized=!1,this.getParticipantsRestrictionState=(e,t)=>{let i=[],n=[],a=!1,r=this.call.isAttendeeRestrictedModality(t),{unrestrictedPublishStateType:s,restrictedPublishStateType:l}=this.getPublishStateTypeByModality(t);if(r&&s){let r=this.getParticipantByPublishStateType(e,s);i=(0,o.filter)(r,e=>!(0,o.some)(this.unrestrictedParticipants,i=>i.modality===t&&(0,o.includes)(i.participantIds,e)));let l=(0,o.find)(this.unrestrictedParticipants,e=>e.modality===t);n=l?(0,o.difference)(l.participantIds,r):[],a=!(0,o.includes)(r,this.selfParticipant.id),l?l.participantIds=r:this.unrestrictedParticipants.push({modality:t,participantIds:r})}else{let r=this.getParticipantByPublishStateType(e,l);n=(0,o.filter)(r,e=>!(0,o.some)(this.restrictedParticipants,i=>i.modality===t&&(0,o.includes)(i.participantIds,e)));let s=(0,o.find)(this.restrictedParticipants,e=>e.modality===t);i=s?(0,o.difference)(s.participantIds,r):[],a=(0,o.includes)(r,this.selfParticipant.id),s?s.participantIds=r:this.restrictedParticipants.push({modality:t,participantIds:r})}let c=(0,o.concat)(i,n);return(0,o.size)(c)>0&&this.logger.info(`${t}: changedToUnRestricted: ${i}, changedToRestricted: ${n}`),{isSelfParticipantRestricted:a,changedParticipants:c}},this.getPublishStateTypeByModality=e=>{switch(e){case s.p.Audio:return{unrestrictedPublishStateType:r.PublishStateType.AttendeeModalitiesUnrestricted,restrictedPublishStateType:r.PublishStateType.AttendeeAudioRestricted};case s.p.Video:return{unrestrictedPublishStateType:r.PublishStateType.AttendeeVideoUnrestricted,restrictedPublishStateType:r.PublishStateType.AttendeeVideoRestricted};default:return null}},this.sendNotificationForSelfParticipant=e=>{let t=(0,o.find)(e,e=>e.modality===s.p.Audio),i=(0,o.find)(e,e=>e.modality===s.p.Video);this.isTownhallAttendeeWithRaiseHandEnabled?this.handleNotificationsForSelfParticipantTownhallAttendee(t,i):this.handleNotificationsForSelfParticipant(t,i)},this.logger=n.newLogger("AttendeeRestrictionsMixin"),this.logger.info(`[constructor] isAttendeeRestrictionsEnabled: ${this.isAttendeeRestrictionsEnabled}, isAttendeeRestrictionsUpdatesEnabled: ${this.isAttendeeRestrictionsUpdatesEnabled}`),this.defaultRestrictedAttendeeRestrictions=this.config.defaultRestrictedAttendeeRestrictions(),(0,m.U)(i,e=>{this.onCallChanged(e)}),this.publishedStatesChangedSubscription=i.on("publishedStatesChanged",e=>{(g.eU.isCallActive(i)||i.state==r.CallState.Observing)&&this.setParticipantsRestrictionState(e)})}get isAttendeeRestrictionsEnabled(){return this.isAttendeeRestrictionsEnabledCached||(this.isAttendeeRestrictionsEnabledCached=this.callingSupportService.isAttendeeRestrictionsEnabled()),this.isAttendeeRestrictionsEnabledCached}get isAttendeeRestrictionsUpdatesEnabled(){return this.isAttendeeRestrictionsUpdatesEnabledCached||(this.isAttendeeRestrictionsUpdatesEnabledCached=this.callingSupportService.isAttendeeRestrictionsUpdatesEnabled()),this.isAttendeeRestrictionsUpdatesEnabledCached}clearAttendeeRestrictions(){return this.updateAttendeeRestrictions([])}onAttendeeRestrictionsChanged(e){return this.on("attendeeRestrictionsChanged",e)}updateAttendeeRestrictions(e=this.defaultRestrictedAttendeeRestrictions){let t=C(this.attendeeRestrictedModalities),i=C(e);this.logger.info(`attempting update from ${t} to ${i}`);let n=(0,o.xor)(this.attendeeRestrictedModalities,e);if(!this.isAttendeeRestrictionsUpdatesEnabled){let e="updateAttendeeRestrictions failed: isAttendeeRestrictionsUpdatesEnabled is false. Updates to attendeeRestrictions are not permitted.";return this.logger.error(e),this.showErrorNotification(n),Promise.reject(e)}if(!(0,o.isArray)(e)){let t=`AttendeeRestrictions must be an array. Got ${e}`;return this.logger.error(t),Promise.reject(t)}if(!this.call.isActionExecutable(l.k.UpdateAttendeeRestrictions)){let e="updateAttendeeRestrictions failed: user does not have permission to update Attendee restrictions";return this.logger.error(e),this.showErrorNotification(n),Promise.reject(e)}return this.updateAttendeeRestrictionsInternal(e,n)}isSelfAttendeeRestrictedForModality(e){return!!this.call.meetingRole&&"attendee"==this.call.meetingRole&&this.isAttendeeRestrictionsEnabled&&this.call.isAttendeeRestricted(null,!0,e)}isAttendeeRestrictedModality(e){return void 0!=this.attendeeRestrictedModalities&&!!this.isAttendeeRestrictionsEnabled&&this.attendeeRestrictedModalities.includes(e)}isAttendeeRestricted(e,t=!1,i=s.p.Audio){let n;!e&&t&&(e=this.selfParticipant&&this.selfParticipant.id);let a=this.call.isAttendeeRestrictedModality(i);return n=a?!(0,o.some)(this.unrestrictedParticipants,t=>t.modality===i&&(0,o.includes)(t.participantIds,e)):(0,o.some)(this.restrictedParticipants,t=>t.modality===i&&(0,o.includes)(t.participantIds,e)),!(i===s.p.Audio&&(0,h.YU)(this.call))&&(this.call.isRestrictingAnAttendeeAudioEnabled||this.call.isRestrictingAnAttendeeVideoEnabled?n:this.call.isRequestToSpeakEnabled?a&&n:a)}getUnrestrictedParticipants(){let e=[];if(this.call.isRestrictingAnAttendeeAudioEnabled||this.call.isRestrictingAnAttendeeVideoEnabled||this.call.isRequestToSpeakEnabled){let t=[];(0,o.forEach)(this.unrestrictedParticipants,i=>{i.participantIds.forEach(n=>{if(t.includes(n)){let t=e.find(e=>e.participantId===n);t&&t.attendeeRestrictions.push(i.modality)}else e.push({participantId:n,attendeeRestrictions:[i.modality]})}),t=(0,o.union)(t,i.participantIds)})}return e}getAttendeeModalityRestrictions(e){let t=(0,o.find)(this.restrictedParticipants,t=>t.modality===e),i=(0,o.find)(this.unrestrictedParticipants,t=>t.modality===e);return{isMeetingRestricted:this.call.isAttendeeRestrictedModality(e),restrictedParticipantIds:t&&t.participantIds,unrestrictedParticipantIds:i&&i.participantIds}}createStreamingAttendeeMicEnabledReceivedScenario(){let e=this.utilityService.generateUUID(),t=this.loggingService.newScenario(S.RG.StreamingAttendeeMicEnabled);return t.eventData={commandId:e,participantId:this.selfParticipant.id,threadId:this.call.threadId,callId:this.call.callId},t.cancelIfOffline=!0,t}updateAttendeeRestrictionsInternal(e,t){let i={attendeeRestrictions:this.toAttendeeRestrictionsBitmap(e)},n=this.utilityService.generateUUID(),a=this.loggingService.newScenario(S.RG.UpdateAttendeeRestrictions),r=this.calculateScenarioData(t);return a.eventData={reasonCMD:JSON.stringify({commandId:n,scenarioData:r}),commandId:n,modality:r.modality,operationType:r.operationType},a.cancelIfOffline=!0,new Promise((e,r)=>{this.call.updateMeetingSettings(i,n).then(()=>{a.stop(),e()}).catch(e=>{let i=JSON.stringify({...e,commandId:n});a.fail({reasonCMD:i});let o=`AttendeeRestrictions: updateAttendeeRestrictions failed with error: ${i}`;this.logger.error(o),this.showErrorNotification(t),r(o)})})}toAttendeeRestrictionsBitmap(e){return e.reduce((e,t)=>e|t,0)}calculateScenarioData(e){let t,i=e.length>0?e[0]:void 0;return i?t=(0,o.includes)(this.attendeeRestrictedModalities,i)?"remove":"add":this.logger.info("There was no change to the meeting level modalities. Can't determine what operation this was for."),{modality:i,operationType:t}}onCallChanged(e){switch(e.state){case r.CallState.Staging:case r.CallState.Connected:let t=[{hostSettingType:d.U7.AttendeeRestrictionsUpdate,currentSettingValue:this.isAttendeeRestrictionsEnabled},{hostSettingType:d.U7.RequestToSpeak,currentSettingValue:e.isRequestToSpeakEnabled}];if(this.callingSupportService.notifyUpdatedHostSettings(t),!e.meetingDetails||!e.meetingDetails.meetingCapability)return;let i=this.normalizeAttendeeRestrictions(e.meetingDetails.meetingCapability.attendeeRestrictions);this.hasMeetingRoleInitialized||"attendee"!==this.call.meetingRole||(this.attendeeRestrictedModalities=void 0,this.hasMeetingRoleInitialized=!0),void 0===i||void 0!==this.attendeeRestrictedModalities&&this.areRestrictionsEqual(this.attendeeRestrictedModalities,i)||this.onAttendeeRestrictionsChangedInternal(i),!this.isInitialized&&e.publishedStates&&(this.unrestrictedParticipants=[],this.restrictedParticipants=[],this.setParticipantsRestrictionState(e.publishedStates));break;case r.CallState.Disconnected:this.publishedStatesChangedSubscription&&(this.publishedStatesChangedSubscription.dispose(),this.publishedStatesChangedSubscription=void 0),this.isInitialized=!1,this.selfParticipant=null,this.restrictedParticipants=void 0,this.unrestrictedParticipants=void 0}}onAttendeeRestrictionsChangedInternal(e){this.logger.info(`onChange: changed from ${this.attendeeRestrictedModalities} to ${e}`);let t=(0,o.xor)(this.attendeeRestrictedModalities,e).includes(s.p.Audio),i=(0,o.xor)(this.attendeeRestrictedModalities,e).includes(s.p.Video);if(t&&this.clearParticipantsModalityStates(s.p.Audio),i&&this.clearParticipantsModalityStates(s.p.Video),this.attendeeRestrictedModalities=e,this.eventingService.emit(c.gT.events.calling.attendeeRestrictionsChanged,{teamsCallId:this.call.teamsCallId,attendeeRestrictions:e}),this.event("attendeeRestrictionsChanged").raise({attendeeRestrictions:e}),t&&this.eventingService.emit(c.gT.events.calling.callParticipantModalityRestrictionsChanged,{teamsCallId:this.call.teamsCallId,modality:s.p.Audio}),i&&this.eventingService.emit(c.gT.events.calling.callParticipantModalityRestrictionsChanged,{teamsCallId:this.call.teamsCallId,modality:s.p.Video}),"attendee"==this.call.meetingRole){if(t){let e=this.call.isRaiseHandsEnabled&&!this.call.isHandRaised&&this.call.isRequestToSpeakEnabled,t=this.prevSelfAttendeeRestrictions.includes(s.p.Audio),i=this.call.isAttendeeRestrictedModality(s.p.Audio),n=this.call.isRestrictingAnAttendeeVideoEnabled;!i||t||(0,h.YU)(this.call)||g.eU.isStreamingAttendee(this.call)?!i&&t&&!(0,h.YU)(this.call)&&this.isPrivateCallingEnabledInSSFC()&&this.showNotification(s.p.Audio,{name:"Meeting_attendees_audio_unrestricted",dismissable:!0,title:this.localized.callingAttendeeHardMuteMicEnabledUfdTitle(),text:this.localized.callingAttendeeHardMuteMicEnabledUfdText(),type:p.NK.Warning}):this.showNotification(s.p.Audio,{name:"Meeting_attendees_audio_restricted",dismissable:!0,title:this.localized.callingAttendeeHardMutedSelfUfdTitle(),text:n?this.localized.callingAttendeeHardMutedSelfUfdText():e?this.localized.callingAttendeeHardMutedUfdText():"",type:p.NK.Warning}),this.updatePreviousSelfRestrictionsState(s.p.Audio)}i&&this.callingSupportService.isAttendeeVideoRestrictionsEnabled()&&this.onVideoRestrictionsChanged()}}onVideoRestrictionsChanged(){let e=this.prevSelfAttendeeRestrictions.includes(s.p.Video),t=this.call.isAttendeeRestrictedModality(s.p.Video);!t||e||g.eU.isStreamingAttendee(this.call)||this.call.isImmersiveEvent?t||!e||this.call.isImmersiveEvent||this.showNotification(s.p.Video,{name:"Meeting_attendees_video_unrestricted",dismissable:!0,title:this.localized.callingAttendeeVideoUnrestrictedUfdTitle(),text:this.localized.callingAttendeeVideoUnrestrictedUfdText(),type:p.NK.Warning}):this.showNotification(s.p.Video,{name:"Meeting_attendees_video_restricted",dismissable:!0,title:this.localized.callingAttendeeVideoRestrictedUfdTitle(),text:this.localized.callingAttendeeVideoRestrictedUfdText(),type:p.NK.Warning}),this.updatePreviousSelfRestrictionsState(s.p.Video)}normalizeAttendeeRestrictions(e){if(!Number.isInteger(e))return v[e];{let t=[];return Object.keys(s.p).map(i=>{let n=Number(i);n&&e&n&&t.push(n)}),t}}areRestrictionsEqual(e,t){return(0,o.isEqual)(e.sort(),t.sort())}showNotification(e,t){let i=[];"Meeting_self_attendee_audio_restricted"===t.name&&i.push("MicMutedRemotely"),this.dismissAttendeeRestricitonNotifications(e,i),this.callingAlertsService.handleOnDemandAlert({teamsCallId:this.call.teamsCallId,timeout:this.config.attendeeRestrictionsUfdTimeoutInMs(),...t})}dismissAttendeeRestricitonNotifications(e,t){let i=t??[];switch(e){case s.p.Video:i=(0,o.concat)(["Meeting_attendees_video_restricted","Meeting_attendees_video_unrestricted","Meeting_self_attendee_video_restricted","Meeting_self_attendee_video_unrestricted"],i);break;case s.p.Audio:default:i=(0,o.concat)(["Meeting_attendees_audio_restricted","Meeting_attendees_audio_unrestricted","Meeting_self_attendee_audio_restricted","Meeting_self_attendee_audio_unrestricted"],i)}let n=this.callingAlertsService.getAlertsOfTypes(i);(0,o.forEach)(n,e=>this.callingAlertsService.dismiss(e))}showErrorNotification(e){(0,o.map)(e,e=>{let t={actions:void 0,dismissable:!0,name:"Meeting_attendees_audio_failed",text:this.localized.callingAttendeeHardMutedUfdErrorText(),title:void 0,type:p.NK.Info,windowType:p.MA.CallingFooter};switch(e){case s.p.Video:t.name="Meeting_attendees_video_failed",t.text=this.localized.callingAttendeesVideoRestrictedUfdErrorText();case s.p.Audio:}this.showNotification(e,t)})}setParticipantsRestrictionState(e){this.selfParticipant?(this.debouncedSetParticipantsRestrictionStateInternal(e),this.isInitialized=!0):this.call.getSelfParticipant().then(t=>{this.selfParticipant=t,this.debouncedSetParticipantsRestrictionStateInternal(e),this.isInitialized=!0})}getParticipantByPublishStateType(e,t){let i=e&&e.typeStates&&e.typeStates.length&&(0,o.find)(e.typeStates,e=>e&&e.type===t);if(!i||!i.participantStates||!i.participantStates.length)return[];let n=[];return i.participantStates.forEach(e=>{e&&e.id&&e.publishedState&&e.publishedState.stateId&&n.push(e.id)}),n}clearParticipantsModalityStates(e){let t=(0,o.find)(this.unrestrictedParticipants,t=>t.modality===e);t&&(t.participantIds=[]);let i=(0,o.find)(this.restrictedParticipants,t=>t.modality===e);i&&(i.participantIds=[])}setParticipantsRestrictionStateInternal(e){let t=[],i=!1,n=!1,a=a=>{let{isSelfParticipantRestricted:r,changedParticipants:l}=this.getParticipantsRestrictionState(e,a),c=(0,o.includes)(l,this.selfParticipant.id);a===s.p.Audio&&(0,o.size)(l)?i=!0:a===s.p.Video&&(0,o.size)(l)&&(n=!0),"attendee"===this.call.meetingRole&&!(0,h.YU)(this.call)&&c&&t.push({modality:a,selfRestricted:r})};(this.call.isRequestToSpeakEnabled||this.call.isRestrictingAnAttendeeAudioEnabled||this.call.isAttendeeRestrictedModality(s.p.Audio))&&a(s.p.Audio),(this.call.isRequestToSpeakEnabled||this.call.isRestrictingAnAttendeeVideoEnabled||this.call.isAttendeeRestrictedModality(s.p.Video))&&a(s.p.Video),(0,o.size)(t)>0&&(this.logger.info(`sending notification for self participant: ${JSON.stringify(t)}`),this.sendNotificationForSelfParticipant(t),(0,o.forEach)(t,e=>e.selfRestricted?this.prevSelfAttendeeRestrictions.push(e.modality):(0,o.remove)(this.prevSelfAttendeeRestrictions,t=>t===e.modality))),(i||n)&&this.eventingService.emit(c.gT.events.calling.attendeeParticipantRestrictionsChanged,{teamsCallId:this.call.teamsCallId}),i&&this.call.isRestrictingAnAttendeeAudioEnabled&&this.eventingService.emit(c.gT.events.calling.callParticipantModalityRestrictionsChanged,{teamsCallId:this.call.teamsCallId,modality:s.p.Audio}),n&&this.call.isRestrictingAnAttendeeVideoEnabled&&this.eventingService.emit(c.gT.events.calling.callParticipantModalityRestrictionsChanged,{teamsCallId:this.call.teamsCallId,modality:s.p.Video})}updatePreviousSelfRestrictionsState(e){this.call.isSelfAttendeeRestrictedForModality(e)?this.prevSelfAttendeeRestrictions.push(e):this.prevSelfAttendeeRestrictions.includes(e)&&(0,o.remove)(this.prevSelfAttendeeRestrictions,t=>t===e)}get isAttendeeEndpoint(){let e=this.call.endpoints?.endpointDetails?.find(e=>e.endpointId===this.call.endpointId);return e?.endpointMeetingRoles?.includes("attendee")??!1}get isTownhallAttendeeWithRaiseHandEnabled(){return!!(this.callingSupportService.isRaiseHandsEnabledForStreaming?.()&&this.config.enableRaiseHandForStreaming?.()&&this.call.meetingDetails?.meetingCapability?.forceAttendeeStreaming&&("attendee"===this.call.meetingRole||this.isAttendeeEndpoint))}handleNotificationsForSelfParticipantTownhallAttendee(e,t){let i=this.prevSelfAttendeeRestrictions.includes(s.p.Audio),n=this.prevSelfAttendeeRestrictions.includes(s.p.Video),a=e&&t;if(e&&(a||!t&&n===e.selfRestricted)){if(e.selfRestricted&&!i)this.dismissAttendeeRestricitonNotifications(s.p.Video),this.showNotification(s.p.Audio,{name:"Meeting_self_attendee_audio_restricted",dismissable:!0,title:this.localized.callingAttendeeAudioAndVideoRestrictedUfdTitle(),text:this.localized.callingAttendeeAudioAndVideoRestrictedUfdText(),type:p.NK.Warning});else if(!e.selfRestricted&&i&&this.isPrivateCallingEnabledInSSFC()){let e=this.createStreamingAttendeeMicEnabledReceivedScenario();this.dismissAttendeeRestricitonNotifications(s.p.Video),this.showNotification(s.p.Audio,{name:"Meeting_self_attendee_audio_unrestricted",dismissable:!0,title:this.localized.callingAttendeeAudioAndVideoUnrestrictedUfdTitle(),text:this.localized.callingAttendeeAudioAndVideoUnrestrictedUfdText(),type:p.NK.Info,narrated:!0,autoFocus:!0}),e?.stop()}}t&&(a||!e&&i===t.selfRestricted)&&(t.selfRestricted&&!n?(this.dismissAttendeeRestricitonNotifications(s.p.Audio),this.showNotification(s.p.Video,{name:"Meeting_self_attendee_video_restricted",dismissable:!0,title:this.localized.callingAttendeeAudioAndVideoRestrictedUfdTitle(),text:this.localized.callingAttendeeAudioAndVideoRestrictedUfdText(),type:p.NK.Warning})):!t.selfRestricted&&n&&(this.dismissAttendeeRestricitonNotifications(s.p.Audio),this.showNotification(s.p.Video,{name:"Meeting_self_attendee_video_unrestricted",dismissable:!0,title:this.localized.callingAttendeeAudioAndVideoUnrestrictedUfdTitle(),text:this.localized.callingAttendeeAudioAndVideoUnrestrictedUfdText(),type:p.NK.Warning})))}handleNotificationsForSelfParticipant(e,t){if(e){let t=this.prevSelfAttendeeRestrictions.includes(s.p.Audio);e.selfRestricted&&!t?this.showNotification(s.p.Audio,{name:"Meeting_self_attendee_audio_restricted",dismissable:!0,title:this.localized.callingAttendeeHardMutedSelfUfdTitle(),text:this.call.isRestrictingAnAttendeeVideoEnabled?this.localized.callingAttendeeHardMutedSelfUfdText():this.localized.callingAttendeeHardMutedUfdText(),type:p.NK.Warning}):!e.selfRestricted&&t&&this.isPrivateCallingEnabledInSSFC()&&this.showNotification(s.p.Audio,{name:"Meeting_self_attendee_audio_unrestricted",dismissable:!0,title:this.localized.callingAttendeeHardMuteMicEnabledUfdTitle(),text:this.localized.callingAttendeeHardMuteMicEnabledUfdText(),type:p.NK.Info,narrated:!0,autoFocus:!0})}if(t){let e=this.prevSelfAttendeeRestrictions.includes(s.p.Video);t.selfRestricted&&!e?this.showNotification(s.p.Video,{name:"Meeting_self_attendee_video_restricted",dismissable:!0,title:this.localized.callingAttendeeVideoRestrictedUfdTitle(),text:this.localized.callingAttendeeVideoRestrictedUfdText(),type:p.NK.Warning}):!t.selfRestricted&&e&&this.showNotification(s.p.Video,{name:"Meeting_self_attendee_video_unrestricted",dismissable:!0,title:this.localized.callingAttendeeVideoUnrestrictedUfdTitle(),text:this.localized.callingAttendeeVideoUnrestrictedUfdText(),type:p.NK.Warning})}}isPrivateCallingEnabledInSSFC(){return!this.call.isScreenshareFromChat||!!this.callingSupportService.isPrivateCallingEnabled}}class b extends _.r{constructor(e,t,i,n,a,r,o){super({...(0,_.f)({methods:["clearAttendeeRestrictions","getAttendeeModalityRestrictions","getUnrestrictedParticipants","isAttendeeRestricted","isAttendeeRestrictedModality","isSelfAttendeeRestrictedForModality","onAttendeeRestrictionsChanged","updateAttendeeRestrictions"],props:["attendeeRestrictedModalities","isAttendeeRestrictionsEnabled","isAttendeeRestrictionsUpdatesEnabled"]}).syncedWith(),createMixin:s=>new f(e,t,s,n,a,r,o,i.callingAlertsService())})}}},756643:function(e,t,i){i.d(t,{a:()=>d});var n=i(370574),a=i(892891),r=i(945761),o=i(575810),s=i(395250);class l{constructor(e,t,i,a,l=r.Wq){this.config=e,this.call=t,this.utilityService=i,this.promiseFactory=l,this.logger=a.newLogger("BreakoutRoomsMixinImplementation"),this.breakoutRoomTimerInfo={},this.breakoutRoomsActionsQueue=[],this.breakoutRoomsState=(e=>{let{call:t,logger:i}=e,a=t.callId,r=(e=>{let{promiseFactory:t,utilityService:i,call:a,logger:r,loggingService:l}=e,c={isLoaded:!1,waiterPromise:null,loadingPromise:t.createDeferred(),callSubscription:null},d=()=>{let e=l.findScenario(s.RG.BreakoutRoomsWithDetails);if(e)return e;let t=l.newScenario(s.RG.BreakoutRoomsWithDetails);return t.appendEventData({callId:a.callId,type:o.gT.breakoutRooms.telemetry.dataSource.assignmentDistribution}),t},g=()=>{c.callSubscription?.dispose(),c.callSubscription=null},h=()=>{if(Object.keys(a.breakoutRoomProperties||{}).length>0){d().mark(s.ck.BreakoutRoomsListOfRoomsLoaded,{reason:"breakout room call"}),r.info("Loading list of rooms finished: it's breakout room call"),p();return}let{breakoutRoomsEnabled:e}=Object(a.meetingDetails?.meetingCapability),{isDataFetched:t}=Object(a.breakoutDetails?.mainMeetingProperties),i=!!a.breakoutDetails?.mainMeetingProperties?.allBreakoutRooms?.length,n=!1===e,o=!0===e&&!0===t;if(n||o||i){let e=`noBreakoutRooms=${n}, breakoutRoomsLoaded=${o}`;d().mark(s.ck.BreakoutRoomsListOfRoomsLoaded,{reason:e}),r.info(`Loading list of rooms finished: ${e}`),p();return}},p=({error:e}={})=>{e?c.loadingPromise.reject(Error(e)):c.loadingPromise.resolve(),g(),c.isLoaded=!0};return{wait:()=>c.isLoaded?void 0:(c.waiterPromise||(c.waiterPromise=new Promise(async(e,t)=>{let o=()=>{i.clearTimeout(l),c.waiterPromise=null,g()},l=i.setTimeoutMs(()=>{let e="Timeout on awaiting rooms loading from call";o(),u.fail({reason:e}),t(Error(e))},15e3),u=d();try{await a.getMeetingDetails(),u.mark(s.ck.CallActivation),r.info(`Loading list of rooms: call activation completed. callId: ${a.callId}`),!c.callSubscription&&(h(),c.isLoaded||(c.callSubscription=a.changed(()=>{if(a.state===n.CallState.Disconnected){g(),c.isLoaded||p({error:"Call was disconnected"});return}c.isLoaded||h()}))),await c.loadingPromise.promise,u.stop(),e(null)}catch(e){r.error(`Error fetching list of rooms: ${e?.message}. callId: ${a.callId}`),u.fail({reason:e?.message}),t(e)}finally{o()}})),c.waiterPromise)}})(e);return{getBreakoutRooms:async()=>{i.info(`Start loading list of rooms. callId: ${a}`),await r.wait(),i.info(`Loading list of rooms completed: callId: ${a}`);let e=t.breakoutDetails?.mainMeetingProperties?.allBreakoutRooms;return i.info(`Fetched breakout rooms count: ${e?.length||0}. callId: ${a}`),e||[]}}})({call:t,utilityService:i,promiseFactory:l,logger:this.logger,loggingService:a}),this.remainingDurationInfo={remainingRoomDuration:this.breakoutRoomProperties.remainingRoomDuration,initializedAt:i.getTimeMs()},this.callChangedSubscription=t.changed(()=>this.handleCallChanged())}waitForBreakoutRoomActionCompletion(e,t,i,n){let a=this.promiseFactory.createDeferred(),r=0,o={actionId:e,callWaitPredicate:t,resolve:()=>{this.utilityService.clearTimeout(r),a.resolve()},reject:t=>{this.removeActionFromActionsQueue(e),this.utilityService.clearTimeout(r),a.reject(Error(t))}};return r=this.utilityService.setTimeoutMs(()=>{this.logger.errorToTelemetry?.(`Action ${e} timed out. Call state = ${this.call.state}. CallId = ${this.call.callId}. PID = ${this.call.participantId}. Current version = ${this.call.breakoutDetails?.mainMeetingProperties?.breakoutRoomVersion}.`,"breakout_rooms_action_timeout"),o.reject(`Action "${e}" timed out`)},i),n.catch(()=>{o.reject(`Action ${e} failed`)}),this.breakoutRoomsActionsQueue.push(o),a.promise}get breakoutRoomInfo(){let e;if((0,a.isEmpty)(this.breakoutRoomInvitationData))return null;let{meetingName:t,relatedMeetingCoords:i,shouldAutoAcceptInvite:n,hasReconciledPstn:r,correlationId:o}=this.breakoutRoomInvitationData;return this.isBreakoutRoom()&&(e=this.breakoutRoomProperties.mainMeetingJoinUrl),{meetingName:t,relatedMeetingCoords:i,shouldAutoAcceptInvite:n,mainMeetingJoinUrl:e,hasReconciledPstn:r,correlationId:o}}isBreakoutRoomInvite(){return this.isIncomingReplacesCall()&&!!this.breakoutRoomInvitationData.isRoomInvite}isMainMeetingInvite(){return this.isIncomingReplacesCall()&&!!this.breakoutRoomInvitationData.isMainMeetingInvite}isBreakoutRoom(){return!(0,a.isEmpty)(this.breakoutRoomProperties)}isBreakoutRoomTimer(){return this.isBreakoutRoom()&&!!this.breakoutRoomProperties.remainingRoomDuration}async takeControlToManageBreakoutRooms(e){let t=e?.causeId??this.utilityService.generateUUID(),i={type:n.PublishStateType.ManageBreakoutRooms,level:n.PublishStateLevel.Endpoint,content:"{}"};await this.call.publishState(i,t)}get breakoutRoomProperties(){let e=this.call.meetingDetails&&this.call.meetingDetails.breakoutDetails&&this.call.meetingDetails.breakoutDetails.breakoutRoomProperties||{};return(0,a.isEmpty)(e)?{}:{mainMeetingJoinUrl:e.mainMeetingJoinUrl,remainingRoomDuration:this.parseRemainingDuration(e.remainingRoomDuration),isRoomAutoJoinEnabled:this.isRoomAutoJoinEnabled}}getCurrentRemainingDuration(){let{remainingRoomDuration:e,initializedAt:t=0}=this.remainingDurationInfo||{};if(e)return Math.max(e-(this.utilityService.getTimeMs()-t),0)}async getBreakoutRooms(){try{return await this.breakoutRoomsState.getBreakoutRooms()}catch(e){throw this.logger.error(`Failed to load breakout rooms: ${e?.message}`),e}}removeActionFromActionsQueue(e){this.breakoutRoomsActionsQueue=this.breakoutRoomsActionsQueue.filter(t=>t.actionId!==e)}isIncomingReplacesCall(){return"replaces"===this.call.incomingCallType&&this.call.state===n.CallState.Notified}get breakoutRoomInvitationData(){return this.call.invitationData&&this.call.invitationData.breakoutRoomData||{}}parseRemainingDuration(e){if(!((0,a.isNil)(e)||(0,a.isEmpty)(e)))try{return this.utilityService.parseFormattedDurationString(e)}catch(t){this.logger.warn(`Failed to parse duration: ${e}.`);return}}get isRoomAutoJoinEnabled(){let e=this.breakoutRoomInvitationData;if(!(0,a.isNil)(e)&&!(0,a.isEmpty)(e))return!1!==e.shouldAutoAcceptInvite;let{allowMoveParticipantsAutomatically:t}=this.call.meetingDetails&&this.call.meetingDetails.breakoutDetails&&this.call.meetingDetails.breakoutDetails.additionalData||{};return this.utilityService.parseBoolean(t,!0)}processBreakoutRoomsActions(){let e=this.call.breakoutDetails?.mainMeetingProperties?.breakoutRoomVersion,t=this.breakoutRoomsActionsQueue.filter(t=>{let i=t.actionId,n=!1;try{n=i===e||t.callWaitPredicate(this.call)}catch(e){this.logger.error(`callWaitPredicate threw error for actionId ${i}`)}return n?(this.logger.info(`[BR actions executor] Completed "${i}" action.`),t.resolve(),!1):(this.logger.info(`[BR actions executor] Action "${i}" is still ongoing.`),!0)});this.breakoutRoomsActionsQueue=t}abandonBreakoutRoomsActions(){this.breakoutRoomsActionsQueue.forEach(e=>{this.logger.info(`[BR actions executor] Abandoned "${e.actionId}" action.`),e.reject("abandoned")})}handleCallChanged(){try{let e=this.call.breakoutRoomProperties.remainingRoomDuration;this.remainingDurationInfo&&this.remainingDurationInfo.remainingRoomDuration!==e&&(this.remainingDurationInfo={remainingRoomDuration:e,initializedAt:this.utilityService.getTimeMs()}),this.processBreakoutRoomsActions(),this.call&&this.call.state===n.CallState.Disconnected&&this.callChangedSubscription&&(this.callChangedSubscription.dispose(),this.abandonBreakoutRoomsActions())}catch(e){this.logger.warn("Failed to handle call changed event.")}}}var c=i(505782);class d extends c.r{constructor(e,t,i){super({...(0,c.f)({methods:["isBreakoutRoomInvite","isMainMeetingInvite","isBreakoutRoom","getCurrentRemainingDuration","isBreakoutRoomTimer","takeControlToManageBreakoutRooms","getBreakoutRooms","waitForBreakoutRoomActionCompletion"],props:["breakoutRoomInfo","breakoutRoomProperties","breakoutRoomTimerInfo","remainingDurationInfo"]}).syncedWith(),createMixin:n=>new l(e,n,t,i)})}}},396172:function(e,t,i){var n,a,r,o,s,l;i.d(t,{I_:()=>n,PR:()=>r,Tp:()=>a,aG:()=>c,b7:()=>d}),(o=n||(n={}))[o.none=0]="none",o[o.disabled=1]="disabled",o[o.started=2]="started",o[o.stopped=3]="stopped",o[o.pending=4]="pending",o[o.failed=5]="failed",(s=a||(a={}))[s.NONE=0]="NONE",s[s.PENDING_ON_BOT_JOIN=1]="PENDING_ON_BOT_JOIN",s[s.PENDING_ON_SEND_COMMAND_TO_BOT=2]="PENDING_ON_SEND_COMMAND_TO_BOT",s[s.ADD_BOT_FAILED=3]="ADD_BOT_FAILED",s[s.START_CAPTIONS_FAILED=4]="START_CAPTIONS_FAILED",(l=r||(r={})).ManualTrigger="ManualTrigger",l.Shortcut="Shortcut",l.AutoStart="AutoStart",l.RTTPanel="RTTPanel",l.TranscriptPanel="TranscriptPanel",l.RetryUFD="RetryUFD";let c=10,d=1050},909968:function(e,t,i){i.d(t,{D:()=>O});var n,a,r=i(505782),o=i(370574),s=i(575810),l=i(229283),c=i(223305),d=i(273213),g=i(4512),h=i(396172),p=i(415912),u=i(855273),m=i(892891);let _=(e,t)=>e?.filter(t)[0],S=e=>t=>t?.source===e;var C=i(826757),v=i(652549),f=i(793841),b=i(373649),y=i(395250),T=i(634504);class I{constructor(e,t,i){this.tag=e,this.utilityService=t,this.logger=i,this.queue=[],this.workingOnPromise=!1}enqueue(e){return new Promise((t,i)=>{this.queue.push({promise:e,resolve:t,reject:i}),this.dequeue()})}clearQueue(){this.queue=[],this.workingOnPromise=!1}dequeue(){if(this.workingOnPromise)return void this.logger.log(`${this.tag}: Working on promise, skip dequeue`);let e=this.queue.shift();if(!e)return void this.logger.log(`${this.tag}: No item to dequeue`);let t=(0,T.Z)();this.logger.log(`${this.tag}[${t}]: Dequeue item`),this.workingOnPromise=!0,e.promise().then(i=>{this.logger.log(`${this.tag}[${t}]: Promise resolved`),e.resolve(!!i)}).catch(i=>{let n=this.utilityService.getErrorLoggingString(i);this.logger.log(`${this.tag}[${t}]: Promise rejected with error: ${n}`),e.reject(n)}).finally(()=>{this.workingOnPromise=!1,this.dequeue()})}}var A=i(200669),E=i(451324);let M=(e,t)=>e.source===t.source&&e.language.toLowerCase()===t.language.toLowerCase(),P="transcript_user_subtitle_language_off",k=["TranslatedText","AudioMetadata"],D={zhh:"zh-hk"},R={zh:"zh-cn"},w=[E.ls.RecordingAndTranscriptStartedByOthers,E.vd.TranscriptStartedByOthers],F=[E.ls.RecordingAndTranscriptStarted,E.vd.TranscriptStarted];(n=a||(a={})).notInitialized="notInitialized",n.initializedOff="initializedOff",n.selected="selected";class N{constructor(e,t,i,n,r,o,s,l,g,p,u,m,_,S,C,v,b,y){this.call=e,this.config=t,this.authenticationService=i,this._callClosedCaptionsService=n,this.callingTelemetryService=r,this.loggingService=o,this.sxConfig=s,this.botRestClientService=l,this.utilityService=g,this.localized=p,this.helpers=m,this.chatServiceUtils=_,this.pstnNumberService=S,this.localizationService=C,this.storageService=v,this.callingMultiWindowService=b,this.myUserPreferencesStore=y,this.status=h.I_.disabled,this.subStatus=h.Tp.NONE,this.previousStatus=h.I_.disabled,this.pendingInviteBot=!1,this.isInitiator=!1,this.haveBeenStarted=!1,this.userSpokenLanguage="",this.userTranslatedLanguage="",this.isTranscriptionBotAdded=!1,this.sourceLanguageHistoryForTranslatedText=[],this.sourceLanguageHistoryForAudioMetadata=[],this.userSelectedManually=a.notInitialized,this.isAiInterpretationTurnedOn=!1,this.isLiveInterpretationTurnedOn=!1,this.shouldShowUFDWithConfidence=!1,this.isClosedCaptionsPoppedOut=!1,this.isSpokenLanguageAutoUpdated=!0,this.isCurrentMeetingSpokenLanguageAutoSet=!1,this.getParticipantIdByMri=(e,t)=>{if(t)return this.call.participantId;let i=this.call.participants.find(t=>t.id===e);return i?.endpoints?.endpointDetails?.[0]?.participantId||""},this.hasClosedCaptionsRuntimeError=()=>!!this.config.enableClosedCaptionsErrorMessageBar?.()&&this.getClosedCaptionsRuntimeError().length>0,this.logger=o.newLogger(`CallClosedCaptionMixinImplementation[${e.callId}]`),this.userSpokenLanguageCommandMgr=new I("userSpokenLanguage",g,this.logger),this.userSubtitleLanguageCommandMgr=new I("userSubtitleLanguage",g,this.logger),this.additionalTracks=[],this.unknownUserData={unidentifiedSpeakerIds:[],maskedPstnUserIds:[]},this.isAiInterpretationTurnedOn=(0,f.k$)(e),this.isLiveInterpretationTurnedOn=(0,f.x$)(e);let T=t.enableClosedCaptions();this.retryInterval=t.captionRetryInterval(),this.retryMaxLimit=t.captionMaximalRetryCount(),T?u.callingBotService().then(i=>{this.callingBotService=i,this.setStatus({status:h.I_.none,subStatus:h.Tp.NONE});let n=t.captionsMode();i.getBotInstance(e,n,d.a_.ClosedCaptions,void 0,c.qD.ClosedCaptions).then(e=>{this.bot=e,this.isClosedCaptionsAudioModeEnabled=t.enableClosedCaptionsAudioMode(),this.botStatusChangedSubscription=this.bot.on("botStatusChanged",()=>this.onBotStatusChanged()),this.botStateChangedSubscription=this.bot.on("botStateChanged",()=>this.onBotStateChanged()),this.subscribeToCall(),this.callingAlertsService=u.callingAlertsService(),this.onBotStatusChanged()}).catch(e=>{this.logger.log(e)})}):this.logger.info("closed captions is not supported in this environment")}get isMultilingualMeeting(){return!!this.config.enableMultilingualForInterpretation?.()&&!this.isLiveInterpretationTurnedOn&&(this.isAiInterpretationTurnedOn||(0,f.QQ)(this.call))||!!this.call.meetingDetails?.meetingCapability?.enableMultiLingualMeeting}startClosedCaption(e){if(this.startClosedCaptionsFrom=e,[h.I_.started,h.I_.pending].includes(this.getClosedCaptionStatus())&&!this.hasClosedCaptionsRuntimeError())return void this.logger.warn(`start captions has been triggered, current status: ${this.getClosedCaptionStatus()}`);this.logger.info(`start captions requested by participant ${this.call.participantId}`),this.haveBeenStarted=!0,this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"),this.isInitiator=!0,this.startClosedCaptionsScenario=this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,y.RG.StartClosedCaptions,this.getScenarioData()),this.bot.getStatus()===c.fU.none&&(this.updateStartScenario(y.ck.WaitingForBotReady),this.setStatus({status:h.I_.pending,subStatus:h.Tp.PENDING_ON_BOT_JOIN}));let t=this.bot.getStatus()===c.fU.added;if(this.call.isBroadcast){this.setStatus({status:h.I_.started,subStatus:h.Tp.NONE}),this.updateStartScenario();return}if(t){this.bot.getProcessingModeState(c.qD.ClosedCaptions)!==c.xV.Active?(this.setStatus({status:h.I_.pending,subStatus:h.Tp.PENDING_ON_SEND_COMMAND_TO_BOT}),this.sendCaptionsBotStartCommand()):this.setStatus({status:h.I_.started,subStatus:h.Tp.NONE}),this.updateStartScenario();return}this.updateStartScenario(y.ck.AddBot),this.pendingInviteBot=!0,this.call.state===o.CallState.Connected&&this.bot&&this.addBotParticipant()}stopClosedCaption(){this.setStatus({status:h.I_.stopped,subStatus:h.Tp.NONE}),this.isInitiator=!1}async setClosedCaptionsLanguage(e,t){return this.bot?.getStatus()!==c.fU.added?(this.spokenLanguage=e.toLowerCase(),this.updateTrackWhenSetClosedCaptionsLanguage(e),!0):this.spokenLanguage===e.toLowerCase()?(this.logger.log(`The spoken language is already set to ${e}`),!1):this.config.enableSpokenLanguageRestriction?.()&&!this.call.canChangeMeetingSpokenLanguage()?(this.logger.warn("User is not allowed to change meeting spoken language"),!1):(await this.setSpokenLanguageForActiveCaptions(e.toLowerCase(),t),!0)}setUserClosedCaptionsLanguage(e,t){return this.userSpokenLanguage===e.toLowerCase()?(t||(this.detectedLanguage=void 0),Promise.resolve(!0)):this.setUserSpokenLanguageForActiveCaptions(e.toLowerCase(),t)}getClosedCaptionsBotParticipantId(){return this.bot.getBotActiveModeParticipantId()}getActiveClosedCaptionsTextTracks(){return[...this.additionalTracks,...this.bot?.getTextTracks()||[]].filter(e=>!((!this.config.enableMCRBotRTMPSource?.()||"rtmp"===e.language)&&e.source===l.cl.Cea708))}hasActiveClosedCaptionsTextTrack(e){return this.getActiveClosedCaptionsTextTracks().some(t=>M(t,e))}addClosedCaptionsTextTracks(e){this.validateTracks(e);let t=e.map(e=>({language:e.language.toLowerCase(),source:e.source}));return this.additionalTracks=(0,m.uniqWith)([...this.additionalTracks,...t],M),this.handleCaptionsStatusUpdates(),this.getActiveClosedCaptionsTextTracks()}removeClosedCaptionsTextTracks(e){return this.validateTracks(e),this.additionalTracks=(0,m.differenceWith)(this.additionalTracks,e,M),this.handleCaptionsStatusUpdates(),this.getActiveClosedCaptionsTextTracks()}getClosedCaptionsLanguage(){return this.bot?.getSpokenLanguage()||this.spokenLanguage}closedCaptionsHaveBeenStarted(){return this.haveBeenStarted}getClosedCaptionStatus(){return this.status}getClosedCaptionSubStatus(){return this.subStatus}resolveMeetingIntelligenceDisplayName(e,t){if(e){if(this.chatServiceUtils.isPstnMri(e)&&this.pstnNumberService.isServerSidePstn(e))return this.getMaskedPstnUserDisplayName(e);else if(this.isUnidentifiedTranscriptSpeaker(e))return this.getDistinguishedUserDisplayName(e,t)}return t}async requestClosedCaptionSubtitle(e){return this.userTranslatedLanguage===e?Promise.resolve(!0):this.config.enableSendingSetLanguageCommandInOrder?.()?this.userSubtitleLanguageCommandMgr.enqueue(()=>this.requestClosedCaptionSubtitleAsync(e)).then(e=>(this.logger.log(`Successfully enqueued requestClosedCaptionSubtitleAsync with operation result: ${e}`),Promise.resolve(e))).catch(()=>(this.logger.error("Failed to enqueue requestClosedCaptionSubtitleAsync"),Promise.resolve(!1))):this.requestClosedCaptionSubtitleAsync(e)}getClosedCaptionsTextTrack(){return this.currentTrack}setClosedCaptionsTextTrack(e){return this.userSelectedManually===a.notInitialized?this.userSelectedManually=this.config.enableUnifiedLanguageSettings?.()&&e.source===l.cl.Mt&&"transcript_user_subtitle_language_off"===e.language?a.initializedOff:a.selected:this.userSelectedManually===a.initializedOff&&(this.userSelectedManually=a.selected),this.logger.info(`setClosedCaptionsTextTrack, source: ${e.source}, language: ${e.language}`),this.currentTrack=e,this.updateClosedCaptionsUsingTrack(this.getActiveClosedCaptionsTextTracks(),this.currentTrack),this.updateClosedCaptionsUsingSource(this.getActiveClosedCaptionsTextTracks(),this.currentTrack),this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"),Promise.resolve(!0)}setIsClosedCaptionsPoppedOut(e){this.isClosedCaptionsPoppedOut=e,this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged")}getIsClosedCaptionsPoppedOut(){return this.isClosedCaptionsPoppedOut}getClosedCaptionsUsingTrack(){return this.usingTrack}getHasBeenSelectedManually(){return this.userSelectedManually===a.selected}getClosedCaptionsUsingSource(){return this.usingSource}getIsTranscriptionBotAdded(){return this.isTranscriptionBotAdded}getUserSpokenLanguage(){return this.userSpokenLanguage}getIsSpokenLanguageAutoUpdated(){return this.isSpokenLanguageAutoUpdated}getDetectedSpokenLanguage(){if(this.detectedLanguage)return this.detectedLanguage in R?R[this.detectedLanguage]:this.detectedLanguage}setIsSpokenLanguageAutoUpdated(e){this.isSpokenLanguageAutoUpdated=e,this.logger.log(`setIsSpokenLanguageAutoUpdated: ${e} successfully`),this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged")}getDisplayedUserSpokenLanguage(){return this.config.enableMultilingualMVPForCaptionsAndTranscription?.()?d.px.includes(this.userSpokenLanguage)?this.userSpokenLanguage:this.userSpokenLanguage.split("-")[0]:this.userSpokenLanguage}getUserTranslatedLanguage(){return this.userTranslatedLanguage}getClosedCaptionsRuntimeError(){return(this.bot.getRuntimeErrors()||[]).filter(e=>l.t4.includes(e.errorCode)).map(e=>({code:e.errorCode}))}handleCaptionsStatusUpdates(){let e=this.didSpokenLanguageChange();e&&this.handleSpokenLanguageChange();let t=this.didTextTracksChange();t&&this.handleTextTracksChange(),(t||e)&&(this.updateClosedCaptionsUsingTrack(this.getActiveClosedCaptionsTextTracks(),this.currentTrack),this.updateClosedCaptionsUsingSource(this.getActiveClosedCaptionsTextTracks(),this.currentTrack),this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"))}getDetectedLanguageWithLocale(e){let t=this.config.languageLocaleMappings?.(),i=t?.findIndex(t=>t.languageCode===e.toLowerCase());if(void 0===i||i<0)return;let n=t[i].localeCode;if(!Array.isArray(n)||n.length<2)return;if(2===n.length)return n[1];let a=this.getUserSavedSpokenLanguages(),r=(this.isMultilingualMeeting?a.savedUserSpokenLanguages.concat(a.savedSpokenLanguages):a.savedSpokenLanguages).find(e=>n.includes(e));if(r)return r;let o=this.localizationService?.getLocale().toLowerCase()||"";return n.indexOf(o)>0?o:n[1]}async requestClosedCaptionSubtitleAsync(e,t){if(e===P)return this.userTranslatedLanguage=P,this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"),Promise.resolve(!0);let i=this.utilityService.generateUUID(),n=t??this.getParticipantId(),a=e?[e]:[],r=this.call.callMode===o.CallMode.Streaming,c=r?p.nP.addLanguage:p.nP.setLanguage,d={applyForAllParticipants:r,subtitleLanguages:a},{isCopilot:g,isTPManagement:h}=await this.getUserLicense(),u=this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,y.RG.ClosedCaptionsSetSubtitle,this.getScenarioData({requestId:i,command:{name:c,from:this.userTranslatedLanguage,subtitleLanguages:a},isCopilot:g,isTPManagement:h,participantId:n,savedUserTranslatedLanguage:this.userPreferences?.userTranslatedLanguage,savedUserTranslatedLanguages:this.userPreferences?.savedUserTranslatedLanguages,savedUserTranslatedLanguageForMultilingual:this.userPreferences?.userTranslatedLanguageForMultilingual,savedUserTranslatedLanguagesForMultilingual:this.userPreferences?.savedUserTranslatedLanguagesForMultilingual,isRetryForUserNotInCall:!!t}));this.logger.log(e?`Sending ${c} command: ${e} to request a new track: ${e}}`:`Sending ${c} command: Turning off all subtitle tracks`);let m=null;if(r&&0===(m=this.getStreamingBots()).length){let e="streaming bot is not present in the call";return u.eventData[s.gT.scenarioDataPropNames.captionError]=e,u.fail(),Promise.reject(e)}try{return await v.A.executeTaskWithRetry(()=>this.sendCaptionsBotRequestLanguageCommand(i,c,d,n,!0,m),this.retryInterval.requestSubtitle,this.retryMaxLimit,this.utilityService,(e,t)=>this.onErrorDuringSetLanguageRetry(e,t,u),e=>!this.isNoneRetriableUserNotInCallError(this.utilityService.getErrorLoggingString(e),n)),this.logger.log(e?`Successfully set closed caption tracks to ${e}, participantId: ${n}`:`Successfully sent command to turn off subtitle tracks, participantId: ${n}`),this.userTranslatedLanguage=e,this.usingSource=l.cl.Mt,this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"),u.stop(),Promise.resolve(!0)}catch(i){let t=this.utilityService.getErrorLoggingString(i);return u.eventData[s.gT.scenarioDataPropNames.captionError]=t,t.includes("UserNotInCall")&&n!==this.call.participantId?(u.cancel({reason:t}),this.logger.log("Retry set subtitle command with call.participantId"),this.requestClosedCaptionSubtitleAsync(e,this.call.participantId)):u.fail(),this.logger.error(e?`Failed to request a new track ${e}. Command failed with error ${t}`:`Failed to turn off subtitle tracks. Command failed with error ${t}`),Promise.resolve(!1)}}getParticipantId(){let e="";return this.call.endpoints?.endpointDetails?.forEach(t=>{if(t.endpointId===this.call.endpointId){e=t.participantId;return}}),e||this.call.participantId}getStreamingBots(){let e=[];return this.call.participants.forEach(t=>{t.endpoints?.endpointDetails?.forEach(i=>{i.streamInformation&&e.push({id:t.id,participantId:i.participantId})})}),e}async sendCaptionsBotRequestLanguageCommand(e,t,i,n,a,r){if(this.bot.getProcessingModeState(c.qD.Transcript)===c.xV.Active||this.bot.getProcessingModeState(c.qD.ClosedCaptions)===c.xV.Active||a){if(!r)return this.botRestClientService.sendCommand(this.bot.getCommandUrl(),t,this.sxConfig.getCurrentSkypeMri(),n,this.call.callId,e,p.PM.transcript,p.pi.transcription,[c.qD.ClosedCaptions],i);await Promise.all(r.map(n=>this.botRestClientService.sendCommand(this.bot.getCommandUrl(),t,n.id,n.participantId,this.call.callId,e,p.PM.transcript,p.pi.transcription,[c.qD.ClosedCaptions],i)))}}handleAddPariticipantFailure(e){if(this.bot.getStatus()===c.fU.added)return void this.logger.info("Starting closed caption failed, but caption bot is already in the call");this.logger.error(`Starting closed caption failed for call: ${this.call.callId} with error: ${this.utilityService.getErrorLoggingString(e)}`),this.setStatus({status:h.I_.failed,subStatus:h.Tp.ADD_BOT_FAILED}),this.startClosedCaptionsScenario.mark(y.ck.BotAddFailed),this.startClosedCaptionsScenario.cancel(),this.showCallClosedCaptionsFailedAlert()}async addBotParticipant(){if(this.pendingInviteBot=!1,this.bot.getStatus()===c.fU.added)return void this.logger.info("caption bot is already in the call");try{let e,t=this.config.mustSkipAuth()||this.authenticationService.isAnonymous();if(this.call.isCombinedBotEnabled())try{return await this.call.addCombinedRecorderBot(this.startClosedCaptionsScenario,void 0,void 0,this.config.enableSkipAADTokenWhenTFLAndAnonymous?.()&&t)}catch(e){return this.handleAddPariticipantFailure(e)}try{t||(e=await this.getAuthToken())}catch(e){if(!this.config.useResilientAuth())return this.handleAddPariticipantFailure(e);this.logger.warn(`Getting auth token failed with error ${e}. Continuing with bot addParticipant...`)}let i=await this.bot.createBotPayload(this.startClosedCaptionsScenario,e,"",this.call.conversationId);return await this.call.addParticipant(this.bot.getBotDefaultMRI(),i)}catch(e){return this.handleAddPariticipantFailure(e)}}async sendCaptionsBotStartCommand(){let e=[c.qD.ClosedCaptions],t=this.config.mustSkipAuth()||this.authenticationService.isAnonymous(),i=this.config.enableSkipAADTokenWhenTFLAndAnonymous?.()?await this.botRestClientService.getAuthHeaders(p.nP.start,e,[this.startClosedCaptionsScenario],!1,t):void 0;try{await v.A.executeTaskWithRetry(()=>this.botRestClientService.sendCommand(this.bot.getCommandUrl(),p.nP.start,this.sxConfig.getCurrentSkypeMri(),this.call.participantId,this.call.callId,this.utilityService.generateUUID(),p.PM.transcript,p.pi.transcription,e,void 0,[this.startClosedCaptionsScenario],i),this.retryInterval.sendStartCommand,this.retryMaxLimit,this.utilityService,(e,t)=>{this.logger.warn(`Retry sending command to start closed captions. Current count: ${t}, Last error: ${this.utilityService.getErrorLoggingString(e)}`)})}catch(e){throw this.setStatus({status:h.I_.failed,subStatus:h.Tp.START_CAPTIONS_FAILED}),this.showCallClosedCaptionsFailedAlert(),e}}getDistinguishedUserDisplayName(e,t){let i;return this.isDistinguishedTranscriptSpeaker(t)?i=t.slice(1):(-1===this.unknownUserData.unidentifiedSpeakerIds.indexOf(e)&&this.unknownUserData.unidentifiedSpeakerIds.push(e),i=(this.unknownUserData.unidentifiedSpeakerIds.indexOf(e)+1).toString()),this.localized.anonymousSpeakerName(i)}getMaskedPstnUserDisplayName(e){-1===this.unknownUserData.maskedPstnUserIds.indexOf(e)&&this.unknownUserData.maskedPstnUserIds.push(e);let t=(this.unknownUserData.maskedPstnUserIds.indexOf(e)+1).toString();return this.localized.pstnMaskedSpeakerName(t)}isUnidentifiedTranscriptSpeaker(e){return e.endsWith("@local")}isDistinguishedTranscriptSpeaker(e){return e&&e.startsWith("@")}validateTracks(e){if(!(0,m.isArray)(e))throw Error(`validateTracks failed: textTracks must be an array. You provided ${e}`);e.forEach(e=>{if(!e.source)throw Error(`validateTracks failed: invalid source: ${e.source}`);if(!e.language)throw Error(`validateTracks failed: invalid language: ${e.language}`)})}async getAuthToken(){return this.authenticationService.getAuthTokens([this.config.callRecordingResource()])}async setStatus(e){let{status:t,subStatus:i}=e;if(this.logger.info(`closed captions state ${h.I_[this.status]} --> ${h.I_[t]}`),this.previousStatus=this.status,this.status=t,this.subStatus=i,this.call.state===o.CallState.Connected)if(this.config.syncCallEndpointMetadataUpdates())await this.call.metadataMemo().publishMetadata({transcriptionPrefs:{closedCaptions:t===h.I_.started}});else{let e=C.eU.getOwnEndpoint(this.call),i=e?.endpointMetadata||{};i.transcriptionPrefs=i.transcriptionPrefs||{},i.transcriptionPrefs.closedCaptions=t===h.I_.started,this.call.updateEndpointMetadata(JSON.stringify(i))}t===h.I_.started&&(this.updateClosedCaptionsUsingTrack(this.getActiveClosedCaptionsTextTracks(),this.currentTrack),this.updateClosedCaptionsUsingSource(this.getActiveClosedCaptionsTextTracks(),this.currentTrack)),this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged")}updateTrackWhenSetClosedCaptionsLanguage(e){this.currentTrack?.source===l.cl.Ai&&(this.currentTrack.language=e?.toLowerCase()),this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged")}updateClosedCaptionsUsingTrack(e,t){this.usingTrack=((e,t)=>{let i=_(e,S(l.cl.Ai));if(t?.source===l.cl.Mt&&i&&i.language===t?.language)return i;if(t&&e&&e.some(e=>t.source===e?.source&&(["Cart","Cea708"].includes(e?.source||"")||t.language===e?.language))||t?.source===l.cl.Mt)return t;let n=_(e,S(l.cl.Cea708))||_(e,S(l.cl.Cart));return n&&n!==t?n:i||void 0})(e,t)}updateClosedCaptionsUsingSource(e,t){this.usingSource=((e,t,i,n)=>{let a=_(e,S(l.cl.Ai));if(t&&!n)return t?.source===l.cl.Mt&&t?.language==="transcript_user_subtitle_language_off"?l.cl.Ai:t?.source;let r=_(e,S(l.cl.Cea708))||_(e,S(l.cl.Cart));return r&&r!==t&&n?r.source:t?.source===l.cl.Mt&&"transcript_user_subtitle_language_off"===t.language?l.cl.Ai:t?.source?t?.source:i?l.cl.Mt:a?l.cl.Ai:void 0})(e,t,!!this.userTranslatedLanguage,this.userSelectedManually!==a.selected)}setUserSpokenLanguageForActiveCaptions(e,t){return this.config.enableSendingSetLanguageCommandInOrder?.()?this.userSpokenLanguageCommandMgr.enqueue(()=>this.setUserSpokenLanguageForActiveCaptionsAsync(e,void 0,t)).then(()=>(this.logger.log("Successfully enqueued setUserSpokenLanguageForActiveCaptionsAsync"),!0)).catch(()=>(this.logger.error("Failed to enqueue setUserSpokenLanguageForActiveCaptionsAsync"),!1)):this.setUserSpokenLanguageForActiveCaptionsAsync(e,void 0,t)}async setUserSpokenLanguageForActiveCaptionsAsync(e,t,i){let n={userSpokenLanguage:e},a=this.utilityService.generateUUID(),r=t??this.getParticipantId(),{isCopilot:o,isTPManagement:l}=await this.getUserLicense(),c=this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,y.RG.ClosedCaptionsSetUserLanguage,this.getScenarioData({requestId:a,command:{name:p.nP.setLanguage,from:this.userSpokenLanguage||this.spokenLanguage,to:e,isUserLanguage:!0},isCopilot:o,isTPManagement:l,participantId:r,savedUserSpokenLanguage:this.userPreferences?.userSpokenLanguage,savedUserSpokenLanguages:this.userPreferences?.savedUserSpokenLanguages,isRetryForUserNotInCall:!!t,isAutoUpdate:i}));this.logger.log(`Sending setUserSpokenLanguage command: ${e}. Current user spoken language: ${this.userSpokenLanguage}. New user spoken language: ${e}. participantId: ${r}, isAutoUpdate: ${i}`);try{return await v.A.executeTaskWithRetry(()=>this.sendCaptionsBotRequestLanguageCommand(a,p.nP.setLanguage,n,r,!0),this.retryInterval.setUserSpokenLanguage,this.retryMaxLimit,this.utilityService,(e,t)=>this.onErrorDuringSetLanguageRetry(e,t,c),e=>{let t=this.utilityService.getErrorLoggingString(e);return!(t.includes("HandingOver")||this.isNoneRetriableUserNotInCallError(t,r))}),this.logger.log(`Successfully set user closed caption language to ${e}`),c.stop(),this.userSpokenLanguage=e,i&&this.showLanguageMismatchAutoUpdateUFD(),this.updateTranscriptStartedAlert(),this.dismissMismatchedSpokenLanguageUFDAfterChangedCorrectly(!i),i||(this.sourceLanguageHistoryForTranslatedText=[],this.sourceLanguageHistoryForAudioMetadata=[],this.lastNotAllowedDetectedLanguage=void 0,this.detectedLanguage=void 0),this.updateTrackWhenSetClosedCaptionsLanguage(e),!0}catch(i){let t=this.utilityService.getErrorLoggingString(i);throw c.eventData[s.gT.scenarioDataPropNames.captionError]=t,t.includes("HandingOver")?(this.userSpokenLanguageForHandoverResend=e,c.cancel({reason:t})):t.includes("UserNotInCall")&&r!==this.call.participantId?(c.cancel({reason:t}),this.logger.log("Retry set user language command with call.participantId"),this.setUserSpokenLanguageForActiveCaptionsAsync(e,this.call.participantId)):c.fail({reason:t}),this.logger.errorToTelemetry?.(`Failed to set user language to ${e}. Command failed with error ${t}`,"setUserSpokenLanguageForActiveCaptions"),i}}async setSpokenLanguageForActiveCaptions(e,t,i){let n={spokenLanguage:e},a=this.utilityService.generateUUID(),r=i??this.getParticipantId(),{isCopilot:o,isTPManagement:l}=await this.getUserLicense(),c=this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,y.RG.ClosedCaptionsSetLanguage,this.getScenarioData({requestId:a,command:{name:p.nP.setLanguage,from:this.getClosedCaptionsLanguage(),to:e},isAutoSetLanguage:t,isCopilot:o,isTPManagement:l,participantId:r,isRetryForUserNotInCall:!!i}));this.logger.log(`Sending setLanguage command: ${e}. Current spoken language: ${this.getClosedCaptionsLanguage()}. participantId: ${r}`);try{return await v.A.executeTaskWithRetry(()=>this.sendCaptionsBotRequestLanguageCommand(a,p.nP.setLanguage,n,r,!1),this.retryInterval.setSpokenLanguage,this.retryMaxLimit,this.utilityService,(e,t)=>this.onErrorDuringSetLanguageRetry(e,t,c),e=>!this.isNoneRetriableUserNotInCallError(this.utilityService.getErrorLoggingString(e),r)),this.logger.log(`Successfully set closed caption language to ${e}`),c.stop(),this.updateTrackWhenSetClosedCaptionsLanguage(e),!0}catch(n){let i=this.utilityService.getErrorLoggingString(n);throw c.eventData[s.gT.scenarioDataPropNames.captionError]=i,i.includes("UserNotInCall")&&r!==this.call.participantId?(c.cancel({reason:i}),this.logger.log("Retry set language command with call.participantId"),this.setSpokenLanguageForActiveCaptions(e,!1,this.call.participantId)):i.includes("UserNotInCall")&&t?c.cancel():c.fail(),this.logger.error(`Failed to set language to ${e}. Command failed with error ${i}, isAutoSetLanguage: ${t}`),n}}isNoneRetriableUserNotInCallError(e,t){return e.includes("UserNotInCall")&&t!==this.call.participantId}onErrorDuringSetLanguageRetry(e,t,i){let n=this.utilityService.getErrorLoggingString(e);this.logger.error(`Send setLanguage command failed, retrying with ${t} time. Error: ${n}`),i.mark(y.ck.ClosedCaptionsSetLanguageComandRetrySending,{[s.gT.scenarioDataPropNames.captionError]:n,[s.gT.counters.eventNames.retryCount]:t})}setAudioMode(e){this.isClosedCaptionsAudioModeEnabled&&this.call.setAudioMidcallConfigJson&&this.call.state===o.CallState.Connected&&(this.logger.info(`setAudioMode: speechRecognition: ${e}`),this.call.setAudioMidcallConfigJson({speechRecognition:e}))}onBotStatusChanged(){switch(this.bot.getStatus()){case c.fU.added:this.isTranscriptionBotAdded=!0,this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"),this.logger.info("captions bot is added to the call"),this.updateStartScenario(y.ck.BotAddedScenarioMarkerStep),this.setAudioMode(!0),this.enableSpokenLanguageDetectionUfd()&&this.callingBotService.registerDataCallback(this.call,3,d.a_.LanguageMismatch,this.onDataReceived.bind(this)).catch(e=>{this.logger.log(e)});break;case c.fU.removed:case c.fU.failed:this.isTranscriptionBotAdded=!1,this.usingSource=void 0,this.enableSpokenLanguageDetectionUfd()&&this.callingBotService?.unregisterDataCallback(this.call.callId,this.call.teamsCallId,d.a_.LanguageMismatch),this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"),this.logger.info("Attempting to gracefully handle captions bot failover... "),this.handleBotFailover()}}async getUserLicense(){if(void 0!==this.isCopilot&&void 0!==this.isTPManagement)return{isCopilot:this.isCopilot,isTPManagement:this.isTPManagement};let e=await this.authenticationService.getUserDetails();return this.isCopilot=e?.licenseDetails?.isCopilot??!1,this.isTPManagement=e?.licenseDetails?.isTPManagement??!1,{isCopilot:this.isCopilot,isTPManagement:this.isTPManagement}}async getLanguageDetectionScenarioData(e,t,i,n,a){let r=this.sxConfig.getCurrentSkypeMri(),o=i===r,s=await this.call.getCallingConversationAsync(),l=void 0!==s&&s.isMeeting(),c=r===this.call.getTranscriptCommandInitiator(),{isCopilot:d,isTPManagement:g}=await this.getUserLicense();return{detectedLanguage:e,currentLanguage:t,detectedUserId:this.getParticipantIdByMri(i,o),isSpeaker:o,isMeeting:l,isCopilot:d,isTPManagement:g,isTranscriptInitiator:c,isMultilingualMeeting:!!this.isMultilingualMeeting,shouldShowLanguageButton:!!n,isLIDV3Enabled:a,isAiInterpreterOn:this.isAiInterpretationTurnedOn}}isNotValidDetectedLanguageForMultilingualMVP(e){return!!(this.config.enableMultilingualMVPForCaptionsAndTranscription?.()&&this.isMultilingualMeeting&&!this.config.multilingualSpokenLanguagesForCaptionsAndTranscription?.().some(t=>t.includes(e)))}async onAiInterpreterAudioMetadataReceived(e,t){if(e!==d.xp.AiInterpretation||!k.includes(t.type)||!t.sourceLanguage||this.isNotValidDetectedLanguageForMultilingualMVP(t.sourceLanguage))return;let i=this.sxConfig.getCurrentSkypeMri();if(t?.speakerId===i){if("TranslatedText"===t.type?this.sourceLanguageHistoryForTranslatedText.push(t.sourceLanguage):"AudioMetadata"===t.type&&t.duration>2e3&&!this.sourceLanguageHistoryForAudioMetadata.some(e=>e.sourceLanguage===t.sourceLanguage&&e.seqNo===t.seqNo)&&this.sourceLanguageHistoryForAudioMetadata.push({sourceLanguage:t.sourceLanguage,seqNo:t.seqNo}),this.sourceLanguageHistoryForTranslatedText.length>3&&this.sourceLanguageHistoryForTranslatedText.shift(),this.sourceLanguageHistoryForAudioMetadata.length>3&&this.sourceLanguageHistoryForAudioMetadata.shift(),1===this.call.aiInterpreterlanguageGroupLabels.length&&t.sourceLanguage===this.call.aiInterpreterlanguageGroupLabels[0]&&3===this.sourceLanguageHistoryForTranslatedText.length){let e=this.sourceLanguageHistoryForTranslatedText[0];this.sourceLanguageHistoryForTranslatedText.every(t=>t===e)&&this.dealLanguageMismatchWithAiInterpreter(e,t.speakerId||"");return}if(3===this.sourceLanguageHistoryForAudioMetadata.length){let e=this.sourceLanguageHistoryForAudioMetadata[0].sourceLanguage;this.sourceLanguageHistoryForAudioMetadata.every(t=>t.sourceLanguage===e)&&this.dealLanguageMismatchWithAiInterpreter(e,t.speakerId||"")}}}async dealLanguageMismatchWithAiInterpreter(e,t){let i=(d.px.includes(e)?e.split("-")[0]:e).toLowerCase(),n=this.userSpokenLanguage.split("-")[0];if(n===i){this.detectedLanguage!==i&&(this.dismissMismatchedSpokenLanguageUFD(),this.isSpokenLanguageDetectionAutoUpdateEnabled&&(this.detectedLanguage=i,this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged")));return}let a=await this.getLanguageDetectionScenarioData(i,n,t,void 0,this.config.enableSpokenLanguageDetectionUfdV3?.());this.checkIsMismatchedLanguageUFDAllowed(i,a)||this.shouldShowUFDWithConfidence?(a.shouldShowLanguageButton=!0,this.showMismatchedSpokenLanguageUFD(i,a),this.shouldShowUFDWithConfidence=!1):(this.logger.info("Language mismatch detected with AI interpreter may be wrong, clear history array and detect again."),this.shouldShowUFDWithConfidence=!0,a.shouldShowLanguageButton=!1),this.logger.info(`Language mismatch detected with AI Interpreter, detectedLanguage: ${e}, unifiedDetectedLanguage: ${i}, currentLanguage: ${this.userSpokenLanguage}`),this.sourceLanguageHistoryForTranslatedText=[],this.sourceLanguageHistoryForAudioMetadata=[],this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,y.RG.ClosedCaptionsMismatchedLanguage,a).fail()}dealWithLanguageMismatch(e,t,i){let n=e.toLowerCase(),a=this.checkIsMismatchedLanguageUFDAllowed(n,i),r=this.isMultilingualMeeting&&n===this.lastNotAllowedDetectedLanguage,o=!this.isNotValidDetectedLanguageForMultilingualMVP(n)&&(a||r)&&t;return i.shouldShowLanguageButton=o,o&&this.showMismatchedSpokenLanguageUFD(n,i),this.lastNotAllowedDetectedLanguage&&(this.lastNotAllowedDetectedLanguage=void 0),this.isMultilingualMeeting&&!a&&(this.lastNotAllowedDetectedLanguage=n),o}async onDataReceived(e,t){if(this.bot.hasProcessingMode(c.qD.Transcript)&&this.bot.getProcessingModeState(c.qD.Transcript)===c.xV.Active||this.bot.hasProcessingMode(c.qD.Copilot)&&this.bot.getProcessingModeState(c.qD.Copilot)===c.xV.Active){if(this.config.enableUsingInterpreterLIDResultsForLanguageDetection?.()&&this.isAiInterpretationTurnedOn)return void this.onAiInterpreterAudioMetadataReceived(e,t);if(e===d.xp.Event&&"LanguageMismatch"===t.type){let e=t.detectedLanguage,i=t.currentLanguage,n=!(e&&i&&this.isLanguageMismatched(e,i)),a=this.sxConfig.getCurrentSkypeMri(),r=t.userId===a;if(n){if(this.isSpokenLanguageDetectionAutoUpdateEnabled&&this.detectedLanguage!==e&&(this.detectedLanguage=e,this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged")),this.dismissMismatchedSpokenLanguageUFD(),r){let n=await this.getLanguageDetectionScenarioData(e,i,t.userId,!1);this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,y.RG.ClosedCaptionsMismatchedLanguage,n).stop()}return}let o=await this.getLanguageDetectionScenarioData(e,i,t.userId,void 0,!!this.config.enableSpokenLanguageDetectionUfdV3?.()),s=this.isMultilingualMeeting?r:o.isTranscriptInitiator||o.isMeeting&&"organizer"===this.call.meetingRole,l=this.dealWithLanguageMismatch(e,s,o);(s||r)&&(this.logger.info("Language mismatch detected, current language is: ",i," detected language is: ",e," shouldShowMismatchedLanguageUFD: ",l," isSpeaker: ",r),this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,y.RG.ClosedCaptionsMismatchedLanguage,o).fail())}}}get isSpokenLanguageDetectionAutoUpdateEnabled(){return(this.isMultilingualMeeting?this.config.enableSpokenLanguageAutoUpdateForMultilingual?.():this.config.enableSpokenLanguageDetectionAutoUpdate?.())&&this.isSpokenLanguageAutoUpdated}isLanguageMismatched(e,t){let i=this.config.languageLocaleMappings?.(),n=i?.findIndex(t=>t.languageCode===e.toLowerCase());return i&&i.length>0&&void 0!==n&&-1!==n&&-1===i[n].localeCode.indexOf(t.toLowerCase())}enableSpokenLanguageDetectionUfd(){return this.config.enableSpokenLanguageDetectionUfd?.()&&this.callingBotService}dismissMismatchedSpokenLanguageUFD(){this.mismatchedSpokenLanguageAlert&&(this.callingAlertsService.dismiss(this.mismatchedSpokenLanguageAlert),this.mismatchedSpokenLanguageAlert=void 0),this.displayLanguageMismatchAlertTimerId&&(this.utilityService.clearTimeout(this.displayLanguageMismatchAlertTimerId),this.displayLanguageMismatchAlertTimerId=void 0)}dismissMismatchedSpokenLanguageUFDAfterChangedCorrectly(e){if(this.mismatchedSpokenLanguageAlert){if(e)return void this.dismissMismatchedSpokenLanguageUFD();this.detectedLanguage&&!this.isLanguageMismatched(this.detectedLanguage,this.isMultilingualMeeting?this.userSpokenLanguage:this.spokenLanguage)&&(this.isSpokenLanguageDetectionAutoUpdateEnabled?this.displayLanguageMismatchAlertTimerId=this.utilityService.setTimeoutMs(()=>this.dismissMismatchedSpokenLanguageUFD(),15e3):this.dismissMismatchedSpokenLanguageUFD())}}showMismatchedSpokenLanguageUFD(e,t){if(this.callingAlertsService.getAllActiveAlerts().some(e=>"MismatchedSpokenLanguage"===e.name)){if(e===this.detectedLanguage)return;this.dismissMismatchedSpokenLanguageUFD()}let i=this.getDetectedLanguageWithLocale(e);!this.isSpokenLanguageDetectionAutoUpdateEnabled&&!this.isAiInterpretationTurnedOn&&this.config.codeSwitchSupportedLanguages?.().includes(this.isMultilingualMeeting?this.userSpokenLanguage:this.spokenLanguage)&&"en"===e?(this.logger.info(`Suppress language mismatch UFD for code switch case, detected language: ${e}`),t.shouldSuppressAlertForCodeSwitchCase=!0,t.shouldShowLanguageButton=!1):(this.detectedLanguage=e,this.mismatchedSpokenLanguageAlert=this.getMismatchedSpokenLanguageAlert(i,t),this.isSpokenLanguageDetectionAutoUpdateEnabled||this.callingAlertsService.handleOnDemandAlert(this.mismatchedSpokenLanguageAlert))}showLanguageMismatchAutoUpdateUFD(){this.mismatchedSpokenLanguageAlert&&this.callingAlertsService.handleOnDemandAlert(this.mismatchedSpokenLanguageAlert)}updateTranscriptStartedAlert(){if(this.callingAlertsService.getAllActiveAlerts().some(e=>w.includes(e.name)))return void this.call.updateRecordingAndTranscriptAlerts();this.callingAlertsService.getAllActiveAlerts().some(e=>F.includes(e.name))&&this.call.isTranscriptAutoStarted()&&this.call.updateRecordingAndTranscriptAlerts()}async handleBotFailover(){switch(await new Promise(e=>this.utilityService.setTimeoutMs(e,this.config.transcriptionBotFailoverTimeout())),this.bot.getStatus()){case c.fU.removed:this.logger.info("captions bot removed from call"),this.setStatus({status:h.I_.none,subStatus:h.Tp.NONE}),this.updateStartScenario(y.ck.BotRemoved),this.setAudioMode(!1),this.userSpokenLanguage="",this.userTranslatedLanguage="";break;case c.fU.failed:this.logger.error(`captions bot failed with ${this.bot.getLastError()}`),this.setStatus({status:h.I_.failed,subStatus:h.Tp.NONE}),this.updateStartScenario(void 0,this.bot.getLastError()),this.setAudioMode(!1),this.userSpokenLanguage="",this.userTranslatedLanguage=""}}onBotStateChanged(){if(this.bot.getProcessingModeState(c.qD.Transcript)===c.xV.Active&&this.userSpokenLanguageForHandoverResend&&(this.logger.info("Resending set language command with user spoken language"),this.setUserClosedCaptionsLanguage(this.userSpokenLanguage),this.userSpokenLanguageForHandoverResend=void 0),this.bot.hasProcessingMode(c.qD.ClosedCaptions)){if(this.hasClosedCaptionsRuntimeError())return void this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged");if(this.bot.getProcessingModeState(c.qD.ClosedCaptions)!==c.xV.Active){this.isInitiator&&this.subStatus===h.Tp.PENDING_ON_BOT_JOIN&&(this.setStatus({status:h.I_.pending,subStatus:h.Tp.PENDING_ON_SEND_COMMAND_TO_BOT}),this.sendCaptionsBotStartCommand());return}this.logger.info("closed captions started"),this.isInitiator&&this.status!==h.I_.started&&(this.setStatus({status:h.I_.started,subStatus:h.Tp.NONE}),this.updateStartScenario()),this.status===h.I_.started&&this.handleCaptionsStatusUpdates()}}handleSpokenLanguageChange(){this.logger.info(`captions spoken language changed from ${this.spokenLanguage} to ${this.bot.getSpokenLanguage()}`),this.config.enableSpokenLanguageChangedUfd()&&this.spokenLanguage&&(this.spokenLanguageChangedAlert&&this.callingAlertsService.dismiss(this.spokenLanguageChangedAlert),this.isMultilingualMeeting||(this.isCurrentMeetingSpokenLanguageAutoSet?(this.showLanguageMismatchAutoUpdateUFD(),this.isCurrentMeetingSpokenLanguageAutoSet=!1):(this.spokenLanguageChangedAlert=this.getSpokenLanguageChangedAlert(this.bot.getSpokenLanguage()),this.callingAlertsService.handleOnDemandAlert(this.spokenLanguageChangedAlert)))),this.spokenLanguage=this.bot.getSpokenLanguage(),this.dismissMismatchedSpokenLanguageUFDAfterChangedCorrectly()}didTextTracksChange(){return!(0,l.H3)(this.getActiveClosedCaptionsTextTracks(),this.previousTextTracks)}handleTextTracksChange(){let e=this.getActiveClosedCaptionsTextTracks();this.logger.info(`captions tracks changed from ${JSON.stringify(this.previousTextTracks)} to ${JSON.stringify(e)}`),this.previousTextTracks=e}getSpokenLanguageChangedAlert(e){return{dismissable:!0,windowType:g.MA.CallScreen,type:g.NK.Info,name:"SpokenLanguageChanged",title:this.localized.localizedAlerts.spokenLanguageChangedTitle?.().text,text:this.localized.localizedAlerts.spokenLanguageChanged?.(e).text,teamsCallId:this.call.teamsCallId,narrated:!0}}didSpokenLanguageChange(){return this.bot.getSpokenLanguage()&&this.bot.getSpokenLanguage()!==this.spokenLanguage}showCallClosedCaptionsFailedAlert(){this.clearCallClosedCaptionsFailedAlert();let e=this.getClosedCaptionsFailedAlert();this.callingAlertsService.handleOnDemandAlert(e)}clearCallClosedCaptionsFailedAlert(){let e=this.getClosedCaptionsFailedAlert();this.callingAlertsService.dismiss(e)}getClosedCaptionsFailedAlert(){return{dismissable:!0,type:g.NK.Warning,name:"ClosedCaptionsStartFailed",title:this.localized.localizedAlerts.closedCaptionsFailedTitle().text,text:this.localized.localizedAlerts.closedCaptionsFailed().text,timeout:g.fn,teamsCallId:this.call.teamsCallId,actions:[{buttonText:this.localized.localizedAlerts.closedCaptionsRestartButton().text,command:()=>{this.startClosedCaption(h.PR.RetryUFD)},isSecondary:!0,buttonTrackName:b.vR.restartClosedCaptions,alertActionType:"RESTART_CLOSED_CAPTIONS"}]}}getIsCallingWindowMinimized(){return this.call.isScreenSharingOn||!!this.callingMultiWindowService?.isContainerShown(this.call.intentId||"",A.bW.CallMonitor)}confirmDetectedSpokenLanguage(e,t){this.isMultilingualMeeting?this.setUserClosedCaptionsLanguage(e,t):(this.isCurrentMeetingSpokenLanguageAutoSet=!!t,this.setClosedCaptionsLanguage(e,t)),this.saveSpokenLanguage(e,!!t)}saveAutoUpdatedSpokenLanguage(e){if(this.isMultilingualMeeting)return void this.myUserPreferencesStore?.setUserPreference("transcriptAndCaptionSettings",JSON.stringify({userSpokenLanguage:e}));this.storageService?.set(s.gT.tmpStorageKeys.captionsAndTranscriptSpokenLanguage,{autoSpokenLanguage:e,savedSpokenLanguages:this.savedSpokenLanguages})}saveSpokenLanguage(e,t){if(t)return void this.saveAutoUpdatedSpokenLanguage(e);let i=this.savedSpokenLanguages.reduce((e,t)=>(3===e.length||e.includes(t)||e.push(t),e),[e]);if(this.isMultilingualMeeting)return void this.myUserPreferencesStore?.setUserPreference("transcriptAndCaptionSettings",JSON.stringify({userSpokenLanguage:e,savedUserSpokenLanguages:i}));this.storageService?.set(s.gT.tmpStorageKeys.captionsAndTranscriptSpokenLanguage,{autoSpokenLanguage:e,savedSpokenLanguages:i})}getMismatchedSpokenLanguageAlert(e,t){let i=this.getIsCallingWindowMinimized(),n=this.config.enableSpokenLanguageDetectionUfdV2?.()?g.NK.Error:g.NK.Warning;if(this.config.enableSpokenLanguageDetectionUfdV3?.()&&e){t.detectedLanguageWithLocale=e;let a=this.isMultilingualMeeting&&this.config.enableMultilingualMVPForCaptionsAndTranscription?.()&&!d.px.includes(e)?e.split("-")[0]:e,r=this.localized.localizedAlerts.mismatchedSpokenLanguageUFDV3?.(a);this.isSpokenLanguageDetectionAutoUpdateEnabled&&(t.isAutoUpdateEnabled=!0,this.confirmDetectedSpokenLanguage(e,!0));let o=[{buttonText:(this.isSpokenLanguageDetectionAutoUpdateEnabled?r?.chooseLanguageButtonForAutoUpdate:r?.chooseLanguageButton)||"",showCallWindowIfNotVisible:i,command:()=>{},buttonTrackName:this.isMultilingualMeeting?b.vR.changeUserLevelSpokenLanguageDialogButton:b.vR.changeMeetingLevelSpokenLanguageDialogButton,alertActionType:this.isMultilingualMeeting?"OpenChangeUserLevelSpokenLanguageDialog":"OpenChangeMeetingLevelSpokenLanguageDialog",isSecondary:!0}];return this.isSpokenLanguageDetectionAutoUpdateEnabled||o.push({buttonText:r?.confirmButton||"",command:()=>{this.confirmDetectedSpokenLanguage(e)},buttonTrackName:b.vR.confirmDetectedSpokenLanguageButton,alertActionType:"CONFIRM_DETECTED_SPOKEN_LANGUAGE"}),{dismissable:!0,windowType:g.MA.CallScreen,type:n,name:"MismatchedSpokenLanguage",title:(this.isSpokenLanguageDetectionAutoUpdateEnabled?r?.titleWithAutoUpdate:r?.title)||"",text:(this.isMultilingualMeeting?this.isSpokenLanguageDetectionAutoUpdateEnabled?r?.multilingualContentWithAutoUpdate:r?.multilingualContentWithButton:this.isSpokenLanguageDetectionAutoUpdateEnabled?r?.monolingualContentWithAutoUpdate:r?.monolingualContentWithButton)||"",timeout:g.fn,teamsCallId:this.call.teamsCallId,actions:o}}return this.getMonolingualMismatchedSpokenLanguageAlert()}getMonolingualMismatchedSpokenLanguageAlert(){let e=this.getIsCallingWindowMinimized(),t=this.config.enableSpokenLanguageDetectionUfdV2?.()?g.NK.Error:g.NK.Warning;if(this.isMultilingualMeeting){let i=this.localized.localizedAlerts.mismatchedUserSpokenLanguageUFDV2?.(this.userSpokenLanguage),n=!!this.config.enableSpokenLanguageRestriction?.()&&i;return{dismissable:!0,windowType:g.MA.CallScreen,type:t,name:"MismatchedSpokenLanguage",title:n?i.title:this.localized.localizedAlerts.mismatchedSpokenLanguageTitle?.()||"",text:n?i.content:this.localized.localizedAlerts.mismatchedSpokenLanguageTextForMultilingual?.()||"",timeout:g.fn,teamsCallId:this.call.teamsCallId,actions:[{buttonText:this.localized.changeSpokenLanguageButton?.()||"",showCallWindowIfNotVisible:e,command:()=>{},buttonTrackName:b.vR.changeUserLevelSpokenLanguageDialogButton,alertActionType:"OpenChangeUserLevelSpokenLanguageDialog"}]}}let i=this.localized.localizedAlerts.mismatchedMeetingSpokenLanguageUFDV2?.(this.spokenLanguage),n=!!this.config.enableSpokenLanguageRestriction?.()&&i;return{dismissable:!0,windowType:g.MA.CallScreen,type:t,name:"MismatchedSpokenLanguage",title:n?i.title:this.localized.localizedAlerts.mismatchedSpokenLanguageTitle(),text:n?i.organizer:this.localized.localizedAlerts.mismatchedSpokenLanguageTextForOrganizer(),timeout:g.fn,teamsCallId:this.call.teamsCallId,actions:[{buttonText:this.localized.changeSpokenLanguageButton?.()||"",showCallWindowIfNotVisible:e,command:()=>{},buttonTrackName:b.vR.changeMeetingLevelSpokenLanguageDialogButton,alertActionType:"OpenChangeMeetingLevelSpokenLanguageDialog"}]}}get savedSpokenLanguages(){let e=this.getUserSavedSpokenLanguages();return this.isMultilingualMeeting?e.savedUserSpokenLanguages:e.savedSpokenLanguages}checkIsMismatchedLanguageUFDAllowed(e,t){t.enableMultilingualMVP=this.config.enableMultilingualMVPForCaptionsAndTranscription?.();let i=this.localizationService?.getLocale()||"";t.savedSpokenLanguages=this.savedSpokenLanguages,t.teamsUILanguage=i;let n=e in D?D[e]:e;return!!(this.savedSpokenLanguages.some(e=>e.includes(n))||i.includes(n))}getUserSavedSpokenLanguages(){let e=this.storageService?.get(s.gT.tmpStorageKeys.captionsAndTranscriptSpokenLanguage);return{savedSpokenLanguages:e?.savedSpokenLanguages||[],savedUserSpokenLanguages:this.userPreferences?.savedUserSpokenLanguages||[]}}subscribeToCall(){(0,u.U)(this.call,e=>{(0,f.k$)(e)&&(this.isAiInterpretationTurnedOn=!0),(0,f.x$)(e)&&(this.isLiveInterpretationTurnedOn=!0),e.state!==o.CallState.Connected||e.isBroadcast||this.isInit||(this.isTranscriptionBotAdded=this.bot.getStatus()===c.fU.added,this.isTranscriptionBotAdded&&this.call.raiseTeamsCallEvent("closedCaptionsStatusChanged"),this.pendingInviteBot&&this.addBotParticipant(),this.isInit=!0,this.bot.getStatus()===c.fU.added&&this.setAudioMode(!0),this.myUserPreferencesStore&&(this.myUserPreferencesStore.getPreferencesWithCacheOption(!1).then(e=>{this.userPreferences=e.userPreferences.transcriptAndCaptionSettings,this.logger.info("User preferences loaded")}),this.unsubscribeUserPreferencesChanges=this.myUserPreferencesStore.subscribeToUserPreferencesChanges("transcriptAndCaptionSettings",async e=>{this.userPreferences=e?.transcriptAndCaptionSettings,this.logger.info("User preferences updated")}))),e.state===o.CallState.Disconnected&&(this.logger.info("call is disconnected, cleaning up"),this.botStatusChangedSubscription.dispose(),this.botStateChangedSubscription.dispose(),this.botStatusChangedSubscription=void 0,this.botStateChangedSubscription=void 0,this.userPreferences=void 0,this.unsubscribeUserPreferencesChanges&&(this.unsubscribeUserPreferencesChanges(),this.unsubscribeUserPreferencesChanges=void 0),this.userSpokenLanguageForHandoverResend=void 0,this.userSpokenLanguageCommandMgr.clearQueue(),this.userSubtitleLanguageCommandMgr.clearQueue(),this.enableSpokenLanguageDetectionUfd()&&(this.callingBotService?.unregisterDataCallback(this.call.callId,this.call.teamsCallId,d.a_.LanguageMismatch),this.detectedLanguage=void 0,this.sourceLanguageHistoryForTranslatedText=[],this.sourceLanguageHistoryForAudioMetadata=[],this.mismatchedSpokenLanguageAlert=void 0,this.lastNotAllowedDetectedLanguage=void 0,this.shouldShowUFDWithConfidence=!1,this.isCurrentMeetingSpokenLanguageAutoSet=!1,this.isSpokenLanguageAutoUpdated=!1),this.displayLanguageMismatchAlertTimerId&&(this.utilityService.clearTimeout(this.displayLanguageMismatchAlertTimerId),this.displayLanguageMismatchAlertTimerId=void 0),this.updateStartScenario(),[y.RG.ClosedCaptionsSetLanguage,y.RG.ClosedCaptionsSetSubtitle,y.RG.ClosedCaptionsSetUserLanguage].forEach(e=>{this.loggingService.findScenario(e)?.cancel({reason:"CallDisconnected"})}))},!0)}getScenarioData(e={}){let t={timestamp:new Date().toJSON(),callState:this.call.state,botMri:this.bot.getMri(),botParticipantId:this.bot.getBotParticipantId(),botEndpointId:this.bot.getBotEndpointId(),botStatus:c.fU[this.bot.getStatus()],botLastError:this.bot.getLastError(),botCommandUrl:this.bot.getCommandUrl(),captionsPreviousStatus:h.I_[this.previousStatus],captionsStatus:h.I_[this.getClosedCaptionStatus()],spokenLanguage:this.getClosedCaptionsLanguage(),currentUserMri:this.sxConfig.getCurrentSkypeMri(),botHasCaptionsMode:this.bot.hasProcessingMode(c.qD.ClosedCaptions),botCaptionsModeState:this.bot.getProcessingModeState(c.qD.ClosedCaptions)?c.xV[this.bot.getProcessingModeState(c.qD.ClosedCaptions)]:"unavailable",tracks:JSON.stringify(this.getActiveClosedCaptionsTextTracks()),isAutoStarted:this.call.isTranscriptAutoStarted(),isMultilingualMeeting:this.isMultilingualMeeting,startClosedCaptionsFrom:this.startClosedCaptionsFrom,...e};return{[s.gT.categories.threadId]:this.call.threadId,[s.gT.categories.conversationId]:this.call.conversationId,[s.gT.scenarioDataPropNames.captionData]:JSON.stringify(t)}}updateStartScenario(e,t){if(!this.startClosedCaptionsScenario)return;let i=this.getScenarioData();if(this.startClosedCaptionsScenario.appendEventData(i),e)return void this.startClosedCaptionsScenario.mark(e);if(t){if(this.startClosedCaptionsScenario.eventData[s.gT.scenarioDataPropNames.captionError]=this.utilityService.getErrorLoggingString(t),this.call.state!==o.CallState.Connected)return void this.startClosedCaptionsScenario.cancel({reason:"CallDisconnected"});this.startClosedCaptionsScenario.fail()}else this.startClosedCaptionsScenario.stop();this.startClosedCaptionsScenario=void 0}}class O extends r.r{constructor(e,t,i,n,a,o,s,l,c,d,g,h,p,u,m,_,S){super({...(0,r.f)({methods:["addClosedCaptionsTextTracks","closedCaptionsHaveBeenStarted","getActiveClosedCaptionsTextTracks","getClosedCaptionsLanguage","getClosedCaptionStatus","getClosedCaptionSubStatus","getClosedCaptionsTextTrack","getClosedCaptionsUsingTrack","getClosedCaptionsUsingSource","hasActiveClosedCaptionsTextTrack","removeClosedCaptionsTextTracks","resolveMeetingIntelligenceDisplayName","requestClosedCaptionSubtitle","setClosedCaptionsLanguage","setUserClosedCaptionsLanguage","setClosedCaptionsTextTrack","startClosedCaption","stopClosedCaption","getClosedCaptionsBotParticipantId","getIsTranscriptionBotAdded","getHasBeenSelectedManually","handleCaptionsStatusUpdates","getUserSpokenLanguage","getIsSpokenLanguageAutoUpdated","getDetectedSpokenLanguage","setIsSpokenLanguageAutoUpdated","getDisplayedUserSpokenLanguage","getUserTranslatedLanguage","getDetectedLanguageWithLocale","getClosedCaptionsRuntimeError","setIsClosedCaptionsPoppedOut","getIsClosedCaptionsPoppedOut"],props:["isMultilingualMeeting"]}).syncedWith(),createMixin:r=>new N(r,e,t,i,n,a,o,s,l,c,d,g,h,p,u,m,_,S)})}}},451324:function(e,t,i){var n,a,r,o,s,l,c;i.d(t,{Iy:()=>o,fd:()=>n,ls:()=>d,mA:()=>h,vd:()=>g});let d={RecordingAndTranscriptPending:"RecordingAndTranscriptPending",RecordingAndTranscriptStarted:"RecordingAndTranscriptStarted",RecordingAndTranscriptStartedByOthers:"RecordingAndTranscriptStartedByOthers",RecordingAndTranscriptFailed:"RecordingAndTranscriptFailed",RecordingStartedTranscriptPending:"RecordingStartedTranscriptPending",TranscriptStartedRecordingPending:"TranscriptStartedRecordingPending",RecordingAndTranscriptStopped:"RecordingAndTranscriptStopped",RecordingAndTranscriptStoppedByOthers:"RecordingAndTranscriptStoppedByOthers",RecordingAndTranscriptStopFailed:"RecordingAndTranscriptStopFailed",RecordingFailedTranscriptStarted:"RecordingFailedTranscriptStarted",TranscriptFailedRecordingStarted:"TranscriptFailedRecordingStarted",RecordingFailedTranscriptPending:"RecordingFailedTranscriptPending",TranscriptFailedRecordingPending:"TranscriptFailedRecordingPending",RecordingAndTranscriptWaitingForMeetingLive:"RecordingAndTranscriptWaitingForMeetingLive"},g={TranscriptStarted:"TranscriptStarted",TranscriptStartedByOthers:"TranscriptStartedByOthers",TranscriptStartFailed:"TranscriptStartFailed",TranscriptStopped:"TranscriptStopped",TranscriptStopFailed:"TranscriptStopFailed",TranscriptWaitingForMeetingLive:"TranscriptWaitingForMeetingLive"},h={InitiatorStartedRecording:"InitiatorStartedRecording",ParticipantsRecordingStarted:"ParticipantsRecordingStarted",JoinersOngoingRecording:"JoinersOngoingRecording",RecordingStopped:"RecordingStopped",RecordingDisabled:"RecordingDisabled",RecordingExited:"RecordingExited",RecordingFailed:"RecordingFailed",RecordingPPT:"RecordingPPT",RecordingWhiteboard:"RecordingWhiteboard",RecordingWaitingForMeetingLive:"RecordingWaitingForMeetingLive"};(s=n||(n={}))[s.none=0]="none",s[s.recordingAndTranscribing=1]="recordingAndTranscribing",s[s.recordingOnly=2]="recordingOnly",s[s.transcriptionOnly=3]="transcriptionOnly",(l=a||(a={}))[l.None=0]="None",l[l.OnlyRecordingOrOnlyTranscribing=1]="OnlyRecordingOrOnlyTranscribing",l[l.BothRecordingAndTranscribing=2]="BothRecordingAndTranscribing",(c=r||(r={}))[c.CallRecordingAndTranscriptAlert=0]="CallRecordingAndTranscriptAlert",c[c.CallTranscriptAlert=1]="CallTranscriptAlert",c[c.CallRecordingAlert=2]="CallRecordingAlert",(o||(o={})).fetchInitiatorNameFailed="fetchInitiatorNameFailed"},675201:function(e,t,i){i.d(t,{AH:()=>r,D9:()=>p,i1:()=>o});var n,a,r,o,s=i(370574),l=i(892891),c=i(505782),d=i(575810),g=i(945761);(n=r||(r={})).normal="normal",n.contentOnly="content-only",n.pstn="pstn",(a=o||(o={})).GroupCall="groupCall",a.GoLiveGroupCall="goLiveGroupCall",a.Cast="cast",a.ScheduledMeeting="scheduledMeeting",a.AdHocMeeting="adHocMeeting",a.ScreenSharingCall="screenSharingCall",a.EmergencyGroupCall="emergencyGroupCall",a.HuddleGroupCall="huddleGroupCall",a.ScheduledTownhall="scheduledTownhall";class h{constructor(e,t,i,n,a,r,o,s=g.Wq){this.call=e,this.config=t,this.callingIntentMultiWindowService=i,this.activeCallsService=n,this.eventingService=r,this.callingMultiWindowService=o,this.promiseFactory=s,this.setupArgs={isChannelMeeting:!1},this.retryCount=0,this.wasPoppedOut=!1,this.isExperienceContainerError=!1,this.acceptedFromContentOnlyJoinNudge=!1,this.acceptedThroughPrejoin=!1,this.disableDisconnectOnObserving=!1,this.isTeamsCallTypeEnabled=!1,this.isReusable=!1,this.callDisposedDefer=s.createDeferred(),this.isTeamsCallTypeEnabled=t.isTeamsCallTypeEnabled(),this.disableDisconnectOnObserving=t.disableDisconnectOnObserving();let l=r.registerHandlerForExternalEvent(d.gT.events.calling.callDisposed,e=>{this.call===e&&(l(),this.dispose())})}setIntent(e){this.intent=e}setWindowId(e){this.windowId=e}setWasPoppedOut(e=!0){this.wasPoppedOut=e,this.eventingService.emit(d.gT.events.calling.callWasPoppedOutChanged,this.call)}markAsReusable(){this.isReusable=!0}getMessageIdAsync(){return this.messageIdPromise||(this.messageIdPromise=new Promise((e,t)=>{if(this.call.messageId)e(this.call.messageId);else{let i=this.call.changed(()=>{this.call.messageId&&(e(this.call.messageId),i.dispose(),clearTimeout(n))});this.disposeMessageIdSubscription=e=>{t(e),i.dispose(),clearTimeout(n),this.messageIdPromise=null,this.disposeMessageIdSubscription=void 0};let n=setTimeout(()=>{this.disposeMessageIdSubscription("messageId not established within timely fashion")},d.gT.timeInMiliseconds.minute)}})),this.messageIdPromise}get teamsCallType(){return this.isTeamsCallTypeEnabled?this.call.callType===s.CallType.Unknown?this.call.callType:this.call.threadId||!(0,l.isEmpty)(this.call.meetingData)||this.call.isEmergencyCall?s.CallType.Conference:s.CallType.P2P:this.call.callType}stopIfNotReusable({abortReason:e}){[s.CallState.Observing,s.CallState.Preheating,s.CallState.Preheated].includes(this.call.state)&&!this.isReusable?(this.activeCallsService.markCallAsEndedLocally(this.call),this.disableDisconnectOnObserving&&this.call.state===s.CallState.Observing&&this.call.conversationType!==o.ScheduledTownhall||(e&&(this.call.abortReason=e),this.call.stop())):this.isReusable=!1}get intentId(){return this.intent&&this.intent.id}getIntent(){return this.intent||this.callingIntentMultiWindowService.getExistingIntentForCall(this.call)}isOpenInChildWindow(){return this.config.setIntentOnNotifiedCall()?!!this.intent?.wasJoinFlowStarted:this.callingMultiWindowService.isModernCallingEnabled()&&this.callingMultiWindowService.isCallSupportedInModernCalling(this.call)&&!!this.getIntent()}isBeingPreheated(){let e=[s.CallState.Preheated,s.CallState.Preheating];return(0,l.includes)(e,this.call.state)||this.call.isPreheatEnabled}dispose(){this.disposeMessageIdSubscription&&this.disposeMessageIdSubscription("Call disposed")}}class p extends c.r{constructor(e,t,i,n,a,r,o,s=g.Wq){super({...(0,c.f)({methods:["markAsReusable","stopIfNotReusable","isBeingPreheated","setIntent","setWindowId","setWasPoppedOut","getIntent","isOpenInChildWindow","getMessageIdAsync"],props:["originalCalleeMri","isInitialized","wasJoinAttempted","callDisposedDefer","setupArgs","initiatedTime","retryCount","conversationId","intentId","windowId","wasPoppedOut","teamsCallType","isExperienceContainerError","acceptedFromContentOnlyJoinNudge","acceptedThroughPrejoin","leaveCallContext","leaveCallReasonCMD","joinType"]}).syncedWith(),createMixin:t=>new h(t,e,a,r,n,i,o,s)})}}},650784:function(e,t,i){var n,a,r,o;i.d(t,{F:()=>a,S:()=>n}),(r=n||(n={}))[r.started=0]="started",r[r.stopped=1]="stopped",r[r.stoppedWithError=2]="stoppedWithError",r[r.noSpeakers=3]="noSpeakers",r[r.noMicrophone=4]="noMicrophone",r[r.speakersMismatch=5]="speakersMismatch",(o=a||(a={}))[o.Ok=0]="Ok",o[o.NoSpeakers=1]="NoSpeakers",o[o.NoMicrophone=2]="NoMicrophone",o[o.SpeakersMismatch=3]="SpeakersMismatch"},839521:function(e,t,i){i.d(t,{y:()=>d});var n=i(370574),a=i(892891),r=i(945761),o=i(377957),s=i(505782),l=i(352320);class c{constructor(e,t,i,n=r.Wq){this.call=e,this.logger=t,this.config=i,this.promiseFactory=n,this.startCallScenarioPromise=this.promiseFactory.resolve(null),this.secondaryScenarios=[],this.startCallScenarioSet=!1}setScenarios(e,t){if(!e)return!1;let i=t.length;if((t=(0,a.compact)(t)).length!==i&&this.logger.error("Received null secondary scenario"),!this.config.disableClientIdChangeForCallingScenarios()){let i=e=>{e&&(e.clientId=o.w.getTeamsCallIdAsString(this.call.teamsCallId))};e.then(i),t.forEach(i)}return e.then(e=>{this.startCallScenario=e}),!this.startCallScenarioSet&&(this.startCallScenarioPromise=e,this.secondaryScenarios=t,this.startCallScenarioSet=!0,!0)}setMediaConnectedScenario(e){this.mediaConnectedScenario=e}getMediaConnectedScenario(){return this.mediaConnectedScenario}getStartCallScenario(){return this.startCallScenarioPromise.then(e=>e||this.promiseFactory.reject("No start call scenario")).catch(e=>(this.call.wasInState(n.CallState.Connecting)&&this.logger.error(`Failed to get start call scenario for callId: ${this.call.callId}, teamsCallId: ${this.call.teamsCallId}, error: ${l.cf.getErrorMessage(e)}`),this.promiseFactory.reject(e)))}getScenarios(){return this.getStartCallScenario().then(e=>this.getCombinedScenarioList(e)).catch(()=>this.getCombinedScenarioList())}getStartCallScenarioIfAvailable(){return this.startCallScenario}getScenarioIfAvailable(e){return this.getCombinedScenarioList(this.startCallScenario).filter(t=>t.name===e)[0]}getCombinedScenarioList(e){let t=[e,...this.secondaryScenarios];return this.mediaConnectedScenario&&t.push(this.mediaConnectedScenario),t.filter(e=>!!e)}}class d extends s.r{constructor(e,t,i=r.Wq){super({...(0,s.f)({methods:["setScenarios","setMediaConnectedScenario","getStartCallScenario","getStartCallScenarioIfAvailable","getScenarios","getScenarioIfAvailable","getMediaConnectedScenario"],props:["hasRaisedConnectedEvent"]}).syncedWith(),forceBind:!0,createMixin:n=>new c(n,e.newLogger("CallTelemetryMixin"),t,i)})}}},223305:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u,m,_;i.d(t,{DW:()=>o,EV:()=>s,IC:()=>l,J4:()=>r,fU:()=>c,qD:()=>a,xV:()=>n}),(d=n||(n={})).Active="Active",d.Inactive="Inactive",d.WaitingForMeetingLive="WaitingForMeetingLive",d.Paused="Paused",(g=a||(a={})).Recording="recording",g.ClosedCaptions="closedCaptions",g.Transcript="realTimeTranscript",g.Coach="meetingCoach",g.FaceStream="faceStream",g.Copilot="copilot",(h=r||(r={})).RecordingAndTranscription="RecordingAndTranscription",h.Recording="Recording",h.Transcription="Transcription",h.Copilot="Copilot",h.SkySafe="SkySafe",(p=o||(o={})).Unknown="Unknown",p.UserCommand="UserCommand",p.ServiceCommand="ServiceCommand",p.UserInitialPayload="UserInitialPayload",p.ServiceInitialPayload="ServiceInitialPayload",p.ParticipantMetadataChanged="ParticipantMetadataChanged",(u=s||(s={})).CallSessionEnded="CallSessionEnded",u.UserCommand="UserCommand",u.TranscriptObjectCreationFailed="TranscriptObjectCreationFailed",u.StoringArtifactsFailed="StoringArtifactsFailed",u.UploadingAccessControlListFailed="UploadingAccessControlListFailed",u.NotUsed="NotUsed",u.ModeEnabledOnAnotherBot="ModeEnabledOnAnotherBot",u.UnsupportedClient="UnsupportedClient",u.CommonSpeechRecognitionEnded="CommonSpeechRecognitionEnded",(m=l||(l={}))[m.TeamsBot=0]="TeamsBot",m[m.AcsBot=1]="AcsBot",m[m.ConsumerRecorderBot=2]="ConsumerRecorderBot",(_=c||(c={}))[_.none=0]="none",_[_.added=1]="added",_[_.removed=2]="removed",_[_.failed=3]="failed"},229283:function(e,t,i){i.d(t,{DZ:()=>y,H3:()=>T,Qk:()=>A,cl:()=>f,f6:()=>s,t4:()=>I,zw:()=>l});var n,a,r,o,s,l,c=i(370574),d=i(892891),g=i(826757),h=i(167135),p=i(352320),u=i(526260),m=i(855273),_=i(575810),S=i(642900),C=i(223305),v=i(395250);(n=o||(o={})).Teams="Teams",n.TeamsForLife="TeamsForLife";let f={Ai:"Ai",Cart:"Cart",Cea708:"Cea708",Mt:"Mt",Rtt:"RTT"};(a=s||(s={})).Ai="Ai",a.Cart="Cart",a.Cea708="Cea708",a.Mt="Mt",a.Rtt="RTT";let b=e=>{switch(e){case s.Ai:return f.Ai;case s.Cart:return f.Cart;case s.Cea708:return f.Cea708;case s.Mt:return f.Mt;default:return f.Ai}},y=e=>{switch(e){case f.Ai:return s.Ai;case f.Cart:return s.Cart;case f.Cea708:return s.Cea708;case f.Mt:return s.Mt;default:return s.Ai}},T=(e,t)=>e&&t?e?.length===t?.length&&0===(0,d.differenceWith)(e,t,d.isEqual).length:e===t;(r=l||(l={})).Unknown="",r.NoError="NoError",r.PptDownloadFailed="PptDownloadFailed",r.PptCorrupted="PptCorrupted",r.TranscriptMailboxQuotaExceeded="TranscriptMailboxQuotaExceeded",r.TranscriptInvalidUser="TranscriptInvalidUser",r.TranscriptArtifactIsDeleted="TranscriptArtifactIsDeleted",r.TranscriptTooManyRequests="TranscriptTooManyRequests",r.TranscriptOtherError="TranscriptOtherError",r.TranscriptRecognitionSessionError="TranscriptRecognitionSessionError";let I=[l.TranscriptRecognitionSessionError];class A extends u.s{constructor(e,t,i,n,a,r,o,s,l,c=C.IC.TeamsBot){super(),this.call=e,this.config=t,this.mode=i,this.defaultBotMRI=n,this.chatServiceUtils=a,this.callTitleService=r,this.channelService=o,this.processingMode=l,this.botType=c,this.status=C.fU.none,this.botMRI=n,this.runtimeErrors=[],this.logger=s.newLogger("CallingBot"),this.disableDefaultBotDataLanguage=t.disableDefaultBotDataLanguage(),this.defaultLanguage=t.defaultLanguage(),this.recorderFeatures={meetingOrganiser:t.meetingOrganiser(),enablePPTSharing:t.enablePPTSharing(),intermediateLiveCaptions:t.intermediateLiveCaptions(),actionItemsEnabled:t.actionItemsEnabled(),enableEmailAndMeetingLanguageModel:t.enableEmailAndMeetingLanguageModel(),ceoSummit:t.ceoSummit(),useUnmixedAudio:t.useUnmixedAudio(),enableTranscriptMeetingChaptering:t.enableTranscriptMeetingChaptering()},this.subscribeToCall()}getStatus(){return this.status}getMri(){return this.botMRI}getBotEndpointId(){return this.botEndpointId}getBotParticipantId(){return this.botParticipantId}getBotActiveModeParticipantId(){for(let e of this.getEndpointDetails())if(e.endpointMetadata?.processingModes?.[this.processingMode]?.state===C.xV.Active)return e.participantId;return this.botParticipantId}getBotParticipant(){return this.bot}getRecordingCommandInitiatorUserId(){return this.recordingCommandInitiatorUserId||""}hasProcessingMode(e){return this.botProcessingModes&&void 0!==this.botProcessingModes[e]}getCopilotProcessingModeUserId(){return!this.hasProcessingMode(C.qD.Copilot)||this.hasProcessingMode(C.qD.Transcript)&&this.botProcessingModes[C.qD.Transcript]?.state===C.xV.Active?"":this.botProcessingModes[C.qD.Copilot]?.state===C.xV.Active&&this&&this.botProcessingModes[C.qD.Copilot]?.userId||""}getProcessingModeState(e){for(let t of this.getEndpointDetails())if(t?.endpointMetadata?.processingModes?.[e]?.state===C.xV.Active)return C.xV.Active;return this.bot?.endpoints?.endpointDetails[0]?.endpointMetadata?.processingModes?.[e]?.state}getProcessingModeRequirements(e){return this.botProcessingModes&&this.botProcessingModes[e]&&this.botProcessingModes[e].requirements}getLastError(){return this.lastError}getCommandUrl(){return this.commandUrl}getTranscriptScopeId(){return this.transcriptScopeId}getTranscriptStorageId(){return this.transcriptStorageId}getTranscriptCommandInitiatorUserId(){return this.transcriptCommandInitiatorUserId}getTranscriptLastStopReason(){return this.transcriptLastStopReason}getRuntimeErrors(){return this.runtimeErrors}getDataChannelSourceId(){return this.dataSourceId===g.eU.SOURCE_ID_ANY?null:this.dataSourceId}getTranscriptEditId(){return this.transcriptEditId}getInRoomAttributionIssues(){return this.inRoomAttributionIssues}getSpokenLanguage(){return this.spokenLanguage}getTextTracks(){return this.textTracks}async createRecordingActionParameter(e,t,i){let n;e?.forEach(e=>{e?.mark(v.ck.GettingRecordingParameters,{[_.gT.counters.eventNames.recordingCorrelationId]:i})});let a={recordingFeatures:this.recorderFeatures,recordingStorageSettings:[],iCalUid:t,correlationId:i};try{a.meetingTitle=(await this.callTitleService.getDefaultCallTitle(_.gT.scenarios.calling.context.recording,this.call,1)).titleText}catch(t){n=`Unable to get conversation. Error: ${p.cf.getErrorMessage(t)}`,a.meetingTitle=a.meetingTitle??this.callTitleService.defaultMeetingTitle,e?.forEach(e=>{e?.mark(v.ck.TitleFetchFailure,{titleError:n})})}return S.P.isChannelMeeting(this.call.messageId||"")&&await this.fulfillBotPayloadForChannel(a,this.config,e),this.call.meetingDetails&&(a.exchangeId=this.call.meetingDetails.exchangeId),this.call.meetingInfo?.organizerId?(a.meetingOrganizer=this.getMeetingOrganizerFromMeetingInfo(this.call.meetingInfo.organizerId),this.logger.info(`[CallingBot] meetingOrganizer from meetingInfo: ${a.meetingOrganizer}`)):this.call.meetingDetails?.invitation&&(a.meetingOrganizer=this.getMeetingOrganizer(this.call.meetingDetails.invitation),this.logger.info(`[CallingBot] meetingOrganizer from invitation: ${a.meetingOrganizer}`)),e?.forEach(e=>{e?.mark(v.ck.TitleResolved)}),a}getBotDefaultMRI(){return this.defaultBotMRI}async createBotPayload(e,t,i="",n,a,r,s){let l=this.config.getRing(),c=this.call.threadId||n,d=this.getConsumerType()===o.TeamsForLife,g={meetingTitle:d?void 0:i,clientInfo:`Teams-${l?l.shortName||l.friendlyName||l.friendlyShortName:"local"}`,callId:this.call.callId,threadId:c,recorderFeatures:this.recorderFeatures,mode:this.mode,iCalUid:a||this.call.meetingDetails&&this.call.meetingDetails.iCalUid||null,consumerType:this.getConsumerType(),spokenLanguage:this.call.getClosedCaptionsLanguage(),correlationId:r};t&&(g.initiatorUserToken=t),d&&(g.initiatorSkypeToken=s),S.P.isChannelMeeting(this.call.messageId||"")&&await this.fulfillBotPayloadForChannel(g,this.config,void 0===e?[]:[e]),this.call.meetingDetails&&(g.exchangeId=this.call.meetingDetails.exchangeId),this.call.meetingInfo?.organizerId?(g.meetingOrganizer=this.getMeetingOrganizerFromMeetingInfo(this.call.meetingInfo.organizerId),this.logger.info(`[CallingBot] meetingOrganizer from meetingInfo: ${g.meetingOrganizer}`)):this.call.meetingDetails?.invitation&&!d&&(g.meetingOrganizer=this.getMeetingOrganizer(this.call.meetingDetails.invitation),this.logger.info(`[CallingBot] meetingOrganizer from invitation: ${g.meetingOrganizer}`));let h=this.call.meetingDetails&&this.call.meetingDetails.meetingCapability&&this.call.meetingDetails.meetingCapability.allowTranscription;return!this.disableDefaultBotDataLanguage&&h&&(g.language=this.defaultLanguage),e?.mark(v.ck.TitleAndTokenResolved),Promise.resolve({participantInvitationData:{botData:g},...this.config.enablePassingThreadIdToAddParticipant?.()?{threadId:c}:{}})}getProcessingModesPropertiesAutoTranscript(){return this.hasProcessingMode(C.qD.Transcript)&&this.botProcessingModes[C.qD.Transcript]?.properties?.lastStartReason===C.DW.ServiceInitialPayload}isCombinedRecorderBot(){return this.hasProcessingMode(C.qD.Transcript)&&this.hasProcessingMode(C.qD.Recording)}isBotReady(){return!!this.botProcessingModes}getEndpointDetails(){return this.bot?.endpoints?.endpointDetails??[]}getAllEndpointCommandUrls(){return(0,d.flatMap)(this.getEndpointDetails(),e=>e.endpointMetadata?.commandUrl??[])}collectTelemetryData(){return{callType:this.call.callType,isOneToOnePstnCall:g.eU.isOneToOnePstnCall(this.call),callState:this.call.state,botState:this.bot?.state,botMri:this.getMri(),botParticipantId:this.getBotParticipantId(),botEndpointId:this.getBotEndpointId(),botStatus:C.fU[this.getStatus()],botCommandUrl:this.getCommandUrl(),botProcessingModes:Object.keys(this.botProcessingModes||{}),botLastError:this.lastError,spokenLanguage:this.call.getClosedCaptionsLanguage()}}getConsumerType(){return this.config.isTflUser()?o.TeamsForLife:o.Teams}setStatus(e){this.status=e,this.event("botStatusChanged").raise(),this.logger.info(`CallingBot status is ${e}`)}onBotRemoved(){let e;this.isFailed()?(this.lastError=this.bot.stateReason,e=C.fU.failed):(this.lastError=void 0,e=C.fU.removed),this.bot=void 0,this.botProcessingModes=void 0,this.commandUrl=void 0,this.botParticipantId=void 0,this.botEndpointId=void 0,this.botSubscription&&(this.botSubscription.dispose(),this.botSubscription=void 0),this.setStatus(e)}getProcessingModesPropertiesAutoRecording(){return!!(this.hasProcessingMode(C.qD.Recording)&&this.botProcessingModes[C.qD.Recording]?.properties?.autoRecording)}isFailed(){return this.bot&&this.bot.stateReason&&!h.cq.includes(this.bot.stateReason)}botStateChanged(e){if(e.state===c.ParticipantState.Connected||e.state===c.ParticipantState.Connecting||e.state===c.ParticipantState.Staging)try{let t=e.endpoints?.endpointDetails[0];if(t?.endpointMetadata?.joinTime&&(t=e.endpoints?.endpointDetails?.reduce((e,t)=>new Date(t.endpointMetadata?.joinTime)>new Date(e.endpointMetadata?.joinTime)?t:e,t)??t),!t.endpointMetadata)throw Error("Endpoint metadata missing");let i=t.endpointMetadata.eventName||"None";if(this.botEndpointId=t.endpointId,this.botParticipantId!==t.participantId&&(e.endpoints?.endpointDetails.length??0)>1&&this.logger.info(`Handover detected, switch to endpoint(${t.participantId}), joined at ${new Date(t.endpointMetadata.joinTime).toJSON()} to process: ${this.processingMode}, number of endpoints: ${e.endpoints?.endpointDetails.length}`),this.botParticipantId=t.participantId,this.commandUrl=t.endpointMetadata.commandUrl,this.spokenLanguage=t.endpointMetadata.spokenLanguage?.toLowerCase(),this.runtimeErrors=t.endpointMetadata.runtimeErrors,this.botProcessingModes=t.endpointMetadata.processingModes,this.botProcessingModes&&(this.recordingCommandInitiatorUserId=t.endpointMetadata.processingModes[C.qD.Recording]?.userId,this.hasProcessingMode(C.qD.Transcript)&&this.botProcessingModes[C.qD.Transcript].properties&&(this.transcriptScopeId=this.botProcessingModes[C.qD.Transcript].properties.scopeId,this.transcriptStorageId=this.botProcessingModes[C.qD.Transcript].properties.storageId,this.transcriptCommandInitiatorUserId=this.botProcessingModes[C.qD.Transcript].userId,this.transcriptLastStopReason=this.botProcessingModes[C.qD.Transcript]?.properties?.lastStopReason,this.transcriptEditId=this.botProcessingModes[C.qD.Transcript].properties.editId,this.dataSourceId=g.eU.getSourceIdForMediaTypeFromEndpoint(t,c.MediaType.Data),this.botProcessingModes[C.qD.Transcript].properties.inRoomAttributionIssues?(this.inRoomAttributionIssues=this.botProcessingModes[C.qD.Transcript].properties.attributionIssuesDetails,this.logger.info(`Current meeting has in room attribution issues: ${this.inRoomAttributionIssues}`)):this.inRoomAttributionIssues=null),this.hasProcessingMode(C.qD.Transcript)||this.hasProcessingMode(C.qD.ClosedCaptions))){let e=this.getTextTracksFromEndpointMetadata(t.endpointMetadata),i=!T(e,this.textTracks);this.textTracks=i?e:this.textTracks}this.event("botStateChanged").raise(i)}catch(e){this.logger.error(`Error parsing Calling Bot metadata, ${p.cf.getErrorMessage(e)}`)}}getTextTracksFromEndpointMetadata(e){let t=[];return(e?.textTracks?.forEach?.(e=>{e?.translations?.length>0?t.push(...this.getTextTracksFromEndpointMetadataTrackWithTranslations(e)):t.push(this.getTextTrackFromEndpointMetadataTrack(e))}),t.length>0)?t:[this.getDefaultTrack()]}getTextTrackFromEndpointMetadataTrack(e){return{language:e?.lang?.toLowerCase(),source:b(e?.source)}}getTextTracksFromEndpointMetadataTrackWithTranslations(e){let t=b(e?.source);return e.translations?.map(e=>({language:e,source:t}))}getDefaultTrack(){return{language:this.getSpokenLanguage(),source:f.Ai}}onBotAdded(e){this.bot=e,this.setStatus(C.fU.added),this.botSubscription=e.changed(()=>this.botStateChanged(e)),this.botStateChanged(e)}onBotChanged(e){this.bot&&this.onBotRemoved(),e&&this.onBotAdded(e)}getEndpointMetadataByProcessingMode(e,t){for(let i of e?.endpoints?.endpointDetails??[])if(i?.endpointMetadata?.processingModes?.[t])return i?.endpointMetadata?.processingModes?.[t];return null}findBotFromCall(){let e=[];for(let t of this.call.participants){let i=this.getEndpointMetadataByProcessingMode(t,this.processingMode);(!i||(this.isAcsBot(t)?C.IC.AcsBot:this.isConsumerRecorderBot(t)?C.IC.ConsumerRecorderBot:C.IC.TeamsBot)===this.botType)&&(i?.state===C.xV.Active?e.unshift(t):i&&e.push(t))}return e[0]}isAcsBot(e){return(this.config.getAcsBotMris?.()||["28:6b45c5b6-1c34-47c0-8980-11e98d47d23f"]).includes(e.id)}isConsumerRecorderBot(e){return(this.config.getTflRecordingBotMri?.()||"28:0ad9717e-76fd-4658-a764-beaf21698977").toLowerCase()===e.id.toLowerCase()}subscribeToCall(){(0,m.U)(this.call,e=>{if(e.state===c.CallState.Disconnected&&this.bot)return void this.onBotRemoved();let t=null!=this.processingMode?this.findBotFromCall():(0,d.find)(e.participants,e=>e.id===this.botMRI);t!==this.bot&&(null!=t&&t.id!==this.botMRI&&(this.botMRI=t.id),this.onBotChanged(t))},!0)}getMeetingOrganizerFromMeetingInfo(e){return this.chatServiceUtils.getTeamsUserMriPrefix()+e}getMeetingOrganizer(e){let t;try{let i=RegExp("context(.*?)(style|target)","g"),n=RegExp('"Oid":"(.*?)"',"g"),a=i.exec(e)[1],r=decodeURIComponent(a);t=this.chatServiceUtils.getTeamsUserMriPrefix()+n.exec(decodeURIComponent(r))[1]}catch(e){this.logger.error(`Failed to decode meeting details invitation blob. ${p.cf.getErrorMessage(e)}`),t=""}return t}async fulfillBotPayloadForChannel(e,t,i){let n,a;if(a=t.enableT2AsyncChannelService?.()?(n=await this.channelService.getChannelByObjectIdAsync?.(this.call.threadId))?await this.channelService.getTeamByObjectIdAsync?.(n.parentTeamId||n.objectId):null:(n=this.channelService.getChannelByObjectId?.(this.call.threadId))?this.channelService.getTeamByObjectId?.(n.parentTeamId):null,!n||!a){let e=`Couldn't get teamName (${!!a}) or channelName (${!!n})`;this.logger.error(e),i?.forEach(e=>{e?.mark(v.ck.ChannelTeamNotFetched,{channel:!!n,team:!!a})})}e.modernGroupId=a&&a.siteInfo&&a.siteInfo.groupId,e.teamName=a?a.displayName:this.callTitleService.defaultMeetingTitle,e.channelName=n?n.displayName:this.callTitleService.defaultMeetingTitle,e.meetingTitle=this.callTitleService.getMeetupTitleForCall(this.call)||e.meetingTitle}}},415912:function(e,t,i){i.d(t,{PM:()=>l,pi:()=>s,nP:()=>o,ix:()=>m});var n,a,r,o,s,l,c=i(223305),d=i(575810),g=i(395250);class h extends Error{constructor(e,t){super(t||"Unknown error"),this.name=this.constructor.name,Object.setPrototypeOf(this,h.prototype),Object.assign(this,e&&"object"==typeof e?e:{})}toString(){return this.message||""}}class p extends Error{constructor(e,t){super(t),this.name=this.constructor.name,this.originalError=e,Object.setPrototypeOf(this,p.prototype)}}async function u(e){try{if(e instanceof Response){let t=await e.text(),i={statusCode:e.status,errorBody:{},errorMessage:t};try{i.errorBody=JSON.parse(t)}catch(e){i.errorBody.Message=t}return new h(i,t)}if(e instanceof p)return new h(e.originalError,e.message);return new h({...e&&"object"==typeof e?e:{},statusCode:e?.statusCode,errorBody:e?.errorMessage&&JSON.parse(e?.errorMessage),errorMessage:e?.errorMessage},e?.errorMessage||e?.message||"Unknown error")}catch(t){throw e}}(n=o||(o={})).makeAllEntriesEdit="makeAllEntriesEdit",n.makeSingleEntryEdit="makeSingleEntryEdit",n.ovfdMessage="ovfdmessage",n.addLanguage="addLanguage",n.setLanguage="setLanguage",n.start="start",n.stop="stop",n.userSettingsUpdate="userSettingsUpdate",n.setUserToken="setUserToken",n.reportParticipant="editMisrecognizedParticipant",(a=s||(s={})).transcription="transcription",a.cloudpeoplefeed="cloudpeoplefeed",a.recording="recording",a.combined="combined",(r=l||(l={})).transcript="transcript",r.coach="coach",r.cloudpeoplefeed="cloudpeoplefeed",r.recording="recording";class m{constructor(e,t,i,n,a){this.httpService=e,this.authenticationService=t,this.helpers=i,this.utilityService=n,this.logger=a.newLogger("CallingBotRestClient")}async getAuthHeaders(e,t,i,n=!1,a=!1){try{return this.aadTokenRequired(e,t)?await this.getAADAuthHeaders(i):await this.getSkypeAndAADAuthHeaders(!1,a,i)}catch(t){let e=new p(t,"Failed to get auth headers");if(n)throw e;throw await u(e)}}async sendCommand(e,t,i,n,a,r,o,l,c,d,h,p){let m={timestamp:new Date().toJSON(),participantMri:i,participantLegId:n,action:t,mode:l,processingModes:c,actionParameters:void 0};l===s.combined&&delete m.mode,d&&(m={...m,actionParameters:{...d,type:t}});try{h?.forEach(e=>{e?.mark(g.ck.FetchingCommandToken)});let i=this.getOptions(a,r,o),n=p??await this.getAuthHeaders(t,c,h,!0),s={...i,headers:{...i.headers,...n}};return h?.forEach(e=>{e?.mark(g.ck.SendingBotCommand)}),await this.httpService.post(e,s,m)}catch(e){throw await u(e)}}aadTokenRequired(e,t){return(t.includes(c.qD.Recording)||t.includes(c.qD.Transcript))&&(e===o.start||e===o.stop)}getAADAuthHeaders(e){return this.helpers.getAuthToken().catch(t=>this.handleTokenError("aadToken",t,!0,e)).then(e=>{let t={};return e&&(t[d.gT.headers.tokens.authorization]=`Bearer ${e}`),t})}getSkypeAndAADAuthHeaders(e=!1,t,i){return Promise.all([this.authenticationService.getSkypeToken(e).catch(e=>this.handleTokenError("skypeToken",e,!1,i)),!t?this.helpers.getAuthToken().catch(e=>this.handleTokenError("aadToken",e,!1,i)):void 0]).then(([e,t])=>{let i={};return t||(t=e),t&&(i[d.gT.headers.tokens.authorization]=`Bearer ${t}`),e&&(i[d.gT.headers.tokens.xSkypeToken]=e),i})}getOptions(e,t,i){return{callType:i,headers:{[d.gT.headers.contentType]:d.gT.headers.jsonContent,[d.gT.categories.requestId]:t,[d.gT.headers.skypeChainId]:e}}}handleTokenError(e,t,i,n){if(this.logger.error(`GetAuthenticationHeaders failure on ${e}: ${t}`),n?.forEach(i=>{i?.mark(g.ck.GetTokenFailed,{tokenError:{tokenType:e,errorCode:t?.errorCode,isExpected:t?.isExpected,errorMessage:this.utilityService.scrubEuii(t?.message||"")}})}),t&&i)throw t;return""}}},890351:function(e,t,i){var n,a;i.d(t,{T:()=>n}),(a=n||(n={}))[a.WindowRestored=0]="WindowRestored",a[a.WindowMinimized=1]="WindowMinimized"},117952:function(e,t,i){var n,a;i.d(t,{y:()=>n}),(a=n||(n={}))[a.none=0]="none",a[a.started=1]="started",a[a.failed=2]="failed"},297385:function(e,t,i){i.d(t,{a:()=>r});var n=i(505782);class a{constructor(e,t){this.call=e,this.isPstnAvailable=!1,this.isPstnInitialized=!1,this.logger=t.newLogger("CortanaCallInfoMixinImplementation")}init(){this.whenPstnInitialized=this.call.getPstnAvailabilityAsync().then(e=>{this.isPstnAvailable=e,this.isPstnInitialized=!0}).catch(e=>{this.logger.warn(`Pstn Availability errored, err: ${e}`)})}}class r extends n.r{constructor(e){super({createMixin:t=>new a(t,e),postInit:e=>e.init(),...(0,n.f)({methods:[],props:["isPstnAvailable","isPstnInitialized","whenPstnInitialized"]}).syncedWith()})}}},836835:function(e,t,i){var n,a;i.d(t,{D:()=>n}),(a=n||(n={}))[a.Caller=0]="Caller",a[a.SecurityDesk=1]="SecurityDesk"},170106:function(e,t,i){i.d(t,{N:()=>v});var n,a,r,o,s=i(370574),l=i(892891),c=i(395250),d=i(4512),g=i(575810),h=i(826757),p=i(855273);(n=r||(r={}))[n.Consented=0]="Consented",n[n.Denied=1]="Denied",n[n.None=2]="None",(a=o||(o={})).SelfConsented="SelfConsented",a.SelfConsentedAndServerUnmute="SelfConsentedAndServerUnmute",a.SelfConsentedAndOptionalServerUnmute="SelfConsentedAndOptionalServerUnmute";let u=["RecordingAndTranscriptStartedByOthers","ParticipantsRecordingStarted","JoinersOngoingRecording"],m=["RecordingAndTranscriptStarted","InitiatorStartedRecording"],_=["TranscriptStarted","TranscriptStartedByOthers"];class S{constructor(e,t,i,n,a,o,s,l,c,d){this.call=e,this.config=t,this.sxConfig=i,this.timeout=n,this.localized=a,this.loggingService=o,this.utilityService=s,this.callingAlertsService=l,this.eventingService=c,this.callingTelemetryService=d,this.selfConsentStateOnPrejoin=r.None,this._avStoppedForRecordingConsentRequired=!1,this._getConsentSignalState=e=>({isSelfConsented:this.isSelfConsented(),isVideoServerUnmuted:this._isVideoServerUnmuted(),isStateIdInPublishedStates:this._isStateIdInPublishedStates(e)}),this._isSelfConsentedAndVideoServerUnmuted=()=>this.isSelfConsented()&&this._isVideoServerUnmuted(),this.logger=this.loggingService.newLogger("ExplicitRecordingConsentMixin"),this.config.enableExplicitRecordingConsent()&&(this._subscribeToCallEvents(),this.myMri=this.sxConfig.getCurrentSkypeMri(),this.previousExplicitRecordingConsentEnabled=this.explicitRecordingConsentEnabled(),this.previousIsSelfConsentedFromServer=this.isSelfConsented(),this.previousConsentActivelyRequired=this.consentActivelyRequired())}explicitRecordingConsentEnabled(){return this.config.enableExplicitRecordingConsent()&&!!this.call.meetingDetails?.recordingConsentDetails?.explicitRecordingConsentEnabled}getPrejoinExplicitConsentPublishedState(){return this.selfConsentStateOnPrejoin===r.None?[]:[{type:this.selfConsentStateOnPrejoin===r.Consented?s.PublishStateType.ConsentToRecording:s.PublishStateType.DenyConsentToRecording,level:s.PublishStateLevel.User,content:"{}"}]}consentRequiredAndNotGiven(){return this.explicitRecordingConsentEnabled()&&this.consentActivelyRequired()&&!this.isSelfConsented()}isSelfConsented(){let e=this.call.publishedStates?.typeStates?.find(e=>e.type===s.PublishStateType.ConsentToRecording);if((0,l.isEmpty)(e?.participantStates))return this.logger.info(`isSelfConsented: no ConsentToRecording typeState or participantStates found. Call state: ${this.call.state}`),!1;let t=e.participantStates.find(e=>e?.id===this.myMri);return(0,l.isEmpty)(t?.publishedState)?(this.logger.info(`isSelfConsented: no published state for participant: ${this.myMri} found. Call state: ${this.call.state}`),!1):(this.logger.info(`isSelfConsented: consent published state found for participant: ${this.myMri}. Call state: ${this.call.state}`),!0)}isSelfConsentedOnPrejoin(){return this.selfConsentStateOnPrejoin===r.Consented}consentActivelyRequired(){return!!this.call.meetingDetails?.recordingConsentDetails?.consentActivelyRequired}avStoppedForRecordingConsentRequired(){return this._avStoppedForRecordingConsentRequired}async consentToRecording(){if(this._shouldSendConsentToServer){let e=await this._setConsentPublishState(s.PublishStateType.ConsentToRecording);try{await this._waitForSignalAfterConsentToRecording(!1,e)}catch(e){throw this._logError("cmd_explicit_recording_consent_consent_to_recording_and_video_server_muted_timeout",this.utilityService.getErrorLoggingString(e)),e}}else this.selfConsentStateOnPrejoin=r.Consented,this._raiseExplicitRecordingConsentStateChangedEvent(),this.logger.info("consentToRecording: consented on prejoin.");return this._explicitRecordingConsentState}async denyConsentToRecording(){return this._shouldSendConsentToServer?await this._setConsentPublishState(s.PublishStateType.DenyConsentToRecording):(this.selfConsentStateOnPrejoin=r.Denied,this._raiseExplicitRecordingConsentStateChangedEvent(),this.logger.info("denyConsentToRecording: denied consent on prejoin.")),this._explicitRecordingConsentState}checkExplicitRecordingConsent(e){return!!this.consentRequiredAndNotGiven()&&(this._showRequestBlockedByConsentAlert(e),!0)}subscribeToServerMutedChangedEvent(e){(0,p.C)(this.call,"serverMutedChanged",t=>{this.logger.info(`serverMutedChanged: ${t}, call state: ${this.call.state}`),t?this._checkAndHandleServerMuteRaisedForRecordingConsentRequired().then(t=>{t||(this.logger.info("serverMutedChanged: not caused by consent, let callingAlertsService handle it"),e())}):e()})}get _explicitRecordingConsentState(){return{explicitRecordingConsentEnabled:this.explicitRecordingConsentEnabled(),isSelfConsented:this.isSelfConsented(),isSelfConsentedOnPrejoin:this.isSelfConsentedOnPrejoin(),consentActivelyRequired:this.consentActivelyRequired()}}async _checkAndHandleServerMuteRaisedForRecordingConsentRequired(){let e;return!h.eU.isCallActive(this.call)||!this.explicitRecordingConsentEnabled()||this.isSelfConsented()?(this.logger.info("ServerMuteChanged: no need to handle server mute"),!1):this.consentActivelyRequired()?(this._stopAVOutput(),!0):(this.logger.info("Wait for consentActivelyRequired to be true"),Promise.race([new Promise(t=>{e=(0,p.U)(this.call,()=>{if(this.consentActivelyRequired())return this.logger.info("ConsentActivelyRequired becomes true"),this._stopAVOutput(),t(!0),!0})}),new Promise(t=>{this.timeout.set(()=>{e&&(e.dispose(),e=void 0),t(!1)},2e3)})]))}async _setConsentPublishState(e){this.logger.info(`Setting ${e} published state for participant ${this.myMri} in call ${this.call.callId}`);let t={type:e,level:s.PublishStateLevel.User,content:"{}"},i=this.utilityService.generateUUID();try{let n=await this.call.publishState(t,i);return this.logger.info(`Set ${e} published state succeeded for participant ${this.myMri} in call ${this.call.callId}`),n}catch(a){let{code:t,subCode:i,phrase:n}=a;if(this.logger.error(`Set ${e} published state failed for participant ${this.myMri} in call ${this.call.callId} with error code: ${t}, sub error code: ${i}, phrase: ${n}.`),this._showSetConsentPublishStateErrorAlert(e,t,i),t)return Promise.reject({errorCode:t,subErrorCode:i,phrase:n});throw Error("invalid error, error code is missing")}}_isStateIdInPublishedStates(e){if(!e)return!1;let t=this.call.publishedStates?.typeStates?.find(e=>e.type===s.PublishStateType.ConsentToRecording);return!!t?.participantStates?.some(t=>t?.publishedState?.stateId===e)}_createWaitForConsentSignalScenario(e,t,i){return this.callingTelemetryService.newCallingScenario(this.call,c.RG.WaitForConsentSignalFromServer,{signalType:e,isConsentFromPrejoin:t,stateId:i},12e4)}async _waitForSignalAfterConsentToRecording(e,t){return this._shouldNotWaitForServerUnmuteSignal()?this._waitForConsentSignalFromServer(o.SelfConsented,this.isSelfConsented.bind(this),e,t):this.config.enableErcExpectOptionalServerUnmute?.()?this._waitForConsentSignalFromServer(o.SelfConsentedAndOptionalServerUnmute,this._isSelfConsentedAndVideoServerUnmuted,e,t,5e3):this._waitForConsentSignalFromServer(o.SelfConsentedAndServerUnmute,this._isSelfConsentedAndVideoServerUnmuted,e,t)}_waitForConsentSignalFromServer(e,t,i,n,a=1e4){let r=this._createWaitForConsentSignalScenario(e,i,n);return this.logger.info(`Wait for ${e} signal from server, isConsentFromPrejoin: ${i}, stateId: ${n}`),new Promise((i,s)=>{let l=null,c=(0,p.U)(this.call,()=>{if(t())return null!==l&&this.timeout.cancel(l),r.stop(this._getConsentSignalState(n)),i(!0),!0},!0);l=this.timeout.set(()=>{if(c?.dispose(),e===o.SelfConsentedAndOptionalServerUnmute&&this.isSelfConsented()){r.stop(this._getConsentSignalState(n)),i(!0);return}r.fail(this._getConsentSignalState(n)),s(`expected ${e} signal is not received until ${a} milliseconds timeout`)},a)})}_isVideoServerUnmuted(){let e=h.eU.getOwnEndpoint(this.call);return e?.mediaStreams?.find(e=>"video"===e.type)?.serverMuted===!1}_showSetConsentPublishStateErrorAlert(e,t,i){switch(e){case s.PublishStateType.ConsentToRecording:return this._showAlert("ConsentToRecordingError",this.localized.ConsentToRecordingErrorDescription(t,i),this.localized.ConsentToRecordingErrorTitle(t,i));case s.PublishStateType.DenyConsentToRecording:return this._showAlert("DenyConsentToRecordingError",this.localized.DenyConsentToRecordingErrorDescription(),this.localized.DenyConsentToRecordingErrorTitle())}}async _waitForServerMuteState(e,t=5e3){return this.logger.info(`Current serverMuted: ${this.call.isServerMuted}, waiting for it to become: ${e}.`),this.call.isServerMuted===e||new Promise((i,n)=>{(0,p.U)(this.call,()=>{if(this.call.isServerMuted===e||!h.eU.isCallConnected(this.call))return i(!0),!0}),this.timeout.set(()=>{n(`expected isServerMuted signal ${e} is not received until ${t} milliseconds timeout`)},t)})}_showRequestBlockedByConsentAlert(e){this.logger.warn(`Request blocked due to lack of consent, scenario: ${e}`),this.callingAlertsService.getAlertsOfTypes(["UnmuteWithoutConsent"]).forEach(e=>this.callingAlertsService.dismiss(e));let t={name:"UnmuteWithoutConsent",title:this.localized.RequestBlockedByConsentUfdTitle(),text:this.localized.RequestBlockedByConsentUfdDescription(e),dismissable:!0,timeout:-1,type:d.NK.Warning,teamsCallId:this.call.teamsCallId};this.callingAlertsService.handleOnDemandAlert(t)}_showAlert(e,t,i="",n=!0,a=-1,r=d.NK.Warning,o=d.MA.CallingFooter){this._dismissConsentAlerts();let s={name:e,title:i,text:t,dismissable:n,timeout:a,type:r,windowType:o,teamsCallId:this.call.teamsCallId};this.callingAlertsService.handleOnDemandAlert(s)}_dismissConsentAlerts(){this.callingAlertsService.getAlertsOfTypes(["ConsentToRecordingError","DenyConsentToRecordingError"]).forEach(e=>this.callingAlertsService.dismiss(e))}_refreshActiveAlerts(e){this.callingAlertsService.getAllActiveAlerts().map(e=>e.name).filter(t=>e.includes(t)).length>0&&this.call.updateRecordingAndTranscriptAlerts()}async _handleJoinMeetingWithConsentScenario(){let e=this.callingTelemetryService.newCallingScenario(this.call,c.RG.JoinMeetingWithRecordingConsent);if(this.call.wasInState(s.CallState.Notified))return void e.cancel({reason:"User was nudged to the meeting"});try{await this._waitForSignalAfterConsentToRecording(!0),e.stop()}catch{e.fail({reason:"User remained hard-muted despite consenting on prejoin page."})}}async _handleJoinMeetingWithDenyingConsentScenario(){let e=this.callingTelemetryService.newCallingScenario(this.call,c.RG.JoinMeetingWithDenyingRecordingConsent);try{await this._waitForServerMuteState(!0),e.stop()}catch{e.fail({reason:"User is not hard-muted while no consent to recording on prejoin page."})}}_handleConsentScenarioLogForJoinMeeting(){if(this.consentActivelyRequired()){if(this.isSelfConsentedOnPrejoin())return void this._handleJoinMeetingWithConsentScenario();if(this.isSelfConsented())return void this.logger.info("User has already consented to recording through other endpoints.");this._handleJoinMeetingWithDenyingConsentScenario()}}_subscribeToCallEvents(){this._subscribeToCallChangedEvent(),this._subscribeToCallStateChangedEvent(),this._subscribeToPublishedStatesChangedEvent()}_subscribeToCallStateChangedEvent(){(0,p.C)(this.call,"callStateChanged",()=>{if(h.eU.isCallConnected(this.call))return this.logger.info("Raise consent state event on call connected."),this._raiseExplicitRecordingConsentStateChangedEvent(),this._handleConsentScenarioLogForJoinMeeting(),!0})}_subscribeToCallChangedEvent(){(0,p.U)(this.call,()=>{let e=this.explicitRecordingConsentEnabled(),t=this.previousExplicitRecordingConsentEnabled!==e;t&&(this.previousExplicitRecordingConsentEnabled=e);let i=this.consentActivelyRequired(),n=this.previousConsentActivelyRequired!==i;n&&(this.previousConsentActivelyRequired=i,!0===i&&this._refreshActiveAlerts(_),i&&!this.isSelfConsented()?(this._avStoppedForRecordingConsentRequired=!0,this._stopAVOutput()):this._avStoppedForRecordingConsentRequired=!1),(t||n)&&this._raiseExplicitRecordingConsentStateChangedEvent()})}_stopAVOutput(){this.logger.info(`Stopping AV output for participant ${this.myMri} in call ${this.call.callId} because recording consent is actively required`),this._stopVideo(),this._stopSharing(),this._stopAudioWhenServerMuteSignalTimeout()}async _stopVideo(){if(this.logger.info("Stopping video."),!this.call.isVideoOn)return void this.logger.info("Video is off, bypassing stopping video.");try{await this.call.stopVideo(this.call.getTagForMedia(s.MediaType.Video)),this.logger.info(`Successfully stop local video for participant ${this.myMri} in call ${this.call.callId} when consent actively required`)}catch(e){this._logError("cmd_explicit_recording_consent_stop_video_failed",`Fails to stop local video for participant ${this.myMri} in call ${this.call.callId} with error ${this.utilityService.getErrorLoggingString(e)} when consent actively required`)}}async _stopSharing(){try{await this.call.stopScreenSharingOnCall(g.gT.scenarios.calling.context.consentActivelyRequired),this.logger.info(`Successfully stop screen sharing for participant ${this.myMri} in call ${this.call.callId} when consent actively required`)}catch(e){this._logError("cmd_explicit_recording_consent_stop_screen_sharing_failed",`Fails to stop screen sharing for participant ${this.myMri} in call ${this.call.callId} with error ${this.utilityService.getErrorLoggingString(e)} when consent actively required`)}this.call.contentSharingSessions.forEach(async e=>{if(e.contentSharingStatus===s.ContentSharingStatus.Presenting)try{await e.stopContentSharing(),this.logger.info(`Successfully stop content sharing with GUID ${e.contentSharingGuid} for participant ${this.myMri} in call ${this.call.callId} when consent actively required`)}catch(t){this._logError("cmd_explicit_recording_consent_stop_content_sharing_failed",`Fails to stop content sharing with GUID ${e.contentSharingGuid} for participant ${this.myMri} in call ${this.call.callId} with error ${this.utilityService.getErrorLoggingString(t)} when consent actively required`)}})}async _stopAudioWhenServerMuteSignalTimeout(){try{await this._waitForServerMuteState(!0),this.logger.info("Expected serverMuted: true received in time")}catch(e){if(this._logError("cmd_explicit_recording_consent_check_server_mute_state_failed",this.utilityService.getErrorLoggingString(e)),!this.call.isMuted){this.logger.info("Waiting for server mute signal timeout, stopping audio.");try{await this.call.mute(),this.logger.info(`Successfully stop local audio for participant ${this.myMri} in call ${this.call.callId}.`)}catch(e){this._logError("cmd_explicit_recording_consent_stop_audio_failed",`Fails to stop local audio for participant ${this.myMri} in call ${this.call.callId} with error ${this.utilityService.getErrorLoggingString(e)}`)}}}}_subscribeToPublishedStatesChangedEvent(){(0,p.C)(this.call,"publishedStatesChanged",()=>{let e=this.isSelfConsented();if(this.previousIsSelfConsentedFromServer===e)return void this.logger.info(`publishedStatesChanged: isSelfConsented ${e} has not changed. Call state: ${this.call.state}`);!0===this.previousIsSelfConsentedFromServer&&this.logger.error("Invalid ConsentToRecording published state changes, from true to false"),this.logger.info(`publishedStatesChanged: isSelfConsented changed from ${this.previousIsSelfConsentedFromServer} to ${e}`),this.previousIsSelfConsentedFromServer=e;let t=[...u,..._,...this.call.isRecordingAutoStarted()?m:[]];this._refreshActiveAlerts(t),this._raiseExplicitRecordingConsentStateChangedEvent()})}_raiseExplicitRecordingConsentStateChangedEvent(){this.eventingService.emit(g.gT.events.calling.explicitRecordingConsentStateChanged,{teamsCallId:this.call.teamsCallId,explicitRecordingConsentState:this._explicitRecordingConsentState})}_logError(e,t,...i){this.logger.error(t,...i)}get _shouldSendConsentToServer(){return[s.CallState.Connected,s.CallState.Connecting,s.CallState.InLobby].includes(this.call.state)}_shouldNotWaitForServerUnmuteSignal(){return this.call.state===s.CallState.InLobby}}var C=i(505782);class v extends C.r{constructor(e,t,i,n,a,r,o,s,l){super({createMixin:c=>new S(c,t,e,i,n,a,r,o.callingAlertsService(),s,l),...(0,C.f)({methods:["getPrejoinExplicitConsentPublishedState","explicitRecordingConsentEnabled","isSelfConsented","isSelfConsentedOnPrejoin","avStoppedForRecordingConsentRequired","consentActivelyRequired","consentToRecording","denyConsentToRecording","checkExplicitRecordingConsent","subscribeToServerMutedChangedEvent","consentRequiredAndNotGiven"],props:[]}).syncedWith()})}}},777016:function(e,t,i){var n,a,r,o;i.d(t,{T:()=>n,u:()=>a}),(r=n||(n={}))[r.Reconnecting=1e3]="Reconnecting",r[r.Transferring=1001]="Transferring",r[r.TransferFailed=1002]="TransferFailed",r[r.TransferSucceeded=1003]="TransferSucceeded",r[r.Escalating=1004]="Escalating",r[r.EscalationFailed=1005]="EscalationFailed",r[r.EscalationSucceeded=1006]="EscalationSucceeded",r[r.Parking=1007]="Parking",r[r.ParkSucceeded=1008]="ParkSucceeded",r[r.ParkFailed=1009]="ParkFailed",r[r.MusicOnHold=1010]="MusicOnHold",r[r.Aborted=1011]="Aborted",(o=a||(a={}))[o.Good=0]="Good",o[o.Poor=1]="Poor",o[o.Bad=2]="Bad"},538198:function(e,t,i){i.d(t,{b:()=>l});var n=i(370574),a=i(945761),r=i(855273),o=i(505782);class s{constructor(e,t,i=a.Wq){this.call=e,this.promiseFactory=i,this.isMeetingDetailsResolved=!1,this.isMeetingChatPropertiesResolved=!1,this.subscribeToCall(),this.meetingDetailsDeferred=i.createDeferred(),this.meetingChatPropertiesDeferred=i.createDeferred(),this.logger=t.newLogger("MeetingDetailsImplementation")}getMeetingDetails(){return this.meetingDetailsPromise?this.meetingDetailsPromise:(this.callChangedSubscription=this.call.changed(()=>this.tryToFetchMeetingDetails()),this.tryToFetchMeetingDetails(),this.meetingDetailsPromise=this.promiseFactory.toCancellable(this.meetingDetailsDeferred.promise))}getMeetingDetailsWithChatProperties(){return this.meetingChatPropertiesPromise?this.meetingChatPropertiesPromise:(this.callChangedSubscriptionForMeetingDetailsWithChatProperties=this.call.changed(()=>this.tryToFetchMeetingDetailsWithChatProperties()),this.tryToFetchMeetingDetailsWithChatProperties(),this.meetingChatPropertiesPromise=this.promiseFactory.toCancellable(this.meetingChatPropertiesDeferred.promise))}tryToFetchMeetingDetails(){!this.isMeetingDetailsResolved&&this.call.meetingDetails&&this.call.meetingDetails.invitation&&(this.logger.info(`Fetched meetingDetails for call: ${this.call.callId}`),this.meetingDetailsDeferred.resolve(this.call.meetingDetails),this.isMeetingDetailsResolved=!0,this.disposeSubscription(this.callChangedSubscription),this.cancelPendingPromise(this.meetingChatPropertiesPromise,this.isMeetingDetailsResolved))}tryToFetchMeetingDetailsWithChatProperties(){!this.isMeetingChatPropertiesResolved&&(this.call.meetingDetails?.meetingChatProperties||this.call.meetingDetails?.meetingChatProperties==="")&&(this.logger.info(`Fetched meeting details with chat properties for call: ${this.call.callId}`),this.meetingChatPropertiesDeferred.resolve(this.call.meetingDetails),this.isMeetingChatPropertiesResolved=!0,this.disposeSubscription(this.callChangedSubscriptionForMeetingDetailsWithChatProperties),this.cancelPendingPromise(this.meetingChatPropertiesPromise,this.isMeetingChatPropertiesResolved))}disposeSubscription(e){e&&(e.dispose(),e=void 0)}cancelPendingPromise(e,t){e&&!t&&this.promiseFactory.cancel(e)}subscribeToCall(){(0,r.U)(this.call,e=>{e.state===n.CallState.Disconnected&&(this.disposeSubscription(this.callChangedSubscriptionForMeetingDetailsWithChatProperties),this.cancelPendingPromise(this.meetingChatPropertiesPromise,this.isMeetingChatPropertiesResolved),this.disposeSubscription(this.callChangedSubscriptionForMeetingDetailsWithChatProperties),this.cancelPendingPromise(this.meetingChatPropertiesPromise,this.isMeetingChatPropertiesResolved))},!0,void 0,"callStateChanged")}}class l extends o.r{constructor(e){super({...(0,o.f)({methods:["getMeetingDetails","getMeetingDetailsWithChatProperties"],props:[]}).syncedWith(),createMixin:t=>new s(t,e)})}}},548512:function(e,t,i){i.d(t,{E:()=>r});var n=i(945761),a=i(395250);class r{constructor(e,t,i,a,r,o=n.Wq){this.call=e,this.conversation=t,this.calendarService=i,this.callingTelemetryService=r,this.promiseFactory=o,this.isPromiseResolved=!1,this.logger=a.newLogger("MeetingInfoProvider")}dispose(){if(this.tryToFetchMeetingInfo(),this.disposeCallSubscription(),this.meetingInfoPromise&&!this.isPromiseResolved&&this.promiseFactory.cancel(this.meetingInfoPromise),this.meetingInfoScenario){let e=`conversationId loaded: ${!!this.call.conversationId}, meetingDetails loaded: ${this.call.meetingDetails}, invitation loaded: ${!!this.call.meetingDetails&&!!this.call.meetingDetails.invitation}`;this.meetingInfoScenario.incomplete({reason:e}),this.meetingInfoScenario=null}}getMeetingInfo(){return this.meetingInfoPromise?this.meetingInfoPromise:(this.meetingInfoScenario=this.callingTelemetryService.newCallingScenario(this.call.teamsCallId,a.RG.GetMeetingInfo),this.meetingInfoDeferred=this.promiseFactory.createDeferred(),this.callChangedCallbackDisposable=this.call.changed(()=>this.tryToFetchMeetingInfo()),this.tryToFetchMeetingInfo(),this.meetingInfoPromise=this.promiseFactory.toCancellable(this.meetingInfoDeferred.promise))}prepareCopyJoinInfo(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){this.logger.error("Failed to decode invitation blob")}return""}disposeCallSubscription(){this.callChangedCallbackDisposable&&this.callChangedCallbackDisposable.dispose()}tryToFetchMeetingInfo(){if(this.meetingInfoDeferred&&this.call.meetingDetails&&this.call.meetingDetails.invitation){this.disposeCallSubscription();let e=this.getMeetingInfoFromConversation();this.meetingInfoDeferred.resolve(e),this.isPromiseResolved=!0,this.meetingInfoScenario&&this.meetingInfoScenario.stop({meetingType:this.conversation.meetingContext}),this.meetingInfoScenario=null}}getMeetingInfoFromConversation(){let e={meetingBody:this.prepareCopyJoinInfo(this.call.meetingDetails.invitation),pstnDetails:this.call.meetingDetails.pstnDetails},t=this.conversation.meetingInfo;return t&&(e={...e,startTime:t.startTime.toString(),endTime:t.endTime.toString(),location:t.location,recurrence:this.getRecurrence(t)}),e}getRecurrence(e){return this.calendarService.getMeetingFormattedTime(new Date(e.startTime.toString()),e.eventRecurrencePattern,e.eventRecurrenceRange)}}},614352:function(e,t,i){var n,a,r,o;i.d(t,{B:()=>a,k:()=>n}),(r=n||(n={})).StartOrStopRecording="startOrStopRecording",r.Share="share",r.ChangeMeetingRole="changeMeetingRole",r.AdmitOrDenyParticipantInLobby="admitOrDenyParticipantInLobby",r.RemoveParticipant="removeParticipant",r.MuteParticipant="muteParticipant",r.MuteAll="muteAll",r.TakeControl="takeControl",r.LowerAllHands="lowerAllHands",r.UpdateAttendeeRestrictions="updateAttendeeRestrictions",r.RequestToSpeak="requestToSpeak",(o=a||(a={}))[o.UpdateMeetingSettings=5661]="UpdateMeetingSettings",o[o.UpdateParticipant=5651]="UpdateParticipant"},973883:function(e,t,i){i.d(t,{B:()=>T});var n,a,r,o,s=i(370574),l=i(892891),c=i(4512),d=i(314401),g=i(826757),h=i(575810),p=i(526260);(n=r||(r={}))[n.announcement=0]="announcement",n[n.tooltipNotification=1]="tooltipNotification";var u=i(373649),m=i(505782),_=i(19745),S=i(855273),C=i(377957),v=i(395250);let f="Unknown error",b=(e,t)=>{let i={phrase:f};try{Object.assign(i,{...e,...t,message:"message"in e&&e.message||f,phrase:["code","subCode","phrase"].some(t=>t in e)?e.phrase||f:e.message||f})}catch{return{message:e.toString(),phrase:e.toString()}}return i};(a=o||(o={})).RaiseHand="RaiseHand",a.DismissHand="DismissHand",a.DismissParticipantHand="DismissParticipantHand",a.DismissHandForEveryone="DismissHandForEveryone",a.UpdateRaiseHandSettings="UpdateRaiseHandSettings";class y extends p.s{constructor(e,t,i,n,a,o,c,d,g,p,u,m,_){if(super(),this.config=e,this.call=t,this.loggingService=i,this.eventingService=n,this.utilityService=a,this.callingSupportService=o,this.timeout=c,this.interval=d,this.callingServicesProvider=g,this.localized=p,this.analyticsService=u,this.participantCountsServiceProvider=m,this.mtmaSubscriptionUtility=_,this.raiseHandOptimisticResponseTimeout=void 0,this.isRaiseHandFeatureEnabled=!1,this.existingParticipantsWithHandRaised=[],this.isInitialized=!1,this.isDismissHandStateUpdateInProgress=!1,this.isHandRaisedDueToAutoHandRaise=!1,this.hasShownAutoHandRaiseOnCall=!1,this.speechInterruptionDetectionEnabled=!1,this.lowerHandOnBehalfOfFailures={},this.notifyRaiseHandsCountForTooltipThrottled=(0,l.throttle)(()=>{this.call.state===s.CallState.Connected&&this.triggerNewHandsRaisedEvent(r.tooltipNotification)},h.gT.timeInMiliseconds.second,{trailing:!0}),this.updateRaiseHandStateFailedScenario=void 0,this.debouncedSetRaiseHandStateInternal=(0,l.debounce)(e=>this.setRaiseHandStateInternal(e),500),this.unmuteAttemptSubscription={micChangeCount:0,lastMicMuted:this.call.isMuted||this.call.isServerMuted},this.setRaiseHandStateForParticipant=(e,t=!1)=>{let i=[],n=[];(0,l.forEach)(e,e=>{let{participantId:a,isHandRaised:r,raiseHandsRank:o}=e,s=a===this.selfParticipant.id?this.selfParticipant:(0,l.find)(this.call.participants,e=>e.id===a);if(s){if(i.push(a),s.isHandRaised=r,s.raiseHandsRank=o,a===this.selfParticipant.id)this.isHandRaised=r,this.selfRaiseHandsRank=o,this.logger.info(`setRaiseHandStateForParticipant: selfHandRaised: ${this.isHandRaised}, selfRaiseHandsRank: ${this.selfRaiseHandsRank}`),this.call.raiseChanged();else if(this.logger.info(`setRaiseHandStateForParticipant: updating participant ${a}, isHandRaised: ${r}, raiseHandRank: ${o}`),this.eventingService.emit(h.gT.events.calling.participantHandStateChanged,{teamsCallId:this.call.teamsCallId,participant:s}),this.raiseHandReceivedScenario){let t=this.createRaiseHandReceivedScenarioEventData(r?[e]:null,r?null:[e],"participantHandStateChanged",!0);this.raiseHandReceivedScenario.mark(v.ck.RaiseHandReceived,t)}}else t||n.push(e)}),(n.length>0||i.length>0)&&((0,l.remove)(this.unprocessedParticipants,e=>(0,l.some)(i,t=>e.participantId===t)),this.unprocessedParticipants=(0,l.concat)(this.unprocessedParticipants,n),this.logger.warn(`setRaiseHandStateForParticipant: unprocessedParticipants: ${this.getFormattedParticipantList(this.unprocessedParticipants)}, number of participants in call: ${this.call.participants.length}`))},this.removeDisplayName=e=>(0,l.map)(e,e=>({participantId:e.participantId,displayName:"",isHandRaised:e.isHandRaised,raiseHandsRank:e.raiseHandsRank,participantStateId:e.participantStateId})),this.getFormattedParticipantList=e=>{let t=(0,l.join)((0,l.map)(e,e=>e.participantId),", ");return`[${t}]`},this.logger=i.newLogger("raise-hand-mixin"),this.isRaiseHandsEnabledForMainApp=o.isRaiseHandsEnabledForMainApp(),this.isRaiseHandsEnabledForMW=o.isRaiseHandsEnabledForMultiWindow(),this.isRaiseHandFeatureEnabled=this.isRaiseHandsEnabledForMW||this.isRaiseHandsEnabledForMainApp,this.enableRaiseHandReceivedScenario=o.isRaiseHandReceivedScenarioEnabled(),this.isRaiseHandSuggestionEnabled=e.enableRaiseHandSuggestion&&e.enableRaiseHandSuggestion(),this.isRaiseHandCoachmarkSuggestionEnabled=e.enableAutoHandRaiseCoachmark&&e.enableAutoHandRaiseCoachmark(),this.enableGroupRaiseHandsStateNotifications=o.enableGroupRaiseHandsStateNotifications,this.isRaiseHandOptimisticResponseEnabled=!!(e.enableRaiseHandsOptimisticResponse&&e.enableRaiseHandsOptimisticResponse()),this.unprocessedParticipants=[],this.participantsWithRaiseHandChange=[],this.logger.info(`raiseHand is enabled: ${this.isRaiseHandsEnabled}, featureEnabled: ${this.isRaiseHandFeatureEnabled}, isRaiseHandAllowedInMeeting: ${this.isRaiseHandAllowedInMeeting}, enabledForMainApp: ${this.isRaiseHandsEnabledForMainApp}, isBroadcast: ${t.isBroadcast}, hasBroadcastMeeting: ${!!t.broadcastMeeting}, for the callId: ${t.callId}`),!this.isRaiseHandFeatureEnabled)return;this.setRoleCapabilities(),this.subscribeToCallEvents(),this.subscribeToParticipantCountEvents(),this.subscribeToCallQualityChangedEvents()}raiseHand(e,t){if(this.timeout.cancel(this.unmuteAttemptSubscription.timeoutId),this.unmuteAttemptSubscription={lastMicMuted:this.call.isMuted||this.call.isServerMuted,micChangeCount:0},this.isRaiseHandStateUpdateInProgress){let e=`raiseHand (stateId: ${this.stateId}): there is already an ongoing raise hands action`;return this.logToTelemetryForHandStateUpdate("warn",t,e),Promise.resolve()}if(this.isDismissHandStateUpdateInProgress){let e=`raiseHand (stateId: ${this.stateId}): there is already an ongoing dismiss hand action`;return this.logToTelemetryForHandStateUpdate("warn",t,e),Promise.resolve()}if(!this.isRaiseHandFeatureEnabled){let e=`raiseHand (stateId: ${this.stateId}): the feature is not enabled (isRaiseHandFeatureEnabled)`;return this.logToTelemetryForHandStateUpdate("warn",t,e),Promise.resolve()}if(!this.isRaiseHandAllowedInMeeting)return this.logToTelemetryForHandStateUpdate("info",t,"raiseHand: the ability to raise hands has been disallowed in the meeting (isRaiseHandAllowedInMeeting)"),Promise.resolve();if(this.isHandRaised){let e=`raiseHand (stateId: ${this.stateId}):user has already raised hand in the meeting`;return this.logToTelemetryForHandStateUpdate("info",t,e),Promise.resolve()}if(this.call.state!==s.CallState.Connected){let e=`raiseHand (stateId: ${this.stateId}): cannot raise hand as call is not connected`;return this.logToTelemetryForHandStateUpdate("info",t,e),Promise.resolve()}let i=this.utilityService.generateUUID();return this.raiseHandEventScenario||(this.isStreamingAttendeeRaiseHand()?(this.createStreamingAttendeePromotionScenario(i),this.raiseHandEventScenario=this.createScenario(h.gT.scenarios.calling.streaming.streamingAttendeeRaiseHand,{commandId:i}),this.raiseHandEventScenario.timeoutInMs(1e4),this.getStreamingAttendeeScenarioEventData().then(e=>{this.raiseHandEventScenario?.appendEventData(e)})):this.raiseHandEventScenario=this.createScenario(h.gT.scenarios.calling.raiseHand,{commandId:i})),this.logger.info(`raiseHand (stateId: ${this.stateId}): attempting to raise hand with skinTone: ${e}`),new Promise((n,a)=>{let r={type:s.PublishStateType.RaiseHands,level:s.PublishStateLevel.User,content:JSON.stringify({skinTone:e})};this.isRaiseHandOptimisticResponseEnabled&&(this.emitOptimisticSelfRaiseHandEvent({isHandRaised:!0,raiseHandSkinTone:e}),this.raiseHandOptimisticResponseTimeout=this.timeout.set(()=>this.emitOptimisticSelfRaiseHandEvent({isHandRaised:!1},!1,"raiseHand timeout"),1e4)),this.isRaiseHandStateUpdateInProgress=!0,this.call.publishState(r,i).then(e=>{let i=`raiseHand (stateId: ${this.stateId}): raise hand request successfully sent`;this.logToTelemetryForHandStateUpdate("info",t,i),this.stateId=e,this.isHandRaised=!0,this.raiseHandEventScenario?.mark("request_sent"),this.showStreamingAttendeeRaiseHandNotification(),n()}).catch(e=>{let n=JSON.stringify(b(e,{commandId:i,stateId:this.stateId,callId:this.call.callId,participantId:this.selfParticipant?.id,isHandRaised:this.isHandRaised}));this.logger.errorToTelemetry?.(`raiseHand thrown an error: ${n}`,"raise_hand_mixin",void 0,!0),this.logToTelemetryForHandStateUpdate("error",t,n),this.isRaiseHandOptimisticResponseEnabled&&this.emitOptimisticSelfRaiseHandEvent({isHandRaised:!1},!1,"raiseHand request threw an error"),this.isRaiseHandStateUpdateInProgress=!1,this.concludeScenarioOnError(e,n,this.raiseHandEventScenario),this.showNotification({name:"RaiseHandsOperationFailure",text:this.localized.raiseHandInCallFailed()}),a(`raiseHand (stateId: ${this.stateId}): failed with error: ${n}`)})})}dismissHand(e,t){if(this.isHandRaisedDueToAutoHandRaise=!1,this.isDismissHandStateUpdateInProgress){let e=`dismissHand (stateId: ${this.stateId}): there is already an ongoing dismiss hand action`;return this.logToTelemetryForHandStateUpdate("warn",t,e),Promise.resolve()}if(this.isRaiseHandStateUpdateInProgress){let e=`dismissHand (stateId: ${this.stateId}): raised hand state update is already in progress, nothing to dismiss`;return this.logToTelemetryForHandStateUpdate("warn",t,e),Promise.resolve()}return this.isRaiseHandFeatureEnabled?this.isHandRaised?this.stateId?(this.isRaiseHandOptimisticResponseEnabled&&(this.emitOptimisticSelfRaiseHandEvent({isHandRaised:!1}),this.raiseHandOptimisticResponseTimeout=this.timeout.set(()=>this.emitOptimisticSelfRaiseHandEvent({isHandRaised:!0,raiseHandSkinTone:e},!1,"dismissHand timeout"),1e4)),this.isDismissHandStateUpdateInProgress=!0,this.dismissHandInternal(this.stateId,this.selfParticipant&&this.selfParticipant.id).then(()=>{let e=`dismissHand (stateId: ${this.stateId}): dismiss hand request successfully sent`;this.logToTelemetryForHandStateUpdate("info",t,e),this.stateId=null,this.isHandRaised=!1,this.dismissRaiseHandNotification(),this.config.hooks.onSelfHandLowered(this.localized.callingUserSelfHandLowered(),!1),this.lowerHandAlertAlreadyShown=!1,this.timeout.cancel(this.lowerHandAlertPromise),this.lowerHandAlertPromise=void 0}).catch(t=>{let i=JSON.stringify(b(t,{stateId:this.stateId,isHandRaised:this.isHandRaised}));return this.logger.error(`dismissHand: dismiss hand request threw an error: ${i}`),this.isRaiseHandOptimisticResponseEnabled&&this.emitOptimisticSelfRaiseHandEvent({isHandRaised:!0,raiseHandSkinTone:e},!1,"dismissHand request threw an error"),this.isDismissHandStateUpdateInProgress=!1,this.showNotification({name:"RaiseHandsOperationFailure",text:this.localized.lowerHandInCallFailed()}),Promise.reject(t)})):Promise.reject(`dismissHand (stateId: ${this.stateId}): invalid stateId`):(this.logToTelemetryForHandStateUpdate("info",t,"dismissHand: user's hand is already dismissed in the meeting"),Promise.resolve()):(this.logToTelemetryForHandStateUpdate("warn",t,"dismissHand: the raise hands feature is not enabled (isRaiseHandFeatureEnabled)"),Promise.resolve())}dismissParticipantHand(e){if(!e)return Promise.reject("dismissParticipantHand: invalid participantId");if(e===(this.selfParticipant&&this.selfParticipant.id))return this.dismissHand();if(this.logger.info(`dismissParticipantHand: attempting to dismiss hand for the participant ${e}`),!this.isRaiseHandFeatureEnabled)return this.logger.warn("dismissParticipantHand: the raise hands feature is not enabled (isRaiseHandFeatureEnabled)"),Promise.resolve();if(this.call.state!==s.CallState.Connected)return this.logger.info("dismissParticipantHand: cannot dismiss hand as call is not connected"),Promise.resolve();if(!this.isActionPermitted(o.DismissParticipantHand))return Promise.reject(`dismissParticipantHand: user does not have permission to dismiss hand for participant: ${e}`);let{stateId:t,errorMessage:i}=this.getStateIdForParticipant(this.call.publishedStates,e);return t?this.dismissHandInternal(t,e).catch(t=>(this.setLowerHandFailureForParticipant(e),Promise.reject(t))):(this.createScenario(h.gT.scenarios.calling.dismissHand,{stateId:t,participantId:e}).cancel({reasonCMD:`no stateId found: error: ${i}`}),this.eventingService.emit(h.gT.events.calling.raiseHandStateChanged,{teamsCallId:this.call.teamsCallId,updatedRaiseHandsState:[{participantId:e,isHandRaised:!1}]}),Promise.reject(`dismissParticipantHand (stateId: ${this.stateId}): no valid stateId found for the participant: ${e}`))}dismissHandsForEveryone(){if(!this.isRaiseHandFeatureEnabled)return this.logger.warn("dismissHandsForEveryone: the raise hands feature is not enabled (isRaiseHandFeatureEnabled)"),Promise.resolve();if(this.call.state!==s.CallState.Connected)return this.logger.info("dismissHandsForEveryone: cannot dismiss hand for everyone as call is not connected"),Promise.resolve();if(!this.isActionPermitted(o.DismissHandForEveryone))return Promise.reject("dismissHandsForEveryone: user does not have permission to dismiss hands for everyone");let e=this.utilityService.generateUUID(),t=this.createScenario(h.gT.scenarios.calling.dismissHandForEveryone,{commandId:e});return this.logger.info("dismissHandsForEveryone: attempting to dismiss hands for everyone"),new Promise((i,n)=>{let a={type:s.PublishStateType.RaiseHands};this.isDismissHandStateUpdateInProgress=this.isHandRaised,this.call.removeStatesForEveryone(a,e).then(()=>{this.isDismissHandStateUpdateInProgress=!1,this.isHandRaised=!1,t.stop(),this.logger.info("dismissHandsForEveryone: request to dismiss hands for everyone successfully sent"),i()}).catch(i=>{this.isDismissHandStateUpdateInProgress=!1;let a=JSON.stringify({...i,commandId:e});this.concludeScenarioOnError(i,a,t),n(`dismissHandsForEveryone: failed with error: ${a}`)})})}updateRaiseHandSettings(e){if(!this.isRaiseHandFeatureEnabled)return this.logger.info("updateRaiseHandSettings: the raise hands feature is not enabled (isRaiseHandFeatureEnabled)"),Promise.resolve();if(!this.isActionPermitted(o.UpdateRaiseHandSettings))return Promise.reject("updateRaiseHandSettings: user does not have permission to update raise hands settings");let t={allowRaiseHands:e},i=this.utilityService.generateUUID(),n=this.createScenario(h.gT.scenarios.calling.updateRaiseHandSetting,{commandId:i,allowRaiseHands:e});return this.logger.info(`updateRaiseHandSettings: attempting to update raise hands setting isRaiseHandsAllowed to ${e}`),new Promise((a,r)=>{this.call.updateMeetingSettings(t,i).then(()=>{n.stop(),this.logger.info(`updateRaiseHandSettings: request to update raise hands setting to ${e} successfully sent`),a()}).catch(e=>{let t=JSON.stringify({...e,commandId:i});this.concludeScenarioOnError(e,t,n),r(`updateRaiseHandSettings: failed with error: ${t}`)})})}get isRaiseHandAllowedInMeeting(){let e=this.call.meetingDetails?.meetingCapability?.allowRaiseHands;return!!(this.config.isACSEmbed||!1!==e)}get isRaiseHandsEnabled(){return!!(this.config.isACSEmbed||this.isRaiseHandsEnabledForMainApp&&this.call.teamsCallType!==s.CallType.P2P&&!this.call.isBroadcast&&!this.call.broadcastMeeting&&this.call.isRaiseHandAllowedInMeeting)}get getParticipantsWithHandStateChange(){return this.participantsWithRaiseHandChange}get getParticipantsWithRaisedHands(){return this.existingParticipantsWithHandRaised}onNewHandsRaised(e){return this.on("newHandsRaised",e)}isLowerHandFailedForParticipant(e){return!!(this.lowerHandOnBehalfOfFailures&&this.lowerHandOnBehalfOfFailures[e])}logToTelemetryForHandStateUpdate(e,t,i){switch(i=`[raiseHand/dismissHand]: ${i}`,e){case"error":this.isFromPeripheralServices(t)?this.logger?.errorToTelemetry?.(i,"teams_button_raise_lower_hand",void 0,!0):this.logger?.error(i);break;case"warn":this.isFromPeripheralServices(t)?this.logger?.warnToTelemetry?.(i,"teams_button_raise_lower_hand",void 0,!0):this.logger?.warn(i);break;case"info":this.isFromPeripheralServices(t)?this.logger?.infoToTelemetry?.(i,"teams_button_raise_lower_hand",void 0,!0):this.logger?.info(i)}}isFromPeripheralServices(e){return e===h.gT.scenarios.calling.teamsDevice.initSteps.aspService||e===h.gT.scenarios.calling.teamsDevice.initSteps.peripheralsCallControlService}emitOptimisticSelfRaiseHandEvent(e,t=!0,i){let n=this.utilityService.generateUUID();this.raiseHandOptimisticResponseLatencyScenario=this.createScenario(h.gT.scenarios.calling.optimisticRaiseHand.scenario,{commandId:n}),this.call.getSelfParticipant().then(n=>{let a={...e,isHandRaised:!!e.isHandRaised,participantId:n.id,isOptimistic:t};this.eventingService.emit(h.gT.events.calling.raiseHandStateChanged,{teamsCallId:this.call.teamsCallId,updatedRaiseHandsState:[a]}),this.raiseHandOptimisticResponseLatencyScenario?.mark(v.ck.LocalStateUpdated),t||(this.cleanupRaiseHandOptimisticResponseLatencyScenario(!1),this.logger.info(`emitOptimisticSelfRaiseHandEvent: reverting previous raise hand state: isHandRaised: ${!!e.isHandRaised}, raiseHandSkinTone: ${e.raiseHandSkinTone}, reason: ${i}`))})}isStreamingAttendeeRaiseHand(){return this.callingSupportService.isRaiseHandsEnabledForStreaming?.()&&this.config.enableRaiseHandForStreaming?.()&&this.call.callMode===s.CallMode.Streaming&&this.call.meetingDetails?.meetingCapability?.forceAttendeeStreaming}isTownHallETM(){return this.config.enableRaiseHandForStreaming?.()&&this.call.meetingDetails?.meetingCapability?.forceAttendeeStreaming&&("organizer"===this.call.meetingRole||"presenter"===this.call.meetingRole)}setLowerHandFailureForParticipant(e){this.cleanupLowerHandFailure(e),this.lowerHandOnBehalfOfFailures[e]=this.timeout.set(()=>this.cleanupLowerHandFailure(e),5e3)}cleanupLowerHandFailure(e){this.lowerHandOnBehalfOfFailures&&this.lowerHandOnBehalfOfFailures[e]&&(this.timeout.cancel(this.lowerHandOnBehalfOfFailures[e]),delete this.lowerHandOnBehalfOfFailures[e])}dismissHandInternal(e,t){this.logger.info(`dismissHandInternal: attempting to dismiss hand for participantId: ${t}`);let i=this.utilityService.generateUUID(),n=this.createScenario(h.gT.scenarios.calling.dismissHand,{commandId:i,stateId:e,participantId:t});return new Promise((a,r)=>{this.call.removeState({stateIds:[e]},i).then(()=>{n.stop(),this.logger.info(`dismissHandInternal: dismiss hand request for participantId: ${t} successfully sent`),a()}).catch(a=>{let o=JSON.stringify(b(a,{commandId:i,stateId:e,participantId:t}));return this.concludeScenarioOnError(a,o,n),r(`dismissHandInternal: failed with error: ${o}`)})})}setRoleCapabilities(){let e={[o.RaiseHand]:this.isRaiseHandFeatureEnabled,[o.DismissHand]:this.isRaiseHandFeatureEnabled,[o.DismissParticipantHand]:!1,[o.DismissHandForEveryone]:!1,[o.UpdateRaiseHandSettings]:!1},t={[o.RaiseHand]:this.isRaiseHandFeatureEnabled,[o.DismissHand]:this.isRaiseHandFeatureEnabled,[o.DismissParticipantHand]:this.isRaiseHandFeatureEnabled,[o.DismissHandForEveryone]:this.isRaiseHandFeatureEnabled,[o.UpdateRaiseHandSettings]:this.isRaiseHandFeatureEnabled};this.roleCapabilities={organizer:t,presenter:t,attendee:e,"":e}}getRoleCapabilities(e,t){return this.isSupportedMeetingRole(e)?this.roleCapabilities[e][t]:this.roleCapabilities.attendee[t]}isSupportedMeetingRole(e){switch(e){case"":case"attendee":case"presenter":case"organizer":return!0;default:return!1}}onParticipantCountsChanged(e){this.speechInterruptionDetectionEnabled?e.totalParticipants<h.gT.raiseHand.minParticipantsToShowAutoHandRaise&&(this.logger.info(`onParticipantCountsChanged: Speech Interruption model is disabled as number of participants reached: ${e.totalParticipants}`),this.call.setAudioMidcallConfigJson({speechOverlapEnabled:!1}),this.speechInterruptionDetectionEnabled=!1):e.totalParticipants>=h.gT.raiseHand.minParticipantsToShowAutoHandRaise&&!this.hasShownAutoHandRaiseOnCall&&(this.logger.info(`onParticipantCountsChanged: Speech Interruption model is enabled as number of participants reached: ${e.totalParticipants}`),this.speechInterruptionDetectionEnabled=!0,this.call.setAudioMidcallConfigJson({speechOverlapEnabled:!0}))}subscribeToParticipantCountEvents(){this.mtmaSubscriptionUtility&&!this.participantCountsChangedSubscription&&(this.participantCountsChangedSubscription=this.mtmaSubscriptionUtility.subscribe(this.participantCountsServiceProvider.participantCountsService(),(e,t)=>this.onParticipantCountsChanged(t),_.j.Type_CallParticipantCountsChanged,C.w.getTeamsCallIdAsString(this.call.teamsCallId)))}subscribeToCallEvents(){this.publishedStatesChangedSubscription=this.call.on("publishedStatesChanged",e=>{g.eU.isCallActive(this.call)&&!(this.config.isRigel()&&this.call.state===s.CallState.Connecting)&&(this.logger.info(`publishedStatesChanged: event received when call state is: ${this.call.state}`),this.setRaiseHandState(e))});let e=this.call.on("participantAdded",e=>{if(g.eU.isCallActive(this.call)&&!(this.config.isRigel()&&this.call.state===s.CallState.Connecting)){let t=(0,l.find)(this.unprocessedParticipants,t=>t.participantId===e.id);if(t){if(this.logger.info(`publishedStatesChanged: found newly added participant in unprocessedParticipants list: ${e.id}`),this.raiseHandReceivedScenario){let e=this.createRaiseHandReceivedScenarioEventData(t.isHandRaised?[t]:null,t.isHandRaised?null:[t],"participantAdded",!1);this.raiseHandReceivedScenario.mark(v.ck.RaiseHandReceived,e)}this.setRaiseHandStateForParticipant([t])}}});this.isRaiseHandSuggestionEnabled&&(this.muteUnmuteSubscriptionDelay=this.timeout.set(()=>this.call.changed(()=>{this.onMicChanges()},{skipParticipantsUpdatesOnCall:!0,skipDominantSpeakerUpdatesOnCall:!0}),3e5));let t=this.call.on("callStateChanged",()=>{switch(this.call.state){case s.CallState.Disconnected:if(this.publishedStatesChangedSubscription&&(this.publishedStatesChangedSubscription.dispose(),this.publishedStatesChangedSubscription=void 0),this.callQualityChangedSubscription&&(this.callQualityChangedSubscription.dispose(),this.callQualityChangedSubscription=void 0,this.lowerHandAlertAlreadyShown=!1,this.timeout.cancel(this.lowerHandAlertPromise),this.lowerHandAlertPromise=void 0),this.participantCountsChangedSubscription&&(this.mtmaSubscriptionUtility.unsubscribe(this.participantCountsServiceProvider.participantCountsService(),this.participantCountsChangedSubscription),this.participantCountsChangedSubscription=void 0),t.dispose(),e&&(e.dispose(),e=null),this.updateRaiseHandStateFailedScenario)if((0,l.size)(this.unprocessedParticipants)>0){let e=(0,l.map)(this.unprocessedParticipants,e=>e.participantId);this.updateRaiseHandStateFailedScenario.fail({reasonCMD:`Was not able to find participant(s): ${e}`})}else this.updateRaiseHandStateFailedScenario.stop();this.stopAnnounceRaiseHandsMessage(),this.existingParticipantsWithHandRaised=null,this.roleCapabilities=null,this.isInitialized=!1,this.stateId=null,this.selfParticipant=null,(0,l.forEach)(this.lowerHandOnBehalfOfFailures,e=>this.timeout.cancel(e)),this.timeout.cancel(this.muteUnmuteSubscriptionDelay),this.muteUnmuteSubscriptionDelay=void 0,this.clearRaiseHandOptimisticResponseTimeout(),this.lowerHandOnBehalfOfFailures=null,this.cleanupRaiseHandEventScenario(!1),this.cleanupRaiseHandReceivedScenario(),this.cleanupRaiseHandOptimisticResponseLatencyScenario(!1);break;case s.CallState.Connected:this.callingSupportService.notifyUpdatedHostSettings([{hostSettingType:d.U7.RaiseHands,currentSettingValue:this.isRaiseHandsEnabledForMW}]),this.lowerHandOnBehalfOfFailures={},!this.isInitialized&&this.call.publishedStates&&(this.existingParticipantsWithHandRaised=null,this.roleCapabilities||this.setRoleCapabilities(),this.setRaiseHandState(this.call.publishedStates),this.timeout.set(()=>this.notifyRaiseHandsCountForTooltipThrottled(),5e3)),this.announceRaiseHandsMessagePromise||(this.announceRaiseHandsMessagePromise=this.interval.set(()=>this.triggerNewHandsRaisedEvent(r.announcement),this.config.raiseHandsAnnouncementInterval()||2e4,!1));break;case s.CallState.LocalHold:case s.CallState.RemoteHold:this.stopAnnounceRaiseHandsMessage(),this.cleanupRaiseHandEventScenario(),this.cleanupRaiseHandReceivedScenario(),this.cleanupRaiseHandOptimisticResponseLatencyScenario();break;default:this.isInitialized=!1,this.existingParticipantsWithHandRaised=null,this.stateId=null,this.stopAnnounceRaiseHandsMessage(),this.cleanupRaiseHandEventScenario(),this.cleanupRaiseHandReceivedScenario(),this.cleanupRaiseHandOptimisticResponseLatencyScenario()}})}showRaiseHandNotification(){if(this.isHandRaised)return;let e=this.localized.raiseHandNowText&&this.localized.raiseHandNowText(),t=this.localized.raiseHandNowTitle&&this.localized.raiseHandNowTitle(),i=this.localized.raiseHandNowPrimaryButtonText&&this.localized.raiseHandNowPrimaryButtonText();if(this.isRaiseHandSuggestionEnabled&&e&&t&&i){let n=[{alertActionType:"AutoHandRaise",buttonText:i,command:()=>{this.raiseHand()},buttonTrackName:u.vR.autoHandRaiseAlert,sendBiTelemetry:()=>this.sendBiTelemetry(u.Lc.autoHandRaiseAlert,u.vR.autoHandRaiseAlert)}];this.showNotification({name:"AutoHandRaisePrompt",text:e,title:t,windowType:c.MA.CallScreen,actions:n}),this.isHandRaisedDueToAutoHandRaise=!0}}showStreamingAttendeeRaiseHandNotification(){try{this.isStreamingAttendeeRaiseHand()||this.showNotification({name:"UserRaisedHand",text:this.localized.callingUserHandRaisedNotification()})}catch(e){this.logger.error(`showStreamingAttendeeRaiseHandNotification: error during showing notification: ${e.message}`)}}onMicChanges(){let e=this.call.isMuted||this.call.isServerMuted;this.unmuteAttemptSubscription.timeoutId||e||this.isHandRaised||(this.unmuteAttemptSubscription.timeoutId=this.timeout.set(()=>{this.unmuteAttemptSubscription={lastMicMuted:e,micChangeCount:0}},this.config.raiseHandSuggestionUnmuteInterval?.())),this.unmuteAttemptSubscription.timeoutId&&(e||e===this.unmuteAttemptSubscription.lastMicMuted||(this.unmuteAttemptSubscription.micChangeCount++,this.unmuteAttemptSubscription.micChangeCount>=this.config.raiseHandSuggestionUnmuteTimes?.()&&!this.unmuteAttemptSubscription.notificationShown&&(this.showRaiseHandNotification(),this.unmuteAttemptSubscription.notificationShown=!0)),this.unmuteAttemptSubscription.lastMicMuted=e)}createStreamingAttendeePromotionScenario(e){this.streamingAttendeePromotionScenario=this.createScenario(h.gT.scenarios.calling.streaming.streamingAttendeePromotionEvent,{commandId:e}),this.streamingAttendeePromotionScenario.appendEventData({callId:this.call.callId,callMode:this.call.callMode,threadId:this.call.threadId,participantId:this.call.participantId}),this.timeout.set(()=>{this.streamingAttendeePromotionScenario&&(this.streamingAttendeePromotionScenario.mark("timeout_after_10000ms"),this.streamingAttendeePromotionScenario.cancel(),this.streamingAttendeePromotionScenario=void 0)},1e4),(0,S.U)(this.call,e=>{e.callMode===s.CallMode.RealTime&&this.streamingAttendeePromotionScenario&&(this.streamingAttendeePromotionScenario.mark(v.ck.AutoPromotionDetected),this.streamingAttendeePromotionScenario.stop(),this.streamingAttendeePromotionScenario=void 0)},!0)}subscribeToCallQualityChangedEvents(){this.config.enableLowerHandAlert()&&!this.callQualityChangedSubscription&&(this.callQualityChangedSubscription=this.call.on("callQualityChanged",({type:e,value:t})=>{g.eU.isCallActive(this.call)&&(e!==s.QualityEventType.DeviceCaptureVoiceActive||t!==s.QualityLevel.Good||this.lowerHandAlertAlreadyShown||(this.isHandRaisedDueToAutoHandRaise?this.dismissHand():this.lowerHandAlertPromise=this.timeout.set(()=>{this.isHandRaised&&this.triggerLowerHandAlert()},this.config.lowerHandUfdDelayInMs())),e===s.QualityEventType.DeviceCaptureVoiceActive&&t===s.QualityLevel.Bad&&this.lowerHandAlertPromise&&(this.timeout.cancel(this.lowerHandAlertPromise),this.lowerHandAlertPromise=void 0),this.isRaiseHandSuggestionEnabled&&this.isRaiseHandCoachmarkSuggestionEnabled&&e===s.QualityEventType.SpeechOverlapFailedInterruptionDetected&&t===s.QualityLevel.Bad&&null!=this.localized.locale&&this.localized.locale()?.startsWith(h.gT.raiseHand.allowedLocale)&&this.call.participantCounts.totalParticipants>=h.gT.raiseHand.minParticipantsToShowAutoHandRaise&&!this.hasShownAutoHandRaiseOnCall&&(this.eventingService.emit(h.gT.events.calling.autoHandRaiseCoachmarkStateChanged,!0),this.isHandRaisedDueToAutoHandRaise=!0,this.hasShownAutoHandRaiseOnCall=!0,this.call.setAudioMidcallConfigJson({speechOverlapEnabled:!1})))}))}triggerLowerHandAlert(){this.lowerHandAlertAlreadyShown=!0;let e={name:"LowerHandPrompt",text:this.localized.lowerHandNotificationText(),windowType:c.MA.CallingFooter,qualityAlertType:s.QualityEventType.DeviceCaptureVoiceActive};this.config.enableAutoLowerHand()?this.triggerAutoLowerHandAlert(e):this.triggerManualLowerHandAlert(e)}triggerAutoLowerHandAlert(e){let t=!1,i=!0,n=[{alertActionType:"KeepHandRaised",buttonText:this.localized.keepRaisedHandButtonText(),command:()=>{t=!0,i=!1},buttonTrackName:u.vR.keepRaisedHandAutoAlert,sendBiTelemetry:()=>this.sendBiTelemetry(u.Lc.keepRaisedHandAutoAlert,u.vR.keepRaisedHandAutoAlert)}],a=()=>{t||this.dismissHand(),i&&this.sendBiTelemetry(u.Lc.autoAlertDismissed,u.vR.autoAlertDismissed,u.iF.other)};this.showNotification({title:this.localized.autoLowerHandNotification(),actions:n,onAlertDismiss:a,...e})}triggerManualLowerHandAlert(e){let t=!0,i=[{alertActionType:"KeepHandRaised",buttonText:this.localized.keepRaisedHandButtonText(),command:()=>{t=!1},buttonTrackName:u.vR.keepRaisedHandManualAlert,isSecondary:!0,sendBiTelemetry:()=>this.sendBiTelemetry(u.Lc.keepRaisedHandManualAlert,u.vR.keepRaisedHandManualAlert)},{alertActionType:"LowerHand",buttonText:this.localized.lowerHandButtonText(),command:()=>{this.dismissHand(),t=!1},buttonTrackName:u.vR.lowerHandManualAlert,sendBiTelemetry:()=>this.sendBiTelemetry(u.Lc.lowerHandManualAlert,u.vR.lowerHandManualAlert)}],n=()=>{t&&this.sendBiTelemetry(u.Lc.manualAlertDismissed,u.vR.manualAlertDismissed,u.iF.other)};this.showNotification({title:this.localized.manualLowerHandNotification(),actions:i,onAlertDismiss:n,...e})}setRaiseHandState(e){this.selfParticipant?this.enableGroupRaiseHandsStateNotifications?this.debouncedSetRaiseHandStateInternal(e):this.setRaiseHandStateInternal(e):this.call.getSelfParticipant().then(t=>{this.selfParticipant=t,this.enableGroupRaiseHandsStateNotifications?this.debouncedSetRaiseHandStateInternal(e):this.setRaiseHandStateInternal(e)})}triggerNewHandsRaisedEvent(e){let t=(0,l.filter)(this.call.participants,e=>(0,l.some)(this.existingParticipantsWithHandRaised,t=>t.participantId===e.id)&&e.state===s.ParticipantState.Connected),i=this.existingParticipantsWithHandRaised;e===r.announcement&&(0,l.isEmpty)(t)||this.event("newHandsRaised").raise({participantsWithHandRaised:t,messageType:e,raisedHandStates:i})}setRaiseHandStateInternal(e){let t=this.getParticipantsWithHandsRaised(e),i=(0,l.filter)(t,e=>!(0,l.some)(this.existingParticipantsWithHandRaised,t=>t.participantId===e.participantId)),n=(0,l.filter)(this.existingParticipantsWithHandRaised,e=>!(0,l.some)(t,t=>t.participantId===e.participantId));if(this.updateHandRaisedE2eTelemetry(i,n),n=(0,l.map)(n,e=>({participantId:e.participantId,isHandRaised:!1,raiseHandRank:void 0})),this.stateId=(0,l.some)(t,e=>e.participantId===this.selfParticipant.id)?this.getStateIdForParticipant(e,this.selfParticipant.id).stateId:null,this.existingParticipantsWithHandRaised=t,this.enableRaiseHandReceivedScenario&&(i.length>0||n.length>0)){let e=this.createRaiseHandReceivedScenarioEventData(i,n,"publishedStateChange",!1);this.raiseHandReceivedScenario?this.raiseHandReceivedScenario.mark(v.ck.RaiseHandReceived,e):(this.raiseHandReceivedScenario=this.createScenario(h.gT.scenarios.calling.raiseHandReceived,e),this.raiseHandReceivedScenario.timeoutInMs(108e5))}let a=this.isHandRaised&&!this.stateId&&!this.isDismissHandStateUpdateInProgress;this.isHandRaised=!!this.stateId,this.logger.info(`setRaiseHandStateInternal: selfHandRaised: ${this.isHandRaised}, selfRaiseHandsRank: ${this.selfRaiseHandsRank}, stateChangedToHandsRaised: ${this.getFormattedParticipantList(i)}, stateChangedToHandsDismissed: ${this.getFormattedParticipantList(n)}`),this.isHandRaised?(this.isRaiseHandStateUpdateInProgress=!1,this.cleanupRaiseHandEventScenario()):this.isDismissHandStateUpdateInProgress=!1,this.cleanupRaiseHandOptimisticResponseLatencyScenario(),this.clearRaiseHandOptimisticResponseTimeout(),this.isInitialized=!0,this.enableGroupRaiseHandsStateNotifications?(0,l.size)(i)>0||(0,l.size)(n)>0?(this.participantsWithRaiseHandChange=(0,l.concat)(i,n),(0,l.forEach)(this.participantsWithRaiseHandChange,e=>{let{participantId:t,isHandRaised:i,raiseHandsRank:n}=e,a=t===this.selfParticipant.id?this.selfParticipant:(0,l.find)(this.call.participants,e=>e.id===t);a&&(a.isHandRaised=i,a.raiseHandsRank=n,this.logger.info(`setRaiseHandStateInternal: updating participant ${t}, isHandRaised: ${i}, raiseHandRank: ${n}`),t===this.selfParticipant.id&&(this.isHandRaised=i,this.selfRaiseHandsRank=n))}),this.logger.info(`setRaiseHandStateInternal: emitting raiseHandStateChanged for participants: ${this.getFormattedParticipantList(this.participantsWithRaiseHandChange)}`),this.eventingService.emit(h.gT.events.calling.raiseHandStateChanged,{teamsCallId:this.call.teamsCallId,updatedRaiseHandsState:this.participantsWithRaiseHandChange})):this.logger.info(`setRaiseHandStateInternal: enableGroupRaiseHandsStateNotifications is set to true for id: ${this.call.teamsCallId}, but found no changes`):(this.setRaiseHandStateForParticipant(i),this.setRaiseHandStateForParticipant(n),this.unprocessedParticipants.length>0&&(this.updateRaiseHandStateFailedScenario||(this.updateRaiseHandStateFailedScenario=this.createScenario(h.gT.scenarios.calling.updateRaiseHandStateFailed,{})),this.setRaiseHandStateForParticipant(this.unprocessedParticipants.reverse(),!0))),a&&this.showNotification({name:"UserHandLoweredByPresenter",text:this.localized.callingUserHandLoweredNotification()}),this.config.isRigel()&&(this.call.meetingRole?this.updateRigelRaisedHandsUfd(i,this.call.meetingRole):this.call.getMeetingRoleAsync().then(e=>{this.updateRigelRaisedHandsUfd(i,e)}).catch(e=>{this.logger.error(`setRaiseHandStateInternal: failed to get meetingRole, error: ${e}`)})),this.notifyRaiseHandsCountForTooltipThrottled()}updateRigelRaisedHandsUfd(e,t){e.length>0&&"attendee"!=t&&(e.length>1||e[0].participantId!==this.selfParticipant.id)&&this.showNotification({name:"RigelOneOrMoreHandsRaised",text:this.localized.callingOneOrMoreHandRaisedNotification(),windowType:c.MA.CallScreen})}getParticipantsWithHandsRaised(e){let t=e&&e.typeStates&&e.typeStates.length&&(0,l.find)(e.typeStates,e=>e&&e.type===s.PublishStateType.RaiseHands);if(!t||!t.participantStates||!t.participantStates.length)return[];let i=[];return t.participantStates.forEach(e=>{if(e&&e.id&&e.publishedState&&e.publishedState.stateId){let t,n=e.id===this.selfParticipant.id?this.selfParticipant:(0,l.find)(this.call.participants,t=>t.id===e.id);n?t=n.displayName:this.logger.info(`getParticipantsWithHandsRaised: could not find participant when trying to get displayName for raise hand notification, participantId: ${e.id}`);let a=e.publishedState.content;i.push({participantId:e.id,displayName:t,isHandRaised:!0,raiseHandsRank:e.publishedState.typeRank,raiseHandSkinTone:a.skinTone,participantStateId:e.publishedState.stateId})}}),i}getStateIdForParticipant(e,t){let i,n=e&&e.typeStates&&e.typeStates.find(e=>e.type===s.PublishStateType.RaiseHands);if((0,l.isEmpty)(n)||(0,l.isEmpty)(n.participantStates))return i=`getStateIdForParticipant: no raise hands typeState or participantStates found for participant ${t}`,this.logger.error(i),{stateId:null,errorMessage:i};let a=n.participantStates.find(e=>e&&e.id===t);return(0,l.isEmpty)(a)?(i=`getStateIdForParticipant: participant ${t} not found. Current raised hands: ${this.getFormattedParticipantList(this.existingParticipantsWithHandRaised)}, typeStates: [${(0,l.join)((0,l.map)(n.participantStates,e=>e.id),", ")}]`,this.logger.error(i),{stateId:null,errorMessage:i}):(0,l.isEmpty)(a.publishedState)?(i=`getStateIdForParticipant: no published state for participant ${t}`,this.logger.error(i),{stateId:null,errorMessage:i}):{stateId:a.publishedState.stateId}}isActionPermitted(e){return this.call.meetingRole?this.getRoleCapabilities(this.call.meetingRole,e):this.isRaiseHandFeatureEnabled&&(0,l.includes)([o.RaiseHand,o.DismissHand,o.DismissParticipantHand],e)}createScenario(e,t){let i=this.loggingService.newScenario(e,null,e=>{e===h.gT.scenarioStepStatus.timeout&&i.appendEventData({reasonCMD:JSON.stringify(t)})});return i.cancelIfOffline=!0,i.appendEventData({callId:this.call.callId}),i}getStreamingAttendeeScenarioEventData(){return new Promise((e,t)=>{let i={};i.callId=this.call.callId,i.callMode=this.call.callMode,this.call.getSelfParticipant().then(t=>{i.selfParticipantId=t.id,e(i)}).catch(e=>{t(e)})})}createRaiseHandReceivedScenarioEventData(e,t,i,n){let a=JSON.stringify(this.removeDisplayName(e)),r=JSON.stringify(this.removeDisplayName(t));return{selfParticipantId:this.selfParticipant.id,handRaised:a,handLowered:r,totalParticipantsInCall:this.call.participantCounts.totalParticipants,stepTriggerEvent:i,raiseHandEventSentToMw:n}}updateHandRaisedE2eTelemetry(e,t){let i=this.isTownHallETM()?v.RG.TownhallEtmRaiseHandReceived:v.RG.RaiseHandE2eLatency;t.forEach(e=>{let t=this.loggingService.findScenarioByNameAndId(i,e.participantId);t?.cancel({reason:"hand_lowered"})}),e.forEach(e=>{let t=this.loggingService.findScenarioByNameAndId(i,e.participantId);t?.incomplete({reason:"hand_raised_again"});let n=this.loggingService.newScenario(i,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e.participantId,void 0,!0);this.isTownHallETM()?(n.appendEventData({totalParticipantsInCall:this.call.participantCounts.totalParticipants,raisedHandTargetParticipant:this.utilityService.scrubEuii(e.participantId),raisedHandTargetParticipantRank:e.raiseHandsRank,totalStreamingAttendees:this.call.participantCounts.streamingClients,totalAttendeesCount:this.call.participantCounts.totalAttendees,callParticipants:this.call.participants}),n.stop()):n.appendEventData({totalParticipantsInCall:this.call.participantCounts.totalParticipants,isAlreadyVisible:!0,stageBucket:"unknown",isPinned:!1,isSpotlighted:!1,hasStreamAvailable:!1,isStreaming:!1,raisedHandTargetParticipantMri:this.utilityService.scrubEuii(e.participantId),viewType:"unknown"})})}cleanupRaiseHandEventScenario(e=!0){this.raiseHandEventScenario&&(e?this.raiseHandEventScenario.stop():this.raiseHandEventScenario.cancel(),this.raiseHandEventScenario=null)}cleanupRaiseHandReceivedScenario(){this.raiseHandReceivedScenario&&(this.raiseHandReceivedScenario.stop(),this.raiseHandReceivedScenario=null)}cleanupRaiseHandOptimisticResponseLatencyScenario(e=!0){this.raiseHandOptimisticResponseLatencyScenario&&(e?this.raiseHandOptimisticResponseLatencyScenario.stop():this.raiseHandOptimisticResponseLatencyScenario.cancel(),this.raiseHandOptimisticResponseLatencyScenario=void 0)}clearRaiseHandOptimisticResponseTimeout(){this.raiseHandOptimisticResponseTimeout&&(this.timeout.cancel(this.raiseHandOptimisticResponseTimeout),this.raiseHandOptimisticResponseTimeout=void 0)}showNotification(e){this.dismissRaiseHandNotification();let t={type:c.NK.Info,windowType:c.MA.CallingFooter,dismissable:!0,teamsCallId:this.call.teamsCallId};this.callingServicesProvider.callingAlertsService().handleOnDemandAlert({...t,...e})}dismissRaiseHandNotification(){let e=this.callingServicesProvider.callingAlertsService().getAlertsOfTypes(["UserRaisedHand","UserHandLoweredByPresenter","RaiseHandsOperationFailure","Meeting_attendees_audio_restricted","Meeting_self_attendee_audio_restricted","RigelOneOrMoreHandsRaised","LowerHandPrompt","AutoHandRaisePrompt","StreamingAttendeeRaiseHand"]);(0,l.forEach)(e,e=>this.callingServicesProvider.callingAlertsService().dismiss(e))}stopAnnounceRaiseHandsMessage(){this.announceRaiseHandsMessagePromise&&(this.interval.cancel(this.announceRaiseHandsMessagePromise),delete this.announceRaiseHandsMessagePromise,this.logger.info("stopAnnounceRaiseHandsMessage: stopped the announcement promise"))}concludeScenarioOnError(e,t,i){if(!i)return void this.logger.info("scenario is undefined");e&&496===e.code&&4520===e.subCode&&"LocalHTTPStackError"===e.phrase||e&&499===e.code&&0===e.subCode&&!e.phrase?i.cancel({reasonCMD:"expected or known failure"}):i.fail({reasonCMD:t})}sendBiTelemetry(e,t,i=u.iF.button){let n={action:{gesture:u.Yk.click,scenario:e},module:{type:i,name:u.vR[t]}},a=this.analyticsService.getAnalyticsPanelActionEventData(n);a&&a.then(e=>this.analyticsService.sendPanelAction(e))}}class T extends m.r{constructor(e,t,i,n,a,r,o,s,l,c,d,g){super({...(0,m.f)({methods:["dismissHand","dismissHandsForEveryone","dismissParticipantHand","isLowerHandFailedForParticipant","onNewHandsRaised","raiseHand","updateRaiseHandSettings"],props:["isHandRaised","isRaiseHandAllowedInMeeting","isRaiseHandsEnabled","selfRaiseHandsRank","getParticipantsWithHandStateChange","getParticipantsWithRaisedHands"]}).syncedWith(),createMixin:h=>new y(e,h,t,i,n,a,r,o,s,l,c,d,g)})}}},139062:function(e,t,i){var n,a;i.d(t,{C:()=>n}),(a=n||(n={}))[a.NotControlCapable=0]="NotControlCapable",a[a.Disabled=1]="Disabled",a[a.NotInControl=2]="NotInControl",a[a.RequestSent=3]="RequestSent",a[a.InControl=4]="InControl"},155965:function(e,t,i){i.d(t,{i9:()=>d});var n=i(505782),a=i(945761),r=i(526260),o=i(4512),s=i(575810),l=i(395250);class c{constructor(e,t,i,n=a.Wq,r,o,s){this.call=e,this.loggingService=t,this.promiseFactory=n,this.localized=s,this.myMri=r.getCurrentSkypeMri(),this.logger=t.newLogger("SelfParticipantMixinImplementation"),this.getUserName=i.getUserInformation().then(e=>e.profile.name).catch(()=>(this.logger.error("AuthenticationService failed to get user display name"),"")),this.callingAlertsService=o.callingAlertsService()}get participantUpdateSeqNumber(){let e=this.call?.propertyBag?.displayNameOverride;return e?.sequenceNumber||1}get displayNameOverride(){let e=this.call?.propertyBag?.displayNameOverride;return e?.value?.displayNameOverrideValue}getSelfParticipant(){return this.selfParticipant?this.promiseFactory.resolve(this.selfParticipant):this.getUserName.then(e=>(this.selfParticipant=new g(this.myMri,e,this.call.mediaStreams,this.loggingService),this.promiseFactory.resolve(this.selfParticipant)))}rename(e,t){let i=this.createScenario(t);return this.call.updateParticipantsProperties({scope:"self",operationId:t,propertyBag:{displayNameOverride:{sequenceNumber:this.participantUpdateSeqNumber,value:{displayNameOverrideValue:e}}}},t).then(e=>{this.logger.info(`Rename requested seqNumber: ${this.participantUpdateSeqNumber}`),i.mark(l.ck.RequestSent);let n=this.myMri||this.call.callerMri;e[`${n}_${t}_displayNameOverride`][n].then(()=>{this.logger.info(`Rename succeeded seqNumber: ${this.participantUpdateSeqNumber}`),i.stop()}).catch(e=>{this.logger.error(`Rename failed seqNumber: ${this.participantUpdateSeqNumber} error phrase: ${e?.phrase}`),i.fail({reasonCMD:e?.phrase}),this.callingAlertsService.handleOnDemandAlert({dismissable:!0,type:o.NK.Error,name:"RenameFailed",text:this.localized.renameFailedAlertText(),teamsCallId:this.call.teamsCallId,timeout:o.LT})})}).catch(e=>{this.logger.error(`Rename failed seqNumber: ${this.participantUpdateSeqNumber} phrase: ${e?.phrase}`),i.fail({reasonCMD:e?.phrase}),this.callingAlertsService.handleOnDemandAlert({dismissable:!0,type:o.NK.Error,name:"RenameFailed",text:this.localized.renameFailedAlertText(),teamsCallId:this.call.teamsCallId,timeout:o.LT})})}createScenario(e){let t=this.loggingService.newScenario(l.RG.RenameParticipant,void 0,i=>{i===s.gT.scenarioStepStatus.timeout&&t.appendEventData({correlationId:e})});return t.cancelIfOffline=!0,t.appendEventData({callId:this.call.callId}),t.appendEventData({participantId:this.call.participantId}),t}}class d extends n.r{constructor(e,t,i,r=a.Wq,o,s){super({...(0,n.f)({methods:["getSelfParticipant","rename"],props:["displayNameOverride"]}).syncedWith(),forceBind:!0,createMixin:n=>new c(n,t,e,r,i,o,s)})}}class g extends r.s{constructor(e,t,i,n){super(),this.id=e,this.displayName=t,this.streams=i,this.loggingService=n}getSourceIdForMediaType(e){return this.loggingService.error("[SelfParticipant/getSourceIdForMediaType] Method not implemented."),-1}getDiagnosticData(){return""}}},215932:function(e,t,i){i.d(t,{X:()=>d});var n,a,r=i(505782);(n=a||(a={})).ModelReadinessChanged="model-readiness-changed",n.SignLanguageDetected="sign-language-detected";var o=i(656511);class s{constructor(e,t,i,n,a){this.call=e,this.onDataProcessedCallback=t,this.loggingService=i,this.timeout=n,this.timeoutOfSigningSignal=a,this.sendData=null,this.stopSignalTimeout=null,this.logger=this.loggingService.newLogger(`(slm) SignLanguageDataChannelHandler_[${e.callId}]}`),e.dataChannelAdapter?.addHandler(25,this).catch(t=>this.logger.error(`(slm) [${e.callId}] data channel addHandler is failed for channel 25 with error ${t}`))}dispose(){this.stopSignalTimeout&&this.timeout.cancel(this.stopSignalTimeout),this.call.dataChannelAdapter&&this.call.dataChannelAdapter?.removeHandler(25).catch(e=>this.logger.error(`(slm) [${this.call.callId}][25] data channel removeHandler is failed with error ${e}`))}onStarted(e,t){return this.sendData=t,Promise.resolve()}onStopped(e){return this.sendData=null,Promise.resolve()}onDataReceived(e,t,i){try{let e=this.uint8ArrayToPayload(t);this.onDataProcessedCallback(e,i)}catch(e){this.logger.error("(slm) Failed to process Sign Language data from data channel")}return Promise.resolve()}sendSignLanguageData(e){try{let t=this.payloadToUint8Array(e);this.sendData&&t&&(this.checkStopSignalTimeout(e.signDetected),this.sendSignLanguageDataInternal(t))}catch(e){this.logger.error("(slm) Failed to send sign language data to data channel")}}checkStopSignalTimeout(e){e?(this.cancelStopSignalTimeout(),this.stopSignalTimeout=this.timeout.set(()=>{let e=this.payloadToUint8Array({timestamp:Date.now(),duration:0,signDetected:!1});this.logger.log("(slm) sending stop signal manually because of timeout"),this.sendSignLanguageDataInternal(e)},this.timeoutOfSigningSignal)):this.cancelStopSignalTimeout()}sendSignLanguageDataInternal(e){this.sendData&&e&&(this.sendData(e),this.onDataReceived(25,e,(0,o.Yb)(this.call)))}cancelStopSignalTimeout(){this.stopSignalTimeout&&this.timeout.cancel(this.stopSignalTimeout)}uint8ArrayToPayload(e){let t;try{t=JSON.parse(new TextDecoder().decode(e))}catch(e){throw this.logger.error("(slm) Failed to decode sign language data to payload"),e}return t}payloadToUint8Array(e){let t;try{t=new TextEncoder().encode(JSON.stringify(e))}catch(e){throw this.logger.error("(slm) Failed to encode payload to sign language payload"),e}return t}}var l=i(370574);class c{constructor(e,t,i,n,a,r,s,c){this.call=e,this.chatServiceUtils=t,this.utilityService=i,this.desktopUtilityService=n,this.loggingService=a,this.config=r,this.deviceManagerService=s,this.timeout=c,this.callStateChanged=()=>{switch(this.call.state){case l.CallState.Connected:this.initDataChannelHandler();break;case l.CallState.Disconnecting:case l.CallState.Disconnected:this.handleCallDisconnect();break;case l.CallState.LocalHold:case l.CallState.RemoteHold:this.handleCallHold()}},this.getParticipant=async e=>await (0,o.RI)(this.call,e),this.enableSignerSelfIdentification=(0,o.J5)(this.config,this.desktopUtilityService,this.utilityService),this.logger=this.loggingService.newLogger(`SignLanguageDetectionMixinImplementation_[${e.callId}]_(slm)`),this.callStateSubscription=this.call.on("callStateChanged",this.callStateChanged)}sendSignLanguageDataToDataChannel(e){e.eventType===a.SignLanguageDetected&&"timestamp"in e.payload&&"duration"in e.payload&&"signDetected"in e.payload&&this.dataChannelHandler?.sendSignLanguageData({...e.payload})}signLanguageEventCallback(e){this.onDataReady||(this.onDataReady=e)}sendStopSignLanguageSignal(){this.logger.log("(slm) sending stop sign language signal"),this.sendSignLanguageDataToDataChannel({eventType:a.SignLanguageDetected,payload:{timestamp:Date.now(),duration:0,signDetected:!1}})}initDataChannelHandler(){!(!this.enableSignerSelfIdentification||(0,o.S4)(this.call,this.chatServiceUtils))&&(this.dataChannelHandler||(this.dataChannelHandler=new s(this.call,this.onDataProcessed.bind(this),this.loggingService,this.timeout,this.config.timeoutOfSigningSignal()||3e3),this.logger.info("(slm) Sign language data channel handler initialized")),this.isVideoDHHSigner(this.call)&&this.deviceManagerService.enableSignLanguageDetectionAsync({shouldStartSignLanguageDetection:!0}))}handleCallDisconnect(){if(this.isVideoDHHSigner(this.call)){let e=this.call.callId;this.sendStopSignLanguageSignal(),this.deviceManagerService.enableSignLanguageDetectionAsync({shouldStartSignLanguageDetection:!1,callId:e}),this.deviceManagerService.removeIdFromSignLanguageDetectionArray(e)}this.dataChannelHandler?.dispose(),this.callStateSubscription.dispose()}handleCallHold(){if(this.isVideoDHHSigner(this.call)){this.logger.log(`(slm) call on hold, sending stop sign language signal callid:${this.call.callId}`);let e=this.call.callId;this.sendStopSignLanguageSignal(),this.deviceManagerService.enableSignLanguageDetectionAsync({shouldStartSignLanguageDetection:!1,callId:e}),this.deviceManagerService.removeIdFromSignLanguageDetectionArray(e)}}isVideoDHHSigner(e){return e.isDHHSigner&&e.isVideoOn}async onDataProcessed(e,t){if(!e)return void this.logger.error("(slm) Empty sign language payload");let i=await this.getParticipant(t);this.logger.info(`(slm) data received: userId:${this.chatServiceUtils.scrubMri(i)} signDetected:${e.signDetected}`),this.onDataReady?.({...e,userId:i})}}class d extends r.r{constructor(e,t,i,n,a,o,s){super({...(0,r.f)({methods:["sendStopSignLanguageSignal","sendSignLanguageDataToDataChannel","signLanguageEventCallback"],props:[]}).syncedWith(),createMixin:r=>new c(r,t,i,n,e,a,o,s)})}}},35569:function(e,t,i){i.d(t,{c:()=>d});var n=i(505782),a=i(945761),r=i(370574),o=i(826757);let s="SIGNER";var l=i(656511);class c{constructor(e,t,i,n,r=a.Wq,o,s,c){if(this.call=e,this.loggingService=t,this.utilityService=i,this.desktopUtilityService=n,this.promiseFactory=r,this.deviceManagerService=s,this.myUserPreferencesStore=c,this.accessibilityModeEnabled=!1,this.signersSelectedInterpreters=new Map,this.participantIdsInSigner=new Set,this.participantIdsInterpreter=new Set,this.publishedStatesChangedSubscription=void 0,this.stateId="",this.isDHHSigner=!1,this.isSignerInterpreter=!1,this.tetheredSignerInterpreters=[],this.updateParticipantSignerState=async(e,t)=>{let i=e===this.selfParticipant?.id,n=i?this.selfParticipant:this.call.participants.find(t=>t.id===e);n&&(n.isDHHSigner=t,n.isSignerInterpreter=!t&&n.isSignerInterpreter,this.enableSignerInterpreterTethering&&(n.tetheredSignerInterpreters=this.signersSelectedInterpreters.get(n.id)),this.logger.info(`(slm) ${i?"myself: ":"participant: "} ${e} signer state changed, isSignerInterpreter: ${n.isSignerInterpreter} isDHHSigner: ${t}`),this.call.raiseTeamsCallEvent(`${i?"myselfSignerStateChanged":"participantSignerStateChanged"}`,n))},this.updateParticipantInterpreterState=async(e,t)=>{let i=e===this.selfParticipant?.id,n=i?this.selfParticipant:this.call.participants.find(t=>t.id===e);n&&(n.isSignerInterpreter=t,n.isDHHSigner=!t&&n.isDHHSigner,this.logger.info(`(slm)  ${i?"myself: ":"participant: "} ${e} interpreter state changed, isSignerInterpreter: ${t} isDHHSigner: ${n.isDHHSigner}`),this.call.raiseTeamsCallEvent(`${i?"myselfSignerStateChanged":"participantSignerStateChanged"}`,n))},this.enableSignerSelfIdentification=(0,l.J5)(o,this.desktopUtilityService,this.utilityService),this.logger=this.loggingService.newLogger("SignerMixin"),this.enableSignerInterpreterTethering=this.enableSignerSelfIdentification&&o.enableSignerInterpreterTethering(),!this.enableSignerSelfIdentification)return void this.logger.info("(slm) signerMixin won't subscribe to call events because feature flag is false");this.subscribeToCallEvents()}toggleSignLanguageMode(e,t){if(!this.enableSignerSelfIdentification)return this.logger.info("(slm) toggle sign language mode isn't publishing state because feature flag is false"),this.promiseFactory.resolve();if(this.accessibilityModeEnabled===e)return this.logger.info(`(slm) toggle sign language mode called with current value, no change needed. sign language mode:${e}.`),this.promiseFactory.resolve();let i="INTERPRETER"===t?"interpreter":"signer";if(this.logger.info(`(slm) toggle sign language state: ${e}.New selection:${i}`),e)return this.logger.info("(slm) toggle sign language calling signer participant"),this.signerParticipant(t);{let n=this.utilityService.generateUUID();return new Promise((a,r)=>{let o={stateIds:[this.stateId]};this.logger.info("(slm) turning off sign language mode"),this.call.removeState(o,n).then(()=>{t===s&&this.shouldEnableSignLanguageDetection(!1),this.stateId="",this.isDHHSigner=!1,this.isSignerInterpreter=!1,this.accessibilityModeEnabled=!1,this.shouldEnableHigherFrameRate(!1),this.logger.info("(slm) turning off sign language mode is success"),a()}).catch(t=>{let a=JSON.stringify({...t,commandId:n,stateId:this.stateId,participantId:this.selfParticipant&&this.selfParticipant.id});return this.logger.info(`(slm) turning off sign language mode is failed. selection:${i} error:${a}`),r(`(slm) toggleSignLanguageMode to ${e} failed with error: ${a}`)})})}}async signerParticipant(e){if(!this.enableSignerSelfIdentification)return this.logger.info("(slm) signer participant isn't publishing state because feature flag is false"),this.promiseFactory.resolve();this.selfParticipant||await this.initSelfParticipant();let t=this.utilityService.generateUUID(),i=e===s,n=`${i?await this.getInterpreterList():"{}"}`;return new Promise((e,a)=>{let o={type:i?r.PublishStateType.DHHSigner:r.PublishStateType.SignLanguageInterpreter,level:r.PublishStateLevel.User,content:n};if(this.stateId){let n={stateIds:[this.stateId]};this.logger.info(`(slm) trying to remove myself as ${i?"signer":"interpreter"} (stateId: ${this.stateId})`),this.call.removeState(n,t).then(()=>{this.logger.info(`(slm) trying to remove myself as ${i?"signer":"interpreter"} (stateId: ${this.stateId}) is success`),this.stateId="",this.isDHHSigner=!1,this.isSignerInterpreter=!1,this.publishNewState(o,this.utilityService.generateUUID(),i,e,a).then(()=>this.shouldEnableSignLanguageDetection(i))}).catch(e=>{let n=JSON.stringify({...e,commandId:t});this.logger.info(`(slm) remove myself as ${i?"signer":"interpreter"} (stateId: ${this.stateId}) failed with error: ${n}`),a(`(slm) remove signer (stateId: ${this.stateId}): failed with error: ${n}`)})}else this.publishNewState(o,t,i,e,a).then(()=>{this.shouldEnableSignLanguageDetection(i),this.shouldEnableHigherFrameRate(!0)})})}async shouldEnableSignLanguageDetection(e){this.call.isVideoOn&&await this.deviceManagerService.enableSignLanguageDetectionAsync({shouldStartSignLanguageDetection:e})}async shouldEnableHigherFrameRate(e){if(this.call.isVideoOn&&this?.call?.setVideoMidcallConfigJson)try{await this.call.setVideoMidcallConfigJson({signer:e}),this.logger.log(`(slm) setting sign language user frame rate higher:${e} callId: ${this.call.callId}`)}catch(t){this.logger.error(`(slm) setting sign language user frame rate higher:${e} failed. Error: ${t.message}, callId: ${this.call.callId}`)}}publishNewState(e,t,i,n,a){return this.logger.info(`(slm) making myself as ${i?"signer":"interpreter"}`),this.call.publishState(e,t).then(e=>{this.stateId=e,this.isDHHSigner=i,this.isSignerInterpreter=!i,this.accessibilityModeEnabled=!0,this.logger.info(`(slm) making myself as ${i?"signer":"interpreter"} (stateId: ${e}) succeeded callId: ${this.call.callId}`),n()}).catch(e=>{let n=JSON.stringify({...e,commandId:t});this.logger.info(`(slm) making myself as ${i?"signer":"interpreter"} (stateId: ${this.stateId}) failed with error: ${n} callId: ${this.call.callId}`),a(`(slm) making signer (stateId: ${this.stateId}): failed with error: ${n}`)})}async getInterpreterList(){return this.enableSignerInterpreterTethering&&this.myUserPreferencesStore?(await this.myUserPreferencesStore.updatePreferenceStoreCache?.(),this.tetheredSignerInterpreters=this.myUserPreferencesStore?.getUserPreferences()?.callAccessibilitySettings?.selectedDHHInterpreters||[],JSON.stringify({interpreterIds:this.tetheredSignerInterpreters.toString()})):"{}"}async initSelfParticipant(){this.selfParticipant||(this.selfParticipant=await this.call.getSelfParticipant())}subscribeToCallEvents(){this.enableSignerSelfIdentification&&(this.publishedStatesChangedSubscription=this.call.on("publishedStatesChanged",e=>{o.eU.isCallActive(this.call)&&this.setSignerState(e)}),this.call.on("callStateChanged",async()=>{switch(this.call.state){case r.CallState.Disconnected:this.publishedStatesChangedSubscription?.dispose(),this.publishedStatesChangedSubscription=void 0,this.participantIdsInSigner=new Set,this.participantIdsInterpreter=new Set,this.stateId="",this.selfParticipant=void 0,this.isDHHSigner=!1,this.isSignerInterpreter=!1;break;case r.CallState.Connected:!this.selfParticipant&&(await this.initSelfParticipant(),this.call.publishedStates&&this.setSignerState(this.call.publishedStates))}}))}async setSignerState(e){this.selfParticipant||await this.initSelfParticipant(),this.setSignLanguageModeSelection(e)}setSignLanguageModeSelection(e){this.setSignerStateInternal(e),this.setInterpreterStateInternal(e)}setInterpreterStateInternal(e){let t=this.getParticipants(e,r.PublishStateType.SignLanguageInterpreter),i=[],n=[];t.forEach(e=>{this.participantIdsInterpreter.has(e)||i.push(e)}),this.participantIdsInterpreter.forEach(e=>{t.includes(e)||n.push(e)}),i.forEach(e=>this.updateParticipantInterpreterState(e,!0)),n.forEach(e=>this.updateParticipantInterpreterState(e,!1)),this.participantIdsInterpreter=new Set(t)}setSignerStateInternal(e){let t=this.getParticipants(e,r.PublishStateType.DHHSigner),i=[],n=[];t.forEach(e=>{this.participantIdsInSigner.has(e)||i.push(e)}),this.participantIdsInSigner.forEach(e=>{t.includes(e)||n.push(e)}),i.forEach(e=>this.updateParticipantSignerState(e,!0)),n.forEach(e=>this.updateParticipantSignerState(e,!1)),this.participantIdsInSigner=new Set(t)}getParticipants(e,t){let i=e?.typeStates?.find(e=>e&&e.type===t);if(!i?.participantStates?.length)return[];let n=[];return i.participantStates.forEach(e=>{if(e?.id&&e?.publishedState?.stateId){if(this.enableSignerInterpreterTethering&&t===r.PublishStateType.DHHSigner&&e.publishedState.content){let t="object"==typeof e.publishedState.content?e.publishedState.content:JSON.parse(e.publishedState.content),i=t?.interpreterIds?.split(",").filter(e=>""!==e)||[];this.signersSelectedInterpreters.set(e.id,i)}n.push(e.id)}}),n}}class d extends n.r{constructor(e,t,i,r=a.Wq,o,s,l){super({...(0,n.f)({methods:["signerParticipant","toggleSignLanguageMode"],props:["isDHHSigner","isSignerInterpreter","tetheredSignerInterpreters"]}).syncedWith(),forceBind:!0,createMixin:n=>new c(n,e,t,i,r,o,s,l)})}}},30031:function(e,t,i){i.d(t,{z:()=>b});var n,a,r=i(370574),o=i(892891),s=i(575810),l=i(945761),c=i(4512),d=i(855273),g=i(826757),h=i(654807),p=i(505782),u=i(395250);(n=a||(a={})).Spotlight="Spotlight",n.StopSpotlight="StopSpotlight",n.StopSpotlightOnParticipant="StopSpotlightOnParticipant",n.StopSpotlightSelf="StopSpotlightSelf";let m="SpotlightStatusOff",_="SpotlightStatusOn",S="SpotlightError",C="AttendeeBringOnStageAlert",v="AttendeeBringOffStageAlert";class f{constructor(e,t,i,n,a,r,c,d,g,h=l.Wq,p){this.call=e,this.loggingService=t,this.eventingService=i,this.utilityService=n,this.callingSupportService=a,this.timeout=r,this.serviceProvider=c,this.localized=g,this.promiseFactory=h,this.config=p,this.userActivityChangedSubscription=null,this.existingParticipantIdsInSpotlight=[],this.existingParticipantScreenShareInSpotlight="",this.changeSpotlightActiveScenarios={},this.stopSpotlightScenario=null,this.isInitialized=!1,this.lastIsScreenSharingOnValue=!1,this.isSpotlighted=!1,this.isScreenShareLive=!1,this.spotlightRank=null,this.updateParticipantSpotlightState=async(e,t,i,n)=>{let a=this.call.meetingDetails?.meetingCapability?.forceAttendeeStreaming||"scheduledTownhall"===this.call.conversationType,r=e===this.selfParticipant.id,l=r?this.selfParticipant:(0,o.find)(this.call.participants,t=>t.id===e);if(!l&&a){this.logger.info(`spotlight publishedState recieved: no call participant matched participantId: ${e}, since it is a townhall and this can be a promoted streaming attendee, retrying in 2 seconds...`);let t=e=>new Promise(t=>this.timeout.set(t,e));await t(2*s.gT.timeInMiliseconds.second),l=(0,o.find)(this.call.participants,t=>t.id===e),this.logger.info(`spotlight publishedState recieved: retried finding participant with id:${e} in call with id: ${this.call.callId} after 2 seconds, found participant: ${l?"successful, participant is added to the call":"unsuccessful, participant not found in the call, ignoring the spotlight state"}`)}if(l){let a=this.changeSpotlightActiveScenarios[e];a&&(a.isSpotlighted===t?(a.scenario.stop(),a.deferred.resolve()):(a.scenario.incomplete(),a.deferred.reject()),this.timeout.cancel(a.timer),delete this.changeSpotlightActiveScenarios[e]),n?(r&&(this.isScreenShareLive=t),l.isScreenShareLive=t,l.isSpotlighted=this.existingParticipantIdsInSpotlight.includes(e)):(l.isSpotlighted=t,l.spotlightRank=i,l.isScreenShareLive=this.existingParticipantScreenShareInSpotlight===e,r&&(this.spotlightRank=t&&null!=i?i:null)),this.logger.info(`setSpotlighted: updating participant: ${e}, isScreenShare: ${n}. Spotlight toggled: ${t}. Spotlight rank: ${i??null}`),this.eventingService.emit(s.gT.events.calling.participantSpotlightStateChanged,{teamsCallId:this.call.teamsCallId,participant:l})}else t&&(this.logger.warn(`spotlight: participant not found in the call, ignoring spotlight state for participantId: ${e}`),this.existingParticipantIdsInSpotlight=this.existingParticipantIdsInSpotlight.filter(t=>t!==e))},this.logger=t.newLogger("SpotlightMixin"),this.callingSupportService=a,this.utilityService=n,this.eventingService=i,this.numberOfAllowedSpotlights=this.callingSupportService.numberOfAllowedSpotlights(),this.isPluginless=d.isPluginless(),this.updateSpotlightAvailability(),this.subscribeToCallEvents()}get participantIdsInSpotlight(){return this.existingParticipantIdsInSpotlight}spotlightParticipant(e,t){let i;this.selfParticipant||this.call.getSelfParticipant().then(e=>{this.selfParticipant=e,this.isInitialized=!0});let n=this.isPptSharedInManagedMode(t);if(!this.isSpotlightFeatureEnabled)return i="spotlight: the feature is not enabled",this.logger.warn(i),Promise.reject(i);if(!this.isActionPermitted(a.Spotlight))return i=`spotlight: user does not have permission to spotlight participant: ${e}`,this.logger.warn(i),Promise.reject(i);if(!t&&this.isSpotlightLimitReached())return i="spotlight: limit reached",this.logger.info(i),Promise.reject(i);if(!t&&this.existingParticipantIdsInSpotlight.find(t=>t===e))return i=`spotlight: user has already been spotlighted in the meeting with participant id: ${e}`,this.logger.info(i),Promise.reject(i);let o=this.utilityService.generateUUID(),l=this.call.participants.find(t=>t.id===e),c=!l||g.eU.isStreamingCallParticipant(l),d=c?s.gT.scenarios.calling.streamingParticipantSpotlight:s.gT.scenarios.calling.startSpotlight;this.isBringOnStageEnabled&&(d=c?s.gT.scenarios.calling.streamingParticipantBringOnStage:s.gT.scenarios.calling.managedModeStartSpotlight);let h=this.createScenario(d,{commandId:o,participantId:e,isScreenShare:t,isPptShareInManagedMode:n}),p=e===(this.selfParticipant&&this.selfParticipant.id);this.logger.info(`spotlight: participant ${e} isScreenShare ${t} on callId=${this.call.callId}`);let m=this.changeSpotlightActiveScenarios[e];if(m)return h.incomplete({[s.gT.counters.eventNames.reason]:"spotlight: already active request"}),m.deferred.promise;this.createSpotlightChangeObject(e,h,!0,o),m=this.changeSpotlightActiveScenarios[e];let _=this.config.enableContentShareQueueInManagedMode()?this.generateSpotlightContent(e,t):"{}";this.logger.info("spotlight: PublishState content: ",_);let S={participantIds:p?[]:[e],type:r.PublishStateType.Spotlight,level:r.PublishStateLevel.User,content:_};return this.call.publishState(S,o).then(()=>{h.mark(u.ck.RequestSent)}).catch(t=>{this.handleSpotlightChangeFailure(e,t,this.getSpotlightErrorNot(),o)}),m.deferred.promise}stopSpotlightOnParticipant(e,t){if(!e)return this.showNotification(S,this.getSpotlightStopErrorNot()),Promise.reject("stopSpotlight: invalid participantId");if(!this.config.enableContentShareQueueInManagedMode()&&e===this.selfParticipant?.id)return this.stopSpotlightSelf();if(!this.isSpotlightFeatureEnabled)return this.logger.warn("stopSpotlight: the feature is not enabled"),Promise.reject("stopSpotlight: the feature is not enabled");if(this.call.state!==r.CallState.Connected)return this.logger.info("stopSpotlight: cannot stop spotlight as call is not connected."),this.showNotification(S,this.getSpotlightStopErrorNot()),Promise.reject("stopSpotlight: cannot stop spotlight as call is not connected.");if(!this.isActionPermitted(a.StopSpotlightOnParticipant))return Promise.reject(`stopSpotlight: user does not have permission to stop spotlight for participant: ${e}`);let i=this.getStateForParticipant(this.call.publishedStates,e,t);return i&&i.stateId?this.stopSpotlightingParticipantInternal(e,i.stateId,t,i.content):(this.logger.warn(`stopSpotlight: no valid stateId found for the participant: ${e}, removing spotlight`),this.updateParticipantSpotlightState(e,!1,void 0,t),Promise.resolve())}stopSpotlightSelf(){return this.isSpotlighted?this.stateId?this.stopSpotlightingParticipantInternal(this.selfParticipant.id,this.stateId,!1).then(()=>{this.stateId=null,this.isSpotlighted=!1,this.spotlightRank=null}).catch(e=>Promise.reject(e)):(this.showNotification(S,this.getSpotlightStopErrorNot()),Promise.reject(`stopSpotlight: invalid stateId: ${this.stateId}`)):(this.logger.info("stopSpotlight: user's spotlight is already stopped in the meeting"),this.updateParticipantSpotlightState(this.selfParticipant.id,!1),Promise.resolve())}stopSpotlight(){if(!this.isSpotlightFeatureEnabled)return Promise.reject("stopSpotlight: the feature is not enabled");if(!this.existingParticipantIdsInSpotlight.length)return Promise.reject("stopSpotlight: cannot stop spotlight as there is no one in spotlight.");if(!this.isActionPermitted(a.StopSpotlight))return Promise.reject("stopSpotlight: user does not have permission to stop spotlight");let e=this.utilityService.generateUUID(),t=this.isBringOnStageEnabled?s.gT.scenarios.calling.managedModeStopSpotlight:s.gT.scenarios.calling.stopSpotlight,i=this.createScenario(t,{commandId:e});if(this.stopSpotlightScenario)return i.incomplete({[s.gT.counters.eventNames.reason]:"spotlight: already active request for stopping spotlight"}),this.stopSpotlightScenario.deferred.promise;let n=this.promiseFactory.createDeferred(),o=this.timeout.set(()=>{this.handleSpotlightChangeFailure(null,"Stop spotlight operation timed out",this.getSpotlightStopErrorNot(),e)},45*s.gT.timeInMiliseconds.second);this.stopSpotlightScenario={scenario:i,deferred:n,isSpotlighted:!1,timer:o};let l={type:r.PublishStateType.Spotlight};return this.call.removeStatesForEveryone(l,e).then(()=>{i.mark(u.ck.RequestSent)}).catch(t=>{let i=JSON.stringify({...t,commandId:e});this.stopSpotlightScenario.scenario.fail({reasonCMD:i}),this.showNotification(S,this.getSpotlightStopErrorNot()),n.reject(`stopSpotlight: failed with error: ${i}`)}),n.promise}get isSpotlightFeatureEnabled(){return this.updateSpotlightAvailability()}updateSpotlightAvailability(){return this.callingSupportService.isSpotlightEnabled(this.call)?(this.roleCapabilities||(this.logger.log("Spotlight has become available for this call."),this.setRoleCapabilities(!0)),!0):(this.roleCapabilities&&(this.logger.log("Spotlight has become not available for this call."),this.clearRoleCapabilities()),!1)}setRoleCapabilities(e){let t={[a.Spotlight]:!1,[a.StopSpotlight]:!1,[a.StopSpotlightOnParticipant]:!1,[a.StopSpotlightSelf]:e},i={[a.Spotlight]:e,[a.StopSpotlight]:e,[a.StopSpotlightOnParticipant]:e,[a.StopSpotlightSelf]:e};this.roleCapabilities={organizer:i,presenter:i,attendee:t,"":i}}getRoleCapabilities(e,t){return this.isSupportedMeetingRole(e)?this.roleCapabilities[e][t]:this.roleCapabilities.attendee[t]}isSupportedMeetingRole(e){switch(e){case"":case"attendee":case"presenter":case"organizer":return!0;default:return!1}}clearRoleCapabilities(){this.roleCapabilities=void 0}isActionPermitted(e){return this.getRoleCapabilities(this.call.meetingRole||"",e)}isSpotlightLimitReached(){return this.existingParticipantIdsInSpotlight.length>=this.numberOfAllowedSpotlights}stopSpotlightingParticipantInternal(e,t,i,n){this.logger.info(`stop spotlight for callId=${this.call.callId}, stateId=${t}`);let a=this.isBringOnStageEnabled?s.gT.scenarios.calling.managedModeStopSpotlight:s.gT.scenarios.calling.stopSpotlight,r=this.isPptSharedInManagedMode(i),o=this.utilityService.generateUUID(),l=this.createScenario(a,{commandId:o,stateId:t,participantId:e,isScreenShare:i,isPptShareInManagedMode:r}),c=this.changeSpotlightActiveScenarios[e];return c?l.incomplete({[s.gT.counters.eventNames.reason]:"spotlight: already active request"}):(this.createSpotlightChangeObject(e,l,!1,o,t),c=this.changeSpotlightActiveScenarios[e],this.removeSpotlightState(t,n??"{}",i,o,l,e)),c.deferred.promise}removeSpotlightState(e,t,i,n,a,o){let s=t.isScreenShareSpotlighted&&!t.isParticipantSpotlighted,l=!t.isScreenShareSpotlighted&&t.isParticipantSpotlighted,c=!t.isScreenShareSpotlighted&&!t.isParticipantSpotlighted;if(!this.config.enableContentShareQueueInManagedMode()||i&&s||!i&&l||c)this.call.removeState({stateIds:[e]},n).then(()=>{a.mark(u.ck.RequestSent)}).catch(t=>{this.handleSpotlightChangeFailure(o,t,this.getSpotlightStopErrorNot(),n,e)});else if(t.isScreenShareSpotlighted&&t.isParticipantSpotlighted){t.isScreenShareSpotlighted=!i,t.isParticipantSpotlighted=i;let e={participantIds:[o],type:r.PublishStateType.Spotlight,level:r.PublishStateLevel.User,content:JSON.stringify(t)};this.call.publishState(e,n).then(()=>{a.mark(u.ck.RequestSent)}).catch(e=>{this.handleSpotlightChangeFailure(o,e,this.getSpotlightErrorNot(),n)})}}isPptSharedInManagedMode(e){let t=!1;return this.call.activeContentSharingSessions&&(t=Array.from(this.call.activeContentSharingSessions.values()).some(e=>this.isPpt(e))),t&&e}isPpt(e){return"ppt"===e.detailedType}createScenario(e,t){let i=this.loggingService.newScenario(e,null,e=>{e===s.gT.scenarioStepStatus.timeout&&(i.eventData={reasonCMD:JSON.stringify(t)})});return i.appendEventData({[s.gT.counters.eventNames.isManagedModeEnabled]:this.isBringOnStageEnabled,[s.gT.counters.eventNames.targetUserInfoId]:t?.participantId?t.participantId.split(":").pop():"",[s.gT.counters.eventNames.commandId]:t?.commandId,[s.gT.counters.eventNames.threadId]:this.call.threadId,[s.gT.counters.eventNames.callId]:this.call.callId,[s.gT.counters.eventNames.spotlightedUserInfoIds]:this.existingParticipantIdsInSpotlight,[s.gT.counters.eventNames.templateId]:this.call.meetingDetails?.templateDetails?.id,[s.gT.counters.eventNames.eventId]:this.call.meetingDetails?.eventDetails?.id,[s.gT.counters.eventNames.isScreenShare]:t?.isScreenShare,[s.gT.counters.eventNames.isPptShareInManagedMode]:t?.isPptShareInManagedMode,[s.gT.counters.eventNames.spotlightedVBSSUserInfoIds]:this.existingParticipantScreenShareInSpotlight}),i.cancelIfOffline=!0,i}showNotification(e,t,i="",n=c.NK.Warning,a=c.MA.CallingFooter){this.dismissSpotlightNotification([m,_,S,C,v]);let r={name:e,title:i,text:t,type:n,dismissable:!0,windowType:a,teamsCallId:this.call.teamsCallId,timeout:45e3};this.serviceProvider.callingAlertsService().handleOnDemandAlert(r)}dismissSpotlightNotification(e){let t=this.serviceProvider.callingAlertsService().getAlertsOfTypes(e);(0,o.forEach)(t,e=>this.serviceProvider.callingAlertsService().dismiss(e))}createSpotlightChangeObject(e,t,i,n,a){if(!this.changeSpotlightActiveScenarios[e]){let r=this.promiseFactory.createDeferred(),o=this.timeout.set(()=>{let t=i?this.getSpotlightErrorNot():this.getSpotlightStopErrorNot();this.handleSpotlightChangeFailure(e,"Spotlight change operation timed out",t,n,a)},45*s.gT.timeInMiliseconds.second);this.changeSpotlightActiveScenarios[e]={scenario:t,isSpotlighted:i,timer:o,deferred:r}}}handleSpotlightChangeFailure(e,t,i,n,a){let r=this.changeSpotlightActiveScenarios[e];if(this.showNotification(S,i),r){let i=`error message: ${this.utilityService.getErrorLoggingString(t)}, commandId: ${n}, stateId: ${a}`,o=t&&t.subCode?{[s.gT.counters.eventNames.reason]:t&&`error message: ${t.phrase}, commandId: ${n}, stateId: ${a}`,[s.gT.counters.eventNames.terminatedReason]:t&&t.subCode}:{[s.gT.counters.eventNames.reason]:i};t&&t.subCode===h.gm0.RoleCheckFail&&"attendee"===this.call.meetingRole?(this.loggingService.error(`Changing role of participant ${e} request rejected (code: ${t.subCode})`),this.eventingService.emit(s.gT.events.calling.actionFailedWithInsufficientMeetingRole,{titleAction:this.localized.insufficientMeetingRoleAlert.title(),textAction:this.localized.insufficientMeetingRoleAlert.title()}),r.scenario.incomplete(o)):(this.loggingService.error(`Changing spotlight state of participant ${e} request failed (reason: ${i})`),r.scenario.fail(o)),this.timeout.cancel(r.timer),r.deferred.reject(t),delete this.changeSpotlightActiveScenarios[e]}}setSpotlightState(e){this.isInitialized=!0,this.selfParticipant?this.setSpotlightStateInternal(e):this.call.getSelfParticipant().then(t=>{this.selfParticipant=t,this.setSpotlightStateInternal(e)}).catch(()=>{this.isInitialized=!1})}setSpotlightStateInternal(e){let t=this.getSpotlightQueue(e);this.config.enableContentShareQueueInManagedMode()&&(this.isBringOnStageEnabled||this.existingParticipantScreenShareInSpotlight)&&this.handleVBSSSpotlight(e);let i=this.config.enableContentShareQueueInManagedMode()?(0,o.map)((0,o.filter)(t,e=>e.isParticipantSpotlighted||!e.isParticipantSpotlighted&&!e.isScreenShareLive),e=>e.id):(0,o.map)(t,e=>e.id);if((0,o.isEmpty)((0,o.xor)(this.existingParticipantIdsInSpotlight,i)))return;let n=(0,o.filter)(t,e=>!(0,o.includes)(this.existingParticipantIdsInSpotlight,e.id)),a=(0,o.filter)(this.existingParticipantIdsInSpotlight,e=>!(0,o.includes)(i,e));(n.length>0||a.length>0)&&this.logger.info(`stateChangedToSpotlighted: ${(0,o.join)((0,o.map)(n,e=>"userId:".concat(e.id,";rank:",e.spotlightRank.toString())),",")}. SpotlightsRemoved: ${(0,o.join)(a,",")}`),this.existingParticipantIdsInSpotlight=i,this.stateId=(0,o.includes)(i,this.selfParticipant.id)?this.getStateForParticipant(e,this.selfParticipant.id,!1).stateId:null;let r=!!this.stateId!==this.isSpotlighted;this.isSpotlighted=!!this.stateId,this.stateId&&this.logger.info(`setSpotlighted: the current participant is spotlighted: ${this.isSpotlighted}. stateId: ${this.stateId}`),this.isBringOnStageEnabled&&(r=r&&!this.selfParticipant.isWeatherperson),(0,o.forEach)(a,e=>this.updateParticipantSpotlightState(e,!1)),(0,o.forEach)(n,e=>this.updateParticipantSpotlightState(e.id,!0,e.spotlightRank)),this.stopSpotlightScenario&&(t.length?(this.stopSpotlightScenario.scenario.incomplete(),this.stopSpotlightScenario.deferred.reject()):(this.stopSpotlightScenario.scenario.stop(),this.stopSpotlightScenario.deferred.resolve()),this.timeout.cancel(this.stopSpotlightScenario.timer),this.stopSpotlightScenario=null),r&&(this.isBringOnStageEnabled?this.showOnStageNotification(this.isSpotlighted):this.isSpotlighted?this.showNotification(_,this.localized.callingSpotlightNotBody(),this.localized.callingSpotlightNot()):this.showNotification(m,this.localized.callingSpotlightStoppedNot()))}handleVBSSSpotlight(e){let t=this.getVBSSParticipantState(e);this.logger.info(`handleVBSSSpotlight: VBSS participant id: ${t?.id}`),t?(this.updateParticipantSpotlightState(t.id,!0,t.spotlightRank,!0),this.existingParticipantScreenShareInSpotlight=t.id):(this.updateParticipantSpotlightState(this.existingParticipantScreenShareInSpotlight,!1,void 0,!0),this.existingParticipantScreenShareInSpotlight="")}getVBSSParticipantState(e){let t=e?.typeStates?.find(e=>e?.type===r.PublishStateType.Spotlight);if(!t||!t.participantStates)return null;let i=t.participantStates.find(e=>{let t=e?.publishedState?.content;return t?.isScreenShareSpotlighted});return i&&i.publishedState?{id:i.id,spotlightRank:i.publishedState.typeRank,isScreenShareLive:!0,isParticipantSpotlighted:!1}:null}getSpotlightQueue(e){let t=this.getSpotlightedParticipants(e);return t.length>this.numberOfAllowedSpotlights&&(this.logger.warn(`spotlight: received ${t.length} spotlights, only ${this.numberOfAllowedSpotlights} allowed`),t.sort((e,t)=>e.spotlightRank-t.spotlightRank),t=t.slice(0,this.numberOfAllowedSpotlights)),t}clearScreenshareSpotlights(){if(!this.config.enableContentShareQueueInManagedMode())return;let e=this.call.publishedStates?.typeStates?.find(e=>e?.type===r.PublishStateType.Spotlight);(0,o.forEach)(e?.participantStates,e=>{let t=e?.publishedState?.content;t?.isScreenShareSpotlighted&&this.stopSpotlightOnParticipant(e.id,!0)})}subscribeToCallEvents(){this.publishedStatesChangedSubscription=this.call.on("publishedStatesChanged",e=>{g.eU.isCallActive(this.call)&&this.setSpotlightState(e)}),this.config.enableContentShareQueueInManagedMode()&&(this.userActivityChangedSubscription=this.call.on("userActivityChanged",()=>{let e=this.call.meetingDetails?.meetingCapability?.showContentSharePreviewInManagedMode||this.config.enableContentShareQueueUIInTownhall(),t=this.isBringOnStageEnabled&&e,i=this.existingParticipantScreenShareInSpotlight===this.selfParticipant?.id;t&&(this.logger.info(`userActivityChangedSubscription call.isScreenSharingOn: ${this.call.isScreenSharingOn}, lastIsScreenSharingOnValue: ${this.lastIsScreenSharingOnValue}, isSelfVBSSSpotlighted: ${i}`),this.call.isScreenSharingOn&&!this.lastIsScreenSharingOnValue?this.clearScreenshareSpotlights():!this.call.isScreenSharingOn&&i&&this.stopSpotlightOnParticipant(this.selfParticipant.id,!0),this.lastIsScreenSharingOnValue=this.call.isScreenSharingOn)})),(0,d.U)(this.call,e=>{switch(e.state){case r.CallState.Disconnected:this.publishedStatesChangedSubscription&&(this.publishedStatesChangedSubscription.dispose(),this.publishedStatesChangedSubscription=void 0),this.userActivityChangedSubscription&&(this.userActivityChangedSubscription.dispose(),this.userActivityChangedSubscription=null),this.existingParticipantIdsInSpotlight=[],this.existingParticipantScreenShareInSpotlight="",this.changeSpotlightActiveScenarios={},this.stopSpotlightScenario=null,this.roleCapabilities=null,this.isInitialized=!1,this.stateId=null,this.selfParticipant=null,this.isSpotlighted=!1,this.isScreenShareLive=!1,this.spotlightRank=null;break;case r.CallState.Connected:e.publishedStates&&(!this.isInitialized&&(this.existingParticipantIdsInSpotlight=[],this.existingParticipantScreenShareInSpotlight="",this.logger.info("Initializing spotlight state"),this.roleCapabilities||this.setRoleCapabilities(!0)),this.setSpotlightState(e.publishedStates));break;case r.CallState.LocalHold:case r.CallState.RemoteHold:break;default:this.isInitialized=!1,this.existingParticipantIdsInSpotlight=[],this.existingParticipantScreenShareInSpotlight="",this.changeSpotlightActiveScenarios={},this.stopSpotlightScenario=null,this.stateId=null,this.isSpotlighted=!1,this.isScreenShareLive=!1,this.spotlightRank=null}},!0)}getStateForParticipant(e,t,i){let n=e&&e.typeStates&&e.typeStates.find(e=>e.type===r.PublishStateType.Spotlight),a=n&&n.participantStates&&n.participantStates.find(e=>!!e&&e.id===t&&(!this.config.enableContentShareQueueInManagedMode()||!i||!!(e?.publishedState?.content).isScreenShareSpotlighted));return a&&a.publishedState&&a.publishedState}getSpotlightedParticipants(e){let t=e&&e.typeStates&&e.typeStates.length&&(0,o.find)(e.typeStates,e=>e&&e.type===r.PublishStateType.Spotlight);if(!t||!t.participantStates||!t.participantStates.length)return[];let i=[];return t.participantStates.forEach(e=>{if(e&&e.id&&e.publishedState&&e.publishedState.stateId){let t=e.publishedState.content,n=t&&!t.isScreenShareSpotlighted&&!t.isParticipantSpotlighted;(t?.isParticipantSpotlighted||n)&&i.push({id:e.id,spotlightRank:e.publishedState.typeRank,isScreenShareLive:!!t?.isScreenShareSpotlighted,isParticipantSpotlighted:!!t?.isParticipantSpotlighted})}}),i}get isBringOnStageEnabled(){return this.callingSupportService.isHostViewModeActive(this.call.meetingDetails?.meetingCapability)}getSpotlightStopErrorNot(){return this.isBringOnStageEnabled?this.localized.callingRemoveFromStageError():this.localized.callingSpotlightStopErrorNot()}getSpotlightErrorNot(){return this.isBringOnStageEnabled?this.localized.callingBringOnStageError():this.localized.callingSpotlightErrorNot()}showOnStageNotification(e){"attendee"===this.call.meetingRole?this.showNotification(e?C:v,e?this.localized.callingAttendeeOnStageNotification():this.localized.callingAttendeeRemovedFromStageNot()):this.showNotification(e?_:m,e?this.localized.callingOnStageNotificationBody():this.localized.callingRemovedFromStageNotBody(),e?this.localized.callingOnStageNotification():this.localized.callingRemovedFromStageNotification())}generateSpotlightContent(e,t){let i={isParticipantSpotlighted:!1,isScreenShareSpotlighted:!1};return this.existingParticipantIdsInSpotlight.find(t=>t===e)&&(i.isParticipantSpotlighted=!0),this.existingParticipantScreenShareInSpotlight===e&&(i.isScreenShareSpotlighted=!0),t?i.isScreenShareSpotlighted=!0:i.isParticipantSpotlighted=!0,JSON.stringify(i)}}class b extends p.r{constructor(e,t,i,n,a,r,o,s,c=l.Wq,d){super({...(0,p.f)({methods:["spotlightParticipant","stopSpotlightSelf","stopSpotlightOnParticipant","stopSpotlight"],props:["isSpotlighted","isScreenShareLive","spotlightRank","participantIdsInSpotlight"]}).syncedWith(),forceBind:!0,createMixin:l=>new f(l,e,t,i,n,a,r,o,s,c,d)})}}},527640:function(e,t,i){var n,a;i.d(t,{o:()=>n}),(a=n||(n={}))[a.None=0]="None",a[a.InGreenRoom=1]="InGreenRoom",a[a.InStagingRoom=2]="InStagingRoom",a[a.SuccessfullyMovedToMainMeeting=3]="SuccessfullyMovedToMainMeeting",a[a.FailedToBeMovedToMainMeeting=4]="FailedToBeMovedToMainMeeting",a[a.MeetingIsLive=5]="MeetingIsLive",a[a.MeetingHasEnded=6]="MeetingHasEnded",a[a.FailedToBeMovedFromMainMeetingToGreenRoom=7]="FailedToBeMovedFromMainMeetingToGreenRoom",a[a.SuccesfullyMovedFromMainMeetingToGreenRoom=8]="SuccesfullyMovedFromMainMeetingToGreenRoom"},835356:function(e,t,i){i.d(t,{Z:()=>d});var n=i(370574),a=i(892891),r=i(575810),o=i(4512),s=i(527640),l=i(505782);class c{constructor(e,t,i,n){this.call=e,this.localized=i,this.callingAlertsService=n,this.stagingRoomStateOrderedArray=[{property:"failedToBeMovedFromMainMeetingToGreenRoom",state:s.o.FailedToBeMovedFromMainMeetingToGreenRoom},{property:"succesfullyMovedFromMainMeetingToGreenRoom",state:s.o.SuccesfullyMovedFromMainMeetingToGreenRoom},{property:"eventEnded",state:s.o.MeetingHasEnded},{property:"failedToBeMovedFromGreenRoomToMainMeeting",state:s.o.FailedToBeMovedToMainMeeting},{property:"succesfullyMovedFromGreenRoomToMainMeeting",state:s.o.SuccessfullyMovedToMainMeeting},{property:"eventActive",state:s.o.MeetingIsLive},{property:"isInStagingRoom",state:s.o.InStagingRoom},{property:"isInGreenRoom",state:s.o.InGreenRoom}],this.stagingRoomStateHistory=[],this.logger=t.newLogger("StagingRoomsMixinImplementation"),this.previousStagingRoomProperties=this.extractStagingRoomPropertiesFromCall(),this.logStagingRoomProperties()}get stagingRoomProperties(){let e=this.extractStagingRoomPropertiesFromCall();return(0,a.isEqual)(e,this.previousStagingRoomProperties)||(this.handleNewStagingRoomState(e),this.handleShowStartMeetingAlert(e),this.handleShowMeetingGoLiveFailedAlert(e),this.handleShowPresenterFailedToBeMovedUponStartingAlert(e),this.call?.meetingRole&&"attendee"!==this.call.meetingRole&&(this.handleMeetingHasEndedAlert(e),this.handleShowEndCurtainFailedAlert(e),this.handleShowPresenterFailedToBeMovedUponEndingAlert(e)),this.previousStagingRoomProperties=e,this.logStagingRoomProperties()),this.previousStagingRoomProperties}logStagingRoomProperties(){let{teamsCallId:e,state:t}=this.call,{isEvent:i,eventActive:n,eventEnded:a,stagingRoomEnabled:r,eventIsLoading:o,isInGreenRoom:s,isInStagingRoom:l,willLandInGreenRoom:c,willLandInStagingRoom:d}=this.previousStagingRoomProperties;this.logger.info(`Staging room details changed for teamsCallId ${e} with state ${t}:
        isTownhallOrWebinar = ${i},
        eventActive = ${n},
        eventEnded = ${a},
        stagingRoomEnabled = ${r},
        eventIsLoading = ${o},
        isInGreenRoom = ${s},
        isInStagingRoom = ${l},
        willLandInGreenRoom = ${c},
        willLandInStagingRoom = ${d}`)}extractStagingRoomPropertiesFromCall(){let{meetingDetails:e,meetingGroupDetails:t,state:i,meetingRole:a}=this.call,{stagingGroup:r,greenGroup:o}=t?.groups||{stagingGroup:void 0,greenGroup:void 0},s=this.call?.meetingDetails?.templateDetails?.id||"",l=!!this.call?.meetingDetails?.meetingCapability?.forceAttendeeStreaming||"firstparty_d892ef44-003e-480c-9929-07349265a2e2"===s||"firstparty_21f91ef7-6265-4064-b78b-41ab66889d90"===s,c=e?.meetingCapability?.meetingLiveState?.phase==="live",d=e?.meetingCapability?.meetingLiveState?.phase==="ended",g=!!e?.meetingCapability?.stagingRoomEnabled,h=this.getEventStartIsLoadingState(),p=this.getEventEndIsLoadingState(),u=h||p,m=!!o&&i!==n.CallState.Connected,_=!!r&&i!==n.CallState.Staging,S=!!o&&i===n.CallState.Connected;return{isEvent:l,eventActive:c,eventEnded:d,stagingRoomEnabled:g,eventIsLoading:u,eventStartIsLoading:h,eventEndIsLoading:p,willLandInGreenRoom:m,willLandInStagingRoom:_,isInGreenRoom:S,isInStagingRoom:!!r&&i===n.CallState.Staging,failedToBeMovedFromGreenRoomToMainMeeting:S&&c&&!u,succesfullyMovedFromGreenRoomToMainMeeting:!S&&c&&!u,failedToBeMovedFromMainMeetingToGreenRoom:!S&&d&&!u&&"attendee"!==a,succesfullyMovedFromMainMeetingToGreenRoom:S&&d&&!u}}getEventIsLoadingState(e){let t=this.call?.publishedStates?.typeStates.find(({type:e})=>e===n.PublishStateType.UFD);return!!t?.participantStates.find(({publishedState:{content:t}})=>t.publishStateUFDType===e)}getEventStartIsLoadingState(){return this.getEventIsLoadingState(r.gT.stagingRooms.publishStateUFDParamValue)}getEventEndIsLoadingState(){return this.getEventIsLoadingState(r.gT.stagingRooms.publishEndCurtainStateUFDParamValue)}handleNewStagingRoomState(e){let t=s.o.None;for(let{property:i,state:n}of this.stagingRoomStateOrderedArray)if(e[i]){t=n;break}this.previousStagingRoomState!==t&&(this.logger.info(`stagingRoomState changed: ${this.previousStagingRoomState} => ${t}`),this.previousStagingRoomState=t,this.stagingRoomStateHistory.push({state:t,timestamp:Date.now()}))}handleShowStartMeetingAlert(e){this.shouldShowStartMeetingAlert(e)?(this.startMeetingAlert={teamsCallId:this.call.teamsCallId,name:"GreenRoomStartMeetingAlert",dismissable:!0,text:this.localized.callingGreenRoomStartMeetingAlertText(),type:o.NK.Info},this.callingAlertsService.handleOnDemandAlert(this.startMeetingAlert)):this.startMeetingAlert&&(this.callingAlertsService.dismiss(this.startMeetingAlert),this.startMeetingAlert=void 0)}handleShowMeetingGoLiveFailedAlert(e){this.shouldShowMeetingGoLiveFailedAlert(e)?(this.logger.warn("Meeting go live failed, showing alert to staging room participants"),this.meetingGoLiveFailedAlert={teamsCallId:this.call.teamsCallId,name:"GreenRoomMeetingGoLiveFailedAlert",dismissable:!0,text:this.localized.callingMeetingGoLiveFailedStagingRoomAlertText(),type:o.NK.Warning},this.callingAlertsService.handleOnDemandAlert(this.meetingGoLiveFailedAlert)):this.meetingGoLiveFailedAlert&&(this.callingAlertsService.dismiss(this.meetingGoLiveFailedAlert),this.meetingGoLiveFailedAlert=void 0)}handleShowPresenterFailedToBeMovedUponStartingAlert(e){e.failedToBeMovedFromGreenRoomToMainMeeting?(this.logger.error("Failed to move the participant from green room to the main meeting"),this.failedToMoveParticipantFromGreenRoomAlert={teamsCallId:this.call.teamsCallId,name:"GreenRoomParticipantFailedToBeMovedAlert",dismissable:!1,title:this.localized.callingFailedToMoveParticipantFromGreenRoomAlertTitle(),text:this.localized.callingFailedToMoveParticipantFromGreenRoomAlertText(),type:o.NK.Warning},this.callingAlertsService.handleOnDemandAlert(this.failedToMoveParticipantFromGreenRoomAlert)):this.failedToMoveParticipantFromGreenRoomAlert&&(this.callingAlertsService.dismiss(this.failedToMoveParticipantFromGreenRoomAlert),this.failedToMoveParticipantFromGreenRoomAlert=void 0)}shouldShowStartMeetingAlert({isInGreenRoom:e,eventActive:t,eventEnded:i,eventStartIsLoading:n}){let{meetingRole:a}=this.call;return e&&!t&&!i&&!n&&"attendee"!==a}shouldShowMeetingGoLiveFailedAlert({eventStartIsLoading:e,eventActive:t,eventEnded:i}){return this.previousStagingRoomProperties.eventStartIsLoading&&!e&&!i&&!t}handleMeetingHasEndedAlert(e){this.shouldShowMeetingEndedAlert(e)?(this.meetingEndedAlert={teamsCallId:this.call.teamsCallId,name:"GREEN_ROOM_MEETING_ENDED_ALERT",dismissable:!0,text:e.isEvent?this.localized.callingStagingRoomEventEndedAlertText():this.localized.callingStagingRoomMeetingEndedAlertText(),type:o.NK.Info},this.callingAlertsService.handleOnDemandAlert(this.meetingEndedAlert)):this.meetingEndedAlert&&(this.callingAlertsService.dismiss(this.meetingEndedAlert),this.meetingEndedAlert=void 0)}shouldShowMeetingEndedAlert({isInGreenRoom:e,eventEndIsLoading:t,eventEnded:i}){return e&&i&&!t}handleShowEndCurtainFailedAlert(e){this.shouldShowEndCurtainFaildAlert(e)?(this.logger.error("Meeting show end curtain failed, showing alert to staging room participants"),this.meetingShowEndCurtainFailedAlert={teamsCallId:this.call.teamsCallId,name:"GREEN_ROOM_MEETING_SHOW_END_CURTAIN_FAILED_ALERT",dismissable:!0,title:e.isEvent?this.localized.callingStagingRoomShowEndCurtainFailedAlertTitle():this.localized.callingStagingRoomMeetingShowEndCurtainFailedAlertTitle(),text:e.isEvent?this.localized.callingStagingRoomShowEndCurtainFailedAlertText():this.localized.callingStagingRoomMeetingShowEndCurtainFailedAlertText(),type:o.NK.Warning},this.callingAlertsService.handleOnDemandAlert(this.meetingShowEndCurtainFailedAlert)):this.meetingShowEndCurtainFailedAlert&&(this.callingAlertsService.dismiss(this.meetingShowEndCurtainFailedAlert),this.meetingShowEndCurtainFailedAlert=void 0)}shouldShowEndCurtainFaildAlert({eventEndIsLoading:e,eventEnded:t}){return this.previousStagingRoomProperties.eventEndIsLoading&&!e&&!t}handleShowPresenterFailedToBeMovedUponEndingAlert(e){e.failedToBeMovedFromMainMeetingToGreenRoom?(this.logger.error("Failed to move the participant from the main meeting to green room"),this.failedToMoveParticipantFromMainMeetingAlert={teamsCallId:this.call.teamsCallId,name:"GREEN_ROOM_PARTICIPANT_FAILED_TO_BE_MOVED_FROM_MAIN_MEETING_ALERT",dismissable:!1,title:this.localized.callingStagingRoomFailedToMoveParticipantFromMainMeetingAlertTitle(),text:e.isEvent?this.localized.callingStagingRoomFailedToMoveParticipantFromMainMeetingAlertText():this.localized.callingStagingRoomMeetingFailedToMoveParticipantFromMainMeetingAlertText(),type:o.NK.Warning},this.callingAlertsService.handleOnDemandAlert(this.failedToMoveParticipantFromMainMeetingAlert)):this.failedToMoveParticipantFromMainMeetingAlert&&(this.callingAlertsService.dismiss(this.failedToMoveParticipantFromMainMeetingAlert),this.failedToMoveParticipantFromMainMeetingAlert=void 0)}}class d extends l.r{constructor(e,t,i){super({...(0,l.f)({methods:[],props:["stagingRoomProperties","stagingRoomStateHistory"]}).syncedWith(),createMixin:n=>new c(n,e,t,i.callingAlertsService())})}}},58369:function(e,t,i){i.d(t,{y:()=>r});var n=i(505782);class a{constructor(e){this.call=e}raiseTeamsCallEvent(e,...t){this.call.event(e).raise(...t)}}class r extends n.r{constructor(){super({createMixin:e=>new a(e),...(0,n.f)({methods:["raiseTeamsCallEvent"],props:[]}).syncedWith(),forceBind:!0})}}},866301:function(e,t,i){i.d(t,{E:()=>n});let n={Cameo:"Cameo",ContentOnly:"ContentOnly",Weatherperson:"Weatherperson",SideBySide:"SideBySide",NewsAnchor:"NewsAnchor"}},969340:function(e,t,i){i.d(t,{z:()=>n});class n{}n.ApplicationIntegrationEnabled="applicationIntegrationEnabled",n.PairedTransportCompanionDevices="pairedTransportCompanionDevices"},749241:function(e,t,i){i.d(t,{t:()=>_});var n=i(370574),a=i(892891),r=i(310735),o=i(200669),s=i(113802),l=i(575810),c=i(945761),d=i(642900),g=i(855273),h=i(206898),p=i(395250);let u=[n.TerminatedReason.CallNotFound,n.TerminatedReason.CallDoesNotExist,n.TerminatedReason.NoPermission],m=[o.Vo.ObservingCallTimeout];class _{constructor(e,t,i,n,a,r,o,s=c.Wq,l=!0){this.timeout=t,this.conversationsAsyncService=i,this.callingService=n,this.retryService=a,this.utilityService=r,this.loggingService=o,this.promiseFactory=s,this.logger=this.loggingService.newLogger("ObservableCallService"),this.disposeEntryTimeoutMs=e.disposeEntryTimeoutMs(),this.retryOptions={retryIntervals:e.retryIntervals(),forever:!1},l&&this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.entries=[]}cleanupOnAppTeardown(e){this.entries.forEach(e=>{let t={error:Error("app teardown"),isTerminal:!0};this.notifySubscribers(e.subscribers,e=>{e.scenario?.cancel({reason:"App teardown"}),e.scenario=void 0,this.invokeErrorCallback(e,t)})}),this.entries=null}async observe(e,t,i,n){let a=this.createScenario(n);try{e.type===r.G.Meeting&&e.instantMeeting?.schedulingServiceEventPromise&&(a.mark(p.ck.AwaitSchedulingServiceEvent),await e.instantMeeting?.schedulingServiceEventPromise),this.enrichScenarioWithCallCoordinates(a,e);let n=await this.getEntryByCoordinates(e,a);if(n)return n.legacyCoordinates||n.coordinates.type!==r.G.Meeting||n.coordinates.joinType!==h.c.MeetingData||e.type!==r.G.Meeting||e.joinType!==h.c.Legacy||(n.legacyCoordinates=e),this.handleExistingEntry(n,t,i,a)}catch(e){return i({error:e,isTerminal:!0}),a.fail({reason:`Failed to start observing call. error=${e?.name}, error.message=${e?.message}`}),Promise.reject(e)}return this.createEntry(e,t,i,a,n)}populateIfEntryShouldBeCleanedUpWithoutDelay(e,t){e.instantDispose||(e.instantDispose=t.isBreakoutRoom())}async getEntryByCoordinates(e,t){t.mark(p.ck.GetEntryByCoordinates);let i=this.entries.map(t=>({entry:t,isEqual:d.P.areCoordinatesEquivalentAsync(t.coordinates,e,this.conversationsAsyncService,this.callingService)})),n=this.entries.reduce((t,i)=>(i.legacyCoordinates&&t.push({entry:i,isEqual:d.P.areCoordinatesEquivalentAsync(i.legacyCoordinates,e,this.conversationsAsyncService,this.callingService)}),t),[]);i.push(...n);let a=i.map(e=>new Promise((t,i)=>e.isEqual.then(i=>i&&t(e.entry),i)));return a.push(Promise.all(i).then(()=>void 0)),Promise.race(a)}createEntry(e,t,i,n,a){n.mark(p.ck.CreateEntry);let r={callback:t,errorCallback:i,scenario:n},o={coordinates:e,subscribers:[r],promise:null,options:a};return this.updateCallPromise(o),this.entries.push(o),this.createDisposable(o,r)}handleExistingEntry(e,t,i,n){n.mark(p.ck.HandleExistingEntry);let a={callback:t,errorCallback:i,scenario:n};return e.subscribers.push(a),e.isPromiseResolved&&e.promise.then(e=>{this.stopScenario(a,e),this.invokeCallback(a,e)}),this.createDisposable(e,a)}updateCallPromise(e){e.retryOperation&&e.retryOperation.cancel(),e.retryOperation=this.retryService.retry("obervableCallService::updateCallPromise",()=>this.updateCallPromiseInternal(e),this.retryOptions),e.retryOperation.promise.catch(t=>{if(t!==l.gT.promiseState.cancelled){let t="max num of failures exceeded";this.logger.error(t),this.raiseTerminalError(e,t)}})}updateCallPromiseInternal(e){return e.subscribers.length?(e.subscribers.forEach(e=>{e.scenario?.mark(p.ck.GetObservableCall)}),e.isPromiseResolved=!1,e.promise=this.callingService.getObservableCall({coordinates:e.coordinates,context:s.l.ObservableCallService,createIfNotExists:!0,skipDeviceInitialization:e.options?.skipDeviceInitialization,skipTransportCompanionInitialization:e.options?.skipTransportCompanionInitialization,ignoreJoinFailure:!1}),e.promise.then(t=>(e.isPromiseResolved=!0,this.notifySubscribers(e.subscribers,e=>{this.stopScenario(e,t),this.invokeCallback(e,t)}),this.waitForCallToDisconnect(e,t))).catch(t=>{let i=`Failed to get observable call. error=${t?.name}, error.message=${t?.message}`;this.logger.error(i);let n={error:t,isTerminal:!1};return e.disposeBooked&&!e.subscribers.length?((0,a.remove)(this.entries,t=>t===e),this.promiseFactory.resolve()):(this.notifySubscribers(e.subscribers,e=>{e.scenario?.mark(p.ck.Retry,{reason:i}),this.invokeErrorCallback(e,n)}),this.promiseFactory.reject(t))})):(e.disposeBooked&&(e.instantDispose=!0,this.disposeEntryIfNeeded(e,"no active subscribers and entry promise is not resolved")),this.promiseFactory.resolve())}waitForCallToDisconnect(e,t){let i=this.promiseFactory.createDeferred();return e.callChangedSubscription=(0,g.U)(t,()=>{if(this.populateIfEntryShouldBeCleanedUpWithoutDelay(e,t),t.state===n.CallState.Disconnected)if((0,a.includes)(u,t.terminatedReason)||(0,a.includes)(m,t.abortReason)){let n=`Observable call disconnected, cannot retry! Terminated reason: ${t.terminatedReason}, callEndDiagnosticsInfo: ${this.utilityService.asString(t.callEndDiagnosticsInfo)}`;this.logger.error(n),this.raiseTerminalError(e,n),i.resolve()}else if(t.wasInState(n.CallState.Connecting)||t.wasInState(n.CallState.Preheating)||t.wasInState(n.CallState.Observing))i.resolve(),this.updateCallPromise(e);else{let e=`Observable call disconnected, terminatedReason: ${t.terminatedReason}, callEndDiagnosticsInfo: ${this.utilityService.asString(t.callEndDiagnosticsInfo)}, retrying...`;i.reject(e)}},!0),i.promise}notifySubscribers(e,t){e.slice().forEach(e=>this.timeout.set(()=>t(e),0))}invokeCallback(e,t){try{e.callback(t)}catch(e){this.logger.errorToTelemetry?.(`Failed to invoke callback. error=${e?.name}, error.message=${e?.message}`,"cmd_observable_call_invoke_callback_failed",void 0,!0)}}invokeErrorCallback(e,t){try{e.errorCallback(t)}catch(e){this.logger.errorToTelemetry?.(`Failed to invoke error callback. error=${e?.name}, error.message=${e?.message}`,"cmd_observable_call_invoke_callback_failed",void 0,!0)}}raiseTerminalError(e,t){let i={error:Error(t),isTerminal:!0};e.terminalError=i,this.notifySubscribers(e.subscribers,e=>{e.scenario?.fail({reason:t}),e.scenario=void 0,this.invokeErrorCallback(e,i)}),this.disposeEntryIfNeeded(e,t)}createDisposable(e,t){return{dispose:i=>{(0,a.remove)(e.subscribers,n=>n===t&&(e.isPromiseResolved?t.scenario?.stop():t.scenario?.cancel({reason:`Observable call subscription disposed. reason=${i}`}),t.scenario=void 0,!0)),this.disposeEntryIfNeeded(e,i)}}}disposeEntryIfNeeded(e,t){let i=()=>{e.subscribers.length||(e.callChangedSubscription&&(e.callChangedSubscription.dispose(),e.callChangedSubscription=null),e.retryOperation&&(e.retryOperation.cancel(),e.retryOperation=null),e.terminalError||e.instantDispose?(0,a.remove)(this.entries,t=>t===e):e.promise.then(i=>{e.subscribers.length||i.state!==n.CallState.Observing||(this.logger.infoToTelemetry?.(`ObservableCallService:dispose: Stopping the observed call. Call state: ${i.state}. Reason: ${t}.`,"cmd_stop_call",{callId:i.callId,participantId:i.participantId,threadId:i.threadId},!0),i.stop())}).catch(a.noop).then(()=>{e.subscribers.length||(0,a.remove)(this.entries,t=>t===e)}))};if(e.terminalError){e.subscribers=[],i();return}if(!e.subscribers.length){if(e.instantDispose)return void i();e.disposeBooked=!0,this.timeout.set(i,this.disposeEntryTimeoutMs,!1)}}createScenario(e){let t=this.loggingService.newScenario(p.RG.CallingCallObserve);return e?.context&&t.appendEventData({context:e.context}),t}enrichScenarioWithCallCoordinates(e,t){t.type===r.G.Meeting&&(t.joinType===h.c.Legacy?e.appendEventData({threadId:t.conversationId,messageId:t.rootMessageId,organizerId:t.organizerId,meetingTenantId:t.tenantId}):t.joinType===h.c.MeetingData&&e.appendEventData({meetingCode:Number(t.meetingData.meetingCode)}))}stopScenario(e,t){e.scenario?.appendEventData({callId:t.callId,teamsCallId:t.teamsCallId,participantId:t.participantId}),e.scenario?.stop(),e.scenario=void 0}}},19745:function(e,t,i){i.d(t,{h:()=>c,j:()=>l});var n=i(370574),a=i(892891),r=i(826757);let o="self",s={totalParticipants:0,totalConnectedTflParticipants:0,lobbyParticipants:0,totalPresenters:0,totalAttendees:0,requestingAttentionPresenters:0,requestingAttentionAttendees:0,overflowAttendees:0,streamingAttendees:0,totalOrganizers:0};class l{}l.Type_CallParticipantCountsChanged="call-participant-counts-changed";class c{constructor(e,t,i,n,a,r,o,s=!0,l){this.config=e,this.callingService=t,this.chatServiceUtils=n,this.mtmaSubscriptionUtility=a,this.asObservable=r,this.helpers=o,this.utilityService=l,s&&this.initializeOnAppLaunchAndReinit(),this.logger=i.newLogger("ParticipantCountsService")}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}getCallLobbyParticipantCounts(e){let t=this.callingService.getCallByTeamsCallId(e,!0,!1);return t?(this.subscribeTo(t),this.callStates?.get(t)?.participantCounts?.lobbyParticipants??0):0}initializeOnAppLaunchAndReinit(){this.callStates=new Map,this.callingBots=new Set(this.config.blacklistedBots()||[]),this.logsMap=new Map,this.callingServiceSubscription=this.mtmaSubscriptionUtility.subscribe(this.callingService,()=>this.onCallsChanged())}cleanupOnAppTeardown(e){this.callStates=void 0,this.callingBots=void 0,this.callingServiceSubscription=void 0,this.logsMap=void 0}getCallParticipantCounts(e){let t=this.callingService.getCallByTeamsCallId(e,!0,!1);return t?(this.subscribeTo(t),this.callStates?.get(t)?.participantCounts):s}trigger(e,t,i){return this.asObservable.trigger(e,t,i)}onCallsChanged(){for(let e of this.callingService.getAllCalls(!0,!0))this.subscribeTo(e)}subscribeTo(e){if(this.callStates.has(e)||e.state===n.CallState.Disconnected)return;let t={lobbyParticipants:new Set,totalPresenters:new Set,totalAttendees:new Set,pstnParticipants:new Set,requestingAttentionPresenters:new Set,requestingAttentionAttendees:new Set,overflowAttendees:new Set,streamingAttendees:new Set,totalOrganizers:new Set},i={...e.participantCounts?this.getParticipantCountsWithoutBots(e):s};this.callStates.set(e,{mainSubscriptions:[],polyfillSubscriptions:[],participantSets:t,participantCounts:i});let a=()=>this.onCallParticipantCountsUpdated(e),r=this.utilityService?()=>{this.utilityService.deferOnce(a)}:a,o=[e.on("callStateChanged",()=>this.onCallStateChanged(e)),e.on("participantCountsUpdated",r),e.on("participantAdded",r),e.on("participantRemoved",r),e.on("participantUpdated",r)],l=e.participantCounts?[]:[e.on("participantCountsUpdated",()=>{this.onCallParticipantCountsAppeared(e)}),e.changed(()=>{this.onSelfParticipantChanged(e),r()}),e.on("participantAdded",t=>{this.onParticipantAdded(e,t),r()}),e.on("participantRemoved",t=>{this.onParticipantRemoved(e,t),r()}),e.on("participantUpdated",t=>{this.onParticipantRemoved(e,t),this.onParticipantAdded(e,t),r()})];this.callStates.set(e,{mainSubscriptions:o,polyfillSubscriptions:l,participantSets:t,participantCounts:i}),e.participantCounts||this.populateInitialParticipantCounts(e)}populateInitialParticipantCounts(e){for(let t of(this.onSelfParticipantChanged(e),e.participants))this.onParticipantAdded(e,t);this.callStates.get(e).participantCounts=this.getCountsFromParticipantSets(e)}getCountsFromParticipantSets(e){let{participantSets:t}=this.callStates.get(e),i={lobbyParticipants:t.lobbyParticipants.size,totalPresenters:t.totalPresenters.size,totalAttendees:t.totalAttendees.size,requestingAttentionAttendees:t.requestingAttentionAttendees.size,requestingAttentionPresenters:t.requestingAttentionPresenters.size,totalParticipants:t.lobbyParticipants.size+t.totalPresenters.size+t.totalAttendees.size+t.pstnParticipants.size,totalConnectedTflParticipants:0};return i.totalAttendees?i.totalAttendees+=t.pstnParticipants.size:i.totalPresenters+=t.pstnParticipants.size,this.logIfNotDuplicate("ParticipantSets",`[${e.callId}] ParticipantSets: ${JSON.stringify(i)}`),i}unsubscribeFrom(e){let t=this.callStates.get(e);if(t){for(let e of t.mainSubscriptions||[])e.dispose();for(let e of t.polyfillSubscriptions||[])e.dispose();this.callStates.delete(e)}}onCallStateChanged(e){e.state===n.CallState.Disconnected&&this.unsubscribeFrom(e)}onCallParticipantCountsAppeared(e){if(!e.participantCounts)return;let t=this.callStates.get(e);for(let e of t.polyfillSubscriptions)e.dispose();for(let e of(0,a.values)(t.participantSets))e.clear&&e.clear();t.polyfillSubscriptions.length=0}onCallParticipantCountsUpdated(e){let t=this.callStates.get(e);if(!t)return;let i=t.participantCounts,n=this.getParticipantCountsWithoutBots(e),r=e.teamsCallId.toString();(0,a.isEqual)(i,n)||(t.participantCounts=n,this.logIfNotDuplicate("TotalCountChanged",`[${e.callId}] Total count changed from ${i.totalParticipants} to ${n.totalParticipants} for call ${r}. ${!e.participantCounts?"Counts are polyfilled.":""}`),i.lobbyParticipants!==n.lobbyParticipants&&this.logIfNotDuplicate("LobbyCountChanged",`[${e.callId}] Participants in lobby count changed from ${i.lobbyParticipants} to ${n.lobbyParticipants} for call ${r}.`),this.trigger(l.Type_CallParticipantCountsChanged,r,n))}getParticipantCountsWithoutBots(e){if(!e.participantCounts)return this.logIfNotDuplicate("RetrievingFromParticipantSets",`[${e.callId}] Retrieving participant counts from participant sets`),this.getCountsFromParticipantSets(e);let t=e.participants.filter(e=>this.callingBots.has(e.id)||r.eU.isInvisibleBot(e)||r.eU.isParticipantAnRtmpInBot(e)),[i,o]=(0,a.partition)(t,({state:e})=>e===n.ParticipantState.InLobby),s=o.filter(({meetingRole:e})=>"attendee"===e).length,l=o.length-s,c=!!e.meetingDetails?.meetingCapability?.forceAttendeeStreaming,d=0;e.participants.forEach(e=>r.eU.isSkypeConsumerUser(e.id)&&!e.id.startsWith("8:guest")&&e.state===n.ParticipantState.Connected&&d++),this.logIfNotDuplicate("ParticipantCounts",`[${e.callId}] Participant counts: ${JSON.stringify(e.participantCounts)}`),this.logIfNotDuplicate("BotsInfo",`[${e.callId}] Participants Size: ${e.participants.length}, botsInCall: ${t.length}, presenterBotsInCallCount: ${l}, attendeeBotsInCallCount: ${s}, botsInLobby: ${i.length}`);let g=this.config.enableRequiredParticipantRosterForCounts()&&e.participants?.length>0,h={...e.participantCounts,totalPresenters:g?e.participantCounts.totalPresenters-l:0,totalAttendees:g?e.participantCounts.totalAttendees-s:0,totalParticipants:g?e.participantCounts.totalParticipants-t.length:0,lobbyParticipants:g?e.participantCounts.lobbyParticipants-i.length:0,streamingAttendees:c?e.participantCounts?.streamingClients:0,overflowAttendees:c?0:e.participantCounts?.streamingClients,totalConnectedTflParticipants:d};return this.logIfNotDuplicate("OverriddenParticipantCounts",`${e.callId} Overridden participant counts: ${JSON.stringify(h)}`),h}onSelfParticipantChanged(e){let{participantSets:t}=this.callStates.get(e);if(t.lobbyParticipants.delete(o),t.totalPresenters.delete(o),t.totalAttendees.delete(o),t.requestingAttentionPresenters.delete(o),t.requestingAttentionAttendees.delete(o),![n.CallState.Observing,n.CallState.None,n.CallState.Preheated,n.CallState.Preheating].includes(e.state)){if(e.state===n.CallState.InLobby)return void t.lobbyParticipants.add(o);"attendee"===e.meetingRole?(t.totalAttendees.add(o),e.isHandRaised&&t.requestingAttentionAttendees.add(o)):(t.totalPresenters.add(o),e.isHandRaised&&t.requestingAttentionPresenters.add(o))}}onParticipantAdded(e,t){let{participantSets:i}=this.callStates.get(e);if(!this.callingBots.has(t.id)){if(t.state===n.ParticipantState.InLobby)return void i.lobbyParticipants.add(t);if(this.chatServiceUtils.isPstnMri(t.id))return void i.pstnParticipants.add(t);"attendee"===t.meetingRole?(i.totalAttendees.add(t),this.helpers.isParticipantHandRaised(t)&&i.requestingAttentionAttendees.add(t)):(i.totalPresenters.add(t),this.helpers.isParticipantHandRaised(t)&&i.requestingAttentionPresenters.add(t))}}onParticipantRemoved(e,t){let{participantSets:i}=this.callStates.get(e);i.lobbyParticipants.delete(t),i.totalPresenters.delete(t),i.totalAttendees.delete(t),i.pstnParticipants.delete(t),i.requestingAttentionPresenters.delete(t),i.requestingAttentionAttendees.delete(t)}logIfNotDuplicate(e,t){this.logsMap&&this.logsMap.get(e)!==t&&(this.logsMap.set(e,t),this.logger.info(t))}}},35379:function(e,t,i){i.d(t,{q:()=>u});var n=i(370574),a=i(892891),r=i(945761),o=i(4512),s=i(575810),l=i(924975),c=i(200669),d=i(377957),g=i(855273),h=i(395250),p=i(634504);class u{constructor(e,t,i,n,a,o,s,l,c,d=r.Wq,g){this.config=e,this.callingService=t,this.callingAlertsService=i,this.callTogglingService=n,this.loggingService=o,this.callingMultiWindowService=s,this.asObservable=l,this.localized=c,this.promiseFactory=d,this.userPreferencesStore=g,this.logger=o.newLogger("PushToTalkService"),this.initialize()}getPushToTalkIsAvailable(){return this.config.enablePushToTalkFeature()&&this.callingMultiWindowService.isModernCallingEnabled()}getPushToTalkEnabledByUser(){return this.userPreferencesStore?this.userPreferencesStore.getUserPreferences()?.enablePushToTalk??!0:(this.logger.error("User preference store is not available."),!0)}setPushToTalkEnabledByUser(e){if(!this.userPreferencesStore)return void this.logger.error("User preference store is not available.");let t=this.loggingService.newScenario(h.RG.PushToTalkStorageUpdate);try{this.userPreferencesStore.setUserPreference(s.gT.storageNames.enablePushToTalk,e.toString()),t.stop({userSetting:e.toString()});let i=this.callingService.getActiveCall();i&&(i.isPushToTalkEnabled=e,this.trigger(s.gT.events.calling.pushToTalk.pushToTalkSettingChanged,d.w.getTeamsCallIdAsString(i.teamsCallId)))}catch(n){let i=`Failed to ${e?"enable":"disable"} push-to-talk setting: ${n}`;this.logger.error(i),t.fail({error:i,userSetting:e.toString()})}}startPushToTalk(e){let t=(0,p.Z)();return this.logger.info(`[cid=${t}] Starting push to talk for call [teamsCallId=${e.teamsCallId}]`),this.promiseFactory.resolve().then(()=>this.callingMultiWindowService.isModernCallingEnabled()?this.config.enablePushToTalkFeature()?this.getPushToTalkEnabledByUser()?!this.callTogglingService.isMuted(e)||e.isPushToTalkActive||e.pushToTalkPromise?this.promiseFactory.reject("Already unmuted or unmuting."):this.promiseFactory.finalized(this.pushToTalkToggleMute(e,t,!1).then(()=>{if(this.callTogglingService.isMuted(e)){let e="Unmuting resolved but the call has been found to be muted.";return this.logger.warn(`[cid=${t}] ${e}`),this.promiseFactory.reject(e)}this.setPushToTalkActive(e)}).then(()=>{if(e.isPushToTalkAborted){if(!this.callTogglingService.isMuted(e))return this.pushToTalkToggleMute(e,t,!0).then(()=>this.promiseFactory.reject("Push to talk has been aborted."))}else e.pushToTalkPromise=null}),()=>{e.pushToTalkPromise=null,e.isPushToTalkAborted=!1}):this.promiseFactory.reject("Push-to-talk is disabled by user privacy settings."):this.promiseFactory.reject("Push-to-talk is disabled in FF."):this.promiseFactory.reject("Push-to-talk is available only in MW version."))}stopPushToTalk(e){return this.promiseFactory.resolve().then(()=>{let t=(0,p.Z)();return(this.logger.info(`[cid=${t}] Stopping push to talk for call [teamsCallId=${e.teamsCallId}]`),e.pushToTalkPromise)?(e.isPushToTalkAborted=!0,this.logger.info(`[cid=${t}] Delaying mute since unmuting is in progress`),e.pushToTalkPromise):e.isPushToTalkActive?this.pushToTalkToggleMute(e,t,!0):this.promiseFactory.reject("Cannot mute back because push to talk is not active")})}subscribe(e,t,i){return this.asObservable.subscribe(e,t,i)}unsubscribe(e){return this.asObservable.unsubscribe(e)}trigger(e,t,i){return this.asObservable.trigger(e,t,i)}async initialize(){this.userPreferencesStore&&await this.userPreferencesStore.waitForPreferenceStoreToInitialize().then(()=>{this.logger.info("User preference store initialized")}).catch(e=>{this.logger.error(`Failed to initialize user preference store: ${e}`)})}pushToTalkActiveAlert(e){let t=this.config.getOsPlatform()===c.NR.Mac;return{dismissable:!1,type:o.NK.Standalone,name:"TemporarilyUnmuted",title:this.localized.alertTemporarilyUnmutedTitle(),text:t?this.localized.alertTemporarilyUnmutedTextMac():this.localized.alertTemporarilyUnmutedTextWindows(),isAffirmational:!0,teamsCallId:e.teamsCallId}}setPushToTalkActive(e){this.startCallTogglingSubscription(e),e.isPushToTalkActive=!0,this.callingAlertsService.handleOnDemandAlert(this.pushToTalkActiveAlert(e))}setPushToTalkInactive(e){e.isPushToTalkActive=!1,this.callingAlertsService.dismiss(this.pushToTalkActiveAlert(e))}isDisconnectedState(e){let t=[n.CallState.Disconnecting,n.CallState.Disconnected],i=(0,a.includes)(t,e.state);return this.logger.info(`isDisconnectedState: ${i}`),i}isCallMuted(e){let t=this.callTogglingService.isMuted(e);return this.logger.info(`isCallMuted: ${t}`),t}startCallTogglingSubscription(e){(0,g.U)(e,()=>{if(this.isCallMuted(e)||this.isDisconnectedState(e))return this.setPushToTalkInactive(e),!0})}pushToTalkToggleMute(e,t,i){return this.promiseFactory.resolve().then(()=>this.callTogglingService.toggleMuteAudio(e,l.c3.MW,i?l.Jn.Mute:l.Jn.Unmute,{[s.gT.counters.eventNames.context]:s.gT.scenarios.calling.context.pushToTalkTriggered},t).then(e=>{e.type===l.Nn.Error&&this.logger.error(`[cid=${t}] Failed push to talk: ${e.message}`)}))}}},261234:function(e,t,i){i.d(t,{Ac:()=>_,LI:()=>O,PC:()=>b,Rr:()=>M,U8:()=>R,UZ:()=>p,XJ:()=>E,Xt:()=>I,by:()=>D,dI:()=>U,ee:()=>y,fp:()=>S,gO:()=>A,hd:()=>C,jn:()=>k,kM:()=>F,lX:()=>B,nw:()=>g,qi:()=>L,rm:()=>T,tG:()=>f,tH:()=>P,uV:()=>w,uW:()=>N,vX:()=>m,ve:()=>h,yV:()=>u});var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C,v=i(771199);(n=g||(g={}))[n.Quality=0]="Quality",n[n.SignalingIncompleteWithEarlyCancellation=1]="SignalingIncompleteWithEarlyCancellation",n[n.ShortDurationHangup=2]="ShortDurationHangup",n[n.EffectiveMeeting=3]="EffectiveMeeting",n[n.EffectiveMeetingV2=4]="EffectiveMeetingV2",n[n.EffectiveMeetingViva=5]="EffectiveMeetingViva",(a=h||(h={}))[a.Unknown=0]="Unknown",a[a.P2P=1]="P2P",a[a.GroupCall=2]="GroupCall",a[a.Meeting=3]="Meeting",a[a.ScreenshareFromChat=4]="ScreenshareFromChat",a[a.PSTN=5]="PSTN",a[a.SfB=6]="SfB",(r=p||(p={})).Unknown="Unknown",r.Inline="Inline",r.Modal="Modal",r.InlineMultiWindow="InlineMultiWindow",r.ModalMultiWindow="ModalMultiWindow",(o=u||(u={}))[o.Audio=1]="Audio",o[o.AttendeeAudio=2]="AttendeeAudio",o[o.Video=3]="Video",o[o.ScreenSharing=4]="ScreenSharing",o[o.Broadcast=5]="Broadcast",o[o.ScreenshareFromChat=6]="ScreenshareFromChat",o[o.AttendeeGeneral=7]="AttendeeGeneral",o[o.AttendeeCaptions=8]="AttendeeCaptions",o[o.CallClosedCaptions=9]="CallClosedCaptions",o[o.EffectiveMeeting=10]="EffectiveMeeting",o[o.Transcript=11]="Transcript",o[o.Other=12]="Other";let f=105,b=106,y=108,T=109,I="%20",A="%27",E="checks",M=3e3,P={CANCEL:"cancel",NOT_SHOWN:"not shown",RANDOM:"random",CLOSE:"close",TIMEOUT:"timeout"},k={SUBMITTED:"Submitted",DISMISSED:"Dismissed",TIMED_OUT:"TimedOut"};(s=m||(m={})).CancelFromToken="CancelFromToken",s.CancelFromRating="CancelFromRating",s.Submit="Submit",(l=_||(_={})).Rating="Rating",l.Tokens="Tokens",(c=S||(S={})).Cooldown="Cooldown",c.VivaEmfNoFeedback="VivaEmfNoFeedback",c.VivaEmf="VivaEmf";let D=[402,403,409],R=[209],w=[409],F=[{category:"q",token:101,uri:"skype:?cqg&target=audio.nolocal&ui_entrypoint=cqf",id:"audio_nolocal"},{category:"q",token:102,uri:"skype:?cqg&target=audio.noremote&ui_entrypoint=cqf",id:"audio_noremote"},{category:"q",token:103,uri:"skype:?cqg&target=audio.quality.echo&ui_entrypoint=cqf",id:"audio_quality_echo"},{category:"q",token:104,uri:"skype:?cqg&target=audio.quality.noise&ui_entrypoint=cqf",id:"audio_quality_noise"},{category:"q",token:105,uri:"skype:?cqg&target=audio.quality.volume&ui_entrypoint=cqf",id:"audio_quality_volume"},{category:"q",token:106,uri:"skype:?cqg&target=audio.dropped&ui_entrypoint=cqf",id:"audio_dropped"},{category:"q",token:107,uri:"skype:?cqg&target=audio.quality.distorted&ui_entrypoint=cqf",id:"audio_quality_distorted"},{category:"q",token:108,uri:"skype:?cqg&target=audio.quality.delay&ui_entrypoint=cqf",id:"audio_quality_delay"},{category:"qe",token:109,uri:"skype:?cqg&target=audio.other&ui_entrypoint=cqf",id:"audio_other",editLength:100},{category:"pq",token:301,uri:"skype:?cqg&target=audio.quality.dialpad&ui_entrypoint=cqf",id:"audio_quality_dialpad"},{category:"vq",token:201,uri:"skype:?cqg&target=video.nolocal&ui_entrypoint=cqf",id:"video_nolocal"},{category:"vq",token:202,uri:"skype:?cqg&target=video.noremote&ui_entrypoint=cqf",id:"video_noremote"},{category:"vq",token:203,uri:"skype:?cqg&target=video.quality.poor&ui_entrypoint=cqf",id:"video_quality_poor"},{category:"vq",token:204,uri:"skype:?cqg&target=video.quality.freezing&ui_entrypoint=cqf",id:"video_quality_freezing"},{category:"vq",token:205,uri:"skype:?cqg&target=video.dropped&ui_entrypoint=cqf",id:"video_dropped"},{category:"vq",token:206,uri:"skype:?cqg&target=video.quality.dark&ui_entrypoint=cqf",id:"video_quality_dark"},{category:"vq",token:207,uri:"skype:?cqg&target=video.quality.sync&ui_entrypoint=cqf",id:"video_quality_sync"},{category:"vqe",token:208,uri:"skype:?cqg&target=video.other&ui_entrypoint=cqf",id:"video_other",editLength:100},{category:"vq",token:209,uri:"skype:?cqg&target=video.quality.backgroundblur&ui_entrypoint=cqf",id:"video_quality_backgroundblur"},{category:"sq",token:401,uri:"skype:?cqg&target=ss.nolocal&ui_entrypoint=cqf",id:"ss_nolocal"},{category:"sq",token:402,uri:"skype:?cqg&target=ss.noremote&ui_entrypoint=cqf",id:"ss_noremote"},{category:"sq",token:403,uri:"skype:?cqg&target=ss.quality.start&ui_entrypoint=cqf",id:"ss_quality_start"},{category:"sq",token:405,uri:"skype:?cqg&target=ss.quality.freezing&ui_entrypoint=cqf",id:"ss_quality_freezing"},{category:"sq",token:404,uri:"skype:?cqg&target=ss.quality.poor&ui_entrypoint=cqf",id:"ss_quality_poor"},{category:"sq",token:406,uri:"skype:?cqg&target=ss.dropped&ui_entrypoint=cqf",id:"ss_dropped"},{category:"sq",token:407,uri:"skype:?cqg&target=ss.quality.sync&ui_entrypoint=cqf",id:"ss_quality_sync"},{category:"sqe",token:408,uri:"skype:?cqg&target=ss.other&ui_entrypoint=cqf",id:"ss_other",editLength:100},{category:"sq",token:409,uri:"skype:?cqg&target=ss.quality.systemaudio&ui_entrypoint=cqf",id:"ss_quality_systemaudio"},{category:"r",token:501,uri:"skype:?cqg&target=reliability.join&ui_entrypoint=cqf",id:"reliability_join"},{category:"r",token:502,uri:"skype:?cqg&target=reliability.invite&ui_entrypoint=cqf",id:"reliability_invite"},{category:"cc",token:701,uri:"skype:?cqg&target=cc.quality.rating.&ui_entrypoint=cqf",id:"cc_quality_rating",starRating:!0},{category:"cc",token:702,uri:"skype:?cqg&target=cc.quality.other.&ui_entrypoint=cqf",id:"cc_other",editLength:100}],N=[{category:"bp",token:601,uri:"skype:?cqg&target=broadcast.start&ui_entrypoint=cqf",id:"broadcast_start"},{category:"bp",token:602,uri:"skype:?cqg&target=broadcast.ended&ui_entrypoint=cqf",id:"broadcast_ended"},{category:"bp",token:603,uri:"skype:?cqg&target=broadcast.layout&ui_entrypoint=cqf",id:"broadcast_layout"},{category:"bp",token:604,uri:"skype:?cqg&target=broadcast.indicators&ui_entrypoint=cqf",id:"broadcast_indicators"},{category:"bp",token:605,uri:"skype:?cqg&target=broadcast.cannot.end&ui_entrypoint=cqf",id:"broadcast_cannot_end"},{category:"ba",token:606,uri:"skype:?cqg&target=broadcast.no.audio&ui_entrypoint=cqf",id:"broadcast_no_audio"},{category:"ba",token:607,uri:"skype:?cqg&target=broadcast.poor.audio&ui_entrypoint=cqf",id:"broadcast_poor_audio"},{category:"be",token:608,uri:"skype:?cqg&target=broadcast.other&ui_entrypoint=cqf",id:"broadcast_other",editLength:100}],O=[{category:"bs",token:801,id:"streaming_audio_nolocal"},{category:"bs",token:802,id:"streaming_audio_has_echo"},{category:"bs",token:803,id:"streaming_audio_sync"},{category:"bs",token:804,id:"streaming_audio_not_natural"},{category:"bs",token:805,id:"streaming_audio_music"},{category:"bs",token:806,id:"streaming_other_audio",editLength:100},{category:"vq",token:807,id:"streaming_novideo"},{category:"vq",token:808,id:"streaming_screenshare_blurry"},{category:"vq",token:809,id:"streaming_video_keep_buffer"},{category:"vq",token:810,id:"streaming_other_video",editLength:100},{category:"bg",token:811,id:"streaming_experience_unexpected_end"},{category:"bg",token:812,id:"streaming_first_join_fail"},{category:"bg",token:813,id:"streaming_join_fail"},{category:"bg",token:814,id:"streaming_experience_load_time"},{category:"bg",token:815,id:"streaming_other",editLength:100},{category:"bc",token:816,id:"streaming_captions_quality",starRating:!0},{category:"bc",token:817,id:"streaming_other_captions",editLength:100}],L=[{category:"emf",token:900,id:"emf_inclusive",starRating:!0},{category:"emf",token:901,id:"more_participation"},{category:"emf",token:902,id:"include_agenda"},{category:"emf",token:903,id:"send_premeeting_reading"},{category:"emf",token:904,id:"time_management"},{category:"emf",token:905,id:"voice_tone"},{category:"emf",token:906,id:"include_required_participants"},{category:"emf",token:907,id:"remote_participant"},{category:"emf",token:908,id:"audio_video_quality"},{category:"emf",token:909,id:"audio_video_reliablity"},{category:"emf",token:910,id:"more_video"},{category:"emf",token:911,id:"emf_other",editLength:100},{category:"emfb",token:912,id:"including_agenda"},{category:"emfb",token:913,id:"define_goals"},{category:"emfb",token:914,id:"define_roles"},{category:"emfb",token:915,id:"provide_preread"},{category:"emfb",token:916,id:"including_everyone_involved"},{category:"emfb",token:917,id:"including_fewer_participants"},{category:"emfd",token:918,id:"more_attendee_participation"},{category:"emfd",token:919,id:"more_attendee_video"},{category:"emfd",token:920,id:"better_audio_video_quality"},{category:"emfd",token:921,id:"better_time_management"},{category:"emfd",token:922,id:"more_inclusive_and_tone"},{category:"emfd",token:923,id:"more_remote_participation"},{category:"emfd",token:924,id:"clearer_articulation_action_items"}];(d=C||(C={})).PosNegPills="pos_neg_pills",d.ThumbPills="thumb_pills",d.PosNegPillsWithScale="pos_neg_pills_with_scale";let U={POS_NEG_PILLS:.1,THUMB_PILLS:.2,POS_NEG_PILLS_WITH_SCALE:.3},B=[{category:"vemfpn",token:v.s.Agenda,id:"agenda",version:0},{category:"vemfpn",token:v.s.Participation,id:"participation",version:0},{category:"vemfpn",token:v.s.FocusedDiscussions,id:"focus",version:0},{category:"vemfpn",token:v.s.NextSteps,id:"next_steps",version:0},{category:"vemfpn",token:v.s.Quorum,id:"quorum",version:0},{category:"vemfpn",token:v.s.MaterialsInAdvance,id:"materials",version:0},{category:"vemfpn",token:v.s.TimeManagement,id:"time_management",version:0},{category:"vemfpn",token:v.s.Inclusive,id:"inclusive",version:0},{category:"vemfpn",token:v.s.Necessity,id:"necessity",version:0}]},915798:function(e,t,i){i.d(t,{P:()=>o});var n=i(261234),a=i(526260),r=i(892891);class o extends a.s{constructor(e,t,i,a,r=!1){super(),this.telemetryService=e,this.timeout=t,this.time=i,this.duration=a,this.useRatingOnly=r,this.qid=n.tG,this.neverExpires=!1,this.type=n.nw.Quality,this.isRateable=!0,this.experience=n.UZ.Unknown,this.questionnaireId=null,this.callQualityFeedbackUxStyle="",this.isActionable=!0,this.scheduleExpiration()}start(){this.timeout.cancel(this.expirationPromise)}get rating(){if(void 0!==this.score)return this.score+1}set rating(e){if(!(0,r.isNumber)(e))throw Error("Invalid argument type: value. Expected numberic value");if(e<1||e>5)throw Error("Invalid argument value: rating. Expected one of [1..5]");if(!this.isActionable)throw Error("Questionnaire is not actionable anymore");this.start(),this.score=e-1,this.isRated=!0,this.onRatingChanged(e)}resolveWithFullRating(){return this.isCQFABTestingControlGroup()}send(){if(!this.isRated&&this.resolveWithFullRating())throw Error("Questionnaire is not rated yet");if(!this.isActionable)throw Error("Questionnaire is not actionable anymore");this.isActionable=!1,this.scheduleCompletion();let e=Object.keys(this.items).map(e=>this.items[e]).reduce((e,t)=>e.concat(t),[]);return this.sendQuestionnaire(n.tH.RANDOM,e,null)}cancel(e=n.tH.CANCEL){let t;if(!this.isActionable)throw Error("Questionnaire is not actionable anymore");this.isActionable=!1,this.isComplete=!0,this.isCancelled=!0,this.timeout.cancel(this.expirationPromise),t=this.isRated?"Token":"Rating";let i=[];this.items&&(i=Object.keys(this.items).map(e=>this.items[e]).reduce((e,t)=>e.concat(t),[])),this.sendQuestionnaire(e,i,t),this.score=null,this.complete()}abandon(){this.isActionable&&(this.isRated?(this.isActionable=!1,this.isComplete=!0,this.sendQuestionnaire(n.tH.RANDOM,[],null),this.complete()):this.cancel(),this.clearPausePromise())}pause(){this.clearPausePromise();let e=this.expirationDatetime-Date.now();this.pauseExpirationPromise=this.timeout.set(()=>{this.abandon()},e)}resume(){this.isResumed=!0,this.clearPausePromise()}removeExpiry(){this.clearPausePromise(),this.timeout.cancel(this.expirationPromise),this.neverExpires=!0}static GetItemTypes(e){return e?Object.keys(e).map(Number).filter(e=>e!==n.yV.Other):[]}static GetIntersectionBetweenClientAndSlimCore(e,t){let i={};return Object.keys(e).map(Number).forEach(n=>{t.has(n)&&(i[n]=e[n].filter(e=>t.get(n).includes(e.token)),i[n]=(0,r.sortBy)(i[n],e=>t.get(n).indexOf(e.token)))}),i}static MapItemCategoryToType(e){switch(e){case"q":case"qe":case"r":return n.yV.Audio;case"pq":return n.yV.Other;case"vq":case"vqe":return n.yV.Video;case"sq":case"sqe":return n.yV.ScreenSharing;case"bp":case"ba":case"be":return n.yV.Broadcast;case"bs":case"bse":return n.yV.AttendeeAudio;case"bg":case"bge":return n.yV.AttendeeGeneral;case"bc":case"bce":return n.yV.AttendeeCaptions;case"sfc":return n.yV.ScreenshareFromChat;case"cc":return n.yV.CallClosedCaptions;case"emf":case"emfb":case"emfd":return n.yV.EffectiveMeeting;case"tqf":return n.yV.Transcript;default:throw Error(`Not supported item category ${e}`)}}onRatingChanged(e){(5===e||this.useRatingOnly)&&this.resolveWithFullRating()&&this.send()}serializeProblemTokens(e){let t=e.filter(e=>e&&!!e.value),i=t.filter(e=>!!e.editLength),a=t.filter(e=>e.starRating),o=t.map(e=>e.token).join(n.Xt),s=i.map(e=>`${e.token}=${this.serializeProblemValue(e.value)}`).join("&"),l=a.map(e=>`${e.token}=${this.serializeRatingValue(e.value)}`).join("&");return`${n.XJ}=${o}&${[s,l].filter(e=>!(0,r.isEmpty)(e)).join("&")}`}createEventPropsForQuestionnaire(e,t,i){let n={...i,call_mos_score_questionary_id:this.qid,call_mos_score:this.score,call_mos_score_tracking_reason:e,call_mos_score_problem_tokens:this.serializeProblemTokens(t),call_mos_score_never_expires:this.neverExpires,feedbackUxStyle:this.callQualityFeedbackUxStyle};return this.experience&&(n.experience=this.experience),n}scheduleExpiration(){this.expirationDatetime=Date.now()+this.time,this.expirationPromise=this.timeout.set(()=>{this.cancel(n.tH.TIMEOUT)},this.time)}scheduleCompletion(){this.timeout.set(()=>{this.isComplete=!0,this.complete()},n.Rr)}clearPausePromise(){this.pauseExpirationPromise&&this.timeout.cancel(this.pauseExpirationPromise)}serializeProblemValue(e){return encodeURIComponent(e.toString()).replace(/'/g,n.gO)}serializeRatingValue(e){return e-1}isCQFABTestingControlGroup(){return(0,r.isEmpty)(this.callQualityFeedbackUxStyle)||this.callQualityFeedbackUxStyle.toLocaleLowerCase().includes("classic")}}},562062:function(e,t,i){i.d(t,{N:()=>h});var n=i(370574),a=i(892891),r=i(575810),o=i(261234),s=i(915798);let l=(e,t,i,n,r,l)=>{let c=o.kM.map(e=>(0,a.assign)({},e));if(e.broadcastMeeting){let e=o.uW.map(e=>(0,a.assign)({},e));c.push(...e)}let d=(0,a.groupBy)(c,e=>s.P.MapItemCategoryToType(e.category));i.isVideoSupported(e.teamsCallType)||delete d[o.yV.Video];let g=(e,t)=>{(0,a.remove)(d[e],e=>(0,a.includes)(t,e.token))};return n.isWeb()&&g(o.yV.ScreenSharing,o.by),i.isBackgroundBlurringAPIV2Enabled()||g(o.yV.Video,o.U8),i.isSystemAudioSupportedForCall(e)||g(o.yV.ScreenSharing,o.uV),i.blockAVOverIPInMeetings()&&(delete d[o.yV.Video],delete d[o.yV.Audio]),t===o.ve.ScreenshareFromChat?(delete d[o.yV.Video],delete d[o.yV.Audio]):t===o.ve.PSTN?(delete d[o.yV.ScreenSharing],delete d[o.yV.Video]):t===o.ve.SfB&&delete d[o.yV.ScreenSharing],r&&l(e)||delete d[o.yV.CallClosedCaptions],d},c=e=>{let t=o.qi.filter(t=>e===o.nw.EffectiveMeeting?"emf"===t.category:"emfb"===t.category||"emfd"===t.category||!0===t.starRating||t.editLength&&t.editLength>0).map(e=>(0,a.assign)({},e));return(0,a.groupBy)(t,e=>s.P.MapItemCategoryToType(e.category))},d=e=>({call_id:e.callId,call_type:g(e.teamsCallType),endpoint_id:e.endpointId,participant_id:e.participantId,[r.gT.categories.isBroadcast]:!!e.broadcastMeeting,[r.gT.categories.isScreenshareFromChat]:!!e.isScreenshareFromChat,call_mode:e.callMode}),g=e=>{switch(e){case n.CallType.P2P:return"P2P";case n.CallType.Conference:return"Conference";default:return"Unknown"}},h={CreateCQFItems:l,CreateEMFItems:c,CreateSlimCoreItems:(e,t,i,n,a,r,d,g)=>{if(!e||e.length<1)return;let h=((e,t)=>{let i=new Map;switch(t){case o.nw.Quality:i.set(o.yV.Audio,[]),i.set(o.yV.Video,[]),i.set(o.yV.ScreenSharing,[]),e.forEach(e=>{e.audio&&e.audio.length>0&&i.set(o.yV.Audio,e.audio),e.video&&e.video.length>0&&i.set(o.yV.Video,e.video),e.screensharing&&e.screensharing.length>0&&i.set(o.yV.ScreenSharing,e.screensharing)});break;case o.nw.EffectiveMeeting:case o.nw.EffectiveMeetingV2:let n=[];e.forEach(e=>{e.emf&&e.emf.length>0&&(n=n.concat(e.emf)),e.emfb&&e.emfb.length>0&&(n=n.concat(e.emfb)),e.emfd&&e.emfd.length>0&&(n=n.concat(e.emfd))}),i.set(o.yV.EffectiveMeeting,n)}return i})(e,t);switch(t){case o.nw.Quality:return s.P.GetIntersectionBetweenClientAndSlimCore(l(i,n,a,r,d,g),h);case o.nw.EffectiveMeeting:case o.nw.EffectiveMeetingV2:return s.P.GetIntersectionBetweenClientAndSlimCore(c(t),h)}},CreateStreamingCQFItems:()=>{let e=o.LI.map(e=>(0,a.assign)({},e));return(0,a.groupBy)(e,e=>s.P.MapItemCategoryToType(e.category))},createEventPropsForQuestionnaireFromCall:d,logAsNotShown:(e,t,i)=>{let n=d(e);n.call_mos_score_tracking_reason=o.tH.NOT_SHOWN;let a={eventName:r.gT.events.calling.callQualityFeedback,props:n};i.sendEvents([a]),t.event(r.gT.events.calling.callQualityFeedback,n)},shuffleArray:function(e){for(let t=e.length-1;t>0;t--){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}}}},945761:function(e,t,i){i.d(t,{T3:()=>s,Wq:()=>o,y3:()=>r});var n=i(892891),a=i(666271);let r="promiseCancelled",o=new class{resolve(e){return Promise.resolve(e)}when(e){return Promise.resolve(e)}reject(e){return Promise.reject(e)}create(e){return new Promise(e)}all(e){if(!e)return Promise.resolve();if((0,n.isArray)(e))return Promise.all(e);let t={};return Promise.all(Object.keys(e).reduce((i,n)=>[...i,e[n].then(e=>t[n]=e)],[])).then(()=>Promise.resolve(t))}allSettled(e){if(!e)return Promise.resolve();let t=e.map(e=>e.then(e=>({state:"fulfilled",value:e}),e=>({state:"rejected",reason:e})));return this.all(t)}createDeferred(){let e=null,t=null,i=new Promise((i,n)=>{e=i,t=n});return{resolve:e,reject:t,promise:i}}toCancellable(e){let t=null,i=new Promise((i,n)=>{t=n,e.then(i).catch(n)});return i.__cancel=()=>t(r),i}cancel(e){"function"==typeof e.__cancel&&e.__cancel()}finalized(e,t){return e.catch(n.noop).then(t).then(()=>e)}toNgPromise(e){return e}};class s{constructor(e,t=o){this.http=e,this.promiseFactory=t}getRequestOptions(e,t,i,n,a){return{headers:t||{},retry:null,reporting:{serviceName:"HttpRequestDispatcherFactory"+(e?`-${e}`:"")},payload:i||null,timeout:n||null,responseType:a}}getAsync(e,t){return this.wrapOperationResponse(this.http.getDetailed(e,this.convertRequestOptions(t)))}postAsync(e,t){return this.wrapOperationResponse(this.http.postDetailed(e,this.convertRequestOptions(t),t.payload))}putAsync(e,t){return this.wrapOperationResponse(this.http.putDetailed(e,this.convertRequestOptions(t),t.payload))}removeAsync(e,t){let i=this.convertRequestOptions(t);if(t.payload&&!Object.keys(i.headers).some(e=>"content-type"===e.toLowerCase()))try{JSON.parse(t.payload),i.headers["Content-Type"]="application/json"}catch(e){}return this.wrapOperationResponse(this.http.deleteDetailed(e,i,t.payload))}canRetry(e){return a.X.isTransientFailure(e)}wrapOperationResponse(e){return new Promise((t,i)=>{e.then(this.getApiResolveCallback(t),this.getApiRejectCallback(i))})}getApiResolveCallback(e){return t=>{e({response:t.object||{status:t.statusCode},request:t.request})}}getApiRejectCallback(e){return t=>{let i,n,a;this.isErrorPayload(t)?(i=t.code,n=t.message):(i=t.errorCode||t.statusCode,n=t.customErrorData||{message:t.errorMessage},a=t.request),e({status:i=i<0?0:i,response:n,request:a})}}isErrorPayload(e){return void 0!==e.codeEnum}convertRequestOptions(e){return{callType:e.reporting.serviceName,headers:e.headers,retries:0,timeout:this.convertTimeout(e.timeout),responseType:e.responseType}}convertTimeout(e){if(e instanceof Promise){let t=this.promiseFactory.createDeferred();return e.then(()=>t.resolve()).catch(e=>t.reject(e)),t.promise}return e}}},684663:function(e,t,i){i.d(t,{v:()=>n});class n{}n.Stores={emergencyLocation:{name:"emergency_location",primaryKeyPath:"networkInfo"},internaldata:{name:"internaldata",primaryKeyPath:"id"}}},668505:function(e,t,i){var n,a;i.d(t,{b:()=>n}),(a=n||(n={}))[a.Islands=1]="Islands",a[a.IslandsWithTempInterop=2]="IslandsWithTempInterop",a[a.IslandsWithVoipDeepLinking=3]="IslandsWithVoipDeepLinking",a[a.SfBOnly=4]="SfBOnly",a[a.SfBWithTeamsCollab=5]="SfBWithTeamsCollab",a[a.SfBWithTeamsCollabAndMeetings=6]="SfBWithTeamsCollabAndMeetings",a[a.TeamsOnly=7]="TeamsOnly",a[a.Legacy=8]="Legacy"},586624:function(e,t,i){var n,a,r,o;i.d(t,{B:()=>a,I:()=>n}),(r=n||(n={}))[r.Manual=0]="Manual",r[r.AppState=1]="AppState",(o=a||(a={}))[o.FailedToReachAppliance=0]="FailedToReachAppliance",o[o.OutgoingCall=1]="OutgoingCall",o[o.FailedOutgoingCall=2]="FailedOutgoingCall",o[o.IncomingCall=3]="IncomingCall",o[o.FailedIncomingCall=4]="FailedIncomingCall",o[o.ApplianceMode=5]="ApplianceMode",o[o.FallbackSucceded=6]="FallbackSucceded",o[o.FallbackFailed=7]="FallbackFailed"},377957:function(e,t,i){i.d(t,{w:()=>r});var n=i(892891);class a{mixTeamsCall(e){e.isTeamsMixed=!0}}class r{constructor(e,t=[],i=()=>{},n=!0){this.inputMixinsList=t,this.onTeamsCallCreated=i,this.mixins=[],this.logger=e.newLogger("TeamsCallService"),n&&this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.mixins=[new a,...this.inputMixinsList]}cleanupOnAppTeardown(e){this.mixins=[],r.nextTeamsCallId=1}getOrCreateTeamsCall(e,t){return!e||e.isTeamsMixed||(e.teamsCallId=t||r.getNextTeamsCallId(),this.mixins.map((t,i)=>{try{return t.mixTeamsCall(e)}catch(e){this.logger.error(`Failed to apply mixins[${i}]: ${e}`)}}).filter(e=>this.isActualInitializer(e)).forEach(e=>{try{e()}catch(e){this.logger.error(`Failed to initialize mixin: ${e}`)}}),this.onTeamsCallCreated(e),this.logger.info(`Assigned teamsCallId ${e.teamsCallId} to call with callId ${e.callId}, suggested teamsCallId: ${t}`)),e}static getNextTeamsCallId(){return r.nextTeamsCallId++}static getTeamsCallIdAsString(e){return String(e)}static parseTeamsCallId(e){return Number(e)||0}static bindMethods(e,t,i,n,a=!1){i.forEach(i=>{if(!a&&void 0!==e[i]&&e[i]){n&&n.error(`Method ${i} already present on the call object`);return}void 0===t[i]?n&&n.error(`Method ${i} not present on the mixin`):e[i]=t[i].bind(t)})}static bindProps(e,t,i,n,a=!1){i.forEach(i=>{if(!a&&void 0!==e[i]){n&&n.error(`Property ${String(i)} already present on the call object`);return}Object.defineProperty(e,i,{get:()=>t[i],set(e){t[i]=e}})})}isActualInitializer(e){return(0,n.isFunction)(e)}}r.nextTeamsCallId=1},698721:function(e,t,i){i.d(t,{m:()=>H});var n,a,r,o,s,l,c,d,g,h,p=i(892891),u=i(370574);(n=l||(l={}))[n.mute=600001]="mute",n[n.unMute=600002]="unMute",n[n.startVideo=600003]="startVideo",n[n.stopVideo=600004]="stopVideo",n[n.hangup=600005]="hangup",n[n.meetingDoesNotExist=403003]="meetingDoesNotExist",n[n.invalidMeetingCode=403004]="invalidMeetingCode",n[n.vendorIdInvalidOrBlank=400017]="vendorIdInvalidOrBlank",n[n.deviceNameBlankOrNull=400018]="deviceNameBlankOrNull",n[n.participantDisplayNameBlankOrNull=400016]="participantDisplayNameBlankOrNull",n[n.selectedCameraNotFound=400100]="selectedCameraNotFound",n[n.selectedSpeakerNotFound=400101]="selectedSpeakerNotFound",n[n.selectedMicrophoneNotFound=400102]="selectedMicrophoneNotFound",n[n.selectedCameraLabelNotFound=400105]="selectedCameraLabelNotFound",n[n.selectedSpeakerLabelNotFound=400106]="selectedSpeakerLabelNotFound",n[n.selectedMicrophoneLabelNotFound=400107]="selectedMicrophoneLabelNotFound",n[n.errorUploadingBrb=400200]="errorUploadingBrb",n[n.unsupportedUserInputAction=400001]="unsupportedUserInputAction",n[n.unableToHandleUserInputAction=400002]="unableToHandleUserInputAction",(a=c||(c={})).mute="Mute request failed",a.unMute="Unmute request failed",a.startVideo="Stop video request failed",a.stopVideo="Start video request failed",a.hangup="Hangup request failed",a.meetingDoesNotExist="Meeting doesnt exist or unable to join currently",a.invalidMeetingCode="Invalid meeting id or passcode",a.vendorIdInvalidOrBlank="Invalid or blank vendor Id",a.deviceNameBlankOrNull="Device name cannot be blank or null",a.participantDisplayNameBlankOrNull="Participant display name cannot be blank or null",a.selectedCameraNotFound="Selected camera not found, switching to default one",a.selectedSpeakerNotFound="Selected speaker not found, switching to default one",a.selectedMicrophoneNotFound="Selected microphone not found, switching to default one",a.selectedCameraLabelNotFound="Selected camera label not found, switching to camera id.",a.selectedSpeakerLabelNotFound="Selected speaker label not found, switching to speaker id.",a.selectedMicrophoneLabelNotFound="Selected microphone label not found, switching to microphone id.",a.errorUploadingBrb="Error uploading the Brb",a.unsupportedUserInputAction="Unsupported user input action",a.unableToHandleUserInputAction="Unable to Handle user input action",(r=d||(d={})).unknown="unknown",r.connecting="connecting",r.lobby="lobby",r.connected="connected",r.disconnecting="disconnecting",r.disconnected="disconnected",(o=g||(g={})).action="action",o.state="state",o.error="error",(s=h||(h={})).muteAudio="muteAudio",s.unmuteAudio="unmuteAudio",s.stopVideo="muteVideo",s.startVideo="unmuteVideo",s.hangup="hangup",s.userInitiatedLogUpload="userInitiatedLogUpload",l.unableToHandleUserInputAction,c.unableToHandleUserInputAction,l.unsupportedUserInputAction,c.unsupportedUserInputAction;let m={code:l.mute,message:c.mute},_={code:l.unMute,message:c.unMute},S={code:l.startVideo,message:c.startVideo},C={code:l.stopVideo,message:c.stopVideo},v={code:l.hangup,message:c.hangup},f={code:l.meetingDoesNotExist,message:c.meetingDoesNotExist},b={code:l.invalidMeetingCode,message:c.invalidMeetingCode},y={code:l.vendorIdInvalidOrBlank,message:c.vendorIdInvalidOrBlank},T={code:l.deviceNameBlankOrNull,message:c.deviceNameBlankOrNull},I={code:l.participantDisplayNameBlankOrNull,message:c.participantDisplayNameBlankOrNull},A={code:l.selectedCameraNotFound,message:c.selectedCameraNotFound},E={code:l.selectedSpeakerNotFound,message:c.selectedSpeakerNotFound},M={code:l.selectedMicrophoneLabelNotFound,message:c.selectedMicrophoneLabelNotFound},P={code:l.selectedCameraLabelNotFound,message:c.selectedCameraLabelNotFound},k={code:l.selectedSpeakerLabelNotFound,message:c.selectedSpeakerLabelNotFound},D={code:l.selectedMicrophoneNotFound,message:c.selectedMicrophoneNotFound},R={code:l.errorUploadingBrb,message:c.errorUploadingBrb},w=e=>!e||!e.trim(),F=(e,t,i)=>{t.warn(`updateMeetingState ${JSON.stringify(i)}`),e.updateMeetingState(i)};var N=i(924975),O=i(826757),L=i(575810),U=i(968316),B=i(634504);let x="thirdPartyRoomService",V=[u.CallState.InLobby,u.CallState.Connected];class H{get hostState(){return this.meetingHost.getHostState()}constructor(e,t,i,n,a,r,o,s,l,c=!0){this.config=e,this.callingService=n,this.callTogglingService=a,this.callTitleService=r,this.telemetryProvider=o,this.brbV2FeedbackService=s,this.deviceManagerService=l,this.userInitiatedLogUploadPromise=void 0,this.actionEvent=e=>{let t=(0,B.Z)();switch(this.logger.info(`[cid=${t}] actionEvent as ${JSON.stringify(e)}`),e.type){case h.muteAudio:case h.unmuteAudio:this.handleChangeAudioStateAction(this.trackedCall,t,e.type===h.muteAudio);break;case h.stopVideo:case h.startVideo:this.handleChangeVideoStateAction(this.trackedCall,t,e.type===h.startVideo);break;case h.hangup:this.handleHangupAction(this.trackedCall);break;case h.userInitiatedLogUpload:this.handleUserInitiatedLogUpload()}};let d=t();this.logger=i.newLogger(x),this.config.mockThirdPartyMeetingRoomApi()&&((e,t)=>{e.hostState={participantDisplayName:"Mock Meeting Room LSQ/13010",vendorId:"MSFT",deviceName:"Teams Mock Room",videoMuted:!1,audioMuted:!1},e.meetingHost={getHostState:()=>e.hostState,updateMeetingState:i=>{void 0!==i.audioMuted&&(e.hostState.audioMuted=i.audioMuted),void 0!==i.videoMuted&&(e.hostState.videoMuted=i.videoMuted),e.meetingHostState={...e.meetingHostState,...i},t&&t.resolve()},addEventListener:(t,i)=>{e.meetingHostEvents[t]=i},removeEventListener:(t,i)=>{t in e.meetingHostEvents&&delete e.meetingHostEvents[t]}},e.meetingHostEvents={},e.meetingHostState={},e.meetingCapabilities={}})(d),this.meetingHost=d.meetingHost||void 0,this.meetingCapabilities={speakerDeviceLabelSupported:!1,microphoneDeviceLabelSupported:!1,cameraDeviceLabelSupported:!1},c&&this.initializeOnAppLaunchAndReinit("appStart")}initializeOnAppLaunchAndReinit(e){if(this.thirdPartyMeetingsEnabled=this.config.enableThirdPartyMeetingRooms(),this.throttledHandleThirdPartyCallChange=(0,p.throttle)(e=>this.handleThirdPartyCallChange(e),1e3),this.thirdPartyMeetingsEnabled&&this.meetingHost){let e=this.config.supportedThirdPartyMeetingRoomVendors();this.isSupportedVendor=e.includes(this.hostState.vendorId);let t=this.config.supportedDevicesSelectionThirdPartyMeetingRoomVendors();this.devicesSelectionEnabled=t.includes(this.hostState.vendorId);let i=this.config.supported2x2ViewThirdPartyMeetingRoomVendors();this.gridView2x2Enabled=i.includes(this.hostState.vendorId)&&this.config.enable2x2ThirdPartyRoomDevices();let n=!!this.config.enableLabelForDeviceSelection&&this.config.enableLabelForDeviceSelection();this.meetingCapabilities=((e,t,i,n)=>{n.info(`meetingCapabilities ${JSON.stringify(i)}`),n.info(`hostCapabilities ${JSON.stringify(t.hostCapabilities)}`);let a=t.hostCapabilities?.speakerDeviceLabelSupported&&i.speakerDeviceLabelSupported,r={meetingCapabilities:{speakerDeviceLabelSupported:a,cameraDeviceLabelSupported:t.hostCapabilities?.cameraDeviceLabelSupported&&i.cameraDeviceLabelSupported,microphoneDeviceLabelSupported:t.hostCapabilities?.microphoneDeviceLabelSupported&&i.microphoneDeviceLabelSupported}};return n.info(`updateMeetingState ${JSON.stringify(r)}`),e.updateMeetingState(r),r.meetingCapabilities})(this.meetingHost,this.hostState,{speakerDeviceLabelSupported:n,microphoneDeviceLabelSupported:n,cameraDeviceLabelSupported:n},this.logger),((e,t,i,n)=>{if(n.info(`Host state ${JSON.stringify(t)}`),n.info(`Meeting Host ${JSON.stringify(e)}`),!i)return F(e,n,{error:y});w(t.participantDisplayName)&&(F(e,n,{error:I}),w(t.deviceName)?t.participantDisplayName="Unknown Meeting Room":t.participantDisplayName=t.deviceName,n.info(`participantDisplayName now ${t.participantDisplayName}`)),w(t.deviceName)&&F(e,n,{error:T})})(this.meetingHost,this.hostState,this.isSupportedVendor,this.logger)}}cleanupOnAppTeardown(){this.thirdPartyMeetingsEnabled=!1,this.gridView2x2Enabled=!1,this.devicesSelectionEnabled=!1,this.isSupportedVendor=!1,this.meetingTitleFetched=!1,this.meetingTitleSubscription&&this.meetingTitleSubscription.dispose(),this.meetingTitleSubscription=void 0,this.callChangedSubscription&&this.callChangedSubscription.dispose(),this.callChangedSubscription=void 0,this.trackedCall=void 0,this.trackedCallState=void 0,this.removeEventListeners(),this.throttledHandleThirdPartyCallChange.cancel(),this.throttledHandleThirdPartyCallChange=void 0,this.userInitiatedLogUploadPromise=void 0}async init(){return Promise.resolve()}isThirdPartyMeetingRoom(){return!!this.meetingHost&&this.thirdPartyMeetingsEnabled&&this.isSupportedVendor&&!!this.hostState}getHostParticipantName(){if(this.isThirdPartyMeetingRoom())return this.hostState.participantDisplayName}getHostOSName(){let e;return this.isThirdPartyMeetingRoom()&&"ZM"===this.hostState.vendorId&&(this.hostState.correlationId?.startsWith("azr")?e="Android":this.hostState.correlationId?.startsWith("winzr")&&(e="Windows")),e?this.logger.info(`Host Os name is ${e}`):this.logger.info("Host Os name cannot be identified"),e}handleThirdPartyCall(e){let t=(0,U.P)();return this.trackedCall?(this.logger.warn(`trackedCall with id ${this.trackedCall.callId} is already set.`),t.reject()):e.then(e=>{this.trackedCall=e,this.addListenersToHostEvents(),this.callChangedSubscription=e.changed(()=>this.throttledHandleThirdPartyCallChange(e)),t.resolve()}).catch(()=>{this.meetingHost.updateMeetingState({error:f}),t.reject()}),t.promise}getHostPrejoinSettings(){return this.isThirdPartyMeetingRoom()?{withOutgoingAudio:!this.hostState.audioMuted,withOutgoingVideo:!this.hostState.videoMuted,correlationId:this.hostState.correlationId}:(this.logger.info("getHostPrejoinSettings called but not a third-party meeting room, returning null"),null)}getHostVendorId(){return this.isThirdPartyMeetingRoom()?this.hostState.vendorId:void this.logger.info("getHostVendorId called but not a third-party meeting room, returning undefined")}is2x2ThirdPartyMeetingRoom(){return!!this.isThirdPartyMeetingRoom()&&this.gridView2x2Enabled}handleThirdPartyCallChange(e){let t={},i=V.includes(e.state),n=this.callTogglingService.isMuted(e);if(i&&(this.hostState.audioMuted!==n&&(t.audioMuted=n),!e.isVideoOn!==this.hostState.videoMuted&&(t.videoMuted=!e.isVideoOn)),this.logger.info(` Call State received as ${e.state}`),this.trackedCallState!==e.state)switch(this.trackedCallState=e.state,e.state){case u.CallState.Connecting:t.state=d.connecting,this.devicesSelectionEnabled&&(((e,t,i,n,a)=>{let r,o,s,l={},c=(r=t.inputAudioDeviceId,{microphone:r&&`microphone:${r}`,speaker:(o=t.outputAudioDeviceId)&&`speaker:${o}`,camera:(s=t.videoDeviceId)&&`camera:${s}`}),d={cameras:[],speakers:[],microphones:[]};i.areDevicesInitialized()?(d=i.getDevices(),a.info(`Available devices ${JSON.stringify(d)}`)):a.error("No Available devices");let g=n.speakerDeviceLabelSupported,h=n.microphoneDeviceLabelSupported,u=n.cameraDeviceLabelSupported;if(t.selectedMicrophoneDeviceLabel&&h){let i=d.microphones?.find(e=>e.label===t.selectedMicrophoneDeviceLabel);i?l.microphone=i.id:(h=!1,F(e,a,{error:M}))}if(c.microphone&&!h&&(!d.microphones.length||d.microphones?.some(e=>e.id===c.microphone)?l.microphone=c.microphone:F(e,a,{error:D})),t.selectedSpeakerDeviceLabel&&g){let i=d.speakers?.find(e=>e.label===t.selectedSpeakerDeviceLabel);i?l.speaker=i.id:(g=!1,F(e,a,{error:k}))}if(c.speaker&&!g&&(!d.speakers.length||d.speakers?.some(e=>e.id===c.speaker)?l.speaker=c.speaker:F(e,a,{error:E})),t.selectedCameraDeviceLabel&&u){let i=d.cameras?.find(e=>e.label===t.selectedCameraDeviceLabel);i?l.camera=i.id:(u=!1,F(e,a,{error:P}))}c.camera&&!u&&(!d.cameras.length||d.cameras?.some(e=>e.id===c.camera)?l.camera=c.camera:F(e,a,{error:A})),(0,p.isEmpty)(l)?a.error("No device(s) selected."):(a.info(`Selected devices ${JSON.stringify(l)}`),i.selectDevices(l,"thirdPartyRoomService: validateAndSelectDevices"))})(this.meetingHost,this.hostState,this.deviceManagerService,this.meetingCapabilities,this.logger),this.logger.info(`Devices Selected ${JSON.stringify(this.deviceManagerService.getSelectedDevices())}`));break;case u.CallState.InLobby:t.state=d.lobby;break;case u.CallState.Connected:t.state=d.connected,t.clientMeetingId=e.callId,t.audioMuted=n,t.videoMuted=!e.isVideoOn;let a=this.callTitleService.getMeetupTitleForCall(e);a&&(t.name=a),this.subscribeToMeetingTitleUpdate(e);break;case u.CallState.Disconnecting:t.state=d.disconnecting;break;case u.CallState.Disconnected:this.removeEventListeners(),this.pushTelemetryAndBrb().finally(()=>{this.reportTerminatedReason(e);let t={};t.state=d.disconnected,this.logger.info(" updateMeetingState meetingHostState disconnected"),this.meetingHost.updateMeetingState(t)})}(0,p.isEmpty)(t)||(this.logger.info(` updateMeetingState ${JSON.stringify(t)}`),this.meetingHost.updateMeetingState(t))}reportTerminatedReason(e){let t=e.callEndDiagnosticsInfo?.callControllerCode,i=e.callEndDiagnosticsInfo?.callControllerSubCode;O.eU.isMeetingCodeInvalid(t,i)&&this.meetingHost.updateMeetingState({error:b})}pushTelemetryAndBrb(){this.logger.info(" telemetryProvider flush");let e=this.telemetryProvider.flush();return this.userInitiatedLogUploadPromise?this.userInitiatedLogUploadPromise.finally(()=>e):Promise.resolve()}addListenersToHostEvents(){this.meetingHost.addEventListener(g.action,this.actionEvent)}removeEventListeners(){this.meetingHost&&this.meetingHost.removeEventListener(g.action,this.actionEvent)}handleChangeAudioStateAction(e,t,i){this.callTogglingService.toggleMuteAudio(e,N.c3.App,i?N.Jn.Mute:N.Jn.Unmute,{[L.gT.counters.eventNames.context]:"third-party-meeting-room"},t).catch(()=>{let e={error:i?m:_};this.logger.warn(`[cid=${t}] updateMeetingState as ${JSON.stringify(e)}`),this.meetingHost.updateMeetingState(e)})}handleChangeVideoStateAction(e,t,i){this.callTogglingService.toggleVideo(e,x,t,i).catch(()=>{let e={error:i?S:C};this.logger.warn(`[cid=${t}] updateMeetingState as ${JSON.stringify(e)}`),this.meetingHost.updateMeetingState(e)})}handleHangupAction(e){this.callingService.leaveCall(e,x).catch(()=>{let e={error:v};this.logger.warn(` updateMeetingState as ${JSON.stringify(e)}`),this.meetingHost.updateMeetingState(e)})}handleUserInitiatedLogUpload(){this.userInitiatedLogUploadPromise=this.brbV2FeedbackService.sendFeedbackToBrbV2(!1,{category:L.gT.feedback.categories.other,title:`[ThirdPartyMeetingRoom] [${this.hostState.vendorId}] User Initiated Log Upload`,description:`[ThirdPartyMeetingRoom] Host State: ${JSON.stringify(this.hostState)}`,allowScreenshots:!1,includeBackgroundBlurImages:!1,piiSafeLogsOnly:!1}).then(()=>{this.logger.info("User initiated log upload completed.")}).catch(()=>{this.logger.error("User initiated log upload failed."),this.meetingHost.updateMeetingState({error:R})})}subscribeToMeetingTitleUpdate(e){this.callTitleService.getDefaultCallTitle(L.gT.scenarios.calling.context.thirdPartyDeviceMeeting,e,L.gT.dialogs.settings.numberOfNamesInTitle).then(e=>{e&&!this.meetingTitleFetched&&this.meetingHost.updateMeetingState({name:e.titleText})}),this.meetingTitleSubscription=this.callTitleService.subscribeForMeetupTitle(e.teamsCallId,e=>{e&&(this.meetingHost.updateMeetingState({name:e}),this.meetingTitleFetched=!0)})}}},666271:function(e,t,i){i.d(t,{X:()=>n});class n{static isTimeout(e){return e<=0}static statusCodeMatch(e,t){return t.test(e)}static isWebApiSuccess(e){return n.statusCodeMatch(e,n.statusCodes.success)||n.statusCodeMatch(e,n.statusCodes.redirection)}static isTransientFailure(e){return n.isTimeout(e)||n.statusCodeMatch(e,n.statusCodes.serverError)}}n.statusCodes={success:/^(2)\d{2}/,redirection:/^(3)\d{2}/,serverError:/^(5)\d{2}/}},788133:function(e,t,i){i.d(t,{G:()=>f});var n,a,r=i(370574),o=i(892891),s=i(654807),l=i(575810),c=i(945761);class d{constructor(e,t,i){this.utilityService=i,this.nativeTrouter=e.createTrouter(t)}registerListener(e,t){e._remoteTrouterListenerId||(e._remoteTrouterListenerId=this.utilityService.generateUUID());let i={remoteId:e._remoteTrouterListenerId,onTrouterConnected:(t,i)=>{e.onTrouterConnected(t,i)},onTrouterDisconnected:()=>{e.onTrouterDisconnected&&e.onTrouterDisconnected()},onTrouterRequest:(t,i)=>{let n={id:t.id,status:0,headers:{},body:"",send:()=>i({id:n.id,status:n.status,headers:n.headers,body:n.body})};e.onTrouterRequest(t,n)},onTrouterUserActivityStateAccepted:t=>{e.onTrouterUserActivityStateAccepted&&e.onTrouterUserActivityStateAccepted(t)}};return this.nativeTrouter.registerListener2(i,t),!0}getNativeTrouter(){return this.nativeTrouter}unregisterListener(e){return!!e._remoteTrouterListenerId&&(this.nativeTrouter.unregisterListener2(e._remoteTrouterListenerId),e._remoteTrouterListenerId=void 0,!0)}setUserActivityState(e,t){this.nativeTrouter.setUserActivityState(e,t)}setAudienceSubscriptions(e,t){return new Promise((e,t)=>{t("setAudienceSubscriptions is not implemented")})}}var g=i(665405);(n=a||(a={}))[n.INCOMING_LYNC_NGC_CALL=105]="INCOMING_LYNC_NGC_CALL",n[n.INCOMING_SKYPE_NGC_CALL=107]="INCOMING_SKYPE_NGC_CALL",n[n.INCOMING_SKYPE_NGC_GVC_CALL=109]="INCOMING_SKYPE_NGC_GVC_CALL",n[n.INCOMING_SKYPE_NGC_PSTN_CALL=111]="INCOMING_SKYPE_NGC_PSTN_CALL",n[n.STOP_RINGING_SKYPE_NGC_CALL=110]="STOP_RINGING_SKYPE_NGC_CALL";class h{constructor(e,t,i){this.messageHandler=e,this.callingSupportService=i,this.logger=t.newLogger("MessageHandlerDecorator")}handleMessage(e){return h.isOneOnOneIncomingCallMessage(e)&&!this.callingSupportService.isOneOnOneCallingEnabled()?void this.logger.warn(`One to one calling not supported. Ignoring incoming event of type ${a[e.eventId]}`):this.messageHandler.handleMessage(e)}static isOneOnOneIncomingCallMessage(e){switch(e.eventId){case a.INCOMING_LYNC_NGC_CALL:case a.INCOMING_SKYPE_NGC_CALL:case a.INCOMING_SKYPE_NGC_PSTN_CALL:return!0;default:return!1}}}var p=i(352320),u=i(817218),m=i(395250),_=i(308113),S=i(826714),C=i(826757),v=i(163349);class f{constructor(...e){this.eventHandlers={},this.promiseFactory=c.Wq,this.isTrouterPromiseResolved=!1,this._isSlimcoreInitialized=!1,this.pendingUserActivityState=[r.UserActivityState.Unknown,""],this.slimcoreInstance=null,this.trouterToAuthTokenTypeMap={skype:u.Zw.Skype,aad:u.Zw.AAD,cae:u.Zw.CAE},this.trouterUrl=()=>"";let t=(0,_.T)(e=>({config:e[0],diagnosticsService:e[1],loggingService:e[2],authenticationService:e[3],eventingService:e[4],appStateService:e[5],telemetryService:e[6],callingSupportService:e[7],platformDetectService:e[8],utilityService:e[9],desktopUtilityService:e[10],geoRoutingService:e[11],eventHandlers:{},promiseFactory:e[12],initializeInCtor:e[13]}),e);t.eventHandlers=t.eventHandlers||{},t.promiseFactory=t.promiseFactory||c.Wq,t.initializeInCtor=!1!==t.initializeInCtor,this.config=t.config,this.diagnosticsService=t.diagnosticsService,this.loggingService=t.loggingService,this.authenticationService=t.authenticationService,this.eventingService=t.eventingService,this.appStateService=t.appStateService,this.telemetryService=t.telemetryService,this.callingSupportService=t.callingSupportService,this.platformDetectService=t.platformDetectService,this.utilityService=t.utilityService,this.desktopUtilityService=t.desktopUtilityService,this.geoRoutingService=t.geoRoutingService,this.eventHandlers=t.eventHandlers,this.promiseFactory=t.promiseFactory,this.trouterStateSubject=new S.X(r.TrouterStateFromSkypeTsTrouter.Unknown),this.logger=this.loggingService.newLogger("TrouterService"),this.trouterAuthSubject$=new S.X({body:void 0}),t.initializeInCtor&&this.initializeOnAppLaunchAndReinit()}async disposeService(e){return new Promise(t=>{this.cleanupOnAppTeardown(e.reason),t()})}initializeOnAppLaunchAndReinit(e){this.enableCheckConnection=this.config.teamsSettings.enablePluginlessCheckConnection(),this.resetTrouterUrlPromise(),this.listeners={},this.diagInfo={connected:!1,lastConnected:void 0,lastDisconnected:void 0,baseEndpointUrl:void 0},this.legacyApiAvailable=this.promiseFactory.create((e,t)=>{this.legacyApiAvailableResolve=e,this.legacyApiAvailableReject=t}),this.desktopUtilityService.isPluginless()?(this.endpointId=this.config.getRegistrationId(),this.endpointId?this.logger.info(`Using external JS endpoint ID: ${this.endpointId}`):(this.endpointId=this.utilityService.generateUUID(),this.logger.warn(`Using generated JS endpoint ID: ${this.endpointId}`))):(this.trouterConnectionScenario=this.loggingService.newScenario(m.RG.TrouterServiceInit,null,null,l.gT.timeInMiliseconds.fiveMinutes),this.endpointIdScenario=this.loggingService.newScenario(m.RG.TrouterServiceEndpointId),this.endpointId=this.config.cachedDesktopEndpointId(),this.endpointId?(this.endpointIdScenario.appendEventData({[l.gT.counters.eventNames.endpointType]:"slimcore-cached",[l.gT.counters.eventNames.endpointId]:this.endpointId}),this.logger.info(`Using cached SlimCore endpoint ID: ${this.endpointId}`)):(this.endpointId=this.utilityService.generateUUID(),this.endpointIdScenario.appendEventData({[l.gT.counters.eventNames.endpointType]:"slimcore-generated",[l.gT.counters.eventNames.endpointId]:this.endpointId}),this.logger.warn(`Cached SlimCore endpoint ID not available, using a temporary generated one: ${this.endpointId}`)),this.slimcoreTrouterState=r.TrouterStateFromSkypeTsTrouter.Unknown);let t=this;this.registerListener({onTrouterConnected(e,i){t.desktopUtilityService.isPluginless()||(t.slimcoreTrouterState=r.TrouterStateFromSkypeTsTrouter.Connected,t.trouterConnectionScenario=t.getTrouterConnectScenario(),t.trouterConnectionScenario.mark(p.cf.getSubscriptionStateAsString(r.TrouterStateFromSkypeTsTrouter.Connected)),t.trouterConnectionScenario.stop({lastDisconnected:t.diagInfo.lastDisconnected,[l.gT.categories.trouterUrls]:i.baseEndpointUrl}),t.trouterConnectionScenario=null),t.logger.info(`Trouter is now CONNECTED, base endpoint URL: ${i.baseEndpointUrl} and endpointUrl: ${e}`),t.diagInfo.connected=!0,t.diagInfo.lastConnected=new Date,t.diagInfo.baseEndpointUrl=i.baseEndpointUrl,t.trouterStateSubject.next(r.TrouterStateFromSkypeTsTrouter.Connected),t.desktopUtilityService.isPluginless()&&t.config.isTflUser&&t.handlePluginlessGGRegistration(i)},onTrouterDisconnected(){t.desktopUtilityService.isPluginless()||(t.slimcoreTrouterState=r.TrouterStateFromSkypeTsTrouter.Disconnected,t.trouterConnectionScenario=t.loggingService.newScenario(m.RG.TrouterClientReconnect),t.trouterConnectionScenario.mark(p.cf.getSubscriptionStateAsString(r.TrouterStateFromSkypeTsTrouter.Disconnected),{lastConnected:t.diagInfo.lastConnected})),t.logger.info("Trouter is now DISCONNECTED"),t.diagInfo.connected=!1,t.diagInfo.lastDisconnected=new Date,t.trouterStateSubject.next(r.TrouterStateFromSkypeTsTrouter.Disconnected)},onTrouterRequest(e,t){t.status=200,t.send()}},"/TeamsTrouterService/"),this.config.enableTokenRevocationHandlingForCMDTrouter&&(this.logger.info(`Registering the listener with path ${this.config.trouterAuthUrlSuffix||"/auth"}`),this.registerListener({onTrouterConnected(e,i){t.logger.info(`onTrouterConnected invoked for endpointUrl=${e}, baseEndpointUrl=${i.baseEndpointUrl}`)},onTrouterDisconnected(){t.logger.info("onTrouterDisconnected invoked for /auth listener")},onTrouterRequest(e,i){t.logger.info(`onTrouterRequest invoked for requestId=${e.id}, path=${e.path}`),t.trouterAuthSubject$.next({body:e.body}),i&&(i.status=200,i.send())}},this.config.trouterAuthUrlSuffix||"/auth"),this.subscribeToTokenRevokedSubscription())}cleanupOnAppTeardown(e){this.stop("cleanupOnAppTeardown"),this.trouterUrl=()=>"",this.registrarUrl=void 0,this.legacyApiAvailable=void 0,this.trouterInstance=void 0,this.trouterUrlDeferred=void 0,this.isTrouterPromiseResolved=!1,this.trouterConfig=void 0,this.trouterServiceSettings=void 0,this.tsTrouterVersion=void 0,this.unsubscribeToAppState=null,this.trouterConnectionScenario=void 0,this.throttledCheckConnection=void 0,this.enableCheckConnection=!1,this.trouterClient=void 0,this.listeners={},this.slimcoreDeferredInit=void 0,this._isSlimcoreInitialized=!1,this.diagInfo={},this.endpointId=null,this.endpointIdScenario=null,this.userActivityReportingSupported=!1,this.userActivityCallbackSupported=!1,this.pendingUserActivityState=[r.UserActivityState.Unknown,""],this.legacyApiAvailableResolve=void 0,this.legacyApiAvailableReject=void 0,this.slimcoreTrouterState=void 0,this.slimcoreInstance=null,this.trouterAuthSubscription?.unsubscribe()}get slimcoreVersionThreshold(){return this.config.teamsSettings.thresholdSlimcoreVersionForTrouterSupport()}get isSlimcoreInitialized(){return this._isSlimcoreInitialized}get isTrouterConnected(){return"Connected"===this.clientState()}observeState(){return this.trouterStateSubject.asObservable()}start(){if(this.desktopUtilityService.isPluginless())return this.logger.info("Starting TrouterService with TsTrouter"),this.trouterConnectionScenario=this.loggingService.newScenario(m.RG.TrouterServiceInit,void 0,void 0,l.gT.timeInMiliseconds.fiveMinutes),this.config.ensureRegistrarAndTrouterLoaded().then(()=>(this.initTsTrouter(),this.trouterConnectionScenario?.mark(m.ck.TrouterServiceInitComplete),this.startTsTrouter({environment:this.config.environment.type,sessionId:this.loggingService.sessionId}).then(()=>{this.legacyApiAvailableResolve()}))).catch(e=>{let t=`Failed to init TsTrouter: ${this.utilityService.getErrorLoggingString(e)}`;this.logger.error(t),this.trouterConnectionScenario.fail({error:t}),this.legacyApiAvailableReject(e)}),this.legacyApiAvailable;{this.logger.info("Starting TrouterService with SlimCore wrapper"),this.slimcoreDeferredInit=this.promiseFactory.createDeferred();let e=this.slimcoreDeferredInit.promise;return e.then(()=>{this._isSlimcoreInitialized=!0}).catch(()=>{this._isSlimcoreInitialized=!1}),e}}async startTsTrouter(e){this.trouterConfig=await this.buildTrouterConfigWith(e),this.config.isTflUser&&(this.goldenGateRegistrar=v.createRegistrarClient(new g.A("ggregistrar",this.logger),async e=>({tokenType:"skype",token:await this.skypeTokenProvider(e.needFresh)}),{registrarUrl:this.registrarUrl,registrationId:`${this.trouterConfig.trouterSettings.registrationId}-gg`,usingLegacyTokenApi:!1,requestTimeoutMs:1e4,initialRetryDelayMs:1e3,maxRetryDelayMs:3e4}));let t=e=>{this.diagnosticsService.setTrouterSubscriptionStatus(s.AnB.Connected,e),this.isTrouterPromiseResolved&&(this.loggingService.event(l.gT.scenarios.calling.trouterService.doubleConnect),this.resetTrouterUrlPromise()),this.isTrouterPromiseResolved=!0,this.trouterUrlDeferred.resolve(e),this.trouterUrl(e);let t={[l.gT.categories.trouterUrls]:e};this.trouterConnectionScenario?(this.trouterConnectionScenario.stop(t),this.trouterConnectionScenario=null):this.loggingService.event(l.gT.scenarios.calling.trouterService.urlAvailable,t),this.eventHandlers.onConnected?.(e)},i=()=>{this.resetTrouterUrlPromise(),this.diagnosticsService.setTrouterSubscriptionStatus(s.AnB.Disconnected),this.eventHandlers.onDisconnected?.()},n=(e,n)=>{switch(this.trouterConnectionScenario=this.getTrouterConnectScenario(),this.trouterConnectionScenario?this.trouterConnectionScenario.mark(p.cf.getSubscriptionStateAsString(e)):e===r.TrouterStateFromSkypeTsTrouter.Disconnected||e===r.TrouterStateFromSkypeTsTrouter.Switching?(this.trouterConnectionScenario=this.loggingService.newScenario(m.RG.TrouterClientReconnect),this.trouterConnectionScenario.mark(p.cf.getSubscriptionStateAsString(e))):this.loggingService.event(l.gT.scenarios.calling.trouterService.stateChange,{[l.gT.categories.trouterState]:p.cf.getSubscriptionStateAsString(e)}),e){case r.TrouterStateFromSkypeTsTrouter.Unknown:break;case r.TrouterStateFromSkypeTsTrouter.Connected:t(n);break;case r.TrouterStateFromSkypeTsTrouter.Switching:case r.TrouterStateFromSkypeTsTrouter.Disconnected:i();break;default:this.logger.error(`Invalid trouter state: ${e}`)}};this.diagnosticsService.setTrouterSubscriptionStatus(s.AnB.Disconnected);try{this.trouterConnectionScenario?this.trouterConnectionScenario.mark(m.ck.TrouterServiceStart):this.loggingService.event(l.gT.scenarios.calling.trouterService.start),this.logger.info("Starting trouter with the config: {0}",JSON.stringify(this.trouterConfig)),this.trouterInstance.start(this.trouterConfig),this.diagnosticsService.setTrouterSubscriptionStatus(s.AnB.Connecting),this.trouterInstance.onStateChanged(n),this.subscribeToGlobalState()}catch(e){throw this.trouterConnectionScenario&&(this.trouterConnectionScenario.fail({[l.gT.counters.eventNames.reason]:p.cf.getErrorMessage(e)}),this.trouterConnectionScenario=null),this.logger.error("failed starting trouter: {0}",p.cf.getErrorMessage(e)),e}this.checkConnectionWithTimer()}state(){return this.trouterInstance&&this.trouterInstance.state()||r.TrouterStateFromSkypeTsTrouter.Unknown}initTsTrouter(){this.trouterUrl=this.buildObservableTrouterUrl(),this.trouterServiceSettings=this.config.settings;let e=this.getTrouterFactory();this.trouterInstance=e.createTrouterService(new g.A("trouter",this.logger)),this.tsTrouterVersion=e.getTrouterServiceVersion(),this.trouterClient=this.trouterInstance,this.userActivityReportingSupported=!0,this.userActivityCallbackSupported=!0,this.initTrouterClientCommon()}initSlimCoreTrouter(e,t){if(this.logger.info("initSlimCoreTrouter() called"),!this.slimcoreDeferredInit&&this.slimcoreInstance===e){this._isSlimcoreInitialized=!0,this.logger.warn("Trouter client already initialized or requesting again for the same slimcore engine instance. Verify initSlimCoreTrouter() flow");return}let i=this.config.getSlimCoreVersion();if(this.utilityService.compareVersions(this.slimcoreVersionThreshold,i)>0){this.logger.error(`SlimCore version ${i} is lower than or equal to, ${this.slimcoreVersionThreshold} Trouter support disabled`),this.slimcoreDeferredInit?.reject(),this.slimcoreDeferredInit=void 0;return}this.userActivityReportingSupported=this.utilityService.compareVersions(i,"2020.38.10")>=0,this.userActivityCallbackSupported=this.utilityService.compareVersions(i,"2021.13.1")>=0;let n=e.getRegistrationId();n===this.endpointId?(this.endpointIdScenario?.stop(),this.logger.info(`SlimCore endpoint ID verified as expected: ${this.endpointId}`)):(this.logger.warn(`SlimCore endpoint ID updated: ${this.endpointId} -> ${n}`),this.endpointIdScenario?.fail({[l.gT.counters.eventNames.correlationId]:n}),this.endpointId=n,this.config.events&&this.config.events.onSlimcoreEndpointIdReady&&this.config.events.onSlimcoreEndpointIdReady(this.endpointId)),this.endpointIdScenario=null,this.slimcoreInstance=e,this.trouterClient=new d(e,t,this.utilityService),this.initTrouterClientCommon(),this.slimcoreDeferredInit?.resolve(),this.slimcoreDeferredInit=void 0}getNativeTrouter(){if(this.trouterClient&&this.trouterClient.getNativeTrouter)return this.trouterClient.getNativeTrouter()}stop(e){if(this.logger.info(`Stopping/unregistering all listeners with reason "${e}"`),this.trouterClient){for(let e of Object.keys(this.listeners)){let t=this.listeners[e];this.trouterClient.unregisterListener(t)}this.trouterClient=void 0,this.slimcoreInstance=null}if(this.listeners={},this.desktopUtilityService.isPluginless()){let t={[l.gT.counters.eventNames.reason]:e||""};this.trouterConnectionScenario?(this.trouterConnectionScenario.cancel(t),this.trouterConnectionScenario=null):this.loggingService.event(l.gT.scenarios.calling.trouterService.stop,t),this.unsubscribeFromGlobalState(),this.diagnosticsService.setTrouterSubscriptionStatus(s.AnB.Disconnected),this.trouterInstance&&(this.trouterInstance.onStateChanged(void 0),this.trouterInstance.stop()),this.trouterUrlDeferred.reject("service stopped"),this.resetTrouterUrlPromise(!0)}else this.slimcoreDeferredInit&&(this.slimcoreDeferredInit.reject(),this.slimcoreDeferredInit=void 0)}registerMessageHandler(e){this.trouterInstance.registerMessageHandler(new h(e,this.loggingService,this.callingSupportService))}clearMessageHandlers(){this.trouterInstance.clearMessageHandlers()}checkConnection(e){this.throttledCheckConnection(e)}clientState(){let e=r.TrouterStateFromSkypeTsTrouter.Unknown;return this.desktopUtilityService.isPluginless()&&this.trouterInstance?e=this.trouterInstance.state():this.desktopUtilityService.isPluginless()||(e=this.slimcoreTrouterState),p.cf.getSubscriptionStateAsString(e)}get trouterUrlGetter(){return{trouterUrl:this.trouterUrl,getTrouterUrlAsync:()=>{let e=this.trouterUrlDeferred.promise;return this.loggingService.event(l.gT.scenarios.calling.trouterService.trouterUrlRequest,{[l.gT.categories.status]:this.promiseStatus(e),[l.gT.categories.trouterUrls]:this.trouterUrl()}),e}}}getTsTrouterVersion(){return this.tsTrouterVersion}resendRegistration(e){try{this.trouterInstance.resendRegistration?(this.logger.info("Calling resendRegistration"),e.mark(m.ck.InvokingResendRegistration),this.trouterInstance.resendRegistration(),e.stop()):(this.logger.info("resendRegistration is not available"),e.incomplete({reasonCMD:l.gT.scenarios.calling.skypeTokenRevocationSteps.resendRegistrationNotAvailable}))}catch(t){this.logger.error(`resendRegistration failed. Error: ${t}`),e.fail({error:this.utilityService.getErrorLoggingString(t),reasonCMD:l.gT.scenarios.calling.callingApiFailure})}}registerListener(e,t){let i=this.trouterClient?this.trouterClient.registerListener(e,t):!this.listeners[t];return i&&(this.listeners[t]=e),i}unregisterListener(e){let t=!!this.trouterClient&&this.trouterClient.unregisterListener(e),i=[];for(let t of Object.keys(this.listeners))this.listeners[t]===e&&i.push(t);if(0===i.length)return t;for(let e of i)delete this.listeners[e];return!0}getDiagInfo(){return this.diagInfo}getEndpointId(){return this.endpointId}isUserActivityReportingSupported(){return this.userActivityReportingSupported}isUserActivityCallbackSupported(){return this.userActivityCallbackSupported}setUserActivityState(e,t){this.trouterClient&&this.userActivityReportingSupported?this.trouterClient.setUserActivityState(e,t):this.pendingUserActivityState=[e,t]}setAudienceSubscriptions(e,t){return this.trouterClient?this.trouterClient.setAudienceSubscriptions(e,t):this.promiseFactory.reject("Trouter client not available")}buildObservableTrouterUrl(){let e=[],t=t=>{e.push(t)};t.off=t=>{(0,o.remove)(e,e=>e===t)},t.notifyAll=t=>{e.forEach(e=>{e(t)})};let i="",n=e=>{if(!e)return i;i!==e&&(i=e,t.notifyAll(e))};return n.changed=t,n}initTrouterClientCommon(){for(let e of Object.keys(this.listeners))this.trouterClient.registerListener(this.listeners[e],e)||this.logger.error(`Could not register Trouter listener for '${e}'`);this.pendingUserActivityState[0]!==r.UserActivityState.Unknown&&this.userActivityReportingSupported&&(this.trouterClient.setUserActivityState(this.pendingUserActivityState[0],this.pendingUserActivityState[1]),this.pendingUserActivityState=[r.UserActivityState.Unknown,""])}getTrouterFactory(){return this.config.getTrouterFactory()}getCurrentRoutingTable(){return this.geoRoutingService.getCurrentRoutingTableAsync?this.geoRoutingService.getCurrentRoutingTableAsync():this.promiseFactory.resolve(this.geoRoutingService.getCurrentRoutingTable())}async buildTrouterConfigWith(e){let t=this.config.notificationStack,i=t.incomingCalls.webRegistrarTtlInSeconds,n=i*l.gT.timeInMiliseconds.second-t.incomingCalls.reregistrationTimeBeforeEndOfTtlInMs,a=this.config.teamsSettings.enableDesktopUtilityPlatformId()||this.desktopUtilityService.isVDI(),r=a?this.desktopUtilityService.getClientVersionForPluginlessStack():this.config.environment.clientVersion,s=a?r:this.config.teamsSettings.clientVersion(),c=await this.getCurrentRoutingTable(),d=c&&c.calling_trouterUrl||this.config.teamsSettings.trouterServiceUrl();d=d.replace(/\/v3\/c$/,"/v4/a");let g=c&&c.calling_registrarUrl||this.config.registrarServiceUrl;this.registrarUrl=g;let h={trouterSettings:{registrationId:this.endpointId,registrarServiceUrl:g,registrarTtlInSeconds:i,maxRegistrationTimeInMs:i*l.gT.timeInMiliseconds.second,registrarRefreshTimeoutInMs:n,pnhAppId:t.incomingCalls.pnhAppId,pnhTemplate:t.incomingCalls.pnhTemplate,pnhContext:t.incomingCalls.pnhContext,platform:this.platformDetectService.getBrowser(),platformUIVersion:r,trouterServiceUrl:d,version:s,trouterConnectTimeoutInMs:t.incomingCalls.trouterConnectTimeoutInMs,productName:t.productName,sessionId:e.sessionId,environment:e.environment,incallModeTimeoutMs:0},telemetryConfig:{eventLogger:this.telemetryService.getTrouterAdapter(),settings:(0,o.assign)({},this.config.telemetry)}};return this.config.teamsSettings.enableSTMEnforcementForTsTrouter()?(this.logger.info("Skype token migration is enabled for Trouter calling stack"),{...h,authTokenProvider:this.authTokenProvider.bind(this)}):{...h,skypeTokenProvider:this.skypeTokenProvider.bind(this)}}skypeTokenProvider(e){return this.authenticationService.getSkypeToken(e).catch(e=>{let t=p.cf.getErrorMessage(e,this.logger,["code"]);return e.data&&(t=p.cf.getErrorMessage(e.data,this.logger,["errorCode"])),e.data&&this.config.isBlockingLicenseAuthError(e.data.errorCode)&&this.stop(`Skype token license error: ${t}`),this.logger.error(`Skype token provider failed: ${t}`),this.promiseFactory.reject(e)})}async authTokenProvider(e){let t,i=e.supportedTokenTypes.map(e=>this.trouterToAuthTokenTypeMap[e]),n=await this.authenticationService.getSupportedToken(i,this.utilityService.generateUUID(),u.io.TrouterCallingWeb,e.wwwAuthenticateHeader,e.needFresh);switch(this.supportedTokenType=n.type,n.type){case r.TokenType.Aad:t="aad";break;case r.TokenType.Cae:t="cae";break;default:t="skype"}return{token:n.token,tokenType:t}}checkConnectionWithTimer(){let e=this.trouterServiceSettings.checkConnectionWithTimer,t=e?(0,o.debounce)(e=>this.throttledCheckConnection(e),this.trouterServiceSettings.checkConnectionIntervalMaxInMs):e=>this.throttledCheckConnection(e);this.throttledCheckConnection=(0,o.throttle)(i=>{if(!this.enableCheckConnection)return;let n=p.cf.getSubscriptionStateAsString(this.state()),a=this.clientState();this.trouterInstance.checkConnection(),e&&t("timer");let r=p.cf.getSubscriptionStateAsString(this.state()),o=this.clientState();this.loggingService.event(l.gT.scenarios.calling.trouterService.checkConnection,{[l.gT.counters.eventNames.reason]:i||"",[l.gT.categories.trouterState]:`${n} -> ${r}`,[l.gT.categories.trouterClientState]:`${a} -> ${o}`})},this.trouterServiceSettings.checkConnectionIntervalMinInMs),e&&t("init")}promiseStatus(e){return e?(e.then(t=>(e.isResolved=!0,t),t=>{throw e.rejected=!0,t}),e.isResolved)?"resolved":e.isResolved?"rejected":"pending":"unavailable"}resetTrouterUrlPromise(e=!1){this.trouterUrlDeferred&&this.trouterUrlDeferred.reject("trouterUrl reset"),this.trouterUrlDeferred=this.promiseFactory.createDeferred(),e?this.trouterUrlDeferred.reject("disabled"):this.isTrouterPromiseResolved=!1}subscribeToGlobalState(){if(this.unsubscribeToAppState)return void this.logger.error("Already subscribed to appState");let e=this.trouterServiceSettings;if(e.checkConnectionWhenOnline||e.checkConnectionWhenActive){let t=this.appStateService.isOnline,i=this.appStateService.isActive;this.unsubscribeToAppState=this.eventingService.registerHandlerForExternalEvent(l.gT.events.appState.changed,()=>{(e.checkConnectionWhenActive&&!i&&this.appStateService.isActive||e.checkConnectionWhenOnline&&!t&&this.appStateService.isOnline)&&this.checkConnection(l.gT.events.appState.changed),t=this.appStateService.isOnline,i=this.appStateService.isActive})}}unsubscribeFromGlobalState(){this.unsubscribeToAppState&&(this.unsubscribeToAppState(),this.unsubscribeToAppState=null)}getTrouterConnectScenario(){let e=this.loggingService.findScenario(m.RG.TrouterServiceInit)||this.loggingService.findScenario(m.RG.TrouterClientReconnect);return e||(this.logger.info("No active telemetry scenario found for Trouter connection"),(e=this.loggingService.newScenario(m.RG.TrouterClientReconnect)).appendEventData({message:"no active scenario present"})),e}subscribeToTokenRevokedSubscription(){let e=this.trouterAuthSubject$.asObservable();this.logger.info("Subscribing to token revocation events from Trouter"),this.trouterAuthSubscription=e.subscribe({next:async e=>{if(!e||!e.body)return;let t={context:"revocationEventFromTrouter",endpointId:this.endpointId,reason:"Token revocation event"},i=this.loggingService.newScenario(m.RG.SkypeTokenRevocation);i.appendEventData(t);let n=()=>{this.logger.infoToTelemetry?.(`Calling resendRegistration using event: tokenRefreshedAfterRevocation. Endpoint id: ${this.endpointId}`,"cmd_trouter_resending_registration_on_token_revocation",t,!0),i.mark(m.ck.ResendRegistrationEventInvoked),this.eventingService.emit(l.gT.events.skypeAuth.tokenRefreshedAfterRevocation)},a=C.eU.safeJsonParse(e.body,{},e=>{this.logger.errorToTelemetry?.(`Error parsing request payload from Token revocation event. Endpoint id: ${this.endpointId}, error: ${this.utilityService.getErrorLoggingString(e)}`,"cmd_trouter_resending_registration_on_token_revocation",t,!0)}),o=this.authenticationService.extractClaimsFromResponseHeader?.(a.claimsChallenge);if(!o){this.logger.errorToTelemetry?.(`Unable to refresh token due to missing claim in payload. Endpoint id: ${this.endpointId}`,"cmd_trouter_resending_registration_on_token_revocation",t,!0),i.mark(m.ck.ClaimMissing),n();return}i.mark(m.ck.ClaimChallengeFound);let s=!1;try{let e=this.desktopUtilityService.isPluginless(),n=this.config.teamsSettings.enableSTMEnforcementForTsTrouter()&&e,l=this.config.teamsSettings.enableGetAuthTokens()&&!e;if(!this.config.teamsSettings.disableObserveResourceTokenState()&&(n||l)){let e=this.utilityService.generateUUID();this.logger.infoToTelemetry?.(`Received IC3 GW token revoked event: correlationId: ${e}. Endpoint id: ${this.endpointId}`,"cmd_trouter_resending_registration_on_token_revocation",t,!0);let i=await this.authenticationService.getSupportedToken([u.Zw.AAD,u.Zw.CAE],e,u.io.TrouterCallingWeb,this.supportedTokenType===r.TokenType.Aad?void 0:a.claimsChallenge,!1);i.type===r.TokenType.Aad&&(this.logger.infoToTelemetry?.(`Force renew AAD token: ${e}. Endpoint id: ${this.endpointId}`,"cmd_trouter_resending_registration_on_token_revocation",t,!0),await this.authenticationService.getSupportedToken([u.Zw.AAD,u.Zw.CAE],e,u.io.TrouterCallingWeb,void 0,!0,i.token)),this.supportedTokenType=i.type}else this.logger.infoToTelemetry?.(`Received Skype token revoked event. Refreshing token. Endpoint id: ${this.endpointId}`,"cmd_trouter_resending_registration_on_token_revocation",t,!0),await this.authenticationService.validateToken?.(o);i.mark(m.ck.TokenRefreshSuccessful),s=!0}catch(e){this.logger.errorToTelemetry?.(`Error when refreshing token as a result of token revocation, Endpoint id: ${this.endpointId}, error: ${this.utilityService.getErrorLoggingString(e)}`,"cmd_trouter_resending_registration_on_token_revocation",t,!0),i.mark(m.ck.TokenRefreshFailed),"InteractionRequired"===e.errorCode?i.incomplete({error:e.errorCode,correlationId:e.correlationId}):i.fail({error:this.utilityService.getErrorLoggingString(e),correlationId:e.correlationId})}s&&n()},error:e=>{this.logger.errorToTelemetry?.(`authToken revoked subscription error: ${e?.message}`,"cmd_trouter_resending_registration_on_token_revocation",void 0,!0)}})}handlePluginlessGGRegistration(e){if(!this.config.enableGoldenGateDualRegistration()){this.logger.info("Tearing down Pluginless GG registration"),this.goldenGateRegistrar?.unregister();return}if(!this.trouterConfig)return void this.logger.error("Cannot setup Pluginless GG registration, trouterConfig is undefined or null");if(!this.trouterConfig.trouterSettings)return void this.logger.error("Cannot setup Pluginless GG registration, trouterSettings is undefined or null");let t=this.trouterConfig.trouterSettings;if(!t.pnhTemplate)return void this.logger.error("Cannot setup Pluginless GG registration, required paramater pnhTemplate is undefined or null");this.logger.info("Setting up Pluginless GG registration"),this.goldenGateRegistrar?.register({appId:t.pnhAppId??"",templateKey:t.pnhTemplate??"",platform:t.platform??"",platformUIVersion:t.platformUIVersion??"",languageId:"",aesKey:"",productContext:""},{TROUTER:[{context:t.pnhContext??"",path:e.baseEndpointUrl,ttl:Math.min(e.connectionTtlSec,3600)}]}).then(()=>{this.logger.info(`Pluginless GG registration successfully setup with AppId: ${t.pnhAppId}, TemplateKey: ${t.pnhTemplate}, Platform: ${t.platform}, PlatformUIVersion: ${t.platformUIVersion}, context: ${t.pnhContext}`)}).catch(e=>{this.logger.error(`Pluginless GG registration failed: ${e.message}`)})}}},679027:function(e,t,i){i.d(t,{_:()=>k});var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C,v,f,b,y=i(370574),T=i(892891),I=i(575810),A=i(130736);(n=h||(h={}))[n.None=0]="None",n[n.Organizer=1]="Organizer",n[n.Tentative=2]="Tentative",n[n.Accepted=3]="Accepted",n[n.Declined=4]="Declined",n[n.NotResponded=5]="NotResponded",(a=p||(p={}))[a.Required=0]="Required",a[a.Optional=1]="Optional",a[a.Resource=2]="Resource",a[a.Organizer=3]="Organizer",(r=u||(u={})).StreamGroup="StreamGroup",r.SecurityGroup="SecurityGroup",(m||(m={})).Admin="Admin",(o=_||(_={}))[o.Free=0]="Free",o[o.Tentative=1]="Tentative",o[o.Busy=2]="Busy",o[o.Oof=3]="Oof",o[o.WorkingElsewhere=4]="WorkingElsewhere",o[o.Unknown=5]="Unknown",(s=S||(S={})).MaxUsersReached="MaxUsersReached",s.MeetingNotFound="MeetingNotFound",s.VodAccessDisabled="VodAccessDisabled",s.NotAuthorized="NotAuthorized",s.RoutingException="RoutingException",s.ResourceDeleted="ResourceDeleted",s.InvalidIdentifiers="InvalidIdentifiers",s.Unknown="Unknown",(l=C||(C={}))[l.Unauthorized=401]="Unauthorized",(c=v||(v={}))[c.UserNotLoggedIn=1]="UserNotLoggedIn",(d=f||(f={})).broadcast_yammer_group_info_text_groupName="broadcast_yammer_group_info_text_groupName",d.broadcast_yammer_group_info_text_visibility="broadcast_yammer_group_info_text_visibility: string",d.broadcast_yammer_group_info_text_visibility_private="broadcast_yammer_group_info_text_visibility_private",d.broadcast_yammer_group_info_text_visibility_public="broadcast_yammer_group_info_text_visibility_public",(g=b||(b={}))[g.Private=0]="Private",g[g.Public=1]="Public";var E=i(28414),M=i(395250),P=i(826757);class k{static getBroadcastStatusResourceString(e,t,i){switch(e){case E.TP.NotStarted:case E.TP.Starting:return i?t.strings.broadcast_status_pre_live_shortformat:t.strings.broadcast_status_pre_live;case E.TP.Started:return t.strings.broadcast_status_live;case E.TP.Stopping:case E.TP.Stopped:return t.strings.broadcast_status_stopped;default:return t.strings.calling_prejoin_preview_container_title_connecting}}static logExternalForDDL(e,t,i,n){if(t)return;let a=k.broadcastUtilitiesHelpers.getRootToolsManager();if(!a||!a.logExternalForDDL)return void i.warn("logExternalForDDL: Attempted to use RootToolsManager.logExternalForDDL but it's not defined");a.logExternalForDDL(e,n)}static isComposerBotMri(e,t){return!!(t&&t.indexOf(e)>=0)}static getAvailableComposerStream(e,t,i){let n=e&&e.broadcastMeeting&&e.broadcastMeeting.broadcastState;if(!n)return null;let a=n&&n.previewSourceId;if(!a)return i.error("getAvailableComposerStream: Preview sourceId not present in current metadata."),null;let r=k.getParticipantStreamFromMediaId(t,a,i);return r||(i.error("getAvailableComposerStream: No preview stream found for participant {0} with sourceId {1}",t.id,a),null)}static getParticipantFromBroadcastSource(e,t,i,n){let a;if("0"===t){let t=e.getScreenSharer();return t?t.id:e.isScreenSharingOn?i.getCurrentSkypeMri():null}for(let i of e.participants)if(!k.isComposerBotMri(i.id,n)&&k.isMediaIdInParticipantEndpoints(i.endpoints,t)){a=i.id;break}return!a&&k.isMediaIdInParticipantEndpoints(e.endpoints,t)&&(a=i.getCurrentSkypeMri()),a}static getParticipantStreamFromMediaId(e,t,i){let n=k.getParticipantIdFromBroadcastSource(e,t,i);if(!n)return i.error("MediaId {0} not found in participants endpoint",t),null;let a="0"===t?y.StreamType.ScreenSharing:y.StreamType.Video,r=e.streams[a];if(!r)return i.error("No video stream found for participantId {0}",e.id),null;let o=(0,T.find)(r,e=>e.participantId===n);return o||(i.error("No stream found for participantId {0}",n),null)}static getParticipantIdFromBroadcastSource(e,t,i){if(!e)return null;let n=k.getEndPointWithGivenMediaId(e.endpoints,t);return n?n.participantId:(i.error("No end point detail found with given mediaId {0}",t),null)}static getEndPointWithGivenMediaId(e,t){let i=e&&e.endpointDetails&&e.endpointDetails;if(!i)return null;for(let e=0;e<i.length;e++){let n=i[e],a=n&&n.mediaStreams;if("0"===t?a&&a.some(e=>e.label===k.mediaSourceLabelForVbss&&e.direction===y.MediaDirection.SendOnly):a&&a.some(e=>e.sourceId===Number(t)))return n}return null}static isMyVideoBroadcasting(e){return!!e&&!!e.broadcastMeeting&&!!e.endpoints&&k.isVideoBroadcasting(e.broadcastMeeting,e.endpoints)}static isVideoBroadcasting(e,t){let i=e.broadcastState;for(let e of k.getBroadcastLiveSources(i))if("0"!==e.id&&k.isMediaIdInParticipantEndpoints(t,e.id))return!0;return!1}static getBroadcastLiveSources(e){return e&&e.status===E.TP.Started?k.getBroadcastLayoutSources(e):[]}static isMediaIdInParticipantEndpoints(e,t){return!!k.getEndPointWithGivenMediaId(e,t)}static getBroadcastLayoutSources(e){let t=[];if(!e)return t;let i=e.layout&&e.layout.sources;if(i&&i.length>0)for(let n of i)n&&e.sources&&n.idx<e.sources.length&&e.sources[n.idx]&&t.push(e.sources[n.idx]);return t}static isMyScreenShareBroadcasting(e){if(!e||!e.broadcastMeeting)return!1;let t=e.broadcastMeeting.broadcastState;for(let i of k.getBroadcastLiveSources(t))if("0"===i.id)return e.isScreenSharingOn;return!1}static isScreenShareBroadcasting(e){if(!e||!e.broadcastMeeting)return!1;let t=e.broadcastMeeting.broadcastState;for(let e of k.getBroadcastLiveSources(t))if("0"===e.id)return!0;return!1}static isParticipantVideoBroadcasting(e,t){return!!t&&!!e&&!!e.endpoints&&k.isVideoBroadcasting(t,e.endpoints)}static isParticipantScreenShareBroadcasting(e,t){if(!t)return!1;let i=t.broadcastState;for(let t of k.getBroadcastLiveSources(i))if("0"===t.id&&e)return e.streams&&e.streams[y.StreamType.ScreenSharing]&&e.streams[y.StreamType.ScreenSharing][0]&&e.streams[y.StreamType.ScreenSharing][0].isAvailable;return!1}static getIdentifiersFromAttendeeMeetingUrl(e,t){try{let t;if(!e||-1===e.indexOf("/teams/")&&-1===e.indexOf("/ngc/v1/"))return null;let i=e.split("?");if((t=-1!=i[0].indexOf("/teams/")?i[0].match(/(\/teams\/)([\w\-]{36})\/([\w\-]{36})\/(\w*.*)\/(\w*.*)/):i[0].match(/(\/ngc\/v1\/)([\w\-]{36})\/([\w\-]{36})\/(\w*.*)\/(\w*.*)\/(\w*.*)/))&&t.length>=6&&t.splice(0,2)&&!(0,T.some)(t,e=>!e))return t;return null}catch(e){return t&&t.error(`Error during parsing meeting url, error: ${e}`),null}}static getMeetingIdFromAttendeeMeetingUrl(e,t){let i=k.getIdentifiersFromAttendeeMeetingUrl(e,t);return i?i.join(k.attendeeMeetingParamsSeparator):null}static getTenantIdFromAttendeeMeetingUrl(e,t){let i=k.getIdentifiersFromAttendeeMeetingUrl(e,t);return i?i[0]:null}static getSessionIdFromAttendeeMeetingUrl(e,t){let i=k.getIdentifiersFromAttendeeMeetingUrl(e,t);return i?i[4]:void 0}static stringifyBroadcastState(e){switch(e){case y.BroadcastModalityState.Connected:return M.ck.ConnectedStep;case y.BroadcastModalityState.Connecting:return M.ck.ConnectingStep;case y.BroadcastModalityState.Disconnected:return M.ck.DisconnectedStep;case y.BroadcastModalityState.Ringing:return M.ck.RingingStep;default:return M.ck.NoneStep}}static isParticipantStreamLive(e,t,i){if(!e||!e.broadcastMeeting)return!1;let n=e.broadcastMeeting.broadcastState;for(let e of k.getBroadcastLiveSources(n))if(e&&"0"===e.id===i&&(i||k.isMediaIdInParticipantEndpoints(t.endpoints,e.id)))return!0;return!1}static isAnyParticipantStreamAvailable(e,t){return!!e.isVideoOn||!!e.isScreenSharingOn||!!(e.participants.filter(e=>!k.isComposerBotMri(e.id,t)&&(A.w.bestAvailableVideoFor(e)||A.w.bestAvailableScreenShareFor(e))).length>0)}static getStreamAttendeeExternalLink(e){return e?`https://web.microsoftstream.com/video/${e}`:null}static getStreamProducerExternalLink(e){return e?`https://web.microsoftstream.com/update/${e}`:null}static getYammerAttendeeExternalLink(e){return e&&(e.event||e.broadcastId)?e.event||`https://www.yammer.com/#/broadcast/${e.broadcastId}`:null}static yammerGroupInfoToString(e,t){if(!e)return null;let i=t.instant(f.broadcast_yammer_group_info_text_groupName),n=t.instant(f.broadcast_yammer_group_info_text_visibility),a=b[e.visibility]===b.Private?t.instant(f.broadcast_yammer_group_info_text_visibility_private):t.instant(f.broadcast_yammer_group_info_text_visibility_public);return`${i}: ${e.displayName}, ${n}: ${a}`}static submitAutoBrbLogs(e,t,i,n,a,r){let o,s=i.newScenario(M.RG.BroadcastAutoBrb);if(!a)return s.stop({[I.gT.scenarioDataPropNames.broadcastError]:"Feature flag not enabled"}),Promise.reject("Feature flag not enabled");if(!t)return s.fail({[I.gT.scenarioDataPropNames.broadcastError]:"Call object is required"}),Promise.reject("Call object is required");let l=`Auto Brb: ${e} (callId: ${t.callId}, participantId: ${t.participantId}, threadId: ${t.threadId})`,c=t.broadcastMeeting&&t.broadcastMeeting.broadcastState;try{o=JSON.stringify({failureType:t.failureType,abortReason:t.abortReason,mediaConnected:t.mediaConnected,terminatedReason:t.terminatedReason,broadcastRole:t.broadcastMeeting&&t.broadcastMeeting.role||"unknown",broadcastModalityState:k.stringifyBroadcastState(t.broadcastMeeting.modalityState),broadcastState:(0,T.pick)(c,["commands","error","status","sources","commandStatus","layout"]),callstate:P.eU.stringifyCallState(t.state)})}catch(e){r.error(`submitAutoBrbLogs encountered error - ${e})`),o=l}let d=String(I.gT.feedback.categories.other);return n.sendFeedbackToBrbV2(!0,{category:d,title:l,description:o,piiSafeLogsOnly:!0,allowScreenshots:!1,includeBackgroundBlurImages:!1,includeHeapSnapshot:!1}).then(()=>{s.stop()}).catch(e=>{r.error(`Brb submission failed with error: ${e}`);let i={};i[I.gT.counters.eventNames.callId]=t.callId,i[I.gT.counters.eventNames.participantId]=t.participantId,[I.gT.scenarioDataPropNames.broadcastError]=e,s.fail(i)})}static handleBroadcastScenarioOnError(e,t,i,n){let a=t&&(t.statusCode||t.status),r=t&&t.errorMessage&&t.errorMessage.subCode;return(i&&i[I.gT.scenarioDataPropNames.broadcastError]||(i={...i,[I.gT.scenarioDataPropNames.broadcastError]:JSON.stringify(t)}),t.innerException?.isExpected)?void e.cancel(i):void 0===a||null==a?void e.fail(i):void(t.code===I.gT.errorCodes.scenarioAbandoned||t.code===I.gT.errorCodes.networkOffline||a===C.Unauthorized&&t.errorCode===v.UserNotLoggedIn||a===I.gT.responseCode.tooManyRequests&&r===S.MaxUsersReached||(0,T.includes)(n,a)?e.cancel(i):e.fail(i))}static appendQueryStringToUrl(e,t,i){if(!e)return null;let n=`${t}=${i}`;return e.indexOf("?")>=0?`${e}&${n}`:`${e}?${n}`}static isPrimaryOrAlternateStreamAvailable(e){return e&&(k.isStreamValid(e.stream)||k.isStreamValid(e.altStream))}static isStreamValid(e){return e&&!!e.wamsStreamingUrl&&!!e.decryptionToken}static isStreamInfoComplete(e){return e&&k.isStreamValid(e.stream)&&k.isStreamValid(e.altStream)}static isQuickStartStreamBroadcast(e,t){return e.streamResource&&e.streamResource.encoderSource===t||!1}static isOverflowBroadcast(e){return!!k.getAttendeeMeetingParamsFromId(e.meetingId).sessionId}static getMeetingIdFromAttendeeMeetingParams(e,t,i,n,a){return[e,t,i,n,a].filter(e=>void 0!==e).join(k.attendeeMeetingParamsSeparator)}static getAttendeeMeetingParamsFromId(e){let[t,i,n,a,r]=e.split(k.attendeeMeetingParamsSeparator);return{tenantId:t,organizerId:i,threadId:n,messageId:a,sessionId:r}}static hasUnresolvedEmailForETMs(e){return(0,T.some)(e,e=>e&&!e.skypeMri&&!e.objectId&&e.type!==p[p.Organizer])}static hasUnresolvedEmailForAttendees(e){return(0,T.some)(e,e=>e&&!e.skypeMri&&!e.objectId)}static getBroadcastLayout(e,t,i){return t?{sources:t.map(t=>({type:t.type,id:k.getMediaId(t,e,i)}))}:(i.error("Sources is null or undefined"),null)}static getMediaId(e,t,i){let n,a;if(!e.participant)return i.error("Source participant is null or undefined"),null;if("vbss"===e.type)return"0";if(e.participant.isMe)n=t.endpoints;else{let i=(0,T.find)(t.participants,t=>t.id===e.participant.mri);n=i&&i.endpoints}if(!n||!n.endpointDetails)return i.error("No endpoint details found"),null;let r=n.endpointDetails,o=this.getParticipantId(t,e,i);if(o){let t=(0,T.find)(r,e=>e.participantId===o);t?a=[t]:i.error(`No endpoint found for ${o} and ${e.type}`)}else i.error("No valid participantId found for the given source {0}",JSON.stringify(e.participant));for(let t of(a||(a=r),a)){let n=k.getSourceIdFromEndpoint(e.type,t,i);if(n)return n}return i.error("No mediaId found"),null}static getParticipantId(e,t,i){if(!t||!t.participant)return i.error("Source participant is null or undefined"),null;if(t.participant.isMe)return e.participantId;let n=e.participants.find(e=>e.id===t.participant.mri);if(!n)return i.error("No participant found with current mri {0}",t.participant.mri),null;if(!n.endpoints&&!n.endpoints.endpointDetails)return i.error("No end points available for local user."),null;"video"!==t.type&&i.error("We always expect the type here to be video. Something wrong");let a=A.w.bestVideoFor(n);return a?a.participantId:(i.error("No available stream found for the participant {0}",t.participant.mri),null)}static getSourceIdFromEndpoint(e,t,i){let n=t.mediaStreams;if(!n)return i.error("Media stream is null"),null;i.info(`MediaStreams from call object: ${JSON.stringify(n)}`);let a=k.mediaSourceLabels[e],r=a&&n.find(e=>e.label===a),o=r&&r.sourceId;return i.info(`Found sourceId [${o}] for [${a}] source, mediaSourceLabel: [${e}]`),o}static isMySourcesInLivePreview(e){if(!e||!e.broadcastMeeting||!e.broadcastMeeting.broadcastState)return!1;let t=e.broadcastMeeting.broadcastState;for(let i of k.getBroadcastLiveSources(t))if(k.isMediaIdInParticipantEndpoints(e.endpoints,i.id)||"0"===i.id&&e.isScreenSharingOn)return!0;return!1}}k.mediaSourceLabelForVbss="applicationsharing-video",k.attendeeMeetingParamsSeparator="__",k.mediaSourceLabels={audio:"main-audio",data:"data",video:"main-video",vbss:"applicationsharing-video"}},826757:function(e,t,i){i.d(t,{Hg:()=>S,Uw:()=>a,eU:()=>_});var n,a,r=i(370574),o=i(892891),s=i(575810),l=i(443889),c=i(777016),d=i(527640),g=i(310735),h=i(650784),p=i(945761),u=i(855273),m=i(113802);let _={SOURCE_ID_ANY:0xfffffffe,skypeIdNamespaces:["live","sip_profile","myspace","c2c","sms","facebook","fb","sc","stbot","guest","test"],bufferToString:e=>String.fromCharCode.apply(null,e),mapMediaTypeStringToMediaType(e){switch(e){case"audio":return r.MediaType.Audio;case"video":return r.MediaType.Video;case"applicationsharing-video":return r.MediaType.ScreenShare;case"data":return r.MediaType.Data;default:return}},getOwnEndpoint:e=>e.endpoints&&e.endpoints.endpointDetails?(0,o.find)(e.endpoints.endpointDetails,t=>t.participantId===e.participantId):null,getParticipantFromCall:(e,t)=>e.participants.find(e=>e.id===t),getPlazaParticipantRoomId(e,t,i){let n,a=new Map,r=0;for(;r<e.participants.length;){let o=e.participants[r];if(a.set(o.endpoints?.endpointDetails?.[0]?.participantId,o),o.id===i&&(n=o.endpoints?.endpointDetails?.[0]?.mappedTo)&&n===e.participantId)return t;if(n){let e=a.get(n);if(e)return e.id}r++}},getNumParticipants:(e,t)=>t.getCallParticipantCounts(e.teamsCallId).totalParticipants,getNumOrganizers:(e,t)=>t.getCallParticipantCounts(e.teamsCallId).totalOrganizers||0,getLobbyParticipantsCount:(e,t)=>t.getCallLobbyParticipantCounts(e.teamsCallId),sendAutoBrbForCallingAnomalies(e,t,i,n,a,r,o=p.Wq){let s=Date.now(),l=e=>t.sendFeedbackToBrbV2(!0,{category:a,title:e,description:"Submitted via perf monitor",allowScreenshots:!1,includeBackgroundBlurImages:!1,includeHeapSnapshot:!1}),c=o.toCancellable(e).then(()=>{let e=Date.now()-s;e>r&&l(`${n} exceeded ${r}ms (taking ${e}ms)`)}).catch(e=>{if("promiseCancelled"===e){let e=Date.now()-s;l(`${n} timed out after ${e}ms`)}else l(`${n} failed`)}).finally(()=>{i.timeout.cancel(d)}),d=i.timeout.set(()=>{o.cancel(c)},12e4)},getParticipantInOneToOneCall(e,t){let i=null;return t.participants.forEach(t=>{t.id!==e&&(i=t.id)}),i},getSourceIdForMediaTypeFromEndpoint(e,t){if(e?.mediaStreams){let i=e.mediaStreams.find(e=>_.mapMediaTypeStringToMediaType(e.type)===t);if(i)return i.sourceId}return _.SOURCE_ID_ANY},hasEndpointDetails:e=>e.endpoints&&e.endpoints.endpointDetails&&e.endpoints.endpointDetails.length>0,hasEndPointType:(e,t)=>!!e&&!!e.endpoints&&-1!==(0,o.findIndex)(e.endpoints.endpointDetails,e=>e.endpointType===t),isCallConnecting:e=>e.state===r.CallState.Connecting||e.state===r.CallState.EarlyMedia,unregisterEventIfNeeded(e){e&&e()},isABot:(e,t,i=[])=>_.isCallingSystemBot(t,i)||e.isVoiceAppMri(t),isAllowedInRoster:(e,t,i)=>!t.isBotMri(e)||i&&i.includes(e),isCallConnected:e=>e.state===r.CallState.Connected,isCallDropped:e=>e.failureType===r.FailureType.CallDropped,isCallOnServerHold:e=>e.state===r.CallState.Observing&&e.isServerHold,isCallSetupFailed:e=>e.failureType===r.FailureType.CallSetupFailed||e.terminatedReason===r.TerminatedReason.UnknownError||e.callEndDiagnosticsInfo?.callControllerSubCode===s.Od.CALLEE_ALLOW_PRIVATE_CALLING_DISABLED,isCallingSystemBot:(e,t=[])=>t.includes(e),getCallEndDiagnosticsInfo:e=>e.callEndDiagnosticsInfo||e.participants[0]&&e.participants[0].callEndDiagnosticsInfo,isTransfereeTransferring:e=>!!e.transferorMri&&_.isCallConnecting(e)&&!_.isParkeeParking(e),isParkeeParking:e=>e.origin&&e.origin===r.CallOrigin.Park,isCallActive:e=>_.isCallConnected(e)||_.isCallConnecting(e)||_.isCallOnServerHold(e)||e.state===r.CallState.LocalHold||e.state===r.CallState.RemoteHold||e.state===r.CallState.InLobby,isCallOnServerHoldV2:e=>e.isServerHoldV2,isCallOnLocalHold:e=>e.state===r.CallState.LocalHold||_.isCallOnServerHold(e)||_.isCallOnServerHoldV2(e),isCallOnHold:e=>e.state===r.CallState.LocalHold||e.state===r.CallState.RemoteHold||_.isCallOnServerHold(e),isCallInLobby:e=>e.state===r.CallState.InLobby,isDownlevelCall:e=>{if(e.teamsCallType!==r.CallType.P2P||!e.participants)return!1;let t=e.participants[0];if(!t)return!1;let i=_.hasEndPointType(t,s.gT.endpointType.lync),n=t.id?.includes(l.zq);return i||n},isOneToOneWithDefaultEndpointTypeCall:e=>{if(e.teamsCallType!==r.CallType.P2P||!e.participants)return!1;let t=e.participants[0];return!!t&&_.hasEndPointType(t,s.gT.endpointType.default)},hasConnectedAcsParticipants:e=>!!e.participants&&!!e.participants.filter(e=>[l.$c,l.dG].some(t=>e.id.startsWith(t))&&e.state===r.ParticipantState.Connected).length,isMeetNow:e=>{let t=e.getIntent();return!!t&&t.type===g.G.Meeting&&!!t.coordinates?.isAdhoc},isOneToOneCall:e=>e.getIntent()?.type===g.G.OneToOneCall,isTownhall:e=>e.meetingDetails?.meetingCapability?.forceAttendeeStreaming||"scheduledTownhall"===e.conversationType,isAudioDropInCall:e=>"huddleGroupCall"===e.conversationType,isEchoBotCall:e=>e.setupArgs&&e.setupArgs.isEchoBotCall&&!0===e.setupArgs.isEchoBotCall||e.getIntent&&e.getIntent()&&e.getIntent().joinOptions&&e.getIntent().joinOptions.context===m.l.EchoBotCall,isFederatedCall:(e,t)=>{if(e.teamsCallType!==r.CallType.P2P||!e.participants||_.isOneToOnePstnCall(e))return!1;let i=e.participants[0];return!!i&&!!t&&!!i.tenantId&&i.tenantId!=t},isIncomingConferenceCallQueue:e=>e.callQueueInfo&&e.callType===r.CallType.Conference&&e.teamsCallType===r.CallType.P2P,isIncomingConsultCall:e=>{let t=e&&e.teamsCallType===r.CallType.P2P&&e.participants,i=t&&t.length>0&&t[0].endpoints,n=i&&i.endpointDetails,a=n&&n.length>0&&n[0].endpointMetadata,o=a&&a.consultationContext;return!!(o&&o.isIncomingConsult)},isInvisibleBot:e=>e.endpoints&&e.endpoints.endpointDetails[0]&&e.endpoints.endpointDetails[0].endpointMetadata&&e.endpoints.endpointDetails[0].endpointMetadata.__platform&&e.endpoints.endpointDetails[0].endpointMetadata.__platform.ui&&e.endpoints.endpointDetails[0].endpointMetadata.__platform.ui.hidden,isParticipantAnRtmpInBot(e){let t=e?.endpoints?.endpointDetails,i=t&&t[0]?.endpointMetadata?.mcrData;return i?.type==="rtmpinput"},isOneToOnePstnCall:e=>{if(!(e&&e.teamsCallType===r.CallType.P2P&&!(0,o.isUndefined)(e.participants)&&!(0,o.isNull)(e.participants)))return!1;let t=e.participants.filter(e=>!e.id?.startsWith(l.RE));return!!t?.[0]?.id?.startsWith(l.Yg)},isMissedCall:e=>e.state===r.CallState.Disconnected&&e.wasInState(r.CallState.Notified)&&!e.wasInState(r.CallState.Connected)&&(e.participants||[]).length<2,isParkCall:e=>e.origin&&e.origin===r.CallOrigin.Park,isPrivateMeeting:(e,t,i)=>e&&e.isInitialized?e.isPrivateMeeting():!!(!t&&i),isReplacesCall:e=>e&&"replaces"===e.incomingCallType&&!!e.consultativeCallId,isSkypeConsumerCall:e=>_.isConsumerCall(e),isConsumerCall:e=>{if(e.teamsCallType!==r.CallType.P2P||!e.participants)return!1;let t=e.participants[0];return!!t&&_.isSkypeConsumerUser(t.id)},isSkypeGroupCallV1:e=>e?.threadId?.includes("@thread.skype"),isTflConsumerCall:e=>_.isOneToOneWithDefaultEndpointTypeCall(e)&&_.isConsumerCall(e),isSfcCall:e=>_.isDownlevelCall(e)&&_.isConsumerCall(e),isSkypeBusinessCall:e=>_.isDownlevelCall(e)&&!_.isConsumerCall(e),isSkypeConsumerUser(e){if(!e)return!1;let t=e.split(";")[0];if(!t)return!1;let i=t.split(":");return!!i&&!(i.length<1)&&!(i.length>3)&&"8"===i[0]&&(2===i.length?!(0,o.isNil)(i[1])&&!(0,o.isEmpty)(i[1]):3===i.length&&!(0>(0,o.findIndex)(_.skypeIdNamespaces,e=>e==i[1]))&&!(0,o.isNil)(i[2])&&!(0,o.isEmpty)(i[1]))},isVoicemailGreetingCall:e=>e.teamsCallType===r.CallType.P2P&&_.hasEndPointType(e,s.gT.endpointType.voicemail),isImmersiveMeetingCall:e=>e.isImmersiveViewActive,isImmersiveEvent:e=>e.isImmersiveEventActive,findParticipantBySourceId(e,t){return e?.participants?.find(e=>this.findEndpointDetailBySourceId(e?.endpoints?.endpointDetails,t))},findEndpointDetailBySourceId:(e,t)=>e?.find(e=>e?.mediaStreams?.find(e=>e?.type==="data"&&e?.sourceId===t)),mapParticipantToSourceId(e,t){if(!e||!e.endpoints||!e.endpoints.endpointDetails)return _.SOURCE_ID_ANY;for(let i of e.endpoints.endpointDetails){let e=_.getSourceIdForMediaTypeFromEndpoint(i,t);if(e!==_.SOURCE_ID_ANY)return e}return _.SOURCE_ID_ANY},mapRosterVersionStringToPlatformId(e){let t=/(\d+?)(?=\/)/.exec(e);return t?parseInt(t[0]):null},stringifyCallState:e=>{switch(e){case r.CallState.Notified:return"Notified";case r.CallState.Connecting:return"Connecting";case r.CallState.Connected:return"Connected";case r.CallState.LocalHold:return"LocalHold";case r.CallState.RemoteHold:return"RemoteHold";case r.CallState.Disconnecting:return"Disconnecting";case r.CallState.Disconnected:return"Disconnected";case r.CallState.Observing:return"Observing";case r.CallState.EarlyMedia:return"EarlyMedia";case r.CallState.InLobby:return"InLobby";case r.CallState.Staging:return"Staging";case r.CallState.Preheating:return"Preheating";case r.CallState.Preheated:return"Preheated";case c.T.Reconnecting:return"Reconnecting";case c.T.Transferring:return"Transferring";case c.T.TransferFailed:return"TransferFailed";case c.T.TransferSucceeded:return"TransferSucceeded";case c.T.Parking:return"Parking";case c.T.ParkFailed:return"ParkFailed";case c.T.ParkSucceeded:return"ParkSucceeded";case c.T.Escalating:return"Escalating";case c.T.EscalationFailed:return"EscalationFailed";case c.T.EscalationSucceeded:return"EscalationSucceeded";case c.T.Aborted:return"Aborted";default:return"None"}},getCallStateInfo:e=>{let t=_.stringifyCallState(e);return`${e} (${t})`},stringifyStagingRoomState:e=>{switch(e){case d.o.InGreenRoom:return"InGreenRoom";case d.o.InStagingRoom:return"InStagingRoom";case d.o.FailedToBeMovedToMainMeeting:return"FailedToBeMovedToMainMeeting";case d.o.SuccessfullyMovedToMainMeeting:return"SuccessfullyMovedToMainMeeting";case d.o.MeetingIsLive:return"MeetingIsLive";case d.o.MeetingHasEnded:return"MeetingHasEnded";case d.o.FailedToBeMovedFromMainMeetingToGreenRoom:return"FailedToBeMovedFromMainMeetingToGreenRoom";case d.o.SuccesfullyMovedFromMainMeetingToGreenRoom:return"SuccesfullyMovedFromMainMeetingToGreenRoom";case d.o.None:default:return"None"}},stringToBuffer(e){let t=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t},waitForCallConnection(e,t){let i=t.createDeferred();return(0,u.U)(e,e=>{if(e.state===r.CallState.Disconnected||e.state===r.CallState.Connected)return i.resolve(e),!0},!0),i.promise},parseHexString(e){let t=[];for(;e.length>=2;)t.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return t},getUUIDHash(e,t){let i=t(e),n=_.parseHexString(i);return n.length<4?-1:(n[0]<<24|n[1]<<16|n[2]<<8|(0|n[3]))>>>0},getUUIDHashPercentage:(e,t)=>_.getCQFHashPercentage(e,t),getCQFHashPercentage(e,t){if(/^[0-9A-Za-z/-]{36}$/.test(e)){let i=_.getUUIDHash(e,t);if(-1!==i)return i%100/100}return -1},systemAudioDeviceCheck(e,t){let i=e.getSelectedDevices(),n=e.isSpeakersMismatchAllowedOnSystemAudioSharing();if(!i.microphone)return h.F.NoMicrophone;if(!i.speaker)return h.F.NoSpeakers;let a=e.getSpeakers().find(e=>e.isDefaultAudioDevice)?.id;return(t.info(`checkSystemAudio: current speaker ${i.speaker} default ${a}`),a&&""!==a||e.getSpeakerChangeSubscribeStatus())?a&&a===i.speaker||n?h.F.Ok:h.F.SpeakersMismatch:(t.warn("no default speaker device found in devicemanager, even though getSelectedDevices returns a speaker"),h.F.Ok)},hasScreenshareModality(e){if(!e)return!1;let t=[r.MediaDirection.Inactive,r.MediaDirection.Disabled];return!_.hasEndpointDetails(e)||e.endpoints.endpointDetails.some(e=>!e.mediaStreams||e.mediaStreams.some(e=>_.mapMediaTypeStringToMediaType(e.type)===r.MediaType.ScreenShare&&-1===t.indexOf(_.mapMediaDirectionStringToMediaDirection(e.direction))))},mapMediaDirectionStringToMediaDirection(e){switch(e){case"disabled":return r.MediaDirection.Disabled;case"inactive":return r.MediaDirection.Inactive;case"recvonly":return r.MediaDirection.ReceiveOnly;case"sendonly":return r.MediaDirection.SendOnly;case"sendrecv":return r.MediaDirection.Bidirectional;default:return}},isConnectedWithBrowserPermission:e=>e.mediaStreams.some(e=>_.mapMediaTypeStringToMediaType(e.type)===r.MediaType.Audio&&_.mapMediaDirectionStringToMediaDirection(e.direction)===r.MediaDirection.ReceiveOnly),isConnectedWithAudioOrVideo(e){if(!e)return!1;let t=[r.MediaDirection.Inactive,r.MediaDirection.Disabled];return!_.hasEndpointDetails(e)||e.endpoints.endpointDetails.some(e=>!e.mediaStreams||!!e.mediaStreams.some(e=>"audio-teleconferencing"===e.type)||!_.isConnectedWithBrowserPermission(e)&&(e.mediaStreams.filter(e=>t.indexOf(_.mapMediaDirectionStringToMediaDirection(e.direction))>-1).length===e.mediaStreams.length||e.mediaStreams.some(e=>(_.mapMediaTypeStringToMediaType(e.type)===r.MediaType.Audio||_.mapMediaTypeStringToMediaType(e.type)===r.MediaType.Video)&&-1===t.indexOf(_.mapMediaDirectionStringToMediaDirection(e.direction)))))},convertOidToCid(e){let t="00000000-0000-0000-";return e&&36===e.length&&e.startsWith(t)?e.slice(t.length).replace("-","").replace(/^0*/,""):void 0},b64EncodeUnicode:e=>e&&"string"==typeof e?btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))})):null,b64DecodeUnicode:e=>e&&"string"==typeof e?decodeURIComponent(atob(e).split("").map(e=>{let t=`00${e.charCodeAt(0).toString(16)}`;return`%${t.slice(-2)}`}).join("")):null,isStreamingAttendee:e=>e.callMode===r.CallMode.Streaming,isStreamingCallParticipant:e=>!!e?.endpoints?.endpointDetails[0]?.stream,isFollowModeParticipant(e){let t=e?.endpoints?.endpointDetails;return!!t&&0!==t.length&&t.every(e=>e.endpointMetadata?.isFollowMode)},isMeetingCodeInvalid:(e,t)=>!!e&&!!t&&s.gT.meetingCodes.invalidMeetingCodeCodes.includes(e)&&s.gT.meetingCodes.invalidMeetingCodeSubcodes.includes(t),isMeetingAnonymized:e=>!!e?.meetingDetails?.meetingCapability?.maskIdentitiesForRole,clampEmail(e,t){let i=e.match(/^(.+)@([^@]+)$/),n=i?.[2],a=i?.length===3?i[1]:e,r=a.length>t?`${a.slice(0,t)}***`:a;return n?`${r}@${n}`:r},safeJsonParse:(e,t={},i)=>{let n;try{if(void 0===e)throw Error('"undefined" is not valid JSON');n=JSON.parse(e)}catch(e){n=t,i?.(e)}return n},isValidMeetingThreadId:e=>RegExp("19:((preview-[a-zA-Z0-9-_]+$)|([a-zA-Z0-9-_]+:?[a-zA-Z0-9-_]+@[a-zA-Z0-9.]+[a-zA-Z0-9]+$))","g").test(e),getInvalidThreadIdString(e){let t=`invalidThreadId_${e?.length}`;return e?.includes("%")&&(t=`${t}_encoded`),t},isMultilineUser:e=>!!e&&e.some(e=>"Alternate"===e.assignmentCategory),isPrimaryNumber:(e,t)=>!!e&&!!t&&e.some(e=>"Primary"===e.assignmentCategory&&e.telephoneNumber===t),getPrimaryPhoneNumber(e){if(e)return e.filter(e=>"Primary"===e.assignmentCategory)[0]?.telephoneNumber||void 0},isCountryEnforcedLbrUser:(e,t)=>!!e&&!!t&&e.some(e=>"Primary"===e.assignmentCategory&&"OperatorConnect"===e.numberType&&e.isoCountryCode&&t.includes(e.isoCountryCode)),isCountryEnforcedMobileLbrUser:(e,t)=>!!e&&!!t&&e.some(e=>"Primary"===e.assignmentCategory&&"OperatorConnect"===e.numberType&&e.acquiredCapabilities?.includes("Mobile")&&e.isoCountryCode&&t.includes(e.isoCountryCode)),isAttributionEnabledForByodRoom(e){let t=!1,i=e?.getIntent()?.joinOptions?.isByodEnabledFromPrejoin,n=!!e?.getIntent()?.joinOptions?.adhocMeetingSpace,a=e?.isByodStateOnForTranscriptAttribution();return(i&&!n||a)&&(t=e?.hasUserPremiumOrCopilotLicense||!1),t},scrubMeetingData(e){if(!e)return;let t={...e};if(t.passcode&&(t.passcode="isPresent"),t.meetingCode){let e=!isNaN(parseFloat(t.meetingCode));t.meetingCode=`isValid:${e}`}return t.meetingUrl&&(t.meetingUrl="isPresent"),t},toExtendedCallStateHistoryWithDebugInfo:e=>e.map((t,i,n)=>({...t,stateInfo:_.getCallStateInfo(t.state),timestampISO:new Date(t.timestamp).toISOString(),elapsedTime:t.timestamp-n[0].timestamp,stateTime:i===e.length-1?0:e[i+1].timestamp-e[i].timestamp})),getCallParticipantMrisExcludingBots(e,t,i,n){let a=t?.getCurrentSkypeMri();return(e.participants||[]).filter(e=>(!a||e.id!==a)&&(!n?.excludingInvisibleBot||!this.isInvisibleBot(e))&&(!n?.excludingVoiceAppBot||!i?.isVoiceAppMri(e.id))&&(!n?.excludingAllBots||!e.id?.startsWith(l.RE))).map(e=>e.id)},stripPstnPrefixAndPlus:e=>e.replace(l.Yg,"").replace("+",""),isTestEmergencyNumber:(e,t)=>!!e&&!!t&&t.includes(_.stripPstnPrefixAndPlus(e)),getOpmMode(e){switch(e){case"ON":return"ON";case"OFF":return"OFF";default:return"AUTO"}}};function S(e,t){let i=function(){let e=a.Pending,t=p.Wq.createDeferred();return t.promise.then(()=>{e=a.Resolved}).catch(()=>{e=a.Rejected}),{deferredPromise:t,getStatus:()=>e}}(),n=i.deferredPromise,r=t.setTimeoutMs(()=>{n.reject(`Timeout after ${e}ms`),t.clearTimeout(r)},e);return i}(n=a||(a={}))[n.Pending=0]="Pending",n[n.Resolved=1]="Resolved",n[n.Rejected=2]="Rejected"},652549:function(e,t,i){i.d(t,{A:()=>c});var n=i(167135),a=i(892891),r=i(575810),o=i(654807);let s=["renewalTimeout","tokenRevoked","Cannot start retry fetch of ADAL tokens without relogin. Rejecting token request"],l=[o.SEp.AttendanceReportDisabledInERCMeeting,o.SEp.TrackInReportDisabledInERCMeeting];class c{static async executeTaskWithRetry(e,t,i,n,a,r){let o=null;for(let s=0;s<=i;s++)try{return await e()}catch(e){if(o=e,r&&!r(e)||s===i)break;a?.(e,s),await new Promise(e=>n.setTimeoutMs(e,t))}throw o}static isRetriableError(e,t,i,a){return!("number"==typeof t&&n.cq.includes(t))&&(!e||e.map(e=>(!e.ccCode||e.ccCode===i)&&(!e.ccSubCode||e.ccSubCode===a)&&(!e.recordingReason||e.recordingReason===`${t}`)).some(e=>e))}static isRetriableCommandError(e){return!(0,a.get)(e,"isExpected",!1)&&!("string"==typeof(0,a.get)(e,"errorMessage",void 0)&&(0,a.get)(e,"errorMessage",void 0).includes("UserNotAllowed"))}static isExpectedError(e){return(0,a.get)(e,"isExpected",!1)||n.cq.includes(e)||"HandingOver"===(0,a.get)(e,"errorBody.ErrorCode",void 0)||s.includes(e)||l.includes(e)}static timeoutExec(e,t,i){return function(...n){return new Promise(async(a,o)=>{let s=i.setTimeoutMs(()=>{o(Error(r.gT.scenarios.calling.reasons.timeout))},t);try{a(await e.apply(this,n))}catch(e){o(e)}finally{i.clearTimeout(s)}})}}static async executeTaskRepeatedlyWithInterval(e,t,i,n,a,r,o){return new Promise(async(s,l)=>{let c,d=[],g=e.setTimeoutMs(()=>{g=null},n);!function n(h){if(null===g||a&&h>=a){c?l(c):l(Error("timeout")),d.forEach(t=>e.clearTimeout(t)),e.clearTimeout(g),g=null;return}let p=e.setTimeoutMs(n,i,h+1);return d.push(p),t().then(t=>{c=void 0,d.forEach(t=>e.clearTimeout(t)),g&&(e.clearTimeout(g),g=null),s(t)}).catch(t=>{if(c=t,o&&!o(t)){l(c),d.forEach(t=>e.clearTimeout(t)),g&&(e.clearTimeout(g),g=null);return}r?.(t,h)})}(0)})}static async anyResolve(e){return new Promise((t,i)=>{let n=0;0===e.length&&i(Error("No promises provided")),e.forEach(a=>{a.then(t).catch(t=>{++n===e.length&&i(t)})})})}static getStatusCode(e){if(!e)return"";if(e.includes("UserNotAllowed"))if(e.includes("Tenant of the user sending command doesn't match to tenant of meeting"))return"UserNotAllowedExternal";else if(e.includes("Guest users are not supported"))return"UserNotAllowedGuest";else return"UserNotAllowedOthers";let t={"message: Request Timed Out":"RequestTimeout","message: timeout":"Timeout","Failed to fetch":"FailedToFetch","The command initiator is not present in the call":"InitiatorNotInCall","Unknown error":"UnknownError","Unsupported token type":"unsupportedTokenType","Internal Server Error":"InternalServerError","Failed to get auth headers":"FailedToGetAuthHeaders"};for(let i in t)if(e.includes(i))return t[i];return"OtherError"}}},642900:function(e,t,i){i.d(t,{P:()=>y});var n=i(370574),a=i(892891),r=i(200669),o=i(28414),s=i(113802),l=i(291518),c=i(160946),d=i(132342),g=i(310735),h=i(167135),p=i(826757),u=i(575810),m=i(206898),_=i(675201),S=i(443889),C=i(184497),v=i(634504),f=i(512304),b=i(798674);class y{static intentFromStartPstnCallOptions(e,t,i){let n=S.Yg+e.dialoutNumber;return t&&!i&&(n+=e.dtmfPortion?`${S.Wp}${e.dtmfPortion}`:""),{instanceId:(0,v.Z)(),type:g.G.OneToOneCall,coordinates:{type:g.G.OneToOneCall,mri:n},joinOptions:{outgoingVideo:!1,outgoingAudio:!e.muted,shareDesktop:!1,consultationContext:e.consultationContext,context:e.context,onBehalfOf:e.onBehalfOf,onBehalfOfUserDisplayName:e.onBehalfOfUserDisplayName,extension:t?e.dtmfPortion:void 0,emergencyResult:e.emergencyResult,callQueueContext:e.callQueueContext},activeScenarios:[]}}static async intentFromPlaceCallClickParametersAsync(e,t,i){let n=await i.getCallingConversation(e.conversationId);return this.intentFromPlaceCallClickParametersInternal(e,t,n)}static intentFromPlaceCallClickParametersInternal(e,t,i){let n,a,r,o={outgoingVideo:!!e.withVideo,outgoingAudio:!e.muted,shareDesktop:!!e.screenSharingOnly,consultationContext:e.consultationContext,onBehalfOf:e.onBehalfOf,onBehalfOfUserDisplayName:e.onBehalfOfUserDisplayName,context:e.context,invitationData:e.invitationData,callQueueContext:e.callQueueContext,alternateId:e.alternateId};if(e.isEchoBotCall||i.isGroup()){a=g.G.GroupCall,r={type:g.G.GroupCall,conversationId:e.conversationId};let t={...o,isAudioDropInCall:e.isAudioDropInCall};return{instanceId:(0,v.Z)(),type:a,coordinates:r,joinOptions:t,activeScenarios:[]}}if(i.isOneToOne()){a=g.G.OneToOneCall;let s=i.members.map(e=>e.id).filter(e=>e!==t);n=s.length&&s[0],r={type:g.G.OneToOneCall,mri:n,conversationId:e.conversationId};let l={extension:e.extension,...o};return e.targetApplicationType&&(l.targetApplicationType=e.targetApplicationType),{instanceId:(0,v.Z)(),type:a,coordinates:r,joinOptions:l,activeScenarios:[]}}return null}static intentFromDeepLinkOptions(e,t,i){let n=e.context&&e.context.MessageId||e.messageId,a=d.H.getDeepLinkType(e.context,e.messageId,i),r=e.context&&e.context.IsBroadcastMeeting,c=!e.bypassPrejoin,h={participantPin:e.participantPin,type:g.G.Meeting,joinType:m.c.Legacy,conversationId:e.conversationId,messageId:n,rootMessageId:e.messageId,isChannel:a!==l._n.PrivateMeeting,isAdhoc:a===l._n.AdhocMeeting,tenantId:e.context&&e.context.Tid||"",organizerId:e.context&&e.context.Oid||"",meetingCloud:e.meetingCloud||t.getUserCloudDomain()};return r&&(h.broadcast={role:e.userRole?e.userRole:o.tf.None}),e.context&&e.context.prid&&(h.registration={participantRegistrationId:e.context&&e.context.prid,isPublicEvent:e.context&&e.context.isPublic||!1}),{instanceId:(0,v.Z)(),type:g.G.Meeting,coordinates:h,joinOptions:{title:e.meetingTitle||"",isPSTN:!1,showPrejoin:c,outgoingVideo:!!e.withVideo||e.context?.WithVideo==="true",outgoingAudio:!(e.muted||e.context?.Muted==="true"),incomingAudio:e.context?.MutedSpeakers!=="true",deeplinkId:e.deeplinkId,correlationId:e.context&&e.context.correlationId||(0,v.Z)(),context:s.l.DeepLink,skipPreJoinOnRejoin:e.context&&e.context.Rejoin,coldDeepLinkJoin:"cold"in e&&e.cold},activeScenarios:[]}}static isAcceptCallContext(e){return[s.l.HIDTriggeredAccept,s.l.OneToOneAcceptCall,s.l.OneToOneVoipAcceptCall,s.l.OneToOnePstnAcceptCall,s.l.GroupAcceptCall,s.l.AcceptCall,s.l.HIDTriggeredGroupAccept,s.l.HIDTriggeredPstnAccept,s.l.HIDTriggeredVoipAccept,s.l.CallQueueAcceptCall].includes(e)}static isAcceptCall(e){return!!e&&!!e.joinOptions&&this.isAcceptCallContext(e.joinOptions.context)}static getReadableIntentType(e){switch(e){case g.G.OngoingCall:return"OngoingCall";case g.G.Meeting:return"Meeting";case g.G.OneToOneCall:return"OneToOneCall";case g.G.GroupCall:return"GroupCall";case g.G.AgentMonitorSession:return"AgentMonitorSession";default:return String(e)}}static formatIntentForLogging(e){return`${e.id} (${this.getReadableIntentType(e.type)})`}static intentFromMeetingParameters(e,t,i,n,s){let l,c=!t.bypassPrejoin;i||(i=(0,v.Z)());let d={correlationId:i,title:e.title||"",isPSTN:t.joinType===_.AH.pstn,showPrejoin:c,showScreensharingPanel:t.showScreensharingPanel,context:t.context,outgoingVideo:t.withOutgoingVideo,outgoingAudio:t.withOutgoingAudio},h=e.meetingData&&y.isTflMeeting(e.meetingData,s),p=e.meetingData?e.meetingData:{meetingCode:""};return n||h||!(0,a.isEmpty)(e.meetingData)&&void 0===n?l={instanceId:(0,v.Z)(),type:g.G.Meeting,coordinates:{type:g.G.Meeting,joinType:m.c.MeetingData,meetingData:p,isAdhoc:!!e.isInstantMeeting},joinOptions:d,activeScenarios:[]}:(l={instanceId:(0,v.Z)(),type:g.G.Meeting,coordinates:{type:g.G.Meeting,joinType:m.c.Legacy,conversationId:e.conversationId,messageId:e.replyChainMessageId||e.messageId||"0",rootMessageId:e.messageId||"0",isChannel:e.meetingType===r.wJ.Team,isAdhoc:!!e.isInstantMeeting,tenantId:e.tenantId||"",organizerId:e.organizerId||"",meetingCloud:e.meetingCloud||"",skypeTeamsMeetingUrl:e.skypeTeamsMeetingUrl||""},joinOptions:d,activeScenarios:[]},e?.isBroadcast&&(l.coordinates.broadcast={role:e.broadcastRole?e.broadcastRole:o.tf.None})),e.isInstantMeeting&&(l.coordinates.instantMeeting={id:(0,v.Z)(),schedulingServiceEventPromise:e.schedulingServiceEventPromise,autoCreated:!!t.autoCreatedInstantMeeting}),l}static intentForAgentMonitorSession(e){return{instanceId:(0,v.Z)(),type:g.G.AgentMonitorSession,coordinates:{type:g.G.AgentMonitorSession,agentId:e},joinOptions:{context:s.l.AgentMonitorSession}}}static intentFromMeetupParameters(e,t,i,n,a,r){return{instanceId:(0,v.Z)(),type:g.G.Meeting,coordinates:{type:g.G.Meeting,joinType:m.c.Legacy,conversationId:e.conversationId,messageId:e.callMessageId,rootMessageId:e.callMessageId,isChannel:!0,isAdhoc:!!r,tenantId:t.tenantId||"",organizerId:t.organizerId||"",meetingCloud:i.getUserCloudDomain()},joinOptions:{showPrejoin:!0,correlationId:n,context:s.l.StartMeetup,outgoingVideo:!!e.withVideo,outgoingAudio:!e.muted,title:a},activeScenarios:[]}}static isLegacyIntent(e){return e&&e.type===g.G.Meeting&&e.coordinates&&e.coordinates.joinType===m.c.Legacy}static async intentTypeFromConversationIdAsync(e,t){let i=e&&await t.getConversation(e);return this.intentTypeFromConversation(i)}static intentTypeFromConversation(e){return e?e.isOneOnOne()?g.G.OneToOneCall:e.isGroupChat()?g.G.GroupCall:g.G.Meeting:g.G.Meeting}static isPSTNIntent(e){return e.coordinates.type===g.G.OneToOneCall&&e.coordinates.mri.startsWith(S.Yg)}static isPSTNCoords(e,t,i=!1){let n=e=>e.type===g.G.OngoingCall&&"oneToOnePstnCall"===e.coordinates.callType;return!!(n(e)&&n(t)&&i||this.isOneToOnePstnCoords(e.coordinates,t.coordinates)&&i)}static async isEquivalentIntentAsync(e,t,i,n,a,r=!1,o,s){let l=this.getCallFromIntent(e,n),c=this.getCallFromIntent(t,n);return!(!this.isEqualCoordsTeamsCallId(e.coordinates,t.coordinates,l,c,a,s)&&this.isPSTNCoords(e,t,r))&&(!!this.areCallCoordinatesEquivalent(e.coordinates,t.coordinates,l,c,a,o)||await this.areCoordinatesEquivalentInternalAsync(e.coordinates,t.coordinates,l,c,i,a,o))}static getCallFromIntent(e,t){return t.getCallByIntentId(e.id)||t.getCallByCoordinates(e.coordinates)}static isExpectedRemoveIntent(e){return[c.ie.EndCallingIntent,c.ie.CleanupApp,c.ie.ChildWindowClosed,c.ie.RejoinCall,c.ie.WindowCloseRunningApp,c.ie.WindowCloseRunningCore,c.ie.Abandoned,f.q.InteractionRequired,c.ie.PluginHostCrashVdiDisconnectedGeneric,c.ie.PluginHostCrashVdiDisconnectedVmWatchdog].includes(e)}static getDetailedRemoveIntentReasonForPluginHostCrash(e){switch(e){case b.ps.Generic:return c.ie.PluginHostCrashVdiDisconnectedGeneric;case b.ps.ClientWatchdog:return c.ie.PluginHostCrashVdiDisconnectedClientWatchdog;case b.ps.BrokenSlimCore:return c.ie.PluginHostCrashVdiDisconnectedBrokenSlimCore;case b.ps.VmWatchdog:return c.ie.PluginHostCrashVdiDisconnectedVmWatchdog;case b.ps.Unknown:return c.ie.PluginHostCrashVdiDisconnectedUnknown;case b.ps.VdiBridgeOnConnected:return c.ie.PluginHostCrashVdiBridgeOnConnected;case b.ps.VdiBridgeOnDisconnected:return c.ie.PluginHostCrashVdiBridgeOnDisconnected;case b.ps.ConsoleSession:return c.ie.PluginHostCrashVdiConsoleSession;case b.ps.FallbackToLocalOnRemoteFailure:return c.ie.PluginHostCrashFallbackToLocalOnRemoteFailure;case b.ps.EndpointShutdown:return c.ie.PluginHostCrashEndpointShutdown;default:return c.ie.PluginHostCrashed}}static async getLinkedChatId(e,t,i,n,a,o,s){let l;if(s===r.Y_.Content||a&&("mri"in e&&(l=e.mri)&&l.startsWith(S.Yg)||"callType"in e&&"oneToOnePstnCall"===e.callType))return Promise.resolve(void 0);{let a=await y.messageUniqueIdentifierFromCallingIntent(e,t,i,n);if(!o)return a?.convId;if(!a)return;let{convId:r,rootMessageId:s}=a;return this.isChannelMeeting(s)?`${r};replyChainId=${s}`:r}}static async messageUniqueIdentifierFromCallingIntent(e,t,i,n){let a=this.messageUniqueIdentifierFromCoordinates(e);if("mri"in e){let i=n.isVoiceAppMri(e.mri||"");a.convId=await this.conversationIdFromMri(e.mri,t,!i)}else if("teamsCallId"in e)return this.messageUniqueIdentifierFromTeamsCallId(e.teamsCallId,i);return a}static toStartPstnCallOptions(e,t,i,n,a){let{joinOptions:r,coordinates:o}=e;if(!("mri"in o))throw Error("mri property not found with coordinates object for interface OneToOneCoordinates.");return{dialoutNumber:n&&!a?-1===o.mri.indexOf(S.Wp)?o.mri.substring(S.Yg.length):o.mri.substring(S.Yg.length,o.mri.indexOf(S.Wp)):o.mri.substring(S.Yg.length),context:t,consultationContext:i,withVideo:r.outgoingVideo,muted:!r.outgoingAudio,dtmfPortion:r.extension,onBehalfOf:r.onBehalfOf,onBehalfOfUserDisplayName:r.onBehalfOfUserDisplayName,emergencyResult:r.emergencyResult,callQueueContext:r.callQueueContext}}static toJoinType(e,t){let{isPSTN:i,outgoingVideo:n,outgoingAudio:a,incomingAudio:r}=e.joinOptions;return i||!t.isIPAudioModeEnabled?_.AH.pstn:n||a||!1!==r?_.AH.normal:_.AH.contentOnly}static toSkypeMeetingInfo(e,t){return{conversationId:e.conversationId,isInstantMeeting:!!e.instantMeeting,schedulingServiceEventPromise:e.instantMeeting&&e.instantMeeting.schedulingServiceEventPromise,meetingType:e.isChannel?r.wJ.Team:r.wJ.Chat,replyChainMessageId:e.messageId,messageId:e.rootMessageId||e.messageId,skypeTeamsMeetingUrl:e.skypeTeamsMeetingUrl,isPstnEnabled:t.isPSTN,correlationId:t.correlationId,title:t.title,meetingCloud:e.meetingCloud,organizerId:e.organizerId,tenantId:e.tenantId,isBroadcast:!!e.broadcast,broadcastRole:e.broadcast&&e.broadcast.role}}static toJoinCallOptions(e,t,i){return{callInfo:{conversationId:i,messageId:t.messageId,callId:t.callId,teamsCallId:t.teamsCallId,isScreenshareFromChat:t.isScreenshareFromChat,isAudioDropInCall:e.type===g.G.GroupCall?e.joinOptions.isAudioDropInCall:void 0},audioOnly:t.isScreenshareFromChat||!e.joinOptions.outgoingVideo,screenSharingOnly:t.isScreenshareFromChat,joinContext:e.joinOptions.context,conversationId:i}}static toMeetingInfo(e){if(!e.organizerId||!e.tenantId)return;let t={tenantId:e.tenantId,organizerId:e.organizerId,replyChainMessageId:e.messageId,meetingType:e.isChannel?n.CallMeetingType.Channel:n.CallMeetingType.Private};return e.broadcast&&(t.isBroadcast=!!e.broadcast,t.broadcastRole=e.broadcast&&y.getBroadcastRoleString(e.broadcast.role)),t}static getBroadcastRoleString(e){switch(e){case o.tf.Producer:return C.q.constants.role.producer;case o.tf.Contributor:return C.q.constants.role.contributor;default:return null}}static toCommonCallOptions(e,t,i){let{coordinates:n,joinOptions:a}=e,{mainScenario:r,secondaryScenarios:o}=y.resolveCallingScenarios(e,i);return{conversationId:n.conversationId,messageId:n.rootMessageId,meetingInfo:y.toMeetingInfo(n),muted:!a.outgoingAudio,joinEventAsAttendee:!!a.joinEventAsAttendee,mutedSpeakers:!1===a.incomingAudio,joinType:y.toJoinType(e,t),audioUsageMode:a.audioUsageMode,startCallScenarioPromise:Promise.resolve(r),secondaryScenarios:o,participantPin:n?.participantPin,participantRegistrationId:n.registration&&n.registration.participantRegistrationId}}static toCallOptions(e,t,i){let{coordinates:n,joinOptions:a}=e;return{...y.toCommonCallOptions(e,t,i),isChannelMeeting:n.isChannel,withVideo:a.outgoingVideo,title:a.title,captchaContentJson:a.captchaContentJson,meetingGroups:{meetingGroups:a.adhocMeetingSpace?.mri?[{id:a.adhocMeetingSpace.mri}]:[]}}}static toJoinCallParams(e,t,i,n){let{joinOptions:a}=e;return{...y.toCommonCallOptions(e,i,n),callId:t.callId,teamsCallId:t.teamsCallId,callUrl:t.callUrl,audioOnly:!a.outgoingVideo,captchaContentJson:e.joinOptions?.captchaContentJson}}static async toPlaceCallOptionsAsync(e,t,i,n,a){let r=await this.conversationIdFromCallingIntentAsync(e.coordinates,t,n);return this.toPlaceCallOptionsInternal(e,i,r,a)}static toPlaceCallOptionsInternal(e,t,i,n){return{conversationId:i.convId,messageId:i.rootMessageId,withVideo:e.joinOptions.outgoingVideo,isEchoBotCall:e.joinOptions.context===s.l.EchoBotCall,isAudioDropInCall:e.type===g.G.GroupCall?e.joinOptions.isAudioDropInCall:void 0,isChannelMeeting:!1,context:t,onBehalfOf:e.type===g.G.OneToOneCall?e.joinOptions.onBehalfOf:"",onBehalfOfUserDisplayName:e.type===g.G.OneToOneCall?e.joinOptions.onBehalfOfUserDisplayName:"",targetApplicationType:e.type===g.G.OneToOneCall?e.joinOptions.targetApplicationType:void 0,callQueueContext:e.type===g.G.OneToOneCall?e.joinOptions.callQueueContext:void 0,alternateId:e.type===g.G.OneToOneCall||e.type===g.G.GroupCall?e.joinOptions.alternateId:void 0,groupId:e.coordinates.type===g.G.GroupCall?e.coordinates.groupId:void 0,invitationData:e.joinOptions.invitationData,screenSharingOnly:n?(e.type===g.G.OneToOneCall||e.type===g.G.GroupCall)&&e.joinOptions.shareDesktop:void 0}}static areCoordinatesEquivalent(e,t,i){let n=i.getCallByCoordinates(e),a=i.getCallByCoordinates(t);return!!this.areCallCoordinatesEquivalent(e,t,n,a)||(e.type===g.G.Meeting&&t.type===g.G.Meeting?this.areMeetingCoordinatesEquivalent(e,t,n,a):this.isEqualCoordsConvIdMessageIdInternal(this.messageUniqueIdentifierFromCoordinates(e),this.messageUniqueIdentifierFromCoordinates(t),n,a))}static areCoordinatesEquivalentAsync(e,t,i,n){let a=n.getCallByCoordinates(e),r=n.getCallByCoordinates(t);return this.areCallCoordinatesEquivalent(e,t,a,r)?Promise.resolve(!0):this.areCoordinatesEquivalentInternalAsync(e,t,a,r,i)}static async conversationIdFromCallingIntentAsync(e,t,i){let n=this.messageUniqueIdentifierFromCoordinates(e);if(i&&e.type===g.G.OneToOneCall){let t=e?.conversationId;if(t)return n.convId=t,n}if("mri"in e){let i=e.mri,a=await t.getChatConversationWith(i);if(!a)throw Error(`Conversation not found with mri: ${e.mri}`);n.convId=a.id}return n}static async coordinatesTypeFromCallAsync(e,t,i){return p.eU.isOneToOnePstnCall(t)||t.isEmergencyCall||t.callType===n.CallType.P2P?g.G.OneToOneCall:this.isMeeting(t)?g.G.Meeting:p.eU.isSkypeGroupCallV1(t)?g.G.GroupCall:this.coordinatesTypeFromConversation(t,e,i)}static isMeetingNudge(e){return["scheduledTownhall","scheduledMeeting","adHocMeeting"].includes(e.conversationType)}static async getCallingIntentTypeFromCall(e,t,i){if(y.isMeetingNudge(e))return g.G.Meeting;if(["groupCall","goLiveGroupCall","emergencyGroupCall","huddleGroupCall"].includes(e.conversationType))return g.G.GroupCall;if(["screenSharingCall"].includes(e.conversationType))return g.G.OneToOneCall;if(!e.conversationType||["cast"].includes(e.conversationType)){let t=e.isBreakoutRoom(),i=p.eU.isSkypeGroupCallV1(e),a=p.eU.isOneToOnePstnCall(e)||e.isEmergencyCall||e.callType===n.CallType.P2P||e.teamsCallType===n.CallType.P2P;if(t)return g.G.Meeting;if(i)return g.G.GroupCall;if(a)return g.G.OneToOneCall}return i?(t?.logging?.logger?.warnToTelemetry?.("[getCallingIntentTypeFromCall] Using conversation service to determine fallback call type.","get_calling_intent_type_from_call",{context:t.logging.context},!0),this.coordinatesTypeFromConversation(e,i,t)):(t?.logging?.logger?.warnToTelemetry?.("[getCallingIntentTypeFromCall] Returning fallback group call type, as conversation service is not included as an argument.","get_calling_intent_type_from_call",{context:t.logging.context},!0),g.G.GroupCall)}static async coordinatesTypeFromConversation(e,t,i){let n;if(!e.conversationId)return i?.logging?.logger.warn(`No conversationId found for call. Returning unknown call type. context=${i?.logging?.context}`),"unknown";try{n=await t.getConversation(e.conversationId,i?.logging?.context)}catch(t){if(i&&i.logging){let n=`Failed to get conversation for threadId=${e.conversationId} error=${t.message}`;i.logging.logger.infoToTelemetry?.(n,`get_conversation_error-${i.logging.context}`,void 0,!0)||i.logging.logger.info(`${n}`)}}return this.coordinatesTypeFromConversationInternal(n,e,i?.settings)}static isMeeting(e){return e.getIntent()?.type===g.G.Meeting||e.isBreakoutRoom()||"scheduledMeeting"===e.conversationType||"adHocMeeting"===e.conversationType}static coordinatesTypeFromConversationInternal(e,t,i){return e?e.isOneOnOne()?g.G.OneToOneCall:e.isMeetingConversation()||e.isChannelConversation()?g.G.Meeting:e.isGroupChat()||i?.enableNewlyCreatedChatGroupCallToast&&"groupCall"===t.conversationType&&e.members?.length===0||i?.enableFixForEmergencyGroupCallToast&&"emergencyGroupCall"===t.conversationType&&e.members?.length===0||i?.enableLieConversationForGroupCallsFix&&e.isLie()&&t.teamsCallType===n.CallType.Conference?g.G.GroupCall:t.teamsCallType===n.CallType.P2P?g.G.OneToOneCall:g.G.Meeting:i?.enableDecouplingGroupCallFromChat&&"scheduledMeeting"!==t.conversationType&&"adHocMeeting"!==t.conversationType||i?.enableNewlyCreatedChatGroupCallToast&&"groupCall"===t.conversationType||i?.enableFixForEmergencyGroupCallToast&&"emergencyGroupCall"===t.conversationType?g.G.GroupCall:g.G.Meeting}static resolveCallingScenarios(e,t){let i=e.mainScenario&&t.findScenarioByNameAndId(e.mainScenario.name,e.mainScenario.clientId),n=(i?e.activeScenarios.filter(e=>e&&e.clientId!==i.clientId&&e.name!==i.name):[]).map(e=>t.findScenarioByNameAndId(e.name,e.clientId));return{mainScenario:i,secondaryScenarios:n=(0,a.compact)(n)}}static coordinatesFromCallInfo(e,t){return{type:g.G.Meeting,joinType:m.c.Legacy,conversationId:e.conversationId,messageId:e.replyChainMessageId||e.messageId,rootMessageId:e.messageId,isChannel:"0"!==e.messageId,isAdhoc:!1,tenantId:e.meetingInfo&&e.meetingInfo.tenantId,organizerId:e.meetingInfo&&e.meetingInfo.organizerId,meetingCloud:t.getUserCloudDomain(),broadcast:null}}static intentToTelemetryData(e){let t={[u.gT.counters.eventNames.context]:e.joinOptions?.context,[u.gT.counters.eventNames.correlationId]:e.joinOptions?.correlationId||e.id};if(e.type===g.G.Meeting&&e.coordinates.joinType===m.c.Legacy){let i=e.coordinates;t={...t,[u.gT.counters.eventNames.meetingTenantId]:i.tenantId,[u.gT.counters.eventNames.messageId]:i.messageId,[u.gT.counters.eventNames.threadId]:i.conversationId,[u.gT.counters.eventNames.isBroadcast]:!!i.broadcast,[u.gT.counters.eventNames.broadcastRole]:i.broadcast?o.tf[i.broadcast.role]:null,[u.gT.categories.broadcastRole]:i.broadcast?o.tf[i.broadcast.role]:null,[u.gT.counters.eventNames.coldDeepLinkJoin]:!!e.joinOptions?.coldDeepLinkJoin}}return t[u.gT.counters.eventNames.homeCloud]=e.joinOptions?.homeCloud,t}static messageUniqueIdentifierFromCoordinates(e){return e.type===g.G.Meeting&&e.joinType===m.c.Legacy?{convId:e.conversationId,rootMessageId:e.rootMessageId,replyChainMessageId:e.messageId}:{convId:"conversationId"in e?e.conversationId:void 0,rootMessageId:void 0}}static messageUniqueIdentifierFromTeamsCallId(e,t){let i=t.getCallByTeamsCallId(e);return{convId:i.conversationId,rootMessageId:i.messageId,replyChainMessageId:i.meetingInfo?.replyChainMessageId}}static async conversationIdFromMri(e,t,i=!0){let n=await t.getConversationWithV2(e,"messageUniqueIdentifierFromCallingIntent",void 0,i);if(!n)throw Error(`Conversation not found with mri: ${e}`);return n.id}static areCallCoordinatesEquivalent(e,t,i,n,a,r){let o=e=>e.type===g.G.OneToOneCall||r&&"oneToOneCall"===e.callType;return e.type===g.G.AgentMonitorSession&&t.type===g.G.AgentMonitorSession?e.agentId===t.agentId:this.isEqualCoordsTeamsCallId(e,t,i,n,a)||o(e)&&o(t)&&this.isEqualCoordsMri(e,t,i,n,a)}static async areCoordinatesEquivalentInternalAsync(e,t,i,n,a,r,o){let s=e=>e.type===g.G.Meeting;return s(e)&&s(t)?this.areMeetingCoordinatesEquivalent(e,t,i,n,r):this.isAgentMonitorSessionCoords(e)&&this.isAgentMonitorSessionCoords(t)?this.areAgentMonitorSessionCoordinatesEquivalent(e,t):this.isEqualCoordsConvIdMessageIdAsync(e,t,a,i,n,r,o)}static intentFromOldIntent(e,t,i){let n={instanceId:t.generateUUID(),type:e.type,coordinates:{...e.coordinates},joinOptions:{context:i.context,showPrejoin:e.joinOptions?.showPrejoin,correlationId:t.generateUUID(),outgoingVideo:e.joinOptions?.outgoingVideo,outgoingAudio:e.joinOptions?.outgoingAudio,incomingVideo:e.joinOptions?.incomingVideo,incomingAudio:e.joinOptions?.incomingAudio,retryCount:(e.joinOptions?.retryCount||0)+1,retryOnNewTab:e.joinOptions?.retryOnNewTab,previousScenario:e.mainScenario&&e.mainScenario.name},activeScenarios:[]};if(e.type===g.G.Meeting&&n.type===g.G.Meeting){n.joinOptions.title=e.joinOptions.title;let t=n.coordinates,r=i.meetingData;t.joinType===m.c.MeetingData&&!(0,a.isEmpty)(r)&&(r.meetingCode&&(t.meetingData={meetingCode:r.meetingCode}),r.passcode&&(t.meetingData.passcode=r.passcode)),t.isAdhoc&&(t.joinType===m.c.Legacy&&t.isChannel?((!t.rootMessageId&&i.rootMessageId||i.replyChainMessageId)&&(t.isAdhoc=!1),t.rootMessageId=t.rootMessageId||i.rootMessageId,t.messageId=t.messageId||i.replyChainMessageId):(t.joinType===m.c.Legacy&&t.conversationId||t.joinType===m.c.MeetingData&&!(0,a.isEmpty)(t.meetingData))&&(t.isAdhoc=!1))}return n}static isOneToOnePstnCoords(e,t){let i=e=>e.type===g.G.OneToOneCall,n=e=>!!(e&&e.startsWith(S.Yg));return i(e)&&i(t)&&n(e.mri)&&n(t.mri)}static isEqualCoordsTeamsCallId(e,t,i,n,a,r){let o="teamsCallId"in e&&e.teamsCallId||i&&i.teamsCallId,s="teamsCallId"in t&&t.teamsCallId||n&&n.teamsCallId,l=!!o&&!!s&&o===s;if(l&&a?.info(`[isEqualCoordsTeamsCallId] #callpopout teamsCallId : ${o}`),this.isOneToOnePstnCoords(e,t)&&r){let i="callId"in e&&e.callId,n="callId"in t&&t.callId;l=l||!!i&&!!n&&i===n,a?.info(`[isEqualCoordsTeamsCallId] comparing PSTN coodinates : callIdA: ${i}, callIdB: ${n}`)}return l}static isEqualCoordsMri(e,t,i,n,a){let r=e.mri||i&&i.callerMri,o=t.mri||n&&n.callerMri,s=!!r&&!!o&&r===o;return s&&a?.info("[isEqualCoordsMri] #callpopout match on mri"),s}static async isEqualCoordsConvIdMessageIdAsync(e,t,i,n,a,r,o){let s=await this.conversationIdFromCallingIntentAsync(e,i),l=await this.conversationIdFromCallingIntentAsync(t,i);return this.isEqualCoordsConvIdMessageIdInternal(s,l,n,a,r,o)}static isEqualCoordsConvIdMessageIdInternal({convId:e,rootMessageId:t},{convId:i,rootMessageId:n},a,r,o,s){e=e||a?.conversationId||a?.threadId,i=i||r?.conversationId||r?.threadId,t=t||a&&a.messageId,n=n||r&&r.messageId;let l=e=>s?!e||"0"===e:!e,c=!!(e&&i&&e===i&&(t&&n&&t===n||l(t)&&l(n)));return c&&o?.info(`[isEqualCoordsConvIdMessageIdInternal] #callpopout match on conversationId ${e} and messageId ${t}`),c}static areMeetingCoordinatesEquivalent(e,t,i,n,a){let r=e.joinType===m.c.MeetingData&&t.joinType===m.c.MeetingData&&this.areMeetingDataCoordinatesEquivalent(e,t,i,n,a),o=e.joinType===m.c.Legacy&&t.joinType===m.c.Legacy&&this.isEqualCoordsConvIdMessageIdInternal(this.messageUniqueIdentifierFromCoordinates(e),this.messageUniqueIdentifierFromCoordinates(t),i,n,a)&&e.organizerId===t.organizerId&&e.tenantId===t.tenantId;return r||o}static areAgentMonitorSessionCoordinatesEquivalent(e,t){return e.type===g.G.AgentMonitorSession&&t.type===g.G.AgentMonitorSession&&e.agentId===t.agentId}static areMeetingDataCoordinatesEquivalent(e,t,i,n,a){let r=i?.meetingData?.meetingCode,o=i?.meetingData?.meetingUrl;e.joinType===m.c.MeetingData&&(r=e.meetingData?.meetingCode,o=e.meetingData?.meetingUrl);let s=n?.meetingData?.meetingCode,l=n?.meetingData?.meetingUrl;return(t.joinType===m.c.MeetingData&&(s=t.meetingData?.meetingCode,l=t.meetingData?.meetingUrl),r&&s&&r===s)?(a?.info(`[areMeetingDataCoordinatesEquivalent] #callpopout match on meetingCode: ${r}`),!0):o&&l&&o===l?(a?.info(`[areMeetingDataCoordinatesEquivalent] #callpopout match on meetingUrl: ${o}`),!0):void 0}static isChannelMeeting(e){return!!(e&&e!==h.c1)}static legacyMeetingCoordinatesFromCall(e,t,i){let n=e.getIntent();if(n&&n.type===g.G.Meeting&&n.coordinates.joinType===m.c.Legacy)return n.coordinates;let a=t.getCallByCallId(e.conversationId,e.callId),r=e.meetingInfo||a&&a.meetingInfo||e.setupArgs&&e.setupArgs.meetingInfo,s=r&&r.isBroadcast?{role:r.broadcastRole}:null;return{type:g.G.Meeting,joinType:m.c.Legacy,conversationId:e.threadId,messageId:r&&r.replyChainMessageId||e.messageId,rootMessageId:e.messageId,isChannel:y.isChannelMeeting(e.messageId),isAdhoc:!1,tenantId:r&&r.tenantId||"",organizerId:r&&r.organizerId||"",meetingCloud:i.getUserCloudDomain(),broadcast:s||e.broadcastMetadata?{role:o.tf.None}:null}}static meetingCodeCoordinatesFromCall(e){return{type:g.G.Meeting,joinType:m.c.MeetingData,meetingData:e.meetingData,isAdhoc:!1}}static toMeetingCoordinatesFromCall(e,t,i){return e.meetingData?y.meetingCodeCoordinatesFromCall(e):y.legacyMeetingCoordinatesFromCall(e,t,i)}static toOneToOneCoordinatesFromCall(e){let t=e.callQueueInfo&&e.callQueueInfo.onBehalfOf?e.callQueueInfo.onBehalfOf.id:e.callerMri??"";return{type:g.G.OneToOneCall,callId:e.callId,mri:t,conversationId:e.conversationId}}static toGroupCoordinatesFromCall(e){return{type:g.G.GroupCall,callId:e.callId,conversationId:e.threadId}}static isTflMeeting(e,t,i){e.meetingUrl||t?.populateMeetingData(e);let n=!1;if(e.meetingUrl)try{let t=new URL(e.meetingUrl);n=t?.host==="teams.live.com"}catch(e){i.error("Failed to parse meetingUrl")}return n}static isOneToOneTfwTflInteropCallIntent(e,t,i){return t?i(e.coordinates.mri):e.joinOptions.targetApplicationType===n.TargetApplicationType.TFL}static isGroupTfwTflInteropCallIntent(e,t,i){if(e.type!==g.G.GroupCall)return!1;{let n=e.coordinates.participants||[];return n.some(e=>!!e&&t(e))&&n.some(e=>!!e&&i(e))}}}y.isAgentMonitorSessionCoords=e=>e.type===g.G.AgentMonitorSession},443889:function(e,t,i){i.d(t,{$9:()=>g,$c:()=>k,Ch:()=>l,Dr:()=>M,FG:()=>S,G_:()=>b,IK:()=>o,Jq:()=>A,NZ:()=>h,P_:()=>P,Pf:()=>C,QW:()=>c,RE:()=>n,Ts:()=>v,Wp:()=>s,YP:()=>R,Yg:()=>a,_W:()=>p,bT:()=>m,dG:()=>D,f$:()=>d,hg:()=>f,iO:()=>E,lP:()=>w,r8:()=>_,rl:()=>I,u0:()=>T,yi:()=>u,zV:()=>y,zq:()=>r});let n="28:",a="4:",r="sfb:",o="8:",s=";ext=",l="meeting",c="tenantid",d="tenantId",g="awareness_conversationLiveState",h="importance",p="Text",u="RichText",m="RichText/Html",_="RichText/Media_FlikMsg",S="RichText/UriObject",C="RichText/Media_Card",v="RichText/Contacts",f="RichText/Files",b="RichText/Sms",y="RichText/Location",T="Signal/Flamingo",I="Message",A="orgid:",E="gcch:",M="dod:",P="gal:",k="8:acs",D="8:gcch-acs",R="19:preview-",w="interopconversationstatus"},973425:function(e,t,i){i.d(t,{Z:()=>h,w:()=>r});var n=i(206898),a=i(817218);let r={publicCommercialCloud:"teams.microsoft.com",gccHighCloud:"gov.teams.microsoft.us",dodCloud:"dod.teams.microsoft.us",dev:"local.teams.office.com",devLive:"local.teams.live.com",liveCloud:"teams.live.com",ag08Cloud:"https://teams.eaglex.ic.gov",ag09Cloud:"https://teams.microsoft.scloud"},o=/^(\s|\/)+|(\s|\/)+$/g,s="meetup-join";function l(e,t){return[r.dev,r.publicCommercialCloud].includes(t)?[r.devLive,r.liveCloud].includes(e):!![r.devLive,r.liveCloud].includes(t)&&[r.dev,r.publicCommercialCloud].includes(e)}function c(e){let t;try{t=new URL(e)}catch(e){return!1}let i=t.pathname.replace(o,"").split("/");return 4===i.length&&i[1]===s&&!!i[2]||2===i.length&&"meet"===i[0]&&!!i[1]}function d(e,t){let i;try{i=new URL(e)}catch(e){return!1}return!!c(e)&&l(i.hostname,t)}function g(e){return e.substring(e.lastIndexOf(":")+1)}let h={getMeetingLegacyURL:function(e){let{tenantId:t,organizerId:i,meetingCloud:n,conversationId:a,rootMessageId:r,messageId:o}=e,s=encodeURIComponent(a),l=encodeURIComponent(r),c=encodeURIComponent(JSON.stringify({Tid:t,Oid:i?g(i):"",MessageId:o||void 0}));if(s&&l&&i&&t&&n)return`https://${n}/l/meetup-join/${s}/${l}?context=${c}`},isCrossCloudMeetingJoinAttempt:function(e,t){return!(!e||t===e||l(e,t))&&(t!==r.dev||e!==r.publicCommercialCloud)&&(t!==r.devLive||e!==r.liveCloud)},isCrossCloudMeetingJoinAttemptBetweenTFLAndTFW:l,isInteropJoinAttemptBetweenTFLAndTFW:function(e,t){return e===a.G7.life&&t===a.G7.prod||e===a.G7.prod&&t===a.G7.life},isCrossCloudMeetingJoinBetweenTFLAndTFWAllowed:d,isDeepLinkExecutionForCrossCloudMeetingJoinBetweenTFLAndTFWAllowed:function(e,t,i){let n,a;try{n=new URL(e).hostname,a=i&&d(t,n)}catch(e){a=!1}return a},isLegacyMeetingUrl:function(e){let t;try{t=new URL(e)}catch(e){return!1}let i=t.pathname.replace(o,"").split("/");return 4===i.length&&i[1]===s&&!!i[2]},isMeetingUrl:c,isTFWDomain:function(e){return[r.dev,r.publicCommercialCloud].includes(e)},isTFWCloud:function(e){return e===a.G7.prod},stripMriPrefix:g,isTFLMeetingURL:function(e){try{let t;return e&&(t=new URL(e)),[r.liveCloud,r.devLive].includes(t?.host)}catch(e){return!1}},getMeetingCloudDomain:function(e){switch(e.joinType){case n.c.Legacy:return e.meetingCloud;case n.c.MeetingData:if(e.meetingData?.meetingUrl){let t;try{t=new URL(e.meetingData?.meetingUrl)}catch(e){return""}return t.hostname}default:return""}}}},968316:function(e,t,i){i.d(t,{P:()=>n});function n(){let e={};return e.promise=new Promise((t,i)=>{e.resolve=t,e.reject=i}),e}},793841:function(e,t,i){i.d(t,{$N:()=>T,D0:()=>o,Ij:()=>r,OY:()=>f,QQ:()=>g,Sr:()=>h,UG:()=>l,YU:()=>_,Zd:()=>b,bS:()=>a,cN:()=>s,g$:()=>y,jG:()=>d,k$:()=>u,kt:()=>C,nV:()=>c,q:()=>m,sl:()=>v,x$:()=>p});var n=i(892891);let a=e=>e.meetingGroupDetails?.groups?.languageGroup?.[0]?.id,r=e=>o(e)?.label,o=e=>{let t=a(e);return S(e,t)},s=(e,t)=>(c(e)||[]).filter(e=>e.interpreters?.includes(t)).map(e=>({id:e.id,label:e.label})).sort((e,t)=>e.label.localeCompare(t.label)),l=e=>!!e.propertyBag?.aiInterpretationEnabled?.value,c=e=>e.meetingDetails?.meetingGroups?.groups?.languageGroup,d=e=>{let t=e.meetingDetails?.meetingGroups?.groups;return t?.floorGroup||t?.meshDefaultGroup||[]},g=e=>{let t=c(e);return!!t&&t.length>0},h=e=>!!e.meetingDetails?.meetingCapability?.interpretationEnabled,p=e=>h(e)&&g(e),u=e=>!!e.meetingDetails?.meetingCapability?.aiInterpretationEnabled,m=e=>e.participants.filter(t=>!_(t)&&b(e,t).length>0).length+ +!!a(e),_=e=>e?.advancedMeetingRole==="interpreter",S=(e,t)=>c(e)?.find(e=>e.id===t),C=(e,t)=>c(e)?.find(e=>e.label===t)?.id,v=(e,t)=>S(e,t)?.label,f=(e,t)=>(0,n.map)(t?.endpoints?.endpointDetails,t=>{let i=(0,n.map)(t.meetingGroupDetails?.groups?.languageGroup,e=>e.id),a=i.map(t=>S(e,t)?.label);return{participantId:t.participantId,groupIds:i,groupLabels:a}}),b=(e,t)=>(0,n.flatMap)(f(e,t),e=>e.groupIds),y=async(e,t,i)=>{if(1!==i)return;if(t)return{name:(await e.getSelfParticipant()).displayName,isMasked:!1};let n=e.participants.find(t=>!_(t)&&b(e,t).length>0);if(n)return e.meetingDetails?.meetingCapability?.maskIdentitiesForRole&&"attendee"===n.meetingRole?{name:n.nonMaskedDisplayName||"",isMasked:!0}:{name:n.displayName,isMasked:!1}},T=e=>e.includes("dev")||e.includes("int")},32416:function(e,t,i){i.d(t,{C:()=>a});var n=i(575810);let a=(e,t,i,a)=>{let r=e();if(!r)return a.info(`[isLocationAccessSettingsAvailable] invoked with [enableLocationAccessSettings=${r}]`),!1;let o=t.getOS();switch(o){case n.gT.os.windows:let s=t.getPlatformOSVersion(),l=i.compareVersions(s,n.gT.minWindowsOsVersion.windows11.Germanium)>=0;return a.info(`[isLocationAccessSettingsAvailable] invoked with [enableLocationAccessSettings=${r}][isMinWindowsOsMet=${l}] on Windows [version=${s}]`),r&&l;case n.gT.os.mac:return a.info(`[isLocationAccessSettingsAvailable] invoked with [enableLocationAccessSettings=${r}] on Mac`),r;default:return a.info(`[isLocationAccessSettingsAvailable] invoked with [enableLocationAccessSettings=${r}] on ${o}`),r}}},590742:function(e,t,i){i.d(t,{_:()=>r});var n=i(892891);let a="(redacted)",r={isValidE911NetworkInfo(e){if(!e)return!1;let{geoCoordinates:t,...i}=e;return!(0,n.isEmpty)(i)&&!(0,n.every)(i,n.isNil)},isValidGeoCoordinates(e){if(!e||(0,n.isEmpty)(e))return!1;let{accuracy:t,...i}=e;return(0,n.every)(i,e=>!(0,n.isNil)(e)&&"number"==typeof e&&!isNaN(e))},maskNotificationDialOutNumber:e=>e?`${e.slice(0,-4)}****`:"",sanitizeEmergencyCallingPolicyForLogging(e){let t={...e};return t.notificationDialOutNumber&&(t.notificationDialOutNumber=r.maskNotificationDialOutNumber(t.notificationDialOutNumber)),t},redactAddressForLogging(e){let t={...e};return["houseNumber","houseNumberSuffix","streetName","streetSuffix","cityOrTown","stateOrProvince","postalOrZipCode","additionalInfo","companyName","countyOrDistrict","postDirectional","preDirectional"].forEach(e=>{e in t&&(t[e]=a)}),t},sanitizeEmergencyAddressResultForLogging(e){let t={...e};t.address&&(t.address=r.redactAddressForLogging(t.address));let i=r.maskGeoCoordinatesForLogging(t.geocoordinates);return{...t,geocoordinates:i||void 0}},maskCoordinatesForLogging(e){let t={...e};return t.latitude&&(t.latitude=t.latitude.replace(/[^\.\s\-]/g,"*")),t.longitude&&(t.longitude=t.longitude.replace(/[^\.\s\-]/g,"*")),t},maskGeoCoordinatesForLogging:e=>e&&r.isValidGeoCoordinates(e)?{...r.maskCoordinatesForLogging({latitude:e.latitude.toString(),longitude:e.longitude.toString()}),accuracy:e.accuracy}:null,sanitizeNetworkInfoForLogging(e){if(!e)return null;let t=r.maskGeoCoordinatesForLogging(e.geoCoordinates);return{...e,geoCoordinates:t||void 0}},sanitizeAreaContentForLogging(e){let t={...e};return t.postalCode&&(t.postalCode=a),t.geocoordinates&&(t.geocoordinates=r.maskCoordinatesForLogging(t.geocoordinates)),t},sanitizeNetworkLocationMatchInfoForLogging(e){let t={...e};if(t.matchingIdentity&&"CLS"===t.matchedNetworkType){let[e,i]=t.matchingIdentity.split(",");if(e&&i){let n=r.maskCoordinatesForLogging({latitude:e,longitude:i});t.matchingIdentity=`latitude: ${n.latitude}, longitude: ${n.longitude}`}}return t},sanitizeLocationInfoForLogging(e){let t={...e};return t.coordinates=r.maskCoordinatesForLogging(t.coordinates),t.address=r.redactAddressForLogging(t.address||{}),t},sanitizeLocationResponseForLogging(e){let t=(0,n.cloneDeep)(e);return t.emergencyCallingPolicy&&(t.emergencyCallingPolicy=r.sanitizeEmergencyCallingPolicyForLogging(t.emergencyCallingPolicy)),t.locationInfo&&(t.locationInfo=r.sanitizeLocationInfoForLogging(t.locationInfo)),t.debugInfo?.ncsDebugInfo?.networkLocationMatchInfo&&(t.debugInfo.ncsDebugInfo.networkLocationMatchInfo=r.sanitizeNetworkLocationMatchInfoForLogging(t.debugInfo.ncsDebugInfo.networkLocationMatchInfo)),t}}},397867:function(e,t,i){i.d(t,{D:()=>r,n:()=>o});let n={2:"prod",3:"prod",4:"prod",90:"prod",91:"prod",92:"prod",93:"life",94:"life",95:"life",990:"prod",991:"prod",992:"gcch",993:"dod",994:"prod",995:"prod",996:"prod",997:"gallatin"},a={prod:"teams.microsoft.com",life:"teams.live.com",gcch:"gov.teams.microsoft.us",dod:"dod.teams.microsoft.us",gallatin:"teams.microsoftonline.cn",airgap08:"teams.eaglex.ic.gov",airgap09:"teams.microsoft.scloud"},r=(e,t,i,r,o)=>{let s=new RegExp(e||"^(?<meetingCloudKey>[1-8]|9+[0-8])[1-9][0-9]*$").exec(o),l=s?.groups?.meetingCloudKey;if(!l)return r;let c=(t||n)[l];if(!c)return r;let d=(i||a)[c];return d?`https://${d}/`:r},o=(e,t,i,n,a,o)=>{let s=r(e,t,i,n,a),l=new URL(`meet/${a}`,s);return o&&l.searchParams.append("p",o),l.toString()}},526260:function(e,t,i){i.d(t,{s:()=>o});var n=i(892891);class a{constructor(){this.subscriptions=[]}subscribe(e){return new r(this.subscriptions,e)}dispose(){this.subscriptions=[]}raiseEvents(e){this.subscriptions.slice().forEach(t=>e(t.eventHandler))}}class r{constructor(e,t){this.subscriptions=e,this.eventHandler=t,e.push(this)}dispose(){(0,n.remove)(this.subscriptions,e=>e===this)}}class o extends a{changed(e){return this.subscribe({changed:e,on:null})}on(e,t){return this.subscribe({changed:null,on:{name:e,handler:this._toEventCallback(t)}})}once(e,t){let i,n=(...e)=>{i.dispose(),this._toEventCallback(t)(...e)};return i=this.on(e,this._fromEventCallback(n))}raiseChanged(){this.raiseEvents(e=>e.changed&&e.changed())}event(e){return{raise:this._fromEventCallback((...t)=>this._raiseEventImpl(e,...t))}}_raiseEventImpl(e,...t){this.raiseEvents(i=>i.on&&i.on.name===e&&i.on.handler(...t))}_toEventCallback(e){return e}_fromEventCallback(e){return e}}o.Type_All="%all",o.Key_All="%all"},250885:function(e,t,i){i.d(t,{o:()=>r});var n=i(892891);class a{constructor(){this._subscriptions={},this.subscriptionTokenCounter=1,this.subscriptionsByToken={},this._startedTrackingKeyForType=null,this._stoppedTrackingKeyForType=null}destroy(){this._subscriptions={},this.subscriptionsByToken={}}hasSubscribers(e="",t=""){if(!e&&!t)return!(0,n.isEmpty)(this.subscriptionsByToken);let i=this._subscriptions[e];return!!i&&(t?!!i[t]:Object.keys(i).length>0)}hasKeyedSubscribers(e){return!!(0,n.find)(this._subscriptions,t=>e in t)}subscribe(e,t=a.Type_All,i=a.Key_All){if(!i||!(0,n.isString)(i))throw Error(`Trying to subscribe to invalid key: ${i}`);this._subscriptions[t]||(this._subscriptions[t]={});let r=this._subscriptions[t],o=r[i];o?o.push(e):(r[i]=[e],this._startedTrackingKeyForType&&this._startedTrackingKeyForType(t,i));let s=this.subscriptionTokenCounter++;return this.subscriptionsByToken[s]={type:t,key:i,callback:e},s}unsubscribe(e){if(!this.subscriptionsByToken[e])return;let t=this.subscriptionsByToken[e].type,i=this.subscriptionsByToken[e].key,n=this.subscriptionsByToken[e].callback;delete this.subscriptionsByToken[e];let a=this._subscriptions[t];if(!a)throw Error(`No subscriptions under type ${t}`);let r=a[i];if(!r)throw Error(`No subscriptions under type ${t} and key ${i}`);for(let e=0;e<r.length;e++)if(r[e]===n){r.splice(e,1),0===r.length&&(delete a[i],this._stoppedTrackingKeyForType&&this._stoppedTrackingKeyForType(t,i));return}throw Error(`Callback not found in subscriptions for type ${t} and key ${i}`)}trigger(e=a.Type_All,t=a.Key_All,i){let{unkeyedCallbacks:n,keyedCallbacks:r}=this.getCallbacks(e,t),o=[];n.forEach(e=>{try{e(void 0,i)}catch(e){o.push(e)}}),r.forEach(e=>{try{e(t,i)}catch(e){o.push(e)}})}getCallbacks(e=a.Type_All,t=a.Key_All){let i=[],r=[];if(e===a.Type_All){if(t!==a.Key_All)throw Error("Can't trigger a specific key of all types");(0,n.each)(this._subscriptions[e],e=>{r=r.concat(e)})}else{let o=this._subscriptions[e];o&&(t===a.Key_All?(0,n.each)(o,e=>{r=r.concat(e)}):i=i.concat(o[t]||[]).concat(o[a.Key_All]||[]));let s=this._subscriptions[a.Type_All];s&&(0,n.each)(s,e=>{r=r.concat(e)})}return{keyedCallbacks:i,unkeyedCallbacks:r}}registerStartTrackingForType(e){this._startedTrackingKeyForType=(t,i)=>e(t,i)}registerStopTrackingForType(e){this._stoppedTrackingKeyForType=(t,i)=>e(t,i)}}a.Type_All="%all",a.Key_All="%all";class r{createObservable(){return new a}}},130736:function(e,t,i){i.d(t,{w:()=>r});var n=i(370574),a=i(892891);class r{static firstScreenShareFor(e){return o(e,n.StreamType.ScreenSharing)[0]}static firstVideoFor(e){return o(e,n.StreamType.Video).filter(s)[0]}static bestAvailableScreenShareFor(e){let t=o(e,n.StreamType.ScreenSharing).filter(e=>e.isAvailable);return(0,a.maxBy)(t,"rank")||t[0]}static bestScreenShareFor(e){return r.bestAvailableScreenShareFor(e)||r.firstScreenShareFor(e)}static bestAvailableVideoFor(e){let t=o(e,n.StreamType.Video).filter(e=>e.isAvailable&&s(e));return(0,a.maxBy)(t,"rank")||t[0]}static bestVideoFor(e){return r.bestAvailableVideoFor(e)||r.firstVideoFor(e)}}function o(e,t){return e&&e.streams&&e.streams[t]||[]}function s(e){return!e.label||"main-video"===e.label}},500536:function(e,t,i){i.d(t,{Ak:()=>r,DJ:()=>_,DP:()=>n,Tl:()=>m,Wv:()=>s,il:()=>p,r:()=>h,vb:()=>g,xt:()=>u,y8:()=>a});class n{}n.adminSettings="adminSettings",n.callingPolicySettings="callingPolicy",n.voicemailPolicy="voicemailPolicy",n.callParkPolicySettings="callParkPolicy",n.meetingPolicySettings="meetingPolicy",n.messagingPolicy="messagingPolicy",n.onlineDialinConferencingPolicy="onlineDialinConferencingPolicy",n.policySettings="policySettings",n.syntheticAutomatedCallPolicy="syntheticAutomatedCallPolicy",n.teamsMeetingBrandingPolicy="teamsMeetingBrandingPolicy",n.teamsMediaLoggingPolicy="teamsMediaLoggingPolicy",n.tenantSettings="tenantSettingsV2",n.tenantVoiceSettings="tenantVoiceSettings",n.userResourcesSettings="userResourcesSettings",n.voiceSettings="voiceAdminSettings",n.teamsEnhancedEncryptionPolicy="teamsEnhancedEncryptionPolicy",n.teamsEmergencyCallingPolicy="teamsEmergencyCallingPolicy",n.teamsEmergencyCallRoutingPolicy="teamsEmergencyCallRoutingPolicy",n.teamsUserPhoneNumbers="teamsUserPhoneNumbers",n.teamsChannelsPolicy="teamsChannelsPolicy",n.branchSurvivabilityPolicy="branchSurvivabilityPolicy",n.vdiPolicy="vdiPolicy",n.teamsMediaConnectivityPolicy="teamsMediaConnectivityPolicy",n.teamsAIPolicySettings="teamsAIPolicy";class a{}a.allowExternalParticipantGiveRequestControl="allowExternalParticipantGiveRequestControl",a.allowNDIStreaming="allowNDIStreaming",a.allowParticipantGiveRequestControl="allowParticipantGiveRequestControl",a.allowPowerPointSharing="allowPowerPointSharing",a.mediaBitRateKb="mediaBitRateKb",a.recordingStorageMode="recordingStorageMode",a.screenSharingMode="screenSharingMode",a.liveStreamingMode="liveStreamingMode",a.roomAttributeUserOverride="roomAttributeUserOverride",a.roomPeopleNameUserOverride="roomPeopleNameUserOverride",a.liveCaptionsEnabledType="liveCaptionsEnabledType",a.allowIPVideo="allowIPVideo",a.teamsCameraFarEndPTZMode="teamsCameraFarEndPTZMode",a.enrollUserOverride="enrollUserOverride",a.allowAnnotations="allowAnnotations",a.connectToMeetingControls="connectToMeetingControls",a.voiceIsolation="voiceIsolation";class r{}r.allowPrivateCalling="allowPrivateCalling",r.allowWebPSTNCalling="allowWebPSTNCalling",r.preventTollBypass="preventTollBypass";class o{}o.allowUserOverrideForCalling="teamsInteropPolicy.allowEndUserClientOverride",o.byot="byot",o.callingLineIdentityPolicy="policySettings.callingLineIdentityPolicy",o.dialPlanPolicy="dialPlanPolicy",o.iTUCountryPrefix="dialPlanPolicy.ituCountryPrefix",o.locationPolicy="locationPolicy",o.teamsInteropPolicy="teamsInteropPolicy",o.teamsMeetingPolicy="teamsMeetingPolicy";class s{}s.delegateSettings="delegationSettings",s.electedSettings="electedSettings",s.isEvEnabled="isEvEnabled",s.isTeamsPreferredClient="isTeamsPreferredClient",s.ringtoneSettings="ringtoneSettings",s.callGroupMembershipSettings="callGroupMembershipSettings",s.callRedirectionSettings="callRedirectionSettings",s.busyOnBusySetting="busyOnBusySetting",s.inboundPstnCallRedirectionSettings="inboundPstnCallRedirectionSettings",s.allowAutoDndSettings="allowAutoDndSettings",s.personalAttendantSettings="personalAttendantSettings";class l{}l.enableMeetingBackgroundImages="enableMeetingBackgroundImages",l.requireBackgroundEffect="requireBackgroundEffect",l.meetingBackgroundImages="meetingBackgroundImages";class c{}c.notificationGroup="notificationGroup",c.notificationDialOutNumber="notificationDialOutNumber",c.externalLocationLookupMode="externalLocationLookupMode",c.notificationMode="notificationMode",c.description="description",c.policyDocument="policyDocument",c.securityDeskMris="securityDeskMris",c.enhancedEmergencyServiceDisclaimer="enhancedEmergencyServiceDisclaimer";class d{}d.allowEnhancedEmergencyServices="allowEnhancedEmergencyServices",d.emergencyNumbers="emergencyNumbers",d.policyDocument="policyDocument";class g{}g.enrollVoice="enrollVoice",g.enrollFace="enrollFace",g.speakerAttributionForBYOD="speakerAttributionForBYOD",g.passiveVoiceEnrollment="passiveVoiceEnrollment";let h={disabled:"Disabled",enabled:"Enabled"},p={disabled:"Disabled",enabled:"Enabled"},u={disabled:"Disabled",enabled:"Enabled"},m={disabled:"Disabled",enabled:"Enabled"},_={disabled:"Disabled",enabled:"Enabled"}},324204:function(e,t,i){i.d(t,{O:()=>a});var n=i(968316);async function a(e,t,i=500){let r=(0,n.P)(),o=setTimeout(()=>r.reject(t),i),s=await Promise.race([e,r.promise]);return clearTimeout(o),s}},855273:function(e,t,i){i.d(t,{C:()=>r,U:()=>a});var n=i(370574);function a(e,t,i=!1,r=null,o){let s=null,l=null,c=()=>{s&&(s.dispose(),s=null),l&&l()},d=()=>{let i=t(e);(e.state===n.CallState.Disconnected||i)&&c()};return e.state!==n.CallState.Disconnected&&(s=o?e.on(o,d):e.changed(d)),i&&d(),r&&s&&(l=r(()=>c())),s}function r(e,t,i){let a=e.on(t,(...t)=>{(i(...t)||e.state===n.CallState.Disconnected)&&(a?.dispose(),a=null)});return a}},656511:function(e,t,i){i.d(t,{J5:()=>c,RI:()=>s,S4:()=>l,Yb:()=>r});var n=i(826757),a=i(370574);let r=e=>{let t=e.endpoints?.endpointDetails[0],i=t?n.eU.getSourceIdForMediaTypeFromEndpoint(t,a.MediaType.Data):n.eU.SOURCE_ID_ANY;return i===n.eU.SOURCE_ID_ANY?0:i},o=async(e,t)=>e?.callType===a.CallType.P2P?0===t?await e.getSelfParticipant():t===n.eU.SOURCE_ID_ANY?e?.participants[0]:void 0:t===r(e)?await e.getSelfParticipant():e?.participants?.find(e=>e?.endpoints?.endpointDetails?.find(e=>e?.mediaStreams?.find(e=>e?.type==="data"&&e?.sourceId===t))),s=async(e,t)=>{let i=await o(e,t);return i?.id??""},l=(e,t)=>e?.callerMri&&t.isPstnMri(e.callerMri)||t.isPstnMri(e.originalCalleeMri)||!0===e.isServerHold,c=(e,t,i)=>{let n=e.signerSelfIdentificationMinSlimcoreVersion?.()||"",a=t.getSlimCoreVersion();return a?!!(e.enableSignerSelfIdentification?.()&&n&&i.compareVersions(a,n)>=0):!!e.enableSignerSelfIdentification?.()}},440743:function(e,t,i){i.d(t,{BB:()=>o,Cu:()=>s,d5:()=>l,q:()=>r});var n=i(575810),a=i(910671);function r({provider:e,testShimEnabled:t,shimSlot2Enabled:i,shimSlot3Enabled:r,shimSlot4Enabled:o}){let s;switch(e){case a.$w.citrixXenDesktop:case a.$w.citrixXenApp:s="vdiCitrixPeerConnection";break;case a.$w.wvd:s="vdiWVDPeerConnection";break;case a.$w.vmware:s="vdiVMwarePeerConnection"}if(!s)return;let l="";switch(!0){case t:l="Test";break;case i:l="2";break;case r:l="3";break;case o:l="4"}return n.gT.lazyLoadedVendorFiles[`${s}${l}`]}function o(e){let t="";try{t=JSON.stringify(e)}catch{t="<unable to serialize>"}return t}function s(e,t){let i=/^\d+\.\d+\.\d+\.\d+$/,n=/^\d+\.\d+\.\d+-\d+$/;if(!((i.test(e)||n.test(e))&&(i.test(t)||n.test(t))))return!1;let a=i.test(e)&&i.test(t),r=e=>a?Number(e):e.split("-").map(Number),o=e.split(".").map(e=>r(e)),s=t.split(".").map(e=>r(e)),l=o.reduce((e,t,i)=>{if(null!==e)return e;if(Array.isArray(t)){let e=t.reduce((e,t,n)=>null!==e?e:t>(s[i][n]||0)||!(t<(s[i][n]||0))&&null,null);if(null!==e)return e}else{if(t>s[i])return!0;if(t<s[i])return!1}return null},null);return null===l||l}function l(e,t){return!!t.isUnoptimizedVDI()&&e.includes(a.y0[t.getVDIProvider()].toLowerCase())}},910671:function(e,t,i){i.d(t,{$w:()=>u,$y:()=>S,DS:()=>p,IL:()=>g,Pr:()=>_,Tr:()=>C,X8:()=>h,of:()=>m,y0:()=>f});var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C,v=i(575810);(n=g||(g={})).Failure="Failure",n.Normal="Normal",n.UnsupportedEndpoint="Unsupported Endpoint",n.UnsupportedSingleWindowEnvironment="Unsupported Single Window Environment",n.NoNetwork="No Network",n.Unknown="Unknown",(a=h||(h={})).EndpointDisconnected="endpointDisconnected",a.Failure="failure",a.EndpointUnsupported="endpointUnsupported",a.UnsupportedSingleWindowEnvironment="unsupportedSingleWindowEnvironment",(r=p||(p={})).Disconnected="Disconnected",r.DesktopVersion="DesktopVersion",r.Unknown="Unknown",r.None="None",r.AngularDeprecated="AngularDeprecated",r.MultiWindowCapabilityChange="MultiWindowCapabilityChange",(o=u||(u={}))[o.none=0]="none",o[o.citrixXenDesktop=1]="citrixXenDesktop",o[o.citrixXenApp=2]="citrixXenApp",o[o.vmware=3]="vmware",o[o.wvd=5]="wvd",o[o.aws=7]="aws",(s=m||(m={})).SlimCoreVDINotConnected="SlimCoreVDI is not connected.",s.CouldNotTrackCompositor="Could not track compositor.",s.CannotStopCompositorTracking="Cannot stop compositor tracking.",s.CouldNotSetupCompositorWindowTracking="No window information provided.",s.CannotTrackVideoElement="Cannot track video element",s.CannotStopTrackingVideoElements="Cannot stop tracking video elements",s.CannotStartOcclusionTracking="Cannot start occlusion tracking";let f={[u.none]:v.pk.none,[u.citrixXenDesktop]:v.pk.citrix,[u.citrixXenApp]:v.pk.citrix,[u.vmware]:v.pk.vmware,[u.wvd]:v.pk.avd,[u.aws]:v.pk.aws};(l=_||(_={})).vdiCallConstraintsChanged="vdiCallConstraintsChanged",l.vdiClientConnected="vdiClientConnected",l.vdiClientDisconnected="vdiClientDisconnected",l.vdiUnableToRemote="vdiUnableToRemote",l.vdiScreenTopologyChanged="vdiScreenTopologyChanged",l.vdiE911InfoChanged="vdiE911InfoChanged",l.vdiRequestEndCalls="vdiRequestEndCalls",(c=S||(S={})).Locked="Locked",c.Unlocked="Unlocked",c.Unknown="Unknown",c.Resumed="Resumed",c.Suspending="Suspending",(d=C||(C={})).avdSlot1="vdiWVDPeerConnection",d.avdSlot2="vdiWVDPeerConnection2",d.avdSlot3="vdiWVDPeerConnection3",d.avdSlot4="vdiWVDPeerConnection4",d.avdTestSlot="vdiWVDPeerConnectionTest",d.citrixSlot1="vdiCitrixPeerConnection",d.citrixSlot2="vdiCitrixPeerConnection2",d.citrixSlot3="vdiCitrixPeerConnection3",d.citrixSlot4="vdiCitrixPeerConnection4",d.citrixTestSlot="vdiCitrixPeerConnectionTest",d.vmwareSlot1="vdiVMwarePeerConnection",d.vmwareSlot2="vdiVMwarePeerConnection2",d.vmwareSlot3="vdiVMwarePeerConnection3",d.vmwareSlot4="vdiVMwarePeerConnection4",d.vmwareTestSlot="vdiVMwarePeerConnectionTest"},512304:function(e,t,i){var n,a,r,o;i.d(t,{W:()=>a,q:()=>n}),(r=n||(n={})).CallStackFailedToInit="call-stack-failed-init",r.CallStackNotInitialized="call-stack-uninit",r.DuplicateScenarioCreation="duplicate-scenario-creation",r.FailedToGenerateIntentId="failed-to-generate-intent-id",r.FailedToShowInteractionRequiredDialog="failed-to-show-interaction-required-dialog",r.InvalidStateParameters="invalid-state-parameters",r.InteractionRequired="interaction-required",r.ModernCallingContainerRemoved="modern-calling-container-removed",r.NotRelevantDuplicateAction="not-relevant-duplicate-action",r.NotWaitedForCallStackInit="not-waited-for-call-stack-init",r.TimeoutInCallStackInit="timeout-call-stack-init",r.WaitedForCallStackInit="waited-for-call-stack-init",r.WindowOpenResultError="window-open-result-err",r.UncaughtError="uncaught-err",r.UnknownEnqueueEntityCommandError="unknown-enqueue-entity-command-error",r.UnknownNavigatePromiseError="unknown-navigate-promise-error",(o=a||(a={})).ChunkLoadTimedOut="ChunkLoadTimedOut",o.ScriptLoadError="ScriptLoadError",o.SlotPhasedRenderingTimedOut="SlotPhasedRenderingTimedOut"},178402:function(e,t,i){i.d(t,{T:()=>n});let n={callingWindowingShowContainerInit:{scenarioName:"calling_windowing_show_container_init",steps:{generatedIntentId:"generated_intent_id"}},callingWindowingCreateContainer:{scenarioName:"calling_windowing_create_container",steps:{builtEntityCommand:"built_entity_command",determineMessageUniqueIdentifierDone:"determine_message_unique_identifier_done",enqueueEntityCommandDone:"enqueue_entity_command_done",ensuredNotInInteractionRequiredState:"ensured_not_in_interaction_required_state",ensuredCallingStackLoaded:"ensured_calling_stack_loaded",navigatePromiseDone:"navigate_promise_done",windowingActionDeduplicationDone:"windowing_action_deduplication_done",windowingContainerRegistered:"windowing_container_registered",windowingContainerRemovalDone:"windowing_container_removal_done"}},callingWindowingUpdateContainer:{scenarioName:"calling_windowing_update_container",steps:{builtEntityCommand:"built_entity_command",determineMessageUniqueIdentifierDone:"determine_message_unique_identifier_done",enqueueEntityCommandDone:"enqueue_entity_command_done",ensuredCallingStackLoaded:"ensured_calling_stack_loaded",navigatePromiseDone:"navigate_promise_done",windowUpdateEventSent:"window_update_event_sent",windowingActionDeduplicationDone:"windowing_action_deduplication_done",windowingContainerUpdated:"windowing_container_updated",windowNavigationDone:"window_navigation_done",intentMapUpdated:"intent_map_updated"}},callingWindowingRerenderContainer:{scenarioName:"calling_windowing_rerender_container",steps:{builtEntityCommand:"built_entity_command",determineMessageUniqueIdentifierDone:"determine_message_unique_identifier_done",enqueueEntityCommandDone:"enqueue_entity_command_done",ensuredCallingStackLoaded:"ensured_calling_stack_loaded",navigatePromiseDone:"navigate_promise_done",windowUpdateEventSent:"window_update_event_sent",windowingActionDeduplicationDone:"windowing_action_deduplication_done",windowingContainerUpdated:"windowing_container_updated",windowNavigationDone:"window_navigation_done",windowingContainerUpdateEventNotSent:"windowing_container_update_event_not_sent"}},windowingAction:{steps:{showContentInitStart:"show_content_init_start",showContentInitEnd:"show_content_init_end",failedToGenerateContainerId:"failed_to_generate_container_id",createContainerStart:"create_container_start",closeContainerStart:"close_container_start",closeContainerNotFound:"close_container_not_found",closeContainerFailed:"close_container_failed",closeContainerTimeout:"close_container_timeout",closeContainerSuccess:"close_container_success",showIntentEnd:"show_intent_end",conflictWithExistingWindowingAction:"conflict_with_existing_windowing_action",createContainerDeduplicated:"create_container_deduplicated",failedEnsureCallingStackLoaded:"failed_ensure_calling_stack_loaded",updateContainerStart:"update_container_start",updateContainerTargetContentFound:"update_container_target_content_found",updateContainerTargetContentNotFound:"update_container_target_content_not_found",updateContainerFailToFocus:"update_container_fail_to_focus",updateContainerUnexpectedFail:"update_container_unexpected_fail",updateContainerStop:"update_container_stop",rerenderContainerStart:"rerender_container_start",rerenderContainerCancel:"rerender_container_cancel",rerenderContainerIntentEventPromiseFailed:"rerender_container_intent_event_promise_failed",windowUpdateEventSent:"window_update_event_sent",windowingContainerUpdated:"windowing_container_updated",intentMapFailedToBeUpdated:"intent_map_failed_to_be_updated",newContentReplaceFailedIntentMismatch:"new_content_replace_failed_intent_mismatch",targetContentFetchFailure:"target_content_fetch_failure",targetIntentNotFound:"target_intent_not_found",newContentAlreadyRendering:"new_content_already_rendering",newContentAlreadyRenderingElsewhere:"new_content_already_rendering_elsewhere",newContentAlreadyShown:"new_content_already_shown",unexpectedErrorForGetExistingIntent:"unexpected_error_for_get_existing_intent",failedWindowingNavigation:"failed_windowing_navigation",intentEventResolutionFailure:"intent_event_resolution_failure",containerUpdatedWithoutFocus:"container_updated_without_focus",errorBoundaryError:"error_boundary_error",intentIdUndefined:"intent_id_undefined",authInteractionRequired:"auth_interaction_required",failedToShowInteractionRequiredDialog:"failed_to_show_interaction_required_dialog",callingStageNotFoundOnSingleWindowExperience:"calling_stage_not_found_on_single_window_experience"}}}},817218:function(e,t,i){var n,a,r,o,s,l,c,d,g,h,p,u,m,_,S,C,v,f,b,y,T,I,A,E;i.d(t,{G7:()=>M,Il:()=>d,Sz:()=>a,Vf:()=>P,Zw:()=>n,_i:()=>h,dE:()=>k,eN:()=>l,ew:()=>g,io:()=>u,jq:()=>r,k0:()=>s,o2:()=>c}),(m=n||(n={}))[m.Skype=0]="Skype",m[m.AAD=1]="AAD",m[m.CAE=2]="CAE",(_=a||(a={})).SkypeTokenRequired="skypeTokenRequired",_.TokenRequired="tokenRequired",(S=r||(r={})).Up="Up",S.InteractionRequired="InteractionRequired",S.AADReconnecting="AADReconnecting",S.SkypeReconnecting="SkypeReconnecting",S.LicenseError="LicenseError",S.SignInRestriction="SignInRestriction",S.RestartDevice="RestartDevice",(C=o||(o={}))[C.Inactive=0]="Inactive",C[C.Staged=1]="Staged",C[C.GoingLive=2]="GoingLive",C[C.Live=4]="Live",(v=s||(s={})).VdiStackSwitch="VdiStackSwitch",v.VdiBridgeConnectTimeout="VdiBridgeConnectTimeout",v.VdiBridgeDisconnectTimeout="VdiBridgeDisconnectTimeout",v.VdiBridgeOnDisconnectedCallback="VdiBridgeOnDisconnectedCallback",v.VdiBridgeOnConnectedCallback="VdiBridgeOnConnectedCallback";let M={prod:"prod",life:"life",dod:"dod",gcch:"gcch",gallatin:"gallatin",airgap08:"airgap08",airgap09:"airgap09"};(f=l||(l={})).Free="Free",f.Tentative="Tentative",f.Busy="Busy",f.Oof="Oof",f.WorkingElsewhere="WorkingElsewhere",f.Unknown="Unknown",(b=c||(c={})).Free="Free",b.Tentative="Tentative",b.Busy="Busy",b.OOF="OOF",b.WorkingElsewhere="WorkingElsewhere",b.Unknown="Unknown",(y=d||(d={})).Required="Required",y.Optional="Optional",y.Resource="Resource",y.Organizer="Organizer",y.Room="Room";let P={None:"None",Organizer:"Organizer",Tentative:"Tentative",Accepted:"Accepted",Declined:"Declined",NotResponded:"NotResponded"};(T=g||(g={})).Office="Office",T.Remote="Remote",T.Unspecified="Unspecified",(I=h||(h={})).IsCancelled="isCancelled",I.IsOrganizer="isOrganizer",I.OrganizerAddress="organizerAddress";let k={activeSectionChanged:"activeSectionChanged",activeSectionSourceChanged:"activeSectionSourceChanged",liveLayoutChanged:"liveLayoutChanged",sectionCleared:"sectionCleared",stagedLayoutChanged:"stagedLayoutChanged",notifyAlertStates:"notifyAlertStates"};(A=p||(p={}))[A.Sharepoint=0]="Sharepoint",A[A.WOPI=1]="WOPI",A[A.Google=2]="Google",A[A.OneDrive=3]="OneDrive",A[A.Recent=4]="Recent",A[A.Aggregate=5]="Aggregate",A[A.FileSystem=6]="FileSystem",A[A.Search=7]="Search",A[A.AllFiles=8]="AllFiles",A[A.SharedWithMe=9]="SharedWithMe",(E=u||(u={})).CMDStableSourceInfo="CMDStableSourceInfo",E.Pluginless="Pluginless",E.Slimcore="Slimcore",E.TrouterCallingWeb="TrouterCallingWeb",E.CallStore="CallStore"},395250:function(e,t,i){var n,a;function r(e={},t){return new Proxy(e,{get:(e,i)=>t?i in e?e[i]:t(String(i)):String(i)})}i.d(t,{RG:()=>s,ck:()=>l}),(a=n||(n={}))[a.Expanded=1]="Expanded",a[a.ExpandedAndPacked=2]="ExpandedAndPacked",a[a.Packed=3]="Packed";let o=e=>e.replace(/[A-Z]/g,(e,t)=>0===t?e.toLowerCase():`_${e.toLowerCase()}`),s=r({SliceSwitch:"activity_slice_switch",FeedListRendered:"feeds_focused_load",FeedListLoadNext:"feeds_focused_load_more",SlicesFeedListRendered:"slices_feeds_focused_load",SlicesFeedListLoadNext:"slices_feeds_focused_load_more",ActivityNameSpaceLoadScenario:"feeds_store_feed_item_namespace_load",AMSMemoryCachePrune:"ams_memory_cache_prune",GetAppPreviewResult:"ext_get_app_preview_result_appbasedlink",AppBasedLink:"ext_app_based_link",AppBasedLinkFetchAppDetails:"ext_app_based_link_fetch_app_details",AppBasedLinkChangedTooSoon:"ext_app_based_link_changed_too_soon",AppDevicePermissionGetAllInstalledAppsDevicePermissions:"app_device_permissions_get_all_installed_apps_device_permissions",CustomEngineAgentTabLoading:"mex_custom_engine_agent_tab_loading",DeclarativeAgentTabLoading:"mex_declarative_agent_tab_loading",NavigateToBizChatMetaOSFromAgentInCallOrMeeting:"mex_navigate_to_bizchat_from_agent_in_call_or_meeting",GetGptList:"mex_get_gpt_list",CeaGroupChatToPersonalEscAgentsLoading:"mex_cea_groupchat_to_personal_esc_agents_loading",CeaGroupChatToPersonalEscalation:"mex_cea_groupchat_to_personal_escalation",AppSwitcherPolicyExpiration:"appswitcher_tac_policy_expiration",HowlingSuppressionUFD:"howling_suppression_ufd",CallHighFidelityMusicModeSetSetting:"call_high_fidelity_music mode_set_setting",CallHighFidelityMusicModeLoadSetting:"call_high_fidelity_music mode_load_setting",CallNSMidCallSetSetting:"call_ns_mid_call_set_setting",CallNSLoadSetting:"call_ns_load_setting",CallNSSetSetting:"call_ns_set_setting",CallOPMMidCallSetSetting:"call_opm_mid_call_set_setting",CallOPMLoadSetting:"call_opm_load_setting",CallOPMSetSetting:"call_opm_set_setting",EditorSdkAugloopServiceTokenOperation:"editorsdk_augloop_service_token_operation",AuthStart:"auth_web_initialization",AuthWebOneChatInvite:"auth_web_onechat_invite",AuthUserInit:"auth_web_user_initialization",AuthWebSetUpTenants:"auth_web_setup_tenants",GetGoogleAuthCode:"google_auth_get_auth_code",AuthReAuthenticateOrRedeemTenant:"auth_reauthenticate_or_redeem_tenant",AuthWebReAuthenticate:"auth_web_reauthenticate",AuthGetUserSubType:"auth_get_user_subtype",AuthWebMTMADataService:"auth_web_mtma_data_service",AuthWebCachedUser:"auth_web_cacheduser",AuthWebHostCommAuthModule:"auth_web_hostcomm_authmodule",AuthWebMeControlRender:"auth_web_mecontrol_render",GetIC3GatewayToken:"get_ic3_gateway_token",AuthSkypeMigration:"auth_web_login_on_launch",MultiAccountTrustedUiLaunch:"multiaccount_trusted_ui_launch",companionMixinCallNotActiveScenario:"call_not_active_scenario",companionMixinMeetNowFailedScenario:"meet_now_failed_scenario",companionMixinValidationScenario:"validation_scenario",companionMixinTransferCallScenario:"transfer_call_scenario",commandRouterIncomingCommandReceived:"b2g:incoming_command_received_scenario",commandRouterAckIncomingCommandFailure:"b2g:ack_incoming_command_failure",commandRouterAckIncomingCommandSuccess:"b2g:ack_incoming_command_success",commandRouterSendOutgoingCommand:"b2g:send_outgoing_command",remoteControllerRoomRemoteProximityBanner:"b2g:room_remote_proximity_banner",dependencyProviderServiceShowCallTransferUfd:"show_call_transfer_ufd",dependencyProviderServiceTransferCallUsingUfd:"transfer_call_using_ufd",deviceSettingsSelectTransportCompanionDevices:"select_transport_companion_devices",deviceSettingsUnselectTransportCompanionDevices:"unselect_transport_companion_devices",BiometricFaceEnrollment:"face_enrollment",BiometricVoiceEnrollment:"voice_enrollment",PnsUFDNotification:"pns_ufd_notification",PnsBackgroundLoudSpeechSuppressedUFD:"pns_background_loud_speech_suppressed_ufd",PnsBackgroundLoudSpeechSuppressedUFDTurnPnsOff:"pns_background_loud_speech_suppressed_ufd_turn_pns_off",UpdateUserPassiveEnrollmentConsent:"pns_update_user_passive_enrollment_consent",GetUserPassiveEnrollmentConsent:"pns_get_user_passive_enrollment_consent",ExtBotsJITInstall:"ext_bots_jit_install",BreakoutRoomPreMeetingAssignmentTypeDialog:"breakout_rooms_assignment_type_dialog",BreakoutRoomTakeControlAction:"breakout_rooms_take_control",BreakoutRoomsPreMeetingTabLoad:"load_breakout_rooms_tab",BYODAttendeeView:"byod_attendee_view",BYODAttendeePopout:"byod_attendee_popout",BYODDeviceSettingsToggle:"byod_device_settings_toggle",CalPeoplePickerUsing3S:"cal_people_picker_using_3s",CalendarSurfaceLoad:"cal_surface_load",CalURLUnfurlingEventCardFailed:"cal_url_unfurling_event_card_failed",CalendarLiveMeetingStatusBarFireMeetingJoinCommand:"calendar-live-meeting-status-bar-fire-meeting-join-command",CalendarLiveMeetingStatusBarMultiMeetingViewModal:"calendar-live-meeting-status-bar-multi-meeting-view-modal",CalNewEventUsingTemplate:"cal_new_event_from_top_bar",AddEntireClass:"lms_integration_course_calendar_add_entire_class",LaunchLmsCourseCalendar:"lms_launch_course_calendar",ChannelCalendarLoad:"cal_channel_calendar_load",ConnectedCalendarDialogLoad:"cal_connected_calendar_dialog_load",ConnectedCalendarSettingDelete:"connected_calendar_settings_delete",GroupCalendarEvents:"group_calendar_get_events",CalendarEventsSyncWorflow:"calendar_events_sync_workflow",OutlookCalendarSettingsWorkflow:"calendar_outlook__settings_workflow",MultiCalendarEventsSyncWorflow:"multi_calendar_events_sync_workflow",CalendarTeamEventCancelWorkflow:"calendar_team_cancel_workflow",CalendarTeamEventCancelJob:"calendar_team_cancel_job",OutlookCalendarSettingsJob:"calendar_outlook__settings_job",CalendarBYGCRoutingConsent:"calendar_bygc_routing_consent",CalSchedulingFormGCPAppDefinitionCheck:"cal_scheduling_form_gcp_app_definition_check",MaGetActionItems:"ai_insights_ma_get_action_items",MaGetNotes:"ai_insights_ma_get_notes",MaSendSignalFeedback:"ai_insights_ma_send_signal_feedback",SdsGetActionItems:"ai_insights_sds_get_action_items",SdsEditActionItems:"ai_insights_sds_edit_action_items",SdsAddActionItems:"ai_insights_sds_add_action_items",SdsDeleteActionItems:"ai_insights_sds_delete_action_items",SdsGetNotes:"ai_insights_sds_get_notes",SdsEditNotes:"ai_insights_sds_edit_notes",SdsDeleteNotes:"ai_insights_sds_delete_notes",SdsAddNotes:"ai_insights_sds_add_notes",SdsCreateCollection:"ai_insights_sds_create_collection",SdsCreateCollectionItem:"ai_insights_sds_create_collection_item",SdsUpdateCollectionItem:"ai_insights_sds_update_collection_item",SdsGetCollectionItems:"ai_insights_sds_get_collection_items",SdsGetCollectionItem:"ai_insights_sds_get_collection_item",TranscriptRecordingMessageDelete:"transcript_delete_rt_notification_message",ClosedCaptionsInitializationE2ETrack:"closed_captions_initialization_time_track",B2gRcPairedDevicesCount:"b2g:rc:paired-devices_count",B2gRcIncomingSession:"b2g:rc:incomingSession",B2gRcRemoveSession:"b2g:rc:removeSession",B2gDesktopCreateSession:"b2g:desktop:createSession",B2gRcSessionScenarioNotFound:"b2g:rc:sessionScenarioNotFound",B2gRcSessionIdNotFound:"b2g:rc:sessionIdNotFound",B2gDesktopProximityScan:"b2g:desktop:proximityScan",B2gIncomingCommand:"b2g:incoming_command",B2gOutgoingCommand:"b2g:outgoing_command",UserPreferenceStoreInitialized:"userPreferenceStoreInitialized",B2gEndpointMatched:"b2g:endpointMatched",MachineSuspend:"machineSuspend",BluetoothLEStatus:"bluetoothLE_status",BroadcastSwitchPrimary:"broadcast_switchPrimary",BroadcastSetupQnaHubConnection:"broadcast_setup_qnaHubConnection",AddBlockListContact:"add_BlockList_contact",RemoveBlockListContact:"remove_BlockList_contact",CallGetForwardingSettings:"calling_get_forwardingSettings",CallingResetForwardingSettings:"calling_reset_forwardingSettings",CallAddorupdateForwardingSettings:"calling_addorupdate_forwardingSettings",SkypeTokenRevocation:"skypeTokenRevocation",CustomVideoBackgroundSaveUserUploadedImage:"customVideoBackground_save_user_uploaded_image",CustomVideoBackgroundGetUserUploadedImage:"customVideoBackground_get_user_uploaded_image",CustomVideoBackgroundGetTenantProvidedImage:"customVideoBackground_get_tenant_provided_image",CustomVideoBackgroundDeleteUserUploadedImage:"customVideoBackground_delete_user_uploaded_image",CustomVideoBackgroundSaveUserImages:"customVideoBackground_save_user_images",CustomVideoBackgroundPersistGeneratedImages:"customVideoBackground_persist_generated_images",CustomVideoBackgroundDeleteImagesByCategory:"customVideoBackground_delete_images_by_category",CustomVideoBackgroundDeleteImagesV2:"customVideoBackground_delete_images_v2",CustomVideoBackgroundGetUserImagesV2:"customVideoBackground_get_user_images_v2",InitIpsForDeviceSettings:"initIpsForDeviceSettings",CheckFrequencyForIps:"checkFrequencyForIps",AnswerCall:"answerCall",UpdateDeviceInCall:"updateDeviceInCall",RejectCall:"rejectCall",EndCall:"endCall",CallControlsHoldCall:"holdCall",ToggleIsolatedAudio:"toggleIsolatedAudio",ToggleNdi:"toggleNdi",SearchUsersByIdsOrQueryScenario:"searchUsersByIdsOrQueryScenario",RetrieveSlimCoreFeedbacInfoScenario:"retrieveSlimCoreFeedbacInfoScenario",SendQuestionnaireWithNEWSlimcoreAPIScenario:"sendQuestionnaireWithNEWSlimcoreAPIScenario",SendQuestionnaireWithVivaEmfResponseScneario:"sendQuestionnaireWithVivaEmfResponseScneario",CheckShouldShowAttendeeVivaEmfScenario:"checkShouldShowAttendeeVivaEmfScenario",CheckVivaEmfArtifacts:"checkVivaEmfArtifacts",CheckIsSampledForVivaEmf:"checkIsSampledForVivaEmf",CheckVivaEmfSettings1eCall:"check_viva_emf_settings_1e_call",GetInternalParticipantCountFromCache:"getInternalParticipantCountFromCache",ClientConnected:"clientConnected",VdiMultiWindow:"vdi_multiWindow",UnableToRemote:"unableToRemote",UnsupportedEndpoint:"unsupportedEndpoint",VdiSessionResumed:"vdi-session-resumed",VdiLocalStackLock:"vdi-local-stack-lock",VdiDisconnectedUnlock:"vdi-disconnected-unlock",VdiShimOperationalLatency:"vdi-shim-operational-latency",LoadVendorFile:"load-vendor-file",PmpAPILatency:"pmpAPILatency",CustomVideoBackgroundDownloadImage:"customVideoBackground_download_image",TsCallingCustomVideoBackgroundDownloadImage:"tsCalling_customVideoBackground_download_image",DelegateAddedNotification:"delegate added notification",DeviceSettingsStorageToGlobalState:"deviceSettingsStorageToGlobalState",GetIsDeviceSettingsMigrated:'get("isDeviceSettingsMigrated")',SetIsDeviceSettingsMigrated:'set("isDeviceSettingsMigrated")',SelectedDeviceTriggered:"selectedDeviceTriggered",HotdeskUserCheckIn:"hotdesk_user_checkin",CqfRenderedScenario:"cqfRenderedScenario",EmfRenderedScenario:"emfRenderedScenario",AvDevicesBYOD:"avDevicesBYOD",CheckSurvivabilityAppliancesScenario:"checkSurvivabilityAppliancesScenario",ChangeSurvivabilityModeScenario:"changeSurvivabilityModeScenario",ConvertToPptFiles:"convertToPptFiles",ConnectedDisplays:"connectedDisplays",RemoteCameraTerminateRemotePtzSession:"remote_camera_terminate_remote_ptz_Session",EnableVideoExtensibility:"enableVideoExtensibility",DisableVideoExtensibility:"disableVideoExtensibility",PrepareCall:"prepareCall",JoinCall:"joinCall",EnableContentCameraSecondStream:"enableContentCameraSecondStream",LockedMeeting:"lockedMeeting",OnDataReceivedDataChannelProxy:"onDataReceived_data_channel_proxy",AiInterpretationE2EReliability:"ai_interpretation_e2e_reliability",AnnotationStoppedByNonInitiator:"annotation_stopped_by_nonInitiator",PeopleFeedStart:"peopleFeed_start",PeopleFeedStop:"peopleFeed_stop",SlideControlRemoveSlideControllerUXLatency:"slide_control_remove_slide_controller_ux_latency",SlideControlSetSlideControllerUXLatency:"slide_control_set_slide_controller_ux_latency",SlideControlGetCapableControllersUXLatency:"slide_control_get_capable_controllers_ux_latency",ScreenSharingTabTrustedUiLaunch:"screen_sharing_tab_trustedui_launch",SlimcoreOperationWithRetryLoad:"slimcore_operation_with_retry:load",SlimcoreOperationWithRetryUnload:"slimcore_operation_with_retry:unload",SlimCoreInstanceCreationProblem:"slimcore_instance_creation_problem",RosterSubPanelFullRender2:"roster_subpanel_full_render2",VideoEffectsCustomizationPanel:"vide_effects_customization_panel",NpsSurveyAnonymousUserOnCallingEndScreen:"nps_survey_anonymous_user_on_calling_end",MarkCallLogAsDeletedWorkflow:"mark-call-log-as-deleted-workflow",SendBufferNameToPPT:"send_buffername_to_ppt",ExtBotsMessageBack:"ext_bots_messageback",ExtAppDefinitionForMECard:"ext_app_definition_for_me_card",ExtAdaptiveCardHtmlTransformationOnUpdate:"ext_ac_html_transformation_on_update",ExtAdaptiveCardRender:"ext_ac_render",ExtAdaptiveCardReactRender:"ext_ac_react_render",ExtAdaptiveCardFooterRender:"ext_ac_footer_render",ExtAdaptiveCardRegisterRenderers:"ext_ac_register_renderers",ExtAdaptiveCardLoadExperimentalPkg:"ext_ac_load_experimental_pkg",ExtAdaptiveCardWithMentionRender:"ext_ac_with_mention_render",AppProfileCardGetAppDefinition:"ext_app_profile_card_get_app_definition",AppProfileCardStartAudioCall:"ext_app_profile_card_get_start_audio_call",AppProfileCardStartChat:"ext_app_profile_card_get_start_chat",AppProfileCardStartVideoCall:"ext_app_profile_card_get_start_video_call",UseOneOnOneAndDisabledByTenantChecker:"ext_app_profile_card_one_on_one_and_disabled_by_tenant_checker",AppProfileCardSendQuickMessage:"ext_app_profile_card_send_quick_message",UseDisabledByUserChecker:"ext_app_profile_card_use_disabled_by_user_checker",ExtBotsCardO365HttpPOST:"ext_bots_actionable_card_http_post",ExtBotsAdaptiveCardImageExpand:"ext_bots_ac_image_expand",ExtBotsCardMessageUpdate:"ext_bots_update_mediacard",CDLStartupSyncConversationListOnMachineActive:"cdl_sync_conversation_list_on_machine_active",CDLStartupSyncConversationListOnAppStart:"cdl_sync_conversation_list_on_app_start",IloggingContext:"cdl_data_store_provider",GetConversationMessageWorkflow:"get_conversations_message_workflow",GetConversationMessageSyncJob:"get_conversations_message_sync_job",InMemoryLATPruningJob:"in_memory_lat_pruning_job",GroupChatsSyncWorkflow:"group_chat_sync_workflow",CentralDataLayerSubscription:"cdl_subscription_agg",CentralDataLayerWaitOnAuthUp:"cdl_wait_on_auth_up",CentralDataLayerBootstrapAuthGetUser:"CentralDataLayerBootstrapAuthGetUser",CentralDataLayerRequest:"cdl_request",CentralDataLayerWorkerStartup:"cdl_worker_startup",CentralDataLayerWorkerManagerStartup:"cdl_worker_manager_startup",CentralDataLayerBootstrapData:"cdl_worker_get_bootstrap_data",CentralDataLayerDataStoreCreate:"cdl_data_store_create",CentralDataLayerDataStoreUpgrade:"cdl_data_store_upgrade",CentralDataLayerDataStoreGetRangeCompare:"cdl_data_store_get_range_compare",CentralDataLayerDataStoreReinitDb:"cdl_data_store_reinit_db",CentralDataLayerDataStoreRemoveAllData:"cdl_data_store_remove_all_data",CentralDataLayerDataStoreRemoveUserData:"cdl_data_store_remove_user_data",MissingNotifications:"gap_detection_missing_notifications",ClearHistoryPruningJob:"clearhistory_pruning_job",ReplyChainSyncJob:"replychain_sync_job",FoundIncompleteRCInRelatedMessageSyncWorkflow:"found_incomplete_rc_in_related_message_sync_workflow",InMemoryCleanupJob:"inmemory_cleanup_job",ConversationManagerUpdateBatchable:"conversation_manager_batch_update",ConvUXMessageCacheValidation:"convux_message_cache_validation",SyncEngineOnInterval:"sync_engine_oninterval",RcmSyncJob:"rcm_fetch_job",RealtimeMessagingEventsWithVerifiedDisplayName:"real_time_messaging_event_with_verified_display_name",OutOfOrderMessages:"gap_detection_out_of_order_messages",MissingMessages:"gap_detection_missing_messages",MessagesGapAboveThreshold:"gap_detection_messages_gap_above_threshold",IndexedDBConnectionClosure:"indexed_db_connection_closure",TPSNotificationEvent:"tps_notification_event",TPSSaveSyncStateToCache:"tps_save_sync_state_to_cache",TPSGetPushUpdates:"tps_get_push_updates",MTMAAggregatorUserDataWrite:"mtma_aggregator_user_data_write",MTMAAggregatorUserDataRead:"mtma_aggregator_user_data_read",CentralDataLayerCoreGraphqlStartup:"cdl_core_graphql_startup",CentralDataLayerLazyStrategyStartup:"cdl_lazy_strategy_startup",CustomEmojiSyncWorkFlow:"custom_emoji_sync_workflow",CustomEmojiCreationWorkFlow:"custom_emoji_metadata_creation_workflow",FolderManagerFetchFoldersFromCSAFolders:"folder_manager_fetch_folders_from_csa_folders",FolderManagerForceMigratePinnedToFavorites:"folder_manager_fetch_force_migrate_pinned_to_favorites",TeamChannelsSyncWorkflow:"TeamChannelsSyncWorkflow",TeamChannelsSyncJob:"TeamChannelsSyncJob",ChannelSyncJob:"ChannelSyncJob",ChatsAndChannelsSyncWorkflow:"ChatsAndChannelsSyncWorkflow",ChatsAndChannelsSyncJob:"ChatsAndChannelsSyncJob",NonHostAppCentralDataLayerRequest:"cdl_non_host_app_request",RC2ManagerPartialFailureFetch:"cdl_rc2_manager_partial_failure_fetch",PrivateStreamPruningJob:"streams_manager_pruning_job",PrivateStreamLocalCatchupSync:"streams_manager_local_catchup_sync",ConversationIdForSkypeCsv1OneOnOnechatsResolver:"conversation_id_for_skype_csv1_oneonone_chats_resolver",ChannelInfoPaneDataLoad:"channel-info-pane-data-load",ChannelInfoPaneRendered:"channel-info-pane-rendered",ChannelInfoPaneDataAllPinnedPostsLoad:"channel-info-pane-data-all-pinned-posts-load",ChannelInfoPaneDataAllSystemMessagesLoad:"channel-info-pane-data-all-system-messages-load",ChannelAutoFavorite:"auto_favorite_channel",RenderSingleTeamView:"render_single-team-view",MessageClearCrossPostJob:"message_clear_cross_post_failure_job",ChatInfoPaneOpen:"chat_infopane_open",ChatInfoPaneDataLoad:"chat_infopane_data_load",ChatInfoPaneRendered:"chat_infopane_rendered",ChatInfoPaneMedia:"chat_infopane_media",ChatInfoPaneFiles:"chat_infopane_files",ChatInfoPaneTabs:"chat_infopane_tabs",GetChatInfoPanePinnedMessages:"get_chat_pinned_messages",AddContactToFavorite:"people_add_contact_to_favorite",ExternalTopNIDBPopulate:"external_topn_idb_populate",ExternalGetTopNSuggestions:"external_get_topn_suggestions",BizChatPreWarmIdleStateTrigger:"bizchat_pre_warm_idle_state_trigger",BizChatPreWarm:"bizchat_pre_warm",CloudPeopleFeedStartReliability:"cloud_peoplefeed_start_reliability",CloudPeopleFeedStopReliability:"cloud_peoplefeed_stop_reliability",CloudPeopleFeedReceiverStartReliability:"cloud_peoplefeed_receiver_start_reliability",CloudPeopleFeedReceiverStopReliability:"cloud_peoplefeed_receiver_stop_reliability",CloudPeopleFeedBotSetupAndAdded:"cloud_peoplefeed_bot_setup_and_added",CloudPeopleFeedFocus:"cloud_peoplefeed_focus",CloudPeopleFeedEnabledReceive:"cloud_peoplefeed_enabled_receive",CloudPeopleFeedRoomToggle:"cloud_peoplefeed_room_toggle",CloudPeopleFeedEnabledSend:"cloud_peoplefeed_enabled_send",Peer5NPMPackageSilentTester:"peer5_npm_package_silent_tester_init",SyntheticTestsSetupApiResolver:"synthetic tests_setup_api_resolver",Peer5NPMPackageSilentTesterTestCall:"peer5_npm_package_silent_tester_test_call",GetMeetingArtifacts:"get_meeting_artifacts_artifacts",ReadCollabObject:"read_from_collab_object",ReadCollabObjectBatchRequest:"read_from_collab_object_batch_request",AddAttachmentToMCOForChannelMeeting:"add_attachment_to_mco_for_channel_meeting",GetMeetingRecommendedArtifacts:"get_meeting_recommended_artifacts_hook",ReadCollabObjectWorker:"read_from_collab_object_worker",ReadCollabObjectBatchWorker:"read_from_collab_object_batch_worker",DeleteCollabObjectWorker:"delete_from_collab_object_worker",DeleteContentWorker:"delete_from_content_worker",GetMeetingContentsFromMCPS:"get_meeting_contents_from_mcps",ListContentsFromMCPS:"list_contents_from_mcps",CreateContentJobToMCPS:"create_content_job_to_mcps",DeleteContentJobToMCPS:"delete_content_job_to_mcps",CommentStreamE2EMessageDelivery:"comment_stream_e2e_message_delivery",SubmitReportConcernCommunities:"communities_report_concern",CommunitiesRequestToJoin:"communities_request_join",CreateCommunityDialog:"communities_create_community_dialog",CommunitiesJoinByThreadId:"communities_join_by_threadid",CommunitiesPendingInviteList:"communities_pending_invites_list",CommunitiesGetInvitationsToCommunities:"communities_get_invtitations_to_communities",CommunitiesWelcomebotConfig:"get_communities_welcomebot_config",CommunitiesApproveJoinLinkToggle:"communities_approve_join_toggle",SubscribeCommunitiesPostPinUnpinUpdate:"subscribe_communities_post_pin_unpin",ComposeAddonsLoadLatency:"compose-addons-load-latency",CopilotPluginManagerCreatePowerPlatformConnection:"copilot_plugin_manager_create_powerplatform_connection",RenderBizChatMetaOSChatListEntry:"render_bizchat_metaos_chat_list_entry",NavigateToBizChatMetaOS:"navigate_to_bizchat_metaos",GetBizChatMetaOSSimpleCollabEntry:"get_bizchat_metaos_simple_collab_entry",NavigateToBizChatMetaOSFromSimpleCollab:"navigate_to_bizchat_metaos_from_simple_collab",HideBizChatMetaOSFromSimpleCollab:"hide_bizchat_metaos_from_simple_collab",GetTopFixedChat:"get_topfixed_chat",BizChatBotJITAppStateCheck:"bizchat_bot_jit_app_state_check",BizChatBotJITInstallation:"bizchat_bot_jit_installation",BizChatBotJITFindConversationId:"bizchat_bot_jit_find_conversation_id",BizChatBotJITPinChat:"bizchat_bot_jit_pin_chat",BizChatBotUpdateUserPreferencesAfterUnpin:"bizchat_bot_update_userpreferences_after_unpin",BizChatBotUnpinFindConversationId:"bizchat_bot_unpin_find_conversation_id",BizChatBotUnpinChat:"bizchat_bot_unpin_chat",MTMATenantName:"mtma_tenant_name",EmptyCortexTopic:"cortex_empty_topic_manual_annotation",CustomSenstivityLabelSync:"custom_sensitivity_label_sync",DiscoverSurfaceFeedsCDLProcessing:"discover_surface_feeds_cdl_processing",DiscoverSurfaceCDLFeedScroll:"discover_surface_cdl_feed_scroll",DiscoverSurfaceSendFeedbackSignal:"discover_surface_feed_send_feedback_signal",DiscoverSurfaceSendUserActionFeedbackSignal:"discover_surface_feed_user_action_signal",GetStoreEditorialArticlesAppItem:"ext_store_editorial_articles_app_get_item",ViewStoreEditorialArticlesAppItemDetail:"ext_store_editorial_articles_app_view_detail",QueuesRTANoNavigationData:"queues_rta_no_navigation_data",QueuesRTANoDataForId:"queues_rta_no_data_for_id",QueueRealTimeCQUpdateReceived:"queue_real_time_cq_update_received",CallingDeeplink:"call_users_deeplink",CallTranscriptPanel:"transcript_panel",CallsAltScenario:"calls_app_launch_time",MwbtAutoJoinCall:"auto_join_mwbt_call",DeleteCallHistoryLog:"deletecalllogscenario",ExtensibilityAppPickerFetchCMSCollectionsManager:"extensibility_app_picker_fetch_cms_collections_manager",ExtensibilityAppPickerFetchCMSCollectionsService:"extensibility_app_picker_fetch_cms_collections_service",ExtensibilityAppPickerAppPostInstall:"extensibility_app_picker_post_install",ExtensibilityAppPickerAppUninstall:"extensibility_app_picker_uninstall",ExtensibilityAppsExperienceCore:"extensibility-apps-experience-core",ExtMeetingAppsFlyoutFilterTransformSortApps:"ext_meeting_apps_filter_transform_sort_apps",PlatformAppsFlyoutFetchGridApps:"platform_apps_flyout_grid_apps",PlatformAppFlyoutJITInstallApp:"platform_app_flyout_jit_install_app",PlatformAppFlyoutJITInstallAndEnableApp:"platform_app_flyout_jit_install_and_enable_app",ExtMessageExtensionUninstallApp:"ext_me_uninstall_app",ExtMeetingAppsFlyoutInstallApp:"ext_meeting_app_flyout_install_app",ExtSilentInstallPreConsentedApps:"ext_silent_install_preconsented_apps",ExtMessageExtensionPostInstallGetFlyoutApp:"ext_me_post_install_get_flyout_app",ExtMeetingFlyoutPreConsentedApps:"ext_meeting_flyout_silent_install_preconsented_apps",ExtMessageExtensionInstallApp:"ext_me_install_app",ExtAppsUsageGetAppsUsage:"ext_get_apps_usage",ExtAppsUsagePostAppsUsage:"ext_post_apps_usage",ExtBotMessageActionImBack:"ext_bot_message_action_imback",ExtExternalAppCECAuth:"ext_external_app_cec_auth",ExtExternalAppCECAuthReplay:"ext_external_app_cec_auth_replay",ExtExternalAppCECCardActionOpenUrl:"ext_external_app_cec_card_action_open_url",ExtExternalAppCECCardActionSubmit:"ext_external_app_cec_card_action_submit",ExtExternalAppDACardActionOpenUrlDialog:"ext_external_app_da_card_action_open_url_dialog",ExtMECardAction:"ext_me_card_action",ExtBotSsoNonSilentAuth:"ext_bot_sso_post_consent_auth",ExtGetFlyoutFilteredME:"ext_get_flyout_filtered_me",ExtGetFlyoutFilteredSectionsME:"ext_get_flyout_filtered_sections_me",ExtMessageExtensionGetSections:"ext_me_get_sections",UpgradeApp:"ext_upgrade_app",LaunchAppInstall:"ext_launch_app_install",PreConsentedAppInstall:"ext_preconsent_app_install",LaunchAppConfig:"ext_launch_app_config",InstallSideLoadApp:"ext_install_side_load_app",InstallTrustedSideLoadApp:"ext_install_trusted_side_load_app",InstallTrustedSideLoadAppFromAdaptiveCardFooter:"ext_install_trusted_side_load_app_from_ac_footer",ExtGetLocation:"ext_location_api_get_location",ExtShowLocation:"ext_location_api_show_location",ExtSelectPeopleContextSearch:"ext_select_people_contextual_search",ExtTaskModuleJITInstall:"ext_task_module_jit_install",ExtMessageExtensionAppInstallation:"ext_me_app_installation",PlatformFetchTabInfo:"platform_fetch_tab_information",ExtMessageExtensionAppOpen:"ext_me_app_open",GetDefaultUrlPreview:"ext_get_default_url_preview_appbasedlink",GetRichUrlPreview:"ext_get_rich_url_preview_appbasedlink",GetUrlPreviewContent:"ext_get_url_preview_content_card_images",ExtCopilotAuthCardAadFlowSME:"ext_copilot_auth_card_aad_flow_sme",ExtMeetingCopilotAuthCardAadFlowSME:"ext_meeting_copilot_auth_card_aad_flow_sme",ExtCopilotMEAuthAndConfig:"ext_copilot_me_authandconfig",ExtMeetingCopilotMEAuthAndConfig:"ext_meeting_copilot_me_authandconfig",ExtAdaptiveCardActionExecuteSSO:"ext_action_execute_sso",ExtAdaptiveCardActionExecuteOAuth:"ext_action_execute_oauth",ExtAdaptiveCardActionExecuteAuthJIT:"ext_action_execute_authentication_jit",ExtGroupScopeBotSsoJIT:"ext_group_scope_bot_sso_jit",AdaptiveCardsV2ManagerWarmUpAuthBlockUsageMap:"adaptive_cards_v2_manager_warmup_auth_block_usage_map",AppProfileCardInstallApp:"ext_app_profile_card_install_app",DeepLinkToMeetingTabSidePanel:"deeplink_to_meeting_tab_sidepanel",FetchBotDynamicCommandsSyncJob:"ext_fetch_bot_dynamic_commands_sync_job",BotDynamicCommandsManager:"ext_bot_dynamic_commands_manager",BotDynamicCommandsSyncWorkflow:"ext_bot_dynamic_commands_sync_workflow",BotDynamicCommandsSyncStrategy:"ext_fetch_bot_dynamic_commands_sync_strategy",FetchBotDynamicSuggestedActionsSyncJob:"ext_fetch_bot_dynamic_suggested_actions_sync_job",BotDynamicSuggestedActionsManager:"ext_bot_dynamic_suggested_actions_manager",BotDynamicSuggestedActionsSyncWorkflow:"ext_bot_dynamic_suggested_actions_sync_workflow",LaunchWorkflowsDialog:"ext_launch_workflows_dialog",LauncConfiguredhWorkflowsDialog:"ext_launch_configured_workflow_dialog",StoreManageWorkflowsCommand:"ext_store_app_manage_command",LaunchConnectorManagerDialog:"ext_launch_connectors_dialog",LaunchWorkflowsManagerDialog:"ext_launch_workflows_entry_dialog",LaunchWorkflowsWidgetHostDialog:"ext_launch_workflows_widget_host_dialog",MOS3TokenGeneration:"ext_mos3_token_generation",FeedbackRdxRenderer:"feedback-rdx-renderer",ScreenshotSelectorTUILoaderLaunchProp:"screenshot-selector-tui-loader-launch-prop",ScreenshotSelectorTrustedUiLaunch:"screenshot-selector-trustedui-launch",ScreenshotSelectorTrustedUiThumbnailQuery:"screenshot-selector-trustedui-thumbnail-query",FilesDeleteUserSafeDomain:"files_delete_user_safe_domains_list",FilesLocalMRUFilesTrustedUILaunch:"files_local_mru_files_trustedui-launch",FilesFetchFloraDefaultPreferences:"files_fetch_flora_default_preference",FileSPOPersonalODTokenPrewarm:"file_spo_personal_od_token_prewarm",FileSPOHomeSiteODTokenPrewarm:"file_spo_home_od_token_prewarm",FileSPOOtherDomainsODTokenPrewarm:"file_spo_other_domains_od_token_prewarm",FileBrowserForCFTPreWarmOnIdleStateTrigger:"file_browser_for_cft_pre_warm_on_idle_state_trigger",FileBrowserForCFTPreWarmIdleStateTrigger:"file_browser_for_cft_pre_warm_idle_state_trigger",FileBrowserPreWarmForCFT:"file_browser_pre_warm_for_cft",FileBrowserPreWarmForCFTOnIdle:"file_browser_pre_warm_for_cft_on_idle",FileNameConflictV2ReshareAPI:"file_name_conflict_v2_reshare_api",ChannelPDFCreateTab:"channel_pdf_create_tab",FetchChannelSiteInfoV2:"fetch-channel-site-info-v2",ChooseFileShareMedium:"documents_choose_file_share_medium",QueryItemDetailsService:"documents_query_item_details_service",FetchOneDriveDetails:"documents_fetch_onedrive_details",FetchNativeEntrypointAvailability:"documents_filespolicy_nativefileentrypoints",ChooseFileFromOsDialog:"documents_choose_file_from_os",FilesAMSImageUpload:"documents_ams_image_upload",FilesAMSAttachedVideoUpload:"documents_ams_attached_video_upload",FileUploadChat:"documents_upload_file_chat",UpdateAvailability:"documents_update_availability",FileAttachSuggestionsFetch:"documents_file_attach_suggestions_fetch",FileAttachSuggestionsRender:"documents_file_attach_suggestions_render",FileExternalChicletDomainRender:"documents_file_external_chiclet_domain",UserFileAttach:"documents_user_file_attach",DownloadSettingsRender:"documents_download_settings_render",DownloadAlwaysAskLocationChange:"documents_always_ask_location_change",P2PFilesListFetchJob:"documents_p2p_files_list_fetch_job",FileRemoveChat:"documents_remove_file_chat",FileOpenOnline:"documents_action_open_file_online",InsecureFileChiclet:"documents_insecure_file_chiclet",FileInfoValidation:"documents_file_info_validation",FileGetP2PFilesList:"documents_get_p2p_files_list",FileGetP2PCommunitiesFilesList:"documents_get_p2p_communities_files_list",ChatInfoPaneGetP2PFiles:"documents_get_p2p_files_chat_info_pane",SharedGetP2PSharedList:"documents_get_p2p_shared_list",P2PSharedListGoToChat:"documents_p2p_shared_list_go_to_chat",P2PFilesListFetchWorkflow:"documents_p2p_files_list_fetch_workflow",RefreshSiteUrl:"documents_refresh_site_url_ns",FileRedeem:"documents_file_redeem",FileRedeemByFileId:"documents_file_redeem_file_id",AddFileToMessage:"documents_share_file_message",ChooseFileFromOnedrive:"documents_choose_file_from_onedrive",QueryLegacyVroomService:"documents_query_legacy_vroom_service",FilesCreateShareLink:"documents_create_share_link",FetchPersonalSiteInfo:"documents_fetch_personal_site_info",FetchPersonalSiteInfoFromUserPreferenceStore:"documents_fetch_personal_site_info_user_preference_store",FetchChannelSiteInfo:"fetch-channel-site-info",FetchThreadSharepointIds:"fetch-thread-sharepoint-ids",FetchOneDriveDetailsFromCDL:"documents_fetch_onedrive_details_from_cdl_v2",CreateFileChiclet:"documents_create_file_chiclet_on_link_paste",AsyncLinkToChiclet:"documents_async_link_to_chiclet",FileUploadChannel:"documents_upload_file_channel",FileRemoveChannel:"documents_remove_file_channel",FileAttachChat:"documents_attach_file_chat",FileAttachChannel:"documents_attach_file_channel",FileSharelinkMessageSend:"documents_share_link_message_send",FileChicletDefaultPermission:"documents_share_link_chiclet_default_permission",FileChicletExistingPermission:"documents_share_link_chiclet_existing_permission",FileChicletAutoProvisionShareLink:"documents_share_link_chiclet_autoprovision",FileShareDialogAudience:"documents_share_dialog_audience",FileShareLinkCopyToClipboard:"documents_share_link_copy_to_clipboard",FileSharingCopyLinkDialog:"documents_share_link_copy_dialog",FileSharingCopyLinkDialogResurface:"documents_share_link_copy_dialog_resurface",FileSharingPermissionDialog:"documents_share_link_permission_dialog",FileSharelinkCheckAccess:"documents_share_link_check_access",FileOpenInDesktopApp:"documents_action_open_office_file_app",FileDownload:"documents_action_download_file",FileDelete:"documents_action_delete_file",MakeAsATab:"documents_action_make_as_a_tab",FileSummary:"documents_action_summarise_file_copilot",P2PSharedListSwitch:"documents_p2p_shared_list_switch",P2PSharedListInternalTabSwitch:"documents_p2p_shared_list_internal_tab_switch",P2PSharedListAllFiles:"documents_p2p_shared_list_allfiles",P2PSharedListAllFilesFast:"documents_p2p_shared_list_allfiles_fast",P2PSharedListLinksMailBox:"documents_p2p_shared_list_links_mailbox",P2PSharedListLinksWorkingSet:"documents_p2p_shared_list_links_workingset",P2PSharedListAllSharedWorkingSet:"documents_p2p_shared_list_allshared_workingset",P2PSharedListAllSharedMailBox:"documents_p2p_shared_list_allshared_mailbox",FileEditInTeams:"documents_action_edit_file_in_teams",FileOpenSuggestionQuery:"documents_file_open_suggestion_query",FileChangeDefaultAppQuery:"documents_change_default_app_query",FilesAppSwitch:"documents_files_app_switch",RefreshSiteUrlPersonal:"documents_refresh_site_url_personal_ns",FilesRenderExternalProviders:"render_files_external_providers",FilesRenderExternalProviderContent:"render_files_external_provider_content",FileOneUpViewer:"file_oneup_viewer",FileThumbnailBlobContentManager:"files_thumbnail_blob_content_manager",FileThumbnailBlobContentResolver:"files_thumbnail_blob_content_resolver",RenderCVSurvey:"render_cv_survey",BootStrapFloodgate:"bootstrap_floodgate",FlyoutStartWebcam:"flyout-start-webcam",FlyoutStopWebcam:"flyout-stop-webcam",WindowVisibilityRegistration:"flyout-register-visibility-handler",unregisterVisibilityScenario:"flyout-unregister-visibility-hander",GetMeetingLink:"flyout-get-link-l1",GetMeetingObjects:"flyout-get-meeting-objects",StartMeetingFromLink:"flyout-start-meeting-from-link",ToggleWebcam:"flyout-toggle-webcam",startMeetingAndSendLink:"flyout-callingl2-send-link",flyoutVisibilityChangedHandler:"flyout-visiblity-changed-handler",fetchFlyoutFeaturedCommunities:"fetch-flyout-featured-communities",TflFeaturedCommunitiesSyncJob:"tfl-featured-communities-sync-job",TflFeaturedCommunitiesSyncWorkflow:"tfl-featured-communities-sync-workflow",TFLConsentLaunch:"consent_launch",QueryExecution:"query_exec",GlobalErrorPage:"global_error_page_display",ErrorPageAction:"global_error_page_action",UnhandledRejection:"unhandled_rejection_error",GraphQLExecuteOperation:"graphql_execute_operation",GraphQLCreateDataClient:"graphql_create_data_client",PostMeetingView:"post_meeting_view_eligible_render",MessageMeetingChicletJoinMeeting:"msg_meeting_chiclet_join_meeting",MessageMeetingChicletAddToMyCalendar:"msg_meeting_chiclet_add_to_my_calendar",MessageMeetingChicletImportCalendarEvent:"msg_meeting_chiclet_import_calendar_event",MessageMeetingChicletImportGoogleCalendarEvent:"msg_meeting_chiclet_import_bygc_calendar_event",MessageMeetingChicletDeleteFromCalendar:"msg_meeting_chiclet_delete_from_calendar",MessageMeetingChicletAcceptRsvp:"msg_meeting_chiclet_accept_rsvp",MessageMeetingChicletViewEventDetails:"msg_meeting_chiclet_view_event_details",MeetingInviteOffNetworkPhone:"invite_offnetwork_phone_to_meeting",MeetingChatInviteOffNetworkPhone:"invite_offnetwork_phone_to_meetingchat",HVCSearchJob:"hvc_search_job",HVCSearchWorkflow:"hvc_search_workflow",NoopScenario:"noop",AppLogout:"authenticationservice_applogout",IndexedDBDelete:"indexed_db_delete",IndexedDBFetch:"indexed_db_fetch",IndexedDBWrite:"indexed_db_write",ContactsSyncPopoutOpened:"contacts_sync_popout",GetPost:"csa_get_post",GetRepliesInChain:"csa_get_replies_in_chain",GetPostAuthorMris:"csa_get_post_authors",FilePreviewLayoutToJsApiScriptLoad:"file_preview_layout_to_jsapi_script_load",JsApiScriptLoad:"jsapi_script_load",JsApiFirstStep:"jsapi_first_step",JsApiSecondStep:"jsapi_second_step",RoomRemoteMeetingRoomSendCommandLeaveMeeting:"room_remote_meeting_room_send_command_leavemeeting",OfflineCacheStorageImageUpload:"ocm_image_upload",OnDemandTranslation:"on_demand_translate_message",DetectLanguagePrompt:"show_switch_language_prompt",ATPGetPolicy:"atp_get_policy",ATPGetPolicyTask:"atp_get_policy_task",ATPGetUrlReputation:"atp_get_url_reputation",CreateWiki:"wikiv2_create_wiki",LoadWiki:"wikiv2_load_wiki",DeleteWiki:"wikiv2_delete_wiki",SavePageTitleWiki:"wikiv2_save_page_title",LockSectionWiki:"wikiv2_lock_section",SaveSectionWiki:"wikiv2_save_section",AddPageWiki:"wikiv2_add_page",DeletePageWiki:"wikiv2_delete_page",MovePageWiki:"wikiv2_move_page",MoveSectionWiki:"wikiv2_move_section",DeleteSectionWiki:"wikiv2_delete_section",ForceUnlockWiki:"wikiv2_force_unlock",AddSectionWiki:"wikiv2_add_section",DiscardSectionWiki:"wikiv2_discard_section",LoadPageWiki:"wikiv2_load_page",FocusSectionWiki:"wikiv2_focus_section",LoadPagesForSidebarWiki:"wikiv2_load_pages_for_sidebar",LoadPageWithoutSectionWiki:"wikiv2_load_page_without_section",LoadSectionWiki:"wikiv2_load_section",NoOpSyncJob:"noop_sync_job",AddMembersToThreadJob:"addmemberstothreadjob",BuddyListAddWorkflow:"buddylist_add_workflow",GetTeamsChannelsFromIndexedDB:"get_teams_channels_from_indexeddb",StoTaskModuleDeleteDraft:"sto_delete_email",ExtBotsCardExecute:"ext_bots_execute",ExtBotsPinAsTab:"ext_bots_pinastab",ExtTflAdaptiveCardAction:"ext_tfl_ac_action",ExtAdaptiveCardTabAuth:"ext_act_authandconfig",ChangeRoleRender:"change_role_latency",OpenShareInviteDialog:"openshareinvitedialog",GetUpgradePolicyFromUserProfileOrDefault:"load_loggedin_user_policy_from_userprofile_or_default",AppBasedLinkAuthOrConfig:"ext_do_auth_or_config_appbasedlink",AppBasedLinkAadAuth:"ext_do_aad_auth_appbasedlink",Unified3SSearch:"unified_3s_search",UnifiedChannelSearch:"channel_search",UnifiedChatsByTitleSearch:"chats_by_title_search",UnifiedChatsByMembersSearch:"chats_by_members_search",UnifiedPeopleSearch:"people_search",TeamSettingsTabLoad:"teamdashboard_settingstab_load",GetOfficeStoreAppDetails:"app_details_get_office_store_app_details",StartScenarioStepSuffix:"_start",PersistDataInIndexdb:"persist_data_in_indexed_db",STTOutlookAtMention:"stt_outlook_at_mention",STTOutlookMWAtMention:"stt_outlook_mw_at_mention",STTAtMention:"stt_at_mention",SwCleanupSwCache:"sw_cleanup_cache",AppInstallationDialogGetAppDefinition:"app_installation_dialog_getappdefinition",AppInstallationDialogInstallApp:"app_installation_dialog_installapp",ChatRosterRendered:"chat_roster_rendered_mw",AdaptiveCardsV2ManagerPopulateUserSpecificContent:"adaptive_cards_v2_manager_populate_userspecific_content",GetUserInfo:"use_user_container_get_user_info",UnPinChannel:"unpin_channel",FRELogOutError:"fre_auth_signout_failure",ConversationalAppsFilterResolver:"ext_conversational_apps_filter_resolver",LmsLaunchSchedulingFormCreate:"lms_integration_launch_scheduling_form_create",GetTeamsForCourse:"lms_get_teams_for_course",LaunchLmsCourseTeam:"lms_launch_course_team",GetLoBNotificationItem:"ext_lob_notifications_get_item",ViewLoBNotificationItemDetail:"ext_lob_notifications_view_detail",LocaleSettingsUpdate:"locale_settings_chatservice_update",LpcGetPersonaProfiles:"lpc_persona_profiles_data_callback",LinkedInRender:"linkedin_render",LpcGetPersonaInfo:"lpc_persona_data_callback",LpcGetPersonaInfoSC:"lpc_persona_data_callback_sc",LpcGetPersonaInfoOneGqlPerson:"lpc_persona_data_callback_onegql_person",LpcGetPersonaInfoSCOneGqlPerson:"lpc_persona_data_callback_sc_onegql_person",LpcGetHeaderInfo:"lpc_header_info_data_callback",LpcGetHeaderInfoSC:"lpc_header_info_data_callback_sc",LpcGetHeaderInfoSCOneGqlPerson:"lpc_header_info_data_callback_sc_onegql_person",LpcGetHeaderActionsPolicy:"lpc_header_actions_data_callback",LpcGetRichPresence:"lpc_rich_presence_data_callback",LpcGetImageUri:"lpc_image_data_callback",LpcGetImageUriOneGqlPerson:"lpc_image_data_callback_onegql_person",LpcGetImageUriSC:"lpc_image_data_callback_sc",MarketplaceDeviceStoreCartControl:"marketplace_device_store_cart_flow",ShowInMeetingReportToggled:"toggle_show_in_meeting_report_enbaled",GetTranscriptDataMAS:"get_transcript_data_mas",GetTranscriptDataMCO:"get_transcript_data_mco",ValidateCopilotAccess:"get_copilot_license_data",MeetingCopilotReadHistory3S:"meeting_copilot_read_history_3s",MeetingCopilotReadCachedHistory3S:"meeting_copilot_read_cached_history_3s",GroupCopilotSendCalendarDataToTCA:"group_copilot_send_calendar_data_to_tca",GroupCopilotSendNotesDataToTCA:"group_copilot_send_notes_data_to_tca",GroupCopilotSendThreadDataToTCA:"group_copilot_send_thread_data_to_tca",SendPingToTCA:"send_ping_to_tca",GCPAppDefinitionCheck:"gcp_app_definition_check",CommitCollabNote:"commit_collab_notes",MeetingPropertiesFromCallFluidContext:"get_meeting_properties_from_call",CopilotNotesIconBadge:"copilot_meeting_notes_icon_badge",TmiDownloadQnAReport:"tmi_download_qna_report",MeetingOptionsSavedToSSOnCreate:"meeting_options_saved_to_ss_on_create",MRShareToOutlookGenerateEmailIdAINotes:"mr_share_to_outlook_generate_email_id_ai_notes",MrGetListFromMCPS:"mr_get_list_from_mcps",MrGet3SRRecommendations:"mr_get_3sr_recommendations",MrGetTranslatedAIContent:"mr_get_translated_ai_content",MrOnDemandAINotes:"mr_on_demand_ai_notes",MrLoadOneTranscript:"mr_load_onetranscript",MrUnloadOnePlayer:"mr_unload_oneplayer",MrLoadOnePlayer:"mr_load_oneplayer",MrLoadOnePlayerIFrame:"mr_load_oneplayer_iframe",MrLoadOneTranscriptIFrame:"mr_load_onetranscript_iframe",MrGetODSPFileInfo:"mr_get_odsp_file_info",MrGetODSPSiteTitle:"mr_get_odsp_site_title",CrLoadOnePlayer:"cr_load_oneplayer",CrLoadOneTranscript:"cr_load_onetranscript",MrGetVIImage:"mr_get_vi_image",MeetAppCreateMeetingLink:"meet_app_create_meeting_link_event",MeetAppScheduleMeetingCreateSSEvent:"meet_app_schedule_meeting_create_ss_event",MeetAppRenderSpeedDialList:"meet_app_render_speeddial_list",MeetAppUpcomingFetchMCO:"meet_app_upcoming_fetch_mco",MeetAppUpcomingFetchMRE:"meet_app_upcoming_fetch_mre",MeetAppUpcomingFetchMP:"meet_app_upcoming_fetch_mp",MeetAppRecentFetchMCO:"meet_app_recent_fetch_mco",MeetAppRecentFetchMCU:"meet_app_recent_fetch_mcu",MeetAppOpenURLAction:"meet_app_open_url_action",MeetForWorkSearchEventsWorkflow:"meet-for-work-search-events-workflow",MeetForWorkCatchUpSyncWorkflow:"meet-for-work-catch-up-sync-workflow",MeetForWorkRecordingThumbnailsSyncWorkflow:"meet-for-work-recording-thumbnails-sync-workflow",MeetForWorkMaintenanceWorkflow:"meet-for-work-maintenance-workflow",MeetForWorkSearchEventsJob:"meet-for-work-search-events-job",MeetForWorkFetchMeetCatchUpJob:"meet-for-work-fetch-meet-catch-up-job",MeetForWorkFetchRecordingThumbnailsJob:"meet-for-work-fetch-recording-thumbnails-job",MeetForWorkDataPruningJob:"meet-for-work-data-pruning-job",getDeepLinkedTranscript:"get_deeplinked_transcript",hasTranscriptMW:"has_transcript_mw",getDeepLinkedTranscriptMW:"get_deeplinked_transcript_mw",RaiseHandE2eLatency:"raise_hand_received_e2e_latency",MEJCO:"mejco",IncommingCall:"incoming_call",LoadImmersiveEventUnityPlayer:"load_immersive_event_unityplayer",InitImmersiveDependencies:"initialize_immersive_dependencies",UnmutedWithPushToTalk:"push_to_talk_scenario",RemoteMuteRender:"server_mute_latency",MyselfVideoOn:"toggle_myself_video_on",MyselfVideoOff:"toggle_myself_video_off",RtcAudioManagerDiagnosticsRecordingService:"init_rtc_manager_recording_diagnostics_service",CallingChatPopOut:"calling_chat_popout",PlatformTabSdkGetAppContentStageSharingState:"platform_tab_get_app_content_stage_sharing_state",PlatformTabSdkRaiseHandStateChangedSubscription:"platform_tab_raise_hand_state_changed_subscription",PlatformTabSdkMeetingReactionReceivedSubscription:"platform_tab_meeting_reaction_received_subscription",DeepLinkShareAppToStage:"deeplink_share_app_to_stage",ReactionsOverlayScreen:"meeting_reactions_overlay",StageContentPopout:"stage_content_pop_out",ShowMeetingBrandingLogo:"meeting_branding_show_logo",FetchDynamicCommands:"ext_fetch_dynamic_commands",ExtMessageExtensionAuthAndConfig:"ext_me_authandconfig",ExtSimplifiedMessageExtensionAuthAndConfig:"ext_sme_authandconfig",ExtMessageExtensionQueryCommand:"ext_me_querycommand",ExtSimplifiedMessageExtensionQueryCommand:"ext_sme_querycommand",ExtPinOrUnpinMessageExtension:"ext_pin_or_unpin_message_extensions",RemoveUrlPreview:"ext_remove_url_preview",InstallAppMessageExtensionJit:"ext_install_app_message_ext_jit",SMESSOTokenRequest:"ext_sme_sso_token_request",ExternalAppActionCommand:"ext_app_action_command",FetchDynamicSuggestedActions:"ext_fetch_dynamic_suggested_actions",SendSmartReplyMessage:"chat_send_sr_message",SendSmartRepliesFeedback:"send_sr_feedback",DeleteChat:"messaging_delete_chat",CreateChatSfB:"create_chat_sfb",CreateChatSfC:"create_chat_sfc",CreateChatNativeFederated:"create_chat_nativefederated",ATPFastSharepointSafelinksClick:"atp_fast_sharepoint_safelinks_click",DeleteMessage:"messaging_delete_message",AdminDeleteMessage:"messaging_admin_delete_message",UndeleteMessage:"messaging_undo_delete",DeleteMessageSaveId:"messaging_delete_message_save_current_session",DeletionInfoUpdate:"messaging_deletion_info_update",DeleteMessageWorkflow:"messaging_delete_message_workflow",UndeleteMessageWorkflow:"messaging_undelete_message_workflow",ReadReceiptsEnabledToggled:"toggle_read_receipts_enbaled",AckUrgentMessage:"messaging_ack_urgent_message",UpToEditBegin:"messaging_up_to_edit_message",VirtualListInitialStableView:"vl_initial_stable_view",VirtualListLoadMore:"vl_load_more",VirtualListNewRenderBounds:"vl_new_render_bounds",VirtualListScrollToStart:"vl_scroll_to_start",StopStreamingMessage:"stop_streaminng_message",SetConversationLiePendingBots:"set-conversation-lie-pending-bots",GetInstalledAppsForConversation:"get-installed-apps-for-conversation",PaidTFWSmsChatSendMessage:"paid_tfw_sms_chat_send_message",M365ChatSendQuery:"m365chat_send_query",M365ChatBotStopGenerating:"m365chat_stop_generating",M365MessageExtensionReferenceRenderer:"m365message_extension_reference_renderer",M365MessageExtensionCitationRenderer:"m365message_extension_citation_renderer",M365NestedMessageExtensionRenderer:"m365nested_message_extension_renderer",P2PSendNewMessageSfB:"chat_send_message_sfb",P2PSendNewMessageSfC:"chat_send_message_sfc",P2PSendNewMessageFederated:"chat_send_message_federated",P2PSendNewMessageNativeFederated:"chat_send_message_nativefederated",P2PSendNewMessageTfw:"chat_send_message_tfw",P2PSendNewMessageTfl:"chat_send_message_tfl",FluidFetchGLV2Manifest:"fluid_fetch_glv2_manifest",CreateThreadFailure:"create_thread_failure_due_to_chat_permissions",AddMemberFailure:"add_member_failure_due_to_chat_permissions",AddMemberFailureDuringCreateThread:"add_member_failure_during_create_thread_due_to_chat_permissions",RemoveMemberFailure:"remove_member_failure_due_to_chat_permissions",LeaveChatFailure:"leave_chat_failure_due_to_chat_permissions",RepliesSummaryChangeLatency:"message_replies_summary_latency",MessageReactionUpdate:"messaging_update_message_reaction",MessageReactionChangeLatency:"messaging_message_reaction_change_latency",MessageReactionAdd:"messaging_add_message_reaction",MessageReactionRemove:"messaging_remove_message_reaction",ReplyChainManagerGetPreviousAndNextMessagesForChat:"reply_chain_manager_get_previous_next_messages_for_chat",ReportConcernTFW:"report_concern_tfw",ReportSecurityConcernTFW:"report_security_concern_tfw",ReportConcernTFL:"report_concern_tfl",SendBizChatFeedback:"send_bizchat_feedback",EmojiLSCleanupJob:"emoji_ls_cleanup_job",EmojiLSCleanupTrigger:"emoji_ls_cleanup_trigger",MessagesListQuery:"messageslist_query",MetaosStoreExperienceCore:"metaos-store-experience-core",MTMAAggregatorMissedNotificationsData:"mtma_aggregator_missed_notifications_data",MTMAMissedNotificationsTrustedUiLaunch:"mtma_missed_notifications_trusted_ui_launch",MTMASecureDataBadgeEventPublished:"mtma_secure_data_badge_event_published",MTMAAggregatorMissedNotificationsDataWriteToCache:"mtma_aggregator_missed_notifications_data_write_to_cache",MTMAAggregatorMissedNotificationsDataReadFromCache:"mtma_aggregator_missed_notifications_data_read_from_cache",notificationBadgeMounter:"notifications_badge_mounter",notificationDropdownRender:"notifications_dropdown_render",missedMTMANotificationsRefetchAuthQuery:"missed_mtma_notifications_refetch_auth_query",NotificationsEngineCDLWorkflowStoreInit:"notifications_engine_cdl_workflow_store_init",NotificationsEngineCDLWorkflowNotificationsTypesInit:"notifications_engine_cdl_workflow_notifications_types_init",NotificationsEngineCDLWorkflowStoreGetData:"notifications_engine_cdl_workflow_store_get_data",NotificationsEngineCDLWorkflowStorePutData:"notifications_engine_cdl_workflow_store_put_data",GetOnboardingNotificationItem:"ext_onboarding_notifications_get_item",ViewOnboardingNotificationItemDetail:"ext_onboarding_notifications_view_detail",FreFetchEphemeralMsaProfile:"fre_fetch_ephemeral_profile",FreStampProfile:"fre_enable_profile_searchability",OsFileShare:"osfileshare",P2PFilesListSwitch:"documents_p2p_files_list_switch",P2PFilesListAllFiles:"documents_p2p_files_list_allfiles",P2PFilesListSwitchCommunities:"documents_p2p_files_list_switch_communities",P2PFilesListAllFilesFast:"documents_p2p_files_list_allfiles_fast",RemoveParticipantRender:"remove_participant_latency",ReportMisrecognizedParticipantRender:"report_misrecognized_participant_latency",NudgeParticipantRender:"nudge_participant_latency",MembersTabSearchFetchTags:"people_targeting_members_tab_search_fetch_tags",MembersTabFetchTags:"people_targeting_members_tab_fetch_tags",ManageTagsFetchTags:"people_targeting_manage_tags_fetch_tags",ManageTagsFetchDeletedTags:"people_targeting_manage_tags_fetch_deleted_tags",ManageTagsCreateTag:"people_targeting_manage_tags_create_tag",ManageTagsUpdateTag:"people_targeting_manage_tags_update_tag",ManageTagsAddTagMember:"people_targeting_manage_tags_add_tag_member",ManageTagsRemoveTagMember:"people_targeting_manage_tags_remove_tag_member",ManageTagsRestoreTag:"people_targeting_manage_tags_restore_tag",ManageTagsDeleteTag:"people_targeting_manage_tags_delete_tag",ManageTagsStartChatWithTag:"people_targeting_manage_tags_start_chat_with_tag",ManageTagsGetTagDetails:"people_targeting_manage_tags_get_tag_details",ManageTagsGetTeamTagSettings:"people_targeting_manage_tags_get_team_tag_settings",ManageTagsDropdownCreateTag:"people_targeting_manage_tags_dropdown_create_tag",ManageTagsDropdownAddOrRemoveTagsFromMember:"people_targeting_manage_tags_dropdown_add_remove_tags_from_member",PeoplePickerTagInitialization:"people_targeting_people_picker_tag_initialization",PeoplePickerGetDLMembers:"people_targeting_people_picker_get_dl_members",PeoplePickerAadDomain:"people_picker_aad_domain_lookup",PeoplePickerCustomProvider:"people_picker_load_results_custom_provider",PeoplePickerPeopleCacheSearch:"people_picker_search_people_cache",PeoplePickerRawContactsCacheSearch:"people_picker_search_raw_contacts_cache",PeoplePickerMfuContactsCacheSearch:"people_picker_search_mfu_contacts_cache",PeoplePickerGroupChatSearch:"people_picker_search_group_chats",PeoplePicker3SSearch:"people_picker_3s_search",PeoplePicker3SFallbackSearch:"people_picker_3s_fallback_search",PeoplePickerPeopleTFLZeroState:"people_picker_people_tfl_zero_state",PeoplePickerMfuContactsSearchTFLZeroState:"people_picker_mfu_tfl_zero_state",TFLZeroStateSuggestions:"tfl_zero_state_suggestions",TFLPeoplePickerSearch:"tfl_people_picker_search",PeoplePickerCache:"people_picker_load_results_clientonly",PeoplePickerPstnAssignmentRemote:"people_picker_pstn_resolve_user_remote",PeoplePickerRemote:"people_picker_load_results",PeoplePickerIDB:"people_picker_indexeddb",PeoplePicker3S:"people_picker_3s",PeoplePickerInstantScd:"people_picker_load_results_scd",PeoplePickerTFLSms:"people_picker_load_results_sms",PeoplePickerOffNetwork:"people_picker_load_results_off_network",PeoplePickerXTap:"people_picker_load_results_xtap",PeoplePickerAAD:"people_picker_aad",SharedChannelProfileFetchMultiple:"shared_channel_batch_profile_fetch",TFLClientProfileFetchJob:"tfl_client_profile_fetch_job",TFLConsumerProfileFetchJob:"tfl_consumer_profile_fetch_job",ExternalSearchJob:"people_picker_external_search_job",SearchV2SearchJob:"people_picker_searchv2_search_job",ContactsSyncSuggestedRawContacts:"contacts_sync_suggested_rawcontacts",AtMentionsPostResult:"people_at_mentions_post_result",MentionsManagerUsersUPSSearch:"mentions_manager_users_ups_search",EmptyAtMentions:"people_empty_at_mentions",AtMentions:"people_at_mentions",BuddyListSyncJob:"buddylist_sync_job",EditAvatar:"edit_avtar",MSASearchability:"msa_searchability",MSAAliasVisibility:"msa_alias_visibility",DDRProfileUpdateSyncWorkflow:"ddr_profile_update_sync_workflow",ProfileFetchSingle:"single_profile_fetch",BuddyListSyncWorkflow:"buddylist_sync_workflow",ProfileFetchMultiple:"multiple_profile_fetch",BuddyListAddMemberToGroup:"buddylist_add_member_to_group",BuddyListDeleteBlockedUserFromGroup:"buddylist_delete_blocked_user_from_group",ProfileFetchMultipleConversation:"multiple_profile_fetch_conversation",BuddyListGetBlockedContacts:"people_get_blocked_contacts",ProfileFetchME:"me_profile_fetch",FetchMsaMeProfile:"msa_me_profile_fetch",BuddyListUpdateBlockedContacts:"people_update_blocked_contacts",ContactsSyncSUggestedContactsSubscription:"contacts_sync_suggested_contacts_subscription",ContactsSyncSettingsCleanUp:"contacts_sync_settings_cleanup",AcceptBlockMSAUser:"block-unblock-msa-user",AcceptBlockSfCChat:"accept-block-sfc-chat",ExtendedDirectoryOnly:"extended-directory-only-fetch",MentionResolverIncrementProfileRequestCount:"mention-resolver-mutation-incrementprofilerequestcount",TenantPrivacyPolicyLinkGetResult:"people_tenant_privacy_policy_link_get_result",PostALT:"post_application_launch_time",AspSetTimeOutForNoneEvent:"asp_set_timeout_for_none_event",AspSetTimeOutForMissedCallEvent:"asp_set_timeout_for_missed_call_event",AspSetTimeOutForMeetingEvent:"asp_set_timeout_for_meeting_event",AspSetTimeOutForVoicemailEvent:"asp_set_timeout_for_voicemail_event",AspSetTimeOutForDailerEvent:"asp_set_timeout_for_dailer_event",AspSetTimeOutForTelemetryEvent:"asp_set_timeout_for_telemetry_event",AspCancelNoneEventToDevice:"asp_cancel_none_event",AspCancelMissedCallEventToDevice:"asp_cancel_missed_call_event",AspCancelMeetingEventToDevice:"asp_cancel_meeting_event",AspCancelVoicemailEventToDevice:"asp_cancel_voicemail_event",AspCancelDailerEventToDevice:"asp_cancel_dailer_event",AspCancelTelemetryEventToDevice:"asp_cancel_telemetry_event",AspConnectionFromApp:"hid_device_asp_connection_from_app",HidConfigurationFromApp:"hid_device_hid_configuration_from_app",PushCallStateFromApp:"hid_device_push_call_state_from_app",PushNotificationFromApp:"hid_device_push_notification_from_app",RequestCallStartTelemetryFromApp:"hid_device_request_call_start_telemetry_from_app",RequestDeviceChangeTelemetryFromApp:"hid_device_request_device_change_telemetry_from_app",RequestBTDeviceUpdateTelemetryFromApp:"hid_device_request_bt_device_update_telemetry_from_app",RequestPeriodicDataFromSelectedDeviceTelemetryFromApp:"hid_device_request_periodic_data_from_selected_device_telemetry_from_app",DeviceTriggeredTelemetryFromApp:"hid_device_device_triggered_telemetry_from_app",PullNotificationContextFromApp:"hid_device_pull_notification_context_from_app",DeskphoneSetupFromApp:"hid_device_deskphone_setup_from_app",DisplaySetupFromApp:"hid_device_display_setup_from_app",SelectDriverFromApp:"hid_device_select_driver_from_app",OpenFromApp:"hid_device_open_from_app",StartPulsingFromApp:"hid_device_start_pulsing_from_app",StartPulsingFromAppToNonSelectedHidDevice:"hid_device_start_pulsing_from_app_to_non_selected_hid_device",HookOnDevice:"hid_device_hook_on_device",HookOnNonSelectedHidDevice:"hid_device_hook_on_non_selected_hid_device",MuteOnDevice:"hid_device_mute_on_device",MuteOnNonSelectedHidDevice:"hid_device_mute_on_non_selected_hid_device",UnmuteFromApp:"hid_device_unmute_from_app",UnmuteFromAppToNonSelectedHidDevice:"hid_device_unmute_from_app_to_non_selected_hid_device",UnmuteOnDevice:"hid_device_unmute_on_device",FlashOnDevice:"hid_device_flash_on_device",FlashOnNonSelectedHidDevice:"hid_device_flash_on_non_selected_hid_device",UnmuteOnNonSelectedHidDevice:"hid_device_unmute_on_non_selected_hid_device",ResumeFromApp:"hid_device_resume_from_app",ResumeOnDevice:"hid_device_resume_on_device",ResumeOnNonSelectedHidDevice:"hid_device_resume_on_non_selected_hid_device",ResumeFromAppToNonSelectedHidDevice:"hid_device_resume_from_app_to_non_selected_hid_device",HoldFromApp:"hid_device_hold_from_app",HoldFromAppToNonSelectedHidDevice:"hid_device_hold_from_app_to_non_selected_hid_device",HoldOnDevice:"hid_device_hold_on_device",HoldOnNonSelectedHidDevice:"hid_device_hold_on_non_selected_hid_device",MuteFromApp:"hid_device_mute_from_app",OffHookFromApp:"hid_device_off_hook_from_app",OffHookFromAppToNonSelectedHidDevice:"hid_device_off_hook_from_app_to_non_selected_hid_device",OffHookOnDevice:"hid_device_off_hook_on_device",OffHookOnNonSelectedHidDevice:"hid_device_off_hook_on_non_selected_hid_device",HookFromApp:"hid_device_hook_from_app",HookFromAppToNonSelectedHidDevice:"hid_device_hook_from_app_to_non_selected_hid_device",RejectOnDevice:"hid_device_reject_on_device",RejectOnNonSelectedHidDevice:"hid_device_reject_on_non_selected_hid_device",StopPulsingFromApp:"hid_device_stop_pulsing_from_app",StopPulsingFromAppToNonSelectedHidDevice:"hid_device_stop_pulsing_from_app_to_non_selected_hid_device",VideoMuteFromApp:"hid_device_video_mute_from_app",VideoMuteFromAppToNonSelectedHidDevice:"hid_device_video_mute_from_app_to_non_selected_hid_device",VideoMuteOnDevice:"hid_device_video_mute_on_device",VideoMuteOnNonSelectedHidDevice:"hid_device_video_mute_on_non_selected_hid_device",PeriodicSyncOnDevice:"hid_device_periodic_sync_on_device",PushDynamicBandwidthNotificationOnDevice:"hid_device_push_dynamic_bandwidth_notification_on_device",AspRequestOnDevice:"hid_device_asp_request_on_device",AspResponseOnDevice:"hid_device_asp_response_on_device",ContentCameraOnDevice:"hid_device_content_camera_on_device",ContentCameraOnNonSelectedHidDevice:"hid_device_content_camera_on_non_selected_hid_device",TeamsButtonClickedOnDevice:"hid_device_teams_button_clicked_on_device",TeamsButtonClickedOnNonSelectedHidDevice:"hid_device_teams_button_clicked_on_non_selected_hid_device",VendorExtensionOnDevice:"hid_device_vendor_extension_on_device",DisplayAttributeOnDevice:"hid_device_display_attribute_on_device",DisplayControlReportOnDevice:"hid_device_display_control_report_on_device",CharacterAttributesOnDevice:"hid_device_character_attributes_on_device",ShortcutButtonContextPptLiveActiveOnDevice:"hid_device_shortcut_button_context_ppt_live_active_on_device",ShortcutButtonContextPptLiveInactiveOnDevice:"hid_device_shortcut_button_context_ppt_live_inactive_on_device",PptLaserPointLongPressedOnDevice:"hid_device_ppt_laser_point_long_pressed_on_device",PptLaserPointLongPressedOnNonSelectedHidDevice:"hid_device_ppt_laser_point_long_pressed_on_non_selected_hid_device",PptLaserPointReleasedOnDevice:"hid_device_ppt_laser_point_released_on_device",PptLaserPointReleasedOnNonSelectedHidDevice:"hid_device_ppt_laser_point_released_on_non_selected_hid_device",PptPrevSlidePressedOnDevice:"hid_device_ppt_prev_slide_pressed_on_device",PptPrevSlidePressedOnNonSelectedHidDevice:"hid_device_ppt_prev_slide_pressed_on_non_selected_hid_device",PptNextSlidePressedOnDevice:"hid_device_ppt_next_slide_pressed_on_device",PptNextSlidePressedOnNonSelectedHidDevice:"hid_device_ppt_next_slide_pressed_on_non_selected_hid_device",AnswerIncomingCallFromDevice:"hid_answer_incoming_call_from_device",AutoMuteToggleFromHidDevice:"hid_auto_mute_toggle_from_hid_device",CallAutoUnmuteFromHidDevice:"hid_call_auto_unmute_from_hid_device",HandleOnDidHookEvent:"hid_handle_on_did_hook_event",HidServiceReInitialize:"hid_service_reinitialize",HidServiceSfbRunningRegKeyChanged:"hid_service_sfb_running_regkey_changed",HidServiceSfbHidDisabledRegKeyChanged:"hid_service_sfb_hid_disabled_regkey_changed",HidServiceStopSfbHRegWatcher:"hid_service_stop_sfb_reg_watcher",SetupUserProfileForDisplayDevices:"hid_setup_user_profile_for_display_devices",UpdateActiveDeviceInCall:"hid_update_active_device_in_call",FindMatchingSlimcoreDevice:"asp_find_matching_slimcore_device",TeamsDeviceInitServices:"teams_device_services_init",GattPushNotificationFromApp:"gatt_device_push_notification_from_app",GattPushCallStateFromApp:"gatt_device_push_call_state_from_app",GattPullNotificationContextFromApp:"gatt_device_pull_notification_context_from_app",GattRequestCallStartTelemetryFromApp:"gatt_device_request_call_start_telemetry_from_app",GattRequestDeviceChangeTelemetryFromApp:"gatt_device_request_device_change_telemetry_from_app",GattRequestBtDeviceUpdateTelemetryFromApp:"gatt_device_request_bt_device_update_telemetry_from_app",GattRequestPeriodicDataFromSelectedDeviceTelemetryFromApp:"gatt_device_request_periodic_data_from_selected_device_telemetry_from_app",GattDeviceTriggeredTelemetryFromApp:"gatt_device_device_triggered_telemetry_from_app",GattAspReinitFromApp:"gatt_device_asp_reinit_from_app",GattAspConnectionFromApp:"gatt_device_asp_connection_from_app",GattGattTeamsButtonClickedOnDevice:"gatt_device_teams_button_clicked_on_device",AnswerIncomingCallFromBTDevice:"answer_incoming_call_from_bt_device",RejectIncomingCallFromBTDevice:"reject_incoming_call_from_bt_device",EndCallFromBTDevice:"end_call_from_bt_device",HoldCallFromBTDevice:"hold_call_from_bt_device",HandleHoldEventFromBTDeviceInMultipleCalls:"handle_hold_event_from_bt_device_in_multiple_calls",HandleFlashEventFromBTDeviceInMultipleCalls:"handle_flash_from_bt_device_in_multiple_calls",UpdateActiveBTDeviceInOngoingCall:"update_active_bt_device_in_ongoing_call",ReportNewIncomingCallToBTDevice:"report_new_incoming_call_to_bt_device",ReportCallAcceptedToBTDevice:"report_call_accepted_to_bt_device",ReportNewOutgoingCallToBTDevice:"report_new_outgoing_call_to_bt_device",ReportCallConnectedStateToBTDevice:"report_call_connected_state_to_bt_device",ReportHoldCallToBTDevice:"report_hold_call_to_bt_device",ReportResumeCallToBTDevice:"report_resume_call_to_bt_device",PersonBlockPerson:"person_block_person_mutation",PersonUnblockPerson:"person_unblock_person_mutation",OneGqlContactUnificationMigrationStatus:"fethcing_one_gql_contact_unification_migration_status",PersonViewSchemaIsPstnCallingAllowedResolver:"PersonViewSchemaIsPstnCallingAllowedResolver",PostPhonelinkSmsMessage:"phonelink_sms_post_message",MarkPhonelinkSmsConversationAsRead:"phonelink_sms_mark_conversation_as_read",GetPhonelinkSmsDeviceInfo:"phonelink_sms_get_device_info",PhonelinkSmsSyncworkflow:"phonelink_sms_sync_workflow",PlacesAutoDetectWorkLocationScenario:"places_auto_detect_work_location",PlacesAutoLocationWifiDisconnectedScenario:"places_auto_location_wifi_disconnected",PlacesADLProcessDetectedEvent:"places_adl_process_detected_event",PlacesADLCreateEventSubscription:"places_adl_create_event_subscription",AddAppDialogFetchAppDefinition:"ext_add_app_dialog_fetch_app_definition",AddAppDialogFetchTeamsOrChats:"ext_add_app_dialog_fetch_teams_or_chats",AddAppDialogFetchDiscoverMoreAppsData:"ext_add_app_dialog_fetch_discover_more_apps_data",AddAppDialogFetchAppStoreRating:"ext_add_app_dialog_fetch_app_store_rating",AddAppDialogGetInstallOptions:"ext_add_app_dialog_get_install_options",AddAppDialogFetchAdminAppRequestConfig:"ext_add_app_dialog_fetch_admin_app_request_config",AddAppDialogInstall:"ext_add_app_dialog_install",AddAppDialogUpgrade:"ext_add_app_dialog_upgrade",AddAppDialogRequestAccess:"ext_add_app_dialog_request_access",AddAppDialogPostInstall:"ext_add_app_dialog_post_install",AddAppDialogPopulateContent:"ext_add_app_dialog_populate_content",AddAppDialogShareAppDeepLink:"ext_add_app_dialog_share_app_deep_link",InstallApp:"ext_install_app",InstallAppFromAdaptiveCardFooter:"ext_install_app_from_ac_footer",InstallAppResultCacheUpdate:"ext_install_app_result_cache_update",ContextlessConfigEntry:"ext_contextless_config_entry",ContextlessConfigEntryFromStoreTile:"ext_contextless_config_entry_from_store_tile",ContextlessConfigOptionLoad:"ext_contextless_config_option_load",ContextlessConfigPersonalInstall:"ext_contextless_config_personal_install",ContextlessConfigTeamInstall:"ext_contextless_config_team_install",ContextlessConfigGroupChatInstall:"ext_contextless_config_group_chat_install",ContextlessConfigMeetingInstall:"ext_contextless_config_meeting_install",ContextlessConfigPersonalPostInstall:"ext_contextless_config_personal_post_install",ContextlessConfigTeamPostInstall:"ext_contextless_config_team_post_install",ContextlessConfigGroupChatPostInstall:"ext_contextless_config_group_chat_post_install",ContextlessConfigMeetingPostInstall:"ext_contextless_config_meeting_post_install",AppDdAppDefLoad:"ext_app_dd_app_def_load",InContextStoreAppEnableDialog:"ext_in_context_store_app_enable_dialog",PlatformUserLifecycleIncontextStoreInstallAppEvent:"platform_userlifecycle_incontext_store_install_app_event",AppsPlatformServiceGetInstalledApps:"ext_apps_platform_service_get_installed_apps",AppsPlatformServiceGetInstalledApp:"ext_apps_platform_service_get_installed_app",AppsPlatformServiceGetInstalledAppsForUser:"ext_apps_platform_service_get_installed_apps_for_user",AppsPlatformServiceDeleteApp:"ext_apps_platform_service_delete_app",ExtractAppDefinitionJob:"ext_extract_app_definition_job",TenantStagedAppsSyncJob:"ext_tenant_staged_apps_sync_job",TenantStagedAppsUploadJob:"ext_tenant_staged_apps_upload_job",TenantStagedAppsDeleteJob:"ext_tenant_staged_apps_delete_job",SideloadAppsUploadWorkflow:"ext_sideload_apps_upload_workflow",InvalidateAppsCacheWorkflow:"ext_invalidate_apps_cache_workflow",SideloadAppsUploadJob:"ext_sideload_apps_upload_job",SideloadAppsUpdateJob:"ext_sideload_apps_update_job",AppsUsageManagerGetAppsUsage:"ext_apps_usage_manager_get_apps_usage",AppsUsageManagerGetAppsUsageFromNetwork:"ext_apps_usage_manager_get_apps_usage_from_network",AppsUsageManagerRecordAppUsage:"ext_apps_usage_manager_record_app_usage",AppsUsageManagerRecordAppActionUsage:"ext_apps_usage_manager_record_app_action_usage",AppsUsageManagerRecordHostedAppContentUsage:"ext_apps_usage_manager_record_hosted_app_content_usage",AppsUsageManagerRecordAppCommandUsage:"ext_apps_usage_manager_record_app_commnd_usage",AppsUsageManagerInitialize:"ext_apps_usage_manager_initialize",AppsUsageManagerSyncWithBackend:"ext_apps_usage_manager_sync_with_backend",AppsUsageManagerMergeAndSaveAppsUsage:"ext_apps_usage_manager_merge_and_save_apps_usage",AppsUsageSyncWorkflow:"ext_apps_usage_sync_workflow",AppsUsageRecordUsageSyncWorkflow:"ext_apps_usage_record_usage_sync_workflow",ContextlessAppsSyncStrategySyncUnconsentedMRUApps:"ext_contextless_apps_sync_strategy_sync_unconsented_mru_apps",AppsUsageStrategyOnstartup:"ext_apps_usage_strategy_onstartup",AppsUsageStrategyOnappstatelonginactive:"ext_apps_usage_strategy_onappstatelonginactive",AppsUsageManagerSync:"ext_apps_usage_manager_sync",TenantStagedAppsSyncWorkflow:"ext_tenant_staged_apps_sync_workflow",TenantStagedAppsUploadWorkflow:"ext_tenant_staged_apps_upload_workflow",TenantStagedAppsDeleteWorkflow:"ext_tenant_staged_apps_delete_workflow",TenantStagedAppsManagerSyncTenantStagedApps:"ext_tenant_staged_apps_manager_sync_staged_apps",TenantStagedAppsManagerDeleteTenantStagedApp:"ext_tenant_staged_apps_manager_delete_staged_app",TenantStagedAppsManagerGetTenantStagedApps:"ext_tenant_staged_apps_manager_get_staged_apps",TenantStagedAppsManagerUploadTenantStagedApp:"ext_tenant_staged_apps_manager_upload_staged_apps",ExtractAppDefinitionFromServer:"ext_extract_app_definition_from_server",GetUserInstalledAppsJob:"ext_get_user_installed_apps_job",GetChannelInstalledAppsJob:"ext_get_channel_installed_apps_job",UserAppRequestManagerSyncBlockedAppDefinitionsByAppId:"user_app_request_manager_sync_blocked_app_definitions_by_appid",TeamInstalledAppsManagerGetTeamsInstalledApps:"team_installed_apps_manager_get_teams_entitlements",TeamInstalledAppsManagerGetFavTeamIdsWithNoCache:"team_installed_apps_manager_get_fav_teamids_with_no_cache",AppDefinitionsManagerGetAppDefinitionsForAppIds:"app_definitions_manager_get_app_definitions_for_appids",AppDefinitionsManagerGetAppDefinitionsForAppIdsWithVersion:"app_definitions_manager_get_app_definitions_for_appids_with_version",GetBatchAppDefinitionsJob:"ext_get_batch_app_definitions_job",TemplatedAppHelperGetTemplatedInstanceAppDef:"templated_apps_helper_get_templated_instance_app_def",UserInstalledAppsManagerMergeUnsavedPinnedApps:"user_installed_apps_manager_merge_unsaved_pinned_apps_from_store",InstallUserAppJob:"ext_install_user_app_job",InstallChatAppJob:"ext_install_chat_app_job",AppsPlatformWorkerResolverPinMessageExtension:"apps_platform_worker_resolver_pin_message_extension_v2",AppsPlatformWorkerResolverUnpinMessageExtension:"apps_platform_worker_resolver_unpin_message_extension_v2",DeleteAppJob:"ext_delete_app_job",UserInstalledAppsManagerUpdatePinnedMessageExtensionDetails:"user_installed_apps_manager_update-pinned-message-extension-details",AppsPlatformServiceGetAppDefinition:"ext_apps_platform_service_get_app_definition",AppsPlatformServiceGetBatchAppDefinition:"ext_apps_platform_service_get_batch_app_definition",AppsPlatformServiceInstallApp:"ext_apps_platform_service_install_app",AppsPlatformServiceUpgradeApp:"ext_apps_platform_service_upgrade_app",AppsPlatformServiceCreateAppEntitlement:"ext_apps_platform_service_create_app_entitlement",AppsPlatformWorkerResolverBlockUnblockBotChat:"ext_apps_platform_worker_resolver_block_unblock_bot_chat",AppsPlatformServiceReadAppDefinitions:"ext_apps_platform_service_read_app_definitions",AppsPlatformServiceReadAppEntitlements:"ext_apps_platform_service_read_app_entitlements",AppsPlatformServiceWriteAppDefinitions:"ext_apps_platform_service_write_app_definitions",AppsPlatformServiceWriteAppEntitlements:"ext_apps_platform_service_write_app_entitlements",AppsPlatformServiceResetAppEntitlementCache:"ext_apps_platform_service_reset_app_entitlement_cache",AppsPlatformServiceCheckAppDefinitionsCacheExpiration:"ext_apps_platform_service_check_app_definitions_cache_expiration",AppsPlatformServiceCheckAppEntitlementsCacheExpiration:"ext_apps_platform_service_check_app_entitlements_cache_expiration",AppsPlatformServiceGetUserAppPolicy:"ext_apps_platform_service_get_user_app_policy",AppsPlatformServiceCanUserManageTenantApps:"ext_apps_platform_service_can_user_manage_tenant_apps",AppsPlatformServiceSideLoadAppDefinition:"ext_apps_platform_service_sideload_app_definition",AppsPlatformServiceTrustedSideLoadAppDefinition:"ext_apps_platform_service_trusted_sideload_app_definition",AppsPlatformServiceInstallSideLoadApp:"ext_apps_platform_service_install_sideload_app",AppsPlatformServiceInstallTrustedSideLoadApp:"ext_apps_platform_service_install_trusted_sideload_app",AppsPlatformServiceAdminAppCatalogUpload:"ext_apps_platform_service_admin_app_catalog_upload",ExtGetAppImpression:"ext_get_app_impressions",UpdateAllPlatformAppsFetchPolicies:"ext_apps_update_all_fetch_policies",GetTeamInstalledAppDefinitionFromCache:"ext_get_installed_app_definition_from_teams_manager_cache",GetChatInstalledAppDefinitionFromCache:"ext_get_installed_app_definition_from_chat_manager_cache",GetUserInstalledAppDefinitionFromCache:"ext_get_installed_app_definition_from_user_manager_cache",GetChannelInstalledAppDefinitionFromCache:"ext_get_installed_app_definition_from_channel_manager_cache",UserInstalledAppsManagerGetInstalledAppsForAppBar:"ext_user_installed_apps_manager_get_installed_apps_for_appbar",AppDefinitionImagesManagerProcessDefinitions:"ext_app_def_images_manager_process_definitions",AppDefinitionImagesManagerGetProjectAgentUrl:"ext_app_def_images_manager_get_project_agent_url",AppDefinitionImagesManagerProcessWrappedAppDefinitions:"ext_app_def_images_manager_process_wrapped_app_definitions",AppDefinitionImagesManagerFetchAppImages:"ext_app_def_images_manager_fetch_ams_images",AppAmsIamgesFetchJob:"ext_app_ams_images_fetch_job",AppAmsIamgesFetchWorkflow:"ext_app_ams_images_fetch_workflow",TabsAdaptorManagerDeletePinnedTab:"ext_tabs_adaptor_manager_delete_pinned_tab",TabsAdaptorManagerCreatePinnedTab:"ext_tabs_adaptor_manager_create_pinned_tab",TabsAdaptorManagerUpdatePinnedTab:"ext_tabs_adaptor_manager_update_pinned_tab",TabsAdaptorManagerGetPinnedTabs:"ext_tabs_adaptor_manager_get_pinned_tabs",TabsAdaptorManagerGetPinnedTabsChannel:"ext_tabs_adaptor_manager_get_pinned_tabs_channel",AppsBarM365AppsResolver:"app_bar_m365apps_resolver",M365AppLinksWorkerResolver:"m365applinks_worker_resolver",AppsSuggestionUtilsGetInstalledAppDefintions:"apps_suggestion_utils_get_installed_app_definitions",AppsBarM365DefaultAppResolver:"app_bar_m365_default_app_resolver",AppsBarM365AppsGetAppsForSuggestionsSection:"app_bar_m365apps_get_apps_for_suggestions_section",AppsBarM365AppsGetAppsForUninstalledAppsSearchSection:"app_bar_m365apps_get_apps_for_uninstalled_apps_search_section",SuggestionsServiceGetAppSuggestions:"app_suggestions_service_get_app_suggestions",SuggestionsServiceGetAppSuggestionStoreItems:"app_suggestions_service_get_app_suggestion_store_items",AppsPlatformWorkerResolverInstalledAppsForMesssageAction:"apps_platform_worker_resolver_installed_apps_for_message_action",GptDefinitionResolverOAuthConfigId:"gpt_definition_resolver_oauth_config_id",AppBarManagerGetAppBarApps:"app_bar_apps_manager_get_app_bar_apps",AppBarManagerGetPinnedApps:"app_bar_apps_manager_get_pinned_apps",ComposeAppLinkURLShortening:"compose_app_link_url_shortening",AppBarManagerGetDefaultApp:"app_bar_apps_manager_get_default_app",AppSuggestionsManagerGetAppSuggestions:"app_suggestions_service_get_app_suggestions",AppSuggestionsManagerGetAppRatings:"app_suggestions_service_get_app_ratings",UserInstalledAppsManagerPinAppToAppBarForMetaOS:"user_installed_apps_manager_pin_app_to_app_bar_for_meta_os",AppsPlatformWorkerResolverPinAppToAppBarForMetaOS:"apps_platform_worker_resolver_pin_app_to_app_bar_for_meta_os",StoreServiceGetCollections:"ext_store_service_get_collections",StoreServiceGetItems:"ext_store_service_get_items",StoreServiceGetHeroItems:"ext_store_service_get_hero_items",StoreServiceQueryItems:"ext_store_service_query_items",StoreServiceQueryExtItems:"ext_store_service_query_ext_items",StoreServiceSuggestItems:"ext_store_service_suggest_items",StoreServiceContentRequest:"ext_store_service_content_request",StoreServiceArticleContentRequest:"ext_store_service_article_content_request",StoreServiceAppsRestore:"ext_store_service_apps_restore",StoreServiceAppsUpdateStartupCategories:"ext_store_service_apps_update_startup_categories",StoreServiceAppCategoriesDictionaryRequest:"ext_store_service_app_categories_dictionary_request",StoreServiceBatchedDefinitionsRequest:"ext_store_service_batched_definitions_request",StoreServiceGetCollectionsCache:"ext_store_service_get_collections_cache",StoreServiceInitTemplates:"ext_store_service_init_templates",StoreServiceTemplatedAppsRequest:"ext_store_service_templated_apps_request",StoreServiceGetTemplatedAppItems:"ext_store_service_get_templated_app_items",StoreServiceGetMoreTemplatedAppItems:"ext_store_service_get_more_templated_app_items",StoreServiceRefreshTemplatedAppItems:"ext_store_service_refresh_templated_app_items",StoreServiceCacheManagerGet:"ext_store_service_cache_manager_get",StoreServiceCacheManagerGetMultiple:"ext_store_service_cache_manager_get_multiple",StoreServiceLaunchFailuresCheck:"ext_store_service_launch_failures_check",StoreAppsStoreDataSyncWorkflow:"ext_store_apps_storedata_sync_workflow",StoreAppsStoreDataSyncJob:"ext_store_apps_storedata_sync_job",StoreEntry:"ext_store_entry",StoreSearchSuggestionQueryLoaded:"ext_store_suggest_items_loaded",StoreSwitchFeed:"ext_store_switch_feed",StoreSwitchCollection:"ext_store_switch_collection",StoreSwitchSearch:"ext_store_switch_search",StoreSwitchManageApps:"ext_store_switch_manage_apps",StoreSwitchArticle:"ext_store_switch_article",StoreCollectionLoadMore:"ext_store_collection_load_more",ManageAppsUninstall:"ext_manage_apps_uninstall",ManageAppsLoad:"ext_manage_apps_load",StoreFREDialogDisplay:"store_fre_dialog_display",StoreServiceSearchAppsRequest:"ext_store_service_search_apps_request",HostedFlyoutEntry:"ext_hosted_flyout_entry",InContextStoreDialogFetchInstalledAppsInScope:"ext_in_context_store_dialog_fetch_installed_apps",InContextStoreDialogCheckIfUserIsAllowedToInstall:"ext_in_context_store_dialog_check_if_user_is_allowed_to_install",InContextStoreDialogCheckUserAllowedToEnableDisableApps:"ext_in_context_store_dialog_check_user_allowed_to_enable_disable_apps",InContextStoreDialogPostInstall:"ext_in_context_store_dialog_post_install",InContextStoreDialogPostInstallOrEnable:"ext_in_context_store_dialog_post_install_or_enable",InContextStoreDialogPopulateFeedCollectionContent:"ext_in_context_store_dialog_populate_feed_collection_content",InContextStoreDialogPopulateSearchCollectionContent:"ext_in_context_store_dialog_populate_search_collection_content",InContextStoreDialogPopulateAppsGridContent:"ext_in_context_store_dialog_populate_apps_grid_content",PlatformHubSdkApiAuthenticate:"platform_tab_hub_sdk_authentication_authenticate",PlatformHubSdkApiNotifyFailure:"platform_tab_hub_sdk_authentication_notify_failure",PlatformHubSdkApiNotifySuccess:"platform_hub_sdk_api_authentication_notify_success",PlatformHubSdkApiOpenConversation:"platform_hub_sdk_api_chat_open_conversation",PlatformHubSdkApiCloseConversation:"platform_hub_sdk_api_chat_close_conversation",PlatformHubSdkApiGetChatMembers:"platform_hub_sdk_api_chat_get_chat_members",PlatformHubSdkApiExecuteDeepLink:"platform_hub_sdk_api_deeplinks_execute_deep_link",PlatformHubSdkApiShareDeepLink:"platform_hub_sdk_api_deeplinks_share_deep_link",PlatformHubSdkApiGetLocation:"platform_hub_sdk_api_location_get_location",PlatformHubSdkApiShowLocation:"platform_hub_sdk_api_location_show_location",PlatformHubSdkApiGetMedia:"platform_hub_sdk_api_media_get_media",PlatformHubSdkApiSelectMedia:"platform_hub_sdk_api_media_select_media",PlatformHubSdkApiViewImages:"platform_hub_sdk_api_media_view_images",PlatformHubSdkApiGetAuthenticationTokenForAnonymousUser:"platform_hub_sdk_api_meeting_get_authentication_token_for_anonymous_user",PlatformHubSdkApiGetIncomingClientAudioState:"platform_hub_sdk_api_meeting_get_incoming_client_audio_state",PlatformHubSdkApiGetMeetingDetails:"platform_hub_sdk_api_meeting_get_meeting_details",PlatformHubSdkApiToggleIncomingClientAudio:"platform_hub_sdk_api_meeting_toggle_incoming_client_audio",PlatformHubSdkApiGetAppContentStageSharingCapabilities:"platform_hub_sdk_api_meeting_get_app_content_stage_sharing_capabilities",PlatformHubSdkApiGetAppContentStageSharingState:"platform_hub_sdk_api_meeting_get_app_content_stage_sharing_state",PlatformHubSdkApiGetLiveStreamState:"platform_hub_sdk_api_meeting_get_live_stream_state",PlatformHubSdkApiRequestStartLiveStreaming:"platform_hub_sdk_api_meeting_request_start_live_streaming",PlatformHubSdkApiRequestStopLiveStreaming:"platform_hub_sdk_api_meeting_request_stop_live_streaming",PlatformHubSdkApiShareAppContentToStage:"platform_hub_sdk_api_meeting_share_app_content_to_stage",PlatformHubSdkApiStopSharingAppContentToStage:"platform_hub_sdk_api_meeting_stop_sharing_app_content_to_stage",PlatformHubSdkApiGetEligibilityInfo:"platform_hub_sdk_api_copilot_eligibility_get_eligibility_info",PlatformHubSdkApiGetConfig:"platform_hub_sdk_api_pages_config_get_config",PlatformHubSdkApiSetConfig:"platform_hub_sdk_api_pages_config_set_config",PlatformHubSdkApiRemoveFailure:"platform_hub_sdk_api_pages_config_remove_failure",PlatformHubSdkApiRemoveSuccess:"platform_hub_sdk_api_pages_config_remove_success",PlatformHubSdkApiSaveFailure:"platform_hub_sdk_api_pages_config_save_failure",PlatformHubSdkApiSaveSuccess:"platform_hub_sdk_api_pages_config_save_success",PlatformHubSdkApiSetValidityState:"platform_hub_sdk_api_pages_config_set_validity_state",PlatformHubSdkApiNavigateBack:"platform_hub_sdk_api_pages_navigate_back",PlatformHubSdkApiEnterFullscreen:"platform_hub_sdk_api_pages_enter_fullscreen",PlatformHubSdkApiExitFullscreen:"platform_hub_sdk_api_pages_exit_fullscreen",PlatformHubSdkApiNavigateCrossDomain:"platform_hub_sdk_api_pages_navigate_cross_domain",PlatformHubSdkApiReturnFocus:"platform_hub_sdk_api_pages_return_focus",PlatformHubSdkApiGetMruTabInstances:"platform_hub_sdk_api_pages_get_mru_tab_instances",PlatformHubSdkApiGetTabInstances:"platform_hub_sdk_api_pages_get_tab_instances",PlatformHubSdkApiNavigateToTab:"platform_hub_sdk_api_pages_navigate_to_tab",PlatformHubSdkApiNavigateToApp:"platform_hub_sdk_api_pages_navigate_to_app",PlatformHubSdkApiGetPermissionStatus:"platform_hub_sdk_api_permissions_get_permission_status",PlatformHubSdkApiRequestUserConsentForPermission:"platform_hub_sdk_api_permissions_request_user_consent_for_permission",PlatformHubSdkApiSelectPeople:"platform_hub_sdk_api_people_select_people",PlatformHubSdkApiGetUserJoinedTeams:"platform_hub_sdk_api_fulltrust_get_user_joined_teams",PlatformHubSdkApiGetConfigSetting:"platform_hub_sdk_api_fulltrust_get_config_setting",PlatformHubSdkApiSdkSelectAppEntity:"platform_hub_sdk_api_select_app_entity",PlatformHubSdkApiAuthenticateWithSSOAndResendRequest:"platform_hub_sdk_api_authenticate_with_sso_and_resend_request",ATPGetSafeUrl:"platform_tab_atp_get_safe_url",AppsPlatformWorkerResolverInstallPersonalAppQuery:"apps_platform_worker_resolver_installed_personal_app_query",PlatformTabSdkGetAuthenticationTokenForAnonymousUser:"platform_tab_sdk_get_authentication_token_for_guest_user",PlatformTabSDKRequestAppAudioHandling:"platform_tab_sdk_request_app_audio_handling",PlatformTabSDKRegisterAudioDeviceSelectionChanged:"platform_tab_sdk_register_audio_device_selection_changed",PlatformTabSDKRegisterMicStateChanged:"platform_tab_sdk_register_mic_state_changed",PlatformTabSDKMicStateUpdateFlow:"platform_tab_sdk_mic_state_update_flow",PlatformTabSDKSendMicMuteStatusResponse:"platform_tab_sdk_send_mic_mute_status_response",TabsUsageRecordUsageSyncJob:"tabs_usage_record_sync_job",PowerbarZQ3SFetch:"powerbar_zq_3s_fetch",PowerbarFirstQuery:"powerbar_query_first",PowerbarZeroQuery:"powerbar_query_zerostate",PowerbarExternalQuery:"powerbar_query_external",TopNIDBPopulate:"topn_idb_populate",GetTopNSuggestions:"get_topn_suggestions",FilesTopNIDBPopulate:"files_topn_idb_populate",GetFilesTopNSuggestions:"get_files_topn_suggestions",AutoSuggestNameSpaceRetryLoadScenario:"autosuggest_retry_namespace_load",PowerbarExternalSearchCheckScenario:"powerbar_external_search_check",PowerbarExternalSearchScenario:"powerbar_external_search",PowerbarExternalSearchCollabScenario:"powerbar_external_search_collab",PptSharingCreateWebView:"ppt_sharing_create_webview",PptSharingPresentationUrlReady:"ppt_sharing_pres_url_ready",PptSharingReloadScreenDisplayed:"ppt_sharing_reload_error_screen_displayed",PreJoinRoomSearchJoin:"prejoin_room_search_join",PreJoinRender:"calling_prejoin_render",PresenceCreateEndpointScenario:"unified_presence_t2_create_endpoint",PresenceCreateEndpointWorkflow:"unified_presence_t2_create_endpoint_workflow",PresenceCreateEndpointJob:"unified_presence_t2_create_endpoint_job",PresenceDeleteEndpointScenario:"unified_presence_t2_delete_endpoint",PresenceGetUsersBatchPresenceScenario:"unified_presence_t2_get_user_batch_presence",PresenceSyncPresenceScenario:"unified_presence_t2_sync_presence",SetUserInitiatedPresenceScenario:"unified_presence_t2_set_user_initiated_presence",PresencePublishPresenceScenario:"unified_presence_t2_publish_presence",PresenceSubscribePresenceScenario:"unified_presence_t2_subscribe_presence",PresencePostHeartbeatScenario:"unified_presence_t2_post_heartbeat",PresencePostHeartbeatWorkflow:"unified_presence_t2_post_heartbeat_workflow",PresencePostHeartbeatJob:"unified_presence_t2_post_heartbeat_job",SetStatusNoteScenario:"unified_presence_t2_set_status_note",SetWorkLocationScenario:"unified_presence_t2_set_work_location",TrouterUserActivityScenario:"unified_presence_t2_post_active_w_trouter",TrouterConnectEndpointCreateScenario:"unified_presence_t2_trouter_connect_endpoint",TrouterUpdateScenario:"unified_presence_trouter_update",GetPriorityContacts:"people_get_priority_contacts",AddPriorityContact:"people_add_priority_contact",RemovePriorityContact:"people_remove_priority_contact",OfficeIntegrationFreDialog:"t2_office_integration_fre_dialog",GetOofSettings:"get_oof_settings_t2.1",SetOofMessage:"set_oof_message_t2.1",PresentInMeeting:"present_in_meeting_start",SendMeetingReaction:"meeting_reactions_send_reaction",SendStreamingReaction:"streaming_reactions_send_reaction",ShowMettingRoomNpsSurvey:"show-meeting-room-nps-survey",StartMeetForMeetingRoomWhiteboardWalkUp:"start_meet_for_meeting_room_whiteboard_walk",StartMeetingRoomWhiteboardWalkUp:"start_meeting_room_whiteboard_walk",MeetingRoomAppEventReceived:"meeting_room_app_events_received",RoomPeopleCountSendDataToUWP:"room_people_count_send_data_to_uwp",VivaInsightsScheduleSendNudge:"viva_insights_schedule_send_suggestion-nudge",SenstivityLabelSync:"sensitivity_label_sync",SenstivityLabelPolicySettingsSync:"sensitivity_label_policy-settings_sync",SensitivityLabelPolicySettingsFetch:"sensitivity_label_policy_setting_query",SensitivityLabelUfd:"sensitivity_label_ufd_scenario",AllSearch:"search_all",MessageSearch:"search_message",FilesSearch:"search_files",PeopleSearch:"search_people",CommunitiesSearch:"search_communities",EngageCommunitiesSearch:"search_engage_communities",EmailSearch:"search_email",TeamChannelSearch:"search_team_channel",MeetingSearch:"search_meeting",ContextualSearchChat:"search_contextual_chat",ContextualSearchChannel:"search_contextual_channel",ContextualSearchTopics:"search_contextual_topics",ContextualSearchMetaOS:"search_contextual_metaos",CustomSearch:"search_custom",CustomSearchPreFetch:"custom_search_pre-fetch",EmailSearch3S:"search_email_3s",Search3SPrefetch:"search_3s_prefetch",ContextualSearchStart:"search_contextual_start",GroupChatSearch:"search_groupchats",TflPeopleSearch:"search_tfl_people",ContextRegionSearch:"search_context_region",ImageSearch:"search_image",ImageSearchPreview:"search_image_preview",OSearchJob:"osearch_job",OSearchWorkflow:"osearch_workflow",InstallAppDeeplinkShareToStage:"ext_install_app_deeplink_share_to_stage",SttExistingChatOrChannelSelection:"stt_existing_chat_channel_selection",SttExistingChatByUsersSearch:"stt_existing_chat_byusers_search",STTOInstall:"share_to_teams_outlook_install",E2EShareFormRender:"e2e_share_form_render",STTOutlookAddInNavigation:"stt_outlook_add_in_navigation",STTOutlookAddInStartup:"stt_outlook_add_in_startup",STTOutlookAuthStrap:"stt_outlook_auth_strap",STTOutlookPopulateUsage:"stt_outlook_populate_usage",STTRecentChannels:"stt_recent_channels",STTRecentChats:"stt_recent_chats",STTRecentRecipients:"stt_recent_recipients",STTOutlookZeroStateSuggestions:"stt_outlook_zero_state_suggestions",ShareFormAppInstall:"stt_app_install",GetContentSDK:"get_content_sdk",STTShareMeetingContent:"stt_worker_share_meeting_content",KeyboardShortcutSubscriptionEvent:"keyboard_shortcut_subscription",SimpleCollabsetChannelRecommendationMutation:"simple_collab_set_channel_recommendation_mutation",SimpleCollabDnDItemToConversationFolder:"simple_collab_dnd_item_to_conversation_folder",SimpleCollabResolverReorderConversationFolder:"simple_collab_resolver_reorder_conversation_folders",UpdateRCMSaveStatus:"update_rcm_save_status",ActivitySlicesFetchDataFromCDL:"activity_slices_fetch_data_from_cdl",StreamingClosedCaptionsInitializationE2ETrack:"streaming_closed_captions_initialization_time_track",StreamingConveneSharepointEmbedOnePlayerSetup:"streaming_convene_sharepoint_embed_oneplayer_setup",StreamingConveneSharepointEmbedOnePlayerPlayback:"streaming_convene_sharepoint_embed_oneplayer_playback",streamingParticipantspotlight:"streaming_participant_spotlight",ManagedModeStartSpotlight:"managed_mode_spotlight_state_start",ManagedModeStopSpotlight:"managed_mode_spotlight_state_stop",TeamsSeeAllChannelsSwitch:"team_see_all_channels_switch",UserOnboardingToTeamLoadNext:"useronboarding_to_team_load_next",UserOnboardingToTeamFilterSortLoad:"useronboarding_to_team_filter_sort_load",GetTeamByGroupId:"get_team_by_groupid",GetTeamsByGroupIds:"get_teams_by_groupids",SetChannelShowForMember:"set_channel_as_default",SetCollapsedConversationPropertyV2:"set_collapsed_conversation_property",UpdateManageTeamSettingsTags:"updatge_manage_team_settings_tags",GetTeamJoinCodeManageTeamSettings:"get_team_join_code_manage_teams_settings",UnArchiveTeam:"unarchive_team",checkWorkFlowStatus:"check_workflow_status",UpdateTeamThreadMembership:"update_team_thread_membership_ux",UpdatePrivateChannelThreadMembership:"update_private_channel_thread_membership_ux",UpdateSharedChannelThreadMembership:"update_shared_channel_thread_membership_ux",RemoveThreadMembershipMutation:"remove_thread_membership",StopSharingChannelWithTeamMutation:"stop_sharing_channel_with_team",GetSharedWithTeamsConnectionQuery:"get_shared_with_teams_connection",MembersConnectionQuery:"members_connection",UpdateMuteForTeamMutation:"update_mute_for_team",UpdateMuteForThreadMemberMutation:"update_mute_for_thread_member",UpdateTeamThreadMembershipMutation:"update_team_thread_membership",UpdatePrivateChannelThreadMembershipMutation:"update_private_channel_thread_membership",UpdateThreadMembershipMutation:"update_shared_channel_thread_membership",AddThreadMembershipMutation:"add_thread_membership",RestoreChannelMutation:"restore_deleted_channel",DeleteChannelMutation:"delete_channel",EditChannelMutation:"edit_channel",RestoreChannel:"restore_channel_dialog",DeleteChannel:"delete_channel_dialog",CheckWorkFlowStatusSubscription:"check_workflow_status_subscription",RosterSync:"admin_sync_membersfromaad",TeamsInsiderMTGetStatus:"teams_insider_middle_tier_get_status",TeamsInsiderMTOptIn:"teams_insider_middle_tier_opt_in",TeamsInsiderMTOptOut:"teams_insider_middle_tier_opt_out",TeamsInsiderSettingMigrationJob:"teams_insider_local_setting_migration_job",GetCrossTeamAnalytics:"get_cross_team_analytics_tas",TFLOnboardingSetTFLUserJob:"tfl_onboarding_set_tfl_user_job",TFLOnboardingSetTFLUserWorkflow:"tfl_onboarding_set_tfl_user_workflow",SMSThreadSearchJob:"sms_thread_search_job",ClaimInviteLink:"claim-invite-link",CreateOneOnOne2WaySms:"create-one-on-one-2-way-sms",SearchPhone2waySms:"search_phone_2way_sms",GroupInviteOffNetwork:"group_invite_offnetwork",RedeemInviteLink:"redeem-invite-link",RedeemInviteLinkMutation:"redeem-invite-link-mutation",ScheduledMeetingChicletGetCalendarEvent:"scheduled-meeting-chiclet-get-calendar-event",ScheduledMeetingChicletGetOccurrenceEvent:"scheduled-meeting-chiclet-get-occurrence-event",CreateChat2WaySmsOneOnOne:"create_chat_2way_sms_one_on_one",GetSkypeEntitlements:"get-skype-entitlements",GetPremiumTrialEnrollmentStatus:"get-premium-trial-enrollment-status",UpdatePremiumTrialEnrollmentStatus:"update-premium-trial-enrollment-status",SkypeRecordingPlayback:"skype-recording-playback",ThreadingUpdateThreadsForMAAR:"threading_update_threads_for_maar",UpdateRCMFollowUnfollowStatus:"update_rcm_follow_unfollow_status",AcquireIC3GatewayAADTokenForAudienceBot:"acquire_ic3_gateway_aad_token_for_audience_bot",TrafficCopPIEMonitor:"traffic_cop_pie_monitor",MinimumWV2VersionBannerButton:"minimum_wv2_version_banner_button",MinimumWV2VersionBanner:"minimum_wv2_version_banner",KnowMoreAboutWV2Clicked:"know_more_about_wv2",OSMinimumVersionCheckTask:"unsupported_os_version_blocking_page_check",EnableBeaconDetector:"ultrasound_enable_beacon_detector",DisableBeaconDetector:"ultrasound_disable_beacon_detector",EnableBeaconProducer:"ultrasound_enable_beacon_producer",Init:"ultrasound_init",PayloadProcessing:"ultrasound_payload_processing",SetAudioConfig:"ultrasound_set_audio_config",DetectMultipleUltrasoundMTRs:"ultrasound_detect_multiple_mtrs",UnifiedConsentLoadHostApp:"uc_load_host_app",UnifiedConsentRequestConsent:"uc_request_consent",UnifiedConsentAccepted:"uc_accept_consent",SlimcoreVDIInit:"slimcore_vdi_init",VDIBridgeStopped:"vdi_bridge_stopped",SlimCoreVdiServiceInit:"slimcore_vdi_service_init",EnsureSlimCoreVdiConnectionAttempt:"ensure_slimcore_vdi_connection_attempt",SlimCorePieVdiStartOcclusionTracking:"slimcore_pie_vdi_start_occlusion_tracking",SlimCorePieVdiStopOcclusionTracking:"slimcore_pie_vdi_stop_occlusion_tracking",SlimCoreVdiStateConnect:"slimcore_vdi_state_connect",SlimCoreVDIOverrideModeHistory:"slimcore_vdi_override_mode_history",SlimCoreVDIOptimizationModeState:"slimcore_vdi_optimization_mode_state",SlimCoreVdiStateDisconnect:"slimcore_vdi_state_disconnect",SlimCoreVdiStateSessionChange:"slimcore_vdi_state_session_change",slimCoreVdiHidCreatorIdState:"slimcore_vdi_hid_creator_id_state",SlimcoreVdiSetupVMSSCompanionSlimCoreInstance:"slimcore_vdi_setup_vmss_companion_slimcore_instance",SlimcoreVdiSetupVMSSCompanionCallingStack:"slimcore_vdi_setup_vmss_companion_calling_stack",SlimcoreVdiCreateVMSSCompanionCallRegistry:"slimcore_vdi_create_vmss_companion_call_registry",SlimcoreVdiInitializeVMSSCompanionCallRegistry:"slimcore_vdi_initialize_vmss_companion_call_registry",slimCoreVdiGlobalStateSubscriptionSlimCorePieVdiState:"slimcore_vdi_global_state_subscription_slimcorepievdistate",SlimCoreVdiBRBEvents:"slimcore_vdi_brb_events",SlimCoreVdiWerRegistration:"slimcore_vdi_wer_registration",SlimCoreVdiEnsureConnectionAttemptSteps:"slimcore_vdi_ensure_connection_attempt_steps",SlimCoreVdiUserVideoBackgroundPersonalFileDetails:"slimcore_vdi_user_video_background_personal_file_details",SlimCoreVdiUserVideoBackgroundUpload:"slimcore_vdi_user_video_background_upload",VideoMessageBlobsGC:"video_message_blobs_gc",OnePlayerLoaderFetch:"oneplayer_loader_fetch",VirtualEventTownHallEmbedAmpSetup:"virtual_event_townhall_embed_amp_setup",VirtualEventTownHallEmbedOnePlayerSetup:"virtual_event_townhall_embed_oneplayer_setup",ChatWithOrganizersAndPresentersCmdBar:"chat_with_event_team_cmd_bar",ChatWithOrganizersAndPresentersScheduleForm:"chat_with_event_team_schedule_form",DecodeAndSanitizeJoinDetailsHtml:"decode_sanitize_join_details_html",OCDIRedirect:"ocdi_redirect",NetworkPolicyFetch:"policy_service_fetch_network",UserPreferencesManagerGetByCategoy:"user_preferences_manager_get_by_category",UserPreferencesWorkerResolverQuery:"user_preferences_worker_resolvers_query",UserPreferencesWorkerResolverQueryCategoryBased:"user_preferences_worker_resolvers_query_category_based",UserPreferencesWorkerResolverMutation:"user_preferences_worker_resolvers_mutation",DiagnosticsGetLogsFromLocalStorage:"diagnostics_logs_get_from_local_storage",DiagnosticsAddLogsIntoIDB:"diagnostics_logs_adding_into_idb",DiagnosticsClearIDBStore:"diagnostic_logs_clear_idb_store",DiagnosticsCreateIDBStore:"diagnostics_logs_create_idb_store",DiagnosticsDeleteIDB:"diagnostics_logs_delete_idb_db",DiagnosticsDeleteLogsInIDB:"diagnostics_logs_delete_idb_item",DiagnosticsDisableIDB:"diagnostics_logs_disable_idb",DiagnosticsOpenIDB:"diagnostics_logs_open_idb",DiagnosticsGetAllLogsFromIDB:"diagnostics_logs_get_all_items_from_idb",DiagnosticsGetAllKeysFromIDB:"diagnostics_logs_get_all_keys_from_idb",DiagnosticsSaveIDBItemMain:"diagnostics_logs_save_idb_item_main",DiagnosticsUpdateIDBItem:"diagnostics_logs_updating_idb_item",DiagnosticsUpdateIDBKey:"diagnostics_logs_updating_idb_key",DiagnosticsInitOPFS:"diagnostics_logs_initialize_opfs",DiagnosticsSaveOPFSItemMain:"diagnostics_logs_save_opfs_item_main",DiagnosticsAddLogsIntoOPFS:"diagnostics_logs_adding_into_opfs",DiagnosticsDeleteLogsInOPFS:"diagnostics_logs_delete_opfs_item",DiagnosticsGetAllLogsFromOPFS:"diagnostics_logs_get_all_items_from_opfs",DiagnosticsGetAllKeysFromOPFS:"diagnostics_logs_get_all_keys_from_opfs",DiagnosticsClearOPFSFolder:"diagnostic_logs_clear_opfs_folder",DiagnosticsDisableOPFS:"diagnostics_logs_disable_opfs",DiagnosticsSaveToExtendedStorageMain:"diagnostics_logs_save_extended_storage_main",RetrieveRegistrationReport:"retrieveregistrationreport",DelayLoadMeshApp:"mesh_delay_load",WikiMigrationStart:"wiki_migration_migration_start",WikiMigrationCompleted:"wiki_migration_migration_complete",extendedContactsStats:"extended_contacts_statistics",YammerQnaAppDefinitionFetch:"yammerqna_app_definition_fetch",YammerQnaAppRealTimeUnRecoverabler:"yammerqna_app_realtime_unrecoverabler",YammerQnaAppRealTimeError:"yammerqna_app_realtime_error"},o),l=r({SliceListFetchTriggered:"slice_list_prefetch_triggered",SlicesActivityFeedMounted:"slice_activity_feed_mounted",CDLEarlyFetchStart:"cdl_early_fetch_start",CDLEarlyFetchEnd:"cdl_early_fetch_end",ActivityFeedMetaDataInsertedIntoStore:"activity_feed_metadata_inserted_into_store",SliceReplyChainsRemoved:"slice_replychains_removed",SliceReplyChainsUpdated:"slice_replychains_updated",SliceReplyChainsValidated:"slice_replychains_validated",scenarioCreatedWhiteboardSharingStartedEventSubscription:"scenario_created-whiteboard-sharing-started-event-subscription",scenarioCreatedWhiteboardSharingAddedEventSubscription:"scenario_created-whiteboard-sharing-added-event-subscription",ExtAppBasedLinkFetchAppDetailsGetURLStart:"ext_app_based_link_fetch_app_details_get_URL_start",ExtAppBasedLinkFetchAppDetailsGetURLEnd:"ext_app_based_link_fetch_app_details_get_URL_end",AppDetailsDialogDiscoverMoreAppsFetchAppDefintion:"app_details_dialog_discover_more_apps_fetch_app_definition",AppDetailsDialogDiscoverMoreAppsFetchBlockedAppDefintion:"app_details_dialog_discover_more_apps_fetch_blocked_app_definition",AppDetailsDialogDiscoverMoreAppsFetchAppDefintions:"app_details_dialog_discover_more_apps_fetch_app_definitions",FetchedAppSuggestionsFromSkyeTeamsAppRanking:"fetched_app_suggestions_from_skype_teams_app_ranking",TransformAppSuggestionsFromSkyeTeamsAppRanking:"transform_app_suggestions_from_skype_teams_app_ranking",T1UninstallDelayDisabled:"enable_t1_uninstall_delay_disabled",AppSwitcherPolicyExpirationType:"appswitcher_tac_policy_expiration_type",AuthStartUpdateMruStart:"auth_web_initialization_update_mru_start",AuthStartUpdateMruStop:"auth_web_initialization_update_mru_stop",AuthWebDisplayAccountsMapHostMachineUsers:"auth_web_display_accounts_map_hostmachine_users",AuthWebDisplayAccountsMapCachedUsers:"auth_web_display_accounts_map_cache_users",AuthAccountSelectionDisplayAccountsFilterAnon:"auth_account_selection_display_accounts_filter_Anon",OneChatInviteUserComplete:"onechat_invite_user_complete",OneChatAddUserToThreadComplete:"onechat_add_user_to_thread_complete",AuthWebUpdateTenantsCrossCloud:"auth_web_update_tenants_crosscloud",AuthWebDeleteTenantsStop:"aauth_web_delete_tenants_stop",AuthHandleTenantsPushNotificationEnd:"auth_handle_tenants_push_notification_stop",AuthWebAuthAppReAuthenticateStart:"auth_web_auth_app_reauthenticate_start",AuthWebAuthAppReAuthenticateStop:"auth_web_auth_app_reauthenticate_stop",AuthServiceLogoutCleanupStop:"auth_service_logout_cleaup_stop",AuthServiceBaseLogoutUserMismatch:"user-misMatch",AuthServiceBaseProviderFail:"provider_fail",AuthServiceBaseProviderStart:"provider_start",AuthServiceBaseProviderStop:"provider_end",AuthServiceLogoutAuditStart:"logout_audit_start",AuthServiceLogoutAuditStop:"logout_audit_end",AuthServiceLogoutAuditFail:"logout_audit_fail",AuthWebUpdateMru:"auth_web_update_mru_start",AuthWebMru:"auth_web_module_end",AuthWebView2UpdateMostRecentUserFail:"auth_webview2_update_most_recent_user_fail",AuthWebView2UpdateMostRecentUserFailGenericCatch:"auth_webview2_update_mru_generic_catch",AuthWebInitializeAccountsDisableMAStart:"auth_web_initialize_accounts_disable_ma_start",AuthWebInitializeAccountsDisableMAStop:"auth_web_initialize_accounts_disable_ma_stop",AuthWebGetUserAuthStateResolverStop:"auth_web_get_user_auth_state_stop",MultiAccountGraphQLOperation:"multiaccount_graphql_operation",AccountSettingsGraphQLOperation:"accountsettings_graphql_operation",GetUserRelationsFinished:"get_user_relations_finshed",GetAuthenticationUsersDataFinshed:"get_authentication_users_data_finished",AccountListGraphQLOperation:"accountlist_graphql_operation",AuthEndPagesGraphQLOperation:"authendpages_graphql_operation",CMDGetUserEnrollmentStatusV1:"cmd_get_user_enrollment_status_v1",CMDGetUserEnrollmentStatusV2:"cmd_get_user_enrollment_status_v2",FetchVoiceEnrollmentStatus:"Fetching voice enrollment status from downstream",ReceivedUserVoiceUnenrolledFromCMD:"Received user voice enroll status as unenrolled from CMD",ForceFetchEnrollmentStatus:"forceFetchEnrollmentStatus is enabled",EmitUserVoiceEnrollmentStatusChanged:"Emit with eventing service that user voice enrollment status has changed",UpdatingRegistryWithLocalCachedEnrollmentStatus:"Update registry with local cached enrollment status",GettingCachedVoiceEnrollmentStatusFromRegistry:"Getting cached voice enrollment status from registry",SendPassiveConsentToBiometricService:"Sending passive consent to biometric service",SuccessfullySentPassiveConsentToBiometricService:"Successfully Sent passive consent to biometric service",NoNeedToUpdateConsentTextVersionToBiometricService:"No need to update consent text version to biometric service",GetCachedPassiveEnrollmentConsent:"Get cached user passive enrollment consent",NoCachedPassiveEnrollmentConsent:"No cached passive enrollment consent",GetPassiveEnrollmentConsentFromSettingStore:"Get passive enrollment consent from Setting Store",ExtBotsSignInOnLaunchWebflow:"ext_bots_signin_webflow_started",ExtBotsSignInOnSdkNotifySuccess:"ext_bots_signin_sdk_notify_success",ExtBotsSignInOnSdkNotifyFailure:"ext_bots_signin_sdk_notify_failure",ExtBotsSignInOnInvokStateVerificationDone:"ext_bots_signin_invoke_state_done",ExtBotsSignInOnInvokStateVerificationFailed:"ext_bots_signin_invoke_state_failed",BreakoutRoomAnnouncementSendMessageResultProcessing:"send_message_result_processing",BreakoutRoomAnnouncementSendMessageListBreakoutRoomsQuery:"list_breakout_rooms_query",BreakoutRoomAnnouncementCoordinatesRoomQuery:"room_coordinates_query",BreakoutRoomButtonCheckMeetingType:"check_meeting_type",BreakoutRoomButtonFetchListBreakoutRooms:"fetch_list_breakout_rooms",BreakoutRoomCreationListBreakoutRoomsQuery:"list_breakout_rooms_query",BreakoutRoomCreationGetParticipants:"breakout_rooms_creation_get_participants",BreakoutRoomCreationCreateBreakoutRoomsMutation:"create_breakout_rooms_mutation",BreakoutRoomEnableRoomsMutation:"enable_rooms_mutation",BreakoutRoomDisableRoomsMutation:"disable_rooms_mutation",BreakoutRoomCreationWaitFullRoster:"wait_full_roster",BreakoutRoomCreationPreserveRoomsParticipants:"preserve_rooms_participants",BreakoutRoomsFinishedFetchingConversationData:"finished_fetching_conversation_data",BreakoutRoomsFinishFetchingCalendarData:"finished_fetching_calendar_data",BreakoutRoomsFinishFetchingTeamMembers:"finished_fetching_team_members",BreakoutRoomsFinishedFetchingAssignees:"finished_fetching_assignees",BreakoutRoomsOpenRightRailFetchData:"fetch_data",ListOfRoomsInTabFetched:"breakout_rooms_list_of_rooms_in_tab_fetched",ParticipantsInTabFetched:"breakout_rooms_participants_in_tab_fetched",EntityOptionsInTabFetched:"breakout_rooms_entity_options_in_tab_fetched",BroadcastPlaybackRetried:"Retry",LiveStreamTick:"Tick",CalPeoplePickerSearchPeopleUsing3SApiStart:"cal_people_picker_search_people_using_3S_api_start",CalPeoplePickerSearchPeopleUsing3SApiSuccess:"cal_people_picker_search_people_using_3S_api_success",CalPeoplePickerSearchPeopleUsing3SApiFail:"cal_people_picker_search_people_using_3S_api_fail",CalendarTrackingScenarioStarted:"cal_tracking_scenario_started",CalendarRootContainerLoadStarted:"cal_root_container_load_started",CalendarRootContainerLoaded:"cal_root_container_loaded",CalendarViewBundleLoadStarted:"cal_view_bundle_load_started",CalendarSurfaceBundleLoadStarted:"cal_surface_bundle_load_started",CalendarSurfaceBundleLoaded:"cal_surface_bundle_loaded",CalendarViewBundleLoaded:"cal_view_bundle_loaded",CalendarAppHostBundleLoadStarted:"cal_app_host_bundle_load_started",CalendarAppHostBundleLoaded:"cal_app_host_container_loaded",CalendarAgendaViewBundleLoadStarted:"cal_agenda_view_bundle_load_started",CalendarAgendaViewBundleLoaded:"cal_agenda_view_container_loaded",LegacyScenarioStopped:"teams_cal_v3_stopped",ExternalCalendarSurfaceLoadStarted:"external_cal_surface_load_started",DefaultCalendarSurfaceLoadStarted:"default_cal_surface_load_started",CalJoinMeetingEventId:"cal_join_meeting_eventId",LiveMeetingStatusBarSubscriptionOnIdleJobStarted:"on_idle_job_started",LiveMeetingStatusBarSubscriptionManagerInstantiated:"subscription_manager_created",LiveMeetingStatusBarSubscriptionOnIdleMeetingsSyncStarted:"meetings_sync_started",LiveMeetingStatusBarSubscriptionOnIdleJobFailed:"on_idle_job_failed",LiveMeetingStatusBarSubscriptionProcessEventReceived128:"received_128",LiveMeetingStatusBarSubscriptionProcessEventReceived115:"received_115",LiveMeetingStatusBarSubscriptionProcessEventReceived2006:"received_2006",LiveMeetingStatusBarSubscriptionProcessEventReceivedOnMeetingTimeout:"received_on_meeting_timeout",LiveMeetingStatusBarSubscriptionProcessEventAddMeetingMutation:"add_meeting_mutation_called",LiveMeetingStatusBarSubscriptionProcessEventAddMeetingMutationSuccessful:"add_meeting_mutation_successful",LiveMeetingStatusBarSubscriptionProcessEventMeetingScheduledForRemoval:"meeting_scheduled_for_removal",LiveMeetingStatusBarSubscriptionProcessEventRemoveMeetingMutation:"remove_meeting_mutation_called",LiveMeetingStatusBarSubscriptionProcessEventRemoveMeetingMutationSuccessful:"remove_meeting_mutation_successful",LiveMeetingStatusBarSubscriptionProcessEventRemoveAllMeetingsMutation:"remove_all_meetings_mutation_called",LiveMeetingStatusBarSubscriptionProcessEventRemoveAllMeetingsMutationSuccessful:"remove_all_meetings_mutation_successful",LiveMeetingStatusBarSubscriptionProcessEventCallFireMeetingJoinCommand:"call_fire_meeting_join_command",LiveMeetingStatusBarMeetingLifecycleMeetingStarted:"meeting_started",LiveMeetingStatusBarMeetingLifecycleMeetingMarkedForEnd:"meeting_marked_for_end",LiveMeetingStatusBarMeetingLifecycleMeetingSustained:"meeting_sustained",LiveMeetingStatusBarMeetingLifecycleMeetingEnded:"meeting_ended",LiveMeetingStatusBarOnCommandFromBannerJoin:"received_join",LiveMeetingStatusBarOnCommandFromBannerViewMeetings:"received_view_meetings",LiveMeetingStatusBarOnCommandFromBannerViewMeetingsT21Surface:"show_t21_calendar_surface",LiveMeetingStatusBarOnCommandFromBannerViewMeetingsM365Surface:"show_m365_calendar_surface",LiveMeetingStatusBarOnCommandFromBannerDismiss:"received_dismiss",LiveMeetingStatusBarOnCommandFromBannerFireCallingIntentMutationSuccessful:"fire_calling_intent_mutation_successful",LiveMeetingStatusBarOnCommandFromBannerremoveAllMeetingsMutationSuccessful:"remove_all_meetings_mutation_successful",FetchCalendarEvents:"fetch_calendar_events_start",FailedToFetchEventFromCDL:"failed_to_fetch_events_from_cdl",StartImplementation:"startz_implementation",FetchedConnectedCalendarSettings:"fetch_connected_calendar_settings",FetchCalendarLeftRailSettingsSuccess:"fetch_cal_left_rail_settings_success",FetchMeetingArtifactsSuccess:"fetch_meeting_artefacts_success",FetchMeetingArtifactsError:"fetch_meeting_artefacts_error",LiveMeetingStatusBarMeetingStartedNotificationServiceEventReceived:"event_received",LiveMeetingStatusBarMeetingStartedNotificationServiceEventParsed:"event_parsed",LiveMeetingStatusBarMeetingStartedNotificationServiceEventValidated:"event_validated",LiveMeetingStatusBarMeetingStartedNotificationServiceEventServiceRetrieved:"event_service_retrieved",LiveMeetingStatusBarUserJoinedCallServiceEventReceived:"event_received",LiveMeetingStatusBarUserJoinedCallServiceEventParsed:"event_parsed",LiveMeetingStatusBarUserJoinedCallServiceEventValidated:"event_validated",LiveMeetingStatusBarUserJoinedCallServiceEventServiceRetrieved:"event_service_retrieved",DownloadedTranscriptWhenUploadFailed:"download_transcript_succeed_when_upload_failed",PanelRenderedForRTT:"panel_rendered_for_rtt",B2gRcSessionAlreadyAccepted:"b2g:rc:sessionAlreadyAccepted",ShowMoveAnnouncementUFD:"show_move_announcement_UFD",CallConnectedSuccess:"callConnectedSuccess",ShowIntentSuccess:"showIntentSuccess",SkypeAuthTokenRefreshed:"skypeAuth:tokenRefreshed",ConversationIdSetOnIncomingCall:"conversationId_set_on_incoming_call",CallStateChanged:"callStateChanged",VdiWaitForCallingAllowed:"vdiWaitForCallingAllowed",UpdateDisplayNameFailed:"updateDisplayNameFailed",UpdateDisplayNameIfNeeded:"updateDisplayNameIfNeeded",UpdateDisplayNameNotPerformed:"updateDisplayNameNotPerformed",IdentityChanged:"identityChanged",ReLogingFailed:"reLogingFailed",NavigatingToPreJoinScreen:"navigatingToPreJoinScreen",StreamInfo:"streamInfo",VideoReady:"videoReady",CoordinateStart:"coordinate-start",CoordinateFailed:"coordinate-failed",CoordinateCallbackFailure:"coordinate-callback-failure",CoordinateCallbackStart:"coordinate-callback-start",CoordinateCallbackSuccess:"coordinate-callback-success",CoordinateSucceeded:"coordinate-succeeded",FailedToUpdateMeetingThreadInfo:"failedToUpdateMeetingThreadInfo",MeetingOrganizerFetching:"meetingOrganizerFetching",MeetingOrganizerFetched:"meetingOrganizerFetched",MeetingOrganizerFetchFailed:"meetingOrganizerFetchFailed",InPreheatingState:"in preheating state",ReceivedDevicesSuccessfullyOnPrejoin:"Received devices successfully on prejoin",CallingPmpApiForRequestId:"Calling PMP API",NoDevicesReceivedFromPmp:"No devices received from PMP",IgnoringNonUsbCompositeAudioDevice:"Ignoring non USB Composite audio device",ErrorInCallingPmpApi:"Error in calling PMP API",IgnoringCameraDevice:"Ignoring camera device",ConvertTelephonyDevicesMatchingPeripheralNotFound:"ConvertTelephonyDevices - matching peripheral not found",PmpDeviceMetadata:"logging device metadata status",ReceivedAValidByodRoomFromPmp:"Received a valid BYOD room from PMP",CachedResponse:"Returned a cached response",PmpScreenMetadata:"logging screen metadata status",StartDeviceDiscoveryFetch:"Start Native device discovery",B2gRcEndpointReceived:"b2g:rc:endpointReceived",B2gRcInvalidEndpoint:"b2g:rc:invalidEndpoint",B2gRcPairingRequested:"b2g:rc:pairingRequested",B2gRcPairingFailed:"b2g:rc:pairingFailed",B2gRcPairingSucceeded:"b2g:rc:pairingSucceeded",BttStackInfoDefined:"bttStackInfoDefined",ReadyForInit:"ReadyForInit",SlimcoreDefined:"slimcoreDefined",BetterTogetherStackInitialized:"betterTogetherStackInitialized",GetBttTransportStack:"getBttTransportStack",AuthTokenCallbackCreated:"authTokenCallbackCreated",GetBttTransportUser:"getBttTransportUser",RemoveCachedSignatureFailed:"Failure to remove cached signature",FailedToRemoveCachedSignature:"Error caught when removing cached signature",SetVoiceSignatureUnenroll:"Attempt to unenroll voice signature via device manager setVoiceSignature",SetVoiceSignatureUnenrollFailed:"Error result from calling device manager setVoiceSignature to unenroll voice signature",GettingCachedVoiceEnrollmentStatus:"Getting cached voice enrollment status",CachingUserVoiceEnrollmentStatus:"Caching user voice enrollment status",BroadcastServiceTimeoutErrorCode:"timeout",ReceivedIncompleteStreamUpdate:"received-incomplete-stream-update",ReceivedBroadcastStreamUpdate:"received-broadcast-stream-update",AutoAcceptAllowed:"Auto_accept_allowed",SaltFound:"Salt_found",ResolvedUserProfile:"Resolved_user_profile",ParticipantMuted:"participant muted",ParticipantLeft:"participant left",FailShown:"fail shown",CheckCanEnableVideo:"checkCanEnableVideo",GetUserMedia:"getUserMedia",ToggleVideoInternal:"toggleLocalVideo",ToggleLocalVideoFinished:"toggleLocalVideoFinished",ToggleLocalVideoFailed:"toggleLocalVideoFailed",InvokingResendRegistration:"invokingResendRegistration",MalformedConversationId:"malformedConversationId",StopInitOnInvalidDeviceLicenseSurfaceHub:"StopInitOnInvalidDeviceLicenseSurfaceHub",InitEvents:"InitEvents",CreateCallRegistry:"CreateCallRegistry",CallStateVerified:"CallStateVerified",ClearMeetingInfo:"ClearMeetingInfo",Authenticate:"Authenticate",GetSkypeIdentity:"GetSkypeIdentity",ObtainCallRegistry:"ObtainCallRegistry",GetEcsConfig:"GetEcsConfig",CallRegistryInitializeStart:"CallRegistryInitializeStart",AccountConfigurationHomeCloudSet:"AccountConfigurationHomeCloudSet",SetupKeyGetSetup:"SetupKeyGetSetup",SetupKeySetTenantId:"SetupKeySetTenantId",SetupKeySetCallingConfigs:"SetupKeySetCallingConfigs",SetupKeySetCallingConfigsFail:"SetupKeySetCallingConfigsFail",SetupKeyInitStart:"SetupKeyInitStart",SetupKeyInitPromiseResolved:"SetupKeyInitPromiseResolved",CallRegistryInitializePromiseResolved:"CallRegistryInitializePromiseResolved",SetSlimCoreAriaCollectorDone:"SetSlimCoreAriaCollectorDone",CallRegistryInitStart:"CallRegistryInitStart",InitSlimCoreTrouter:"InitSlimCoreTrouter",GetUserInformation:"getUserInformation",GetSkypeId:"getSkypeId",CallCreated:"callCreated",InitCall:"InitCall",InitCallCompleted:"initCallCompleted",OutgoingCallInitCall:"init_call",CallConversationFetchedCallingServiceInit:"call_conversation_fetched_callingService_init",VideoAvailable:"VideoAvailable",InitCallGetConversation:"InitCallGetConversation",InitCallDetails:"InitCallDetails",InitCallInitialization:"InitCallInitialization",UpdatedCallStartOptions:"updatedCallStartOptions",InitCallStarted:"InitCallStarted",CallConversationFetchedStartCall:"call_conversation_fetched_startCall",OutgoingCallCallCreated:"call_created",CallConversationFetchedPrepareCall:"call_conversation_fetched_prepareCall",HandleOngoingCallOnMultiCallsAllowed:"HandleOngoingCallOnMultiCallsAllowed",HandleOngoingCallStart:"HandleOngoingCallStart",ActiveCallFound:"ActiveCallFound",NoActiveCallFound:"NoActiveCallFound",HandleOngoingCallNoActiveCalls:"HandleOngoingCallNoActiveCalls",CallSetupCreateCall:"CreateCall",PostCallSetup:"PostCallSetup",MessageIdSet:"MessageIdSet",CorrectedParticipandId:"CorrectedParticipandId",CorrectedMeetingCloud:"correctedMeetingCloud",StartSharingContent:"startSharingContent",CSSCallMatchTargetCall:"CSSCallMatchTargetCall",JoinOngoingCallSucceeded:"joinOngoingCall_succeeded",JoinOngoingCallFailed:"joinOngoingCall_failed",NavigateToUserMediaModal:"navigate_toUser_media_modal",TransitionDelayed:"transition delayed",TransitionSuperseded:"transition superseded",Notified:"Notified",PopulateEmergencyCall:"populateEmergencyCall",CheckedPermissionsGiven:"checkedPermissionsGiven",AskDevicePermissionFailed:"askDevicePermission_failed",AskDevicePermission:"askDevicePermission",PollForPermissions:"pollForPermissions",StartPolling:"startPolling",StopPolling:"stopPolling",ContinueWithDeficiency:"continueWithDeficiency",CallHoldStateInitiatedEnd:"call-hold-state-initiated-end",SetCallHoldStateInitiatedStart:"set-call-hold-state-initiated-start",UndefinedCalledNotifiedTime:"undefinedCalledNotifiedTime",IsCallRejectWithinThresholdTime:"isCallRejectWithinThresholdTime",SuccessfullyResolvedAWorkspace:"Successfully resolved a workspace",CheckingIntoReservation:"Checking into reservation",SendingNotification:"Sending notification",ConversationInitialized:"conversationInitialized",MeetingDetailsReceived:"meetingDetailsReceived",PrivateConversationMeetingInfoReceived:"privateConversationMeetingInfoReceived",EventReceivedUsingEventProvider:"eventReceivedUsingEventProvider",Initialization:"Initialization",InitializationStarted:"InitializationStarted",InitializationCompleted:"InitializationCompleted",AddBot:"AddBot",BotAddedScenarioMarkerStep:"BotAdded",BotAddFailed:"BotAddFailed",BotRemoved:"BotRemoved",BotPresent:"BotPresent",MultipleBotsPresent:"MultipleBotsPresent",WaitingForBotReady:"WaitingForBotReady",BotStatusUpdate:"BotStatusUpdate",BotCaptionsUpdate:"BotCaptionsUpdate",CaptionsStateUpdate:"CaptionsStateUpdate",SetAudioMode:"SetAudioMode",UnsetAudioMode:"UnsetAudioMode",AuthTokenFetched:"AuthTokenFetched",BotPayloadCreated:"BotPayloadCreated",ParticipantAdded:"ParticipantAdded",BotCommandSentScenarioMarkerStep:"BotCommandSent",BotStatusChange:"BotStatusChange",BotEventUpdate:"BotEventUpdate",BotTranscriptEventUpdate:"BotTranscriptEventUpdate",BotCoachEventUpdate:"BotCoachEventUpdate",CoachStateTransition:"CoachStateTransition",SendingBotCommand:"SendingBotCommand",MeetingTitleFetched:"MeetingTitleFetched",SendingClientMetadata:"SendingClientMetadata",ClientMetadataMessageCreated:"ClientMetadataMessageCreated",ClientMetadataSent:"ClientMetadataSent",StartCoachByUser:"StartCoachByUser",TranscriptStateTransition:"TranscriptStateTransition",TranscriptEditIdChange:"TranscriptEditIdChange",TranscriptInRoomAttributionIssuesChange:"TranscriptInRoomAttributionIssuesChange",SendingBotEditCommand:"SendingBotEditCommand",GetTranscript:"GetTranscript",EditTranscript:"EditTranscript",GetTranscriptAcl:"GetTranscriptAcl",ChangeRoleForParticipantNotInRosterRequestSent:"changeRoleForParticipantNotInRoster request_sent",ChangeRoleForParticipantNotInRosterRequestFailed:"changeRoleForParticipantNotInRoster request_failed",SendingRoomAttributionSettingUpdateCommand:"SendingRoomAttributionSettingUpdateCommand",RequestRemotePtzCameraControlSuccessfulFromMixin:"requestRemotePtzCameraControl successful from mixin",TerminateRemotePtzSessionSuccessfulFromMixin:"terminateRemotePtzSession successful from mixin",InitStarted:"init started",StartedSubscribingToCallEvents:"started subscribing to call events",StartedLoadingParticipants:"started loading participants",StartedSubscribeToPtzHandlerEvents:"started subscribe to ptz handler events",StartedSubscribeToParticipantChanges:"started subscribe to participant changes",ParticipantIsPtzCapable:"participant is ptz capable",ParticipantIsRemovedFromThePtzMasterList:"participant is removed from the ptz master list",ParticipantIsUpdatedAndIsRemovedFromThePtzMasterList:"participant is updated and is removed from the ptz master list",ParticipantIsUpdatedAndAddedToTheMasterList:"participant is updated and added to the master list",CallDisposing:"call disposing",ScdToggledOn:"scd: toggled on",ScdToggledOff:"scd: toggled off",BeforeCallNavigateToRigelConsoleState:"before_call_navigateToRigelConsoleState",CallStarted:"call-started",NavigatingToRigelConsoleWithCall:"Navigating to rigel console with call",PublicPreviewDialogInactiveTimeout:"publicPreviewDialogInactiveTimeout",PublicPreviewDialogClosed:"publicPreviewDialogClosed",OpenPublicPreviewDialog:"openPublicPreviewDialog",RigelServiceHandlerInitHandler:"RigelServiceHandler_initHandler",RigelServiceHandlerInitialSettingsLoaded:"RigelServiceHandler_initialSettingsLoaded",StartingInstantMeeting:"startingInstantMeeting",StartInstantMeetingFailed:"startInstantMeetingFailed",InstantMeetingLinkCreated:"instantMeetingLinkCreated",InviteMessageSent:"inviteMessageSent",ConnectedStep:"Connected",ConnectingStep:"Connecting",DisconnectedStep:"Disconnected",SwitchingStep:"Switching",RingingStep:"Ringing",UnknownStep:"Unknown",NoneStep:"None",ResendRegistrationEventInvoked:"resendRegistrationEventInvoked",ClaimMissing:"claimMissing",ClaimChallengeFound:"claimChallengeFound",TokenRefreshSuccessful:"tokenRefreshSuccessful",TokenRefreshFailed:"tokenRefreshFailed",KeepAliveSuccess:"keep alive success",KeepAliveFailed:"keep alive failed",LicenseDisabledKeepAliveFailed:"license disabled. Keep alive failed",EndCallingIntentResolver:"endCallingIntent_resolver",EndIntentSucceess:"endIntent_succeess",EndIntentFailure:"endIntent_failure",UpdateHigherFrameRateConfigFinished:"update_higher_framerate_config_finished",UpdateHigherFrameRateConfigFailed:"update_higher_framerate_config_failed",RequestRemotePtzCameraControlResolver:"requestRemotePtzCameraControl_resolver",SendRemotePtzCustomCommandResolver:"sendRemotePtzCustomCommand_resolver",TerminateRemotePtzSessionResolver:"terminateRemotePtzSession_resolver",PtzCapableParticipantsResolver:"ptzCapableParticipants_resolver",GetUserPremiumOrCopilotLicenseStart:"get-user-premium-or-copilot-license-start",GetUserPremiumOrCopilotLicenseSuccess:"get-user-premium-or-copilot-license-success",GetUserPremiumOrCopilotLicenseFailure:"get-user-premium-or-copilot-license-failure",RosterGroupingServiceInitialized:"Service Initialized, registering events",RosterGroupingSlimcoreJoinEvent:"Received slimcore join event",RosterGroupingUserAlreadyInGroup:"User already part of an existing group. Changing Group",PolicyDisabled:"Policy is disabled for this user/tenant.",CachedNonGuestUserCount:"Count of cached non-guest users from auth service",DisableGuestUserHidDialout:"Do not allow dial out from hid device from a guest account",DisableMtmaHidDialout:"Do not allow dial out from hid device if multiple acccounts detected",DisableNonRendererAccountHidDialout:"Do not allow dial out from hid device if account does not match main renderer account",HidDialoutUserRole:"Role of user attempting to dial out from hid device",TranscriptStartCommandRetrySending:"transcription_start_command_retry_sending",TranscriptStopCommandRetrySending:"transcription_stop_command_retry_sending",ClosedCaptionsSetLanguageComandRetrySending:"closed_captions_set_language_command_retry_sending",MeetingJoinWithCaptchaEnabled:"join_with_captcha_enabled",CPFBotSetup:"cpf_bot_setup",CPFBotAdded:"cpf_bot_added",CPFBotFailure:"cpf_bot_failure",CPFStartFailure:"cpf_start_failure",CPFStopFailure:"cpf_stop_failure",PopOutClosedCaptions:"closed_captions_pop_out",CloseClosedCaptionsPanel:"closed_captions_close_panel",OpenClosedCaptionsPanel:"closed_captions_open_panel",CloseClosedCaptionsWindow:"closed_captions_close_window",OpenClosedCaptionsWindow:"closed_captions_open_window",ClosedCaptionsUpdateFlyOutStatusTrue:"closed_captions_update_status_true",ClosedCaptionsUpdateFlyOutStatusFalse:"closed_captions_update_status_false",ClosedCaptionsCallNotConected:"closed_captions_call_not_connected",URLShimLoading:"url_shim_loading",PNSModeEnabledOnPassiveEnrollmentConsentUpdate:"pns_mode_enabled_on_passive_enrollment_consent_update",BroadcastTrackingSignalrconnection_Disconnected:"disconnected",DownloadImageFromAMSFailure:"download_image_from_ams_failure",ReuploadImageToAMSFailure:"reupload_image_to_ams_failure",EndMeetup_Disconnecting:"disconnecting",SetReadyToHandleSlimoreEvent:"set_ready_to_handle_slimcore_event",JobCompleted:"jobCompleted",GsStartVdiBridgeLoad:"gs_start_vdibridge_load",GsVdiBridgeLoaded:"gs_vdibridge_loaded",GlobalVdiBridgeLoaded:"global_vdibridge_loaded",StartLoadingCallingCdl:"start_load_calling_cdl",CallingStackDisposeSlimCoreInstance:"calling_stack_dispose_slimcore_instance",CallingStackDisposeSlimCoreInstanceMissing:"calling_stack_dispose_slimcore_instance_missing",CallingStackDisposeSlimCoreInstanceSkipped:"calling_stack_dispose_slimcore_instance_skipped",CallingStackDisposeSlimCoreInstanceFailed:"calling_stack_dispose_slimcore_instance_failed",CallingStackDisposeCompanionSlimCoreInstance:"calling_stack_dispose_companion_slimcore_instance",CallingStackDisposeCompanionSlimCoreInstanceExists:"calling_stack_dispose_companion_slimcore_instance_exists",CallingStackDisposeCompanionSlimCoreInstanceInProc:"calling_stack_dispose_companion_slimcore_instance_in_proc",GetModuleLoader:"get_moduleloader",RosterParticipantsNGCSearch:"roster_participants_ngc_search",EnsuredNotInInteractionRequireState:"ensured_not_in_interaction_required_state",CallingAppOnCommandResult:"on_command_result_calling_app",LoadCallingLPCDone:"load_calling_LPC_done",StreamVideoPlaybackSetSource:"setsource",StreamVideoPlaybackCanPlayThrough:"canplaythrough",StreamVideoStartInitializeConnection:"initializeConnection",StreamVideoStartSignInSuccessful:"signinsuccessful",StreamVideoStartSignInIncomplete:"signinincomplete",MessagesReduced:"MessagesReduced",ExtAppForBotCardChatQuery:"ext_app_definitions_for_bot_card_chat_query",ExtAppForBotCardAppQuery:"ext_app_definitions_for_bot_card_app_query",ConversationFetchJobInit:"init",ReplyChainSyncJobInvalidTeam:"replychain_sync_job_invalid_team",DeeplinkMessageGreaterThanEOSWButNotFoundFromStore:"deeplinkMessage_greater_than_EOSW_but_not_found_from_store",DeeplinkMessageNotFoundFromStore:"deeplinkMessage_not_found_from_store",ConversationFetchWorkflowInit:"init",ConversationFetchWorkflowValidated:"validated",ConversationFetchWorkflowJobComplete:"job_complete",ConversationFetchWorkflowProcessedResults:"processed_results",ConversationFetchResiliencyFlowInit:"resiliency_init",ConversationFetchTempjoinInit:"tempjoin_started",ConversationFetchTempjoinComplete:"tempjoin_complete",ConversationFetchRetryResultsProcessed:"retry_results_processed",ConversationFetchResiliencyFlowComplete:"resiliency_complete",MarkAllAsReadWorkflowUpdatedCH:"updated_app_ch",MarkAllAsReadWorkflowMAARChatService:"maar_cs_complete",ConversationManagerUpdateBatchableDebounceRuleMatch:"debounce_rule_match",ConversationManagerUpdateBatchableDebounceBatch:"debounce_rule_batch",ConversationManagerUpdateBatchablePreemptiveDebounce:"preemptive_debounce",TPSGetPushUpdatesMakingRequest:"making_request",TPSReceivedSyncResponse:"received_sync_response",TPSResyncedEntities:"resynced_entities",WorkerInitialize:"workerInitialize",ConversationFolderManagerStartup:"cfm_startup",MembersRosterVersionMismatch:"thread_members_workflow_mismatch",PrivateStreamPruningPruneReplyChains:"streams_manager_pruning_job_prune_reply_chains",PrivateStreamPruningPruneAuxiliaryData:"streams_manager_pruning_job_prune_aux_data",PrivateStreamPruningUpdateSyncState:"streams_manager_pruning_job_update_sync_state",PrivateStreamPruningReplyChainsCompliance:"streams_manager_pruning_reply_chain_compliance",ChannelInfoPaneAllSystemMessageLoading:"channel_info_pane_all_system_messages_loading",GetChannelSharedFilesFromCache:"get_channel_system_messages_from_cache",GetChannelSharedFilesFromCDL:"get_channel_shared_files_from_cdl",GetChannelSharedFilesFromCDLCompleted:"get_channel_shared_files_from_cdl_completed",GetChannelSystemMessagesFromCSA:"get_channel_system_messages_from_csa",GetChannelSystemMessagesFromCSACompleted:"get_channel_system_messages_from_csa_completed",GetChannelPinnedPostsFromCSA:"get_channel_pinned_posts_from_csa",GetChannelPinnedPostsFromCSACompleted:"get_channel_pinned_posts_from_csa_completed",FetchChannelMembersFromCS:"fetch_channel_members_from_cs",FetchChannelMembersFromCSCompleted:"fetch_channel_members_from_cs_completed",ChannelHeaderRenderComplete:"render_channel_header_complete",ChannelHeaderRenderFail:"render_channel_header_fail",ChannelHeaderTitleRendering:"rendering_channel_header_title",ChannelRightPaneHeaderQueryLoaded:"channel_header_query_loaded",ChannelRightPaneHeaderQueryFailed:"channel_header_query_failed",ChannelRightPaneHeaderRenderComplete:"render_channel_header_complete",ChannelRightPaneHeaderRenderFail:"render_channel_header_fail",RenderChannelRightPaneHeaderAbandoned:"render_channel_header_abandoned",ChannelRightPaneHeaderTitleRendering:"rendering_channel_header_title",ChannelListRenderComplete:"render_channel_list_complete",ChannelListRenderFail:"render_channel_list_fail",ChannelListPinnedChannelsUpdate:"channel_list_pinned_channel_update",PinnedPostsCdlFetch:"pinned_post_cdl_fetch",PinnedPostsProcessMessages:"pinned_post_process_messages",PinnedPostsBuildResponse:"pinned_post_build_response",FetchAvailableAppsQueryComplete:"available_apps_fetch_query_complete",ChatInfoPaneChatQueryComplete:"chat_infopane_chat_query_complete",ChatInfoPanePeopleSectionRendered:"chat_infopane_people_section_rendered",ChatInfoPaneFilesSectionRendered:"chat_infopane_files_section_rendered",ChatInfoPanePinnedMessagesSectionRendered:"chat_infopane_pinned_messages_section_rendered",ChatInfoPaneSharedSectionRendered:"chat_infopane_shared_section_rendered",ChatInfoPaneOptionsSectionRendered:"chat_infopane_options_section_rendered",LoadPeer5NPMPackage:"load_peer5_npm_package",LoadPeer5NPMPackageDone:"load_peer5_npm_package_done",RTCPeerConnectionCreated:"rtc_peer_connection_created",CreateNPMPackageSilentTester:"create_npm_package_silent_tester",CreateNPMPackageSilentTesterDone:"create_npm_package_silent_tester_done",ProbeDevicesSetUpAlreadyExisting:"probe_devices_setup_already_existing",DisposeSyntheticTestsServiceDone:"dispose_global_synthetic_tests_service_done",DisposeSyntheticTestsServiceSystemStateUpdate:"dispose_global_synthetic_tests_service_system_state_update",DeleteTranscriptionChickletSucceeded:"delet_transcription_chicklet_succeeded",DeleteTranscriptionChickletFailed:"delet_transcription_chicklet_failed",CommunitiesEditNicknameService:"communitis_edit_nickname_service",CommunitiesEditNicknameGetCache:"communitis_edit_nickname_get_cache",StartBringGeneralChannelToTop:"start_bring_general_channel_top",EndBringGeneralChannelToTop:"end_bring_general_channel_top",CommunityMemberRoleUpdateNotFoundUIState:"community_member_role_update_not_found_ui_state",CommunityWelcomebotConfigStarted:"community_welcome_bot_config_started",CommunityWelcomebotConfigSuceeded:"community_welcome_bot_config_successful",CommunityWelcomebotConfigFailed:"community_welcome_bot_config_Failed",UpdateCommunityWelcomebotConfigStarted:"update_community_welcome_bot_config_started",UpdateCommunityWelcomebotConfigSuceeded:"update_community_welcome_bot_config_successful",UpdateCommunityWelcomebotConfigFailedEmptyConfigs:"update_community_welcome_bot_config_failed_empty_configs",UpdateCommunityWelcomebotConfigFailed:"update_community_welcome_bot_config_failed",FetchCommunitiesMembersForThread:"communities_fetch_members_thread",FetchCommunitiesdMembersByRoleComplete:"fetch_communities_members_by_role_complete",ExtractCommunityIdFronJoinLink:"extract_community_id_from_join_link",ComposeInlineImageAMSLoading:"compose_inline_image_ams_loading",MetaOSAppInstalled:"metaos_app_installed",HideMetaOSBizChat:"hide_meta_os_bizchat",CheckCopilotLicense:"check_license",FetchingData:"Fetching_data",RenderGCPBotMessage:"render_gcp_bot_message",PermissionGranted:"microphone_permission_granted",PermissionDenied:"microphone_permission_denied",DiscoverSurfaceFeedsFetchedFromPPS:"discover_surface_feeds_fetched_from_pps",DiscoverScrollFeedsFetchedfromScrollCache:"discover_scroll_feeds_fetched_from_fcroll_cache",DiscoverScrollFeedsFetchedfromStore:"discover_surface_feeds_fetched_from_store",DiscoverScrollFeedsFetchedfromNetwork:"discover_surface_feeds_fetched_from_network",DiscoverSurfaceLoadMoreInitiated:"discover_surface_feeds_load_more_initiated",DiscoverSurfaceLoadMoreComplete:"discover_surface_feeds_load_more_complete",GetConversationsStep:"teams_grid_load_query_get_conversations",GetUserPreferencesStep:"teams_grid_load_query_get_preferences",ResolverStartedRetrySendCsaRequest:"resolver_started_csa_request",ResolverCompletedRetrySendCsaRequest:"resolver_completed_csa_request",SignalRConnectionEstablised:"signal_r_connection_established",HistoricDataManagerFetchLeftNav:"historic_data_manager_fetch_leftnav",HistoricGetLeftNavDataStart:"historic_data_manager_fetch_leftnav_start",HistoricLeftNavDataFetchComplete:"historic_data_manager_fetch_leftnav_complete",HistoricLeftNavDataFetchError:"historic_data_manager_fetch_leftnav_error",HistoricNavigationFetchAgents:"fetch_agents",HistoricNavigationFetchAutoAttendants:"fetch_auto_attendants",HistoricNavigationFetchCallQueues:"fetch_call_queues",HistoricDataManagerFetchCenterPane:"historic_data_manager_fetch_centerpane",HistoricDataFetchAgents:"fetch_agent",HistoricDataFetchAutoAttendants:"fetch_auto_attendants",HistoricDataFetchCallQueues:"fetch_call_queues",HistoricDataFetchFromServiceStart:"historic_data_manager_fetch_from_service_start",HistoricDataFetchFromServiceComplete:"historic_data_manager_fetch_from_service_complete",HistoricDataSyncInIndexDBStart:"historic_data_sync_in_indexdb_start",HistoricSyncOldDataRemovedFromIndexDB:"historic_sync_old_data_removed_from_indexdb",HistoricDataSyncInIndexDBComplete:"historic_data_sync_in_indexdb_complete",HistoricSyncDataFailedByCDL:"historic_sync_data_failed_by_cdl",BrowserToastRequested:"BrowserToastRequested",BrowserToastActivated:"BrowserToastActivated",CommandResolutionStarted:"CommandResolutionStarted",RecreatingNotificationsWindow:"RecreatingNotificationsWindow",NotificationsWindowFound:"NotificationsWindowFound",NotificationsResolutionStarted:"NotificationsResolutionStarted",InAppNotificationsStarted:"InAppNotificationsStarted",FailedToUpdateWindowsCache:"FailedToUpdateWindowsCache",CommandResolved:"CommandResolved",ToastShown:"ToastShown",ToastRenderCancelled:"ToastRenderCancelled",ToastCommandAbandoned:"ToastCommandAbandoned",RootNotificationRenderBegin:"RootNotificationRenderBegin",NotificationItemRenderBegin:"NotificationItemRenderBegin",NotificationRenderUpdate:"NotificationRenderUpdate",SetSinkIdSuccess:"SetSinkIdSuccess",SetSinkIdFailed:"SetSinkIdFailed",PlayingDefaultDevice:"PlayingDefaultDevice",ErrorGettingDefaultDeviceSinkId:"ErrorGettingDefaultDeviceSinkId",UnknownToastTypeDetected:"UnknownToastTypeDetected",RingtonePlayed:"RingtonePlayed",ErroredPlayingLocalAudio:"ErroredPlayingLocalAudio",RingtoneSilenced:"RingtoneSilenced",RingtoneErrored:"RingtoneErrored",RingtonePausedLocally:"RingtonePausedLocally",AudioObjectCleanedUp:"AudioObjectCleanedUp",RingtoneDeviceEnumerationFailed:"RingtoneDeviceEnumerationFailed",SecondaryRingtonePlayed:"SecondaryRingtonePlayed",SecondaryRingtoneSilenced:"SecondaryRingtoneSilenced",ErroredPlayingSecondaryLocalAudio:"ErroredPlayingSecondaryLocalAudio",SecondaryRingtoneErrored:"SecondaryRingtoneErrored",SecondaryRingtonePausedLocally:"SecondaryRingtonePausedLocally",SecondaryDeviceSetSinkIdSuccess:"SecondaryDEviceSetSinkIdSuccess",SecondaryDeviceSetSinkIdFailed:"SecondaryDeviceSetSinkIdFailed",PlayingDefaultSecondaryDevice:"PlayingDefaultSecondaryDevice",SecondaryAudioObjectCleanedUp:"SecondaryAudioObjectCleanedUp",StateTransitionOverriden:"StateTransitionOverriden",StateTransitionNotOverriden:"StateTransitionNotOverriden",CallingNotificationRenderComplete:"CallingNotificationRenderComplete",MsnMeetingNotificationRenderComplete:"MsnMeetingNotificationRenderComplete",MeetingNudgeNotificationRenderComplete:"MeetingNudgeNotificationRenderComplete",NormalNotificationRenderComplete:"NormalNotificationRenderComplete",AcceptIncomingCallContentOnly:"AcceptIncomingCallContentOnly",AcceptIncomingCallWithAudio:"AcceptIncomingCallWithAudio",AcceptIncomingCallWithVideo:"AcceptIncomingCallWithVideo",AcceptIncomingCallThroughPrejoin:"AcceptIncomingCallThroughPrejoin",AcceptIncomingScreenshareOnlyCall:"AcceptIncomingScreenshareOnlyCall",IgnoreIncomingCall:"IgnoreIncomingCall",RejectIncomingCall:"RejectIncomingCall",ReplyIncomingCall:"ReplyIncomingCall",NavigateToCallTab:"NavigateToCallTab",ResumeCallTransfer:"ResumeCallTransfer",AcceptWithVideoClicked:"AcceptWithVideoClicked",AcceptClicked:"AcceptClicked",DeclinedClicked:"DeclinedClicked",NoAudioElementFound:"NoAudioElementFound",NoAudioElementFoundSecRinger:"NoAudioElementFoundSecRinger",CallWindowClosureBeforeUnload:"beforeunload",CallWindowClosureSetClosePrompt:"setClosePrompt",CallingDeeplinkDialogRendered:"show_dialog",DeeplinkDialogCallStarted:"start_call",HandleOngoingCall:"handle_ongoing_calls",EndMonitoringTenantIdNotFound:"end_monitoring_not_triggered_no_tenantId_found",UseUpdatedGetVoicemailsPath:"useUpdatedGetVoicemailsPath",GetVoicemails:"getVoicemails",GetSharedVoicemails:"getSharedVoicemails",QueryAgentOptStatus:"QueryAgentOptStatus",QueryCallQueueDetails:"QueryCallQueueDetails",CallQueueReregistration:"CallQueueReregistration",InitSignalRConnectionOptIn:"InitSignalRConnection",ShowTransferOptions:"ShowTransferOptions",ClearCachedSession:"ClearCachedSession",ClearCacheAndNetworkSession:"ClearCacheAndNetworkSession",HandleForceTakeover:"HandleForceTakeover",HandleSessionUpdate:"HandleSessionUpdate",DeviceTransferToOtherDevice:"DeviceTransferToOtherDevice",DeviceTransferEndMonitoringFailed:"DeviceTransferEndMonitoringFailed",HandleSessionStart:"HandleSessionStart",HandleSessionEnd:"HandleSessionEnd",ForceTakeoverEndCurrentDeviceMonitoring:"ForceTakeoverEndCurrentDeviceMonitoring",ForceTakeoverEndCurrentDeviceMonitoringFailed:"ForceTakeoverEndCurrentDeviceMonitoringFailed",ForceTakeoverClearSession:"ForceTakeoverClearSession",ExtensibilityAppPickerFetchConversation:"extensibility_app_picker_fetch_thread_conversation",ExtensibilityAppPickerFetchTeam:"extensibility_app_picker_fetch_thread_team",ExtensibilityAppPickerFetchCMSCollection:"extensibility_app_picker_fetch_cms_collection",ExtMeetingAppsFlyoutFilterApps:"ext_meeting_apps_filter_apps",ExtMeetingAppsFlyoutTransformApps:"ext_meeting_apps_transform_apps",ExtMeetingAppsFlyoutSortApps:"ext_meeting_apps_sort_apps",ExtBotMessageActionOdslInvokeActivitySent:"ext_bot_message_action_invoke_activity_sent",ExtBotCitationReferenceMessageError:"ext_bot_citation_reference_message_Error",ExtCECBotSsoTokenInvokeSuccess:"ext_cec_bot_sso_token_invoke_success",ExtCECBotSsoTokenInvokeFailure:"ext_cec_bot_sso_token_invoke_failure",ExtCECBotOAuthCodeInvokeSuccess:"ext_cec_oauth_code_invoke_success",ExtCECBotOAuthCodeInvokeFailure:"ext_cec_oauth_code_invoke_failure",ExtExternalAppCECAuthReplaySuccess:"ext_external_app_cec_auth_replay_success",ExtExternalAppCECAuthReplayFailure:"ext_external_app_cec_auth_replay_failure",ExtExternalAppCECCardActionOpenUrlSuccess:"ext_external_app_cec_card_action_open_url_success",ExtExternalAppCECCardActionOpenUrlFailure:"ext_external_app_cec_card_action_open_url_failure",ExtExternalAppCECCardActionSubmitSuccess:"ext_external_app_cec_card_action_submit_success",ExtExternalAppCECCardActionSubmitFailure:"ext_external_app_cec_card_action_submit_failure",ExtExternalAppDACardActionOpenUrlDialogSuccess:"ext_external_app_da_card_action_open_url_dialog_success",ExtExternalAppDACardActionOpenUrlDialogFailure:"ext_external_app_da_card_action_open_url_dialog_failure",ExtPowerbarMessageExtensionAppNotFound:"ext_powerbar_message_extension_App_Not_found",ExtPowerbarMessageExtensionScopeResolutionFailed:"ext_powerbar_message_extension_scope_not_resolved",ExtPowerbarMessageExtensionTaskModuleOpenSucess:"ext_powerbar_message_extension_task_module_open_success",ExtDeeplinkToChatFeatureFlagDisabled:"ext_deeplink_to_chat_featureflag_disabled",ExtDeeplinkToChatMessageFeatureFlagDisabled:"ext_deeplink_to_chat_message_featureflag_disabled",M365DeeplinkToChatFeatureFlagDisabled:"m365_deeplink_to_chat_featureflag_disabled",ExtDeeplinkToTaskModuleFeatureFlagDisabled:"ext_deeplink_to_task_module_featureflag_disabled",ExtMECardFetchAppDefinition:"ext_me_card_fetch_app_definition",ExtMECardPolicyCheck:"ext_me_card_policy_check",ExtMECardGetInstalledApp:"ext_me_card_get_installed_app",ExtMECardInstallApp:"ext_me_card_install_app",ExtMECardExecuteAction:"ext_me_card_execute_action",ExtACMediaCreateEmbedLink:"ext_ac_media_create_embed_link",ExtACMediaLoadMediaFile:"ext_ac_media_load_media_file",PlatformFetchTabInfo:"platform_fetch_tab_information",CacheRetrievalFailed:"ext_bot_dynamic_suggested_actions_manager_cache_failed",PreConsentedAppInstallation:"preconsented_app_installation",InstallPreconsentedPowerAutomateApp:"preconsent_power_automate_app",GetInstalledAppDetail:"get_install_app_detail",ConnectorLoadingManagerDialogRenderer:"connector_loading_manage_dialog_renderer",ConnectorLoadedManagerDialogRenderer:"connector_loaded_manage_dialog_renderer",WorkflowsSearchEnabled:"workflows_search_query_results",WorkflowsDialogConfiguredWorkflowsSectionLoadFailed:"workflows_dialog_configured_workflows_section_loaded_failed",OAuthStart:"oauth_start",SSOStart:"sso_start",OpenAIPluginStart:"open_ai_plugin_start",AppNotFoundInPersonal:"ext_task_module_card_action_invoke_app_not_found_in_personal",AppNotInstalledInPersonal:"ext_task_module_card_action_invoke_app_not_installed_in_personal",AppNotFoundInChat:"ext_task_module_card_action_invoke_app_not_found_in_chat",AppNotInstalledInChat:"ext_task_module_card_action_invoke_app_not_installed_in_chat",AppNotFoundInChannel:"ext_task_module_card_action_invoke_app_not_found_in_channel",AppNotInstalledInChannel:"ext_task_module_card_action_invoke_app_not_installed_in_channel",AppSilentInstall:"ext_task_module_card_action_invoke_app_silent_install",AppInstallDialog:"ext_task_module_card_action_invoke_app_install_dialog",AppDefinitionNotFound:"ext_task_module_card_action_invoke_app_def_not_found",ScreenshotSelectorGraphQLQuery:"screenshot_selector_graphql_query",FeedbackFormInitializationWarning:"feedback_form_initialization_warn",FetchContentViaAPI:"fetch_content_via_api",FetchExternalChicletFileDomainStart:"fetch_external_chiclet_file_domain_starts",ChatInfoPaneGetP2PFilesCacheHit:"chat_info_pane_get_p2p_files_cache_hit",ChatInfoPaneGetP2PFilesL1CallComplete:"chat_info_pane_get_p2p_files_l1_call_complete",ChatInfoPaneGetP2PFilesL2CallComplete:"chat_info_pane_get_p2p_files_l2_call_complete",ChatInfoPaneGetP2PFilesL1CallFail:"chat_info_pane_get_p2p_files_l1_call_fail",ChatInfoPaneGetP2PFilesL2CallFail:"chat_info_pane_get_p2p_files_l2_call_fail",SubstrateSharedAPI:"substrate_shared_api",FailedToFetchNetworkDataForFilesFastAPI:"failed_to_fetch_network_data_for_files_fast_api",FailedToFetchNetworkDataForFilesCompleteDataAPI:"failed_to_fetch_network_data_for_files_complete_data_api",FailedToFetchNetworkDataForLinksFastAPI:"failed_to_fetch_network_data_for_links_fast_api",FailedToFetchNetworkDataForLinksCompleteDataAPI:"failed_to_fetch_network_data_for_links_complete_data_api",FailedToFetchNetworkDataForFastAPI:"failed_to_fetch_network_data_for_fast_api",FileShareInfoRedeemGetUpdatedSiteUrlStart:"file_share_info_get_updated_site_url_start",FileShareInfoRedeemGetUpdatedSiteUrlEnd:"file_share_info_get_updated_site_url_end",FileShareInfoRedeemByIdGetUpdatedSiteUrlStart:"file_share_info_get_updated_site_url_start_redeem_file_by_id",FileShareInfoRedeemByIdGetUpdatedSiteUrlEnd:"file_share_info_get_updated_site_url_end_redeem_file_by_id",FileShareInfoRedeemByIdRetryWithUpdatedSiteUrlStart:"file_share_info_redeem_retry_with_updated_site_url_start_redeem_file_by_id",FileShareInfoRedeemByIdRetryWithUpdatedSiteUrlEnd:"file_share_info_redeem_retry_with_updated_site_url_end_redeem_file_by_id",FetchingUserDetailsStarted:"fetching_users_details_started",FetchingFederatedUser:"fetching_federated_users",FetchingTflConsumerUser:"fetching_tfl_consumer_users",FetchingUserDetailsCompleted:"fetching_users_details_completed",FileDownloadWithoutTempAuthStart:"file_download_without_tempauth_start",FileDownloadGetAuthTokenSuccess:"file_download_getauth_token_for_download_success",FileSummaryStart:"summarise_file_copilot_start",FileSummaryFileRedeem:"summarise_file_copilot_fetch_file_redeem_info",FileSummaryInitialisePCP:"summarise_file_copilot_pcp_open",P2PSharedListContainerStart:"p2p_shared_list_container_start",P2PSharedListRendererError:"p2p_shared_list_renderer_error",P2PSharedListRendererEmptyList:"p2p_shared_list_renderer_empty_list",P2PSharedListWorkingSetRendererEmptyList:"p2p_shared_list_working_set_renderer_empty_list",P2PSharedListRendererSharedList:"p2p_shared_list_renderer_shared_list",P2PSharedListFastDataRendererSharedList:"p2p_shared_list_fast_data_renderer_shared_list",P2PSharedListFastDataRenderFirstPageSharedList:"p2p_shared_list_fast_data_render_first_page_shared_list",GetCloudStorageFoldersApiCallForClassMaterialFolderAdmin:"get_cloud_storage_folders_api_class_material_folder_admin",GetCloudServiceCallStart:"get_cloud_storage_folders_api_service_call_start",GetCloudServiceMTCallStart:"get_cloud_storage_folders_api_service_mt_call_start",GetCloudServiceMTCallSuccess:"get_cloud_storage_folders_api_service_mt_call_success",GetCloudServiceMTCallFailed:"get_cloud_storage_folders_api_service_mt_call_failed",ServiceCallCompltedForNormalUser:"get_cloud_storage_folders_api_service_call_completed_for_normal_user",ProvisionSpecialLibrariesStart:"get_cloud_storage_folders_api_provision_special_libraries_start",ProvisionSpecialLibrariesSuccess:"get_cloud_storage_folders_api_provision_special_libraries_success",ServiceCallCompletedForEDU:"get_cloud_storage_folders_api_service_call_completed_for_edu",DeleteCloudServiceCallStart:"delete_cloud_storage_folders_api_service_call_start",AddExternalFolderStart:"add_cloud_storage_add_external_folder_start",FetchSiteInfoStart:"add_cloud_storage_fetch_site_info_start",FetchRelevantSitesStart:"add_cloud_storage_fetch_relevant_sites_start",FetchRelevantFoldersStart:"add_cloud_storage_fetch_relevant_folders_start",DiagnoseCloudStorageLibraryStart:"add_cloud_storage_diagnose_cloud_storage_library_start",RepairCloudStorageLibraryStart:"add_cloud_storage_repair_cloud_storage_library_start",FileOneUpViewerRedeemCallStart:"file_oneup_viewer_redeem_call_start",FileOneUpViewerGetUpdatedSiteUrlStart:"file_oneup_viewer_get_updated_site_url_start",FileOneUpViewerGetUpdatedSiteUrlEnd:"file_oneup_viewer_get_updated_site_url_end",FileOneUpViewerRedeemCallWithUpdatedSiteUrlStart:"file_oneup_viewer_redeem_call_with_updated_site_url_start",FileOneUpViewerRedeemCallWithUpdatedSiteUrlEnd:"file_oneup_viewer_redeem_call_with_updated_site_url_end",FileOneUpViewerRedeemCallEnd:"file_oneup_viewer_redeem_call_end",FileOneUpViewerEmbedParamsConstructed:"file_oneup_viewer_embed_params_constructed",FilesThumbnailBlobContentInputFromDataStore:"files_thumbnail_blob_content_input_data_store",FilesThumbnailBlobContentInputFromNetwork:"files_thumbnail_blob_content_input_network",FilesThumbnailBlobContentFromDataStore:"files_thumbnail_blob_content_data_store",FilesThumbnailBlobContentFromNetwork:"files_thumbnail_blob_content_network",FilesThumbnailBlobContentFromManager:"files_thumbnail_blob_content_resolver_manager",FileInteractivePreviewIFrameLoaded:"file_interactive_preview_iframe_loaded",ThumbnailFetchViaAMSPreviewUrl:"thumbnail_fetch_via_ams_preview_url",FetchDriveAndItemID:"fetch_drive_and_item_id",GenerateCustomCopilotPreview:"generate_copilot_extension_preview",FloraFreDialogCloseSaveFloraFileOpenPreference:"flora_fre_dialog_render_fetch_flora_file_open_preference",FilesQuickShareDialogRenderFileLayout:"files_render_quick_share_dialog_render_file_layout",file_CopyLinkFromQuickShareEnd:"file_copy_link_from_quick_share_end",FluidThreadCreateInProgressUpdate:"fluid_thread_create_inprogress_update",BindingUserMediaWithFlyoutVideo:"binding-user-media-with-flyout-video",AttemptingToGetUserMedia:"attempting-to-get-user-media",ReceivedUserMediaOrNull:"received-user-media-or-null",GetConversationByIdToSendLink:"get-conv-by-userId-send-link",CreateMeetingLinkMutationDocument:"create-meeting-link-Mutation",CreateChatMutationDocument:"create-Chat-Mutation",SendNewMessage:"send-new-message",CreateMeetingObject:"create-meeting-object",WebcamNotEnabledAndSetLoadingVideoFalse:"webcam-not-enabled-and-set-loading-video-false",FlyoutLaunched:"flyout-launched",ShouldStartWebcamOnLaunch:"should-start-webcam-on-launch",FlyoutDismissed:"flyout-dismissed",ExpLoaderReadIndex:"read-index-html",ExpLoaderSlowReadIndex:"slow-read-index-html",PinnedChatsQueryFetchedPinnedChats:"pinned_chats_fetched_pinned_chats",PinnedChatsQueryAutoPinSelfChat:"pinned_chats_auto_pin_self_chat",PinnedChatsQueryCreateSelfChatConversationLie:"pinned_chats_create_self_chat_conversation_lie",PinnedChatsQueryGetConversationsOneToOneLieChat:"pinned_chats_get_conversations_one_to_one_lie_chat",PinnedChatsQueryi18nNamespaceLoaded:"pinned_chats_i18n_namespace_loaded",UploadMemoryTracingFile:"upload_memory_tracing_files",ThirdPartyContactsSyncSettingsCleanUp:"third_party_contacts_sync_settings_cleanUp",ImmersiveEventAvailabilityUIStateUpdateWithCacheDone:"immersive_event_availability_ui_state_update_with_cache_done",ImmersiveEventAvailabilityUIStateUpdateWithFetchDone:"immersive_event_availability_ui_state_update_with_fetch_done",ImmersiveEventAvailabilityAppIDReadDone:"immersive_event_availability_app_id_read_done",ImmersiveEventAvailabilityAppIDReadFailed:"immersive_event_availability_app_id_read_failed",ImmersiveEventAvailabilityCacheWriteDone:"immersive_event_availability_writing_to_cache",ImmersiveEventAvailabilityCacheWriteSkipped:"immersive_event_availability_skipping_cache_write",MeshAvailabilityCacheReadFailed:"mesh_availability_cache_Read_failed",MeshAvailabilityUIStateUpdateWithCacheDone:"mesh_availability_ui_state_update_with_cache_done",MeshAvailabilityUIStateUpdateWithFetchDone:"mesh_availability_ui_state_update_with_fetch_done",MeshAvailabilityAppIDReadDone:"mesh_availability_app_id_read_done",MeshAvailabilityAppIDReadFailed:"mesh_availability_app_id_read_failed",MeshAvailabilityCacheWriteDone:"mesh_availability_writing_to_cache",MeshAvailabilityCacheWriteSkipped:"mesh_availability_skipping_cache_write",ExtGroupOrTeamAppsFetched:"ext_group_team_apps_fetched",CallHangupLatency_StoppingCall:"stopping_call",CallHangupLatency_EndSlotHidden:"end_slot_hidden",CallHangupLatency_CallingScreeenDisconnecting:"disconnecting",CallHangupLatency_CallLeaveTriggered:"call_leave_triggered",CallHangupLatency_StageUnmounted:"stage_unmounted",CallHangupLatency_ClientStateLowered:"client_state_lowered",CallHangupLatency_CallRemovedFromRegistry:"call_removed_from_registry",CallHangupLatency_CallEventDisconnected:"call_event_disconnected",CallHangupLatency_CallingScreenReset:"calling_screen_reset",CallHangupLatency_EndScreenEvaluated:"end_screen_evaluated",CallHangupLatency_EndScreenCompleted:"end_screen_completed",CallHangupLatency_CallDisposed:"call_disposed",CallHangupLatency_CallingScreeenDisconnected:"disconnected",ExtAppsQueryInstalledAppsWithPreCheck:"ext_apps_fetch_installed_apps_with_pre_check",AppCacheMainJS:"appcache_main",AppCacheVendorJS:"appcache_vendor",ClickTimeAction:"click-time-action",DownloadMainJs:"main",DownloadVendorJs:"vendor",EncodedBodySizeMainJS:"encoded_body_size_main",EncodedBodySizeVendorJS:"encoded_body_size_vendor",STTDialogTriggered:"stt_dialog_triggered",STTOutlookAuthStrapOpen:"stt_outlook_auth_strap_open",STTOutlookAuthStrapRedirect:"stt_outlook_auth_strap_redirect",STTOutlookCallbackTokenComplete:"stt_outlook_callback_token_complete",STTOutlookMTCachedTokenComplete:"stt_outlook_mt_cached_token_complete",STTOutlookOpen:"stt_outlook_open",STTOutlookSSOComplete:"stt_outlook_sso_complete",RequestSentMT:"request_sent_mt",ResponseSuccessMT:"response_success_mt",InvalidConvId:"invalid_convId",NoHitInMainChatMessage:"no_hit_main_chat",MainChatMessageFound:"main_chat_found",OnBehalfOfUserResolveNameFromMessage:"onbehalfof_user_resolve_name_from_message",OnBehalfOfUserResolveNameFromUserQuery:"onbehalfof_user_resolve_name_from_user_query",MessageIdFetched:"messageId_retrieved",ExtAppsQueryInstalledAppsV2:"ext_apps_fetch_installed_apps_v2",ExtAdaptiveCardSDKParse:"ext_ac_sdk_parse",ExtAdaptiveCardSDKRender:"ext_ac_sdk_render",ExtAdaptiveCardHtmlTransformation:"ext_ac_html_transformation",ExtCardCopyPreProcessing:"ext_bots_card_copy_preprocess",ExtCardCopyUISlotReady:"ext_bots_card_copy_ui_slot_ready",ExtCardCopyGenerateMetaInfoHtml:"ext_bots_card_copy_gen_html_meta_info",ExtCardCopyGenerateSharingHtml:"ext_bots_card_copy_gen_html_sharing",ExtCardCopyGenerateTextPreview:"ext_bots_card_copy_gen_text_preview",ExtCardCopyToClipboard:"ext_bots_card_copy_to_clipboard",ExtCardCopyDone:"ext_bots_card_copy_done",ExtAppDefinitionFetched:"ext_app_defintion_fetched",Channel3SResolved:"3s_channel_resolved",Chat3SResolved:"3s_chat_resolved",People3SResolved:"3s_people_resolved",IndexedDBUpgrade:"indexed_db_upgrade",ChatRosterRenderedMembersLoaded:"members_loaded",ChatRosterRenderedMembersRenderedInVList:"members_rendered_in_vlist",LinkedInCheckVersionOverride:"linkedin_checkversionoverride",LinkedInLoadMain:"linkedin_loadmain",FetchCatalogFromCache:"devices_store_fetch_catalog_from_cache",FetchCatalogFromCacheInError:"devices_store_fetch_catalog_from_cache_in_error",FetchCatalogFromNetwork:"devices_store_fetch_catalog_from_network",GetAllDevicesOneCdnVersion:"devices_store_fetch_catalog_get_one_cdn_version",FetchCatalogFromNetworkEmpty:"devices_store_fetch_catalog_from_network_empty",ProviderFetchCatalogForCollection:"devices_store_fetch_catalog_provider_fetch_for_collection",ProviderFetchCatalogForSearch:"devices_store_fetch_catalog_provider_fetch_for_search",ProviderFilterCatalogForCollection:"devices_store_fetch_catalog_provider_filter_for_collection",ProviderFilterCatalogForFeatured:"devices_store_fetch_catalog_provider_filter_for_featured",SortCatalog:"devices_store_fetch_catalog_sort",FilterCatalog:"devices_store_fetch_catalog_filter",FetchMetadataFromCache:"devices_store_fetch_device_metadata_from_cache",FetchMetadataFromNetwork:"devices_store_fetch_device_metadata_from_network",FetchMetadataFromNetworkEmpty:"devices_store_fetch_device_metadata_from_network_empty",GetDeviceDetailsOneCdnVersion:"devices_store_fetch_device_metadata_get_one_cdn_version",AddItemsToCart:"add_item_to_cart",RemoveItemsFromCart:"remove_item_from_cart",OpenCartDialogFromPDP:"open_cart_dialog",OpenCartDialogFromHome:"open_cart_dialog",MeetingChatRsvpMeetingJoinUnmuteConversation:"meeting_chat_rsvp_meeting_join_unmuted_conversation",MeetingChatRsvpMeetingJoinUnmuteConversationFollow:"meeting_chat_rsvp_meeting_join_unmuted_conversation_follow",MeetingChatRsvpMeetingJoinUnmuteConversationTentative:"meeting_chat_rsvp_meeting_join_unmuted_conversation_tentative",MeetingChatMeetNowObjectRendererCompleted:"meeting_chat_meeting_object_renderer_completed",ConstructedResult:"search_meeting_summary_constructed_result",QuestionRendered:"meeting_collab_question_rendered",AnswerRendered:"meeting_collab_answer_rendered",StopCopilotTimeout:"StopCopilotTimeout",StartCopilotTimeout:"StartCopilotTimeout",CopilotTranscriptStatusChanged:"CopilotTranscriptStatusChanged",GroupCopilot_UpdateMeetingSettings:"update_meeting_settings",HandoffResponseRecieved:"handoff_response_received",FluidNoteUpdatePSLAccessList:"fluid_note_update_psl_access_list",FluidNoteUpdatePSLAccessListSucceeded:"fluid_note_update_psl_access_list_succeeded",FluidNoteUpdatePSLAccessListFailed:"fluid_note_update_psl_access_list_failed",CallingCalendarQuery_ChatLoaded:"calling_calendar_query_chat_loaded",CallingCalendarQuery_TeamChannelLoaded:"calling_calendar_query_team_channel_loaded",MeetingPropertiesFromCallingCalendar:"meeting_properties_from_callingcalendar",RecapMCPSNoPermissionError:"recap_mcps_no_permission_error",OndemandStart:"on_demand_start",RecapFileUrlDomainChecked:"file_url_domain_checked",RecapInstancesListLoaded:"recap_instance_list_loaded",AIInsightsLoaded:"AI_insights_loaded",AIMentionsLoaded:"AI_mentions_loaded",OnePlayerLoaded:"OnePlayer_loaded",OnePlayerFailed:"OnePlayer_failed",FetchOnePlayerDataFailed:"Data_For_OnePlayer_started",OneTranscriptLoaded:"onetranscript_loaded",CallRecapStartLoadingOnePlayer:"call_recap_start_loading_OnePlayer",CallRecapOnePlayerLoaded:"call_recap_OnePlayer_loaded",CallRecapOneTranscriptLoaded:"call_recap_OneTranscript_loaded",OneTranscriptStartLoading:"OneTranscript_start_loading",ChapteringStartLoading:"Chaptering_start_loading",OnePlayerStartLoading:"OnePlayer_startLoading",OnePlayerStartInitialize:"OnePlayer_startInitialize",OnePlayerInitializeWithSoftTrim:"OnePlayer_initialize_with_soft_trim",OnePlayerTimeToLoaded:"OnePlayer_time_to_loaded",OnePlayerCompletedInitialize:"OnePlayer_completedInitialize",LoadPreviewUrl:"OnePlayer_startLoading",LoadOnePlayer:"OnePlayer_startInitialize",PreviewDataFetched:"Preview_data_Fetched",XPlatLoaded:"XPlat_Loaded",OneTranscriptIFrameLoaded:"OneTranscript_iframe_Loaded",CrOnePlayerStartLoading:"Cr_OnePlayer_startLoading",CrOneTranscriptStartLoading:"Cr_OneTranscript_start_loading",MrChicletLoadingRecordingsFromMCPS:"mr_chiclet_loading_recordings_from_mcps",MeetAppScheduleMeetingCreateSSEventInitializationComplete:"meet_app_schedule_meeting_create_ss_event_initialization_complete",MeetAppScheduleMeetingGetUserTimeZoneNameResponseFunction:"meet_app_schedule_meeting_get_user_time_zone_response_function",MeetAppSpeedDialListRenderComplete:"meet_app_speeddial_list_render_complete",MeetAppSpeedDialListQueryLoaded:"meet_app_speeddial_list_query_loaded",MeetAppUpcomingRenderErrorPageLoaded:"meet_app_upcoming_error_page_loaded",MeetAppRecentRenderErrorPageLoaded:"meet_app_recent_error_page_loaded",FetchUpcomingMCO:"fetch_upcoming_mco",FetchUpcomingMRE:"fetch_upcoming_mre",FetchUpcomingMP:"fetch_upcoming_mp",FetchRecentMCO:"fetch_recent_mco",FetchRecentMCU:"fetch_recent_mcu",MeetAppRecentFetchMCOError:"meet_app_recent_fetch_mco_error",MeetAppRecentFetchMCUToken:"meet_app_recent_fetch_mcu_token",MeetForWorkSummaryGetThumbnail:"meet_app_redner_summary_get_thumbnail",MeetForWorkSummaryGetSummary:"meet_app_redner_summary_get_summary",MeetForWorkSummaryExistTasks:"meet_app_redner_summary_exist_tasks",MeetForWorkSummaryExistMentions:"meet_app_redner_summary_exist_mentions",PPTStarted:"ppt_started",PPTFrameLoaded:"ppt_frame_loaded",PPTIncomplete:"ppt_incomplete",VideoContainerMounted:"video_container_rendered",CompositorCreating:"video_compositor_creating",TenantIdResolutionFinished:"tenant_resolution_finished",onBeforeCommandHandled:"calling_before_command_handled",SwitchTmLatencyInvitingBotToCall:"invite_bot_to_call",SwitchTmLatencyLayoutItemCreated:"layout_item_created",SwitchTmLatencyBotJoinedCall:"bot_joined_call",SwitchTmLatencyStartStreamInitiated:"start_stream_initiated",SwitchTmLatencyRendererCreated:"renderer_created",PropsChanged:"prop_changed",SwitchLgLatencyInvitingBotToCall:"invite_bot_to_call",SwitchLgLatencyBotJoinedCall:"bot_joined_call",SwitchLgLatencyStartStreamInitiated:"start_stream_initiated",SwitchLgLatencyRendererCreated:"renderer_created",VideoStreamRenderingRendererCreated:"renderer_created",StartVideoPreJoinToggle:"pre_join_toggle_on",StartVideoCallToggle:"call_toggle_on",StartVideoContainer:"start_video_on_container",ToggleVideoPropsChanged:"video_props_changed",StopVideoPreJoinToggle:"pre_join_toggle_off",StopVideoCallToggle:"call_toggle_off",StopVideoContainer:"stop_video_on_container",resolvedTsCallingStoppedSharing:"resolved_ts_calling_stop_sharing",addNMSStage:"add_nms_stage",updateNMSLayout:"update_nms_layout",ShowFailed:"show-failed",HideFailed:"hide-failed",UnhideFailed:"unhide-failed",CWHide:"cw-hide",CWHidden:"cw-hidden",CWHideFailed:"cw-hide-failed",CWShow:"cw-show",CWVisible:"cw-visible",CWShowFailed:"cw-show-failed",CloseFailed:"close-failed",ChatPaneContainerChatOrMessageListQueryPending:"chat_pane_chat_or_message_list_query_pending",ChatPaneChatAwaitQueryStart:"chat_pane_chat_query_start",ChatPaneChatAwaitQueryEnd:"chat_pane_chat_query_end",CommentStreamChatPaneMessagesQueryStart:"comment_stream_chat_pane_message_query_start",CommentStreamChatPaneMessagesQueryEnd:"comment_stream_chat_pane_message_query_end",CommentStreamChatPaneMessagesQueryError:"comment_stream_chat_pane_message_query_error",NotifySDKError:"notify_sdk_error",ApplySelectedAvatarUnknown:"",FacilitatorMeetingTimerAgendaTimerRender:"facilitator_meeting_timer_agenda_render",FacilitatorMeetingTimerAdhocTimerRender:"facilitator_meeting_timer_adhoc_render",ExtMessageExtensionQueryCommandInit:"ext_me_queryCommand_init",ExtMessageExtensionQueryCommandSSOAuthReenter:"ext_me_queryCommand_sso_auth_re_enter",LoadLocalizationNamespacesForConversationComplete:"load_localization_namespaces_for_conversations_complete",IRAuthTokenRetrieved:"ir_auth_token_retrieved",MessageSendWorkerOverrideT1DisplayNameEOL:"message_send_worker_override_t1_display_name_eol",PostGuardiansAnnouncementToConversation:"post_guardians_announcements_to_conversation",PostMessageToPhonelinkSmsConversation:"post_message-to-phonelink-sms_conversation",EditScheduledMessageInDraftStream:"edit_scheduled_in_draft_stream",CreateChatThreadId:"lobby_chat_create_chat_thread_id",M365ChatBotStopGeneratingClicked:"m365chat_stop_generating_click",M365ChatBotStopGeneratingRequestDone:"m365chat_stop_generating_request_done",M365ChatBotStopGeneratingFinished:"m365chat_stop_generating_finished",DeeplinkParamsReceived:"params_received",DeeplinkIncomingData:"incoming_data",DeeplinkLoadingMore:"loading_more",DeeplinkVirtualListLoadMore:"virtual_list_load_more",DeeplinkLoadedMore:"loaded_more",DeeplinkLoadedAll:"loaded_all",DeeplinkScrollToIndex:"scroll_to_index",DeeplinkHighlightVisible:"highlight_visible",DeeplinkScrollComplete:"scroll_complete",FluidFetchComposeManifestCacheHit:"A cached version has been hit",FluidFetchGLV2ManifestLoaded:"Manifest has been loaded from CDN",FluidGetSPOFileInfo:"fluid_get_spo_file_info",FluidPasteSendNotification:"Notification are executed on send click",FluidGetValidDomainsFromSP:"fluid_get_valid_domains_from_sharepoint",FluidLinkPasted:"marking the success of Loop link paste action",NoPreviousAndNextMessage:"no_previous_next_message",NavScrollToIndex:"scroll_to_index",MessagesListQueryGetConversation:"messages_list_get_conversation",MessagesListQueryFetchedSingleReplyChainMessages:"messages_list_fetched_single_reply_chain_messages",MessagesListQueryFetchedConversationMessages:"messages_list_fetched_conversation_messages",MessagesListQueryIntelligentTranslation:"messages_list_intelligent_translation",MessagesListQuerySortConvertMessages:"messages_list_sort_convert_messages",GetMTMANotificationsInitiated:"get_mtma_notifications_initiated",NotificationsGraphQLQuery:"notifications_graphql_query",ModernStageRender_Join:"modern_stage_render_join",ModernStageRender_Swap:"modern_stage_render_swap",ModernStageRender_Pinning:"modern_stage_render_pinning",ModernStageRender_Spotlighting:"modern_stage_render_spotlighting",ModernStageRender_FocusingOnInterpreter:"modern_stage_render_focusing_on_interpreter",ModernStageRender_DisablingParticipantVideo:"modern_stage_render_disabling_participant_video",ModernStageRender_VBSS:"modern_stage_render_vbss",ModernStageRender_BotView:"modern_stage_render_botview",ModernStageRender_PPT:"modern_stage_render_ppt",ModernStageRender_Holographic:"modern_stage_render_holographic",ModernStageRender_Whiteboard:"modern_stage_render_whiteboard",ModernStageRender_HostMode:"modern_stage_render_hostmode",ModernStageRender_ProductionStudio:"modern_stage_render_production_studio",ModernStageRender_Resize:"modern_stage_render_resize",ModernStageRender_CallParticipantsResponse:"modern_stage_render_call_participants_response",XDaysOfInactiveStatusCalculateConditionsTriggered:"x_days_of_inactive_status_calculcate_conditions_triggered",XDaysOfInactiveStatusCalculateConditionsNoDataReceived:"x_days_of_inactive_status_calculcate_conditions_no_data_received",MeetNowLinksCalculateConditionsTriggered:"meet_now_links_calculcate_conditions_triggered",MeetNowLinksCalculateConditionsNoDataReceived:"meet_now_links_calculcate_conditions_no_data_received",AssignedUnknownUserNameToTFLtToast:"assigned_unknown_user_name_to_tfl_toast",P2PFilesListRendererError:"p2p_files_list_renderer_error",P2PFilesListRendererEmptyList:"p2p_files_list_renderer_empty_list",P2PFilesListRendererFilesList:"p2p_files_list_renderer_files_list",P2PFilesListAllFilesCallStart:"p2p_files_list_allfiles_call_start",P2PFilesListAllFilesCallCompleted:"p2p_files_list_allfiles_call_completed",P2PFilesListAllFilesCallFailed:"p2p_files_list_allfiles_call_failed",P2PFilesListAllFilesFastCallStart:"p2p_files_list_allfiles_fast_call_start",P2PFilesListAllFilesFastCallCompleted:"p2p_files_list_allfiles_fast_call_completed",P2PFilesListAllFilesFastCallFailed:"p2p_files_list_allfiles_fast_call_failed",MembersTabSearchFetchTagsError:"people_targeting_members_tab_search_fetch_tags_error",MembersTabSearchFetchTagsComplete:"people_targeting_members_tab_search_fetch_tags_complete",MembersTabFetchTagsComplete:"people_targeting_members_tab_fetch_tags_complete",MembersTabFetchTagsError:"people_targeting_members_tab_fetch_tags_error",ManageTagsFetchTagsComplete:"people_targeting_manage_tags_fetch_tags_complete",ManageTagsFetchTagsError:"people_targeting_manage_tags_fetch_tags_error",ManageTagsFetchTagsFetchDeletedTags:"people_targeting_manage_tags_fetch_tags_fetch_deleted_tags",ManageTagsFetchTagsFetchDeletedTagsComplete:"people_targeting_manage_tags_fetch_tags_fetch_deleted_tags_complete",ManageTagsFetchDeletedTagsComplete:"people_targeting_manage_tags_fetch_deleted_tags_complete",ManageTagsFetchDeletedTagsError:"people_targeting_manage_tags_fetch_deleted_tags_error",ManageTagsCreateTagComplete:"people_targeting_manage_tags_create_tag_complete",ManageTagsCreateTagError:"people_targeting_manage_tags_create_tag_error",ManageTagsUpdateTagComplete:"people_targeting_manage_tags_update_tag_complete",ManageTagsUpdateTagError:"people_targeting_manage_tags_update_tag_error",ManageTagsAddTagMemberComplete:"people_targeting_manage_tags_add_tag_member_complete",ManageTagsAddTagMemberError:"people_targeting_manage_tags_add_tag_member_error",ManageTagsRemoveTagMemberComplete:"people_targeting_manage_tags_remove_tag_member_complete",ManageTagsRemoveTagMemberError:"people_targeting_manage_tags_remove_tag_member_error",ManageTagsRestoreTagComplete:"people_targeting_manage_tags_restore_tag_complete",ManageTagsRestoreTagError:"people_targeting_manage_tags_restore_tag_error",ManageTagsDeleteTagComplete:"people_targeting_manage_tags_delete_tag_complete",ManageTagsDeleteTagError:"people_targeting_manage_tags_delete_tag_error",ManageTagsStartChatWithTagCancelled:"people_targeting_manage_tags_start_chat_with_tag_cancelled",ManageTagsStartChatWithTagComplete:"people_targeting_manage_tags_start_chat_with_tag_complete",ManageTagsStartChatWithTagFetchTagMembersSucceed:"people_targeting_manage_tags_start_chat_with_tag_fetch_tag_members_succeed",ManageTagsStartChatWithTagError:"people_targeting_manage_tags_start_chat_with_tag_error",ManageTagsGetTagDetailsComplete:"people_targeting_manage_tags_get_tag_details_complete",ManageTagsGetTagDetailsError:"people_targeting_manage_tags_get_tag_details_error",ManageTagsGetTeamTagSettingsComplete:"people_targeting_manage_tags_get_team_tag_settings_complete",ManageTagsGetTeamTagSettingsError:"people_targeting_manage_tags_get_team_tag_settings_error",ManageTagsDropdownCreateTagComplete:"people_targeting_manage_tags_dropdown_create_tag_complete",ManageTagsDropdownCreateTagError:"people_targeting_manage_tags_dropdown_create_tag_error",ManageTagsDropdownAddOrRemoveTagsFromMemberComplete:"people_targeting_manage_tags_dropdown_add_remove_tags_from_member_complete",ManageTagsDropdownAddOrRemoveTagsFromMemberError:"people_targeting_manage_tags_dropdown_add_remove_tags_from_member_error",ManageTagsDropdownAddTagsToMember:"people_targeting_manage_tags_dropdown_add_tags_to_member",ManageTagsDropdownRemoveTagsFromMember:"people_targeting_manage_tags_dropdown_remove_tags_from_member",FilterFedAndBots:"filter_federated_users_and_bots",FilterTFLResults:"filter_tfl_results",GetOffNetWorkResults:"get_off_network_results",EmptySearchQuery:"Empty searchQuery",UpdateCachedThreadRoster:"updating cached thread roster",ThreadNotCached:"thread not cached",StoredFetchedThreadMembers:"stored fetched thread members zero-state",FetchedThreadMembers:"thread members fetch failed zero-state",UPSSearchSuccess:"UPS search success",LocalCacheSearchSuccess:"Local cache search success",ThreadFetched:"thread fetched",FetchedThreadFromConversationManager:"fetched thread from convMgr",FetchedThreadFromConversationManagerFail:"fetch thread from convMgr failed",FetchedThreadFromChatService:"fetched thread from chatSvc",FetchedThreadFromChatServiceFail:"fetch thread from chatSvc failed",FetchedThreadFromCache:"fetched thread from in-memory cache",AddedTeamMention:"added team mention",AddedChannelMention:"added channel mention",AddedNamedChannelMention:"added named channel mention",TagsNotAllowed:"tags not allowed",FetchedAllTagsFromPeopleTargetingManager:"fetched all tags from peopleTargetingManager",FetchedAllTagsFromPeopleTargetingService:"fetched all tags from peopleTargetingService",FetchedAllTags:"fetched all tags",TagsFetchFailed:"tags fetch failed",OwnerTagAdded:"owner tag added",StartConversationFetchWorkflowForCSV1Started:"start_conversation_fetch_workflow_for_csv1_started",StartConversationFetchWorkflowForCSV1Completed:"start_conversation_fetch_workflow_for_csv1_completed",SetupImageAuthCookie:"After setupImageAuthCookie",MTResource_Acquired:"MTResource acquired",AcquireTokenV2:"After acquireTokenV2",PreIndexServiceWorkerStartup:"pre_worker_startup",IndexServiceWorkerStartup:"service_worker_startup",IndexFetchIPC:"index_fetch_ipc",IndexDNS:"index_dns_lookup",ReadIndexHtml:"read-index-html",retrySWRegisteration:"retry_sw_registration",LoadLPCLoader:"load_lpc_loader",RenderWithLPC:"render_with_lpc",FetchWaitRequestIPC:"fetch_wait_request_ipc",FetchWaitResponseIPC:"fetch_wait_response_ipc",FetchWaitIPC:"fetch_wait_ipc",AppPhasePostCritical:"AppPhase_post_critical",AppPhaseComplete:"AppPhase_complete",ExperienceWarmJobCompleted:"Experience_Warm_Job_Completed",PreWarmJobCompleted:"Pre_Warm_Job_Completed",AspConnectionFromAppSubscribeToGlobalService:"hid_device_asp_connection_from_app_subscribe_to_global_service",AspConnectionFromAppUpdateFromGlobalService:"hid_device_asp_connection_from_app_update_from_global_service",HfpModuleInitialized:"hfp_module_init",NotifyingBTDevices:"notifying_bt_devices",PersonMapContactsToPersonsCompleted:"person_map_contacts_to_person_completed",copilotPanelLoaded:"loading_copilot_panel_loaded",bizChatHostReady:"bizchat_host_ready",bizChatBeforeLoading:"bizchat_available_before_loading",bizChatLoadingStart:"bizchat_loading_start",bizChatLoadingCompleted:"bizchat_loading_completed",PhonelinkSmsSyncJobFailed:"phonelinkSmsSyncJobFailed",PhonelinkSmsSyncJobCancelled:"phonelinkSmsSyncJobCancelled",PhonelinkSmsSyncFetchingSyncTokens:"phonelinkSmsSyncFetchingSyncTokens",PhonelinkSmsSyncNoConversationsSyncToken:"phonelinkSmsSyncNoConversationsSyncToken",PhonelinkSmsSyncNoMessagesSyncToken:"phonelinkSmsSyncNoMessagesSyncToken",PhonelinkSmsSyncFetchedConversationsSyncToken:"phonelinkSmsSyncFetchedConversationsSyncToken",PhonelinkSmsSyncFetchedMessagesSyncToken:"phonelinkSmsSyncFetchedMessagesSyncToken",PhonelinkSmsSyncJobStarted:"phonelinkSmsSyncJobStarted",PhonelinkSmsSyncJobCompleted:"phonelinkSmsSyncJobCompleted",PhonelinkSmsSyncFetchedDataFromCSA:"phonelinkSmsSyncFetchedDataFromCSA",PhonelinkSmsSyncProcessedConversationsData:"phonelinkSmsSyncProcessedConversationsData",PhonelinkSmsSyncProcessedMessagesData:"phonelinkSmsSyncProcessedMessagesData",PhonelinkSmsSyncUpdatedConversationsSyncMetaData:"phonelinkSmsSyncUpdatedConversationsSyncMetaData",PhonelinkSmsSyncUpdatedMessagesSyncMetaData:"phonelinkSmsSyncUpdatedMessagesSyncMetaData",PhonelinkSmsSyncFailedToSaveData:"phonelinkSmsSyncFailedToSaveData",PhonelinkSmsSyncFailedToSaveSyncState:"phonelinkSmsSyncFailedToSaveSyncState",phonelinkSmsServiceResponseWithError:"phonelinkSmsServiceResponseWithError",PhonelinkSmsDeleteConversationAndReplyChains:"phonelinkSmsDeleteConversationAndReplyChains",PhonelinkSmsGotDeviceId:"phonelinkSmsGotDeviceId",PhonelinkSmsReceivedPairedResult:"phonelinkSmsReceivedPairedResult",PhonelinkSmsSavedDeviceId:"phonelinkSmsSavedDeviceId",PhonelinkSmsErrorSavingDeviceId:"phonelinkSmsErrorSavingDeviceId",PhonelinkSmsGetAllPhonelinkChats:"phonelinkSmsgetAllPhonelinkChats",PhonelinkSmsLookupReplyChainsBySkypeGuid:"phonelinkSmslookupReplyChainsBySkypeGuid",PhonelinkSmsRemoveMessage:"phonelinkSmsremoveMessage",PhonelinkSmsUpdateLastMessageOfChat:"phonelinkSmsupdateLastMessageOfChat",PlacesADLProcessDetectedEventDebounce:"places_adl_process_detected_event_debounce",PlacesADLProcessDetectedEventReport:"places_adl_process_detected_event_report",PlacesADLCreateEventSubscriptionShouldSubscribe:"places_adl_create_event_subscription_should_subscribe",AddAppDialogStartFetch:"app_app_dialog_start_fetch",AddAppDialogFetchChats:"app_app_dialog_fetch_chats",AddAppDialogFetchChatsById:"app_app_dialog_fetch_chats_by_id",AddAppDialogFetchTeams:"app_app_dialog_fetch_teams",AddAppDialogFetchMeeting:"app_app_dialog_fetch_meetings",AppEnableDialogOpened:"ext_app_enable_dialog_opened",AppEnableDialogClosed:"ext_app_enable_dialog_closed",ExtractAppDefinitionJobStarted:"ext_extract_app_definition_job_started",ExtractAppDefinitionJobComplete:"ext_extract_app_definition_job_complete",SideloadAppsUploadJobCompleted:"sideload_apps_upload_job_complete",SideloadAppsUpdateJobCompleted:"sideload_apps_update_job_complete",AppsUsageManagerGetAppsUsageFromNetworkExpectedErrors:"ext_apps_usage_manager_get_apps_usage_from_network_expected_errors",AppsUsageManagerSyncJobComplete:"apps_usage__manager_sync_job_complete",AppsUsageStrategyOnappstatelonginactiveNoSync:"ext_apps_usage_strategy_onappstatelonginactive_no_sync",AppsUsageStrategyOnappstatelonginactiveShouldSync:"ext_apps_usage_strategy_onappstatelonginactive_should_sync",AppsUsageManagerSyncTerminate:"ext_apps_usage_manager_sync_terminate",AppsUsageManagerSyncContinue:"ext_apps_usage_manager_sync_continue",FetchBlockedAppDefinitionsFromCache:"user_app_request_manager_get_blocked_app_definitions_from_cache",FetchBlockedAppDefinitionsFromSource:"user_app_request_manager_get_blocked_app_definitions_from_source",EnableAppInLWGChannel:"enable_app_in_lwg_channel",GetAppStatusesFromCache:"channel_installed_apps_manager_get_app_statuses_from_cache",GetAppStatusesFromCacheFailed:"channel_installed_apps_manager_get_app_statuses_from_cache_failed",SyncAppStatuses:"channel_installed_apps_manager_sync_app_statuses",ResolveAppDefinitionFromCache:"apps_platform_worker_resolver_app_definition_from_cache",ResolveAppDefinitionFromBlockedApps:"apps_platform_worker_resolver_app_definition_from_blocked_apps",ResolveAppDefinitionFromSource:"apps_platform_worker_resolver_app_definition_from_source",NoAppDefinitionFound:"apps_platform_worker_resolver_app_definition_not_found",ResolveNewAppInstallContext:"apps_platform_worker_resolver_installed_apps_v2_resolve_new_app_install_context",AppsPlatformWorkerResolverInstalledAppsForMesssageActionFFDisabled:"apps_platform_worker_resolver_installed_apps_for_message_action_ff_disabled",AppsPlatformWorkerResolverInstalledAppsForMesssageActionNoConversationId:"apps_platform_worker_resolver_installed_apps_for_message_action_no_conversation_id",AppsPlatformWorkerResolverInstalledAppsForMesssageActionNotGroupChatScoped:"apps_platform_worker_resolver_installed_apps_for_message_action_not_group_chat_scoped",FilterUnsupportedAppBarApps:"filter_unsupported_appbar_apps",StoreGetItemsHaveItemsList:"have_items_list",StoreGetItemsItemsFetched:"items_fetched",StoreSuggestItemsZeroStateResults:"have_zero_state_results",StoreSuggestItemsTypeaheadResults:"have_typeahead_results",StoreSuggestItemsFetched:"items_fetched",StoreEntryProviderLoaded:"provider_loaded",StoreEntryItemsQueryCompleted:"items_query_completed",StoreEntryItemsDetailQueryStarted:"items_detail_query_started",StoreSearchHaveServerResults:"have_server_results",StoreSearchClientIndexReady:"client_index_ready",StoreSearchHaveClientResults:"have_client_results",StoreSearchItemsFetched:"items_fetched",StoreSearchCollectionsFiltered:"collections_filtered",PlatformTabInitInvoke:"platform_tab_initialize_invoked",PlatformTabAppLoadedInvoke:"platform_tab_appLoaded_invoked",PlatformTabNotifySuccessInvoke:"platform_tab_success_invoked",PlatformTabNotifyFailureInvoke:"platform_tab_failure_invoked",PlatformTabNotifyExpectedFailureInvoke:"platform_tab_expected_failure_invoked",PlatformTabSidePanelLoadStart:"platform_tab_sidepanel_load_start",PlatformTabSendSelectAppEntityEvent:"platform_tab_select_app_entity_event",StageViewAppIsPreInstalled:"stage_view_app_is_preinstalled",StageViewAppIsNotPreInstalled:"stage_view_app_is_not_preinstalled",StageViewJITInstallDone:"stage_view_jit_install_done",StageViewJITInstallScopeNotSupported:"stage_view_jit_install_scope_not_sopported",StageViewAppTabInfoParsed:"stage_view_tab_info_parsed",PlatformTabFetchUbarIsMemberSuccess:"platform_tab_fetch_ubar_isMember_success",PlatformTabFetchUbarIsMemberNotSet:"platform_tab_fetch_ubar_isMember_notSet",PlatformTabFetchUbarDroppedTabsDueToMeetingContext:"platform_tab_fetch_ubar_droppedTabs_meetingContext",PlatformFetchAppDefinitionResolver:"platform_fetch_app_definition_from_resolver",PlatformFetchInstalledAppResolver:"platform_fetch_installed_app_from_resolver",TabsUsageRecordUsageSyncJobStarted:"tabs_usage_record_sync_job_started",TabsUsageRecordUsageSyncJobComplete:"tabs_usage_record_sync_job_complete",IdbPeopleAndChatStart:"indexeddb_people_chat_start",IdbPeopleAndChatEnd:"indexeddb_people_chat_end",SuggestionTCCIdbStart:"suggestion_tcc_idb_start",SuggestionTCCIdbStop:"suggestion_tcc_idb_stop",Suggestion3SStart:"suggestion_3s_start",Suggestion3SStop:"suggestion_3s_stop",Suggestion3SProcessComplete:"suggestion_3s_process_complete",SuggestionSearchV2Start:"suggestions_searchv2_start",SuggestionSearchV2Stop:"suggestions_searchv2_stop",PeopleTopNIdbStop:"people_topn_idb_stop",FilesTopNIdbStop:"files_topn_idb_stop",ConversionStart:"suggestion_conversion_start",ConversionStop:"suggestion_conversion_stop",LocalConversionStart:"local_suggestion_conversion_start",LocalConversionStop:"local_suggestion_conversion_stop",ConversationFallbackToPeopleHydration:"suggestion_conversation_fallback_hydration",SuggestionLocalTCCSortEnd:"suggestion_local_tcc_sort_end",AppSuggestionsMEAppsFound:"app_suggestions_me_apps_found",ZQTopNSuggestionsDBFetchComplete:"zq_topn_suggestions_db_fetch_complete",GetZQTopNSuggestionsStop:"get_zq_topn_suggestions_stop",ZQ3SSuggestionsDBFetchComplete:"zq_3s_suggestions_db_fetch_complete",GetZQ3SSuggestionsStop:"get_zq_3s_suggestions_stop",GetZQDiscoverEntryStop:"get_zq_discover_entry_stop",JoinByRoomInitiated:"initiated_join_by_room",DoNotUseAudioInitiated:"initiated_do_not_use_audio",BeginRegisterImProvider:"t2_office_integration_begin_register_im_provider",FinalizeRegisterImProvider:"t2_office_integration_finalize_register_im_provider",LogActivity:"log-activity",SurveyActivated:"survey-activated",ShowCommand:"show-command",SurveyTimeout:"survey-timeout",LicenseInformationReceived:"license-information-received",SerializingConfiguration:"serializing-configuration",WaitingForExperience:"waiting-for-experience",ExperienceReceived:"experience-received",Search3SStop:"search_3s_stop",Search3SProcessComplete:"search_3s_process_complete",Search3SRetry:"search_results_3s_retry",CacheWait3S:"cache_wait_3s",PrefetchResponse3S:"prefetch_response_3s",Get3SCallMetaData:"get_3s_call_metadata",RequestSent3S:"request_sent_3s",SecondRequestSent3S:"second_request_sent_3s",ResponseSuccess3S:"response_success_3s",UIResultsProcessed:"render_begin",AdditionalUIResultsProcessed:"render_continue",FetchedFromServiceCache:"fetched_from_cache",ForcedTimedOut3S:"forced_timeout_3s",Failure3S:"failure_3s",Retry3S:"retry_3s",DynamicRefinersRenderComplete:"search_dynamic_refiners_render_complete",OfficeFileAndSPOFirstRenderComplete:"office_file_and_spo_first_render_complete",PrensenterModeFirstRenderComplete:"presenter_mode_first_render_complete",docCollabDynamicFileUserPermissionsBatchProcessingPermissionsAssigned:"doc_collab_dynamic_file_user_permissions_batch_processing_permissionsAssigned",docCollabDynamicFileUserPermissionsBatchProcessingPartialPermissionsAssigned:"doc_collab_dynamic_file_user_permissions_batch_processing_partial_permissionsAssigned",docCollabDynamicFileUserPermissionsBatchProcessingPermissionsNotificationSent:"doc_collab_dynamic_file_user_permissions_batch_processing_permissionsNotificationSent",STTGetAggregatedSuggestions:"stt_get_aggregated_suggestions",STTProcessPeopleResults:"stt_process_people_results",STTProcessGroupChatResults:"stt_process_group_chat_results",STTProcessChannelResults:"stt_process_channel_results",RenderShareForm:"RenderShareForm",SimpleCollabReorderConversationFoldersShouldShowBizChatMetaOSEntry:"simple_collab_reorder_conversation_folders_should_show_biz_chat_meta_os_entry",SimpleCollabDnDItemToConversationFolderUpdaterStart:"simple_collab_dnd_item_to_conversation_folder_updater_start",SimpleCollabDnDItemToConversationFolderUpdaterCompleted:"simple_collab_dnd_item_to_conversation_folder_updater_completed",SimpleCollabDnDItemToConversationFolderUpdaterFailed:"simple_collab_dnd_item_to_conversation_folder_updater_failed",SimpleCollabDnDItemToConversationFolderCompletedBySubscription:"simple_collab_dnd_item_to_conversation_folder_completed_by_subscription",SimpleCollabDnDItemToConversationFolderFailedBySubscription:"simple_collab_dnd_item_to_conversation_folder_failed_by_subscription",SimpleCollabResolverSetSliceGestureGetSliceConversationStart:"simple_collab_set_slice_gesture_get_slice_conversation_start",SimpleCollabResolverSetSliceGestureGetSliceConversationComplete:"simple_collab_set_slice_gesture_get_slice_conversation_complete",SimpleCollabResolverSetSliceGestureUpdateFolderItemsStart:"simple_collab_set_slice_gesture_update_folder_items_start",SimpleCollabResolverSetSliceGestureUpdateFolderItemsComplete:"simple_collab_set_slice_gesture_update_folder_items_complete",SimpleCollabSelectNextConversationGetRawFolderByConversationId:"simple_collab_select_next_conversation_get_raw_folder_by_conversation",SimpleCollabResolverRemoveConversationFromFolderStart:"simple_collab_remove_conversation_from_folder_start",SimpleCollabResolverRemoveConversationFromFolderGetFromFolder:"simple_collab_remove_conversation_from_folder_get_from_folder",SimpleCollabResolverRemoveConversationFromFolderDeleteItemFromFolder:"simple_collab_remove_conversation_from_folder_delete_conversation_from_folder",SimpleCollabResolverRemoveConversationFromFolderFetchUpdatedFromFolder:"simple_collab_remove_conversation_from_folder_fetch_updated_from_folder",SimpleCollabResolverReorderConversationFolderStart:"simple_collab_resolver_reorder_conversation_folders_start",SimpleCollabResolverReorderConversationFolderGetConversationFoldersComplete:"simple_collab_resolver_reorder_conversation_folders_get_conversation_complete",SimpleCollabResolverReorderConversationFolderUpdateConversationFoldersOrderComplete:"simple_collab_resolver_reorder_conversation_folders_update_conversation_folders_order_complete",GetCDLFoldersStart:"get_cdl_folders_start",GetCDLFoldersComplete:"get_cdl_folders_complete",LocalCatchupNotNeeded:"sync_not_needed",SliceItemIsReadInfoAdded:"slice_item_isread_info_added",GetRecommendedTeamsUsersComplete:"get_recommended_teams_users_Complete",buildUserSet:"get_recommended_teams_users",UserOnboardingToTeamLoadNextComplete:"useronboarding_to_team_load_next_complete",UserOnboardingToTeamLoadNextFail:"useronboarding_to_team_load_next_fail",UserOnboardingToTeamFilterSortLoadComplete:"useronboarding_to_team_filter_sort_load_complete",UserOnboardingToTeamFilterSortLoadFail:"useronboarding_to_team_filter_sort_load_fail",GetJoinedTeamsFilterWithTagsEnabled:"get_joined_teams_filter_tags_enabled",InvokeStaleChannelsHideBatchAPIStart:"invoke_stale_channels_hide_batch_api_start",InvokeStaleChannelsHideBatchAPIComplete:"invoke_stale_channels_hide_batch_api_complete",HandleStaleChannelsBatchAPIError:"handle_stale_channels_batch_api_error",InvokeStaleChannelsShowBatchAPIStart:"invoke_stale_channels_show_batch_api_start",InvokeStaleChannelsShowBatchAPIComplete:"invoke_stale_channels_show_batch_api_complete",SetLastFavoritedPropertyOnStaleTeamsAndChannels:"set_last_favorited_timestamp_on_stale_teams_and_channels",UpdateStaleTeamsAndChannelsDataCDLInternalStore:"update_stale_teams_and_channels_data_cdl_internal_store",GetStaleTeamsDataInContainer:"get_stale_teams_data_container",GetStaleTeamsDataInRenderer:"get_stale_teams_data_renderer",CreateTeamRenderError:"render_create_team_error",CreateTeamRenderComplete:"render_create_team_complete",AddToThreadDialogRenderedCompleted:"add_to_thread_dialog_rendered_complete",GetTemplateDetailsGetDetails:"create_team_from_template_get_details",GetTemplateDetailsGetAppDefinitions:"create_team_from_template_get_app_definitions",UpdateManageTeamSettingsTagsError:"render_team_settings_tab_error",UpdateManageTeamSettingsTagsComplete:"render_team_settings_tab_complete",RenderChannelInvitationsTabRequestFinished:"render_channel_invitations_tab_request_done",UpdateTeamThreadMembershipError:"update_team_thread_membership_ux_error",UpdateTeamThreadMembershipComplete:"update_team_thread_membership_ux_complete",UpdatePrivateChannelThreadMembershipError:"update_private_channel_thread_membership_ux_error",UpdatePrivateChannelThreadMembershipComplete:"update_private_channel_thread_membership_ux_complete",UpdateSharedChannelThreadMembershipError:"update_shared_channel_thread_membership_ux_error",UpdateSharedChannelThreadMembershipComplete:"update_shared_channel_thread_membership_ux_complete",ChangeReactTeamProfilePictureError:"change_team_profile_picture_error",DeleteChannelDeleteLieSucceed:"delete_channel_lie_succeed",RenderTeamsGalleryPaneEmptyResults:"render_teams_gallery_pane_teams_empty_results",FetchPendingJoinRequestsCdProcessed:"fetch_pending_join_requests_cdl_processed",FetchSharedChannelsTenantMetadataError:"render_shared_channels_from_other_teams_table_error",FetchSharedChannelsTenantMetadataComplete:"render_shared_channels_from_other_teams_table_complete",GetArchivedChannelsSuccess:"get_deleted_channels_success",GetArchivedChannelsFail:"get_deleted_channels_fail",RenderPendingInvitationsTabRequestsFetched:"render_pending_invitation_tab_requests_fetched",RenderPendingInvitationsTabRequestsProcessed:"render_pending_invitation_tab_requests_processed",RenderPendingInvitationsTabRequestsFetchedError:"render_pending_invitation_tab_requests_fetched_error",RenderPendingInvitationsTabEmpty:"render_pending_invitation_tab_empty",CreateChannelLieSuccess:"create_channel_success",CreateChannelLieFailed:"create_channel_failed",SharedChannelInvitationDialogError:"shared_channel_invitation_error",SharedChannelInvitationDialogComplete:"shared_channel_invitation_complete",SharedChannelInvitationDialogPartialError:"shared_channel_invitation_partial_error",CloneTeamMutationUseMTService:"clone_team_mutation_mt",CloneTeamMutationUseTemplateService:"clone_team_mutation_ts",CloneTeamMutationInitialStatusCheck:"clone_team_mutation_status",CloneTeamMutationParseStatueResponse:"clone_team_mutation_parse_status",CloneTeamMutationPreprocessing:"clone_team_mutation_pre_processing",CheckWorkFlowStatusSubscriptionError:"check_workflow_status_subscription_error",CheckWorkFlowStatusSubscriptionComplete:"check_workflow_status_subscription_complete",RosterSyncFetchConversations:"roster_sync_fetch_conversation",GetTeamsInsiderStatusJobComplete:"get_teams_insider_status_job_started",TeamsInsiderOptInJobComplete:"teams_insider_opt_in_job_started",TeamsInsiderOptOutJobComplete:"teams_insider_opt_out_job_started",GetCrossTeamAnalyticsTASError:"get_cross_team_analytics_tas_error",GetCrossTeamAnalyticsTASLoaded:"get_cross_team_analytics_tas_loaded",CaptchaChallengeArkoseIframeWarning:"captcha_challenge_arkose_iframe_message_warning",MinimumVersionBannerShownDefinition:"minimum_banner_shown_definition",MinimumVersionBannerDismissedDefinition:"minimum_banner_dismissed_definition",MinimumVersionBannerClickedDefinition:"minimum_banner_clicked_definition",VersionChecked:"version_checked",ShowDesktopUpdateRequiredPage:"show_update_requried_page",UbarInitLayoutRendererReady:"init_layout_renderer_ready",UbarInitPriorityProvidersReady:"init_priority_providers_ready",UbarPhaseInitCompleted:"init_completed",UbarConfigLayoutDetected:"config_layout_detected",UbarConfigAdapterReady:"config_adapter_ready",UbarPhaseConfigCompleted:"config_completed",UbarQueueCriticalBuilt:"queue_critical_built",UbarQueueCriticalRendered:"queue_critical_rendered",UbarPhaseQueueCriticalCompleted:"queue_critical_completed",UbarQueueNonCriticalBuilt:"queue_non_critical_built",UbarQueueNonCriticalRendered:"queue_non_critical_rendered",UbarPhaseQueueNonCriticalCompleted:"queue_non_critical_completed",SlimcoreVDIModuleLoadSuccess:"slimcore_vdi_module_load_success",SlimcoreVDIModuleLoadFailed:"slimcore_vdi_module_load_failed",VDIBridgeStarted:"vdi_bridge_started",VDIBridgeConnected:"vdi_bridge_connected",VDIBridgeDownloadSlimcore:"vdi_bridge_download_slimcore",VDIBridgeDisconnected:"vdi_bridge_disconnected",VDIBridgeConnectedNoPlugin:"vdi_bridge_connected_no_plugin",SlimCoreVdiModulesLoadSuccess:"slimcore_vdi_modules_load_success",SlimCoreVdiModulesLoadFailure:"slimcore_vdi_modules_load_failure",PieVdiSlimCoreModuleGetFailed:"pie_vdi_slimcore_module_get_failed",SlimCorePieVdiStartOcclusionTracking:"slimcore_pie_vdi_start_occlusion_tracking",SlimCoreVDINotConnected:"slimcore_vdi_not_connected",SlimCorePieVdiStopOcclusionTracking:"slimcore_pie_vdi_stop_occlusion_tracking",SlimCorePieVdiStopWindowTracking:"slimcore_pie_vdi_stop_window_tracking",SlimCorePieVdiStopRemoveCompositor:"slimcore_pie_vdi_remove_compositor",SlimCorePieVdiStopCompositorTrackingWarning:"slimcore_pie_vdi_stop_compositor_tracking_warning",StopVideoElementTrackingError:"vdi_pluginless_stop_video_element_tracking_error",VdiPluginless_StopWindow:"vdi_pluginless_stop_window",VDIStatusIndicatorQueryError:"vdi_status_indicator_query_error",VDIStatusIndicatorNextModeDetermined:"vdi_status_indicator_next_mode_determined",VDIStatusIndicatorCurrentModeDetermined:"vdi_status_indicator_current_mode_determined",VDIStatusIndicatorShowInfoDialog:"vdi_status_indicator_show_info_dialog",VDIStatusIndicatorRestartMenuEnabled:"vdi_status_indicator_restart_menu_enabled",GlobalVdiModeStateSubscriptionCallbackVDIModeConfirmed:"global_vdi_mode_state_subscription_callback_vdi_mode_confirmed",VdiBridgeDownloadingSlimCore:"vdi_bridge_downloading_slimcore",VdiBridgeDownloadSlimCoreSuccess:"vdi_bridge_download_slimcore_success",VdiBridgeDynamicSlimCoreModuleLoadingStart:"vdi_bridge_dynamic_slimcore_module_loading_start",VdiBridgeDynamicSlimCoreModuleLoadingSuccess:"vdi_bridge_dynamic_slimcore_module_loading_success",VdiBridgeDynamicSlimCoreModuleLoadingFailure:"vdi_bridge_dynamic_slimcore_module_loading_failure",VdiBridgeDownloadSlimCoreFailure:"vdi_bridge_download_slimcore_failure",RemoteSlimCoreActive:"remote_slimcore_active",ConnectReloadCallingStackFailure:"reload_calling_stack_failure",VdiOverrideModeChangeHistoryBySession:"vdi_override_mode_changes_history_by_session",SetVDIOverrideModeDequeued:"set_vid_override_mode_dequeued",DisconnectReloadCallingStackFailure:"reload_calling_stack_failure",DisposeRemoteCallingStackSlimCoreNotReloadable:"dispose_remote_calling_stack_slimcore_not_reloadable",DisposeRemoteCallingStackUnloadSlimCore:"dispose_remote_calling_stack_unload_slimcore",DisposeRemoteCallingStackUnloadSlimCoreSuccess:"dispose_remote_calling_stack_unload_slimcore_success",DisposeRemoteCallingStackUnloadSlimCoreFailure:"dispose_remote_calling_stack_unload_slimcore_failure",DisposeRemoteCallingStackLoadSlimCore:"dispose_remote_calling_stack_load_slimcore",DisposeRemoteCallingStackLoadSlimCoreSuccess:"dispose_remote_calling_stack_load_slimcore_success",DisposeRemoteCallingStackLoadSlimCoreFailure:"dispose_remote_calling_stack_load_slimcore_failure",DisposeCallingStackLocalSlimCoreMissing:"dispose_calling_stack_local_slimcore_missing",DisposeCallingStackLocalSlimCoreGlobalsReset:"dispose_calling_stack_local_slimcore_globals_reset",OnSessionChange:"vdi_bridge_on_session_change",WaitforDisconnectBeforeSetConsoleSession:"vdi_bridge_wait_for_disconnect_on_session_change",SessionChangeHandleConsoleSessionFailure:"vdi_brdige_handle_session_change_failure",SlimcoreVdiCallingStackNMSCapabilitiesReinit:"slimcore_vdi_calling_stack_nms_capabilities_reinit",SetConsoleSession:"set_ConsoleSession",DeferOnSlimCoreVdiConnectStart:"defer_on_slimcore_vdi_connect_start",DeferOnSlimCoreVdiConnectInProgress:"defer_on_slimcore_vdi_connect_in_progress",DeferOnSlimCoreVdiConnectEnd:"defer_on_slimcore_vdi_connect_end",DeferOnSlimCoreVdiConnectTimedOut:"defer_on_slimcore_vdi_connect_timed_out",UploadImageToAMSSuccess:"upload_image_to_ams_success",ConstructAMSUrlSuccess:"construct_ams_url_success",ScreenRecorderUnmounted:"screen_recorder_dialog_unmounted",MessageLieUpdateFailed:"msg_lie_update_failed",VideoContainerLazyLoaded:"video_container_lazy_loaded ",OnePlayerLoaderBundleFetchedFromCDN:"one_player_loader_bundle_fetched_from_cdn",OnePlayerFactoryFetchedFromCDN:"one_player_factory_fetched_from_cdn",SegmentPrefetchingInitiated:"segment_prefetch_initiated",SegmentABRPrefetchingInitiated:"segment_abr_prefetch_initiated",VideoMessagesGetCaptionDefaultOn:"video_message_get_caption_setting",VideoMessagesSetCaptionDefaultOn:"video_message_set_caption_setting",VideoAttachmentLoaded:"video_attachment_loaded",VideoAttachmentFetchEmbedUrl:"video_attachment_fetch_embedUrl",NewMeetingLinkReturned:"new_meeting_link_returned_from_indexed_db",CopilotImageFetchODSPNotApplicable:"copilot_image_fetch_odsp_not_applicable",CopilotImageFetchODSPQueried:"copilot_image_fetch_odsp_queried",CopilotImageFetchODSPResponseReceived:"copilot_image_fetch_odsp_response_received",PoliciesPushEffectivenessOnInterval:"on_interval",PoliciesServiceGetPoliciesRetryFailedNamespaces:"retry_failed_namespaces",GetDiagnosticsLogsFromCdlWorkerManager:"get_cdl_diagnostics_Logs",GetSyncEngineLogsFromCdlWorkerManager:"get_sync_engine_Logs",SwitchServiceSetAPIOverrides:"switch_service_set_api_overrides",WhiteboardUrlReceived:"whiteboard_url_change_received",WhiteboardUrlSending:"whiteboard_url_change_sending",LoadExtensibleAppRetryAppDefinitionForAttendee:"LoadExtensibleApp_Retry_App_definition_for_attendee",LoadExtensibleAppRetryAppFetch:"LoadExtensibleApp_Retry_App_Fetch",LoadExtensibleOfficeAppDynamicPermissionsReceivedAsNotificationForAttendee:"LoadExtensibleOfficeApp_DynamicPermissions_ReceivedAsNotification_for_attendee",LoadExtensibleOfficeAppDynamicPermissionsReceivedInSharingSessionForAttendee:"LoadExtensibleOfficeApp_DynamicPermissions_ReceivedInSharingSession_for_attendee",LoadExtensibleOfficeAppDynamicPermissionsNotReceivedForAttendee:"LoadExtensibleOfficeApp_DynamicPermissions_Not_Received_for_attendee"},o)}}]);