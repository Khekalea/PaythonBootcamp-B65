"use strict";(this.webpackChunk_msteams_light_meetings=this.webpackChunk_msteams_light_meetings||[]).push([["3944"],{416241:function(e,t,r){if(r.d(t,{BZ:()=>b,VT:()=>S,db:()=>m,kh:()=>_,l_:()=>g,lj:()=>v,mM:()=>C,o8:()=>y,zF:()=>f}),56909==r.j)var a=r(806674);if(56909==r.j)var o=r(757568);if(56909==r.j)var n=r(132667);if(56909==r.j)var i=r(414501);if(56909==r.j)var s=r(524434);if(56909==r.j)var l=r(739965);if(56909==r.j)var d=r(668400);if(56909==r.j)var c=r(751843);if(56909==r.j)var u=r(619305);if(56909==r.j)var p=r(331280);if(56909==r.j)var h=r(433139);let f=(e,t,r)=>{let o;if(t&&!r){let r=i.Jt.getAllOfType("User").filter(e=>e.profile.tid===t&&e.type!==a.Ch.Anonymous);if(r.length>1){let t=i.Jt.getValue(s.Jl.globalUser);if(o=!!e&&r.find(t=>t.id===e)||r.find(e=>e.id===t.id))return o;throw{message:"Multiple users found in cache with same tenantId",errorCode:l.SM.MultipleUsersPresentWithSpecifiedIdentifier}}return r[0]}if(e){let t=i.Jt.getAllOfType("User");o=t?.filter(t=>t.id===e)[0]}else o=i.Jt.getValue(s.Jl.globalUser);return o},m=e=>e&&i.Jt.getAllOfType("User").filter(t=>t.id!==e&&t.homeAccountId===e)||[],g=(e,t)=>{if(e&&t)return m(e).find(e=>e.profile.tid===t)},y=(e,t)=>!!e&&!!t&&e.some(e=>e.cloud!==t&&!e.id.startsWith("dummy-user")),C=async(e,t,r,a)=>{let n,l;r?.addScenarioMark("auth_get_encryption_key_start");let d=i.Jt.getValue(s.Jl.encryptionKey);if("object"==typeof d)return r?.addScenarioMark("auth_get_encryption_key_stop"),d;r?.addScenarioMark("auth_get_exported_key_start");try{if(a&&(0,p.n)(e)){let e=await t.loadModule(o.nM.Auth);n=(await e.acquireEncryptionKey({correlationId:r?.correlation.id||(0,c.pW)()})).result}else{let e=i.Jt.getValue(s.Jl.exportedEncryptionKey);n=e?.exportedKey}}catch(e){return r?.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Acquiring the exported key failed."},"failure"),r?.addScenarioMark("auth_get_encryption_key_stop"),null}if(!n){r?.addScenarioMark("auth_get_exported_key_stop",{reason:"No exported encryption key."}),r?.addScenarioMark("auth_get_encryption_key_stop");return}try{l=await e.crypto.subtle.importKey("raw",(0,u.k)(n),{name:"AES-CBC"},!0,["encrypt","decrypt"]),i.Jt.put(s.Jl.encryptionKey,l),r?.addScenarioMark("auth_get_exported_key_stop")}catch(e){r?.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Importing the key failed"},"failure"),l=null}return r?.addScenarioMark("auth_get_encryption_key_stop"),l},_=(e,t,r)=>{let o=a.JE[n.j[e]],l=f(t,void 0);if(!l)return void d.q.warn(`[AuthState] Account ${t} not found when attempting to write userAuthState`);let u=(0,h.Xx)(l),p=(0,c.u4)(r?.reason)||o;i.Jt.put((0,s.VF)(u).userAuthState,{state:o,reason:p,customError:r?{errorCode:r.errorCode||r.code,message:r.message,isExpected:r.isExpected,context:r.context,subContext:r.subContext,correlationId:r.correlationId,authSubErrorCode:r.authSubErrorCode}:null}),r?d.q.warn(`[AuthState] UserAuthState updated - ${t} : ${o} errorCode: ${r.errorCode} isExpected: ${r.isExpected} correlationId: ${r.correlationId}`):d.q.log(`[AuthState] UserAuthState updated - ${t} : ${o}`)},v=()=>i.Jt.getValue(s.Jl.logoutState),b=()=>i.Jt.getValue(s.Jl.previousSignInProgressState),S=()=>i.Jt.del(s.Jl.previousSignInProgressState)},414501:function(e,t,r){let a;r.d(t,{Jt:()=>a,ky:()=>y});var o=r(739965);if(56909==r.j)var n=r(668400);if(56909==r.j)var i=r(751843);if(56909==r.j)var s=r(433139);if(56909==r.j)var l=r(524434);let d=[o.ZU,o.Fz],c=56909==r.j?{KeyVersion:"v1",UseAccountIdKey:!0}:null,u=e=>c.UseAccountIdKey?e?.id||"":e?JSON.stringify({tenantId:e.tenantId,oid:e.oid,accountType:e.accountType,userName:e.userName}):JSON.stringify(void 0),p=(e,t,r)=>`tmp.auth.${c.KeyVersion}.${e}.${t}.${r}`,h=e=>{let{typeName:t,user:r}=e;return{user:e.user?u(r):"GLOBAL",typeName:t,key:e.key?e.key.toUpperCase():t}},f=(e,t)=>({storageKey:c.UseAccountIdKey?p(t.user,t.typeName,t.key):`$[${t.user}][${t.typeName}][${t.key}]`,loggingKey:p(e.user?`${e.user.id}`:t.user,t.typeName,t.key)});class m{constructor(e,t){this._coreSettings=t,this._expireOffsetSeconds=o.rF.SECONDS_FIVE_MINUTES,this._expireOffsetSecondsMin=o.rF.SECONDS_PER_MINUTE,this._searchParamsQsp="",this.internalCache={GLOBAL:{User:{},Token:{},MsalAccount:{}}},this._initializeCacheForCacheItem=(e,t)=>{void 0===this.internalCache[t]?(this.internalCache[t]={},this.internalCache[t][e]={}):void 0===this.internalCache[t][e]&&(this.internalCache[t][e]={})},this._addToExternalCache=async(e,t)=>{if(!this._coreSettings?.("disableSkipOpaqueDataToExternalCache")&&e.user?.id?.startsWith("opaque-"))return;let r=t;t.item.encryptedToken&&(r=this._deepCopyEncryptedToken(t));let a=h(e),{storageKey:o,loggingKey:s}=f(e,a);try{this._storage.setItem(o,(0,i.u4)(r))}catch(e){n.q.error(`error in putting key [${s}] in storage, error - [${(0,i.VK)(e)}]`)}},this._deepCopyEncryptedToken=e=>{let t={...e.item};return t.skypeToken?t.skypeToken="":t.token="",{item:t,hitCount:e.hitCount,shouldRefresh:e.shouldRefresh,refreshAfter:e.refreshAfter}},this._deleteFromExternalCache=async e=>{let t=h(e),{storageKey:r,loggingKey:a}=f(e,t);try{this._storage.removeItem(r)}catch(e){n.q.error(`error in deleting key [${a}] in storage, error - [${(0,i.VK)(e)}]`)}},this._flushExternalCache=async e=>{try{let t={};Object.keys(this._storage).forEach(r=>{d.forEach(e=>{if(-1!==r.indexOf(e)){let e=this._storage.getItem(r);e&&(t[r]=e)}}),(!e&&0===r.indexOf("$[")||!e&&0===r.indexOf("tmp.auth")||e&&-1!==r.indexOf("tmp.auth")&&(-1!==r.indexOf(e.oid)||e.id&&-1!==r.indexOf(e.id)))&&this._storage.removeItem(r)}),Object.keys(t).forEach(e=>{this._storage.setItem(e,t[e])})}catch(e){n.q.error(`error in clearing storage, error - [${(0,i.VK)(e)}]`)}},this._isGlobalUser=e=>{let t=this.internalCache.GLOBAL?.User?.User;return t||(t=this.get(l.Jl.globalUser)),t&&(0,s.FG)((0,s.Xx)(t.item),e)},this._putGlobalUserInCache=(e,t)=>{if(this._shouldSkipUpdatingGlobalUser(e,t))return;let r=e.user?"GLOBAL":u((0,s.Xx)(t.item));if(this._initializeCacheForCacheItem("User",r),this.internalCache[r].User.User=t,this._shouldSkipUpdatingGlobalUserToExternalCache(r))return;let a=c.UseAccountIdKey?p(r,"User","User"):`$[${r}][User][User]`;this._storage.setItem(a,JSON.stringify(t))},this._shouldSkipUpdatingGlobalUserToExternalCache=e=>!!(this._coreSettings?.("enableStopStorageToExternalCache")&&"GLOBAL"===e&&(0,s.gO)(this._searchParamsQsp)),this._shouldSkipUpdatingGlobalUser=(e,t)=>{if(this.getValue(l.Jl.globalUser)&&e.user&&!this._isGlobalUser(e.user))return!0;let r=t.item,a=this._coreSettings?.("buildCloud");return!this._coreSettings?.("disableSetOnlyCurrentCloudGlobalUser")&&!!r&&!!a&&r.cloud!==a},this._validateValue=(e,t)=>{if("Token"===e.typeName&&("object"!=typeof t||!t.token||!t.expires))throw Error("Invalid value for Token.");if("Discover"===e.typeName&&e.key===o.rz&&("object"!=typeof t||!t.skypeToken||!t.expiration))throw Error("Invalid value for Skype token.");if("User"!==e.typeName)return;let r=this._coreSettings?.("disableSkipOpaqueDataToExternalCache");if((!t.userName||!t.type||!t.role||!t.profile||void 0===t.isAuthenticated)&&(r||!e.user?.id?.startsWith("opaque-")))throw Error(`Invalid value for user. userName exists: [${!!t.userName}], type: [${t.type}], role: [${t.role}], profile exists: [${!!t.profile}],isAuthenticated: [${t.isAuthenticated}]`);let a=this.internalCache.GLOBAL?.User?.User,n=(0,s.Xx)(t);if(a&&!e.user&&!this._isGlobalUser(n))throw Error("there is already global user in auth cache")},this._storage=e.localStorage,this._searchParamsQsp=e?.location?.search,n.q.info("auth_cache initialized")}updateSetting(e,t){n.q.log(`Updating authCache setting ${e} from ${c[e]} to ${t}.`),"KeyVersion"===e&&(t!==c.KeyVersion&&(this.internalCache={}),c.KeyVersion=t),"UseAccountIdKey"===e&&(t!==c.UseAccountIdKey&&(this.internalCache={}),c.UseAccountIdKey=t)}setExpiryOffset(e,t){e&&(this._expireOffsetSeconds=e),t&&(this._expireOffsetSecondsMin=t)}put(e,t){g(e),this._validateValue(e,t);let{typeName:r,key:a,user:o}=h(e),n="Token"===r||"Discover"===r&&"SKYPE-TOKEN"===a;n&&(t.fromCache=!0);let i=this.internalCache[o]?.[r]?.[a];return i?(i.hitCount=0,i.item=t):i={item:t,shouldRefresh:!1,hitCount:0},n&&(i.refreshAfter=function(e,t,r){let a=_(e,t);if(a&&r)return function(e,t,r=.67){let a=Math.round((t-e)*r);return Math.min(e+a,t-v)}(C(),a,r)}(r,t,this.refreshPercents)),"User"===r&&this._putGlobalUserInCache(e,i),this._initializeCacheForCacheItem(r,o),this.internalCache[o][r][a]=i,this._addToExternalCache(e,i),!0}updateGlobalUser(e){let t="GLOBAL",r={item:e,shouldRefresh:!1,hitCount:0};return this._initializeCacheForCacheItem("User",t),this.internalCache[t].User.User=r,!!this._shouldSkipUpdatingGlobalUserToExternalCache(t)||(this._addToExternalCache(l.Jl.globalUser,r),!0)}get(e){g(e);let t=h(e),{storageKey:r,loggingKey:a}=f(e,t),{typeName:o,key:s,user:l}=t,d=this.internalCache[l]?.[o]?.[s],c=!!d;if(!d)try{let e=this._storage?.getItem(r);if("RealmMap"===o&&e){d=JSON.parse(e);let t=Object.fromEntries(d.item);d.item=new Map(Object.entries(t))}else e&&(d=JSON.parse(e))}catch(e){n.q.error(`value for key [${a}] throw error. ${(0,i.VK)(e)}`)}if(!d)return void n.q.info(`value for key [${a}] not found in memory or storage`);if(this._initializeCacheForCacheItem(o,l),this.internalCache[l][o][s]=d,("Token"===o||"Discover"===o&&"SKYPE-TOKEN"===s)&&(d.shouldRefresh=this._shouldRefresh(d,o),d.hitCount++,this.internalCache[l][o][s]=d,this._addToExternalCache(e,d)),void 0===d.shouldRefresh){n.q.info(`cacheItem '[${r}]' need to refresh`),this.del(e);return}return n.q.info(`returning cacheItem '[${r}]' from cache${d.shouldRefresh?", will be refreshed in background":""}. In memory:${+c} found: [${+!!d}]`),d}getValue(e){let t=this.get(e);return t?this._value(t):void 0}getAllOfType(e){let t=[],r=[];return Object.keys(this.internalCache).forEach(a=>{"GLOBAL"!==a&&Object.keys(this.internalCache[a][e]||{}).forEach(o=>{let{storageKey:n}=f({},{user:a,typeName:e,key:o});r.push(n),t.push(this.internalCache[a][e][o].item)})}),Object.keys(this._storage).forEach(a=>{if(-1===r.indexOf(a)&&-1===a.indexOf(".GLOBAL.")&&-1!==a.indexOf(`.${e}.`))try{let e=this._storage.getItem(a);e&&t.push(JSON.parse(e)?.item)}catch(e){n.q.error(`value for key [${a}] throw error. ${(0,i.VK)(e)}`)}}),t}del(e){if(!e)return n.q.error(`Invalid cacheKey: ${e}`),!1;if(!e.typeName)return n.q.error(`Invalid cacheKey type: ${e.typeName}`),!1;if("User"===e.typeName)return this.flush(e.user),!0;let t=h(e),{loggingKey:r}=f(e,t),{typeName:a,key:o,user:i}=t;this.internalCache[i]?.[a]?.[o]&&n.q.info(`Value of key: [${r}] exists before deletion]`);let s=this.internalCache[i]?.[a]?.[o]&&delete this.internalCache[i][a][o],l=this._deleteFromExternalCache(e);return n.q.info(`deleted from local auth-cache. key: [${r}], done - local: [${s}], storage: [${l}]`),s}delTokensWithError(e,t){let{user:r,typeName:a}=h({user:e,typeName:"Token"});if(this.internalCache[r]?.[a]){let o=this.internalCache[r][a];for(let r in o)o[r]?.item?.error?.errorCode===t&&this.del({user:e,typeName:a,key:r})}}deleteType(e,t){let{user:r,typeName:a}=h({user:e,typeName:t});if(this.internalCache[r]?.[a]){let t;if("Token"===a)t=this.internalCache[r][a];else{if("Discover"!==a)return;t=this.internalCache[r][a]}for(let r in t)r&&this.del({user:e,typeName:a,key:r})}}flush(e){if(!e){n.q.info("no user provided, flushing global user from cache");let t=this.internalCache.GLOBAL?.User?.User;if(!t)return;e=(0,s.Xx)(t.item)}n.q.info(`flushing user ${e.id} data from cache`);let t=u(e);this.internalCache[t]={},this._flushExternalCache(e),this._isGlobalUser(e)&&(this.internalCache.GLOBAL={},this._storage.removeItem("$[GLOBAL][User][User]"),this._storage.removeItem("tmp.auth.v1.GLOBAL.User.User")),n.q.info("flushing completed")}_value(e){return e.item}_shouldRefresh(e,t){if(!["Discover","Token"].includes(t)||!e.item)return;let r=e.item,a=_(t,r);if(e.refreshAfter&&this.refreshPercents)return function(e,t,r,a=o.rF.SECONDS_PER_MINUTE){return!r||r<e+a?void 0:t<e}(C(),e.refreshAfter,a,this._expireOffsetSecondsMin);if(r&&a){let e=a-this._expireOffsetSeconds,t=a-this._expireOffsetSecondsMin,r=C();if(r<=t)return r>=e}}get refreshPercents(){return Number(this._coreSettings?.("proactiveTokenRefreshPercents")??0)}}let g=e=>{if(-1!==["Token","Discover"].indexOf(e.typeName)&&(!e.key||!e.user))throw Error(`key/user cannot be empty for type [${e.typeName}]: key: ${e.key}, user: ${+!!e.user}`)},y=(e,t)=>(a||(a=new m(e,t),e.localStorage?.getItem("localDebug")&&e.loader&&(e.loader.authCache=a)),a);function C(){return Math.round(Date.now()/o.rF.MILLI_PER_SECOND)}function _(e,t){return"Discover"===e?Math.round(t?.expiration/o.rF.MILLI_PER_SECOND):"Token"===e?t?.expires:void 0}let v=o.rF.SECONDS_PER_MINUTE*o.uI.TEN},524434:function(e,t,r){if(r.d(t,{Jl:()=>i,VF:()=>o,px:()=>n}),56909==r.j)var a=r(739965);let o=e=>({userDetail:{user:e,typeName:"Discover",key:"discover-user-details"},regionGtm:{user:e,typeName:"Discover",key:"discover-region-gtm"},skypeToken:{user:e,typeName:"Discover",key:"skype-token"},user:{user:e,typeName:"User"},tenants:{user:e,typeName:"Tenants"},loginValidation:{user:e,typeName:"LoginValidation"},userAuthState:{user:e,typeName:"UserAuthState"},meetingDetails:{user:e,typeName:"MeetingDetails"},telemetryInfo:{user:e,typeName:"TelemetryInfo"},realmMap:{user:e,typeName:"RealmMap"}}),n=(e,t,r)=>({user:e,typeName:"Token",key:`${t}${r?`-external-${r}`:""}`}),i=56909==r.j?{addAccountsSuggestionCoachMarkTimeStamp:{typeName:"addAccountsSuggestionCoachMarkTimeStamp"},logoutState:{typeName:a.ZU},authSessionId:{typeName:a.Fz},globalUser:{typeName:"User"},primaryUserId:{typeName:"PrimaryUserId"},encryptionKey:{typeName:"EncryptionKey"},deviceOsUpdateState:{typeName:"DeviceOsUpdateState"},exportedEncryptionKey:{typeName:"ExportedEncryptionKey"},initializationVector:{typeName:"InitializationVector"},previousSignInProgressState:{typeName:"PreviousSignInProgressState"},eOtpLoginUser:{typeName:"EotpLoginUser"},ropcLogoutState:{typeName:"RopcLogoutState"}}:null},385339:function(e,t,r){if(r.d(t,{AO:()=>R,Hl:()=>E,IS:()=>$,Jx:()=>K,Lh:()=>b,P9:()=>I,S3:()=>Q,Tq:()=>ea,U2:()=>N,Up:()=>A,YT:()=>O,aC:()=>ee,bU:()=>U,b_:()=>B,dA:()=>k,ds:()=>et,ge:()=>L,gz:()=>q,h3:()=>J,j7:()=>F,mb:()=>z,o9:()=>W,qn:()=>X,qz:()=>er,rP:()=>w,rt:()=>Y,wt:()=>Z,xX:()=>M,yD:()=>H,zp:()=>j}),56909==r.j)var a=r(739965);if(56909==r.j)var o=r(757568);if(56909==r.j)var n=r(806674);if(56909==r.j)var i=r(875342);if(56909==r.j)var s=r(153439);if(56909==r.j)var l=r(771139);if(56909==r.j)var d=r(414501);if(56909==r.j)var c=r(524434);if(56909==r.j)var u=r(668400);if(56909==r.j)var p=r(433139);if(56909==r.j)var h=r(93965);if(56909==r.j)var f=r(743918);if(56909==r.j)var m=r(573440);if(56909==r.j)var g=r(974377);if(56909==r.j)var y=r(416241);if(56909==r.j)var C=r(619305);if(56909==r.j)var _=r(985213);if(56909==r.j)var v=r(767892);let b=(e,t)=>{let{id:r,type:a,role:o,profile:n,subType:i,cloud:s,homeAccountId:l}=e,u=S(e),h=s!==u.cloud,f=d.Jt.getValue((0,c.VF)((0,p.Xx)(e)).telemetryInfo);t.setUserToTelemetryContext({id:r,type:a,role:o,oid:n?.oid,tid:n?.tid,subType:i,isCrossCloudUser:!!f?.isCrossCloudUser,isExternal:(0,p.b9)(r,l),userCloud:u.cloud,homeAccountId:h?u.cloud:u?.id,homeTenantId:h?u.cloud:u?.profile.tid})},S=e=>e.homeAccountId&&e.homeAccountId!==e.id?d.Jt.getAllOfType("User").find(t=>t.id===e.homeAccountId)??e:e,M=async(e,t,r,a,o)=>{await E(t,a,o,r,!0),u.q.log(`[core-auth-base][login][${e.source}][${e.id}]] provider set cookie succesful.`)},E=async(e,t,r,a,o)=>{let n=d.Jt.getValue(c.Jl.primaryUserId),i=n&&(0,y.zF)(n,void 0);if(i)return o&&T(i,e,t,r).then(()=>void 0),i;let s=r?.("buildCloud")||"";return(i=a&&(0,h.Kf)(a)&&!(0,h.oO)(a)?a:(0,h.TT)(s))&&(d.Jt.put(c.Jl.primaryUserId,i.id),e.addScenarioMark("auth-web-set-primary-user",{primaryUserId:i.id})),await T(i,e,t,r),i},A=async(e,t)=>{try{e.addScenarioMark("check_accounts_sync_start"),e.addScenarioMark("check_accounts_load_module");let r=await t.loadModule(o.nM.Auth),a=await r.getActiveUsers({correlationId:e.correlation.id});if(!a||a.result.length<1)return void e.addEventData(["totalAccounts:0"]);let i=a.result,s=i.filter(function(e,t,r){let a=(0,p.nL)(e);return r.map(e=>(0,p.nL)(e)).indexOf(a)===t});e.addEventData([`uniqueClouds:${s?.length}`,`totalAccounts:${i?.length}`]);let l=d.Jt.getAllOfType("User"),c=l?.filter(e=>!!e.profile.isHomeAccount&&e.type!==n.Ch.Anonymous),u=await t.loadModule(o.nM.Core);s.forEach(async t=>{if(!c.find(e=>e.id===t.profile.id)){let r=(0,p.nL)(t);e.addEventData([`missingRenderer:${r}`]),await u.launchCloud({cloudType:(0,p.TP)(r),deepLink:"core",correlation:e.correlation})}}),e.addScenarioMark("check_accounts_sync_stop")}catch(t){e.addScenarioMark("check_accounts_sync_error",t)}},k=e=>{let{correlation:t,accountId:r}=e,[a,o]=(0,m.OU)({options:e,subContext:"initializeAccounts",scenarioName:i.RG.AuthWebGetTenantData,source:"core-auth-base"}),n=(0,y.zF)(r,void 0),s=(0,h.dt)(r);if(!n||!s){let e=W(n?"NoHomeUserAgaintAccountId":"NoTenantFoundAgaintAccountId",t.id,!0);throw o({error:e}),e}let l=d.Jt.getValue((0,c.VF)((0,p.Xx)(s)).tenants),u=l?.filter(e=>e.tenantId===n.profile.tid)?.[0];return a.addScenarioMark(i.ck.AuthWebGetTenantDataAuthComplete),o(),u},T=async(e,t,r,a)=>{if(!a?.("enableTmaPrimaryUser"))return Promise.resolve();try{t.addScenarioMark("auth-web-primary-user-update-start"),await r.updatePrimaryUser?.({correlation:t.correlation,id:e?.id,tenantId:e?.profile.tid,upn:e?.userName}),t.addScenarioMark("auth-web-primary-user-update-stop")}catch(e){t.addScenarioMark("auth-web-primary-user-update-stop",{error:e})}},I=(e,t,r)=>{let a=r?.("enableMTMAAuthDataInMaglevStorage")||r?.("enableMTMAAuthDataInMaglevStorageViaHost"),o=r?.("buildCloud");return!!t&&(!!e.prioritizeUserContextId&&t.id===e.accountId||!a||!o||o===t.cloud)},U=async(e,t,r,a,o,n,i,p,h,f,m)=>("dummy-token"===r.token||await x(r,i,p,h,m),u.q.debug("[core-auth-base][_setTokenInCache] called."),d.Jt.put((0,c.px)(e,t,f),r),o&&n(s.n.TokenUpdate,a,{typeName:l.O_.MT,value:r}),r),x=async(e,t,r,o,n)=>{if(!n?.("enableTokenEncryption"))return e;r.addScenarioMark("auth_web_encrypt_token_start");let i=await (0,y.mM)(t,o,r,!!n?.("enableEncryptionKeyMaglev"));if(!i)return r.addEventData(["tokenEncryption:missingEncryptionKey"]),r.addScenarioMark("auth_web_encrypt_token_stop",{reason:"No encryption key"}),e;try{let o=t.crypto.getRandomValues(new Uint8Array(a.uI.SIXTEEN)),n=new TextEncoder().encode(e.token),s=await t.crypto.subtle.encrypt({name:"AES-CBC",iv:o},i,n);e.encryptedToken=(0,C.z)(s),e.iv=(0,C.z)(o),r.addEventData(["tokenEncryption:success"]),r.addScenarioMark("auth_web_encrypt_token_stop")}catch(e){r.addEventData(["tokenEncryption:error",`errorMessage:${e?.message}`]),r.addScenarioMark("auth_web_encrypt_token_stop",{error:e,reason:e?.message},"failure")}return e},w=async(e,t,r,a,o)=>{if(!o?.("enableTokenEncryption")||!e.encryptedToken||e.token)return e;r.addScenarioMark("auth_web_decrypt_token_start");let n=await (0,y.mM)(t,a,r,!!o?.("enableEncryptionKeyMaglev"));if(!n)return r.addEventData(["tokenDecryption:MissingEncryptionKey"]),r.addScenarioMark("auth_web_decrypt_token_stop",{reason:"Missing encryption key for decryption"}),e;let i=e.iv;if(i||(i=d.Jt.getValue(c.Jl.initializationVector),r.addEventData([`tokenDecryption-cachedIV:${+!!i}`])),!i)return r.addEventData(["tokenDecryption:MissingInitializationVector"]),r.addScenarioMark("auth_web_decrypt_token_stop",{reason:"Missing IV for decryption"},"failure"),e;try{let a=(0,C.k)(i),o=(0,C.k)(e.encryptedToken),s=await t.crypto.subtle.decrypt({name:"AES-CBC",iv:a},n,o);e.token=new TextDecoder().decode(s),r.addEventData(["tokenDecryption:success"]),r.addScenarioMark("auth_web_decrypt_token_stop")}catch(e){r.addEventData(["tokenDecryption:failure",`errorMessage:${e?.message}`]),r.addScenarioMark("auth_web_decrypt_token_stop",{error:e,reason:e?.message},"failure")}return e},$=e=>d.Jt.getAllOfType("User").filter(t=>t.id.replace(/-/g,"").includes(e)&&t.type===n.Ch.Msa)[0],O=async(e,t,r)=>{if(e.type===n.Ch.Msa){let o=await (0,p.qL)(e,t,r);throw o.errorCode=a.SM.MsaUserNotAllowed,o}},N=(e,t,r)=>(t.homeAccountId===t.id||!!(0,p.tN)(t))&&(e.errorCode===a.SM.UserNotLicensed?(D(e,t),!0):!(e.errorCode!==a.SM.CloudMismatch||r?.("disableSkipAccountDeletionOnCloudMistachError"))||e.errorCode===a.SM.InteractionRequired&&r?.("enableRopcFlow")===!0||t.type===n.Ch.Msa),D=(e,t)=>{d.Jt.put((0,c.VF)((0,p.Xx)(t)).userAuthState,{state:n.JE.LicenseError,customError:{authSubErrorCode:e.authSubErrorCode,errorCode:e.errorCode,isExpected:!0,message:e.message,context:e.context,subContext:e.subContext,correlationId:e.correlationId,errorMetadata:{name:t.profile.name,email:t.userName,accountId:t.id,userLoggedIn:!0}},reason:"LicenseError"})},L=async(e,t,r,o,i,s,l)=>{if(!(l?.("enableMTMAAuthDataInMaglevStorage")||l?.("enableMTMAAuthDataInMaglevStorageViaHost"))||l?.("disableDummyUserCreationForCrossCloudUser")||!e||t?.errorCode===a.SM.CloudMismatch||e.role!==n.w4.Member&&e.role!==n.w4.Guest)return;let h=d.Jt.getValue((0,c.VF)((0,p.Xx)(e)).telemetryInfo);if(h?.isCrossCloudUser||G(e,l)){u.q.log("[core-auth-base][checkIfDummyUserCreationRequired] called as it is cross cloud user");let l=n.JE.LoginError;t?.errorCode===a.SM.UserNotLicensed&&(l=n.JE.LicenseError);let h={state:l,reason:"Cross cloud User login fails",customError:{errorCode:t.errorCode||t.code||a.SM.UserNotAuthenticated,message:t.message,isExpected:!!t.isExpected,context:t.context,subContext:t.subContext,correlationId:t.correlationId},visibilityState:n.Bl.Shown},f=(0,p.x7)(e),m=(0,p.Xx)(f);d.Jt.put((0,c.VF)(m).user,f),d.Jt.put((0,c.VF)(m).userAuthState,h),await r(f,s),await o(f.id,h,s),u.q.log("[core-auth-base][checkIfDummyUserCreationRequired] dummy user updated"),d.Jt.flush((0,p.Xx)(e)),await i(e.id,s),u.q.log("[core-auth-base][checkIfDummyUserCreationRequired] active user deleted")}},R=e=>{let t=d.Jt.getAllOfType("User");t&&e&&0===t.filter(t=>t.cloud===e&&t.role!==n.w4.Anonymous).length&&t.forEach(e=>d.Jt.flush((0,p.Xx)(e)))},G=(e,t)=>{if(t?.("disableCrossCloudUserCheck")||!e||e.profile.isHomeAccount||e.profile.tid===a._6.services)return!1;let r=d.Jt.getAllOfType("User").find(t=>t.id===e.homeAccountId);return!r||r.cloud!==e.cloud},j=async(e,t,r,o,i)=>{let s=i?.("enableTenantPickerForTFL"),l=i?.("buildCloud");if(!s||t.errorCode!==a.SM.CloudMismatch||e?.cloud!==n.G7.prod||l!==n.G7.life)return;let u=d.Jt.getAllOfType("User").filter(e=>e.id===e.homeAccountId);if(!u||u.length<1||u[0].cloud!==n.G7.life)return!1;let h=u[0],f=d.Jt.getValue((0,c.VF)((0,p.Xx)(h)).tenants);f&&!(f.length<1)&&r(h.id,f,o)},P=async(e,t,r,o,n,i,s,l,d,c,p,h)=>{try{if(!c){u.q.info(`[core-auth-base][acquiretoken][${o}] cache empty token for interaction required error`);let e=a.rF.ONE_HOUR*a.uI.SIXTEEN;c={token:"dummy-token",expires:Math.floor((Date.now()+e)/a.rF.MILLI_PER_SECOND),fromCache:!0}}c.error=e,await U(t,r,c,o,n,i,s,l,d,p,h)}catch(e){u.q.error(`ERROR CACHING ISSUE. ${e.message}, ${e.errorCode}`)}},q=(e,t)=>{"none"!==t&&(u.q.info("[core-auth-base][acquireToken] prompt none interacton req. clearing cache."),d.Jt.delTokensWithError(e,"InteractionRequired"))},F=(e,t,r)=>{if(t.includes(e?.errorCode)){let t=(0,v.b)(e.message);return t&&"cannot parse"!==t||r?.("disableFixEmptyInteractionErrorMessage")||(t=e.message),(0,f.Tr)({...e,message:t,errorCode:"InteractionRequired",isExpected:!0})}return e},J=(e,t)=>{let{correlation:r,allowAnon:a}=t;if(e?.role===n.w4.Anonymous&&!1===a)throw V(r.id);let o=e&&(0,h.K_)(e);if(!o||o.state===n.JE.Up||!0!==a)return e},V=e=>{let t=(0,f.Tr)({context:"core-auth-base",subContext:"getUser",correlationId:e,errorCode:a.SM.ErrorGetUserWhenAnonNotSupported,message:"Cannot sign in due to existing anon meeting"});return t.code=t.errorCode,t},K=(e,t)=>{let r=`[core-auth-base][${e}][${t}] User missing cannot perform action.`,o=(0,f.Tr)({context:"core-auth-base",subContext:e,errorCode:a.SM.UserNotFoundError,isExpected:!0,message:r,correlationId:t});return o.code=o.errorCode,o},W=(e,t,r,a="getTenantData")=>{let o=`[core-auth-base][${t}][${e}] Error in fetch tenant data.`,n=(0,f.Tr)({context:"core-auth-base",subContext:a,errorCode:e,isExpected:r,message:o,correlationId:t});return n.code=n.errorCode,n},z=e=>{let t=(0,f.Tr)({context:"core-auth-base",subContext:"_acquireToken",errorCode:a.SM.NoNetwork,isExpected:!0,message:"Network is offline according to NetworkState.",correlationId:e});throw t.code=t.errorCode,t},H=(e,t)=>(0,f.MD)({name:"errorRateLimitExceeded",code:a.SM.ErrorRateLimitExceeded,context:"core-auth-base",subContext:"_acquireToken",message:"Rate limit exceeded based on policy",correlationId:e,isExpected:!0,errorCode:a.SM.ErrorRateLimitExceeded,errorMetadata:t}),B=e=>{let t=(0,f.Tr)({context:"core-auth-base",subContext:"_acquireToken",errorCode:a.SM.MachineAsleep,isExpected:!0,message:"Machine is asleep according to machineState.",correlationId:e});throw t.code=t.errorCode,t},Q=async(e,t,r,a,o,n,i,s,l,d,c,u,p)=>(e.isExpected=(0,f.ZG)(e),e.message=eo(e.message,l),e=F(e,o,p),((e,t,r)=>{let a=r?.("disableIgnoreConsentRequiredForIRCache");return!!e.includes(t.errorCode)&&(!!a||!(t.message.includes("consent_required")||t.reason?.subError==="consent_required"))})(o,e,p)&&await P(e,t,r,a,r===n,i,s,l,d,c?.item,u,p),e),X=(e,t,r,a,o,n,s,l,d,c,u,h,f)=>{let m,{userIdentifier:g=(0,p.Xx)(a)}=r;try{m=((e,t,r,a,o="",n)=>{let s=e.newScenario("bg"===o?i.RG.AcquireTokenInBackground:i.RG.AcquireToken);return s?.appendEventData({endpointUrl:t,target:t,dataSource:a,correlationId:r,contentType:o,isSilent:!n?.prompt||"none"===n.prompt}),s})(s,t,e.id,o.name,"bg",r),m?.mark("provider_start"),o.acquireToken(t,{...r,userIdentifier:g}).then(async a=>{a.idToken=void 0,m?.mark("provider_end"),await U(g,t,a,e.id,t===l,n,d,c,u,r.tenantId,f),m?.stop({authCacheCounter:h?.hitCount,prevTokenExpire:h?.item?.expires})}).catch(e=>{m?.mark("provider_fail"),(0,p.S1)("acquireToken",e,m,[],"bg",t)})}catch(e){(0,p.S1)("acquireToken",e,m,[],t,"bg")}},Y=(e,t,r)=>({result:{accessToken:e.token,idToken:e.idToken,expiresIn:e.expires-Math.round(Date.now()/a.rF.MILLI_PER_SECOND),userProperties:{homeAccountId:t.homeAccountId??t.id,environment:(0,p.M_)(t.cloud,r),username:t.userName,name:t.profile.name}}}),Z=async(e,t,r,a)=>{if(a?.("isWebClientType"))return"";try{let a=await t.loadModule(o.nM.Auth),n=await a.migratePendingAccounts({correlationId:e});return r.addEventData([`accountToMigrateFound:${+!!n.accountId}`]),n.accountId}catch{return r.addEventData(["accountToMigrateFound:error"]),""}},ee=async(e,t,r)=>{try{let a=await t.loadModule(o.nM.Core),i=await a.launchCloud({cloudType:n.G7.life,deepLink:"default",userContextId:e,correlation:{id:"id",source:"initialize-accounts"}});r.addEventData([`launchMsaGuestMigratedAccountResult:${i?.success}`])}catch{r.addEventData(["launchMsaGuestMigratedAccountResult:error"])}},et=async(e,t,r)=>{if(r?.("buildCloud")===n.G7.life&&!r?.("enableHostCapabilityCheckForLife"))return!1;try{let r=await e.loadModule(o.nM.Hostcapabilities),a=await r.getCapabilities(["isT2Point2Enabled"]);if(a&&a.length>0)return t.addEventData([`getHostCapabilityfor:${a[0].name}-${a[0].value}`]),a[0].value}catch{t.addEventData(["getHostCapability:error"])}return!1},er=async(e,t,r,n,i,s)=>{if(r.errorCode===a.SM.CloudMismatch)try{let a=await n.loadModule(o.nM.Core),l=await a.launchCloud({cloudType:r.errorMetadata?.cloud,deepLink:t?"default":"core",userContextId:e,correlation:{id:"id",source:"initialize-accounts"}});i.addEventData([`crossCloudLogin:${+!!l.success}`]),s.recordPanelAction(_.tS)}catch(e){i.addEventData(["crossCloudLogin:error",`errorCode: ${e.errorCode}`]),i.appendScenarioEventData({errorCode:e.errorCode,reason:"Launch Cloud Failed"}),s.recordPanelAction(_.mg)}else i.addEventData(["login:0",`errorCode:${r.errorCode}`]),i.appendScenarioEventData({errorCode:r.errorCode,reason:"Pending Account Login Failed"}),s.recordPanelAction(_.Of)},ea=async(e,t,r,a,o)=>{let i=r.siteUrl?r.siteUrl:e.includes("sharepoint")?e:void 0;if(a.addEventData([`urlToResolve:${+!!i}`]),i){let e=new URL(i).origin;if(["https://1drv.ms","https://my.microsoftpersonalcontent.com"].includes(e))return void a.addEventData(["msaSharepointSiteUrl"]);let s=(0,c.VF)((0,p.Xx)(t)).realmMap,l=d.Jt.getValue(s)??new Map;if(a.addEventData([`map:${+l.has(e)}`]),l.has(e))r.tenantId=l.get(e);else{let t=e.includes("sharepoint")?e.concat("/_api/v2.0/shares"):e;a.addScenarioMark("tenant_realm_fetch_start");let o=await fetch(t,{method:"GET",headers:new Headers({Authorization:"Bearer "})});if(a.addScenarioMark("tenant_realm_fetch_stop"),a.addEventData([`fetch-${o.status}`]),401===o.status){let t=Object.fromEntries(o.headers),n=(0,g.Wn)(t);a.addEventData([`realm:${+!!n.realm}`]),n.realm&&(r.tenantId=n.realm,l.set(e,n.realm),d.Jt.put(s,l))}}o?.("enableCoherenceLoopTokenAcquisition")&&t.cloud===n.G7.life&&(a.addEventData(["enableCoherenceLoopTokenAcquisition:1"]),r.extraQueryParameters={...r.extraQueryParameters??{},external_collab_cross_cloud_token:"1"})}},eo=(e,t)=>{if(!e)return e;try{let t=e;if(!t.includes("login_hint=")&&!t.includes("loginHint="))return e;return[/login_hint=[^&"]+(&|"|$)/g,/loginHint=[^&"]+(&|"|$)/g].forEach(e=>{let r;for(;null!==(r=e.exec(t));){let e=r[1]||"";t=t.replace(r[0],e)}}),t}catch(r){return t.addEventData(["error_removing_loginHint"]),e}}},985213:function(e,t,r){r.d(t,{$C:()=>o,Lt:()=>n,Of:()=>i,mg:()=>l,tS:()=>s});var a=r(719970);let o={actionWorkload:"auth",actionOutcome:a.$K.accountMigrationStart,actionScenario:a.Tk.AuthAccountMigration,actionScenarioType:a.Yu.appAuth},n={actionWorkload:"auth",actionOutcome:a.$K.accountMigrationLoginSuccess,actionScenario:a.Tk.AuthAccountMigration,actionScenarioType:a.Yu.appAuth},i={actionWorkload:"auth",actionOutcome:a.$K.accountMigrationLoginFailure,actionScenario:a.Tk.AuthAccountMigration,actionScenarioType:a.Yu.appAuth},s={actionWorkload:"auth",actionOutcome:a.$K.accountMigrationLaunchCloudSuccess,actionScenario:a.Tk.AuthAccountMigration,actionScenarioType:a.Yu.appAuth},l={actionWorkload:"auth",actionOutcome:a.$K.accountMigrationLaunchCloudFailure,actionScenario:a.Tk.AuthAccountMigration,actionScenarioType:a.Yu.appAuth}},633064:function(e,t,r){if(r.d(t,{$R:()=>E,MD:()=>_,Ri:()=>M,SH:()=>S,Wh:()=>T,Zl:()=>y,bO:()=>I,et:()=>A,fG:()=>C,gA:()=>g,h1:()=>U}),56909==r.j)var a=r(806674);if(56909==r.j)var o=r(757568);if(56909==r.j)var n=r(875342);if(56909==r.j)var i=r(743918);if(56909==r.j)var s=r(573440);if(56909==r.j)var l=r(739965);if(56909==r.j)var d=r(668400);if(56909==r.j)var c=r(433139);if(56909==r.j)var u=r(751843);if(56909==r.j)var p=r(414501);if(56909==r.j)var h=r(524434);if(56909==r.j)var f=r(416241);if(56909==r.j)var m=r(767892);let g=(e,t,r,a,o,n)=>{let i=_(e,t,r,a,o,n);return{...i,message:i.message,stack:i.stack,errorMetadata:{accountId:t?.result?.profile?.id,name:t?.result?.profile?.displayName,email:t?.result?.profile?.email}}},y=(e,t)=>{let r=t?.("buildCloud")||"",o=e.extraQueryParameters?.tenantId,n=w(o,e.domainHint||r,t),i=e.extraQueryParameters?.accountType||a.Ch.Aad;return{correlation:e.correlation,silent:e.silent,extraQueryParameters:{...e.extraQueryParameters,authority:n},userIdentifier:{accountType:i,tenantId:o,id:e.accountId||"",userName:"",oid:""}}},C=e=>e.accountId&&e.extraQueryParameters?.tenantId,_=(e,t,r,a,o,n)=>{let s=(t=$(t,n,o)).isExpected||t.message?.includes("657rv")||t.errorMessage?.includes("657rv")||!1,l=(t?.errorMessage||t.message||"ErrorMessageMissing").replace(/[^"',;:\s]+@[^"',;:\s]+\.[^"',;:\s]+/g,"email");return a?(0,i.Tr)({context:"authentication",subContext:e,errorCode:t.errorCode||"ErrorCodeMissing",message:l,isExpected:s,correlationId:r.id,tag:b(l),systemErrorCode:v(l)}):(0,i.Tr)({context:"authentication",subContext:e,errorCode:t.errorCode||"ErrorCodeMissing",message:l,isExpected:s,correlationId:r.id})},v=e=>{if(e&&e.includes("{"))try{return JSON.parse(e.substring(e.indexOf("{"))).SystemErrorCode??""}catch(e){}return""},b=e=>{if(e&&e.includes("{"))try{return JSON.parse(e.substring(e.indexOf("{"))).Tag??""}catch(e){}return""},S=(e,t,r)=>{let{accountId:a,correlation:n,prompt:i,loginHint:s,extraQueryParameters:l,windowId:d}=e,u=!!r?.("enableRopcFlow"),p={accountId:a,correlationId:n.id,domainHint:r?.("enableAad")?r?.("enableMultiCloud")?void 0:o.nU.prod:o.nU.life,extraQueryParameters:(0,c.nW)(l),loginHint:s,silent:"none"===i,windowId:d,useRopcFlow:u};return t.addEventData([`nativeArgs:{domainPresent:${p.domainHint}`,`extraParams:${p.extraQueryParameters?.length}`,`idPresent:${+!!p.accountId}`,`loginHintPresent:${+!!p.loginHint}`,`silent:${p.silent}`,`useRopcFlow:${p.useRopcFlow}}`]),p},M=(e,t,r,a)=>{let o=E(t.userIdentifier);if(!t.extraQueryParameters?.authority&&a?.("enableSetAuthorityAlways")){let e=w(t.tenantId||o.tenantId,a?.("buildCloud")||"",a);t.extraQueryParameters=t.extraQueryParameters||{},t.extraQueryParameters.authority=e}let n={resource:e,correlationId:t.correlation.id,accessTokenToRenew:t.accessTokenToRenew,claim:t.claim,silent:t.silent??"login"!==t.prompt,userIdentifier:o,tenantId:t.tenantId,extraQueryParameters:(0,c.nW)(t.extraQueryParameters),windowId:t.windowId};return r.addEventData(["nativeArgs:{",`accessTokenPresent:${+!!n.accessTokenToRenew}`,`claimPresent:${+(0,c.WD)(t.claim)}`,`idPresent:${+!!o?.id}`,`silent:${n.silent}`,`userToUse:${+!!o}`,`externalTenant:${+!!n.tenantId}`,"}"]),n},E=e=>({id:e.id,tenantId:e.tenantId,oid:e.oid,upn:e.userName}),A=(e,t,r)=>{let o,n,i;d.q.info("Getting user profile");let s=e.extendedProperties?.find(e=>"acct"===e.name),l=e.extendedProperties?.find(e=>"idp"===e.name);s&&(o=+s.value);let u=l?l.value:void 0;try{n=e.profile.id||(e.profile.oid.startsWith("000")?e.profile.oid.replace(/[0-]/g,""):e.profile.oid)}catch{n=e.profile.oid}let f=e.extendedProperties?.find(e=>"isCrossCloudUser"===e.name),m=x(e,f?.value),g={tenantId:e.profile.tenantId,oid:e.profile.oid,accountType:(0,c.QG)(e.profile.tenantId),userName:e.userName,id:n};p.Jt.put((0,h.VF)(g).telemetryInfo,{isCrossCloudUser:m});let y=k(e,!!t?.("enableMTO"),!!t?.("enableCCM")),C=1===o?a.w4.Guest:a.w4.Member;y===a.Yf.Ccm&&(C=a.w4.Anonymous);let _=!!t?.("disableHomeTidAndCloud"),[v,b]=(0,c.Ug)(e);return e.profile.isHomeAccount?(v=n,b=e.profile.tenantId,i=(0,c.nL)(e,t,r,n,v)):(b=e.homeTenantId||b,i=e.homeCloud?(0,c.SJ)(e.homeCloud):void 0),{id:n,userName:e.userName||e.profile.email,profile:{acct:o,altsecid:"",amr:[],aud:"",exp:-1,idp:u,email:e.profile.email,family_name:"",given_name:e.profile.displayName,iat:1,iss:"",name:e.profile.displayName,preferred_username:e.userName||e.profile.email,nbf:-1,nonce:"",oid:e.profile.oid,onprem_sid:"",sub:"",tid:e.profile.tenantId,unique_name:e.profile.displayName,upn:e.profile.email,ver:"1.0",isHomeAccount:e.profile.isHomeAccount},isAuthenticated:!1,type:(0,c.QG)(e.profile.tenantId),cloud:(0,c.nL)(e,t,r,n,v),homeAccountId:v,homeTenantId:_?void 0:b,homeAccountCloud:_?void 0:i,role:C,subType:y}},k=(e,t,r)=>{let o=a.Yf.Default;if(t||r){let i={id:(0,u.pW)(),scenarioName:n.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"},[d,c]=(0,s.OU)({options:{correlation:i},subContext:"auth-helper::getUserSubType",scenarioName:n.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"}),p=e.extendedProperties?.find(e=>e.name===l.GA);if(p){let e=t&&p.value.indexOf(l.f)>-1,n=r&&p.value.indexOf(l.u1)>-1;e?o=a.Yf.Mto:n&&(o=a.Yf.Ccm)}c({reason:"Extended properties wids claim check done.",userSubType:o},"success")}return d.q.log(`User subType set to ${o}, enableMTO: ${t}`),o},T=e=>({token:e.result.token,idToken:e.result.idToken,expires:e.result.expires,fromCache:!1,account:e.result.account}),I=e=>e.errorCode===l.wK.ApiContractViolation&&e.message.includes(l.wK.UiAlreadyShowing),U=e=>e?.message?.match(/Tag\\?":\\?"([^\\"]*)/)?.[1]||"",x=(e,t)=>{if(!e.homeAccountId||e.profile.id===e.homeAccountId)return!1;let r=(0,f.zF)(e.homeAccountId,void 0);return(!r||e.profile.sovereignty!==a.ym.gcc||r.cloud!==a.G7.prod)&&"1"===t},w=(e,t,r)=>{let a=(0,c.M_)(t,r);return`${a}${e}`},$=(e,t,r)=>{if(!e||!r||!t||!r("enableErrorCodeTranslationMaglev"))return e;let a=e?.errorMessage||e?.message||"ErrorMessageMissing",o=(0,m.b)(a);try{let a=(0,m.s)(o,r,"maglev");if(void 0!==a){let r=e.errorCode;e.errorCode=a,t.addEventData(["errorCodeRemapped:success","reMappedByParsedMessage",`oldErrorCode:${r}`,`newErrorCode:${a}`])}return e}catch(r){return t.addEventData(["errorCodeRemapped:failed","reason:cannot parse error message"]),e}}},331280:function(e,t,r){r.d(t,{n:()=>a});let a=e=>!!e?.chrome?.webview},433139:function(e,t,r){r.d(t,{$8:()=>R,As:()=>eC,B$:()=>w,CK:()=>es,Cq:()=>eA,FG:()=>ee,Fr:()=>ek,HE:()=>ef,Ig:()=>q,Kv:()=>Z,LP:()=>O,MM:()=>eR,MW:()=>Y,M_:()=>D,N3:()=>ew,NL:()=>ec,PP:()=>eT,PU:()=>eo,QG:()=>N,S1:()=>el,SJ:()=>P,SR:()=>ey,TP:()=>j,Ug:()=>$,VT:()=>eU,WD:()=>eu,Xx:()=>W,ZW:()=>ed,_Z:()=>eh,aS:()=>X,au:()=>ei,b6:()=>I,b9:()=>k,bc:()=>M,bi:()=>G,c_:()=>ep,dW:()=>en,en:()=>eG,fM:()=>et,gO:()=>ea,iZ:()=>x,jV:()=>er,l8:()=>B,nL:()=>L,nW:()=>H,op:()=>T,ps:()=>em,qL:()=>eN,qv:()=>z,r7:()=>ev,rL:()=>ej,rl:()=>e_,s4:()=>eO,t6:()=>ex,tN:()=>E,v8:()=>Q,w2:()=>A,x7:()=>eD,yI:()=>U,z7:()=>eL});var a,o,n=r(892891);if(56909==r.j)var i=r(806674);if(56909==r.j)var s=r(771139);if(56909==r.j)var l=r(757568);if(56909==r.j)var d=r(875342);if(56909==r.j)var c=r(668400);if(56909==r.j)var u=r(739965);if(56909==r.j)var p=r(414501);if(56909==r.j)var h=r(743918);if(56909==r.j)var f=r(330463);if(56909==r.j)var m=r(751843);if(56909==r.j)var g=r(524434);if(56909==r.j)var y=r(732100);if(56909==r.j)var C=r(573440);if(56909==r.j)var _=r(249808);if(56909==r.j)var v=r(416241);if(56909==r.j)var b=r(633064);if(56909==r.j)var S=r(222024);let M="9188040d-6c67-4c5b-b112-36a304b66dad";(a=o||(o={})).Otp="mail",a.GFed="google.com";let E=({type:e,profile:t})=>(e===i.Ch.Otp||e===i.Ch.GFed||t.idp===o.Otp||t.idp===o.GFed)&&t.tid===u._6.services,A=({cloud:e,profile:t},r)=>e===i.G7.life&&t.tid===u.zP&&r===i.G7.prod;function k(e,t){return void 0!==t&&e!==t}function T(e,t,r){let a=r?.("disablePassExternalLoginIdentifier");return t.subType===i.Yf.Eotp&&(e.extraQueryParameters={...e.extraQueryParameters,otpAccount:!0,...!a&&u.jb}),e}let I=e=>(c.q.info(`[returnTokenForAnonUser][${e}] empty token return for anonymous user`),{token:"",expires:Math.floor(new Date().setMinutes(u.uI.FIFTEEN)/u.rF.MILLI_PER_SECOND),fromCache:!0}),U=(e,t)=>{if(!e)return"";let r=t?.("instanceUrl"),a=r?`${r}${e??"common"}`:"";return c.q.log(`[getAuthorityFromCloud] Get Authority from cloud type - ${a}`),a},x=e=>e.tenantId&&e.isAnonEligible&&e.isAnonRestrictionSatisfied,w=(e,t,r,a,o)=>{let n=t?.profile.tid||r||e?.tenantId;if(n&&(t||a||e?.isAnonEligible&&e?.isAnonRestrictionSatisfied))return O(n,void 0,t,void 0,o)},$=e=>{let t,r,a=e.homeAccountId?.split(".");return a&&a.length>0&&(t=a[0],t?.startsWith("00000000-0000-0000")&&(t=t.replace("00000000-0000-0000-","").replace("-","")),a.length>1&&(r=a[1])),[t,r]},O=(e,t,r,a,o)=>{c.q.info("Anon flow - anonymous user created"),t=t||(e===u.zP?i.G7.life:i.G7.prod),o&&a&&(0,S._S)(a)!==a&&o?.addEventData(["meetingUniqueIdEuiiLeak:1"]);let n=`anon.${t}.${e}.${a}`;return{id:n,isAuthenticated:!0,userName:r?.userName||"anonymous",profile:{oid:z(n),tid:e,upn:r?.profile?.upn||"",puid:""},role:i.w4.Anonymous,type:i.Ch.Anonymous,homeAccountId:n,homeTenantId:e,homeAccountCloud:r?.cloud||t,cloud:r?.cloud||t,subType:i.Yf.Default}},N=e=>e===s.e0?i.Ch.MsaLife:i.Ch.Aad,D=(e,t)=>{if(!e){if(t?.("disableUseBuildCloudForEmptyCloudInAuthotityFn"))return u._V;e=t?.("buildCloud")||i.G7.prod}let r=t?.("cloudAuthorityMap")??u.fL;return r.find(t=>t.cloud.toString()===e)?.authority||u._V},L=(e,t,r,a,o)=>{if(N(e.profile.tenantId)===i.Ch.MsaLife)return i.G7.life;if(!(t?.("enableMTMAAuthDataInMaglevStorage")||t?.("enableMTMAAuthDataInMaglevStorageViaHost")))return G(e.profile.sovereignty);{let n=e.profile.sovereignty;return o===a?G(n):r||R(e.profile.environment,e.profile.tenantId,t)}},R=(e,t,r)=>{if(t===M)return i.G7.life;switch(e){case i.Ke.prod:return i.G7.prod;case i.Ke.gallatin:return i.G7.gallatin;case i.Ke.airgap08:return i.G7.airgap08;case i.Ke.airgap09:return i.G7.airgap09;case i.Ke.gov:return r?.("buildCloud");default:return i.G7.prod}},G=e=>{switch(e){case i.ym.prod:case i.ym.gcc:return i.G7.prod;case i.ym.gcch:return i.G7.gcch;case i.ym.dod:return i.G7.dod;case i.ym.ag08:return i.G7.airgap08;case i.ym.ag09:return i.G7.airgap09;case i.ym.gallatin:return i.G7.gallatin;default:return i.G7.prod}},j=e=>{switch(e){case i.G7.prod:return l.nU.prod;case i.G7.life:return l.nU.life;case i.G7.gcch:return l.nU.gcch;case i.G7.dod:return l.nU.dod;case i.G7.airgap08:return l.nU.airgap08;case i.G7.airgap09:return l.nU.airgap09;case i.G7.gallatin:return l.nU.gallatin;default:return l.nU.prod}},P=e=>{switch(e){case l.nU.prod:return i.G7.prod;case l.nU.life:return i.G7.life;case l.nU.gcch:return i.G7.gcch;case l.nU.dod:return i.G7.dod;case l.nU.airgap08:return i.G7.airgap08;case l.nU.airgap09:return i.G7.airgap09;case l.nU.gallatin:return i.G7.gallatin;default:return i.G7.prod}},q=(e,t,r,a,o)=>{if(t?.subType===i.Yf.Ccm||t?.subType===i.Yf.Eotp)return t;if(!t||(0,n.isEmpty)(t.profile)||t.role===i.w4.Anonymous||t.userRole===u.uI.TWO||!t.isAuthenticated&&e.isAnonEligible||!t.isAuthenticated&&a)return c.q.info("checking anon flow"),w(e,t,r,a,o);let s=void 0===t.role&&t.profile?.acct===void 0&&F(t?.homeAccountId,t?.profile?.oid,t?.cloud);return t.role=t.role===i.w4.Guest||t.profile?.acct===1||s?i.w4.Guest:i.w4.Member,J(t),V(t),K(t)},F=(e,t,r)=>e&&t&&r&&"life"!==r&&e!==t,J=e=>{if(e.profile?.tid===s.e0){e.type=i.Ch.MsaLife;return}let t=[i.Ch.Msa,i.Ch.Otp,i.Ch.GFed];if(e.type&&-1!==t.indexOf(e.type))return;let r=e.profile?.altsecid?.indexOf("1:")===0?i.Ch.Msa:i.Ch.Aad;e.profile?.idp&&e.profile?.iss!==e.profile.idp&&(r=e.profile.idp===o.Otp?i.Ch.Otp:r,r=e.profile.idp===o.GFed?i.Ch.GFed:r),e.profile?.altsecid?.indexOf("1:")===0&&e.cloud===i.G7.prod&&e.profile?.tid&&e.profile.tid!==u._6.services&&(r=i.Ch.Aad),e.type=r},V=e=>{if(e.type===i.Ch.MsaLife){e.cloud=i.G7.life;return}e.cloud&&e.cloud!==i.G7.prod||(e.cloud=i.G7.prod)},K=e=>(e.profile.oid=e.profile.oid||z(e.profile.tid),!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.subType||(e.subType=i.Yf.Default),c.q.log(`User role = [${e.role}], type = [${e.type}], cloud = [${e.cloud}]`),e),W=e=>{if(!e)throw Error("getUserIdentifier: User cannot be null");return{tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id}},z=e=>`8:defaultOid:${e}`,H=e=>{let t=[];for(let r in e)Object.hasOwnProperty.call(e,r)&&e[r]&&t.push({name:r,key:r,value:"string"==typeof e[r]?e[r]:(0,m.u4)(e[r])});return t},B=e=>{let{extraQueryParameters:t}=e;t?.otpAccount?p.Jt.put(g.Jl.eOtpLoginUser,e.loginHint):p.Jt.del(g.Jl.eOtpLoginUser)},Q=e=>(0,h.Tr)({context:"core-auth-base",subContext:"getUserFromAccountId",correlationId:e,errorCode:u.SM.UserNotFoundError,message:"Cannot update global user ude to missing user"}),X=(e,t)=>{t.addEventData(["update-global-user:t"]),t.addScenarioMark("auth_update_global_user_start");let r=(0,v.zF)(e,void 0);if(r)return t.addScenarioMark("auth_update_global_user_foundUser"),p.Jt.updateGlobalUser(r);throw t.addScenarioMark("auth_update_global_user_noUserFound"),Q(t.correlation?.id)},Y=(e,t)=>{if(!t?.("disableHomeTidAndCloud")&&(!e.homeTenantId||!e.homeAccountCloud)){if(e.profile.isHomeAccount)e.homeTenantId=e.profile.tid,e.homeAccountCloud=e.cloud;else{let t=(0,v.zF)(e.homeAccountId,void 0);e.homeTenantId=t?.profile.tid,e.homeAccountCloud=t?.cloud}p.Jt.put((0,g.VF)(W(e)).user,e)}return e},Z=e=>e?e?.id?e?.id:`${e?.oid}-${e?.tenantId}`:"unknown user",ee=(e,t)=>!!e&&!!t&&((e.id||t.id)&&e.id===t.id||e.tenantId===t.tenantId&&e.oid===t.oid&&e.userName===t.userName),et=(e,t,r)=>{let a=new CustomEvent(t,{detail:r});e?.dispatchEvent?.(a)},er=(e,t,r,a,o)=>{let n=q(e,t,a,o,r);return n&&(c.q.info(`[auth-helper][getMappedUserAndSetItToCache][${r.correlation.id}] put user in cache.`),p.Jt.put((0,g.VF)(W(n)).user,n),(0,f.mD)(!1,{correlation:r.correlation,accountId:n.id},"login"),r.addEventData(["setLoggedOut:0"])),n},ea=e=>"postmessage"===new URLSearchParams(e).get("agent"),eo=(e,t,r,a,o)=>{if(u.s9(e,t))throw o.addEventData(["scope_invalid:1"]),c.q.warn(`[core-auth-base][acquireToken][${a.source}][${a.id}] invalid scope. resource: [${e}]`),(0,h.Tr)({context:"core-auth-base",subContext:"acquireToken",message:`request with [${r?.id}-${r?.oid}-${r?.tenantId}] sent from invalid resource: ${e}`,errorCode:u.SM.InvalidScopeResource,isExpected:!0,correlationId:a.id})},en=(e,t,r,a,o)=>(a.push("user_missing"),(0,h.Tr)({context:"core-auth-base",subContext:e,errorCode:u.SM.UserNotFoundError,isExpected:r,message:`request sent with [${t}] failed as user not found`,innerError:Error("User Null or empty"),correlationId:o})),ei=(e,t,r,a)=>(0,h.Tr)({context:"core-auth-base",subContext:e,errorCode:u.SM.UnsupportedParameter,isExpected:r,message:`${t} parameter is not currently supported`,innerError:Error(`${t} parameter is not currently supported`),correlationId:a}),es=(e,t,r,a,o)=>{let n=e instanceof y.l?e?.code:e?.errorCode;a.push(`errorCode:${n||"undefined"},errorMessage:${e?.message||"undefined"}`),a?.length>0&&a.push("$");let i={errorCode:n,message:e?.message,reason:a?.join(";"),correlationId:r},s=e instanceof y.l||e?.isExpected,l=`Login unsuccessful. Expected: ${!!s}. Message: ${e?.message}. eventData: ${i.reason}`;s?(o?t?.mark(o,i,"incomplete"):t?.incomplete(i),c.q.warn(l)):(o?t?.mark(o,i,"failure"):t?.fail(i),c.q.error(l))},el=(e,t,r,a,o,n)=>{a?.push(`errorCode:${t?.errorCode||"undefined"},errorMessage:${t?.message||"undefined"}`),a&&a.length>0&&a.push("$");let i=function(e,t,r="",a,o){return{contentType:r,context:"core-auth-base",correlationId:t?.correlationId,endpointUrl:o||"unset",errorCode:t?.errorCode||"AcquireToken Error",innerError:t,isExpected:t?.isExpected,message:(0,m.VK)(t),reason:a?.join(";")||"",subContext:e}}(e,t,o,a,n),s=i.errorCode.includes(u.SM.InvalidScopeResource)||i.message?.includes(u.SM.InvalidScopeResource)||i.isExpected||i.innerError?.isExpected;return s?c.q.warning(`Error found ${(0,m.VK)(t)}`):c.q.error(`Error found ${(0,m.VK)(t)}`),s?r?.incomplete(i):r?.fail(i),i},ed={access_token:{xms_cc:{values:["CP1"]}}},ec=JSON.stringify(ed),eu=e=>!!(e&&e!==ec),ep=(e,t)=>{let r=t?.("enablePromptResourcesFor401")||[];return!!e&&!!r&&Array.isArray(r)&&r.findIndex(t=>e.includes(t))>-1},eh=(e,t,r,a,o)=>(r.tflClaim&&(r.accessTokenToRenew=r.tflClaim),void 0===r.prompt&&void 0===r.silent&&((r.accessTokenToRenew||eu(r.claim))&&(!a?.("disablePromptFor401")||ep(e,a))?(r.prompt="login",r.silent=!1):(r.prompt="none",r.silent=!0)),o&&!r.accessTokenToRenew&&(r.forceRenew||!1===r.silent||"login"===r.prompt)&&(c.q.info("[core-auth-base][acquireToken] force renewing."),r.accessTokenToRenew=o.item.token),t.addEventData([`cacheToken:${+!!o}`,`tflClaim:${+!!r.tflClaim}`,`accessTokenToRenew:${+!!r.accessTokenToRenew}`,`forceRenew:${+!!r.forceRenew}`,`prompt: ${r.prompt}`,`silent:${+!!r.silent}`]),o?.item?.error?.errorCode&&t.addEventData([`errorInToken:[${o?.item?.error?.errorCode||""}]`]),r),ef=(e,t)=>{let r=t?.("enableMSAGuest"),a=t?.("enableTFLOnT21");return r&&!a&&e.cloud===i.G7.life},em=async e=>{let{user:t,authTelemetry:r,environment:a,authProvider:o,options:n,getSetting:s}=e,l=s?.("buildCloud"),d=s?.("enableMultiCloud"),f=s?.("enableCCM"),m=s?.("enableRefreshTenantsForGuestDeeplink");if(c.q.log(`starting cloud misMatch check. Env: ${a}, buildCloud: ${l}, user tid: ${t.profile.tid}, user cloud: ${t.cloud}`),e_(t,s))return Promise.reject(await eU(t,n.correlation,o));if(!t.cloud||!l||t.cloud===l&&t.subType!==i.Yf.Ccm)return c.q.log("No cloud mismatch detected."),r.addEventData(["cloudMismatch:0"]),t;let g=ef(t,s);if(r.addEventData(["cloudMismatch:1",`isMsaGuest:${+!!g}`,`enableCCM:${+!!f}`,`meetingDetails:${+!!n.meetingDetails}`]),g){r.addScenarioMark("msa_flow_start");let e=await eb(t,n,o,r,l,s);if(e)return e}if(m&&n.extraQueryParameters?.isNewGuestUser){r.addScenarioMark("try_login_to_new_tenant_start");let e=await eg(t,n,o,r,l,s);if(e)return e}if(f&&n.meetingDetails&&t.cloud!==i.G7.life){r.addScenarioMark("ccm_flow_start");let e=await eS(t,n,o,r,l,n.meetingDetails,s);if(e)return e}return d?(r.addScenarioMark("cloud_mismatch_detected",{reason:`_checkForCloudMismatchAndReboot. Env: ${a}, enableMultiCloud: ${d}, buildCloud: ${l}, user tid: ${t.profile.tid}, user cloud: ${t.cloud}`}),Promise.reject(await eT(t,n.correlation,o))):(p.Jt.del({user:W(t),typeName:"User"}),o.removeWebActiveUser?.(),Promise.reject(await (0,h.MD)({name:u.SM.CloudMismatchNoMultiCloud,message:"cloud mismatch, reboot required",correlationId:n.correlation.id,context:"Login",subContext:"checkForCloudMismatch",errorCode:u.SM.CloudMismatchNoMultiCloud,isExpected:!0})))},eg=async(e,t,r,a,o,n)=>{try{let i=await eM(e,t,r,t.extraQueryParameters?.tenantId,o,n),s=eE(i,n);if(a.addEventData([`account:${+!!s}`,`sub:${s?.subType}`,`buildCloud:${o}`,`userCloud:${s?.cloud}`]),s)return a.addEventData(["newCcgaUser:1"]),a.addScenarioMark("try_login_to_new_tenant_end"),s;a.addScenarioMark("try_login_to_new_tenant_end")}catch(e){a.addScenarioMark("try_login_to_new_tenant_end",e)}},ey=e=>{let{user:t,options:r,authTelemetry:a,getSetting:o}=e,n=r.meetingDeepLink;if(o?.("disableCrossCloudMeetingBlock")||!n)return;let i=n.includes("teams.live.com"),s=!(i||n.includes("teams.microsoft.com")),l="life"!==t.cloud&&"prod"!==t.cloud;if(s&&"life"===t.cloud||l&&i)throw(0,h.MD)({message:"User attempted to join an invalid cross cloud meeting",name:"",errorCode:"InvalidMeeting",correlationId:a.correlation.id,context:"account-selection-dialog-renderer",subContext:"onItemClick",authSubErrorCode:"GenericAuthError"})},eC=(e,t)=>{t?.("enableWebTflMsaGuestFlow")&&(e?.profile?.altsecid?.indexOf("1:live")<0||"prod"!==e.cloud||p.Jt.put((0,g.VF)(W(e)).userAuthState,{state:i.JE.Up,reason:"",visibilityState:i.Bl.Shown}))},e_=(e,t)=>e.cloud===i.G7.life&&!!t?.("enableMultiMsaRoadBlock")&&!!t?.("enableTFLOnT21")&&!!p.Jt.getAllOfType("User").find(t=>t.id!==e.id&&t.cloud===i.G7.life&&t.type!==i.Ch.Anonymous),ev=(e,t,r)=>{let a=r?.("buildCloud");if(r?.("isWebClientType")&&e.meetingDeepLink&&"interopMeetingLogin"===e.loginType)try{t.addScenarioMark("update_hostName_for_interop_start");let r=new URL(e.meetingDeepLink);r.hostname=a===i.G7.prod?u.sC.TfwToTfl:u.sC.TflToTfw,r.searchParams.set("login_hint",e.loginHint||""),r.searchParams.set("webjoin","true"),e.redirectUrl=r.toString(),t.addScenarioMark("update_hostName_for_interop_end")}catch(e){t.addScenarioMark("update_hostName_for_Interop_fail",e)}},eb=async(e,t,r,a,o,n)=>{try{let s=await eM(e,t,r,u._6.services,o,n),l=s.webAccount??eE(s,n),d=!!n?.("enableWebTflMsaGuestFlow");if(a.addEventData([`msa-account:${+!!l}`]),a.addScenarioMark("msa_flow_end"),l){d&&(l.id=l.homeAccountId??l.id);let e=await eN(l,a.correlation,r);return p.Jt.put((0,g.VF)(W(l)).userAuthState,{state:i.JE.Unknown,customError:{errorCode:e.errorCode,isExpected:e.isExpected,message:e.message,context:e.context,subContext:e.subContext,correlationId:e.correlationId,errorMetadata:e.errorMetadata},reason:"MsaUserNotAllowed"}),d||(l.homeAccountId=l.id),l.type=i.Ch.Msa,l}}catch(e){a.addScenarioMark("msa_flow_end",e)}},eS=async(e,t,r,a,o,n,s)=>{if(e.subType===i.Yf.Ccm)return e$(e,a,n,e.profile.name,s);try{let l=await eM(e,t,r,n.tenantId,o,s),d=eE(l,s);if(a.addEventData([`account:${+!!d}`,`sub:${d?.subType}`]),d){if(d.subType===i.Yf.Ccm)return e$(d,a,n,e.profile.name,s);return a.addEventData(["ccgaUser:1"]),d}a.addScenarioMark("ccm_flow_end")}catch(e){a.addScenarioMark("ccm_flow_end",e)}},eM=async(e,t,r,a,o,n)=>{let i=D(o,n),l=`${i}${a}`,d=n?.("mtResource")||s.O_.MT;return await r.acquireToken(d,{correlation:t.correlation,silent:t.silent,userIdentifier:W(e),extraQueryParameters:{authority:l}})},eE=(e,t)=>e&&e.account?(0,b.et)(e.account,t):void 0,eA=e=>{if(!e?.("enableAuthCacheSchemaV1"))return!1;let t=e?.("authCacheSchemaVersion");t&&p.Jt.updateSetting("KeyVersion",t),c.q.log("[CoreAuth][_migrateAuthCache] Starting migration.");let r={id:(0,m.pW)(),scenarioName:d.RG.AuthWebMigrateCache,source:"core-auth::migrateAuthCache"},a=C.cv.create({correlation:r,subContext:"migrateAuthCache"}),o=p.Jt.getValue({typeName:"User"});if(!o)return c.q.log("[CoreAuth][_migrateAuthCache] Aborting migration. No existing user found"),a.closeScenario({reason:"no user found"},"abandoned"),p.Jt.updateSetting("UseAccountIdKey",!0),!0;if(!o.id)return c.q.log("[CoreAuth][_migrateAuthCache] Aborting migration. Existing user does not have id. Will try again next launch"),a.closeScenario({reason:"user has no id"},"incomplete"),p.Jt.updateSetting("UseAccountIdKey",!1),!1;p.Jt.updateSetting("UseAccountIdKey",!0);let n=p.Jt.getValue({typeName:"User"});return n?(c.q.log(`[CoreAuth][_migrateAuthCache] Aborting migration. Existing user found with new schema. Id: ${n.id}`),a.closeScenario({reason:"migration already complete"},"abandoned"),!1):(p.Jt.put((0,g.VF)(W(o)).user,o),c.q.log(`[CoreAuth][_migrateAuthCache] Successful migration for account ${o.id}.`),a.closeScenario({reason:"migration completed successfully"},"success"),!0)},ek=async(e,t,r,a)=>new Promise(async o=>{if(e.length<=0)return o({count:0,failure:[]});let n=0,i=[];for(let s of e){n++;try{let e=t(s);await e}catch(e){i.push(n),r?.(e,n,s)}finally{if(a){let e=a(s);await e.catch(()=>void 0)}n>=e.length&&o({count:n,failure:i})}}}),eT=async(e,t,r)=>(0,h.MD)({errorMetadata:await eI(e,t,r),authSubErrorCode:"MultiCloudMismatch",name:u.SM.CloudMismatch,message:"Cloud Mismatch Detected",context:"Login",correlationId:t.id,errorCode:u.SM.CloudMismatch,subContext:"checkForCloudMismatch",isExpected:!0}),eI=async(e,t,r)=>{let a=await r.getUserImage?.({id:e.id,correlation:t})||"";return{cloud:e.cloud,accountId:e.id,email:e.profile.email,name:e.profile.name,pictureBlob:a}},eU=async(e,t,r)=>(0,h.MD)({errorMetadata:await eI(e,t,r),authSubErrorCode:"MultiCloudMismatch",name:u.SM.MultiMSARoadBlock,message:"MultiMSARoadBlock Detected",context:"Login",correlationId:t.id,errorCode:u.SM.MultiMSARoadBlock,subContext:"MultiMSARoadBlock",isExpected:!0}),ex=e=>Math.floor((e-Math.floor(new Date().getTime()/u.rF.MILLI_PER_SECOND))*u.rF.MILLI_PER_SECOND/u.rF.ONE_MINUTE),ew=(e,t,r,a)=>{eu(r)&&e.addEventData([`isSameToken: ${a===t.token}`]);let o=ex(t.expires);e.addEventData([`tokenLifeTime: ${o}`,`fromCache: ${t.fromCache}`])},e$=(e,t,r,a,o)=>{t.addEventData(["ccmUser:1"]);let n=o?.("disableNewCCMSeparator")?"_":"_teamsccm_";return r.isShortLinkUrl?(t.addEventData(["shortMeetingDetails:1"]),e.id=`${e.id}${n}${r.meetingCode}`):(t.addEventData(["legacyMeetingDetails:1"]),e.id=`${e.id}${n}${r.conversationId}`),e.type=i.Ch.Anonymous,e.profile.name=a,p.Jt.put((0,g.VF)(W(e)).meetingDetails,r),t.addScenarioMark("ccm_flow_end"),e},eO=(e,t)=>{let{options:r,user:a,getSetting:o}=e,n=o?.("disableSetAnonymousSettingOnRedirect"),s=p.Jt.getValue(g.Jl.eOtpLoginUser),l=!!r.extraQueryParameters?.otpAccount||!!s;if(l&&!n&&(0,_.WQ)(!0),!(0,_.uc)(!!o?.("enableOTPMeetings"))||(p.Jt.del(g.Jl.eOtpLoginUser),!l||"mail"!==a.profile.idp||a.profile.tid!==u._6.services))return a;let d=r.meetingDeepLink?.lastIndexOf("/")||0,c=r?.meetingDeepLink?.slice(d+1);return t.addEventData(["otpUser:1"]),a.subType=i.Yf.Eotp,a.type=i.Ch.Anonymous,a.role=i.w4.Anonymous,a.profile.upn=a.userName,p.Jt.put((0,g.VF)(W(a)).meetingDetails,r.meetingDetails||c),a},eN=async(e,t,r)=>{let a=await r.getUserImage?.({id:e.id,correlation:t})||"",o={cloud:e.cloud,accountId:e.id,email:e.profile.email||e.userName,name:e.profile.name,pictureBlob:a};return(0,h.MD)({errorMetadata:o,authSubErrorCode:"MsaUserNotAllowed",name:u.SM.CloudMismatch,message:"msa user Detected",context:"Login",correlationId:t.id,errorCode:u.SM.MsaUserNotAllowed,subContext:"msaUserNotAllowedError",isExpected:!0})},eD=e=>({id:`dummy-user-${e.profile?.tid}-${e.homeAccountId}`,userName:e.userName,profile:{acct:1,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile?.email,family_name:"",given_name:e.profile?.given_name,iat:1,iss:"",name:e.profile?.name,preferred_username:e.userName||e.profile?.email,nbf:-1,nonce:"",oid:`dummy-user-${e.profile?.tid}`,onprem_sid:"",sub:"",tid:e.profile?.tid,unique_name:e.profile?.unique_name,upn:e.profile?.email,ver:"1.0",isHomeAccount:!1},homeAccountId:e.homeAccountId||e.id,homeTenantId:e.homeTenantId||e.profile?.tid,homeAccountCloud:e.homeAccountCloud||e.cloud,isAuthenticated:!1,type:i.Ch.Aad,cloud:e.cloud,role:e.role}),eL=(e,t)=>!t.some(t=>t.cloud===e),eR=(e,t)=>{let r=t?.("cloudAuthorityMap");if(!r||!e)return;let a=e.split("/");if(a.length<4)return;let o=a?.[2],n=a?.[3];if(n&&n===s.e0)return i.G7.life;let l=r.find(e=>e.authority===`https://${o}/`)?.cloud,d=t?.("buildCloud");return(d===i.G7.dod||d===i.G7.gcch)&&("dod"===l||"gcch"===l)?d:l?i.G7[l]:void 0},eG=(e,t)=>{if(!p.Jt.getAllOfType("User").find(t=>t.id===e?.id)){p.Jt.del(g.Jl.globalUser),t?.addScenarioMark("auth_web_global_user_invalid"),t?.addEventData(["validGlobalUser:0",`userId:${+!!e?.id}`]);return}return e},ej=e=>{if(e.subType===i.Yf.Ccm){let t=p.Jt.getValue((0,g.VF)(W(e)).skypeToken);t?.userDetails.ccmDisplayName&&!e.profile.name&&(e.profile.name=t.userDetails.ccmDisplayName)}return e}},619305:function(e,t,r){r.d(t,{k:()=>n,z:()=>o});var a=r(875291);let o=e=>a.Buffer.from(e).toString("base64"),n=e=>a.Buffer.from(e,"base64")},767892:function(e,t,r){r.d(t,{b:()=>a,s:()=>o});let a=e=>{if(e&&e.includes("{"))try{let t=JSON.parse(e.substring(e.indexOf("{"))),r={Description:t.Description,ErrorCode:t.ErrorCode,Message:t.Message,SystemErrorCode:t.SystemErrorCode,Tag:t.Tag,broker_app_used:t.broker_app_used,request_eligible_for_broker:t.request_eligible_for_broker,request_duration:t.request_duration,correlation_id:t.correlation_id,authority_type:t.authority_type,api_error_context:t.api_error_context,was_request_throttled:t.was_request_throttled};return JSON.stringify(r)}catch(e){return"cannot parse"}return""},o=(e,t,r)=>{let a=t("errorTranslation");if(!a||!Array.isArray(a)||0===a.length)return;let o=a.filter(e=>e.platform.toLowerCase()===r.toLowerCase());if(0!==o.length)try{let t=JSON.parse(e);for(let e of o)if(e.criteria.every(({key:e,value:r})=>{let a=t[e];return"string"==typeof a?a.toLowerCase()===r.toLowerCase():!("number"!=typeof a||isNaN(Number(r)))&&Number(r)===a}))return e.updatedTeamsErrorCode;return}catch(e){throw e}}},93965:function(e,t,r){if(r.d(t,{K_:()=>l,Kf:()=>f,P0:()=>c,TT:()=>m,XD:()=>p,dt:()=>d,jP:()=>g,oO:()=>h,t8:()=>u}),56909==r.j)var a=r(806674);if(56909==r.j)var o=r(416241);if(56909==r.j)var n=r(414501);if(56909==r.j)var i=r(524434);if(56909==r.j)var s=r(433139);let l=e=>n.Jt.getValue((0,i.VF)((0,s.Xx)(e)).userAuthState),d=e=>{if(!e)return;let t=(0,o.zF)(e,void 0);return t&&t.homeAccountId&&t.homeAccountId!==t.id?(0,o.zF)(t.homeAccountId,void 0):t},c=(e,t)=>{if(e&&t)return n.Jt.getAllOfType("User").find(r=>r.homeAccountId===e&&r.profile.tid===t)},u=()=>n.Jt.getAllOfType("User")?.filter(e=>f(e)&&!h(e))?.[0],p=(e,t)=>{let r=(0,o.zF)(e,void 0);if(!r)return"SkypeMigrationAccountSwap"===t?[(0,o.zF)(void 0,void 0),[]]:[r,[]];if(e)return[r,(0,o.db)(e)||[]];let a=(0,o.zF)(r.homeAccountId,void 0)||r,n=(0,o.db)(a.id)||[];return a.id===r.id||f(a)?[a,n]:(n.push(a),[r,n.filter(e=>e.id!==r.id)])},h=e=>!!(e&&e.homeAccountId&&e.homeAccountId!==e.id),f=e=>e.type!==a.Ch.Anonymous&&!e.id.startsWith("dummy-user-"),m=e=>{let t=n.Jt.getAllOfType("User")?.filter(Boolean)?.filter(t=>f(t)&&t.cloud===e),r=t?.filter(e=>!h(e));return r?.[0]||t?.[0]},g=e=>({message:`user for id: '${e}' not found. if id is undefined, global user should return`,errorCode:"NoAccountFoundForLogout",isExpected:!0,context:"get-user-utilities",subContext:"getUserForLogout",correlationId:"",name:"NoAccountFoundForLogout"})},330463:function(e,t,r){if(r.d(t,{d7:()=>h,jx:()=>f,mD:()=>c,nQ:()=>u}),56909==r.j)var a=r(806674);if(56909==r.j)var o=r(900610);if(56909==r.j)var n=r(524434);if(56909==r.j)var i=r(414501);if(56909==r.j)var s=r(668400);if(56909==r.j)var l=r(93965);let d=56909==r.j?["logoutSetting"]:null,c=(e,t,r,a)=>{s.q.log(`[core-auth-base][${r}][${t.correlation.id}] settings logged out state to: ${e}. Reason : ${t.reason||"unset"}, uid: ${t.accountId}`);let o={};d.forEach(e=>{a?.(e)!==void 0&&(o[e]=a?.(e))});let l=a?.("buildCloud");if((i.Jt.getAllOfType("User").filter(e=>e.cloud===l)??[]).length>0&&e||a?.("enableRopcFlow")===!0)return;let c={isLoggedOut:e,reason:t.reason||"unset",settings:o};i.Jt.put(n.Jl.logoutState,c)},u=(e,t)=>t?.(e)!==void 0?t?.(e):p(e),p=e=>{let t=i.Jt.getValue({typeName:"LogoutState"});if(t&&t.settings)return t.settings[e]},h=e=>({accountId:e.id,isPrimaryUser:i.Jt.getValue(n.Jl.primaryUserId)===e.id,isMostRecentUser:i.Jt.getValue(n.Jl.globalUser)?.id===e.id,state:(0,l.K_)(e)?.state||a.JE.Unknown,userType:f(e),isAuthenticated:!!e.isAuthenticated}),f=e=>e.type===a.Ch.Anonymous?o.j.Anonymous:(0,l.oO)(e)?o.j.GuestTenant:o.j.HomeTenant},919100:function(e,t,r){let a,o,n;if(r.d(t,{g:()=>f}),56909==r.j)var i=r(806674);if(56909==r.j)var s=r(743918);if(56909==r.j)var l=r(751843);if(56909==r.j)var d=r(433139);var c=r(739965);if(56909==r.j)var u=r(668400);if(56909==r.j)var p=r(454184);var h=r(892891);function f(e,t,r,i){var s;if(Object.getOwnPropertyDescriptor(Window,"mockApi")||Object.defineProperty(Window,"mockApi",{value:{enable:()=>{n=!0},disable:()=>{n=!1},setConfig:m}}),s=e,a||(a={}),a[t]=s,!(n=i)){o={};return}try{o="string"==typeof r?{...o,...JSON.parse(decodeURIComponent(r))}:{...o,...r}}catch(e){u.q.warning(`[MOCK-API] cannot parse config: ${r}`)}g(e,t)}function m(e,t={}){o||(o={}),o[e]=t;let r=e.split(".")[0];g(a?.[r],r)}function g(e,t){Object.getOwnPropertyNames(o).filter(e=>e.startsWith(`${t}.`)).map(e=>e.replace(`${t}.`,"")).forEach(r=>{let a=Object.getOwnPropertyDescriptor(e,r)?.value||Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),r)?.value,i=o?.[`${t}.${r}`];i&&i.delay&&i.delay>0?Object.defineProperty(e,r,{configurable:!0,value:async(...o)=>{if(!n)return a.apply(e,o);if(u.q.warning(`[MOCK-API] returning delayed mocked response for ${t}.${r}`),i&&i.delay){let e=void 0!==i.delay?i.delay:0;await new Promise(t=>(0,h.delay)(t,e))}return y(t,r)||a.apply(e,o)}}):Object.defineProperty(e,r,{configurable:!0,value:(...o)=>n?(u.q.warning(`[MOCK-API] returning mocked response for ${t}.${r}`),y(t,r)||a.apply(e,o)):a.apply(e,o)})})}function y(e,t){let r=o?.[`${e}.${t}`];if(r&&r.error){var a,n,i;throw a=r.error,n=e,i=t,(0,s.MD)({name:a?.name||"",context:a?.context||n,subContext:a?.subContext||i,reason:a?.reason,errorCode:a?.errorCode||"ErrorCodeNotFound",correlationId:a?.correlationId||(0,l.pW)(),isExpected:a?.isExpected||!1,message:a?.message||`[MockApi][${n}][${i}]`,authSubErrorCode:a?.authSubErrorCode,errorMetadata:a?.errorMetadata,serverResponse:a?.serverResponse})}if(r&&r.success){let e=function(e){switch(e){case"aquireToken":return _;case"user":return C();case"hostMachineUsers":return[v];case"users":return[C()];case"emptyList":return[]}return{}}(r.success.defaultValue);return Array.isArray(e)?r.success.returnValue?Array.isArray(r.success.returnValue)?[...e,...r.success.returnValue]:[...e,r.success.returnValue]:e:{...e,...r.success?.returnValue}}}let C=()=>(0,d.Ig)(new p.N("https://test.msft.com"),{userName:"TestUserName@email.com",role:i.w4.Member,profile:{name:"Test",oid:(0,d.qv)("123456789"),tid:"123456789"}}),_={token:"TestToken",expires:Date.now()+c.rF.SECONDS_FIVE_MINUTES,fromCache:!1},v=56909==r.j?{accountType:"Aad",id:"TestHostMachineUserId",displayName:"Test User",emailPhone:"test@email.com",picture:""}:null},454184:function(e,t,r){if(r.d(t,{N:()=>n,j:()=>d}),56909==r.j)var a=r(739965);if(56909==r.j)var o=r(668400);class n{constructor(e){this._hash="",this._search="",this._pathname="",this._isAnonEligible=!1,this._isAnonRestrictionSatisfied=!1,this._tid=void 0,this._queryStrings={},this._parse=e=>{let t=Object.create(null);return"string"==typeof e&&(e=e.trim().replace(/^[?#&]/,""))&&e.split("&").forEach(e=>{let r=e.replace(/\+/g," ").split("="),a=r.shift(),n=r.length>0?decodeURIComponent(r.join("=")):null;if(a){if("context"===(a=decodeURIComponent(a))&&n?.indexOf("{")===0)try{let e=JSON.parse(n);for(let t in e)e.hasOwnProperty(t)&&("tid"===t.toLowerCase()||"tenantid"===t.toLowerCase())&&(this._tid=e[t]);t={...t,...e}}catch(e){o.q.error(e)}if(Object.prototype.hasOwnProperty.call(t,a))Array.isArray(t[a])?t[a].push(n):t[a]=[t[a],n];else{t[a]=n;let e=a.toLowerCase();n&&("tid"===e||"tenantid"===e)&&(this._tid=n)}}}),t};try{this._currenttUrl=Object.freeze(new URL(e))}catch(t){throw Error(`[TeamsUrl::ctor] - error - ${t} url ${e}`)}if(this._currenttUrl.hash&&-1!==this._currenttUrl.hash.indexOf("#/")){let e=this._currenttUrl.href.substring(this._currenttUrl.origin.length),t=e.indexOf("#");t>=0&&(this._hash=e.substr(t),this._pathname=e.substr(0,t));let r=this._hash.indexOf("?");r>=0&&(this._search=this._hash.substr(r))}this._queryStrings=this._parse(this._search||this._currenttUrl.search);let t=i(this._currenttUrl);this._isAnonEligible=t[0],this._isAnonRestrictionSatisfied=t[1]}get href(){return this._currenttUrl.href}get isLocal(){return 0===this._currenttUrl.host.indexOf("local.teams.office.com")}get hash(){return this._hash||this._currenttUrl.hash}get pathname(){return this._pathname||this._currenttUrl.pathname}get search(){return this._search||this._currenttUrl.search}get origin(){return this._currenttUrl.origin}get searchParams(){return{get:e=>this._queryStrings[e]}}get queryStrings(){return this._queryStrings}get tenantId(){return 0===this._currenttUrl.host.indexOf("teams.live.")?a.zP:this._tid}get isAnonEligible(){return this._isAnonEligible}get isAnonRestrictionSatisfied(){return this._isAnonRestrictionSatisfied}get alternateUrl(){let e=new URL(this._currenttUrl.href);return this.isLocal?e.port?e.port="":e.port="8080":0===e.host.indexOf("teams.live.")?e.host="teams.microsoft.com":e.host="teams.live.com",e.href}get hasPostMessageAgent(){return this._queryStrings.agent?.toLowerCase()==="postmessage"}}let i=e=>{if(!l)return[!1,!1];for(let t of l)if(t.anonUrlMatch&&e.href.indexOf(t.anonUrlMatch)>-1)return[!0,s(t,e.href)];return[!1,!1]},s=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(let r of e.restrictions)if(t.indexOf(r)>-1)return!0;return!1},l=56909==r.j?[]:null,d=e=>{e&&(l=e)}},900610:function(e,t,r){var a,o;r.d(t,{j:()=>a}),(o=a||(a={}))[o.HomeTenant=0]="HomeTenant",o[o.GuestTenant=1]="GuestTenant",o[o.Anonymous=2]="Anonymous"},757568:function(e,t,r){var a,o,n,i,s,l,d,c,u,p,h,f;r.d(t,{O3:()=>i,R_:()=>n,nM:()=>s,nU:()=>o,oo:()=>a,vs:()=>l}),(d=a||(a={})).SUCCESS="SUCCESS",d.CANCELLED="CANCELLED",d.FAILED="FAILED",d.TIMEOUT="TIMEOUT",(c=o||(o={})).prod="prod",c.life="life",c.dod="dod",c.gcch="gcch",c.gallatin="gallatin",c.airgap08="airgap08",c.airgap09="airgap09",(u=n||(n={})).Aad="Aad",u.MsaLife="MsaLife",(p=i||(i={})).AADReconnecting="AADReconnecting",p.Failure="Failure",p.InteractionRequired="InteractionRequired",p.SignInRestriction="SignInRestriction",p.SkypeReconnecting="SkypeReconnecting",p.Up="Up",(h=s||(s={})).UserDataXCloud="userdataxcloud",h.Auth="auth",h.Core="core",h.Hostcapabilities="hostcapabilities",(f=l||(l={}))[f.Msa=0]="Msa",f[f.MsaLife=1]="MsaLife",f[f.Other=2]="Other"},153439:function(e,t,r){var a,o;r.d(t,{n:()=>a}),(o=a||(a={})).LoginRequired="auth:loginRequired",o.TokenUpdate="auth:tokenUpdate",o.Logout="auth:logout"},732100:function(e,t,r){r.d(t,{l:()=>i});var a=r(672156),o=r(880884);let n=["NoNetwork","RemoteOperationFailed"];class i extends a.G{constructor(e,t){super({type:"AuthError",code:function(e,t){if(t)return t;if("boolean"==typeof e)return e?"SIGN_IN_RESTRICTIONS":"UNKNOWN";if((0,o.a)(e)){let t=e.code;switch(t){case"SignInRestrictions":return"SIGN_IN_RESTRICTIONS";case"ErrorGetUserWhenAnonNotSupported":return"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED";default:return n.includes(t)?"OFFLINE":"UNKNOWN"}}return"UNKNOWN"}(e,t),prevError:"boolean"==typeof e?void 0:e})}getBoundaryProps(){switch(this.code){case"SIGN_IN_RESTRICTIONS":return{title:"default_signinrestrictions_title",description:"default_signinrestrictions_description",actions:["RESTART"]};case"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED":return{title:"default_error_getuser_when_anon_not_supported_title",description:"default_error_getuser_when_anon_not_supported_description"};case"OFFLINE":return{title:"default_auth_no_network_title",description:"default_auth_no_network_description",actions:["RESTART"]};default:return{title:"default_authentication_title",description:"default_authentication_description",actions:["RESTART","SIGN_OUT"]}}}static fromSerialized(e){if(e?.type!=="AuthError")return null;let t=new i(void 0,e.code);return t.deserialize(e),t}}},249808:function(e,t,r){if(r.d(t,{MK:()=>l,WQ:()=>i,uc:()=>s}),56909==r.j)var a=r(50012);if(56909==r.j)var o=r(283499);let n=56909==r.j?{enableOTPMeetings:!1}:null,i=e=>{n.enableOTPMeetings=e},s=e=>e||!!n.enableOTPMeetings;async function l(e,t,r,o){try{r.addScenarioMark("auth-web-get-organizer-ring-start");let{disableSetOtpEnabledFromHostTenantId:i,enableOTPMeetings:s,otpMeetingEnabledRings:l}=t?.get(a.J.Auth)||{};if(s){n.enableOTPMeetings=!0;return}if(!l||i)return;r.addEventData(["makeConfigApiCall:1"]);let c=await d(e,o,r,t);if(!l.includes(c))return void r.addEventData(["setOTPEnabled:0"]);r.addEventData(["setOTPEnabled:1"]),n.enableOTPMeetings=!0}catch(e){r.addEventData(["setOTPEnabled:failure"])}}async function d(e,t,r,n){try{let{disableSetOtpEnabledFromHostOid:i,configApiBaseUrlWeb:s}=n?.get(a.J.Auth)||{},{Tid:l,Oid:d}=function(e,t){if(!e)return{};let r={};try{let t=new URL(e).search.substring(1);return(t?.split("&")).forEach(e=>{let t=e.split("=");r[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}),{Tid:r.context?JSON.parse(r.context).Tid:null,Oid:r.context?JSON.parse(r.context).Oid:null}}catch(e){t.addEventData(["getUrlParams:Failure"])}return{Tid:null,Oid:null}}(e,r),c=t??l,u=s??"https://config.teams.microsoft.com/config/v1/MicrosoftTeams/1415_1.0.0.0?",p=i||!d?`${u}tenantId=${c}`:`${u}tenantId=${c}&id=${d}`,h=await (0,o.l)({url:p,method:"GET",headers:{},serviceName:"auth",apiName:"getConfig"}),f=await h.body?.json(),m=f?.Segmentation?.TeamsRing;return r.addEventData([`organizerRing:${m}`]),m}catch(e){r.addEventData(["configApiCall:Failure"]),r.addScenarioMark("auth-web-get-meeting-config-failure")}return"general"}}}]);